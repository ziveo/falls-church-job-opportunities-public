(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&i(a)}).observe(document,{childList:!0,subtree:!0});function r(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerpolicy&&(s.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?s.credentials="include":n.crossorigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(n){if(n.ep)return;n.ep=!0;const s=r(n);fetch(n.href,s)}})();function g$e(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var v5={exports:{}},Hr={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var DR=Symbol.for("react.element"),y$e=Symbol.for("react.portal"),b$e=Symbol.for("react.fragment"),v$e=Symbol.for("react.strict_mode"),_$e=Symbol.for("react.profiler"),w$e=Symbol.for("react.provider"),x$e=Symbol.for("react.context"),T$e=Symbol.for("react.forward_ref"),S$e=Symbol.for("react.suspense"),E$e=Symbol.for("react.memo"),C$e=Symbol.for("react.lazy"),Doe=Symbol.iterator;function A$e(e){return e===null||typeof e!="object"?null:(e=Doe&&e[Doe]||e["@@iterator"],typeof e=="function"?e:null)}var nve={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},sve=Object.assign,ave={};function j9(e,t,r){this.props=e,this.context=t,this.refs=ave,this.updater=r||nve}j9.prototype.isReactComponent={};j9.prototype.setState=function(e,t){if(typeof e!="object"&&typeof e!="function"&&e!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")};j9.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")};function ove(){}ove.prototype=j9.prototype;function Eee(e,t,r){this.props=e,this.context=t,this.refs=ave,this.updater=r||nve}var Cee=Eee.prototype=new ove;Cee.constructor=Eee;sve(Cee,j9.prototype);Cee.isPureReactComponent=!0;var Foe=Array.isArray,lve=Object.prototype.hasOwnProperty,Aee={current:null},cve={key:!0,ref:!0,__self:!0,__source:!0};function dve(e,t,r){var i,n={},s=null,a=null;if(t!=null)for(i in t.ref!==void 0&&(a=t.ref),t.key!==void 0&&(s=""+t.key),t)lve.call(t,i)&&!cve.hasOwnProperty(i)&&(n[i]=t[i]);var o=arguments.length-2;if(o===1)n.children=r;else if(1<o){for(var l=Array(o),c=0;c<o;c++)l[c]=arguments[c+2];n.children=l}if(e&&e.defaultProps)for(i in o=e.defaultProps,o)n[i]===void 0&&(n[i]=o[i]);return{$$typeof:DR,type:e,key:s,ref:a,props:n,_owner:Aee.current}}function R$e(e,t){return{$$typeof:DR,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}function Ree(e){return typeof e=="object"&&e!==null&&e.$$typeof===DR}function O$e(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(r){return t[r]})}var Noe=/\/+/g;function gB(e,t){return typeof e=="object"&&e!==null&&e.key!=null?O$e(""+e.key):t.toString(36)}function E$(e,t,r,i,n){var s=typeof e;(s==="undefined"||s==="boolean")&&(e=null);var a=!1;if(e===null)a=!0;else switch(s){case"string":case"number":a=!0;break;case"object":switch(e.$$typeof){case DR:case y$e:a=!0}}if(a)return a=e,n=n(a),e=i===""?"."+gB(a,0):i,Foe(n)?(r="",e!=null&&(r=e.replace(Noe,"$&/")+"/"),E$(n,t,r,"",function(c){return c})):n!=null&&(Ree(n)&&(n=R$e(n,r+(!n.key||a&&a.key===n.key?"":(""+n.key).replace(Noe,"$&/")+"/")+e)),t.push(n)),1;if(a=0,i=i===""?".":i+":",Foe(e))for(var o=0;o<e.length;o++){s=e[o];var l=i+gB(s,o);a+=E$(s,t,r,l,n)}else if(l=A$e(e),typeof l=="function")for(e=l.call(e),o=0;!(s=e.next()).done;)s=s.value,l=i+gB(s,o++),a+=E$(s,t,r,l,n);else if(s==="object")throw t=String(e),Error("Objects are not valid as a React child (found: "+(t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return a}function iM(e,t,r){if(e==null)return e;var i=[],n=0;return E$(e,i,"","",function(s){return t.call(r,s,n++)}),i}function M$e(e){if(e._status===-1){var t=e._result;t=t(),t.then(function(r){(e._status===0||e._status===-1)&&(e._status=1,e._result=r)},function(r){(e._status===0||e._status===-1)&&(e._status=2,e._result=r)}),e._status===-1&&(e._status=0,e._result=t)}if(e._status===1)return e._result.default;throw e._result}var mc={current:null},C$={transition:null},P$e={ReactCurrentDispatcher:mc,ReactCurrentBatchConfig:C$,ReactCurrentOwner:Aee};Hr.Children={map:iM,forEach:function(e,t,r){iM(e,function(){t.apply(this,arguments)},r)},count:function(e){var t=0;return iM(e,function(){t++}),t},toArray:function(e){return iM(e,function(t){return t})||[]},only:function(e){if(!Ree(e))throw Error("React.Children.only expected to receive a single React element child.");return e}};Hr.Component=j9;Hr.Fragment=b$e;Hr.Profiler=_$e;Hr.PureComponent=Eee;Hr.StrictMode=v$e;Hr.Suspense=S$e;Hr.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=P$e;Hr.cloneElement=function(e,t,r){if(e==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var i=sve({},e.props),n=e.key,s=e.ref,a=e._owner;if(t!=null){if(t.ref!==void 0&&(s=t.ref,a=Aee.current),t.key!==void 0&&(n=""+t.key),e.type&&e.type.defaultProps)var o=e.type.defaultProps;for(l in t)lve.call(t,l)&&!cve.hasOwnProperty(l)&&(i[l]=t[l]===void 0&&o!==void 0?o[l]:t[l])}var l=arguments.length-2;if(l===1)i.children=r;else if(1<l){o=Array(l);for(var c=0;c<l;c++)o[c]=arguments[c+2];i.children=o}return{$$typeof:DR,type:e.type,key:n,ref:s,props:i,_owner:a}};Hr.createContext=function(e){return e={$$typeof:x$e,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},e.Provider={$$typeof:w$e,_context:e},e.Consumer=e};Hr.createElement=dve;Hr.createFactory=function(e){var t=dve.bind(null,e);return t.type=e,t};Hr.createRef=function(){return{current:null}};Hr.forwardRef=function(e){return{$$typeof:T$e,render:e}};Hr.isValidElement=Ree;Hr.lazy=function(e){return{$$typeof:C$e,_payload:{_status:-1,_result:e},_init:M$e}};Hr.memo=function(e,t){return{$$typeof:E$e,type:e,compare:t===void 0?null:t}};Hr.startTransition=function(e){var t=C$.transition;C$.transition={};try{e()}finally{C$.transition=t}};Hr.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")};Hr.useCallback=function(e,t){return mc.current.useCallback(e,t)};Hr.useContext=function(e){return mc.current.useContext(e)};Hr.useDebugValue=function(){};Hr.useDeferredValue=function(e){return mc.current.useDeferredValue(e)};Hr.useEffect=function(e,t){return mc.current.useEffect(e,t)};Hr.useId=function(){return mc.current.useId()};Hr.useImperativeHandle=function(e,t,r){return mc.current.useImperativeHandle(e,t,r)};Hr.useInsertionEffect=function(e,t){return mc.current.useInsertionEffect(e,t)};Hr.useLayoutEffect=function(e,t){return mc.current.useLayoutEffect(e,t)};Hr.useMemo=function(e,t){return mc.current.useMemo(e,t)};Hr.useReducer=function(e,t,r){return mc.current.useReducer(e,t,r)};Hr.useRef=function(e){return mc.current.useRef(e)};Hr.useState=function(e){return mc.current.useState(e)};Hr.useSyncExternalStore=function(e,t,r){return mc.current.useSyncExternalStore(e,t,r)};Hr.useTransition=function(){return mc.current.useTransition()};Hr.version="18.2.0";(function(e){e.exports=Hr})(v5);const I$e=g$e(v5.exports);var eW={},uve={exports:{}},Pu={},hve={exports:{}},fve={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(e){function t(F,U){var j=F.length;F.push(U);e:for(;0<j;){var W=j-1>>>1,Z=F[W];if(0<n(Z,U))F[W]=U,F[j]=Z,j=W;else break e}}function r(F){return F.length===0?null:F[0]}function i(F){if(F.length===0)return null;var U=F[0],j=F.pop();if(j!==U){F[0]=j;e:for(var W=0,Z=F.length,q=Z>>>1;W<q;){var ee=2*(W+1)-1,me=F[ee],_e=ee+1,De=F[_e];if(0>n(me,j))_e<Z&&0>n(De,me)?(F[W]=De,F[_e]=j,W=_e):(F[W]=me,F[ee]=j,W=ee);else if(_e<Z&&0>n(De,j))F[W]=De,F[_e]=j,W=_e;else break e}}return U}function n(F,U){var j=F.sortIndex-U.sortIndex;return j!==0?j:F.id-U.id}if(typeof performance=="object"&&typeof performance.now=="function"){var s=performance;e.unstable_now=function(){return s.now()}}else{var a=Date,o=a.now();e.unstable_now=function(){return a.now()-o}}var l=[],c=[],u=1,h=null,p=3,m=!1,g=!1,b=!1,w=typeof setTimeout=="function"?setTimeout:null,v=typeof clearTimeout=="function"?clearTimeout:null,x=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function T(F){for(var U=r(c);U!==null;){if(U.callback===null)i(c);else if(U.startTime<=F)i(c),U.sortIndex=U.expirationTime,t(l,U);else break;U=r(c)}}function E(F){if(b=!1,T(F),!g)if(r(l)!==null)g=!0,se(C);else{var U=r(c);U!==null&&D(E,U.startTime-F)}}function C(F,U){g=!1,b&&(b=!1,v(I),I=-1),m=!0;var j=p;try{for(T(U),h=r(l);h!==null&&(!(h.expirationTime>U)||F&&!G());){var W=h.callback;if(typeof W=="function"){h.callback=null,p=h.priorityLevel;var Z=W(h.expirationTime<=U);U=e.unstable_now(),typeof Z=="function"?h.callback=Z:h===r(l)&&i(l),T(U)}else i(l);h=r(l)}if(h!==null)var q=!0;else{var ee=r(c);ee!==null&&D(E,ee.startTime-U),q=!1}return q}finally{h=null,p=j,m=!1}}var A=!1,P=null,I=-1,L=5,V=-1;function G(){return!(e.unstable_now()-V<L)}function B(){if(P!==null){var F=e.unstable_now();V=F;var U=!0;try{U=P(!0,F)}finally{U?X():(A=!1,P=null)}}else A=!1}var X;if(typeof x=="function")X=function(){x(B)};else if(typeof MessageChannel<"u"){var Y=new MessageChannel,ce=Y.port2;Y.port1.onmessage=B,X=function(){ce.postMessage(null)}}else X=function(){w(B,0)};function se(F){P=F,A||(A=!0,X())}function D(F,U){I=w(function(){F(e.unstable_now())},U)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(F){F.callback=null},e.unstable_continueExecution=function(){g||m||(g=!0,se(C))},e.unstable_forceFrameRate=function(F){0>F||125<F?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):L=0<F?Math.floor(1e3/F):5},e.unstable_getCurrentPriorityLevel=function(){return p},e.unstable_getFirstCallbackNode=function(){return r(l)},e.unstable_next=function(F){switch(p){case 1:case 2:case 3:var U=3;break;default:U=p}var j=p;p=U;try{return F()}finally{p=j}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(F,U){switch(F){case 1:case 2:case 3:case 4:case 5:break;default:F=3}var j=p;p=F;try{return U()}finally{p=j}},e.unstable_scheduleCallback=function(F,U,j){var W=e.unstable_now();switch(typeof j=="object"&&j!==null?(j=j.delay,j=typeof j=="number"&&0<j?W+j:W):j=W,F){case 1:var Z=-1;break;case 2:Z=250;break;case 5:Z=1073741823;break;case 4:Z=1e4;break;default:Z=5e3}return Z=j+Z,F={id:u++,callback:U,priorityLevel:F,startTime:j,expirationTime:Z,sortIndex:-1},j>W?(F.sortIndex=j,t(c,F),r(l)===null&&F===r(c)&&(b?(v(I),I=-1):b=!0,D(E,j-W))):(F.sortIndex=Z,t(l,F),g||m||(g=!0,se(C))),F},e.unstable_shouldYield=G,e.unstable_wrapCallback=function(F){var U=p;return function(){var j=p;p=U;try{return F.apply(this,arguments)}finally{p=j}}}})(fve);(function(e){e.exports=fve})(hve);/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var pve=v5.exports,xu=hve.exports;function ke(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,r=1;r<arguments.length;r++)t+="&args[]="+encodeURIComponent(arguments[r]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var mve=new Set,D7={};function fx(e,t){_5(e,t),_5(e+"Capture",t)}function _5(e,t){for(D7[e]=t,e=0;e<t.length;e++)mve.add(t[e])}var xy=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),tW=Object.prototype.hasOwnProperty,$$e=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,koe={},Voe={};function L$e(e){return tW.call(Voe,e)?!0:tW.call(koe,e)?!1:$$e.test(e)?Voe[e]=!0:(koe[e]=!0,!1)}function D$e(e,t,r,i){if(r!==null&&r.type===0)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return i?!1:r!==null?!r.acceptsBooleans:(e=e.toLowerCase().slice(0,5),e!=="data-"&&e!=="aria-");default:return!1}}function F$e(e,t,r,i){if(t===null||typeof t>"u"||D$e(e,t,r,i))return!0;if(i)return!1;if(r!==null)switch(r.type){case 3:return!t;case 4:return t===!1;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}function gc(e,t,r,i,n,s,a){this.acceptsBooleans=t===2||t===3||t===4,this.attributeName=i,this.attributeNamespace=n,this.mustUseProperty=r,this.propertyName=e,this.type=t,this.sanitizeURL=s,this.removeEmptyString=a}var Lo={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){Lo[e]=new gc(e,0,!1,e,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var t=e[0];Lo[t]=new gc(t,1,!1,e[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(e){Lo[e]=new gc(e,2,!1,e.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){Lo[e]=new gc(e,2,!1,e,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){Lo[e]=new gc(e,3,!1,e.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(e){Lo[e]=new gc(e,3,!0,e,null,!1,!1)});["capture","download"].forEach(function(e){Lo[e]=new gc(e,4,!1,e,null,!1,!1)});["cols","rows","size","span"].forEach(function(e){Lo[e]=new gc(e,6,!1,e,null,!1,!1)});["rowSpan","start"].forEach(function(e){Lo[e]=new gc(e,5,!1,e.toLowerCase(),null,!1,!1)});var Oee=/[\-:]([a-z])/g;function Mee(e){return e[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var t=e.replace(Oee,Mee);Lo[t]=new gc(t,1,!1,e,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var t=e.replace(Oee,Mee);Lo[t]=new gc(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(e){var t=e.replace(Oee,Mee);Lo[t]=new gc(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(e){Lo[e]=new gc(e,1,!1,e.toLowerCase(),null,!1,!1)});Lo.xlinkHref=new gc("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(e){Lo[e]=new gc(e,1,!1,e.toLowerCase(),null,!0,!0)});function Pee(e,t,r,i){var n=Lo.hasOwnProperty(t)?Lo[t]:null;(n!==null?n.type!==0:i||!(2<t.length)||t[0]!=="o"&&t[0]!=="O"||t[1]!=="n"&&t[1]!=="N")&&(F$e(t,r,n,i)&&(r=null),i||n===null?L$e(t)&&(r===null?e.removeAttribute(t):e.setAttribute(t,""+r)):n.mustUseProperty?e[n.propertyName]=r===null?n.type===3?!1:"":r:(t=n.attributeName,i=n.attributeNamespace,r===null?e.removeAttribute(t):(n=n.type,r=n===3||n===4&&r===!0?"":""+r,i?e.setAttributeNS(i,t,r):e.setAttribute(t,r))))}var Uy=pve.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,nM=Symbol.for("react.element"),ZS=Symbol.for("react.portal"),QS=Symbol.for("react.fragment"),Iee=Symbol.for("react.strict_mode"),rW=Symbol.for("react.profiler"),gve=Symbol.for("react.provider"),yve=Symbol.for("react.context"),$ee=Symbol.for("react.forward_ref"),iW=Symbol.for("react.suspense"),nW=Symbol.for("react.suspense_list"),Lee=Symbol.for("react.memo"),O1=Symbol.for("react.lazy"),bve=Symbol.for("react.offscreen"),zoe=Symbol.iterator;function A6(e){return e===null||typeof e!="object"?null:(e=zoe&&e[zoe]||e["@@iterator"],typeof e=="function"?e:null)}var ts=Object.assign,yB;function K8(e){if(yB===void 0)try{throw Error()}catch(r){var t=r.stack.trim().match(/\n( *(at )?)/);yB=t&&t[1]||""}return`
`+yB+e}var bB=!1;function vB(e,t){if(!e||bB)return"";bB=!0;var r=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(t,[])}catch(c){var i=c}Reflect.construct(e,[],t)}else{try{t.call()}catch(c){i=c}e.call(t.prototype)}else{try{throw Error()}catch(c){i=c}e()}}catch(c){if(c&&i&&typeof c.stack=="string"){for(var n=c.stack.split(`
`),s=i.stack.split(`
`),a=n.length-1,o=s.length-1;1<=a&&0<=o&&n[a]!==s[o];)o--;for(;1<=a&&0<=o;a--,o--)if(n[a]!==s[o]){if(a!==1||o!==1)do if(a--,o--,0>o||n[a]!==s[o]){var l=`
`+n[a].replace(" at new "," at ");return e.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",e.displayName)),l}while(1<=a&&0<=o);break}}}finally{bB=!1,Error.prepareStackTrace=r}return(e=e?e.displayName||e.name:"")?K8(e):""}function N$e(e){switch(e.tag){case 5:return K8(e.type);case 16:return K8("Lazy");case 13:return K8("Suspense");case 19:return K8("SuspenseList");case 0:case 2:case 15:return e=vB(e.type,!1),e;case 11:return e=vB(e.type.render,!1),e;case 1:return e=vB(e.type,!0),e;default:return""}}function sW(e){if(e==null)return null;if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case QS:return"Fragment";case ZS:return"Portal";case rW:return"Profiler";case Iee:return"StrictMode";case iW:return"Suspense";case nW:return"SuspenseList"}if(typeof e=="object")switch(e.$$typeof){case yve:return(e.displayName||"Context")+".Consumer";case gve:return(e._context.displayName||"Context")+".Provider";case $ee:var t=e.render;return e=e.displayName,e||(e=t.displayName||t.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case Lee:return t=e.displayName||null,t!==null?t:sW(e.type)||"Memo";case O1:t=e._payload,e=e._init;try{return sW(e(t))}catch{}}return null}function k$e(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=t.render,e=e.displayName||e.name||"",t.displayName||(e!==""?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return sW(t);case 8:return t===Iee?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t}return null}function Uv(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function vve(e){var t=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(t==="checkbox"||t==="radio")}function V$e(e){var t=vve(e)?"checked":"value",r=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),i=""+e[t];if(!e.hasOwnProperty(t)&&typeof r<"u"&&typeof r.get=="function"&&typeof r.set=="function"){var n=r.get,s=r.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return n.call(this)},set:function(a){i=""+a,s.call(this,a)}}),Object.defineProperty(e,t,{enumerable:r.enumerable}),{getValue:function(){return i},setValue:function(a){i=""+a},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}function sM(e){e._valueTracker||(e._valueTracker=V$e(e))}function _ve(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var r=t.getValue(),i="";return e&&(i=vve(e)?e.checked?"true":"false":e.value),e=i,e!==r?(t.setValue(e),!0):!1}function jD(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}function aW(e,t){var r=t.checked;return ts({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:r!=null?r:e._wrapperState.initialChecked})}function Uoe(e,t){var r=t.defaultValue==null?"":t.defaultValue,i=t.checked!=null?t.checked:t.defaultChecked;r=Uv(t.value!=null?t.value:r),e._wrapperState={initialChecked:i,initialValue:r,controlled:t.type==="checkbox"||t.type==="radio"?t.checked!=null:t.value!=null}}function wve(e,t){t=t.checked,t!=null&&Pee(e,"checked",t,!1)}function oW(e,t){wve(e,t);var r=Uv(t.value),i=t.type;if(r!=null)i==="number"?(r===0&&e.value===""||e.value!=r)&&(e.value=""+r):e.value!==""+r&&(e.value=""+r);else if(i==="submit"||i==="reset"){e.removeAttribute("value");return}t.hasOwnProperty("value")?lW(e,t.type,r):t.hasOwnProperty("defaultValue")&&lW(e,t.type,Uv(t.defaultValue)),t.checked==null&&t.defaultChecked!=null&&(e.defaultChecked=!!t.defaultChecked)}function Boe(e,t,r){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var i=t.type;if(!(i!=="submit"&&i!=="reset"||t.value!==void 0&&t.value!==null))return;t=""+e._wrapperState.initialValue,r||t===e.value||(e.value=t),e.defaultValue=t}r=e.name,r!==""&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,r!==""&&(e.name=r)}function lW(e,t,r){(t!=="number"||jD(e.ownerDocument)!==e)&&(r==null?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+r&&(e.defaultValue=""+r))}var eE=Array.isArray;function D4(e,t,r,i){if(e=e.options,t){t={};for(var n=0;n<r.length;n++)t["$"+r[n]]=!0;for(r=0;r<e.length;r++)n=t.hasOwnProperty("$"+e[r].value),e[r].selected!==n&&(e[r].selected=n),n&&i&&(e[r].defaultSelected=!0)}else{for(r=""+Uv(r),t=null,n=0;n<e.length;n++){if(e[n].value===r){e[n].selected=!0,i&&(e[n].defaultSelected=!0);return}t!==null||e[n].disabled||(t=e[n])}t!==null&&(t.selected=!0)}}function cW(e,t){if(t.dangerouslySetInnerHTML!=null)throw Error(ke(91));return ts({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function Goe(e,t){var r=t.value;if(r==null){if(r=t.children,t=t.defaultValue,r!=null){if(t!=null)throw Error(ke(92));if(eE(r)){if(1<r.length)throw Error(ke(93));r=r[0]}t=r}t==null&&(t=""),r=t}e._wrapperState={initialValue:Uv(r)}}function xve(e,t){var r=Uv(t.value),i=Uv(t.defaultValue);r!=null&&(r=""+r,r!==e.value&&(e.value=r),t.defaultValue==null&&e.defaultValue!==r&&(e.defaultValue=r)),i!=null&&(e.defaultValue=""+i)}function joe(e){var t=e.textContent;t===e._wrapperState.initialValue&&t!==""&&t!==null&&(e.value=t)}function Tve(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function dW(e,t){return e==null||e==="http://www.w3.org/1999/xhtml"?Tve(t):e==="http://www.w3.org/2000/svg"&&t==="foreignObject"?"http://www.w3.org/1999/xhtml":e}var aM,Sve=function(e){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(t,r,i,n){MSApp.execUnsafeLocalFunction(function(){return e(t,r,i,n)})}:e}(function(e,t){if(e.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in e)e.innerHTML=t;else{for(aM=aM||document.createElement("div"),aM.innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=aM.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}});function F7(e,t){if(t){var r=e.firstChild;if(r&&r===e.lastChild&&r.nodeType===3){r.nodeValue=t;return}}e.textContent=t}var MC={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},z$e=["Webkit","ms","Moz","O"];Object.keys(MC).forEach(function(e){z$e.forEach(function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),MC[t]=MC[e]})});function Eve(e,t,r){return t==null||typeof t=="boolean"||t===""?"":r||typeof t!="number"||t===0||MC.hasOwnProperty(e)&&MC[e]?(""+t).trim():t+"px"}function Cve(e,t){e=e.style;for(var r in t)if(t.hasOwnProperty(r)){var i=r.indexOf("--")===0,n=Eve(r,t[r],i);r==="float"&&(r="cssFloat"),i?e.setProperty(r,n):e[r]=n}}var U$e=ts({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function uW(e,t){if(t){if(U$e[e]&&(t.children!=null||t.dangerouslySetInnerHTML!=null))throw Error(ke(137,e));if(t.dangerouslySetInnerHTML!=null){if(t.children!=null)throw Error(ke(60));if(typeof t.dangerouslySetInnerHTML!="object"||!("__html"in t.dangerouslySetInnerHTML))throw Error(ke(61))}if(t.style!=null&&typeof t.style!="object")throw Error(ke(62))}}function hW(e,t){if(e.indexOf("-")===-1)return typeof t.is=="string";switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var fW=null;function Dee(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var pW=null,F4=null,N4=null;function qoe(e){if(e=kR(e)){if(typeof pW!="function")throw Error(ke(280));var t=e.stateNode;t&&(t=Hk(t),pW(e.stateNode,e.type,t))}}function Ave(e){F4?N4?N4.push(e):N4=[e]:F4=e}function Rve(){if(F4){var e=F4,t=N4;if(N4=F4=null,qoe(e),t)for(e=0;e<t.length;e++)qoe(t[e])}}function Ove(e,t){return e(t)}function Mve(){}var _B=!1;function Pve(e,t,r){if(_B)return e(t,r);_B=!0;try{return Ove(e,t,r)}finally{_B=!1,(F4!==null||N4!==null)&&(Mve(),Rve())}}function N7(e,t){var r=e.stateNode;if(r===null)return null;var i=Hk(r);if(i===null)return null;r=i[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(i=!i.disabled)||(e=e.type,i=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!i;break e;default:e=!1}if(e)return null;if(r&&typeof r!="function")throw Error(ke(231,t,typeof r));return r}var mW=!1;if(xy)try{var R6={};Object.defineProperty(R6,"passive",{get:function(){mW=!0}}),window.addEventListener("test",R6,R6),window.removeEventListener("test",R6,R6)}catch{mW=!1}function B$e(e,t,r,i,n,s,a,o,l){var c=Array.prototype.slice.call(arguments,3);try{t.apply(r,c)}catch(u){this.onError(u)}}var PC=!1,qD=null,HD=!1,gW=null,G$e={onError:function(e){PC=!0,qD=e}};function j$e(e,t,r,i,n,s,a,o,l){PC=!1,qD=null,B$e.apply(G$e,arguments)}function q$e(e,t,r,i,n,s,a,o,l){if(j$e.apply(this,arguments),PC){if(PC){var c=qD;PC=!1,qD=null}else throw Error(ke(198));HD||(HD=!0,gW=c)}}function px(e){var t=e,r=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do t=e,(t.flags&4098)!==0&&(r=t.return),e=t.return;while(e)}return t.tag===3?r:null}function Ive(e){if(e.tag===13){var t=e.memoizedState;if(t===null&&(e=e.alternate,e!==null&&(t=e.memoizedState)),t!==null)return t.dehydrated}return null}function Hoe(e){if(px(e)!==e)throw Error(ke(188))}function H$e(e){var t=e.alternate;if(!t){if(t=px(e),t===null)throw Error(ke(188));return t!==e?null:e}for(var r=e,i=t;;){var n=r.return;if(n===null)break;var s=n.alternate;if(s===null){if(i=n.return,i!==null){r=i;continue}break}if(n.child===s.child){for(s=n.child;s;){if(s===r)return Hoe(n),e;if(s===i)return Hoe(n),t;s=s.sibling}throw Error(ke(188))}if(r.return!==i.return)r=n,i=s;else{for(var a=!1,o=n.child;o;){if(o===r){a=!0,r=n,i=s;break}if(o===i){a=!0,i=n,r=s;break}o=o.sibling}if(!a){for(o=s.child;o;){if(o===r){a=!0,r=s,i=n;break}if(o===i){a=!0,i=s,r=n;break}o=o.sibling}if(!a)throw Error(ke(189))}}if(r.alternate!==i)throw Error(ke(190))}if(r.tag!==3)throw Error(ke(188));return r.stateNode.current===r?e:t}function $ve(e){return e=H$e(e),e!==null?Lve(e):null}function Lve(e){if(e.tag===5||e.tag===6)return e;for(e=e.child;e!==null;){var t=Lve(e);if(t!==null)return t;e=e.sibling}return null}var Dve=xu.unstable_scheduleCallback,Woe=xu.unstable_cancelCallback,W$e=xu.unstable_shouldYield,X$e=xu.unstable_requestPaint,Fs=xu.unstable_now,Y$e=xu.unstable_getCurrentPriorityLevel,Fee=xu.unstable_ImmediatePriority,Fve=xu.unstable_UserBlockingPriority,WD=xu.unstable_NormalPriority,Z$e=xu.unstable_LowPriority,Nve=xu.unstable_IdlePriority,Bk=null,J0=null;function Q$e(e){if(J0&&typeof J0.onCommitFiberRoot=="function")try{J0.onCommitFiberRoot(Bk,e,void 0,(e.current.flags&128)===128)}catch{}}var wp=Math.clz32?Math.clz32:eLe,J$e=Math.log,K$e=Math.LN2;function eLe(e){return e>>>=0,e===0?32:31-(J$e(e)/K$e|0)|0}var oM=64,lM=4194304;function tE(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return e&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function XD(e,t){var r=e.pendingLanes;if(r===0)return 0;var i=0,n=e.suspendedLanes,s=e.pingedLanes,a=r&268435455;if(a!==0){var o=a&~n;o!==0?i=tE(o):(s&=a,s!==0&&(i=tE(s)))}else a=r&~n,a!==0?i=tE(a):s!==0&&(i=tE(s));if(i===0)return 0;if(t!==0&&t!==i&&(t&n)===0&&(n=i&-i,s=t&-t,n>=s||n===16&&(s&4194240)!==0))return t;if((i&4)!==0&&(i|=r&16),t=e.entangledLanes,t!==0)for(e=e.entanglements,t&=i;0<t;)r=31-wp(t),n=1<<r,i|=e[r],t&=~n;return i}function tLe(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function rLe(e,t){for(var r=e.suspendedLanes,i=e.pingedLanes,n=e.expirationTimes,s=e.pendingLanes;0<s;){var a=31-wp(s),o=1<<a,l=n[a];l===-1?((o&r)===0||(o&i)!==0)&&(n[a]=tLe(o,t)):l<=t&&(e.expiredLanes|=o),s&=~o}}function yW(e){return e=e.pendingLanes&-1073741825,e!==0?e:e&1073741824?1073741824:0}function kve(){var e=oM;return oM<<=1,(oM&4194240)===0&&(oM=64),e}function wB(e){for(var t=[],r=0;31>r;r++)t.push(e);return t}function FR(e,t,r){e.pendingLanes|=t,t!==536870912&&(e.suspendedLanes=0,e.pingedLanes=0),e=e.eventTimes,t=31-wp(t),e[t]=r}function iLe(e,t){var r=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var i=e.eventTimes;for(e=e.expirationTimes;0<r;){var n=31-wp(r),s=1<<n;t[n]=0,i[n]=-1,e[n]=-1,r&=~s}}function Nee(e,t){var r=e.entangledLanes|=t;for(e=e.entanglements;r;){var i=31-wp(r),n=1<<i;n&t|e[i]&t&&(e[i]|=t),r&=~n}}var zi=0;function Vve(e){return e&=-e,1<e?4<e?(e&268435455)!==0?16:536870912:4:1}var zve,kee,Uve,Bve,Gve,bW=!1,cM=[],_v=null,wv=null,xv=null,k7=new Map,V7=new Map,G1=[],nLe="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Xoe(e,t){switch(e){case"focusin":case"focusout":_v=null;break;case"dragenter":case"dragleave":wv=null;break;case"mouseover":case"mouseout":xv=null;break;case"pointerover":case"pointerout":k7.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":V7.delete(t.pointerId)}}function O6(e,t,r,i,n,s){return e===null||e.nativeEvent!==s?(e={blockedOn:t,domEventName:r,eventSystemFlags:i,nativeEvent:s,targetContainers:[n]},t!==null&&(t=kR(t),t!==null&&kee(t)),e):(e.eventSystemFlags|=i,t=e.targetContainers,n!==null&&t.indexOf(n)===-1&&t.push(n),e)}function sLe(e,t,r,i,n){switch(t){case"focusin":return _v=O6(_v,e,t,r,i,n),!0;case"dragenter":return wv=O6(wv,e,t,r,i,n),!0;case"mouseover":return xv=O6(xv,e,t,r,i,n),!0;case"pointerover":var s=n.pointerId;return k7.set(s,O6(k7.get(s)||null,e,t,r,i,n)),!0;case"gotpointercapture":return s=n.pointerId,V7.set(s,O6(V7.get(s)||null,e,t,r,i,n)),!0}return!1}function jve(e){var t=L3(e.target);if(t!==null){var r=px(t);if(r!==null){if(t=r.tag,t===13){if(t=Ive(r),t!==null){e.blockedOn=t,Gve(e.priority,function(){Uve(r)});return}}else if(t===3&&r.stateNode.current.memoizedState.isDehydrated){e.blockedOn=r.tag===3?r.stateNode.containerInfo:null;return}}}e.blockedOn=null}function A$(e){if(e.blockedOn!==null)return!1;for(var t=e.targetContainers;0<t.length;){var r=vW(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(r===null){r=e.nativeEvent;var i=new r.constructor(r.type,r);fW=i,r.target.dispatchEvent(i),fW=null}else return t=kR(r),t!==null&&kee(t),e.blockedOn=r,!1;t.shift()}return!0}function Yoe(e,t,r){A$(e)&&r.delete(t)}function aLe(){bW=!1,_v!==null&&A$(_v)&&(_v=null),wv!==null&&A$(wv)&&(wv=null),xv!==null&&A$(xv)&&(xv=null),k7.forEach(Yoe),V7.forEach(Yoe)}function M6(e,t){e.blockedOn===t&&(e.blockedOn=null,bW||(bW=!0,xu.unstable_scheduleCallback(xu.unstable_NormalPriority,aLe)))}function z7(e){function t(n){return M6(n,e)}if(0<cM.length){M6(cM[0],e);for(var r=1;r<cM.length;r++){var i=cM[r];i.blockedOn===e&&(i.blockedOn=null)}}for(_v!==null&&M6(_v,e),wv!==null&&M6(wv,e),xv!==null&&M6(xv,e),k7.forEach(t),V7.forEach(t),r=0;r<G1.length;r++)i=G1[r],i.blockedOn===e&&(i.blockedOn=null);for(;0<G1.length&&(r=G1[0],r.blockedOn===null);)jve(r),r.blockedOn===null&&G1.shift()}var k4=Uy.ReactCurrentBatchConfig,YD=!0;function oLe(e,t,r,i){var n=zi,s=k4.transition;k4.transition=null;try{zi=1,Vee(e,t,r,i)}finally{zi=n,k4.transition=s}}function lLe(e,t,r,i){var n=zi,s=k4.transition;k4.transition=null;try{zi=4,Vee(e,t,r,i)}finally{zi=n,k4.transition=s}}function Vee(e,t,r,i){if(YD){var n=vW(e,t,r,i);if(n===null)PB(e,t,i,ZD,r),Xoe(e,i);else if(sLe(n,e,t,r,i))i.stopPropagation();else if(Xoe(e,i),t&4&&-1<nLe.indexOf(e)){for(;n!==null;){var s=kR(n);if(s!==null&&zve(s),s=vW(e,t,r,i),s===null&&PB(e,t,i,ZD,r),s===n)break;n=s}n!==null&&i.stopPropagation()}else PB(e,t,i,null,r)}}var ZD=null;function vW(e,t,r,i){if(ZD=null,e=Dee(i),e=L3(e),e!==null)if(t=px(e),t===null)e=null;else if(r=t.tag,r===13){if(e=Ive(t),e!==null)return e;e=null}else if(r===3){if(t.stateNode.current.memoizedState.isDehydrated)return t.tag===3?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return ZD=e,null}function qve(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Y$e()){case Fee:return 1;case Fve:return 4;case WD:case Z$e:return 16;case Nve:return 536870912;default:return 16}default:return 16}}var K1=null,zee=null,R$=null;function Hve(){if(R$)return R$;var e,t=zee,r=t.length,i,n="value"in K1?K1.value:K1.textContent,s=n.length;for(e=0;e<r&&t[e]===n[e];e++);var a=r-e;for(i=1;i<=a&&t[r-i]===n[s-i];i++);return R$=n.slice(e,1<i?1-i:void 0)}function O$(e){var t=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&t===13&&(e=13)):e=t,e===10&&(e=13),32<=e||e===13?e:0}function dM(){return!0}function Zoe(){return!1}function Iu(e){function t(r,i,n,s,a){this._reactName=r,this._targetInst=n,this.type=i,this.nativeEvent=s,this.target=a,this.currentTarget=null;for(var o in e)e.hasOwnProperty(o)&&(r=e[o],this[o]=r?r(s):s[o]);return this.isDefaultPrevented=(s.defaultPrevented!=null?s.defaultPrevented:s.returnValue===!1)?dM:Zoe,this.isPropagationStopped=Zoe,this}return ts(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var r=this.nativeEvent;r&&(r.preventDefault?r.preventDefault():typeof r.returnValue!="unknown"&&(r.returnValue=!1),this.isDefaultPrevented=dM)},stopPropagation:function(){var r=this.nativeEvent;r&&(r.stopPropagation?r.stopPropagation():typeof r.cancelBubble!="unknown"&&(r.cancelBubble=!0),this.isPropagationStopped=dM)},persist:function(){},isPersistent:dM}),t}var q9={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Uee=Iu(q9),NR=ts({},q9,{view:0,detail:0}),cLe=Iu(NR),xB,TB,P6,Gk=ts({},NR,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Bee,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==P6&&(P6&&e.type==="mousemove"?(xB=e.screenX-P6.screenX,TB=e.screenY-P6.screenY):TB=xB=0,P6=e),xB)},movementY:function(e){return"movementY"in e?e.movementY:TB}}),Qoe=Iu(Gk),dLe=ts({},Gk,{dataTransfer:0}),uLe=Iu(dLe),hLe=ts({},NR,{relatedTarget:0}),SB=Iu(hLe),fLe=ts({},q9,{animationName:0,elapsedTime:0,pseudoElement:0}),pLe=Iu(fLe),mLe=ts({},q9,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),gLe=Iu(mLe),yLe=ts({},q9,{data:0}),Joe=Iu(yLe),bLe={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},vLe={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},_Le={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function wLe(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):(e=_Le[e])?!!t[e]:!1}function Bee(){return wLe}var xLe=ts({},NR,{key:function(e){if(e.key){var t=bLe[e.key]||e.key;if(t!=="Unidentified")return t}return e.type==="keypress"?(e=O$(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?vLe[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Bee,charCode:function(e){return e.type==="keypress"?O$(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?O$(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),TLe=Iu(xLe),SLe=ts({},Gk,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Koe=Iu(SLe),ELe=ts({},NR,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Bee}),CLe=Iu(ELe),ALe=ts({},q9,{propertyName:0,elapsedTime:0,pseudoElement:0}),RLe=Iu(ALe),OLe=ts({},Gk,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),MLe=Iu(OLe),PLe=[9,13,27,32],Gee=xy&&"CompositionEvent"in window,IC=null;xy&&"documentMode"in document&&(IC=document.documentMode);var ILe=xy&&"TextEvent"in window&&!IC,Wve=xy&&(!Gee||IC&&8<IC&&11>=IC),ele=String.fromCharCode(32),tle=!1;function Xve(e,t){switch(e){case"keyup":return PLe.indexOf(t.keyCode)!==-1;case"keydown":return t.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Yve(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var JS=!1;function $Le(e,t){switch(e){case"compositionend":return Yve(t);case"keypress":return t.which!==32?null:(tle=!0,ele);case"textInput":return e=t.data,e===ele&&tle?null:e;default:return null}}function LLe(e,t){if(JS)return e==="compositionend"||!Gee&&Xve(e,t)?(e=Hve(),R$=zee=K1=null,JS=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return Wve&&t.locale!=="ko"?null:t.data;default:return null}}var DLe={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function rle(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t==="input"?!!DLe[e.type]:t==="textarea"}function Zve(e,t,r,i){Ave(i),t=QD(t,"onChange"),0<t.length&&(r=new Uee("onChange","change",null,r,i),e.push({event:r,listeners:t}))}var $C=null,U7=null;function FLe(e){o_e(e,0)}function jk(e){var t=t4(e);if(_ve(t))return e}function NLe(e,t){if(e==="change")return t}var Qve=!1;if(xy){var EB;if(xy){var CB="oninput"in document;if(!CB){var ile=document.createElement("div");ile.setAttribute("oninput","return;"),CB=typeof ile.oninput=="function"}EB=CB}else EB=!1;Qve=EB&&(!document.documentMode||9<document.documentMode)}function nle(){$C&&($C.detachEvent("onpropertychange",Jve),U7=$C=null)}function Jve(e){if(e.propertyName==="value"&&jk(U7)){var t=[];Zve(t,U7,e,Dee(e)),Pve(FLe,t)}}function kLe(e,t,r){e==="focusin"?(nle(),$C=t,U7=r,$C.attachEvent("onpropertychange",Jve)):e==="focusout"&&nle()}function VLe(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return jk(U7)}function zLe(e,t){if(e==="click")return jk(t)}function ULe(e,t){if(e==="input"||e==="change")return jk(t)}function BLe(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var Rp=typeof Object.is=="function"?Object.is:BLe;function B7(e,t){if(Rp(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;var r=Object.keys(e),i=Object.keys(t);if(r.length!==i.length)return!1;for(i=0;i<r.length;i++){var n=r[i];if(!tW.call(t,n)||!Rp(e[n],t[n]))return!1}return!0}function sle(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function ale(e,t){var r=sle(e);e=0;for(var i;r;){if(r.nodeType===3){if(i=e+r.textContent.length,e<=t&&i>=t)return{node:r,offset:t-e};e=i}e:{for(;r;){if(r.nextSibling){r=r.nextSibling;break e}r=r.parentNode}r=void 0}r=sle(r)}}function Kve(e,t){return e&&t?e===t?!0:e&&e.nodeType===3?!1:t&&t.nodeType===3?Kve(e,t.parentNode):"contains"in e?e.contains(t):e.compareDocumentPosition?!!(e.compareDocumentPosition(t)&16):!1:!1}function e_e(){for(var e=window,t=jD();t instanceof e.HTMLIFrameElement;){try{var r=typeof t.contentWindow.location.href=="string"}catch{r=!1}if(r)e=t.contentWindow;else break;t=jD(e.document)}return t}function jee(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&(t==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||t==="textarea"||e.contentEditable==="true")}function GLe(e){var t=e_e(),r=e.focusedElem,i=e.selectionRange;if(t!==r&&r&&r.ownerDocument&&Kve(r.ownerDocument.documentElement,r)){if(i!==null&&jee(r)){if(t=i.start,e=i.end,e===void 0&&(e=t),"selectionStart"in r)r.selectionStart=t,r.selectionEnd=Math.min(e,r.value.length);else if(e=(t=r.ownerDocument||document)&&t.defaultView||window,e.getSelection){e=e.getSelection();var n=r.textContent.length,s=Math.min(i.start,n);i=i.end===void 0?s:Math.min(i.end,n),!e.extend&&s>i&&(n=i,i=s,s=n),n=ale(r,s);var a=ale(r,i);n&&a&&(e.rangeCount!==1||e.anchorNode!==n.node||e.anchorOffset!==n.offset||e.focusNode!==a.node||e.focusOffset!==a.offset)&&(t=t.createRange(),t.setStart(n.node,n.offset),e.removeAllRanges(),s>i?(e.addRange(t),e.extend(a.node,a.offset)):(t.setEnd(a.node,a.offset),e.addRange(t)))}}for(t=[],e=r;e=e.parentNode;)e.nodeType===1&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for(typeof r.focus=="function"&&r.focus(),r=0;r<t.length;r++)e=t[r],e.element.scrollLeft=e.left,e.element.scrollTop=e.top}}var jLe=xy&&"documentMode"in document&&11>=document.documentMode,KS=null,_W=null,LC=null,wW=!1;function ole(e,t,r){var i=r.window===r?r.document:r.nodeType===9?r:r.ownerDocument;wW||KS==null||KS!==jD(i)||(i=KS,"selectionStart"in i&&jee(i)?i={start:i.selectionStart,end:i.selectionEnd}:(i=(i.ownerDocument&&i.ownerDocument.defaultView||window).getSelection(),i={anchorNode:i.anchorNode,anchorOffset:i.anchorOffset,focusNode:i.focusNode,focusOffset:i.focusOffset}),LC&&B7(LC,i)||(LC=i,i=QD(_W,"onSelect"),0<i.length&&(t=new Uee("onSelect","select",null,t,r),e.push({event:t,listeners:i}),t.target=KS)))}function uM(e,t){var r={};return r[e.toLowerCase()]=t.toLowerCase(),r["Webkit"+e]="webkit"+t,r["Moz"+e]="moz"+t,r}var e4={animationend:uM("Animation","AnimationEnd"),animationiteration:uM("Animation","AnimationIteration"),animationstart:uM("Animation","AnimationStart"),transitionend:uM("Transition","TransitionEnd")},AB={},t_e={};xy&&(t_e=document.createElement("div").style,"AnimationEvent"in window||(delete e4.animationend.animation,delete e4.animationiteration.animation,delete e4.animationstart.animation),"TransitionEvent"in window||delete e4.transitionend.transition);function qk(e){if(AB[e])return AB[e];if(!e4[e])return e;var t=e4[e],r;for(r in t)if(t.hasOwnProperty(r)&&r in t_e)return AB[e]=t[r];return e}var r_e=qk("animationend"),i_e=qk("animationiteration"),n_e=qk("animationstart"),s_e=qk("transitionend"),a_e=new Map,lle="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function f_(e,t){a_e.set(e,t),fx(t,[e])}for(var RB=0;RB<lle.length;RB++){var OB=lle[RB],qLe=OB.toLowerCase(),HLe=OB[0].toUpperCase()+OB.slice(1);f_(qLe,"on"+HLe)}f_(r_e,"onAnimationEnd");f_(i_e,"onAnimationIteration");f_(n_e,"onAnimationStart");f_("dblclick","onDoubleClick");f_("focusin","onFocus");f_("focusout","onBlur");f_(s_e,"onTransitionEnd");_5("onMouseEnter",["mouseout","mouseover"]);_5("onMouseLeave",["mouseout","mouseover"]);_5("onPointerEnter",["pointerout","pointerover"]);_5("onPointerLeave",["pointerout","pointerover"]);fx("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));fx("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));fx("onBeforeInput",["compositionend","keypress","textInput","paste"]);fx("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));fx("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));fx("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var rE="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),WLe=new Set("cancel close invalid load scroll toggle".split(" ").concat(rE));function cle(e,t,r){var i=e.type||"unknown-event";e.currentTarget=r,q$e(i,t,void 0,e),e.currentTarget=null}function o_e(e,t){t=(t&4)!==0;for(var r=0;r<e.length;r++){var i=e[r],n=i.event;i=i.listeners;e:{var s=void 0;if(t)for(var a=i.length-1;0<=a;a--){var o=i[a],l=o.instance,c=o.currentTarget;if(o=o.listener,l!==s&&n.isPropagationStopped())break e;cle(n,o,c),s=l}else for(a=0;a<i.length;a++){if(o=i[a],l=o.instance,c=o.currentTarget,o=o.listener,l!==s&&n.isPropagationStopped())break e;cle(n,o,c),s=l}}}if(HD)throw e=gW,HD=!1,gW=null,e}function bn(e,t){var r=t[CW];r===void 0&&(r=t[CW]=new Set);var i=e+"__bubble";r.has(i)||(l_e(t,e,2,!1),r.add(i))}function MB(e,t,r){var i=0;t&&(i|=4),l_e(r,e,i,t)}var hM="_reactListening"+Math.random().toString(36).slice(2);function G7(e){if(!e[hM]){e[hM]=!0,mve.forEach(function(r){r!=="selectionchange"&&(WLe.has(r)||MB(r,!1,e),MB(r,!0,e))});var t=e.nodeType===9?e:e.ownerDocument;t===null||t[hM]||(t[hM]=!0,MB("selectionchange",!1,t))}}function l_e(e,t,r,i){switch(qve(t)){case 1:var n=oLe;break;case 4:n=lLe;break;default:n=Vee}r=n.bind(null,t,r,e),n=void 0,!mW||t!=="touchstart"&&t!=="touchmove"&&t!=="wheel"||(n=!0),i?n!==void 0?e.addEventListener(t,r,{capture:!0,passive:n}):e.addEventListener(t,r,!0):n!==void 0?e.addEventListener(t,r,{passive:n}):e.addEventListener(t,r,!1)}function PB(e,t,r,i,n){var s=i;if((t&1)===0&&(t&2)===0&&i!==null)e:for(;;){if(i===null)return;var a=i.tag;if(a===3||a===4){var o=i.stateNode.containerInfo;if(o===n||o.nodeType===8&&o.parentNode===n)break;if(a===4)for(a=i.return;a!==null;){var l=a.tag;if((l===3||l===4)&&(l=a.stateNode.containerInfo,l===n||l.nodeType===8&&l.parentNode===n))return;a=a.return}for(;o!==null;){if(a=L3(o),a===null)return;if(l=a.tag,l===5||l===6){i=s=a;continue e}o=o.parentNode}}i=i.return}Pve(function(){var c=s,u=Dee(r),h=[];e:{var p=a_e.get(e);if(p!==void 0){var m=Uee,g=e;switch(e){case"keypress":if(O$(r)===0)break e;case"keydown":case"keyup":m=TLe;break;case"focusin":g="focus",m=SB;break;case"focusout":g="blur",m=SB;break;case"beforeblur":case"afterblur":m=SB;break;case"click":if(r.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":m=Qoe;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":m=uLe;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":m=CLe;break;case r_e:case i_e:case n_e:m=pLe;break;case s_e:m=RLe;break;case"scroll":m=cLe;break;case"wheel":m=MLe;break;case"copy":case"cut":case"paste":m=gLe;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":m=Koe}var b=(t&4)!==0,w=!b&&e==="scroll",v=b?p!==null?p+"Capture":null:p;b=[];for(var x=c,T;x!==null;){T=x;var E=T.stateNode;if(T.tag===5&&E!==null&&(T=E,v!==null&&(E=N7(x,v),E!=null&&b.push(j7(x,E,T)))),w)break;x=x.return}0<b.length&&(p=new m(p,g,null,r,u),h.push({event:p,listeners:b}))}}if((t&7)===0){e:{if(p=e==="mouseover"||e==="pointerover",m=e==="mouseout"||e==="pointerout",p&&r!==fW&&(g=r.relatedTarget||r.fromElement)&&(L3(g)||g[Ty]))break e;if((m||p)&&(p=u.window===u?u:(p=u.ownerDocument)?p.defaultView||p.parentWindow:window,m?(g=r.relatedTarget||r.toElement,m=c,g=g?L3(g):null,g!==null&&(w=px(g),g!==w||g.tag!==5&&g.tag!==6)&&(g=null)):(m=null,g=c),m!==g)){if(b=Qoe,E="onMouseLeave",v="onMouseEnter",x="mouse",(e==="pointerout"||e==="pointerover")&&(b=Koe,E="onPointerLeave",v="onPointerEnter",x="pointer"),w=m==null?p:t4(m),T=g==null?p:t4(g),p=new b(E,x+"leave",m,r,u),p.target=w,p.relatedTarget=T,E=null,L3(u)===c&&(b=new b(v,x+"enter",g,r,u),b.target=T,b.relatedTarget=w,E=b),w=E,m&&g)t:{for(b=m,v=g,x=0,T=b;T;T=Fx(T))x++;for(T=0,E=v;E;E=Fx(E))T++;for(;0<x-T;)b=Fx(b),x--;for(;0<T-x;)v=Fx(v),T--;for(;x--;){if(b===v||v!==null&&b===v.alternate)break t;b=Fx(b),v=Fx(v)}b=null}else b=null;m!==null&&dle(h,p,m,b,!1),g!==null&&w!==null&&dle(h,w,g,b,!0)}}e:{if(p=c?t4(c):window,m=p.nodeName&&p.nodeName.toLowerCase(),m==="select"||m==="input"&&p.type==="file")var C=NLe;else if(rle(p))if(Qve)C=ULe;else{C=VLe;var A=kLe}else(m=p.nodeName)&&m.toLowerCase()==="input"&&(p.type==="checkbox"||p.type==="radio")&&(C=zLe);if(C&&(C=C(e,c))){Zve(h,C,r,u);break e}A&&A(e,p,c),e==="focusout"&&(A=p._wrapperState)&&A.controlled&&p.type==="number"&&lW(p,"number",p.value)}switch(A=c?t4(c):window,e){case"focusin":(rle(A)||A.contentEditable==="true")&&(KS=A,_W=c,LC=null);break;case"focusout":LC=_W=KS=null;break;case"mousedown":wW=!0;break;case"contextmenu":case"mouseup":case"dragend":wW=!1,ole(h,r,u);break;case"selectionchange":if(jLe)break;case"keydown":case"keyup":ole(h,r,u)}var P;if(Gee)e:{switch(e){case"compositionstart":var I="onCompositionStart";break e;case"compositionend":I="onCompositionEnd";break e;case"compositionupdate":I="onCompositionUpdate";break e}I=void 0}else JS?Xve(e,r)&&(I="onCompositionEnd"):e==="keydown"&&r.keyCode===229&&(I="onCompositionStart");I&&(Wve&&r.locale!=="ko"&&(JS||I!=="onCompositionStart"?I==="onCompositionEnd"&&JS&&(P=Hve()):(K1=u,zee="value"in K1?K1.value:K1.textContent,JS=!0)),A=QD(c,I),0<A.length&&(I=new Joe(I,e,null,r,u),h.push({event:I,listeners:A}),P?I.data=P:(P=Yve(r),P!==null&&(I.data=P)))),(P=ILe?$Le(e,r):LLe(e,r))&&(c=QD(c,"onBeforeInput"),0<c.length&&(u=new Joe("onBeforeInput","beforeinput",null,r,u),h.push({event:u,listeners:c}),u.data=P))}o_e(h,t)})}function j7(e,t,r){return{instance:e,listener:t,currentTarget:r}}function QD(e,t){for(var r=t+"Capture",i=[];e!==null;){var n=e,s=n.stateNode;n.tag===5&&s!==null&&(n=s,s=N7(e,r),s!=null&&i.unshift(j7(e,s,n)),s=N7(e,t),s!=null&&i.push(j7(e,s,n))),e=e.return}return i}function Fx(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5);return e||null}function dle(e,t,r,i,n){for(var s=t._reactName,a=[];r!==null&&r!==i;){var o=r,l=o.alternate,c=o.stateNode;if(l!==null&&l===i)break;o.tag===5&&c!==null&&(o=c,n?(l=N7(r,s),l!=null&&a.unshift(j7(r,l,o))):n||(l=N7(r,s),l!=null&&a.push(j7(r,l,o)))),r=r.return}a.length!==0&&e.push({event:t,listeners:a})}var XLe=/\r\n?/g,YLe=/\u0000|\uFFFD/g;function ule(e){return(typeof e=="string"?e:""+e).replace(XLe,`
`).replace(YLe,"")}function fM(e,t,r){if(t=ule(t),ule(e)!==t&&r)throw Error(ke(425))}function JD(){}var xW=null,TW=null;function SW(e,t){return e==="textarea"||e==="noscript"||typeof t.children=="string"||typeof t.children=="number"||typeof t.dangerouslySetInnerHTML=="object"&&t.dangerouslySetInnerHTML!==null&&t.dangerouslySetInnerHTML.__html!=null}var EW=typeof setTimeout=="function"?setTimeout:void 0,ZLe=typeof clearTimeout=="function"?clearTimeout:void 0,hle=typeof Promise=="function"?Promise:void 0,QLe=typeof queueMicrotask=="function"?queueMicrotask:typeof hle<"u"?function(e){return hle.resolve(null).then(e).catch(JLe)}:EW;function JLe(e){setTimeout(function(){throw e})}function IB(e,t){var r=t,i=0;do{var n=r.nextSibling;if(e.removeChild(r),n&&n.nodeType===8)if(r=n.data,r==="/$"){if(i===0){e.removeChild(n),z7(t);return}i--}else r!=="$"&&r!=="$?"&&r!=="$!"||i++;r=n}while(r);z7(t)}function Tv(e){for(;e!=null;e=e.nextSibling){var t=e.nodeType;if(t===1||t===3)break;if(t===8){if(t=e.data,t==="$"||t==="$!"||t==="$?")break;if(t==="/$")return null}}return e}function fle(e){e=e.previousSibling;for(var t=0;e;){if(e.nodeType===8){var r=e.data;if(r==="$"||r==="$!"||r==="$?"){if(t===0)return e;t--}else r==="/$"&&t++}e=e.previousSibling}return null}var H9=Math.random().toString(36).slice(2),B0="__reactFiber$"+H9,q7="__reactProps$"+H9,Ty="__reactContainer$"+H9,CW="__reactEvents$"+H9,KLe="__reactListeners$"+H9,eDe="__reactHandles$"+H9;function L3(e){var t=e[B0];if(t)return t;for(var r=e.parentNode;r;){if(t=r[Ty]||r[B0]){if(r=t.alternate,t.child!==null||r!==null&&r.child!==null)for(e=fle(e);e!==null;){if(r=e[B0])return r;e=fle(e)}return t}e=r,r=e.parentNode}return null}function kR(e){return e=e[B0]||e[Ty],!e||e.tag!==5&&e.tag!==6&&e.tag!==13&&e.tag!==3?null:e}function t4(e){if(e.tag===5||e.tag===6)return e.stateNode;throw Error(ke(33))}function Hk(e){return e[q7]||null}var AW=[],r4=-1;function p_(e){return{current:e}}function An(e){0>r4||(e.current=AW[r4],AW[r4]=null,r4--)}function un(e,t){r4++,AW[r4]=e.current,e.current=t}var Bv={},bl=p_(Bv),ad=p_(!1),ww=Bv;function w5(e,t){var r=e.type.contextTypes;if(!r)return Bv;var i=e.stateNode;if(i&&i.__reactInternalMemoizedUnmaskedChildContext===t)return i.__reactInternalMemoizedMaskedChildContext;var n={},s;for(s in r)n[s]=t[s];return i&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=n),n}function od(e){return e=e.childContextTypes,e!=null}function KD(){An(ad),An(bl)}function ple(e,t,r){if(bl.current!==Bv)throw Error(ke(168));un(bl,t),un(ad,r)}function c_e(e,t,r){var i=e.stateNode;if(t=t.childContextTypes,typeof i.getChildContext!="function")return r;i=i.getChildContext();for(var n in i)if(!(n in t))throw Error(ke(108,k$e(e)||"Unknown",n));return ts({},r,i)}function eF(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||Bv,ww=bl.current,un(bl,e),un(ad,ad.current),!0}function mle(e,t,r){var i=e.stateNode;if(!i)throw Error(ke(169));r?(e=c_e(e,t,ww),i.__reactInternalMemoizedMergedChildContext=e,An(ad),An(bl),un(bl,e)):An(ad),un(ad,r)}var zg=null,Wk=!1,$B=!1;function d_e(e){zg===null?zg=[e]:zg.push(e)}function tDe(e){Wk=!0,d_e(e)}function m_(){if(!$B&&zg!==null){$B=!0;var e=0,t=zi;try{var r=zg;for(zi=1;e<r.length;e++){var i=r[e];do i=i(!0);while(i!==null)}zg=null,Wk=!1}catch(n){throw zg!==null&&(zg=zg.slice(e+1)),Dve(Fee,m_),n}finally{zi=t,$B=!1}}return null}var i4=[],n4=0,tF=null,rF=0,xh=[],Th=0,xw=null,Xg=1,Yg="";function f2(e,t){i4[n4++]=rF,i4[n4++]=tF,tF=e,rF=t}function u_e(e,t,r){xh[Th++]=Xg,xh[Th++]=Yg,xh[Th++]=xw,xw=e;var i=Xg;e=Yg;var n=32-wp(i)-1;i&=~(1<<n),r+=1;var s=32-wp(t)+n;if(30<s){var a=n-n%5;s=(i&(1<<a)-1).toString(32),i>>=a,n-=a,Xg=1<<32-wp(t)+n|r<<n|i,Yg=s+e}else Xg=1<<s|r<<n|i,Yg=e}function qee(e){e.return!==null&&(f2(e,1),u_e(e,1,0))}function Hee(e){for(;e===tF;)tF=i4[--n4],i4[n4]=null,rF=i4[--n4],i4[n4]=null;for(;e===xw;)xw=xh[--Th],xh[Th]=null,Yg=xh[--Th],xh[Th]=null,Xg=xh[--Th],xh[Th]=null}var fu=null,cu=null,$n=!1,tp=null;function h_e(e,t){var r=Dh(5,null,null,0);r.elementType="DELETED",r.stateNode=t,r.return=e,t=e.deletions,t===null?(e.deletions=[r],e.flags|=16):t.push(r)}function gle(e,t){switch(e.tag){case 5:var r=e.type;return t=t.nodeType!==1||r.toLowerCase()!==t.nodeName.toLowerCase()?null:t,t!==null?(e.stateNode=t,fu=e,cu=Tv(t.firstChild),!0):!1;case 6:return t=e.pendingProps===""||t.nodeType!==3?null:t,t!==null?(e.stateNode=t,fu=e,cu=null,!0):!1;case 13:return t=t.nodeType!==8?null:t,t!==null?(r=xw!==null?{id:Xg,overflow:Yg}:null,e.memoizedState={dehydrated:t,treeContext:r,retryLane:1073741824},r=Dh(18,null,null,0),r.stateNode=t,r.return=e,e.child=r,fu=e,cu=null,!0):!1;default:return!1}}function RW(e){return(e.mode&1)!==0&&(e.flags&128)===0}function OW(e){if($n){var t=cu;if(t){var r=t;if(!gle(e,t)){if(RW(e))throw Error(ke(418));t=Tv(r.nextSibling);var i=fu;t&&gle(e,t)?h_e(i,r):(e.flags=e.flags&-4097|2,$n=!1,fu=e)}}else{if(RW(e))throw Error(ke(418));e.flags=e.flags&-4097|2,$n=!1,fu=e}}}function yle(e){for(e=e.return;e!==null&&e.tag!==5&&e.tag!==3&&e.tag!==13;)e=e.return;fu=e}function pM(e){if(e!==fu)return!1;if(!$n)return yle(e),$n=!0,!1;var t;if((t=e.tag!==3)&&!(t=e.tag!==5)&&(t=e.type,t=t!=="head"&&t!=="body"&&!SW(e.type,e.memoizedProps)),t&&(t=cu)){if(RW(e))throw f_e(),Error(ke(418));for(;t;)h_e(e,t),t=Tv(t.nextSibling)}if(yle(e),e.tag===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(ke(317));e:{for(e=e.nextSibling,t=0;e;){if(e.nodeType===8){var r=e.data;if(r==="/$"){if(t===0){cu=Tv(e.nextSibling);break e}t--}else r!=="$"&&r!=="$!"&&r!=="$?"||t++}e=e.nextSibling}cu=null}}else cu=fu?Tv(e.stateNode.nextSibling):null;return!0}function f_e(){for(var e=cu;e;)e=Tv(e.nextSibling)}function x5(){cu=fu=null,$n=!1}function Wee(e){tp===null?tp=[e]:tp.push(e)}var rDe=Uy.ReactCurrentBatchConfig;function Wf(e,t){if(e&&e.defaultProps){t=ts({},t),e=e.defaultProps;for(var r in e)t[r]===void 0&&(t[r]=e[r]);return t}return t}var iF=p_(null),nF=null,s4=null,Xee=null;function Yee(){Xee=s4=nF=null}function Zee(e){var t=iF.current;An(iF),e._currentValue=t}function MW(e,t,r){for(;e!==null;){var i=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,i!==null&&(i.childLanes|=t)):i!==null&&(i.childLanes&t)!==t&&(i.childLanes|=t),e===r)break;e=e.return}}function V4(e,t){nF=e,Xee=s4=null,e=e.dependencies,e!==null&&e.firstContext!==null&&((e.lanes&t)!==0&&(Kc=!0),e.firstContext=null)}function Gh(e){var t=e._currentValue;if(Xee!==e)if(e={context:e,memoizedValue:t,next:null},s4===null){if(nF===null)throw Error(ke(308));s4=e,nF.dependencies={lanes:0,firstContext:e}}else s4=s4.next=e;return t}var D3=null;function Qee(e){D3===null?D3=[e]:D3.push(e)}function p_e(e,t,r,i){var n=t.interleaved;return n===null?(r.next=r,Qee(t)):(r.next=n.next,n.next=r),t.interleaved=r,Sy(e,i)}function Sy(e,t){e.lanes|=t;var r=e.alternate;for(r!==null&&(r.lanes|=t),r=e,e=e.return;e!==null;)e.childLanes|=t,r=e.alternate,r!==null&&(r.childLanes|=t),r=e,e=e.return;return r.tag===3?r.stateNode:null}var M1=!1;function Jee(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function m_e(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function sy(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function Sv(e,t,r){var i=e.updateQueue;if(i===null)return null;if(i=i.shared,(hi&2)!==0){var n=i.pending;return n===null?t.next=t:(t.next=n.next,n.next=t),i.pending=t,Sy(e,r)}return n=i.interleaved,n===null?(t.next=t,Qee(i)):(t.next=n.next,n.next=t),i.interleaved=t,Sy(e,r)}function M$(e,t,r){if(t=t.updateQueue,t!==null&&(t=t.shared,(r&4194240)!==0)){var i=t.lanes;i&=e.pendingLanes,r|=i,t.lanes=r,Nee(e,r)}}function ble(e,t){var r=e.updateQueue,i=e.alternate;if(i!==null&&(i=i.updateQueue,r===i)){var n=null,s=null;if(r=r.firstBaseUpdate,r!==null){do{var a={eventTime:r.eventTime,lane:r.lane,tag:r.tag,payload:r.payload,callback:r.callback,next:null};s===null?n=s=a:s=s.next=a,r=r.next}while(r!==null);s===null?n=s=t:s=s.next=t}else n=s=t;r={baseState:i.baseState,firstBaseUpdate:n,lastBaseUpdate:s,shared:i.shared,effects:i.effects},e.updateQueue=r;return}e=r.lastBaseUpdate,e===null?r.firstBaseUpdate=t:e.next=t,r.lastBaseUpdate=t}function sF(e,t,r,i){var n=e.updateQueue;M1=!1;var s=n.firstBaseUpdate,a=n.lastBaseUpdate,o=n.shared.pending;if(o!==null){n.shared.pending=null;var l=o,c=l.next;l.next=null,a===null?s=c:a.next=c,a=l;var u=e.alternate;u!==null&&(u=u.updateQueue,o=u.lastBaseUpdate,o!==a&&(o===null?u.firstBaseUpdate=c:o.next=c,u.lastBaseUpdate=l))}if(s!==null){var h=n.baseState;a=0,u=c=l=null,o=s;do{var p=o.lane,m=o.eventTime;if((i&p)===p){u!==null&&(u=u.next={eventTime:m,lane:0,tag:o.tag,payload:o.payload,callback:o.callback,next:null});e:{var g=e,b=o;switch(p=t,m=r,b.tag){case 1:if(g=b.payload,typeof g=="function"){h=g.call(m,h,p);break e}h=g;break e;case 3:g.flags=g.flags&-65537|128;case 0:if(g=b.payload,p=typeof g=="function"?g.call(m,h,p):g,p==null)break e;h=ts({},h,p);break e;case 2:M1=!0}}o.callback!==null&&o.lane!==0&&(e.flags|=64,p=n.effects,p===null?n.effects=[o]:p.push(o))}else m={eventTime:m,lane:p,tag:o.tag,payload:o.payload,callback:o.callback,next:null},u===null?(c=u=m,l=h):u=u.next=m,a|=p;if(o=o.next,o===null){if(o=n.shared.pending,o===null)break;p=o,o=p.next,p.next=null,n.lastBaseUpdate=p,n.shared.pending=null}}while(1);if(u===null&&(l=h),n.baseState=l,n.firstBaseUpdate=c,n.lastBaseUpdate=u,t=n.shared.interleaved,t!==null){n=t;do a|=n.lane,n=n.next;while(n!==t)}else s===null&&(n.shared.lanes=0);Sw|=a,e.lanes=a,e.memoizedState=h}}function vle(e,t,r){if(e=t.effects,t.effects=null,e!==null)for(t=0;t<e.length;t++){var i=e[t],n=i.callback;if(n!==null){if(i.callback=null,i=r,typeof n!="function")throw Error(ke(191,n));n.call(i)}}}var g_e=new pve.Component().refs;function PW(e,t,r,i){t=e.memoizedState,r=r(i,t),r=r==null?t:ts({},t,r),e.memoizedState=r,e.lanes===0&&(e.updateQueue.baseState=r)}var Xk={isMounted:function(e){return(e=e._reactInternals)?px(e)===e:!1},enqueueSetState:function(e,t,r){e=e._reactInternals;var i=rc(),n=Cv(e),s=sy(i,n);s.payload=t,r!=null&&(s.callback=r),t=Sv(e,s,n),t!==null&&(xp(t,e,n,i),M$(t,e,n))},enqueueReplaceState:function(e,t,r){e=e._reactInternals;var i=rc(),n=Cv(e),s=sy(i,n);s.tag=1,s.payload=t,r!=null&&(s.callback=r),t=Sv(e,s,n),t!==null&&(xp(t,e,n,i),M$(t,e,n))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var r=rc(),i=Cv(e),n=sy(r,i);n.tag=2,t!=null&&(n.callback=t),t=Sv(e,n,i),t!==null&&(xp(t,e,i,r),M$(t,e,i))}};function _le(e,t,r,i,n,s,a){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(i,s,a):t.prototype&&t.prototype.isPureReactComponent?!B7(r,i)||!B7(n,s):!0}function y_e(e,t,r){var i=!1,n=Bv,s=t.contextType;return typeof s=="object"&&s!==null?s=Gh(s):(n=od(t)?ww:bl.current,i=t.contextTypes,s=(i=i!=null)?w5(e,n):Bv),t=new t(r,s),e.memoizedState=t.state!==null&&t.state!==void 0?t.state:null,t.updater=Xk,e.stateNode=t,t._reactInternals=e,i&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=n,e.__reactInternalMemoizedMaskedChildContext=s),t}function wle(e,t,r,i){e=t.state,typeof t.componentWillReceiveProps=="function"&&t.componentWillReceiveProps(r,i),typeof t.UNSAFE_componentWillReceiveProps=="function"&&t.UNSAFE_componentWillReceiveProps(r,i),t.state!==e&&Xk.enqueueReplaceState(t,t.state,null)}function IW(e,t,r,i){var n=e.stateNode;n.props=r,n.state=e.memoizedState,n.refs=g_e,Jee(e);var s=t.contextType;typeof s=="object"&&s!==null?n.context=Gh(s):(s=od(t)?ww:bl.current,n.context=w5(e,s)),n.state=e.memoizedState,s=t.getDerivedStateFromProps,typeof s=="function"&&(PW(e,t,s,r),n.state=e.memoizedState),typeof t.getDerivedStateFromProps=="function"||typeof n.getSnapshotBeforeUpdate=="function"||typeof n.UNSAFE_componentWillMount!="function"&&typeof n.componentWillMount!="function"||(t=n.state,typeof n.componentWillMount=="function"&&n.componentWillMount(),typeof n.UNSAFE_componentWillMount=="function"&&n.UNSAFE_componentWillMount(),t!==n.state&&Xk.enqueueReplaceState(n,n.state,null),sF(e,r,n,i),n.state=e.memoizedState),typeof n.componentDidMount=="function"&&(e.flags|=4194308)}function I6(e,t,r){if(e=r.ref,e!==null&&typeof e!="function"&&typeof e!="object"){if(r._owner){if(r=r._owner,r){if(r.tag!==1)throw Error(ke(309));var i=r.stateNode}if(!i)throw Error(ke(147,e));var n=i,s=""+e;return t!==null&&t.ref!==null&&typeof t.ref=="function"&&t.ref._stringRef===s?t.ref:(t=function(a){var o=n.refs;o===g_e&&(o=n.refs={}),a===null?delete o[s]:o[s]=a},t._stringRef=s,t)}if(typeof e!="string")throw Error(ke(284));if(!r._owner)throw Error(ke(290,e))}return e}function mM(e,t){throw e=Object.prototype.toString.call(t),Error(ke(31,e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function xle(e){var t=e._init;return t(e._payload)}function b_e(e){function t(v,x){if(e){var T=v.deletions;T===null?(v.deletions=[x],v.flags|=16):T.push(x)}}function r(v,x){if(!e)return null;for(;x!==null;)t(v,x),x=x.sibling;return null}function i(v,x){for(v=new Map;x!==null;)x.key!==null?v.set(x.key,x):v.set(x.index,x),x=x.sibling;return v}function n(v,x){return v=Av(v,x),v.index=0,v.sibling=null,v}function s(v,x,T){return v.index=T,e?(T=v.alternate,T!==null?(T=T.index,T<x?(v.flags|=2,x):T):(v.flags|=2,x)):(v.flags|=1048576,x)}function a(v){return e&&v.alternate===null&&(v.flags|=2),v}function o(v,x,T,E){return x===null||x.tag!==6?(x=zB(T,v.mode,E),x.return=v,x):(x=n(x,T),x.return=v,x)}function l(v,x,T,E){var C=T.type;return C===QS?u(v,x,T.props.children,E,T.key):x!==null&&(x.elementType===C||typeof C=="object"&&C!==null&&C.$$typeof===O1&&xle(C)===x.type)?(E=n(x,T.props),E.ref=I6(v,x,T),E.return=v,E):(E=F$(T.type,T.key,T.props,null,v.mode,E),E.ref=I6(v,x,T),E.return=v,E)}function c(v,x,T,E){return x===null||x.tag!==4||x.stateNode.containerInfo!==T.containerInfo||x.stateNode.implementation!==T.implementation?(x=UB(T,v.mode,E),x.return=v,x):(x=n(x,T.children||[]),x.return=v,x)}function u(v,x,T,E,C){return x===null||x.tag!==7?(x=rw(T,v.mode,E,C),x.return=v,x):(x=n(x,T),x.return=v,x)}function h(v,x,T){if(typeof x=="string"&&x!==""||typeof x=="number")return x=zB(""+x,v.mode,T),x.return=v,x;if(typeof x=="object"&&x!==null){switch(x.$$typeof){case nM:return T=F$(x.type,x.key,x.props,null,v.mode,T),T.ref=I6(v,null,x),T.return=v,T;case ZS:return x=UB(x,v.mode,T),x.return=v,x;case O1:var E=x._init;return h(v,E(x._payload),T)}if(eE(x)||A6(x))return x=rw(x,v.mode,T,null),x.return=v,x;mM(v,x)}return null}function p(v,x,T,E){var C=x!==null?x.key:null;if(typeof T=="string"&&T!==""||typeof T=="number")return C!==null?null:o(v,x,""+T,E);if(typeof T=="object"&&T!==null){switch(T.$$typeof){case nM:return T.key===C?l(v,x,T,E):null;case ZS:return T.key===C?c(v,x,T,E):null;case O1:return C=T._init,p(v,x,C(T._payload),E)}if(eE(T)||A6(T))return C!==null?null:u(v,x,T,E,null);mM(v,T)}return null}function m(v,x,T,E,C){if(typeof E=="string"&&E!==""||typeof E=="number")return v=v.get(T)||null,o(x,v,""+E,C);if(typeof E=="object"&&E!==null){switch(E.$$typeof){case nM:return v=v.get(E.key===null?T:E.key)||null,l(x,v,E,C);case ZS:return v=v.get(E.key===null?T:E.key)||null,c(x,v,E,C);case O1:var A=E._init;return m(v,x,T,A(E._payload),C)}if(eE(E)||A6(E))return v=v.get(T)||null,u(x,v,E,C,null);mM(x,E)}return null}function g(v,x,T,E){for(var C=null,A=null,P=x,I=x=0,L=null;P!==null&&I<T.length;I++){P.index>I?(L=P,P=null):L=P.sibling;var V=p(v,P,T[I],E);if(V===null){P===null&&(P=L);break}e&&P&&V.alternate===null&&t(v,P),x=s(V,x,I),A===null?C=V:A.sibling=V,A=V,P=L}if(I===T.length)return r(v,P),$n&&f2(v,I),C;if(P===null){for(;I<T.length;I++)P=h(v,T[I],E),P!==null&&(x=s(P,x,I),A===null?C=P:A.sibling=P,A=P);return $n&&f2(v,I),C}for(P=i(v,P);I<T.length;I++)L=m(P,v,I,T[I],E),L!==null&&(e&&L.alternate!==null&&P.delete(L.key===null?I:L.key),x=s(L,x,I),A===null?C=L:A.sibling=L,A=L);return e&&P.forEach(function(G){return t(v,G)}),$n&&f2(v,I),C}function b(v,x,T,E){var C=A6(T);if(typeof C!="function")throw Error(ke(150));if(T=C.call(T),T==null)throw Error(ke(151));for(var A=C=null,P=x,I=x=0,L=null,V=T.next();P!==null&&!V.done;I++,V=T.next()){P.index>I?(L=P,P=null):L=P.sibling;var G=p(v,P,V.value,E);if(G===null){P===null&&(P=L);break}e&&P&&G.alternate===null&&t(v,P),x=s(G,x,I),A===null?C=G:A.sibling=G,A=G,P=L}if(V.done)return r(v,P),$n&&f2(v,I),C;if(P===null){for(;!V.done;I++,V=T.next())V=h(v,V.value,E),V!==null&&(x=s(V,x,I),A===null?C=V:A.sibling=V,A=V);return $n&&f2(v,I),C}for(P=i(v,P);!V.done;I++,V=T.next())V=m(P,v,I,V.value,E),V!==null&&(e&&V.alternate!==null&&P.delete(V.key===null?I:V.key),x=s(V,x,I),A===null?C=V:A.sibling=V,A=V);return e&&P.forEach(function(B){return t(v,B)}),$n&&f2(v,I),C}function w(v,x,T,E){if(typeof T=="object"&&T!==null&&T.type===QS&&T.key===null&&(T=T.props.children),typeof T=="object"&&T!==null){switch(T.$$typeof){case nM:e:{for(var C=T.key,A=x;A!==null;){if(A.key===C){if(C=T.type,C===QS){if(A.tag===7){r(v,A.sibling),x=n(A,T.props.children),x.return=v,v=x;break e}}else if(A.elementType===C||typeof C=="object"&&C!==null&&C.$$typeof===O1&&xle(C)===A.type){r(v,A.sibling),x=n(A,T.props),x.ref=I6(v,A,T),x.return=v,v=x;break e}r(v,A);break}else t(v,A);A=A.sibling}T.type===QS?(x=rw(T.props.children,v.mode,E,T.key),x.return=v,v=x):(E=F$(T.type,T.key,T.props,null,v.mode,E),E.ref=I6(v,x,T),E.return=v,v=E)}return a(v);case ZS:e:{for(A=T.key;x!==null;){if(x.key===A)if(x.tag===4&&x.stateNode.containerInfo===T.containerInfo&&x.stateNode.implementation===T.implementation){r(v,x.sibling),x=n(x,T.children||[]),x.return=v,v=x;break e}else{r(v,x);break}else t(v,x);x=x.sibling}x=UB(T,v.mode,E),x.return=v,v=x}return a(v);case O1:return A=T._init,w(v,x,A(T._payload),E)}if(eE(T))return g(v,x,T,E);if(A6(T))return b(v,x,T,E);mM(v,T)}return typeof T=="string"&&T!==""||typeof T=="number"?(T=""+T,x!==null&&x.tag===6?(r(v,x.sibling),x=n(x,T),x.return=v,v=x):(r(v,x),x=zB(T,v.mode,E),x.return=v,v=x),a(v)):r(v,x)}return w}var T5=b_e(!0),v_e=b_e(!1),VR={},K0=p_(VR),H7=p_(VR),W7=p_(VR);function F3(e){if(e===VR)throw Error(ke(174));return e}function Kee(e,t){switch(un(W7,t),un(H7,e),un(K0,VR),e=t.nodeType,e){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:dW(null,"");break;default:e=e===8?t.parentNode:t,t=e.namespaceURI||null,e=e.tagName,t=dW(t,e)}An(K0),un(K0,t)}function S5(){An(K0),An(H7),An(W7)}function __e(e){F3(W7.current);var t=F3(K0.current),r=dW(t,e.type);t!==r&&(un(H7,e),un(K0,r))}function ete(e){H7.current===e&&(An(K0),An(H7))}var qn=p_(0);function aF(e){for(var t=e;t!==null;){if(t.tag===13){var r=t.memoizedState;if(r!==null&&(r=r.dehydrated,r===null||r.data==="$?"||r.data==="$!"))return t}else if(t.tag===19&&t.memoizedProps.revealOrder!==void 0){if((t.flags&128)!==0)return t}else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var LB=[];function tte(){for(var e=0;e<LB.length;e++)LB[e]._workInProgressVersionPrimary=null;LB.length=0}var P$=Uy.ReactCurrentDispatcher,DB=Uy.ReactCurrentBatchConfig,Tw=0,Jn=null,Ca=null,eo=null,oF=!1,DC=!1,X7=0,iDe=0;function Uo(){throw Error(ke(321))}function rte(e,t){if(t===null)return!1;for(var r=0;r<t.length&&r<e.length;r++)if(!Rp(e[r],t[r]))return!1;return!0}function ite(e,t,r,i,n,s){if(Tw=s,Jn=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,P$.current=e===null||e.memoizedState===null?oDe:lDe,e=r(i,n),DC){s=0;do{if(DC=!1,X7=0,25<=s)throw Error(ke(301));s+=1,eo=Ca=null,t.updateQueue=null,P$.current=cDe,e=r(i,n)}while(DC)}if(P$.current=lF,t=Ca!==null&&Ca.next!==null,Tw=0,eo=Ca=Jn=null,oF=!1,t)throw Error(ke(300));return e}function nte(){var e=X7!==0;return X7=0,e}function I0(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return eo===null?Jn.memoizedState=eo=e:eo=eo.next=e,eo}function jh(){if(Ca===null){var e=Jn.alternate;e=e!==null?e.memoizedState:null}else e=Ca.next;var t=eo===null?Jn.memoizedState:eo.next;if(t!==null)eo=t,Ca=e;else{if(e===null)throw Error(ke(310));Ca=e,e={memoizedState:Ca.memoizedState,baseState:Ca.baseState,baseQueue:Ca.baseQueue,queue:Ca.queue,next:null},eo===null?Jn.memoizedState=eo=e:eo=eo.next=e}return eo}function Y7(e,t){return typeof t=="function"?t(e):t}function FB(e){var t=jh(),r=t.queue;if(r===null)throw Error(ke(311));r.lastRenderedReducer=e;var i=Ca,n=i.baseQueue,s=r.pending;if(s!==null){if(n!==null){var a=n.next;n.next=s.next,s.next=a}i.baseQueue=n=s,r.pending=null}if(n!==null){s=n.next,i=i.baseState;var o=a=null,l=null,c=s;do{var u=c.lane;if((Tw&u)===u)l!==null&&(l=l.next={lane:0,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null}),i=c.hasEagerState?c.eagerState:e(i,c.action);else{var h={lane:u,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null};l===null?(o=l=h,a=i):l=l.next=h,Jn.lanes|=u,Sw|=u}c=c.next}while(c!==null&&c!==s);l===null?a=i:l.next=o,Rp(i,t.memoizedState)||(Kc=!0),t.memoizedState=i,t.baseState=a,t.baseQueue=l,r.lastRenderedState=i}if(e=r.interleaved,e!==null){n=e;do s=n.lane,Jn.lanes|=s,Sw|=s,n=n.next;while(n!==e)}else n===null&&(r.lanes=0);return[t.memoizedState,r.dispatch]}function NB(e){var t=jh(),r=t.queue;if(r===null)throw Error(ke(311));r.lastRenderedReducer=e;var i=r.dispatch,n=r.pending,s=t.memoizedState;if(n!==null){r.pending=null;var a=n=n.next;do s=e(s,a.action),a=a.next;while(a!==n);Rp(s,t.memoizedState)||(Kc=!0),t.memoizedState=s,t.baseQueue===null&&(t.baseState=s),r.lastRenderedState=s}return[s,i]}function w_e(){}function x_e(e,t){var r=Jn,i=jh(),n=t(),s=!Rp(i.memoizedState,n);if(s&&(i.memoizedState=n,Kc=!0),i=i.queue,ste(E_e.bind(null,r,i,e),[e]),i.getSnapshot!==t||s||eo!==null&&eo.memoizedState.tag&1){if(r.flags|=2048,Z7(9,S_e.bind(null,r,i,n,t),void 0,null),lo===null)throw Error(ke(349));(Tw&30)!==0||T_e(r,t,n)}return n}function T_e(e,t,r){e.flags|=16384,e={getSnapshot:t,value:r},t=Jn.updateQueue,t===null?(t={lastEffect:null,stores:null},Jn.updateQueue=t,t.stores=[e]):(r=t.stores,r===null?t.stores=[e]:r.push(e))}function S_e(e,t,r,i){t.value=r,t.getSnapshot=i,C_e(t)&&A_e(e)}function E_e(e,t,r){return r(function(){C_e(t)&&A_e(e)})}function C_e(e){var t=e.getSnapshot;e=e.value;try{var r=t();return!Rp(e,r)}catch{return!0}}function A_e(e){var t=Sy(e,1);t!==null&&xp(t,e,1,-1)}function Tle(e){var t=I0();return typeof e=="function"&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Y7,lastRenderedState:e},t.queue=e,e=e.dispatch=aDe.bind(null,Jn,e),[t.memoizedState,e]}function Z7(e,t,r,i){return e={tag:e,create:t,destroy:r,deps:i,next:null},t=Jn.updateQueue,t===null?(t={lastEffect:null,stores:null},Jn.updateQueue=t,t.lastEffect=e.next=e):(r=t.lastEffect,r===null?t.lastEffect=e.next=e:(i=r.next,r.next=e,e.next=i,t.lastEffect=e)),e}function R_e(){return jh().memoizedState}function I$(e,t,r,i){var n=I0();Jn.flags|=e,n.memoizedState=Z7(1|t,r,void 0,i===void 0?null:i)}function Yk(e,t,r,i){var n=jh();i=i===void 0?null:i;var s=void 0;if(Ca!==null){var a=Ca.memoizedState;if(s=a.destroy,i!==null&&rte(i,a.deps)){n.memoizedState=Z7(t,r,s,i);return}}Jn.flags|=e,n.memoizedState=Z7(1|t,r,s,i)}function Sle(e,t){return I$(8390656,8,e,t)}function ste(e,t){return Yk(2048,8,e,t)}function O_e(e,t){return Yk(4,2,e,t)}function M_e(e,t){return Yk(4,4,e,t)}function P_e(e,t){if(typeof t=="function")return e=e(),t(e),function(){t(null)};if(t!=null)return e=e(),t.current=e,function(){t.current=null}}function I_e(e,t,r){return r=r!=null?r.concat([e]):null,Yk(4,4,P_e.bind(null,t,e),r)}function ate(){}function $_e(e,t){var r=jh();t=t===void 0?null:t;var i=r.memoizedState;return i!==null&&t!==null&&rte(t,i[1])?i[0]:(r.memoizedState=[e,t],e)}function L_e(e,t){var r=jh();t=t===void 0?null:t;var i=r.memoizedState;return i!==null&&t!==null&&rte(t,i[1])?i[0]:(e=e(),r.memoizedState=[e,t],e)}function D_e(e,t,r){return(Tw&21)===0?(e.baseState&&(e.baseState=!1,Kc=!0),e.memoizedState=r):(Rp(r,t)||(r=kve(),Jn.lanes|=r,Sw|=r,e.baseState=!0),t)}function nDe(e,t){var r=zi;zi=r!==0&&4>r?r:4,e(!0);var i=DB.transition;DB.transition={};try{e(!1),t()}finally{zi=r,DB.transition=i}}function F_e(){return jh().memoizedState}function sDe(e,t,r){var i=Cv(e);if(r={lane:i,action:r,hasEagerState:!1,eagerState:null,next:null},N_e(e))k_e(t,r);else if(r=p_e(e,t,r,i),r!==null){var n=rc();xp(r,e,i,n),V_e(r,t,i)}}function aDe(e,t,r){var i=Cv(e),n={lane:i,action:r,hasEagerState:!1,eagerState:null,next:null};if(N_e(e))k_e(t,n);else{var s=e.alternate;if(e.lanes===0&&(s===null||s.lanes===0)&&(s=t.lastRenderedReducer,s!==null))try{var a=t.lastRenderedState,o=s(a,r);if(n.hasEagerState=!0,n.eagerState=o,Rp(o,a)){var l=t.interleaved;l===null?(n.next=n,Qee(t)):(n.next=l.next,l.next=n),t.interleaved=n;return}}catch{}finally{}r=p_e(e,t,n,i),r!==null&&(n=rc(),xp(r,e,i,n),V_e(r,t,i))}}function N_e(e){var t=e.alternate;return e===Jn||t!==null&&t===Jn}function k_e(e,t){DC=oF=!0;var r=e.pending;r===null?t.next=t:(t.next=r.next,r.next=t),e.pending=t}function V_e(e,t,r){if((r&4194240)!==0){var i=t.lanes;i&=e.pendingLanes,r|=i,t.lanes=r,Nee(e,r)}}var lF={readContext:Gh,useCallback:Uo,useContext:Uo,useEffect:Uo,useImperativeHandle:Uo,useInsertionEffect:Uo,useLayoutEffect:Uo,useMemo:Uo,useReducer:Uo,useRef:Uo,useState:Uo,useDebugValue:Uo,useDeferredValue:Uo,useTransition:Uo,useMutableSource:Uo,useSyncExternalStore:Uo,useId:Uo,unstable_isNewReconciler:!1},oDe={readContext:Gh,useCallback:function(e,t){return I0().memoizedState=[e,t===void 0?null:t],e},useContext:Gh,useEffect:Sle,useImperativeHandle:function(e,t,r){return r=r!=null?r.concat([e]):null,I$(4194308,4,P_e.bind(null,t,e),r)},useLayoutEffect:function(e,t){return I$(4194308,4,e,t)},useInsertionEffect:function(e,t){return I$(4,2,e,t)},useMemo:function(e,t){var r=I0();return t=t===void 0?null:t,e=e(),r.memoizedState=[e,t],e},useReducer:function(e,t,r){var i=I0();return t=r!==void 0?r(t):t,i.memoizedState=i.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},i.queue=e,e=e.dispatch=sDe.bind(null,Jn,e),[i.memoizedState,e]},useRef:function(e){var t=I0();return e={current:e},t.memoizedState=e},useState:Tle,useDebugValue:ate,useDeferredValue:function(e){return I0().memoizedState=e},useTransition:function(){var e=Tle(!1),t=e[0];return e=nDe.bind(null,e[1]),I0().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,r){var i=Jn,n=I0();if($n){if(r===void 0)throw Error(ke(407));r=r()}else{if(r=t(),lo===null)throw Error(ke(349));(Tw&30)!==0||T_e(i,t,r)}n.memoizedState=r;var s={value:r,getSnapshot:t};return n.queue=s,Sle(E_e.bind(null,i,s,e),[e]),i.flags|=2048,Z7(9,S_e.bind(null,i,s,r,t),void 0,null),r},useId:function(){var e=I0(),t=lo.identifierPrefix;if($n){var r=Yg,i=Xg;r=(i&~(1<<32-wp(i)-1)).toString(32)+r,t=":"+t+"R"+r,r=X7++,0<r&&(t+="H"+r.toString(32)),t+=":"}else r=iDe++,t=":"+t+"r"+r.toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},lDe={readContext:Gh,useCallback:$_e,useContext:Gh,useEffect:ste,useImperativeHandle:I_e,useInsertionEffect:O_e,useLayoutEffect:M_e,useMemo:L_e,useReducer:FB,useRef:R_e,useState:function(){return FB(Y7)},useDebugValue:ate,useDeferredValue:function(e){var t=jh();return D_e(t,Ca.memoizedState,e)},useTransition:function(){var e=FB(Y7)[0],t=jh().memoizedState;return[e,t]},useMutableSource:w_e,useSyncExternalStore:x_e,useId:F_e,unstable_isNewReconciler:!1},cDe={readContext:Gh,useCallback:$_e,useContext:Gh,useEffect:ste,useImperativeHandle:I_e,useInsertionEffect:O_e,useLayoutEffect:M_e,useMemo:L_e,useReducer:NB,useRef:R_e,useState:function(){return NB(Y7)},useDebugValue:ate,useDeferredValue:function(e){var t=jh();return Ca===null?t.memoizedState=e:D_e(t,Ca.memoizedState,e)},useTransition:function(){var e=NB(Y7)[0],t=jh().memoizedState;return[e,t]},useMutableSource:w_e,useSyncExternalStore:x_e,useId:F_e,unstable_isNewReconciler:!1};function E5(e,t){try{var r="",i=t;do r+=N$e(i),i=i.return;while(i);var n=r}catch(s){n=`
Error generating stack: `+s.message+`
`+s.stack}return{value:e,source:t,stack:n,digest:null}}function kB(e,t,r){return{value:e,source:null,stack:r!=null?r:null,digest:t!=null?t:null}}function $W(e,t){try{console.error(t.value)}catch(r){setTimeout(function(){throw r})}}var dDe=typeof WeakMap=="function"?WeakMap:Map;function z_e(e,t,r){r=sy(-1,r),r.tag=3,r.payload={element:null};var i=t.value;return r.callback=function(){dF||(dF=!0,GW=i),$W(e,t)},r}function U_e(e,t,r){r=sy(-1,r),r.tag=3;var i=e.type.getDerivedStateFromError;if(typeof i=="function"){var n=t.value;r.payload=function(){return i(n)},r.callback=function(){$W(e,t)}}var s=e.stateNode;return s!==null&&typeof s.componentDidCatch=="function"&&(r.callback=function(){$W(e,t),typeof i!="function"&&(Ev===null?Ev=new Set([this]):Ev.add(this));var a=t.stack;this.componentDidCatch(t.value,{componentStack:a!==null?a:""})}),r}function Ele(e,t,r){var i=e.pingCache;if(i===null){i=e.pingCache=new dDe;var n=new Set;i.set(t,n)}else n=i.get(t),n===void 0&&(n=new Set,i.set(t,n));n.has(r)||(n.add(r),e=SDe.bind(null,e,t,r),t.then(e,e))}function Cle(e){do{var t;if((t=e.tag===13)&&(t=e.memoizedState,t=t!==null?t.dehydrated!==null:!0),t)return e;e=e.return}while(e!==null);return null}function Ale(e,t,r,i,n){return(e.mode&1)===0?(e===t?e.flags|=65536:(e.flags|=128,r.flags|=131072,r.flags&=-52805,r.tag===1&&(r.alternate===null?r.tag=17:(t=sy(-1,1),t.tag=2,Sv(r,t,1))),r.lanes|=1),e):(e.flags|=65536,e.lanes=n,e)}var uDe=Uy.ReactCurrentOwner,Kc=!1;function Hl(e,t,r,i){t.child=e===null?v_e(t,null,r,i):T5(t,e.child,r,i)}function Rle(e,t,r,i,n){r=r.render;var s=t.ref;return V4(t,n),i=ite(e,t,r,i,s,n),r=nte(),e!==null&&!Kc?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~n,Ey(e,t,n)):($n&&r&&qee(t),t.flags|=1,Hl(e,t,i,n),t.child)}function Ole(e,t,r,i,n){if(e===null){var s=r.type;return typeof s=="function"&&!pte(s)&&s.defaultProps===void 0&&r.compare===null&&r.defaultProps===void 0?(t.tag=15,t.type=s,B_e(e,t,s,i,n)):(e=F$(r.type,null,i,t,t.mode,n),e.ref=t.ref,e.return=t,t.child=e)}if(s=e.child,(e.lanes&n)===0){var a=s.memoizedProps;if(r=r.compare,r=r!==null?r:B7,r(a,i)&&e.ref===t.ref)return Ey(e,t,n)}return t.flags|=1,e=Av(s,i),e.ref=t.ref,e.return=t,t.child=e}function B_e(e,t,r,i,n){if(e!==null){var s=e.memoizedProps;if(B7(s,i)&&e.ref===t.ref)if(Kc=!1,t.pendingProps=i=s,(e.lanes&n)!==0)(e.flags&131072)!==0&&(Kc=!0);else return t.lanes=e.lanes,Ey(e,t,n)}return LW(e,t,r,i,n)}function G_e(e,t,r){var i=t.pendingProps,n=i.children,s=e!==null?e.memoizedState:null;if(i.mode==="hidden")if((t.mode&1)===0)t.memoizedState={baseLanes:0,cachePool:null,transitions:null},un(o4,Wd),Wd|=r;else{if((r&1073741824)===0)return e=s!==null?s.baseLanes|r:r,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,un(o4,Wd),Wd|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},i=s!==null?s.baseLanes:r,un(o4,Wd),Wd|=i}else s!==null?(i=s.baseLanes|r,t.memoizedState=null):i=r,un(o4,Wd),Wd|=i;return Hl(e,t,n,r),t.child}function j_e(e,t){var r=t.ref;(e===null&&r!==null||e!==null&&e.ref!==r)&&(t.flags|=512,t.flags|=2097152)}function LW(e,t,r,i,n){var s=od(r)?ww:bl.current;return s=w5(t,s),V4(t,n),r=ite(e,t,r,i,s,n),i=nte(),e!==null&&!Kc?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~n,Ey(e,t,n)):($n&&i&&qee(t),t.flags|=1,Hl(e,t,r,n),t.child)}function Mle(e,t,r,i,n){if(od(r)){var s=!0;eF(t)}else s=!1;if(V4(t,n),t.stateNode===null)$$(e,t),y_e(t,r,i),IW(t,r,i,n),i=!0;else if(e===null){var a=t.stateNode,o=t.memoizedProps;a.props=o;var l=a.context,c=r.contextType;typeof c=="object"&&c!==null?c=Gh(c):(c=od(r)?ww:bl.current,c=w5(t,c));var u=r.getDerivedStateFromProps,h=typeof u=="function"||typeof a.getSnapshotBeforeUpdate=="function";h||typeof a.UNSAFE_componentWillReceiveProps!="function"&&typeof a.componentWillReceiveProps!="function"||(o!==i||l!==c)&&wle(t,a,i,c),M1=!1;var p=t.memoizedState;a.state=p,sF(t,i,a,n),l=t.memoizedState,o!==i||p!==l||ad.current||M1?(typeof u=="function"&&(PW(t,r,u,i),l=t.memoizedState),(o=M1||_le(t,r,o,i,p,l,c))?(h||typeof a.UNSAFE_componentWillMount!="function"&&typeof a.componentWillMount!="function"||(typeof a.componentWillMount=="function"&&a.componentWillMount(),typeof a.UNSAFE_componentWillMount=="function"&&a.UNSAFE_componentWillMount()),typeof a.componentDidMount=="function"&&(t.flags|=4194308)):(typeof a.componentDidMount=="function"&&(t.flags|=4194308),t.memoizedProps=i,t.memoizedState=l),a.props=i,a.state=l,a.context=c,i=o):(typeof a.componentDidMount=="function"&&(t.flags|=4194308),i=!1)}else{a=t.stateNode,m_e(e,t),o=t.memoizedProps,c=t.type===t.elementType?o:Wf(t.type,o),a.props=c,h=t.pendingProps,p=a.context,l=r.contextType,typeof l=="object"&&l!==null?l=Gh(l):(l=od(r)?ww:bl.current,l=w5(t,l));var m=r.getDerivedStateFromProps;(u=typeof m=="function"||typeof a.getSnapshotBeforeUpdate=="function")||typeof a.UNSAFE_componentWillReceiveProps!="function"&&typeof a.componentWillReceiveProps!="function"||(o!==h||p!==l)&&wle(t,a,i,l),M1=!1,p=t.memoizedState,a.state=p,sF(t,i,a,n);var g=t.memoizedState;o!==h||p!==g||ad.current||M1?(typeof m=="function"&&(PW(t,r,m,i),g=t.memoizedState),(c=M1||_le(t,r,c,i,p,g,l)||!1)?(u||typeof a.UNSAFE_componentWillUpdate!="function"&&typeof a.componentWillUpdate!="function"||(typeof a.componentWillUpdate=="function"&&a.componentWillUpdate(i,g,l),typeof a.UNSAFE_componentWillUpdate=="function"&&a.UNSAFE_componentWillUpdate(i,g,l)),typeof a.componentDidUpdate=="function"&&(t.flags|=4),typeof a.getSnapshotBeforeUpdate=="function"&&(t.flags|=1024)):(typeof a.componentDidUpdate!="function"||o===e.memoizedProps&&p===e.memoizedState||(t.flags|=4),typeof a.getSnapshotBeforeUpdate!="function"||o===e.memoizedProps&&p===e.memoizedState||(t.flags|=1024),t.memoizedProps=i,t.memoizedState=g),a.props=i,a.state=g,a.context=l,i=c):(typeof a.componentDidUpdate!="function"||o===e.memoizedProps&&p===e.memoizedState||(t.flags|=4),typeof a.getSnapshotBeforeUpdate!="function"||o===e.memoizedProps&&p===e.memoizedState||(t.flags|=1024),i=!1)}return DW(e,t,r,i,s,n)}function DW(e,t,r,i,n,s){j_e(e,t);var a=(t.flags&128)!==0;if(!i&&!a)return n&&mle(t,r,!1),Ey(e,t,s);i=t.stateNode,uDe.current=t;var o=a&&typeof r.getDerivedStateFromError!="function"?null:i.render();return t.flags|=1,e!==null&&a?(t.child=T5(t,e.child,null,s),t.child=T5(t,null,o,s)):Hl(e,t,o,s),t.memoizedState=i.state,n&&mle(t,r,!0),t.child}function q_e(e){var t=e.stateNode;t.pendingContext?ple(e,t.pendingContext,t.pendingContext!==t.context):t.context&&ple(e,t.context,!1),Kee(e,t.containerInfo)}function Ple(e,t,r,i,n){return x5(),Wee(n),t.flags|=256,Hl(e,t,r,i),t.child}var FW={dehydrated:null,treeContext:null,retryLane:0};function NW(e){return{baseLanes:e,cachePool:null,transitions:null}}function H_e(e,t,r){var i=t.pendingProps,n=qn.current,s=!1,a=(t.flags&128)!==0,o;if((o=a)||(o=e!==null&&e.memoizedState===null?!1:(n&2)!==0),o?(s=!0,t.flags&=-129):(e===null||e.memoizedState!==null)&&(n|=1),un(qn,n&1),e===null)return OW(t),e=t.memoizedState,e!==null&&(e=e.dehydrated,e!==null)?((t.mode&1)===0?t.lanes=1:e.data==="$!"?t.lanes=8:t.lanes=1073741824,null):(a=i.children,e=i.fallback,s?(i=t.mode,s=t.child,a={mode:"hidden",children:a},(i&1)===0&&s!==null?(s.childLanes=0,s.pendingProps=a):s=Jk(a,i,0,null),e=rw(e,i,r,null),s.return=t,e.return=t,s.sibling=e,t.child=s,t.child.memoizedState=NW(r),t.memoizedState=FW,e):ote(t,a));if(n=e.memoizedState,n!==null&&(o=n.dehydrated,o!==null))return hDe(e,t,a,i,o,n,r);if(s){s=i.fallback,a=t.mode,n=e.child,o=n.sibling;var l={mode:"hidden",children:i.children};return(a&1)===0&&t.child!==n?(i=t.child,i.childLanes=0,i.pendingProps=l,t.deletions=null):(i=Av(n,l),i.subtreeFlags=n.subtreeFlags&14680064),o!==null?s=Av(o,s):(s=rw(s,a,r,null),s.flags|=2),s.return=t,i.return=t,i.sibling=s,t.child=i,i=s,s=t.child,a=e.child.memoizedState,a=a===null?NW(r):{baseLanes:a.baseLanes|r,cachePool:null,transitions:a.transitions},s.memoizedState=a,s.childLanes=e.childLanes&~r,t.memoizedState=FW,i}return s=e.child,e=s.sibling,i=Av(s,{mode:"visible",children:i.children}),(t.mode&1)===0&&(i.lanes=r),i.return=t,i.sibling=null,e!==null&&(r=t.deletions,r===null?(t.deletions=[e],t.flags|=16):r.push(e)),t.child=i,t.memoizedState=null,i}function ote(e,t){return t=Jk({mode:"visible",children:t},e.mode,0,null),t.return=e,e.child=t}function gM(e,t,r,i){return i!==null&&Wee(i),T5(t,e.child,null,r),e=ote(t,t.pendingProps.children),e.flags|=2,t.memoizedState=null,e}function hDe(e,t,r,i,n,s,a){if(r)return t.flags&256?(t.flags&=-257,i=kB(Error(ke(422))),gM(e,t,a,i)):t.memoizedState!==null?(t.child=e.child,t.flags|=128,null):(s=i.fallback,n=t.mode,i=Jk({mode:"visible",children:i.children},n,0,null),s=rw(s,n,a,null),s.flags|=2,i.return=t,s.return=t,i.sibling=s,t.child=i,(t.mode&1)!==0&&T5(t,e.child,null,a),t.child.memoizedState=NW(a),t.memoizedState=FW,s);if((t.mode&1)===0)return gM(e,t,a,null);if(n.data==="$!"){if(i=n.nextSibling&&n.nextSibling.dataset,i)var o=i.dgst;return i=o,s=Error(ke(419)),i=kB(s,i,void 0),gM(e,t,a,i)}if(o=(a&e.childLanes)!==0,Kc||o){if(i=lo,i!==null){switch(a&-a){case 4:n=2;break;case 16:n=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:n=32;break;case 536870912:n=268435456;break;default:n=0}n=(n&(i.suspendedLanes|a))!==0?0:n,n!==0&&n!==s.retryLane&&(s.retryLane=n,Sy(e,n),xp(i,e,n,-1))}return fte(),i=kB(Error(ke(421))),gM(e,t,a,i)}return n.data==="$?"?(t.flags|=128,t.child=e.child,t=EDe.bind(null,e),n._reactRetry=t,null):(e=s.treeContext,cu=Tv(n.nextSibling),fu=t,$n=!0,tp=null,e!==null&&(xh[Th++]=Xg,xh[Th++]=Yg,xh[Th++]=xw,Xg=e.id,Yg=e.overflow,xw=t),t=ote(t,i.children),t.flags|=4096,t)}function Ile(e,t,r){e.lanes|=t;var i=e.alternate;i!==null&&(i.lanes|=t),MW(e.return,t,r)}function VB(e,t,r,i,n){var s=e.memoizedState;s===null?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:i,tail:r,tailMode:n}:(s.isBackwards=t,s.rendering=null,s.renderingStartTime=0,s.last=i,s.tail=r,s.tailMode=n)}function W_e(e,t,r){var i=t.pendingProps,n=i.revealOrder,s=i.tail;if(Hl(e,t,i.children,r),i=qn.current,(i&2)!==0)i=i&1|2,t.flags|=128;else{if(e!==null&&(e.flags&128)!==0)e:for(e=t.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&Ile(e,r,t);else if(e.tag===19)Ile(e,r,t);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;e.sibling===null;){if(e.return===null||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}i&=1}if(un(qn,i),(t.mode&1)===0)t.memoizedState=null;else switch(n){case"forwards":for(r=t.child,n=null;r!==null;)e=r.alternate,e!==null&&aF(e)===null&&(n=r),r=r.sibling;r=n,r===null?(n=t.child,t.child=null):(n=r.sibling,r.sibling=null),VB(t,!1,n,r,s);break;case"backwards":for(r=null,n=t.child,t.child=null;n!==null;){if(e=n.alternate,e!==null&&aF(e)===null){t.child=n;break}e=n.sibling,n.sibling=r,r=n,n=e}VB(t,!0,r,null,s);break;case"together":VB(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function $$(e,t){(t.mode&1)===0&&e!==null&&(e.alternate=null,t.alternate=null,t.flags|=2)}function Ey(e,t,r){if(e!==null&&(t.dependencies=e.dependencies),Sw|=t.lanes,(r&t.childLanes)===0)return null;if(e!==null&&t.child!==e.child)throw Error(ke(153));if(t.child!==null){for(e=t.child,r=Av(e,e.pendingProps),t.child=r,r.return=t;e.sibling!==null;)e=e.sibling,r=r.sibling=Av(e,e.pendingProps),r.return=t;r.sibling=null}return t.child}function fDe(e,t,r){switch(t.tag){case 3:q_e(t),x5();break;case 5:__e(t);break;case 1:od(t.type)&&eF(t);break;case 4:Kee(t,t.stateNode.containerInfo);break;case 10:var i=t.type._context,n=t.memoizedProps.value;un(iF,i._currentValue),i._currentValue=n;break;case 13:if(i=t.memoizedState,i!==null)return i.dehydrated!==null?(un(qn,qn.current&1),t.flags|=128,null):(r&t.child.childLanes)!==0?H_e(e,t,r):(un(qn,qn.current&1),e=Ey(e,t,r),e!==null?e.sibling:null);un(qn,qn.current&1);break;case 19:if(i=(r&t.childLanes)!==0,(e.flags&128)!==0){if(i)return W_e(e,t,r);t.flags|=128}if(n=t.memoizedState,n!==null&&(n.rendering=null,n.tail=null,n.lastEffect=null),un(qn,qn.current),i)break;return null;case 22:case 23:return t.lanes=0,G_e(e,t,r)}return Ey(e,t,r)}var X_e,kW,Y_e,Z_e;X_e=function(e,t){for(var r=t.child;r!==null;){if(r.tag===5||r.tag===6)e.appendChild(r.stateNode);else if(r.tag!==4&&r.child!==null){r.child.return=r,r=r.child;continue}if(r===t)break;for(;r.sibling===null;){if(r.return===null||r.return===t)return;r=r.return}r.sibling.return=r.return,r=r.sibling}};kW=function(){};Y_e=function(e,t,r,i){var n=e.memoizedProps;if(n!==i){e=t.stateNode,F3(K0.current);var s=null;switch(r){case"input":n=aW(e,n),i=aW(e,i),s=[];break;case"select":n=ts({},n,{value:void 0}),i=ts({},i,{value:void 0}),s=[];break;case"textarea":n=cW(e,n),i=cW(e,i),s=[];break;default:typeof n.onClick!="function"&&typeof i.onClick=="function"&&(e.onclick=JD)}uW(r,i);var a;r=null;for(c in n)if(!i.hasOwnProperty(c)&&n.hasOwnProperty(c)&&n[c]!=null)if(c==="style"){var o=n[c];for(a in o)o.hasOwnProperty(a)&&(r||(r={}),r[a]="")}else c!=="dangerouslySetInnerHTML"&&c!=="children"&&c!=="suppressContentEditableWarning"&&c!=="suppressHydrationWarning"&&c!=="autoFocus"&&(D7.hasOwnProperty(c)?s||(s=[]):(s=s||[]).push(c,null));for(c in i){var l=i[c];if(o=n!=null?n[c]:void 0,i.hasOwnProperty(c)&&l!==o&&(l!=null||o!=null))if(c==="style")if(o){for(a in o)!o.hasOwnProperty(a)||l&&l.hasOwnProperty(a)||(r||(r={}),r[a]="");for(a in l)l.hasOwnProperty(a)&&o[a]!==l[a]&&(r||(r={}),r[a]=l[a])}else r||(s||(s=[]),s.push(c,r)),r=l;else c==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,o=o?o.__html:void 0,l!=null&&o!==l&&(s=s||[]).push(c,l)):c==="children"?typeof l!="string"&&typeof l!="number"||(s=s||[]).push(c,""+l):c!=="suppressContentEditableWarning"&&c!=="suppressHydrationWarning"&&(D7.hasOwnProperty(c)?(l!=null&&c==="onScroll"&&bn("scroll",e),s||o===l||(s=[])):(s=s||[]).push(c,l))}r&&(s=s||[]).push("style",r);var c=s;(t.updateQueue=c)&&(t.flags|=4)}};Z_e=function(e,t,r,i){r!==i&&(t.flags|=4)};function $6(e,t){if(!$n)switch(e.tailMode){case"hidden":t=e.tail;for(var r=null;t!==null;)t.alternate!==null&&(r=t),t=t.sibling;r===null?e.tail=null:r.sibling=null;break;case"collapsed":r=e.tail;for(var i=null;r!==null;)r.alternate!==null&&(i=r),r=r.sibling;i===null?t||e.tail===null?e.tail=null:e.tail.sibling=null:i.sibling=null}}function Bo(e){var t=e.alternate!==null&&e.alternate.child===e.child,r=0,i=0;if(t)for(var n=e.child;n!==null;)r|=n.lanes|n.childLanes,i|=n.subtreeFlags&14680064,i|=n.flags&14680064,n.return=e,n=n.sibling;else for(n=e.child;n!==null;)r|=n.lanes|n.childLanes,i|=n.subtreeFlags,i|=n.flags,n.return=e,n=n.sibling;return e.subtreeFlags|=i,e.childLanes=r,t}function pDe(e,t,r){var i=t.pendingProps;switch(Hee(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Bo(t),null;case 1:return od(t.type)&&KD(),Bo(t),null;case 3:return i=t.stateNode,S5(),An(ad),An(bl),tte(),i.pendingContext&&(i.context=i.pendingContext,i.pendingContext=null),(e===null||e.child===null)&&(pM(t)?t.flags|=4:e===null||e.memoizedState.isDehydrated&&(t.flags&256)===0||(t.flags|=1024,tp!==null&&(HW(tp),tp=null))),kW(e,t),Bo(t),null;case 5:ete(t);var n=F3(W7.current);if(r=t.type,e!==null&&t.stateNode!=null)Y_e(e,t,r,i,n),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!i){if(t.stateNode===null)throw Error(ke(166));return Bo(t),null}if(e=F3(K0.current),pM(t)){i=t.stateNode,r=t.type;var s=t.memoizedProps;switch(i[B0]=t,i[q7]=s,e=(t.mode&1)!==0,r){case"dialog":bn("cancel",i),bn("close",i);break;case"iframe":case"object":case"embed":bn("load",i);break;case"video":case"audio":for(n=0;n<rE.length;n++)bn(rE[n],i);break;case"source":bn("error",i);break;case"img":case"image":case"link":bn("error",i),bn("load",i);break;case"details":bn("toggle",i);break;case"input":Uoe(i,s),bn("invalid",i);break;case"select":i._wrapperState={wasMultiple:!!s.multiple},bn("invalid",i);break;case"textarea":Goe(i,s),bn("invalid",i)}uW(r,s),n=null;for(var a in s)if(s.hasOwnProperty(a)){var o=s[a];a==="children"?typeof o=="string"?i.textContent!==o&&(s.suppressHydrationWarning!==!0&&fM(i.textContent,o,e),n=["children",o]):typeof o=="number"&&i.textContent!==""+o&&(s.suppressHydrationWarning!==!0&&fM(i.textContent,o,e),n=["children",""+o]):D7.hasOwnProperty(a)&&o!=null&&a==="onScroll"&&bn("scroll",i)}switch(r){case"input":sM(i),Boe(i,s,!0);break;case"textarea":sM(i),joe(i);break;case"select":case"option":break;default:typeof s.onClick=="function"&&(i.onclick=JD)}i=n,t.updateQueue=i,i!==null&&(t.flags|=4)}else{a=n.nodeType===9?n:n.ownerDocument,e==="http://www.w3.org/1999/xhtml"&&(e=Tve(r)),e==="http://www.w3.org/1999/xhtml"?r==="script"?(e=a.createElement("div"),e.innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):typeof i.is=="string"?e=a.createElement(r,{is:i.is}):(e=a.createElement(r),r==="select"&&(a=e,i.multiple?a.multiple=!0:i.size&&(a.size=i.size))):e=a.createElementNS(e,r),e[B0]=t,e[q7]=i,X_e(e,t,!1,!1),t.stateNode=e;e:{switch(a=hW(r,i),r){case"dialog":bn("cancel",e),bn("close",e),n=i;break;case"iframe":case"object":case"embed":bn("load",e),n=i;break;case"video":case"audio":for(n=0;n<rE.length;n++)bn(rE[n],e);n=i;break;case"source":bn("error",e),n=i;break;case"img":case"image":case"link":bn("error",e),bn("load",e),n=i;break;case"details":bn("toggle",e),n=i;break;case"input":Uoe(e,i),n=aW(e,i),bn("invalid",e);break;case"option":n=i;break;case"select":e._wrapperState={wasMultiple:!!i.multiple},n=ts({},i,{value:void 0}),bn("invalid",e);break;case"textarea":Goe(e,i),n=cW(e,i),bn("invalid",e);break;default:n=i}uW(r,n),o=n;for(s in o)if(o.hasOwnProperty(s)){var l=o[s];s==="style"?Cve(e,l):s==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,l!=null&&Sve(e,l)):s==="children"?typeof l=="string"?(r!=="textarea"||l!=="")&&F7(e,l):typeof l=="number"&&F7(e,""+l):s!=="suppressContentEditableWarning"&&s!=="suppressHydrationWarning"&&s!=="autoFocus"&&(D7.hasOwnProperty(s)?l!=null&&s==="onScroll"&&bn("scroll",e):l!=null&&Pee(e,s,l,a))}switch(r){case"input":sM(e),Boe(e,i,!1);break;case"textarea":sM(e),joe(e);break;case"option":i.value!=null&&e.setAttribute("value",""+Uv(i.value));break;case"select":e.multiple=!!i.multiple,s=i.value,s!=null?D4(e,!!i.multiple,s,!1):i.defaultValue!=null&&D4(e,!!i.multiple,i.defaultValue,!0);break;default:typeof n.onClick=="function"&&(e.onclick=JD)}switch(r){case"button":case"input":case"select":case"textarea":i=!!i.autoFocus;break e;case"img":i=!0;break e;default:i=!1}}i&&(t.flags|=4)}t.ref!==null&&(t.flags|=512,t.flags|=2097152)}return Bo(t),null;case 6:if(e&&t.stateNode!=null)Z_e(e,t,e.memoizedProps,i);else{if(typeof i!="string"&&t.stateNode===null)throw Error(ke(166));if(r=F3(W7.current),F3(K0.current),pM(t)){if(i=t.stateNode,r=t.memoizedProps,i[B0]=t,(s=i.nodeValue!==r)&&(e=fu,e!==null))switch(e.tag){case 3:fM(i.nodeValue,r,(e.mode&1)!==0);break;case 5:e.memoizedProps.suppressHydrationWarning!==!0&&fM(i.nodeValue,r,(e.mode&1)!==0)}s&&(t.flags|=4)}else i=(r.nodeType===9?r:r.ownerDocument).createTextNode(i),i[B0]=t,t.stateNode=i}return Bo(t),null;case 13:if(An(qn),i=t.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if($n&&cu!==null&&(t.mode&1)!==0&&(t.flags&128)===0)f_e(),x5(),t.flags|=98560,s=!1;else if(s=pM(t),i!==null&&i.dehydrated!==null){if(e===null){if(!s)throw Error(ke(318));if(s=t.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(ke(317));s[B0]=t}else x5(),(t.flags&128)===0&&(t.memoizedState=null),t.flags|=4;Bo(t),s=!1}else tp!==null&&(HW(tp),tp=null),s=!0;if(!s)return t.flags&65536?t:null}return(t.flags&128)!==0?(t.lanes=r,t):(i=i!==null,i!==(e!==null&&e.memoizedState!==null)&&i&&(t.child.flags|=8192,(t.mode&1)!==0&&(e===null||(qn.current&1)!==0?$a===0&&($a=3):fte())),t.updateQueue!==null&&(t.flags|=4),Bo(t),null);case 4:return S5(),kW(e,t),e===null&&G7(t.stateNode.containerInfo),Bo(t),null;case 10:return Zee(t.type._context),Bo(t),null;case 17:return od(t.type)&&KD(),Bo(t),null;case 19:if(An(qn),s=t.memoizedState,s===null)return Bo(t),null;if(i=(t.flags&128)!==0,a=s.rendering,a===null)if(i)$6(s,!1);else{if($a!==0||e!==null&&(e.flags&128)!==0)for(e=t.child;e!==null;){if(a=aF(e),a!==null){for(t.flags|=128,$6(s,!1),i=a.updateQueue,i!==null&&(t.updateQueue=i,t.flags|=4),t.subtreeFlags=0,i=r,r=t.child;r!==null;)s=r,e=i,s.flags&=14680066,a=s.alternate,a===null?(s.childLanes=0,s.lanes=e,s.child=null,s.subtreeFlags=0,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=a.childLanes,s.lanes=a.lanes,s.child=a.child,s.subtreeFlags=0,s.deletions=null,s.memoizedProps=a.memoizedProps,s.memoizedState=a.memoizedState,s.updateQueue=a.updateQueue,s.type=a.type,e=a.dependencies,s.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext}),r=r.sibling;return un(qn,qn.current&1|2),t.child}e=e.sibling}s.tail!==null&&Fs()>C5&&(t.flags|=128,i=!0,$6(s,!1),t.lanes=4194304)}else{if(!i)if(e=aF(a),e!==null){if(t.flags|=128,i=!0,r=e.updateQueue,r!==null&&(t.updateQueue=r,t.flags|=4),$6(s,!0),s.tail===null&&s.tailMode==="hidden"&&!a.alternate&&!$n)return Bo(t),null}else 2*Fs()-s.renderingStartTime>C5&&r!==1073741824&&(t.flags|=128,i=!0,$6(s,!1),t.lanes=4194304);s.isBackwards?(a.sibling=t.child,t.child=a):(r=s.last,r!==null?r.sibling=a:t.child=a,s.last=a)}return s.tail!==null?(t=s.tail,s.rendering=t,s.tail=t.sibling,s.renderingStartTime=Fs(),t.sibling=null,r=qn.current,un(qn,i?r&1|2:r&1),t):(Bo(t),null);case 22:case 23:return hte(),i=t.memoizedState!==null,e!==null&&e.memoizedState!==null!==i&&(t.flags|=8192),i&&(t.mode&1)!==0?(Wd&1073741824)!==0&&(Bo(t),t.subtreeFlags&6&&(t.flags|=8192)):Bo(t),null;case 24:return null;case 25:return null}throw Error(ke(156,t.tag))}function mDe(e,t){switch(Hee(t),t.tag){case 1:return od(t.type)&&KD(),e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 3:return S5(),An(ad),An(bl),tte(),e=t.flags,(e&65536)!==0&&(e&128)===0?(t.flags=e&-65537|128,t):null;case 5:return ete(t),null;case 13:if(An(qn),e=t.memoizedState,e!==null&&e.dehydrated!==null){if(t.alternate===null)throw Error(ke(340));x5()}return e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 19:return An(qn),null;case 4:return S5(),null;case 10:return Zee(t.type._context),null;case 22:case 23:return hte(),null;case 24:return null;default:return null}}var yM=!1,dl=!1,gDe=typeof WeakSet=="function"?WeakSet:Set,ut=null;function a4(e,t){var r=e.ref;if(r!==null)if(typeof r=="function")try{r(null)}catch(i){ms(e,t,i)}else r.current=null}function VW(e,t,r){try{r()}catch(i){ms(e,t,i)}}var $le=!1;function yDe(e,t){if(xW=YD,e=e_e(),jee(e)){if("selectionStart"in e)var r={start:e.selectionStart,end:e.selectionEnd};else e:{r=(r=e.ownerDocument)&&r.defaultView||window;var i=r.getSelection&&r.getSelection();if(i&&i.rangeCount!==0){r=i.anchorNode;var n=i.anchorOffset,s=i.focusNode;i=i.focusOffset;try{r.nodeType,s.nodeType}catch{r=null;break e}var a=0,o=-1,l=-1,c=0,u=0,h=e,p=null;t:for(;;){for(var m;h!==r||n!==0&&h.nodeType!==3||(o=a+n),h!==s||i!==0&&h.nodeType!==3||(l=a+i),h.nodeType===3&&(a+=h.nodeValue.length),(m=h.firstChild)!==null;)p=h,h=m;for(;;){if(h===e)break t;if(p===r&&++c===n&&(o=a),p===s&&++u===i&&(l=a),(m=h.nextSibling)!==null)break;h=p,p=h.parentNode}h=m}r=o===-1||l===-1?null:{start:o,end:l}}else r=null}r=r||{start:0,end:0}}else r=null;for(TW={focusedElem:e,selectionRange:r},YD=!1,ut=t;ut!==null;)if(t=ut,e=t.child,(t.subtreeFlags&1028)!==0&&e!==null)e.return=t,ut=e;else for(;ut!==null;){t=ut;try{var g=t.alternate;if((t.flags&1024)!==0)switch(t.tag){case 0:case 11:case 15:break;case 1:if(g!==null){var b=g.memoizedProps,w=g.memoizedState,v=t.stateNode,x=v.getSnapshotBeforeUpdate(t.elementType===t.type?b:Wf(t.type,b),w);v.__reactInternalSnapshotBeforeUpdate=x}break;case 3:var T=t.stateNode.containerInfo;T.nodeType===1?T.textContent="":T.nodeType===9&&T.documentElement&&T.removeChild(T.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(ke(163))}}catch(E){ms(t,t.return,E)}if(e=t.sibling,e!==null){e.return=t.return,ut=e;break}ut=t.return}return g=$le,$le=!1,g}function FC(e,t,r){var i=t.updateQueue;if(i=i!==null?i.lastEffect:null,i!==null){var n=i=i.next;do{if((n.tag&e)===e){var s=n.destroy;n.destroy=void 0,s!==void 0&&VW(t,r,s)}n=n.next}while(n!==i)}}function Zk(e,t){if(t=t.updateQueue,t=t!==null?t.lastEffect:null,t!==null){var r=t=t.next;do{if((r.tag&e)===e){var i=r.create;r.destroy=i()}r=r.next}while(r!==t)}}function zW(e){var t=e.ref;if(t!==null){var r=e.stateNode;switch(e.tag){case 5:e=r;break;default:e=r}typeof t=="function"?t(e):t.current=e}}function Q_e(e){var t=e.alternate;t!==null&&(e.alternate=null,Q_e(t)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(t=e.stateNode,t!==null&&(delete t[B0],delete t[q7],delete t[CW],delete t[KLe],delete t[eDe])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function J_e(e){return e.tag===5||e.tag===3||e.tag===4}function Lle(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||J_e(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function UW(e,t,r){var i=e.tag;if(i===5||i===6)e=e.stateNode,t?r.nodeType===8?r.parentNode.insertBefore(e,t):r.insertBefore(e,t):(r.nodeType===8?(t=r.parentNode,t.insertBefore(e,r)):(t=r,t.appendChild(e)),r=r._reactRootContainer,r!=null||t.onclick!==null||(t.onclick=JD));else if(i!==4&&(e=e.child,e!==null))for(UW(e,t,r),e=e.sibling;e!==null;)UW(e,t,r),e=e.sibling}function BW(e,t,r){var i=e.tag;if(i===5||i===6)e=e.stateNode,t?r.insertBefore(e,t):r.appendChild(e);else if(i!==4&&(e=e.child,e!==null))for(BW(e,t,r),e=e.sibling;e!==null;)BW(e,t,r),e=e.sibling}var So=null,Zf=!1;function ib(e,t,r){for(r=r.child;r!==null;)K_e(e,t,r),r=r.sibling}function K_e(e,t,r){if(J0&&typeof J0.onCommitFiberUnmount=="function")try{J0.onCommitFiberUnmount(Bk,r)}catch{}switch(r.tag){case 5:dl||a4(r,t);case 6:var i=So,n=Zf;So=null,ib(e,t,r),So=i,Zf=n,So!==null&&(Zf?(e=So,r=r.stateNode,e.nodeType===8?e.parentNode.removeChild(r):e.removeChild(r)):So.removeChild(r.stateNode));break;case 18:So!==null&&(Zf?(e=So,r=r.stateNode,e.nodeType===8?IB(e.parentNode,r):e.nodeType===1&&IB(e,r),z7(e)):IB(So,r.stateNode));break;case 4:i=So,n=Zf,So=r.stateNode.containerInfo,Zf=!0,ib(e,t,r),So=i,Zf=n;break;case 0:case 11:case 14:case 15:if(!dl&&(i=r.updateQueue,i!==null&&(i=i.lastEffect,i!==null))){n=i=i.next;do{var s=n,a=s.destroy;s=s.tag,a!==void 0&&((s&2)!==0||(s&4)!==0)&&VW(r,t,a),n=n.next}while(n!==i)}ib(e,t,r);break;case 1:if(!dl&&(a4(r,t),i=r.stateNode,typeof i.componentWillUnmount=="function"))try{i.props=r.memoizedProps,i.state=r.memoizedState,i.componentWillUnmount()}catch(o){ms(r,t,o)}ib(e,t,r);break;case 21:ib(e,t,r);break;case 22:r.mode&1?(dl=(i=dl)||r.memoizedState!==null,ib(e,t,r),dl=i):ib(e,t,r);break;default:ib(e,t,r)}}function Dle(e){var t=e.updateQueue;if(t!==null){e.updateQueue=null;var r=e.stateNode;r===null&&(r=e.stateNode=new gDe),t.forEach(function(i){var n=CDe.bind(null,e,i);r.has(i)||(r.add(i),i.then(n,n))})}}function df(e,t){var r=t.deletions;if(r!==null)for(var i=0;i<r.length;i++){var n=r[i];try{var s=e,a=t,o=a;e:for(;o!==null;){switch(o.tag){case 5:So=o.stateNode,Zf=!1;break e;case 3:So=o.stateNode.containerInfo,Zf=!0;break e;case 4:So=o.stateNode.containerInfo,Zf=!0;break e}o=o.return}if(So===null)throw Error(ke(160));K_e(s,a,n),So=null,Zf=!1;var l=n.alternate;l!==null&&(l.return=null),n.return=null}catch(c){ms(n,t,c)}}if(t.subtreeFlags&12854)for(t=t.child;t!==null;)e2e(t,e),t=t.sibling}function e2e(e,t){var r=e.alternate,i=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(df(t,e),zp(e),i&4){try{FC(3,e,e.return),Zk(3,e)}catch(b){ms(e,e.return,b)}try{FC(5,e,e.return)}catch(b){ms(e,e.return,b)}}break;case 1:df(t,e),zp(e),i&512&&r!==null&&a4(r,r.return);break;case 5:if(df(t,e),zp(e),i&512&&r!==null&&a4(r,r.return),e.flags&32){var n=e.stateNode;try{F7(n,"")}catch(b){ms(e,e.return,b)}}if(i&4&&(n=e.stateNode,n!=null)){var s=e.memoizedProps,a=r!==null?r.memoizedProps:s,o=e.type,l=e.updateQueue;if(e.updateQueue=null,l!==null)try{o==="input"&&s.type==="radio"&&s.name!=null&&wve(n,s),hW(o,a);var c=hW(o,s);for(a=0;a<l.length;a+=2){var u=l[a],h=l[a+1];u==="style"?Cve(n,h):u==="dangerouslySetInnerHTML"?Sve(n,h):u==="children"?F7(n,h):Pee(n,u,h,c)}switch(o){case"input":oW(n,s);break;case"textarea":xve(n,s);break;case"select":var p=n._wrapperState.wasMultiple;n._wrapperState.wasMultiple=!!s.multiple;var m=s.value;m!=null?D4(n,!!s.multiple,m,!1):p!==!!s.multiple&&(s.defaultValue!=null?D4(n,!!s.multiple,s.defaultValue,!0):D4(n,!!s.multiple,s.multiple?[]:"",!1))}n[q7]=s}catch(b){ms(e,e.return,b)}}break;case 6:if(df(t,e),zp(e),i&4){if(e.stateNode===null)throw Error(ke(162));n=e.stateNode,s=e.memoizedProps;try{n.nodeValue=s}catch(b){ms(e,e.return,b)}}break;case 3:if(df(t,e),zp(e),i&4&&r!==null&&r.memoizedState.isDehydrated)try{z7(t.containerInfo)}catch(b){ms(e,e.return,b)}break;case 4:df(t,e),zp(e);break;case 13:df(t,e),zp(e),n=e.child,n.flags&8192&&(s=n.memoizedState!==null,n.stateNode.isHidden=s,!s||n.alternate!==null&&n.alternate.memoizedState!==null||(dte=Fs())),i&4&&Dle(e);break;case 22:if(u=r!==null&&r.memoizedState!==null,e.mode&1?(dl=(c=dl)||u,df(t,e),dl=c):df(t,e),zp(e),i&8192){if(c=e.memoizedState!==null,(e.stateNode.isHidden=c)&&!u&&(e.mode&1)!==0)for(ut=e,u=e.child;u!==null;){for(h=ut=u;ut!==null;){switch(p=ut,m=p.child,p.tag){case 0:case 11:case 14:case 15:FC(4,p,p.return);break;case 1:a4(p,p.return);var g=p.stateNode;if(typeof g.componentWillUnmount=="function"){i=p,r=p.return;try{t=i,g.props=t.memoizedProps,g.state=t.memoizedState,g.componentWillUnmount()}catch(b){ms(i,r,b)}}break;case 5:a4(p,p.return);break;case 22:if(p.memoizedState!==null){Nle(h);continue}}m!==null?(m.return=p,ut=m):Nle(h)}u=u.sibling}e:for(u=null,h=e;;){if(h.tag===5){if(u===null){u=h;try{n=h.stateNode,c?(s=n.style,typeof s.setProperty=="function"?s.setProperty("display","none","important"):s.display="none"):(o=h.stateNode,l=h.memoizedProps.style,a=l!=null&&l.hasOwnProperty("display")?l.display:null,o.style.display=Eve("display",a))}catch(b){ms(e,e.return,b)}}}else if(h.tag===6){if(u===null)try{h.stateNode.nodeValue=c?"":h.memoizedProps}catch(b){ms(e,e.return,b)}}else if((h.tag!==22&&h.tag!==23||h.memoizedState===null||h===e)&&h.child!==null){h.child.return=h,h=h.child;continue}if(h===e)break e;for(;h.sibling===null;){if(h.return===null||h.return===e)break e;u===h&&(u=null),h=h.return}u===h&&(u=null),h.sibling.return=h.return,h=h.sibling}}break;case 19:df(t,e),zp(e),i&4&&Dle(e);break;case 21:break;default:df(t,e),zp(e)}}function zp(e){var t=e.flags;if(t&2){try{e:{for(var r=e.return;r!==null;){if(J_e(r)){var i=r;break e}r=r.return}throw Error(ke(160))}switch(i.tag){case 5:var n=i.stateNode;i.flags&32&&(F7(n,""),i.flags&=-33);var s=Lle(e);BW(e,s,n);break;case 3:case 4:var a=i.stateNode.containerInfo,o=Lle(e);UW(e,o,a);break;default:throw Error(ke(161))}}catch(l){ms(e,e.return,l)}e.flags&=-3}t&4096&&(e.flags&=-4097)}function bDe(e,t,r){ut=e,t2e(e)}function t2e(e,t,r){for(var i=(e.mode&1)!==0;ut!==null;){var n=ut,s=n.child;if(n.tag===22&&i){var a=n.memoizedState!==null||yM;if(!a){var o=n.alternate,l=o!==null&&o.memoizedState!==null||dl;o=yM;var c=dl;if(yM=a,(dl=l)&&!c)for(ut=n;ut!==null;)a=ut,l=a.child,a.tag===22&&a.memoizedState!==null?kle(n):l!==null?(l.return=a,ut=l):kle(n);for(;s!==null;)ut=s,t2e(s),s=s.sibling;ut=n,yM=o,dl=c}Fle(e)}else(n.subtreeFlags&8772)!==0&&s!==null?(s.return=n,ut=s):Fle(e)}}function Fle(e){for(;ut!==null;){var t=ut;if((t.flags&8772)!==0){var r=t.alternate;try{if((t.flags&8772)!==0)switch(t.tag){case 0:case 11:case 15:dl||Zk(5,t);break;case 1:var i=t.stateNode;if(t.flags&4&&!dl)if(r===null)i.componentDidMount();else{var n=t.elementType===t.type?r.memoizedProps:Wf(t.type,r.memoizedProps);i.componentDidUpdate(n,r.memoizedState,i.__reactInternalSnapshotBeforeUpdate)}var s=t.updateQueue;s!==null&&vle(t,s,i);break;case 3:var a=t.updateQueue;if(a!==null){if(r=null,t.child!==null)switch(t.child.tag){case 5:r=t.child.stateNode;break;case 1:r=t.child.stateNode}vle(t,a,r)}break;case 5:var o=t.stateNode;if(r===null&&t.flags&4){r=o;var l=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":l.autoFocus&&r.focus();break;case"img":l.src&&(r.src=l.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(t.memoizedState===null){var c=t.alternate;if(c!==null){var u=c.memoizedState;if(u!==null){var h=u.dehydrated;h!==null&&z7(h)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(ke(163))}dl||t.flags&512&&zW(t)}catch(p){ms(t,t.return,p)}}if(t===e){ut=null;break}if(r=t.sibling,r!==null){r.return=t.return,ut=r;break}ut=t.return}}function Nle(e){for(;ut!==null;){var t=ut;if(t===e){ut=null;break}var r=t.sibling;if(r!==null){r.return=t.return,ut=r;break}ut=t.return}}function kle(e){for(;ut!==null;){var t=ut;try{switch(t.tag){case 0:case 11:case 15:var r=t.return;try{Zk(4,t)}catch(l){ms(t,r,l)}break;case 1:var i=t.stateNode;if(typeof i.componentDidMount=="function"){var n=t.return;try{i.componentDidMount()}catch(l){ms(t,n,l)}}var s=t.return;try{zW(t)}catch(l){ms(t,s,l)}break;case 5:var a=t.return;try{zW(t)}catch(l){ms(t,a,l)}}}catch(l){ms(t,t.return,l)}if(t===e){ut=null;break}var o=t.sibling;if(o!==null){o.return=t.return,ut=o;break}ut=t.return}}var vDe=Math.ceil,cF=Uy.ReactCurrentDispatcher,lte=Uy.ReactCurrentOwner,Vh=Uy.ReactCurrentBatchConfig,hi=0,lo=null,na=null,Po=0,Wd=0,o4=p_(0),$a=0,Q7=null,Sw=0,Qk=0,cte=0,NC=null,Wc=null,dte=0,C5=1/0,Ig=null,dF=!1,GW=null,Ev=null,bM=!1,ev=null,uF=0,kC=0,jW=null,L$=-1,D$=0;function rc(){return(hi&6)!==0?Fs():L$!==-1?L$:L$=Fs()}function Cv(e){return(e.mode&1)===0?1:(hi&2)!==0&&Po!==0?Po&-Po:rDe.transition!==null?(D$===0&&(D$=kve()),D$):(e=zi,e!==0||(e=window.event,e=e===void 0?16:qve(e.type)),e)}function xp(e,t,r,i){if(50<kC)throw kC=0,jW=null,Error(ke(185));FR(e,r,i),((hi&2)===0||e!==lo)&&(e===lo&&((hi&2)===0&&(Qk|=r),$a===4&&j1(e,Po)),ld(e,i),r===1&&hi===0&&(t.mode&1)===0&&(C5=Fs()+500,Wk&&m_()))}function ld(e,t){var r=e.callbackNode;rLe(e,t);var i=XD(e,e===lo?Po:0);if(i===0)r!==null&&Woe(r),e.callbackNode=null,e.callbackPriority=0;else if(t=i&-i,e.callbackPriority!==t){if(r!=null&&Woe(r),t===1)e.tag===0?tDe(Vle.bind(null,e)):d_e(Vle.bind(null,e)),QLe(function(){(hi&6)===0&&m_()}),r=null;else{switch(Vve(i)){case 1:r=Fee;break;case 4:r=Fve;break;case 16:r=WD;break;case 536870912:r=Nve;break;default:r=WD}r=c2e(r,r2e.bind(null,e))}e.callbackPriority=t,e.callbackNode=r}}function r2e(e,t){if(L$=-1,D$=0,(hi&6)!==0)throw Error(ke(327));var r=e.callbackNode;if(z4()&&e.callbackNode!==r)return null;var i=XD(e,e===lo?Po:0);if(i===0)return null;if((i&30)!==0||(i&e.expiredLanes)!==0||t)t=hF(e,i);else{t=i;var n=hi;hi|=2;var s=n2e();(lo!==e||Po!==t)&&(Ig=null,C5=Fs()+500,tw(e,t));do try{xDe();break}catch(o){i2e(e,o)}while(1);Yee(),cF.current=s,hi=n,na!==null?t=0:(lo=null,Po=0,t=$a)}if(t!==0){if(t===2&&(n=yW(e),n!==0&&(i=n,t=qW(e,n))),t===1)throw r=Q7,tw(e,0),j1(e,i),ld(e,Fs()),r;if(t===6)j1(e,i);else{if(n=e.current.alternate,(i&30)===0&&!_De(n)&&(t=hF(e,i),t===2&&(s=yW(e),s!==0&&(i=s,t=qW(e,s))),t===1))throw r=Q7,tw(e,0),j1(e,i),ld(e,Fs()),r;switch(e.finishedWork=n,e.finishedLanes=i,t){case 0:case 1:throw Error(ke(345));case 2:p2(e,Wc,Ig);break;case 3:if(j1(e,i),(i&130023424)===i&&(t=dte+500-Fs(),10<t)){if(XD(e,0)!==0)break;if(n=e.suspendedLanes,(n&i)!==i){rc(),e.pingedLanes|=e.suspendedLanes&n;break}e.timeoutHandle=EW(p2.bind(null,e,Wc,Ig),t);break}p2(e,Wc,Ig);break;case 4:if(j1(e,i),(i&4194240)===i)break;for(t=e.eventTimes,n=-1;0<i;){var a=31-wp(i);s=1<<a,a=t[a],a>n&&(n=a),i&=~s}if(i=n,i=Fs()-i,i=(120>i?120:480>i?480:1080>i?1080:1920>i?1920:3e3>i?3e3:4320>i?4320:1960*vDe(i/1960))-i,10<i){e.timeoutHandle=EW(p2.bind(null,e,Wc,Ig),i);break}p2(e,Wc,Ig);break;case 5:p2(e,Wc,Ig);break;default:throw Error(ke(329))}}}return ld(e,Fs()),e.callbackNode===r?r2e.bind(null,e):null}function qW(e,t){var r=NC;return e.current.memoizedState.isDehydrated&&(tw(e,t).flags|=256),e=hF(e,t),e!==2&&(t=Wc,Wc=r,t!==null&&HW(t)),e}function HW(e){Wc===null?Wc=e:Wc.push.apply(Wc,e)}function _De(e){for(var t=e;;){if(t.flags&16384){var r=t.updateQueue;if(r!==null&&(r=r.stores,r!==null))for(var i=0;i<r.length;i++){var n=r[i],s=n.getSnapshot;n=n.value;try{if(!Rp(s(),n))return!1}catch{return!1}}}if(r=t.child,t.subtreeFlags&16384&&r!==null)r.return=t,t=r;else{if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function j1(e,t){for(t&=~cte,t&=~Qk,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var r=31-wp(t),i=1<<r;e[r]=-1,t&=~i}}function Vle(e){if((hi&6)!==0)throw Error(ke(327));z4();var t=XD(e,0);if((t&1)===0)return ld(e,Fs()),null;var r=hF(e,t);if(e.tag!==0&&r===2){var i=yW(e);i!==0&&(t=i,r=qW(e,i))}if(r===1)throw r=Q7,tw(e,0),j1(e,t),ld(e,Fs()),r;if(r===6)throw Error(ke(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,p2(e,Wc,Ig),ld(e,Fs()),null}function ute(e,t){var r=hi;hi|=1;try{return e(t)}finally{hi=r,hi===0&&(C5=Fs()+500,Wk&&m_())}}function Ew(e){ev!==null&&ev.tag===0&&(hi&6)===0&&z4();var t=hi;hi|=1;var r=Vh.transition,i=zi;try{if(Vh.transition=null,zi=1,e)return e()}finally{zi=i,Vh.transition=r,hi=t,(hi&6)===0&&m_()}}function hte(){Wd=o4.current,An(o4)}function tw(e,t){e.finishedWork=null,e.finishedLanes=0;var r=e.timeoutHandle;if(r!==-1&&(e.timeoutHandle=-1,ZLe(r)),na!==null)for(r=na.return;r!==null;){var i=r;switch(Hee(i),i.tag){case 1:i=i.type.childContextTypes,i!=null&&KD();break;case 3:S5(),An(ad),An(bl),tte();break;case 5:ete(i);break;case 4:S5();break;case 13:An(qn);break;case 19:An(qn);break;case 10:Zee(i.type._context);break;case 22:case 23:hte()}r=r.return}if(lo=e,na=e=Av(e.current,null),Po=Wd=t,$a=0,Q7=null,cte=Qk=Sw=0,Wc=NC=null,D3!==null){for(t=0;t<D3.length;t++)if(r=D3[t],i=r.interleaved,i!==null){r.interleaved=null;var n=i.next,s=r.pending;if(s!==null){var a=s.next;s.next=n,i.next=a}r.pending=i}D3=null}return e}function i2e(e,t){do{var r=na;try{if(Yee(),P$.current=lF,oF){for(var i=Jn.memoizedState;i!==null;){var n=i.queue;n!==null&&(n.pending=null),i=i.next}oF=!1}if(Tw=0,eo=Ca=Jn=null,DC=!1,X7=0,lte.current=null,r===null||r.return===null){$a=1,Q7=t,na=null;break}e:{var s=e,a=r.return,o=r,l=t;if(t=Po,o.flags|=32768,l!==null&&typeof l=="object"&&typeof l.then=="function"){var c=l,u=o,h=u.tag;if((u.mode&1)===0&&(h===0||h===11||h===15)){var p=u.alternate;p?(u.updateQueue=p.updateQueue,u.memoizedState=p.memoizedState,u.lanes=p.lanes):(u.updateQueue=null,u.memoizedState=null)}var m=Cle(a);if(m!==null){m.flags&=-257,Ale(m,a,o,s,t),m.mode&1&&Ele(s,c,t),t=m,l=c;var g=t.updateQueue;if(g===null){var b=new Set;b.add(l),t.updateQueue=b}else g.add(l);break e}else{if((t&1)===0){Ele(s,c,t),fte();break e}l=Error(ke(426))}}else if($n&&o.mode&1){var w=Cle(a);if(w!==null){(w.flags&65536)===0&&(w.flags|=256),Ale(w,a,o,s,t),Wee(E5(l,o));break e}}s=l=E5(l,o),$a!==4&&($a=2),NC===null?NC=[s]:NC.push(s),s=a;do{switch(s.tag){case 3:s.flags|=65536,t&=-t,s.lanes|=t;var v=z_e(s,l,t);ble(s,v);break e;case 1:o=l;var x=s.type,T=s.stateNode;if((s.flags&128)===0&&(typeof x.getDerivedStateFromError=="function"||T!==null&&typeof T.componentDidCatch=="function"&&(Ev===null||!Ev.has(T)))){s.flags|=65536,t&=-t,s.lanes|=t;var E=U_e(s,o,t);ble(s,E);break e}}s=s.return}while(s!==null)}a2e(r)}catch(C){t=C,na===r&&r!==null&&(na=r=r.return);continue}break}while(1)}function n2e(){var e=cF.current;return cF.current=lF,e===null?lF:e}function fte(){($a===0||$a===3||$a===2)&&($a=4),lo===null||(Sw&268435455)===0&&(Qk&268435455)===0||j1(lo,Po)}function hF(e,t){var r=hi;hi|=2;var i=n2e();(lo!==e||Po!==t)&&(Ig=null,tw(e,t));do try{wDe();break}catch(n){i2e(e,n)}while(1);if(Yee(),hi=r,cF.current=i,na!==null)throw Error(ke(261));return lo=null,Po=0,$a}function wDe(){for(;na!==null;)s2e(na)}function xDe(){for(;na!==null&&!W$e();)s2e(na)}function s2e(e){var t=l2e(e.alternate,e,Wd);e.memoizedProps=e.pendingProps,t===null?a2e(e):na=t,lte.current=null}function a2e(e){var t=e;do{var r=t.alternate;if(e=t.return,(t.flags&32768)===0){if(r=pDe(r,t,Wd),r!==null){na=r;return}}else{if(r=mDe(r,t),r!==null){r.flags&=32767,na=r;return}if(e!==null)e.flags|=32768,e.subtreeFlags=0,e.deletions=null;else{$a=6,na=null;return}}if(t=t.sibling,t!==null){na=t;return}na=t=e}while(t!==null);$a===0&&($a=5)}function p2(e,t,r){var i=zi,n=Vh.transition;try{Vh.transition=null,zi=1,TDe(e,t,r,i)}finally{Vh.transition=n,zi=i}return null}function TDe(e,t,r,i){do z4();while(ev!==null);if((hi&6)!==0)throw Error(ke(327));r=e.finishedWork;var n=e.finishedLanes;if(r===null)return null;if(e.finishedWork=null,e.finishedLanes=0,r===e.current)throw Error(ke(177));e.callbackNode=null,e.callbackPriority=0;var s=r.lanes|r.childLanes;if(iLe(e,s),e===lo&&(na=lo=null,Po=0),(r.subtreeFlags&2064)===0&&(r.flags&2064)===0||bM||(bM=!0,c2e(WD,function(){return z4(),null})),s=(r.flags&15990)!==0,(r.subtreeFlags&15990)!==0||s){s=Vh.transition,Vh.transition=null;var a=zi;zi=1;var o=hi;hi|=4,lte.current=null,yDe(e,r),e2e(r,e),GLe(TW),YD=!!xW,TW=xW=null,e.current=r,bDe(r),X$e(),hi=o,zi=a,Vh.transition=s}else e.current=r;if(bM&&(bM=!1,ev=e,uF=n),s=e.pendingLanes,s===0&&(Ev=null),Q$e(r.stateNode),ld(e,Fs()),t!==null)for(i=e.onRecoverableError,r=0;r<t.length;r++)n=t[r],i(n.value,{componentStack:n.stack,digest:n.digest});if(dF)throw dF=!1,e=GW,GW=null,e;return(uF&1)!==0&&e.tag!==0&&z4(),s=e.pendingLanes,(s&1)!==0?e===jW?kC++:(kC=0,jW=e):kC=0,m_(),null}function z4(){if(ev!==null){var e=Vve(uF),t=Vh.transition,r=zi;try{if(Vh.transition=null,zi=16>e?16:e,ev===null)var i=!1;else{if(e=ev,ev=null,uF=0,(hi&6)!==0)throw Error(ke(331));var n=hi;for(hi|=4,ut=e.current;ut!==null;){var s=ut,a=s.child;if((ut.flags&16)!==0){var o=s.deletions;if(o!==null){for(var l=0;l<o.length;l++){var c=o[l];for(ut=c;ut!==null;){var u=ut;switch(u.tag){case 0:case 11:case 15:FC(8,u,s)}var h=u.child;if(h!==null)h.return=u,ut=h;else for(;ut!==null;){u=ut;var p=u.sibling,m=u.return;if(Q_e(u),u===c){ut=null;break}if(p!==null){p.return=m,ut=p;break}ut=m}}}var g=s.alternate;if(g!==null){var b=g.child;if(b!==null){g.child=null;do{var w=b.sibling;b.sibling=null,b=w}while(b!==null)}}ut=s}}if((s.subtreeFlags&2064)!==0&&a!==null)a.return=s,ut=a;else e:for(;ut!==null;){if(s=ut,(s.flags&2048)!==0)switch(s.tag){case 0:case 11:case 15:FC(9,s,s.return)}var v=s.sibling;if(v!==null){v.return=s.return,ut=v;break e}ut=s.return}}var x=e.current;for(ut=x;ut!==null;){a=ut;var T=a.child;if((a.subtreeFlags&2064)!==0&&T!==null)T.return=a,ut=T;else e:for(a=x;ut!==null;){if(o=ut,(o.flags&2048)!==0)try{switch(o.tag){case 0:case 11:case 15:Zk(9,o)}}catch(C){ms(o,o.return,C)}if(o===a){ut=null;break e}var E=o.sibling;if(E!==null){E.return=o.return,ut=E;break e}ut=o.return}}if(hi=n,m_(),J0&&typeof J0.onPostCommitFiberRoot=="function")try{J0.onPostCommitFiberRoot(Bk,e)}catch{}i=!0}return i}finally{zi=r,Vh.transition=t}}return!1}function zle(e,t,r){t=E5(r,t),t=z_e(e,t,1),e=Sv(e,t,1),t=rc(),e!==null&&(FR(e,1,t),ld(e,t))}function ms(e,t,r){if(e.tag===3)zle(e,e,r);else for(;t!==null;){if(t.tag===3){zle(t,e,r);break}else if(t.tag===1){var i=t.stateNode;if(typeof t.type.getDerivedStateFromError=="function"||typeof i.componentDidCatch=="function"&&(Ev===null||!Ev.has(i))){e=E5(r,e),e=U_e(t,e,1),t=Sv(t,e,1),e=rc(),t!==null&&(FR(t,1,e),ld(t,e));break}}t=t.return}}function SDe(e,t,r){var i=e.pingCache;i!==null&&i.delete(t),t=rc(),e.pingedLanes|=e.suspendedLanes&r,lo===e&&(Po&r)===r&&($a===4||$a===3&&(Po&130023424)===Po&&500>Fs()-dte?tw(e,0):cte|=r),ld(e,t)}function o2e(e,t){t===0&&((e.mode&1)===0?t=1:(t=lM,lM<<=1,(lM&130023424)===0&&(lM=4194304)));var r=rc();e=Sy(e,t),e!==null&&(FR(e,t,r),ld(e,r))}function EDe(e){var t=e.memoizedState,r=0;t!==null&&(r=t.retryLane),o2e(e,r)}function CDe(e,t){var r=0;switch(e.tag){case 13:var i=e.stateNode,n=e.memoizedState;n!==null&&(r=n.retryLane);break;case 19:i=e.stateNode;break;default:throw Error(ke(314))}i!==null&&i.delete(t),o2e(e,r)}var l2e;l2e=function(e,t,r){if(e!==null)if(e.memoizedProps!==t.pendingProps||ad.current)Kc=!0;else{if((e.lanes&r)===0&&(t.flags&128)===0)return Kc=!1,fDe(e,t,r);Kc=(e.flags&131072)!==0}else Kc=!1,$n&&(t.flags&1048576)!==0&&u_e(t,rF,t.index);switch(t.lanes=0,t.tag){case 2:var i=t.type;$$(e,t),e=t.pendingProps;var n=w5(t,bl.current);V4(t,r),n=ite(null,t,i,e,n,r);var s=nte();return t.flags|=1,typeof n=="object"&&n!==null&&typeof n.render=="function"&&n.$$typeof===void 0?(t.tag=1,t.memoizedState=null,t.updateQueue=null,od(i)?(s=!0,eF(t)):s=!1,t.memoizedState=n.state!==null&&n.state!==void 0?n.state:null,Jee(t),n.updater=Xk,t.stateNode=n,n._reactInternals=t,IW(t,i,e,r),t=DW(null,t,i,!0,s,r)):(t.tag=0,$n&&s&&qee(t),Hl(null,t,n,r),t=t.child),t;case 16:i=t.elementType;e:{switch($$(e,t),e=t.pendingProps,n=i._init,i=n(i._payload),t.type=i,n=t.tag=RDe(i),e=Wf(i,e),n){case 0:t=LW(null,t,i,e,r);break e;case 1:t=Mle(null,t,i,e,r);break e;case 11:t=Rle(null,t,i,e,r);break e;case 14:t=Ole(null,t,i,Wf(i.type,e),r);break e}throw Error(ke(306,i,""))}return t;case 0:return i=t.type,n=t.pendingProps,n=t.elementType===i?n:Wf(i,n),LW(e,t,i,n,r);case 1:return i=t.type,n=t.pendingProps,n=t.elementType===i?n:Wf(i,n),Mle(e,t,i,n,r);case 3:e:{if(q_e(t),e===null)throw Error(ke(387));i=t.pendingProps,s=t.memoizedState,n=s.element,m_e(e,t),sF(t,i,null,r);var a=t.memoizedState;if(i=a.element,s.isDehydrated)if(s={element:i,isDehydrated:!1,cache:a.cache,pendingSuspenseBoundaries:a.pendingSuspenseBoundaries,transitions:a.transitions},t.updateQueue.baseState=s,t.memoizedState=s,t.flags&256){n=E5(Error(ke(423)),t),t=Ple(e,t,i,r,n);break e}else if(i!==n){n=E5(Error(ke(424)),t),t=Ple(e,t,i,r,n);break e}else for(cu=Tv(t.stateNode.containerInfo.firstChild),fu=t,$n=!0,tp=null,r=v_e(t,null,i,r),t.child=r;r;)r.flags=r.flags&-3|4096,r=r.sibling;else{if(x5(),i===n){t=Ey(e,t,r);break e}Hl(e,t,i,r)}t=t.child}return t;case 5:return __e(t),e===null&&OW(t),i=t.type,n=t.pendingProps,s=e!==null?e.memoizedProps:null,a=n.children,SW(i,n)?a=null:s!==null&&SW(i,s)&&(t.flags|=32),j_e(e,t),Hl(e,t,a,r),t.child;case 6:return e===null&&OW(t),null;case 13:return H_e(e,t,r);case 4:return Kee(t,t.stateNode.containerInfo),i=t.pendingProps,e===null?t.child=T5(t,null,i,r):Hl(e,t,i,r),t.child;case 11:return i=t.type,n=t.pendingProps,n=t.elementType===i?n:Wf(i,n),Rle(e,t,i,n,r);case 7:return Hl(e,t,t.pendingProps,r),t.child;case 8:return Hl(e,t,t.pendingProps.children,r),t.child;case 12:return Hl(e,t,t.pendingProps.children,r),t.child;case 10:e:{if(i=t.type._context,n=t.pendingProps,s=t.memoizedProps,a=n.value,un(iF,i._currentValue),i._currentValue=a,s!==null)if(Rp(s.value,a)){if(s.children===n.children&&!ad.current){t=Ey(e,t,r);break e}}else for(s=t.child,s!==null&&(s.return=t);s!==null;){var o=s.dependencies;if(o!==null){a=s.child;for(var l=o.firstContext;l!==null;){if(l.context===i){if(s.tag===1){l=sy(-1,r&-r),l.tag=2;var c=s.updateQueue;if(c!==null){c=c.shared;var u=c.pending;u===null?l.next=l:(l.next=u.next,u.next=l),c.pending=l}}s.lanes|=r,l=s.alternate,l!==null&&(l.lanes|=r),MW(s.return,r,t),o.lanes|=r;break}l=l.next}}else if(s.tag===10)a=s.type===t.type?null:s.child;else if(s.tag===18){if(a=s.return,a===null)throw Error(ke(341));a.lanes|=r,o=a.alternate,o!==null&&(o.lanes|=r),MW(a,r,t),a=s.sibling}else a=s.child;if(a!==null)a.return=s;else for(a=s;a!==null;){if(a===t){a=null;break}if(s=a.sibling,s!==null){s.return=a.return,a=s;break}a=a.return}s=a}Hl(e,t,n.children,r),t=t.child}return t;case 9:return n=t.type,i=t.pendingProps.children,V4(t,r),n=Gh(n),i=i(n),t.flags|=1,Hl(e,t,i,r),t.child;case 14:return i=t.type,n=Wf(i,t.pendingProps),n=Wf(i.type,n),Ole(e,t,i,n,r);case 15:return B_e(e,t,t.type,t.pendingProps,r);case 17:return i=t.type,n=t.pendingProps,n=t.elementType===i?n:Wf(i,n),$$(e,t),t.tag=1,od(i)?(e=!0,eF(t)):e=!1,V4(t,r),y_e(t,i,n),IW(t,i,n,r),DW(null,t,i,!0,e,r);case 19:return W_e(e,t,r);case 22:return G_e(e,t,r)}throw Error(ke(156,t.tag))};function c2e(e,t){return Dve(e,t)}function ADe(e,t,r,i){this.tag=e,this.key=r,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=i,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Dh(e,t,r,i){return new ADe(e,t,r,i)}function pte(e){return e=e.prototype,!(!e||!e.isReactComponent)}function RDe(e){if(typeof e=="function")return pte(e)?1:0;if(e!=null){if(e=e.$$typeof,e===$ee)return 11;if(e===Lee)return 14}return 2}function Av(e,t){var r=e.alternate;return r===null?(r=Dh(e.tag,t,e.key,e.mode),r.elementType=e.elementType,r.type=e.type,r.stateNode=e.stateNode,r.alternate=e,e.alternate=r):(r.pendingProps=t,r.type=e.type,r.flags=0,r.subtreeFlags=0,r.deletions=null),r.flags=e.flags&14680064,r.childLanes=e.childLanes,r.lanes=e.lanes,r.child=e.child,r.memoizedProps=e.memoizedProps,r.memoizedState=e.memoizedState,r.updateQueue=e.updateQueue,t=e.dependencies,r.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext},r.sibling=e.sibling,r.index=e.index,r.ref=e.ref,r}function F$(e,t,r,i,n,s){var a=2;if(i=e,typeof e=="function")pte(e)&&(a=1);else if(typeof e=="string")a=5;else e:switch(e){case QS:return rw(r.children,n,s,t);case Iee:a=8,n|=8;break;case rW:return e=Dh(12,r,t,n|2),e.elementType=rW,e.lanes=s,e;case iW:return e=Dh(13,r,t,n),e.elementType=iW,e.lanes=s,e;case nW:return e=Dh(19,r,t,n),e.elementType=nW,e.lanes=s,e;case bve:return Jk(r,n,s,t);default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case gve:a=10;break e;case yve:a=9;break e;case $ee:a=11;break e;case Lee:a=14;break e;case O1:a=16,i=null;break e}throw Error(ke(130,e==null?e:typeof e,""))}return t=Dh(a,r,t,n),t.elementType=e,t.type=i,t.lanes=s,t}function rw(e,t,r,i){return e=Dh(7,e,i,t),e.lanes=r,e}function Jk(e,t,r,i){return e=Dh(22,e,i,t),e.elementType=bve,e.lanes=r,e.stateNode={isHidden:!1},e}function zB(e,t,r){return e=Dh(6,e,null,t),e.lanes=r,e}function UB(e,t,r){return t=Dh(4,e.children!==null?e.children:[],e.key,t),t.lanes=r,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function ODe(e,t,r,i,n){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=wB(0),this.expirationTimes=wB(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=wB(0),this.identifierPrefix=i,this.onRecoverableError=n,this.mutableSourceEagerHydrationData=null}function mte(e,t,r,i,n,s,a,o,l){return e=new ODe(e,t,r,o,l),t===1?(t=1,s===!0&&(t|=8)):t=0,s=Dh(3,null,null,t),e.current=s,s.stateNode=e,s.memoizedState={element:i,isDehydrated:r,cache:null,transitions:null,pendingSuspenseBoundaries:null},Jee(s),e}function MDe(e,t,r){var i=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:ZS,key:i==null?null:""+i,children:e,containerInfo:t,implementation:r}}function d2e(e){if(!e)return Bv;e=e._reactInternals;e:{if(px(e)!==e||e.tag!==1)throw Error(ke(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(od(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(t!==null);throw Error(ke(171))}if(e.tag===1){var r=e.type;if(od(r))return c_e(e,r,t)}return t}function u2e(e,t,r,i,n,s,a,o,l){return e=mte(r,i,!0,e,n,s,a,o,l),e.context=d2e(null),r=e.current,i=rc(),n=Cv(r),s=sy(i,n),s.callback=t!=null?t:null,Sv(r,s,n),e.current.lanes=n,FR(e,n,i),ld(e,i),e}function Kk(e,t,r,i){var n=t.current,s=rc(),a=Cv(n);return r=d2e(r),t.context===null?t.context=r:t.pendingContext=r,t=sy(s,a),t.payload={element:e},i=i===void 0?null:i,i!==null&&(t.callback=i),e=Sv(n,t,a),e!==null&&(xp(e,n,a,s),M$(e,n,a)),a}function fF(e){if(e=e.current,!e.child)return null;switch(e.child.tag){case 5:return e.child.stateNode;default:return e.child.stateNode}}function Ule(e,t){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var r=e.retryLane;e.retryLane=r!==0&&r<t?r:t}}function gte(e,t){Ule(e,t),(e=e.alternate)&&Ule(e,t)}function PDe(){return null}var h2e=typeof reportError=="function"?reportError:function(e){console.error(e)};function yte(e){this._internalRoot=e}eV.prototype.render=yte.prototype.render=function(e){var t=this._internalRoot;if(t===null)throw Error(ke(409));Kk(e,t,null,null)};eV.prototype.unmount=yte.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var t=e.containerInfo;Ew(function(){Kk(null,e,null,null)}),t[Ty]=null}};function eV(e){this._internalRoot=e}eV.prototype.unstable_scheduleHydration=function(e){if(e){var t=Bve();e={blockedOn:null,target:e,priority:t};for(var r=0;r<G1.length&&t!==0&&t<G1[r].priority;r++);G1.splice(r,0,e),r===0&&jve(e)}};function bte(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function tV(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11&&(e.nodeType!==8||e.nodeValue!==" react-mount-point-unstable "))}function Ble(){}function IDe(e,t,r,i,n){if(n){if(typeof i=="function"){var s=i;i=function(){var c=fF(a);s.call(c)}}var a=u2e(t,i,e,0,null,!1,!1,"",Ble);return e._reactRootContainer=a,e[Ty]=a.current,G7(e.nodeType===8?e.parentNode:e),Ew(),a}for(;n=e.lastChild;)e.removeChild(n);if(typeof i=="function"){var o=i;i=function(){var c=fF(l);o.call(c)}}var l=mte(e,0,!1,null,null,!1,!1,"",Ble);return e._reactRootContainer=l,e[Ty]=l.current,G7(e.nodeType===8?e.parentNode:e),Ew(function(){Kk(t,l,r,i)}),l}function rV(e,t,r,i,n){var s=r._reactRootContainer;if(s){var a=s;if(typeof n=="function"){var o=n;n=function(){var l=fF(a);o.call(l)}}Kk(t,a,e,n)}else a=IDe(r,t,e,n,i);return fF(a)}zve=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var r=tE(t.pendingLanes);r!==0&&(Nee(t,r|1),ld(t,Fs()),(hi&6)===0&&(C5=Fs()+500,m_()))}break;case 13:Ew(function(){var i=Sy(e,1);if(i!==null){var n=rc();xp(i,e,1,n)}}),gte(e,1)}};kee=function(e){if(e.tag===13){var t=Sy(e,134217728);if(t!==null){var r=rc();xp(t,e,134217728,r)}gte(e,134217728)}};Uve=function(e){if(e.tag===13){var t=Cv(e),r=Sy(e,t);if(r!==null){var i=rc();xp(r,e,t,i)}gte(e,t)}};Bve=function(){return zi};Gve=function(e,t){var r=zi;try{return zi=e,t()}finally{zi=r}};pW=function(e,t,r){switch(t){case"input":if(oW(e,r),t=r.name,r.type==="radio"&&t!=null){for(r=e;r.parentNode;)r=r.parentNode;for(r=r.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<r.length;t++){var i=r[t];if(i!==e&&i.form===e.form){var n=Hk(i);if(!n)throw Error(ke(90));_ve(i),oW(i,n)}}}break;case"textarea":xve(e,r);break;case"select":t=r.value,t!=null&&D4(e,!!r.multiple,t,!1)}};Ove=ute;Mve=Ew;var $De={usingClientEntryPoint:!1,Events:[kR,t4,Hk,Ave,Rve,ute]},L6={findFiberByHostInstance:L3,bundleType:0,version:"18.2.0",rendererPackageName:"react-dom"},LDe={bundleType:L6.bundleType,version:L6.version,rendererPackageName:L6.rendererPackageName,rendererConfig:L6.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Uy.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return e=$ve(e),e===null?null:e.stateNode},findFiberByHostInstance:L6.findFiberByHostInstance||PDe,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.2.0-next-9e3b772b8-20220608"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var vM=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!vM.isDisabled&&vM.supportsFiber)try{Bk=vM.inject(LDe),J0=vM}catch{}}Pu.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=$De;Pu.createPortal=function(e,t){var r=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!bte(t))throw Error(ke(200));return MDe(e,t,null,r)};Pu.createRoot=function(e,t){if(!bte(e))throw Error(ke(299));var r=!1,i="",n=h2e;return t!=null&&(t.unstable_strictMode===!0&&(r=!0),t.identifierPrefix!==void 0&&(i=t.identifierPrefix),t.onRecoverableError!==void 0&&(n=t.onRecoverableError)),t=mte(e,1,!1,null,null,r,!1,i,n),e[Ty]=t.current,G7(e.nodeType===8?e.parentNode:e),new yte(t)};Pu.findDOMNode=function(e){if(e==null)return null;if(e.nodeType===1)return e;var t=e._reactInternals;if(t===void 0)throw typeof e.render=="function"?Error(ke(188)):(e=Object.keys(e).join(","),Error(ke(268,e)));return e=$ve(t),e=e===null?null:e.stateNode,e};Pu.flushSync=function(e){return Ew(e)};Pu.hydrate=function(e,t,r){if(!tV(t))throw Error(ke(200));return rV(null,e,t,!0,r)};Pu.hydrateRoot=function(e,t,r){if(!bte(e))throw Error(ke(405));var i=r!=null&&r.hydratedSources||null,n=!1,s="",a=h2e;if(r!=null&&(r.unstable_strictMode===!0&&(n=!0),r.identifierPrefix!==void 0&&(s=r.identifierPrefix),r.onRecoverableError!==void 0&&(a=r.onRecoverableError)),t=u2e(t,null,e,1,r!=null?r:null,n,!1,s,a),e[Ty]=t.current,G7(e),i)for(e=0;e<i.length;e++)r=i[e],n=r._getVersion,n=n(r._source),t.mutableSourceEagerHydrationData==null?t.mutableSourceEagerHydrationData=[r,n]:t.mutableSourceEagerHydrationData.push(r,n);return new eV(t)};Pu.render=function(e,t,r){if(!tV(t))throw Error(ke(200));return rV(null,e,t,!1,r)};Pu.unmountComponentAtNode=function(e){if(!tV(e))throw Error(ke(40));return e._reactRootContainer?(Ew(function(){rV(null,null,e,!1,function(){e._reactRootContainer=null,e[Ty]=null})}),!0):!1};Pu.unstable_batchedUpdates=ute;Pu.unstable_renderSubtreeIntoContainer=function(e,t,r,i){if(!tV(r))throw Error(ke(200));if(e==null||e._reactInternals===void 0)throw Error(ke(38));return rV(e,t,r,!1,i)};Pu.version="18.2.0-next-9e3b772b8-20220608";(function(e){function t(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(t)}catch(r){console.error(r)}}t(),e.exports=Pu})(uve);var Gle=uve.exports;eW.createRoot=Gle.createRoot,eW.hydrateRoot=Gle.hydrateRoot;function d(e,t,r,i){var n,s=arguments.length,a=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,r):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(e,t,r,i);else for(var o=e.length-1;o>=0;o--)(n=e[o])&&(a=(s<3?n(a):s>3?n(t,r,a):n(t,r))||a);return s>3&&a&&Object.defineProperty(t,r,a),a}const DDe="modulepreload",FDe=function(e,t){return new URL(e,t).href},jle={},ie=function(t,r,i){return!r||r.length===0?t():Promise.all(r.map(n=>{if(n=FDe(n,i),n in jle)return;jle[n]=!0;const s=n.endsWith(".css"),a=s?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${n}"]${a}`))return;const o=document.createElement("link");if(o.rel=s?"stylesheet":DDe,s||(o.as="script",o.crossOrigin=""),o.href=n,document.head.appendChild(o),s)return new Promise((l,c)=>{o.addEventListener("load",l),o.addEventListener("error",()=>c(new Error(`Unable to preload CSS for ${n}`)))})})).then(()=>t())};function NDe(e){return e&&e.release&&typeof e.release=="function"}function kDe(e){return e&&e.acquire&&typeof e.acquire=="function"}class Fn{constructor(t,r,i,n=1,s=0){if(this.ctor=t,this.acquireFunction=r,this.releaseFunction=i,this.allocationSize=n,this._pool=new Array(s),this._initialSize=s,this.ctor)for(let a=0;a<s;a++)this._pool[a]=new this.ctor;this.allocationSize=Math.max(n,1)}destroy(){this.prune(0)}acquire(...t){let r;if(Fn.test.disabled)r=new this.ctor;else{if(this._pool.length===0){const i=this.allocationSize;for(let n=0;n<i;n++)this._pool[n]=new this.ctor}r=this._pool.pop()}return this.acquireFunction?this.acquireFunction(r,...t):kDe(r)&&r.acquire(...t),r}release(t){t&&!Fn.test.disabled&&(this.releaseFunction?this.releaseFunction(t):NDe(t)&&t.release(),this._pool.push(t))}prune(t=this._initialSize){if(!(t>=this._pool.length)){for(let r=t;r<this._pool.length;++r){const i=this._pool[r];this._dispose(i)}this._pool.length=t}}_dispose(t){t.dispose&&typeof t.dispose=="function"&&t.dispose()}}Fn.test={disabled:!1};function VDe(e){e.length=0}class Xc{constructor(t=50,r=50){this._pool=new Fn(Array,void 0,VDe,r,t)}acquire(){return this._pool.acquire()}release(t){this._pool.release(t)}prune(){this._pool.prune(0)}static acquire(){return BB.acquire()}static release(t){return BB.release(t)}static prune(){BB.prune()}}const BB=new Xc(100);function wPt(e){const t=[];return function*(){yield*t;for(const r of e)t.push(r),yield r}}function xPt(e,t){for(const r of e)if(r!=null&&t(r))return r}function f2e(e){return e!=null&&typeof e[Symbol.iterator]=="function"}const m2=null;function _(e){return e!=null}function R(e){return e==null}function ys(e,t){return _(e)?t(e):m2}function TPt(e){return e}function zDe(e,t){if(R(e))throw new Error(t);return e}function vt(e,t){return _(e)?e:typeof t=="function"?t():t}function SPt(e,t){return _(e)?e:t}function ct(e){return _(e)&&e.destroy(),null}function Qe(e){return _(e)&&e.dispose(),null}function Ts(e){return _(e)&&e.remove(),null}function qh(e){return _(e)&&e.abort(),null}function ri(e){return _(e)&&e.release(),null}function UDe(e,t,r){return _(e)&&_(t)?_(r)?r(e,t):e.equals(t):e===t}function BDe(e){return null}function EPt(e,t){const r=new Array;return e.forEach(i=>{const n=t(i);_(n)&&r.push(n)}),r}function CPt(e,t){const r=new Array;for(const i of e)r.push(tu(i,null,t));return r}function APt(e,t){for(const r of e)ys(r,t)}function tu(e,t,r){return _(e)?r(e):t}function RPt(e){return e.filter(t=>_(t))}function Vi(e,...t){let r=e;for(let i=0;i<t.length&&r;++i)r=r[t[i]];return r}function OPt(e){return e}function A5(e){return Hh(()=>e.forEach(t=>_(t)&&t.remove()))}function Hh(e){return{remove:()=>{e&&(e(),e=void 0)}}}function MPt(e){return Hh(_(e)?()=>e.destroy():void 0)}function GDe(e,t){const r=setTimeout(e,t);return Hh(()=>clearTimeout(r))}class Sh{constructor(t=1){this._seed=t}set seed(t){this._seed=t==null?Math.random()*Sh._m:t}getInt(){return this._seed=(Sh._a*this._seed+Sh._c)%Sh._m,this._seed}getFloat(){return this.getInt()/(Sh._m-1)}getIntRange(t,r){return Math.round(this.getFloatRange(t,r))}getFloatRange(t,r){const i=r-t;return t+this.getInt()/Sh._m*i}}Sh._m=2147483647,Sh._a=48271,Sh._c=0;function zR(e,t){return t?e.filter((r,i,n)=>n.findIndex(t.bind(null,r))===i):e.filter((r,i,n)=>n.indexOf(r)===i)}function Gv(e,t,r){if(R(e)&&R(t))return!0;if(R(e)||R(t)||e.length!==t.length)return!1;if(r){for(let i=0;i<e.length;i++)if(!r(e[i],t[i]))return!1}else for(let i=0;i<e.length;i++)if(e[i]!==t[i])return!1;return!0}function vte(e,t){let r=e.length!==t.length;e.length=t.length;for(let i=0;i<t.length;++i)e[i]!==t[i]&&(e[i]=t[i],r=!0);return r}function jDe(e,t,r){let i,n;return r?(i=t.filter(s=>!e.some(a=>r(a,s))),n=e.filter(s=>!t.some(a=>r(a,s)))):(i=t.filter(s=>!e.includes(s)),n=e.filter(s=>!t.includes(s))),{added:i,removed:n}}function qDe(e){return e&&typeof e.length=="number"}function HDe(e,t){const r=e.length;if(r===0)return[];const i=[];for(let n=0;n<r;n+=t)i.push(e.slice(n,n+t));return i}const WDe=!!Array.prototype.fill;function PPt(e,t){if(WDe)return new Array(e).fill(t);const r=new Array(e);for(let i=0;i<e;i++)r[i]=t;return r}function XDe(e,t){t===void 0&&(t=e,e=0);const r=new Array(t-e);for(let i=e;i<t;i++)r[i-e]=i;return r}function p2e(e,t,r){const i=e.length;let n=0,s=i-1;for(;n<s;){const o=n+Math.floor((s-n)/2);t>e[o]?n=o+1:s=o}const a=e[n];return r?t>=e[i-1]?-1:a===t?n:n-1:a===t?n:-1}function m2e(e){return e.reduce((t,r)=>t.concat(r||[]),[])}class g2e{constructor(){this.last=0}}const y2e=new g2e;function b2e(e,t,r,i){i=i||y2e;const n=Math.max(0,i.last-10);for(let a=n;a<r;++a)if(e[a]===t)return i.last=a,a;const s=Math.min(n,r);for(let a=0;a<s;++a)if(e[a]===t)return i.last=a,a;return-1}function iV(e,t,r,i){const n=r==null?e.length:r,s=b2e(e,t,n,i);if(s!==-1)return e[s]=e[n-1],r==null&&e.pop(),t}const uf=new Set;function YDe(e,t,r=e.length,i=t.length,n,s){if(i===0||r===0)return r;uf.clear();for(let o=0;o<i;++o)uf.add(t[o]);n=n||y2e;const a=Math.max(0,n.last-10);for(let o=a;o<r;++o)if(uf.has(e[o])&&(s&&s.push(e[o]),uf.delete(e[o]),e[o]=e[r-1],--r,--o,uf.size===0||r===0))return uf.clear(),r;for(let o=0;o<a;++o)if(uf.has(e[o])&&(s&&s.push(e[o]),uf.delete(e[o]),e[o]=e[r-1],--r,--o,uf.size===0||r===0))return uf.clear(),r;return uf.clear(),r}function J7(e,t,r){const i=e.length;if(t>=i)return e.slice(0);const n=v2e(r),s=new Set,a=[];for(;a.length<t;){const o=Math.floor(n()*i);s.has(o)||(s.add(o),a.push(e[o]))}return a}function v2e(e){return e?(qle.seed=e,()=>qle.getFloat()):Math.random}function IPt(e,t){const r=v2e(t);for(let i=e.length-1;i>0;i--){const n=Math.floor(r()*(i+1)),s=e[i];e[i]=e[n],e[n]=s}return e}const qle=new Sh;function _te(e,t){const r=e.indexOf(t);return r!==-1?(e.splice(r,1),t):null}let tv;function ue(e){return typeof tv[e]=="function"?tv[e]=tv[e](globalThis):tv[e]}var Y1e,Z1e,Q1e,J1e;tv=((Y1e=globalThis.dojoConfig)==null?void 0:Y1e.has)||((Z1e=globalThis.esriConfig)==null?void 0:Z1e.has)?{...(Q1e=globalThis.dojoConfig)==null?void 0:Q1e.has,...(J1e=globalThis.esriConfig)==null?void 0:J1e.has}:{},ue.add=(e,t,r,i)=>((i||tv[e]===void 0)&&(tv[e]=t),r&&ue(e)),ue.cache=tv,ue.add("esri-deprecation-warnings",!0),(()=>{var t;ue.add("host-webworker",globalThis.WorkerGlobalScope!==void 0&&self instanceof globalThis.WorkerGlobalScope);const e=typeof window<"u"&&typeof location<"u"&&typeof document<"u"&&window.location===location&&window.document===document;if(ue.add("host-browser",e),ue.add("host-node",typeof globalThis.process=="object"&&((t=globalThis.process.versions)==null?void 0:t.node)&&globalThis.process.versions.v8),ue.add("dom",e),ue("host-browser")){const r=navigator,i=r.userAgent,n=r.appVersion,s=parseFloat(n);if(ue.add("wp",parseFloat(i.split("Windows Phone")[1])||void 0),ue.add("msapp",parseFloat(i.split("MSAppHost/")[1])||void 0),ue.add("khtml",n.includes("Konqueror")?s:void 0),ue.add("edge",parseFloat(i.split("Edge/")[1])||void 0),ue.add("opr",parseFloat(i.split("OPR/")[1])||void 0),ue.add("webkit",!ue("wp")&&!ue("edge")&&parseFloat(i.split("WebKit/")[1])||void 0),ue.add("chrome",!ue("edge")&&!ue("opr")&&parseFloat(i.split("Chrome/")[1])||void 0),ue.add("android",!ue("wp")&&parseFloat(i.split("Android ")[1])||void 0),ue.add("safari",!n.includes("Safari")||ue("wp")||ue("chrome")||ue("android")||ue("edge")||ue("opr")?void 0:parseFloat(n.split("Version/")[1])),ue.add("mac",n.includes("Macintosh")),!ue("wp")&&i.match(/(iPhone|iPod|iPad)/)){const a=RegExp.$1.replace(/P/,"p"),o=i.match(/OS ([\d_]+)/)?RegExp.$1:"1",l=parseFloat(o.replace(/_/,".").replace(/_/g,""));ue.add(a,l),ue.add("ios",l)}ue.add("trident",parseFloat(n.split("Trident/")[1])||void 0),ue("webkit")||(!i.includes("Gecko")||ue("wp")||ue("khtml")||ue("trident")||ue("edge")||ue.add("mozilla",s),ue("mozilla")&&ue.add("ff",parseFloat(i.split("Firefox/")[1]||i.split("Minefield/")[1])||void 0))}})(),(()=>{if(globalThis.navigator){const e=navigator.userAgent,t=/Android|webOS|iPhone|iPad|iPod|BlackBerry|Opera Mini|IEMobile/i.test(e),r=/iPhone/i.test(e);t&&ue.add("esri-mobile",t),r&&ue.add("esri-iPhone",r),ue.add("esri-geolocation",!!navigator.geolocation)}ue.add("esri-canvas-svg-support",!ue("trident")),ue.add("esri-wasm","WebAssembly"in globalThis),ue.add("esri-shared-array-buffer",()=>{const e="SharedArrayBuffer"in globalThis,t=globalThis.crossOriginIsolated===!1;return e&&!t}),ue.add("wasm-simd",()=>{const e=[0,97,115,109,1,0,0,0,1,5,1,96,0,1,123,3,2,1,0,10,10,1,8,0,65,0,253,15,253,98,11];return WebAssembly.validate(new Uint8Array(e))}),ue.add("esri-atomics","Atomics"in globalThis),ue.add("esri-workers","Worker"in globalThis),ue.add("web-feat:cache","caches"in globalThis),ue.add("esri-workers-arraybuffer-transfer",!ue("safari")||Number(ue("safari"))>=12),ue.add("featurelayer-simplify-thresholds",[.5,.5,.5,.5]),ue.add("featurelayer-simplify-payload-size-factors",[1,1,4]),ue.add("featurelayer-snapshot-enabled",!0),ue.add("featurelayer-snapshot-point-min-threshold",8e4),ue.add("featurelayer-snapshot-point-max-threshold",4e5),ue.add("featurelayer-snapshot-point-coverage",.1),ue.add("featurelayer-advanced-symbols",!1),ue.add("featurelayer-pbf",!0),ue.add("featurelayer-pbf-statistics",!1),ue.add("feature-layers-workers",!0),ue.add("feature-polyline-generalization-factor",1),ue.add("mapview-transitions-duration",200),ue.add("mapview-srswitch-adjust-rotation-scale-threshold",24e6),ue.add("mapserver-pbf-enabled",!1),ue.add("mapimagelayer-popup-identify-max-tolerance",20),ue.add("heatmap-allow-raster-fallback",!0),ue.add("heatmap-force-raster",!1),ue("host-webworker")||ue("host-browser")&&(ue.add("esri-csp-restrictions",()=>{try{new Function}catch{return!0}return!1}),ue.add("esri-image-decode",()=>{if("decode"in new Image){const e=new Image;return e.src='data:image/svg+xml;charset=UTF-8,<svg version="1.1" xmlns="http://www.w3.org/2000/svg"></svg>',void e.decode().then(()=>{ue.add("esri-image-decode",!0,!0,!0)}).catch(()=>{ue.add("esri-image-decode",!1,!0,!0)})}return!1}),ue.add("esri-url-encodes-apostrophe",()=>{const e=window.document.createElement("a");return e.href="?'",e.href.includes("?%27")}))})();function ZDe(e,t){if(e.forEach)e.forEach(t);else for(let r=0;r<e.length;r++)t(e[r],r,e)}function wte(e,t,r){if(e.slice)return e.slice(t,r);t===void 0?t=0:(t<0&&(t+=e.length),t=Math.min(e.length,Math.max(0,t))),r===void 0?r=e.length:(r<0&&(r+=e.length),r=Math.min(e.length,Math.max(0,r)));const i=Math.max(0,r-t),n=new e.constructor(i);for(let s=0;s<i;s++)n[s]=e[t+s];return n}function D6(e){return e instanceof ArrayBuffer||e&&e.constructor&&e.constructor.name==="ArrayBuffer"}function QDe(e){return e instanceof Int8Array||e&&e.constructor&&e.constructor.name==="Int8Array"}function f3(e){return e instanceof Uint8Array||e&&e.constructor&&e.constructor.name==="Uint8Array"}function JDe(e){return e instanceof Uint8ClampedArray||e&&e.constructor&&e.constructor.name==="Uint8ClampedArray"}function _2e(e){return e instanceof Int16Array||e&&e.constructor&&e.constructor.name==="Int16Array"}function pF(e){return e instanceof Uint16Array||e&&e.constructor&&e.constructor.name==="Uint16Array"}function w2e(e){return e instanceof Int32Array||e&&e.constructor&&e.constructor.name==="Int32Array"}function mF(e){return e instanceof Uint32Array||e&&e.constructor&&e.constructor.name==="Uint32Array"}function x2e(e){return e instanceof Float32Array||e&&e.constructor&&e.constructor.name==="Float32Array"}function T2e(e){return e instanceof Float64Array||e&&e.constructor&&e.constructor.name==="Float64Array"}function KDe(e){const t=new Array(e.length);for(let r=0;r<e.length;r++)t[r]=e[r];return t}function _M(e){return R(e)?0:128+e.buffer.byteLength+64}function S2e(e,t){let r;if(t)for(r in e)e.hasOwnProperty(r)&&(e[r]===void 0?delete e[r]:e[r]instanceof Object&&S2e(e[r],!0));else for(r in e)e.hasOwnProperty(r)&&e[r]===void 0&&delete e[r];return e}function te(e){if(!e||typeof e!="object"||typeof e=="function")return e;const t=R2e(e);if(_(t))return t;if(E2e(e))return e.clone();if(C2e(e))return e.map(te);if(A2e(e))return e.clone();const r={};for(const i of Object.getOwnPropertyNames(e))r[i]=te(e[i]);return r}function WW(e){if(!e||typeof e!="object"||typeof e=="function")return e;const t=R2e(e);if(_(t))return t;if(C2e(e)){let r=!0;const i=e.map(n=>{const s=WW(n);return n!=null&&s==null&&(r=!1),s});return r?i:null}if(E2e(e))return e.clone();if(!A2e(e)){const r=new(Object.getPrototypeOf(e)).constructor;for(const i of Object.getOwnPropertyNames(e)){const n=e[i],s=WW(n);if(n!=null&&s==null)return null;r[i]=s}return r}return null}function E2e(e){return typeof e.clone=="function"}function C2e(e){return typeof e.map=="function"&&typeof e.forEach=="function"}function A2e(e){return typeof e.notifyChange=="function"&&typeof e.watch=="function"}function Hle(e){if(Object.prototype.toString.call(e)!=="[object Object]")return!1;const t=Object.getPrototypeOf(e);return t===null||t===Object.prototype}function R2e(e){if(QDe(e)||f3(e)||JDe(e)||_2e(e)||pF(e)||w2e(e)||mF(e)||x2e(e)||T2e(e))return wte(e);if(e instanceof Date)return new Date(e.getTime());if(e instanceof ArrayBuffer)return e.slice(0,e.byteLength);if(e instanceof Map){const t=new Map;return e.forEach((r,i)=>{t.set(i,te(r))}),t}if(e instanceof Set){const t=new Set;return e.forEach(r=>{t.add(te(r))}),t}return null}function xte(e,t){return e===t||typeof e=="number"&&isNaN(e)&&typeof t=="number"&&isNaN(t)||typeof(e||{}).getTime=="function"&&typeof(t||{}).getTime=="function"&&e.getTime()===t.getTime()||!1}function eFe(e,t){return e===t||(e==null||typeof e=="string"?e===t:typeof e=="number"?e===t||typeof t=="number"&&isNaN(e)&&isNaN(t):e instanceof Date?t instanceof Date&&e.getTime()===t.getTime():Array.isArray(e)?Array.isArray(t)&&Gv(e,t):e instanceof Set?t instanceof Set&&rFe(e,t):e instanceof Map?t instanceof Map&&iFe(e,t):!!Hle(e)&&Hle(t)&&tFe(e,t))}function tFe(e,t){if(e===null||t===null)return!1;const r=Object.keys(e);if(t===null||Object.keys(t).length!==r.length)return!1;for(const i of r)if(e[i]!==t[i]||!Object.prototype.hasOwnProperty.call(t,i))return!1;return!0}function rFe(e,t){if(e.size!==t.size)return!1;for(const r of e)if(!t.has(r))return!1;return!0}function iFe(e,t){if(e.size!==t.size)return!1;for(const[r,i]of e){const n=t.get(r);if(n!==i||n===void 0&&!t.has(r))return!1}return!0}function Do(e){return e?e.__accessor__?e.__accessor__:e.propertyInvalidated?e:null:null}function nFe(e,t){return e!=null&&e.metadatas&&e.metadatas[t]!=null}function N$(e,t,r){return r?gF(e,t,{policy:r,path:""}):gF(e,t,null)}function gF(e,t,r){return t?Object.keys(t).reduce((i,n)=>{let s=null,a="merge";if(r&&(s=r.path?`${r.path}.${n}`:n,a=r.policy(s)),a==="replace")return i[n]=t[n],i;if(i[n]===void 0)return i[n]=te(t[n]),i;let o=i[n],l=t[n];if(o===l)return i;if(Array.isArray(l)||Array.isArray(i))o=o?Array.isArray(o)?i[n]=o.concat():i[n]=[o]:i[n]=[],l&&(Array.isArray(l)||(l=[l]),l.forEach(c=>{o.includes(c)||o.push(c)}));else if(l&&typeof l=="object")if(r){const c=r.path;r.path=s,i[n]=gF(o,l,r),r.path=c}else i[n]=gF(o,l,null);else i.hasOwnProperty(n)&&!t.hasOwnProperty(n)||(i[n]=l);return i},e||{}):e}function O2e(e){return Array.isArray(e)?e:e.split(".")}function Wle(e){return e.includes(",")?e.split(",").map(t=>t.trim()):[e.trim()]}function sFe(e){if(Array.isArray(e)){const t=[];for(const r of e)t.push(...Wle(r));return t}return Wle(e)}function M2e(e,t,r,i){const n=sFe(t);if(n.length!==1){const s=n.map(a=>i(e,a,r));return A5(s)}return i(e,n[0],r)}function Tte(e){let t=!1;return()=>{t||(t=!0,e())}}function P2e(e,t){const r=e[e.length-1]==="?"?e.slice(0,-1):e;if(t.getItemAt!=null||Array.isArray(t)){const n=parseInt(r,10);if(!isNaN(n))return Array.isArray(t)?t[n]:t.getItemAt(n)}const i=Do(t);return nFe(i,r)?i.get(r):t[r]}function I2e(e,t,r){if(e==null)return e;const i=P2e(t[r],e);return!i&&r<t.length-1?void 0:r===t.length-1?i:I2e(i,t,r+1)}function UR(e,t,r=0){return typeof t!="string"||t.includes(".")?I2e(e,O2e(t),r):P2e(t,e)}function yF(e,t){return UR(e,t)}function Xle(e,t){return UR(t,e)!==void 0}var G0;(function(e){e[e.INITIALIZING=0]="INITIALIZING",e[e.CONSTRUCTING=1]="CONSTRUCTING",e[e.CONSTRUCTED=2]="CONSTRUCTED"})(G0||(G0={}));class Yle{constructor(t){this.autoDestroy=!1,this.properties=t}}function BR(e){let t=e.constructor.__accessorMetadata__;const r=Object.prototype.hasOwnProperty.call(e.constructor,"__accessorMetadata__");if(t){if(!r){const i=Object.create(t.properties),n=t.autoDestroy;for(const s in i)i[s]=te(i[s]);t=new Yle(i),t.autoDestroy=n,Object.defineProperty(e.constructor,"__accessorMetadata__",{value:t,enumerable:!1,configurable:!0,writable:!0})}}else t=new Yle({}),Object.defineProperty(e.constructor,"__accessorMetadata__",{value:t,enumerable:!1,configurable:!0,writable:!0});return e.constructor.__accessorMetadata__}function aFe(e){return BR(e).properties}function GR(e,t){const r=aFe(e);let i=r[t];return i||(i=r[t]={}),i}function oFe(e,t){return N$(e,t,cFe)}const lFe=/^(?:[^.]+\.)?(?:value|type|(?:json\.type|json\.origins\.[^.]\.type))$/;function cFe(e){return lFe.test(e)?"replace":"merge"}function $2e(e,t,r=!1){return D2e(e,t,r)}function W9(e,t){if(t!=null)return t[e]||L2e(e.split("."),!1,t)}function ud(e,t,r){const i=e.split("."),n=i.pop(),s=L2e(i,!0,r);s&&n&&(s[n]=t)}function L2e(e,t,r){let i=r;for(const n of e){if(i==null)return;if(!(n in i)){if(!t)return;i[n]={}}i=i[n]}return i}function D2e(e,t,r){return t?Object.keys(t).reduce((i,n)=>{let s=i[n],a=t[n];return s===a?i:s===void 0?(i[n]=te(a),i):(Array.isArray(a)||Array.isArray(i)?(s=s?Array.isArray(s)?i[n]=s.concat():i[n]=[s]:i[n]=[],a&&(Array.isArray(a)||(a=[a]),r?a.forEach(o=>{s.includes(o)||s.push(o)}):i[n]=a.concat())):a&&typeof a=="object"?i[n]=D2e(s,a,r):i.hasOwnProperty(n)&&!t.hasOwnProperty(n)||(i[n]=a),i)},e||{}):e}var K1e;const Vr={apiKey:void 0,applicationUrl:(K1e=globalThis.location)==null?void 0:K1e.href,assetsPath:"",fontsUrl:"https://static.arcgis.com/fonts",geometryServiceUrl:"https://utility.arcgisonline.com/arcgis/rest/services/Geometry/GeometryServer",geoRSSServiceUrl:"https://utility.arcgis.com/sharing/rss",kmlServiceUrl:"https://utility.arcgis.com/sharing/kml",portalUrl:"https://www.arcgis.com",routeServiceUrl:"https://route-api.arcgis.com/arcgis/rest/services/World/Route/NAServer/Route_World",workers:{loaderConfig:{has:{},paths:{},map:{},packages:[]}},request:{crossOriginNoCorsDomains:null,httpsDomains:["arcgis.com","arcgisonline.com","esrikr.com","premiumservices.blackbridge.com","esripremium.accuweather.com","gbm.digitalglobe.com","firstlook.digitalglobe.com","msi.digitalglobe.com"],interceptors:[],maxUrlLength:2e3,priority:"high",proxyRules:[],proxyUrl:null,timeout:6e4,trustedServers:[],useIdentity:!0},log:{interceptors:[],level:null}};if(globalThis.esriConfig&&($2e(Vr,globalThis.esriConfig,!0),delete Vr.has),!Vr.assetsPath){const e="4.24.7";Vr.assetsPath=`https://js.arcgis.com/${e.slice(0,-2)}/@arcgis/core/assets`}Vr.baseUrl&&console.warn("[esri.config]","baseUrl has been replaced by assetsPath"),Object.defineProperty(Vr,"baseUrl",{set(){console.warn("[esri.config]","baseUrl has been replaced by assetsPath")}}),Vr.request.corsEnabledServers=[],Vr.request.corsEnabledServers.push=function(){return console.warn("[esri.config]","request.corsEnabledServers is not supported and will be removed in a future release. See http://esriurl.com/cors8664"),0};const dFe=/\{([^\}]+)\}/g;function Zle(e){return e==null?"":e}function lm(e,t){return e.replace(dFe,typeof t=="object"?(r,i)=>Zle(W9(i,t)):(r,i)=>Zle(t(i)))}function F2e(e,t){return e.replace(/([\.$?*|{}\(\)\[\]\\\/\+\-^])/g,r=>t&&t.includes(r)?r:`\\${r}`)}function Ste(e){let t=0;for(let r=0;r<e.length;r++)t=(t<<5)-t+e.charCodeAt(r),t|=0;return t}function $Pt(e){return new DOMParser().parseFromString(e||"","text/html").body.innerText||""}const Qle={info:0,warn:1,error:2,none:3};class fe{constructor(t){this.level=null,this._module="",this._parent=null,this.writer=null,this._loggedMessages={error:new Map,warn:new Map,info:new Map},t.level!=null&&(this.level=t.level),t.writer!=null&&(this.writer=t.writer),this._module=t.module,fe._loggers[this.module]=this;const r=this.module.lastIndexOf(".");r!==-1&&(this._parent=fe.getLogger(this.module.slice(0,r)))}get module(){return this._module}get parent(){return this._parent}error(...t){this._log("error","always",...t)}warn(...t){this._log("warn","always",...t)}info(...t){this._log("info","always",...t)}errorOnce(...t){this._log("error","once",...t)}warnOnce(...t){this._log("warn","once",...t)}infoOnce(...t){this._log("info","once",...t)}errorOncePerTick(...t){this._log("error","oncePerTick",...t)}warnOncePerTick(...t){this._log("warn","oncePerTick",...t)}infoOncePerTick(...t){this._log("info","oncePerTick",...t)}get test(){const t=this;return{loggedMessages:t._loggedMessages,clearLoggedWarnings:()=>t._loggedMessages.warn.clear()}}static get testSingleton(){return{resetLoggers(t={}){const r=fe._loggers;return fe._loggers=t,r},set throttlingDisabled(t){fe._throttlingDisabled=t}}}static getLogger(t){let r=fe._loggers[t];return r||(r=new fe({module:t})),r}_log(t,r,...i){if(!!this._matchLevel(t)){if(r!=="always"&&!fe._throttlingDisabled){const n=this._argsToKey(i),s=this._loggedMessages[t].get(n);if(r==="once"&&s!=null||r==="oncePerTick"&&s&&s>=fe._tickCounter)return;this._loggedMessages[t].set(n,fe._tickCounter),fe._scheduleTickCounterIncrement()}for(const n of Vr.log.interceptors)if(n(t,this.module,...i))return;this._inheritedWriter()(t,this.module,...i)}}_parentWithMember(t,r){let i=this;for(;_(i);){const n=i[t];if(_(n))return n;i=i.parent}return r}_inheritedWriter(){return this._parentWithMember("writer",this._consoleWriter)}_consoleWriter(t,r,...i){console[t](`[${r}]`,...i)}_matchLevel(t){const r=Vr.log.level?Vr.log.level:"warn";return Qle[this._parentWithMember("level",r)]<=Qle[t]}_argsToKey(...t){const r=(i,n)=>typeof n!="object"||Array.isArray(n)?n:"[Object]";return Ste(JSON.stringify(t,r))}static _scheduleTickCounterIncrement(){fe._tickCounterScheduled||(fe._tickCounterScheduled=!0,Promise.resolve().then(()=>{fe._tickCounter++,fe._tickCounterScheduled=!1}))}}fe._loggers={},fe._tickCounter=0,fe._tickCounterScheduled=!1,fe._throttlingDisabled=!1;var Gt;(function(e){e[e.DEFAULTS=0]="DEFAULTS",e[e.COMPUTED=1]="COMPUTED",e[e.SERVICE=2]="SERVICE",e[e.PORTAL_ITEM=3]="PORTAL_ITEM",e[e.WEB_SCENE=4]="WEB_SCENE",e[e.WEB_MAP=5]="WEB_MAP",e[e.USER=6]="USER"})(Gt||(Gt={}));const XW=Gt.USER+1;function Zg(e){switch(e){case"defaults":return Gt.DEFAULTS;case"service":return Gt.SERVICE;case"portal-item":return Gt.PORTAL_ITEM;case"web-scene":return Gt.WEB_SCENE;case"web-map":return Gt.WEB_MAP;case"user":return Gt.USER}}function bF(e){switch(e){case Gt.DEFAULTS:return"defaults";case Gt.SERVICE:return"service";case Gt.PORTAL_ITEM:return"portal-item";case Gt.WEB_SCENE:return"web-scene";case Gt.WEB_MAP:return"web-map";case Gt.USER:return"user"}return void 0}function uFe(e){return bF(e)}var xi;(function(e){e[e.Dirty=1]="Dirty",e[e.Overriden=2]="Overriden",e[e.Computing=4]="Computing",e[e.NonNullable=8]="NonNullable",e[e.HasDefaultValue=16]="HasDefaultValue",e[e.DepTrackingInitialized=32]="DepTrackingInitialized",e[e.AutoTracked=64]="AutoTracked",e[e.ExplicitlyTracking=128]="ExplicitlyTracking"})(xi||(xi={}));let vF,iE=[];const hFe=fe.getLogger("esri.core.Accessor");function nr(e){vF!==void 0&&vF.onObservableAccessed(e)}let k$=!1,V$=!1;function Cy(e,t,r){if(k$)return Ete(e,t,r);N2e(e);const i=t.call(r);return k2e(),i}function fFe(e,t){return Cy(void 0,e,t)}function Ete(e,t,r){const i=k$;k$=!0,N2e(e);let n=null;try{n=t.call(r)}catch(s){V$&&hFe.error(s)}return k2e(),k$=i,n}function N2e(e){vF=e,iE.push(e)}function k2e(){const e=iE.pop();vF=iE.length>0?iE[iE.length-1]:void 0,e!==void 0&&e.onTrackingEnd()}function V2e(e,t){if(t.flags&xi.DepTrackingInitialized)return;const r=V$;V$=!1,t.flags&xi.AutoTracked?Ete(t,t.metadata.get,e):z2e(e,t),V$=r}const pFe=[];function z2e(e,t){t.flags&xi.ExplicitlyTracking||(t.flags|=xi.ExplicitlyTracking,Ete(t,()=>{const r=t.metadata.dependsOn||pFe;for(const i of r)if(typeof i!="string"||i.includes(".")){const n=O2e(i);for(let s=0,a=e;s<n.length&&a!=null&&typeof a=="object";++s)a=Jle(a,n[s],s!==n.length-1)}else Jle(e,i,!1)}),t.flags&=~xi.ExplicitlyTracking)}function Jle(e,t,r){var s;const i=t[t.length-1]==="?"?t.slice(0,-1):t;if(e.getItemAt!=null||Array.isArray(e)){const a=parseInt(i,10);if(!isNaN(a))return Array.isArray(e)?e[a]:e.getItemAt(a)}const n=(s=Do(e))==null?void 0:s.properties.get(i);return n&&(nr(n),V2e(e,n)),r?e[i]:void 0}class U2e{constructor(t,r){this._observers=t,this._observer=r}remove(){_te(this._observers,this._observer)}}class Kle{constructor(t,r,i){this.properties=t,this.propertyName=r,this.metadata=i,this._observers=null,this._accessed=null,this._handles=null,this.flags=xi.Dirty|(i.nonNullable?xi.NonNullable:0)|(i.hasOwnProperty("value")?xi.HasDefaultValue:0)|(i.get===void 0?xi.DepTrackingInitialized:0)|(i.dependsOn===void 0?xi.AutoTracked:0)}destroy(){if(this.flags&xi.Dirty&&this._observers){const t=this._observers.slice();for(const r of t)r.onCommitted()}this._accessed=null,this._observers=null,this._clearObservationHandles()}getComputed(){nr(this);const t=this.properties.store,r=this.propertyName,i=this.flags,n=t.get(r);if(i&xi.Computing||~i&xi.Dirty&&t.has(r))return n;this.flags|=xi.Computing;const s=this.properties.host;let a;i&xi.AutoTracked?a=Cy(this,this.metadata.get,s):(z2e(s,this),a=this.metadata.get.call(s)),t.set(r,a,Gt.COMPUTED);const o=t.get(r);return o===n?this.flags&=~xi.Dirty:fFe(this.commit,this),this.flags&=~xi.Computing,o}onObservableAccessed(t){t!==this&&(this._accessed===null&&(this._accessed=[]),this._accessed.includes(t)||this._accessed.push(t))}onTrackingEnd(){this._clearObservationHandles(),this.flags|=xi.DepTrackingInitialized;const t=this._accessed;if(t===null)return;let r=this._handles;r===null&&(r=this._handles=[]);for(let i=0;i<t.length;++i)r.push(t[i].observe(this));t.length=0}observe(t){return this._observers===null&&(this._observers=[]),this._observers.includes(t)||this._observers.push(t),new U2e(this._observers,t)}notifyChange(){this.onInvalidated(),this.onCommitted()}invalidate(){this.onInvalidated()}onInvalidated(){~this.flags&xi.Overriden&&(this.flags|=xi.Dirty);const t=this._observers;if(t!==null)for(let r=0;r<t.length;++r)t[r].onInvalidated()}commit(){this.flags&=~xi.Dirty,this.onCommitted()}onCommitted(){if(this._observers===null)return;const t=this._observers.slice();for(let r=0;r<t.length;++r)t[r].onCommitted()}_clearObservationHandles(){const t=this._handles;if(t!==null){for(let r=0;r<t.length;++r)t[r].remove();t.length=0}}}class Cte{constructor(){this._values=new Map,this.multipleOriginsSupported=!1}clone(t){const r=new Cte;return this._values.forEach((i,n)=>{t&&t.has(n)||r.set(n,te(i))}),r}get(t){return this._values.get(t)}originOf(){return Gt.USER}keys(){return[...this._values.keys()]}set(t,r){this._values.set(t,r)}delete(t){this._values.delete(t)}has(t){return this._values.has(t)}forEach(t){this._values.forEach(t)}}function wM(e,t,r){return e!==void 0}function ece(e,t,r,i){return e!==void 0&&(!(r==null&&e.flags&xi.NonNullable)||(i.lifecycle,G0.INITIALIZING,!1))}function mFe(e){return e&&typeof e.destroy=="function"}fe.getLogger("esri.core.accessorSupport.Properties");class gFe{constructor(t){this.host=t,this.properties=new Map,this.ctorArgs=null,this.destroyed=!1,this.lifecycle=G0.INITIALIZING,this.store=new Cte,this._origin=Gt.USER;const r=this.host.constructor.__accessorMetadata__,i=r.properties;for(const n in i){const s=new Kle(this,n,i[n]);this.properties.set(n,s)}this.metadatas=i,this._autoDestroy=r.autoDestroy}initialize(){this.lifecycle=G0.CONSTRUCTING}constructed(){this.lifecycle=G0.CONSTRUCTED}destroy(){if(this.destroyed=!0,this._autoDestroy)for(const[t,r]of this.properties){const i=this.internalGet(t);i&&mFe(i)&&(i.destroy(),~r.flags&xi.NonNullable&&this._internalSet(r,null)),r.destroy()}else for(const[t,r]of this.properties)r.destroy()}get initialized(){return this.lifecycle!==G0.INITIALIZING}get(t){const r=this.properties.get(t);if(r.metadata.get)return r.getComputed();nr(r);const i=this.store;return i.has(t)?i.get(t):r.metadata.value}originOf(t){const r=this.store.originOf(t);if(r===void 0){const i=this.properties.get(t);if(i!==void 0&&i.flags&xi.HasDefaultValue)return"defaults"}return bF(r)}has(t){return!!this.properties.has(t)&&this.store.has(t)}keys(){return[...this.properties.keys()]}internalGet(t){const r=this.properties.get(t);if(wM(r))return this.store.has(t)?this.store.get(t):r.metadata.value}internalSet(t,r){const i=this.properties.get(t);wM(i)&&this._internalSet(i,r)}getDependsInfo(t,r,i){const n=this.properties.get(r);if(!wM(n))return"";const s=new Set,a=Cy({onObservableAccessed:l=>s.add(l),onTrackingEnd:()=>{}},()=>{var l;return(l=n.metadata.get)==null?void 0:l.call(t)});let o=`${i}${t.declaredClass.split(".").pop()}.${r}: ${a}
`;if(s.size===0)return o;i+="  ";for(const l of s){if(!(l instanceof Kle))continue;const c=l.properties.host,u=l.propertyName,h=Do(c);o+=h?h.getDependsInfo(c,u,i):`${i}${u}: undefined
`}return o}setAtOrigin(t,r,i){const n=this.properties.get(t);if(wM(n))return this._setAtOrigin(n,r,i)}isOverridden(t){const r=this.properties.get(t);return r!==void 0&&!!(r.flags&xi.Overriden)}clearOverride(t){const r=this.properties.get(t);r!==void 0&&r.flags&xi.Overriden&&(r.flags&=~xi.Overriden,r.notifyChange())}override(t,r){const i=this.properties.get(t);if(!ece(i,t,r,this))return;const n=i.metadata.cast;if(n){const s=this._cast(n,r),{valid:a,value:o}=s;if(GB.release(s),!a)return;r=o}i.flags|=xi.Overriden,this._internalSet(i,r)}set(t,r){const i=this.properties.get(t);if(!ece(i,t,r,this))return;const n=i.metadata.cast;if(n){const a=this._cast(n,r),{valid:o,value:l}=a;if(GB.release(a),!o)return;r=l}const s=i.metadata.set;s?s.call(this.host,r):this._internalSet(i,r)}setDefaultOrigin(t){this._origin=Zg(t)}getDefaultOrigin(){return bF(this._origin)}notifyChange(t){const r=this.properties.get(t);r!==void 0&&r.notifyChange()}invalidate(t){const r=this.properties.get(t);r!==void 0&&r.invalidate()}commit(t){const r=this.properties.get(t);r!==void 0&&r.commit()}_internalSet(t,r){const i=this.lifecycle!==G0.INITIALIZING?this._origin:Gt.DEFAULTS;this._setAtOrigin(t,r,i)}_setAtOrigin(t,r,i){const n=this.store,s=t.propertyName;n.has(s,i)&&xte(r,n.get(s))&&~t.flags&xi.Overriden&&i===n.originOf(s)||(t.invalidate(),n.set(s,r,i),t.commit(),V2e(this.host,t))}_cast(t,r){const i=GB.acquire();return i.valid=!0,i.value=r,t&&(i.value=t.call(this.host,r,i)),i}}class yFe{constructor(){this.value=null,this.valid=!0}acquire(){this.valid=!0}release(){this.value=null}}const GB=new Fn(yFe);function bFe(e,t){return e.replace(/\$\{([^\s\:\}]*)(?:\:([^\s\:\}]+))?\}/g,(r,i)=>{if(i==="")return"$";const n=W9(i,t),s=n==null?"":n;if(s===void 0)throw new Error(`could not find key "${i}" in template`);return s.toString()})}class nV{constructor(t,r,i){this.name=t,this.details=i,this.message=void 0,this instanceof nV&&(this.message=r&&bFe(r,i)||"")}toString(){return"["+this.name+"]: "+this.message}}class k extends nV{constructor(t,r,i){if(super(t,r,i),!(this instanceof k))return new k(t,r,i)}toJSON(){if(this.details!=null)try{return{name:this.name,message:this.message,details:JSON.parse(JSON.stringify(this.details,(t,r)=>{if(r&&typeof r=="object"&&typeof r.toJSON=="function")return r;try{return te(r)}catch{return"[object]"}}))}}catch(t){throw fe.getLogger("esri.core.Error").error(t),t}return{name:this.name,message:this.message,details:this.details}}static fromJSON(t){return new k(t.name,t.message,t.details)}}k.prototype.type="error";function _F(e,t,r){if(e&&t)if(typeof t=="object")for(const i of Object.getOwnPropertyNames(t))_F(e,i,t[i]);else{if(t.includes(".")){const n=t.split("."),s=n.splice(n.length-1,1)[0];return void _F(yF(e,n),s,r)}const i=e.__accessor__;i!=null&&vFe(t,i),e[t]=r}}function vFe(e,t){if(ue("esri-unknown-property-errors")&&!_Fe(e,t))throw new k("set:unknown-property",wFe(e,t))}function _Fe(e,t){return t.metadatas[e]!=null}function wFe(e,t){return"setting unknown property '"+e+"' on instance of "+t.host.declaredClass}fe.getLogger("esri.core.accessorSupport.set");class B2e extends Fn{constructor(){super(...arguments),this._set=new Set}destroy(){super.destroy(),this._set=BDe(this._set)}acquire(...t){const r=super.acquire(...t);return this._set.delete(r),r}release(t){t&&!this._set.has(t)&&(super.release(t),this._set.add(t))}_dispose(t){this._set.delete(t),super._dispose(t)}}const xM=[];function R5(e){xM.push(e),xM.length===1&&queueMicrotask(()=>{const t=xM.slice();xM.length=0;for(const r of t)r()})}const xFe=29;class Rv{constructor(t,r=xFe){this.name=t,this._counter=0,this._items=new Array(r)}record(t){this._items[++this._counter%this._items.length]=t}get median(){return this._items.slice().sort((t,r)=>t-r)[Math.floor(this._items.length/2)]}get average(){return this._items.reduce((t,r)=>t+r,0)/this._items.length}get last(){return this._items[this._counter%this._items.length]}}var YW;(function(e){const t=(s,a,o,l)=>{let c=a,u=a;const h=o>>>1,p=s[c-1];for(;u<=h;){u=c<<1,u<o&&l(s[u-1],s[u])<0&&++u;const m=s[u-1];if(l(m,p)<=0)break;s[c-1]=m,c=u}s[c-1]=p},r=(s,a)=>s<a?-1:s>a?1:0;function i(s,a,o,l){a===void 0&&(a=0),o===void 0&&(o=s.length),l===void 0&&(l=r);for(let u=o>>>1;u>a;u--)t(s,u,o,l);const c=a+1;for(let u=o-1;u>a;u--){const h=s[a];s[a]=s[u],s[u]=h,t(s,c,u,l)}}function*n(s,a,o,l){a===void 0&&(a=0),o===void 0&&(o=s.length),l===void 0&&(l=r);for(let u=o>>>1;u>a;u--)t(s,u,o,l),yield;const c=a+1;for(let u=o-1;u>a;u--){const h=s[a];s[a]=s[u],s[u]=h,t(s,c,u,l),yield}}e.sort=i,e.iterableSort=n})(YW||(YW={}));const tce=YW,TFe=1.5,SFe=1.1;class Qt{constructor(t){this.data=[],this._length=0,this._allocator=void 0,this._deallocator=()=>null,this._shrink=()=>{},this._hint=new g2e,t&&(t.initialSize&&(this.data=new Array(t.initialSize)),t.allocator&&(this._allocator=t.allocator),t.deallocator!==void 0&&(this._deallocator=t.deallocator),t.shrink&&(this._shrink=()=>rce(this)))}toArray(){return this.data.slice(0,this.length)}filter(t){const r=new Array;for(let i=0;i<this._length;i++){const n=this.data[i];t(n)&&r.push(n)}return r}getItemAt(t){if(!(t<0||t>=this._length))return this.data[t]}includes(t,r){const i=this.data.indexOf(t,r);return i!==-1&&i<this.length}get length(){return this._length}set length(t){if(t>this._length){if(this._allocator){for(;this._length<t;)this.data[this._length++]=this._allocator(this.data[this._length]);return}this._length=t}else{if(this._deallocator)for(let r=t;r<this._length;++r)this.data[r]=this._deallocator(this.data[r]);this._length=t,this._shrink()}}clear(){this.length=0}prune(){this.clear(),this.data=[]}push(t){this.data[this._length++]=t}pushArray(t,r=t.length){for(let i=0;i<r;i++)this.data[this._length++]=t[i]}fill(t,r){for(let i=0;i<r;i++)this.data[this._length++]=t}pushNew(){this._allocator&&(this.data[this.length]=this._allocator(this.data[this.length]));const t=this.data[this._length];return++this._length,t}unshift(t){this.data.unshift(t),this._length++,rce(this)}pop(){if(this.length===0)return;const t=this.data[this.length-1];return this.length=this.length-1,this._shrink(),t}remove(t){const r=b2e(this.data,t,this.length,this._hint);if(r!==-1)return this.data.splice(r,1),this.length=this.length-1,t}removeUnordered(t){const r=iV(this.data,t,this.length,this._hint);return r!==void 0&&(this.length=this.length-1),this._shrink(),r}removeUnorderedIndex(t){if(!(t>=this.length||t<0))return this.swapElements(t,this.length-1),this.pop()}removeUnorderedMany(t,r=t.length,i){this.length=YDe(this.data,t,this.length,r,this._hint,i),this._shrink()}front(){if(this.length!==0)return this.data[0]}back(){if(this.length!==0)return this.data[this.length-1]}swapElements(t,r){t>=this.length||r>=this.length||t===r||([this.data[t],this.data[r]]=[this.data[r],this.data[t]])}sort(t){tce.sort(this.data,0,this.length,t)}iterableSort(t){return tce.iterableSort(this.data,0,this.length,t)}some(t,r){for(let i=0;i<this.length;++i)if(t.call(r,this.data[i],i,this.data))return!0;return!1}filterInPlace(t,r){let i=0;for(let n=0;n<this._length;++n){const s=this.data[n];t.call(r,s,n,this.data)&&(this.data[n]=this.data[i],this.data[i]=s,i++)}if(this._deallocator)for(let n=i;n<this._length;n++)this.data[n]=this._deallocator(this.data[n]);return this._length=i,this._shrink(),this}forAll(t,r){const i=this.length,n=this.data;for(let s=0;s<i;++s)t.call(r,n[s],s,n)}forEach(t,r){for(let i=0;i<this.length;++i)t.call(r,this.data[i],i,this.data)}map(t,r){const i=new Array(this.length);for(let n=0;n<this.length;++n)i[n]=t.call(r,this.data[n],n,this.data);return i}reduce(t,r){let i=r;for(let n=0;n<this.length;++n)i=t(i,this.data[n],n,this.data);return i}has(t){const r=this.length,i=this.data;for(let n=0;n<r;++n)if(i[n]===t)return!0;return!1}}function rce(e){e.data.length>TFe*e.length&&(e.data.length=Math.floor(e.length*SFe))}function EFe(e){return{setTimeout:(t,r)=>{const i=e.setTimeout(t,r);return{remove:()=>e.clearTimeout(i)}}}}const sV=EFe(globalThis),ice=new Set;function CFe(e,t,r=!1){r&&ice.has(t)||(r&&ice.add(t),e.warn(`\u{1F6D1} DEPRECATED - ${t}`))}function AFe(e,t,r={}){if(ue("esri-deprecation-warnings")){const{moduleName:i}=r;G2e(e,`Property: ${(i?i+"::":"")+t}`,r)}}function G2e(e,t,r={}){if(ue("esri-deprecation-warnings")){const{replacement:i,version:n,see:s,warnOnce:a}=r;let o=t;i&&(o+=`
	\u{1F6E0}\uFE0F Replacement: ${i}`),n&&(o+=`
	\u2699\uFE0F Version: ${n}`),s&&(o+=`
	\u{1F517} See ${s} for more details.`),CFe(e,o,a)}}function aV(e){return e&&(typeof e.on=="function"||typeof e.addEventListener=="function")}function jR(e,t,r){if(!aV(e))throw new TypeError("target is not a Evented or EventTarget object");if("on"in e)return e.on(t,r);if(Array.isArray(t)){const i=t.slice();for(const n of i)e.addEventListener(n,r);return{remove(){for(const n of i)e.removeEventListener(n,r)}}}return e.addEventListener(t,r),{remove(){e.removeEventListener(t,r)}}}function j2e(e,t,r){if(!aV(e))throw new TypeError("target is not a Evented or EventTarget object");if("once"in e)return e.once(t,r);const i=jR(e,t,n=>{i.remove(),r.call(e,n)});return{remove(){i.remove()}}}const RFe={Win:"Meta",Scroll:"ScrollLock",Spacebar:" ",Down:"ArrowDown",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Del:"Delete",Apps:"ContextMenu",Esc:"Escape",Multiply:"*",Add:"+",Subtract:"-",Decimal:".",Divide:"/"};function p3({key:e}){return RFe[e]||e}function br(e="Aborted"){return new k("AbortError",e)}function Et(e,t="Aborted"){if(bs(e))throw br(t)}function oV(e){return _(e)?"aborted"in e?e:e.signal:e}function bs(e){const t=oV(e);return _(t)&&t.aborted}function pu(e){if(Ui(e))throw e}function ZW(e){if(!Ui(e))throw e}function Fo(e,t){const r=oV(e);if(!R(r)){if(!r.aborted)return j2e(r,"abort",()=>t());t()}}function Ate(e,t){const r=oV(e);if(!R(r))return Et(r),j2e(r,"abort",()=>t(br()))}function q2e(e,t){const r=oV(t);return R(r)?e:new Promise((i,n)=>{let s=Fo(t,()=>n(br()));const a=()=>s=Ts(s);e.then(a,a),e.then(i,n)})}function Ui(e){return e&&e.name==="AbortError"}async function QW(e){try{return await e}catch(t){if(!Ui(t))throw t}}async function LPt(e,t=fe.getLogger("esri")){try{return await e}catch(r){Ui(r)||t.error(r)}}function jv(){let e=null;const t=new Promise((r,i)=>{e={promise:void 0,resolve:r,reject:i}});return e.promise=t,e}async function dn(e){if(!e)return;if(typeof e.forEach!="function"){const r=Object.keys(e),i=r.map(a=>e[a]),n=await dn(i),s={};return r.map((a,o)=>s[a]=n[o]),s}const t=e;return new Promise(r=>{const i=[];let n=t.length;n===0&&r(i),t.forEach(s=>{const a={promise:s||Promise.resolve(s)};i.push(a),a.promise.then(o=>{a.value=o}).catch(o=>{a.error=o}).then(()=>{--n,n===0&&r(i)})})})}async function OFe(e){return(await dn(e)).filter(t=>!!t.value).map(t=>t.value)}function O5(e,t,r){const i=new AbortController;return Fo(r,()=>i.abort()),new Promise((n,s)=>{let a=setTimeout(()=>{a=0,n(t)},e);Fo(i,()=>{a&&(clearTimeout(a),s(br()))})})}function H2e(e,t,r,i){const n=r&&"abort"in r?r:null;i!=null||n||(i=r);let s=setTimeout(()=>{s=0,n&&n.abort()},t);const a=()=>i||new k("promiseUtils:timeout","The wrapped promise did not resolve within "+t+" ms");return e.then(o=>{if(s===0)throw a();return clearTimeout(s),o},o=>{throw clearTimeout(s),s===0?a():o})}function $u(e){return e&&typeof e.then=="function"}function JW(e){return $u(e)?e:Promise.resolve(e)}function qR(e,t=-1){let r,i,n,s,a=null;const o=(...l)=>{if(r){i=l,s&&s.reject(br()),s=jv();const p=s.promise;if(a){const m=a;a=null,m.abort()}return p}if(n=s||jv(),s=null,t>0){const p=new AbortController;r=JW(e(...l,p.signal));const m=r;O5(t).then(()=>{r===m&&(s?p.abort():a=p)})}else r=1,r=JW(e(...l));const c=()=>{const p=i;i=n=r=a=null,p!=null&&o(...p)},u=r,h=n;return u.then(c,c),u.then(h.resolve,h.reject),h.promise};return o}function Op(){let e,t;const r=new Promise((n,s)=>{e=n,t=s}),i=n=>{e(n)};return i.resolve=n=>e(n),i.reject=n=>t(n),i.timeout=(n,s)=>sV.setTimeout(()=>i.reject(s),n),i.promise=r,i}function DPt(e,t){return e.then(t,t)}function HR(e,t){let r,i=new AbortController;const n=e(i.signal);let s={promise:n,finished:!1,abort:()=>{i&&(i.abort(),i=null)}};const a=()=>{s&&(s.finished=!0,s=null),_(r)&&(r.remove(),r=null),i=null};return n.then(a,a),r=Fo(t,()=>{_(s)&&s.abort()}),s}async function nce(e){await Promise.resolve(),Et(e)}function W2e(e){return 1e3*e}function Rte(e){return .001*e}class MFe{constructor(t){this.phases=t,this.paused=!1,this.ticks=-1,this.removed=!1}}class PFe{constructor(t){this.callback=t,this.isActive=!0}remove(){this.isActive=!1}}let KW=0,eX=0;const F6={time:0,deltaTime:0,elapsedFrameTime:0,frameDuration:0},tX=["prepare","preRender","render","postRender","update","finish"],rX=[],Cw=new Qt;class IFe{constructor(t){this._task=t}remove(){this._task.removed=!0}pause(){this._task.paused=!0}resume(){this._task.paused=!1}}const wF={frameTasks:Cw,willDispatch:!1,clearFrameTasks:$Fe,dispatch:Z2e,executeFrameTasks:DFe};function X9(e){const t=new PFe(e);return rX.push(t),wF.willDispatch||(wF.willDispatch=!0,R5(Z2e)),t}function Aw(e){const t=new MFe(e);return Cw.push(t),xF==null&&(KW=performance.now(),xF=requestAnimationFrame(X2e)),new IFe(t)}let xF=null;function $Fe(e=!1){Cw.forAll(t=>{t.removed=!0}),e&&Y2e()}function LFe(e){eX=Math.max(0,e)}function X2e(){const e=performance.now();xF=null,xF=Cw.length>0?requestAnimationFrame(X2e):null,wF.executeFrameTasks(e)}function DFe(e){const t=e-KW;KW=e;const r=eX>0?eX:1e3/60,i=Math.max(0,t-r);for(let n=0;n<tX.length;n++){const s=performance.now(),a=tX[n];Cw.forAll(o=>{var l;o.paused||o.removed||(n===0&&o.ticks++,o.phases[a]&&(F6.time=e,F6.deltaTime=o.ticks===0?0:t,F6.elapsedFrameTime=performance.now()-e,F6.frameDuration=r-i,(l=o.phases[a])==null||l.call(o,F6)))}),FFe[n].record(performance.now()-s)}Y2e(),NFe.record(performance.now()-e)}const TM=new Qt;function Y2e(){Cw.forAll(e=>{e.removed&&TM.push(e)}),Cw.removeUnorderedMany(TM.data,TM.length),TM.clear()}function Z2e(){for(;rX.length;){const e=rX.shift();e.isActive&&e.callback()}wF.willDispatch=!1}function FPt(e=1,t){const r=Op(),i=()=>{bs(t)?r.reject(br()):e===0?r():(--e,R5(()=>i()))};return i(),r.promise}const FFe=tX.map(e=>new Rv(e)),NFe=new Rv("total");function z$(e,t){for(const r of e.entries())if(t(r[0]))return!0;return!1}let kFe=0;const VFe=0;function ic(){return++kFe}class lV{constructor(t){this._notify=t,this._accessed=[],this._handles=[],this._invalidCount=0}destroy(){this._accessed.length=0,this.clear()}onInvalidated(){this._invalidCount++}onCommitted(){const t=this._invalidCount;if(t===1)return this._invalidCount=0,void this._notify();this._invalidCount=t>0?t-1:0}onObservableAccessed(t){this._accessed.includes(t)||this._accessed.push(t)}onTrackingEnd(){const t=this._handles,r=this._accessed;for(let i=0;i<r.length;++i)t.push(r[i].observe(this));r.length=0}clear(){const t=this._handles;for(let r=0;r<t.length;++r)t[r].remove();t.length=0}}let U4=!1;const TF=[];function Q2e(e,t){let r=new lV(s),i=null,n=!1;function s(){if(!r||n)return;if(U4)return void e3e(s);const o=i;r.clear(),U4=!0,n=!0,i=Cy(r,e),n=!1,U4=!1,t(i,o),t3e()}function a(){r&&(r.destroy(),r=null,i=null)}return n=!0,i=Cy(r,e),n=!1,{remove:a}}function J2e(e,t){let r=new lV(n),i=null;function n(){t(i,a)}function s(){r&&(r.destroy(),r=null),i=null}function a(){return r?(r.clear(),i=Cy(r,e),i):null}return a(),{remove:s}}function K2e(e){let t=new lV(i),r=!1;function i(){t&&!r&&(U4?e3e(i):(t.clear(),U4=!0,r=!0,Cy(t,e),r=!1,U4=!1,t3e()))}function n(){t&&(t.destroy(),t=null)}return r=!0,Cy(t,e),r=!1,{remove:n}}function e3e(e){TF.includes(e)||TF.unshift(e)}function t3e(){for(;TF.length;)TF.pop()()}var VC;(function(e){e[e.Untracked=0]="Untracked",e[e.Tracked=1]="Tracked"})(VC||(VC={}));class K7{constructor(){this.uid=ic(),this.removed=!1,this.type=null,this.oldValue=null,this.callback=null,this.getValue=null,this.target=null,this.path=null,this.equals=null}static acquireUntracked(t,r,i,n,s){return this.pool.acquire(VC.Untracked,t,r,i,n,s,xte)}static acquireTracked(t,r,i,n){return this.pool.acquire(VC.Tracked,t,r,i,null,null,n)}notify(t,r){this.type===VC.Untracked?this.callback.call(this.target,t,r,this.path,this.target):this.callback.call(null,t,r)}acquire(t,r,i,n,s,a,o){this.uid=ic(),this.removed=!1,this.type=t,this.oldValue=r,this.callback=i,this.getValue=n,this.target=s,this.path=a,this.equals=o}release(){this.target=this.path=this.oldValue=this.callback=this.getValue=null,this.uid=ic(),this.removed=!0}}K7.pool=new B2e(K7);const U$=new Xc,ay=new Set;let SF;function EF(e){ay.delete(e),ay.add(e),SF||(SF=X9(BFe))}function zFe(e){if(e.removed)return;const t=e.oldValue,r=e.getValue();e.equals(t,r)||(e.oldValue=r,e.notify(r,t))}function UFe(e){for(const t of ay.values())t.target===e&&(t.removed=!0)}function BFe(){let e=10;for(;SF&&e--;){SF=null;const t=GFe(),r=U$.acquire();for(const i of t){const n=i.uid;zFe(i),n===i.uid&&i.removed&&r.push(i)}for(const i of ay)i.removed&&(r.push(i),ay.delete(i));for(const i of r)K7.pool.release(i);U$.release(r),U$.release(t),iX.forEach(i=>i())}}function GFe(){const e=U$.acquire();e.length=ay.size;let t=0;for(const r of ay)e[t]=r,++t;return ay.clear(),e}const iX=new Set;function r3e(e){return iX.add(e),{remove(){iX.delete(e)}}}function jFe(e,t,r){let i=M2e(e,t,r,(n,s,a)=>{let o,l,c=J2e(()=>UR(n,s),(u,h)=>{n.__accessor__.destroyed||o&&o.uid!==l?i.remove():(o||(o=K7.acquireUntracked(u,a,h,n,s),l=o.uid),EF(o))});return{remove:Tte(()=>{c.remove(),o&&(o.uid!==l||o.removed||(o.removed=!0,EF(o)),o=null),i=c=null})}});return i}function qFe(e,t,r){const i=M2e(e,t,r,(n,s,a)=>{let o=!1;return Q2e(()=>UR(n,s),(l,c)=>{n.__accessor__.destroyed?i.remove():o||(o=!0,xte(c,l)||a.call(n,l,c,s,n),o=!1)})});return i}function HFe(e,t,r,i=!1){return!e.__accessor__||e.__accessor__.destroyed?{remove(){}}:i?qFe(e,t,r):jFe(e,t,r)}function WFe(e,t,r){let i,n,s=J2e(e,(a,o)=>{i&&i.uid!==n?s.remove():(i||(i=K7.acquireTracked(a,t,o,r),n=i.uid),EF(i))});return{remove:Tte(()=>{s.remove(),i&&(i.uid!==n||i.removed||(i.removed=!0,EF(i)),i=null),s=null})}}function XFe(e,t,r){let i=!1;return Q2e(e,(n,s)=>{i||(i=!0,r(s,n)||t(n,s),i=!1)})}function YFe(e,t,r=!1,i=eFe){return r?XFe(e,t,i):WFe(e,t,i)}function sce(e){return z$(ay,t=>t.oldValue===e)}function vs(e,t){for(const[r,i]of e)if(t(i,r))return!0;return!1}function NPt(e,t){for(const[r,i]of e)if(t(i,r))return i;return null}function Ote(e,t,r){const i=e.get(t);if(i!==void 0)return i;const n=r();return e.set(t,n),n}const B4=fe.getLogger("esri.core.Accessor");function ZFe(e){return e==null?e:new Date(e)}function QFe(e){return e==null?e:!!e}function WR(e){return e==null?e:e.toString()}function Eh(e){return e==null?e:(e=parseFloat(e),isNaN(e)?0:e)}function Mte(e){return e==null?e:Math.round(parseFloat(e))}function i3e(e){return e&&e.constructor&&e.constructor.__accessorMetadata__!==void 0}function CF(e,t){return t!=null&&e&&!(t instanceof e)}function n3e(e){return e&&"isCollection"in e}function ace(e){return e&&e.Type?typeof e.Type=="function"?e.Type:e.Type.base:null}function JFe(e,t){if(!t||!t.constructor||!n3e(t.constructor))return nX(e,t)?t:new e(t);const r=ace(e.prototype.itemType),i=ace(t.constructor.prototype.itemType);return r?i?r===i?t:r.prototype.isPrototypeOf(i.prototype)?new e(t):(nX(e,t),t):new e(t):t}function nX(e,t){return!!i3e(t)&&(B4.error("Accessor#set","Assigning an instance of '"+(t.declaredClass||"unknown")+"' which is not a subclass of '"+cV(e)+"'"),!0)}function M5(e,t){return t==null?t:n3e(e)?JFe(e,t):CF(e,t)?nX(e,t)?t:new e(t):t}function cV(e){return e&&e.prototype&&e.prototype.declaredClass||"unknown"}const KFe=new WeakMap;function eNe(e){switch(e){case Number:return Eh;case $i:return Mte;case Boolean:return QFe;case String:return WR;case Date:return ZFe;default:return Ote(KFe,e,()=>M5.bind(null,e))}}function rs(e,t){const r=eNe(e);return arguments.length===1?r:r(t)}function eA(e,t,r){return arguments.length===1?eA.bind(null,e):t&&(Array.isArray(t)?t.map(i=>e(i,r)):[e(t,r)])}function tNe(e,t){return arguments.length===1?eA(rs.bind(null,e)):eA(rs.bind(null,e),t)}function s3e(e,t,r){return t!==0&&Array.isArray(r)?r.map(i=>s3e(e,t-1,i)):e(r)}function AF(e,t,r){if(arguments.length===2)return AF.bind(null,e,t);if(!r)return r;let i=t,n=r=s3e(e,t,r);for(;i>0&&Array.isArray(n);)i--,n=n[0];if(n!==void 0)for(let s=0;s<i;s++)r=[r];return r}function rNe(e,t,r){return arguments.length===2?AF(rs.bind(null,e),t):AF(rs.bind(null,e),t,r)}function a3e(e){return!!Array.isArray(e)&&!e.some(t=>{const r=typeof t;return!(r==="string"||r==="number"||r==="function"&&e.length>1)})}function sX(e,t){if(arguments.length===2)return sX(e).call(null,t);const r=new Set,i=e.filter(o=>typeof o!="function"),n=e.filter(o=>typeof o=="function");for(const o of e)typeof o!="string"&&typeof o!="number"||r.add(o);let s=null,a=null;return(o,l)=>{if(o==null)return o;const c=typeof o,u=c==="string"||c==="number";return u&&(r.has(o)||n.some(h=>c==="string"&&h===String||c==="number"&&h===Number))||c==="object"&&n.some(h=>!CF(o,h))?o:(u&&i.length?(s||(s=i.map(h=>typeof h=="string"?`'${h}'`:`${h}`).join(", ")),B4.error("Accessor#set",`'${o}' is not a valid value for this property, only the following values are valid: ${s}`)):typeof o=="object"&&n.length?(a||(a=n.map(h=>cV(h)).join(", ")),B4.error("Accessor#set",`'${o}' is not a valid value for this property, value must be one of ${a}`)):B4.error("Accessor#set",`'${o}' is not a valid value for this property`),l&&(l.valid=!1),null)}}function Mp(e,t){if(arguments.length===2)return Mp(e).call(null,t);const r={},i=[],n=[];for(const l in e.typeMap){const c=e.typeMap[l];r[l]=rs(c),i.push(cV(c)),n.push(l)}const s=()=>`'${i.join("', '")}'`,a=()=>`'${n.join("', '")}'`,o=typeof e.key=="string"?l=>l[e.key]:e.key;return l=>{if(e.base&&!CF(e.base,l)||l==null)return l;const c=o(l)||e.defaultKeyValue,u=r[c];if(!u)return B4.error("Accessor#set",`Invalid property value, value needs to be one of ${s()}, or a plain object that can autocast (having .type = ${a()})`),null;if(!CF(e.typeMap[c],l))return l;if(typeof e.key=="string"&&!i3e(l)){const h={};for(const p in l)p!==e.key&&(h[p]=l[p]);return u(h)}return u(l)}}class $i{}const kPt={native:e=>({type:"native",value:e}),array:e=>({type:"array",value:e}),oneOf:e=>({type:"one-of",values:e})};function iNe(e){if(!e||!("type"in e))return!1;switch(e.type){case"native":case"array":case"one-of":return!0}return!1}function o3e(e){switch(e.type){case"native":return rs(e.value);case"array":return eA(o3e(e.value));case"one-of":return nNe(e);default:return null}}function nNe(e){let t=null;return(r,i)=>oX(r,e)?r:(t==null&&(t=aX(e)),B4.error("Accessor#set",`Invalid property value, value needs to be of type ${t}`),i&&(i.valid=!1),null)}function aX(e){switch(e.type){case"native":switch(e.value){case Number:return"number";case String:return"string";case Boolean:return"boolean";case $i:return"integer";case Date:return"date";default:return cV(e.value)}case"array":return`array of ${aX(e.value)}`;case"one-of":{const t=e.values.map(r=>aX(r));return`one of ${t.slice(0,t.length-1)} or ${t[t.length-1]}`}}return"unknown"}function oX(e,t){if(e==null)return!0;switch(t.type){case"native":switch(t.value){case Number:case $i:return typeof e=="number";case Boolean:return typeof e=="boolean";case String:return typeof e=="string"}return e instanceof t.value;case"array":return!!Array.isArray(e)&&!e.some(r=>!oX(r,t.value));case"one-of":return t.values.some(r=>oX(e,r))}}function f(e={}){return(t,r)=>{if(t===Function.prototype)throw new Error(`Inappropriate use of @property() on a static field: ${t.name}.${r}. Accessor does not support static properties.`);const i=Object.getOwnPropertyDescriptor(t,r),n=GR(t,r);i&&(i.get||i.set?(n.get=i.get||n.get,n.set=i.set||n.set):"value"in i&&("value"in e&&fe.getLogger("esri.core.accessorSupport.decorators.property").warn(`@property() will redefine the value of "${r}" on "${t.constructor.name}" already defined in the metadata`,e),n.value=e.value=i.value)),e.readOnly!=null&&(n.readOnly=e.readOnly);const s=e.aliasOf;if(s){const l=typeof s=="string"?s:s.source,c=typeof s=="string"?null:s.overridable===!0;let u;n.dependsOn=[l],n.get=function(){let h=yF(this,l);if(typeof h=="function"){u||(u=l.split(".").slice(0,-1).join("."));const p=yF(this,u);p&&(h=h.bind(p))}return h},n.readOnly||(n.set=c?function(h){h!==void 0?this._override(r,h):this._clearOverride(r)}:function(h){_F(this,l,h)})}const a=e.type,o=e.types;n.cast||(a?n.cast=sNe(a):o&&(Array.isArray(o)?n.cast=eA(Mp(o[0])):n.cast=Mp(o))),e.range&&(n.cast=aNe(n.cast,e.range)),oFe(n,e)}}function Pte(e,t,r){const i=GR(e,r);i.json||(i.json={});let n=i.json;return t!==void 0&&(n.origins||(n.origins={}),n.origins[t]||(n.origins[t]={}),n=n.origins[t]),n}function sNe(e){let t=0,r=e;if(iNe(e))return o3e(e);for(;Array.isArray(r)&&r.length===1&&typeof r[0]!="string"&&typeof r[0]!="number";)r=r[0],t++;const i=r;if(a3e(i))return t===0?sX(i):AF(sX(i),t);if(t===1)return tNe(i);if(t>1)return rNe(i,t);const n=e;return n.from?n.from:rs(n)}function aNe(e,t){return r=>{let i=+e(r);return t.step!=null&&(i=Math.round(i/t.step)*t.step),t.min!=null&&(i=Math.max(t.min,i)),t.max!=null&&(i=Math.min(t.max,i)),i}}function oNe(e){if(e.json&&e.json.origins){const t=e.json.origins,r={"web-document":["web-scene","web-map"]};for(const i in r)if(t[i]){const n=t[i];r[i].forEach(s=>{t[s]=n}),delete t[i]}}}class cc extends nV{constructor(t,r,i){if(super(t,r,i),!(this instanceof cc))return new cc(t,r,i)}}cc.prototype.type="warning";function l3e(e){return!!e&&e.prototype&&e.prototype.declaredClass&&e.prototype.declaredClass.indexOf("esri.core.Collection")===0}const lX=fe.getLogger("esri.core.accessorSupport.extensions.serializableProperty.reader");function oce(e,t,r){var i,n;e&&(!r&&!t.read||((i=t.read)==null?void 0:i.reader)||((n=t.read)==null?void 0:n.enabled)===!1||dNe(e)&&ud("read.reader",Y9(e),t))}function Y9(e){var r,i,n;const t=(r=e.ndimArray)!=null?r:0;if(t>1)return cNe(e);if(t===1)return lce(e);if("type"in e&&d3e(e.type)){const s=(n=(i=e.type.prototype)==null?void 0:i.itemType)==null?void 0:n.Type,a=lce(typeof s=="function"?{type:s}:{types:s});return(o,l,c)=>{const u=a(o,l,c);return u&&new e.type(u)}}return Ite(e)}function Ite(e){return"type"in e?lNe(e.type):uNe(e.types)}function lNe(e){return e.prototype.read?(t,r,i)=>{if(t==null)return t;const n=typeof t;if(n!=="object")return void lX.error(`Expected JSON value of type 'object' to deserialize type '${e.prototype.declaredClass}', but got '${n}'`);const s=new e;return s.read(t,i),s}:e.fromJSON}function c3e(e,t,r,i){return i!==0&&Array.isArray(t)?t.map(n=>c3e(e,n,r,i-1)):e(t,void 0,r)}function cNe(e){var n;const t=Ite(e),r=c3e.bind(null,t),i=(n=e.ndimArray)!=null?n:0;return(s,a,o)=>{if(s==null)return s;s=r(s,o,i);let l=i,c=s;for(;l>0&&Array.isArray(c);)l--,c=c[0];if(c!==void 0)for(let u=0;u<l;u++)s=[s];return s}}function lce(e){const t=Ite(e);return(r,i,n)=>{if(r==null)return r;if(Array.isArray(r)){const a=[];for(const o of r){const l=t(o,void 0,n);l!==void 0&&a.push(l)}return a}const s=t(r,void 0,n);return s!==void 0?[s]:void 0}}function d3e(e){if(!l3e(e))return!1;const t=e.prototype.itemType;return!(!t||!t.Type)&&(typeof t.Type=="function"?$te(t.Type):u3e(t.Type))}function dNe(e){return"types"in e?u3e(e.types):$te(e.type)}function $te(e){return!Array.isArray(e)&&!!e&&e.prototype&&("read"in e.prototype||"fromJSON"in e||d3e(e))}function u3e(e){for(const t in e.typeMap)if(!$te(e.typeMap[t]))return!1;return!0}function uNe(e){var i;let t=null;const r=(i=e.errorContext)!=null?i:"type";return(n,s,a)=>{if(n==null)return n;const o=typeof n;if(o!=="object")return void lX.error(`Expected JSON value of type 'object' to deserialize, but got '${o}'`);t||(t=hNe(e));const l=e.key;if(typeof l!="string")return;const c=n[l],u=c?t[c]:e.defaultKeyValue?e.typeMap[e.defaultKeyValue]:void 0;if(!u){const p=`Type '${c||"unknown"}' is not supported`;return a&&a.messages&&n&&a.messages.push(new cc(`${r}:unsupported`,p,{definition:n,context:a})),void lX.error(p)}const h=new u;return h.read(n,a),h}}function hNe(e){var r,i;const t={};for(const n in e.typeMap){const s=e.typeMap[n],a=BR(s.prototype);if(typeof e.key=="function")continue;const o=a.properties[e.key];if(!o)continue;((r=o.json)==null?void 0:r.type)&&Array.isArray(o.json.type)&&o.json.type.length===1&&typeof o.json.type[0]=="string"&&(t[o.json.type[0]]=s);const l=(i=o.json)==null?void 0:i.write;if(!l||!l.writer){t[n]=s;continue}const c=l.target,u=typeof c=="string"?c:e.key,h={};l.writer(n,h,u),h[u]&&(t[h[u]]=s)}return t}function fNe(e){if(e.json||(e.json={}),dce(e.json),uce(e.json),cce(e.json),e.json.origins)for(const t in e.json.origins)dce(e.json.origins[t]),uce(e.json.origins[t]),cce(e.json.origins[t]);return!0}function cce(e){e.name&&(e.read&&typeof e.read=="object"?e.read.source===void 0&&(e.read.source=e.name):e.read={source:e.name},e.write&&typeof e.write=="object"?e.write.target===void 0&&(e.write.target=e.name):e.write={target:e.name})}function dce(e){typeof e.read=="boolean"?e.read={enabled:e.read}:typeof e.read=="function"?e.read={enabled:!0,reader:e.read}:e.read&&typeof e.read=="object"&&e.read.enabled===void 0&&(e.read.enabled=!0)}function uce(e){typeof e.write=="boolean"?e.write={enabled:e.write}:typeof e.write=="function"?e.write={enabled:!0,writer:e.write}:e.write&&typeof e.write=="object"&&e.write.enabled===void 0&&(e.write.enabled=!0)}const pNe=fe.getLogger("esri.core.accessorSupport.extensions.serializableProperty.writer");function hce(e,t){var i;if(!t.write||t.write.writer||t.write.enabled===!1&&!t.write.overridePolicy)return;const r=(i=e==null?void 0:e.ndimArray)!=null?i:0;e&&(r===1||"type"in e&&l3e(e.type))?t.write.writer=yNe:r>1?t.write.writer=bNe(r):t.types?Array.isArray(t.types)?t.write.writer=gNe(t.types[0]):t.write.writer=mNe(t.types):t.write.writer=tA}function mNe(e){return(t,r,i,n)=>t?h3e(t,e,n)?tA(t,r,i,n):void 0:tA(t,r,i,n)}function h3e(e,t,r){var i,n;for(const s in t.typeMap)if(e instanceof t.typeMap[s])return!0;if(r!=null&&r.messages){const s=(i=t.errorContext)!=null?i:"type",a=`Values of type '${(n=typeof t.key!="function"?e[t.key]:e.declaredClass)!=null?n:"Unknown"}' cannot be written`;r&&r.messages&&e&&r.messages.push(new k(`${s}:unsupported`,a,{definition:e,context:r})),pNe.error(a)}return!1}function gNe(e){return(t,r,i,n)=>!t||!Array.isArray(t)?tA(t,r,i,n):tA(t.filter(s=>h3e(s,e,n)),r,i,n)}function tA(e,t,r,i){ud(r,RF(e,i),t)}function RF(e,t){return e&&typeof e.write=="function"?e.write({},t):e&&typeof e.toJSON=="function"?e.toJSON():typeof e=="number"?OF(e):e}function OF(e){return e===-1/0?-Number.MAX_VALUE:e===1/0?Number.MAX_VALUE:isNaN(e)?null:e}function yNe(e,t,r,i){let n;e===null?n=null:e&&typeof e.map=="function"?(n=e.map(s=>RF(s,i)),typeof n.toArray=="function"&&(n=n.toArray())):n=[RF(e,i)],ud(r,n,t)}function f3e(e,t,r){return r!==0&&Array.isArray(e)?e.map(i=>f3e(i,t,r-1)):RF(e,t)}function bNe(e){return(t,r,i,n)=>{let s;if(t===null)s=null;else{s=f3e(t,n,e);let a=e,o=s;for(;a>0&&Array.isArray(o);)a--,o=o[0];if(o!==void 0)for(let l=0;l<a;l++)s=[s]}ud(i,s,r)}}function cX(e,t){return Lte(e,"read",t)}function p3e(e,t){return Lte(e,"write",t)}function Lte(e,t,r){let i=e&&e.json;if(e&&e.json&&e.json.origins&&r){const n=e.json.origins[r.origin];n&&(t==="any"||t in n)&&(i=n)}return i}function vNe(e){const t=_Ne(e);if(e.json.origins)for(const r in e.json.origins){const i=e.json.origins[r],n=i.types?wNe(i):t;oce(n,i,!1),i.types&&!i.write&&e.json.write&&e.json.write.enabled&&(i.write={...e.json.write}),hce(n,i)}oce(t,e.json,!0),hce(t,e.json)}function _Ne(e){return e.json.types?dX(e.json):e.type?m3e(e):dX(e)}function wNe(e){return e.type?m3e(e):dX(e)}function m3e(e){if(!e.type)return;let t=0,r=e.type;for(;Array.isArray(r)&&!a3e(r);)r=r[0],t++;return{type:r,ndimArray:t}}function dX(e){if(!e.types)return;let t=0,r=e.types;for(;Array.isArray(r);)r=r[0],t++;return{types:r,ndimArray:t}}function xNe(e){fNe(e)&&(oNe(e),vNe(e))}const jB=new Set,qB=new Set;function $(e){return t=>{t.prototype.declaredClass=e,SNe(t);const r=[],i=[];let n=t.prototype;for(;n;)n.hasOwnProperty("initialize")&&!jB.has(n.initialize)&&(jB.add(n.initialize),r.push(n.initialize)),n.hasOwnProperty("destroy")&&!qB.has(n.destroy)&&(qB.add(n.destroy),i.push(n.destroy)),n=Object.getPrototypeOf(n);jB.clear(),qB.clear();class s extends t{constructor(...o){if(super(...o),this.constructor===s&&typeof this.postscript=="function"){if(r.length&&Object.defineProperty(this,"initialize",{enumerable:!1,configurable:!0,value(){for(let l=r.length-1;l>=0;l--)r[l].call(this)}}),i.length){let l=!1;Object.defineProperty(this,"destroy",{enumerable:!1,configurable:!0,value(){if(!l){l=!0;for(let c=0;c<i.length;c++)i[c].call(this)}}})}this.postscript(...o)}}}return s.__accessorMetadata__=BR(t.prototype),s.prototype.declaredClass=e,s}}function TNe(e,t){return t.get==null?function(){const r=this.__accessor__.properties.get(e);if(r===void 0)return;nr(r);const i=this.__accessor__.store;return i.has(e)?i.get(e):r.metadata.value}:function(){const r=this.__accessor__.properties.get(e);if(r!==void 0)return r.getComputed()}}function SNe(e){const t=e.prototype,r=BR(t).properties,i={};for(const n of Object.getOwnPropertyNames(r)){const s=r[n];xNe(s),i[n]={enumerable:!0,configurable:!0,get:TNe(n,s),set(a){const o=this.__accessor__;if(o!==void 0){if(!Object.isFrozen(this)){if(o.initialized&&s.readOnly)throw new TypeError(`[accessor] cannot assign to read-only property '${n}' of ${this.declaredClass}`);if(o.lifecycle===G0.CONSTRUCTED&&s.constructOnly)throw new TypeError(`[accessor] cannot assign to construct-only property '${n}' of ${this.declaredClass}`);o.set(n,a)}}else Object.defineProperty(this,n,{enumerable:!0,configurable:!0,writable:!0,value:a})}}}Object.defineProperties(e.prototype,i)}var g3e;function ENe(e){var t;if(e==null)return{value:e};if(Array.isArray(e))return{type:[e[0]],value:null};switch(typeof e){case"object":return((t=e.constructor)==null?void 0:t.__accessorMetadata__)||e instanceof Date?{type:e.constructor,value:e}:e;case"boolean":return{type:Boolean,value:e};case"string":return{type:String,value:e};case"number":return{type:Number,value:e};case"function":return{type:e,value:null};default:return}}const nE=Symbol("Accessor-Handles");class xe{constructor(...t){if(this[g3e]=null,this.constructor===xe)throw new Error("[accessor] cannot instantiate Accessor. This can be fixed by creating a subclass of Accessor");Object.defineProperty(this,"__accessor__",{enumerable:!1,value:new gFe(this)}),t.length>0&&this.normalizeCtorArgs&&(this.__accessor__.ctorArgs=this.normalizeCtorArgs.apply(this,t))}static createSubclass(t={}){if(Array.isArray(t))throw new Error("Multi-inheritance unsupported since 4.16");const{properties:r,declaredClass:i,constructor:n}=t;delete t.declaredClass,delete t.properties,delete t.constructor;const s=this;class a extends s{constructor(...l){super(...l),this.inherited=null,n&&n.apply(this,l)}}BR(a.prototype);for(const o in t){const l=t[o];a.prototype[o]=typeof l=="function"?function(...c){const u=this.inherited;let h;this.inherited=function(...p){if(s.prototype[o])return s.prototype[o].apply(this,p)};try{h=l.apply(this,c)}catch(p){throw this.inherited=u,p}return this.inherited=u,h}:t[o]}for(const o in r){const l=ENe(r[o]);f(l)(a.prototype,o)}return $(i)(a)}postscript(t){const r=this.__accessor__,i=r.ctorArgs||t;r.initialize(),i&&(this.set(i),r.ctorArgs=null),r.constructed(),this.initialize()}initialize(){}destroy(){this.destroyed||(ys(this[nE],t=>{t.forEach(r=>r.remove())}),this[nE]=null,UFe(this),this.__accessor__.destroy())}get initialized(){return this.__accessor__&&this.__accessor__.initialized||!1}get constructed(){return this.__accessor__&&this.__accessor__.lifecycle===G0.CONSTRUCTED||!1}get destroyed(){return this.__accessor__&&this.__accessor__.destroyed||!1}commitProperty(t){this.get(t)}get(t){return yF(this,t)}hasOwnProperty(t){return this.__accessor__?this.__accessor__.has(t):Object.prototype.hasOwnProperty.call(this,t)}keys(){return this.__accessor__?this.__accessor__.keys():[]}set(t,r){return _F(this,t,r),this}watch(t,r,i){return HFe(this,t,r,i)}own(t){let r=this[nE];if(R(r)&&(r=this[nE]=new Set),f2e(t))for(const i of t)r.add(i);else r.add(t)}_clearOverride(t){return this.__accessor__.clearOverride(t)}_override(t,r){return this.__accessor__.override(t,r)}_isOverridden(t){return this.__accessor__.isOverridden(t)}notifyChange(t){this.__accessor__.notifyChange(t)}_get(t){return this.__accessor__.internalGet(t)}_set(t,r){return this.__accessor__.internalSet(t,r),this}}g3e=nE;class G4{constructor(){this._emitter=new G4.EventEmitter(this)}emit(t,r){return this._emitter.emit(t,r)}on(t,r){return this._emitter.on(t,r)}once(t,r){return this._emitter.once(t,r)}hasEventListener(t){return this._emitter.hasEventListener(t)}}(function(e){class t{constructor(n=null){this.target=n,this._listenersMap=null}clear(){this._listenersMap&&this._listenersMap.clear(),this._listenersMap=null}emit(n,s){const a=this._listenersMap&&this._listenersMap.get(n);if(!a)return!1;const o=this.target||this;return[...a].forEach(l=>{l.call(o,s)}),a.length>0}on(n,s){if(Array.isArray(n)){const o=n.map(l=>this.on(l,s));return A5(o)}if(n.includes(","))throw new TypeError("Evented.on() with a comma delimited string of event types is not supported");this._listenersMap||(this._listenersMap=new Map);const a=this._listenersMap.get(n)||[];return a.push(s),this._listenersMap.set(n,a),{remove:()=>{const o=this._listenersMap&&this._listenersMap.get(n)||[],l=o.indexOf(s);l>=0&&o.splice(l,1)}}}once(n,s){const a=this.on(n,o=>{a.remove(),s.call(null,o)});return a}hasEventListener(n){const s=this._listenersMap&&this._listenersMap.get(n);return s!=null&&s.length>0}}e.EventEmitter=t,e.EventedMixin=i=>{let n=class extends i{constructor(){super(...arguments),this._emitter=new t}destroy(){this._emitter.clear()}emit(s,a){return this._emitter.emit(s,a)}on(s,a){return this._emitter.on(s,a)}once(s,a){return this._emitter.once(s,a)}hasEventListener(s){return this._emitter.hasEventListener(s)}};return n=d([$("esri.core.Evented")],n),n};let r=class extends xe{constructor(){super(...arguments),this._emitter=new G4.EventEmitter(this)}destroy(){this._emitter.clear()}emit(i,n){return this._emitter.emit(i,n)}on(i,n){return this._emitter.on(i,n)}once(i,n){return this._emitter.once(i,n)}hasEventListener(i){return this._emitter.hasEventListener(i)}};r=d([$("esri.core.Evented")],r),e.EventedAccessor=r})(G4||(G4={}));const mn=G4;var Jr;(function(e){e[e.ADD=1]="ADD",e[e.REMOVE=2]="REMOVE",e[e.MOVE=4]="MOVE"})(Jr||(Jr={}));function Dte(e){return(t,r)=>{t[r]=e}}class y3e{constructor(){this._observers=[]}observe(t){return this._observers.includes(t)||this._observers.push(t),new U2e(this._observers,t)}notify(){const t=this._observers.slice();for(let r=0;r<t.length;++r){const i=t[r];i.onInvalidated(),i.onCommitted()}}}var Ug;class CNe{constructor(){this.target=null,this.cancellable=!1,this.defaultPrevented=!1,this.item=void 0,this.type=void 0}preventDefault(){this.cancellable&&(this.defaultPrevented=!0)}reset(t){this.defaultPrevented=!1,this.item=t}}const Vu=new Fn(CNe,void 0,e=>{e.item=null,e.target=null,e.defaultPrevented=!1,e.cancellable=!1}),ANe=()=>{};function HB(e){return e?e instanceof m3?e.toArray():e.length?Array.prototype.slice.apply(e):[]:[]}function WB(e){if(e&&e.length)return e[0]}function RNe(e,t,r,i){const n=Math.min(e.length-r,t.length-i);let s=0;for(;s<n&&e[r+s]===t[i+s];)s++;return s}function b3e(e,t,r,i){t&&t.forEach((n,s,a)=>{e.push(n),b3e(e,r.call(i,n,s,a),r,i)})}const nb=new Set,sb=new Set,ab=new Set,XB=new Map;let ONe=0,m3=Ug=class extends mn.EventedAccessor{constructor(e){super(e),this._chgListeners=[],this._notifications=null,this._timer=null,this._observable=new y3e,this.length=0,this._items=[],Object.defineProperty(this,"uid",{value:ONe++})}static isCollection(e){return e!=null&&e instanceof Ug}normalizeCtorArgs(e){return e?Array.isArray(e)||e instanceof Ug?{items:e}:e:{}}destroy(){this.removeAll()}*[Symbol.iterator](){yield*this.items}get items(){return nr(this._observable),this._items}set items(e){this._emitBeforeChanges(Jr.ADD)||(this._splice(0,this.length,HB(e)),this._emitAfterChanges(Jr.ADD))}hasEventListener(e){return e==="change"?this._chgListeners.length>0:this._emitter.hasEventListener(e)}on(e,t){if(e==="change"){const r=this._chgListeners,i={removed:!1,callback:t};return r.push(i),this._notifications&&this._notifications.push({listeners:r.slice(),items:this._items.slice(),changes:[]}),{remove(){this.remove=ANe,i.removed=!0,r.splice(r.indexOf(i),1)}}}return this._emitter.on(e,t)}once(e,t){const r=this.on(e,t);return{remove(){r.remove()}}}add(e,t){if(nr(this._observable),this._emitBeforeChanges(Jr.ADD))return this;const r=this.getNextIndex(t!=null?t:null);return this._splice(r,0,[e]),this._emitAfterChanges(Jr.ADD),this}addMany(e,t=this._items.length){if(nr(this._observable),!e||!e.length)return this;if(this._emitBeforeChanges(Jr.ADD))return this;const r=this.getNextIndex(t);return this._splice(r,0,HB(e)),this._emitAfterChanges(Jr.ADD),this}at(e){if(nr(this._observable),(e=Math.trunc(e)||0)<0&&(e+=this.length),!(e<0||e>=this.length))return this._items[e]}removeAll(){if(nr(this._observable),!this.length||this._emitBeforeChanges(Jr.REMOVE))return[];const e=this._splice(0,this.length)||[];return this._emitAfterChanges(Jr.REMOVE),e}clone(){return nr(this._observable),this._createNewInstance({items:this._items.map(te)})}concat(...e){nr(this._observable);const t=e.map(HB);return this._createNewInstance({items:this._items.concat(...t)})}drain(e,t){if(nr(this._observable),!this.length||this._emitBeforeChanges(Jr.REMOVE))return;const r=this._splice(0,this.length),i=r.length;for(let n=0;n<i;n++)e.call(t,r[n],n,r);this._emitAfterChanges(Jr.REMOVE)}every(e,t){return nr(this._observable),this._items.every(e,t)}filter(e,t){let r;return nr(this._observable),r=arguments.length===2?this._items.filter(e,t):this._items.filter(e),this._createNewInstance({items:r})}find(e,t){return nr(this._observable),this._items.find(e,t)}findIndex(e,t){return nr(this._observable),this._items.findIndex(e,t)}flatten(e,t){nr(this._observable);const r=[];return b3e(r,this,e,t),new Ug(r)}forEach(e,t){return nr(this._observable),this._items.forEach(e,t)}getItemAt(e){return nr(this._observable),this._items[e]}getNextIndex(e){nr(this._observable);const t=this.length;return(e=e==null?t:e)<0?e=0:e>t&&(e=t),e}includes(e,t=0){return nr(this._observable),this._items.includes(e,t)}indexOf(e,t=0){return nr(this._observable),this._items.indexOf(e,t)}join(e=","){return nr(this._observable),this._items.join(e)}lastIndexOf(e,t=this.length-1){return nr(this._observable),this._items.lastIndexOf(e,t)}map(e,t){nr(this._observable);const r=this._items.map(e,t);return new Ug({items:r})}reorder(e,t=this.length-1){nr(this._observable);const r=this.indexOf(e);if(r!==-1){if(t<0?t=0:t>=this.length&&(t=this.length-1),r!==t){if(this._emitBeforeChanges(Jr.MOVE))return e;this._splice(r,1),this._splice(t,0,[e]),this._emitAfterChanges(Jr.MOVE)}return e}}pop(){if(nr(this._observable),!this.length||this._emitBeforeChanges(Jr.REMOVE))return;const e=WB(this._splice(this.length-1,1));return this._emitAfterChanges(Jr.REMOVE),e}push(...e){return nr(this._observable),this._emitBeforeChanges(Jr.ADD)||(this._splice(this.length,0,e),this._emitAfterChanges(Jr.ADD)),this.length}reduce(e,t){nr(this._observable);const r=this._items;return arguments.length===2?r.reduce(e,t):r.reduce(e)}reduceRight(e,t){nr(this._observable);const r=this._items;return arguments.length===2?r.reduceRight(e,t):r.reduceRight(e)}remove(e){return nr(this._observable),this.removeAt(this.indexOf(e))}removeAt(e){if(nr(this._observable),e<0||e>=this.length||this._emitBeforeChanges(Jr.REMOVE))return;const t=WB(this._splice(e,1));return this._emitAfterChanges(Jr.REMOVE),t}removeMany(e){if(nr(this._observable),!e||!e.length||this._emitBeforeChanges(Jr.REMOVE))return[];const t=e instanceof Ug?e.toArray():e,r=this._items,i=[],n=t.length;for(let s=0;s<n;s++){const a=t[s],o=r.indexOf(a);if(o>-1){const l=1+RNe(t,r,s+1,o+1),c=this._splice(o,l);c&&c.length>0&&i.push.apply(i,c),s+=l-1}}return this._emitAfterChanges(Jr.REMOVE),i}reverse(){if(nr(this._observable),this._emitBeforeChanges(Jr.MOVE))return this;const e=this._splice(0,this.length);return e&&(e.reverse(),this._splice(0,0,e)),this._emitAfterChanges(Jr.MOVE),this}shift(){if(nr(this._observable),!this.length||this._emitBeforeChanges(Jr.REMOVE))return;const e=WB(this._splice(0,1));return this._emitAfterChanges(Jr.REMOVE),e}slice(e=0,t=this.length){return nr(this._observable),this._createNewInstance({items:this._items.slice(e,t)})}some(e,t){return nr(this._observable),this._items.some(e,t)}sort(e){if(nr(this._observable),!this.length||this._emitBeforeChanges(Jr.MOVE))return this;const t=this._splice(0,this.length);return arguments.length?t.sort(e):t.sort(),this._splice(0,0,t),this._emitAfterChanges(Jr.MOVE),this}splice(e,t,...r){nr(this._observable);const i=(t?Jr.REMOVE:0)|(r.length?Jr.ADD:0);if(this._emitBeforeChanges(i))return[];const n=this._splice(e,t,r)||[];return this._emitAfterChanges(i),n}toArray(){return nr(this._observable),this._items.slice()}toJSON(){return nr(this._observable),this.toArray()}toLocaleString(){return nr(this._observable),this._items.toLocaleString()}toString(){return nr(this._observable),this._items.toString()}unshift(...e){return nr(this._observable),!e.length||this._emitBeforeChanges(Jr.ADD)||(this._splice(0,0,e),this._emitAfterChanges(Jr.ADD)),this.length}_createNewInstance(e){return new this.constructor(e)}_splice(e,t,r){const i=this._items,n=this.itemType;let s,a;if(!this._notifications&&this.hasEventListener("change")&&(this._notifications=[{listeners:this._chgListeners.slice(),items:this._items.slice(),changes:[]}],this._timer&&this._timer.remove(),this._timer=X9(()=>this._dispatchChange())),t){if(a=i.splice(e,t),this.hasEventListener("before-remove")){const o=Vu.acquire();o.target=this,o.cancellable=!0;for(let l=0,c=a.length;l<c;l++)s=a[l],o.reset(s),this.emit("before-remove",o),o.defaultPrevented&&(a.splice(l,1),i.splice(e,0,s),e+=1,l-=1,c-=1);Vu.release(o)}if(this.length=this._items.length,this.hasEventListener("after-remove")){const o=Vu.acquire();o.target=this,o.cancellable=!1;const l=a.length;for(let c=0;c<l;c++)o.reset(a[c]),this.emit("after-remove",o);Vu.release(o)}}if(r&&r.length){if(n){const u=[];for(const h of r){const p=n.ensureType(h);p==null&&h!=null||u.push(p)}r=u}const o=this.hasEventListener("before-add"),l=this.hasEventListener("after-add"),c=e===this.length;if(o||l){const u=Vu.acquire();u.target=this,u.cancellable=!0;const h=Vu.acquire();h.target=this,h.cancellable=!1;for(const p of r)o?(u.reset(p),this.emit("before-add",u),u.defaultPrevented||(c?i.push(p):i.splice(e++,0,p),this._set("length",i.length),l&&(h.reset(p),this.emit("after-add",h)))):(c?i.push(p):i.splice(e++,0,p),this._set("length",i.length),h.reset(p),this.emit("after-add",h));Vu.release(h),Vu.release(u)}else{if(c)for(const u of r)i.push(u);else i.splice(e,0,...r);this._set("length",i.length)}}return(r&&r.length||a&&a.length)&&this._notifyChangeEvent(r,a),a}_emitBeforeChanges(e){let t=!1;if(this.hasEventListener("before-changes")){const r=Vu.acquire();r.target=this,r.cancellable=!0,r.type=e,this.emit("before-changes",r),t=r.defaultPrevented,Vu.release(r)}return t}_emitAfterChanges(e){if(this.hasEventListener("after-changes")){const t=Vu.acquire();t.target=this,t.cancellable=!1,t.type=e,this.emit("after-changes",t),Vu.release(t)}this._observable.notify()}_notifyChangeEvent(e,t){this.hasEventListener("change")&&this._notifications&&this._notifications[this._notifications.length-1].changes.push({added:e,removed:t})}_dispatchChange(){if(this._timer&&(this._timer.remove(),this._timer=null),!this._notifications)return;const e=this._notifications;this._notifications=null;for(const t of e){const r=t.changes;nb.clear(),sb.clear(),ab.clear();for(const{added:l,removed:c}of r){if(l)if(ab.size===0&&sb.size===0)for(const u of l)nb.add(u);else for(const u of l)sb.has(u)?(ab.add(u),sb.delete(u)):ab.has(u)||nb.add(u);if(c)if(ab.size===0&&nb.size===0)for(const u of c)sb.add(u);else for(const u of c)nb.has(u)?nb.delete(u):(ab.delete(u),sb.add(u))}const i=Xc.acquire();nb.forEach(l=>{i.push(l)});const n=Xc.acquire();sb.forEach(l=>{n.push(l)});const s=this._items,a=t.items,o=Xc.acquire();if(ab.forEach(l=>{a.indexOf(l)!==s.indexOf(l)&&o.push(l)}),t.listeners&&(i.length||n.length||o.length)){const l={target:this,added:i,removed:n,moved:o},c=t.listeners.length;for(let u=0;u<c;u++){const h=t.listeners[u];h.removed||h.callback.call(this,l)}}Xc.release(i),Xc.release(n),Xc.release(o)}nb.clear(),sb.clear(),ab.clear()}};m3.ofType=e=>{if(!e)return Ug;if(XB.has(e))return XB.get(e);let t=null;if(typeof e=="function")t=e.prototype.declaredClass;else if(e.base)t=e.base.prototype.declaredClass;else for(const i in e.typeMap){const n=e.typeMap[i].prototype.declaredClass;t?t+=` | ${n}`:t=n}let r=class extends Ug{};return d([Dte({Type:e,ensureType:typeof e=="function"?rs(e):Mp(e)})],r.prototype,"itemType",void 0),r=d([$(`esri.core.Collection<${t}>`)],r),XB.set(e,r),r},d([f()],m3.prototype,"length",void 0),d([f()],m3.prototype,"items",null),m3=Ug=d([$("esri.core.Collection")],m3);const lt=m3;function Rw(e,t,r=lt){return t||(t=new r),t===e||(t.removeAll(),MNe(e)?t.addMany(e):e&&t.add(e)),t}function v3e(e){return e}function MNe(e){return e&&(Array.isArray(e)||"items"in e&&Array.isArray(e.items))}class Fte{constructor(){this._values=new Map,this.multipleOriginsSupported=!1}clone(t){const r=new Fte;return this._values.forEach((i,n)=>{t&&t.has(n)||r.set(n,te(i.value),i.origin)}),r}get(t,r){r=this._normalizeOrigin(r);const i=this._values.get(t);return r==null||(i==null?void 0:i.origin)===r?i==null?void 0:i.value:void 0}originOf(t){var r,i;return(i=(r=this._values.get(t))==null?void 0:r.origin)!=null?i:Gt.USER}keys(t){t=this._normalizeOrigin(t);const r=[...this._values.keys()];return t==null?r:r.filter(i=>{var n;return((n=this._values.get(i))==null?void 0:n.origin)===t})}set(t,r,i){if((i=this._normalizeOrigin(i))===Gt.DEFAULTS){const n=this._values.get(t);if(n&&n.origin!=null&&n.origin>i)return}this._values.set(t,new PNe(r,i))}delete(t,r){var i;(r=this._normalizeOrigin(r))!=null&&((i=this._values.get(t))==null?void 0:i.origin)!==r||this._values.delete(t)}has(t,r){var i;return(r=this._normalizeOrigin(r))!=null?((i=this._values.get(t))==null?void 0:i.origin)===r:this._values.has(t)}forEach(t){this._values.forEach(({value:r},i)=>t(r,i))}_normalizeOrigin(t){if(t!=null)return t===Gt.DEFAULTS?t:Gt.USER}}class PNe{constructor(t,r){this.value=t,this.origin=r}}function _3e(e,t,r){t.keys().forEach(n=>{r.set(n,t.get(n),Gt.DEFAULTS)});const i=e.metadatas;Object.keys(i).forEach(n=>{e.internalGet(n)&&r.set(n,e.internalGet(n),Gt.DEFAULTS)})}function INe(e,t,r){if(!e||!e.read||e.read.enabled===!1||!e.read.source)return!1;const i=e.read.source;if(typeof i=="string"){if(i===t||i.includes(".")&&i.indexOf(t)===0&&Xle(i,r))return!0}else for(const n of i)if(n===t||n.includes(".")&&n.indexOf(t)===0&&Xle(n,r))return!0;return!1}function $Ne(e){return e&&(!e.read||e.read.enabled!==!1&&!e.read.source)}function LNe(e,t,r,i,n){let s=cX(t[r],n);$Ne(s)&&(e[r]=!0);for(const a of Object.getOwnPropertyNames(t))s=cX(t[a],n),INe(s,r,i)&&(e[a]=!0)}function DNe(e,t,r,i){const n=r.metadatas,s=Lte(n[t],"any",i),a=s&&s.default;if(a===void 0)return;const o=typeof a=="function"?a.call(e,t,i):a;o!==void 0&&r.set(t,o)}const w3e={origin:"service"};function x3e(e,t,r=w3e){if(!t||typeof t!="object")return;const i=Do(e),n=i.metadatas,s={};for(const a of Object.getOwnPropertyNames(t))LNe(s,n,a,t,r);i.setDefaultOrigin(r.origin);for(const a of Object.getOwnPropertyNames(s)){const o=cX(n[a],r).read,l=o&&o.source;let c;c=l&&typeof l=="string"?UR(t,l):t[a],o&&o.reader&&(c=o.reader.call(e,c,t,r)),c!==void 0&&i.set(a,c)}if(!r||!r.ignoreDefaults){i.setDefaultOrigin("defaults");for(const a of Object.getOwnPropertyNames(n))s[a]||DNe(e,a,i,r)}i.setDefaultOrigin("user")}function FNe(e,t,r,i=w3e){var s;const n={...i,messages:[]};r(n),(s=n.messages)==null||s.forEach(a=>{a.type!=="warning"||e.loaded?i&&i.messages&&i.messages.push(a):e.loadWarnings.push(a)})}const NNe=fe.getLogger("esri.core.accessorSupport.write");function kNe(e,t,r,i,n){var a,o;const s={};return(o=(a=t.write)==null?void 0:a.writer)==null||o.call(e,i,s,r,n),s}function T3e(e,t,r,i,n,s){if(!i||!i.write)return!1;const a=e.get(r);if(!n&&i.write.overridePolicy){const o=i.write.overridePolicy.call(e,a,r,s);o!==void 0&&(n=o)}if(n||(n=i.write),!n||n.enabled===!1)return!1;if((a===null&&!n.allowNull&&!n.writerEnsuresNonNull||a===void 0)&&n.isRequired){const o=new k("web-document-write:property-required",`Missing value for required property '${r}' on '${e.declaredClass}'`,{propertyName:r,target:e});return o&&s&&s.messages?s.messages.push(o):o&&!s&&NNe.error(o.name,o.message),!1}return!(a===void 0||a===null&&!n.allowNull&&!n.writerEnsuresNonNull||(!t.store.multipleOriginsSupported||t.store.originOf(r)===Gt.DEFAULTS)&&VNe(e,r,s,i,a)||!n.ignoreOrigin&&s&&s.origin&&t.store.multipleOriginsSupported&&t.store.originOf(r)<Zg(s.origin))}function VNe(e,t,r,i,n){const s=i.default;if(s===void 0)return!1;if(i.defaultEquals!=null)return i.defaultEquals(n);if(typeof s=="function"){if(Array.isArray(n)){const a=s.call(e,t,r);return Gv(a,n)}return!1}return s===n}function zNe(e,t,r,i){const n=Do(e),s=n.metadatas,a=p3e(s[t],i);return!!a&&T3e(e,n,t,a,r,i)}function S3e(e,t,r){var s,a;if(e&&typeof e.toJSON=="function"&&(!e.toJSON.isDefaultToJSON||!e.write))return N$(t,e.toJSON(r));const i=Do(e),n=i.metadatas;for(const o in n){const l=p3e(n[o],r);if(!T3e(e,i,o,l,void 0,r))continue;const c=e.get(o),u=kNe(e,l,l.write&&typeof l.write.target=="string"?l.write.target:o,c,r);Object.keys(u).length>0&&(t=N$(t,u),(a=(s=r==null?void 0:r.resources)==null?void 0:s.pendingOperations)!=null&&a.length&&Promise.all(r.resources.pendingOperations).then(()=>N$(t,u)),r&&r.writtenProperties&&r.writtenProperties.push({target:e,propName:o,oldOrigin:uFe(i.store.originOf(o)),newOrigin:r.origin}))}return t}const Z9=e=>{let t=class extends e{constructor(...r){super(...r);const i=Do(this),n=i.store,s=new Fte;i.store=s,_3e(i,n,s)}read(r,i){x3e(this,r,i)}write(r={},i){return S3e(this,r,i)}toJSON(r){return this.write({},r)}static fromJSON(r,i){return UNe.call(this,r,i)}};return t=d([$("esri.core.JSONSupport")],t),t.prototype.toJSON.isDefaultToJSON=!0,t};function UNe(e,t){if(!e)return null;if(e.declaredClass)throw new Error("JSON object is already hydrated");const r=new this;return r.read(e,t),r}let ge=class extends Z9(xe){};ge=d([$("esri.core.JSONSupport")],ge);var P1;(function(e){e[e.PENDING=0]="PENDING",e[e.RESOLVED=1]="RESOLVED",e[e.REJECTED=2]="REJECTED"})(P1||(P1={}));class BNe{constructor(t){this.instance=t,this._resolver=jv(),this._status=P1.PENDING,this._resolvingPromises=[],this._resolver.promise.then(()=>{this._status=P1.RESOLVED,this._cleanUp()},()=>{this._status=P1.REJECTED,this._cleanUp()})}addResolvingPromise(t){this._resolvingPromises.push(t),this._tryResolve()}isResolved(){return this._status===P1.RESOLVED}isRejected(){return this._status===P1.REJECTED}isFulfilled(){return this._status!==P1.PENDING}abort(){this._resolver.reject(br())}when(t,r){return this._resolver.promise.then(t,r)}_cleanUp(){this._allPromise=this._resolvingPromises=this._allPromise=null}_tryResolve(){if(this.isFulfilled())return;const t=jv(),r=[...this._resolvingPromises,t.promise],i=this._allPromise=Promise.all(r);i.then(()=>{this.isFulfilled()||this._allPromise!==i||this._resolver.resolve(this.instance)},n=>{this.isFulfilled()||this._allPromise!==i||Ui(n)||this._resolver.reject(n)}),t.resolve()}}const XR=e=>{let t=class extends e{constructor(...r){super(...r),this._promiseProps=new BNe(this),this.addResolvingPromise(Promise.resolve())}isResolved(){return this._promiseProps.isResolved()}isRejected(){return this._promiseProps.isRejected()}isFulfilled(){return this._promiseProps.isFulfilled()}when(r,i){return new Promise((n,s)=>{this._promiseProps.when(n,s)}).then(r,i)}catch(r){return this.when(null,r)}addResolvingPromise(r){r&&!this._promiseProps.isFulfilled()&&this._promiseProps.addResolvingPromise("_promiseProps"in r?r.when():r)}};return t=d([$("esri.core.Promise")],t),t};let MF=class extends XR(xe){};MF=d([$("esri.core.Promise")],MF);const GNe="not-loaded",jNe="loading",qNe="failed",fce="loaded",E3e=e=>{let t=class extends e{constructor(...r){super(...r),this._loadController=null,this.loadError=null,this.loadStatus="not-loaded",this._set("loadWarnings",[]),this.addResolvingPromise(new Promise(i=>{const n=this.load.bind(this);this.load=s=>{const a=new Promise((o,l)=>{const c=Ate(s,l);this.destroyed&&l(new k("load:instance-destroyed",`Instance of '${this.declaredClass||this.constructor.name}' is already destroyed`,{instance:this})),this._promiseProps.when(o,l).finally(()=>{c&&c.remove()})});if(this.loadStatus===GNe){this._set("loadStatus",jNe);const o=this._loadController=new AbortController;n({signal:o.signal}),Fo(o.signal,()=>{this._promiseProps.abort()})}return i(),a}})),this.when(()=>{this._set("loadStatus",fce),this._loadController=null},i=>{this._set("loadStatus",qNe),this._set("loadError",i),this._loadController=null})}get loaded(){return this.loadStatus===fce}get loadWarnings(){return this._get("loadWarnings")}load(){return null}cancelLoad(){var r;return this.isFulfilled()||(this._set("loadError",new k("load:cancelled","Cancelled")),(r=this._loadController)==null||r.abort()),this}};return d([f({readOnly:!0})],t.prototype,"loaded",null),d([f({readOnly:!0})],t.prototype,"loadError",void 0),d([f({clonable:!1})],t.prototype,"loadStatus",void 0),d([f({type:[cc],readOnly:!0})],t.prototype,"loadWarnings",null),t=d([$("esri.core.Loadable")],t),t};let sE=class extends E3e(MF){};sE=d([$("esri.core.Loadable")],sE),function(e){function t(r){return!(!r||!r.load)}e.LoadableMixin=E3e,e.isLoadable=t}(sE||(sE={}));const hd=sE;function dV(e,t,r){return dn(e.map((i,n)=>t.apply(r,[i,n])))}async function HNe(e,t,r){return(await dn(e.map((i,n)=>t.apply(r,[i,n])))).map(i=>i.value)}async function Tu(e){if(R(e))return{ok:!1,error:new Error("no promise provided")};try{return{ok:!0,value:await e}}catch(t){return{ok:!1,error:t}}}async function VPt(e){try{return{ok:!0,value:await e}}catch(t){return pu(t),{ok:!1,error:t}}}function zPt(e){if(e.ok===!0)return e.value;throw e.error}async function C3e(e,t){return await e.load(),WNe(e,t)}async function WNe(e,t){const r=[],i=(...s)=>{for(const a of s)R(a)||(Array.isArray(a)?i(...a):lt.isCollection(a)?a.forEach(o=>i(o)):hd.isLoadable(a)&&r.push(a))};t(i);let n=null;if(await HNe(r,async s=>{(await Tu(XNe(s)?s.loadAll():s.load())).ok!==!1||n||(n=s)}),n)throw n.loadError;return e}function XNe(e){return"loadAll"in e&&typeof e.loadAll=="function"}const YNe=fe.getLogger("esri.core.urlUtils"),Q9=Vr.request,pce="esri/config: esriConfig.request.proxyUrl is not set.",A3e=/^\s*[a-z][a-z0-9-+.]*:(?![0-9])/i,R3e=/^\s*http:/i,ZNe=/^\s*https:/i,QNe=/^\s*file:/i,JNe=/:\d+$/,KNe=/^https?:\/\/[^/]+\.arcgis.com\/sharing(\/|$)/i,eke=new RegExp("^(([^:/?#]+):)?(//([^/?#]*))?([^?#]*)(\\?([^#]*))?(#(.*))?$"),tke=new RegExp("^((([^\\[:]+):)?([^@]+)@)?(\\[([^\\]]+)\\]|([^\\[:]*))(:([0-9]+))?$");class j4{constructor(t=""){this.uri=t,this.scheme=null,this.authority=null,this.path=null,this.query=null,this.fragment=null,this.user=null,this.password=null,this.host=null,this.port=null;let r=this.uri.match(eke);this.scheme=r[2]||(r[1]?"":null),this.authority=r[4]||(r[3]?"":null),this.path=r[5],this.query=r[7]||(r[6]?"":null),this.fragment=r[9]||(r[8]?"":null),this.authority!=null&&(r=this.authority.match(tke),this.user=r[3]||null,this.password=r[4]||null,this.host=r[6]||r[7],this.port=r[9]||null)}toString(){return this.uri}}const SM={},rke=new j4(Vr.applicationUrl);let hl=rke;const ike=nke();let Nte=ike;const kte=()=>hl,UPt=()=>Nte;function nke(){const e=hl.path,t=e.substring(0,e.lastIndexOf(e.split("/")[e.split("/").length-1]));return`${`${hl.scheme}://${hl.host}${hl.port!=null?`:${hl.port}`:""}`}${t}`}function pn(e){const t={path:null,query:null},r=new j4(e),i=e.indexOf("?");return r.query===null?t.path=e:(t.path=e.substring(0,i),t.query=O3e(r.query)),r.fragment&&(t.hash=r.fragment,r.query===null&&(t.path=t.path.substring(0,t.path.length-(r.fragment.length+1)))),t}function O3e(e){const t=e.split("&"),r={};for(const i of t){if(!i)continue;const n=i.indexOf("=");let s,a;n<0?(s=decodeURIComponent(i),a=""):(s=decodeURIComponent(i.slice(0,n)),a=decodeURIComponent(i.slice(n+1)));let o=r[s];typeof o=="string"&&(o=r[s]=[o]),Array.isArray(o)?o.push(a):r[s]=a}return r}function mce(e){return e&&typeof e=="object"&&"toJSON"in e&&typeof e.toJSON=="function"}function rA(e,t){return e?t&&typeof t=="function"?Object.keys(e).map(r=>encodeURIComponent(r)+"="+encodeURIComponent(t(r,e[r]))).join("&"):Object.keys(e).map(r=>{const i=e[r];if(i==null)return"";const n=encodeURIComponent(r)+"=",s=t&&t[r];return s?n+encodeURIComponent(s(i)):Array.isArray(i)?i.map(a=>mce(a)?n+encodeURIComponent(JSON.stringify(a)):n+encodeURIComponent(a)).join("&"):mce(i)?n+encodeURIComponent(JSON.stringify(i)):n+encodeURIComponent(i)}).filter(r=>r).join("&"):""}function ske(e=!1){let t,r=Q9.proxyUrl;if(typeof e=="string"){t=hke(e);const i=uV(e);i&&(r=i.proxyUrl)}else t=!!e;if(!r)throw YNe.warn(pce),new k("urlutils:proxy-not-set",pce);return t&&uX()&&(r=Gte(r)),pn(r)}function ake(e){const t=uV(e);let r,i;if(t){const n=Vte(t.proxyUrl);r=n.path,i=n.query?O3e(n.query):null}if(r){const n=pn(e);e=r+"?"+n.path;const s=rA({...i,...n.query});s&&(e=`${e}?${s}`)}return e}const N6={path:"",query:""};function Vte(e){const t=e.indexOf("?");return t!==-1?(N6.path=e.slice(0,t),N6.query=e.slice(t+1)):(N6.path=e,N6.query=null),N6}function M3e(e){return e=(e=PF(e=yke(e=Vte(e).path),!0)).toLowerCase()}function oke(e){const t={proxyUrl:e.proxyUrl,urlPrefix:M3e(e.urlPrefix)},r=Q9.proxyRules,i=t.urlPrefix;let n=r.length;for(let s=0;s<r.length;s++){const a=r[s].urlPrefix;if(i.indexOf(a)===0){if(i.length===a.length)return-1;n=s;break}a.indexOf(i)===0&&(n=s+1)}return r.splice(n,0,t),n}function uV(e){const t=Q9.proxyRules,r=M3e(e);for(let i=0;i<t.length;i++)if(r.indexOf(t[i].urlPrefix)===0)return t[i]}function P3e(e,t){return e=gce(e),t=gce(t),PF(e)===PF(t)}function gce(e){const t=(e=zh(e)).indexOf("/sharing");return t>0?e.substring(0,t):e.replace(/\/+$/,"")}function I3e(e){const t=i=>i==null||i instanceof RegExp&&i.test(e)||typeof i=="string"&&e.startsWith(i),r=Q9.interceptors;if(r){for(const i of r)if(Array.isArray(i.urls)){if(i.urls.some(t))return i}else if(t(i.urls))return i}return null}function iA(e,t,r=!1){const i=fX(e),n=fX(t);return!(!r&&i.scheme!==n.scheme)&&i.host!=null&&n.host!=null&&i.host.toLowerCase()===n.host.toLowerCase()&&i.port===n.port}function zte(e){if(typeof e=="string"){if(!cd(e))return!0;e=fX(e)}if(iA(e,hl))return!0;const t=Q9.trustedServers||[];for(let r=0;r<t.length;r++){const i=lke(t[r]);for(let n=0;n<i.length;n++)if(iA(e,i[n]))return!0}return!1}function lke(e){return SM[e]||(Bte(e)||cm(e)?SM[e]=[new j4(Fh(e))]:SM[e]=[new j4(`http://${e}`),new j4(`https://${e}`)]),SM[e]}function Fh(e,t=Nte,r){return cm(e)?r&&r.preserveProtocolRelative?e:hl.scheme==="http"&&hl.authority===Tp(e).slice(2)?`http:${e}`:`https:${e}`:Bte(e)?e:vl(e[0]==="/"?gke(t):t,e)}function Ute(e,t=Nte,r){if(!cd(e))return e;const i=zh(e),n=i.toLowerCase(),s=zh(t).toLowerCase().replace(/\/+$/,""),a=r?zh(r).toLowerCase().replace(/\/+$/,""):null;if(a&&s.indexOf(a)!==0)return e;const o=(h,p,m)=>(m=h.indexOf(p,m))===-1?h.length:m;let l=o(n,"/",n.indexOf("//")+2),c=-1;for(;n.slice(0,l+1)===s.slice(0,l)+"/"&&(c=l+1,l!==n.length);)l=o(n,"/",l+1);if(c===-1||a&&c<a.length)return e;e=i.slice(c);const u=s.slice(c-1).replace(/[^/]+/g,"").length;if(u>0)for(let h=0;h<u;h++)e=`../${e}`;else e=`./${e}`;return e}function zh(e){return e=_ke(e=vke(e=bke(e=Fh(e=e.trim()))))}function vl(...e){const t=e.filter(_);if(!t||!t.length)return;const r=[];if(cd(t[0])){const n=t[0],s=n.indexOf("//");s!==-1&&(r.push(n.slice(0,s+1)),pke(t[0])&&(r[0]+="/"),t[0]=n.slice(s+2))}else t[0][0]==="/"&&r.push("");const i=t.reduce((n,s)=>s?n.concat(s.split("/")):n,[]);for(let n=0;n<i.length;n++){const s=i[n];s===".."&&r.length>0&&r[r.length-1]!==".."?r.pop():(!s&&n===i.length-1||s&&(s!=="."||r.length===0))&&r.push(s)}return r.join("/")}function Tp(e,t=!1){if(qv(e)||Tm(e))return null;let r=e.indexOf("://");if(r===-1&&cm(e))r=2;else{if(r===-1)return null;r+=3}const i=e.indexOf("/",r);return i!==-1&&(e=e.slice(0,i)),t&&(e=PF(e,!0)),e}function cd(e){return cm(e)||Bte(e)}function qv(e){return e!=null&&e.slice(0,5)==="blob:"}function Tm(e){return e.slice(0,5)==="data:"}function $3e(e){const t=hV(e);if(!t||!t.isBase64)return null;const r=atob(t.data),i=new Uint8Array(r.length);for(let n=0;n<r.length;n++)i[n]=r.charCodeAt(n);return i.buffer}function BPt(e){return btoa(String.fromCharCode.apply(null,e)).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}const cke=/^data:(.*?)(;base64)?,(.*)$/;function hV(e){const t=e.match(cke);if(!t)return null;const[,r,i,n]=t;return{mediaType:r,isBase64:!!i,data:n}}function L3e(e){return e.isBase64?`data:${e.mediaType};base64,${e.data}`:`data:${e.mediaType},${e.data}`}function GPt(e,t){dke(e,t)||uke(e,t)}function dke(e,t){if(!e)return!1;const r=document.createElement("a");if(!("download"in r))return!1;const i=URL.createObjectURL(e);return r.download=t,r.href=i,r.style.display="none",document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(i),!0}function uke(e,t){return!!window.navigator.msSaveOrOpenBlob&&window.navigator.msSaveOrOpenBlob(e,t)}function cm(e){return e!=null&&e!==void 0&&e[0]==="/"&&e[1]==="/"}function Bte(e){return A3e.test(e)}function hke(e){return ZNe.test(e)||hl.scheme==="https"&&cm(e)}function fke(e){return R3e.test(e)||hl.scheme==="http"&&cm(e)}function pke(e){return QNe.test(e)}function Gte(e){return cm(e)?`https:${e}`:e.replace(R3e,"https:")}function mke(){return hl.scheme==="http"}function uX(){return hl.scheme==="https"}function PF(e,t=!1){return cm(e)?e.slice(2):(e=e.replace(A3e,""),t&&e.length>1&&e[0]==="/"&&e[1]==="/"&&(e=e.slice(2)),e)}function gke(e){const t=e.indexOf("//"),r=e.indexOf("/",t+2);return r===-1?e:e.slice(0,r)}function jte(e){let t=0;if(cd(e)){const i=e.indexOf("//");i!==-1&&(t=i+2)}const r=e.lastIndexOf("/");return r<t?e:e.slice(0,r+1)}function jPt(e,t){if(!e)return"";const r=pn(e).path.replace(/\/+$/,""),i=r.substring(r.lastIndexOf("/")+1);if(!(t!=null&&t.length))return i;const n=new RegExp(`.(${t.join("|")})$`,"ig");return i.replace(n,"")}function yke(e){return e&&e[e.length-1]==="/"?e:`${e}/`}function D3e(e){return e.replace(/\/+$/,"")}function bke(e){if(/^https?:\/\//i.test(e)){const t=Vte(e);e=(e=t.path.replace(/\/{2,}/g,"/")).replace("/","//"),t.query&&(e+=`?${t.query}`)}return e}function vke(e){return e.replace(/^(https?:\/\/)(arcgis\.com)/i,"$1www.$2")}function _ke(e){const t=Q9.httpsDomains;if(!fke(e))return e;const r=e.indexOf("/",7);let i;if(i=r===-1?e:e.slice(0,r),i=i.toLowerCase().slice(7),JNe.test(i)){if(!i.endsWith(":80"))return e;i=i.slice(0,-3),e=e.replace(":80","")}return mke()&&i===hl.authority&&!KNe.test(e)||(uX()&&i===hl.authority||t&&t.some(n=>i===n||i.endsWith(`.${n}`))||uX()&&!uV(e))&&(e=Gte(e)),e}function hX(e,t,r){if(!(t&&r&&e&&cd(e)))return e;const i=e.indexOf("//"),n=e.indexOf("/",i+2),s=e.indexOf(":",i+2),a=Math.min(n<0?e.length:n,s<0?e.length:s);return e.slice(i+2,a).toLowerCase()!==t.toLowerCase()?e:`${e.slice(0,i+2)}${r}${e.slice(a)}`}function fX(e){return typeof e=="string"?new j4(Fh(e)):(e.scheme||(e.scheme=hl.scheme),e)}function qte(e){return xke.test(e)}function F3e(e,t){const r=pn(e),i=Object.keys(r.query||{});return i.length>0&&t&&t.warn("removeQueryParameters()",`Url query parameters are not supported, the following parameters have been removed: ${i.join(", ")}.`),r.path}function N3e(e,t,r){const i=pn(e),n=i.query||{};return n[t]=String(r),`${i.path}?${rA(n)}`}function B$(e,t){const r=pn(e),i=r.query||{};for(const s in t)i[s]=t[s];const n=rA(i);return n?`${r.path}?${n}`:r.path}function Hte(e){if(R(e))return null;const t=e.match(wke);return t?t[1]:null}const wke=/.*?\.([^\/]*)$/,xke=/(^data:image\/svg|\.svg$)/i;function Xe(e,t,r){let i,n;return t===void 0?(n=e,i=[void 0]):typeof t!="string"?(n=e,i=[void 0],r=t):(n=t,i=Array.isArray(e)?e:[e]),(s,a)=>{const o=s.constructor.prototype;for(const l of i){const c=Pte(s,l,n);c.write&&typeof c.write=="object"||(c.write={}),r&&(c.write.target=r),c.write.writer=o[a]}}}var Ph;(function(e){e[e.CGCS2000=4490]="CGCS2000",e[e.GCSMARS2000=104971]="GCSMARS2000",e[e.GCSMARS2000_SPHERE=104905]="GCSMARS2000_SPHERE",e[e.GCSMOON2000=104903]="GCSMOON2000"})(Ph||(Ph={}));let y;const N={values:[1,.3048,.3048006096012192,.3047972654,.9143917962,.201166195164,.9143984146160287,.3047994715386762,20.11676512155263,20.11678249437587,.9143985307444408,.91439523,.3047997101815088,20.1168,20.116756,5e4,15e4],units:["Meter","Foot","Foot_US","Foot_Clarke","Yard_Clarke","Link_Clarke","Yard_Sears","Foot_Sears","Chain_Sears","Chain_Benoit_1895_B","Yard_Indian","Yard_Indian_1937","Foot_Gold_Coast","Chain","Chain_Sears_1922_Truncated","50_Kilometers","150_Kilometers"],2066:5,2136:12,2155:2,2157:0,2158:0,2159:12,2160:12,2204:2,2219:0,2220:0,2254:2,2255:2,2256:1,2265:1,2266:1,2267:2,2268:2,2269:1,2270:1,2271:2,2272:2,2273:1,2294:0,2295:0,2314:3,2899:2,2900:2,2901:1,2909:1,2910:1,2911:2,2912:2,2913:1,2914:1,2992:1,2993:0,2994:1,3080:1,3089:2,3090:0,3091:2,3102:2,3141:0,3142:0,3167:14,3359:2,3360:0,3361:1,3362:0,3363:2,3364:0,3365:2,3366:3,3404:2,3405:0,3406:0,3407:3,3439:0,3440:0,3479:1,3480:0,3481:1,3482:0,3483:1,3484:0,3485:2,3486:0,3487:2,3488:0,3489:0,3490:2,3491:0,3492:2,3493:0,3494:2,3495:0,3496:2,3497:0,3498:2,3499:0,3500:2,3501:0,3502:2,3503:0,3504:2,3505:0,3506:2,3507:0,3508:2,3509:0,3510:2,3511:0,3512:2,3513:0,3514:0,3515:2,3516:0,3517:2,3518:0,3519:2,3520:0,3521:2,3522:0,3523:2,3524:0,3525:2,3526:0,3527:2,3528:0,3529:2,3530:0,3531:2,3532:0,3533:2,3534:0,3535:2,3536:0,3537:2,3538:0,3539:2,3540:0,3541:2,3542:0,3543:2,3544:0,3545:2,3546:0,3547:2,3548:0,3549:2,3550:0,3551:2,3552:0,3553:2,3582:2,3583:0,3584:2,3585:0,3586:2,3587:0,3588:1,3589:0,3590:1,3591:0,3592:0,3593:1,3598:2,3599:0,3600:2,3605:1,3606:0,3607:0,3608:2,3609:0,3610:2,3611:0,3612:2,3613:0,3614:2,3615:0,3616:2,3617:0,3618:2,3619:0,3620:2,3621:0,3622:2,3623:0,3624:2,3625:0,3626:2,3627:0,3628:2,3629:0,3630:2,3631:0,3632:2,3633:0,3634:1,3635:0,3636:1,3640:2,3641:0,3642:2,3643:0,3644:1,3645:0,3646:1,3647:0,3648:1,3649:0,3650:2,3651:0,3652:2,3653:0,3654:2,3655:0,3656:1,3657:0,3658:2,3659:0,3660:2,3661:0,3662:2,3663:0,3664:2,3668:2,3669:0,3670:2,3671:0,3672:2,3673:0,3674:2,3675:0,3676:1,3677:2,3678:0,3679:1,3680:2,3681:0,3682:1,3683:2,3684:0,3685:0,3686:2,3687:0,3688:2,3689:0,3690:2,3691:0,3692:2,3696:2,3697:0,3698:2,3699:0,3700:2,3793:0,3794:0,3812:0,3854:0,3857:0,3920:0,3978:0,3979:0,3991:2,3992:2,4026:0,4037:0,4038:0,4071:0,4082:0,4083:0,4087:0,4088:0,4217:2,4414:0,4415:0,4417:0,4434:0,4437:0,4438:2,4439:2,4462:0,4467:0,4471:0,4474:0,4559:0,4647:0,4822:0,4826:0,4839:0,5018:0,5048:0,5167:0,5168:0,5221:0,5223:0,5234:0,5235:0,5243:0,5247:0,5266:0,5316:0,5320:0,5321:0,5325:0,5337:0,5361:0,5362:0,5367:0,5382:0,5383:0,5396:0,5456:0,5457:0,5469:0,5472:4,5490:0,5513:0,5514:0,5523:0,5559:0,5588:1,5589:3,5596:0,5627:0,5629:0,5641:0,5643:0,5644:0,5646:2,5654:2,5655:2,5659:0,5700:0,5825:0,5836:0,5837:0,5839:0,5842:0,5844:0,5858:0,5879:0,5880:0,5887:0,5890:0,6128:1,6129:1,6141:1,6204:0,6210:0,6211:0,6307:0,6312:0,6316:0,6362:0,6391:1,6405:1,6406:0,6407:1,6408:0,6409:1,6410:0,6411:2,6412:0,6413:2,6414:0,6415:0,6416:2,6417:0,6418:2,6419:0,6420:2,6421:0,6422:2,6423:0,6424:2,6425:0,6426:2,6427:0,6428:2,6429:0,6430:2,6431:0,6432:2,6433:0,6434:2,6435:0,6436:2,6437:0,6438:2,6439:0,6440:0,6441:2,6442:0,6443:2,6444:0,6445:2,6446:0,6447:2,6448:0,6449:2,6450:0,6451:2,6452:0,6453:2,6454:0,6455:2,6456:0,6457:2,6458:0,6459:2,6460:0,6461:2,6462:0,6463:2,6464:0,6465:2,6466:0,6467:2,6468:0,6469:2,6470:0,6471:2,6472:0,6473:2,6474:0,6475:2,6476:0,6477:2,6478:0,6479:2,6484:2,6485:0,6486:2,6487:0,6488:2,6489:0,6490:2,6491:0,6492:2,6493:0,6494:1,6495:0,6496:1,6497:0,6498:0,6499:1,6500:0,6501:2,6502:0,6503:2,6504:0,6505:2,6506:0,6507:2,6508:0,6509:0,6510:2,6515:1,6516:0,6518:0,6519:2,6520:0,6521:2,6522:0,6523:2,6524:0,6525:2,6526:0,6527:2,6528:0,6529:2,6530:0,6531:2,6532:0,6533:2,6534:0,6535:2,6536:0,6537:2,6538:0,6539:2,6540:0,6541:2,6542:0,6543:2,6544:0,6545:1,6546:0,6547:1,6548:0,6549:2,6550:0,6551:2,6552:0,6553:2,6554:0,6555:2,6556:0,6557:1,6558:0,6559:1,6560:0,6561:1,6562:0,6563:2,6564:0,6565:2,6566:0,6567:0,6568:2,6569:0,6570:1,6571:0,6572:2,6573:0,6574:2,6575:0,6576:2,6577:0,6578:2,6582:2,6583:0,6584:2,6585:0,6586:2,6587:0,6588:2,6589:0,6590:2,6591:0,6592:0,6593:2,6594:0,6595:2,6596:0,6597:2,6598:0,6599:2,6600:0,6601:2,6602:0,6603:2,6605:2,6606:0,6607:2,6608:0,6609:2,6610:0,6611:0,6612:2,6613:0,6614:2,6615:0,6616:2,6617:0,6618:2,6633:2,6646:0,6703:0,6784:0,6785:1,6786:0,6787:1,6788:0,6789:1,6790:0,6791:1,6792:0,6793:1,6794:0,6795:1,6796:0,6797:1,6798:0,6799:1,6800:0,6801:1,6802:0,6803:1,6804:0,6805:1,6806:0,6807:1,6808:0,6809:1,6810:0,6811:1,6812:0,6813:1,6814:0,6815:1,6816:0,6817:1,6818:0,6819:1,6820:0,6821:1,6822:0,6823:1,6824:0,6825:1,6826:0,6827:1,6828:0,6829:1,6830:0,6831:1,6832:0,6833:1,6834:0,6835:1,6836:0,6837:1,6838:0,6839:1,6840:0,6841:1,6842:0,6843:1,6844:0,6845:1,6846:0,6847:1,6848:0,6849:1,6850:0,6851:1,6852:0,6853:1,6854:0,6855:1,6856:0,6857:1,6858:0,6859:1,6860:0,6861:1,6862:0,6863:1,6867:0,6868:1,6870:0,6875:0,6876:0,6879:0,6880:2,6884:0,6885:1,6886:0,6887:1,6915:0,6922:0,6923:2,6924:0,6925:2,6962:0,6984:0,6991:0,7128:2,7131:0,7132:2,7142:0,7257:0,7258:2,7259:0,7260:2,7261:0,7262:2,7263:0,7264:2,7265:0,7266:2,7267:0,7268:2,7269:0,7270:2,7271:0,7272:2,7273:0,7274:2,7275:0,7276:2,7277:0,7278:2,7279:0,7280:2,7281:0,7282:2,7283:0,7284:2,7285:0,7286:2,7287:0,7288:2,7289:0,7290:2,7291:0,7292:2,7293:0,7294:2,7295:0,7296:2,7297:0,7298:2,7299:0,7300:2,7301:0,7302:2,7303:0,7304:2,7305:0,7306:2,7307:0,7308:2,7309:0,7310:2,7311:0,7312:2,7313:0,7314:2,7315:0,7316:2,7317:0,7318:2,7319:0,7320:2,7321:0,7322:2,7323:0,7324:2,7325:0,7326:2,7327:0,7328:2,7329:0,7330:2,7331:0,7332:2,7333:0,7334:2,7335:0,7336:2,7337:0,7338:2,7339:0,7340:2,7341:0,7342:2,7343:0,7344:2,7345:0,7346:2,7347:0,7348:2,7349:0,7350:2,7351:0,7352:2,7353:0,7354:2,7355:0,7356:2,7357:0,7358:2,7359:0,7360:2,7361:0,7362:2,7363:0,7364:2,7365:0,7366:2,7367:0,7368:2,7369:0,7370:2,7877:0,7878:0,7882:0,7883:0,7887:0,7899:0,7991:0,7992:0,8035:2,8036:2,8058:0,8059:0,8082:0,8083:0,8088:0,8090:0,8091:2,8092:0,8093:2,8095:0,8096:2,8097:0,8098:2,8099:0,8100:2,8101:0,8102:2,8103:0,8104:2,8105:0,8106:2,8107:0,8108:2,8109:0,8110:2,8111:0,8112:2,8113:0,8114:2,8115:0,8116:2,8117:0,8118:2,8119:0,8120:2,8121:0,8122:2,8123:0,8124:2,8125:0,8126:2,8127:0,8128:2,8129:0,8130:2,8131:0,8132:2,8133:0,8134:2,8135:0,8136:2,8137:0,8138:2,8139:0,8140:2,8141:0,8142:2,8143:0,8144:2,8145:0,8146:2,8147:0,8148:2,8149:0,8150:2,8151:0,8152:2,8153:0,8154:2,8155:0,8156:2,8157:0,8158:2,8159:0,8160:2,8161:0,8162:2,8163:0,8164:2,8165:0,8166:2,8167:0,8168:2,8169:0,8170:2,8171:0,8172:2,8173:0,8177:2,8179:0,8180:2,8181:0,8182:2,8184:0,8185:2,8187:0,8189:2,8191:0,8193:2,8196:0,8197:2,8198:0,8200:2,8201:0,8202:2,8203:0,8204:2,8205:0,8206:2,8207:0,8208:2,8209:0,8210:2,8212:0,8213:2,8214:0,8216:2,8218:0,8220:2,8222:0,8224:2,8225:0,8226:2,8311:0,8312:1,8313:0,8314:1,8315:0,8316:1,8317:0,8318:1,8319:0,8320:1,8321:0,8322:1,8323:0,8324:1,8325:0,8326:1,8327:0,8328:1,8329:0,8330:1,8331:0,8332:1,8333:0,8334:1,8335:0,8336:1,8337:0,8338:1,8339:0,8340:1,8341:0,8342:1,8343:0,8344:1,8345:0,8346:1,8347:0,8348:1,8352:0,8353:0,8379:0,8380:2,8381:0,8382:2,8383:0,8384:2,8385:0,8387:2,8391:0,8395:0,8433:0,8441:0,8455:0,8456:0,8531:2,8682:0,8686:0,8687:0,8692:0,8693:0,8826:0,8903:0,8950:0,8951:0,9039:0,9040:0,9141:0,9149:0,9150:0,9191:0,9221:0,9222:0,9249:0,9250:0,9252:0,9254:0,9265:0,9284:0,9285:0,9300:0,9354:0,9367:0,9373:0,9377:0,9387:0,9391:0,9456:0,9473:0,9498:0,9674:0,9678:0,9680:0,9709:0,9712:0,9713:0,9716:0,9741:0,9748:2,9749:2,9761:0,9766:0,20499:0,20538:0,20539:0,20790:0,20791:0,21291:0,21292:0,21500:0,21817:0,21818:0,22032:0,22033:0,22091:0,22092:0,22332:0,22391:0,22392:0,22700:0,22770:0,22780:0,22832:0,23090:0,23095:0,23239:0,23240:0,23433:0,23700:0,24047:0,24048:0,24100:3,24200:0,24305:0,24306:0,24382:10,24383:0,24500:0,24547:0,24548:0,24571:9,24600:0,25e3:0,25231:0,25884:0,25932:0,26237:0,26331:0,26332:0,26432:0,26591:0,26592:0,26632:0,26692:0,27120:0,27200:0,27291:6,27292:6,27429:0,27492:0,27493:0,27500:0,27700:0,28232:0,28600:0,28991:0,28992:0,29100:0,29101:0,29220:0,29221:0,29333:0,29635:0,29636:0,29701:0,29738:0,29739:0,29849:0,29850:0,29871:8,29872:7,29873:0,29874:0,30200:5,30339:0,30340:0,30591:0,30592:0,30791:0,30792:0,30800:0,31028:0,31121:0,31154:0,31170:0,31171:0,31370:0,31528:0,31529:0,31600:0,31700:0,31838:0,31839:0,31900:0,31901:0,32061:0,32062:0,32098:0,32099:2,32100:0,32104:0,32161:0,32766:0,53048:0,53049:0,54090:0,54091:0,65061:2,65062:2,65161:0,65163:0,102041:2,102064:11,102068:15,102069:16,102118:2,102119:1,102120:2,102121:2,102217:2,102218:0,102219:2,102220:2,102378:1,102379:1,102380:0,102381:1,102589:2,102599:2,102600:2,102604:2,102647:0,102704:2,102705:2,102706:0,102759:1,102760:1,102761:2,102762:0,102763:2,102764:0,102765:0,102766:2,102970:1,102974:2,102993:0,102994:0,102995:2,102996:2,103015:0,103016:2,103017:0,103018:2,103025:0,103026:0,103027:2,103028:2,103035:0,103036:0,103037:2,103038:2,103039:0,103040:0,103041:2,103042:2,103043:0,103044:0,103045:2,103046:2,103047:0,103048:0,103049:2,103050:2,103051:0,103052:2,103053:0,103054:2,103055:0,103056:2,103057:0,103058:0,103059:2,103060:2,103061:0,103062:0,103063:2,103064:2,103069:2,103070:0,103071:0,103072:2,103073:2,103086:0,103087:0,103088:2,103089:2,103094:1,103095:0,103096:2,103103:0,103104:2,103105:0,103106:2,103121:0,103122:2,103123:0,103124:0,103125:1,103126:1,103127:0,103128:0,103129:2,103130:2,103131:0,103132:0,103133:2,103134:2,103135:0,103136:0,103137:1,103138:1,103139:0,103140:2,103141:0,103142:2,103143:0,103144:2,103145:0,103146:1,103147:0,103148:0,103149:2,103150:2,103151:0,103152:2,103172:0,103173:2,103174:0,103175:0,103176:2,103177:2,103178:0,103179:0,103180:2,103181:2,103182:0,103183:0,103184:2,103185:2,103228:0,103229:0,103230:2,103231:2,103250:0,103251:2,103252:0,103253:2,103260:0,103261:0,103262:2,103263:2,103270:0,103271:0,103272:2,103273:2,103274:0,103275:0,103276:2,103277:2,103278:0,103279:0,103280:2,103281:2,103282:0,103283:0,103284:2,103285:2,103286:0,103287:2,103288:0,103289:2,103290:0,103291:2,103292:0,103293:0,103294:2,103295:2,103296:0,103297:0,103298:2,103299:2,103376:2,103377:0,103378:0,103379:2,103380:2,103393:0,103394:0,103395:2,103396:2,103472:0,103473:1,103474:0,103475:2,103482:0,103483:2,103484:0,103485:2,103500:0,103501:2,103502:0,103503:0,103504:1,103505:1,103506:0,103507:0,103508:2,103509:2,103510:0,103511:0,103512:2,103513:2,103514:0,103515:2,103516:0,103517:2,103518:0,103519:2,103520:0,103521:1,103522:0,103523:0,103524:2,103525:2,103526:0,103527:2,103561:2,103562:2,103563:0,103564:0,103565:2,103566:2,103567:0,103568:0,103569:2,103570:2,103584:0,103585:2,103586:0,103587:2,103588:1,103589:0,103590:2,103591:1,103592:0,103593:2,103594:1,103695:2};for(y=2e3;y<=2045;y++)N[y]=0;for(y=2056;y<=2065;y++)N[y]=0;for(y=2067;y<=2135;y++)N[y]=0;for(y=2137;y<=2154;y++)N[y]=0;for(y=2161;y<=2170;y++)N[y]=0;for(y=2172;y<=2193;y++)N[y]=0;for(y=2195;y<=2198;y++)N[y]=0;for(y=2200;y<=2203;y++)N[y]=0;for(y=2205;y<=2217;y++)N[y]=0;for(y=2222;y<=2224;y++)N[y]=1;for(y=2225;y<=2250;y++)N[y]=2;for(y=2251;y<=2253;y++)N[y]=1;for(y=2257;y<=2264;y++)N[y]=2;for(y=2274;y<=2279;y++)N[y]=2;for(y=2280;y<=2282;y++)N[y]=1;for(y=2283;y<=2289;y++)N[y]=2;for(y=2290;y<=2292;y++)N[y]=0;for(y=2308;y<=2313;y++)N[y]=0;for(y=2315;y<=2491;y++)N[y]=0;for(y=2494;y<=2866;y++)N[y]=0;for(y=2867;y<=2869;y++)N[y]=1;for(y=2870;y<=2888;y++)N[y]=2;for(y=2891;y<=2895;y++)N[y]=2;for(y=2896;y<=2898;y++)N[y]=1;for(y=2902;y<=2908;y++)N[y]=2;for(y=2915;y<=2920;y++)N[y]=2;for(y=2921;y<=2923;y++)N[y]=1;for(y=2924;y<=2930;y++)N[y]=2;for(y=2931;y<=2962;y++)N[y]=0;for(y=2964;y<=2968;y++)N[y]=2;for(y=2969;y<=2973;y++)N[y]=0;for(y=2975;y<=2991;y++)N[y]=0;for(y=2995;y<=3051;y++)N[y]=0;for(y=3054;y<=3079;y++)N[y]=0;for(y=3081;y<=3088;y++)N[y]=0;for(y=3092;y<=3101;y++)N[y]=0;for(y=3106;y<=3138;y++)N[y]=0;for(y=3146;y<=3151;y++)N[y]=0;for(y=3153;y<=3166;y++)N[y]=0;for(y=3168;y<=3172;y++)N[y]=0;for(y=3174;y<=3203;y++)N[y]=0;for(y=3294;y<=3358;y++)N[y]=0;for(y=3367;y<=3403;y++)N[y]=0;for(y=3408;y<=3416;y++)N[y]=0;for(y=3417;y<=3438;y++)N[y]=2;for(y=3441;y<=3446;y++)N[y]=2;for(y=3447;y<=3450;y++)N[y]=0;for(y=3451;y<=3459;y++)N[y]=2;for(y=3460;y<=3478;y++)N[y]=0;for(y=3554;y<=3559;y++)N[y]=0;for(y=3560;y<=3570;y++)N[y]=2;for(y=3571;y<=3581;y++)N[y]=0;for(y=3594;y<=3597;y++)N[y]=0;for(y=3601;y<=3604;y++)N[y]=0;for(y=3637;y<=3639;y++)N[y]=0;for(y=3665;y<=3667;y++)N[y]=0;for(y=3693;y<=3695;y++)N[y]=0;for(y=3701;y<=3727;y++)N[y]=0;for(y=3728;y<=3739;y++)N[y]=2;for(y=3740;y<=3751;y++)N[y]=0;for(y=3753;y<=3760;y++)N[y]=2;for(y=3761;y<=3773;y++)N[y]=0;for(y=3775;y<=3777;y++)N[y]=0;for(y=3779;y<=3781;y++)N[y]=0;for(y=3783;y<=3785;y++)N[y]=0;for(y=3788;y<=3791;y++)N[y]=0;for(y=3797;y<=3802;y++)N[y]=0;for(y=3814;y<=3816;y++)N[y]=0;for(y=3825;y<=3829;y++)N[y]=0;for(y=3832;y<=3841;y++)N[y]=0;for(y=3844;y<=3852;y++)N[y]=0;for(y=3873;y<=3885;y++)N[y]=0;for(y=3890;y<=3893;y++)N[y]=0;for(y=3907;y<=3912;y++)N[y]=0;for(y=3942;y<=3950;y++)N[y]=0;for(y=3968;y<=3970;y++)N[y]=0;for(y=3973;y<=3976;y++)N[y]=0;for(y=3986;y<=3989;y++)N[y]=0;for(y=3994;y<=3997;y++)N[y]=0;for(y=4048;y<=4051;y++)N[y]=0;for(y=4056;y<=4063;y++)N[y]=0;for(y=4093;y<=4096;y++)N[y]=0;for(y=4390;y<=4398;y++)N[y]=0;for(y=4399;y<=4413;y++)N[y]=2;for(y=4418;y<=4433;y++)N[y]=2;for(y=4455;y<=4457;y++)N[y]=2;for(y=4484;y<=4489;y++)N[y]=0;for(y=4491;y<=4554;y++)N[y]=0;for(y=4568;y<=4589;y++)N[y]=0;for(y=4652;y<=4656;y++)N[y]=0;for(y=4766;y<=4800;y++)N[y]=0;for(y=5014;y<=5016;y++)N[y]=0;for(y=5069;y<=5072;y++)N[y]=0;for(y=5105;y<=5130;y++)N[y]=0;for(y=5173;y<=5188;y++)N[y]=0;for(y=5253;y<=5259;y++)N[y]=0;for(y=5269;y<=5275;y++)N[y]=0;for(y=5292;y<=5311;y++)N[y]=0;for(y=5329;y<=5331;y++)N[y]=0;for(y=5343;y<=5349;y++)N[y]=0;for(y=5355;y<=5357;y++)N[y]=0;for(y=5387;y<=5389;y++)N[y]=0;for(y=5459;y<=5463;y++)N[y]=0;for(y=5479;y<=5482;y++)N[y]=0;for(y=5518;y<=5520;y++)N[y]=0;for(y=5530;y<=5539;y++)N[y]=0;for(y=5550;y<=5552;y++)N[y]=0;for(y=5562;y<=5583;y++)N[y]=0;for(y=5623;y<=5625;y++)N[y]=2;for(y=5631;y<=5639;y++)N[y]=0;for(y=5649;y<=5653;y++)N[y]=0;for(y=5663;y<=5680;y++)N[y]=0;for(y=5682;y<=5685;y++)N[y]=0;for(y=5875;y<=5877;y++)N[y]=0;for(y=5896;y<=5899;y++)N[y]=0;for(y=5921;y<=5940;y++)N[y]=0;for(y=6050;y<=6125;y++)N[y]=0;for(y=6244;y<=6275;y++)N[y]=0;for(y=6328;y<=6348;y++)N[y]=0;for(y=6350;y<=6356;y++)N[y]=0;for(y=6366;y<=6372;y++)N[y]=0;for(y=6381;y<=6387;y++)N[y]=0;for(y=6393;y<=6404;y++)N[y]=0;for(y=6480;y<=6483;y++)N[y]=0;for(y=6511;y<=6514;y++)N[y]=0;for(y=6579;y<=6581;y++)N[y]=0;for(y=6619;y<=6624;y++)N[y]=0;for(y=6625;y<=6627;y++)N[y]=2;for(y=6628;y<=6632;y++)N[y]=0;for(y=6634;y<=6637;y++)N[y]=0;for(y=6669;y<=6692;y++)N[y]=0;for(y=6707;y<=6709;y++)N[y]=0;for(y=6720;y<=6723;y++)N[y]=0;for(y=6732;y<=6738;y++)N[y]=0;for(y=6931;y<=6933;y++)N[y]=0;for(y=6956;y<=6959;y++)N[y]=0;for(y=7005;y<=7007;y++)N[y]=0;for(y=7057;y<=7070;y++)N[y]=2;for(y=7074;y<=7082;y++)N[y]=0;for(y=7109;y<=7118;y++)N[y]=0;for(y=7119;y<=7127;y++)N[y]=1;for(y=7374;y<=7376;y++)N[y]=0;for(y=7528;y<=7586;y++)N[y]=0;for(y=7587;y<=7645;y++)N[y]=2;for(y=7692;y<=7696;y++)N[y]=0;for(y=7755;y<=7787;y++)N[y]=0;for(y=7791;y<=7795;y++)N[y]=0;for(y=7799;y<=7801;y++)N[y]=0;for(y=7803;y<=7805;y++)N[y]=0;for(y=7825;y<=7831;y++)N[y]=0;for(y=7845;y<=7859;y++)N[y]=0;for(y=8013;y<=8032;y++)N[y]=0;for(y=8065;y<=8068;y++)N[y]=1;for(y=8518;y<=8529;y++)N[y]=2;for(y=8533;y<=8536;y++)N[y]=2;for(y=8538;y<=8540;y++)N[y]=2;for(y=8677;y<=8679;y++)N[y]=0;for(y=8836;y<=8840;y++)N[y]=0;for(y=8857;y<=8859;y++)N[y]=0;for(y=8908;y<=8910;y++)N[y]=0;for(y=9154;y<=9159;y++)N[y]=0;for(y=9205;y<=9218;y++)N[y]=0;for(y=9271;y<=9273;y++)N[y]=0;for(y=9295;y<=9297;y++)N[y]=0;for(y=9356;y<=9360;y++)N[y]=0;for(y=9404;y<=9407;y++)N[y]=0;for(y=9476;y<=9482;y++)N[y]=0;for(y=9487;y<=9494;y++)N[y]=0;for(y=9697;y<=9699;y++)N[y]=0;for(y=20002;y<=20032;y++)N[y]=0;for(y=20062;y<=20092;y++)N[y]=0;for(y=20135;y<=20138;y++)N[y]=0;for(y=20248;y<=20258;y++)N[y]=0;for(y=20348;y<=20358;y++)N[y]=0;for(y=20436;y<=20440;y++)N[y]=0;for(y=20822;y<=20824;y++)N[y]=0;for(y=20904;y<=20932;y++)N[y]=0;for(y=20934;y<=20936;y++)N[y]=0;for(y=21004;y<=21032;y++)N[y]=0;for(y=21035;y<=21037;y++)N[y]=0;for(y=21095;y<=21097;y++)N[y]=0;for(y=21148;y<=21150;y++)N[y]=0;for(y=21207;y<=21264;y++)N[y]=0;for(y=21307;y<=21364;y++)N[y]=0;for(y=21413;y<=21423;y++)N[y]=0;for(y=21453;y<=21463;y++)N[y]=0;for(y=21473;y<=21483;y++)N[y]=0;for(y=21780;y<=21782;y++)N[y]=0;for(y=21891;y<=21894;y++)N[y]=0;for(y=21896;y<=21899;y++)N[y]=0;for(y=22171;y<=22177;y++)N[y]=0;for(y=22181;y<=22187;y++)N[y]=0;for(y=22191;y<=22197;y++)N[y]=0;for(y=22234;y<=22236;y++)N[y]=0;for(y=22521;y<=22525;y++)N[y]=0;for(y=22991;y<=22994;y++)N[y]=0;for(y=23028;y<=23038;y++)N[y]=0;for(y=23830;y<=23853;y++)N[y]=0;for(y=23866;y<=23872;y++)N[y]=0;for(y=23877;y<=23884;y++)N[y]=0;for(y=23886;y<=23894;y++)N[y]=0;for(y=23946;y<=23948;y++)N[y]=0;for(y=24311;y<=24313;y++)N[y]=0;for(y=24342;y<=24347;y++)N[y]=0;for(y=24370;y<=24374;y++)N[y]=10;for(y=24375;y<=24381;y++)N[y]=0;for(y=24718;y<=24721;y++)N[y]=0;for(y=24817;y<=24821;y++)N[y]=0;for(y=24877;y<=24882;y++)N[y]=0;for(y=24891;y<=24893;y++)N[y]=0;for(y=25391;y<=25395;y++)N[y]=0;for(y=25828;y<=25838;y++)N[y]=0;for(y=26191;y<=26195;y++)N[y]=0;for(y=26391;y<=26393;y++)N[y]=0;for(y=26701;y<=26722;y++)N[y]=0;for(y=26729;y<=26799;y++)N[y]=2;for(y=26801;y<=26803;y++)N[y]=2;for(y=26811;y<=26813;y++)N[y]=2;for(y=26847;y<=26870;y++)N[y]=2;for(y=26891;y<=26899;y++)N[y]=0;for(y=26901;y<=26923;y++)N[y]=0;for(y=26929;y<=26946;y++)N[y]=0;for(y=26948;y<=26998;y++)N[y]=0;for(y=27037;y<=27040;y++)N[y]=0;for(y=27205;y<=27232;y++)N[y]=0;for(y=27258;y<=27260;y++)N[y]=0;for(y=27391;y<=27398;y++)N[y]=0;for(y=27561;y<=27564;y++)N[y]=0;for(y=27571;y<=27574;y++)N[y]=0;for(y=27581;y<=27584;y++)N[y]=0;for(y=27591;y<=27594;y++)N[y]=0;for(y=28191;y<=28193;y++)N[y]=0;for(y=28348;y<=28358;y++)N[y]=0;for(y=28402;y<=28432;y++)N[y]=0;for(y=28462;y<=28492;y++)N[y]=0;for(y=29118;y<=29122;y++)N[y]=0;for(y=29168;y<=29172;y++)N[y]=0;for(y=29177;y<=29185;y++)N[y]=0;for(y=29187;y<=29195;y++)N[y]=0;for(y=29900;y<=29903;y++)N[y]=0;for(y=30161;y<=30179;y++)N[y]=0;for(y=30491;y<=30494;y++)N[y]=0;for(y=30729;y<=30732;y++)N[y]=0;for(y=31251;y<=31259;y++)N[y]=0;for(y=31265;y<=31268;y++)N[y]=0;for(y=31275;y<=31279;y++)N[y]=0;for(y=31281;y<=31297;y++)N[y]=0;for(y=31461;y<=31469;y++)N[y]=0;for(y=31491;y<=31495;y++)N[y]=0;for(y=31917;y<=31922;y++)N[y]=0;for(y=31965;y<=32e3;y++)N[y]=0;for(y=32001;y<=32003;y++)N[y]=2;for(y=32005;y<=32031;y++)N[y]=2;for(y=32033;y<=32060;y++)N[y]=2;for(y=32064;y<=32067;y++)N[y]=2;for(y=32074;y<=32077;y++)N[y]=2;for(y=32081;y<=32086;y++)N[y]=0;for(y=32107;y<=32130;y++)N[y]=0;for(y=32133;y<=32158;y++)N[y]=0;for(y=32164;y<=32167;y++)N[y]=2;for(y=32180;y<=32199;y++)N[y]=0;for(y=32201;y<=32260;y++)N[y]=0;for(y=32301;y<=32360;y++)N[y]=0;for(y=32601;y<=32662;y++)N[y]=0;for(y=32664;y<=32667;y++)N[y]=2;for(y=32701;y<=32761;y++)N[y]=0;for(y=53001;y<=53004;y++)N[y]=0;for(y=53008;y<=53019;y++)N[y]=0;for(y=53021;y<=53032;y++)N[y]=0;for(y=53034;y<=53037;y++)N[y]=0;for(y=53042;y<=53046;y++)N[y]=0;for(y=53074;y<=53080;y++)N[y]=0;for(y=54001;y<=54004;y++)N[y]=0;for(y=54008;y<=54019;y++)N[y]=0;for(y=54021;y<=54032;y++)N[y]=0;for(y=54034;y<=54037;y++)N[y]=0;for(y=54042;y<=54046;y++)N[y]=0;for(y=54048;y<=54053;y++)N[y]=0;for(y=54074;y<=54080;y++)N[y]=0;for(y=54098;y<=54101;y++)N[y]=0;for(y=102001;y<=102040;y++)N[y]=0;for(y=102042;y<=102063;y++)N[y]=0;for(y=102065;y<=102067;y++)N[y]=0;for(y=102070;y<=102117;y++)N[y]=0;for(y=102122;y<=102216;y++)N[y]=0;for(y=102221;y<=102377;y++)N[y]=0;for(y=102382;y<=102388;y++)N[y]=0;for(y=102389;y<=102398;y++)N[y]=2;for(y=102399;y<=102444;y++)N[y]=0;for(y=102445;y<=102447;y++)N[y]=2;for(y=102448;y<=102458;y++)N[y]=0;for(y=102459;y<=102468;y++)N[y]=2;for(y=102469;y<=102499;y++)N[y]=0;for(y=102500;y<=102519;y++)N[y]=1;for(y=102520;y<=102524;y++)N[y]=0;for(y=102525;y<=102529;y++)N[y]=2;for(y=102530;y<=102588;y++)N[y]=0;for(y=102590;y<=102598;y++)N[y]=0;for(y=102601;y<=102603;y++)N[y]=0;for(y=102605;y<=102628;y++)N[y]=0;for(y=102629;y<=102646;y++)N[y]=2;for(y=102648;y<=102700;y++)N[y]=2;for(y=102701;y<=102703;y++)N[y]=0;for(y=102707;y<=102730;y++)N[y]=2;for(y=102733;y<=102758;y++)N[y]=2;for(y=102767;y<=102900;y++)N[y]=0;for(y=102901;y<=102933;y++)N[y]=2;for(y=102934;y<=102950;y++)N[y]=13;for(y=102951;y<=102955;y++)N[y]=0;for(y=102961;y<=102963;y++)N[y]=0;for(y=102965;y<=102969;y++)N[y]=0;for(y=102971;y<=102973;y++)N[y]=0;for(y=102975;y<=102989;y++)N[y]=0;for(y=102990;y<=102992;y++)N[y]=1;for(y=102997;y<=103002;y++)N[y]=0;for(y=103003;y<=103008;y++)N[y]=2;for(y=103009;y<=103011;y++)N[y]=0;for(y=103012;y<=103014;y++)N[y]=2;for(y=103019;y<=103021;y++)N[y]=0;for(y=103022;y<=103024;y++)N[y]=2;for(y=103029;y<=103031;y++)N[y]=0;for(y=103032;y<=103034;y++)N[y]=2;for(y=103065;y<=103068;y++)N[y]=0;for(y=103074;y<=103076;y++)N[y]=0;for(y=103077;y<=103079;y++)N[y]=1;for(y=103080;y<=103082;y++)N[y]=0;for(y=103083;y<=103085;y++)N[y]=2;for(y=103090;y<=103093;y++)N[y]=0;for(y=103097;y<=103099;y++)N[y]=0;for(y=103100;y<=103102;y++)N[y]=2;for(y=103107;y<=103109;y++)N[y]=0;for(y=103110;y<=103112;y++)N[y]=2;for(y=103113;y<=103116;y++)N[y]=0;for(y=103117;y<=103120;y++)N[y]=2;for(y=103153;y<=103157;y++)N[y]=0;for(y=103158;y<=103162;y++)N[y]=2;for(y=103163;y<=103165;y++)N[y]=0;for(y=103166;y<=103168;y++)N[y]=1;for(y=103169;y<=103171;y++)N[y]=2;for(y=103186;y<=103188;y++)N[y]=0;for(y=103189;y<=103191;y++)N[y]=2;for(y=103192;y<=103195;y++)N[y]=0;for(y=103196;y<=103199;y++)N[y]=2;for(y=103200;y<=103224;y++)N[y]=0;for(y=103225;y<=103227;y++)N[y]=1;for(y=103232;y<=103237;y++)N[y]=0;for(y=103238;y<=103243;y++)N[y]=2;for(y=103244;y<=103246;y++)N[y]=0;for(y=103247;y<=103249;y++)N[y]=2;for(y=103254;y<=103256;y++)N[y]=0;for(y=103257;y<=103259;y++)N[y]=2;for(y=103264;y<=103266;y++)N[y]=0;for(y=103267;y<=103269;y++)N[y]=2;for(y=103300;y<=103375;y++)N[y]=0;for(y=103381;y<=103383;y++)N[y]=0;for(y=103384;y<=103386;y++)N[y]=1;for(y=103387;y<=103389;y++)N[y]=0;for(y=103390;y<=103392;y++)N[y]=2;for(y=103397;y<=103399;y++)N[y]=0;for(y=103400;y<=103471;y++)N[y]=2;for(y=103476;y<=103478;y++)N[y]=0;for(y=103479;y<=103481;y++)N[y]=2;for(y=103486;y<=103488;y++)N[y]=0;for(y=103489;y<=103491;y++)N[y]=2;for(y=103492;y<=103495;y++)N[y]=0;for(y=103496;y<=103499;y++)N[y]=2;for(y=103528;y<=103543;y++)N[y]=0;for(y=103544;y<=103548;y++)N[y]=2;for(y=103549;y<=103551;y++)N[y]=0;for(y=103552;y<=103554;y++)N[y]=1;for(y=103555;y<=103557;y++)N[y]=2;for(y=103558;y<=103560;y++)N[y]=0;for(y=103571;y<=103573;y++)N[y]=0;for(y=103574;y<=103576;y++)N[y]=2;for(y=103577;y<=103580;y++)N[y]=0;for(y=103581;y<=103583;y++)N[y]=2;for(y=103595;y<=103694;y++)N[y]=0;for(y=103696;y<=103699;y++)N[y]=0;for(y=103700;y<=103793;y++)N[y]=2;for(y=103794;y<=103887;y++)N[y]=0;for(y=103900;y<=103971;y++)N[y]=2;const Tke={102113:!0,102100:!0,3857:!0,3785:!0},Ske={4326:!0,3785:!0,3857:!0,102113:!0,102100:!0,104905:!0,104971:!0},yce='PROJCS["WGS_1984_Web_Mercator_Auxiliary_Sphere",GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Mercator_Auxiliary_Sphere"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],PARAMETER["Standard_Parallel_1",0.0],PARAMETER["Auxiliary_Sphere_Type",0.0],UNIT["Meter",1.0]]',EM=[-20037508342788905e-9,20037508342788905e-9],CM=[-20037508342787e-6,20037508342787e-6],k3e={102113:{wkTemplate:'PROJCS["WGS_1984_Web_Mercator",GEOGCS["GCS_WGS_1984_Major_Auxiliary_Sphere",DATUM["D_WGS_1984_Major_Auxiliary_Sphere",SPHEROID["WGS_1984_Major_Auxiliary_Sphere",6378137.0,0.0]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Mercator"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],PARAMETER["Standard_Parallel_1",0.0],UNIT["Meter",1.0]]',valid:EM,origin:CM,dx:1e-5},102100:{wkTemplate:yce,valid:EM,origin:CM,dx:1e-5},3785:{wkTemplate:'PROJCS["WGS_1984_Web_Mercator",GEOGCS["GCS_WGS_1984_Major_Auxiliary_Sphere",DATUM["D_WGS_1984_Major_Auxiliary_Sphere",SPHEROID["WGS_1984_Major_Auxiliary_Sphere",6378137.0,0.0]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Mercator"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],PARAMETER["Standard_Parallel_1",0.0],UNIT["Meter",1.0]]',valid:EM,origin:CM,dx:1e-5},3857:{wkTemplate:yce,valid:EM,origin:CM,dx:1e-5},4326:{wkTemplate:'GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",{Central_Meridian}],UNIT["Degree",0.0174532925199433]]',altTemplate:'PROJCS["WGS_1984_Plate_Carree",GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Plate_Carree"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],UNIT["Degrees",111319.491]]',valid:[-180,180],origin:[-180,90],dx:1e-5},104971:{wkTemplate:'GEOGCS["Mars_2000_(Sphere)",DATUM["Mars_2000_(Sphere)",SPHEROID["Mars_2000_(Sphere)",3396190.0,0.0]],PRIMEM["Reference_Meridian",0.0],UNIT["Degree",0.0174532925199433]]',valid:[-180,180],origin:[-180,90],dx:1e-5},104905:{wkTemplate:'GEOGCS["GCS_Mars_2000",DATUM["D_Mars_2000",SPHEROID["Mars_2000_IAU_IAG",3396190.0,169.8944472236118]],PRIMEM["Reference_Meridian",0.0],UNIT["Degree",0.0174532925199433]]',valid:[-180,180],origin:[-180,90],dx:1e-5}};function _l(e,t){return!R(e)&&!R(t)&&(e===t||(e.wkid!=null||t.wkid!=null?e.wkid===t.wkid||Ow(e)&&Ow(t)||t.latestWkid!=null&&e.wkid===t.latestWkid||e.latestWkid!=null&&t.wkid===e.latestWkid:!(!e.wkt||!t.wkt)&&e.wkt.toUpperCase()===t.wkt.toUpperCase()))}function oy(e){return dc(e)&&e.wkid&&k3e[e.wkid]||null}function V3e(e){return!!dc(e)&&(e.wkid?N[e.wkid]==null:!!e.wkt&&!!/^\s*GEOGCS/i.test(e.wkt))}function nA(e){return!(Sm(e)||Em(e))}function sA(e){return dc(e)&&e.wkid===4326}function z3e(e){return dc(e)&&e.wkid===Ph.CGCS2000}function Ow(e){return dc(e)&&e.wkid!=null&&Tke[e.wkid]===!0}function aA(e){return dc(e)&&e.wkid===32662}function Wte(e){return e===Ph.GCSMARS2000||e===Ph.GCSMARS2000_SPHERE}function Sm(e){return dc(e)&&e.wkid!=null&&Wte(e.wkid)}function Xte(e){return e===Ph.GCSMOON2000}function Em(e){return dc(e)&&e.wkid!=null&&Xte(e.wkid)}function U3e(e){return dc(e)&&e.wkid!=null&&Ske[e.wkid]===!0}function dc(e){return _(e)&&(e.wkid!=null&&e.wkid>=2e3||e.wkt!=null)}const Eke={wkid:4326,wkt:lm(k3e[4326].wkTemplate,{Central_Meridian:"0.0"})},Cke={wkid:102100,latestWkid:3857},Ake={wkid:32662};var o0;let Ai=o0=class extends ge{constructor(e){super(e),this.latestWkid=null,this.wkid=null,this.wkt=null,this.vcsWkid=null,this.latestVcsWkid=null,this.imageCoordinateSystem=null}static fromJSON(e){if(!e)return null;if(e.wkid){if(e.wkid===102100)return o0.WebMercator;if(e.wkid===4326)return o0.WGS84}const t=new o0;return t.read(e),t}normalizeCtorArgs(e){return e&&typeof e=="object"?e:{[typeof e=="string"?"wkt":"wkid"]:e}}get isWGS84(){return sA(this)}get isWebMercator(){return Ow(this)}get isGeographic(){return V3e(this)}get isWrappable(){return U3e(this)}writeWkt(e,t){this.wkid||(t.wkt=e)}clone(){if(this===o0.WGS84)return o0.WGS84;if(this===o0.WebMercator)return o0.WebMercator;const e=new o0;return this.wkid!=null?(e.wkid=this.wkid,this.latestWkid!=null&&(e.latestWkid=this.latestWkid),this.vcsWkid!=null&&(e.vcsWkid=this.vcsWkid),this.latestVcsWkid!=null&&(e.latestVcsWkid=this.latestVcsWkid)):this.wkt!=null&&(e.wkt=this.wkt),this.imageCoordinateSystem&&(e.imageCoordinateSystem=te(this.imageCoordinateSystem)),e}equals(e){if(e==null)return!1;if(this.imageCoordinateSystem||e.imageCoordinateSystem){if(this.imageCoordinateSystem==null||e.imageCoordinateSystem==null)return!1;const{id:t,referenceServiceName:r}=e.imageCoordinateSystem,{geodataXform:i}=e.imageCoordinateSystem,n=this.imageCoordinateSystem;return t==null||i?JSON.stringify(n)===JSON.stringify(e.imageCoordinateSystem):r?n.id===t&&n.referenceServiceName===r:n.id===t}return _l(this,e)}toJSON(e){return this.write(void 0,e)}};Ai.GCS_NAD_1927=null,Ai.WGS84=null,Ai.WebMercator=null,Ai.PlateCarree=null,d([f({readOnly:!0})],Ai.prototype,"isWGS84",null),d([f({readOnly:!0})],Ai.prototype,"isWebMercator",null),d([f({readOnly:!0})],Ai.prototype,"isGeographic",null),d([f({readOnly:!0})],Ai.prototype,"isWrappable",null),d([f({type:$i,json:{write:!0}})],Ai.prototype,"latestWkid",void 0),d([f({type:$i,json:{write:!0,origins:{"web-scene":{write:{overridePolicy(){return{isRequired:this.wkt===null}}}}}}})],Ai.prototype,"wkid",void 0),d([f({type:String,json:{origins:{"web-scene":{write:{overridePolicy(){return{isRequired:this.wkid===null}}}}}}})],Ai.prototype,"wkt",void 0),d([Xe("wkt"),Xe("web-scene","wkt")],Ai.prototype,"writeWkt",null),d([f({type:$i,json:{write:!0}})],Ai.prototype,"vcsWkid",void 0),d([f({type:$i,json:{write:!0}})],Ai.prototype,"latestVcsWkid",void 0),d([f()],Ai.prototype,"imageCoordinateSystem",void 0),Ai=o0=d([$("esri.geometry.SpatialReference")],Ai),Ai.prototype.toJSON.isDefaultToJSON=!0,Ai.GCS_NAD_1927=new Ai({wkid:4267,wkt:'GEOGCS["GCS_North_American_1927",DATUM["D_North_American_1927",SPHEROID["Clarke_1866",6378206.4,294.9786982]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]]'}),Ai.WGS84=new Ai(Eke),Ai.WebMercator=new Ai(Cke),Ai.PlateCarree=new Ai(Ake),Object.freeze&&(Object.freeze(Ai.GCS_NAD_1927),Object.freeze(Ai.WGS84),Object.freeze(Ai.WebMercator));const Ye=Ai,B3e="20220708",G3e="7fd01dbc0e83d753fcf101c8ff2a8d215430252d",j3e="4.24",Rke={async request(e,t){var o;const{default:r}=await ie(()=>Promise.resolve().then(()=>Z3e),void 0,import.meta.url),i=e.options,n=i.responseType;i.signal=t==null?void 0:t.signal,i.responseType=n==="native"||n==="native-request-init"?"native-request-init":["blob","json","text"].includes(n)&&((o=I3e(e.url))==null?void 0:o.after)?n:"array-buffer";const s=await r(e.url,i),a={data:s.data,ssl:s.ssl};switch(s.requestOptions.responseType){case"native-request-init":return delete a.data.signal,a;case"blob":a.data=await a.data.arrayBuffer();break;case"json":a.data=new TextEncoder().encode(JSON.stringify(a.data)).buffer;break;case"text":a.data=new TextEncoder().encode(a.data).buffer}return{result:a,transferList:[a.data]}}};let Xi;function qPt(e){Xi=e}function q3e(e){const t=Xi&&Xi.findCredential(e);return t&&t.token?N3e(e,"token",t.token):e}ue("host-webworker")||(ue("edge")||ue("trident"))&&console.warn("Deprecated browser - see http://esriurl.com/oldbrowser");const Oke=["elevation3d.arcgis.com","js.arcgis.com","jsdev.arcgis.com","jsqa.arcgis.com","static.arcgis.com"];function H3e(e){const t=Tp(e,!0);return t&&t.endsWith(".arcgis.com")&&!Oke.includes(t)&&!e.endsWith("/sharing/rest/generateToken")}function W3e(e,t,r=!1,i){return new Promise((n,s)=>{if(bs(i))return void s(bce());let a=()=>{c(),s(new Error(`Unable to load ${t}`))},o=()=>{const u=e;c(),n(u)},l=()=>{if(!e)return;const u=e;c(),u.src="",s(bce())};const c=()=>{ue("esri-image-decode")||(e.removeEventListener("error",a),e.removeEventListener("load",o)),a=null,o=null,e=null,_(i)&&i.removeEventListener("abort",l),l=null,r&&URL.revokeObjectURL(t)};_(i)&&i.addEventListener("abort",l),ue("esri-image-decode")?e.decode().then(o,a):(e.addEventListener("error",a),e.addEventListener("load",o))})}function bce(){try{return new DOMException("Aborted","AbortError")}catch{const e=new Error;return e.name="AbortError",e}}function Mke(e){Vr.request.crossOriginNoCorsDomains||(Vr.request.crossOriginNoCorsDomains={});const t=Vr.request.crossOriginNoCorsDomains;for(let r of e)r=r.toLowerCase(),/^https?:\/\//.test(r)?t[Tp(r)]=0:(t[Tp("http://"+r)]=0,t[Tp("https://"+r)]=0)}function Pke(e){const t=Vr.request.crossOriginNoCorsDomains;if(t){let r=Tp(e);if(r)return r=r.toLowerCase(),!iA(r,kte())&&t[r]<Date.now()-36e5}return!1}async function Ike(e){var i;const t=Vr.request.crossOriginNoCorsDomains;t&&(t[Tp(e).toLowerCase()]=Date.now());const r=pn(e);e=r.path,((i=r.query)==null?void 0:i.f)==="json"&&(e+="?f=json");try{await fetch(e,{mode:"no-cors",credentials:"include"})}catch{}}async function qt(e,t){var c;const r=Tm(e),i=qv(e);i||r||(e=zh(e));const n={url:e,requestOptions:{...t}};let s=I3e(e);if(s){const u=await zke(s,n);if(u!=null)return{data:u,getHeader:Yte,requestOptions:n.requestOptions,url:n.url};s.after||s.error||(s=null)}if(e=n.url,(t=n.requestOptions).responseType==="image"){if(ue("host-webworker")||ue("host-node"))throw cp("request:invalid-parameters",new Error("responseType 'image' is not supported in Web Workers or Node environment"),n)}else if(r)throw cp("request:invalid-parameters",new Error("Data URLs are not supported for responseType = "+t.responseType),n);if(t.method==="head"){if(t.body)throw cp("request:invalid-parameters",new Error("body parameter cannot be set when method is 'head'"),n);if(r||i)throw cp("request:invalid-parameters",new Error("data and blob URLs are not supported for method 'head'"),n)}if(await Nke(),IF)return IF.execute(e,t);const a=new AbortController;Fo(t,()=>a.abort());const o={controller:a,credential:null,credentialToken:null,fetchOptions:null,hasToken:!1,interceptor:s,params:n,redoRequest:!1,useIdentity:Qf.useIdentity,useProxy:!1,useSSL:!1,withCredentials:!1},l=await Bke(o);return(c=s==null?void 0:s.after)==null||c.call(s,l),l}let IF;const Qf=Vr.request,X3e="FormData"in globalThis,$ke=[499,498,403,401],Lke=["COM_0056","COM_0057","SB_0008"],Dke=[/\/arcgis\/tokens/i,/\/sharing(\/rest)?\/generatetoken/i,/\/rest\/info/i],Yte=()=>null,pX=Symbol();function Fke(e){const t=Tp(e);t&&!qt._corsServers.includes(t)&&qt._corsServers.push(t)}function vce(e){const t=Tp(e);return!t||t.endsWith(".arcgis.com")||qt._corsServers.includes(t)||zte(t)}function cp(e,t,r,i){let n="Error";const s={url:r.url,requestOptions:r.requestOptions,getHeader:Yte,ssl:!1};if(t instanceof k)return t.details?(t.details=te(t.details),t.details.url=r.url,t.details.requestOptions=r.requestOptions):t.details=s,t;if(t){const a=i&&(c=>i.headers.get(c)),o=i&&i.status,l=t.message;l&&(n=l),a&&(s.getHeader=a),s.httpStatus=(t.httpCode!=null?t.httpCode:t.code)||o||0,s.subCode=t.subcode,s.messageCode=t.messageCode,typeof t.details=="string"?s.messages=[t.details]:s.messages=t.details,s.raw=pX in t?t[pX]:t}return Ui(t)?br():new k(e,n,s)}async function Nke(){ue("host-webworker")?IF||(IF=await ie(()=>import("./request.b206b6cd.js"),[],import.meta.url)):qt._abortableFetch||(qt._abortableFetch=globalThis.fetch.bind(globalThis))}async function mX(){Xi||await ie(()=>import("./IdentityManager.e4bc75fb.js"),[],import.meta.url)}async function kke(e){var o;const t=e.params.url,r=e.params.requestOptions,i=e.controller.signal,n=r.body;let s=null,a=null;if(X3e&&"HTMLFormElement"in globalThis&&(n instanceof FormData?s=n:n instanceof HTMLFormElement&&(s=new FormData(n))),typeof n=="string"&&(a=n),e.fetchOptions={cache:r.cacheBust&&!qt._abortableFetch.polyfill?"no-cache":"default",credentials:"same-origin",headers:r.headers||{},method:r.method==="head"?"HEAD":"GET",mode:"cors",priority:Qf.priority,redirect:"follow",signal:i},(s||a)&&(e.fetchOptions.body=s||a),r.authMode==="anonymous"&&(e.useIdentity=!1),e.hasToken=!!(/token=/i.test(t)||((o=r.query)==null?void 0:o.token)||(s==null?void 0:s.get("token"))),!e.hasToken&&Vr.apiKey&&H3e(t)&&(r.query||(r.query={}),r.query.token=Vr.apiKey,e.hasToken=!0),e.useIdentity&&!e.hasToken&&!e.credentialToken&&!Y3e(t)&&!bs(i)){let l;r.authMode==="immediate"?(await mX(),l=await Xi.getCredential(t,{signal:i}),e.credential=l):r.authMode==="no-prompt"?(await mX(),l=await Xi.getCredential(t,{prompt:!1,signal:i}).catch(()=>{}),e.credential=l):Xi&&(l=Xi.findCredential(t)),l&&(e.credentialToken=l.token,e.useSSL=!!l.ssl)}}function Y3e(e){return Dke.some(t=>t.test(e))}async function Vke(e){let t=e.params.url;const r=e.params.requestOptions,i=e.fetchOptions,n=qv(t)||Tm(t),s=r.responseType||"json",a=n?0:r.timeout!=null?r.timeout:Qf.timeout;let o=!1;if(!n){e.useSSL&&(t=Gte(t)),r.cacheBust&&i.cache==="default"&&(t=N3e(t,"request.preventCache",Date.now()));let p={...r.query};e.credentialToken&&(p.token=e.credentialToken);let m=rA(p);ue("esri-url-encodes-apostrophe")&&(m=m.replace(/'/g,"%27"));const g=t.length+1+m.length;let b;o=r.method==="delete"||r.method==="post"||r.method==="put"||!!r.body||g>Qf.maxUrlLength;const w=r.useProxy||!!uV(t);if(w){const v=ske(t);b=v.path,!o&&b.length+1+g>Qf.maxUrlLength&&(o=!0),v.query&&(p={...v.query,...p})}if(i.method==="HEAD"&&(o||w)){if(o)throw g>Qf.maxUrlLength?cp("request:invalid-parameters",new Error("URL exceeds maximum length"),e.params):cp("request:invalid-parameters",new Error("cannot use POST request when method is 'head'"),e.params);if(w)throw cp("request:invalid-parameters",new Error("cannot use proxy when method is 'head'"),e.params)}if(o?(i.method=r.method==="delete"?"DELETE":r.method==="put"?"PUT":"POST",r.body?t=B$(t,p):(i.body=rA(p),i.headers["Content-Type"]="application/x-www-form-urlencoded")):t=B$(t,p),w&&(e.useProxy=!0,t=`${b}?${t}`),p.token&&X3e&&i.body instanceof FormData&&!/\/(sharing|usrsvcs)\/(appservices|servers)\//i.test(t)&&i.body.set("token",p.token),r.hasOwnProperty("withCredentials"))e.withCredentials=r.withCredentials;else if(!iA(t,kte())){if(zte(t))e.withCredentials=!0;else if(Xi){const v=Xi.findServerInfo(t);v&&v.webTierAuth&&(e.withCredentials=!0)}}e.withCredentials&&(i.credentials="include",Pke(t)&&await Ike(o?B$(t,p):t))}let l,c,u=0,h=!1;a>0&&(u=setTimeout(()=>{h=!0,e.controller.abort()},a));try{if(r.responseType==="native-request-init")c=i,c.url=t;else if(r.responseType!=="image"||i.cache!=="default"||i.method!=="GET"||o||Uke(r.headers)||!n&&!e.useProxy&&Qf.proxyUrl&&!vce(t)){if(l=await qt._abortableFetch(t,i),e.useProxy||Fke(t),r.responseType==="native")c=l;else if(i.method!=="HEAD")if(l.ok){switch(s){case"array-buffer":c=await l.arrayBuffer();break;case"blob":case"image":c=await l.blob();break;default:c=await l.text()}if(u&&(clearTimeout(u),u=0),s==="json"||s==="xml"||s==="document")if(c)switch(s){case"json":c=JSON.parse(c);break;case"xml":c=_ce(c,"application/xml");break;case"document":c=_ce(c,"text/html")}else c=null;if(c){if(s==="array-buffer"||s==="blob"){const p=l.headers.get("Content-Type");if(/application\/json|text\/plain/i.test(p)&&c[s==="blob"?"size":"byteLength"]<=750)try{const m=await new Response(c).json();m.error&&(c=m)}catch{}}s==="image"&&c instanceof Blob&&(c=await wce(URL.createObjectURL(c),e,!0))}}else c=await l.text()}else c=await wce(t,e)}catch(p){if(p.name==="AbortError")throw h?new Error("Timeout exceeded"):br("Request canceled");if(!(!l&&p instanceof TypeError&&Qf.proxyUrl)||r.body||r.method==="delete"||r.method==="head"||r.method==="post"||r.method==="put"||e.useProxy||vce(t))throw p;e.redoRequest=!0,oke({proxyUrl:Qf.proxyUrl,urlPrefix:Tp(t)})}finally{u&&clearTimeout(u)}return[l,c]}async function zke(e,t){if(e.responseData!=null)return e.responseData;if(e.headers&&(t.requestOptions.headers={...t.requestOptions.headers,...e.headers}),e.query&&(t.requestOptions.query={...t.requestOptions.query,...e.query}),e.before){let r,i;try{i=await e.before(t)}catch(n){r=cp("request:interceptor",n,t)}if((i instanceof Error||i instanceof k)&&(r=cp("request:interceptor",i,t)),r)throw e.error&&e.error(r),r;return i}}function Uke(e){if(e){for(const t of Object.getOwnPropertyNames(e))if(e[t])return!0}return!1}function _ce(e,t){let r;try{r=new DOMParser().parseFromString(e,t)}catch{}if(!r||r.getElementsByTagName("parsererror").length)throw new SyntaxError("XML Parse error");return r}async function Bke(e){var s;let t,r;await kke(e);try{do[t,r]=await Vke(e);while(!await Gke(e,t,r))}catch(a){const o=cp("request:server",a,e.params,t);throw o.details.ssl=e.useSSL,e.interceptor&&e.interceptor.error&&e.interceptor.error(o),o}const i=e.params.url;if(r&&/\/sharing\/rest\/(accounts|portals)\/self/i.test(i)){if(!e.hasToken&&!e.credentialToken&&((s=r.user)==null?void 0:s.username)&&!zte(i)){const a=Tp(i,!0);a&&Qf.trustedServers.push(a)}Array.isArray(r.authorizedCrossOriginNoCorsDomains)&&Mke(r.authorizedCrossOriginNoCorsDomains)}const n=e.credential;if(n&&Xi){const a=Xi.findServerInfo(n.server);let o=a&&a.owningSystemUrl;if(o){o=o.replace(/\/?$/,"/sharing");const l=Xi.findCredential(o,n.userId);l&&Xi._getIdenticalSvcIdx(o,l)===-1&&l.resources.unshift(o)}}return{data:r,getHeader:t?a=>t.headers.get(a):Yte,requestOptions:e.params.requestOptions,ssl:e.useSSL,url:e.params.url}}async function Gke(e,t,r){if(e.redoRequest)return e.redoRequest=!1,!1;const i=e.params.requestOptions;if(!t||i.responseType==="native"||i.responseType==="native-request-init")return!0;let n,s,a,o;if(!t.ok)throw n=new Error(`Unable to load ${t.url} status: ${t.status}`),n[pX]=r,n;r!=null&&r.error&&(n=r.error),n&&(s=Number(n.code),a=n.hasOwnProperty("subcode")?Number(n.subcode):null,o=n.messageCode,o=o&&o.toUpperCase());const l=i.authMode;if(s===403&&(a===4||n.message&&n.message.toLowerCase().includes("ssl")&&!n.message.toLowerCase().includes("permission"))){if(!e.useSSL)return e.useSSL=!0,!1}else if(!e.hasToken&&e.useIdentity&&(l!=="no-prompt"||s===498)&&$ke.includes(s)&&!Y3e(e.params.url)&&(s!==403||!Lke.includes(o)&&(a==null||a===2&&e.credentialToken))){await mX();try{const c=await Xi.getCredential(e.params.url,{error:cp("request:server",n,e.params),prompt:l!=="no-prompt",signal:e.controller.signal,token:e.credentialToken});return e.credential=c,e.credentialToken=c.token,e.useSSL=e.useSSL||c.ssl,!1}catch(c){if(l==="no-prompt")return e.credential=null,e.credentialToken=null,!1;n=c}}if(n)throw n;return!0}function wce(e,t,r=!1){const i=t.controller.signal,n=new Image;return t.withCredentials?n.crossOrigin="use-credentials":n.crossOrigin="anonymous",n.alt="",n.fetchPriority=Qf.priority,n.src=e,W3e(n,e,r,i)}qt._abortableFetch=null,qt._corsServers=["https://server.arcgisonline.com","https://services.arcgisonline.com"];const Z3e=Object.freeze(Object.defineProperty({__proto__:null,default:qt},Symbol.toStringTag,{value:"Module"}));function $e(e,t,r){let i,n;return t===void 0||Array.isArray(t)?(n=e,r=t,i=[void 0]):(n=t,i=Array.isArray(e)?e:[e]),(s,a)=>{const o=s.constructor.prototype;i.forEach(l=>{const c=Pte(s,l,n);c.read&&typeof c.read=="object"||(c.read={}),c.read.reader=o[a],r&&(c.read.source=(c.read.source||[]).concat(r))})}}let l0=class extends ge{constructor(...e){super(...e),this.type=null,this.hasM=!1,this.hasZ=!1,this.spatialReference=Ye.WGS84}get cache(){return this.commitProperty("spatialReference"),{}}get extent(){return null}readSpatialReference(e,t){if(e instanceof Ye)return e;if(e!=null){const r=new Ye;return r.read(e,t),r}return e}clone(){return console.warn(".clone() is not implemented for "+this.declaredClass),null}clearCache(){this.notifyChange("cache")}getCacheValue(e){return this.cache[e]}setCacheValue(e,t){this.cache[e]=t}};d([f()],l0.prototype,"type",void 0),d([f({readOnly:!0})],l0.prototype,"cache",null),d([f({readOnly:!0})],l0.prototype,"extent",null),d([f({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],l0.prototype,"hasM",void 0),d([f({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],l0.prototype,"hasZ",void 0),d([f({type:Ye,json:{write:!0}})],l0.prototype,"spatialReference",void 0),d([$e("spatialReference")],l0.prototype,"readSpatialReference",null),l0=d([$("esri.geometry.Geometry")],l0);const fd=l0,jke=Object.prototype.toString;function qke(e){const t="__accessorMetadata__"in e?rs(e):e;return function(...r){if(r.push(t),typeof r[2]=="number")throw new Error("Using @cast has parameter decorator is not supported since 4.16");return Hke.apply(this,r)}}function Hke(e,t,r,i){GR(e,t).cast=i}function Wke(e){return(t,r)=>{GR(t,e).cast=t[r]}}function Xt(...e){if(e.length!==3||typeof e[1]!="string")return e.length===1&&jke.call(e[0])==="[object Function]"?qke(e[0]):e.length===1&&typeof e[0]=="string"?Wke(e[0]):void 0}function Xke(e,t,r,i){var n;return e.x=e.x+t,e.y=e.y+r,i!=null&&(e.z=((n=e.z)!=null?n:0)+i),e}function Yke(e,t){const r=e.x-t.x,i=e.y-t.y,n=e.hasZ&&t.hasZ?e.z-t.z:0;return Math.sqrt(r*r+i*i+n*n)}class Zte{constructor(t,r,i,n){this.semiMajorAxis=t,this.flattening=r,this.outerAtmosphereRimWidth=i;const s=1-this.flattening;this.semiMinorAxis=this.semiMajorAxis*s,this.halfSemiMajorAxis=this.semiMajorAxis/2,this.halfCircumference=Math.PI*this.semiMajorAxis,this.metersPerDegree=this.halfCircumference/180,this.inverseFlattening=1/(1-this.flattening)-1,this.eccentricitySquared=n||2*this.flattening-this.flattening*this.flattening,this.meanRadiusSemiAxes=(2*this.semiMajorAxis+this.semiMinorAxis)/3}get radius(){return this.semiMajorAxis}}const $r=new Zte(6378137,1/298.257223563,3e5,.006694379990137799),em=new Zte(3396190,1/169.8944472236118,23e4),Ay=new Zte(1737400,0,0),Zke=57.29577951308232,Qke=.017453292519943;function xce(e){return e*Zke}function Tce(e){return e*Qke}function Sce(e){return e/$r.radius}function $F(e){return Math.PI/2-2*Math.atan(Math.exp(-e/$r.radius))}function gX(e){return e.wkid!=null||e.wkt!=null}const YB=[0,0];function LF(e,t,r,i,n){const s=e,a=n;if(a.spatialReference=r,"x"in s&&"x"in a)[a.x,a.y]=t(s.x,s.y,YB,i);else if("xmin"in s&&"xmin"in a)[a.xmin,a.ymin]=t(s.xmin,s.ymin,YB,i),[a.xmax,a.ymax]=t(s.xmax,s.ymax,YB,i);else if("paths"in s&&"paths"in a||"rings"in s&&"rings"in a){const o="paths"in s?s.paths:s.rings,l=[];let c;for(let u=0;u<o.length;u++){const h=o[u];c=[],l.push(c);for(let p=0;p<h.length;p++)c.push(t(h[p][0],h[p][1],[0,0],i)),h[p].length>2&&c[p].push(h[p][2]),h[p].length>3&&c[p].push(h[p][3])}"paths"in a?a.paths=l:a.rings=l}else if("points"in s&&"points"in a){const o=s.points,l=[];for(let c=0;c<o.length;c++)l[c]=t(o[c][0],o[c][1],[0,0],i),o[c].length>2&&l[c].push(o[c][2]),o[c].length>3&&l[c].push(o[c][3]);a.points=l}return n}function Ov(e,t){const r=e&&(gX(e)?e:e.spatialReference),i=t&&(gX(t)?t:t.spatialReference);return!(e&&"type"in e&&e.type==="mesh"||t&&"type"in t&&t.type==="mesh"||!r||!i)&&(!!_l(i,r)||Ow(i)&&sA(r)||Ow(r)&&sA(i))}function mx(e,t){if(R(e))return null;const r=e.spatialReference,i=t&&(gX(t)?t:t.spatialReference);return Ov(r,i)?_l(r,i)?te(e):Ow(i)?LF(e,l4,Ye.WebMercator,!1,te(e)):sA(i)?LF(e,zC,Ye.WGS84,!1,te(e)):null:null}function l4(e,t,r=[0,0]){t>89.99999?t=89.99999:t<-89.99999&&(t=-89.99999);const i=Tce(t);return r[0]=Tce(e)*$r.radius,r[1]=$r.halfSemiMajorAxis*Math.log((1+Math.sin(i))/(1-Math.sin(i))),r}function zC(e,t,r=[0,0],i=!1){const n=xce(e/$r.radius);return r[0]=i?n:n-360*Math.floor((n+180)/360),r[1]=xce(Math.PI/2-2*Math.atan(Math.exp(-t/$r.radius))),r}function ly(e,t=!1,r=te(e)){return LF(e,l4,Ye.WebMercator,t,r)}function aE(e,t=!1,r=te(e)){return LF(e,zC,Ye.WGS84,t,r)}var G$;const k6=[0,0];function Ece(e){return e&&(e.declaredClass==="esri.geometry.SpatialReference"||e.wkid!=null)}const AM=fe.getLogger("esri.geometry.Point");let Ll=G$=class extends fd{constructor(...e){super(...e),this.x=0,this.y=0,this.z=void 0,this.m=void 0,this.type="point"}static copy(e,t){t._set("x",e._get("x")),t._set("y",e._get("y")),t._set("z",e._get("z")),t._set("m",e._get("m"));const r=e._get("spatialReference");t._set("spatialReference",Object.isFrozen(r)?r:r.clone())}normalizeCtorArgs(e,t,r,i,n){let s;if(Array.isArray(e))s=e,n=t,e=s[0],t=s[1],r=s[2],i=s[3];else if(e&&typeof e=="object"){if(s=e,e=s.x!=null?s.x:s.longitude,t=s.y!=null?s.y:s.latitude,r=s.z,i=s.m,(n=s.spatialReference)&&n.declaredClass!=="esri.geometry.SpatialReference"&&(n=new Ye(n)),s.longitude!=null||s.latitude!=null){if(s.longitude==null)AM.warn(".longitude=","Latitude was defined without longitude");else if(s.latitude==null)AM.warn(".latitude=","Longitude was defined without latitude");else if(!s.declaredClass&&n&&n.isWebMercator){const o=l4(s.longitude,s.latitude,k6);e=o[0],t=o[1]}}}else Ece(r)?(n=r,r=null):Ece(i)&&(n=i,i=null);const a={x:e,y:t};return a.x==null&&a.y!=null?AM.warn(".y=","Y coordinate was defined without an X coordinate"):a.y==null&&a.x!=null&&AM.warn(".x=","X coordinate was defined without a Y coordinate"),n!=null&&(a.spatialReference=n),r!=null&&(a.z=r),i!=null&&(a.m=i),a}get cache(){return this.commitProperty("x"),this.commitProperty("y"),this.commitProperty("z"),this.commitProperty("m"),this.commitProperty("spatialReference"),{}}get hasM(){return this.m!==void 0}set hasM(e){e!==(this._get("m")!==void 0)&&(this._set("m",e?0:void 0),this._set("hasM",e))}get hasZ(){return this.z!==void 0}set hasZ(e){e!==(this._get("z")!==void 0)&&(this._set("z",e?0:void 0),this._set("hasZ",e))}get latitude(){const{spatialReference:e,x:t,y:r}=this;if(e){if(e.isWebMercator)return zC(t,r,k6)[1];if(e.isGeographic)return r}return null}set latitude(e){const{spatialReference:t,x:r}=this;t&&(t.isWebMercator?this._set("y",l4(r,e,k6)[1]):t.isGeographic&&this._set("y",e),this._set("latitude",e))}get longitude(){const{x:e,y:t,spatialReference:r}=this;if(r){if(r.isWebMercator)return zC(e,t,k6)[0];if(r.isGeographic)return e}return null}set longitude(e){const{y:t,spatialReference:r}=this;r&&(r.isWebMercator?this._set("x",l4(e,t,k6)[0]):r.isGeographic&&this._set("x",e),this._set("longitude",e))}writeX(e,t,r){t[r]=isNaN(e)?"NaN":e}readX(e){return typeof e=="string"?NaN:e}clone(){const e=new G$;return e.x=this.x,e.y=this.y,e.z=this.z,e.m=this.m,e.spatialReference=this.spatialReference,e}copy(e){return G$.copy(e,this),this}equals(e){if(R(e))return!1;const{x:t,y:r,z:i,m:n,spatialReference:s}=this,{z:a,m:o}=e;let{x:l,y:c,spatialReference:u}=e;if(!s.equals(u))if(s.isWebMercator&&u.isWGS84)[l,c]=l4(l,c),u=s;else{if(!s.isWGS84||!u.isWebMercator)return!1;[l,c]=zC(l,c),u=s}return t===l&&r===c&&i===a&&n===o&&s.wkid===u.wkid}offset(e,t,r){return Xke(this,e,t,r)}normalize(){if(!this.spatialReference)return this;const e=oy(this.spatialReference);if(!e)return this;let t=this.x;const[r,i]=e.valid,n=2*i;let s;return t>i?(s=Math.ceil(Math.abs(t-i)/n),t-=s*n):t<r&&(s=Math.ceil(Math.abs(t-r)/n),t+=s*n),this._set("x",t),this}distance(e){return Yke(this,e)}toArray(){const e=this.hasZ,t=this.hasM;return e&&t?[this.x,this.y,this.z,this.m]:e?[this.x,this.y,this.z]:t?[this.x,this.y,this.m]:[this.x,this.y]}toJSON(e){return this.write({},e)}};d([f({readOnly:!0})],Ll.prototype,"cache",null),d([f({type:Boolean,json:{read:!1,write:{enabled:!1,overridePolicy:null}}})],Ll.prototype,"hasM",null),d([f({type:Boolean,json:{read:!1,write:{enabled:!1,overridePolicy:null}}})],Ll.prototype,"hasZ",null),d([f({type:Number})],Ll.prototype,"latitude",null),d([f({type:Number})],Ll.prototype,"longitude",null),d([f({type:Number,json:{type:[Number,String],write:{isRequired:!0,allowNull:!0}}}),Xt(e=>isNaN(e)?e:Eh(e))],Ll.prototype,"x",void 0),d([Xe("x")],Ll.prototype,"writeX",null),d([$e("x")],Ll.prototype,"readX",null),d([f({type:Number,json:{write:!0}})],Ll.prototype,"y",void 0),d([f({type:Number,json:{write:{overridePolicy(){return{enabled:this.hasZ}}}}})],Ll.prototype,"z",void 0),d([f({type:Number,json:{write:{overridePolicy(){return{enabled:this.hasM}}}}})],Ll.prototype,"m",void 0),Ll=G$=d([$("esri.geometry.Point")],Ll),Ll.prototype.toJSON.isDefaultToJSON=!0;const ot=Ll,ZB=[0,0];function Qte(e,t){return!!_(t)&&sl(e,t.x,t.y,t.z)}function HPt(e,t){if(!t.points||t.points.length)return!1;for(const r of t.points)if(!P5(e,r))return!1;return!0}function Jke(e,t){const{xmin:r,ymin:i,zmin:n,xmax:s,ymax:a,zmax:o}=t;return e.hasZ&&t.hasZ?sl(e,r,i,n)&&sl(e,r,a,n)&&sl(e,s,a,n)&&sl(e,s,i,n)&&sl(e,r,i,o)&&sl(e,r,a,o)&&sl(e,s,a,o)&&sl(e,s,i,o):sl(e,r,i)&&sl(e,r,a)&&sl(e,s,a)&&sl(e,s,i)}function P5(e,t){return sl(e,t[0],t[1])}function Kke(e,t){return sl(e,t[0],t[1],t[2])}function sl(e,t,r,i){return t>=e.xmin&&t<=e.xmax&&r>=e.ymin&&r<=e.ymax&&(i==null||!e.hasZ||i>=e.zmin&&i<=e.zmax)}function eVe(e,t){return ZB[1]=t.y,ZB[0]=t.x,tVe(e,ZB)}function tVe(e,t){return Q3e(e.rings,t)}function Q3e(e,t){if(!e)return!1;if(rVe(e))return Cce(!1,e,t);let r=!1;for(let i=0,n=e.length;i<n;i++)r=Cce(r,e[i],t);return r}function rVe(e){return!Array.isArray(e[0][0])}function Cce(e,t,r){const[i,n]=r;let s=e,a=0;for(let o=0,l=t.length;o<l;o++){a++,a===l&&(a=0);const[c,u]=t[o],[h,p]=t[a];(u<n&&p>=n||p<n&&u>=n)&&c+(n-u)/(p-u)*(h-c)<i&&(s=!s)}return s}function iVe(e,t){return Qte(e,t)}function nVe(e,t){const r=e.hasZ&&t.hasZ;let i,n,s;if(e.xmin<=t.xmin){if(i=t.xmin,e.xmax<i)return!1}else if(i=e.xmin,t.xmax<i)return!1;if(e.ymin<=t.ymin){if(n=t.ymin,e.ymax<n)return!1}else if(n=e.ymin,t.ymax<n)return!1;if(r&&t.hasZ){if(e.zmin<=t.zmin){if(s=t.zmin,e.zmax<s)return!1}else if(s=e.zmin,t.zmax<s)return!1}return!0}function sVe(e,t){const{points:r,hasZ:i}=t,n=i?Kke:P5;for(const s of r)if(n(e,s))return!0;return!1}const Mw=[0,0],Pw=[0,0],Iw=[0,0],$w=[0,0],aVe=[Mw,Pw,Iw,$w],J3e=[[Iw,Mw],[Mw,Pw],[Pw,$w],[$w,Iw]];function oVe(e,t){return lVe(e,t.rings)}function lVe(e,t){Mw[0]=e.xmin,Mw[1]=e.ymax,Pw[0]=e.xmax,Pw[1]=e.ymax,Iw[0]=e.xmin,Iw[1]=e.ymin,$w[0]=e.xmax,$w[1]=e.ymin;for(const r of aVe)if(Q3e(t,r))return!0;for(const r of t){if(!r.length)continue;let i=r[0];if(P5(e,i))return!0;for(let n=1;n<r.length;n++){const s=r[n];if(P5(e,s)||K3e(i,s,J3e))return!0;i=s}}return!1}function cVe(e,t){Mw[0]=e.xmin,Mw[1]=e.ymax,Pw[0]=e.xmax,Pw[1]=e.ymax,Iw[0]=e.xmin,Iw[1]=e.ymin,$w[0]=e.xmax,$w[1]=e.ymin;const r=t.paths;for(const i of r){if(!r.length)continue;let n=i[0];if(P5(e,n))return!0;for(let s=1;s<i.length;s++){const a=i[s];if(P5(e,a)||K3e(n,a,J3e))return!0;n=a}}return!1}const Ua=[0,0];function dVe(e){for(let t=0;t<e.length;t++){const r=e[t];for(let n=0;n<r.length-1;n++){const s=r[n],a=r[n+1];for(let o=t+1;o<e.length;o++)for(let l=0;l<e[o].length-1;l++){const c=e[o][l],u=e[o][l+1];if(yX(s,a,c,u,Ua)&&!(Ua[0]===s[0]&&Ua[1]===s[1]||Ua[0]===c[0]&&Ua[1]===c[1]||Ua[0]===a[0]&&Ua[1]===a[1]||Ua[0]===u[0]&&Ua[1]===u[1]))return!0}}const i=r.length;if(!(i<=4))for(let n=0;n<i-3;n++){let s=i-1;n===0&&(s=i-2);const a=r[n],o=r[n+1];for(let l=n+2;l<s;l++){const c=r[l],u=r[l+1];if(yX(a,o,c,u,Ua)&&!(Ua[0]===a[0]&&Ua[1]===a[1]||Ua[0]===c[0]&&Ua[1]===c[1]||Ua[0]===o[0]&&Ua[1]===o[1]||Ua[0]===u[0]&&Ua[1]===u[1]))return!0}}}return!1}function K3e(e,t,r){for(let i=0;i<r.length;i++)if(yX(e,t,r[i][0],r[i][1]))return!0;return!1}function yX(e,t,r,i,n){const[s,a]=e,[o,l]=t,[c,u]=r,[h,p]=i,m=h-c,g=s-c,b=o-s,w=p-u,v=a-u,x=l-a,T=w*b-m*x;if(T===0)return!1;const E=(m*v-w*g)/T,C=(b*v-x*g)/T;return E>=0&&E<=1&&C>=0&&C<=1&&(n&&(n[0]=s+E*(o-s),n[1]=a+E*(l-a)),!0)}function uVe(e){switch(e){case"esriGeometryEnvelope":case"extent":return nVe;case"esriGeometryMultipoint":case"multipoint":return sVe;case"esriGeometryPoint":case"point":return iVe;case"esriGeometryPolygon":case"polygon":return oVe;case"esriGeometryPolyline":case"polyline":return cVe}}var Ju;function hVe(e){return e&&(e.declaredClass==="esri.geometry.SpatialReference"||e.wkid!=null)}function ob(e,t,r){return t==null?r:r==null?t:e(t,r)}let fa=Ju=class extends fd{constructor(...e){super(...e),this.type="extent",this.xmin=0,this.ymin=0,this.mmin=void 0,this.zmin=void 0,this.xmax=0,this.ymax=0,this.mmax=void 0,this.zmax=void 0}normalizeCtorArgs(e,t,r,i,n){return hVe(e)?{spatialReference:e,xmin:0,ymin:0,xmax:0,ymax:0}:typeof e=="object"?(e.spatialReference=e.spatialReference==null?Ye.WGS84:e.spatialReference,e):{xmin:e,ymin:t,xmax:r,ymax:i,spatialReference:n==null?Ye.WGS84:n}}static fromBounds(e,t){return new Ju({xmin:e[0],ymin:e[1],xmax:e[2],ymax:e[3],spatialReference:t})}static fromPoint(e){return new Ju({xmin:e.x,ymin:e.y,zmin:e.z,xmax:e.x,ymax:e.y,zmax:e.z,spatialReference:e.spatialReference})}get cache(){return this.commitProperty("xmin"),this.commitProperty("ymin"),this.commitProperty("zmin"),this.commitProperty("mmin"),this.commitProperty("xmax"),this.commitProperty("ymax"),this.commitProperty("zmax"),this.commitProperty("mmax"),this.commitProperty("spatialReference"),{}}get center(){const e=new ot({x:.5*(this.xmin+this.xmax),y:.5*(this.ymin+this.ymax),spatialReference:this.spatialReference});return this.hasZ&&(e.z=.5*(this.zmin+this.zmax)),this.hasM&&(e.m=.5*(this.mmin+this.mmax)),e}get extent(){return this.clone()}get hasM(){return this.mmin!=null&&this.mmax!=null}get hasZ(){return this.zmin!=null&&this.zmax!=null}get height(){return Math.abs(this.ymax-this.ymin)}get width(){return Math.abs(this.xmax-this.xmin)}centerAt(e){const t=this.center;return e.z!=null&&this.hasZ?this.offset(e.x-t.x,e.y-t.y,e.z-t.z):this.offset(e.x-t.x,e.y-t.y)}clone(){const e=new Ju;return e.xmin=this.xmin,e.ymin=this.ymin,e.xmax=this.xmax,e.ymax=this.ymax,e.spatialReference=this.spatialReference,this.zmin!=null&&(e.zmin=this.zmin,e.zmax=this.zmax),this.mmin!=null&&(e.mmin=this.mmin,e.mmax=this.mmax),e}contains(e){if(!e)return!1;const t=this.spatialReference,r=e.spatialReference;return t&&r&&!t.equals(r)&&Ov(t,r)&&(e=t.isWebMercator?ly(e):aE(e,!0)),e.type==="point"?Qte(this,e):e.type==="extent"&&Jke(this,e)}equals(e){if(this===e)return!0;if(R(e))return!1;const t=this.spatialReference,r=e.spatialReference;return t&&r&&!t.equals(r)&&Ov(t,r)&&(e=t.isWebMercator?ly(e):aE(e,!0)),this.xmin===e.xmin&&this.ymin===e.ymin&&this.zmin===e.zmin&&this.mmin===e.mmin&&this.xmax===e.xmax&&this.ymax===e.ymax&&this.zmax===e.zmax&&this.mmax===e.mmax}expand(e){const t=.5*(1-e),r=this.width*t,i=this.height*t;if(this.xmin+=r,this.ymin+=i,this.xmax-=r,this.ymax-=i,this.hasZ){const n=(this.zmax-this.zmin)*t;this.zmin+=n,this.zmax-=n}if(this.hasM){const n=(this.mmax-this.mmin)*t;this.mmin+=n,this.mmax-=n}return this}intersects(e){if(R(e))return!1;e.type==="mesh"&&(e=e.extent);const t=this.spatialReference,r=e.spatialReference;return t&&r&&!t.equals(r)&&Ov(t,r)&&(e=t.isWebMercator?ly(e):aE(e,!0)),uVe(e.type)(this,e)}normalize(){const e=this._normalize(!1,!0);return Array.isArray(e)?e:[e]}offset(e,t,r){return this.xmin+=e,this.ymin+=t,this.xmax+=e,this.ymax+=t,r!=null&&(this.zmin+=r,this.zmax+=r),this}shiftCentralMeridian(){return this._normalize(!0)}union(e){return this===e||(this.xmin=Math.min(this.xmin,e.xmin),this.ymin=Math.min(this.ymin,e.ymin),this.xmax=Math.max(this.xmax,e.xmax),this.ymax=Math.max(this.ymax,e.ymax),(this.hasZ||e.hasZ)&&(this.zmin=ob(Math.min,this.zmin,e.zmin),this.zmax=ob(Math.max,this.zmax,e.zmax)),(this.hasM||e.hasM)&&(this.mmin=ob(Math.min,this.mmin,e.mmin),this.mmax=ob(Math.max,this.mmax,e.mmax))),this}intersection(e){return this===e?this:R(e)||!this.intersects(e)?null:(this.xmin=Math.max(this.xmin,e.xmin),this.ymin=Math.max(this.ymin,e.ymin),this.xmax=Math.min(this.xmax,e.xmax),this.ymax=Math.min(this.ymax,e.ymax),(this.hasZ||e.hasZ)&&(this.zmin=ob(Math.max,this.zmin,e.zmin),this.zmax=ob(Math.min,this.zmax,e.zmax)),(this.hasM||e.hasM)&&(this.mmin=ob(Math.max,this.mmin,e.mmin),this.mmax=ob(Math.min,this.mmax,e.mmax)),this)}toJSON(e){return this.write({},e)}_shiftCM(e=oy(this.spatialReference)){if(!e||!this.spatialReference)return this;const t=this.spatialReference,r=this._getCM(e);if(r){const i=t.isWebMercator?aE(r):r;this.xmin-=r.x,this.xmax-=r.x,t.isWebMercator||(i.x=this._normalizeX(i.x,e).x),this.spatialReference=new Ye(lm(t.isWGS84?e.altTemplate:e.wkTemplate,{Central_Meridian:i.x}))}return this}_getCM(e){let t=null;const[r,i]=e.valid,n=this.xmin,s=this.xmax;return n>=r&&n<=i&&s>=r&&s<=i||(t=this.center),t}_normalize(e,t,r){const i=this.spatialReference;if(!i)return this;if(!(r=r||oy(i)))return this;const n=this._getParts(r).map(o=>o.extent);if(n.length<2)return n[0]||this;if(n.length>2)return e?this._shiftCM(r):this.set({xmin:r.valid[0],xmax:r.valid[1]});if(e)return this._shiftCM(r);if(t)return n;let s=!0,a=!0;return n.forEach(o=>{o.hasZ||(s=!1),o.hasM||(a=!1)}),{rings:n.map(o=>{const l=[[o.xmin,o.ymin],[o.xmin,o.ymax],[o.xmax,o.ymax],[o.xmax,o.ymin],[o.xmin,o.ymin]];if(s){const c=(o.zmax-o.zmin)/2;for(let u=0;u<l.length;u++)l[u].push(c)}if(a){const c=(o.mmax-o.mmin)/2;for(let u=0;u<l.length;u++)l[u].push(c)}return l}),hasZ:s,hasM:a,spatialReference:i}}_getParts(e){let t=this.cache._parts;if(!t){t=[];const{ymin:n,ymax:s,spatialReference:a}=this,o=this.width,l=this.xmin,c=this.xmax;let u;e=e||oy(a);const[h,p]=e.valid;u=this._normalizeX(this.xmin,e);const m=u.x,g=u.frameId;u=this._normalizeX(this.xmax,e);const b=u.x,w=u.frameId,v=m===b&&o>0;if(o>2*p){const x=new Ju(l<c?m:b,n,p,s,a),T=new Ju(h,n,l<c?b:m,s,a),E=new Ju(0,n,p,s,a),C=new Ju(h,n,0,s,a),A=[],P=[];x.contains(E)&&A.push(g),x.contains(C)&&P.push(g),T.contains(E)&&A.push(w),T.contains(C)&&P.push(w);for(let I=g+1;I<w;I++)A.push(I),P.push(I);t.push({extent:x,frameIds:[g]},{extent:T,frameIds:[w]},{extent:E,frameIds:A},{extent:C,frameIds:P})}else m>b||v?t.push({extent:new Ju(m,n,p,s,a),frameIds:[g]},{extent:new Ju(h,n,b,s,a),frameIds:[w]}):t.push({extent:new Ju(m,n,b,s,a),frameIds:[g]});this.cache._parts=t}const r=this.hasZ,i=this.hasM;if(r||i){const n={};r&&(n.zmin=this.zmin,n.zmax=this.zmax),i&&(n.mmin=this.mmin,n.mmax=this.mmax);for(let s=0;s<t.length;s++)t[s].extent.set(n)}return t}_normalizeX(e,t){const[r,i]=t.valid,n=2*i;let s,a=0;return e>i?(s=Math.ceil(Math.abs(e-i)/n),e-=s*n,a=s):e<r&&(s=Math.ceil(Math.abs(e-r)/n),e+=s*n,a=-s),{x:e,frameId:a}}};d([f({readOnly:!0})],fa.prototype,"cache",null),d([f({readOnly:!0})],fa.prototype,"center",null),d([f({readOnly:!0})],fa.prototype,"extent",null),d([f({readOnly:!0,json:{write:{enabled:!1,overridePolicy:null}}})],fa.prototype,"hasM",null),d([f({readOnly:!0,json:{write:{enabled:!1,overridePolicy:null}}})],fa.prototype,"hasZ",null),d([f({readOnly:!0})],fa.prototype,"height",null),d([f({readOnly:!0})],fa.prototype,"width",null),d([f({type:Number,json:{type:[Number,String],write:{enabled:!0,allowNull:!0}}})],fa.prototype,"xmin",void 0),d([f({type:Number,json:{write:!0}})],fa.prototype,"ymin",void 0),d([f({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasM}}}}})],fa.prototype,"mmin",void 0),d([f({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasZ}}}}})],fa.prototype,"zmin",void 0),d([f({type:Number,json:{write:!0}})],fa.prototype,"xmax",void 0),d([f({type:Number,json:{write:!0}})],fa.prototype,"ymax",void 0),d([f({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasM}}}}})],fa.prototype,"mmax",void 0),d([f({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasZ}}}}})],fa.prototype,"zmax",void 0),fa=Ju=d([$("esri.geometry.Extent")],fa),fa.prototype.toJSON.isDefaultToJSON=!0;const Zt=fa;let UC;var eve,tve,rve;const QB=(rve=(eve=globalThis.esriConfig)==null?void 0:eve.locale)!=null?rve:(tve=globalThis.dojoConfig)==null?void 0:tve.locale;function ewe(){var e,t;return(t=QB!=null?QB:(e=globalThis.navigator)==null?void 0:e.language)!=null?t:"en"}function mu(){return UC===void 0&&(UC=ewe()),UC}const BC=[];function twe(e){return BC.push(e),{remove(){BC.splice(BC.indexOf(e),1)}}}const bX=[];function Jte(e){return bX.push(e),{remove(){BC.splice(bX.indexOf(e),1)}}}function fVe(){const e=ewe();UC!==e&&(UC=e,[...bX].forEach(t=>{t.call(null,e)}),[...BC].forEach(t=>{t.call(null,e)}))}var ive;(ive=globalThis.addEventListener)==null||ive.call(globalThis,"languagechange",fVe);class tr{constructor(t,r={ignoreUnknown:!1,useNumericKeys:!1}){this.jsonToAPI=t,this.options=r,this.apiValues=[],this.jsonValues=[],this.apiToJSON=this._invertMap(t),this.apiValues=this._getKeysSorted(this.apiToJSON),this.jsonValues=this._getKeysSorted(this.jsonToAPI),this.read=i=>this.fromJSON(i),this.write=(i,n,s)=>{const a=this.toJSON(i);a!==void 0&&ud(s,a,n)},this.write.isJSONMapWriter=!0}toJSON(t){if(this.apiToJSON.hasOwnProperty(t)){const r=this.apiToJSON[t];return this.options.useNumericKeys?+r:r}return this.options.ignoreUnknown?void 0:t}fromJSON(t){return this.jsonToAPI.hasOwnProperty(t)?this.jsonToAPI[t]:this.options.ignoreUnknown?void 0:t}_invertMap(t){const r={};for(const i in t)r[t[i]]=i;return r}_getKeysSorted(t){const r=[];for(const i in t)r.push(i);return r.sort(),r}}function uo(){return function(e,t){return new tr(e,{ignoreUnknown:!0,...t})}}var vX;const pVe=new tr({avgRating:"avg-rating",numRatings:"num-ratings",numComments:"num-comments",numViews:"num-views"});let Ku=vX=class extends xe{constructor(e){super(e),this.categories=null,this.disableExtraQuery=!1,this.extent=null,this.filter=null,this.num=10,this.query=null,this.sortField=null,this.start=1}get sortOrder(){return this._get("sortOrder")||"asc"}set sortOrder(e){e!=="asc"&&e!=="desc"||this._set("sortOrder",e)}clone(){return new vX({categories:this.categories?te(this.categories):null,disableExtraQuery:this.disableExtraQuery,extent:this.extent?this.extent.clone():null,filter:this.filter,num:this.num,query:this.query,sortField:this.sortField,sortOrder:this.sortOrder,start:this.start})}toRequestOptions(e,t){let r,i;if(this.categories&&(r=this.categories.map(a=>Array.isArray(a)?JSON.stringify(a):a)),this.extent){const a=mx(this.extent,Ye.WGS84);_(a)&&(i=`${a.xmin},${a.ymin},${a.xmax},${a.ymax}`)}let n=this.query;!this.disableExtraQuery&&e.extraQuery&&(n="("+n+")"+e.extraQuery);const s={categories:r,bbox:i,q:n,filter:this.filter,num:this.num,sortField:null,sortOrder:null,start:this.start};return this.sortField&&(s.sortField=this.sortField.split(",").map(a=>pVe.toJSON(a.trim())).join(","),s.sortOrder=this.sortOrder),{query:{...t,...s}}}};d([f()],Ku.prototype,"categories",void 0),d([f()],Ku.prototype,"disableExtraQuery",void 0),d([f({type:Zt})],Ku.prototype,"extent",void 0),d([f()],Ku.prototype,"filter",void 0),d([f()],Ku.prototype,"num",void 0),d([f()],Ku.prototype,"query",void 0),d([f()],Ku.prototype,"sortField",void 0),d([f()],Ku.prototype,"sortOrder",null),d([f()],Ku.prototype,"start",void 0),Ku=vX=d([$("esri.portal.PortalQueryParams")],Ku);const jg=Ku;let g2=class extends xe{constructor(e){super(e),this.nextQueryParams=null,this.queryParams=null,this.results=null,this.total=null}};d([f()],g2.prototype,"nextQueryParams",void 0),d([f()],g2.prototype,"queryParams",void 0),d([f()],g2.prototype,"results",void 0),d([f()],g2.prototype,"total",void 0),g2=d([$("esri.portal.PortalQueryResult")],g2);const mVe=g2;let tg=class extends ge{constructor(e){super(e),this.created=null,this.id=null,this.portal=null,this.title=null,this.username=null}get url(){const e=this.get("portal.restUrl");return e?`${e}/content/users/${this.username}/${this.id}`:null}toJSON(){throw new k("internal:not-yet-implemented","PortalFolder.toJSON is not yet implemented")}};d([f({type:Date})],tg.prototype,"created",void 0),d([f()],tg.prototype,"id",void 0),d([f()],tg.prototype,"portal",void 0),d([f()],tg.prototype,"title",void 0),d([f({readOnly:!0})],tg.prototype,"url",null),d([f()],tg.prototype,"username",void 0),tg=d([$("esri.portal.PortalFolder")],tg);const gVe=tg;let pa=class extends ge{constructor(e){super(e),this.access=null,this.created=null,this.description=null,this.id=null,this.isInvitationOnly=!1,this.modified=null,this.owner=null,this.portal=null,this.snippet=null,this.sortField=null,this.sortOrder=null,this.tags=null,this.title=null}get thumbnailUrl(){const e=this.url,t=this.thumbnail;return e&&t?this.portal._normalizeUrl(`${e}/info/${t}?f=json`):null}get url(){const e=this.get("portal.restUrl");return e?e+"/community/groups/"+this.id:null}fetchCategorySchema(e){return this.portal._request(this.url+"/categorySchema",e).then(t=>{const r=t.categorySchema||[];return r.some(i=>i.source==="contentCategorySetsGroupQuery.LivingAtlas")?this._fetchCategorySchemaSet("LivingAtlas",e):r})}fetchMembers(e){return this.portal._request(this.url+"/users",e)}getThumbnailUrl(e){let t=this.thumbnailUrl;return t&&e&&(t+=`&w=${e}`),t}toJSON(){throw new k("internal:not-yet-implemented","PortalGroup.toJSON is not yet implemented")}queryItems(e,t){let r=rs(jg,e);return parseFloat(this.portal.currentVersion)>5?(r=r||new jg,this.portal._queryPortal(`/content/groups/${this.id}/search`,r,"PortalItem",t)):(r=r?r.clone():new jg,r.query="group:"+this.id+(r.query?" "+r.query:""),this.portal.queryItems(r,t))}_fetchCategorySchemaSet(e,t){return this.portal._fetchSelf(this.portal.authMode,!0,t).then(r=>{const i=r.contentCategorySetsGroupQuery;if(i){const n=new jg;return n.disableExtraQuery=!0,n.num=1,n.query=i,this.portal.queryGroups(n,t)}throw new k("portal-group:fetchCategorySchema","contentCategorySetsGroupQuery value not found")}).then(r=>{if(r.total){const i=r.results[0],n=new jg;return n.num=1,n.query=`typekeywords:"${e}"`,i.queryItems(n,t)}throw new k("portal-group:fetchCategorySchema","contentCategorySetsGroupQuery group not found")}).then(r=>r.total?r.results[0].fetchData("json",t).then(i=>{const n=i&&i.categorySchema;return n&&n.length?n:[]}):[])}};d([f()],pa.prototype,"access",void 0),d([f({type:Date})],pa.prototype,"created",void 0),d([f()],pa.prototype,"description",void 0),d([f()],pa.prototype,"id",void 0),d([f()],pa.prototype,"isInvitationOnly",void 0),d([f({type:Date})],pa.prototype,"modified",void 0),d([f()],pa.prototype,"owner",void 0),d([f()],pa.prototype,"portal",void 0),d([f()],pa.prototype,"snippet",void 0),d([f()],pa.prototype,"sortField",void 0),d([f()],pa.prototype,"sortOrder",void 0),d([f()],pa.prototype,"tags",void 0),d([f()],pa.prototype,"thumbnail",void 0),d([f({readOnly:!0})],pa.prototype,"thumbnailUrl",null),d([f()],pa.prototype,"title",void 0),d([f({readOnly:!0})],pa.prototype,"url",null),pa=d([$("esri.portal.PortalGroup")],pa);const _X=pa,yVe=Object.freeze(Object.defineProperty({__proto__:null,default:_X},Symbol.toStringTag,{value:"Module"}));var wX;let an=wX=class extends ge{constructor(...e){super(...e),this.access=null,this.created=null,this.culture=null,this.description=null,this.email=null,this.fullName=null,this.modified=null,this.orgId=null,this.portal=null,this.preferredView=null,this.privileges=null,this.region=null,this.role=null,this.roleId=null,this.sourceJSON=null,this.units=null,this.username=null,this.userType=null}get thumbnailUrl(){const e=this.url,t=this.thumbnail;return e&&t?this.portal._normalizeUrl(`${e}/info/${t}?f=json`):null}get userContentUrl(){const e=this.get("portal.restUrl");return e?`${e}/content/users/${this.username}`:null}get url(){const e=this.get("portal.restUrl");return e?`${e}/community/users/${this.username}`:null}addItem(e){const t=e&&e.item,r=e&&e.data,i=e&&e.folder,n={method:"post"};t&&(n.query=t.createPostQuery(),r!=null&&(typeof r=="string"?n.query.text=r:typeof r=="object"&&(n.query.text=JSON.stringify(r))));let s=this.userContentUrl;return i&&(s+="/"+(typeof i=="string"?i:i.id)),this.portal._request(s+"/addItem",n).then(a=>(t.id=a.id,t.portal=this.portal,t.loaded?t.reload():t.load()))}deleteItem(e){let t=this.userContentUrl;return e.ownerFolder&&(t+="/"+e.ownerFolder),this.portal._request(t+`/items/${e.id}/delete`,{method:"post"}).then(()=>{e.id=null,e.portal=null})}deleteItems(e){const t=this.userContentUrl+"/deleteItems",r=e.map(i=>i.id);if(r.length){const i={method:"post",query:{items:r.join(",")}};return this.portal._request(t,i).then(()=>{e.forEach(n=>{n.id=null,n.portal=null})})}return Promise.resolve(void 0)}fetchFolders(){const e={query:{num:1}};return this.portal._request(this.userContentUrl,e).then(t=>{let r;return r=t&&t.folders?t.folders.map(i=>{const n=gVe.fromJSON(i);return n.portal=this.portal,n}):[],r})}fetchGroups(){return this.portal._request(this.url).then(e=>{let t;return t=e&&e.groups?e.groups.map(r=>{const i=_X.fromJSON(r);return i.portal=this.portal,i}):[],t})}fetchItems(e){e||(e={});let t,r=this.userContentUrl;return e.folder&&(r+="/"+e.folder.id),ie(()=>Promise.resolve().then(()=>rwe),void 0,import.meta.url).then(({default:i})=>{t=i;const n={folders:!1,num:e.num||10,start:e.start||1,sortField:e.sortField||"created",sortOrder:e.sortOrder||"asc"};return this.portal._request(r,{query:n})}).then(i=>{let n;return i&&i.items?(n=i.items.map(s=>{const a=t.fromJSON(s);return a.portal=this.portal,a}),Promise.all(n.map(s=>s.load())).catch(s=>s).then(()=>({items:n,nextStart:i.nextStart,total:i.total}))):{items:[],nextStart:-1,total:0}})}fetchTags(){return this.portal._request(this.url+"/tags").then(e=>e.tags)}getThumbnailUrl(e){let t=this.thumbnailUrl;return t&&e&&(t+=`&w=${e}`),t}queryFavorites(e){return this.favGroupId?(this._favGroup||(this._favGroup=new _X({id:this.favGroupId,portal:this.portal})),this._favGroup.queryItems(e)):Promise.reject(new k("internal:unknown","Unknown internal error",{internalError:"Unknown favGroupId"}))}toJSON(){throw new k("internal:not-yet-implemented","PortalGroup.toJSON is not yet implemented")}static fromJSON(e){if(!e)return null;if(e.declaredClass)throw new Error("JSON object is already hydrated");const t=new wX;return t.sourceJSON=e,t.read(e),t}};d([f()],an.prototype,"access",void 0),d([f({type:Date})],an.prototype,"created",void 0),d([f()],an.prototype,"culture",void 0),d([f()],an.prototype,"description",void 0),d([f()],an.prototype,"email",void 0),d([f()],an.prototype,"favGroupId",void 0),d([f()],an.prototype,"fullName",void 0),d([f({type:Date})],an.prototype,"modified",void 0),d([f()],an.prototype,"orgId",void 0),d([f()],an.prototype,"portal",void 0),d([f()],an.prototype,"preferredView",void 0),d([f()],an.prototype,"privileges",void 0),d([f()],an.prototype,"region",void 0),d([f()],an.prototype,"role",void 0),d([f()],an.prototype,"roleId",void 0),d([f()],an.prototype,"sourceJSON",void 0),d([f()],an.prototype,"thumbnail",void 0),d([f({readOnly:!0})],an.prototype,"thumbnailUrl",null),d([f()],an.prototype,"units",void 0),d([f({readOnly:!0})],an.prototype,"userContentUrl",null),d([f({readOnly:!0})],an.prototype,"url",null),d([f()],an.prototype,"username",void 0),d([f()],an.prototype,"userType",void 0),an=wX=d([$("esri.portal.PortalUser")],an);const Kte=an,bVe=Object.freeze(Object.defineProperty({__proto__:null,default:Kte},Symbol.toStringTag,{value:"Module"}));var Id;let JB;const Ace={PortalGroup:()=>ie(()=>Promise.resolve().then(()=>yVe),void 0,import.meta.url),PortalItem:()=>ie(()=>Promise.resolve().then(()=>rwe),void 0,import.meta.url),PortalUser:()=>ie(()=>Promise.resolve().then(()=>bVe),void 0,import.meta.url)};let Ge=Id=class extends Z9(hd){constructor(e){super(e),this.access=null,this.allSSL=!1,this.authMode="auto",this.authorizedCrossOriginDomains=null,this.basemapGalleryGroupQuery=null,this.bingKey=null,this.canListApps=!1,this.canListData=!1,this.canListPreProvisionedItems=!1,this.canProvisionDirectPurchase=!1,this.canSearchPublic=!0,this.canShareBingPublic=!1,this.canSharePublic=!1,this.canSignInArcGIS=!1,this.canSignInIDP=!1,this.colorSetsGroupQuery=null,this.commentsEnabled=!1,this.created=null,this.culture=null,this.customBaseUrl=null,this.defaultBasemap=null,this.defaultDevBasemap=null,this.defaultExtent=null,this.defaultVectorBasemap=null,this.description=null,this.devBasemapGalleryGroupQuery=null,this.eueiEnabled=null,this.featuredGroups=null,this.featuredItemsGroupQuery=null,this.galleryTemplatesGroupQuery=null,this.livingAtlasGroupQuery=null,this.hasCategorySchema=!1,this.helperServices=null,this.homePageFeaturedContent=null,this.homePageFeaturedContentCount=null,this.httpPort=null,this.httpsPort=null,this.id=null,this.ipCntryCode=null,this.isPortal=!1,this.isReadOnly=!1,this.layerTemplatesGroupQuery=null,this.maxTokenExpirationMinutes=null,this.modified=null,this.name=null,this.portalHostname=null,this.portalMode=null,this.portalProperties=null,this.region=null,this.rotatorPanels=null,this.showHomePageDescription=!1,this.sourceJSON=null,this.supportsHostedServices=!1,this.symbolSetsGroupQuery=null,this.templatesGroupQuery=null,this.units=null,this.url=Vr.portalUrl,this.urlKey=null,this.user=null,this.useStandardizedQuery=!1,this.useVectorBasemaps=!1,this.vectorBasemapGalleryGroupQuery=null}normalizeCtorArgs(e){return typeof e=="string"?{url:e}:e}destroy(){this._esriId_credentialCreateHandle&&(this._esriId_credentialCreateHandle.remove(),this._esriId_credentialCreateHandle=null)}readAuthorizedCrossOriginDomains(e){if(e)for(const t of e)Vr.request.trustedServers.includes(t)||Vr.request.trustedServers.push(t);return e}readDefaultBasemap(e){return this._readBasemap(e)}readDefaultDevBasemap(e){return this._readBasemap(e)}readDefaultVectorBasemap(e){return this._readBasemap(e)}get extraQuery(){const e=!(this.user&&this.user.orgId)||this.canSearchPublic;return this.id&&!e?` AND orgid:${this.id}`:null}get isOrganization(){return!!this.access}get restUrl(){let e=this.url;if(e){const t=e.indexOf("/sharing");e=t>0?e.substring(0,t):this.url.replace(/\/+$/,""),e+="/sharing/rest"}return e}get thumbnailUrl(){const e=this.restUrl,t=this.thumbnail;return e&&t?this._normalizeSSL(e+"/portals/self/resources/"+t):null}readUrlKey(e){return e&&e.toLowerCase()}readUser(e){let t=null;return e&&(t=Kte.fromJSON(e),t.portal=this),t}load(e){const t=ie(()=>Promise.resolve().then(()=>NVe),void 0,import.meta.url).then(({default:r})=>{Et(e),JB=r}).then(()=>this.sourceJSON?this.sourceJSON:this._fetchSelf(this.authMode,!1,e)).then(r=>{if(Xi){const i=Xi;this.credential=i.findCredential(this.restUrl),this.credential||this.authMode!==Id.AUTH_MODE_AUTO||(this._esriId_credentialCreateHandle=i.on("credential-create",()=>{i.findCredential(this.restUrl)&&this._signIn()}))}this.sourceJSON=r,this.read(r)});return this.addResolvingPromise(t),Promise.resolve(this)}async createElevationLayers(){await this.load();const e=this._getHelperService("defaultElevationLayers"),t=(await ie(()=>import("./ElevationLayer.019057e8.js"),["ElevationLayer.019057e8.js","ArcGISCachedService.17d1a46d.js","TilemapCache.35b85054.js"],import.meta.url)).default;return e?e.map(r=>new t({id:r.id,url:r.url})):[]}fetchBasemaps(e,t){const r=new jg;return r.query=e||(Vr.apiKey&&H3e(this.url)?this.devBasemapGalleryGroupQuery:this.useVectorBasemaps?this.vectorBasemapGalleryGroupQuery:this.basemapGalleryGroupQuery),r.disableExtraQuery=!0,this.queryGroups(r,t).then(i=>{if(r.num=100,r.query='type:"Web Map" -type:"Web Application"',i.total){const n=i.results[0];return r.sortField=n.sortField||"name",r.sortOrder=n.sortOrder||"desc",n.queryItems(r,t)}return null}).then(i=>{let n;return n=i&&i.total?i.results.filter(s=>s.type==="Web Map").map(s=>new JB({portalItem:s})):[],n})}fetchCategorySchema(e){return this.hasCategorySchema?this._request(this.restUrl+"/portals/self/categorySchema",e).then(t=>t.categorySchema):bs(e)?Promise.reject(br()):Promise.resolve([])}fetchFeaturedGroups(e){const t=this.featuredGroups,r=new jg;if(r.num=100,r.sortField="title",t&&t.length){const i=[];for(const n of t)i.push(`(title:"${n.title}" AND owner:${n.owner})`);return r.query=i.join(" OR "),this.queryGroups(r,e).then(n=>n.results)}return bs(e)?Promise.reject(br()):Promise.resolve([])}fetchRegions(e){var r;const t=((r=this.user)==null?void 0:r.culture)||this.culture||mu();return this._request(this.restUrl+"/portals/regions",{...e,query:{culture:t}})}fetchSettings(e){var r;const t=((r=this.user)==null?void 0:r.culture)||this.culture||mu();return this._request(this.restUrl+"/portals/self/settings",{...e,query:{culture:t}})}static getDefault(){return Id._default&&!Id._default.destroyed||(Id._default=new Id),Id._default}queryGroups(e,t){return this._queryPortal("/community/groups",e,"PortalGroup",t)}queryItems(e,t){return this._queryPortal("/search",e,"PortalItem",t)}queryUsers(e,t){return e.sortField||(e.sortField="username"),this._queryPortal("/community/users",e,"PortalUser",t)}toJSON(){throw new k("internal:not-yet-implemented","Portal.toJSON is not yet implemented")}static fromJSON(e){if(!e)return null;if(e.declaredClass)throw new Error("JSON object is already hydrated");return new Id({sourceJSON:e})}_getHelperService(e){const t=this.helperServices&&this.helperServices[e];if(!t)throw new k("portal:service-not-found",`The \`helperServices\` do not include an entry named "${e}"`);return t}_getHelperServiceUrl(e){const t=this._getHelperService(e);if(!t.url)throw new k("portal:service-url-not-found",`The \`helperServices\` entry "${e}" does not include a \`url\` value`);return t.url}_fetchSelf(e=this.authMode,t=!1,r){const i=this.restUrl+"/portals/self",n={authMode:e,query:{culture:mu().toLowerCase()},...r};return n.authMode==="auto"&&(n.authMode="no-prompt"),t&&(n.query.default=!0),this._request(i,n)}_queryPortal(e,t,r,i){const n=rs(jg,t),s=a=>this._request(this.restUrl+e,{...n.toRequestOptions(this),...i}).then(o=>{const l=n.clone();return l.start=o.nextStart,new mVe({nextQueryParams:l,queryParams:n,total:o.total,results:Id._resultsToTypedArray(a,{portal:this},o,i)})}).then(o=>Promise.all(o.results.map(l=>typeof l.when=="function"?l.when():o)).then(()=>o,l=>(pu(l),o)));return r&&Ace[r]?Ace[r]().then(({default:a})=>(Et(i),s(a))):s()}_signIn(){if(this.authMode===Id.AUTH_MODE_ANONYMOUS)return Promise.reject(new k("portal:invalid-auth-mode",`Current "authMode"' is "${this.authMode}"`));if(this.loadStatus==="failed")return Promise.reject(this.loadError);const e=t=>Promise.resolve().then(()=>this.loadStatus==="not-loaded"?(t||(this.authMode="immediate"),this.load().then(()=>null)):this.loadStatus==="loading"?this.load().then(()=>this.credential?null:(this.credential=t,this._fetchSelf("immediate"))):this.user&&this.credential===t?null:(this.credential=t,this._fetchSelf("immediate"))).then(r=>{r&&(this.sourceJSON=r,this.read(r))});return Xi?Xi.getCredential(this.restUrl).then(t=>e(t)):e(this.credential)}_normalizeSSL(e){return e.replace(/^http:/i,"https:").replace(":7080",":7443")}_normalizeUrl(e){const t=this.credential&&this.credential.token;return this._normalizeSSL(t?e+(e.includes("?")?"&":"?")+"token="+t:e)}_requestToTypedArray(e,t,r){return this._request(e,t).then(i=>{const n=Id._resultsToTypedArray(r,{portal:this},i);return Promise.all(n.map(s=>typeof s.when=="function"?s.when():i)).then(()=>n,()=>n)})}_readBasemap(e){if(e){const t=JB.fromJSON(e);return t.portalItem={portal:this},t}return null}_request(e,t={}){const r={f:"json",...t.query},{authMode:i=this.authMode===Id.AUTH_MODE_ANONYMOUS?"anonymous":"auto",body:n=null,cacheBust:s=!1,method:a="auto",responseType:o="json",signal:l}=t,c={authMode:i,body:n,cacheBust:s,method:a,query:r,responseType:o,timeout:0,signal:l};return qt(this._normalizeSSL(e),c).then(u=>u.data)}static _resultsToTypedArray(e,t,r,i){let n;if(r){const s=_(i)?i.signal:null;n=r.listings||r.notifications||r.userInvitations||r.tags||r.items||r.groups||r.comments||r.provisions||r.results||r.relatedItems||r,(e||t)&&(n=n.map(a=>{const o=Object.assign(e?e.fromJSON(a):a,t);return typeof o.load=="function"&&o.load(s),o}))}else n=[];return n}};Ge.AUTH_MODE_ANONYMOUS="anonymous",Ge.AUTH_MODE_AUTO="auto",Ge.AUTH_MODE_IMMEDIATE="immediate",d([f()],Ge.prototype,"access",void 0),d([f()],Ge.prototype,"allSSL",void 0),d([f()],Ge.prototype,"authMode",void 0),d([f()],Ge.prototype,"authorizedCrossOriginDomains",void 0),d([$e("authorizedCrossOriginDomains")],Ge.prototype,"readAuthorizedCrossOriginDomains",null),d([f()],Ge.prototype,"basemapGalleryGroupQuery",void 0),d([f()],Ge.prototype,"bingKey",void 0),d([f()],Ge.prototype,"canListApps",void 0),d([f()],Ge.prototype,"canListData",void 0),d([f()],Ge.prototype,"canListPreProvisionedItems",void 0),d([f()],Ge.prototype,"canProvisionDirectPurchase",void 0),d([f()],Ge.prototype,"canSearchPublic",void 0),d([f()],Ge.prototype,"canShareBingPublic",void 0),d([f()],Ge.prototype,"canSharePublic",void 0),d([f()],Ge.prototype,"canSignInArcGIS",void 0),d([f()],Ge.prototype,"canSignInIDP",void 0),d([f()],Ge.prototype,"colorSetsGroupQuery",void 0),d([f()],Ge.prototype,"commentsEnabled",void 0),d([f({type:Date})],Ge.prototype,"created",void 0),d([f()],Ge.prototype,"credential",void 0),d([f()],Ge.prototype,"culture",void 0),d([f()],Ge.prototype,"currentVersion",void 0),d([f()],Ge.prototype,"customBaseUrl",void 0),d([f()],Ge.prototype,"defaultBasemap",void 0),d([$e("defaultBasemap")],Ge.prototype,"readDefaultBasemap",null),d([f()],Ge.prototype,"defaultDevBasemap",void 0),d([$e("defaultDevBasemap")],Ge.prototype,"readDefaultDevBasemap",null),d([f({type:Zt})],Ge.prototype,"defaultExtent",void 0),d([f()],Ge.prototype,"defaultVectorBasemap",void 0),d([$e("defaultVectorBasemap")],Ge.prototype,"readDefaultVectorBasemap",null),d([f()],Ge.prototype,"description",void 0),d([f()],Ge.prototype,"devBasemapGalleryGroupQuery",void 0),d([f()],Ge.prototype,"eueiEnabled",void 0),d([f({readOnly:!0})],Ge.prototype,"extraQuery",null),d([f()],Ge.prototype,"featuredGroups",void 0),d([f()],Ge.prototype,"featuredItemsGroupQuery",void 0),d([f()],Ge.prototype,"galleryTemplatesGroupQuery",void 0),d([f()],Ge.prototype,"livingAtlasGroupQuery",void 0),d([f()],Ge.prototype,"hasCategorySchema",void 0),d([f()],Ge.prototype,"helpBase",void 0),d([f()],Ge.prototype,"helperServices",void 0),d([f()],Ge.prototype,"helpMap",void 0),d([f()],Ge.prototype,"homePageFeaturedContent",void 0),d([f()],Ge.prototype,"homePageFeaturedContentCount",void 0),d([f()],Ge.prototype,"httpPort",void 0),d([f()],Ge.prototype,"httpsPort",void 0),d([f()],Ge.prototype,"id",void 0),d([f()],Ge.prototype,"ipCntryCode",void 0),d([f({readOnly:!0})],Ge.prototype,"isOrganization",null),d([f()],Ge.prototype,"isPortal",void 0),d([f()],Ge.prototype,"isReadOnly",void 0),d([f()],Ge.prototype,"layerTemplatesGroupQuery",void 0),d([f()],Ge.prototype,"maxTokenExpirationMinutes",void 0),d([f({type:Date})],Ge.prototype,"modified",void 0),d([f()],Ge.prototype,"name",void 0),d([f()],Ge.prototype,"portalHostname",void 0),d([f()],Ge.prototype,"portalMode",void 0),d([f()],Ge.prototype,"portalProperties",void 0),d([f()],Ge.prototype,"region",void 0),d([f({readOnly:!0})],Ge.prototype,"restUrl",null),d([f()],Ge.prototype,"rotatorPanels",void 0),d([f()],Ge.prototype,"showHomePageDescription",void 0),d([f()],Ge.prototype,"sourceJSON",void 0),d([f()],Ge.prototype,"staticImagesUrl",void 0),d([f({json:{name:"2DStylesGroupQuery"}})],Ge.prototype,"stylesGroupQuery2d",void 0),d([f({json:{name:"stylesGroupQuery"}})],Ge.prototype,"stylesGroupQuery3d",void 0),d([f()],Ge.prototype,"supportsHostedServices",void 0),d([f()],Ge.prototype,"symbolSetsGroupQuery",void 0),d([f()],Ge.prototype,"templatesGroupQuery",void 0),d([f()],Ge.prototype,"thumbnail",void 0),d([f({readOnly:!0})],Ge.prototype,"thumbnailUrl",null),d([f()],Ge.prototype,"units",void 0),d([f()],Ge.prototype,"url",void 0),d([f()],Ge.prototype,"urlKey",void 0),d([$e("urlKey")],Ge.prototype,"readUrlKey",null),d([f()],Ge.prototype,"user",void 0),d([$e("user")],Ge.prototype,"readUser",null),d([f()],Ge.prototype,"useStandardizedQuery",void 0),d([f()],Ge.prototype,"useVectorBasemaps",void 0),d([f()],Ge.prototype,"vectorBasemapGalleryGroupQuery",void 0),Ge=Id=d([$("esri.portal.Portal")],Ge);const Cs=Ge,vVe=fe.getLogger("esri.assets");function _Ve(e,t){return qt(xr(e),t)}function xr(e){if(!Vr.assetsPath)throw vVe.errorOnce("The API assets location needs to be set using config.assetsPath. More information: https://arcg.is/1OzLe50"),new k("assets:path-not-set","config.assetsPath is not set");return vl(Vr.assetsPath,e)}const wVe=fe.getLogger("esri.portal.PortalItemResource");let jb=class extends xe{constructor(e){super(e),this.portalItem=null}normalizeCtorArgs(e){return e&&e.portalItem&&e.path?{...e,path:this._normalizePath(e.path,e.portalItem)}:e}set path(e){_(e)&&cd(e)?wVe.error("portalitemresource:invalid-path","A portal item resource path must be relative"):this._set("path",e)}_castPath(e){return this._normalizePath(e,this.portalItem)}get url(){return this.portalItem&&this.path?`${this.portalItem.itemUrl}/resources/${this.path}`:null}get itemRelativeUrl(){return this.portalItem&&this.path?`./resources/${this.path}`:null}fetch(e="json",t){const r=this.url;if(R(r))throw new k("portal-item-resource:fetch","Portal item resource does not refer to a valid item or path");return this.portalItem.portal._request(r,{responseType:e,query:{token:this.portalItem.apiKey},signal:Vi(t,"signal")})}async update(e,t){return(await ie(()=>Promise.resolve().then(()=>vC),void 0,import.meta.url)).addOrUpdateResource(this,"update",e,t)}hasPath(){return _(this.path)}_normalizePath(e,t){return R(e)?e:(e=e.replace(/^\/+/,""),_(t)&&cd(e)&&(e=Ute(e,t.itemUrl)),e.replace(/^\/+/,"").replace(/^(\.\/)?resources\//,""))}};d([f()],jb.prototype,"portalItem",void 0),d([f({type:String,value:null})],jb.prototype,"path",null),d([Xt("path")],jb.prototype,"_castPath",null),d([f({type:String,readOnly:!0})],jb.prototype,"url",null),d([f({type:String,readOnly:!0})],jb.prototype,"itemRelativeUrl",null),jb=d([$("esri.portal.PortalItemResource")],jb);const xVe=jb;let oE=class extends xe{constructor(e){super(e),this.created=null,this.rating=null}};d([f()],oE.prototype,"created",void 0),d([f()],oE.prototype,"rating",void 0),oE=d([$("esri.portal.PortalRating")],oE);const KB=oE;var QT;let fr=QT=class extends Z9(hd){constructor(e){super(e),this.access=null,this.accessInformation=null,this.apiKey=null,this.applicationProxies=null,this.avgRating=null,this.categories=null,this.created=null,this.culture=null,this.description=null,this.extent=null,this.groupCategories=null,this.id=null,this.itemControl=null,this.licenseInfo=null,this.modified=null,this.name=null,this.numComments=null,this.numRatings=null,this.numViews=null,this.owner=null,this.ownerFolder=null,this.portal=null,this.screenshots=null,this.size=null,this.snippet=null,this.sourceJSON=null,this.spatialReference=null,this.tags=null,this.title=null,this.type=null,this.typeKeywords=null,this.url=null}static from(e){return M5(QT,e)}destroy(){this.portal=null}get displayName(){const e=this.type,t=this.typeKeywords||[];let r=e;return e==="Feature Service"||e==="Feature Collection"?r=t.includes("Table")?"Table":t.includes("Route Layer")?"Route Layer":t.includes("Markup")?"Markup":"Feature Layer":e==="Image Service"?r=t.includes("Elevation 3D Layer")?"Elevation Layer":t.includes("Tiled Imagery")?"Tiled Imagery Layer":"Imagery Layer":e==="Scene Service"?r="Scene Layer":e==="Video Service"?r="Video Layer":e==="Scene Package"?r="Scene Layer Package":e==="Stream Service"?r="Feature Layer":e==="Geoprocessing Service"&&this.portal&&this.portal.isPortal?r=t.includes("Web Tool")?"Tool":"Geoprocessing Service":e==="Geocoding Service"?r="Locator":e==="Geoenrichment Service"?r="GeoEnrichment Service":e==="Microsoft Powerpoint"?r="Microsoft PowerPoint":e==="GeoJson"?r="GeoJSON":e==="Globe Service"?r="Globe Layer":e==="Vector Tile Service"?r="Tile Layer":e==="netCDF"?r="NetCDF":e==="Map Service"?r=t.includes("Spatiotemporal")||!t.includes("Hosted Service")&&!t.includes("Tiled")||t.includes("Relational")?"Map Image Layer":"Tile Layer":e&&e.toLowerCase().includes("add in")?r=e.replace(/(add in)/gi,"Add-In"):e==="datastore catalog service"?r="Big Data File Share":e==="Compact Tile Package"?r="Tile Package (tpkx)":e==="OGCFeatureServer"?r="OGC Feature Layer":e==="web mapping application"&&t.includes("configurableApp")&&(r="Instant App"),r}readExtent(e){return e&&e.length?new Zt(e[0][0],e[0][1],e[1][0],e[1][1]):null}get iconUrl(){const e=this.type&&this.type.toLowerCase()||"",t=this.typeKeywords||[],r="esri/images/portal/",i="16";let n,s=!1,a=!1,o=!1,l=!1,c=!1,u=!1;return e.indexOf("service")>0||e==="feature collection"||e==="kml"||e==="wms"||e==="wmts"||e==="wfs"?(s=t.includes("Hosted Service"),e==="feature service"||e==="feature collection"||e==="kml"||e==="wfs"?(a=t.includes("Table"),o=t.includes("Route Layer"),l=t.includes("Markup"),c=t.includes("Spatiotemporal"),u=t.includes("UtilityNetwork"),n=c&&a?"spatiotemporaltable":a?"table":o?"routelayer":l?"markup":c?"spatiotemporal":s?"featureshosted":u?"utilitynetwork":"features"):n=e==="map service"||e==="wms"||e==="wmts"?s||t.includes("Tiled")||e==="wmts"?"maptiles":"mapimages":e==="scene service"?t.includes("Line")?"sceneweblayerline":t.includes("3DObject")?"sceneweblayermultipatch":t.includes("Point")?"sceneweblayerpoint":t.includes("IntegratedMesh")?"sceneweblayermesh":t.includes("PointCloud")?"sceneweblayerpointcloud":t.includes("Polygon")?"sceneweblayerpolygon":t.includes("Building")?"sceneweblayerbuilding":t.includes("Voxel")?"sceneweblayervoxel":"sceneweblayer":e==="image service"?t.includes("Elevation 3D Layer")?"elevationlayer":t.includes("Tiled Imagery")?"tiledimagerylayer":"imagery":e==="stream service"?"streamlayer":e==="video service"?"mediaservice":e==="vector tile service"?"vectortile":e==="datastore catalog service"?"datastorecollection":e==="geocoding service"?"geocodeservice":e==="geoprocessing service"?t.includes("Web Tool")&&this.portal&&this.portal.isPortal?"tool":"layers":e==="geodata service"?"geodataservice":"layers"):n=e==="web map"||e==="cityengine web scene"?"maps":e==="web scene"?t.includes("ViewingMode-Local")?"webscenelocal":"websceneglobal":e==="web mapping application"&&t.includes("configurableApp")?"instantapps":e==="web mapping application"||e==="mobile application"||e==="application"||e==="operation view"||e==="desktop application"?"apps":e==="map document"||e==="map package"||e==="published map"||e==="scene document"||e==="globe document"||e==="basemap package"||e==="mobile basemap package"||e==="mobile map package"||e==="project package"||e==="project template"||e==="pro map"||e==="layout"||e==="layer"&&t.includes("ArcGIS Pro")||e==="explorer map"&&t.indexOf("Explorer Document")?"mapsgray":e==="service definition"||e==="csv"||e==="shapefile"||e==="cad drawing"||e==="geojson"||e==="360 vr experience"||e==="netcdf"||e==="administrative report"?"datafiles":e==="explorer add in"||e==="desktop add in"||e==="windows viewer add in"||e==="windows viewer configuration"?"appsgray":e==="arcgis pro add in"||e==="arcgis pro configuration"?"addindesktop":e==="rule package"||e==="file geodatabase"||e==="sqlite geodatabase"||e==="csv collection"||e==="kml collection"||e==="windows mobile package"||e==="map template"||e==="desktop application template"||e==="gml"||e==="arcpad package"||e==="code sample"||e==="form"||e==="document link"||e==="earth configuration"||e==="operations dashboard add in"||e==="rules package"||e==="image"||e==="workflow manager package"||e==="explorer map"&&t.includes("Explorer Mapping Application")||t.includes("Document")?"datafilesgray":e==="network analysis service"||e==="geoprocessing service"||e==="geodata service"||e==="geometry service"||e==="geoprocessing package"||e==="locator package"||e==="geoprocessing sample"||e==="workflow manager service"?"toolsgray":e==="layer"||e==="layer package"||e==="explorer layer"?"layersgray":e==="scene package"?"scenepackage":e==="mobile scene package"?"mobilescenepackage":e==="tile package"||e==="compact tile package"?"tilepackage":e==="task file"?"taskfile":e==="report template"?"report-template":e==="statistical data collection"?"statisticaldatacollection":e==="insights workbook"?"workbook":e==="insights model"?"insightsmodel":e==="insights page"?"insightspage":e==="insights theme"?"insightstheme":e==="hub initiative"?"hubinitiative":e==="hubpage"?"hubpage":e==="hub event"?"hubevent":e==="hub site application"?"hubsite":e==="hub project"?"hubproject":e==="relational database connection"?"relationaldatabaseconnection":e==="big data file share"?"datastorecollection":e==="image collection"?"imagecollection":e==="style"?"style":e==="desktop style"?"desktopstyle":e==="dashboard"?"dashboard":e==="raster function template"?"rasterprocessingtemplate":e==="vector tile package"?"vectortilepackage":e==="ortho mapping project"?"orthomappingproject":e==="ortho mapping template"?"orthomappingtemplate":e==="solution"?"solutions":e==="geopackage"?"geopackage":e==="deep learning package"?"deeplearningpackage":e==="real time analytic"?"realtimeanalytics":e==="big data analytic"?"bigdataanalytics":e==="feed"?"feed":e==="excalibur imagery project"?"excaliburimageryproject":e==="notebook"?"notebook":e==="storymap"?"storymap":e==="survey123 add in"?"survey123addin":e==="mission"?"mission":e==="mission report"?"missionreport":e==="quickcapture project"?"quickcaptureproject":e==="pro report"?"proreport":e==="urban model"?"urbanmodel":e==="web experience"?"experiencebuilder":e==="web experience template"?"webexperiencetemplate":e==="experience builder widget"?"experiencebuilderwidget":e==="experience builder widget package"?"experiencebuilderwidgetpackage":e==="workflow"?"workflow":e==="insights script"?"insightsscript":e==="kernel gateway connection"?"kernelgatewayconnection":e==="hub initiative template"?"hubinitiativetemplate":e==="storymap theme"?"storymaptheme":e==="knowledge graph"?"knowledgegraph":e==="native application"?"nativeapp":e==="native application installer"?"nativeappinstaller":e==="link chart"?"linkchart":e==="investigation"?"investigation":e==="ogcfeatureserver"?"features":e==="pro project"?"proproject":e==="insights workbook package"?"insightsworkbookpackage":e==="apache parquet"?"apacheparquet":e==="notebook code snippets"?"notebookcodesnippets":e==="suitability model"?"suitabilitymodel":e==="esri classifier definition"?"classifierdefinition":e==="esri classification schema"?"classificationschema":e==="insights data engineering workbook"?"dataengineeringworkbook":e==="insights data engineering model"?"dataengineeringmodel":e==="deep learning studio project"?"deeplearningproject":"maps",n?xr(r+n+i+".png"):null}get isLayer(){return["Map Service","Feature Service","Feature Collection","Scene Service","Image Service","Stream Service","Vector Tile Service","WMTS","WMS"].includes(this.type)}get itemUrl(){const e=this.get("portal.restUrl");return e&&this.id?`${e}/content/items/${this.id}`:null}get thumbnailUrl(){const e=this.itemUrl,t=this.thumbnail;return e&&t?this.portal._normalizeUrl(`${e}/info/${t}?f=json`):null}get userItemUrl(){const e=this.get("portal.restUrl");if(!e)return null;const t=this.owner||this.get("portal.user.username");return t?`${e}/content/users/${this.ownerFolder?`${t}/${this.ownerFolder}`:t}/items/${this.id}`:null}load(e){this.portal||(this.portal=Cs.getDefault());const t=this.portal.load(e).then(()=>this.sourceJSON?this.sourceJSON:this.id&&this.itemUrl?this.portal._request(this.itemUrl,{signal:_(e)?e.signal:null,query:{token:this.apiKey}}):{}).then(r=>{this.sourceJSON=r,this.read(r)});return this.addResolvingPromise(t),Promise.resolve(this)}addRating(e){const t={method:"post",query:{}};return e instanceof KB&&(e=e.rating),isNaN(e)||typeof e!="number"||(t.query.rating=e),this.portal._request(this.itemUrl+"/addRating",t).then(()=>new KB({rating:e,created:new Date}))}clone(){const e={access:this.access,accessInformation:this.accessInformation,applicationProxies:te(this.applicationProxies),avgRating:this.avgRating,categories:te(this.categories),created:te(this.created),culture:this.culture,description:this.description,extent:te(this.extent),groupCategories:te(this.groupCategories),id:this.id,itemControl:this.itemControl,licenseInfo:this.licenseInfo,modified:te(this.modified),name:this.name,numComments:this.numComments,numRatings:this.numRatings,numViews:this.numViews,owner:this.owner,ownerFolder:this.ownerFolder,portal:this.portal,screenshots:te(this.screenshots),size:this.size,snippet:this.snippet,spatialReference:this.spatialReference,tags:te(this.tags),thumbnail:this.thumbnail,title:this.title,type:this.type,typeKeywords:te(this.typeKeywords),url:this.url};return this.loaded&&(e.loadStatus="loaded"),new QT({sourceJSON:this.sourceJSON}).set(e)}createPostQuery(){const e=this.toJSON();for(const r of["tags","typeKeywords","categories"])e[r]&&(e[r]=e[r].join(", "));const{extent:t}=e;return t&&(e.extent=JSON.stringify(t)),e}deleteRating(){return this.portal._request(this.itemUrl+"/deleteRating",{method:"post"}).then(()=>{})}fetchData(e="json",t){return this.portal._request(this.itemUrl+"/data",{responseType:e,...t,query:{token:this.apiKey}})}fetchRating(e){return this.portal._request(this.itemUrl+"/rating",{query:{token:this.apiKey},...e}).then(t=>t.rating!=null?(t.created=new Date(t.created),new KB(t)):null)}fetchRelatedItems(e,t){return this.portal._requestToTypedArray(this.itemUrl+"/relatedItems",{query:{...e,token:this.apiKey},...t},QT)}getThumbnailUrl(e){let t=this.thumbnailUrl;return t&&e&&(t+=`&w=${e}`),t}reload(){return this.portal._request(this.itemUrl,{cacheBust:!0,query:{token:this.apiKey}}).then(e=>(this.sourceJSON=e,this.read(e),this))}update(e){return this.id?this.load().then(()=>this.portal._signIn()).then(()=>{const t=e&&e.data,r={method:"post"};r.query=this.createPostQuery();for(const i in r.query)r.query[i]===null&&(r.query[i]="");return r.query.clearEmptyFields=!0,t!=null&&(typeof t=="string"?r.query.text=t:typeof t=="object"&&(r.query.text=JSON.stringify(t))),this.portal._request(`${this.userItemUrl}/update`,r).then(()=>this.reload())}):Promise.reject(new k("portal:item-does-not-exist","The item does not exist yet and cannot be updated"))}updateThumbnail(e){return this.id?this.load().then(()=>this.portal._signIn()).then(()=>{const t=e.thumbnail,r=e.filename,i={method:"post"};if(typeof t=="string")Tm(t)?i.query={data:t}:i.query={url:Fh(t)},_(r)&&(i.query.filename=r);else{const n=new FormData;_(r)?n.append("file",t,r):n.append("file",t),i.body=n}return this.portal._request(`${this.userItemUrl}/updateThumbnail`,i).then(()=>this.reload())}):Promise.reject(new k("portal:item-does-not-exist","The item does not exist yet and cannot be updated"))}async fetchResources(e={},t){return(await ie(()=>Promise.resolve().then(()=>vC),void 0,import.meta.url)).fetchResources(this,e,t)}async addResource(e,t,r){const i=await ie(()=>Promise.resolve().then(()=>vC),void 0,import.meta.url);return e.portalItem=this,i.addOrUpdateResource(e,"add",t,r)}async removeResource(e,t){const r=await ie(()=>Promise.resolve().then(()=>vC),void 0,import.meta.url);if(e.portalItem&&e.portalItem.itemUrl!==this.itemUrl)throw new k("removeresource:portal-item-mismatch","The portal item associated with the provided resource does not match the item");return r.removeResource(this,e,t)}async removeAllResources(e){return(await ie(()=>Promise.resolve().then(()=>vC),void 0,import.meta.url)).removeAllResources(this,e)}resourceFromPath(e){return new xVe({portalItem:this,path:e})}toJSON(){const e=this.extent,t={accessInformation:this.accessInformation,categories:te(this.categories),created:this.created&&this.created.getTime(),description:this.description,extent:e&&[[e.xmin,e.ymin],[e.xmax,e.ymax]],id:this.id,licenseInfo:this.licenseInfo,modified:this.modified&&this.modified.getTime(),name:this.name,owner:this.owner,ownerFolder:this.ownerFolder,snippet:this.snippet,spatialReference:this.spatialReference,tags:te(this.tags),thumbnail:this.thumbnail,title:this.title,type:this.type,typeKeywords:te(this.typeKeywords),url:this.url};return S2e(t)}static fromJSON(e){if(!e)return null;if(e.declaredClass)throw new Error("JSON object is already hydrated");return new QT({sourceJSON:e})}_getPostQuery(){const e=this.toJSON();for(const t in e)t==="tags"&&e[t]!==null&&(e[t]=e[t].join(", ")),t==="typeKeywords"&&e[t]!==null&&(e[t]=e[t].join(", ")),t==="extent"&&e[t]&&(e[t]=JSON.stringify(e[t]));return e}};d([f({type:["private","shared","org","public"]})],fr.prototype,"access",void 0),d([f()],fr.prototype,"accessInformation",void 0),d([f({type:String})],fr.prototype,"apiKey",void 0),d([f({json:{read:{source:"appProxies"}}})],fr.prototype,"applicationProxies",void 0),d([f()],fr.prototype,"avgRating",void 0),d([f()],fr.prototype,"categories",void 0),d([f({type:Date})],fr.prototype,"created",void 0),d([f()],fr.prototype,"culture",void 0),d([f()],fr.prototype,"description",void 0),d([f({readOnly:!0})],fr.prototype,"displayName",null),d([f({type:Zt})],fr.prototype,"extent",void 0),d([$e("extent")],fr.prototype,"readExtent",null),d([f()],fr.prototype,"groupCategories",void 0),d([f({readOnly:!0})],fr.prototype,"iconUrl",null),d([f()],fr.prototype,"id",void 0),d([f({readOnly:!0})],fr.prototype,"isLayer",null),d([f()],fr.prototype,"itemControl",void 0),d([f({readOnly:!0})],fr.prototype,"itemUrl",null),d([f()],fr.prototype,"licenseInfo",void 0),d([f({type:Date})],fr.prototype,"modified",void 0),d([f()],fr.prototype,"name",void 0),d([f()],fr.prototype,"numComments",void 0),d([f()],fr.prototype,"numRatings",void 0),d([f()],fr.prototype,"numViews",void 0),d([f()],fr.prototype,"owner",void 0),d([f()],fr.prototype,"ownerFolder",void 0),d([f({type:Cs})],fr.prototype,"portal",void 0),d([f()],fr.prototype,"screenshots",void 0),d([f()],fr.prototype,"size",void 0),d([f()],fr.prototype,"snippet",void 0),d([f()],fr.prototype,"sourceJSON",void 0),d([f({type:String})],fr.prototype,"spatialReference",void 0),d([f()],fr.prototype,"tags",void 0),d([f()],fr.prototype,"thumbnail",void 0),d([f({readOnly:!0})],fr.prototype,"thumbnailUrl",null),d([f()],fr.prototype,"title",void 0),d([f()],fr.prototype,"type",void 0),d([f()],fr.prototype,"typeKeywords",void 0),d([f({type:String,json:{read(e,t){var i;if(t.type!=="KML")return e;const r=(i=this.portal)==null?void 0:i.restUrl;return e||(e=r&&this.id?`${r}/content/items/${this.id}/data`:null),e}}})],fr.prototype,"url",void 0),d([f({readOnly:!0})],fr.prototype,"userItemUrl",null),fr=QT=d([$("esri.portal.PortalItem")],fr);const I5=fr,rwe=Object.freeze(Object.defineProperty({__proto__:null,default:I5},Symbol.toStringTag,{value:"Module"})),Rce=/^([a-z]{2})(?:[-_]([A-Za-z]{2}))?$/,TVe={ar:!0,bg:!0,bs:!0,ca:!0,cs:!0,da:!0,de:!0,el:!0,en:!0,es:!0,et:!0,fi:!0,fr:!0,he:!0,hr:!0,hu:!0,id:!0,it:!0,ja:!0,ko:!0,lt:!0,lv:!0,nb:!0,nl:!0,pl:!0,"pt-BR":!0,"pt-PT":!0,ro:!0,ru:!0,sk:!0,sl:!0,sr:!0,sv:!0,th:!0,tr:!0,uk:!0,vi:!0,"zh-CN":!0,"zh-HK":!0,"zh-TW":!0};function Oce(e){var t;return(t=TVe[e])!=null?t:!1}const lE=[],q4=new Map;function Mce(e){for(const t of q4.keys())iwe(e.pattern,t)&&q4.delete(t)}function SVe(e){return lE.includes(e)||(Mce(e),lE.unshift(e)),{remove(){const t=lE.indexOf(e);t>-1&&(lE.splice(t,1),Mce(e))}}}async function ere(e){const t=mu();q4.has(e)||q4.set(e,CVe(e,t));const r=q4.get(e);return await AVe.add(r),r}function EVe(e){if(!Rce.test(e))return null;const[,t,r]=Rce.exec(e),i=t+(r?"-"+r.toUpperCase():"");return Oce(i)?i:Oce(t)?t:null}async function CVe(e,t){const r=[];for(const i of lE)if(iwe(i.pattern,e))try{return await i.fetchMessageBundle(e,t)}catch(n){r.push(n)}throw r.length?new k("intl:message-bundle-error",`Errors occurred while loading "${e}"`,{errors:r}):new k("intl:no-message-bundle-loader",`No loader found for message bundle "${e}"`)}function iwe(e,t){return typeof e=="string"?t.startsWith(e):e.test(t)}Jte(()=>{q4.clear()});const AVe=new class{constructor(){this._numLoading=0}async waitForAll(){this._dfd&&await this._dfd.promise}add(e){return this._increase(),e.then(()=>this._decrease(),()=>this._decrease()),this.waitForAll()}_increase(){this._numLoading++,this._dfd||(this._dfd=jv())}_decrease(){this._numLoading=Math.max(this._numLoading-1,0),this._dfd&&this._numLoading===0&&(this._dfd.resolve(),this._dfd=null)}};async function RVe(e){if(!e)return;const t=e.includes("-vector")?e.slice(0,e.indexOf("-vector")):e,r=await ere("esri/t9n/basemaps");return r[e]||r[t]}const oA={streets:{id:"streets",classic:!0,deprecated:!0,get thumbnailUrl(){return xr("esri/images/basemap/streets.jpg")},baseMapLayers:[{id:"streets-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Street_Map/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Street Map",showLegend:!1,visibility:!0,opacity:1}]},satellite:{id:"satellite",classic:!0,get thumbnailUrl(){return xr("esri/images/basemap/satellite.jpg")},baseMapLayers:[{id:"satellite-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Imagery",showLegend:!1,visibility:!0,opacity:1}]},hybrid:{id:"hybrid",classic:!0,get thumbnailUrl(){return xr("esri/images/basemap/hybrid.jpg")},baseMapLayers:[{id:"hybrid-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Imagery",showLegend:!1,visibility:!0,opacity:1},{id:"hybrid-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/30d6b8271e1849cd9c3042060001f425/resources/styles/root.json",layerType:"VectorTileLayer",title:"Hybrid Reference Layer",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},terrain:{id:"terrain",classic:!0,get thumbnailUrl(){return xr("esri/images/basemap/terrain.jpg")},baseMapLayers:[{id:"terrain-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Terrain_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Terrain Base",showLegend:!1,visibility:!0,opacity:1},{id:"terrain-reference-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Reference/World_Reference_Overlay/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Reference Overlay",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},topo:{id:"topo",classic:!0,deprecated:!0,get thumbnailUrl(){return xr("esri/images/basemap/topo.jpg")},baseMapLayers:[{id:"topo-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Topo_Map/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Topo Map",showLegend:!1,visibility:!0,opacity:1}]},gray:{id:"gray",classic:!0,deprecated:!0,get thumbnailUrl(){return xr("esri/images/basemap/gray.jpg")},baseMapLayers:[{id:"gray-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Light_Gray_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Light Gray Base",showLegend:!1,visibility:!0,opacity:1},{id:"gray-reference-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Light_Gray_Reference/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Light Gray Reference",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},"dark-gray":{id:"dark-gray",classic:!0,deprecated:!0,get thumbnailUrl(){return xr("esri/images/basemap/dark-gray.jpg")},baseMapLayers:[{id:"dark-gray-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Dark_Gray_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Dark Gray Base",showLegend:!1,visibility:!0,opacity:1},{id:"dark-gray-reference-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Dark_Gray_Reference/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Dark Gray Reference",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},oceans:{id:"oceans",classic:!0,get thumbnailUrl(){return xr("esri/images/basemap/oceans.jpg")},baseMapLayers:[{id:"oceans-base-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Ocean/World_Ocean_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Ocean Base",showLegend:!1,visibility:!0,opacity:1},{id:"oceans-reference-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Ocean/World_Ocean_Reference/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Ocean Reference",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},"national-geographic":{id:"national-geographic",classic:!0,deprecated:!0,get thumbnailUrl(){return xr("esri/images/basemap/national-geographic.jpg")},baseMapLayers:[{id:"national-geographic-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/NatGeo_World_Map/MapServer",title:"NatGeo World Map",showLegend:!1,layerType:"ArcGISTiledMapServiceLayer",visibility:!0,opacity:1}]},osm:{id:"osm",classic:!0,get thumbnailUrl(){return xr("esri/images/basemap/osm.jpg")},baseMapLayers:[{id:"osm-base-layer",layerType:"OpenStreetMap",title:"Open Street Map",showLegend:!1,visibility:!0,opacity:1}]},"dark-gray-vector":{id:"dark-gray-vector",classic:!0,get thumbnailUrl(){return xr("esri/images/basemap/dark-gray-vector.jpg")},baseMapLayers:[{id:"dark-gray-base-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/5e9b3685f4c24d8781073dd928ebda50/resources/styles/root.json",layerType:"VectorTileLayer",title:"Dark Gray Base",visibility:!0,opacity:1},{id:"dark-gray-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/747cb7a5329c478cbe6981076cc879c5/resources/styles/root.json",layerType:"VectorTileLayer",title:"Dark Gray Reference",isReference:!0,visibility:!0,opacity:1}]},"gray-vector":{id:"gray-vector",classic:!0,get thumbnailUrl(){return xr("esri/images/basemap/gray-vector.jpg")},baseMapLayers:[{id:"gray-base-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/291da5eab3a0412593b66d384379f89f/resources/styles/root.json",layerType:"VectorTileLayer",title:"Light Gray Base",visibility:!0,opacity:1},{id:"gray-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/1768e8369a214dfab4e2167d5c5f2454/resources/styles/root.json",layerType:"VectorTileLayer",title:"Light Gray Reference",isReference:!0,visibility:!0,opacity:1}]},"streets-vector":{id:"streets-vector",classic:!0,get thumbnailUrl(){return xr("esri/images/basemap/streets-vector.jpg")},baseMapLayers:[{id:"streets-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/de26a3cf4cc9451298ea173c4b324736/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets",visibility:!0,opacity:1}]},"topo-vector":{id:"topo-vector",classic:!0,get thumbnailUrl(){return xr("esri/images/basemap/topo-vector.jpg")},baseMapLayers:[{id:"world-hillshade-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Hillshade",showLegend:!1,visibility:!0,opacity:1},{id:"topo-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/7dc6cea0b1764a1f9af2e679f642f0f5/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Topo",visibility:!0,opacity:1}]},"streets-night-vector":{id:"streets-night-vector",classic:!0,get thumbnailUrl(){return xr("esri/images/basemap/streets-night.jpg")},baseMapLayers:[{id:"streets-night-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/86f556a2d1fd468181855a35e344567f/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets Night",visibility:!0,opacity:1}]},"streets-relief-vector":{id:"streets-relief-vector",classic:!0,get thumbnailUrl(){return xr("esri/images/basemap/streets-relief.jpg")},baseMapLayers:[{id:"world-hillshade-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Hillshade",showLegend:!1,visibility:!0,opacity:1},{id:"streets-relief-vector-base-layer",styleUrl:"//www.arcgis.com/sharing/rest/content/items/b266e6d17fc345b498345613930fbd76/resources/styles/root.json",title:"World Streets Relief",layerType:"VectorTileLayer",visibility:!0,opacity:1}]},"streets-navigation-vector":{id:"streets-navigation-vector",classic:!0,get thumbnailUrl(){return xr("esri/images/basemap/streets-navigation.jpg")},baseMapLayers:[{id:"streets-navigation-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/63c47b7177f946b49902c24129b87252/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets Navigation",visibility:!0,opacity:1}]},"arcgis-imagery":{get thumbnailUrl(){return xr("esri/images/basemap/hybrid.jpg")},title:"Imagery Hybrid",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Imagery",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/World_Imagery/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Imagery:Labels",title:"Hybrid Reference Layer",isReference:!0}]},"arcgis-imagery-standard":{get thumbnailUrl(){return xr("esri/images/basemap/satellite.jpg")},title:"Imagery",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Imagery",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/World_Imagery/MapServer"}]},"arcgis-imagery-labels":{title:"Hybrid [Reference]",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Imagery:Labels",title:"Hybrid Reference Layer",isReference:!0}]},"arcgis-light-gray":{get thumbnailUrl(){return xr("esri/images/basemap/gray-vector.jpg")},title:"Light Gray Canvas",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:LightGray:Base",title:"Light Gray Canvas Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:LightGray:Labels",title:"Light Gray Canvas Labels",isReference:!0}]},"arcgis-dark-gray":{get thumbnailUrl(){return xr("esri/images/basemap/dark-gray.jpg")},title:"Dark Gray Canvas",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:DarkGray:Base",title:"Dark Gray Canvas Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:DarkGray:Labels",title:"Dark Gray Canvas Labels",isReference:!0}]},"arcgis-navigation":{get thumbnailUrl(){return xr("esri/images/basemap/streets-navigation.jpg")},title:"Navigation",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Navigation",title:"World Navigation Map"}]},"arcgis-navigation-night":{title:"Navigation (Dark Mode)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:NavigationNight",title:"World Navigation Map (Dark Mode)"}]},"arcgis-streets":{get thumbnailUrl(){return xr("esri/images/basemap/streets-vector.jpg")},title:"Streets",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Streets",title:"World Street Map"}]},"arcgis-streets-night":{get thumbnailUrl(){return xr("esri/images/basemap/streets-night.jpg")},title:"Streets (Night)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:StreetsNight",title:"World Street Map (Night)"}]},"arcgis-streets-relief":{get thumbnailUrl(){return xr("esri/images/basemap/streets-relief.jpg")},title:"Streets (with Relief)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:StreetsRelief:Base",title:"World Street Map (with Relief)"}]},"arcgis-topographic":{get thumbnailUrl(){return xr("esri/images/basemap/topo.jpg")},title:"Topographic",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Topographic:Base",title:"World Topographic Map"}]},"arcgis-oceans":{get thumbnailUrl(){return xr("esri/images/basemap/oceans.jpg")},title:"Oceans",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Ocean Base",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Ocean/World_Ocean_Base/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Oceans:Labels",title:"World Ocean Reference",isReference:!0}]},"osm-standard":{title:"OpenStreetMap",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:Standard",title:"OpenStreetMap"}]},"osm-standard-relief":{title:"OpenStreetMap (with relief)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:StandardRelief:Base",layerType:"VectorTileLayer",title:"OpenStreetMap Relief Base"}]},"osm-streets":{title:"OpenStreetMap (Streets)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:Streets",title:"OpenStreetMap (Streets)"}]},"osm-streets-relief":{title:"OpenStreetMap (Streets with relief)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:StreetsRelief:Base",layerType:"VectorTileLayer",title:"OpenStreetMap Relief Base"}]},"osm-light-gray":{title:"OpenStreetMap (Light Gray Canvas)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:LightGray:Base",title:"OSM (Light Gray Base)"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:LightGray:Labels",title:"OSM (Light Gray Reference)",isReference:!0}]},"osm-dark-gray":{title:"OpenStreetMap (Dark Gray Canvas)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:DarkGray:Base",title:"OSM (Dark Gray Base)"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:DarkGray:Labels",title:"OSM (Dark Gray Reference)",isReference:!0}]},"arcgis-terrain":{title:"Terrain with Labels",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Terrain:Base",title:"World Terrain Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Terrain:Detail",title:"World Terrain Reference",isReference:!0}]},"arcgis-community":{title:"Community",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Community",title:"Community"}]},"arcgis-charted-territory":{title:"Charted Territory",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:ChartedTerritory:Base",title:"Charted Territory"}]},"arcgis-colored-pencil":{title:"Colored Pencil",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:ColoredPencil",title:"Colored Pencil"}]},"arcgis-nova":{title:"Nova",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Nova",title:"Nova"}]},"arcgis-modern-antique":{title:"Modern Antique",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:ModernAntique:Base",title:"Modern Antique"}]},"arcgis-midcentury":{title:"Mid-Century",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Midcentury",title:"Mid-Century"}]},"arcgis-newspaper":{title:"Newspaper",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Newspaper",title:"Newspaper"}]},"arcgis-hillshade-light":{title:"Hillshade",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"}]},"arcgis-hillshade-dark":{title:"Hillshade (Dark)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade (Dark)",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade_Dark/MapServer"}]}};function Pce(e){const t=e==null?void 0:e.type;return t==="imagery-tile"||t==="tile"||t==="open-street-map"||t==="vector-tile"||t==="web-tile"||t==="wmts"}function H4(e){const t=e==null?void 0:e.type;return t==="base-tile"||t==="tile"||t==="elevation"||t==="imagery-tile"||t==="base-elevation"||t==="open-street-map"||t==="wcs"||t==="web-tile"||t==="wmts"||t==="vector-tile"}function Ice(e){return(e==null?void 0:e.type)==="voxel"}function $ce(e){return(e==null?void 0:e.type)==="imagery-tile"}function nwe(e){var t;return((t=e.parent)==null?void 0:t.declaredClass)==="esri.Basemap"&&e.parent.baseLayers.includes(e)}function tre(e){var t;return(e==null?void 0:e.type)==="feature"&&!e.url&&((t=e.source)==null?void 0:t.type)==="memory"}function WPt(e){var t;return(e==null?void 0:e.type)==="feature"&&((t=e.source)==null?void 0:t.type)==="feature-layer"}function xX(e){return e.labelsVisible===!0&&e.labelingInfo!=null&&e.labelingInfo.length>0}function OVe(e){if(e.activeLayer){const t=e.activeLayer.tileMatrixSet;if(t)return t;const r=e.activeLayer.tileMatrixSets;if(r)return r}return null}const MVe=new Set(["bing-maps","imagery","imagery-tile","map-image","open-street-map","tile","unknown","unsupported","vector-tile","web-tile","wms","wmts"]),PVe=new Set(["csv","feature","geo-rss","geojson","group","imagery","imagery-tile","kml","map-image","map-notes","ogc-feature","route","tile","unknown","unsupported","vector-tile","web-tile","wfs","wms","wmts"]);function IVe(e){return e.layerContainerType==="basemap"?MVe:e.layerContainerType==="operational-layers"?PVe:null}function $Ve(e,t){if(t.restrictedWebMapWriting){const r=IVe(t);return!_(r)||r.has(e.type)&&!tre(e)}return!0}function LVe(e,t){if(tre(e)){const r=W9("featureCollection.layers",t),i=r&&r[0]&&r[0].layerDefinition;i&&eG(e,i)}else e.type==="stream"?eG(e,t.layerDefinition=t.layerDefinition||{}):e.type!=="group"&&eG(e,t)}function eG(e,t){"maxScale"in e&&(t.maxScale=OF(e.maxScale)),"minScale"in e&&(t.minScale=OF(e.minScale))}function DVe(e,t){if(LVe(e,t),"blendMode"in e&&(t.blendMode=e.blendMode,t.blendMode==="normal"&&delete t.blendMode),t.opacity=OF(e.opacity),t.title=e.title||"Layer",t.visibility=e.visible,"legendEnabled"in e&&e.type!=="wmts")if(tre(e)){const r=t.featureCollection;r&&(r.showLegend=e.legendEnabled)}else t.showLegend=e.legendEnabled}function Lce(e,t,r){if(!("write"in e)||!e.write)return r&&r.messages&&r.messages.push(new k("layer:unsupported",`Layers (${e.title}, ${e.id}) of type '${e.declaredClass}' cannot be persisted`,{layer:e})),null;if($Ve(e,r)){const i={};return e.write(i,r)?i:null}return _(t)&&DVe(e,t=te(t)),t}var j$;let FVe=0;const tG=fe.getLogger("esri.Basemap");let eh=j$=class extends Z9(hd){constructor(e){super(e),this.id=null,this.portalItem=null,this.spatialReference=null,this.thumbnailUrl=null,this.title="Basemap",this.id=Date.now().toString(16)+"-basemap-"+FVe++,this.baseLayers=new lt,this.referenceLayers=new lt;const t=i=>{i.parent&&i.parent!==this&&"remove"in i.parent&&i.parent.remove(i),i.parent=this,i.type==="elevation"&&tG.error(`Layer '${i.title}, id:${i.id}' of type '${i.type}' is not supported as a basemap layer and will therefore be ignored.`)},r=i=>{i.parent=null};this.baseLayers.on("after-add",i=>t(i.item)),this.referenceLayers.on("after-add",i=>t(i.item)),this.baseLayers.on("after-remove",i=>r(i.item)),this.referenceLayers.on("after-remove",i=>r(i.item))}initialize(){this.when().catch(e=>{tG.error("#load()",`Failed to load basemap (title: '${this.title}', id: '${this.id}')`,e)}),this.resourceInfo&&this.read(this.resourceInfo.data,this.resourceInfo.context)}destroy(){var r;const e=this.baseLayers.removeAll();for(const i of e)i.destroy();const t=this.referenceLayers.removeAll();for(const i of t)i.destroy();this.baseLayers.destroy(),this.referenceLayers.destroy(),(r=this.portalItem)==null||r.destroy(),this.portalItem=null}normalizeCtorArgs(e){return e&&"resourceInfo"in e&&(this._set("resourceInfo",e.resourceInfo),delete(e={...e}).resourceInfo),e}set baseLayers(e){this._set("baseLayers",Rw(e,this._get("baseLayers")))}_writeBaseLayers(e,t,r){const i=[];e&&(r={...r,layerContainerType:"basemap"},this.baseLayers.forEach(n=>{const s=Lce(n,r.webmap?r.webmap.getLayerJSONFromResourceInfo(n):null,r);_(s)&&i.push(s)}),this.referenceLayers.forEach(n=>{const s=Lce(n,r.webmap?r.webmap.getLayerJSONFromResourceInfo(n):null,r);_(s)&&(s.isReference=!0,i.push(s))})),t.baseMapLayers=i}set referenceLayers(e){this._set("referenceLayers",Rw(e,this._get("referenceLayers")))}writeTitle(e,t){t.title=e||"Basemap"}load(e){return this.addResolvingPromise(this._loadFromSource(e)),Promise.resolve(this)}loadAll(){return C3e(this,e=>{e(this.baseLayers,this.referenceLayers)})}clone(){const e={id:this.id,title:this.title,portalItem:this.portalItem,baseLayers:this.baseLayers.slice(),referenceLayers:this.referenceLayers.slice()};return this.loaded&&(e.loadStatus="loaded"),new j$({resourceInfo:this.resourceInfo}).set(e)}read(e,t){this.resourceInfo||this._set("resourceInfo",{data:e,context:t}),super.read(e,t)}write(e,t){return e=e||{},t&&t.origin||(t={origin:"web-map",...t}),super.write(e,t),!this.loaded&&this.resourceInfo&&this.resourceInfo.data.baseMapLayers&&(e.baseMapLayers=this.resourceInfo.data.baseMapLayers.map(r=>{const i=te(r);return i.url&&cm(i.url)&&(i.url=`https:${i.url}`),i.templateUrl&&cm(i.templateUrl)&&(i.templateUrl=`https:${i.templateUrl}`),i})),e}async _loadFromSource(e){const{resourceInfo:t,portalItem:r}=this;Et(e);const i=[];if(t){const n=t.context?t.context.url:null;if(i.push(this._loadLayersFromJSON(t.data,n,e)),t.data.id&&!t.data.title){const s=t.data.id;i.push(RVe(s).then(a=>{a&&this.read({title:a},t.context)}))}}else r&&i.push(this._loadFromItem(r,e));await Promise.all(i)}async _loadLayersFromJSON(e,t,r){const i=this.resourceInfo&&this.resourceInfo.context,n=this.portalItem&&this.portalItem.portal||i&&i.portal||null,s=i&&i.origin==="web-scene"?"web-scene":"web-map",{populateOperationalLayers:a}=await ie(()=>import("./layersCreator.62e74b60.js"),["layersCreator.62e74b60.js","lazyLayerLoader.5e7c3b38.js","portalLayers.6f0bd1c6.js","layersLoader.315a9bc7.js","jsonContext.b1feec67.js","portalItemUtils.59cab615.js"],import.meta.url),o=[];if(Et(r),e.baseMapLayers&&Array.isArray(e.baseMapLayers)){const l={context:{origin:s,url:t,portal:n,layerContainerType:"basemap"},defaultLayerType:"DefaultTileLayer"},c=a(this.baseLayers,e.baseMapLayers.filter(h=>!h.isReference),l);o.push(c);const u=a(this.referenceLayers,e.baseMapLayers.filter(h=>h.isReference),l);o.push(u)}await dn(o)}async _loadFromItem(e,t){const r=await e.load(t),i=await r.fetchData("json",t),n=pn(e.itemUrl);return this._set("resourceInfo",{data:i.baseMap,context:{origin:"web-map",portal:e.portal||Cs.getDefault(),url:n}}),this.read(this.resourceInfo.data,this.resourceInfo.context),this.read({spatialReference:i.spatialReference},this.resourceInfo.context),this.read({title:e.title,thumbnailUrl:e.thumbnailUrl},{origin:"portal-item",portal:e.portal||Cs.getDefault(),url:n}),this._loadLayersFromJSON(this.resourceInfo.data,n,t)}static fromId(e){const t=oA[e];if(t){if(t.deprecated){let r=null;e==="dark-gray"?r="dark-gray-vector":e==="gray"?r="gray-vector":e==="streets"?r="streets-vector":e==="topo"&&(r="topo-vector"),G2e(tG,`The ${e} basemap has entered mature support and is no longer being updated.`,{replacement:r,see:"https://arcg.is/1iq8aD",warnOnce:!0})}return j$.fromJSON(t)}return null}};d([f({json:{write:{ignoreOrigin:!0,target:"baseMapLayers",writer(e,t,r,i){this._writeBaseLayers(e,t,i)}},origins:{"web-scene":{write:{ignoreOrigin:!0,target:{baseMapLayers:{type:lt}},writer(e,t,r,i){this._writeBaseLayers(e,t,i)}}}}}})],eh.prototype,"baseLayers",null),d([f({type:String,json:{origins:{"web-scene":{write:!0}}}})],eh.prototype,"id",void 0),d([f({type:I5})],eh.prototype,"portalItem",void 0),d([f()],eh.prototype,"referenceLayers",null),d([f({readOnly:!0})],eh.prototype,"resourceInfo",void 0),d([f({type:Ye})],eh.prototype,"spatialReference",void 0),d([f()],eh.prototype,"thumbnailUrl",void 0),d([f({type:String,json:{origins:{"web-scene":{write:{isRequired:!0}}}}})],eh.prototype,"title",void 0),d([Xe("title")],eh.prototype,"writeTitle",null),eh=j$=d([$("esri.Basemap")],eh);const dp=eh,NVe=Object.freeze(Object.defineProperty({__proto__:null,default:dp},Symbol.toStringTag,{value:"Module"})),DF={transparent:[0,0,0,0],black:[0,0,0,1],silver:[192,192,192,1],gray:[128,128,128,1],white:[255,255,255,1],maroon:[128,0,0,1],red:[255,0,0,1],purple:[128,0,128,1],fuchsia:[255,0,255,1],green:[0,128,0,1],lime:[0,255,0,1],olive:[128,128,0,1],yellow:[255,255,0,1],navy:[0,0,128,1],blue:[0,0,255,1],teal:[0,128,128,1],aqua:[0,255,255,1],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],blanchedalmond:[255,235,205,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],oldlace:[253,245,230,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],rebeccapurple:[102,51,153,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],whitesmoke:[245,245,245,1],yellowgreen:[154,205,50,1]};function swe(e){return DF[e]||DF[e.toLowerCase()]}function rre(e){var t;return(t=DF[e])!=null?t:DF[e.toLowerCase()]}function kVe(e){return[...rre(e)]}function rG(e,t,r){r<0&&++r,r>1&&--r;const i=6*r;return i<1?e+(t-e)*i:2*r<1?t:3*r<2?e+(t-e)*(2/3-r)*6:e}function awe(e,t,r,i=1){const n=(e%360+360)%360/360,s=r<=.5?r*(t+1):r+t-r*t,a=2*r-s;return[Math.round(255*rG(a,s,n+1/3)),Math.round(255*rG(a,s,n)),Math.round(255*rG(a,s,n-1/3)),i]}function VVe(e){const t=e.length>5,r=t?8:4,i=(1<<r)-1,n=t?1:17,s=t?e.length===9:e.length===5;let a=Number("0x"+e.substr(1));if(isNaN(a))return null;const o=[0,0,0,1];let l;return s&&(l=a&i,a>>=r,o[3]=n*l/255),l=a&i,a>>=r,o[2]=n*l,l=a&i,a>>=r,o[1]=n*l,l=a&i,a>>=r,o[0]=n*l,o}function M(){return[0,0,0]}function Kn(e){return[e[0],e[1],e[2]]}function Ve(e,t,r){return[e,t,r]}function Wl(e){const t=M(),r=Math.min(3,e.length);for(let i=0;i<r;++i)t[i]=e[i];return t}function ire(e,t){return new Float64Array(e,t,3)}function owe(){return M()}function lwe(){return Ve(1,1,1)}function cwe(){return Ve(1,0,0)}function dwe(){return Ve(0,1,0)}function nre(){return Ve(0,0,1)}const gl=owe(),X0=lwe(),zVe=cwe(),UVe=dwe(),uwe=nre();Object.freeze(Object.defineProperty({__proto__:null,create:M,clone:Kn,fromValues:Ve,fromArray:Wl,createView:ire,zeros:owe,ones:lwe,unitX:cwe,unitY:dwe,unitZ:nre,ZEROS:gl,ONES:X0,UNIT_X:zVe,UNIT_Y:UVe,UNIT_Z:uwe},Symbol.toStringTag,{value:"Module"}));const Rt=1e-6,up=Math.random,BVe=Math.PI/180,GVe=180/Math.PI;function fV(e){return e*BVe}function jVe(e){return e*GVe}function qVe(e,t){return Math.abs(e-t)<=Rt*Math.max(1,Math.abs(e),Math.abs(t))}Object.freeze(Object.defineProperty({__proto__:null,EPSILON:Rt,RANDOM:up,toRadian:fV,toDegree:jVe,equals:qVe},Symbol.toStringTag,{value:"Module"}));function Oe(e){const t=e[0],r=e[1],i=e[2];return Math.sqrt(t*t+r*r+i*i)}function oe(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function ne(e,t,r,i){return e[0]=t,e[1]=r,e[2]=i,e}function he(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e}function pe(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e}function pV(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e[2]=t[2]*r[2],e}function FF(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e[2]=t[2]/r[2],e}function HVe(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e}function WVe(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e}function TX(e,t){return e[0]=Math.abs(t[0]),e[1]=Math.abs(t[1]),e[2]=Math.abs(t[2]),e}function hwe(e,t){return e[0]=Math.sign(t[0]),e[1]=Math.sign(t[1]),e[2]=Math.sign(t[2]),e}function fwe(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e[2]=Math.min(t[2],r[2]),e}function XVe(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e[2]=Math.max(t[2],r[2]),e}function YVe(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e}function le(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e}function N3(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e[2]=t[2]+r[2]*i,e}function fi(e,t){const r=t[0]-e[0],i=t[1]-e[1],n=t[2]-e[2];return Math.sqrt(r*r+i*i+n*n)}function Vs(e,t){const r=t[0]-e[0],i=t[1]-e[1],n=t[2]-e[2];return r*r+i*i+n*n}function fl(e){const t=e[0],r=e[1],i=e[2];return t*t+r*r+i*i}function Io(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e}function ZVe(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e}function we(e,t){const r=t[0],i=t[1],n=t[2];let s=r*r+i*i+n*n;return s>0&&(s=1/Math.sqrt(s),e[0]=t[0]*s,e[1]=t[1]*s,e[2]=t[2]*s),e}function Se(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function dt(e,t,r){const i=t[0],n=t[1],s=t[2],a=r[0],o=r[1],l=r[2];return e[0]=n*l-s*o,e[1]=s*a-i*l,e[2]=i*o-n*a,e}function As(e,t,r,i){const n=t[0],s=t[1],a=t[2];return e[0]=n+i*(r[0]-n),e[1]=s+i*(r[1]-s),e[2]=a+i*(r[2]-a),e}function QVe(e,t,r,i,n,s){const a=s*s,o=a*(2*s-3)+1,l=a*(s-2)+s,c=a*(s-1),u=a*(3-2*s);return e[0]=t[0]*o+r[0]*l+i[0]*c+n[0]*u,e[1]=t[1]*o+r[1]*l+i[1]*c+n[1]*u,e[2]=t[2]*o+r[2]*l+i[2]*c+n[2]*u,e}function JVe(e,t,r,i,n,s){const a=1-s,o=a*a,l=s*s,c=o*a,u=3*s*o,h=3*l*a,p=l*s;return e[0]=t[0]*c+r[0]*u+i[0]*h+n[0]*p,e[1]=t[1]*c+r[1]*u+i[1]*h+n[1]*p,e[2]=t[2]*c+r[2]*u+i[2]*h+n[2]*p,e}function KVe(e,t){t=t||1;const r=2*up()*Math.PI,i=2*up()-1,n=Math.sqrt(1-i*i)*t;return e[0]=Math.cos(r)*n,e[1]=Math.sin(r)*n,e[2]=i*t,e}function ze(e,t,r){const i=t[0],n=t[1],s=t[2];return e[0]=r[0]*i+r[4]*n+r[8]*s+r[12],e[1]=r[1]*i+r[5]*n+r[9]*s+r[13],e[2]=r[2]*i+r[6]*n+r[10]*s+r[14],e}function ed(e,t,r){const i=t[0],n=t[1],s=t[2];return e[0]=i*r[0]+n*r[3]+s*r[6],e[1]=i*r[1]+n*r[4]+s*r[7],e[2]=i*r[2]+n*r[5]+s*r[8],e}function gu(e,t,r){const i=r[0],n=r[1],s=r[2],a=r[3],o=t[0],l=t[1],c=t[2];let u=n*c-s*l,h=s*o-i*c,p=i*l-n*o,m=n*p-s*h,g=s*u-i*p,b=i*h-n*u;const w=2*a;return u*=w,h*=w,p*=w,m*=2,g*=2,b*=2,e[0]=o+u+m,e[1]=l+h+g,e[2]=c+p+b,e}function eze(e,t,r,i){const n=[],s=[];return n[0]=t[0]-r[0],n[1]=t[1]-r[1],n[2]=t[2]-r[2],s[0]=n[0],s[1]=n[1]*Math.cos(i)-n[2]*Math.sin(i),s[2]=n[1]*Math.sin(i)+n[2]*Math.cos(i),e[0]=s[0]+r[0],e[1]=s[1]+r[1],e[2]=s[2]+r[2],e}function tze(e,t,r,i){const n=[],s=[];return n[0]=t[0]-r[0],n[1]=t[1]-r[1],n[2]=t[2]-r[2],s[0]=n[2]*Math.sin(i)+n[0]*Math.cos(i),s[1]=n[1],s[2]=n[2]*Math.cos(i)-n[0]*Math.sin(i),e[0]=s[0]+r[0],e[1]=s[1]+r[1],e[2]=s[2]+r[2],e}function rze(e,t,r,i){const n=[],s=[];return n[0]=t[0]-r[0],n[1]=t[1]-r[1],n[2]=t[2]-r[2],s[0]=n[0]*Math.cos(i)-n[1]*Math.sin(i),s[1]=n[0]*Math.sin(i)+n[1]*Math.cos(i),s[2]=n[2],e[0]=s[0]+r[0],e[1]=s[1]+r[1],e[2]=s[2]+r[2],e}function ize(e,t){oe(RM,e),oe(OM,t),we(RM,RM),we(OM,OM);const r=Se(RM,OM);return r>1?0:r<-1?Math.PI:Math.acos(r)}const RM=M(),OM=M();function nze(e){return"vec3("+e[0]+", "+e[1]+", "+e[2]+")"}function Kl(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]}function Lw(e,t){if(e===t)return!0;const r=e[0],i=e[1],n=e[2],s=t[0],a=t[1],o=t[2];return Math.abs(r-s)<=Rt*Math.max(1,Math.abs(r),Math.abs(s))&&Math.abs(i-a)<=Rt*Math.max(1,Math.abs(i),Math.abs(a))&&Math.abs(n-o)<=Rt*Math.max(1,Math.abs(n),Math.abs(o))}function By(e,t,r){const i=r[0]-t[0],n=r[1]-t[1],s=r[2]-t[2];let a=i*i+n*n+s*s;return a>0?(a=1/Math.sqrt(a),e[0]=i*a,e[1]=n*a,e[2]=s*a,e):(e[0]=0,e[1]=0,e[2]=0,e)}const pd=pe,sze=pV,aze=FF,sre=fi,are=Vs,ore=Oe,SX=fl,Dce=Object.freeze(Object.defineProperty({__proto__:null,length:Oe,copy:oe,set:ne,add:he,subtract:pe,multiply:pV,divide:FF,ceil:HVe,floor:WVe,abs:TX,sign:hwe,min:fwe,max:XVe,round:YVe,scale:le,scaleAndAdd:N3,distance:fi,squaredDistance:Vs,squaredLength:fl,negate:Io,inverse:ZVe,normalize:we,dot:Se,cross:dt,lerp:As,hermite:QVe,bezier:JVe,random:KVe,transformMat4:ze,transformMat3:ed,transformQuat:gu,rotateX:eze,rotateY:tze,rotateZ:rze,angle:ize,str:nze,exactEquals:Kl,equals:Lw,direction:By,sub:pd,mul:sze,div:aze,dist:sre,sqrDist:are,len:ore,sqrLen:SX},Symbol.toStringTag,{value:"Module"}));function hp(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function ei(e,t,r,i,n){return e[0]=t,e[1]=r,e[2]=i,e[3]=n,e}function lre(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e}function pwe(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e}function mwe(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e[2]=t[2]*r[2],e[3]=t[3]*r[3],e}function gwe(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e[2]=t[2]/r[2],e[3]=t[3]/r[3],e}function oze(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e[3]=Math.ceil(t[3]),e}function lze(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e[3]=Math.floor(t[3]),e}function cze(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e[2]=Math.min(t[2],r[2]),e[3]=Math.min(t[3],r[3]),e}function dze(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e[2]=Math.max(t[2],r[2]),e[3]=Math.max(t[3],r[3]),e}function uze(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e[3]=Math.round(t[3]),e}function YR(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e}function hze(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e[2]=t[2]+r[2]*i,e[3]=t[3]+r[3]*i,e}function ywe(e,t){const r=t[0]-e[0],i=t[1]-e[1],n=t[2]-e[2],s=t[3]-e[3];return Math.sqrt(r*r+i*i+n*n+s*s)}function NF(e,t){const r=t[0]-e[0],i=t[1]-e[1],n=t[2]-e[2],s=t[3]-e[3];return r*r+i*i+n*n+s*s}function cre(e){const t=e[0],r=e[1],i=e[2],n=e[3];return Math.sqrt(t*t+r*r+i*i+n*n)}function dre(e){const t=e[0],r=e[1],i=e[2],n=e[3];return t*t+r*r+i*i+n*n}function fze(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e}function pze(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e[3]=1/t[3],e}function bwe(e,t){const r=t[0],i=t[1],n=t[2],s=t[3];let a=r*r+i*i+n*n+s*s;return a>0&&(a=1/Math.sqrt(a),e[0]=r*a,e[1]=i*a,e[2]=n*a,e[3]=s*a),e}function vwe(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]}function mV(e,t,r,i){const n=t[0],s=t[1],a=t[2],o=t[3];return e[0]=n+i*(r[0]-n),e[1]=s+i*(r[1]-s),e[2]=a+i*(r[2]-a),e[3]=o+i*(r[3]-o),e}function mze(e,t){let r,i,n,s,a,o;t=t||1;do r=2*up()-1,i=2*up()-1,a=r*r+i*i;while(a>=1);do n=2*up()-1,s=2*up()-1,o=n*n+s*s;while(o>=1);const l=Math.sqrt((1-a)/o);return e[0]=t*r,e[1]=t*i,e[2]=t*n*l,e[3]=t*s*l,e}function du(e,t,r){const i=t[0],n=t[1],s=t[2],a=t[3];return e[0]=r[0]*i+r[4]*n+r[8]*s+r[12]*a,e[1]=r[1]*i+r[5]*n+r[9]*s+r[13]*a,e[2]=r[2]*i+r[6]*n+r[10]*s+r[14]*a,e[3]=r[3]*i+r[7]*n+r[11]*s+r[15]*a,e}function gze(e,t,r){const i=t[0],n=t[1],s=t[2],a=r[0],o=r[1],l=r[2],c=r[3],u=c*i+o*s-l*n,h=c*n+l*i-a*s,p=c*s+a*n-o*i,m=-a*i-o*n-l*s;return e[0]=u*c+m*-a+h*-l-p*-o,e[1]=h*c+m*-o+p*-a-u*-l,e[2]=p*c+m*-l+u*-o-h*-a,e[3]=t[3],e}function yze(e){return"vec4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}function lA(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]}function _we(e,t){const r=e[0],i=e[1],n=e[2],s=e[3],a=t[0],o=t[1],l=t[2],c=t[3];return Math.abs(r-a)<=Rt*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(i-o)<=Rt*Math.max(1,Math.abs(i),Math.abs(o))&&Math.abs(n-l)<=Rt*Math.max(1,Math.abs(n),Math.abs(l))&&Math.abs(s-c)<=Rt*Math.max(1,Math.abs(s),Math.abs(c))}const bze=pwe,vze=mwe,_ze=gwe,wze=ywe,xze=NF,Tze=cre,Sze=dre,wwe=Object.freeze(Object.defineProperty({__proto__:null,copy:hp,set:ei,add:lre,subtract:pwe,multiply:mwe,divide:gwe,ceil:oze,floor:lze,min:cze,max:dze,round:uze,scale:YR,scaleAndAdd:hze,distance:ywe,squaredDistance:NF,length:cre,squaredLength:dre,negate:fze,inverse:pze,normalize:bwe,dot:vwe,lerp:mV,random:mze,transformMat4:du,transformQuat:gze,str:yze,exactEquals:lA,equals:_we,sub:bze,mul:vze,div:_ze,dist:wze,sqrDist:xze,len:Tze,sqrLen:Sze},Symbol.toStringTag,{value:"Module"})),Fce=new Float32Array(1);function $5(e){--e;for(let t=1;t<32;t<<=1)e|=e>>t;return e+1}function Le(e,t,r){return Math.min(Math.max(e,t),r)}function L5(e){return(e&e-1)==0}function XPt(e){return e--,e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,e|=e>>16,++e}function YPt(e){return 10**Math.ceil(Math.LOG10E*Math.log(e))}function Kt(e,t,r){return e+(t-e)*r}function kt(e){return e*Math.PI/180}function md(e){return 180*e/Math.PI}function EX(e,t=1e-6){return(e<0?-1:1)/Math.max(Math.abs(e),t)}function Rs(e){return Math.acos(Le(e,-1,1))}function Pp(e){return Math.asin(Le(e,-1,1))}function Eze(e,t,r=1e-6){if(isNaN(e)||isNaN(t))return!1;if(e===t)return!0;const i=Math.abs(e-t),n=Math.abs(e),s=Math.abs(t);if(e===0||t===0||n<1e-12&&s<1e-12){if(i>.01*r)return!1}else if(i/(n+s)>r)return!1;return!0}function W4(e,t,r=1e-6){return isNaN(e)||isNaN(t)?!1:(e>t?e-t:t-e)<=r}function Cze(e){return xwe(Math.max(-CX,Math.min(e,CX)))}function xwe(e){return Fce[0]=e,Fce[0]}function D5(e,t,r){const i=Le((r-e)/(t-e),0,1);return i*i*(3-2*i)}function Nce(e,t){const r=Oe(e),i=Pp(e[2]/r),n=Math.atan2(e[1]/r,e[0]/r);return ne(t,r,i,n),t}function ZPt(e,t,r){return ei(e,t[0],t[1],t[2],t[3]*r)}function QPt(e){const t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],r=e[3]*e[3]+e[4]*e[4]+e[5]*e[5],i=e[6]*e[6]+e[7]*e[7]+e[8]*e[8];return!(W4(t,1)&&W4(r,1)&&W4(i,1))}const CX=xwe(34028234663852886e22);function MM(e){return Le(Mte(e),0,255)}function PM(e,t,r){return e=Number(e),isNaN(e)?r:e<t?t:e>r?r:e}class $s{constructor(t){this.r=255,this.g=255,this.b=255,this.a=1,t&&this.setColor(t)}static blendColors(t,r,i,n=new $s){return n.r=Math.round(t.r+(r.r-t.r)*i),n.g=Math.round(t.g+(r.g-t.g)*i),n.b=Math.round(t.b+(r.b-t.b)*i),n.a=t.a+(r.a-t.a)*i,n._sanitize()}static fromRgb(t,r){const i=t.toLowerCase().match(/^(rgba?|hsla?)\(([\s\.\-,%0-9]+)\)/);if(i){const n=i[2].split(/\s*,\s*/),s=i[1];if(s==="rgb"&&n.length===3||s==="rgba"&&n.length===4){const a=n[0];if(a.charAt(a.length-1)==="%"){const o=n.map(l=>2.56*parseFloat(l));return n.length===4&&(o[3]=parseFloat(n[3])),$s.fromArray(o,r)}return $s.fromArray(n.map(o=>parseFloat(o)),r)}if(s==="hsl"&&n.length===3||s==="hsla"&&n.length===4)return $s.fromArray(awe(parseFloat(n[0]),parseFloat(n[1])/100,parseFloat(n[2])/100,parseFloat(n[3])),r)}return null}static fromHex(t,r=new $s){if(t.length!==4&&t.length!==7||t[0]!=="#")return null;const i=t.length===4?4:8,n=(1<<i)-1;let s=Number("0x"+t.substr(1));return isNaN(s)?null:(["b","g","r"].forEach(a=>{const o=s&n;s>>=i,r[a]=i===4?17*o:o}),r.a=1,r)}static fromArray(t,r=new $s){return r._set(Number(t[0]),Number(t[1]),Number(t[2]),Number(t[3])),isNaN(r.a)&&(r.a=1),r._sanitize()}static fromString(t,r){const i=swe(t)?rre(t):null;return i&&$s.fromArray(i,r)||$s.fromRgb(t,r)||$s.fromHex(t,r)}static fromJSON(t){return t&&new $s([t[0],t[1],t[2],t[3]/255])}static toUnitRGB(t){return _(t)?[t.r/255,t.g/255,t.b/255]:null}static toUnitRGBA(t){return _(t)?[t.r/255,t.g/255,t.b/255,t.a!=null?t.a:1]:null}get isBright(){return .299*this.r+.587*this.g+.114*this.b>=127}setColor(t){var r,i,n,s;return typeof t=="string"?$s.fromString(t,this):Array.isArray(t)?$s.fromArray(t,this):(this._set((r=t.r)!=null?r:0,(i=t.g)!=null?i:0,(n=t.b)!=null?n:0,(s=t.a)!=null?s:1),t instanceof $s||this._sanitize()),this}toRgb(){return[this.r,this.g,this.b]}toRgba(){return[this.r,this.g,this.b,this.a]}toHex(){const t=this.r.toString(16),r=this.g.toString(16),i=this.b.toString(16);return`#${t.length<2?"0"+t:t}${r.length<2?"0"+r:r}${i.length<2?"0"+i:i}`}toCss(t=!1){const r=this.r+", "+this.g+", "+this.b;return t?`rgba(${r}, ${this.a})`:`rgb(${r})`}toString(){return this.toCss(!0)}toJSON(){return this.toArray()}toArray(t=$s.AlphaMode.ALWAYS){const r=MM(this.r),i=MM(this.g),n=MM(this.b);return t===$s.AlphaMode.ALWAYS||this.a!==1?[r,i,n,MM(255*this.a)]:[r,i,n]}clone(){return new $s(this.toRgba())}hash(){return this.r<<24|this.g<<16|this.b<<8|255*this.a}equals(t){return _(t)&&t.r===this.r&&t.g===this.g&&t.b===this.b&&t.a===this.a}_sanitize(){return this.r=Math.round(PM(this.r,0,255)),this.g=Math.round(PM(this.g,0,255)),this.b=Math.round(PM(this.b,0,255)),this.a=PM(this.a,0,1),this}_set(t,r,i,n){this.r=t,this.g=r,this.b=i,this.a=n}}$s.prototype.declaredClass="esri.Color",function(e){var t;(t=e.AlphaMode||(e.AlphaMode={}))[t.ALWAYS=0]="ALWAYS",t[t.UNLESS_OPAQUE=1]="UNLESS_OPAQUE"}($s||($s={}));const Te=$s;function JPt(e){}function Aze(e){return()=>e}function Ze(e,t={}){var n;const r=e instanceof tr?e:new tr(e,t),i={type:(n=t==null?void 0:t.ignoreUnknown)==null||n?r.apiValues:String,json:{type:r.jsonValues,read:!(t!=null&&t.readOnly)&&{reader:r.read},write:{writer:r.write}}};return(t==null?void 0:t.readOnly)!==void 0&&(i.readOnly=!!t.readOnly),(t==null?void 0:t.default)!==void 0&&(i.json.default=t.default),(t==null?void 0:t.name)!==void 0&&(i.json.name=t.name),f(i)}var AX;let q$=AX=class extends ge{constructor(e){super(e),this.type="none"}clone(){return new AX({type:this.type})}};d([Ze({none:"none",stayAbove:"stay-above"})],q$.prototype,"type",void 0),q$=AX=d([$("esri.ground.NavigationConstraint")],q$);function gV(e){const t=Mte(100*(1-e));return Math.max(0,Math.min(t,100))}function F5(e){const t=1-e/100;return Math.max(0,Math.min(t,1))}var RX;const kce=fe.getLogger("esri.Ground");let rg=RX=class extends Z9(hd){constructor(e){super(e),this.opacity=1,this.surfaceColor=null,this.navigationConstraint=null,this.layers=new lt;const t=i=>{i.parent&&i.parent!==this&&"remove"in i.parent&&i.parent.remove(i),i.parent=this,i.type!=="elevation"&&i.type!=="base-elevation"&&kce.error(`Layer '${i.title}, id:${i.id}' of type '${i.type}' is not supported as a ground layer and will therefore be ignored. Only layers of type 'elevation' are supported.`)},r=i=>{i.parent=null};this.layers.on("after-add",i=>t(i.item)),this.layers.on("after-remove",i=>r(i.item))}initialize(){this.when().catch(e=>{kce.error("#load()","Failed to load ground",e)}),this.resourceInfo&&this.read(this.resourceInfo.data,this.resourceInfo.context)}destroy(){const e=this.layers.removeAll();for(const t of e)t.destroy();this.layers.destroy()}normalizeCtorArgs(e){return e&&"resourceInfo"in e&&(this._set("resourceInfo",e.resourceInfo),delete(e={...e}).resourceInfo),e}set layers(e){this._set("layers",Rw(e,this._get("layers")))}writeLayers(e,t,r,i){const n=[];e&&(i={...i,layerContainerType:"ground"},e.forEach(s=>{if("write"in s){const a={};Aze(s)().write(a,i)&&n.push(a)}else i&&i.messages&&i.messages.push(new k("layer:unsupported",`Layers (${s.title}, ${s.id}) of type '${s.declaredClass}' cannot be persisted in the ground`,{layer:s}))})),t.layers=n}load(e){return this.addResolvingPromise(this._loadFromSource(e)),Promise.resolve(this)}loadAll(){return C3e(this,e=>{e(this.layers)})}async queryElevation(e,t){await this.load({signal:t==null?void 0:t.signal});const{ElevationQuery:r}=await ie(()=>import("./ElevationQuery.7a2199a3.js"),[],import.meta.url);Et(t);const i=new r,n=this.layers.filter(Vce).toArray();return i.queryAll(n,e,t)}async createElevationSampler(e,t){await this.load({signal:t==null?void 0:t.signal});const{ElevationQuery:r}=await ie(()=>import("./ElevationQuery.7a2199a3.js"),[],import.meta.url);Et(t);const i=new r,n=this.layers.filter(Vce).toArray();return i.createSamplerAll(n,e,t)}clone(){const e={opacity:this.opacity,surfaceColor:te(this.surfaceColor),navigationConstraint:te(this.navigationConstraint),layers:this.layers.slice()};return this.loaded&&(e.loadStatus="loaded"),new RX({resourceInfo:this.resourceInfo}).set(e)}read(e,t){this.resourceInfo||this._set("resourceInfo",{data:e,context:t}),super.read(e,t)}_loadFromSource(e){const t=this.resourceInfo;return t?this._loadLayersFromJSON(t.data,t.context,e):Promise.resolve(null)}_loadLayersFromJSON(e,t,r){const i=t&&t.origin||"web-scene",n=t&&t.portal||null,s=t&&t.url||null;return ie(()=>import("./layersCreator.62e74b60.js"),["layersCreator.62e74b60.js","lazyLayerLoader.5e7c3b38.js","portalLayers.6f0bd1c6.js","layersLoader.315a9bc7.js","jsonContext.b1feec67.js","portalItemUtils.59cab615.js"],import.meta.url).then(({populateOperationalLayers:a})=>{Et(r);const o=[];if(e.layers&&Array.isArray(e.layers)){const l={context:{origin:i,url:s,portal:n,layerContainerType:"ground"},defaultLayerType:"ArcGISTiledElevationServiceLayer"};o.push(a(this.layers,e.layers,l))}return dn(o)}).then(()=>{})}};function Rze(e){return e&&"createElevationSampler"in e}function Vce(e){return e.type==="elevation"||Rze(e)}d([f({json:{read:!1}})],rg.prototype,"layers",null),d([Xe("layers")],rg.prototype,"writeLayers",null),d([f({readOnly:!0})],rg.prototype,"resourceInfo",void 0),d([f({type:Number,nonNullable:!0,range:{min:0,max:1},json:{type:$i,read:{reader:F5,source:"transparency"},write:{writer:(e,t)=>{t.transparency=gV(e)},target:"transparency"}}})],rg.prototype,"opacity",void 0),d([f({type:Te,json:{type:[$i],write:(e,t)=>{t.surfaceColor=e.toJSON().slice(0,3)}}})],rg.prototype,"surfaceColor",void 0),d([f({type:q$,json:{write:!0}})],rg.prototype,"navigationConstraint",void 0),rg=RX=d([$("esri.Ground")],rg);const kF=rg;let H$=class extends xe{constructor(e){super(e),this._groups=new Map}destroy(){this.removeAll()}get size(){let e=0;return this._groups.forEach(t=>{e+=t.length}),e}add(e,t){if(!this._isHandle(e)&&!Array.isArray(e)&&!lt.isCollection(e))return this;const r=this._getOrCreateGroup(t);return Array.isArray(e)||lt.isCollection(e)?e.forEach(i=>this._isHandle(i)&&r.push(i)):r.push(e),this.notifyChange("size"),this}forEach(e,t){if(typeof e=="function")this._groups.forEach(r=>r.forEach(e));else{const r=this._getGroup(e);r&&t&&r.forEach(t)}}has(e){return this._groups.has(this._ensureGroupKey(e))}remove(e){if(Array.isArray(e)||lt.isCollection(e))return e.forEach(this.remove,this),this;if(!this.has(e))return this;const t=this._getGroup(e);for(let r=0;r<t.length;r++)t[r].remove();return this._deleteGroup(e),this.notifyChange("size"),this}removeAll(){return this._groups.forEach(e=>{for(let t=0;t<e.length;t++)e[t].remove()}),this._groups.clear(),this.notifyChange("size"),this}_isHandle(e){return e&&!!e.remove}_getOrCreateGroup(e){if(this.has(e))return this._getGroup(e);const t=[];return this._groups.set(this._ensureGroupKey(e),t),t}_getGroup(e){return this._groups.get(this._ensureGroupKey(e))}_deleteGroup(e){return this._groups.delete(this._ensureGroupKey(e))}_ensureGroupKey(e){return e||"_default_"}};d([f({readOnly:!0})],H$.prototype,"size",null),H$=d([$("esri.core.Handles")],H$);const Ft=H$;function re(e,t,r={}){return ure(e,t,r,Twe)}function Fa(e,t,r={}){return ure(e,t,r,Swe)}function ure(e,t,r={},i){let n=null;const s=r.once?(a,o)=>{i(a)&&(Ts(n),t(a,o))}:(a,o)=>{i(a)&&t(a,o)};if(n=YFe(e,s,r.sync,r.equals),r.initial){const a=e();s(a,a)}return n}function rn(e,t,r,i={}){let n=null,s=null,a=null;function o(){var u;n&&s&&(s.remove(),(u=i.onListenerRemove)==null||u.call(i,n),n=null,s=null)}function l(u){i.once&&i.once&&Ts(a),r(u)}const c=re(e,(u,h)=>{var p;o(),aV(u)&&(n=u,s=jR(u,t,l),(p=i.onListenerAdd)==null||p.call(i,u))},{sync:i.sync,initial:!0});return a=Hh(()=>{c.remove(),o()}),a}function td(e,t){return Oze(e,Swe,t)}function Oze(e,t,r){if(bs(r))return Promise.reject(br());const i=e();if(t!=null&&t(i))return Promise.resolve(i);let n=null;function s(){n=Ts(n)}return new Promise((a,o)=>{n=A5([Fo(r,()=>{s(),o(br())}),ure(e,l=>{s(),a(l)},{sync:!1,once:!0},t!=null?t:Twe)])})}function Twe(e){return!0}function Swe(e){return!!e}function Mze(e,t,r={}){let i=!1;const n=re(e,(s,a)=>{i||t(s,a)},r);return{remove(){n.remove()},pause(){i=!0},resume(){i=!1}}}const ti={sync:!0},Ot={initial:!0},Yn={sync:!0,initial:!0};let tm=class extends xe{constructor(){super(...arguments),this.updating=!1,this.handleId=0,this.handles=new Ft,this.scheduleHandleId=0,this.pendingPromises=new Set}destroy(){this.removeAll(),this.handles.destroy()}add(e,t,r={}){return this._installWatch(e,t,r,re)}addWhen(e,t,r={}){return this._installWatch(e,t,r,Fa)}addOnCollectionChange(e,t,{initial:r=!1,final:i=!1}={}){const n=++this.handleId;return this.handles.add([rn(e,"after-changes",this._createSyncUpdatingCallback(),ti),rn(e,"change",t,{onListenerAdd:r?s=>t({added:s.toArray(),removed:[]}):void 0,onListenerRemove:i?s=>t({added:[],removed:s.toArray()}):void 0})],n),{remove:()=>this.handles.remove(n)}}addPromise(e){if(R(e))return e;const t=++this.handleId;this.handles.add({remove:()=>{this.pendingPromises.delete(e)&&(this.pendingPromises.size!==0||this.handles.has(IM)||this._set("updating",!1))}},t),this.pendingPromises.add(e),this._set("updating",!0);const r=()=>this.handles.remove(t);return e.then(r,r),e}removeAll(){this.pendingPromises.clear(),this.handles.removeAll(),this._set("updating",!1)}_installWatch(e,t,r={},i){const n=++this.handleId;r.sync||this._installSyncUpdatingWatch(e,n);const s=i(e,t,r);return this.handles.add(s,n),{remove:()=>this.handles.remove(n)}}_installSyncUpdatingWatch(e,t){const r=this._createSyncUpdatingCallback(),i=re(e,r,{sync:!0,equals:()=>!1});return this.handles.add(i,t),i}_createSyncUpdatingCallback(){return()=>{this.handles.remove(IM),++this.scheduleHandleId;const e=this.scheduleHandleId;this._get("updating")||this._set("updating",!0),this.handles.add(X9(()=>{e===this.scheduleHandleId&&(this._set("updating",this.pendingPromises.size>0),this.handles.remove(IM))}),IM)}}};d([f({readOnly:!0})],tm.prototype,"updating",void 0),tm=d([$("esri.core.support.WatchUpdatingTracking")],tm);const IM=-42;var zce;(function(e){e[e.NONE=0]="NONE",e[e.SYNC=1]="SYNC",e[e.INIT=2]="INIT"})(zce||(zce={}));const Cm=e=>{let t=class extends e{destroy(){var r,i;this.destroyed||((r=this._get("handles"))==null||r.destroy(),(i=this._get("updatingHandles"))==null||i.destroy())}get handles(){return this._get("handles")||new Ft}get updatingHandles(){return this._get("updatingHandles")||new tm}};return d([f({readOnly:!0})],t.prototype,"handles",null),d([f({readOnly:!0})],t.prototype,"updatingHandles",null),t=d([$("esri.core.HandleOwner")],t),t};let N5=class extends Cm(xe){};N5=d([$("esri.core.HandleOwner")],N5);let JT=class extends Cm(lt){constructor(e){super(e),this.getCollections=null}initialize(){this.handles.add(K2e(()=>this._refresh()))}destroy(){this.getCollections=null}_refresh(){const e=_(this.getCollections)?this.getCollections():null;if(R(e))return void this.removeAll();let t=0;for(const r of e)_(r)&&(t=this._processCollection(t,r));this.splice(t,this.length)}_createNewInstance(e){return new lt(e)}_processCollection(e,t){if(!t)return e;const r=this.itemFilterFunction?this.itemFilterFunction:i=>!!i;for(const i of t)if(i){if(r(i)){const n=this.indexOf(i,e);n>=0?n!==e&&this.reorder(i,e):this.add(i,e),++e}if(this.getChildrenFunction){const n=this.getChildrenFunction(i);if(Array.isArray(n))for(const s of n)e=this._processCollection(e,s);else e=this._processCollection(e,n)}}return e}};d([f()],JT.prototype,"getCollections",void 0),d([f()],JT.prototype,"getChildrenFunction",void 0),d([f()],JT.prototype,"itemFilterFunction",void 0),JT=d([$("esri.core.CollectionFlattener")],JT);const k5=JT;function Pze(e){var t;return!!(e&&e.loaded&&"capabilities"in e&&((t=e==null?void 0:e.capabilities)==null?void 0:t.operations)&&"supportsEditing"in e.capabilities.operations&&e.capabilities.operations.supportsEditing===!0)&&!("editingEnabled"in e&&!e.editingEnabled)}const Uce=fe.getLogger("esri.support.basemapUtils");function Ize(){return{}}function $ze(e){for(const t in e){const r=e[t];(r==null?void 0:r.destroyed)===!1&&r.destroy(),delete e[t]}}function Lze(e,t){let r;if(typeof e=="string"){if(!(e in oA)){const i=Object.entries(oA).filter(([n,s])=>Vr.apiKey&&!s.classic||!Vr.apiKey&&s.classic&&!s.deprecated).map(([n])=>`"${n}"`).join(", ");return Uce.warn(`Unable to find basemap definition for: ${e}. Try one of these: ${i}`),null}t&&(r=t[e]),r||(r=dp.fromId(e),t&&(t[e]=r))}else r=rs(dp,e);return r!=null&&r.destroyed&&(Uce.warn("The provided basemap is already destroyed",{basemap:r}),r=null),r}function Dze(e){let t=null;const r=OX(e),i=!r.baseLayers.length;for(const n in oA){const s=Cwe(r,Ewe(oA[n]),{mustMatchReferences:i});if(s==="equal"){t=n;break}s==="base-layers-equal"&&(t=n)}return t}function Fze(e,t){return e===t?!0:Cwe(OX(e),OX(t),{mustMatchReferences:!0})==="equal"}function Nze(e,t){var n,s,a;if(R(t)||R(e))return{spatialReference:null,updating:!1};if(t.loadStatus==="not-loaded")return t.load(),{spatialReference:null,updating:!0};if(t.spatialReference)return{spatialReference:t.spatialReference,updating:!1};if(t.baseLayers.length===0)return{spatialReference:null,updating:!1};const r=t.baseLayers.getItemAt(0);switch(r.loadStatus){case"not-loaded":r.load();case"loading":return{spatialReference:null,updating:!0};case"failed":return{spatialReference:null,updating:!1}}const i=(("supportedSpatialReferences"in r?r.supportedSpatialReferences:null)||["tileInfo"in r?(n=r.tileInfo)==null?void 0:n.spatialReference:r.spatialReference]).filter(Boolean);return e.spatialReference?{spatialReference:(a=(s=i.find(o=>e.spatialReference.equals(o)))!=null?s:i[0])!=null?a:null,updating:!1}:{spatialReference:i[0],updating:!1}}function OX(e){return e?!e.loaded&&e.resourceInfo?Ewe(e.resourceInfo.data):{baseLayers:Bce(e.baseLayers),referenceLayers:Bce(e.referenceLayers)}:null}function Bce(e){return(lt.isCollection(e)?e.toArray():e).map(kze)}function kze(e){var t,r;return{type:e.type,url:Awe("urlTemplate"in e&&e.urlTemplate||e.url||"styleUrl"in e&&e.styleUrl),minScale:"minScale"in e&&e.minScale!=null?e.minScale:0,maxScale:"maxScale"in e&&e.maxScale!=null?e.maxScale:0,opacity:e.opacity!=null?e.opacity:1,visible:e.visible==null||!!e.visible,sublayers:e.type!=="map-image"&&e.type!=="wms"||!_(e.sublayers)||(t=e.sublayers)==null?void 0:t.map(i=>({id:i.id,visible:i.visible})),activeLayerId:e.type==="wmts"?(r=e.activeLayer)==null?void 0:r.id:void 0}}function Ewe(e){return e?{baseLayers:Gce(e.baseMapLayers.filter(t=>!t.isReference)),referenceLayers:Gce(e.baseMapLayers.filter(t=>t.isReference))}:null}function Gce(e){return e.map(t=>Vze(t))}function Vze(e){let t;switch(e.layerType){case"VectorTileLayer":t="vector-tile";break;case"ArcGISTiledMapServiceLayer":t="tile";break;default:t="unknown"}return{type:t,url:Awe(e.templateUrl||e.urlTemplate||e.styleUrl||e.url),minScale:e.minScale!=null?e.minScale:0,maxScale:e.maxScale!=null?e.maxScale:0,opacity:e.opacity!=null?e.opacity:1,visible:e.visibility==null||!!e.visibility,sublayers:void 0,activeLayerId:void 0}}function Cwe(e,t,r){return e!=null!=(t!=null)?"not-equal":e?jce(e.baseLayers,t.baseLayers)?jce(e.referenceLayers,t.referenceLayers)?"equal":r.mustMatchReferences?"not-equal":"base-layers-equal":"not-equal":"equal"}function jce(e,t){if(e.length!==t.length)return!1;for(let r=0;r<e.length;r++)if(!zze(e[r],t[r]))return!1;return!0}function zze(e,t){if(e.type!==t.type||e.url!==t.url||e.minScale!==t.minScale||e.maxScale!==t.maxScale||e.visible!==t.visible||e.opacity!==t.opacity)return!1;if(_(e.activeLayerId)||_(t.activeLayerId))return e.activeLayerId===t.activeLayerId;if(_(e.sublayers)||_(t.sublayers)){if(R(e.sublayers)||R(t.sublayers)||e.sublayers.length!==t.sublayers.length)return!1;for(let r=0;r<e.sublayers.length;r++){const i=e.sublayers.at(r),n=t.sublayers.at(r);if(i.id!==n.id||i.visible!==n.visible)return!1}}return!0}function Awe(e){return e?zh(e).replace(/^\s*https?:/i,"").toLowerCase():""}function Uze(e){return new k5({getCollections:()=>[e.tables,e.layers],getChildrenFunction:t=>{const r=[];return"tables"in t&&r.push(t.tables),"layers"in t&&r.push(t.layers),r},itemFilterFunction:t=>{const r=t.parent;return r&&"tables"in r&&r.tables.includes(t)}})}const Bze=fe.getLogger("esri.support.groundUtils"),qce={"world-elevation":{id:"worldElevation",url:"//elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/Terrain3D/ImageServer",layerType:"ArcGISTiledElevationServiceLayer"},"world-topobathymetry":{id:"worldTopoBathymetry",url:"//elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/TopoBathy3D/ImageServer",layerType:"ArcGISTiledElevationServiceLayer"}};function Gze(e){let t=null;if(typeof e=="string")if(e in qce){const r=qce[e];t=new kF({resourceInfo:{data:{layers:[r]}}})}else Bze.warn(`Unable to find ground definition for: ${e}. Try "world-elevation"`);else t=rs(kF,e);return t}function V5(e,t,r=!1){let{hasM:i,hasZ:n}=e;Array.isArray(t)?t.length!==4||i||n?t.length===3&&r&&!i?(n=!0,i=!1):t.length===3&&i&&n&&(i=!1,n=!1):(i=!0,n=!0):(n=!n&&t.hasZ&&(!i||t.hasM),i=!i&&t.hasM&&(!n||t.hasZ)),e.hasZ=n,e.hasM=i}var MX;function Hce(e){return(t,r)=>t==null?r:r==null?t:e(t,r)}function jze(e){return e&&(e.declaredClass==="esri.geometry.SpatialReference"||e.wkid!=null)}let qb=MX=class extends fd{constructor(...e){super(...e),this.points=[],this.type="multipoint"}normalizeCtorArgs(e,t){if(!e&&!t)return null;const r={};Array.isArray(e)?(r.points=e,r.spatialReference=t):jze(e)?r.spatialReference=e:(e.points&&(r.points=e.points),e.spatialReference&&(r.spatialReference=e.spatialReference),e.hasZ&&(r.hasZ=e.hasZ),e.hasM&&(r.hasM=e.hasM));const i=r.points&&r.points[0];return i&&(r.hasZ===void 0&&r.hasM===void 0?(r.hasZ=i.length>2,r.hasM=!1):r.hasZ===void 0?r.hasZ=i.length>3:r.hasM===void 0&&(r.hasM=i.length>3)),r}get cache(){return this.commitProperty("points"),this.commitProperty("hasZ"),this.commitProperty("hasM"),this.commitProperty("spatialReference"),{}}get extent(){const e=this.points;if(!e.length)return null;const t=new Zt,r=this.hasZ,i=this.hasM,n=r?3:2,s=e[0],a=Hce(Math.min),o=Hce(Math.max);let l,c,u,h,[p,m]=s,[g,b]=s;for(let w=0,v=e.length;w<v;w++){const x=e[w],[T,E]=x;if(p=a(p,T),m=a(m,E),g=o(g,T),b=o(b,E),r&&x.length>2){const C=x[2];l=a(l,C),u=o(u,C)}if(i&&x.length>n){const C=x[n];c=a(c,C),h=o(h,C)}}return t.xmin=p,t.ymin=m,t.xmax=g,t.ymax=b,t.spatialReference=this.spatialReference,r?(t.zmin=l,t.zmax=u):(t.zmin=null,t.zmax=null),i?(t.mmin=c,t.mmax=h):(t.mmin=null,t.mmax=null),t}writePoints(e,t){t.points=te(this.points)}addPoint(e){return V5(this,e),Array.isArray(e)?this.points.push(e):this.points.push(e.toArray()),this.notifyChange("points"),this}clone(){const e={points:te(this.points),spatialReference:this.spatialReference};return this.hasZ&&(e.hasZ=!0),this.hasM&&(e.hasM=!0),new MX(e)}getPoint(e){if(!this._validateInputs(e))return null;const t=this.points[e],r={x:t[0],y:t[1],spatialReference:this.spatialReference};let i=2;return this.hasZ&&(r.z=t[2],i=3),this.hasM&&(r.m=t[i]),new ot(r)}removePoint(e){if(!this._validateInputs(e))return null;const t=new ot(this.points.splice(e,1)[0],this.spatialReference);return this.notifyChange("points"),t}setPoint(e,t){return this._validateInputs(e)?(V5(this,t),Array.isArray(t)||(t=t.toArray()),this.points[e]=t,this.notifyChange("points"),this):this}toJSON(e){return this.write({},e)}_validateInputs(e){return e!=null&&e>=0&&e<this.points.length}};d([f({readOnly:!0})],qb.prototype,"cache",null),d([f()],qb.prototype,"extent",null),d([f({type:[[Number]],json:{write:{isRequired:!0}}})],qb.prototype,"points",void 0),d([Xe("points")],qb.prototype,"writePoints",null),qb=MX=d([$("esri.geometry.Multipoint")],qb),qb.prototype.toJSON.isDefaultToJSON=!0;const gx=qb;function yV(e,t){const r=t[0]-e[0],i=t[1]-e[1];if(e.length>2&&t.length>2){const n=e[2]-t[2];return Math.sqrt(r*r+i*i+n*n)}return Math.sqrt(r*r+i*i)}function Rwe(e,t,r){const i=e[0]+r*(t[0]-e[0]),n=e[1]+r*(t[1]-e[1]);return e.length>2&&t.length>2?[i,n,e[2]+r*(t[2]-e[2])]:[i,n]}function qze(e,t){return Rwe(e,t,.5)}function hre(e){const t=e.length;let r=0;for(let i=0;i<t-1;++i)r+=yV(e[i],e[i+1]);return r}function Owe(e,t){if(t<=0)return e[0];const r=e.length;let i=0;for(let n=0;n<r-1;++n){const s=yV(e[n],e[n+1]);if(t-i<s){const a=(t-i)/s;return Rwe(e[n],e[n+1],a)}i+=s}return e[r-1]}function fre(e,t,r){const i=e.length;let n=0,s=0,a=0;for(let o=0;o<i;o++){const l=e[o],c=e[(o+1)%i];let u=2;n+=l[0]*c[1]-c[0]*l[1],l.length>2&&c.length>2&&r&&(s+=l[0]*c[2]-c[0]*l[2],u=3),l.length>u&&c.length>u&&t&&(a+=l[0]*c[u]-c[0]*l[u])}return n<=0&&s<=0&&a<=0}function KPt(e){if("rings"in e)for(const t of e.rings)t.length<3||t[0][0]===t[t.length-1][0]&&t[0][1]===t[t.length-1][1]||t.push([t[0][0],t[0][1]])}function eIt(e){return e?e.hasZ?[e.xmax-e.xmin/2,e.ymax-e.ymin/2,e.zmax-e.zmin/2]:[e.xmax-e.xmin/2,e.ymax-e.ymin/2]:null}function Hze(e){return e?Mwe(e.rings,e.hasZ):null}function Mwe(e,t){if(!e||!e.length)return null;const r=[],i=[],n=t?[1/0,-1/0,1/0,-1/0,1/0,-1/0]:[1/0,-1/0,1/0,-1/0];for(let s=0,a=e.length;s<a;s++){const o=Wze(e[s],t,n);o&&i.push(o)}if(i.sort((s,a)=>{let o=s[2]-a[2];return o===0&&t&&(o=s[4]-a[4]),o}),i.length&&(r[0]=i[0][0],r[1]=i[0][1],t&&(r[2]=i[0][3]),(r[0]<n[0]||r[0]>n[1]||r[1]<n[2]||r[1]>n[3]||t&&(r[2]<n[4]||r[2]>n[5]))&&(r.length=0)),!r.length){const s=e[0]&&e[0].length?Xze(e[0],t):null;if(!s)return null;r[0]=s[0],r[1]=s[1],t&&s.length>2&&(r[2]=s[2])}return r}function Wze(e,t,r){let i=0,n=0,s=0,a=0,o=0;const l=e.length?e[0][0]:0,c=e.length?e[0][1]:0,u=e.length&&t?e[0][2]:0;for(let p=0;p<e.length;p++){const m=e[p],g=e[(p+1)%e.length],[b,w,v]=m,x=b-l,T=w-c,E=t?v-u:void 0,[C,A,P]=g,I=C-l,L=A-c,V=t?P-u:void 0,G=x*L-I*T;if(a+=G,i+=(x+I)*G,n+=(T+L)*G,t&&m.length>2&&g.length>2){const B=x*V-I*E;s+=(E+V)*B,o+=B}b<r[0]&&(r[0]=b),b>r[1]&&(r[1]=b),w<r[2]&&(r[2]=w),w>r[3]&&(r[3]=w),t&&(v<r[4]&&(r[4]=v),v>r[5]&&(r[5]=v))}if(a>0&&(a*=-1),o>0&&(o*=-1),!a)return null;a*=.5,o*=.5;const h=[i/(6*a)+l,n/(6*a)+c,a];return t&&(r[4]===r[5]||o===0?(h[3]=(r[4]+r[5])/2,h[4]=0):(h[3]=s/(6*o)+u,h[4]=o)),h}function Xze(e,t){const r=t?[0,0,0]:[0,0],i=t?[0,0,0]:[0,0];let n=0,s=0,a=0,o=0;for(let l=0,c=e.length;l<c-1;l++){const u=e[l],h=e[l+1];if(u&&h){r[0]=u[0],r[1]=u[1],i[0]=h[0],i[1]=h[1],t&&u.length>2&&h.length>2&&(r[2]=u[2],i[2]=h[2]);const p=yV(r,i);if(p){n+=p;const m=qze(u,h);s+=p*m[0],a+=p*m[1],t&&m.length>2&&(o+=p*m[2])}}}return n>0?t?[s/n,a/n,o/n]:[s/n,a/n]:e.length?e[0]:null}function Pwe(e){return e.xmin!==void 0&&e.ymin!==void 0&&e.xmax!==void 0&&e.ymax!==void 0}function Iwe(e){return e.points!==void 0}function $we(e){return e.x!==void 0&&e.y!==void 0}function Lwe(e){return e.paths!==void 0}function Dwe(e){return e.rings!==void 0}function Fwe(e){return(t,r)=>t==null?r:r==null?t:e(t,r)}const rv=Fwe(Math.min),iv=Fwe(Math.max);function tIt(e,t){return Lwe(t)?z5(e,t.paths,!1,!1):Dwe(t)?z5(e,t.rings,!1,!1):Iwe(t)?pre(e,t.points,!1,!1,!1,!1):Pwe(t)?Nwe(e,t):($we(t)&&(e[0]=t.x,e[1]=t.y,e[2]=t.x,e[3]=t.y),e)}function rIt(e,t){return Lwe(t)?z5(e,t.paths,!0,!1):Dwe(t)?z5(e,t.rings,!0,!1):Iwe(t)?pre(e,t.points,!0,!1,!0,!1):Pwe(t)?Nwe(e,t,!0,!1,!0,!1):($we(t)&&(e[0]=t.x,e[1]=t.y,e[2]=t.z,e[3]=t.x,e[4]=t.y,e[5]=t.z),e)}function z5(e,t,r,i){const n=r?3:2;if(!t.length||!t[0].length)return null;let s,a,o,l,[c,u]=t[0][0],[h,p]=t[0][0];for(let m=0;m<t.length;m++){const g=t[m];for(let b=0;b<g.length;b++){const w=g[b],[v,x]=w;if(c=rv(c,v),u=rv(u,x),h=iv(h,v),p=iv(p,x),r&&w.length>2){const T=w[2];s=rv(s,T),a=iv(a,T)}if(i&&w.length>n){const T=w[n];o=rv(s,T),l=iv(a,T)}}}return r?i?(e[0]=c,e[1]=u,e[2]=s,e[3]=o,e[4]=h,e[5]=p,e[6]=a,e[7]=l,e.length=8,e):(e[0]=c,e[1]=u,e[2]=s,e[3]=h,e[4]=p,e[5]=a,e.length=6,e):i?(e[0]=c,e[1]=u,e[2]=o,e[3]=h,e[4]=p,e[5]=l,e.length=6,e):(e[0]=c,e[1]=u,e[2]=h,e[3]=p,e.length=4,e)}function Nwe(e,t,r,i,n,s){const a=t.xmin,o=t.xmax,l=t.ymin,c=t.ymax;let u=t.zmin,h=t.zmax,p=t.mmin,m=t.mmax;return n?(u=u||0,h=h||0,s?(p=p||0,m=m||0,e[0]=a,e[1]=l,e[2]=u,e[3]=p,e[4]=o,e[5]=c,e[6]=h,e[7]=m,e):(e[0]=a,e[1]=l,e[2]=u,e[3]=o,e[4]=c,e[5]=h,e)):s?(p=p||0,m=m||0,e[0]=a,e[1]=l,e[2]=p,e[3]=o,e[4]=c,e[5]=m,e):(e[0]=a,e[1]=l,e[2]=o,e[3]=c,e)}function pre(e,t,r,i,n,s){const a=r?3:2,o=i&&s,l=r&&n;if(!t.length||!t[0].length)return null;let c,u,h,p,[m,g]=t[0],[b,w]=t[0];for(let v=0;v<t.length;v++){const x=t[v],[T,E]=x;if(m=rv(m,T),g=rv(g,E),b=iv(b,T),w=iv(w,E),l&&x.length>2){const C=x[2];c=rv(c,C),u=iv(u,C)}if(o&&x.length>a){const C=x[a];h=rv(c,C),p=iv(u,C)}}return n?(c=c||0,u=u||0,s?(h=h||0,p=p||0,e[0]=m,e[1]=g,e[2]=c,e[3]=h,e[4]=b,e[5]=w,e[6]=u,e[7]=p,e):(e[0]=m,e[1]=g,e[2]=c,e[3]=b,e[4]=w,e[5]=u,e)):s?(h=h||0,p=p||0,e[0]=m,e[1]=g,e[2]=h,e[3]=b,e[4]=w,e[5]=p,e):(e[0]=m,e[1]=g,e[2]=b,e[3]=w,e)}function Yze(e){return e.xmin!==void 0&&e.ymin!==void 0&&e.xmax!==void 0&&e.ymax!==void 0}function Zze(e){return e.points!==void 0}function Qze(e){return e.x!==void 0&&e.y!==void 0}function Jze(e){return e.paths!==void 0}function Kze(e){return e.rings!==void 0}const mre=[];function kwe(e,t,r,i){return{xmin:e,ymin:t,xmax:r,ymax:i}}function Vwe(e,t,r,i,n,s){return{xmin:e,ymin:t,zmin:r,xmax:i,ymax:n,zmax:s}}function zwe(e,t,r,i,n,s){return{xmin:e,ymin:t,mmin:r,xmax:i,ymax:n,mmax:s}}function Uwe(e,t,r,i,n,s,a,o){return{xmin:e,ymin:t,zmin:r,mmin:i,xmax:n,ymax:s,zmax:a,mmax:o}}function gre(e,t=!1,r=!1){return t?r?Uwe(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7]):Vwe(e[0],e[1],e[2],e[3],e[4],e[5]):r?zwe(e[0],e[1],e[2],e[3],e[4],e[5]):kwe(e[0],e[1],e[2],e[3])}function iIt(e){return e?Yze(e)?e:Qze(e)?tUe(e):Kze(e)?Bwe(e):Jze(e)?Gwe(e):Zze(e)?eUe(e):null:null}function eUe(e){const{hasZ:t,hasM:r,points:i}=e;return gre(pre(mre,i,t,r),t,r)}function tUe(e){const{x:t,y:r,z:i,m:n}=e,s=n!=null;return i!=null?s?Uwe(t,r,i,n,t,r,i,n):Vwe(t,r,i,t,r,i):s?zwe(t,r,n,t,r,n):kwe(t,r,t,r)}function Bwe(e){const{hasZ:t,hasM:r,rings:i}=e,n=z5(mre,i,t,r);return n?gre(n,t,r):null}function Gwe(e){const{hasZ:t,hasM:r,paths:i}=e,n=z5(mre,i,t,r);return n?gre(n,t,r):null}var W$;function Wce(e){return!Array.isArray(e[0])}let c0=W$=class extends fd{constructor(...e){super(...e),this.rings=[],this.type="polygon"}static fromExtent(e){const t=e.clone().normalize(),r=e.spatialReference;let i=!1,n=!1;for(const a of t)a.hasZ&&(i=!0),a.hasM&&(n=!0);const s={rings:t.map(a=>{const o=[[a.xmin,a.ymin],[a.xmin,a.ymax],[a.xmax,a.ymax],[a.xmax,a.ymin],[a.xmin,a.ymin]];if(i&&a.hasZ){const l=a.zmin+.5*(a.zmax-a.zmin);for(let c=0;c<o.length;c++)o[c].push(l)}if(n&&a.hasM){const l=a.mmin+.5*(a.mmax-a.mmin);for(let c=0;c<o.length;c++)o[c].push(l)}return o}),spatialReference:r};return i&&(s.hasZ=!0),n&&(s.hasM=!0),new W$(s)}normalizeCtorArgs(e,t){let r,i,n=null,s=null;return e&&!Array.isArray(e)?(n=e.rings?e.rings:null,t||(e.spatialReference?t=e.spatialReference:e.rings||(t=e)),r=e.hasZ,i=e.hasM):n=e,n=n||[],t=t||Ye.WGS84,n.length&&n[0]&&n[0][0]!=null&&typeof n[0][0]=="number"&&(n=[n]),s=n[0]&&n[0][0],s&&(r===void 0&&i===void 0?(r=s.length>2,i=s.length>3):r===void 0?r=i?s.length>3:s.length>2:i===void 0&&(i=r?s.length>3:s.length>2)),{rings:n,spatialReference:t,hasZ:r,hasM:i}}get cache(){return this.commitProperty("rings"),this.commitProperty("hasZ"),this.commitProperty("hasM"),this.commitProperty("spatialReference"),{}}get centroid(){const e=Hze(this);if(!e||isNaN(e[0])||isNaN(e[1])||this.hasZ&&isNaN(e[2]))return null;const t=new ot;return t.x=e[0],t.y=e[1],t.spatialReference=this.spatialReference,this.hasZ&&(t.z=e[2]),t}get extent(){const{spatialReference:e}=this,t=Bwe(this);if(!t)return null;const r=new Zt(t);return r.spatialReference=e,r}get isSelfIntersecting(){return dVe(this.rings)}writeRings(e,t){t.rings=te(this.rings)}addRing(e){if(!e)return;const t=this.rings,r=t.length;if(Wce(e)){const i=[];for(let n=0,s=e.length;n<s;n++)i[n]=e[n].toArray();t[r]=i}else t[r]=e.concat();return this.notifyChange("rings"),this}clone(){const e=new W$;return e.spatialReference=this.spatialReference,e.rings=te(this.rings),e.hasZ=this.hasZ,e.hasM=this.hasM,e}equals(e){if(this===e)return!0;if(R(e))return!1;const t=this.spatialReference,r=e.spatialReference;if(_(t)!==_(r)||_(t)&&_(r)&&!t.equals(r)||this.rings.length!==e.rings.length)return!1;const i=([n,s,a,o],[l,c,u,h])=>n===l&&s===c&&(a==null&&u==null||a===u)&&(o==null&&h==null||o===h);for(let n=0;n<this.rings.length;n++){const s=this.rings[n],a=e.rings[n];if(!Gv(s,a,i))return!1}return!0}contains(e){if(!e)return!1;const t=mx(e,this.spatialReference);return eVe(this,_(t)?t:e)}isClockwise(e){let t;return t=Wce(e)?e.map(r=>this.hasZ?this.hasM?[r.x,r.y,r.z,r.m]:[r.x,r.y,r.z]:[r.x,r.y]):e,fre(t,this.hasM,this.hasZ)}getPoint(e,t){if(!this._validateInputs(e,t))return null;const r=this.rings[e][t],i=this.hasZ,n=this.hasM;return i&&!n?new ot(r[0],r[1],r[2],void 0,this.spatialReference):n&&!i?new ot(r[0],r[1],void 0,r[2],this.spatialReference):i&&n?new ot(r[0],r[1],r[2],r[3],this.spatialReference):new ot(r[0],r[1],this.spatialReference)}insertPoint(e,t,r){return this._validateInputs(e,t,!0)?(V5(this,r),Array.isArray(r)||(r=r.toArray()),this.rings[e].splice(t,0,r),this.notifyChange("rings"),this):this}removePoint(e,t){if(!this._validateInputs(e,t))return null;const r=new ot(this.rings[e].splice(t,1)[0],this.spatialReference);return this.notifyChange("rings"),r}removeRing(e){if(!this._validateInputs(e,null))return null;const t=this.rings.splice(e,1)[0],r=this.spatialReference,i=t.map(n=>new ot(n,r));return this.notifyChange("rings"),i}setPoint(e,t,r){return this._validateInputs(e,t)?(V5(this,r),Array.isArray(r)||(r=r.toArray()),this.rings[e][t]=r,this.notifyChange("rings"),this):this}_validateInputs(e,t,r=!1){if(e==null||e<0||e>=this.rings.length)return!1;if(t!=null){const i=this.rings[e];if(r&&(t<0||t>i.length)||!r&&(t<0||t>=i.length))return!1}return!0}toJSON(e){return this.write({},e)}};d([f({readOnly:!0})],c0.prototype,"cache",null),d([f({readOnly:!0})],c0.prototype,"centroid",null),d([f({readOnly:!0})],c0.prototype,"extent",null),d([f({readOnly:!0})],c0.prototype,"isSelfIntersecting",null),d([f({type:[[[Number]]],json:{write:{isRequired:!0}}})],c0.prototype,"rings",void 0),d([Xe("rings")],c0.prototype,"writeRings",null),c0=W$=d([$("esri.geometry.Polygon")],c0),c0.prototype.toJSON.isDefaultToJSON=!0;const $o=c0;var PX;function rUe(e){return!Array.isArray(e[0])}let Hb=PX=class extends fd{constructor(...e){super(...e),this.paths=[],this.type="polyline"}normalizeCtorArgs(e,t){let r,i,n=null,s=null;return e&&!Array.isArray(e)?(n=e.paths?e.paths:null,t||(e.spatialReference?t=e.spatialReference:e.paths||(t=e)),r=e.hasZ,i=e.hasM):n=e,n=n||[],t=t||Ye.WGS84,n.length&&n[0]&&n[0][0]!=null&&typeof n[0][0]=="number"&&(n=[n]),s=n[0]&&n[0][0],s&&(r===void 0&&i===void 0?(r=s.length>2,i=!1):r===void 0?r=!i&&s.length>3:i===void 0&&(i=!r&&s.length>3)),{paths:n,spatialReference:t,hasZ:r,hasM:i}}get cache(){return this.commitProperty("paths"),this.commitProperty("hasZ"),this.commitProperty("hasM"),this.commitProperty("spatialReference"),{}}get extent(){const{spatialReference:e}=this,t=Gwe(this);if(!t)return null;const r=new Zt(t);return r.spatialReference=e,r}writePaths(e,t){t.paths=te(this.paths)}addPath(e){if(!e)return;const t=this.paths,r=t.length;if(rUe(e)){const i=[];for(let n=0,s=e.length;n<s;n++)i[n]=e[n].toArray();t[r]=i}else t[r]=e.concat();return this.notifyChange("paths"),this}clone(){const e=new PX;return e.spatialReference=this.spatialReference,e.paths=te(this.paths),e.hasZ=this.hasZ,e.hasM=this.hasM,e}getPoint(e,t){if(!this._validateInputs(e,t))return null;const r=this.paths[e][t],i=this.hasZ,n=this.hasM;return i&&!n?new ot(r[0],r[1],r[2],void 0,this.spatialReference):n&&!i?new ot(r[0],r[1],void 0,r[2],this.spatialReference):i&&n?new ot(r[0],r[1],r[2],r[3],this.spatialReference):new ot(r[0],r[1],this.spatialReference)}insertPoint(e,t,r){return this._validateInputs(e,t,!0)?(V5(this,r),Array.isArray(r)||(r=r.toArray()),this.paths[e].splice(t,0,r),this.notifyChange("paths"),this):this}removePath(e){if(!this._validateInputs(e,null))return null;const t=this.paths.splice(e,1)[0],r=this.spatialReference,i=t.map(n=>new ot(n,r));return this.notifyChange("paths"),i}removePoint(e,t){if(!this._validateInputs(e,t))return null;const r=new ot(this.paths[e].splice(t,1)[0],this.spatialReference);return this.notifyChange("paths"),r}setPoint(e,t,r){return this._validateInputs(e,t)?(V5(this,r),Array.isArray(r)||(r=r.toArray()),this.paths[e][t]=r,this.notifyChange("paths"),this):this}_validateInputs(e,t,r=!1){if(e==null||e<0||e>=this.paths.length)return!1;if(t!=null){const i=this.paths[e];if(r&&(t<0||t>i.length)||!r&&(t<0||t>=i.length))return!1}return!0}toJSON(e){return this.write({},e)}};d([f({readOnly:!0})],Hb.prototype,"cache",null),d([f({readOnly:!0})],Hb.prototype,"extent",null),d([f({type:[[[Number]]],json:{write:{isRequired:!0}}})],Hb.prototype,"paths",void 0),d([Xe("paths")],Hb.prototype,"writePaths",null),Hb=PX=d([$("esri.geometry.Polyline")],Hb),Hb.prototype.toJSON.isDefaultToJSON=!0;const uu=Hb,bV=uo()({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon"}),Xce=uo()({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryEnvelope:"extent",mesh:"mesh"});function jwe(e){return e.xmin!==void 0&&e.ymin!==void 0&&e.xmax!==void 0&&e.ymax!==void 0}function yre(e){return e.points!==void 0}function bre(e){return e.x!==void 0&&e.y!==void 0}function vre(e){return e.paths!==void 0}function iw(e){return e.rings!==void 0}function Ry(e){return R(e)?null:e instanceof fd?e:bre(e)?ot.fromJSON(e):vre(e)?uu.fromJSON(e):iw(e)?$o.fromJSON(e):yre(e)?gx.fromJSON(e):jwe(e)?Zt.fromJSON(e):null}function yx(e){return e?bre(e)?"esriGeometryPoint":vre(e)?"esriGeometryPolyline":iw(e)?"esriGeometryPolygon":jwe(e)?"esriGeometryEnvelope":yre(e)?"esriGeometryMultipoint":null:null}const iUe={esriGeometryPoint:ot,esriGeometryPolyline:uu,esriGeometryPolygon:$o,esriGeometryEnvelope:Zt,esriGeometryMultipoint:gx};function qwe(e){return e&&iUe[e]||null}const bx={base:fd,key:"type",typeMap:{extent:Zt,multipoint:gx,point:ot,polyline:uu,polygon:$o}};Mp(bx);let nUe=0;const _re=e=>{let t=class extends e{constructor(...r){super(...r),Object.defineProperty(this,"uid",{writable:!1,configurable:!1,value:Date.now().toString(16)+"-object-"+nUe++})}};return t=d([$("esri.core.Identifiable")],t),t};let Yce=class extends _re(class{}){};Yce=d([$("esri.core.Identifiable")],Yce);const sUe=fe.getLogger("esri.layers.support.fromPortalItem");async function aUe(e){const t="portalItem"in e?e:{portalItem:e},r=await ie(()=>import("./portalLayers.6f0bd1c6.js"),["portalLayers.6f0bd1c6.js","lazyLayerLoader.5e7c3b38.js","layersLoader.315a9bc7.js","jsonContext.b1feec67.js","portalItemUtils.59cab615.js"],import.meta.url);try{return await r.fromItem(t)}catch(i){const n=t&&t.portalItem,s=n&&n.id||"unset",a=n&&n.portal&&n.portal.url||Vr.portalUrl;throw sUe.error("#fromPortalItem()","Failed to create layer from portal item (portal: '"+a+"', id: '"+s+"')",i),i}}let oUe=0,ma=class extends mn.EventedMixin(_re(hd)){constructor(){super(...arguments),this.attributionDataUrl=null,this.fullExtent=new Zt(-180,-90,180,90,Ye.WGS84),this.id=Date.now().toString(16)+"-layer-"+oUe++,this.legendEnabled=!0,this.listMode="show",this.opacity=1,this.parent=null,this.popupEnabled=!0,this.attributionVisible=!0,this.spatialReference=Ye.WGS84,this.title=null,this.type=null,this.url=null,this.visible=!0}static async fromArcGISServerUrl(e){const t=typeof e=="string"?{url:e}:e;return(await ie(()=>import("./arcgisLayers.0a615040.js"),["arcgisLayers.0a615040.js","lazyLayerLoader.5e7c3b38.js"],import.meta.url)).fromUrl(t)}static fromPortalItem(e){return aUe(e)}initialize(){this.when().catch(e=>{var t,r;Ui(e)||fe.getLogger(this.declaredClass).error("#load()",`Failed to load layer (title: '${(t=this.title)!=null?t:"no title"}', id: '${(r=this.id)!=null?r:"no id"}')`,{error:e})})}destroy(){if(this.parent){const e=this,t=this.parent;"layers"in t&&t.layers.includes(e)?t.layers.remove(e):"tables"in t&&t.tables.includes(e)?t.tables.remove(e):"baseLayers"in t&&t.baseLayers.includes(e)?t.baseLayers.remove(e):"baseLayers"in t&&t.referenceLayers.includes(e)&&t.referenceLayers.remove(e)}}get hasAttributionData(){return this.attributionDataUrl!=null}get parsedUrl(){const e=this.url;return e?pn(e):null}async fetchAttributionData(){const e=this.attributionDataUrl;if(this.hasAttributionData&&e)return(await qt(e,{query:{f:"json"},responseType:"json"})).data;throw new k("layer:no-attribution-data","Layer does not have attribution data")}};d([f({type:String})],ma.prototype,"attributionDataUrl",void 0),d([f({type:Zt})],ma.prototype,"fullExtent",void 0),d([f({readOnly:!0})],ma.prototype,"hasAttributionData",null),d([f({type:String,clonable:!1})],ma.prototype,"id",void 0),d([f({type:Boolean,nonNullable:!0})],ma.prototype,"legendEnabled",void 0),d([f({type:["show","hide","hide-children"]})],ma.prototype,"listMode",void 0),d([f({type:Number,range:{min:0,max:1},nonNullable:!0})],ma.prototype,"opacity",void 0),d([f({clonable:!1})],ma.prototype,"parent",void 0),d([f({readOnly:!0})],ma.prototype,"parsedUrl",null),d([f({type:Boolean})],ma.prototype,"popupEnabled",void 0),d([f({type:Boolean})],ma.prototype,"attributionVisible",void 0),d([f({type:Ye})],ma.prototype,"spatialReference",void 0),d([f({type:String})],ma.prototype,"title",void 0),d([f({readOnly:!0,json:{read:!1}})],ma.prototype,"type",void 0),d([f()],ma.prototype,"url",void 0),d([f({type:Boolean,nonNullable:!0})],ma.prototype,"visible",void 0),ma=d([$("esri.layers.Layer")],ma);const U5=ma;function IX(e,t,r){let i,n;if(e)for(let s=0,a=e.length;s<a;s++){if(i=e.getItemAt(s),i[t]===r)return i;if((i==null?void 0:i.type)==="group"&&(n=IX(i.layers,t,r),n))return n}}const Zce=fe.getLogger("esri.support.LayersMixin"),lUe=e=>{let t=class extends e{constructor(...r){super(...r),this.layers=new lt;const i=a=>{a.parent&&"remove"in a.parent&&a.parent.remove(a)},n=a=>{a.parent=this,this.layerAdded(a),a.type!=="elevation"&&a.type!=="base-elevation"||Zce.error(`Layer 'title:${a.title}, id:${a.id}' of type '${a.type}' is not supported as an operational layer and will therefore be ignored.`)},s=a=>{a.parent=null,this.layerRemoved(a)};this.layers.on("before-add",a=>i(a.item)),this.layers.on("after-add",a=>n(a.item)),this.layers.on("after-remove",a=>s(a.item))}destroy(){const r=this.layers.removeAll();for(const i of r)this.layerRemoved(i),i.destroy();this.layers.destroy()}set layers(r){this._set("layers",Rw(r,this._get("layers")))}add(r,i){const n=this.layers;if(i=n.getNextIndex(i),r instanceof U5){const s=r;s.parent===this?this.reorder(s,i):n.add(s,i)}else $u(r)?r.then(s=>{this.destroyed||this.add(s,i)}):Zce.error("#add()","The item being added is not a Layer or a Promise that resolves to a Layer.")}addMany(r,i){const n=this.layers;i=n.getNextIndex(i),r.slice().forEach(s=>{s.parent!==this?(n.add(s,i),i+=1):this.reorder(s,i)})}findLayerById(r){return IX(this.layers,"id",r)}findLayerByUid(r){return IX(this.layers,"uid",r)}remove(r){return this.layers.remove(r)}removeMany(r){return this.layers.removeMany(r)}removeAll(){return this.layers.removeAll()}reorder(r,i){return this.layers.reorder(r,i)}layerAdded(r){}layerRemoved(r){}};return d([f()],t.prototype,"layers",null),t=d([$("esri.support.LayersMixin")],t),t},Hwe="esri.support.TablesMixin",cUe=fe.getLogger(Hwe);function $X(e,t,r){if(e)for(let i=0,n=e.length;i<n;i++){const s=e.getItemAt(i);if(s[t]===r)return s;if((s==null?void 0:s.type)==="group"){const a=$X(s.tables,t,r);if(a)return a}}}const dUe=e=>{let t=class extends e{constructor(...r){super(...r),this.tables=new lt,this.tables.on("after-add",i=>{const n=i.item;n.parent&&n.parent!==this&&"tables"in n.parent&&n.parent.tables.remove(n),n.parent=this,n.type!=="feature"&&cUe.error(`Layer 'title:${n.title}, id:${n.id}' of type '${n.type}' is not supported as a table and will therefore be ignored.`)}),this.tables.on("after-remove",i=>{i.item.parent=null})}destroy(){const r=this.tables.removeAll();for(const i of r)i.destroy();this.tables.destroy()}set tables(r){this._set("tables",Rw(r,this._get("tables")))}findTableById(r){return $X(this.tables,"id",r)}findTableByUid(r){return $X(this.tables,"uid",r)}};return d([f()],t.prototype,"tables",null),t=d([$(Hwe)],t),t};let d0=class extends dUe(lUe(mn.EventedMixin(xe))){constructor(e){super(e),this.allLayers=new k5({getCollections:()=>{var t,r,i;return[(t=this.basemap)==null?void 0:t.baseLayers,(r=this.ground)==null?void 0:r.layers,this.layers,(i=this.basemap)==null?void 0:i.referenceLayers]},getChildrenFunction:t=>"layers"in t?t.layers:null}),this.allTables=Uze(this),this.basemap=null,this.editableLayers=new k5({getCollections:()=>[this.allLayers],itemFilterFunction:Pze}),this.ground=new kF,this._basemapCache=Ize()}destroy(){var e,t;this.allLayers.destroy(),this.allTables.destroy(),this.editableLayers.destroy(),(e=this.ground)==null||e.destroy(),(t=this.basemap)==null||t.destroy(),$ze(this._basemapCache),this._basemapCache=null}castBasemap(e){return Lze(e,this._basemapCache)}castGround(e){const t=Gze(e);return R(t)?this._get("ground"):t}findLayerById(e){return this.allLayers.find(t=>t.id===e)}findTableById(e){return this.allTables.find(t=>t.id===e)}};d([f({readOnly:!0,dependsOn:[]})],d0.prototype,"allLayers",void 0),d([f({readOnly:!0})],d0.prototype,"allTables",void 0),d([f({type:dp})],d0.prototype,"basemap",void 0),d([Xt("basemap")],d0.prototype,"castBasemap",null),d([f({readOnly:!0})],d0.prototype,"editableLayers",void 0),d([f({type:kF,nonNullable:!0})],d0.prototype,"ground",void 0),d([Xt("ground")],d0.prototype,"castGround",null),d0=d([$("esri.Map")],d0);const Wwe=d0;fe.getLogger("esri.core.Clonable");const yd=e=>{let t=class extends e{clone(){var l;const r=zDe(Do(this),"unable to clone instance of non-accessor class"),i=r.metadatas,n=r.store,s={},a=new Map;for(const c in i){const u=i[c],h=n==null?void 0:n.originOf(c),p=u.clonable;if(u.readOnly||p===!1||h!==Gt.USER&&h!==Gt.DEFAULTS&&h!==Gt.WEB_MAP&&h!==Gt.WEB_SCENE)continue;const m=this[c];let g=null;g=typeof p=="function"?p(m):p==="reference"?m:WW(m),m!=null&&g==null||(h===Gt.DEFAULTS?a.set(c,g):s[c]=g)}const o=new(Object.getPrototypeOf(this)).constructor(s);if(a.size){const c=(l=Do(o))==null?void 0:l.store;if(c)for(const[u,h]of a)c.set(u,h,Gt.DEFAULTS)}return o}};return t=d([$("esri.core.Clonable")],t),t};let Qce=class extends yd(xe){};Qce=d([$("esri.core.Clonable")],Qce);class Hv{constructor(t,r){this.min=t,this.max=r,this.range=r-t}ndiff(t,r=0){return Math.ceil((t-r)/this.range)*this.range+r}_normalize(t,r,i,n=0,s=!1){return(i-=n)<t?i+=this.ndiff(t-i):i>r&&(i-=this.ndiff(i-r)),s&&i===r&&(i=t),i+n}normalize(t,r=0,i=!1){return this._normalize(this.min,this.max,t,r,i)}clamp(t,r=0){return Le(t-r,this.min,this.max)+r}monotonic(t,r,i){return t<r?r:r+this.ndiff(t-r,i)}minimalMonotonic(t,r,i){return this._normalize(t,t+this.range,r,i)}center(t,r,i){return r=this.monotonic(t,r,i),this.normalize((t+r)/2,i)}diff(t,r,i){return this.monotonic(t,r,i)-t}shortestSignedDiff(t,r){t=this.normalize(t);const i=(r=this.normalize(r))-t,n=r<t?this.minimalMonotonic(t,r)-t:r-this.minimalMonotonic(r,t);return Math.abs(i)<Math.abs(n)?i:n}contains(t,r,i){return r=this.minimalMonotonic(t,r),(i=this.minimalMonotonic(t,i))>t&&i<r}}function wre(e){for(const t in e){const r=e[t];r instanceof Function&&(e[t]=r.bind(e))}return e}const uUe=wre(new Hv(0,2*Math.PI)),Wv=wre(new Hv(-Math.PI,Math.PI)),xre=wre(new Hv(0,360));let ig=class extends yd(ge){constructor(...e){super(...e),this.position=new ot([0,0,0]),this.heading=0,this.tilt=0,this.fov=55}normalizeCtorArgs(e,t,r,i){if(e&&typeof e=="object"&&("x"in e||Array.isArray(e))){const n={position:e};return t!=null&&(n.heading=t),r!=null&&(n.tilt=r),i!=null&&(n.fov=i),n}return e}writePosition(e,t,r,i){const n=e.clone();n.x=Eh(e.x||0),n.y=Eh(e.y||0),n.z=e.hasZ?Eh(e.z||0):e.z,t[r]=n.write({},i)}readPosition(e,t){const r=new ot;return r.read(e,t),r.x=Eh(r.x||0),r.y=Eh(r.y||0),r.z=r.hasZ?Eh(r.z||0):r.z,r}equals(e){return!!e&&this.tilt===e.tilt&&this.heading===e.heading&&this.fov===e.fov&&this.position.equals(e.position)}};d([f({type:ot,json:{write:{isRequired:!0}}})],ig.prototype,"position",void 0),d([Xe("position")],ig.prototype,"writePosition",null),d([$e("position")],ig.prototype,"readPosition",null),d([f({type:Number,nonNullable:!0,json:{write:{isRequired:!0}}}),Xt(e=>xre.normalize(Eh(e)))],ig.prototype,"heading",void 0),d([f({type:Number,nonNullable:!0,json:{write:{isRequired:!0}}}),Xt(e=>Le(Eh(e),-180,180))],ig.prototype,"tilt",void 0),d([f({type:Number,nonNullable:!0,json:{read:!1,write:!1}})],ig.prototype,"fov",void 0),ig=d([$("esri.Camera")],ig);const gd=ig;var B5;function hUe(e,t){switch(e.type){case"range":{const r="range"in e?e.range[0]:e.minValue,i="range"in e?e.range[1]:e.maxValue;if(+t<r||+t>i)return B5.VALUE_OUT_OF_RANGE;break}case"coded-value":case"codedValue":if(e.codedValues==null||e.codedValues.every(r=>r==null||r.code!==t))return B5.INVALID_CODED_VALUE}return null}(function(e){e.VALUE_OUT_OF_RANGE="domain-validation-error::value-out-of-range",e.INVALID_CODED_VALUE="domain-validation-error::invalid-coded-value"})(B5||(B5={}));let iG;function Wh(){return iG||(iG=(async()=>{const e=await ie(()=>import("./arcadeUtils.813d410b.js").then(t=>t.t),[],import.meta.url);return{arcade:e.arcade,arcadeUtils:e,Dictionary:e.Dictionary,Feature:e.arcadeFeature}})()),iG}const fUe=(e,t,r)=>ZR.create(e,t,r,null,["$feature"]),pUe=(e,t,r)=>ZR.create(e,t,r,null,["$feature","$view"]),mUe=(e,t,r,i)=>ZR.create(e,t,r,i,["$feature","$view"]);class ZR{constructor(t,r,i,n,s,a,o,l){this.script=t,this.evaluate=s;const c=Array.isArray(o)?o:o.fields;this.fields=c,this._syntaxTree=n,this._arcade=r,this._arcadeDictionary=i,this._arcadeFeature=a,this._spatialReference=l,this._referencesGeometry=r.scriptTouchesGeometry(this._syntaxTree),this._referencesScale=this._arcade.referencesMember(this._syntaxTree,"scale")}static async create(t,r,i,n,s,a){const{arcade:o,Feature:l,Dictionary:c}=await Wh(),u=Ye.fromJSON(r),h=o.parseScript(t,a),p=s.reduce((C,A)=>({...C,[A]:null}),{});let m=null;_(n)&&(m=new c(n),m.immutable=!0,p.$config=null);const g=o.scriptUsesGeometryEngine(h)&&o.enableGeometrySupport(),b=o.scriptUsesFeatureSet(h)&&o.enableFeatureSetSupport(),w=o.scriptIsAsync(h)&&o.enableAsyncSupport(),v={vars:p,spatialReference:u,useAsync:!!w},x=new c;x.immutable=!1,x.setField("scale",0);const T=o.compileScript(h,v),E=C=>("$view"in C&&C.$view&&(x.setField("scale",C.$view.scale),C.$view=x),m&&(C.$config=m),T({vars:C,spatialReference:u}));return await Promise.all([g,b,w]),new ZR(t,o,c,h,E,new l,i,u)}repurposeFeature(t){return t.geometry&&!t.geometry.spatialReference&&(t.geometry.spatialReference=this._spatialReference),this._arcadeFeature.repurposeFromGraphicLikeObject(t.geometry,t.attributes,{fields:this.fields}),this._arcadeFeature}createDictionary(){return new this._arcadeDictionary}referencesMember(t){return this._arcade.referencesMember(this._syntaxTree,t)}referencesFunction(t){return this._arcade.referencesFunction(this._syntaxTree,t)}referencesGeometry(){return this._referencesGeometry}referencesScale(){return this._referencesScale}extractFieldLiterals(){return this._arcade.extractExpectedFieldLiterals(this._syntaxTree)}}const gUe=["field","field2","field3","normalizationField","rotationInfo.field","proportionalSymbolInfo.field","proportionalSymbolInfo.normalizationField","colorInfo.field","colorInfo.normalizationField"],yUe=["field","normalizationField"];function G5(e,t){if(e!=null&&t!=null){for(const r of Array.isArray(e)?e:[e])if(Jce(gUe,r,t),"visualVariables"in r&&r.visualVariables)for(const i of r.visualVariables)Jce(yUe,i,t)}}function Jce(e,t,r){if(e)for(const i of e){const n=W9(i,t),s=n&&typeof n!="function"&&r.get(n);s&&ud(i,s.name,t)}}function Tre(e,t){if(e!=null&&(t==null?void 0:t.fields.length))if("startField"in e){const r=t.get(e.startField),i=t.get(e.endField);e.startField=r&&r.name||null,e.endField=i&&i.name||null}else{const r=t.get(e.startTimeField),i=t.get(e.endTimeField);e.startTimeField=r&&r.name||null,e.endTimeField=i&&i.name||null}}const nG=new Set;function Xwe(e,t){return e&&t?(nG.clear(),cA(nG,e,t),Array.from(nG).sort()):[]}function cA(e,t,r){var i;if(r)if((i=t==null?void 0:t.fields)!=null&&i.length)if(r.includes("*"))for(const{name:n}of t.fields)e.add(n);else for(const n of r)Uh(e,t,n);else{if(r.includes("*"))return e.clear(),void e.add("*");for(const n of r)e.add(n)}}function Uh(e,t,r){if(typeof r=="string")if(t){const i=t.get(r);i&&e.add(i.name)}else e.add(r)}function nIt(e,t){return R(t)||R(e)?[]:t.includes("*")?e.fields.map(r=>r.name):t}async function uc(e,t,r){var s;if(!r)return;const{arcadeUtils:i}=await Wh(),n=i.extractFieldNames(r,(s=t==null?void 0:t.fields)==null?void 0:s.map(a=>a.name));for(const a of n)Uh(e,t,a)}async function Ywe(e,t,r){if(r&&r!=="1=1"){const i=(await ie(()=>import("./WhereClause.ecb0bafc.js"),[],import.meta.url)).WhereClause.create(r,t);if(!i.isStandardized)throw new k("fieldUtils:collectFilterFields","Where clause is not standardized",{where:r});cA(e,t,i.fieldNames)}}function bUe({displayField:e,fields:t}){return e||(t&&t.length?sG(t,"name-or-title")||sG(t,"unique-identifier")||sG(t,"type-or-category")||vUe(t):null)}function vUe(e){for(const t of e){if(!t||!t.name)continue;const r=t.name.toLowerCase();if(r.includes("name")||r.includes("title"))return t.name}return null}function sG(e,t){for(const r of e)if(r&&r.valueType&&r.valueType===t)return r.name;return null}async function sIt(e,t){if(!t)return;const r=W9("elevationInfo.featureExpressionInfo",t);return r?r.collectRequiredFields(e,t.fieldsIndex):void 0}async function _Ue(e,t,r){r.outStatistic.onStatisticValueExpression?uc(e,t,r.outStatistic.onStatisticValueExpression):e.add(r.outStatistic.onStatisticField)}async function aIt(e,t,r){var n,s;if(!t||!r||!("fields"in r))return;const i=[];if((n=r.popupTemplate)!=null&&n.expressionInfos&&i.push(...r.popupTemplate.expressionInfos.map(a=>uc(e,t.fieldsIndex,a.expression))),Array.isArray((s=r.popupTemplate)==null?void 0:s.content)){const a=r.popupTemplate.content;for(const o of a)o.type==="expression"&&o.expressionInfo&&i.push(uc(e,t.fieldsIndex,o.expressionInfo.expression))}r.fields&&i.push(...r.fields.map(a=>_Ue(e,t.fieldsIndex,a))),await Promise.all(i)}async function oIt(e,t,r){t&&(t.timeInfo&&_(r)&&r.timeExtent&&cA(e,t.fieldsIndex,[t.timeInfo.startField,t.timeInfo.endField]),t.floorInfo&&cA(e,t.fieldsIndex,[t.floorInfo.floorField]),_(r)&&_(r.where)&&await Ywe(e,t.fieldsIndex,r.where))}async function lIt(e,t,r){t&&r&&await Promise.all(r.map(i=>wUe(e,t,i)))}async function wUe(e,t,r){t&&r&&(r.valueExpression?await uc(e,t.fieldsIndex,r.valueExpression):r.field&&Uh(e,t.fieldsIndex,r.field))}function cIt(e){if(!e)return[];const t="editFieldsInfo"in e&&e.editFieldsInfo;return t?Xwe(e.fieldsIndex,[t&&t.creatorField,t&&t.creationDateField,t&&t.editorField,t&&t.editDateField]):[]}async function dIt(e,t){const{labelingInfo:r,fieldsIndex:i}=t;r&&r.length&&await Promise.all(r.map(n=>xUe(e,i,n)))}async function xUe(e,t,r){if(!r)return;const i=r.getLabelExpression(),n=r.where;if(i.type==="arcade")await uc(e,t,i.expression);else{const s=i.expression.match(/{[^}]*}/g);s&&s.forEach(a=>{Uh(e,t,a.slice(1,-1))})}await Ywe(e,t,n)}function TUe(e){const t=e.defaultValue;return t!==void 0&&Jwe(e,t)?t:e.nullable?null:void 0}function Zwe(e){return typeof e=="number"&&!isNaN(e)&&isFinite(e)}function SUe(e){return e===null||Zwe(e)}const Sre="isInteger"in Number?Number.isInteger:e=>typeof e=="number"&&isFinite(e)&&Math.floor(e)===e;function EUe(e){return e===null||Sre(e)}function Qwe(e){return e!=null&&typeof e=="string"}function CUe(e){return e===null||Qwe(e)}function AUe(){return!0}function Jwe(e,t){let r;switch(e.type){case"date":case"integer":case"long":case"small-integer":case"esriFieldTypeDate":case"esriFieldTypeInteger":case"esriFieldTypeLong":case"esriFieldTypeSmallInteger":r=e.nullable?EUe:Sre;break;case"double":case"single":case"esriFieldTypeSingle":case"esriFieldTypeDouble":r=e.nullable?SUe:Zwe;break;case"string":case"esriFieldTypeString":r=e.nullable?CUe:Qwe;break;default:r=AUe}return arguments.length===1?r:r(t)}const RUe=["integer","small-integer","single","double"],OUe=new Set([...RUe,"esriFieldTypeInteger","esriFieldTypeSmallInteger","esriFieldTypeSingle","esriFieldTypeDouble"]);function J9(e){return e!=null&&OUe.has(e.type)}function MUe(e){return e!=null&&(e.type==="string"||e.type==="esriFieldTypeString")}function X4(e){return e!=null&&(e.type==="date"||e.type==="esriFieldTypeDate")}var VF,zF;function uIt(e){return e==null||typeof e=="number"&&isNaN(e)?null:e}function hIt(e,t){return e.nullable&&t===null?null:J9(e)&&!PUe(e.type,Number(t))?VF.OUT_OF_RANGE:Jwe(e,t)?e.domain?hUe(e.domain,t):null:zF.INVALID_TYPE}function PUe(e,t){const r=typeof e=="string"?Kwe(e):e;return!!r&&(r.isInteger?Sre(t)&&t>=r.min&&t<=r.max:t>=r.min&&t<=r.max)}function Kwe(e){switch(e){case"esriFieldTypeSmallInteger":case"small-integer":return IUe;case"esriFieldTypeInteger":case"integer":return $Ue;case"esriFieldTypeSingle":case"single":return LUe;case"esriFieldTypeDouble":case"double":return DUe}}(function(e){e.OUT_OF_RANGE="numeric-range-validation-error::out-of-range"})(VF||(VF={})),function(e){e.INVALID_TYPE="type-validation-error::invalid-type"}(zF||(zF={}));const IUe={min:-32768,max:32767,isInteger:!0},$Ue={min:-2147483648,max:2147483647,isInteger:!0},LUe={min:-34e37,max:12e37,isInteger:!1},DUe={min:-Number.MAX_VALUE,max:Number.MAX_VALUE,isInteger:!1};function fIt(e,t,r){switch(e){case B5.INVALID_CODED_VALUE:return`Value ${r} is not in the coded domain - field: ${t.name}, domain: ${JSON.stringify(t.domain)}`;case B5.VALUE_OUT_OF_RANGE:return`Value ${r} is out of the range of valid values - field: ${t.name}, domain: ${JSON.stringify(t.domain)}`;case zF.INVALID_TYPE:return`Value ${r} is not a valid value for the field type - field: ${t.name}, type: ${t.type}, nullable: ${t.nullable}`;case VF.OUT_OF_RANGE:{const{min:i,max:n}=Kwe(t.type);return`Value ${r} is out of range for the number type - field: ${t.name}, type: ${t.type}, value range is ${i} to ${n}`}}}function FUe(e,t){return!NUe(e,t,null)}function NUe(e,t,r){if(!t||!t.attributes||!e){if(_(r))for(const s of e)r.add(s);return!0}const i=t.attributes;let n=!1;for(const s of e)if(!(s in i)){if(n=!0,!_(r))break;r.add(s)}return n}function exe(e){return["raster.itempixelvalue","raster.servicepixelvalue"].some(t=>e.toLowerCase().startsWith(t))}let X$=class extends ge{constructor(e){super(e),this.type=null}};d([f({type:["attachments","custom","fields","media","text","expression"],readOnly:!0,json:{read:!1,write:!0}})],X$.prototype,"type",void 0),X$=d([$("esri.popup.content.Content")],X$);const vx=X$;var LX;let y2=LX=class extends vx{constructor(e){super(e),this.description=null,this.displayType="auto",this.title=null,this.type="attachments"}clone(){return new LX({description:this.description,displayType:this.displayType,title:this.title})}};d([f({type:String,json:{write:!0}})],y2.prototype,"description",void 0),d([f({type:["auto","preview","list"],json:{write:!0}})],y2.prototype,"displayType",void 0),d([f({type:String,json:{write:!0}})],y2.prototype,"title",void 0),d([f({type:["attachments"],readOnly:!0,json:{read:!1,write:!0}})],y2.prototype,"type",void 0),y2=LX=d([$("esri.popup.content.AttachmentsContent")],y2);const dA=y2;var DX;let b2=DX=class extends vx{constructor(e){super(e),this.creator=null,this.destroyer=null,this.outFields=null,this.type="custom"}clone(){return new DX({creator:this.creator,destroyer:this.destroyer,outFields:Array.isArray(this.outFields)?te(this.outFields):null})}};d([f()],b2.prototype,"creator",void 0),d([f()],b2.prototype,"destroyer",void 0),d([f()],b2.prototype,"outFields",void 0),d([f({type:["custom"],readOnly:!0})],b2.prototype,"type",void 0),b2=DX=d([$("esri.popup.content.CustomContent")],b2);const kUe=b2;var FX;let KT=FX=class extends ge{constructor(e){super(e),this.title=null,this.expression=null,this.returnType="dictionary"}clone(){return new FX({title:this.title,expression:this.expression})}};d([f({type:String,json:{write:!0}})],KT.prototype,"title",void 0),d([f({type:String,json:{write:!0}})],KT.prototype,"expression",void 0),d([f({type:["dictionary"],readOnly:!0,json:{read:!1,write:!0}})],KT.prototype,"returnType",void 0),KT=FX=d([$("esri.popup.ElementExpressionInfo")],KT);const txe=KT;var NX;let cE=NX=class extends vx{constructor(e){super(e),this.expressionInfo=null,this.type="expression"}clone(){var e;return new NX({expressionInfo:(e=this.expressionInfo)==null?void 0:e.clone()})}};d([f({type:txe,json:{write:!0}})],cE.prototype,"expressionInfo",void 0),d([f({type:["expression"],readOnly:!0,json:{read:!1,write:!0}})],cE.prototype,"type",void 0),cE=NX=d([$("esri.popup.content.ExpressionContent")],cE);const Ere=cE,uA=uo()({shortDate:"short-date",shortDateShortTime:"short-date-short-time",shortDateShortTime24:"short-date-short-time-24",shortDateLongTime:"short-date-long-time",shortDateLongTime24:"short-date-long-time-24",shortDateLE:"short-date-le",shortDateLEShortTime:"short-date-le-short-time",shortDateLEShortTime24:"short-date-le-short-time-24",shortDateLELongTime:"short-date-le-long-time",shortDateLELongTime24:"short-date-le-long-time-24",longMonthDayYear:"long-month-day-year",longMonthDayYearShortTime:"long-month-day-year-short-time",longMonthDayYearShortTime24:"long-month-day-year-short-time-24",longMonthDayYearLongTime:"long-month-day-year-long-time",longMonthDayYearLongTime24:"long-month-day-year-long-time-24",dayShortMonthYear:"day-short-month-year",dayShortMonthYearShortTime:"day-short-month-year-short-time",dayShortMonthYearShortTime24:"day-short-month-year-short-time-24",dayShortMonthYearLongTime:"day-short-month-year-long-time",dayShortMonthYearLongTime24:"day-short-month-year-long-time-24",longDate:"long-date",longDateShortTime:"long-date-short-time",longDateShortTime24:"long-date-short-time-24",longDateLongTime:"long-date-long-time",longDateLongTime24:"long-date-long-time-24",longMonthYear:"long-month-year",shortMonthYear:"short-month-year",year:"year"});uA.toJSON.bind(uA);uA.fromJSON.bind(uA);const Up={year:"numeric",month:"numeric",day:"numeric"},V6={year:"numeric",month:"long",day:"numeric"},z6={year:"numeric",month:"short",day:"numeric"},U6={year:"numeric",month:"long",weekday:"long",day:"numeric"},th={hour:"numeric",minute:"numeric"},hf={...th,second:"numeric"},Cre={"short-date":Up,"short-date-short-time":{...Up,...th},"short-date-short-time-24":{...Up,...th,hour12:!1},"short-date-long-time":{...Up,...hf},"short-date-long-time-24":{...Up,...hf,hour12:!1},"short-date-le":Up,"short-date-le-short-time":{...Up,...th},"short-date-le-short-time-24":{...Up,...th,hour12:!1},"short-date-le-long-time":{...Up,...hf},"short-date-le-long-time-24":{...Up,...hf,hour12:!1},"long-month-day-year":V6,"long-month-day-year-short-time":{...V6,...th},"long-month-day-year-short-time-24":{...V6,...th,hour12:!1},"long-month-day-year-long-time":{...V6,...hf},"long-month-day-year-long-time-24":{...V6,...hf,hour12:!1},"day-short-month-year":z6,"day-short-month-year-short-time":{...z6,...th},"day-short-month-year-short-time-24":{...z6,...th,hour12:!1},"day-short-month-year-long-time":{...z6,...hf},"day-short-month-year-long-time-24":{...z6,...hf,hour12:!1},"long-date":U6,"long-date-short-time":{...U6,...th},"long-date-short-time-24":{...U6,...th,hour12:!1},"long-date-long-time":{...U6,...hf},"long-date-long-time-24":{...U6,...hf,hour12:!1},"long-month-year":{month:"long",year:"numeric"},"short-month-year":{month:"short",year:"numeric"},year:{year:"numeric"},"short-time":th,"long-time":hf},hA=uo()({shortDate:"short-date",shortDateShortTime:"short-date-short-time",shortDateShortTime24:"short-date-short-time-24",shortDateLongTime:"short-date-long-time",shortDateLongTime24:"short-date-long-time-24",shortDateLE:"short-date-le",shortDateLEShortTime:"short-date-le-short-time",shortDateLEShortTime24:"short-date-le-short-time-24",shortDateLELongTime:"short-date-le-long-time",shortDateLELongTime24:"short-date-le-long-time-24",longMonthDayYear:"long-month-day-year",longMonthDayYearShortTime:"long-month-day-year-short-time",longMonthDayYearShortTime24:"long-month-day-year-short-time-24",longMonthDayYearLongTime:"long-month-day-year-long-time",longMonthDayYearLongTime24:"long-month-day-year-long-time-24",dayShortMonthYear:"day-short-month-year",dayShortMonthYearShortTime:"day-short-month-year-short-time",dayShortMonthYearShortTime24:"day-short-month-year-short-time-24",dayShortMonthYearLongTime:"day-short-month-year-long-time",dayShortMonthYearLongTime24:"day-short-month-year-long-time-24",longDate:"long-date",longDateShortTime:"long-date-short-time",longDateShortTime24:"long-date-short-time-24",longDateLongTime:"long-date-long-time",longDateLongTime24:"long-date-long-time-24",longMonthYear:"long-month-year",shortMonthYear:"short-month-year",year:"year"});hA.apiValues;hA.toJSON.bind(hA);hA.fromJSON.bind(hA);const VUe={ar:"ar-u-nu-latn-ca-gregory"};let Y$=new WeakMap,rxe=Cre["short-date-short-time"];function zUe(e){const t=e||rxe;if(!Y$.has(t)){const r=mu(),i=VUe[mu()]||r;Y$.set(t,new Intl.DateTimeFormat(i,t))}return Y$.get(t)}function QR(e){return Cre[e]||null}function Ip(e,t){return zUe(t).format(e)}Jte(()=>{Y$=new WeakMap,rxe=Cre["short-date-short-time"]});const UUe={ar:"ar-u-nu-latn"};let Z$=new WeakMap,ixe={};function BUe(e){const t=e||ixe;if(!Z$.has(t)){const r=mu(),i=UUe[mu()]||r;Z$.set(t,new Intl.NumberFormat(i,e))}return Z$.get(t)}function nxe(e={}){const t={};return e.digitSeparator!=null&&(t.useGrouping=e.digitSeparator),e.places!=null&&(t.minimumFractionDigits=t.maximumFractionDigits=e.places),t}function Xh(e,t){return e===-0&&(e=0),BUe(t).format(e)}Jte(()=>{Z$=new WeakMap,ixe={}});var kX;let v2=kX=class extends ge{constructor(e){super(e),this.dateFormat=null,this.dateTimeFormatOptions=null,this.digitSeparator=!1,this.places=null}clone(){return new kX({dateFormat:this.dateFormat,digitSeparator:this.digitSeparator,places:this.places})}format(e){return this.dateFormat?Ip(e,{...QR(this.dateFormat),...this.dateTimeFormatOptions}):Xh(e,nxe(this))}formatRasterPixelValue(e){let t,r;return e.trim().includes(",")?(t=",",r=t+" ",this._formatDelimitedString(e,t,r,this)):e.trim().includes(";")?(t=";",r=t+" ",this._formatDelimitedString(e,t,r,this)):e.trim().includes(" ")?(t=r=" ",this._formatDelimitedString(e,t,r,this)):this.format(Number(e))}_formatDelimitedString(e,t,r,i){return e&&t&&r&&i?e.trim().split(t).map(n=>this.format(Number(n))).join(r):e}};d([Ze(uA)],v2.prototype,"dateFormat",void 0),d([f({type:Object,json:{read:!1}})],v2.prototype,"dateTimeFormatOptions",void 0),d([f({type:Boolean,json:{write:!0}})],v2.prototype,"digitSeparator",void 0),d([f({type:$i,json:{write:!0}})],v2.prototype,"places",void 0),v2=kX=d([$("esri.popup.support.FieldInfoFormat")],v2);const c4=v2;var VX;let xf=VX=class extends ge{constructor(e){super(e),this.fieldName=null,this.format=null,this.isEditable=!1,this.label=null,this.stringFieldOption="text-box",this.statisticType=null,this.tooltip=null,this.visible=!0}clone(){return new VX({fieldName:this.fieldName,format:this.format?te(this.format):null,isEditable:this.isEditable,label:this.label,stringFieldOption:this.stringFieldOption,statisticType:this.statisticType,tooltip:this.tooltip,visible:this.visible})}};d([f({type:String,json:{write:!0}})],xf.prototype,"fieldName",void 0),d([f({type:c4,json:{write:!0}})],xf.prototype,"format",void 0),d([f({type:Boolean,json:{write:!0,default:!1}})],xf.prototype,"isEditable",void 0),d([f({type:String,json:{write:!0}})],xf.prototype,"label",void 0),d([Ze(new tr({richtext:"rich-text",textarea:"text-area",textbox:"text-box"}),{default:"text-box"})],xf.prototype,"stringFieldOption",void 0),d([f({type:["count","sum","min","max","avg","stddev","var"],json:{write:!0}})],xf.prototype,"statisticType",void 0),d([f({type:String,json:{write:!0}})],xf.prototype,"tooltip",void 0),d([f({type:Boolean,json:{write:!0}})],xf.prototype,"visible",void 0),xf=VX=d([$("esri.popup.FieldInfo")],xf);const JR=xf;var zX;let ng=zX=class extends vx{constructor(e){super(e),this.attributes=null,this.description=null,this.fieldInfos=null,this.title=null,this.type="fields"}writeFieldInfos(e,t){t.fieldInfos=e&&e.map(r=>r.toJSON())}clone(){return new zX(te({attributes:this.attributes,description:this.description,fieldInfos:this.fieldInfos,title:this.title}))}};d([f({type:Object,json:{write:!0}})],ng.prototype,"attributes",void 0),d([f({type:String,json:{write:!0}})],ng.prototype,"description",void 0),d([f({type:[JR]})],ng.prototype,"fieldInfos",void 0),d([Xe("fieldInfos")],ng.prototype,"writeFieldInfos",null),d([f({type:String,json:{write:!0}})],ng.prototype,"title",void 0),d([f({type:["fields"],readOnly:!0,json:{read:!1,write:!0}})],ng.prototype,"type",void 0),ng=zX=d([$("esri.popup.content.FieldsContent")],ng);const j5=ng;let _2=class extends ge{constructor(e){super(e),this.altText=null,this.caption="",this.title="",this.type=null}};d([f({type:String,json:{write:!0}})],_2.prototype,"altText",void 0),d([f({type:String,json:{write:!0}})],_2.prototype,"caption",void 0),d([f({type:String,json:{write:!0}})],_2.prototype,"title",void 0),d([f({type:["image","bar-chart","column-chart","line-chart","pie-chart"],readOnly:!0,json:{read:!1,write:!0}})],_2.prototype,"type",void 0),_2=d([$("esri.popup.content.mixins.MediaInfo")],_2);const Are=_2;var UX;let eS=UX=class extends xe{constructor(e){super(e),this.fieldName=null,this.tooltip=null,this.value=null}clone(){return new UX({fieldName:this.fieldName,tooltip:this.tooltip,value:this.value})}};d([f()],eS.prototype,"fieldName",void 0),d([f()],eS.prototype,"tooltip",void 0),d([f()],eS.prototype,"value",void 0),eS=UX=d([$("esri.popup.content.support.ChartMediaInfoValueSeries")],eS);const sxe=eS;var BX;let w2=BX=class extends ge{constructor(e){super(e),this.fields=[],this.normalizeField=null,this.series=[],this.tooltipField=null}clone(){return new BX({fields:te(this.fields),normalizeField:this.normalizeField,tooltipField:this.tooltipField})}};d([f({type:[String],json:{write:!0}})],w2.prototype,"fields",void 0),d([f({type:String,json:{write:!0}})],w2.prototype,"normalizeField",void 0),d([f({type:[sxe],json:{read:!1}})],w2.prototype,"series",void 0),d([f({type:String,json:{write:!0}})],w2.prototype,"tooltipField",void 0),w2=BX=d([$("esri.popup.content.support.ChartMediaInfoValue")],w2);const GUe=w2;let dE=class extends Are{constructor(e){super(e),this.type=null,this.value=null}};d([f({type:["bar-chart","column-chart","line-chart","pie-chart"],readOnly:!0,json:{read:!1,write:!0}})],dE.prototype,"type",void 0),d([f({type:GUe,json:{write:!0}})],dE.prototype,"value",void 0),dE=d([$("esri.popup.content.mixins.ChartMediaInfo")],dE);const vV=dE,_V=uo()({barchart:"bar-chart",columnchart:"column-chart",linechart:"line-chart",piechart:"pie-chart"});var GX;let Q$=GX=class extends vV{constructor(e){super(e),this.type="bar-chart"}clone(){return new GX({altText:this.altText,title:this.title,caption:this.caption,value:this.value?this.value.clone():null})}};d([f({type:["bar-chart"],readOnly:!0,json:{type:["barchart"],read:!1,write:_V.write}})],Q$.prototype,"type",void 0),Q$=GX=d([$("esri.popup.content.BarChartMediaInfo")],Q$);const axe=Q$;var jX;let J$=jX=class extends vV{constructor(e){super(e),this.type="column-chart"}clone(){return new jX({altText:this.altText,title:this.title,caption:this.caption,value:this.value?this.value.clone():null})}};d([f({type:["column-chart"],readOnly:!0,json:{type:["columnchart"],read:!1,write:_V.write}})],J$.prototype,"type",void 0),J$=jX=d([$("esri.popup.content.ColumnChartMediaInfo")],J$);const oxe=J$;var qX;let uE=qX=class extends ge{constructor(e){super(e),this.linkURL=null,this.sourceURL=null}clone(){return new qX({linkURL:this.linkURL,sourceURL:this.sourceURL})}};d([f({type:String,json:{write:!0}})],uE.prototype,"linkURL",void 0),d([f({type:String,json:{write:!0}})],uE.prototype,"sourceURL",void 0),uE=qX=d([$("esri.popup.content.support.ImageMediaInfoValue")],uE);const jUe=uE;var HX;let tS=HX=class extends Are{constructor(e){super(e),this.refreshInterval=null,this.type="image",this.value=null}clone(){return new HX({altText:this.altText,title:this.title,caption:this.caption,refreshInterval:this.refreshInterval,value:this.value?this.value.clone():null})}};d([f({type:Number,json:{write:!0}})],tS.prototype,"refreshInterval",void 0),d([f({type:["image"],readOnly:!0,json:{read:!1,write:!0}})],tS.prototype,"type",void 0),d([f({type:jUe,json:{write:!0}})],tS.prototype,"value",void 0),tS=HX=d([$("esri.popup.content.ImageMediaInfo")],tS);const lxe=tS;var WX;let K$=WX=class extends vV{constructor(e){super(e),this.type="line-chart"}clone(){return new WX({altText:this.altText,title:this.title,caption:this.caption,value:this.value?this.value.clone():null})}};d([f({type:["line-chart"],readOnly:!0,json:{type:["linechart"],read:!1,write:_V.write}})],K$.prototype,"type",void 0),K$=WX=d([$("esri.popup.content.LineChartMediaInfo")],K$);const cxe=K$;var XX;let eL=XX=class extends vV{constructor(e){super(e),this.type="pie-chart"}clone(){return new XX({altText:this.altText,title:this.title,caption:this.caption,value:this.value?this.value.clone():null})}};d([f({type:["pie-chart"],readOnly:!0,json:{type:["piechart"],read:!1,write:_V.write}})],eL.prototype,"type",void 0),eL=XX=d([$("esri.popup.content.PieChartMediaInfo")],eL);const dxe=eL,uxe={base:Are,key:"type",defaultKeyValue:"image",typeMap:{"bar-chart":axe,"column-chart":oxe,"line-chart":cxe,"pie-chart":dxe,image:lxe}};var YX;let Tf=YX=class extends vx{constructor(e){super(e),this.activeMediaInfoIndex=null,this.attributes=null,this.description=null,this.mediaInfos=null,this.title=null,this.type="media"}readMediaInfos(e){return e&&e.map(t=>t.type==="image"?lxe.fromJSON(t):t.type==="barchart"?axe.fromJSON(t):t.type==="columnchart"?oxe.fromJSON(t):t.type==="linechart"?cxe.fromJSON(t):t.type==="piechart"?dxe.fromJSON(t):void 0).filter(Boolean)}writeMediaInfos(e,t){t.mediaInfos=e&&e.map(r=>r.toJSON())}clone(){return new YX(te({activeMediaInfoIndex:this.activeMediaInfoIndex,attributes:this.attributes,description:this.description,mediaInfos:this.mediaInfos,title:this.title}))}};d([f()],Tf.prototype,"activeMediaInfoIndex",void 0),d([f({type:Object,json:{write:!0}})],Tf.prototype,"attributes",void 0),d([f({type:String,json:{write:!0}})],Tf.prototype,"description",void 0),d([f({types:[uxe]})],Tf.prototype,"mediaInfos",void 0),d([$e("mediaInfos")],Tf.prototype,"readMediaInfos",null),d([Xe("mediaInfos")],Tf.prototype,"writeMediaInfos",null),d([f({type:String,json:{write:!0}})],Tf.prototype,"title",void 0),d([f({type:["media"],readOnly:!0,json:{read:!1,write:!0}})],Tf.prototype,"type",void 0),Tf=YX=d([$("esri.popup.content.MediaContent")],Tf);const fA=Tf;var ZX;let hE=ZX=class extends vx{constructor(e){super(e),this.text=null,this.type="text"}clone(){return new ZX({text:this.text})}};d([f({type:String,json:{write:!0}})],hE.prototype,"text",void 0),d([f({type:["text"],readOnly:!0,json:{read:!1,write:!0}})],hE.prototype,"type",void 0),hE=ZX=d([$("esri.popup.content.TextContent")],hE);const q5=hE,qUe={base:null,key:"type",typeMap:{attachment:dA,media:fA,text:q5,expression:Ere,field:j5}};var QX;let x2=QX=class extends ge{constructor(e){super(e),this.name=null,this.title=null,this.expression=null,this.returnType=null}clone(){return new QX({name:this.name,title:this.title,expression:this.expression,returnType:this.returnType})}};d([f({type:String,json:{write:!0}})],x2.prototype,"name",void 0),d([f({type:String,json:{write:!0}})],x2.prototype,"title",void 0),d([f({type:String,json:{write:!0}})],x2.prototype,"expression",void 0),d([f({type:["string","number"],json:{write:!0}})],x2.prototype,"returnType",void 0),x2=QX=d([$("esri.popup.ExpressionInfo")],x2);const hxe=x2;var JX;let fE=JX=class extends ge{constructor(e){super(e),this.returnTopmostRaster=null,this.showNoDataRecords=null}clone(){return new JX({showNoDataRecords:this.showNoDataRecords,returnTopmostRaster:this.returnTopmostRaster})}};d([f({type:Boolean,json:{write:!0}})],fE.prototype,"returnTopmostRaster",void 0),d([f({type:Boolean,json:{write:!0}})],fE.prototype,"showNoDataRecords",void 0),fE=JX=d([$("esri.popup.LayerOptions")],fE);const HUe=fE;var KX;let pE=KX=class extends ge{constructor(e){super(e),this.field=null,this.order=null}clone(){return new KX({field:this.field,order:this.order})}};d([f({type:String,json:{write:!0}})],pE.prototype,"field",void 0),d([f({type:["asc","desc"],json:{write:!0}})],pE.prototype,"order",void 0),pE=KX=d([$("esri.popup.support.RelatedRecordsInfoFieldOrder")],pE);const fxe=pE;var eY;let mE=eY=class extends ge{constructor(e){super(e),this.showRelatedRecords=null,this.orderByFields=null}clone(){return new eY({showRelatedRecords:this.showRelatedRecords,orderByFields:this.orderByFields?te(this.orderByFields):null})}};d([f({type:Boolean,json:{write:!0}})],mE.prototype,"showRelatedRecords",void 0),d([f({type:[fxe],json:{write:!0}})],mE.prototype,"orderByFields",void 0),mE=eY=d([$("esri.popup.RelatedRecordsInfo")],mE);const WUe=mE;var tY;let Sf=tY=class extends _re(xe){constructor(e){super(e),this.active=!1,this.className=null,this.disabled=!1,this.id=null,this.indicator=!1,this.title=null,this.type=null,this.visible=!0}clone(){return new tY({active:this.active,className:this.className,disabled:this.disabled,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible})}};d([f()],Sf.prototype,"active",void 0),d([f()],Sf.prototype,"className",void 0),d([f()],Sf.prototype,"disabled",void 0),d([f()],Sf.prototype,"id",void 0),d([f()],Sf.prototype,"indicator",void 0),d([f()],Sf.prototype,"title",void 0),d([f()],Sf.prototype,"type",void 0),d([f()],Sf.prototype,"visible",void 0),Sf=tY=d([$("esri.support.actions.ActionBase")],Sf);const wV=Sf;var rY;let tL=rY=class extends wV{constructor(e){super(e),this.image=null,this.type="button"}clone(){return new rY({active:this.active,className:this.className,disabled:this.disabled,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible,image:this.image})}};d([f()],tL.prototype,"image",void 0),tL=rY=d([$("esri.support.Action.ActionButton")],tL);const K9=tL;var iY;let gE=iY=class extends wV{constructor(e){super(e),this.image=null,this.type="toggle",this.value=!1}clone(){return new iY({active:this.active,className:this.className,disabled:this.disabled,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible,image:this.image,value:this.value})}};d([f()],gE.prototype,"image",void 0),d([f()],gE.prototype,"value",void 0),gE=iY=d([$("esri.support.Action.ActionToggle")],gE);const pxe=gE;var nY;const XUe=lt.ofType({key:"type",defaultKeyValue:"button",base:wV,typeMap:{button:K9,toggle:pxe}}),YUe={base:vx,key:"type",typeMap:{media:fA,custom:kUe,text:q5,attachments:dA,fields:j5,expression:Ere}},mxe="esri.PopupTemplate",ZUe=fe.getLogger(mxe),QUe=["attachments","fields","media","text","expression"];let qs=nY=class extends ge{constructor(){super(...arguments),this.actions=null,this.content="",this.expressionInfos=null,this.fieldInfos=null,this.layerOptions=null,this.lastEditInfoEnabled=!0,this.outFields=null,this.overwriteActions=!1,this.returnGeometry=!1,this.title="",this.relatedRecordsInfo=null}castContent(e){return Array.isArray(e)?e.map(t=>Mp(YUe,t)):typeof e=="string"||typeof e=="function"||e instanceof HTMLElement||$u(e)?e:(ZUe.error("content error","unsupported content value",{value:e}),null)}readContent(e,t){const{popupElements:r}=t;return Array.isArray(r)&&r.length>0?this._readPopupInfoElements(t):this._readPopupInfo(t)}writeContent(e,t,r,i){typeof e!="string"?Array.isArray(e)&&(t.popupElements=e.filter(n=>QUe.includes(n.type)).map(n=>n&&n.toJSON(i)),t.popupElements.forEach(n=>{n.type==="attachments"?this._writeAttachmentContent(t):n.type==="media"?this._writeMediaContent(n,t):n.type==="text"&&this._writeTextContent(n,t)})):t.description=e}writeFieldInfos(e,t,r,i){const{content:n}=this,s=Array.isArray(n)?n:null;if(e){const a=s?s.filter(l=>l.type==="fields"):[],o=a.length&&a.every(l=>{var c;return(c=l.fieldInfos)==null?void 0:c.length});t.fieldInfos=e.filter(Boolean).map(l=>{const c=l.toJSON(i);return o&&(c.visible=!1),c})}if(s)for(const a of s)a.type==="fields"&&this._writeFieldsContent(a,t)}writeLayerOptions(e,t,r,i){t[r]=!e||e.showNoDataRecords===null&&e.returnTopmostRaster===null?null:e.toJSON(i)}writeTitle(e,t){t.title=e||""}clone(){const{actions:e}=this,t=e?te(e.toArray()):[];return new nY({actions:t,content:Array.isArray(this.content)?te(this.content):this.content,expressionInfos:Array.isArray(this.expressionInfos)?te(this.expressionInfos):null,fieldInfos:Array.isArray(this.fieldInfos)?te(this.fieldInfos):null,layerOptions:this.layerOptions?te(this.layerOptions):null,lastEditInfoEnabled:this.lastEditInfoEnabled,outFields:Array.isArray(this.outFields)?te(this.outFields):null,overwriteActions:this.overwriteActions,returnGeometry:this.returnGeometry,title:this.title,relatedRecordsInfo:this.relatedRecordsInfo?te(this.relatedRecordsInfo):null})}async collectRequiredFields(e,t){const r=this.expressionInfos||[];await this._collectExpressionInfoFields(e,t,[...r,...this._getContentExpressionInfos(this.content,r)]),cA(e,t,[...this.outFields||[],...this._getActionsFields(this.actions),...this._getTitleFields(this.title),...this._getContentFields(this.content)])}async getRequiredFields(e){const t=new Set;return await this.collectRequiredFields(t,e),[...t].sort()}_writeFieldsContent(e,t){if(!Array.isArray(e.fieldInfos)||!e.fieldInfos.length)return;const r=te(e.fieldInfos);Array.isArray(t.fieldInfos)?r.forEach(i=>{const n=t.fieldInfos.find(s=>s.fieldName.toLowerCase()===i.fieldName.toLowerCase());n?n.visible=!0:t.fieldInfos.push(i)}):t.fieldInfos=r}_writeAttachmentContent(e){e.showAttachments||(e.showAttachments=!0)}_writeTextContent(e,t){!t.description&&e.text&&(t.description=e.text)}_writeMediaContent(e,t){if(!Array.isArray(e.mediaInfos)||!e.mediaInfos.length)return;const r=te(e.mediaInfos);Array.isArray(t.mediaInfos)?t.mediaInfos=[...t.mediaInfos,...r]:t.mediaInfos=r}_readPopupInfoElements({description:e,mediaInfos:t,popupElements:r}){const i={description:!1,mediaInfos:!1};return r.map(n=>n.type==="media"?(n.mediaInfos||!t||i.mediaInfos||(n.mediaInfos=t,i.mediaInfos=!0),fA.fromJSON(n)):n.type==="text"?(n.text||!e||i.description||(n.text=e,i.description=!0),q5.fromJSON(n)):n.type==="attachments"?dA.fromJSON(n):n.type==="fields"?j5.fromJSON(n):n.type==="expression"?Ere.fromJSON(n):void 0).filter(Boolean)}_readPopupInfo({description:e,mediaInfos:t,showAttachments:r}){const i=[];return e?i.push(new q5({text:e})):i.push(new j5),Array.isArray(t)&&t.length&&i.push(fA.fromJSON({mediaInfos:t})),r&&i.push(dA.fromJSON({displayType:"auto"})),i.length?i:e}_getContentElementFields(e){const t=e==null?void 0:e.type;if(t==="attachments")return[...this._extractFieldNames(e.title),...this._extractFieldNames(e.description)];if(t==="custom")return e.outFields||[];if(t==="fields")return[...this._extractFieldNames(e.title),...this._extractFieldNames(e.description),...this._getFieldInfoFields(e.fieldInfos||this.fieldInfos)];if(t==="media"){const r=e.mediaInfos||[];return[...this._extractFieldNames(e.title),...this._extractFieldNames(e.description),...r.reduce((i,n)=>[...i,...this._getMediaInfoFields(n)],[])]}return t==="text"?this._extractFieldNames(e.text):[]}_getMediaInfoFields(e){const{caption:t,title:r,value:i}=e,n=i||{},{fields:s=[],normalizeField:a,tooltipField:o,sourceURL:l,linkURL:c}=n,u=[...this._extractFieldNames(r),...this._extractFieldNames(t),...this._extractFieldNames(l),...this._extractFieldNames(c),...s];return a&&u.push(a),o&&u.push(o),u}_getContentExpressionInfos(e,t){return Array.isArray(e)?e.reduce((r,i)=>[...r,...i.type==="expression"&&i.expressionInfo?[i.expressionInfo]:[]],t):[]}_getContentFields(e){return typeof e=="string"?this._extractFieldNames(e):Array.isArray(e)?e.reduce((t,r)=>[...t,...this._getContentElementFields(r)],[]):[]}async _collectExpressionInfoFields(e,t,r){r&&await Promise.all(r.map(i=>uc(e,t,i.expression)))}_getFieldInfoFields(e){return e?e.filter(t=>t.visible===void 0||!!t.visible).map(t=>t.fieldName).filter(t=>!t.includes("relationships/")&&!t.includes("expression/")):[]}_getActionsFields(e){return e?e.toArray().reduce((t,r)=>[...t,...this._getActionFields(r)],[]):[]}_getActionFields(e){const{className:t,title:r,type:i}=e,n=i==="button"||i==="toggle"?e.image:"";return[...this._extractFieldNames(r),...this._extractFieldNames(t),...this._extractFieldNames(n)]}_getTitleFields(e){return typeof e=="string"?this._extractFieldNames(e):[]}_extractFieldNames(e){if(!e||typeof e!="string")return[];const t=/{[^}]*}/g,r=e.match(t);if(!r)return[];const i=/\{(\w+):.+\}/,n=r.filter(s=>!(s.indexOf("{relationships/")===0||s.indexOf("{expression/")===0)).map(s=>s.replace(i,"{$1}"));return n?n.map(s=>s.slice(1,-1)):[]}};d([f({type:XUe})],qs.prototype,"actions",void 0),d([f()],qs.prototype,"content",void 0),d([Xt("content")],qs.prototype,"castContent",null),d([$e("content",["description","fieldInfos","popupElements","mediaInfos","showAttachments"])],qs.prototype,"readContent",null),d([Xe("content",{popupElements:{type:lt.ofType(qUe)},showAttachments:{type:Boolean},mediaInfos:{type:lt.ofType(uxe)},description:{type:String}})],qs.prototype,"writeContent",null),d([f({type:[hxe],json:{write:!0}})],qs.prototype,"expressionInfos",void 0),d([f({type:[JR]})],qs.prototype,"fieldInfos",void 0),d([Xe("fieldInfos")],qs.prototype,"writeFieldInfos",null),d([f({type:HUe})],qs.prototype,"layerOptions",void 0),d([Xe("layerOptions")],qs.prototype,"writeLayerOptions",null),d([f({type:Boolean,json:{read:{source:"showLastEditInfo"},write:{target:"showLastEditInfo"},default:!0}})],qs.prototype,"lastEditInfoEnabled",void 0),d([f()],qs.prototype,"outFields",void 0),d([f()],qs.prototype,"overwriteActions",void 0),d([f()],qs.prototype,"returnGeometry",void 0),d([f({json:{type:String}})],qs.prototype,"title",void 0),d([Xe("title")],qs.prototype,"writeTitle",null),d([f({type:WUe,json:{write:!0}})],qs.prototype,"relatedRecordsInfo",void 0),qs=nY=d([$(mxe)],qs);const _x=qs,Kce=new tr({esriSMS:"simple-marker",esriPMS:"picture-marker",esriSLS:"simple-line",esriSFS:"simple-fill",esriPFS:"picture-fill",esriTS:"text",esriSHD:"shield-label-symbol",PointSymbol3D:"point-3d",LineSymbol3D:"line-3d",PolygonSymbol3D:"polygon-3d",WebStyleSymbol:"web-style",MeshSymbol3D:"mesh-3d",LabelSymbol3D:"label-3d",CIMSymbolReference:"cim"});let JUe=0,rS=class extends ge{constructor(e){super(e),this.id="sym"+JUe++,this.type=null,this.color=new Te([0,0,0,1])}readColor(e){return e&&e[0]!=null?[e[0],e[1],e[2],e[3]/255]:e}async collectRequiredFields(e,t){}hash(){return JSON.stringify(this.toJSON())}clone(){}};d([f({type:Kce.apiValues,readOnly:!0,json:{read:!1,write:{ignoreOrigin:!0,writer:Kce.write}}})],rS.prototype,"type",void 0),d([f({type:Te,json:{write:{allowNull:!0}}})],rS.prototype,"color",void 0),d([$e("color")],rS.prototype,"readColor",null),rS=d([$("esri.symbols.Symbol")],rS);const yc=rS;var sY;let Wb=sY=class extends yc{constructor(e){super(e),this.data=null,this.type="cim"}readData(e,t){return t}writeData(e,t){if(e)for(const r in e)t[r]=e[r]}async collectRequiredFields(e,t){if(this.data.type==="CIMSymbolReference"){const r=this.data.primitiveOverrides;if(r){const i=r.map(n=>{const s=n.valueExpressionInfo;return uc(e,t,s.expression)});await Promise.all(i)}}}clone(){return new sY({data:te(this.data)})}hash(){return Ste(JSON.stringify(this.data)).toString()}};d([f({json:{write:!1}})],Wb.prototype,"color",void 0),d([f({json:{write:!0}})],Wb.prototype,"data",void 0),d([$e("data",["symbol"])],Wb.prototype,"readData",null),d([Xe("data",{})],Wb.prototype,"writeData",null),d([Ze({CIMSymbolReference:"cim"},{readOnly:!0})],Wb.prototype,"type",void 0),Wb=sY=d([$("esri.symbols.CIMSymbol")],Wb);const e6=Wb;let iS=class extends ge{constructor(e){super(e),this.enabled=!0,this.type=null}writeEnabled(e,t,r){e||(t[r]=e)}};d([f({type:Boolean,json:{read:{source:"enable"},write:{target:"enable"}}})],iS.prototype,"enabled",void 0),d([Xe("enabled")],iS.prototype,"writeEnabled",null),d([f({type:["icon","object","line","path","fill","water","extrude","text"],readOnly:!0})],iS.prototype,"type",void 0),iS=d([$("esri.symbols.Symbol3DLayer")],iS);const Am=iS,KUe=/^-?(\d+(\.\d+)?)\s*((px)|(pt))?$/i,eBe="screenUtils.toPt: input not recognized!",gxe=96;function ur(e){return e?e/72*gxe:0}function zs(e){return e?72*e/gxe:0}function Xr(e){if(typeof e=="string"){const t=e.match(KUe);if(t){const r=Number(t[1]),i=t[3]&&t[3].toLowerCase(),n=e.charAt(0)==="-",s=i==="px"?zs(r):r;return n?-s:s}return console.warn(eBe),null}return e}function Su(e=0,t=0){return{x:e,y:t}}function tn(e=0,t=0){return[e,t]}function tBe(e=0,t=0){return[e,t]}function ro(e=0,t=0,r=0){return[e,t,r]}function pIt(e){return e}function mIt(e){return e}function gIt(e){return e}function qg(e,t){return t?(t[0]=e.x,t[1]=e.y,t.length>2&&(t[2]=0),t):[e.x,e.y]}function rBe(e,t){const r=t.transparency!=null?F5(t.transparency):1,i=t.color;return i&&Array.isArray(i)?new Te([i[0]||0,i[1]||0,i[2]||0,r]):null}function iBe(e,t){t.color=e.toJSON().slice(0,3);const r=gV(e.a);r!==0&&(t.transparency=r)}const Gy={type:Te,json:{type:[$i],default:null,read:{source:["color","transparency"],reader:rBe},write:{target:{color:{type:[$i]},transparency:{type:$i}},writer:iBe}}},dm={type:Number,cast:Xr,json:{write:!0}};let T2=class extends ge{constructor(e){super(e),this.color=new Te([0,0,0,1]),this.extensionLength=0,this.size=zs(1)}clone(){}cloneProperties(){return{color:te(this.color),size:this.size,extensionLength:this.extensionLength}}};d([f({type:["solid","sketch"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],T2.prototype,"type",void 0),d([f(Gy)],T2.prototype,"color",void 0),d([f({...dm,json:{write:{overridePolicy:e=>({enabled:!!e})}}})],T2.prototype,"extensionLength",void 0),d([f(dm)],T2.prototype,"size",void 0),T2=d([$("esri.symbols.edges.Edges3D")],T2);const Rre=T2;var aY;let rL=aY=class extends Rre{constructor(e){super(e),this.type="sketch"}clone(){return new aY(this.cloneProperties())}};d([Ze({sketch:"sketch"},{readOnly:!0})],rL.prototype,"type",void 0),rL=aY=d([$("esri.symbols.edges.SketchEdges3D")],rL);const yxe=rL;var oY;let iL=oY=class extends Rre{constructor(e){super(e),this.type="solid"}clone(){return new oY(this.cloneProperties())}};d([Ze({solid:"solid"},{readOnly:!0})],iL.prototype,"type",void 0),iL=oY=d([$("esri.symbols.support.SolidEdges3D")],iL);const bxe=iL,vxe={types:{key:"type",base:Rre,typeMap:{solid:bxe,sketch:yxe}},json:{write:!0}};var lY;let yu=lY=class extends ge{constructor(e){super(e),this.color=null}clone(){const e={color:_(this.color)?this.color.clone():null};return new lY(e)}};d([f(Gy)],yu.prototype,"color",void 0),yu=lY=d([$("esri.symbols.support.Symbol3DMaterial")],yu);var cY;let Xb=cY=class extends Am{constructor(e){super(e),this.type="extrude",this.size=1,this.material=null,this.castShadows=!0,this.edges=null}clone(){return new cY({edges:this.edges&&this.edges.clone(),enabled:this.enabled,material:_(this.material)?this.material.clone():null,castShadows:this.castShadows,size:this.size})}};d([Ze({Extrude:"extrude"},{readOnly:!0})],Xb.prototype,"type",void 0),d([f({type:Number,json:{write:{enabled:!0,isRequired:!0}},nonNullable:!0})],Xb.prototype,"size",void 0),d([f({type:yu,json:{write:!0}})],Xb.prototype,"material",void 0),d([f({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],Xb.prototype,"castShadows",void 0),d([f(vxe)],Xb.prototype,"edges",void 0),Xb=cY=d([$("esri.symbols.ExtrudeSymbol3DLayer")],Xb);const Ore=Xb;let yE=class extends yc{constructor(e){super(e),this.type="simple-line",this.width=.75}hash(){return`${this.type}.${this.width}`}};d([Ze({esriSLS:"simple-line"},{readOnly:!0})],yE.prototype,"type",void 0),d([f({type:Number,cast:Xr,json:{write:!0}})],yE.prototype,"width",void 0),yE=d([$("esri.symbols.LineSymbol")],yE);const nBe=yE,sBe=["begin","end","begin-end"],_xe=["arrow","circle","square","diamond","cross","x"];var dY;let u0=dY=class extends ge{constructor(e){super(e),this.placement="begin-end",this.type="line-marker",this.style="arrow"}writeStyle(e,t,r,i){t[r]=(i==null?void 0:i.origin)==="web-map"?"arrow":e}set color(e){this._set("color",e)}readColor(e){return e&&e[0]!=null?[e[0],e[1],e[2],e[3]/255]:e}writeColor(e,t,r,i){(i==null?void 0:i.origin)==="web-map"||(t[r]=e)}clone(){return new dY({color:te(this.color),placement:this.placement,style:this.style})}hash(){var e;return`${this.placement}.${(e=this.color)==null?void 0:e.hash()}.${this.style}`}};d([f({type:["begin","end","begin-end"],json:{write:!0}})],u0.prototype,"placement",void 0),d([Ze({"line-marker":"line-marker"},{readOnly:!0}),f({json:{origins:{"web-map":{write:!1}}}})],u0.prototype,"type",void 0),d([f({type:_xe})],u0.prototype,"style",void 0),d([Xe("style")],u0.prototype,"writeStyle",null),d([f({type:Te,value:null,json:{write:{allowNull:!0}}})],u0.prototype,"color",null),d([$e("color")],u0.prototype,"readColor",null),d([Xe("color")],u0.prototype,"writeColor",null),u0=dY=d([$("esri.symbols.LineSymbolMarker")],u0);const aBe=u0;var uY;const aG=new tr({esriSLSSolid:"solid",esriSLSDash:"dash",esriSLSDot:"dot",esriSLSDashDot:"dash-dot",esriSLSDashDotDot:"long-dash-dot-dot",esriSLSNull:"none",esriSLSInsideFrame:"inside-frame",esriSLSShortDash:"short-dash",esriSLSShortDot:"short-dot",esriSLSShortDashDot:"short-dash-dot",esriSLSShortDashDotDot:"short-dash-dot-dot",esriSLSLongDash:"long-dash",esriSLSLongDashDot:"long-dash-dot"});let sg=uY=class extends nBe{constructor(...e){super(...e),this.type="simple-line",this.style="solid",this.cap="round",this.join="round",this.marker=null,this.miterLimit=2}normalizeCtorArgs(e,t,r,i,n,s){if(e&&typeof e!="string")return e;const a={};return e!=null&&(a.style=e),t!=null&&(a.color=t),r!=null&&(a.width=Xr(r)),i!=null&&(a.cap=i),n!=null&&(a.join=n),s!=null&&(a.miterLimit=Xr(s)),a}clone(){var e;return new uY({color:te(this.color),style:this.style,width:this.width,cap:this.cap,join:this.join,miterLimit:this.miterLimit,marker:(e=this.marker)==null?void 0:e.clone()})}hash(){var e,t;return`${super.hash()}.${(e=this.color)==null?void 0:e.hash()}.${this.style}.${this.cap}.${this.join}.${this.miterLimit}.${(t=this.marker)==null?void 0:t.hash()}`}};d([Ze({esriSLS:"simple-line"},{readOnly:!0})],sg.prototype,"type",void 0),d([f({type:aG.apiValues,json:{read:aG.read,write:aG.write}})],sg.prototype,"style",void 0),d([f({type:["butt","round","square"],json:{write:{overridePolicy:(e,t,r)=>({enabled:e!=="round"&&(r==null||r.origin==null)})}}})],sg.prototype,"cap",void 0),d([f({type:["miter","round","bevel"],json:{write:{overridePolicy:(e,t,r)=>({enabled:e!=="round"&&(r==null||r.origin==null)})}}})],sg.prototype,"join",void 0),d([f({types:{key:"type",base:null,defaultKeyValue:"line-marker",typeMap:{"line-marker":aBe}},json:{write:!0,origins:{"web-scene":{write:!1}}}})],sg.prototype,"marker",void 0),d([f({type:Number,json:{read:!1,write:!1}})],sg.prototype,"miterLimit",void 0),sg=uY=d([$("esri.symbols.SimpleLineSymbol")],sg);const bc=sg;let bE=class extends yc{constructor(e){super(e),this.outline=null,this.type=null}hash(){return`${this.type}.${this.outline&&this.outline.hash()}`}};d([f({types:{key:"type",base:null,defaultKeyValue:"simple-line",typeMap:{"simple-line":bc}},json:{default:null,write:!0}})],bE.prototype,"outline",void 0),d([f({type:["simple-fill","picture-fill"],readOnly:!0})],bE.prototype,"type",void 0),bE=d([$("esri.symbols.FillSymbol")],bE);const wxe=bE;let nL=class extends ge{constructor(e){super(e)}clone(){}};d([f({type:["style"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],nL.prototype,"type",void 0),nL=d([$("esri.symbols.patterns.LinePattern3D")],nL);const xxe=nL,oBe=["dash","dash-dot","dot","long-dash","long-dash-dot","long-dash-dot-dot","none","short-dash","short-dash-dot","short-dash-dot-dot","short-dot","solid"];var hY;const lBe=uo()({dash:"dash","dash-dot":"dash-dot","dash-dot-dot":"long-dash-dot-dot",dot:"dot","long-dash":"long-dash","long-dash-dot":"long-dash-dot",null:"none","short-dash":"short-dash","short-dash-dot":"short-dash-dot","short-dash-dot-dot":"short-dash-dot-dot","short-dot":"short-dot",solid:"solid"});let vE=hY=class extends xxe{constructor(e){super(e),this.type="style",this.style="solid"}clone(){const e={style:this.style};return new hY(e)}};d([f({type:["style"]})],vE.prototype,"type",void 0),d([Ze(lBe),f({type:oBe})],vE.prototype,"style",void 0),vE=hY=d([$("esri.symbols.patterns.LineStylePattern3D")],vE);const Mre=vE;let sL=class extends ge{constructor(e){super(e)}clone(){}};d([f({type:["style"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],sL.prototype,"type",void 0),sL=d([$("esri.symbols.patterns.Pattern3D")],sL);const Txe=sL,cBe=["backward-diagonal","cross","diagonal-cross","forward-diagonal","horizontal","none","solid","vertical"];var fY;let _E=fY=class extends Txe{constructor(e){super(e),this.type="style",this.style="solid"}clone(){const e={style:this.style};return new fY(e)}};d([f({type:["style"]})],_E.prototype,"type",void 0),d([f({type:cBe,json:{read:!0,write:!0}})],_E.prototype,"style",void 0),_E=fY=d([$("esri.symbols.patterns.StylePattern3D")],_E);const Sxe=_E,dBe={types:{key:"type",base:Txe,typeMap:{style:Sxe}},json:{write:!0}},Exe={types:{key:"type",base:xxe,typeMap:{style:Mre}},json:{write:!0}},GC=new Te("white");new Te("black");const uBe=new Te([255,255,255,0]);function hBe(e){return e.r===0&&e.g===0&&e.b===0}var pY;let jC=pY=class extends yu{constructor(e){super(e),this.colorMixMode=null}clone(){const e={color:_(this.color)?this.color.clone():null,colorMixMode:this.colorMixMode};return new pY(e)}};d([Ze({multiply:"multiply",replace:"replace",tint:"tint"})],jC.prototype,"colorMixMode",void 0),jC=pY=d([$("esri.symbols.support.Symbol3DFillMaterial")],jC);function zt(e=gBe){return[e[0],e[1],e[2],e[3]]}function yIt(e){return[e[0],e[1],e[2],e[3]]}function Oy(e,t){return e!==t&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3]),e}function Pre(e,t,r,i,n=zt()){return n[0]=e,n[1]=t,n[2]=r,n[3]=i,n}function Cxe(e,t=zt()){return t[0]=e.xmin,t[1]=e.ymin,t[2]=e.xmax,t[3]=e.ymax,t}function xV(e,t){return new Zt({xmin:e[0],ymin:e[1],xmax:e[2],ymax:e[3],spatialReference:t})}function Y4(e,t){t[0]<e[0]&&(e[0]=t[0]),t[0]>e[2]&&(e[2]=t[0]),t[1]<e[1]&&(e[1]=t[1]),t[1]>e[3]&&(e[3]=t[1])}function nw(e,t,r){if(R(t))Oy(r,e);else if("length"in t)gY(t)?(r[0]=Math.min(e[0],t[0]),r[1]=Math.min(e[1],t[1]),r[2]=Math.max(e[2],t[2]),r[3]=Math.max(e[3],t[3])):t.length!==2&&t.length!==3||(r[0]=Math.min(e[0],t[0]),r[1]=Math.min(e[1],t[1]),r[2]=Math.max(e[2],t[0]),r[3]=Math.max(e[3],t[1]));else switch(t.type){case"extent":r[0]=Math.min(e[0],t.xmin),r[1]=Math.min(e[1],t.ymin),r[2]=Math.max(e[2],t.xmax),r[3]=Math.max(e[3],t.ymax);break;case"point":r[0]=Math.min(e[0],t.x),r[1]=Math.min(e[1],t.y),r[2]=Math.max(e[2],t.x),r[3]=Math.max(e[3],t.y)}}function oG(e,t,r=e){const i=t.length;let n=e[0],s=e[1],a=e[2],o=e[3];for(let l=0;l<i;l++){const c=t[l];n=Math.min(n,c[0]),s=Math.min(s,c[1]),a=Math.max(a,c[0]),o=Math.max(o,c[1])}return r[0]=n,r[1]=s,r[2]=a,r[3]=o,r}function mY(e){for(let t=0;t<4;t++)if(!isFinite(e[t]))return!1;return!0}function su(e){return R(e)||e[0]>=e[2]?0:e[2]-e[0]}function $p(e){return e[1]>=e[3]?0:e[3]-e[1]}function Axe(e){return su(e)*$p(e)}function Ire(e,t=[0,0]){return t[0]=(e[0]+e[2])/2,t[1]=(e[1]+e[3])/2,t}function Rxe(e,t){return $re(e,t[0],t[1])}function ede(e,t){const r=t[3],i=.5*(e[0]+e[2]),n=Math.abs(t[0]-i),s=.5*(e[2]-e[0]);if(n>r+s)return!1;const a=.5*(e[1]+e[3]),o=.5*(e[3]-e[1]),l=Math.abs(t[1]-a);if(l>r+o)return!1;if(n<s||l<o)return!0;const c=n-s,u=l-o;return c*c+u*u<=r*r}function bIt(e,t,r){const i=e[0],n=e[1],s=e[2],a=e[3],{x:o,y:l}=t,{x:c,y:u}=r,h=(w,v)=>(u-l)*w+(o-c)*v+(c*l-o*u)<0,p=h(i,a),m=h(s,a),g=h(s,n),b=h(i,n);return!(p===m&&m===g&&g===b&&b===p||o<i&&c<i||o>s&&c>s||l>a&&u>a||l<n&&u<n)}function vIt(e,t){return $re(e,t.x,t.y)}function $re(e,t,r){return t>=e[0]&&r>=e[1]&&t<=e[2]&&r<=e[3]}function wE(e,t,r,i){return t>=e[0]-i&&r>=e[1]-i&&t<=e[2]+i&&r<=e[3]+i}function fBe(e,t,r){return t[0]>=e[0]-r&&t[1]>=e[1]-r&&t[0]<=e[2]+r&&t[1]<=e[3]+r}function KR(e,t){return Math.max(t[0],e[0])<=Math.min(t[2],e[2])&&Math.max(t[1],e[1])<=Math.min(t[3],e[3])}function tde(e,t){return t[0]>=e[0]&&t[2]<=e[2]&&t[1]>=e[1]&&t[3]<=e[3]}function aL(e,t,r){if(R(t))return Oy(r,e);const i=t[0],n=t[1],s=t[2],a=t[3];return r[0]=Le(e[0],i,s),r[1]=Le(e[1],n,a),r[2]=Le(e[2],i,s),r[3]=Le(e[3],n,a),r}function pBe(e,t){const r=(e[0]+e[2])/2,i=(e[1]+e[3])/2,n=Math.max(Math.abs(t[0]-r)-su(e)/2,0),s=Math.max(Math.abs(t[1]-i)-$p(e)/2,0);return Math.sqrt(n*n+s*s)}function UF(e,t,r,i=e){return i[0]=e[0]+t,i[1]=e[1]+r,i[2]=e[2]+t,i[3]=e[3]+r,i}function Eu(e){return e?Oy(e,yY):zt(yY)}function gY(e){return e!=null&&e.length===4}function mBe(e){return!(su(e)!==0&&isFinite(e[0])||$p(e)!==0&&isFinite(e[1]))}function sw(e,t){return gY(e)&&gY(t)?e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]:e===t}const _It=[-1/0,-1/0,1/0,1/0],yY=[1/0,1/0,-1/0,-1/0],gBe=[0,0,0,0];function is(e=$xe){return[e[0],e[1],e[2],e[3],e[4],e[5]]}function Dw(e,t,r,i,n,s,a=is()){return a[0]=e,a[1]=t,a[2]=r,a[3]=i,a[4]=n,a[5]=s,a}function wIt(e,t){const r=isFinite(e[2])||isFinite(e[5]);return new Zt(r?{xmin:e[0],xmax:e[3],ymin:e[1],ymax:e[4],zmin:e[2],zmax:e[5],spatialReference:t}:{xmin:e[0],xmax:e[3],ymin:e[1],ymax:e[4],spatialReference:t})}function H5(e,t){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[2]=Math.min(e[2],t[2]),e[3]=Math.max(e[3],t[3]),e[4]=Math.max(e[4],t[4]),e[5]=Math.max(e[5],t[5])}function yBe(e,t){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[3]=Math.max(e[3],t[2]),e[4]=Math.max(e[4],t[3])}function um(e,t){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[2]=Math.min(e[2],t[2]),e[3]=Math.max(e[3],t[0]),e[4]=Math.max(e[4],t[1]),e[5]=Math.max(e[5],t[2])}function hu(e,t,r=0,i=t.length/3){let n=e[0],s=e[1],a=e[2],o=e[3],l=e[4],c=e[5];for(let u=0;u<i;u++)n=Math.min(n,t[r+3*u]),s=Math.min(s,t[r+3*u+1]),a=Math.min(a,t[r+3*u+2]),o=Math.max(o,t[r+3*u]),l=Math.max(l,t[r+3*u+1]),c=Math.max(c,t[r+3*u+2]);e[0]=n,e[1]=s,e[2]=a,e[3]=o,e[4]=l,e[5]=c}function lG(e,t,r){const i=t.length;let n=e[0],s=e[1],a=e[2],o=e[3],l=e[4],c=e[5];if(r)for(let u=0;u<i;u++){const h=t[u];n=Math.min(n,h[0]),s=Math.min(s,h[1]),a=Math.min(a,h[2]),o=Math.max(o,h[0]),l=Math.max(l,h[1]),c=Math.max(c,h[2])}else for(let u=0;u<i;u++){const h=t[u];n=Math.min(n,h[0]),s=Math.min(s,h[1]),o=Math.max(o,h[0]),l=Math.max(l,h[1])}e[0]=n,e[1]=s,e[2]=a,e[3]=o,e[4]=l,e[5]=c}function bBe(e){for(let t=0;t<6;t++)if(!isFinite(e[t]))return!1;return!0}function wx(e){return e[0]>=e[3]?0:e[3]-e[0]}function xx(e){return e[1]>=e[4]?0:e[4]-e[1]}function g_(e){return e[2]>=e[5]?0:e[5]-e[2]}function Oxe(e){const t=wx(e),r=g_(e),i=xx(e);return Math.sqrt(t*t+r*r+i*i)}function fp(e,t=[0,0,0]){return t[0]=e[0]+wx(e)/2,t[1]=e[1]+xx(e)/2,t[2]=e[2]+g_(e)/2,t}function $M(e,t=[0,0,0]){return t[0]=wx(e),t[1]=xx(e),t[2]=g_(e),t}function vBe(e){return Math.max(wx(e),g_(e),xx(e))}function Lre(e,t){return t[0]>=e[0]&&t[1]>=e[1]&&t[2]>=e[2]&&t[0]<=e[3]&&t[1]<=e[4]&&t[2]<=e[5]}function xIt(e,t){return t[0]>=e[0]&&t[1]>=e[1]&&t[2]>=e[2]&&t[3]<=e[3]&&t[4]<=e[4]&&t[5]<=e[5]}function _Be(e,t){return Math.max(t[0],e[0])<=Math.min(t[3],e[3])&&Math.max(t[1],e[1])<=Math.min(t[4],e[4])&&Math.max(t[2],e[2])<=Math.min(t[5],e[5])}function pp(e,t){return!!R(t)||_Be(e,t)}function Mxe(e,t,r,i,n=e){return n[0]=e[0]+t,n[1]=e[1]+r,n[2]=e[2]+i,n[3]=e[3]+t,n[4]=e[4]+r,n[5]=e[5]+i,n}function TIt(e,t,r=e){const i=e[0]+wx(e)/2,n=e[1]+xx(e)/2,s=e[2]+g_(e)/2;return r[0]=i+(e[0]-i)*t,r[1]=n+(e[1]-n)*t,r[2]=s+(e[2]-s)*t,r[3]=i+(e[3]-i)*t,r[4]=n+(e[4]-n)*t,r[5]=s+(e[5]-s)*t,r}function Pxe(e,t,r=e){return r[0]=t[0],r[1]=t[1],r[2]=t[2],r!==e&&(r[3]=e[3],r[4]=e[4],r[5]=e[5]),r}function Ixe(e,t,r=e){return r[3]=t[0],r[4]=t[1],r[5]=t[2],r!==e&&(r[0]=e[0],r[1]=e[1],r[2]=e[2]),e}function TV(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e}function bi(e){return e?TV(e,ide):is(ide)}function Dre(e,t){return t||(t=zt()),t[0]=e[0],t[1]=e[1],t[2]=e[3],t[3]=e[4],t}function SIt(e,t){return e[0]=t[0],e[1]=t[1],e[2]=Number.NEGATIVE_INFINITY,e[3]=t[2],e[4]=t[3],e[5]=Number.POSITIVE_INFINITY,e}function rde(e){return e.length===6}function SV(e){return wx(e)===0&&xx(e)===0&&g_(e)===0}function EIt(e,t,r){if(R(e)||R(t))return e===t;if(!rde(e)||!rde(t))return!1;if(r){for(let i=0;i<e.length;i++)if(!r(e[i],t[i]))return!1}else for(let i=0;i<e.length;i++)if(e[i]!==t[i])return!1;return!0}function wBe(e,t,r,i,n,s){return Dw(e,t,r,i,n,s,xBe)}const CIt=[-1/0,-1/0,-1/0,1/0,1/0,1/0],ide=[1/0,1/0,1/0,-1/0,-1/0,-1/0],$xe=[0,0,0,0,0,0],xBe=is();function cG(e,{isPrimitive:t,width:r,depth:i,height:n}){const s=t?10:1;if(r==null&&n==null&&i==null)return[s*e[0],s*e[1],s*e[2]];const a=Ve(r,i,n);let o;for(let l=0;l<3;l++){const c=a[l];if(c!=null){o=c/e[l];break}}for(let l=0;l<3;l++)a[l]==null&&(a[l]=e[l]*o);return a}const TBe=Dw(-.5,-.5,-.5,.5,.5,.5),SBe=Dw(-.5,-.5,0,.5,.5,1),EBe=Dw(-.5,-.5,0,.5,.5,.5);function CBe(e){switch(e){case"sphere":case"cube":case"diamond":return TBe;case"cylinder":case"cone":case"inverted-cone":return SBe;case"tetrahedron":return EBe;default:return}}const Fre=["butt","square","round"],ABe=[...Fre,"none"],Lxe=["miter","bevel","round"];var bY;let S2=bY=class extends ge{constructor(e){super(e),this.color=new Te([0,0,0,1]),this.size=zs(1),this.pattern=null,this.patternCap="butt"}clone(){const e={color:_(this.color)?this.color.clone():null,size:this.size,pattern:_(this.pattern)?this.pattern.clone():null,patternCap:this.patternCap};return new bY(e)}};d([f(Gy)],S2.prototype,"color",void 0),d([f(dm)],S2.prototype,"size",void 0),d([f(Exe)],S2.prototype,"pattern",void 0),d([f({type:Fre,json:{default:"butt",write:{overridePolicy(){return{enabled:_(this.pattern)}}}}})],S2.prototype,"patternCap",void 0),S2=bY=d([$("esri.symbols.support.Symbol3DOutline")],S2);var oL;let ag=oL=class extends Am{constructor(e){super(e),this.type="fill",this.material=null,this.pattern=null,this.castShadows=!0,this.outline=null,this.edges=null}clone(){const e={edges:_(this.edges)?this.edges.clone():null,enabled:this.enabled,material:_(this.material)?this.material.clone():null,pattern:_(this.pattern)?this.pattern.clone():null,castShadows:this.castShadows,outline:_(this.outline)?this.outline.clone():null};return new oL(e)}static fromSimpleFillSymbol(e){var i,n,s,a,o,l;const t=e.outline&&e.outline.style&&e.outline.style!=="inside-frame"&&e.outline.style!=="solid"?new Mre({style:e.outline.style}):null,r={size:(n=(i=e.outline)==null?void 0:i.width)!=null?n:0,color:((a=(s=e.outline)==null?void 0:s.color)!=null?a:GC).clone(),pattern:t};return t&&((o=e.outline)==null?void 0:o.cap)&&(r.patternCap=e.outline.cap),new oL({material:new jC({color:((l=e.color)!=null?l:uBe).clone()}),pattern:e.style&&e.style!=="solid"?new Sxe({style:e.style}):null,outline:r})}};d([Ze({Fill:"fill"},{readOnly:!0})],ag.prototype,"type",void 0),d([f({type:jC,json:{write:!0}})],ag.prototype,"material",void 0),d([f(dBe)],ag.prototype,"pattern",void 0),d([f({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],ag.prototype,"castShadows",void 0),d([f({type:S2,json:{write:!0}})],ag.prototype,"outline",void 0),d([f(vxe)],ag.prototype,"edges",void 0),ag=oL=d([$("esri.symbols.FillSymbol3DLayer")],ag);const W5=ag,RBe=["none","underline","line-through"],OBe=["normal","italic","oblique"],MBe=["normal","lighter","bold","bolder"],Dxe={type:Number,cast:e=>{const t=Eh(e);return t===0?1:Le(t,.1,4)},nonNullable:!0},PBe=["left","right","center"],IBe=["baseline","top","middle","bottom"],Fxe={type:PBe,nonNullable:!0},Nxe={type:IBe,nonNullable:!0};var vY;let og=vY=class extends ge{constructor(e){super(e),this.decoration="none",this.family="sans-serif",this.size=9,this.style="normal",this.weight="normal"}castSize(e){return Xr(e)}clone(){return new vY({decoration:this.decoration,family:this.family,size:this.size,style:this.style,weight:this.weight})}hash(){return`${this.decoration}.${this.family}.${this.size}.${this.style}.${this.weight}`}};d([f({type:RBe,json:{default:"none",write:!0}})],og.prototype,"decoration",void 0),d([f({type:String,json:{write:!0}})],og.prototype,"family",void 0),d([f({type:Number,json:{write:{overridePolicy:(e,t,r)=>({enabled:!r||!r.textSymbol3D})}}})],og.prototype,"size",void 0),d([Xt("size")],og.prototype,"castSize",null),d([f({type:OBe,json:{default:"normal",write:!0}})],og.prototype,"style",void 0),d([f({type:MBe,json:{default:"normal",write:!0}})],og.prototype,"weight",void 0),og=vY=d([$("esri.symbols.Font")],og);const EV=og;function My(e,t){const r=t&&t.url&&t.url.path;if(e&&r&&(e=Fh(e,r,{preserveProtocolRelative:!0}),t.portalItem&&t.readResourcePaths)){const i=Ute(e,t.portalItem.itemUrl);LBe.test(i)&&t.readResourcePaths.push(t.portalItem.resourceFromPath(i).path)}return _Y(e,t&&t.portal)}function Py(e,t,r=X5.YES){if(!e)return e;!cd(e)&&t&&t.blockedRelativeUrls&&t.blockedRelativeUrls.push(e);let i=Fh(e);if(t){const n=t.verifyItemRelativeUrls&&t.verifyItemRelativeUrls.rootPath||t.url&&t.url.path;if(n){const s=_Y(n,t.portal);i=Ute(_Y(i,t.portal),s,s),i!==e&&t.verifyItemRelativeUrls&&t.verifyItemRelativeUrls.writtenUrls.push(i)}}return i=Vxe(i,t&&t.portal),cd(i)&&(i=zh(i)),(t==null?void 0:t.resources)&&(t==null?void 0:t.portalItem)&&!cd(i)&&!Tm(i)&&r===X5.YES&&t.resources.toKeep.push({resource:t.portalItem.resourceFromPath(i)}),i}function CV(e,t,r){return My(e,r)}function Xv(e,t,r,i){const n=Py(e,i);n!==void 0&&(t[r]=n)}const $Be=/\/items\/([^\/]+)\/resources\//,LBe=/^\.\/resources\//;function kxe(e){const t=_(e)?e.match($Be):null;return _(t)?t[1]:null}function Vxe(e,t){return t&&!t.isPortal&&t.urlKey&&t.customBaseUrl?hX(e,`${t.urlKey}.${t.customBaseUrl}`,t.portalHostname):e}function _Y(e,t){if(!t||t.isPortal||!t.urlKey||!t.customBaseUrl)return e;const r=`${t.urlKey}.${t.customBaseUrl}`,i=kte();return iA(i,`${i.scheme}://${r}`)?hX(e,t.portalHostname,r):hX(e,r,t.portalHostname)}var X5;(function(e){e[e.YES=0]="YES",e[e.NO=1]="NO"})(X5||(X5={}));const DBe=Object.freeze(Object.defineProperty({__proto__:null,fromJSON:My,toJSON:Py,read:CV,write:Xv,itemIdFromResourceUrl:kxe,ensureMainOnlineDomain:Vxe,get MarkKeep(){return X5}},Symbol.toStringTag,{value:"Module"}));var wY;const FBe=uo()({circle:"circle",square:"square",cross:"cross",x:"x",kite:"kite",triangle:"triangle"});let E2=wY=class extends ge{constructor(e){super(e)}readHref(e,t,r){return e?My(e,r):t.dataURI}writeHref(e,t,r,i){e&&(Tm(e)?t.dataURI=e:(t.href=Py(e,i),cd(t.href)&&(t.href=zh(t.href))))}clone(){return new wY({href:this.href,primitive:this.primitive})}};d([f({type:String,json:{write:!0,read:{source:["href","dataURI"]}}})],E2.prototype,"href",void 0),d([$e("href")],E2.prototype,"readHref",null),d([Xe("href",{href:{type:String},dataURI:{type:String}})],E2.prototype,"writeHref",null),d([Ze(FBe)],E2.prototype,"primitive",void 0),E2=wY=d([$("esri.symbols.support.IconSymbol3DLayerResource")],E2);const zxe="circle";var xY;let d4=xY=class extends xe{constructor(){super(...arguments),this.x=0,this.y=0}clone(){return new xY({x:this.x,y:this.y})}};d([f({type:Number})],d4.prototype,"x",void 0),d([f({type:Number})],d4.prototype,"y",void 0),d4=xY=d([$("esri.symbols.support.Symbol3DAnchorPosition2D")],d4);var TY;let xE=TY=class extends ge{constructor(e){super(e),this.color=new Te([0,0,0,1]),this.size=zs(1)}clone(){const e={color:_(this.color)?this.color.clone():null,size:this.size};return new TY(e)}};d([f(Gy)],xE.prototype,"color",void 0),d([f(dm)],xE.prototype,"size",void 0),xE=TY=d([$("esri.symbols.support.Symbol3DIconOutline")],xE);var nS;const NBe=fe.getLogger("esri.symbols.IconSymbol3DLayer");let h0=nS=class extends Am{constructor(e){super(e),this.material=null,this.resource=null,this.type="icon",this.size=12,this.anchor="center",this.anchorPosition=void 0,this.outline=void 0}clone(){return new nS({anchor:this.anchor,anchorPosition:this.anchorPosition&&this.anchorPosition.clone(),enabled:this.enabled,material:_(this.material)?this.material.clone():null,outline:_(this.outline)?this.outline.clone():null,resource:this.resource&&this.resource.clone(),size:this.size})}static fromSimpleMarkerSymbol(e){const t=e.color||GC,r=nde(e),i=e.outline&&e.outline.width>0?{size:e.outline.width,color:(e.outline.color||GC).clone()}:null;return new nS({size:e.size,resource:{primitive:VBe(e.style)},material:{color:t},outline:i,anchor:r?"relative":void 0,anchorPosition:r})}static fromPictureMarkerSymbol(e){const t=!e.color||hBe(e.color)?GC:e.color,r=nde(e);return new nS({size:e.width<=e.height?e.height:e.width,resource:{href:e.url},material:{color:t.clone()},anchor:r?"relative":void 0,anchorPosition:r})}static fromCIMSymbol(e){return new nS({resource:{href:L3e({mediaType:"application/json",data:JSON.stringify(e.data)})}})}};function nde(e){const t="width"in e?e.width:e.size,r="height"in e?e.height:e.size,i=sde(e.xoffset),n=sde(e.yoffset);return(i||n)&&t&&r?{x:-i/t,y:n/r}:null}function sde(e){return isFinite(e)?e:0}d([f({type:yu,json:{write:!0}})],h0.prototype,"material",void 0),d([f({type:E2,json:{write:!0}})],h0.prototype,"resource",void 0),d([Ze({Icon:"icon"},{readOnly:!0})],h0.prototype,"type",void 0),d([f(dm)],h0.prototype,"size",void 0),d([Ze({center:"center",left:"left",right:"right",top:"top",bottom:"bottom",topLeft:"top-left",topRight:"top-right",bottomLeft:"bottom-left",bottomRight:"bottom-right",relative:"relative"}),f({json:{default:"center"}})],h0.prototype,"anchor",void 0),d([f({type:d4,json:{type:[Number],read:{reader:e=>new d4({x:e[0],y:e[1]})},write:{writer:(e,t)=>{t.anchorPosition=[e.x,e.y]},overridePolicy(){return{enabled:this.anchor==="relative"}}}}})],h0.prototype,"anchorPosition",void 0),d([f({type:xE,json:{write:!0}})],h0.prototype,"outline",void 0),h0=nS=d([$("esri.symbols.IconSymbol3DLayer")],h0);const kBe={circle:"circle",cross:"cross",diamond:"kite",square:"square",x:"x",triangle:"triangle",path:null};function VBe(e){return kBe[e]||(NBe.warn(`${e} cannot be mapped to Icon symbol. Fallback to "circle"`),"circle")}const Qg=h0;let C2=class extends yd(ge){constructor(e){super(e),this.type="style",this.placement="begin-end",this.style="arrow",this.color=null}equals(e){return _(e)&&e.placement===this.placement&&e.style===this.style&&(R(this.color)&&R(e.color)||_(this.color)&&_(e.color)&&this.color.toJSON()===e.color.toJSON())}};d([f({type:["style"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],C2.prototype,"type",void 0),d([f({type:sBe,json:{default:"begin-end",write:!0}})],C2.prototype,"placement",void 0),d([f({type:_xe,json:{default:"arrow",write:!0}})],C2.prototype,"style",void 0),d([f({type:Te,json:{type:[$i],default:null,write:!0}})],C2.prototype,"color",void 0),C2=d([$("esri.symbols.LineStyleMarker3D")],C2);const SY=C2;var lL;let f0=lL=class extends Am{constructor(e){super(e),this.material=null,this.type="line",this.join="miter",this.cap="butt",this.size=zs(1),this.pattern=null,this.marker=null}clone(){const e={enabled:this.enabled,material:_(this.material)?this.material.clone():null,size:this.size,join:this.join,cap:this.cap,pattern:_(this.pattern)?this.pattern.clone():null,marker:_(this.marker)?this.marker.clone():null};return new lL(e)}static fromSimpleLineSymbol(e){var r,i,n;const t={enabled:!0,size:(r=e.width)!=null?r:zs(1),cap:e.cap||"butt",join:e.join||"miter",pattern:e.style&&e.style!=="inside-frame"?new Mre({style:e.style}):null,material:new yu({color:(e.color||GC).clone()}),marker:e.marker?new SY({placement:e.marker.placement,style:e.marker.style,color:(n=(i=e.marker.color)==null?void 0:i.clone())!=null?n:null}):null};return new lL(t)}};d([f({type:yu,json:{write:!0}})],f0.prototype,"material",void 0),d([Ze({Line:"line"},{readOnly:!0})],f0.prototype,"type",void 0),d([f({type:Lxe,json:{write:!0,default:"miter"}})],f0.prototype,"join",void 0),d([f({type:Fre,json:{write:!0,default:"butt"}})],f0.prototype,"cap",void 0),d([f(dm)],f0.prototype,"size",void 0),d([f(Exe)],f0.prototype,"pattern",void 0),d([f({types:{key:"type",base:SY,typeMap:{style:SY}},json:{write:!0}})],f0.prototype,"marker",void 0),f0=lL=d([$("esri.symbols.LineSymbol3DLayer")],f0);const t6=f0;var EY;const zBe=uo()({sphere:"sphere",cylinder:"cylinder",cube:"cube",cone:"cone",diamond:"diamond",tetrahedron:"tetrahedron",invertedCone:"inverted-cone"});let TE=EY=class extends ge{clone(){return new EY({href:this.href,primitive:this.primitive})}};d([f({type:String,json:{read:CV,write:Xv}})],TE.prototype,"href",void 0),d([Ze(zBe)],TE.prototype,"primitive",void 0),TE=EY=d([$("esri.symbols.support.ObjectSymbol3DLayerResource")],TE);const Nre="sphere";var CY;let g3=CY=class extends xe{constructor(){super(...arguments),this.x=0,this.y=0,this.z=0}clone(){return new CY({x:this.x,y:this.y,z:this.z})}};d([f({type:Number})],g3.prototype,"x",void 0),d([f({type:Number})],g3.prototype,"y",void 0),d([f({type:Number})],g3.prototype,"z",void 0),g3=CY=d([$("esri.symbols.support.Symbol3DAnchorPosition3D")],g3);var AY;let Wo=AY=class extends Am{constructor(e){super(e),this.material=null,this.castShadows=!0,this.resource=null,this.type="object",this.width=void 0,this.height=void 0,this.depth=void 0,this.anchor=void 0,this.anchorPosition=void 0,this.heading=void 0,this.tilt=void 0,this.roll=void 0}clone(){return new AY({heading:this.heading,tilt:this.tilt,roll:this.roll,anchor:this.anchor,anchorPosition:this.anchorPosition&&this.anchorPosition.clone(),depth:this.depth,enabled:this.enabled,height:this.height,material:_(this.material)?this.material.clone():null,castShadows:this.castShadows,resource:this.resource&&this.resource.clone(),width:this.width})}get isPrimitive(){return!this.resource||typeof this.resource.href!="string"}};d([f({type:yu,json:{write:!0}})],Wo.prototype,"material",void 0),d([f({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],Wo.prototype,"castShadows",void 0),d([f({type:TE,json:{write:!0}})],Wo.prototype,"resource",void 0),d([Ze({Object:"object"},{readOnly:!0})],Wo.prototype,"type",void 0),d([f({type:Number,json:{write:!0}})],Wo.prototype,"width",void 0),d([f({type:Number,json:{write:!0}})],Wo.prototype,"height",void 0),d([f({type:Number,json:{write:!0}})],Wo.prototype,"depth",void 0),d([Ze({center:"center",top:"top",bottom:"bottom",origin:"origin",relative:"relative"}),f({json:{default:"origin"}})],Wo.prototype,"anchor",void 0),d([f({type:g3,json:{type:[Number],read:{reader:e=>new g3({x:e[0],y:e[1],z:e[2]})},write:{writer:(e,t)=>{t.anchorPosition=[e.x,e.y,e.z]},overridePolicy(){return{enabled:this.anchor==="relative"}}}}})],Wo.prototype,"anchorPosition",void 0),d([f({type:Number,json:{write:!0}})],Wo.prototype,"heading",void 0),d([f({type:Number,json:{write:!0}})],Wo.prototype,"tilt",void 0),d([f({type:Number,json:{write:!0}})],Wo.prototype,"roll",void 0),d([f({readOnly:!0})],Wo.prototype,"isPrimitive",null),Wo=AY=d([$("esri.symbols.ObjectSymbol3DLayer")],Wo);const AV=Wo;var RY;let Dl=RY=class extends Am{constructor(e){super(e),this.material=null,this.castShadows=!0,this.type="path",this.profile="circle",this.join="miter",this.cap="butt",this.width=void 0,this.height=void 0,this.anchor="center",this.profileRotation="all"}readWidth(e,t){return e!=null?e:t.height==null&&t.size!=null?t.size:void 0}readHeight(e,t){return e!=null?e:t.width==null&&t.size!=null?t.size:void 0}clone(){return new RY({enabled:this.enabled,material:_(this.material)?this.material.clone():null,castShadows:this.castShadows,profile:this.profile,join:this.join,cap:this.cap,width:this.width,height:this.height,profileRotation:this.profileRotation,anchor:this.anchor})}};d([f({type:yu,json:{write:!0}})],Dl.prototype,"material",void 0),d([f({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],Dl.prototype,"castShadows",void 0),d([Ze({Path:"path"},{readOnly:!0})],Dl.prototype,"type",void 0),d([f({type:["circle","quad"],json:{write:!0,default:"circle"}})],Dl.prototype,"profile",void 0),d([f({type:Lxe,json:{write:!0,default:"miter"}})],Dl.prototype,"join",void 0),d([f({type:ABe,json:{write:!0,default:"butt"}})],Dl.prototype,"cap",void 0),d([f({type:Number,json:{write:{enabled:!0,target:{width:{type:Number},size:{type:Number}}}}})],Dl.prototype,"width",void 0),d([$e("width",["width","size","height"])],Dl.prototype,"readWidth",null),d([f({type:Number,json:{write:!0}})],Dl.prototype,"height",void 0),d([$e("height",["height","size","width"])],Dl.prototype,"readHeight",null),d([f({type:["center","bottom","top"],json:{write:!0,default:"center"}})],Dl.prototype,"anchor",void 0),d([f({type:["heading","all"],json:{write:!0,default:"all"}})],Dl.prototype,"profileRotation",void 0),Dl=RY=d([$("esri.symbols.PathSymbol3DLayer")],Dl);const RV=Dl;var OY;let u4=OY=class extends ge{constructor(){super(...arguments),this.color=new Te([0,0,0,1]),this.size=0}clone(){const e={color:te(this.color),size:this.size};return new OY(e)}};d([f(Gy)],u4.prototype,"color",void 0),d([f(dm)],u4.prototype,"size",void 0),u4=OY=d([$("esri.symbols.support.Symbol3DHalo")],u4);let qC=class extends yd(ge){constructor(e){super(e),this.color=null}};d([f(Gy)],qC.prototype,"color",void 0),qC=d([$("esri.symbols.support.Symbol3DTextBackground")],qC);var cL;let Rc=cL=class extends Am{constructor(e){super(e),this._userSize=void 0,this.halo=null,this.horizontalAlignment="center",this.lineHeight=1,this.material=null,this.background=null,this.text=null,this.type="text",this.verticalAlignment="baseline"}get font(){return this._get("font")||null}set font(e){_(e)&&_(this._userSize)&&(e.size=this._userSize),this._set("font",e)}writeFont(e,t,r,i){const n={...i,textSymbol3D:!0};t.font=e.write({},n),delete t.font.size}get size(){return _(this._userSize)?this._userSize:_(this.font)&&this.font.size!=null?this.font.size:9}set size(e){this._userSize=e,_(this.font)&&(this.font.size=this._userSize),this.notifyChange("size")}clone(){const e=new cL({enabled:this.enabled,font:this.font&&te(this.font),halo:this.halo&&te(this.halo),horizontalAlignment:this.horizontalAlignment,lineHeight:this.lineHeight,material:_(this.material)?this.material.clone():null,text:this.text,verticalAlignment:this.verticalAlignment,background:te(this.background)});return e._userSize=this._userSize,e}static fromTextSymbol(e){return new cL({font:_(e.font)?e.font.clone():new EV,halo:UBe(e.haloColor,e.haloSize),horizontalAlignment:e.horizontalAlignment,lineHeight:e.lineHeight,material:e.color?new yu({color:e.color.clone()}):null,text:e.text,verticalAlignment:e.verticalAlignment,background:e.backgroundColor?new qC({color:e.backgroundColor.clone()}):null})}};function UBe(e,t){return e&&t>0?new u4({color:te(e),size:t}):null}d([f({type:EV,json:{write:!0}})],Rc.prototype,"font",null),d([Xe("font")],Rc.prototype,"writeFont",null),d([f({type:u4,json:{write:!0}})],Rc.prototype,"halo",void 0),d([f({...Fxe,json:{default:"center",write:!0}})],Rc.prototype,"horizontalAlignment",void 0),d([f({...Dxe,json:{default:1,write:!0}})],Rc.prototype,"lineHeight",void 0),d([f({type:yu,json:{write:!0}})],Rc.prototype,"material",void 0),d([f({type:qC,json:{write:!0}})],Rc.prototype,"background",void 0),d([f(dm)],Rc.prototype,"size",null),d([f({type:String,json:{write:!0}})],Rc.prototype,"text",void 0),d([Ze({Text:"text"},{readOnly:!0})],Rc.prototype,"type",void 0),d([f({...Nxe,json:{default:"baseline",write:!0}})],Rc.prototype,"verticalAlignment",void 0),Rc=cL=d([$("esri.symbols.TextSymbol3DLayer")],Rc);const Tx=Rc;var MY;let Yb=MY=class extends Am{constructor(e){super(e),this.color=PY.clone(),this.type="water",this.waterbodySize="medium",this.waveDirection=null,this.waveStrength="moderate"}clone(){return new MY({color:te(this.color),waterbodySize:this.waterbodySize,waveDirection:this.waveDirection,waveStrength:this.waveStrength})}};d([f({type:Te,nonNullable:!0,json:{type:[$i],write:(e,t,r)=>t[r]=e.toArray(Te.AlphaMode.UNLESS_OPAQUE),default:()=>PY.clone(),defaultEquals:e=>e.toCss(!0)===PY.toCss(!0)}})],Yb.prototype,"color",void 0),d([Ze({Water:"water"},{readOnly:!0})],Yb.prototype,"type",void 0),d([f({type:["small","medium","large"],json:{write:!0,default:"medium"}})],Yb.prototype,"waterbodySize",void 0),d([f({type:Number,json:{write:!0,default:null}})],Yb.prototype,"waveDirection",void 0),d([f({type:["calm","rippled","slight","moderate"],json:{write:!0,default:"moderate"}})],Yb.prototype,"waveStrength",void 0),Yb=MY=d([$("esri.symbols.WaterSymbol3DLayer")],Yb);const PY=new Te([0,119,190]),Uxe=Yb;var IY;let A2=IY=class extends xe{constructor(){super(...arguments),this.portal=null}clone(){return new IY({name:this.name,styleUrl:this.styleUrl,styleName:this.styleName,portal:this.portal})}};d([f({type:String})],A2.prototype,"name",void 0),d([f({type:String})],A2.prototype,"styleUrl",void 0),d([f({type:String})],A2.prototype,"styleName",void 0),d([f({type:Cs})],A2.prototype,"portal",void 0),A2=IY=d([$("esri.symbols.support.StyleOrigin")],A2);const pA=A2;var $Y;let aw=$Y=class extends xe{clone(){return new $Y({url:this.url})}};d([f({type:String})],aw.prototype,"url",void 0),aw=$Y=d([$("esri.symbols.support.Thumbnail")],aw);const Bxe={icon:Qg,object:AV,line:t6,path:RV,fill:W5,extrude:Ore,text:Tx,water:Uxe},BBe=lt.ofType({base:Am,key:"type",typeMap:Bxe,errorContext:"symbol-layer"}),GBe=fe.getLogger("esri.symbols.Symbol3D");let p0=class extends yc{constructor(e){super(e),this.styleOrigin=null,this.thumbnail=null,this.type=null;const t=this.__accessor__&&this.__accessor__.metadatas&&this.__accessor__.metadatas.symbolLayers,r=t&&t.type||lt;this._set("symbolLayers",new r)}get color(){return null}set color(e){this.initialized&&GBe.error("Symbol3D does not support colors on the symbol level. Colors may be set on individual symbol layer materials instead.")}set symbolLayers(e){Rw(e,this._get("symbolLayers"))}readStyleOrigin(e,t,r){if(e.styleUrl&&e.name){const i=My(e.styleUrl,r);return new pA({styleUrl:i,name:e.name})}if(e.styleName&&e.name)return new pA({portal:r&&r.portal||Cs.getDefault(),styleName:e.styleName,name:e.name});r&&r.messages&&r.messages.push(new cc("symbol3d:incomplete-style-origin","Style origin requires either a 'styleUrl' or 'styleName' and a 'name' property",{context:r,definition:e}))}writeStyleOrigin(e,t,r,i){if(e.styleUrl&&e.name){let n=Py(e.styleUrl,i);cd(n)&&(n=zh(n)),t.styleOrigin={styleUrl:n,name:e.name}}else e.styleName&&e.name&&(e.portal&&i&&i.portal&&!P3e(e.portal.restUrl,i.portal.restUrl)?i&&i.messages&&i.messages.push(new cc("symbol:cross-portal","The symbol style origin cannot be persisted because it refers to an item on a different portal than the one being saved to.",{symbol:this})):t.styleOrigin={styleName:e.styleName,name:e.name})}normalizeCtorArgs(e){return e instanceof Am||e&&Bxe[e.type]?{symbolLayers:[e]}:Array.isArray(e)?{symbolLayers:e}:e}};d([f({json:{read:!1,write:!1}})],p0.prototype,"color",null),d([f({type:BBe,nonNullable:!0,json:{write:!0}}),Xt(v3e)],p0.prototype,"symbolLayers",null),d([f({type:pA})],p0.prototype,"styleOrigin",void 0),d([$e("styleOrigin")],p0.prototype,"readStyleOrigin",null),d([Xe("styleOrigin",{"styleOrigin.styleUrl":{type:String},"styleOrigin.styleName":{type:String},"styleOrigin.name":{type:String}})],p0.prototype,"writeStyleOrigin",null),d([f({type:aw,json:{read:!1}})],p0.prototype,"thumbnail",void 0),d([f({type:["point-3d","line-3d","polygon-3d","mesh-3d","label-3d"],readOnly:!0})],p0.prototype,"type",void 0),p0=d([$("esri.symbols.Symbol3D")],p0);const r6=p0;let SE=class extends ge{constructor(e){super(e),this.visible=!0}clone(){}};d([f({type:["line"],readOnly:!0,json:{read:!1,write:{ignoreOrigin:!0}}})],SE.prototype,"type",void 0),d([f({readOnly:!0})],SE.prototype,"visible",void 0),SE=d([$("esri.symbols.callouts.Callout3D")],SE);const Gxe=SE;var LY;let dL=LY=class extends ge{constructor(){super(...arguments),this.color=new Te("white")}clone(){return new LY({color:te(this.color)})}};d([f(Gy)],dL.prototype,"color",void 0),dL=LY=d([$("esri.symbols.callouts.LineCallout3DBorder")],dL);const jxe=dL;Object.freeze(Object.defineProperty({__proto__:null,default:jxe},Symbol.toStringTag,{value:"Module"}));var DY;let Zb=DY=class extends Gxe{constructor(e){super(e),this.type="line",this.color=new Te([0,0,0,1]),this.size=zs(1),this.border=null}get visible(){return this.size>0&&_(this.color)&&this.color.a>0}clone(){return new DY({color:te(this.color),size:this.size,border:te(this.border)})}};d([Ze({line:"line"},{readOnly:!0})],Zb.prototype,"type",void 0),d([f(Gy)],Zb.prototype,"color",void 0),d([f(dm)],Zb.prototype,"size",void 0),d([f({type:jxe,json:{write:!0}})],Zb.prototype,"border",void 0),d([f({readOnly:!0})],Zb.prototype,"visible",null),Zb=DY=d([$("esri.symbols.callouts.LineCallout3D")],Zb);const jBe=Zb;function kre(e){if(!e)return!1;const t=e.verticalOffset;return!!t&&!(t.screenLength<=0||t.maxWorldLength<=0)}function qxe(e){if(!e||!e.supportsCallout||!e.supportsCallout())return!1;const t=e.callout;return!!t&&!!t.visible&&!!kre(e)}function Vre(e){return e.type==="point-3d"||e.type==="label-3d"}function Hxe(e){return e.horizontalAlignment==="center"}const Wxe={types:{key:"type",base:Gxe,typeMap:{line:jBe}},json:{write:!0}};var FY;let y3=FY=class extends ge{constructor(){super(...arguments),this.screenLength=0,this.minWorldLength=0}clone(){return new FY({screenLength:this.screenLength,minWorldLength:this.minWorldLength,maxWorldLength:this.maxWorldLength})}};d([f(dm)],y3.prototype,"screenLength",void 0),d([f({type:Number,json:{write:!0,default:0}})],y3.prototype,"minWorldLength",void 0),d([f({type:Number,json:{write:!0}})],y3.prototype,"maxWorldLength",void 0),y3=FY=d([$("esri.symbols.support.Symbol3DVerticalOffset")],y3);var uL;const Xxe=lt.ofType({base:null,key:"type",typeMap:{text:Tx}});let Qb=uL=class extends r6{constructor(e){super(e),this.verticalOffset=null,this.callout=null,this.styleOrigin=null,this.symbolLayers=new Xxe,this.type="label-3d"}supportsCallout(){return!0}hasVisibleCallout(){return qxe(this)}hasVisibleVerticalOffset(){return kre(this)}clone(){return new uL({styleOrigin:te(this.styleOrigin),symbolLayers:te(this.symbolLayers),thumbnail:te(this.thumbnail),callout:te(this.callout),verticalOffset:te(this.verticalOffset)})}static fromTextSymbol(e){return new uL({symbolLayers:[Tx.fromTextSymbol(e)]})}};d([f({type:y3,json:{write:!0}})],Qb.prototype,"verticalOffset",void 0),d([f(Wxe)],Qb.prototype,"callout",void 0),d([f({json:{read:!1,write:!1}})],Qb.prototype,"styleOrigin",void 0),d([f({type:Xxe})],Qb.prototype,"symbolLayers",void 0),d([Ze({LabelSymbol3D:"label-3d"},{readOnly:!0})],Qb.prototype,"type",void 0),Qb=uL=d([$("esri.symbols.LabelSymbol3D")],Qb);const OV=Qb;var hL;const Yxe=lt.ofType({base:null,key:"type",typeMap:{line:t6,path:RV}}),qBe=lt.ofType({base:null,key:"type",typeMap:{line:t6,path:RV}});let EE=hL=class extends r6{constructor(e){super(e),this.symbolLayers=new Yxe,this.type="line-3d"}clone(){return new hL({styleOrigin:te(this.styleOrigin),symbolLayers:te(this.symbolLayers),thumbnail:te(this.thumbnail)})}static fromSimpleLineSymbol(e){return new hL({symbolLayers:[t6.fromSimpleLineSymbol(e)]})}};d([f({type:Yxe,json:{type:qBe}})],EE.prototype,"symbolLayers",void 0),d([Ze({LineSymbol3D:"line-3d"},{readOnly:!0})],EE.prototype,"type",void 0),EE=hL=d([$("esri.symbols.LineSymbol3D")],EE);const Y5=EE;let Jb=class extends yc{constructor(e){super(e),this.angle=0,this.type=null,this.xoffset=0,this.yoffset=0,this.size=9}hash(){return`${this.type}.${this.angle}.${this.size}.${this.xoffset}.${this.yoffset}`}};d([f({type:Number,json:{read:e=>e&&-1*e,write:(e,t)=>t.angle=e&&-1*e}})],Jb.prototype,"angle",void 0),d([f({type:["simple-marker","picture-marker"],readOnly:!0})],Jb.prototype,"type",void 0),d([f({type:Number,cast:Xr,json:{write:!0}})],Jb.prototype,"xoffset",void 0),d([f({type:Number,cast:Xr,json:{write:!0}})],Jb.prototype,"yoffset",void 0),d([f({type:Number,cast:e=>e==="auto"?e:Xr(e),json:{write:!0}})],Jb.prototype,"size",void 0),Jb=d([$("esri.symbols.MarkerSymbol")],Jb);const Zxe=Jb;var NY;const Qxe=lt.ofType({base:null,key:"type",typeMap:{fill:W5}});let CE=NY=class extends r6{constructor(e){super(e),this.symbolLayers=new Qxe,this.type="mesh-3d"}clone(){return new NY({styleOrigin:te(this.styleOrigin),symbolLayers:te(this.symbolLayers),thumbnail:te(this.thumbnail)})}};d([f({type:Qxe})],CE.prototype,"symbolLayers",void 0),d([Ze({MeshSymbol3D:"mesh-3d"},{readOnly:!0})],CE.prototype,"type",void 0),CE=NY=d([$("esri.symbols.MeshSymbol3D")],CE);const MV=CE;function HBe(e,t,r){return t.imageData?L3e({mediaType:t.contentType||"image/png",isBase64:!0,data:t.imageData}):Jxe(t.url,r)}function Jxe(e,t){return XBe(t)&&!cd(e)&&t.layer.parsedUrl?vl(t.layer.parsedUrl.path,"images",e):My(e,t)}function WBe(e,t,r,i){if(Tm(e)){const n=hV(e);t.contentType=n.mediaType,t.imageData=n.data,r&&r.imageData===t.imageData&&r.url&&Xv(r.url,t,"url",i)}else Xv(e,t,"url",i)}const Kxe={json:{read:{source:["imageData","url"],reader:HBe},write:{writer(e,t,r,i){WBe(e,t,this.source,i)}}}},eTe={readOnly:!0,json:{read:{source:["imageData","url"],reader(e,t,r){const i={};return t.imageData&&(i.imageData=t.imageData),t.contentType&&(i.contentType=t.contentType),t.url&&(i.url=Jxe(t.url,r)),i}}}};function XBe(e){return e&&(e.origin==="service"||e.origin==="portal-item")&&e.layer&&(e.layer.type==="feature"||e.layer.type==="stream")}var kY;let rh=kY=class extends wxe{constructor(...e){super(...e),this.type="picture-fill",this.url=null,this.xscale=1,this.yscale=1,this.width=12,this.height=12,this.xoffset=0,this.yoffset=0,this.source=null}normalizeCtorArgs(e,t,r,i){if(e&&typeof e!="string"&&e.imageData==null)return e;const n={};return e&&(n.url=e),t&&(n.outline=t),r!=null&&(n.width=Xr(r)),i!=null&&(n.height=Xr(i)),n}clone(){const e=new kY({color:te(this.color),height:this.height,outline:this.outline&&this.outline.clone(),url:this.url,width:this.width,xoffset:this.xoffset,xscale:this.xscale,yoffset:this.yoffset,yscale:this.yscale});return e._set("source",te(this.source)),e}hash(){var e;return`${super.hash()}.${(e=this.color)==null?void 0:e.hash()}.${this.height}.${this.url}.${this.width}.${this.xoffset}.${this.xscale}.${this.yoffset}.${this.yscale}`}};d([Ze({esriPFS:"picture-fill"},{readOnly:!0})],rh.prototype,"type",void 0),d([f(Kxe)],rh.prototype,"url",void 0),d([f({type:Number,json:{write:!0}})],rh.prototype,"xscale",void 0),d([f({type:Number,json:{write:!0}})],rh.prototype,"yscale",void 0),d([f({type:Number,cast:Xr,json:{write:!0}})],rh.prototype,"width",void 0),d([f({type:Number,cast:Xr,json:{write:!0}})],rh.prototype,"height",void 0),d([f({type:Number,cast:Xr,json:{write:!0}})],rh.prototype,"xoffset",void 0),d([f({type:Number,cast:Xr,json:{write:!0}})],rh.prototype,"yoffset",void 0),d([f(eTe)],rh.prototype,"source",void 0),rh=kY=d([$("esri.symbols.PictureFillSymbol")],rh);const tTe=rh;var VY;let Ef=VY=class extends Zxe{constructor(...e){super(...e),this.color=null,this.type="picture-marker",this.url=null,this.source=null,this.height=12,this.width=12,this.size=null}normalizeCtorArgs(e,t,r){if(e&&typeof e!="string"&&e.imageData==null)return e;const i={};return e&&(i.url=e),t!=null&&(i.width=Xr(t)),r!=null&&(i.height=Xr(r)),i}readHeight(e,t){return t.size||e}readWidth(e,t){return t.size||e}clone(){const e=new VY({angle:this.angle,height:this.height,url:this.url,width:this.width,xoffset:this.xoffset,yoffset:this.yoffset});return e._set("source",te(this.source)),e}hash(){return`${super.hash()}.${this.height}.${this.url}.${this.width}`}};d([f({json:{write:!1}})],Ef.prototype,"color",void 0),d([Ze({esriPMS:"picture-marker"},{readOnly:!0})],Ef.prototype,"type",void 0),d([f(Kxe)],Ef.prototype,"url",void 0),d([f(eTe)],Ef.prototype,"source",void 0),d([f({type:Number,cast:Xr,json:{write:!0}})],Ef.prototype,"height",void 0),d([$e("height",["height","size"])],Ef.prototype,"readHeight",null),d([f({type:Number,cast:Xr,json:{write:!0}})],Ef.prototype,"width",void 0),d([f({json:{write:!1}})],Ef.prototype,"size",void 0),Ef=VY=d([$("esri.symbols.PictureMarkerSymbol")],Ef);const PV=Ef;var Kb;const rTe=lt.ofType({base:null,key:"type",typeMap:{icon:Qg,object:AV,text:Tx}});let R2=Kb=class extends r6{constructor(e){super(e),this.verticalOffset=null,this.callout=null,this.symbolLayers=new rTe,this.type="point-3d"}supportsCallout(){if((this.symbolLayers?this.symbolLayers.length:0)<1)return!1;for(const e of this.symbolLayers.items)switch(e.type){case"icon":case"text":case"object":continue;default:return!1}return!0}hasVisibleCallout(){return qxe(this)}hasVisibleVerticalOffset(){return kre(this)}clone(){return new Kb({verticalOffset:te(this.verticalOffset),callout:te(this.callout),styleOrigin:te(this.styleOrigin),symbolLayers:te(this.symbolLayers),thumbnail:te(this.thumbnail)})}static fromSimpleMarkerSymbol(e){return new Kb({symbolLayers:[Qg.fromSimpleMarkerSymbol(e)]})}static fromPictureMarkerSymbol(e){return new Kb({symbolLayers:[Qg.fromPictureMarkerSymbol(e)]})}static fromCIMSymbol(e){var r,i;return((i=(r=e.data)==null?void 0:r.symbol)==null?void 0:i.type)!=="CIMPointSymbol"?null:e.data.symbol.callout?new Kb({symbolLayers:[Qg.fromCIMSymbol(e)],callout:{type:"line",size:.5,color:[0,0,0]},verticalOffset:{screenLength:40}}):new Kb({symbolLayers:[Qg.fromCIMSymbol(e)]})}static fromTextSymbol(e){return new Kb({symbolLayers:[Tx.fromTextSymbol(e)]})}};d([f({type:y3,json:{write:!0}})],R2.prototype,"verticalOffset",void 0),d([f(Wxe)],R2.prototype,"callout",void 0),d([f({type:rTe,json:{origins:{"web-scene":{write:!0}}}})],R2.prototype,"symbolLayers",void 0),d([Ze({PointSymbol3D:"point-3d"},{readOnly:!0})],R2.prototype,"type",void 0),R2=Kb=d([$("esri.symbols.PointSymbol3D")],R2);const Y0=R2;var AE;const iTe=lt.ofType({base:null,key:"type",typeMap:{extrude:Ore,fill:W5,icon:Qg,line:t6,object:AV,text:Tx,water:Uxe}});let RE=AE=class extends r6{constructor(e){super(e),this.symbolLayers=new iTe,this.type="polygon-3d"}clone(){return new AE({styleOrigin:te(this.styleOrigin),symbolLayers:te(this.symbolLayers),thumbnail:te(this.thumbnail)})}static fromJSON(e){const t=new AE;if(t.read(e),t.symbolLayers.length===2&&t.symbolLayers.getItemAt(0).type==="fill"&&t.symbolLayers.getItemAt(1).type==="line"){const r=t.symbolLayers.getItemAt(0),i=t.symbolLayers.getItemAt(1);!i.enabled||e.symbolLayers&&e.symbolLayers[1]&&e.symbolLayers[1].enable===!1||(r.outline={size:i.size,color:_(i.material)?i.material.color:null}),t.symbolLayers.removeAt(1)}return t}static fromSimpleFillSymbol(e){return new AE({symbolLayers:[W5.fromSimpleFillSymbol(e)]})}};d([f({type:iTe,json:{write:!0}})],RE.prototype,"symbolLayers",void 0),d([Ze({PolygonSymbol3D:"polygon-3d"},{readOnly:!0})],RE.prototype,"type",void 0),RE=AE=d([$("esri.symbols.PolygonSymbol3D")],RE);const Fw=RE;var zY;const dG=new tr({esriSFSSolid:"solid",esriSFSNull:"none",esriSFSHorizontal:"horizontal",esriSFSVertical:"vertical",esriSFSForwardDiagonal:"forward-diagonal",esriSFSBackwardDiagonal:"backward-diagonal",esriSFSCross:"cross",esriSFSDiagonalCross:"diagonal-cross"});let O2=zY=class extends wxe{constructor(...e){super(...e),this.color=new Te([0,0,0,.25]),this.outline=new bc,this.type="simple-fill",this.style="solid"}normalizeCtorArgs(e,t,r){if(e&&typeof e!="string")return e;const i={};return e&&(i.style=e),t&&(i.outline=t),r&&(i.color=r),i}clone(){return new zY({color:te(this.color),outline:this.outline&&this.outline.clone(),style:this.style})}hash(){return`${super.hash()}${this.style}.${this.color&&this.color.hash()}`}};d([f()],O2.prototype,"color",void 0),d([f()],O2.prototype,"outline",void 0),d([Ze({esriSFS:"simple-fill"},{readOnly:!0})],O2.prototype,"type",void 0),d([f({type:dG.apiValues,json:{read:dG.read,write:dG.write}})],O2.prototype,"style",void 0),O2=zY=d([$("esri.symbols.SimpleFillSymbol")],O2);const kp=O2;var UY;const uG=new tr({esriSMSCircle:"circle",esriSMSSquare:"square",esriSMSCross:"cross",esriSMSX:"x",esriSMSDiamond:"diamond",esriSMSTriangle:"triangle",esriSMSPath:"path"});let m0=UY=class extends Zxe{constructor(...e){super(...e),this.color=new Te([255,255,255,.25]),this.type="simple-marker",this.size=12,this.style="circle",this.outline=new bc}normalizeCtorArgs(e,t,r,i){if(e&&typeof e!="string")return e;const n={};return e&&(n.style=e),t!=null&&(n.size=Xr(t)),r&&(n.outline=r),i&&(n.color=i),n}writeColor(e,t){e&&this.style!=="x"&&this.style!=="cross"&&(t.color=e.toJSON()),e===null&&(t.color=null)}set path(e){this.style="path",this._set("path",e)}clone(){return new UY({angle:this.angle,color:te(this.color),outline:this.outline&&this.outline.clone(),path:this.path,size:this.size,style:this.style,xoffset:this.xoffset,yoffset:this.yoffset})}hash(){var e;return`${super.hash()}.${this.color&&this.color.hash()}.${this.path}.${this.style}.${(e=this.outline)==null?void 0:e.hash()}`}};d([f()],m0.prototype,"color",void 0),d([Xe("color")],m0.prototype,"writeColor",null),d([Ze({esriSMS:"simple-marker"},{readOnly:!0})],m0.prototype,"type",void 0),d([f()],m0.prototype,"size",void 0),d([f({type:uG.apiValues,json:{read:uG.read,write:uG.write}})],m0.prototype,"style",void 0),d([f({type:String,json:{write:!0}})],m0.prototype,"path",null),d([f({types:{key:"type",base:null,defaultKeyValue:"simple-line",typeMap:{"simple-line":bc}},json:{default:null,write:!0}})],m0.prototype,"outline",void 0),m0=UY=d([$("esri.symbols.SimpleMarkerSymbol")],m0);const nc=m0;var BY;let vn=BY=class extends yc{constructor(...e){super(...e),this.backgroundColor=null,this.borderLineColor=null,this.borderLineSize=null,this.font=new EV,this.horizontalAlignment="center",this.kerning=!0,this.haloColor=null,this.haloSize=null,this.rightToLeft=null,this.rotated=!1,this.text="",this.type="text",this.verticalAlignment="baseline",this.xoffset=0,this.yoffset=0,this.angle=0,this.width=null,this.lineWidth=192,this.lineHeight=1}normalizeCtorArgs(e,t,r){if(e&&typeof e!="string")return e;const i={};return e&&(i.text=e),t&&(i.font=t),r&&(i.color=r),i}writeLineWidth(e,t,r,i){i&&typeof i!="string"?i.origin:t[r]=e}castLineWidth(e){return Xr(e)}writeLineHeight(e,t,r,i){i&&typeof i!="string"?i.origin:t[r]=e}clone(){return new BY({angle:this.angle,backgroundColor:te(this.backgroundColor),borderLineColor:te(this.borderLineColor),borderLineSize:this.borderLineSize,color:te(this.color),font:this.font&&this.font.clone(),haloColor:te(this.haloColor),haloSize:this.haloSize,horizontalAlignment:this.horizontalAlignment,kerning:this.kerning,lineHeight:this.lineHeight,lineWidth:this.lineWidth,rightToLeft:this.rightToLeft,rotated:this.rotated,text:this.text,verticalAlignment:this.verticalAlignment,width:this.width,xoffset:this.xoffset,yoffset:this.yoffset})}hash(){return`${this.backgroundColor&&this.backgroundColor.hash()}.${this.borderLineColor}.${this.borderLineSize}.${this.color.hash()}.${this.font&&this.font.hash()}.${this.haloColor&&this.haloColor.hash()}.${this.haloSize}.${this.horizontalAlignment}.${this.kerning}.${this.rightToLeft}.${this.rotated}.${this.text}.${this.verticalAlignment}.${this.width}.${this.xoffset}.${this.yoffset}.${this.lineHeight}.${this.lineWidth}.${this.angle}`}};d([f({type:Te,json:{write:!0}})],vn.prototype,"backgroundColor",void 0),d([f({type:Te,json:{write:!0}})],vn.prototype,"borderLineColor",void 0),d([f({type:Number,json:{write:!0}})],vn.prototype,"borderLineSize",void 0),d([f({type:EV,json:{write:!0}})],vn.prototype,"font",void 0),d([f({...Fxe,json:{write:!0}})],vn.prototype,"horizontalAlignment",void 0),d([f({type:Boolean,json:{write:!0}})],vn.prototype,"kerning",void 0),d([f({type:Te,json:{write:!0}})],vn.prototype,"haloColor",void 0),d([f({type:Number,cast:Xr,json:{write:!0}})],vn.prototype,"haloSize",void 0),d([f({type:Boolean,json:{write:!0}})],vn.prototype,"rightToLeft",void 0),d([f({type:Boolean,json:{write:!0}})],vn.prototype,"rotated",void 0),d([f({type:String,json:{write:!0}})],vn.prototype,"text",void 0),d([Ze({esriTS:"text"},{readOnly:!0})],vn.prototype,"type",void 0),d([f({...Nxe,json:{write:!0}})],vn.prototype,"verticalAlignment",void 0),d([f({type:Number,cast:Xr,json:{write:!0}})],vn.prototype,"xoffset",void 0),d([f({type:Number,cast:Xr,json:{write:!0}})],vn.prototype,"yoffset",void 0),d([f({type:Number,json:{read:e=>e&&-1*e,write:(e,t)=>t.angle=e&&-1*e}})],vn.prototype,"angle",void 0),d([f({type:Number,json:{write:!0}})],vn.prototype,"width",void 0),d([f({type:Number})],vn.prototype,"lineWidth",void 0),d([Xe("lineWidth")],vn.prototype,"writeLineWidth",null),d([Xt("lineWidth")],vn.prototype,"castLineWidth",null),d([f(Dxe)],vn.prototype,"lineHeight",void 0),d([Xe("lineHeight")],vn.prototype,"writeLineHeight",null),vn=BY=d([$("esri.symbols.TextSymbol")],vn);const i6=vn;var GY;const YBe=fe.getLogger("esri.symbols.WebStyleSymbol");let Cf=GY=class extends yc{constructor(e){super(e),this.styleName=null,this.portal=null,this.styleUrl=null,this.thumbnail=null,this.name=null,this.type="web-style"}get fetchCacheKey(){const e=_(this.portal)?this.portal:Cs.getDefault(),t=e.user?e.user.username:null;return`${this.styleName}:${this.styleUrl}:${this.name}:${t}:${e.url}`}read(e,t){this.portal=t?t.portal:void 0,super.read(e,t)}clone(){return new GY({name:this.name,styleUrl:this.styleUrl,styleName:this.styleName,portal:this.portal})}fetchSymbol(e){return this._fetchSymbol("webRef",e)}fetchCIMSymbol(e){return this._fetchSymbol("cimRef",e)}async _fetchSymbol(e,t){const r=_(t)?t.cache:null,i=r?this.fetchCacheKey:null;if(_(r)){const o=r.get(i);if(o)return o.clone()}const n=await ZBe();Et(t);const s=n.resolveWebStyleSymbol(this,{portal:this.portal},e,t);s.catch(o=>{YBe.error("#fetchSymbol()","Failed to create symbol from style",o)});const a=await s;return e==="webRef"&&a.type==="point-3d"||e==="cimRef"&&a.type==="cim"?(_(r)&&r.set(i,a.clone()),a):null}};function ZBe(){return ie(()=>Promise.resolve().then(()=>Q7t),void 0,import.meta.url)}d([f({json:{write:!1}})],Cf.prototype,"color",void 0),d([f({type:String,json:{write:!0}})],Cf.prototype,"styleName",void 0),d([f({type:Cs,json:{write:!1}})],Cf.prototype,"portal",void 0),d([f({type:String,json:{read:CV,write:Xv}})],Cf.prototype,"styleUrl",void 0),d([f({type:aw,json:{read:!1}})],Cf.prototype,"thumbnail",void 0),d([f({type:String,json:{write:!0}})],Cf.prototype,"name",void 0),d([Ze({styleSymbolReference:"web-style"},{readOnly:!0})],Cf.prototype,"type",void 0),d([f()],Cf.prototype,"fetchCacheKey",null),Cf=GY=d([$("esri.symbols.WebStyleSymbol")],Cf);const Sx=Cf;function IV(e){if(!e)return!1;switch(e.type){case"picture-fill":case"picture-marker":case"simple-fill":case"simple-line":case"simple-marker":case"text":case"cim":return!0;default:return!1}}function hm(e){if(!e)return!1;switch(e.type){case"label-3d":case"line-3d":case"mesh-3d":case"point-3d":case"polygon-3d":return!0;default:return!1}}const ow={base:yc,key:"type",typeMap:{"simple-fill":kp,"picture-fill":tTe,"picture-marker":PV,"simple-line":bc,"simple-marker":nc,text:i6,"label-3d":OV,"line-3d":Y5,"mesh-3d":MV,"point-3d":Y0,"polygon-3d":Fw,"web-style":Sx,cim:e6},errorContext:"symbol"},QBe={base:yc,key:"type",typeMap:{"picture-marker":PV,"simple-marker":nc,text:i6,"web-style":Sx,cim:e6},errorContext:"symbol"},JBe=Y9({types:ow}),nTe={base:yc,key:"type",typeMap:{"simple-fill":kp,"picture-fill":tTe,"picture-marker":PV,"simple-line":bc,"simple-marker":nc,text:i6,"line-3d":Y5,"mesh-3d":MV,"point-3d":Y0,"polygon-3d":Fw,"web-style":Sx,cim:e6},errorContext:"symbol"},KBe={base:yc,key:"type",typeMap:{text:i6,"label-3d":OV},errorContext:"symbol"},ade={base:yc,key:"type",typeMap:{"line-3d":Y5,"mesh-3d":MV,"point-3d":Y0,"polygon-3d":Fw,"web-style":Sx,cim:e6},errorContext:"symbol"},eGe={base:yc,key:"type",typeMap:{"label-3d":OV},errorContext:"symbol"},sTe=Mp(ow);function tGe(e){if(!e)return null;const t={};for(const r in e){const i=Ry(e[r]);i&&(t[r]=i)}return Object.keys(t).length!==0?t:null}function rGe(e){if(!_(e))return null;const t={};for(const r in e){const i=e[r];i&&(t[r]=i.toJSON())}return Object.keys(t).length!==0?t:null}let Oc=class extends yd(ge){constructor(...e){super(...e),this.isAggregate=!1,this.layer=null,this.popupTemplate=null,this.sourceLayer=null,Object.defineProperty(this,"uid",{value:ic(),configurable:!0})}normalizeCtorArgs(e,t,r,i){return e&&!e.declaredClass?e:{geometry:e,symbol:t,attributes:r,popupTemplate:i}}set aggregateGeometries(e){const t=this._get("aggregateGeometries");JSON.stringify(t)!==JSON.stringify(e)&&this._set("aggregateGeometries",e)}set attributes(e){const t=this._get("attributes");t!==e&&(this._set("attributes",e),this._notifyLayer("attributes",t,e))}set geometry(e){const t=this._get("geometry");t!==e&&(this._set("geometry",e),this._notifyLayer("geometry",t,e))}set symbol(e){const t=this._get("symbol");t!==e&&(this._set("symbol",e),this._notifyLayer("symbol",t,e))}set visible(e){const t=this._get("visible");t!==e&&(this._set("visible",e),this._notifyLayer("visible",t,e))}getEffectivePopupTemplate(e=!1){if(this.popupTemplate)return this.popupTemplate;for(const t of[this.sourceLayer,this.layer])if(t){if("popupTemplate"in t&&t.popupTemplate)return t.popupTemplate;if(e&&"defaultPopupTemplate"in t&&_(t.defaultPopupTemplate))return t.defaultPopupTemplate}return null}getAttribute(e){return this.attributes&&this.attributes[e]}setAttribute(e,t){if(this.attributes){const r=this.getAttribute(e);this.attributes[e]=t,this._notifyLayer("attributes",r,t,e)}else this.attributes={[e]:t},this._notifyLayer("attributes",void 0,t,e)}getObjectId(){return this.sourceLayer&&"objectIdField"in this.sourceLayer&&this.sourceLayer.objectIdField?this.getAttribute(this.sourceLayer.objectIdField):null}toJSON(){return{aggregateGeometries:rGe(this.aggregateGeometries),geometry:_(this.geometry)?this.geometry.toJSON():null,symbol:_(this.symbol)?this.symbol.toJSON():null,attributes:{...this.attributes},popupTemplate:this.popupTemplate&&this.popupTemplate.toJSON()}}notifyGeometryChanged(){this._notifyLayer("geometry",this.geometry,this.geometry)}notifyMeshTransformChanged(){_(this.geometry)&&this.geometry.type==="mesh"&&this._notifyLayer("transform",this.geometry.transform,this.geometry.transform)}_notifyLayer(e,t,r,i){if(!this.layer||!("graphicChanged"in this.layer))return;const n={graphic:this,property:e,oldValue:t,newValue:r};e==="attributes"&&(n.attributeName=i),this.layer.graphicChanged(n)}};d([f({value:null,json:{read:tGe}})],Oc.prototype,"aggregateGeometries",null),d([f({value:null})],Oc.prototype,"attributes",null),d([f({value:null,types:bx,json:{read:Ry}})],Oc.prototype,"geometry",null),d([f({type:Boolean})],Oc.prototype,"isAggregate",void 0),d([f({clonable:"reference"})],Oc.prototype,"layer",void 0),d([f({type:_x})],Oc.prototype,"popupTemplate",void 0),d([f({clonable:"reference"})],Oc.prototype,"sourceLayer",void 0),d([f({value:null,types:ow})],Oc.prototype,"symbol",null),d([f({type:Boolean,value:!0})],Oc.prototype,"visible",null),Oc=d([$("esri.Graphic")],Oc),function(e){e.generateUID=ic}(Oc||(Oc={}));const co=Oc;var jY;let e1=jY=class extends ge{constructor(e){super(e),this.rotation=0,this.scale=0,this.targetGeometry=null,this.camera=null}castRotation(e){return(e%=360)<0&&(e+=360),e}clone(){return new jY({rotation:this.rotation,scale:this.scale,targetGeometry:_(this.targetGeometry)?this.targetGeometry.clone():null,camera:_(this.camera)?this.camera.clone():null})}};function hG(){return{enabled:!this.camera}}d([f({type:Number,json:{write:!0,origins:{"web-map":{default:0,write:!0},"web-scene":{write:{overridePolicy:hG}}}}})],e1.prototype,"rotation",void 0),d([Xt("rotation")],e1.prototype,"castRotation",null),d([f({type:Number,json:{write:!0,origins:{"web-map":{default:0,write:!0},"web-scene":{write:{overridePolicy:hG}}}}})],e1.prototype,"scale",void 0),d([f({types:bx,json:{read:Ry,write:!0,origins:{"web-scene":{read:Ry,write:{overridePolicy:hG}}}}})],e1.prototype,"targetGeometry",void 0),d([f({type:gd,json:{write:!0}})],e1.prototype,"camera",void 0),e1=jY=d([$("esri.Viewpoint")],e1);const Yh=e1;function $V(e){return typeof e=="string"?document.getElementById(e):e}function aTe(e){for(;e.hasChildNodes();)e.removeChild(e.firstChild)}function ode(e,t){const r=t.parentNode;r&&r.insertBefore(e,t)}function lde(e,t){for(;;){const r=e.firstChild;if(!r)break;t.appendChild(r)}}class qY{constructor(t=r=>r.values().next().value){this._peeker=t,this._items=new Set}get length(){return this._items.size}clear(){this._items.clear()}last(){if(this._items.size===0)return;let t;for(t of this._items);return t}peek(){if(this._items.size!==0)return this._peeker(this._items)}push(t){this.contains(t)||this._items.add(t)}contains(t){return this._items.has(t)}pop(){if(this.length===0)return;const t=this.peek();return this._items.delete(t),t}popLast(){if(this.length===0)return;const t=this.last();return this._items.delete(t),t}remove(t){this._items.delete(t)}filter(t){return this._items.forEach(r=>{t(r)||this._items.delete(r)}),this}}var sc;(function(e){e[e.HANDSHAKE=0]="HANDSHAKE",e[e.OPEN=1]="OPEN",e[e.OPENED=2]="OPENED",e[e.RESPONSE=3]="RESPONSE",e[e.INVOKE=4]="INVOKE",e[e.ABORT=5]="ABORT",e[e.CLOSE=6]="CLOSE",e[e.OPEN_PORT=7]="OPEN_PORT",e[e.ON=8]="ON"})(sc||(sc={}));let iGe=0;function oTe(){return iGe++}function nGe(e){return e&&typeof e=="object"&&("result"in e||"transferList"in e)}function BF(e){return e?typeof e=="string"?JSON.stringify({name:"message",message:e}):e.toJSON?JSON.stringify(e):JSON.stringify({name:e.name,message:e.message,details:e.details||{stack:e.stack}}):null}function lTe(e,t,r,i){if(t.type===sc.OPEN_PORT)return void e.postMessage(t,[t.port]);if(t.type!==sc.INVOKE&&t.type!==sc.RESPONSE)return void e.postMessage(t);let n;nGe(r)?(n=cde(r.transferList),t.data=r.result):(n=cde(i),t.data=r),n?e.postMessage(t,n):e.postMessage(t)}function mA(e){if(!e)return null;const t=e.data;return t?typeof t=="string"?JSON.parse(t):t:null}function cde(e){if(!e||!e.length)return null;if(ue("esri-workers-arraybuffer-transfer"))return e;const t=e.filter(r=>!sGe(r));return t.length?t:null}function sGe(e){return e instanceof ArrayBuffer||e&&e.constructor&&e.constructor.name==="ArrayBuffer"}const aGe={statsWorker:()=>ie(()=>Promise.resolve().then(()=>mOt),void 0,import.meta.url),geometryEngineWorker:()=>ie(()=>import("./geometryEngineWorker.06591522.js"),["geometryEngineWorker.06591522.js","geometryEngineJSON.5a1f200e.js","geometryEngineBase.0f0d7ecf.js","json.8bd707cf.js"],import.meta.url),CSVSourceWorker:()=>ie(()=>import("./CSVSourceWorker.1b700c73.js"),["CSVSourceWorker.1b700c73.js","json.8bd707cf.js","FeatureStore.90eb75d8.js","PooledRBush.1dfcdd85.js","quickselect.bb286034.js","optimizedFeatureQueryEngineAdapter.bfa7c41c.js","centroid.80c9450e.js","QueryEngineResult.5def21e8.js","WhereClause.ecb0bafc.js","QueryEngine.fba17b75.js"],import.meta.url),EdgeProcessingWorker:()=>ie(()=>Promise.resolve().then(()=>P6t),void 0,import.meta.url),ElevationSamplerWorker:()=>ie(()=>import("./ElevationSamplerWorker.2c3c2d2f.js"),["ElevationSamplerWorker.2c3c2d2f.js","PooledRBush.1dfcdd85.js","quickselect.bb286034.js","georeference.f85d44f2.js"],import.meta.url),FeatureServiceSnappingSourceWorker:()=>ie(()=>import("./FeatureServiceSnappingSourceWorker.d7bf2f2e.js"),["FeatureServiceSnappingSourceWorker.d7bf2f2e.js","FeatureStore.90eb75d8.js","PooledRBush.1dfcdd85.js","quickselect.bb286034.js","optimizedFeatureQueryEngineAdapter.bfa7c41c.js","centroid.80c9450e.js","QueryEngine.fba17b75.js","QueryEngineResult.5def21e8.js","WhereClause.ecb0bafc.js","json.8bd707cf.js"],import.meta.url),GeoJSONSourceWorker:()=>ie(()=>import("./GeoJSONSourceWorker.643ac8d4.js"),["GeoJSONSourceWorker.643ac8d4.js","FeatureStore.90eb75d8.js","PooledRBush.1dfcdd85.js","quickselect.bb286034.js","optimizedFeatureQueryEngineAdapter.bfa7c41c.js","centroid.80c9450e.js","QueryEngineResult.5def21e8.js","WhereClause.ecb0bafc.js","json.8bd707cf.js","QueryEngine.fba17b75.js","geojson.600b9085.js","sourceUtils.5a2f1af3.js"],import.meta.url),LercWorker:()=>ie(()=>import("./LercWorker.3862f4c9.js"),[],import.meta.url),MemorySourceWorker:()=>ie(()=>import("./MemorySourceWorker.0e1b95ea.js"),["MemorySourceWorker.0e1b95ea.js","objectIdUtils.5d771dff.js","FeatureStore.90eb75d8.js","PooledRBush.1dfcdd85.js","quickselect.bb286034.js","optimizedFeatureQueryEngineAdapter.bfa7c41c.js","centroid.80c9450e.js","QueryEngineResult.5def21e8.js","WhereClause.ecb0bafc.js","json.8bd707cf.js","QueryEngine.fba17b75.js","sourceUtils.5a2f1af3.js"],import.meta.url),PBFDecoderWorker:()=>ie(()=>import("./PBFDecoderWorker.9b19f8e2.js"),[],import.meta.url),Pipeline:()=>ie(()=>import("./Pipeline.e7fb462b.js").then(e=>e.P),["Pipeline.e7fb462b.js","QueryEngine.fba17b75.js","QueryEngineResult.5def21e8.js","WhereClause.ecb0bafc.js","json.8bd707cf.js","createConnection.2d7fd802.js","quickselect.bb286034.js","centroid.80c9450e.js","ogcFeatureUtils.fd6a37f2.js","geojson.600b9085.js","enums.4de5fe56.js","Utils.be0af777.js","number.6e30c64a.js"],import.meta.url),PointCloudWorker:()=>ie(()=>import("./PointCloudWorker.345c1e6c.js"),["PointCloudWorker.345c1e6c.js","PointCloudWorkerUtil.b88b3926.js"],import.meta.url),RasterWorker:()=>ie(()=>import("./RasterWorker.c21c650b.js"),["RasterWorker.c21c650b.js","PixelBlock.db4f59f3.js","dataUtils.6bb8a64c.js","rasterProjectionHelper.c4fee2f8.js","utils.d8b12540.js"],import.meta.url),SceneLayerSnappingSourceWorker:()=>ie(()=>import("./SceneLayerSnappingSourceWorker.0b8e6fcd.js"),["SceneLayerSnappingSourceWorker.0b8e6fcd.js","QueryEngineResult.5def21e8.js","WhereClause.ecb0bafc.js","json.8bd707cf.js"],import.meta.url),SceneLayerWorker:()=>ie(()=>import("./SceneLayerWorker.9ea3db21.js").then(e=>e.S),["SceneLayerWorker.9ea3db21.js","I3SNode.cc916286.js"],import.meta.url),WFSSourceWorker:()=>ie(()=>import("./WFSSourceWorker.08025af4.js"),["WFSSourceWorker.08025af4.js","FeatureStore.90eb75d8.js","PooledRBush.1dfcdd85.js","quickselect.bb286034.js","optimizedFeatureQueryEngineAdapter.bfa7c41c.js","centroid.80c9450e.js","QueryEngineResult.5def21e8.js","WhereClause.ecb0bafc.js","json.8bd707cf.js","QueryEngine.fba17b75.js","geojson.600b9085.js","sourceUtils.5a2f1af3.js","wfsUtils.e9f04406.js","xmlUtils.fe1322c5.js"],import.meta.url),WorkerTileHandler:()=>ie(()=>import("./WorkerTileHandler.0d0f0785.js"),["WorkerTileHandler.0d0f0785.js","StyleRepository.fd472b71.js","enums.4de5fe56.js","Geometry.f2d62961.js","GeometryUtils.2547656a.js","TileClipper.3e083391.js","BidiEngine.210f7ff8.js"],import.meta.url)},{CLOSE:dde,ABORT:ude,INVOKE:hde,RESPONSE:B6,OPEN_PORT:fde,ON:oGe}=sc,lGe=2;class cGe{constructor(t){this._timer=null,this._cancelledJobIds=new Set,this._invokeMessages=[],this._invoke=t,this._timer=null,this._process=this._process.bind(this)}push(t){t.type===sc.ABORT?this._cancelledJobIds.add(t.jobId):(this._invokeMessages.push(t),this._timer===null&&(this._timer=setTimeout(this._process,0)))}clear(){this._invokeMessages.length=0,this._cancelledJobIds.clear(),this._timer=null}_process(){this._timer=null;for(const t of this._invokeMessages)this._cancelledJobIds.has(t.jobId)||this._invoke(t);this._cancelledJobIds.clear(),this._invokeMessages.length=0}}class Zc{constructor(t,r,i){this._port=t,this._getNextJob=i,this._outJobs=new Map,this._inJobs=new Map,this._invokeQueue=new cGe(n=>this._onInvokeMessage(n)),this._client=r.client,this._onMessage=this._onMessage.bind(this),this._channel=r.channel,this._schedule=r.schedule,this._port.addEventListener("message",this._onMessage),this._port.start()}static connect(t){const r=new MessageChannel;let i;i=typeof t=="function"?new t:"default"in t&&typeof t.default=="function"?new t.default:t;const n=new Zc(r.port1,{channel:r,client:i},()=>null);return typeof i=="object"&&"remoteClient"in i&&(i.remoteClient=n),Zc.clients.set(n,i),r.port2}static loadWorker(t){const r=aGe[t];return r?r():Promise.resolve(null)}close(){this._post({type:dde}),this._close()}isBusy(){return this._outJobs.size>0}invoke(t,r,i){const n=i&&i.signal,s=i&&i.transferList;if(!this._port)return Promise.reject(new k("worker:port-closed",`Cannot call invoke('${t}'), port is closed`,{methodName:t,data:r}));const a=oTe();return new Promise((o,l)=>{if(bs(n))return this._processWork(),void l(br());const c=Fo(n,()=>{const h=this._outJobs.get(a);h&&(this._outJobs.delete(a),this._processWork(),Ts(h.abortHandle),this._post({type:ude,jobId:a}),l(br()))}),u={resolve:o,reject:l,abortHandle:c,debugInfo:t};this._outJobs.set(a,u),this._post({type:hde,jobId:a,methodName:t,abortable:n!=null},r,s)})}on(t,r){const i=new MessageChannel;function n(s){r(s.data)}return this._port.postMessage({type:sc.ON,eventType:t,port:i.port2},[i.port2]),i.port1.addEventListener("message",n),i.port1.start(),{remove(){i.port1.postMessage({type:sc.CLOSE}),i.port1.close(),i.port1.removeEventListener("message",n)}}}jobAdded(){this._processWork()}openPort(){const t=new MessageChannel;return this._post({type:fde,port:t.port2}),t.port1}_processWork(){if(this._outJobs.size>=lGe)return;const t=this._getNextJob();if(!t)return;const{methodName:r,data:i,invokeOptions:n,deferred:s}=t;this.invoke(r,i,n).then(a=>s.resolve(a)).catch(a=>s.reject(a))}_close(){this._channel&&(this._channel=null),this._port.removeEventListener("message",this._onMessage),this._port.close(),this._outJobs.forEach(t=>{Ts(t.abortHandle),t.reject(br(`Worker closing, aborting job calling '${t.debugInfo}'`))}),this._inJobs.clear(),this._outJobs.clear(),this._invokeQueue.clear(),this._port=this._client=this._schedule=null}_onMessage(t){_(this._schedule)?this._schedule(()=>this._processMessage(t)):this._processMessage(t)}_processMessage(t){const r=mA(t);if(r)switch(r.type){case B6:this._onResponseMessage(r);break;case hde:this._invokeQueue.push(r);break;case ude:this._onAbortMessage(r);break;case dde:this._onCloseMessage();break;case fde:this._onOpenPortMessage(r);break;case oGe:this._onOnMessage(r)}}_onAbortMessage(t){const r=this._inJobs,i=t.jobId,n=r.get(i);this._invokeQueue.push(t),n&&(n.controller&&n.controller.abort(),r.delete(i))}_onCloseMessage(){const t=this._client;this._close(),t&&"destroy"in t&&Zc.clients.get(this)===t&&t.destroy(),Zc.clients.delete(this),t&&t.remoteClient&&(t.remoteClient=null)}_onInvokeMessage(t){const{methodName:r,jobId:i,data:n,abortable:s}=t,a=s?new AbortController:null,o=this._inJobs;let l,c=this._client,u=c[r];try{if(!u&&r&&r.includes(".")){const h=r.split(".");for(let p=0;p<h.length-1;p++)c=c[h[p]],u=c[h[p+1]]}if(typeof u!="function")throw new TypeError(`${r} is not a function`);l=u.call(c,n,{client:this,signal:a?a.signal:null})}catch(h){return void this._post({type:B6,jobId:i,error:BF(h)})}$u(l)?(o.set(i,{controller:a,promise:l}),l.then(h=>{o.has(i)&&(o.delete(i),this._post({type:B6,jobId:i},h))},h=>{o.has(i)&&(o.delete(i),Ui(h)||this._post({type:B6,jobId:i,error:BF(h||{message:`Error encountered at method ${r}`})}))})):this._post({type:B6,jobId:i},l)}_onOpenPortMessage(t){new Zc(t.port,{client:this._client},()=>null)}_onOnMessage(t){const{port:r}=t,i=this._client.on(t.eventType,s=>{r.postMessage(s)}),n=jR(t.port,"message",s=>{mA(s).type===sc.CLOSE&&(n.remove(),i.remove(),r.close())})}_onResponseMessage(t){const{jobId:r,error:i,data:n}=t,s=this._outJobs;if(!s.has(r))return;const a=s.get(r);this._processWork(),s.delete(r),Ts(a.abortHandle),i?a.reject(k.fromJSON(JSON.parse(i))):a.resolve(n)}_post(t,r,i){return lTe(this._port,t,r,i)}}Zc.kernelInfo={revision:G3e,version:j3e,buildDate:B3e},Zc.clients=new Map;const dGe=fe.getLogger("esri.core.workers.Connection");class uGe{constructor(){this._inUseClients=new Array,this._clients=new Array,this._clientPromises=new Array,this._ongoingJobsQueue=new qY}destroy(){this.close()}get closed(){return!this._clients||!this._clients.length}open(t,r){return new Promise((i,n)=>{let s=!0;const a=o=>{Et(r.signal),s&&(s=!1,o())};this._clients.length=t.length,this._clientPromises.length=t.length,this._inUseClients.length=t.length;for(let o=0;o<t.length;++o){const l=t[o];$u(l)?this._clientPromises[o]=l.then(c=>(this._clients[o]=new Zc(c,r,()=>this._ongoingJobsQueue.pop()),a(i),this._clients[o]),()=>(a(n),null)):(this._clients[o]=new Zc(l,r,()=>this._ongoingJobsQueue.pop()),this._clientPromises[o]=Promise.resolve(this._clients[o]),a(i))}})}broadcast(t,r,i){const n=new Array(this._clientPromises.length);for(let s=0;s<this._clientPromises.length;++s){const a=this._clientPromises[s];n[s]=a.then(o=>o.invoke(t,r,i))}return n}close(){let t;for(;t=this._ongoingJobsQueue.pop();)t.deferred.reject(br(`Worker closing, aborting job calling '${t.methodName}'`));for(const r of this._clientPromises)r.then(i=>i.close());this._clients.length=0,this._clientPromises.length=0}invoke(t,r,i){let n=null;Array.isArray(i)?(dGe.warn("invoke()","The transferList parameter is deprecated, use the options object instead"),n={transferList:i}):n=i;const s=jv();this._ongoingJobsQueue.push({methodName:t,data:r,invokeOptions:n,deferred:s});for(let a=0;a<this._clientPromises.length;a++){const o=this._clients[a];o?o.jobAdded():this._clientPromises[a].then(l=>l.jobAdded())}return s.promise}on(t,r){return Promise.all(this._clientPromises).then(()=>A5(this._clients.map(i=>i.on(t,r))))}openPorts(){return new Promise(t=>{const r=new Array(this._clientPromises.length);let i=r.length;for(let n=0;n<this._clientPromises.length;++n)this._clientPromises[n].then(s=>{r[n]=s.openPort(),--i==0&&t(r)})})}get test(){return{numClients:this._clients.length}}}const cTe=fe.getLogger("esri.intl");function fh(e,t,r={}){const{format:i={}}=r;return lm(e,n=>hGe(n,t,i))}function hGe(e,t,r){let i,n;const s=e.indexOf(":");if(s===-1?i=e.trim():(i=e.slice(0,s).trim(),n=e.slice(s+1).trim()),!i)return"";const a=W9(i,t);if(a==null)return"";const o=r[n]||r[i];return o?fGe(a,o):n?pGe(a,n):zre(a)}function fGe(e,t){switch(t.type){case"date":return Ip(e,t.intlOptions);case"number":return Xh(e,t.intlOptions);default:return cTe.warn("missing format descriptor for key {key}"),zre(e)}}function pGe(e,t){switch(t.toLowerCase()){case"dateformat":return Ip(e);case"numberformat":return Xh(e);default:return cTe.warn(`inline format is unsupported since 4.12: ${t}`),/^(dateformat|datestring)/i.test(t)?Ip(e):/^numberformat/i.test(t)?Xh(e):zre(e)}}function zre(e){switch(typeof e){case"string":return e;case"number":return Xh(e);case"boolean":return""+e;default:return e instanceof Date?Ip(e):""}}async function mGe(e,t,r,i){const n=t.exec(r);if(!n)throw new k("esri-intl:invalid-bundle",`Bundle id "${r}" is not compatible with the pattern "${t}"`);const s=n[1]?`${n[1]}/`:"",a=n[2],o=EVe(i),l=`${s}${a}.json`,c=o?`${s}${a}_${o}.json`:l;let u;try{u=await pde(e(c))}catch(h){if(c===l)throw new k("intl:unknown-bundle",`Bundle "${r}" cannot be loaded`,{error:h});try{u=await pde(e(l))}catch(p){throw new k("intl:unknown-bundle",`Bundle "${r}" cannot be loaded`,{error:p})}}return u}async function pde(e){if(_(mde.fetchBundleAsset))return mde.fetchBundleAsset(e);const t=await qt(e,{responseType:"text"});return JSON.parse(t.data)}class gGe{constructor({base:t="",pattern:r,location:i=new URL(window.location.href)}){let n;n=typeof i=="string"?s=>new URL(s,new URL(i,window.location.href)).href:i instanceof URL?s=>new URL(s,i).href:i,this.pattern=typeof r=="string"?new RegExp(`^${r}`):r,this.getAssetUrl=n,t=t?t.endsWith("/")?t:t+"/":"",this.matcher=new RegExp(`^${t}(?:(.*)/)?(.*)$`)}fetchMessageBundle(t,r){return mGe(this.getAssetUrl,this.matcher,t,r)}}function yGe(e){return new gGe(e)}const mde={};SVe(yGe({pattern:"esri/",location:xr}));const gde={};function bGe(e,t){for(const r of e)if(r.name===t.name)return;e.push(t)}function vGe(e){var r;const t={async:e.async,isDebug:e.isDebug,locale:e.locale,baseUrl:e.baseUrl,has:{...e.has},map:{...e.map},packages:e.packages&&e.packages.concat()||[],paths:{...e.paths}};return e.hasOwnProperty("async")||(t.async=!0),e.hasOwnProperty("isDebug")||(t.isDebug=!1),e.baseUrl||(t.baseUrl=gde.baseUrl),(r=gde.packages)==null||r.forEach(i=>{bGe(t.packages,i)}),t}class _Ge{constructor(){const t=document.createDocumentFragment();["addEventListener","dispatchEvent","removeEventListener"].forEach(r=>{this[r]=(...i)=>t[r](...i)})}}class fL{constructor(){this._dispatcher=new _Ge,this._workerPostMessage({type:sc.HANDSHAKE})}terminate(){}get onmessage(){return this._onmessageHandler}set onmessage(t){this._onmessageHandler&&this.removeEventListener("message",this._onmessageHandler),this._onmessageHandler=t,t&&this.addEventListener("message",t)}get onmessageerror(){return this._onmessageerrorHandler}set onmessageerror(t){this._onmessageerrorHandler&&this.removeEventListener("messageerror",this._onmessageerrorHandler),this._onmessageerrorHandler=t,t&&this.addEventListener("messageerror",t)}get onerror(){return this._onerrorHandler}set onerror(t){this._onerrorHandler&&this.removeEventListener("error",this._onerrorHandler),this._onerrorHandler=t,t&&this.addEventListener("error",t)}postMessage(t){R5(()=>{this._workerMessageHandler(new MessageEvent("message",{data:t}))})}dispatchEvent(t){return this._dispatcher.dispatchEvent(t)}addEventListener(t,r,i){this._dispatcher.addEventListener(t,r,i)}removeEventListener(t,r,i){this._dispatcher.removeEventListener(t,r,i)}_workerPostMessage(t){R5(()=>{this.dispatchEvent(new MessageEvent("message",{data:t}))})}async _workerMessageHandler(t){const r=mA(t);if(r&&r.type===sc.OPEN){const{modulePath:i,jobId:n}=r;let s=await Zc.loadWorker(i);s||(s=await ie(()=>import(i),[],import.meta.url));const a=Zc.connect(s);this._workerPostMessage({type:sc.OPENED,jobId:n,data:a})}}}const HY=fe.getLogger("esri.core.workers"),{HANDSHAKE:wGe}=sc,xGe='let globalId=0;const outgoing=new Map,configuration=JSON.parse("{CONFIGURATION}");self.esriConfig=configuration.esriConfig;const workerPath=self.esriConfig.workers.workerPath,HANDSHAKE=0,OPEN=1,OPENED=2,RESPONSE=3,INVOKE=4,ABORT=5;function createAbortError(){const e=new Error("Aborted");return e.name="AbortError",e}function receiveMessage(e){return e&&e.data?"string"==typeof e.data?JSON.parse(e.data):e.data:null}function invokeStaticMessage(e,o,r){const t=r&&r.signal,n=globalId++;return new Promise(((r,i)=>{if(t){if(t.aborted)return i(createAbortError());t.addEventListener("abort",(()=>{outgoing.get(n)&&(outgoing.delete(n),self.postMessage({type:5,jobId:n}),i(createAbortError()))}))}outgoing.set(n,{resolve:r,reject:i}),self.postMessage({type:4,jobId:n,methodName:e,abortable:null!=t,data:o})}))}let workerRevisionChecked=!1;function checkWorkerRevision(e){if(!workerRevisionChecked&&e.kernelInfo){workerRevisionChecked=!0;const{revision:o,buildDate:r,version:t}=configuration.kernelInfo,{revision:n,buildDate:i,version:s}=e.kernelInfo;o!==n&&console.warn(`[esri.core.workers] Version mismatch detected between ArcGIS API for JavaScript and assets:\\nAPI version: ${t} [Date: ${r}, Revision: ${o.slice(0,8)}]\nAssets version: ${s} [Date: ${i}, Revision: ${n.slice(0,8)}]`)}}function messageHandler(e){const o=receiveMessage(e);if(!o)return;const r=o.jobId;switch(o.type){case 1:let e;function t(o){const t=e.connect(o);self.postMessage({type:2,jobId:r,data:t},[t])}"function"==typeof define&&define.amd?require([workerPath],(r=>{e=r.default||r,checkWorkerRevision(e),e.loadWorker(o.modulePath).then((e=>e||new Promise((e=>{require([o.modulePath],e)})))).then(t)})):"System"in self&&"function"==typeof System.import?System.import(workerPath).then((r=>(e=r.default,checkWorkerRevision(e),e.loadWorker(o.modulePath)))).then((e=>e||System.import(o.modulePath))).then(t):esriConfig.workers.useDynamicImport?import(workerPath).then((r=>{e=r.default||r,checkWorkerRevision(e),e.loadWorker(o.modulePath).then((e=>e||import(o.modulePath))).then(t)})):(self.RemoteClient||importScripts(workerPath),e=self.RemoteClient.default||self.RemoteClient,checkWorkerRevision(e),e.loadWorker(o.modulePath).then(t));break;case 3:if(outgoing.has(r)){const e=outgoing.get(r);outgoing.delete(r),o.error?e.reject(JSON.parse(o.error)):e.resolve(o.data)}}}self.dojoConfig=configuration.loaderConfig,esriConfig.workers.loaderUrl&&(self.importScripts(esriConfig.workers.loaderUrl),"function"==typeof require&&"function"==typeof require.config&&require.config(configuration.loaderConfig)),self.addEventListener("message",messageHandler),self.postMessage({type:0});';let LM,DM;const yde="Failed to create Worker. Fallback to execute module in main thread";async function TGe(){if(!ue("esri-workers")||(ue("mozilla"),0))return bde(new fL);if(!LM&&!DM)try{const t=xGe.replace('"{CONFIGURATION}"',`'${SGe()}'`);LM=URL.createObjectURL(new Blob([t],{type:"text/javascript"}))}catch(t){DM=t||{}}let e;if(LM)try{e=new Worker(LM,{name:"esri-worker-"+EGe++})}catch{HY.warn(yde,DM),e=new fL}else HY.warn(yde,DM),e=new fL;return bde(e)}async function bde(e){return new Promise(t=>{function r(n){const s=mA(n);s&&s.type===wGe&&(e.removeEventListener("message",r),e.removeEventListener("error",i),t(e))}function i(n){n.preventDefault(),e.removeEventListener("message",r),e.removeEventListener("error",i),HY.warn("Failed to create Worker. Fallback to execute module in main thread",n),(e=new fL).addEventListener("message",r),e.addEventListener("error",i)}e.addEventListener("message",r),e.addEventListener("error",i)})}function SGe(){let e;if(Vr.default!=null){const n={...Vr};delete n.default,e=JSON.parse(JSON.stringify(n))}else e=JSON.parse(JSON.stringify(Vr));e.assetsPath=Fh(e.assetsPath),e.request.interceptors=[],e.log.interceptors=[],e.locale=mu(),e.has={"esri-csp-restrictions":ue("esri-csp-restrictions"),"esri-2d-debug":!1,"esri-2d-update-debug":ue("esri-2d-update-debug"),"esri-2d-query-centroid-enabled":ue("esri-2d-query-centroid-enabled"),"featurelayer-pbf":ue("featurelayer-pbf"),"featurelayer-simplify-thresholds":ue("featurelayer-simplify-thresholds"),"featurelayer-simplify-payload-size-factors":ue("featurelayer-simplify-payload-size-factors"),"featurelayer-simplify-mobile-factor":ue("featurelayer-simplify-mobile-factor"),"esri-atomics":ue("esri-atomics"),"esri-shared-array-buffer":ue("esri-shared-array-buffer"),"esri-tiles-debug":ue("esri-tiles-debug"),"esri-workers-arraybuffer-transfer":ue("esri-workers-arraybuffer-transfer"),"feature-polyline-generalization-factor":ue("feature-polyline-generalization-factor"),"host-webworker":1},e.workers.loaderUrl&&(e.workers.loaderUrl=Fh(e.workers.loaderUrl)),e.workers.workerPath?e.workers.workerPath=Fh(e.workers.workerPath):e.workers.workerPath=Fh(xr("esri/core/workers/RemoteClient.js")),e.workers.useDynamicImport=!1;const t=Vr.workers.loaderConfig,r=vGe({baseUrl:t==null?void 0:t.baseUrl,locale:mu(),has:{"csp-restrictions":1,"dojo-test-sniff":0,"host-webworker":1,...t==null?void 0:t.has},map:{...t==null?void 0:t.map},paths:{...t==null?void 0:t.paths},packages:(t==null?void 0:t.packages)||[]}),i={version:j3e,buildDate:B3e,revision:G3e};return JSON.stringify({esriConfig:e,loaderConfig:r,kernelInfo:i})}let EGe=0;const CGe=fe.getLogger("esri.core.workers"),{ABORT:vde,INVOKE:AGe,OPEN:RGe,OPENED:OGe,RESPONSE:G6}=sc;class Ure{constructor(t,r){this._outJobs=new Map,this._inJobs=new Map,this.worker=t,this.id=r,t.addEventListener("message",this._onMessage.bind(this)),t.addEventListener("error",i=>{i.preventDefault(),CGe.error(i)})}static async create(t){const r=await TGe();return new Ure(r,t)}terminate(){this.worker.terminate()}async open(t,r={}){const{signal:i}=r,n=oTe();return new Promise((s,a)=>{const o={resolve:s,reject:a,abortHandle:Ate(i,()=>{this._outJobs.delete(n),this._post({type:vde,jobId:n})})};this._outJobs.set(n,o),this._post({type:RGe,jobId:n,modulePath:t})})}_onMessage(t){const r=mA(t);if(r)switch(r.type){case OGe:this._onOpenedMessage(r);break;case G6:this._onResponseMessage(r);break;case vde:this._onAbortMessage(r);break;case AGe:this._onInvokeMessage(r)}}_onAbortMessage(t){const r=this._inJobs,i=t.jobId,n=r.get(i);n&&(n.controller&&n.controller.abort(),r.delete(i))}_onInvokeMessage(t){const{methodName:r,jobId:i,data:n,abortable:s}=t,a=s?new AbortController:null,o=this._inJobs,l=Rke[r];let c;try{if(typeof l!="function")throw new TypeError(`${r} is not a function`);c=l.call(null,n,{signal:a?a.signal:null})}catch(u){return void this._post({type:G6,jobId:i,error:BF(u)})}$u(c)?(o.set(i,{controller:a,promise:c}),c.then(u=>{o.has(i)&&(o.delete(i),this._post({type:G6,jobId:i},u))},u=>{o.has(i)&&(o.delete(i),u||(u={message:"Error encountered at method"+r}),Ui(u)||this._post({type:G6,jobId:i,error:BF(u||{message:`Error encountered at method ${r}`})}))})):this._post({type:G6,jobId:i},c)}_onOpenedMessage(t){const{jobId:r,data:i}=t,n=this._outJobs.get(r);n&&(this._outJobs.delete(r),Ts(n.abortHandle),n.resolve(i))}_onResponseMessage(t){const{jobId:r,error:i,data:n}=t,s=this._outJobs.get(r);s&&(this._outJobs.delete(r),Ts(s.abortHandle),i?s.reject(k.fromJSON(JSON.parse(i))):s.resolve(n))}_post(t,r,i){return lTe(this.worker,t,r,i)}}let k3=ue("esri-workers-debug")?1:ue("host-browser")?navigator.hardwareConcurrency-1:0;k3||(k3=ue("safari")&&ue("mac")||ue("trident")?7:2);let _de=0;const pL=[];function MGe(){dTe()}async function FM(e,t){const r=new uGe;return await r.open(e,t),r}async function LV(e,t={}){if(typeof e!="string")throw new k("workers:undefined-module","modulePath is missing");let r=t.strategy||"distributed";if(ue("host-webworker")&&!ue("esri-workers")&&(r="local"),r==="local"){let i=await Zc.loadWorker(e);i||(i=await ie(()=>import(e),[],import.meta.url)),Et(t.signal);const n=t.client||i;return FM([Zc.connect(i)],{...t,client:n})}if(await dTe(),Et(t.signal),r==="dedicated"){const i=_de++%k3;return FM([await pL[i].open(e,t)],t)}if(t.maxNumWorkers&&t.maxNumWorkers>0){const i=Math.min(t.maxNumWorkers,k3);if(i<k3){const n=new Array(i);for(let s=0;s<i;++s){const a=_de++%k3;n[s]=pL[a].open(e,t)}return FM(n,t)}}return FM(pL.map(i=>i.open(e,t)),t)}let NM=null;async function dTe(){if(NM)return NM;new AbortController;const e=[];for(let t=0;t<k3;t++){const r=Ure.create(t).then(i=>(pL[t]=i,i));e.push(r)}return NM=Promise.all(e),NM}fe.getLogger("esri.core.support.OwningCollection");let HC=class extends Cm(lt){constructor(e){super(e),this.handles.add([this.on("before-add",t=>{R(t.item)&&t.preventDefault()}),this.on("after-add",t=>this._own(t.item)),this.on("after-remove",t=>this._release(t.item))])}get owner(){return this._get("owner")}set owner(e){e!==this._get("owner")&&(this._releaseAll(),this._set("owner",e),this._ownAll())}_ownAll(){for(const e of this.items)this._own(e)}_releaseAll(){for(const e of this.items)this._release(e)}_createNewInstance(e){return this.itemType?new(lt.ofType(this.itemType.Type))(e):new lt(e)}};function WY(e,t){return{type:e,cast:v3e,set(r){const i=Rw(r,this._get(t),e);i.owner=this,this._set(t,i)}}}d([f()],HC.prototype,"owner",null),HC=d([$("esri.core.support.OwningCollection")],HC);function Bre(e){return new Ye({wkt:`GEOCCS["Spherical geocentric",
    DATUM["Not specified",
      SPHEROID["Sphere",${e.radius},0]],
    PRIMEM["Greenwich",0.0,
      AUTHORITY["EPSG","8901"]],
    UNIT["m",1.0],
    AXIS["Geocentric X",OTHER],
    AXIS["Geocentric Y",EAST],
    AXIS["Geocentric Z",NORTH]
  ]`})}const uTe=Bre($r),GF=Bre(em),jF=Bre(Ay),PGe=new Ye({wkt:`GEOCCS["WGS 84",
  DATUM["WGS_1984",
    SPHEROID["WGS 84",${$r.radius},298.257223563,
      AUTHORITY["EPSG","7030"]],
    AUTHORITY["EPSG","6326"]],
  PRIMEM["Greenwich",0,
    AUTHORITY["EPSG","8901"]],
  UNIT["m",1.0,
    AUTHORITY["EPSG","9001"]],
  AXIS["Geocentric X",OTHER],
  AXIS["Geocentric Y",OTHER],
  AXIS["Geocentric Z",NORTH],
  AUTHORITY["EPSG","4978"]
]`});function fm(e){return e&&(Sm(e)||e===GF)?GF:e&&(Em(e)||e===jF)?jF:uTe}function Ar(e){return e&&(Sm(e)||e===GF)?em:e&&(Em(e)||e===jF)?Ay:$r}function AIt(e){return Wte(e)?em:Xte(e)?Ay:$r}const Gre=39.37,IGe=$r.radius*Math.PI/200,hTe=/UNIT\[([^\]]+)\]\]$/i,lw=N,fTe=/UNIT\[([^\]]+)\]/i,$Ge=new Set([4261,4305,4807,4810,4811,4812,4816,4819,4821,4901,4902,37225,104139,104140]),LGe=uo()({meter:"meters",foot:"feet",foot_us:"us-feet",foot_clarke:"clarke-feet",yard_clarke:"clarke-yards",link_clarke:"clarke-links",yard_sears:"sears-yards",foot_sears:"sears-feet",chain_sears:"sears-chains",chain_benoit_1895_b:"benoit-1895-b-chains",yard_indian:"indian-yards",yard_indian_1937:"indian-1937-yards",foot_gold_coast:"gold-coast-feet",chain_sears_1922_truncated:"sears-1922-truncated-chains","50_kilometers":"50-kilometers","150_kilometers":"150-kilometers"}),Bp=e=>e*e,lb=e=>e*e*e,gA={length:{baseUnit:"meters",units:{millimeters:{inBaseUnits:.001},centimeters:{inBaseUnits:.01},decimeters:{inBaseUnits:.1},meters:{inBaseUnits:1},kilometers:{inBaseUnits:1e3},inches:{inBaseUnits:.0254},feet:{inBaseUnits:.3048},yards:{inBaseUnits:.9144},miles:{inBaseUnits:1609.344},"nautical-miles":{inBaseUnits:1852},"us-feet":{inBaseUnits:1200/3937}}},area:{baseUnit:"square-meters",units:{"square-millimeters":{inBaseUnits:Bp(.001)},"square-centimeters":{inBaseUnits:Bp(.01)},"square-decimeters":{inBaseUnits:Bp(.1)},"square-meters":{inBaseUnits:1},"square-kilometers":{inBaseUnits:Bp(1e3)},"square-inches":{inBaseUnits:Bp(.0254)},"square-feet":{inBaseUnits:Bp(.3048)},"square-yards":{inBaseUnits:Bp(.9144)},"square-miles":{inBaseUnits:Bp(1609.344)},"square-us-feet":{inBaseUnits:Bp(1200/3937)},acres:{inBaseUnits:.0015625*Bp(1609.344)},ares:{inBaseUnits:100},hectares:{inBaseUnits:1e4}}},volume:{baseUnit:"liters",units:{liters:{inBaseUnits:1},"cubic-millimeters":{inBaseUnits:1e3*lb(.001)},"cubic-centimeters":{inBaseUnits:1e3*lb(.01)},"cubic-decimeters":{inBaseUnits:1e3*lb(.1)},"cubic-meters":{inBaseUnits:1e3},"cubic-kilometers":{inBaseUnits:1e3*lb(1e3)},"cubic-inches":{inBaseUnits:1e3*lb(.0254)},"cubic-feet":{inBaseUnits:1e3*lb(.3048)},"cubic-yards":{inBaseUnits:1e3*lb(.9144)},"cubic-miles":{inBaseUnits:1e3*lb(1609.344)}}},angle:{baseUnit:"radians",units:{radians:{inBaseUnits:1},degrees:{inBaseUnits:Math.PI/180}}}},DGe=(()=>{const e={};for(const t in gA)for(const r in gA[t].units)e[r]=t;return e})();function FGe(e,t,r){return e*gA[r].units[t].inBaseUnits}function NGe(e,t,r){return e/gA[r].units[t].inBaseUnits}const kGe=["metric","imperial","inches","feet","yards","miles","nautical-miles","us-feet","meters","kilometers"];function XY(e){const t=DGe[e];if(!t)throw new Error("unknown type");return t}function wde(e,t=null){return t=t||XY(e),gA[t].baseUnit===e}function ps(e,t,r){if(t===r)return e;const i=XY(t);if(i!==XY(r))throw new Error("incompatible units");const n=wde(t,i)?e:FGe(e,t,i);return wde(r,i)?n:NGe(n,r,i)}function VGe(e,t){const r=ps(e,t,"meters");return Math.abs(r)<3e3?"meters":"kilometers"}function zGe(e,t){const r=ps(e,t,"meters");return Math.abs(r)<1e5?"meters":"kilometers"}function UGe(e,t){const r=ps(e,t,"feet");return Math.abs(r)<1e3?"feet":"miles"}function BGe(e,t){const r=ps(e,t,"feet");return Math.abs(r)<1e5?"feet":"miles"}function RIt(e,t){const r=ps(e,t,"square-meters");return Math.abs(r)<3e6?"square-meters":"square-kilometers"}function OIt(e,t){const r=ps(e,t,"square-feet");return Math.abs(r)<1e6?"square-feet":"square-miles"}function GGe(e,t,r){return ps(e,t,"meters")/(r*Math.PI/180)}function pTe(e){return LGe.fromJSON(e.toLowerCase())||null}function Z5(e){if(e&&typeof e=="object"&&!nA(e))return 1;const t=vc(e);return t>1e5?1:t}function jGe(e){return vc(e)>=(e instanceof Ye?Ar(e).metersPerDegree:1e5)?"meters":jre(e)}function vc(e,t=$r.metersPerDegree){return vt(qGe(e,!0),t)}function qGe(e,t=!1){let r,i,n=null;if(e!=null&&(typeof e=="object"?(r=e.wkid,i=e.wkt):typeof e=="number"?r=e:typeof e=="string"&&(i=e)),r){if(Wte(r))return em.metersPerDegree;if(Xte(r))return Ay.metersPerDegree;n=lw.values[lw[r]],!n&&t&&$Ge.has(r)&&(n=IGe)}else i&&(yTe(i)?n=xde(hTe.exec(i),n):gTe(i)&&(n=xde(fTe.exec(i),n)));return n}function xde(e,t){return e&&e[1]?mTe(e[1]):t}function mTe(e){return parseFloat(e.split(",")[1])}function jre(e){let t,r,i=null;if(e!=null&&(typeof e=="object"?(t=e.wkid,r=e.wkt):typeof e=="number"?t=e:typeof e=="string"&&(r=e)),t)i=lw.units[lw[t]];else if(r){const n=yTe(r)?hTe:gTe(r)?fTe:null;if(n){const s=n.exec(r);s&&s[1]&&(i=WGe(s[1]))}}return _(i)?pTe(i):null}function MIt(e){const t=jre(e);return R(t)||!kGe.includes(t)?null:t}function gTe(e){return/^GEOCCS/i.test(e)}function yTe(e){return/^PROJCS/i.test(e)}const HGe=1e-7;function WGe(e){const t=/[\\"\\']{1}([^\\"\\']+)/.exec(e);let r=t&&t[1];if(!r||!lw.units.includes(r)){const i=mTe(e);r=null;const n=lw.values;for(let s=0;s<n.length;++s)if(Math.abs(i-n[s])<HGe){r=lw.units[s];break}}return r}function XGe(e){const t=jre(e);if(R(t))return null;switch(t){case"feet":case"us-feet":case"clarke-feet":case"clarke-yards":case"clarke-links":case"sears-yards":case"sears-feet":case"sears-chains":case"benoit-1895-b-chains":case"indian-yards":case"indian-1937-yards":case"gold-coast-feet":case"sears-1922-truncated-chains":return"imperial";case"50-kilometers":case"150-kilometers":case"meters":return"metric"}return null}function PIt(e){var n,s,a;const t="metric";if(R(e))return t;const r=e.map,i=r&&"portalItem"in r?(n=r.portalItem)==null?void 0:n.portal:null;if(i)switch((a=(s=i==null?void 0:i.user)==null?void 0:s.units)!=null?a:i.units){case t:return t;case"english":return"imperial"}return vt(XGe(e.spatialReference),t)}const bTe={esriAcres:"acres",esriAres:"ares",esriHectares:"hectares",esriSquareCentimeters:"square-centimeters",esriSquareDecimeters:"square-decimeters",esriSquareFeet:"square-feet",esriSquareInches:"square-inches",esriSquareKilometers:"square-kilometers",esriSquareMeters:"square-meters",esriSquareMiles:"square-miles",esriSquareMillimeters:"square-millimeters",esriSquareUsFeet:"square-us-feet",esriSquareYards:"square-yards"},vTe={esriCentimeters:"centimeters",esriDecimeters:"decimeters",esriFeet:"feet",esriInches:"inches",esriKilometers:"kilometers",esriMeters:"meters",esriMiles:"miles",esriMillimeters:"millimeters",esriNauticalMiles:"nautical-miles",esriYards:"yards"},YGe=uo()(bTe),ZGe=uo()(vTe);uo()({...bTe,...vTe});var OE;const qF=uo()({orthometric:"gravity-related-height",gravity_related_height:"gravity-related-height",ellipsoidal:"ellipsoidal"}),_Te=qF.jsonValues.slice();iV(_Te,"orthometric");const WC=uo()({meter:"meters",foot:"feet","us-foot":"us-feet","clarke-foot":"clarke-feet","clarke-yard":"clarke-yards","clarke-link":"clarke-links","sears-yard":"sears-yards","sears-foot":"sears-feet","sears-chain":"sears-chains","benoit-1895-b-chain":"benoit-1895-b-chains","indian-yard":"indian-yards","indian-1937-yard":"indian-1937-yards","gold-coast-foot":"gold-coast-feet","sears-1922-truncated-chain":"sears-1922-truncated-chains","50-kilometers":"50-kilometers","150-kilometers":"150-kilometers"});let Af=OE=class extends ge{constructor(e){super(e),this.heightModel="gravity-related-height",this.heightUnit="meters",this.vertCRS=null}writeHeightModel(e,t,r){return qF.write(e,t,r)}readHeightModel(e,t,r){return qF.read(e)||(r&&r.messages&&r.messages.push(QGe(e,{context:r})),null)}readHeightUnit(e,t,r){return WC.read(e)||(r&&r.messages&&r.messages.push(Tde(e,{context:r})),null)}readHeightUnitService(e,t,r){return pTe(e)||WC.read(e)||(r&&r.messages&&r.messages.push(Tde(e,{context:r})),null)}readVertCRS(e,t){return t.vertCRS||t.ellipsoid||t.geoid}clone(){return new OE({heightModel:this.heightModel,heightUnit:this.heightUnit,vertCRS:this.vertCRS})}equals(e){return!!e&&(this===e||this.heightModel===e.heightModel&&this.heightUnit===e.heightUnit&&this.vertCRS===e.vertCRS)}static deriveUnitFromSR(e,t){const r=jGe(t);return new OE({heightModel:e.heightModel,heightUnit:r,vertCRS:e.vertCRS})}write(e,t){return t={origin:"web-scene",...t},super.write(e,t)}static fromJSON(e){if(!e)return null;const t=new OE;return t.read(e,{origin:"web-scene"}),t}};function Tde(e,t){return new cc("height-unit:unsupported",`Height unit of value '${e}' is not supported`,t)}function QGe(e,t){return new cc("height-model:unsupported",`Height model of value '${e}' is not supported`,t)}d([f({type:qF.apiValues,constructOnly:!0,json:{origins:{"web-scene":{type:_Te,default:"ellipsoidal"}}}})],Af.prototype,"heightModel",void 0),d([Xe("web-scene","heightModel")],Af.prototype,"writeHeightModel",null),d([$e(["web-scene","service"],"heightModel")],Af.prototype,"readHeightModel",null),d([f({type:WC.apiValues,constructOnly:!0,json:{origins:{"web-scene":{type:WC.jsonValues,write:WC.write}}}})],Af.prototype,"heightUnit",void 0),d([$e("web-scene","heightUnit")],Af.prototype,"readHeightUnit",null),d([$e("service","heightUnit")],Af.prototype,"readHeightUnitService",null),d([f({type:String,constructOnly:!0,json:{origins:{"web-scene":{write:!0}}}})],Af.prototype,"vertCRS",void 0),d([$e("service","vertCRS",["vertCRS","ellipsoid","geoid"])],Af.prototype,"readVertCRS",null),Af=OE=d([$("esri.geometry.HeightModelInfo")],Af);const Ex=Af;function Ln(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function Rm(e,t,r,i,n,s,a,o,l,c,u,h,p,m,g,b,w){return e[0]=t,e[1]=r,e[2]=i,e[3]=n,e[4]=s,e[5]=a,e[6]=o,e[7]=l,e[8]=c,e[9]=u,e[10]=h,e[11]=p,e[12]=m,e[13]=g,e[14]=b,e[15]=w,e}function pm(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function hc(e,t){if(e===t){const r=t[1],i=t[2],n=t[3],s=t[6],a=t[7],o=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=r,e[6]=t[9],e[7]=t[13],e[8]=i,e[9]=s,e[11]=t[14],e[12]=n,e[13]=a,e[14]=o}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e}function Rn(e,t){const r=t[0],i=t[1],n=t[2],s=t[3],a=t[4],o=t[5],l=t[6],c=t[7],u=t[8],h=t[9],p=t[10],m=t[11],g=t[12],b=t[13],w=t[14],v=t[15],x=r*o-i*a,T=r*l-n*a,E=r*c-s*a,C=i*l-n*o,A=i*c-s*o,P=n*c-s*l,I=u*b-h*g,L=u*w-p*g,V=u*v-m*g,G=h*w-p*b,B=h*v-m*b,X=p*v-m*w;let Y=x*X-T*B+E*G+C*V-A*L+P*I;return Y?(Y=1/Y,e[0]=(o*X-l*B+c*G)*Y,e[1]=(n*B-i*X-s*G)*Y,e[2]=(b*P-w*A+v*C)*Y,e[3]=(p*A-h*P-m*C)*Y,e[4]=(l*V-a*X-c*L)*Y,e[5]=(r*X-n*V+s*L)*Y,e[6]=(w*E-g*P-v*T)*Y,e[7]=(u*P-p*E+m*T)*Y,e[8]=(a*B-o*V+c*I)*Y,e[9]=(i*V-r*B-s*I)*Y,e[10]=(g*A-b*E+v*x)*Y,e[11]=(h*E-u*A-m*x)*Y,e[12]=(o*L-a*G-l*I)*Y,e[13]=(r*G-i*L+n*I)*Y,e[14]=(b*T-g*C-w*x)*Y,e[15]=(u*C-h*T+p*x)*Y,e):null}function JGe(e,t){const r=t[0],i=t[1],n=t[2],s=t[3],a=t[4],o=t[5],l=t[6],c=t[7],u=t[8],h=t[9],p=t[10],m=t[11],g=t[12],b=t[13],w=t[14],v=t[15];return e[0]=o*(p*v-m*w)-h*(l*v-c*w)+b*(l*m-c*p),e[1]=-(i*(p*v-m*w)-h*(n*v-s*w)+b*(n*m-s*p)),e[2]=i*(l*v-c*w)-o*(n*v-s*w)+b*(n*c-s*l),e[3]=-(i*(l*m-c*p)-o*(n*m-s*p)+h*(n*c-s*l)),e[4]=-(a*(p*v-m*w)-u*(l*v-c*w)+g*(l*m-c*p)),e[5]=r*(p*v-m*w)-u*(n*v-s*w)+g*(n*m-s*p),e[6]=-(r*(l*v-c*w)-a*(n*v-s*w)+g*(n*c-s*l)),e[7]=r*(l*m-c*p)-a*(n*m-s*p)+u*(n*c-s*l),e[8]=a*(h*v-m*b)-u*(o*v-c*b)+g*(o*m-c*h),e[9]=-(r*(h*v-m*b)-u*(i*v-s*b)+g*(i*m-s*h)),e[10]=r*(o*v-c*b)-a*(i*v-s*b)+g*(i*c-s*o),e[11]=-(r*(o*m-c*h)-a*(i*m-s*h)+u*(i*c-s*o)),e[12]=-(a*(h*w-p*b)-u*(o*w-l*b)+g*(o*p-l*h)),e[13]=r*(h*w-p*b)-u*(i*w-n*b)+g*(i*p-n*h),e[14]=-(r*(o*w-l*b)-a*(i*w-n*b)+g*(i*l-n*o)),e[15]=r*(o*p-l*h)-a*(i*p-n*h)+u*(i*l-n*o),e}function KGe(e){const t=e[0],r=e[1],i=e[2],n=e[3],s=e[4],a=e[5],o=e[6],l=e[7],c=e[8],u=e[9],h=e[10],p=e[11],m=e[12],g=e[13],b=e[14],w=e[15];return(t*a-r*s)*(h*w-p*b)-(t*o-i*s)*(u*w-p*g)+(t*l-n*s)*(u*b-h*g)+(r*o-i*a)*(c*w-p*m)-(r*l-n*a)*(c*b-h*m)+(i*l-n*o)*(c*g-u*m)}function Zi(e,t,r){const i=t[0],n=t[1],s=t[2],a=t[3],o=t[4],l=t[5],c=t[6],u=t[7],h=t[8],p=t[9],m=t[10],g=t[11],b=t[12],w=t[13],v=t[14],x=t[15];let T=r[0],E=r[1],C=r[2],A=r[3];return e[0]=T*i+E*o+C*h+A*b,e[1]=T*n+E*l+C*p+A*w,e[2]=T*s+E*c+C*m+A*v,e[3]=T*a+E*u+C*g+A*x,T=r[4],E=r[5],C=r[6],A=r[7],e[4]=T*i+E*o+C*h+A*b,e[5]=T*n+E*l+C*p+A*w,e[6]=T*s+E*c+C*m+A*v,e[7]=T*a+E*u+C*g+A*x,T=r[8],E=r[9],C=r[10],A=r[11],e[8]=T*i+E*o+C*h+A*b,e[9]=T*n+E*l+C*p+A*w,e[10]=T*s+E*c+C*m+A*v,e[11]=T*a+E*u+C*g+A*x,T=r[12],E=r[13],C=r[14],A=r[15],e[12]=T*i+E*o+C*h+A*b,e[13]=T*n+E*l+C*p+A*w,e[14]=T*s+E*c+C*m+A*v,e[15]=T*a+E*u+C*g+A*x,e}function wl(e,t,r){const i=r[0],n=r[1],s=r[2];if(t===e)e[12]=t[0]*i+t[4]*n+t[8]*s+t[12],e[13]=t[1]*i+t[5]*n+t[9]*s+t[13],e[14]=t[2]*i+t[6]*n+t[10]*s+t[14],e[15]=t[3]*i+t[7]*n+t[11]*s+t[15];else{const a=t[0],o=t[1],l=t[2],c=t[3],u=t[4],h=t[5],p=t[6],m=t[7],g=t[8],b=t[9],w=t[10],v=t[11];e[0]=a,e[1]=o,e[2]=l,e[3]=c,e[4]=u,e[5]=h,e[6]=p,e[7]=m,e[8]=g,e[9]=b,e[10]=w,e[11]=v,e[12]=a*i+u*n+g*s+t[12],e[13]=o*i+h*n+b*s+t[13],e[14]=l*i+p*n+w*s+t[14],e[15]=c*i+m*n+v*s+t[15]}return e}function DV(e,t,r){const i=r[0],n=r[1],s=r[2];return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e[4]=t[4]*n,e[5]=t[5]*n,e[6]=t[6]*n,e[7]=t[7]*n,e[8]=t[8]*s,e[9]=t[9]*s,e[10]=t[10]*s,e[11]=t[11]*s,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function rd(e,t,r,i){let n,s,a,o,l,c,u,h,p,m,g,b,w,v,x,T,E,C,A,P,I,L,V,G,B=i[0],X=i[1],Y=i[2],ce=Math.sqrt(B*B+X*X+Y*Y);return ce<Rt?null:(ce=1/ce,B*=ce,X*=ce,Y*=ce,n=Math.sin(r),s=Math.cos(r),a=1-s,o=t[0],l=t[1],c=t[2],u=t[3],h=t[4],p=t[5],m=t[6],g=t[7],b=t[8],w=t[9],v=t[10],x=t[11],T=B*B*a+s,E=X*B*a+Y*n,C=Y*B*a-X*n,A=B*X*a-Y*n,P=X*X*a+s,I=Y*X*a+B*n,L=B*Y*a+X*n,V=X*Y*a-B*n,G=Y*Y*a+s,e[0]=o*T+h*E+b*C,e[1]=l*T+p*E+w*C,e[2]=c*T+m*E+v*C,e[3]=u*T+g*E+x*C,e[4]=o*A+h*P+b*I,e[5]=l*A+p*P+w*I,e[6]=c*A+m*P+v*I,e[7]=u*A+g*P+x*I,e[8]=o*L+h*V+b*G,e[9]=l*L+p*V+w*G,e[10]=c*L+m*V+v*G,e[11]=u*L+g*V+x*G,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e)}function Q5(e,t,r){const i=Math.sin(r),n=Math.cos(r),s=t[4],a=t[5],o=t[6],l=t[7],c=t[8],u=t[9],h=t[10],p=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=s*n+c*i,e[5]=a*n+u*i,e[6]=o*n+h*i,e[7]=l*n+p*i,e[8]=c*n-s*i,e[9]=u*n-a*i,e[10]=h*n-o*i,e[11]=p*n-l*i,e}function FV(e,t,r){const i=Math.sin(r),n=Math.cos(r),s=t[0],a=t[1],o=t[2],l=t[3],c=t[8],u=t[9],h=t[10],p=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=s*n-c*i,e[1]=a*n-u*i,e[2]=o*n-h*i,e[3]=l*n-p*i,e[8]=s*i+c*n,e[9]=a*i+u*n,e[10]=o*i+h*n,e[11]=l*i+p*n,e}function J5(e,t,r){const i=Math.sin(r),n=Math.cos(r),s=t[0],a=t[1],o=t[2],l=t[3],c=t[4],u=t[5],h=t[6],p=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=s*n+c*i,e[1]=a*n+u*i,e[2]=o*n+h*i,e[3]=l*n+p*i,e[4]=c*n-s*i,e[5]=u*n-a*i,e[6]=h*n-o*i,e[7]=p*n-l*i,e}function NV(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e}function eje(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Cu(e,t,r){let i,n,s,a=r[0],o=r[1],l=r[2],c=Math.sqrt(a*a+o*o+l*l);return c<Rt?null:(c=1/c,a*=c,o*=c,l*=c,i=Math.sin(t),n=Math.cos(t),s=1-n,e[0]=a*a*s+n,e[1]=o*a*s+l*i,e[2]=l*a*s-o*i,e[3]=0,e[4]=a*o*s-l*i,e[5]=o*o*s+n,e[6]=l*o*s+a*i,e[7]=0,e[8]=a*l*s+o*i,e[9]=o*l*s-a*i,e[10]=l*l*s+n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)}function wTe(e,t){const r=Math.sin(t),i=Math.cos(t);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=i,e[6]=r,e[7]=0,e[8]=0,e[9]=-r,e[10]=i,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function tje(e,t){const r=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=0,e[2]=-r,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=r,e[9]=0,e[10]=i,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function xTe(e,t){const r=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=r,e[2]=0,e[3]=0,e[4]=-r,e[5]=i,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function TTe(e,t,r){const i=t[0],n=t[1],s=t[2],a=t[3],o=i+i,l=n+n,c=s+s,u=i*o,h=i*l,p=i*c,m=n*l,g=n*c,b=s*c,w=a*o,v=a*l,x=a*c;return e[0]=1-(m+b),e[1]=h+x,e[2]=p-v,e[3]=0,e[4]=h-x,e[5]=1-(u+b),e[6]=g+w,e[7]=0,e[8]=p+v,e[9]=g-w,e[10]=1-(u+m),e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function rje(e,t){const r=ije,i=-t[0],n=-t[1],s=-t[2],a=t[3],o=t[4],l=t[5],c=t[6],u=t[7],h=i*i+n*n+s*s+a*a;return h>0?(r[0]=2*(o*a+u*i+l*s-c*n)/h,r[1]=2*(l*a+u*n+c*i-o*s)/h,r[2]=2*(c*a+u*s+o*n-l*i)/h):(r[0]=2*(o*a+u*i+l*s-c*n),r[1]=2*(l*a+u*n+c*i-o*s),r[2]=2*(c*a+u*s+o*n-l*i)),TTe(e,t,r),e}const ije=M();function nje(e,t){return e[0]=t[12],e[1]=t[13],e[2]=t[14],e}function STe(e,t){const r=t[0],i=t[1],n=t[2],s=t[4],a=t[5],o=t[6],l=t[8],c=t[9],u=t[10];return e[0]=Math.sqrt(r*r+i*i+n*n),e[1]=Math.sqrt(s*s+a*a+o*o),e[2]=Math.sqrt(l*l+c*c+u*u),e}function sje(e,t){const r=t[0]+t[5]+t[10];let i=0;return r>0?(i=2*Math.sqrt(r+1),e[3]=.25*i,e[0]=(t[6]-t[9])/i,e[1]=(t[8]-t[2])/i,e[2]=(t[1]-t[4])/i):t[0]>t[5]&&t[0]>t[10]?(i=2*Math.sqrt(1+t[0]-t[5]-t[10]),e[3]=(t[6]-t[9])/i,e[0]=.25*i,e[1]=(t[1]+t[4])/i,e[2]=(t[8]+t[2])/i):t[5]>t[10]?(i=2*Math.sqrt(1+t[5]-t[0]-t[10]),e[3]=(t[8]-t[2])/i,e[0]=(t[1]+t[4])/i,e[1]=.25*i,e[2]=(t[6]+t[9])/i):(i=2*Math.sqrt(1+t[10]-t[0]-t[5]),e[3]=(t[1]-t[4])/i,e[0]=(t[8]+t[2])/i,e[1]=(t[6]+t[9])/i,e[2]=.25*i),e}function aje(e,t,r,i){const n=t[0],s=t[1],a=t[2],o=t[3],l=n+n,c=s+s,u=a+a,h=n*l,p=n*c,m=n*u,g=s*c,b=s*u,w=a*u,v=o*l,x=o*c,T=o*u,E=i[0],C=i[1],A=i[2];return e[0]=(1-(g+w))*E,e[1]=(p+T)*E,e[2]=(m-x)*E,e[3]=0,e[4]=(p-T)*C,e[5]=(1-(h+w))*C,e[6]=(b+v)*C,e[7]=0,e[8]=(m+x)*A,e[9]=(b-v)*A,e[10]=(1-(h+g))*A,e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function oje(e,t,r,i,n){const s=t[0],a=t[1],o=t[2],l=t[3],c=s+s,u=a+a,h=o+o,p=s*c,m=s*u,g=s*h,b=a*u,w=a*h,v=o*h,x=l*c,T=l*u,E=l*h,C=i[0],A=i[1],P=i[2],I=n[0],L=n[1],V=n[2],G=(1-(b+v))*C,B=(m+E)*C,X=(g-T)*C,Y=(m-E)*A,ce=(1-(p+v))*A,se=(w+x)*A,D=(g+T)*P,F=(w-x)*P,U=(1-(p+b))*P;return e[0]=G,e[1]=B,e[2]=X,e[3]=0,e[4]=Y,e[5]=ce,e[6]=se,e[7]=0,e[8]=D,e[9]=F,e[10]=U,e[11]=0,e[12]=r[0]+I-(G*I+Y*L+D*V),e[13]=r[1]+L-(B*I+ce*L+F*V),e[14]=r[2]+V-(X*I+se*L+U*V),e[15]=1,e}function lje(e,t){const r=t[0],i=t[1],n=t[2],s=t[3],a=r+r,o=i+i,l=n+n,c=r*a,u=i*a,h=i*o,p=n*a,m=n*o,g=n*l,b=s*a,w=s*o,v=s*l;return e[0]=1-h-g,e[1]=u+v,e[2]=p-w,e[3]=0,e[4]=u-v,e[5]=1-c-g,e[6]=m+b,e[7]=0,e[8]=p+w,e[9]=m-b,e[10]=1-c-h,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function ETe(e,t,r,i,n,s,a){const o=1/(r-t),l=1/(n-i),c=1/(s-a);return e[0]=2*s*o,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=2*s*l,e[6]=0,e[7]=0,e[8]=(r+t)*o,e[9]=(n+i)*l,e[10]=(a+s)*c,e[11]=-1,e[12]=0,e[13]=0,e[14]=a*s*2*c,e[15]=0,e}function cje(e,t,r,i,n){const s=1/Math.tan(t/2);let a;return e[0]=s/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=s,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,n!=null&&n!==1/0?(a=1/(i-n),e[10]=(n+i)*a,e[14]=2*n*i*a):(e[10]=-1,e[14]=-2*i),e}function dje(e,t,r,i){const n=Math.tan(t.upDegrees*Math.PI/180),s=Math.tan(t.downDegrees*Math.PI/180),a=Math.tan(t.leftDegrees*Math.PI/180),o=Math.tan(t.rightDegrees*Math.PI/180),l=2/(a+o),c=2/(n+s);return e[0]=l,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=c,e[6]=0,e[7]=0,e[8]=-(a-o)*l*.5,e[9]=(n-s)*c*.5,e[10]=i/(r-i),e[11]=-1,e[12]=0,e[13]=0,e[14]=i*r/(r-i),e[15]=0,e}function qre(e,t,r,i,n,s,a){const o=1/(t-r),l=1/(i-n),c=1/(s-a);return e[0]=-2*o,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*l,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*c,e[11]=0,e[12]=(t+r)*o,e[13]=(n+i)*l,e[14]=(a+s)*c,e[15]=1,e}function kV(e,t,r,i){let n,s,a,o,l,c,u,h,p,m;const g=t[0],b=t[1],w=t[2],v=i[0],x=i[1],T=i[2],E=r[0],C=r[1],A=r[2];return Math.abs(g-E)<Rt&&Math.abs(b-C)<Rt&&Math.abs(w-A)<Rt?pm(e):(u=g-E,h=b-C,p=w-A,m=1/Math.sqrt(u*u+h*h+p*p),u*=m,h*=m,p*=m,n=x*p-T*h,s=T*u-v*p,a=v*h-x*u,m=Math.sqrt(n*n+s*s+a*a),m?(m=1/m,n*=m,s*=m,a*=m):(n=0,s=0,a=0),o=h*a-p*s,l=p*n-u*a,c=u*s-h*n,m=Math.sqrt(o*o+l*l+c*c),m?(m=1/m,o*=m,l*=m,c*=m):(o=0,l=0,c=0),e[0]=n,e[1]=o,e[2]=u,e[3]=0,e[4]=s,e[5]=l,e[6]=h,e[7]=0,e[8]=a,e[9]=c,e[10]=p,e[11]=0,e[12]=-(n*g+s*b+a*w),e[13]=-(o*g+l*b+c*w),e[14]=-(u*g+h*b+p*w),e[15]=1,e)}function CTe(e,t,r,i){const n=t[0],s=t[1],a=t[2],o=i[0],l=i[1],c=i[2];let u=n-r[0],h=s-r[1],p=a-r[2],m=u*u+h*h+p*p;m>0&&(m=1/Math.sqrt(m),u*=m,h*=m,p*=m);let g=l*p-c*h,b=c*u-o*p,w=o*h-l*u;return m=g*g+b*b+w*w,m>0&&(m=1/Math.sqrt(m),g*=m,b*=m,w*=m),e[0]=g,e[1]=b,e[2]=w,e[3]=0,e[4]=h*w-p*b,e[5]=p*g-u*w,e[6]=u*b-h*g,e[7]=0,e[8]=u,e[9]=h,e[10]=p,e[11]=0,e[12]=n,e[13]=s,e[14]=a,e[15]=1,e}function uje(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"}function hje(e){return Math.sqrt(e[0]**2+e[1]**2+e[2]**2+e[3]**2+e[4]**2+e[5]**2+e[6]**2+e[7]**2+e[8]**2+e[9]**2+e[10]**2+e[11]**2+e[12]**2+e[13]**2+e[14]**2+e[15]**2)}function fje(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e[4]=t[4]+r[4],e[5]=t[5]+r[5],e[6]=t[6]+r[6],e[7]=t[7]+r[7],e[8]=t[8]+r[8],e[9]=t[9]+r[9],e[10]=t[10]+r[10],e[11]=t[11]+r[11],e[12]=t[12]+r[12],e[13]=t[13]+r[13],e[14]=t[14]+r[14],e[15]=t[15]+r[15],e}function ATe(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e[4]=t[4]-r[4],e[5]=t[5]-r[5],e[6]=t[6]-r[6],e[7]=t[7]-r[7],e[8]=t[8]-r[8],e[9]=t[9]-r[9],e[10]=t[10]-r[10],e[11]=t[11]-r[11],e[12]=t[12]-r[12],e[13]=t[13]-r[13],e[14]=t[14]-r[14],e[15]=t[15]-r[15],e}function pje(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=t[7]*r,e[8]=t[8]*r,e[9]=t[9]*r,e[10]=t[10]*r,e[11]=t[11]*r,e[12]=t[12]*r,e[13]=t[13]*r,e[14]=t[14]*r,e[15]=t[15]*r,e}function mje(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e[2]=t[2]+r[2]*i,e[3]=t[3]+r[3]*i,e[4]=t[4]+r[4]*i,e[5]=t[5]+r[5]*i,e[6]=t[6]+r[6]*i,e[7]=t[7]+r[7]*i,e[8]=t[8]+r[8]*i,e[9]=t[9]+r[9]*i,e[10]=t[10]+r[10]*i,e[11]=t[11]+r[11]*i,e[12]=t[12]+r[12]*i,e[13]=t[13]+r[13]*i,e[14]=t[14]+r[14]*i,e[15]=t[15]+r[15]*i,e}function gje(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]&&e[9]===t[9]&&e[10]===t[10]&&e[11]===t[11]&&e[12]===t[12]&&e[13]===t[13]&&e[14]===t[14]&&e[15]===t[15]}function RTe(e,t){if(e===t)return!0;const r=e[0],i=e[1],n=e[2],s=e[3],a=e[4],o=e[5],l=e[6],c=e[7],u=e[8],h=e[9],p=e[10],m=e[11],g=e[12],b=e[13],w=e[14],v=e[15],x=t[0],T=t[1],E=t[2],C=t[3],A=t[4],P=t[5],I=t[6],L=t[7],V=t[8],G=t[9],B=t[10],X=t[11],Y=t[12],ce=t[13],se=t[14],D=t[15];return Math.abs(r-x)<=Rt*Math.max(1,Math.abs(r),Math.abs(x))&&Math.abs(i-T)<=Rt*Math.max(1,Math.abs(i),Math.abs(T))&&Math.abs(n-E)<=Rt*Math.max(1,Math.abs(n),Math.abs(E))&&Math.abs(s-C)<=Rt*Math.max(1,Math.abs(s),Math.abs(C))&&Math.abs(a-A)<=Rt*Math.max(1,Math.abs(a),Math.abs(A))&&Math.abs(o-P)<=Rt*Math.max(1,Math.abs(o),Math.abs(P))&&Math.abs(l-I)<=Rt*Math.max(1,Math.abs(l),Math.abs(I))&&Math.abs(c-L)<=Rt*Math.max(1,Math.abs(c),Math.abs(L))&&Math.abs(u-V)<=Rt*Math.max(1,Math.abs(u),Math.abs(V))&&Math.abs(h-G)<=Rt*Math.max(1,Math.abs(h),Math.abs(G))&&Math.abs(p-B)<=Rt*Math.max(1,Math.abs(p),Math.abs(B))&&Math.abs(m-X)<=Rt*Math.max(1,Math.abs(m),Math.abs(X))&&Math.abs(g-Y)<=Rt*Math.max(1,Math.abs(g),Math.abs(Y))&&Math.abs(b-ce)<=Rt*Math.max(1,Math.abs(b),Math.abs(ce))&&Math.abs(w-se)<=Rt*Math.max(1,Math.abs(w),Math.abs(se))&&Math.abs(v-D)<=Rt*Math.max(1,Math.abs(v),Math.abs(D))}function Hre(e){const t=Rt,r=e[0],i=e[1],n=e[2],s=e[4],a=e[5],o=e[6],l=e[8],c=e[9],u=e[10];return Math.abs(1-(r*r+s*s+l*l))<=t&&Math.abs(1-(i*i+a*a+c*c))<=t&&Math.abs(1-(n*n+o*o+u*u))<=t}const yje=Zi,bje=ATe;Object.freeze(Object.defineProperty({__proto__:null,copy:Ln,set:Rm,identity:pm,transpose:hc,invert:Rn,adjoint:JGe,determinant:KGe,multiply:Zi,translate:wl,scale:DV,rotate:rd,rotateX:Q5,rotateY:FV,rotateZ:J5,fromTranslation:NV,fromScaling:eje,fromRotation:Cu,fromXRotation:wTe,fromYRotation:tje,fromZRotation:xTe,fromRotationTranslation:TTe,fromQuat2:rje,getTranslation:nje,getScaling:STe,getRotation:sje,fromRotationTranslationScale:aje,fromRotationTranslationScaleOrigin:oje,fromQuat:lje,frustum:ETe,perspective:cje,perspectiveFromFieldOfView:dje,ortho:qre,lookAt:kV,targetTo:CTe,str:uje,frob:hje,add:fje,subtract:ATe,multiplyScalar:pje,multiplyScalarAndAdd:mje,exactEquals:gje,equals:RTe,isOrthoNormal:Hre,mul:yje,sub:bje},Symbol.toStringTag,{value:"Module"}));let fG,ae=null;function OTe(){return!!ae}function vje(){return!!ue("esri-wasm")}function MTe(){return fG||(fG=ie(()=>import("./pe-wasm.9649c26b.js"),[],import.meta.url).then(e=>e.p).then(({default:e})=>e({locateFile:t=>xr(`esri/geometry/support/${t}`)})).then(e=>{ITe(e)}),fG)}var YY,wn,ZY;(function(e){function t(s,a,o){ae.ensureCache.prepare();const l=b3(o),c=o===l,u=ae.ensureFloat64(l),h=ae._pe_geog_to_proj(ae.getPointer(s),a,u);return h&&q1(o,a,u,c),h}function r(s,a,o,l){switch(l){case wn.PE_TRANSFORM_P_TO_G:return i(s,a,o);case wn.PE_TRANSFORM_G_TO_P:return t(s,a,o)}return 0}function i(s,a,o){return n(s,a,o,0)}function n(s,a,o,l){ae.ensureCache.prepare();const c=b3(o),u=o===c,h=ae.ensureFloat64(c),p=ae._pe_proj_to_geog_center(ae.getPointer(s),a,h,l);return p&&q1(o,a,h,u),p}e.geogToProj=t,e.projGeog=r,e.projToGeog=i,e.projToGeogCenter=n})(YY||(YY={})),function(e){function t(){e.PE_BUFFER_MAX=ae.PeDefs.prototype.PE_BUFFER_MAX,e.PE_NAME_MAX=ae.PeDefs.prototype.PE_NAME_MAX,e.PE_MGRS_MAX=ae.PeDefs.prototype.PE_MGRS_MAX,e.PE_USNG_MAX=ae.PeDefs.prototype.PE_USNG_MAX,e.PE_DD_MAX=ae.PeDefs.prototype.PE_DD_MAX,e.PE_DDM_MAX=ae.PeDefs.prototype.PE_DDM_MAX,e.PE_DMS_MAX=ae.PeDefs.prototype.PE_DMS_MAX,e.PE_UTM_MAX=ae.PeDefs.prototype.PE_UTM_MAX,e.PE_PARM_MAX=ae.PeDefs.prototype.PE_PARM_MAX,e.PE_TYPE_NONE=ae.PeDefs.prototype.PE_TYPE_NONE,e.PE_TYPE_GEOGCS=ae.PeDefs.prototype.PE_TYPE_GEOGCS,e.PE_TYPE_PROJCS=ae.PeDefs.prototype.PE_TYPE_PROJCS,e.PE_TYPE_GEOGTRAN=ae.PeDefs.prototype.PE_TYPE_GEOGTRAN,e.PE_TYPE_COORDSYS=ae.PeDefs.prototype.PE_TYPE_COORDSYS,e.PE_TYPE_UNIT=ae.PeDefs.prototype.PE_TYPE_UNIT,e.PE_TYPE_LINUNIT=ae.PeDefs.prototype.PE_TYPE_LINUNIT,e.PE_STR_OPTS_NONE=ae.PeDefs.prototype.PE_STR_OPTS_NONE,e.PE_STR_AUTH_NONE=ae.PeDefs.prototype.PE_STR_AUTH_NONE,e.PE_STR_AUTH_TOP=ae.PeDefs.prototype.PE_STR_AUTH_TOP,e.PE_STR_NAME_CANON=ae.PeDefs.prototype.PE_STR_NAME_CANON,e.PE_PARM_X0=ae.PeDefs.prototype.PE_PARM_X0,e.PE_PARM_ND=ae.PeDefs.prototype.PE_PARM_ND,e.PE_TRANSFORM_1_TO_2=ae.PeDefs.prototype.PE_TRANSFORM_1_TO_2,e.PE_TRANSFORM_2_TO_1=ae.PeDefs.prototype.PE_TRANSFORM_2_TO_1,e.PE_TRANSFORM_P_TO_G=ae.PeDefs.prototype.PE_TRANSFORM_P_TO_G,e.PE_TRANSFORM_G_TO_P=ae.PeDefs.prototype.PE_TRANSFORM_G_TO_P,e.PE_HORIZON_RECT=ae.PeDefs.prototype.PE_HORIZON_RECT,e.PE_HORIZON_POLY=ae.PeDefs.prototype.PE_HORIZON_POLY,e.PE_HORIZON_LINE=ae.PeDefs.prototype.PE_HORIZON_LINE,e.PE_HORIZON_DELTA=ae.PeDefs.prototype.PE_HORIZON_DELTA}e.init=t}(wn||(wn={})),function(e){const t={},r={},i=m=>{if(m){const g=m.getType();switch(g){case wn.PE_TYPE_GEOGCS:m=ae.castObject(m,ae.PeGeogcs);break;case wn.PE_TYPE_PROJCS:m=ae.castObject(m,ae.PeProjcs);break;case wn.PE_TYPE_GEOGTRAN:m=ae.castObject(m,ae.PeGeogtran);break;default:g&wn.PE_TYPE_UNIT&&(m=ae.castObject(m,ae.PeUnit))}}return m};function n(){ae.PeFactory.prototype.initialize(null)}function s(m){return a(wn.PE_TYPE_COORDSYS,m)}function a(m,g){let b=null,w=t[m];if(w||(w={},t[m]=w),w.hasOwnProperty(String(g)))b=w[g];else{const v=ae.PeFactory.prototype.factoryByType(m,g);ae.compare(v,ae.NULL)||(b=v,w[g]=b)}return b=i(b),b}function o(m,g){let b=null,w=r[m];if(w||(w={},r[m]=w),w.hasOwnProperty(g))b=w[g];else{const v=ae.PeFactory.prototype.fromString(m,g);ae.compare(v,ae.NULL)||(b=v,w[g]=b)}return b=i(b),b}function l(m){return a(wn.PE_TYPE_GEOGCS,m)}function c(m){return a(wn.PE_TYPE_GEOGTRAN,m)}function u(m){return ae.PeFactory.prototype.getCode(m)}function h(m){return a(wn.PE_TYPE_PROJCS,m)}function p(m){return a(wn.PE_TYPE_UNIT,m)}e.initialize=n,e.coordsys=s,e.factoryByType=a,e.fromString=o,e.geogcs=l,e.geogtran=c,e.getCode=u,e.projcs=h,e.unit=p}(ZY||(ZY={}));let PTe=null;var HF,QY,JY,KY,WF,eZ,XF,YF,tZ;function ITe(e){function t(s,a,o){s[a]=o(s[a])}ae=e,wn.init(),HF.init(),WF.init(),XF.init(),YF.init(),PTe=class extends ae.PeGCSExtent{destroy(){ae.destroy(this)}};const r=[ae.PeDatum,ae.PeGeogcs,ae.PeGeogtran,ae.PeObject,ae.PeParameter,ae.PePrimem,ae.PeProjcs,ae.PeSpheroid,ae.PeUnit];for(const s of r)t(s.prototype,"getName",a=>function(){return a.call(this,new Array(wn.PE_NAME_MAX))});for(const s of[ae.PeGeogtran,ae.PeProjcs])t(s.prototype,"getParameters",a=>function(){const o=new Array(wn.PE_PARM_MAX);let l=a.call(this);for(let c=0;c<o.length;c++){const u=ae.getValue(l,"*");o[c]=u?ae.wrapPointer(u,ae.PeParameter):null,l+=Int32Array.BYTES_PER_ELEMENT}return o});t(ae.PeHorizon.prototype,"getCoord",s=>function(){const a=this.getSize();if(!a)return null;const o=[];return q1(o,a,s.call(this)),o}),t(ae.PeGTlistExtendedEntry.prototype,"getEntries",s=>{const a=ae._pe_getPeGTlistExtendedGTsSize();return function(){let o=null;const l=s.call(this);if(!ae.compare(l,ae.NULL)){o=[l];const c=this.getSteps();if(c>1){const u=ae.getPointer(l);for(let h=1;h<c;h++)o.push(ae.wrapPointer(u+a*h,ae.PeGTlistExtendedGTs))}}return o}});const i=ae._pe_getPeHorizonSize(),n=s=>function(){let a=this._cache;if(a||(a=new Map,this._cache=a),a.has(s))return a.get(s);let o=null;const l=s.call(this);if(!ae.compare(l,ae.NULL)){o=[l];const c=l.getNump();if(c>1){const u=ae.getPointer(l);for(let h=1;h<c;h++)o.push(ae.wrapPointer(u+i*h,ae.PeHorizon))}}return a.set(s,o),o};t(ae.PeProjcs.prototype,"horizonGcsGenerate",n),t(ae.PeProjcs.prototype,"horizonPcsGenerate",n),ae.PeObject.prototype.toString=function(s=wn.PE_STR_OPTS_NONE){ae.ensureCache.prepare();const a=ae.getPointer(this),o=ae.ensureInt8(new Array(wn.PE_BUFFER_MAX));return ae.UTF8ToString(ae._pe_object_to_string_ext(a,s,o))}}function km(e){if(!e)return;const t=ae.getClass(e);if(!t)return;const r=ae.getCache(t);if(!r)return;const i=ae.getPointer(e);i&&delete r[i]}function kM(e,t){const r=[],i=new Array(t);for(let n=0;n<e;n++)r.push(ae.ensureInt8(i));return r}function b3(e){let t;return Array.isArray(e[0])?(t=[],e.forEach(r=>{t.push(r[0],r[1])})):t=e,t}function q1(e,t,r,i=!1){if(i)for(let n=0;n<2*t;n++)e[n]=ae.getValue(r+n*Float64Array.BYTES_PER_ELEMENT,"double");else{const n=e.length===0;for(let s=0;s<t;s++)n&&(e[s]=new Array(2)),e[s][0]=ae.getValue(r,"double"),e[s][1]=ae.getValue(r+Float64Array.BYTES_PER_ELEMENT,"double"),r+=2*Float64Array.BYTES_PER_ELEMENT}}(function(e){let t;function r(){e.PE_GTLIST_OPTS_COMMON=ae.PeGTlistExtended.prototype.PE_GTLIST_OPTS_COMMON,t=ae._pe_getPeGTlistExtendedEntrySize()}function i(n,s,a,o,l,c){let u=null;const h=new ae.PeInteger(c);try{const p=ae.PeGTlistExtended.prototype.getGTlist(n,s,a,o,l,h);if((c=h.val)&&(u=[p],c>1)){const m=ae.getPointer(p);for(let g=1;g<c;g++)u.push(ae.wrapPointer(m+t*g,ae.PeGTlistExtendedEntry))}}finally{ae.destroy(h)}return u}e.init=r,e.getGTlist=i})(HF||(HF={})),function(e){function t(r){if(r&&r.length){for(const i of r)km(i),i.getEntries().forEach(n=>{km(n);const s=n.getGeogtran();km(s),s.getParameters().forEach(km),[s.getGeogcs1(),s.getGeogcs2()].forEach(a=>{km(a);const o=a.getDatum();km(o),km(o.getSpheroid()),km(a.getPrimem()),km(a.getUnit())})});ae.PeGTlistExtendedEntry.prototype.Delete(r[0])}}e.destroy=t}(QY||(QY={})),function(e){function t(r,i,n,s,a){ae.ensureCache.prepare();const o=b3(n),l=n===o,c=ae.ensureFloat64(o);let u=0;s&&(u=ae.ensureFloat64(s));const h=ae._pe_geog_to_geog(ae.getPointer(r),i,c,u,a);return h&&q1(n,i,c,l),h}e.geogToGeog=t}(JY||(JY={})),function(e){const t=(c,u,h,p,m,g)=>{let b,w;switch(ae.ensureCache.prepare(),c){case"dd":b=ae._pe_geog_to_dd,w=wn.PE_DD_MAX;break;case"ddm":b=ae._pe_geog_to_ddm,w=wn.PE_DDM_MAX;break;case"dms":b=ae._pe_geog_to_dms,w=wn.PE_DMS_MAX}let v=0;u&&(v=ae.getPointer(u));const x=b3(p),T=ae.ensureFloat64(x),E=kM(h,w),C=b(v,h,T,m,ae.ensureInt32(E));if(C)for(let A=0;A<h;A++)g[A]=ae.UTF8ToString(E[A]);return C},r=(c,u,h,p,m)=>{let g;switch(ae.ensureCache.prepare(),c){case"dd":g=ae._pe_dd_to_geog;break;case"ddm":g=ae._pe_ddm_to_geog;break;case"dms":g=ae._pe_dms_to_geog}let b=0;u&&(b=ae.getPointer(u));const w=p.map(E=>ae.ensureString(E)),v=ae.ensureInt32(w),x=ae.ensureFloat64(new Array(2*h)),T=g(b,h,v,x);return T&&q1(m,h,x),T};function i(c,u,h,p,m){return t("dms",c,u,h,p,m)}function n(c,u,h,p){return r("dms",c,u,h,p)}function s(c,u,h,p,m){return t("ddm",c,u,h,p,m)}function a(c,u,h,p){return r("ddm",c,u,h,p)}function o(c,u,h,p,m){return t("dd",c,u,h,p,m)}function l(c,u,h,p){return r("dd",c,u,h,p)}e.geogToDms=i,e.dmsToGeog=n,e.geogToDdm=s,e.ddmToGeog=a,e.geogToDd=o,e.ddToGeog=l}(KY||(KY={})),function(e){function t(){e.PE_MGRS_STYLE_NEW=ae.PeNotationMgrs.prototype.PE_MGRS_STYLE_NEW,e.PE_MGRS_STYLE_OLD=ae.PeNotationMgrs.prototype.PE_MGRS_STYLE_OLD,e.PE_MGRS_STYLE_AUTO=ae.PeNotationMgrs.prototype.PE_MGRS_STYLE_AUTO,e.PE_MGRS_180_ZONE_1_PLUS=ae.PeNotationMgrs.prototype.PE_MGRS_180_ZONE_1_PLUS,e.PE_MGRS_ADD_SPACES=ae.PeNotationMgrs.prototype.PE_MGRS_ADD_SPACES}function r(n,s,a,o,l,c,u){ae.ensureCache.prepare();let h=0;n&&(h=ae.getPointer(n));const p=b3(a),m=ae.ensureFloat64(p),g=kM(s,wn.PE_MGRS_MAX),b=ae.ensureInt32(g),w=ae._pe_geog_to_mgrs_extended(h,s,m,o,l,c,b);if(w)for(let v=0;v<s;v++)u[v]=ae.UTF8ToString(g[v]);return w}function i(n,s,a,o,l){ae.ensureCache.prepare();let c=0;n&&(c=ae.getPointer(n));const u=a.map(g=>ae.ensureString(g)),h=ae.ensureInt32(u),p=ae.ensureFloat64(new Array(2*s)),m=ae._pe_mgrs_to_geog_extended(c,s,h,o,p);return m&&q1(l,s,p),m}e.init=t,e.geogToMgrsExtended=r,e.mgrsToGeogExtended=i}(WF||(WF={})),function(e){function t(i,n,s,a,o,l,c){ae.ensureCache.prepare();let u=0;i&&(u=ae.getPointer(i));const h=b3(s),p=ae.ensureFloat64(h),m=kM(n,wn.PE_MGRS_MAX),g=ae.ensureInt32(m),b=ae._pe_geog_to_usng(u,n,p,a,o,l,g);if(b)for(let w=0;w<n;w++)c[w]=ae.UTF8ToString(m[w]);return b}function r(i,n,s,a){ae.ensureCache.prepare();let o=0;i&&(o=ae.getPointer(i));const l=s.map(p=>ae.ensureString(p)),c=ae.ensureInt32(l),u=ae.ensureFloat64(new Array(2*n)),h=ae._pe_usng_to_geog(o,n,c,u);return h&&q1(a,n,u),h}e.geogToUsng=t,e.usngToGeog=r}(eZ||(eZ={})),function(e){function t(){e.PE_UTM_OPTS_NONE=ae.PeNotationUtm.prototype.PE_UTM_OPTS_NONE,e.PE_UTM_OPTS_ADD_SPACES=ae.PeNotationUtm.prototype.PE_UTM_OPTS_ADD_SPACES,e.PE_UTM_OPTS_NS=ae.PeNotationUtm.prototype.PE_UTM_OPTS_NS}function r(n,s,a,o,l){ae.ensureCache.prepare();let c=0;n&&(c=ae.getPointer(n));const u=b3(a),h=ae.ensureFloat64(u),p=kM(s,wn.PE_UTM_MAX),m=ae.ensureInt32(p),g=ae._pe_geog_to_utm(c,s,h,o,m);if(g)for(let b=0;b<s;b++)l[b]=ae.UTF8ToString(p[b]);return g}function i(n,s,a,o,l){ae.ensureCache.prepare();let c=0;n&&(c=ae.getPointer(n));const u=a.map(g=>ae.ensureString(g)),h=ae.ensureInt32(u),p=ae.ensureFloat64(new Array(2*s)),m=ae._pe_utm_to_geog(c,s,h,o,p);return m&&q1(l,s,p),m}e.init=t,e.geogToUtm=r,e.utmToGeog=i}(XF||(XF={})),function(e){const t=new Map;function r(){e.PE_PCSINFO_OPTION_NONE=ae.PePCSInfo.prototype.PE_PCSINFO_OPTION_NONE,e.PE_PCSINFO_OPTION_DOMAIN=ae.PePCSInfo.prototype.PE_PCSINFO_OPTION_DOMAIN,e.PE_POLE_OUTSIDE_BOUNDARY=ae.PePCSInfo.prototype.PE_POLE_OUTSIDE_BOUNDARY,e.PE_POLE_POINT=ae.PePCSInfo.prototype.PE_POLE_POINT}function i(n,s=e.PE_PCSINFO_OPTION_DOMAIN){let a,o;return t.has(n)&&(o=t.get(n),o[s]&&(a=o[s])),a||(a=ae.PePCSInfo.prototype.generate(n,s),o||(o=[],t.set(n,o)),o[s]=a),a}e.init=r,e.generate=i}(YF||(YF={})),function(e){function t(){return ae.PeVersion.prototype.version_string()}e.versionString=t}(tZ||(tZ={}));const _je=Object.freeze(Object.defineProperty({__proto__:null,get _pe(){return ae},isLoaded:OTe,isSupported:vje,load:MTe,get PeCSTransformations(){return YY},get PeDefs(){return wn},get PeFactory(){return ZY},get PeGCSExtent(){return PTe},get PeGTlistExtended(){return HF},get PeGTlistExtendedEntry(){return QY},get PeGTTransformations(){return JY},get PeNotationDms(){return KY},get PeNotationMgrs(){return WF},get PeNotationUsng(){return eZ},get PeNotationUtm(){return XF},get PePCSInfo(){return YF},get PeVersion(){return tZ},_init:ITe},Symbol.toStringTag,{value:"Module"})),IIt=Math.PI/180,$It=/SPHEROID\[([^\]]+)]/i,cb=$r.radius,ff=$r.eccentricitySquared,wje={a1:cb*ff,a2:cb*ff*cb*ff,a3:cb*ff*ff/2,a4:cb*ff*cb*ff*2.5,a5:cb*ff+cb*ff*ff/2,a6:1-ff},LIt={4267:{a:63782064e-1,f:1/294.9786982},4269:{a:6378137,f:1/298.257222101},4326:{a:$r.radius,f:$r.flattening},104900:{a:2439700,f:0},104901:{a:6051e3,f:0},104902:{a:6051800,f:0},104903:{a:Ay.radius,f:Ay.flattening},104904:{a:3393400,f:1/192.0430107526882},104905:{a:em.radius,f:em.flattening},104906:{a:6200,f:0},104907:{a:11100,f:0},104908:{a:71492e3,f:.06487439154031222},104909:{a:8200,f:0},104910:{a:83500,f:0},104911:{a:1e4,f:0},104912:{a:2409300,f:0},104913:{a:15e3,f:0},104914:{a:4e4,f:0},104915:{a:1562090,f:0},104916:{a:2632345,f:0},104917:{a:85e3,f:0},104918:{a:1821460,f:0},104919:{a:5e3,f:0},104920:{a:12e3,f:0},104921:{a:3e4,f:3},104922:{a:18e3,f:0},104923:{a:14e3,f:0},104924:{a:49300,f:0},104925:{a:60268e3,f:1/10.2079945799458},104926:{a:16e3,f:0},104927:{a:9500,f:0},104928:{a:56e4,f:0},104929:{a:249400,f:0},104930:{a:59500,f:0},104931:{a:16e3,f:0},104932:{a:133e3,f:0},104933:{a:718e3,f:0},104934:{a:888e3,f:0},104935:{a:1986300,f:0},104936:{a:1e4,f:0},104937:{a:41900,f:0},104938:{a:11e4,f:0},104939:{a:50100,f:0},104940:{a:764e3,f:0},104941:{a:11e3,f:0},104942:{a:529800,f:0},104943:{a:2575e3,f:0},104944:{a:25559e3,f:1/43.61604095563141},104945:{a:578900,f:0},104946:{a:33e3,f:0},104947:{a:21e3,f:0},104948:{a:13e3,f:0},104949:{a:31e3,f:0},104950:{a:27e3,f:0},104951:{a:42e3,f:0},104952:{a:235800,f:0},104953:{a:761400,f:0},104954:{a:15e3,f:0},104955:{a:54e3,f:0},104956:{a:77e3,f:0},104957:{a:27e3,f:0},104958:{a:788900,f:0},104959:{a:584700,f:0},104960:{a:24764e3,f:.01708124697141011},104961:{a:74e3,f:0},104962:{a:79e3,f:0},104963:{a:104e3,f:.14423076923076922},104964:{a:29e3,f:0},104965:{a:17e4,f:0},104966:{a:208e3,f:0},104967:{a:4e4,f:0},104968:{a:1352600,f:0},104969:{a:1195e3,f:0},104970:{a:593e3,f:0},104971:{a:em.radius,f:0},104972:{a:47e4,f:0},104973:{a:255e3,f:0},104974:{a:2439400,f:0}};let VM=0;class Z4{constructor(t=null){this.uid=VM++,t?(this._wkt=t.wkt!==void 0?t.wkt:null,this._wkid=t.wkid!==void 0?t.wkid:-1,this._isInverse=t.isInverse!==void 0&&t.isInverse===!0):(this._wkt=null,this._wkid=-1,this._isInverse=!1)}static fromGE(t){const r=new Z4;return r._wkt=t.wkt,r._wkid=t.wkid,r._isInverse=t.isInverse,r}get wkt(){return this._wkt}set wkt(t){this._wkt=t,this.uid=VM++}get wkid(){return this._wkid}set wkid(t){this._wkid=t,this.uid=VM++}get isInverse(){return this._isInverse}set isInverse(t){this._isInverse=t,this.uid=VM++}getInverse(){const t=new Z4;return t._wkt=this.wkt,t._wkid=this._wkid,t._isInverse=!this.isInverse,t}}class nv{constructor(t){if(this.steps=[],this._cached_projection={},this._chain="",this._gtlistentry=null,t&&t.steps)for(const r of t.steps)r instanceof Z4?this.steps.push(r):this.steps.push(new Z4({wkid:r.wkid,wkt:r.wkt,isInverse:r.isInverse}))}static cacheKey(t,r){return[t.wkid!==void 0&&t.wkid!==null?t.wkid.toString():"-1",t.wkt!==void 0&&t.wkt!==null?t.wkt.toString():"",r.wkid!==void 0&&r.wkid!==null?r.wkid.toString():"-1",r.wkt!==void 0&&r.wkt!==null?r.wkt.toString():""].join(",")}static fromGE(t){const r=new nv;let i="";for(const n of t.steps){const s=Z4.fromGE(n);r.steps.push(s),i+=s.uid.toString()+","}return r._cached_projection={},r._gtlistentry=null,r._chain=i,r}getInverse(){const t=new nv;t.steps=[];for(let r=this.steps.length-1;r>=0;r--){const i=this.steps[r];t.steps.push(i.getInverse())}return t}getGTListEntry(){let t="";for(const r of this.steps)t+=r.uid.toString()+",";return t!==this._chain&&(this._gtlistentry=null,this._cached_projection={},this._chain=t),this._gtlistentry}assignCachedGe(t,r,i){this._cached_projection[nv.cacheKey(t,r)]=i}getCachedGeTransformation(t,r){let i="";for(const s of this.steps)i+=s.uid.toString()+",";i!==this._chain&&(this._gtlistentry=null,this._cached_projection={},this._chain=i);const n=this._cached_projection[nv.cacheKey(t,r)];return n===void 0?null:n}}function Wre(e,t,r){if(R(t)||R(r)||r.vcsWkid||_l(t,r))return null;const i=Z5(t)/Z5(r);if(i===1)return null;switch(e){case"point":case"esriGeometryPoint":return n=>xje(n,i);case"polyline":case"esriGeometryPolyline":return n=>Sje(n,i);case"polygon":case"esriGeometryPolygon":return n=>Tje(n,i);case"multipoint":case"esriGeometryMultipoint":return n=>Eje(n,i);case"extent":case"esriGeometryExtent":return n=>Cje(n,i);default:return null}}function xje(e,t){e&&e.z!=null&&(e.z*=t)}function Tje(e,t){if(e)for(const r of e.rings)for(const i of r)i.length>2&&(i[2]*=t)}function Sje(e,t){if(e)for(const r of e.paths)for(const i of r)i.length>2&&(i[2]*=t)}function Eje(e,t){if(e)for(const r of e.points)r.length>2&&(r[2]*=t)}function Cje(e,t){e&&e.zmin!=null&&e.zmax!=null&&(e.zmin*=t,e.zmax*=t)}let Mv=null,ZF=null,pG=null,mG={};const $Te=new y3e;function VV(){return!!Mv&&OTe()}function yA(e){return R(pG)&&(pG=Promise.all([MTe(),ie(()=>import("./geometryEngineBase.0f0d7ecf.js"),[],import.meta.url).then(t=>t.g),ie(()=>import("./hydrated.e7f04c19.js"),[],import.meta.url)])),pG.then(([,t,{hydratedAdapter:r}])=>{Et(e),ZF=r,Mv=t.default,Mv._enableProjection(_je),$Te.notify()})}function eO(e,t,r=null,i=null){return Array.isArray(e)?e.length===0?[]:Sde(ZF,e,e[0].spatialReference,t,r,i):Sde(ZF,[e],e.spatialReference,t,r,i)[0]}function Sde(e,t,r,i,n=null,s=null){if(R(r)||R(i))return t;if(mm(r,i,n))return t.map(a=>LTe(a,r,i));if(R(n)){const a=nv.cacheKey(r,i);mG[a]!==void 0?n=mG[a]:(n=Aje(r,i,null),R(n)&&(n=new nv),mG[a]=n)}if(R(Mv))throw new Xre;return _(s)?Mv._project(e,t,r,i,n,s):Mv._project(e,t,r,i,n)}function DIt(e,t){return R(e)?{pending:null,geometry:null}:_l(e.spatialReference,t)?{pending:null,geometry:e}:dc(e.spatialReference)&&dc(t)?mm(e.spatialReference,t)||VV()?{pending:null,geometry:Rje(e,t)}:(nr($Te),{pending:yA(),geometry:null}):{pending:null,geometry:null}}function Aje(e,t,r=null){if(R(Mv))throw new Xre;if(R(e)||R(t))return null;const i=Mv._getTransformation(ZF,e,t,r,r==null?void 0:r.spatialReference);return i!==null?nv.fromGE(i):null}class Xre extends k{constructor(){super("projection:not-loaded","projection engine not fully loaded yet, please call load()")}}var J;(function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.SPHERICAL_ECEF=1]="SPHERICAL_ECEF",e[e.WGS84=2]="WGS84",e[e.WEB_MERCATOR=3]="WEB_MERCATOR",e[e.WGS84_ECEF=4]="WGS84_ECEF",e[e.CGCS2000=5]="CGCS2000",e[e.WGS84_COMPARABLE_LON_LAT=6]="WGS84_COMPARABLE_LON_LAT",e[e.SPHERICAL_MARS_PCPF=7]="SPHERICAL_MARS_PCPF",e[e.GCSMARS2000=8]="GCSMARS2000",e[e.SPHERICAL_MOON_PCPF=9]="SPHERICAL_MOON_PCPF",e[e.GCSMOON2000=10]="GCSMOON2000",e[e.LON_LAT=11]="LON_LAT",e[e.PLATE_CARREE=12]="PLATE_CARREE"})(J||(J={}));function Rje(e,t){try{const r=eO(e,t);if(r==null)return null;"xmin"in e&&"xmin"in r&&(r.zmin=e.zmin,r.zmax=e.zmax);const i=Wre(r.type,e.spatialReference,t);return _(i)&&i(r),r}catch(r){if(!(r instanceof Xre))throw r;return null}}function mm(e,t,r){return!r&&(!!_l(e,t)||dc(e)&&dc(t)&&!!Jre(e,t,eie))}async function FIt(e,t,r,i){if(VV())return nce(i);if(Array.isArray(e)){for(const{source:n,dest:s,geographicTransformation:a}of e)if(!mm(n,s,a))return yA(i)}else if(!mm(e,t,r))return yA(i);return nce(i)}function NIt(e,t){switch(Jre(e,t,eie)){case wi:return"copy3";case av:return"wgs84ToSphericalECEF";case Nw:return"wgs84ToWebMercator";case sv:return"wgs84ToPlateCarree";case lv:return"wgs84ToWGS84ECEF";case cw:return"webMercatorToWGS84";case zTe:return"webMercatorToSphericalECEF";case UTe:return"webMercatorToWGS84ECEF";case BTe:return"webMercatorToPlateCarree";case cv:return"wgs84ECEFToWGS84";case qTe:return"wgs84ECEFToSphericalECEF";case HTe:return"wgs84ECEFToWebMercator";case ov:return"sphericalECEFToWGS84";case GTe:return"sphericalECEFToWebMercator";case sZ:return"sphericalMarsPCPFToMars2000";case nZ:return"sphericalMoonPCPFToMoon2000";case jTe:return"sphericalECEFToWGS84ECEF";case iZ:return"mars2000ToSphericalPCPF";case rZ:return"moon2000ToSphericalPCPF";default:return null}}function LTe(e,t,r){return e?"x"in e?DTe(e,t,new ot,r,0):"xmin"in e?$je(e,t,new Zt,r,0):"rings"in e?FTe(e,t,new $o,r,0):"paths"in e?Pje(e,t,new uu,r,0):"points"in e?Mje(e,t,new gx,r,0):null:null}function Oje(e,t,r=t.spatialReference,i=0){return!R(r)&&_(DTe(e,e.spatialReference,t,r,i))}function DTe(e,t,r,i,n){qr[0]=e.x,qr[1]=e.y;const s=e.z;return qr[2]=s!==void 0?s:n,mi(qr,t,0,qr,i,0,1)?(r.x=qr[0],r.y=qr[1],r.spatialReference=i,s===void 0?(r.z=void 0,r.hasZ=!1):(r.z=qr[2],r.hasZ=!0),e.m===void 0?(r.m=void 0,r.hasM=!1):(r.m=e.m,r.hasM=!0),r):null}function Mje(e,t,r,i,n){const{points:s,hasZ:a,hasM:o}=e,l=[],c=s.length,u=[];for(const h of s)u.push(h[0],h[1],a?h[2]:n);if(!mi(u,t,0,u,i,0,c))return null;for(let h=0;h<c;++h){const p=3*h,m=u[p],g=u[p+1];a&&o?l.push([m,g,u[p+2],s[h][3]]):a?l.push([m,g,u[p+2]]):o?l.push([m,g,s[h][2]]):l.push([m,g])}return r.points=l,r.spatialReference=i,r.hasZ=a,r.hasM=o,r}function Pje(e,t,r,i,n){const{paths:s,hasZ:a,hasM:o}=e,l=[];return kTe(s,a,o,t,l,i,n)?(r.paths=l,r.spatialReference=i,r.hasZ=a,r.hasM=o,r):null}function Ije(e,t,r=t.spatialReference,i=0){return _(r)&&_(FTe(e,e.spatialReference,t,r,i))}function FTe(e,t,r,i,n){const{rings:s,hasZ:a,hasM:o}=e,l=[];return kTe(s,a,o,t,l,i,n)?(r.rings=l,r.spatialReference=i,r.hasZ=a,r.hasM=o,r):null}function $je(e,t,r,i,n){const{xmin:s,ymin:a,xmax:o,ymax:l,hasZ:c,hasM:u}=e;return Ede(s,a,c?e.zmin:n,t,qr,i)?(r.xmin=qr[0],r.ymin=qr[1],c&&(r.zmin=qr[2]),Ede(o,l,c?e.zmax:n,t,qr,i)?(r.xmax=qr[0],r.ymax=qr[1],c&&(r.zmax=qr[2]),u&&(r.mmin=e.mmin,r.mmax=e.mmax),r.spatialReference=i,r):null):null}function Yv(e,t,r){if(R(t)||R(r))return null;const i=new ot({spatialReference:r});return mi(e,t,0,qr,r,0,1)?(i.x=qr[0],i.y=qr[1],i.z=qr[2],i):null}function NTe(e,t,r){return mi(e,t,0,qr,r.spatialReference,0,1)?(r.x=qr[0],r.y=qr[1],r.z=qr[2],r):null}function oa(e,t,r,i=0){qr[0]=e.x,qr[1]=e.y;const n=e.z;return qr[2]=n!==void 0?n:i,mi(qr,e.spatialReference,0,t,r,0,1)}function Ede(e,t,r,i,n,s){return en[0]=e,en[1]=t,en[2]=r,mi(en,i,0,n,s,0,1)}function Ss(e,t,r,i){return!(R(t)||R(i)||e.length<2)&&(e.length===2&&(en[0]=e[0],en[1]=e[1],en[2]=0,e=en),mi(e,t,0,r,i,0,1))}function Lje(e,t){qr[0]=e.x,qr[1]=e.y;const r=e.z;return qr[2]=r!==void 0?r:0,Dje(qr,e.spatialReference,t)}function Dje(e,t,r){return Fje(e,t,r)}function Fje(e,t,r){if(R(t))return!1;const i=Zv(t,UV),n=Z0[i][J.WGS84_COMPARABLE_LON_LAT];return!R(n)&&(n(e,0,en,0),r!==en&&(r[0]=en[0],r[1]=en[1],r.length>2&&(r[2]=en[2])),!0)}function mi(e,t,r,i,n,s,a=1){const o=Jre(t,n,eie);if(R(o))return!1;if(o===wi){if(e===i&&r===s)return!0;const c=r+3*a;for(let u=r,h=s;u<c;u++,h++)i[h]=e[u];return!0}const l=r+3*a;for(let c=r,u=s;c<l;c+=3,u+=3)o(e,c,i,u);return!0}function kIt(e,t,r,i,n){oe(qr,e),he(zM,e,t),Ss(qr,r,qr,n),Ss(zM,r,zM,n),pe(i,zM,qr),we(i,i)}function kTe(e,t,r,i,n,s,a=0){const o=new Array;for(const c of e)for(const u of c)o.push(u[0],u[1],t?u[2]:a);if(!mi(o,i,0,o,s,0,o.length/3))return!1;let l=0;n.length=0;for(const c of e){const u=new Array;for(const h of c)t&&r?u.push([o[l++],o[l++],o[l++],h[3]]):t?u.push([o[l++],o[l++],o[l++]]):r?(u.push([o[l++],o[l++],h[2]]),l++):(u.push([o[l++],o[l++]]),l++);n.push(u)}return!0}function Nje(e,t,r,i){if(R(t)||R(i))return!1;const n=WTe(t,i,qje);if(n.projector===wi)return r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],!0;if(R(n.projector))return!1;const{source:s,dest:a}=n;if(a.spatialReferenceId===J.WEB_MERCATOR){const o=Z0[s.spatialReferenceId][J.WGS84];return!R(o)&&(o(e,0,Xf,0),Nw(Xf,0,r,0),r[3]=Cde(Xf[1],e[2],e[3],$r.radius),!0)}if(s.spatialReferenceId!==J.WGS84&&s.spatialReferenceId!==J.CGCS2000||a.spatialReferenceId!==J.PLATE_CARREE)n.projector(e,0,r,0),r[3]=e[3]*s.metersPerUnit/a.metersPerUnit;else{const o=Z0[s.spatialReferenceId][J.SPHERICAL_ECEF],l=Z0[J.SPHERICAL_ECEF][J.PLATE_CARREE];let c=e[3];_(o)&&_(l)&&(c=Cde(e[1],e[2],e[3],$r.radius)),n.projector(e,0,r,0),r[3]=c}return!0}function Cde(e,t,r,i){const n=i+t;if(n<i/2||r>n)return Number.MAX_VALUE;const s=Math.abs(mp*e)+Math.asin(r/n);return s>=Math.PI/2?Number.MAX_VALUE:r/Math.cos(s)}function zV(e,t,r,i){return e!=null&&(_l(t,i)?(Oy(r,e),!0):(en[0]=e[0],en[1]=e[1],en[2]=0,!!mi(en,t,0,en,i,0,1)&&(r[0]=en[0],r[1]=en[1],en[0]=e[2],en[1]=e[3],en[2]=0,!!mi(en,t,0,en,i,0,1)&&(r[2]=en[0],r[3]=en[1],!0))))}function VIt(e,t,r,i){if(R(t)||R(i))return!1;const n=Zv(t,UV),s=Zv(i,XTe);if(n===s&&n!==J.UNKNOWN||_l(t,i))return r[0]=1,r[1]=1,r[2]=1,!0;if(n===J.SPHERICAL_ECEF){const a=Oe(e),o=a/Math.sqrt(e[0]*e[0]+e[1]*e[1]),l=a/$r.radius;if(s===J.WEB_MERCATOR)return r[0]=o*l,r[1]=o*l,r[2]=1,!0;if(s===J.WGS84||s===J.CGCS2000){const c=XC;return r[0]=c*o*l,r[1]=c*l,r[2]=1,!0}}else if(n===J.PLATE_CARREE){if(s===J.WGS84||s===J.CGCS2000)return r[0]=XC,r[1]=XC,r[2]=1,!0;if(s===J.WEB_MERCATOR){const a=e[1]/$r.radius;return r[0]=1,r[1]=1/Math.cos(a),r[2]=1,!0}}return!1}function Au(e,t,r,i){if(R(e)||R(i))return!1;const n=Zv(e,UV),s=Zv(i,XTe);if(n===s&&!Ade(s)&&(n!==J.UNKNOWN||_l(e,i)))return NV(r,t),!0;if(Ade(s)){const a=Z0[n][J.LON_LAT],o=Z0[J.LON_LAT][s];return!R(a)&&!R(o)&&(a(t,0,Xf,0),o(Xf,0,db,0),VTe(mp*Xf[0],mp*Xf[1],r),r[12]=db[0],r[13]=db[1],r[14]=db[2],!0)}if((s===J.WEB_MERCATOR||s===J.PLATE_CARREE)&&(n===J.WGS84||n===J.CGCS2000&&s===J.PLATE_CARREE||n===J.SPHERICAL_ECEF||n===J.WEB_MERCATOR)){const a=Z0[n][J.LON_LAT],o=Z0[J.LON_LAT][s];return!R(a)&&!R(o)&&(a(t,0,Xf,0),o(Xf,0,db,0),n===J.SPHERICAL_ECEF?kje(mp*Xf[0],mp*Xf[1],r):pm(r),r[12]=db[0],r[13]=db[1],r[14]=db[2],!0)}return!1}function Ade(e){return e===J.SPHERICAL_ECEF||e===J.SPHERICAL_MARS_PCPF||e===J.SPHERICAL_MOON_PCPF}function VTe(e,t,r){const i=Math.sin(e),n=Math.cos(e),s=Math.sin(t),a=Math.cos(t),o=r;return o[0]=-i,o[4]=-s*n,o[8]=a*n,o[12]=0,o[1]=n,o[5]=-s*i,o[9]=a*i,o[13]=0,o[2]=0,o[6]=a,o[10]=s,o[14]=0,o[3]=0,o[7]=0,o[11]=0,o[15]=1,o}function kje(e,t,r){return VTe(e,t,r),hc(r,r),r}function Zv(e,t){return t.spatialReference===e?t.spatialReferenceId:(t.spatialReference=e,"metersPerUnit"in t&&(t.metersPerUnit=vc(e,1)),e.wkt===uTe.wkt?t.spatialReferenceId=J.SPHERICAL_ECEF:sA(e)?t.spatialReferenceId=J.WGS84:Ow(e)?t.spatialReferenceId=J.WEB_MERCATOR:aA(e)?t.spatialReferenceId=J.PLATE_CARREE:e.wkt===PGe.wkt?t.spatialReferenceId=J.WGS84_ECEF:e.wkid===Ph.CGCS2000?t.spatialReferenceId=J.CGCS2000:e.wkt===GF.wkt?t.spatialReferenceId=J.SPHERICAL_MARS_PCPF:e.wkt===jF.wkt?t.spatialReferenceId=J.SPHERICAL_MOON_PCPF:Sm(e)?t.spatialReferenceId=J.GCSMARS2000:Em(e)?t.spatialReferenceId=J.GCSMOON2000:t.spatialReferenceId=J.UNKNOWN)}function wi(e,t,r,i){e!==r&&(r[i++]=e[t++],r[i++]=e[t++],r[i]=e[t])}function cw(e,t,r,i){r[i++]=K5*(e[t++]/$r.radius),r[i++]=K5*(Math.PI/2-2*Math.atan(Math.exp(-e[t++]/$r.radius))),r[i]=e[t]}function zTe(e,t,r,i){cw(e,t,r,i),av(r,i,r,i)}function UTe(e,t,r,i){cw(e,t,r,i),lv(r,i,r,i)}function Yre(e,t,r,i,n){const s=.4999999*Math.PI,a=Le(mp*e[t+1],-s,s),o=Math.sin(a);r[i++]=mp*e[t]*n.radius,r[i++]=n.halfSemiMajorAxis*Math.log((1+o)/(1-o)),r[i]=e[t+2]}function Nw(e,t,r,i){Yre(e,t,r,i,$r)}const Rde=$r.radius*Math.PI/180,XC=180/($r.radius*Math.PI);function sv(e,t,r,i){r[i]=e[t]*Rde,r[i+1]=e[t+1]*Rde,r[i+2]=e[t+2]}function V3(e,t,r,i){r[i]=e[t]*XC,r[i+1]=e[t+1]*XC,r[i+2]=e[t+2]}function BTe(e,t,r,i){cw(e,t,r,i),sv(r,i,r,i)}function Vje(e,t,r,i){cv(e,t,r,i),sv(r,i,r,i)}function zje(e,t,r,i){ov(e,t,r,i),sv(r,i,r,i)}function Uje(e,t,r,i){V3(e,t,r,i),av(r,i,r,i)}function Bje(e,t,r,i){V3(e,t,r,i),Nw(r,i,r,i)}function Gje(e,t,r,i){V3(e,t,r,i),lv(r,i,r,i)}function kw(e){if(R(e))return!1;const t=Zv(e,UV);return!!Z0[t][J.WGS84_COMPARABLE_LON_LAT]}function j6(e,t,r,i){const n=Math.cos(r);e[0]=Math.cos(t)*n*i,e[1]=Math.sin(t)*n*i,e[2]=Math.sin(r)*i}function Zre(e,t,r,i,n){const s=n+e[t+2],a=mp*e[t+1],o=mp*e[t],l=Math.cos(a);r[i++]=Math.cos(o)*l*s,r[i++]=Math.sin(o)*l*s,r[i]=Math.sin(a)*s}function rZ(e,t,r,i){Zre(e,t,r,i,Ay.radius)}function iZ(e,t,r,i){Zre(e,t,r,i,em.radius)}function av(e,t,r,i){Zre(e,t,r,i,$r.radius)}function Qre(e,t,r,i,n){const s=e[t],a=e[t+1],o=e[t+2],l=Math.sqrt(s*s+a*a+o*o),c=Pp(o/(l===0?1:l)),u=Math.atan2(a,s);r[i++]=K5*u,r[i++]=K5*c,r[i]=l-n}function nZ(e,t,r,i){Qre(e,t,r,i,Ay.radius)}function sZ(e,t,r,i){Qre(e,t,r,i,em.radius)}function ov(e,t,r,i){Qre(e,t,r,i,$r.radius)}function GTe(e,t,r,i){ov(e,t,r,i),Nw(r,i,r,i)}function jTe(e,t,r,i){ov(e,t,r,i),lv(r,i,r,i)}function jje(e,t,r,i,n){const s=mp*e[t],a=mp*e[t+1],o=e[t+2],l=Math.sin(a),c=Math.cos(a),u=n.radius/Math.sqrt(1-n.eccentricitySquared*l*l);r[i++]=(u+o)*c*Math.cos(s),r[i++]=(u+o)*c*Math.sin(s),r[i++]=(u*(1-n.eccentricitySquared)+o)*l}function lv(e,t,r,i){jje(e,t,r,i,$r)}function cv(e,t,r,i){const n=wje,s=e[t],a=e[t+1],o=e[t+2];let l,c,u,h,p,m,g,b,w,v,x,T,E,C,A,P,I,L,V,G,B;l=Math.abs(o),c=s*s+a*a,u=Math.sqrt(c),h=c+o*o,p=Math.sqrt(h),G=Math.atan2(a,s),m=o*o/h,g=c/h,C=n.a2/p,A=n.a3-n.a4/p,g>.3?(b=l/p*(1+g*(n.a1+C+m*A)/p),V=Math.asin(b),v=b*b,w=Math.sqrt(1-v)):(w=u/p*(1-m*(n.a5-C-g*A)/p),V=Math.acos(w),v=1-w*w,b=Math.sqrt(v)),x=1-$r.eccentricitySquared*v,T=$r.radius/Math.sqrt(x),E=n.a6*T,C=u-T*w,A=l-E*b,I=w*C+b*A,P=w*A-b*C,L=P/(E/x+I),V+=L,B=I+P*L/2,o<0&&(V=-V),r[i++]=K5*G,r[i++]=K5*V,r[i]=B}function qTe(e,t,r,i){cv(e,t,r,i),av(r,i,r,i)}function HTe(e,t,r,i){cv(e,t,r,i),Nw(r,i,r,i)}const Z0={[J.WGS84]:{[J.CGCS2000]:null,[J.GCSMARS2000]:null,[J.GCSMOON2000]:null,[J.LON_LAT]:wi,[J.WGS84_COMPARABLE_LON_LAT]:wi,[J.SPHERICAL_ECEF]:av,[J.SPHERICAL_MARS_PCPF]:null,[J.SPHERICAL_MOON_PCPF]:null,[J.UNKNOWN]:null,[J.WEB_MERCATOR]:Nw,[J.PLATE_CARREE]:sv,[J.WGS84]:wi,[J.WGS84_ECEF]:lv},[J.CGCS2000]:{[J.CGCS2000]:wi,[J.GCSMARS2000]:null,[J.GCSMOON2000]:null,[J.LON_LAT]:wi,[J.WGS84_COMPARABLE_LON_LAT]:wi,[J.SPHERICAL_ECEF]:av,[J.SPHERICAL_MARS_PCPF]:null,[J.SPHERICAL_MOON_PCPF]:null,[J.UNKNOWN]:null,[J.WEB_MERCATOR]:null,[J.PLATE_CARREE]:sv,[J.WGS84]:null,[J.WGS84_ECEF]:lv},[J.GCSMARS2000]:{[J.CGCS2000]:null,[J.GCSMARS2000]:wi,[J.GCSMOON2000]:null,[J.LON_LAT]:wi,[J.WGS84_COMPARABLE_LON_LAT]:null,[J.SPHERICAL_ECEF]:null,[J.SPHERICAL_MARS_PCPF]:iZ,[J.SPHERICAL_MOON_PCPF]:null,[J.UNKNOWN]:null,[J.WEB_MERCATOR]:null,[J.PLATE_CARREE]:null,[J.WGS84]:null,[J.WGS84_ECEF]:null},[J.GCSMOON2000]:{[J.CGCS2000]:null,[J.GCSMARS2000]:null,[J.GCSMOON2000]:wi,[J.LON_LAT]:wi,[J.WGS84_COMPARABLE_LON_LAT]:null,[J.SPHERICAL_ECEF]:null,[J.SPHERICAL_MARS_PCPF]:null,[J.SPHERICAL_MOON_PCPF]:rZ,[J.UNKNOWN]:null,[J.WEB_MERCATOR]:null,[J.PLATE_CARREE]:null,[J.WGS84]:null,[J.WGS84_ECEF]:null},[J.WEB_MERCATOR]:{[J.CGCS2000]:null,[J.GCSMARS2000]:null,[J.GCSMOON2000]:null,[J.LON_LAT]:cw,[J.WGS84_COMPARABLE_LON_LAT]:cw,[J.SPHERICAL_ECEF]:zTe,[J.SPHERICAL_MARS_PCPF]:null,[J.SPHERICAL_MOON_PCPF]:null,[J.UNKNOWN]:null,[J.WEB_MERCATOR]:wi,[J.PLATE_CARREE]:BTe,[J.WGS84]:cw,[J.WGS84_ECEF]:UTe},[J.WGS84_ECEF]:{[J.CGCS2000]:cv,[J.GCSMARS2000]:null,[J.GCSMOON2000]:null,[J.LON_LAT]:cv,[J.WGS84_COMPARABLE_LON_LAT]:cv,[J.SPHERICAL_ECEF]:qTe,[J.SPHERICAL_MARS_PCPF]:null,[J.SPHERICAL_MOON_PCPF]:null,[J.UNKNOWN]:null,[J.WEB_MERCATOR]:HTe,[J.PLATE_CARREE]:Vje,[J.WGS84]:cv,[J.WGS84_ECEF]:wi},[J.SPHERICAL_ECEF]:{[J.CGCS2000]:ov,[J.GCSMARS2000]:null,[J.GCSMOON2000]:null,[J.LON_LAT]:ov,[J.WGS84_COMPARABLE_LON_LAT]:ov,[J.SPHERICAL_ECEF]:wi,[J.SPHERICAL_MARS_PCPF]:null,[J.SPHERICAL_MOON_PCPF]:null,[J.UNKNOWN]:null,[J.WEB_MERCATOR]:GTe,[J.PLATE_CARREE]:zje,[J.WGS84]:ov,[J.WGS84_ECEF]:jTe},[J.SPHERICAL_MARS_PCPF]:{[J.CGCS2000]:null,[J.GCSMARS2000]:sZ,[J.GCSMOON2000]:null,[J.LON_LAT]:sZ,[J.WGS84_COMPARABLE_LON_LAT]:null,[J.SPHERICAL_ECEF]:null,[J.SPHERICAL_MARS_PCPF]:wi,[J.SPHERICAL_MOON_PCPF]:null,[J.UNKNOWN]:null,[J.WEB_MERCATOR]:null,[J.PLATE_CARREE]:null,[J.WGS84]:null,[J.WGS84_ECEF]:null},[J.SPHERICAL_MOON_PCPF]:{[J.CGCS2000]:null,[J.GCSMARS2000]:null,[J.GCSMOON2000]:nZ,[J.LON_LAT]:nZ,[J.WGS84_COMPARABLE_LON_LAT]:null,[J.SPHERICAL_ECEF]:null,[J.SPHERICAL_MARS_PCPF]:null,[J.SPHERICAL_MOON_PCPF]:wi,[J.UNKNOWN]:null,[J.WEB_MERCATOR]:null,[J.PLATE_CARREE]:null,[J.WGS84]:null,[J.WGS84_ECEF]:null},[J.UNKNOWN]:{[J.CGCS2000]:null,[J.GCSMARS2000]:null,[J.GCSMOON2000]:null,[J.LON_LAT]:null,[J.WGS84_COMPARABLE_LON_LAT]:null,[J.SPHERICAL_ECEF]:null,[J.SPHERICAL_MARS_PCPF]:null,[J.SPHERICAL_MOON_PCPF]:null,[J.UNKNOWN]:wi,[J.WEB_MERCATOR]:null,[J.PLATE_CARREE]:null,[J.WGS84]:null,[J.WGS84_ECEF]:null},[J.LON_LAT]:{[J.CGCS2000]:wi,[J.GCSMARS2000]:wi,[J.GCSMOON2000]:wi,[J.LON_LAT]:wi,[J.WGS84_COMPARABLE_LON_LAT]:wi,[J.SPHERICAL_ECEF]:av,[J.SPHERICAL_MARS_PCPF]:iZ,[J.SPHERICAL_MOON_PCPF]:rZ,[J.UNKNOWN]:null,[J.WEB_MERCATOR]:Nw,[J.PLATE_CARREE]:sv,[J.WGS84]:wi,[J.WGS84_ECEF]:lv},[J.WGS84_COMPARABLE_LON_LAT]:{[J.CGCS2000]:null,[J.GCSMARS2000]:null,[J.GCSMOON2000]:null,[J.LON_LAT]:wi,[J.WGS84_COMPARABLE_LON_LAT]:wi,[J.SPHERICAL_ECEF]:av,[J.SPHERICAL_MARS_PCPF]:null,[J.SPHERICAL_MOON_PCPF]:null,[J.UNKNOWN]:null,[J.WEB_MERCATOR]:null,[J.PLATE_CARREE]:sv,[J.WGS84]:wi,[J.WGS84_ECEF]:lv},[J.PLATE_CARREE]:{[J.CGCS2000]:V3,[J.GCSMARS2000]:null,[J.GCSMOON2000]:null,[J.LON_LAT]:V3,[J.WGS84_COMPARABLE_LON_LAT]:V3,[J.SPHERICAL_ECEF]:Uje,[J.SPHERICAL_MARS_PCPF]:null,[J.SPHERICAL_MOON_PCPF]:null,[J.UNKNOWN]:null,[J.WEB_MERCATOR]:Bje,[J.PLATE_CARREE]:wi,[J.WGS84]:V3,[J.WGS84_ECEF]:Gje}};function Jre(e,t,r=Kre()){return R(e)||R(t)?null:WTe(e,t,r).projector}function WTe(e,t,r){if(R(e)||R(t)||r.source.spatialReference===e&&r.dest.spatialReference===t)return r;const i=Zv(e,r.source),n=Zv(t,r.dest);return i===J.UNKNOWN&&n===J.UNKNOWN?_l(e,t)?r.projector=wi:r.projector=null:r.projector=Z0[i][n],r}function Kre(){return{source:{spatialReference:null,spatialReferenceId:J.UNKNOWN,metersPerUnit:1},dest:{spatialReference:null,spatialReferenceId:J.UNKNOWN,metersPerUnit:1},projector:wi}}const UV={spatialReference:null,spatialReferenceId:J.UNKNOWN},XTe={spatialReference:null,spatialReferenceId:J.UNKNOWN},eie=Kre(),qje=Kre(),mp=kt(1),K5=md(1),en=M(),Xf=M(),db=M(),qr=M(),zM=M();class jy{constructor(t){this.allocator=t,this._items=[],this._itemsPtr=0,this._grow()}get(){return this._itemsPtr===0&&R5(()=>this._reset()),this._itemsPtr===this._items.length&&this._grow(),this._items[this._itemsPtr++]}_reset(){const t=Math.min(3*Math.max(8,this._itemsPtr),this._itemsPtr+3*Ode);this._items.length=Math.min(t,this._items.length),this._itemsPtr=0}_grow(){for(let t=0;t<Math.max(8,Math.min(this._items.length,Ode));t++)this._items.push(this.allocator())}}const Ode=1024;function Ae(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function dw(e){return[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15]]}function tie(e,t,r,i,n,s,a,o,l,c,u,h,p,m,g,b){return[e,t,r,i,n,s,a,o,l,c,u,h,p,m,g,b]}function YTe(e,t){return new Float64Array(e,t,16)}const Es=Ae();Object.freeze(Object.defineProperty({__proto__:null,create:Ae,clone:dw,fromValues:tie,createView:YTe,IDENTITY:Es},Symbol.toStringTag,{value:"Module"}));var bu;(function(e){e[e.X=0]="X",e[e.Y=1]="Y",e[e.Z=2]="Z"})(bu||(bu={}));function Hje(e){return 32+e.length}function Wje(){return 16}function ZTe(e){if(!e)return 0;let t=32;for(const r in e)if(e.hasOwnProperty(r)){const i=e[r];switch(typeof i){case"string":t+=Hje(i);break;case"number":t+=Wje();break;case"boolean":t+=4}}return t}function zIt(e,t){return 32+e.length*t}var e9;(function(e){e[e.KILOBYTES=1024]="KILOBYTES",e[e.MEGABYTES=1048576]="MEGABYTES",e[e.GIGABYTES=1073741824]="GIGABYTES"})(e9||(e9={}));function Li(){return[1,0,0,0,1,0,0,0,1]}function Xje(e){return[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8]]}function Yje(e,t,r,i,n,s,a,o,l){return[e,t,r,i,n,s,a,o,l]}function QTe(e,t){return new Float64Array(e,t,9)}Object.freeze(Object.defineProperty({__proto__:null,create:Li,clone:Xje,fromValues:Yje,createView:QTe},Symbol.toStringTag,{value:"Module"}));function qy(){return[0,0,0,1]}function Zje(e){return[e[0],e[1],e[2],e[3]]}function Qje(e,t,r,i){return[e,t,r,i]}function JTe(e,t){return new Float64Array(e,t,4)}const Jje=qy();Object.freeze(Object.defineProperty({__proto__:null,create:qy,clone:Zje,fromValues:Qje,createView:JTe,IDENTITY:Jje},Symbol.toStringTag,{value:"Module"}));function it(){return[0,0]}function ME(e){return[e[0],e[1]]}function Nr(e,t){return[e,t]}function KTe(e){const t=it(),r=Math.min(2,e.length);for(let i=0;i<r;++i)t[i]=e[i];return t}function eSe(e,t){return new Float64Array(e,t,2)}function tSe(){return it()}function rSe(){return Nr(1,1)}function iSe(){return Nr(1,0)}function nSe(){return Nr(0,1)}const Zh=tSe(),sSe=rSe(),Kje=iSe(),eqe=nSe();Object.freeze(Object.defineProperty({__proto__:null,create:it,clone:ME,fromValues:Nr,fromArray:KTe,createView:eSe,zeros:tSe,ones:rSe,unitX:iSe,unitY:nSe,ZEROS:Zh,ONES:sSe,UNIT_X:Kje,UNIT_Y:eqe},Symbol.toStringTag,{value:"Module"}));function Jt(){return[0,0,0,0]}function BV(e){return[e[0],e[1],e[2],e[3]]}function Tr(e,t,r,i){return[e,t,r,i]}function rie(e){const t=Jt(),r=Math.min(4,e.length);for(let i=0;i<r;++i)t[i]=e[i];return t}function aSe(e,t){return new Float64Array(e,t,4)}function oSe(){return Jt()}function lSe(){return Tr(1,1,1,1)}function cSe(){return Tr(1,0,0,0)}function dSe(){return Tr(0,1,0,0)}function uSe(){return Tr(0,0,1,0)}function hSe(){return Tr(0,0,0,1)}const rm=oSe(),Ih=lSe(),tqe=cSe(),rqe=dSe(),iqe=uSe(),nqe=hSe();Object.freeze(Object.defineProperty({__proto__:null,create:Jt,clone:BV,fromValues:Tr,fromArray:rie,createView:aSe,zeros:oSe,ones:lSe,unitX:cSe,unitY:dSe,unitZ:uSe,unitW:hSe,ZEROS:rm,ONES:Ih,UNIT_X:tqe,UNIT_Y:rqe,UNIT_Z:iqe,UNIT_W:nqe},Symbol.toStringTag,{value:"Module"}));class ru{constructor(t,r,i){this.itemByteSize=t,this.itemCreate=r,this._buffers=new Array,this._items=new Array,this._itemsPtr=0,this._itemsPerBuffer=Math.ceil(i/this.itemByteSize)}get(){this._itemsPtr===0&&R5(()=>this._reset());const t=Math.floor(this._itemsPtr/this._itemsPerBuffer);for(;this._buffers.length<=t;){const r=new ArrayBuffer(this._itemsPerBuffer*this.itemByteSize);for(let i=0;i<this._itemsPerBuffer;++i)this._items.push(this.itemCreate(r,i*this.itemByteSize));this._buffers.push(r)}return this._items[this._itemsPtr++]}_reset(){const t=2*(Math.floor(this._itemsPtr/this._itemsPerBuffer)+1);for(;this._buffers.length>t;)this._buffers.pop(),this._items.length=this._buffers.length*this._itemsPerBuffer;this._itemsPtr=0}static createVec2f64(t=Nx){return new ru(16,eSe,t)}static createVec3f64(t=Nx){return new ru(24,ire,t)}static createVec4f64(t=Nx){return new ru(32,aSe,t)}static createMat3f64(t=Nx){return new ru(72,QTe,t)}static createMat4f64(t=Nx){return new ru(128,YTe,t)}static createQuatf64(t=Nx){return new ru(32,JTe,t)}get test(){return{size:this._buffers.length*this._itemsPerBuffer*this.itemByteSize}}}const Nx=4*e9.KILOBYTES,UIt=ru.createVec2f64(),qe=ru.createVec3f64(),iie=ru.createVec4f64();ru.createMat3f64();const nie=ru.createMat4f64(),BIt=ru.createQuatf64();function Om(e){return e?{origin:Kn(e.origin),vector:Kn(e.vector)}:{origin:M(),vector:M()}}function sqe(e,t){const r=oqe.get();return r.origin=e,r.vector=t,r}function GIt(e,t=Om()){return aqe(e.origin,e.vector,t)}function aqe(e,t,r=Om()){return oe(r.origin,e),oe(r.vector,t),r}function uw(e,t,r=Om()){return oe(r.origin,e),pe(r.vector,t,e),r}function sie(e,t){const r=pe(qe.get(),t,e.origin),i=Se(e.vector,r),n=Se(e.vector,e.vector),s=Le(i/n,0,1),a=pe(qe.get(),le(qe.get(),e.vector,s),r);return Se(a,a)}function jIt(e,t,r){return aZ(e,t,0,1,r)}function qIt(e,t,r){return he(r,e.origin,le(r,e.vector,t))}function aZ(e,t,r,i,n){const{vector:s,origin:a}=e,o=pe(qe.get(),t,a),l=Se(s,o)/fl(s);return le(n,s,Le(l,r,i)),he(n,n,e.origin)}function HIt(e,t){if(pSe(e,sqe(t.origin,t.direction),!1,QF)){const{tA:r,pB:i,distance2:n}=QF;if(r>=0&&r<=1)return n;if(r<0)return Vs(e.origin,i);if(r>1)return Vs(he(qe.get(),e.origin,e.vector),i)}return null}function fSe(e,t,r){return!!pSe(e,t,!0,QF)&&(oe(r,QF.pA),!0)}function pSe(e,t,r,i){const s=e.origin,a=he(qe.get(),s,e.vector),o=t.origin,l=he(qe.get(),o,t.vector),c=qe.get(),u=qe.get();if(c[0]=s[0]-o[0],c[1]=s[1]-o[1],c[2]=s[2]-o[2],u[0]=l[0]-o[0],u[1]=l[1]-o[1],u[2]=l[2]-o[2],Math.abs(u[0])<1e-6&&Math.abs(u[1])<1e-6&&Math.abs(u[2])<1e-6)return!1;const h=qe.get();if(h[0]=a[0]-s[0],h[1]=a[1]-s[1],h[2]=a[2]-s[2],Math.abs(h[0])<1e-6&&Math.abs(h[1])<1e-6&&Math.abs(h[2])<1e-6)return!1;const p=c[0]*u[0]+c[1]*u[1]+c[2]*u[2],m=u[0]*h[0]+u[1]*h[1]+u[2]*h[2],g=c[0]*h[0]+c[1]*h[1]+c[2]*h[2],b=u[0]*u[0]+u[1]*u[1]+u[2]*u[2],w=(h[0]*h[0]+h[1]*h[1]+h[2]*h[2])*b-m*m;if(Math.abs(w)<1e-6)return!1;let v=(p*m-g*b)/w,x=(p+m*v)/b;r&&(v=Le(v,0,1),x=Le(x,0,1));const T=qe.get(),E=qe.get();return T[0]=s[0]+v*h[0],T[1]=s[1]+v*h[1],T[2]=s[2]+v*h[2],E[0]=o[0]+x*u[0],E[1]=o[1]+x*u[1],E[2]=o[2]+x*u[2],i.tA=v,i.tB=x,i.pA=T,i.pB=E,i.distance2=Vs(T,E),!0}const QF={tA:0,tB:0,pA:M(),pB:M(),distance2:0},oqe=new jy(()=>({origin:null,vector:null}));function Ma(e){return e?{origin:Kn(e.origin),direction:Kn(e.direction)}:{origin:M(),direction:M()}}function WIt(e,t){return Gv(e.origin,t.origin)&&Gv(e.direction,t.direction)}function Ru(e,t){const r=hqe.get();return r.origin=e,r.direction=t,r}function JF(e,t=Ma()){return mSe(e.origin,e.direction,t)}function lqe(e,t,r=Ma()){return oe(r.origin,e),pe(r.direction,t,e),r}function mSe(e,t,r=Ma()){return oe(r.origin,e),oe(r.direction,t),r}function cqe(e,t){const r=dt(qe.get(),we(qe.get(),e.direction),pe(qe.get(),t,e.origin));return Se(r,r)}function dqe(e,t,r){const i=Se(e.direction,pe(r,t,e.origin));return he(r,e.origin,le(r,e.direction,i)),r}function uqe(){return{origin:null,direction:null}}const hqe=new jy(uqe);function YC(e,t){return Se(e,t)/Oe(e)}function aie(e,t){const r=Se(e,t)/(Oe(e)*Oe(t));return-Rs(r)}function fqe(e,t,r){we(UM,e),we(gG,t);const i=Se(UM,gG),n=Rs(i),s=dt(UM,UM,gG);return Se(s,r)<0?2*Math.PI-n:n}const UM=M(),gG=M(),pqe=fe.getLogger("esri.geometry.support.sphere");function Us(){return Jt()}function t9(e,t=Us()){return hp(t,e)}function gSe(e,t){return Tr(e[0],e[1],e[2],t)}function mqe(e){return e}function ySe(e){e[0]=e[1]=e[2]=e[3]=0}function GV(e,t){return e[0]=e[1]=e[2]=0,e[3]=t,e}function cy(e){return e[3]}function gqe(e){return e}function bSe(e,t,r,i){return Tr(e,t,r,i)}function yqe(e,t,r){return e!==r&&oe(r,e),r[3]=e[3]+t,r}function bqe(e,t,r){return pqe.error("sphere.setExtent is not yet supported"),e===r?r:t9(e,r)}function y_(e,t,r){if(R(t))return!1;const{origin:i,direction:n}=t,s=vqe;s[0]=i[0]-e[0],s[1]=i[1]-e[1],s[2]=i[2]-e[2];const a=n[0]*n[0]+n[1]*n[1]+n[2]*n[2],o=2*(n[0]*s[0]+n[1]*s[1]+n[2]*s[2]),l=o*o-4*a*(s[0]*s[0]+s[1]*s[1]+s[2]*s[2]-e[3]*e[3]);if(l<0)return!1;const c=Math.sqrt(l);let u=(-o-c)/(2*a);const h=(-o+c)/(2*a);return(u<0||h<u&&h>0)&&(u=h),!(u<0)&&(r&&(r[0]=i[0]+n[0]*u,r[1]=i[1]+n[1]*u,r[2]=i[2]+n[2]*u),!0)}const vqe=M();function oZ(e,t){return y_(e,t,null)}function _qe(e,t,r){if(y_(e,t,r))return r;const i=n6(e,t,qe.get());return he(r,t.origin,le(qe.get(),t.direction,fi(t.origin,i)/Oe(t.direction))),r}function n6(e,t,r){const i=qe.get(),n=nie.get();dt(i,t.origin,t.direction);const s=cy(e);dt(r,i,t.origin),le(r,r,1/Oe(r)*s);const a=wSe(e,t.origin),o=aie(t.origin,r);return Cu(n,o+a,i),ze(r,r,n),r}function wqe(e,t,r){return y_(e,t,r)?r:(dqe(t,e,r),vSe(e,r,r))}function vSe(e,t,r){const i=pe(qe.get(),t,e),n=le(qe.get(),i,e[3]/Oe(i));return he(r,n,e)}function _Se(e,t){const r=pe(qe.get(),t,e),i=fl(r),n=e[3]*e[3];return Math.sqrt(Math.abs(i-n))}function wSe(e,t){const r=pe(qe.get(),t,e),i=Oe(r),n=cy(e),s=n+Math.abs(n-i);return Rs(n/s)}const yG=M();function xSe(e,t,r,i){const n=pe(yG,t,e);switch(r){case bu.X:{const s=Nce(n,yG)[2];return ne(i,-Math.sin(s),Math.cos(s),0)}case bu.Y:{const s=Nce(n,yG),a=s[1],o=s[2],l=Math.sin(a);return ne(i,-l*Math.cos(o),-l*Math.sin(o),Math.cos(a))}case bu.Z:return we(i,n);default:return}}function TSe(e,t){const r=pe(lZ,t,e);return Oe(r)-e[3]}function xqe(e,t,r,i){const n=TSe(e,t),s=xSe(e,t,bu.Z,lZ),a=le(lZ,s,r-n);return he(i,t,a)}function Tqe(e,t){const r=Vs(e,t),i=cy(e);return r<=i*i}const lZ=M(),jV=Us(),Sqe=Object.freeze(Object.defineProperty({__proto__:null,create:Us,copy:t9,fromCenterAndRadius:gSe,wrap:mqe,clear:ySe,fromRadius:GV,getRadius:cy,getCenter:gqe,fromValues:bSe,elevate:yqe,setExtent:bqe,intersectRay:y_,intersectsRay:oZ,intersectRayClosestSilhouette:_qe,closestPointOnSilhouette:n6,closestPoint:wqe,projectPoint:vSe,distanceToSilhouette:_Se,angleToSilhouette:wSe,axisAt:xSe,altitudeAt:TSe,setAltitudeAt:xqe,containsPoint:Tqe,tmpSphere:jV},Symbol.toStringTag,{value:"Module"}));function Vw(e){const t=e[0]*e[0]+e[4]*e[4]+e[8]*e[8],r=e[1]*e[1]+e[5]*e[5]+e[9]*e[9],i=e[2]*e[2]+e[6]*e[6]+e[10]*e[10];return Math.sqrt(Math.max(t,r,i))}function Eqe(e,t){const r=Math.sqrt(t[0]*t[0]+t[4]*t[4]+t[8]*t[8]),i=Math.sqrt(t[1]*t[1]+t[5]*t[5]+t[9]*t[9]),n=Math.sqrt(t[2]*t[2]+t[6]*t[6]+t[10]*t[10]);return ne(e,r,i,n),e}function XIt(e,t,r){r=r||e;const i=Se(e,t);ne(r,e[0]-i*t[0],e[1]-i*t[1],e[2]-i*t[2]),we(r,r)}function YIt(e,t,r){Math.abs(e[0])>Math.abs(e[1])?ne(t,0,1,0):ne(t,1,0,0),dt(r,e,t),we(t,t),dt(t,r,e),we(r,r)}function BM(e,t,r,i,n,s){const a=e+(t-e)*n;return a+(r+(i-r)*n-a)*s}function Cqe(e,t,r,i=M()){const n=Oe(e),s=Oe(t),a=Se(e,t)/(n*s);if(a<.9999999999999999){const o=Math.acos(a),l=((1-r)*n+r*s)/Math.sin(o),c=l/n*Math.sin((1-r)*o),u=l/s*Math.sin(r*o);return le(z3,e,c),le(U3,t,u),he(i,z3,U3)}return As(i,e,t,r)}function ZIt(e,t,r,i=M(),n=M()){const s=Oe(e),a=Oe(t),o=Se(e,t)/(s*a);if(o<.9999999999999999){const l=Math.acos(o),c=Math.sin(l),u=Math.sin(r*l),h=Math.sin((1-r)*l),p=(1-r)*s+r*a;{const m=p/c,g=m/a*u;le(z3,e,m/s*h),le(U3,t,g),he(i,z3,U3)}{const m=1/s*(-Math.cos((1-r)*l)*l*p+h*(-s+a));le(z3,e,m);const g=1/a*(Math.cos(r*l)*l*p+u*(-s+a));le(U3,t,g),he(n,z3,U3),le(n,n,1/c)}return n}return As(i,e,t,r),pe(n,t,e),we(n,n),n}function mL(e,t,r){e=we(z3,e),t=we(U3,t);const i=Rs(Se(e,t));if(r){const n=dt(Aqe,e,t);if(Se(n,r)<0)return-i}return i}function gL(e){const t=e.length;return r=>{if(r<=e[0][0])return e[0][1];if(r>=e[t-1][0])return e[t-1][1];let i=1;for(;r>e[i][0];)i++;const n=e[i-1][0],s=e[i][0],a=(s-r)/(s-n);return a*e[i-1][1]+(1-a)*e[i][1]}}function QIt(e,t,r,i){pe(Mde,t,e),pe(Pde,r,e),dt(i,Mde,Pde),we(i,i),i[3]=-Se(e,i)}const Mde=M(),Pde=M(),Aqe=M(),z3=M(),U3=M();function Er(e=PE){return[e[0],e[1],e[2],e[3]]}function Rqe(e=PE[0],t=PE[1],r=PE[2],i=PE[3]){return oie(e,t,r,i,iie.get())}function qV(e,t){return oie(t[0],t[1],t[2],t[3],e)}function oie(e,t,r,i,n=Er()){return n[0]=e,n[1]=t,n[2]=r,n[3]=i,n}function SSe(e,t,r){return oe(r,e),r[3]=t,r}function r9(e,t,r){const i=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],n=Math.abs(i-1)>1e-5&&i>1e-12?1/Math.sqrt(i):1;return r[0]=t[0]*n,r[1]=t[1]*n,r[2]=t[2]*n,r[3]=-(r[0]*e[0]+r[1]*e[1]+r[2]*e[2]),r}function Ao(e,t,r,i=Er()){const n=r[0]-t[0],s=r[1]-t[1],a=r[2]-t[2],o=e[0]-t[0],l=e[1]-t[1],c=e[2]-t[2],u=s*c-a*l,h=a*o-n*c,p=n*l-s*o,m=u*u+h*h+p*p,g=Math.abs(m-1)>1e-5&&m>1e-12?1/Math.sqrt(m):1;return i[0]=u*g,i[1]=h*g,i[2]=p*g,i[3]=-(i[0]*e[0]+i[1]*e[1]+i[2]*e[2]),i}function ESe(e,t,r,i,n){if(e.count<3)return!1;e.getVec(r,q6);let s=i,a=!1;for(;s<e.count-1&&!a;)e.getVec(s,kx),s++,a=!Kl(q6,kx);if(!a)return!1;for(s=Math.max(s,n),a=!1;s<e.count&&!a;)e.getVec(s,v3),s++,pe(GM,q6,kx),we(GM,GM),pe(jM,kx,v3),we(jM,jM),a=!Kl(q6,v3)&&!Kl(kx,v3)&&Math.abs(Se(GM,jM))<Oqe;return a?(Ao(q6,kx,v3,t),!0):(r!==0||i!==1||n!==2)&&ESe(e,t,0,1,2)}const Oqe=.99619469809,q6=M(),kx=M(),v3=M(),GM=M(),jM=M();function cZ(e,t,r){return t!==e&&qV(e,t),e[3]=-Se(e,r),e}function dZ(e,t){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t}function bA(e,t,r,i){return dt(v3,t,e),r9(r,v3,i)}function JIt(e,t,r,i){return HV(e,t,pe(qe.get(),r,t),Fqe,i)}function Cx(e,t,r){return!!_(t)&&HV(e,t.origin,t.direction,Nqe,r)}function Mqe(e,t,r){return HV(e,t.origin,t.vector,im.NONE,r)}function Pqe(e,t,r){return HV(e,t.origin,t.vector,im.CLAMP,r)}function CSe(e,t){return di(e,t)>=0}function Iqe(e,t){const r=t[0],i=t[1],n=t[2],s=t[3],a=t[4],o=t[5];return e[0]*(e[0]>0?r:s)+e[1]*(e[1]>0?i:a)+e[2]*(e[2]>0?n:o)+e[3]>=0}function $qe(e,t){const r=Se(e,t.ray.direction),i=-di(e,t.ray.origin);if(i<0&&r>=0)return!1;if(r>-1e-6&&r<1e-6)return i>0;if((i<0||r<0)&&!(i<0&&r<0))return!0;const n=i/r;return r>0?n<t.c1&&(t.c1=n):n>t.c0&&(t.c0=n),t.c0<=t.c1}function Lqe(e,t){const r=Se(e,t.ray.direction),i=-di(e,t.ray.origin);if(r>-1e-6&&r<1e-6)return i>0;const n=i/r;return r>0?n<t.c1&&(t.c1=n):n>t.c0&&(t.c0=n),t.c0<=t.c1}function Dqe(e,t,r){const i=le(qe.get(),e,-e[3]),n=uZ(e,pe(qe.get(),t,i),qe.get());return he(r,n,i),r}function uZ(e,t,r){const i=le(qe.get(),e,Se(e,t));return pe(r,t,i),r}function di(e,t){return Se(e,t)+e[3]}function HV(e,t,r,i,n){const s=Se(e,r);if(s===0)return!1;let a=-(Se(e,t)+e[3])/s;return i&im.CLAMP&&(a=Le(a,0,1)),!(!(i&im.INFINITE_MIN)&&a<0||!(i&im.INFINITE_MAX)&&a>1)&&(he(n,t,le(n,r,a)),!0)}function KIt(e){return e}const PE=[0,0,1,0];var im;(function(e){e[e.NONE=0]="NONE",e[e.CLAMP=1]="CLAMP",e[e.INFINITE_MIN=4]="INFINITE_MIN",e[e.INFINITE_MAX=8]="INFINITE_MAX"})(im||(im={}));const Fqe=im.INFINITE_MIN|im.INFINITE_MAX,Nqe=im.INFINITE_MAX,bG=fe.getLogger("esri.views.3d.support.geometryUtils.boundedPlane");class ASe{constructor(){this.plane=Er(),this.origin=M(),this.basis1=M(),this.basis2=M()}}function b_(e=kSe){return{plane:Er(e.plane),origin:Kn(e.origin),basis1:Kn(e.basis1),basis2:Kn(e.basis2)}}function kqe(e,t,r){const i=Zqe.get();return i.origin=e,i.basis1=t,i.basis2=r,i.plane=Rqe(0,0,0,0),WV(i),i}function Ax(e,t=b_()){return lie(e.origin,e.basis1,e.basis2,t)}function Vqe(e,t){oe(t.origin,e.origin),oe(t.basis1,e.basis1),oe(t.basis2,e.basis2),qV(t.plane,e.plane)}function lie(e,t,r,i=b_()){return oe(i.origin,e),oe(i.basis1,t),oe(i.basis2,r),WV(i),Xqe(i,"fromValues()"),i}function WV(e){bA(e.basis2,e.basis1,e.origin,e.plane)}function RSe(e,t,r){e!==r&&Ax(e,r);const i=le(qe.get(),Iy(e),t);return he(r.origin,r.origin,i),r.plane[3]-=t,r}function zqe(e,t,r){return OSe(t,r),RSe(r,hie(e,e.origin),r),r}function OSe(e,t=b_()){const r=(e[2]-e[0])/2,i=(e[3]-e[1])/2;return ne(t.origin,e[0]+r,e[1]+i,0),ne(t.basis1,r,0,0),ne(t.basis2,0,i,0),oie(0,0,1,0,t.plane),t}function cie(e,t,r){return!!Cx(e.plane,t,r)&&FSe(e,r)}function Uqe(e,t,r){if(cie(e,t,r))return r;const i=MSe(e,t,qe.get());return he(r,t.origin,le(qe.get(),t.direction,fi(t.origin,i)/Oe(t.direction))),r}function MSe(e,t,r){const i=KF.get();NSe(e,t,i,KF.get());let n=Number.POSITIVE_INFINITY;for(const s of pie){const a=fie(e,s,XV.get()),o=qe.get();if(Mqe(i,a,o)){const l=By(qe.get(),t.origin,o),c=Math.abs(Rs(Se(t.direction,l)));c<n&&(n=c,oe(r,o))}}return n===Number.POSITIVE_INFINITY?PSe(e,t,r):r}function PSe(e,t,r){if(cie(e,t,r))return r;const i=KF.get(),n=KF.get();NSe(e,t,i,n);let s=Number.POSITIVE_INFINITY;for(const a of pie){const o=fie(e,a,XV.get()),l=qe.get();if(Pqe(i,o,l)){const c=cqe(t,l);if(!CSe(n,l))continue;c<s&&(s=c,oe(r,l))}}return die(e,t.origin)<s&&ISe(e,t.origin,r),r}function ISe(e,t,r){const i=Dqe(e.plane,t,qe.get()),n=aZ(Ide(e,e.basis1),i,-1,1,qe.get()),s=aZ(Ide(e,e.basis2),i,-1,1,qe.get());return pe(r,he(qe.get(),n,s),e.origin),r}function $Se(e,t,r){const{origin:i,basis1:n,basis2:s}=e,a=pe(qe.get(),t,i),o=YC(n,a),l=YC(s,a),c=YC(Iy(e),a);return ne(r,o,l,c)}function die(e,t){const r=$Se(e,t,qe.get()),{basis1:i,basis2:n}=e,s=Oe(i),a=Oe(n),o=Math.max(Math.abs(r[0])-s,0),l=Math.max(Math.abs(r[1])-a,0),c=r[2];return o*o+l*l+c*c}function Bqe(e,t){return Math.sqrt(die(e,t))}function Gqe(e,t){let r=Number.NEGATIVE_INFINITY;for(const i of pie){const n=fie(e,i,XV.get()),s=sie(n,t);s>r&&(r=s)}return Math.sqrt(r)}function uie(e,t){return CSe(e.plane,t)&&FSe(e,t)}function jqe(e,t,r,i){return Wqe(e,r,i)}function hie(e,t){const r=-e.plane[3];return YC(Iy(e),t)-r}function qqe(e,t,r,i){const n=hie(e,t),s=le(Yqe,Iy(e),r-n);return he(i,t,s),i}function LSe(e,t){return Kl(e.basis1,t.basis1)&&Kl(e.basis2,t.basis2)&&Kl(e.origin,t.origin)}function DSe(e,t,r){return e!==r&&Ax(e,r),Rn(Vx,t),hc(Vx,Vx),ze(r.basis1,e.basis1,Vx),ze(r.basis2,e.basis2,Vx),ze(r.plane,e.plane,Vx),ze(r.origin,e.origin,t),cZ(r.plane,r.plane,r.origin),r}function Hqe(e,t,r,i){return e!==i&&Ax(e,i),Cu(vG,t,r),ze(i.basis1,e.basis1,vG),ze(i.basis2,e.basis2,vG),WV(i),i}function Iy(e){return e.plane}function Wqe(e,t,r){switch(t){case bu.X:oe(r,e.basis1),we(r,r);break;case bu.Y:oe(r,e.basis2),we(r,r);break;case bu.Z:oe(r,Iy(e))}return r}function FSe(e,t){const r=pe(qe.get(),t,e.origin),i=fl(e.basis1),n=fl(e.basis2),s=Se(e.basis1,r),a=Se(e.basis2,r);return-s-i<0&&s-i<0&&-a-n<0&&a-n<0}function Ide(e,t){const r=XV.get();return oe(r.origin,e.origin),oe(r.vector,t),r}function fie(e,t,r){const{basis1:i,basis2:n,origin:s}=e,a=le(qe.get(),i,t.origin[0]),o=le(qe.get(),n,t.origin[1]);he(r.origin,a,o),he(r.origin,r.origin,s);const l=le(qe.get(),i,t.direction[0]),c=le(qe.get(),n,t.direction[1]);return le(r.vector,he(l,l,c),2),r}function Xqe(e,t){Math.abs(Se(e.basis1,e.basis2)/(Oe(e.basis1)*Oe(e.basis2)))>1e-6&&bG.warn(t,"Provided basis vectors are not perpendicular"),Math.abs(Se(e.basis1,Iy(e)))>1e-6&&bG.warn(t,"Basis vectors and plane normal are not perpendicular"),Math.abs(-Se(Iy(e),e.origin)-e.plane[3])>1e-6&&bG.warn(t,"Plane offset is not consistent with plane origin")}function NSe(e,t,r,i){const n=Iy(e);bA(n,t.direction,t.origin,r),bA(r,n,t.origin,i)}const kSe={plane:Er(),origin:Ve(0,0,0),basis1:Ve(1,0,0),basis2:Ve(0,1,0)},KF=new jy(Er),XV=new jy(Om),Yqe=M(),Zqe=new jy(()=>({origin:null,basis1:null,basis2:null,plane:null})),pie=[{origin:[-1,-1],direction:[1,0]},{origin:[1,-1],direction:[0,1]},{origin:[1,1],direction:[-1,0]},{origin:[-1,1],direction:[0,-1]}],Vx=Ae(),vG=Ae(),Qqe=Object.freeze(Object.defineProperty({__proto__:null,BoundedPlaneClass:ASe,create:b_,wrap:kqe,copy:Ax,copyWithoutVerify:Vqe,fromValues:lie,updateUnboundedPlane:WV,elevate:RSe,setExtent:zqe,fromAABoundingRect:OSe,intersectRay:cie,intersectRayClosestSilhouette:Uqe,closestPointOnSilhouette:MSe,closestPoint:PSe,projectPoint:ISe,projectPointLocal:$Se,distance2:die,distance:Bqe,distanceToSilhouette:Gqe,extrusionContainsPoint:uie,axisAt:jqe,altitudeAt:hie,setAltitudeAt:qqe,equals:LSe,transform:DSe,rotate:Hqe,normal:Iy,UP:kSe},Symbol.toStringTag,{value:"Module"}));function Jqe(e){const{value:t,operations:r}=e;return{operations:r,value:r.create(t)}}function Kqe(e,t,r){return e.operations.setExtent(e.value,t,r.value),r}function eHe(e){return{operations:e,value:e.create()}}function VSe(e,t,r=eHe(e)){return r.operations=e,e.copy(t,r.value),r}function tHe(e){return VSe(Sqe,bSe(0,0,0,Ar(e).radius))}const $de=2**50;function rHe(){return VSe(Qqe,lie([0,0,0],[$de,0,0],[0,$de,0]))}function iHe(e,t,r){return e.operations.axisAt(e.value,t,bu.Z,r)}function nHe(e,t,r,i){return e.operations.axisAt(e.value,t,r,i)}function sHe(e,t,r){return e.operations.intersectRay(e.value,t,r)}function aHe(e,t,r){return e.operations.intersectRayClosestSilhouette(e.value,t,r)}function oHe(e,t){return e.operations.altitudeAt(e.value,t)}function zSe(e,t,r,i){return e.operations.setAltitudeAt(e.value,t,r,i)}function lHe(e,t,r,i){return t!==i&&Ln(i,t),ne(zx,i[12],i[13],i[14]),zSe(e,zx,r,zx),i[12]=zx[0],i[13]=zx[1],i[14]=zx[2],i}function _G(e,t,r){return e.operations.elevate(e.value,t,r.value)}const zx=M();function Lde(e,t,r,i,n){return n[0]=Se(e,t),n[1]=Se(e,r),n[2]=Se(e,i),n}function hZ(e,t,r,i,n){oe(r,e),oe(qM,t),we(qM,qM),dt(i,qM,r),dt(n,i,r)}function USe(e,t){return e?fm(t):t.isGeographic?Ye.PlateCarree:t}const qM=M(),mie=96;function cHe(e,t){const r=t||e.extent,i=e.width,n=vc(r&&r.spatialReference);return r&&i?r.width/i*n*Gre*mie:0}function BSe(e,t){return e/(vc(t)*Gre*mie)}function fZ(e,t){return e*(vc(t)*Gre*mie)}const dHe=fe.getLogger("esri.support.AnalysesCollection");let i9=class extends HC{constructor(e){super(e),this.handles.add(this.on("before-add",t=>{R(t.item)||t.item.parent===this.owner&&(dHe.warn("Analysis inside the collection must be unique. Not adding this element again."),t.preventDefault())}))}_own(e){e.parent=this.owner}_release(e){e.parent=null}};i9=d([$("esri.support.AnalysesCollection")],i9);const yL={widthBreakpoint:{getValue(e){const t=e.viewSize[0],r=e.breakpoints,i=this.values;return t<=r.xsmall?i.xsmall:t<=r.small?i.small:t<=r.medium?i.medium:t<=r.large?i.large:i.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-width-xsmall esri-view-width-less-than-small esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",small:"esri-view-width-small esri-view-width-greater-than-xsmall esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",medium:"esri-view-width-medium esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-less-than-large esri-view-width-less-than-xlarge",large:"esri-view-width-large esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-less-than-xlarge",xlarge:"esri-view-width-xlarge esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-greater-than-large"}},heightBreakpoint:{getValue(e){const t=e.viewSize[1],r=e.breakpoints,i=this.values;return t<=r.xsmall?i.xsmall:t<=r.small?i.small:t<=r.medium?i.medium:t<=r.large?i.large:i.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-height-xsmall esri-view-height-less-than-small esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",small:"esri-view-height-small esri-view-height-greater-than-xsmall esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",medium:"esri-view-height-medium esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-less-than-large esri-view-height-less-than-xlarge",large:"esri-view-height-large esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-less-than-xlarge",xlarge:"esri-view-height-xlarge esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-greater-than-large"}},orientation:{getValue(e){const t=e.viewSize,r=t[0],i=t[1],n=this.values;return i>=r?n.portrait:n.landscape},values:{portrait:"portrait",landscape:"landscape"},valueToClassName:{portrait:"esri-view-orientation-portrait",landscape:"esri-view-orientation-landscape"}}},wG={xsmall:544,small:768,medium:992,large:1200};function uHe(e){const t=e;return t&&t.xsmall<t.small&&t.small<t.medium&&t.medium<t.large}function xG(e,t){return t?yL[e].valueToClassName[t].split(" "):[]}const hHe=e=>{let t=class extends e{constructor(...r){super(...r),this._breakpointsHandles=new Ft,this.orientation=null,this.widthBreakpoint=null,this.heightBreakpoint=null,this.breakpoints=wG}initialize(){this._breakpointsHandles.add(re(()=>[this.breakpoints,this.size],()=>this._updateClassNames(),Ot))}destroy(){this.destroyed||(this._removeActiveClassNames(),this._breakpointsHandles=ct(this._breakpointsHandles))}set breakpoints(r){if(r===this._get("breakpoints"))return;const i=uHe(r);if(!i){const n=JSON.stringify(wG,null,2);console.warn("provided breakpoints are not valid, using defaults:"+n)}r=i?r:wG,this._set("breakpoints",{...r})}_updateClassNames(){if(!this.container)return;const r=Xc.acquire(),i=Xc.acquire();let n,s=!1;for(n in yL){const a=this[n],o=yL[n].getValue({viewSize:this.size,breakpoints:this.breakpoints});a!==o&&(s=!0,this[n]=o,xG(n,a).forEach(l=>i.push(l)),xG(n,o).forEach(l=>r.push(l)))}s&&(this._applyClassNameChanges(r,i),Xc.release(r),Xc.release(i))}_applyClassNameChanges(r,i){const n=this.container;n&&(i.forEach(s=>n.classList.remove(s)),r.forEach(s=>n.classList.add(s)))}_removeActiveClassNames(){const r=this.container;if(!r)return;let i;for(i in yL)xG(i,this[i]).forEach(n=>r.classList.remove(n))}};return d([f()],t.prototype,"breakpoints",null),d([f()],t.prototype,"orientation",void 0),d([f()],t.prototype,"widthBreakpoint",void 0),d([f()],t.prototype,"heightBreakpoint",void 0),t=d([$("esri.views.BreakpointsOwner")],t),t};/*!
 * @esri/arcgis-html-sanitizer - v2.10.0 - Tue Mar 15 2022 16:38:25 GMT-0400 (Eastern Daylight Time)
 * Copyright (c) 2022 - Environmental Systems Research Institute, Inc.
 * Apache-2.0
 * 
 * js-xss
 * Copyright (c) 2012-2017 Zongmin Lei() <leizongmin@gmail.com>
 * http://ucdok.com
 * MIT License, see https://github.com/leizongmin/js-xss/blob/master/LICENSE for details
 * 
 * Lodash/isPlainObject
 * Copyright (c) JS Foundation and other contributors <https://js.foundation/>
 * MIT License, see https://raw.githubusercontent.com/lodash/lodash/4.17.10-npm/LICENSE for details
 */var fHe="[object Object]";function pHe(e){var t=!1;if(e!=null&&typeof e.toString!="function")try{t=!!(e+"")}catch{}return t}function mHe(e,t){return function(r){return e(t(r))}}var gHe=Function.prototype,GSe=Object.prototype,jSe=gHe.toString,yHe=GSe.hasOwnProperty,bHe=jSe.call(Object),vHe=GSe.toString,_He=mHe(Object.getPrototypeOf,Object);function wHe(e){return!!e&&typeof e=="object"}function xHe(e){if(!wHe(e)||vHe.call(e)!=fHe||pHe(e))return!1;var t=_He(e);if(t===null)return!0;var r=yHe.call(t,"constructor")&&t.constructor;return typeof r=="function"&&r instanceof r&&jSe.call(r)==bHe}var THe=xHe,_3={exports:{}},ss={},vA={exports:{}},Rx={};function qSe(){var e={};return e["align-content"]=!1,e["align-items"]=!1,e["align-self"]=!1,e["alignment-adjust"]=!1,e["alignment-baseline"]=!1,e.all=!1,e["anchor-point"]=!1,e.animation=!1,e["animation-delay"]=!1,e["animation-direction"]=!1,e["animation-duration"]=!1,e["animation-fill-mode"]=!1,e["animation-iteration-count"]=!1,e["animation-name"]=!1,e["animation-play-state"]=!1,e["animation-timing-function"]=!1,e.azimuth=!1,e["backface-visibility"]=!1,e.background=!0,e["background-attachment"]=!0,e["background-clip"]=!0,e["background-color"]=!0,e["background-image"]=!0,e["background-origin"]=!0,e["background-position"]=!0,e["background-repeat"]=!0,e["background-size"]=!0,e["baseline-shift"]=!1,e.binding=!1,e.bleed=!1,e["bookmark-label"]=!1,e["bookmark-level"]=!1,e["bookmark-state"]=!1,e.border=!0,e["border-bottom"]=!0,e["border-bottom-color"]=!0,e["border-bottom-left-radius"]=!0,e["border-bottom-right-radius"]=!0,e["border-bottom-style"]=!0,e["border-bottom-width"]=!0,e["border-collapse"]=!0,e["border-color"]=!0,e["border-image"]=!0,e["border-image-outset"]=!0,e["border-image-repeat"]=!0,e["border-image-slice"]=!0,e["border-image-source"]=!0,e["border-image-width"]=!0,e["border-left"]=!0,e["border-left-color"]=!0,e["border-left-style"]=!0,e["border-left-width"]=!0,e["border-radius"]=!0,e["border-right"]=!0,e["border-right-color"]=!0,e["border-right-style"]=!0,e["border-right-width"]=!0,e["border-spacing"]=!0,e["border-style"]=!0,e["border-top"]=!0,e["border-top-color"]=!0,e["border-top-left-radius"]=!0,e["border-top-right-radius"]=!0,e["border-top-style"]=!0,e["border-top-width"]=!0,e["border-width"]=!0,e.bottom=!1,e["box-decoration-break"]=!0,e["box-shadow"]=!0,e["box-sizing"]=!0,e["box-snap"]=!0,e["box-suppress"]=!0,e["break-after"]=!0,e["break-before"]=!0,e["break-inside"]=!0,e["caption-side"]=!1,e.chains=!1,e.clear=!0,e.clip=!1,e["clip-path"]=!1,e["clip-rule"]=!1,e.color=!0,e["color-interpolation-filters"]=!0,e["column-count"]=!1,e["column-fill"]=!1,e["column-gap"]=!1,e["column-rule"]=!1,e["column-rule-color"]=!1,e["column-rule-style"]=!1,e["column-rule-width"]=!1,e["column-span"]=!1,e["column-width"]=!1,e.columns=!1,e.contain=!1,e.content=!1,e["counter-increment"]=!1,e["counter-reset"]=!1,e["counter-set"]=!1,e.crop=!1,e.cue=!1,e["cue-after"]=!1,e["cue-before"]=!1,e.cursor=!1,e.direction=!1,e.display=!0,e["display-inside"]=!0,e["display-list"]=!0,e["display-outside"]=!0,e["dominant-baseline"]=!1,e.elevation=!1,e["empty-cells"]=!1,e.filter=!1,e.flex=!1,e["flex-basis"]=!1,e["flex-direction"]=!1,e["flex-flow"]=!1,e["flex-grow"]=!1,e["flex-shrink"]=!1,e["flex-wrap"]=!1,e.float=!1,e["float-offset"]=!1,e["flood-color"]=!1,e["flood-opacity"]=!1,e["flow-from"]=!1,e["flow-into"]=!1,e.font=!0,e["font-family"]=!0,e["font-feature-settings"]=!0,e["font-kerning"]=!0,e["font-language-override"]=!0,e["font-size"]=!0,e["font-size-adjust"]=!0,e["font-stretch"]=!0,e["font-style"]=!0,e["font-synthesis"]=!0,e["font-variant"]=!0,e["font-variant-alternates"]=!0,e["font-variant-caps"]=!0,e["font-variant-east-asian"]=!0,e["font-variant-ligatures"]=!0,e["font-variant-numeric"]=!0,e["font-variant-position"]=!0,e["font-weight"]=!0,e.grid=!1,e["grid-area"]=!1,e["grid-auto-columns"]=!1,e["grid-auto-flow"]=!1,e["grid-auto-rows"]=!1,e["grid-column"]=!1,e["grid-column-end"]=!1,e["grid-column-start"]=!1,e["grid-row"]=!1,e["grid-row-end"]=!1,e["grid-row-start"]=!1,e["grid-template"]=!1,e["grid-template-areas"]=!1,e["grid-template-columns"]=!1,e["grid-template-rows"]=!1,e["hanging-punctuation"]=!1,e.height=!0,e.hyphens=!1,e.icon=!1,e["image-orientation"]=!1,e["image-resolution"]=!1,e["ime-mode"]=!1,e["initial-letters"]=!1,e["inline-box-align"]=!1,e["justify-content"]=!1,e["justify-items"]=!1,e["justify-self"]=!1,e.left=!1,e["letter-spacing"]=!0,e["lighting-color"]=!0,e["line-box-contain"]=!1,e["line-break"]=!1,e["line-grid"]=!1,e["line-height"]=!1,e["line-snap"]=!1,e["line-stacking"]=!1,e["line-stacking-ruby"]=!1,e["line-stacking-shift"]=!1,e["line-stacking-strategy"]=!1,e["list-style"]=!0,e["list-style-image"]=!0,e["list-style-position"]=!0,e["list-style-type"]=!0,e.margin=!0,e["margin-bottom"]=!0,e["margin-left"]=!0,e["margin-right"]=!0,e["margin-top"]=!0,e["marker-offset"]=!1,e["marker-side"]=!1,e.marks=!1,e.mask=!1,e["mask-box"]=!1,e["mask-box-outset"]=!1,e["mask-box-repeat"]=!1,e["mask-box-slice"]=!1,e["mask-box-source"]=!1,e["mask-box-width"]=!1,e["mask-clip"]=!1,e["mask-image"]=!1,e["mask-origin"]=!1,e["mask-position"]=!1,e["mask-repeat"]=!1,e["mask-size"]=!1,e["mask-source-type"]=!1,e["mask-type"]=!1,e["max-height"]=!0,e["max-lines"]=!1,e["max-width"]=!0,e["min-height"]=!0,e["min-width"]=!0,e["move-to"]=!1,e["nav-down"]=!1,e["nav-index"]=!1,e["nav-left"]=!1,e["nav-right"]=!1,e["nav-up"]=!1,e["object-fit"]=!1,e["object-position"]=!1,e.opacity=!1,e.order=!1,e.orphans=!1,e.outline=!1,e["outline-color"]=!1,e["outline-offset"]=!1,e["outline-style"]=!1,e["outline-width"]=!1,e.overflow=!1,e["overflow-wrap"]=!1,e["overflow-x"]=!1,e["overflow-y"]=!1,e.padding=!0,e["padding-bottom"]=!0,e["padding-left"]=!0,e["padding-right"]=!0,e["padding-top"]=!0,e.page=!1,e["page-break-after"]=!1,e["page-break-before"]=!1,e["page-break-inside"]=!1,e["page-policy"]=!1,e.pause=!1,e["pause-after"]=!1,e["pause-before"]=!1,e.perspective=!1,e["perspective-origin"]=!1,e.pitch=!1,e["pitch-range"]=!1,e["play-during"]=!1,e.position=!1,e["presentation-level"]=!1,e.quotes=!1,e["region-fragment"]=!1,e.resize=!1,e.rest=!1,e["rest-after"]=!1,e["rest-before"]=!1,e.richness=!1,e.right=!1,e.rotation=!1,e["rotation-point"]=!1,e["ruby-align"]=!1,e["ruby-merge"]=!1,e["ruby-position"]=!1,e["shape-image-threshold"]=!1,e["shape-outside"]=!1,e["shape-margin"]=!1,e.size=!1,e.speak=!1,e["speak-as"]=!1,e["speak-header"]=!1,e["speak-numeral"]=!1,e["speak-punctuation"]=!1,e["speech-rate"]=!1,e.stress=!1,e["string-set"]=!1,e["tab-size"]=!1,e["table-layout"]=!1,e["text-align"]=!0,e["text-align-last"]=!0,e["text-combine-upright"]=!0,e["text-decoration"]=!0,e["text-decoration-color"]=!0,e["text-decoration-line"]=!0,e["text-decoration-skip"]=!0,e["text-decoration-style"]=!0,e["text-emphasis"]=!0,e["text-emphasis-color"]=!0,e["text-emphasis-position"]=!0,e["text-emphasis-style"]=!0,e["text-height"]=!0,e["text-indent"]=!0,e["text-justify"]=!0,e["text-orientation"]=!0,e["text-overflow"]=!0,e["text-shadow"]=!0,e["text-space-collapse"]=!0,e["text-transform"]=!0,e["text-underline-position"]=!0,e["text-wrap"]=!0,e.top=!1,e.transform=!1,e["transform-origin"]=!1,e["transform-style"]=!1,e.transition=!1,e["transition-delay"]=!1,e["transition-duration"]=!1,e["transition-property"]=!1,e["transition-timing-function"]=!1,e["unicode-bidi"]=!1,e["vertical-align"]=!1,e.visibility=!1,e["voice-balance"]=!1,e["voice-duration"]=!1,e["voice-family"]=!1,e["voice-pitch"]=!1,e["voice-range"]=!1,e["voice-rate"]=!1,e["voice-stress"]=!1,e["voice-volume"]=!1,e.volume=!1,e["white-space"]=!1,e.widows=!1,e.width=!0,e["will-change"]=!1,e["word-break"]=!0,e["word-spacing"]=!0,e["word-wrap"]=!0,e["wrap-flow"]=!1,e["wrap-through"]=!1,e["writing-mode"]=!1,e["z-index"]=!1,e}function SHe(e,t,r){}function EHe(e,t,r){}var CHe=/javascript\s*\:/img;function AHe(e,t){return CHe.test(t)?"":t}Rx.whiteList=qSe();Rx.getDefaultWhiteList=qSe;Rx.onAttr=SHe;Rx.onIgnoreAttr=EHe;Rx.safeAttrValue=AHe;var RHe={indexOf:function(e,t){var r,i;if(Array.prototype.indexOf)return e.indexOf(t);for(r=0,i=e.length;r<i;r++)if(e[r]===t)return r;return-1},forEach:function(e,t,r){var i,n;if(Array.prototype.forEach)return e.forEach(t,r);for(i=0,n=e.length;i<n;i++)t.call(r,e[i],i,e)},trim:function(e){return String.prototype.trim?e.trim():e.replace(/(^\s*)|(\s*$)/g,"")},trimRight:function(e){return String.prototype.trimRight?e.trimRight():e.replace(/(\s*$)/g,"")}},H6=RHe;function OHe(e,t){e=H6.trimRight(e),e[e.length-1]!==";"&&(e+=";");var r=e.length,i=!1,n=0,s=0,a="";function o(){if(!i){var u=H6.trim(e.slice(n,s)),h=u.indexOf(":");if(h!==-1){var p=H6.trim(u.slice(0,h)),m=H6.trim(u.slice(h+1));if(p){var g=t(n,a.length,p,m,u);g&&(a+=g+"; ")}}}n=s+1}for(;s<r;s++){var l=e[s];if(l==="/"&&e[s+1]==="*"){var c=e.indexOf("*/",s+2);if(c===-1)break;s=c+1,n=s+1,i=!1}else l==="("?i=!0:l===")"?i=!1:l===";"?i||o():l===`
`&&o()}return H6.trim(a)}var MHe=OHe,HM=Rx,PHe=MHe;function Dde(e){return e==null}function IHe(e){var t={};for(var r in e)t[r]=e[r];return t}function HSe(e){e=IHe(e||{}),e.whiteList=e.whiteList||HM.whiteList,e.onAttr=e.onAttr||HM.onAttr,e.onIgnoreAttr=e.onIgnoreAttr||HM.onIgnoreAttr,e.safeAttrValue=e.safeAttrValue||HM.safeAttrValue,this.options=e}HSe.prototype.process=function(e){if(e=e||"",e=e.toString(),!e)return"";var t=this,r=t.options,i=r.whiteList,n=r.onAttr,s=r.onIgnoreAttr,a=r.safeAttrValue,o=PHe(e,function(l,c,u,h,p){var m=i[u],g=!1;if(m===!0?g=m:typeof m=="function"?g=m(h):m instanceof RegExp&&(g=m.test(h)),g!==!0&&(g=!1),h=a(u,h),!!h){var b={position:c,sourcePosition:l,source:p,isWhite:g};if(g){var w=n(u,h,b);return Dde(w)?u+":"+h:w}else{var w=s(u,h,b);if(!Dde(w))return w}}});return o};var $He=HSe;(function(e,t){var r=Rx,i=$He;function n(a,o){var l=new i(o);return l.process(a)}t=e.exports=n,t.FilterCSS=i;for(var s in r)t[s]=r[s]})(vA,vA.exports);var gie={indexOf:function(e,t){var r,i;if(Array.prototype.indexOf)return e.indexOf(t);for(r=0,i=e.length;r<i;r++)if(e[r]===t)return r;return-1},forEach:function(e,t,r){var i,n;if(Array.prototype.forEach)return e.forEach(t,r);for(i=0,n=e.length;i<n;i++)t.call(r,e[i],i,e)},trim:function(e){return String.prototype.trim?e.trim():e.replace(/(^\s*)|(\s*$)/g,"")},spaceIndex:function(e){var t=/\s|\n|\t/,r=t.exec(e);return r?r.index:-1}},LHe=vA.exports.FilterCSS,DHe=vA.exports.getDefaultWhiteList,eN=gie;function WSe(){return{a:["target","href","title"],abbr:["title"],address:[],area:["shape","coords","href","alt"],article:[],aside:[],audio:["autoplay","controls","crossorigin","loop","muted","preload","src"],b:[],bdi:["dir"],bdo:["dir"],big:[],blockquote:["cite"],br:[],caption:[],center:[],cite:[],code:[],col:["align","valign","span","width"],colgroup:["align","valign","span","width"],dd:[],del:["datetime"],details:["open"],div:[],dl:[],dt:[],em:[],figcaption:[],figure:[],font:["color","size","face"],footer:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],header:[],hr:[],i:[],img:["src","alt","title","width","height"],ins:["datetime"],li:[],mark:[],nav:[],ol:[],p:[],pre:[],s:[],section:[],small:[],span:[],sub:[],summary:[],sup:[],strong:[],strike:[],table:["width","border","align","valign"],tbody:["align","valign"],td:["width","rowspan","colspan","align","valign"],tfoot:["align","valign"],th:["width","rowspan","colspan","align","valign"],thead:["align","valign"],tr:["rowspan","align","valign"],tt:[],u:[],ul:[],video:["autoplay","controls","crossorigin","loop","muted","playsinline","poster","preload","src","height","width"]}}var XSe=new LHe;function FHe(e,t,r){}function NHe(e,t,r){}function kHe(e,t,r){}function VHe(e,t,r){}function YSe(e){return e.replace(UHe,"&lt;").replace(BHe,"&gt;")}function zHe(e,t,r,i){if(r=t4e(r),t==="href"||t==="src"){if(r=eN.trim(r),r==="#")return"#";if(!(r.substr(0,7)==="http://"||r.substr(0,8)==="https://"||r.substr(0,7)==="mailto:"||r.substr(0,4)==="tel:"||r.substr(0,11)==="data:image/"||r.substr(0,6)==="ftp://"||r.substr(0,2)==="./"||r.substr(0,3)==="../"||r[0]==="#"||r[0]==="/"))return""}else if(t==="background"){if(WM.lastIndex=0,WM.test(r))return""}else if(t==="style"){if(Fde.lastIndex=0,Fde.test(r)||(Nde.lastIndex=0,Nde.test(r)&&(WM.lastIndex=0,WM.test(r))))return"";i!==!1&&(i=i||XSe,r=i.process(r))}return r=r4e(r),r}var UHe=/</g,BHe=/>/g,GHe=/"/g,jHe=/&quot;/g,qHe=/&#([a-zA-Z0-9]*);?/gim,HHe=/&colon;?/gim,WHe=/&newline;?/gim,WM=/((j\s*a\s*v\s*a|v\s*b|l\s*i\s*v\s*e)\s*s\s*c\s*r\s*i\s*p\s*t\s*|m\s*o\s*c\s*h\s*a)\:/gi,Fde=/e\s*x\s*p\s*r\s*e\s*s\s*s\s*i\s*o\s*n\s*\(.*/gi,Nde=/u\s*r\s*l\s*\(.*/gi;function ZSe(e){return e.replace(GHe,"&quot;")}function QSe(e){return e.replace(jHe,'"')}function JSe(e){return e.replace(qHe,function(r,i){return i[0]==="x"||i[0]==="X"?String.fromCharCode(parseInt(i.substr(1),16)):String.fromCharCode(parseInt(i,10))})}function KSe(e){return e.replace(HHe,":").replace(WHe," ")}function e4e(e){for(var t="",r=0,i=e.length;r<i;r++)t+=e.charCodeAt(r)<32?" ":e.charAt(r);return eN.trim(t)}function t4e(e){return e=QSe(e),e=JSe(e),e=KSe(e),e=e4e(e),e}function r4e(e){return e=ZSe(e),e=YSe(e),e}function XHe(){return""}function YHe(e,t){typeof t!="function"&&(t=function(){});var r=!Array.isArray(e);function i(a){return r?!0:eN.indexOf(e,a)!==-1}var n=[],s=!1;return{onIgnoreTag:function(a,o,l){if(i(a))if(l.isClosing){var c="[/removed]",u=l.position+c.length;return n.push([s!==!1?s:l.position,u]),s=!1,c}else return s||(s=l.position),"[removed]";else return t(a,o,l)},remove:function(a){var o="",l=0;return eN.forEach(n,function(c){o+=a.slice(l,c[0]),l=c[1]}),o+=a.slice(l),o}}}function ZHe(e){for(var t="",r=0;r<e.length;){var i=e.indexOf("<!--",r);if(i===-1){t+=e.slice(r);break}t+=e.slice(r,i);var n=e.indexOf("-->",i);if(n===-1)break;r=n+3}return t}function QHe(e){var t=e.split("");return t=t.filter(function(r){var i=r.charCodeAt(0);return i===127?!1:i<=31?i===10||i===13:!0}),t.join("")}ss.whiteList=WSe();ss.getDefaultWhiteList=WSe;ss.onTag=FHe;ss.onIgnoreTag=NHe;ss.onTagAttr=kHe;ss.onIgnoreTagAttr=VHe;ss.safeAttrValue=zHe;ss.escapeHtml=YSe;ss.escapeQuote=ZSe;ss.unescapeQuote=QSe;ss.escapeHtmlEntities=JSe;ss.escapeDangerHtml5Entities=KSe;ss.clearNonPrintableCharacter=e4e;ss.friendlyAttrValue=t4e;ss.escapeAttrValue=r4e;ss.onIgnoreTagStripAll=XHe;ss.StripTagBody=YHe;ss.stripCommentTag=ZHe;ss.stripBlankChar=QHe;ss.cssFilter=XSe;ss.getDefaultCSSWhiteList=DHe;var YV={},I1=gie;function JHe(e){var t=I1.spaceIndex(e);if(t===-1)var r=e.slice(1,-1);else var r=e.slice(1,t+1);return r=I1.trim(r).toLowerCase(),r.slice(0,1)==="/"&&(r=r.slice(1)),r.slice(-1)==="/"&&(r=r.slice(0,-1)),r}function KHe(e){return e.slice(0,2)==="</"}function eWe(e,t,r){var i="",n=0,s=!1,a=!1,o=0,l=e.length,c="",u="";e:for(o=0;o<l;o++){var h=e.charAt(o);if(s===!1){if(h==="<"){s=o;continue}}else if(a===!1){if(h==="<"){i+=r(e.slice(n,o)),s=o,n=o;continue}if(h===">"){i+=r(e.slice(n,s)),u=e.slice(s,o+1),c=JHe(u),i+=t(s,i.length,c,u,KHe(u)),n=o+1,s=!1;continue}if(h==='"'||h==="'")for(var p=1,m=e.charAt(o-p);m.trim()===""||m==="=";){if(m==="="){a=h;continue e}m=e.charAt(o-++p)}}else if(h===a){a=!1;continue}}return n<e.length&&(i+=r(e.substr(n))),i}var tWe=/[^a-zA-Z0-9_:\.\-]/gim;function rWe(e,t){var r=0,i=[],n=!1,s=e.length;function a(h,p){if(h=I1.trim(h),h=h.replace(tWe,"").toLowerCase(),!(h.length<1)){var m=t(h,p||"");m&&i.push(m)}}for(var o=0;o<s;o++){var l=e.charAt(o),c,u;if(n===!1&&l==="="){n=e.slice(r,o),r=o+1;continue}if(n!==!1&&o===r&&(l==='"'||l==="'")&&e.charAt(o-1)==="="){if(u=e.indexOf(l,o+1),u===-1)break;c=I1.trim(e.slice(r+1,u)),a(n,c),n=!1,o=u,r=o+1;continue}if(/\s|\n|\t/.test(l))if(e=e.replace(/\s|\n|\t/g," "),n===!1)if(u=iWe(e,o),u===-1){c=I1.trim(e.slice(r,o)),a(c),n=!1,r=o+1;continue}else{o=u-1;continue}else if(u=nWe(e,o-1),u===-1){c=I1.trim(e.slice(r,o)),c=kde(c),a(n,c),n=!1,r=o+1;continue}else continue}return r<e.length&&(n===!1?a(e.slice(r)):a(n,kde(I1.trim(e.slice(r))))),I1.trim(i.join(" "))}function iWe(e,t){for(;t<e.length;t++){var r=e[t];if(r!==" ")return r==="="?t:-1}}function nWe(e,t){for(;t>0;t--){var r=e[t];if(r!==" ")return r==="="?t:-1}}function sWe(e){return e[0]==='"'&&e[e.length-1]==='"'||e[0]==="'"&&e[e.length-1]==="'"}function kde(e){return sWe(e)?e.substr(1,e.length-2):e}YV.parseTag=eWe;YV.parseAttr=rWe;var aWe=vA.exports.FilterCSS,Yf=ss,i4e=YV,oWe=i4e.parseTag,lWe=i4e.parseAttr,bL=gie;function XM(e){return e==null}function cWe(e){var t=bL.spaceIndex(e);if(t===-1)return{html:"",closing:e[e.length-2]==="/"};e=bL.trim(e.slice(t+1,-1));var r=e[e.length-1]==="/";return r&&(e=bL.trim(e.slice(0,-1))),{html:e,closing:r}}function dWe(e){var t={};for(var r in e)t[r]=e[r];return t}function n4e(e){e=dWe(e||{}),e.stripIgnoreTag&&(e.onIgnoreTag&&console.error('Notes: cannot use these two options "stripIgnoreTag" and "onIgnoreTag" at the same time'),e.onIgnoreTag=Yf.onIgnoreTagStripAll),e.whiteList=e.whiteList||e.allowList||Yf.whiteList,e.onTag=e.onTag||Yf.onTag,e.onTagAttr=e.onTagAttr||Yf.onTagAttr,e.onIgnoreTag=e.onIgnoreTag||Yf.onIgnoreTag,e.onIgnoreTagAttr=e.onIgnoreTagAttr||Yf.onIgnoreTagAttr,e.safeAttrValue=e.safeAttrValue||Yf.safeAttrValue,e.escapeHtml=e.escapeHtml||Yf.escapeHtml,this.options=e,e.css===!1?this.cssFilter=!1:(e.css=e.css||{},this.cssFilter=new aWe(e.css))}n4e.prototype.process=function(e){if(e=e||"",e=e.toString(),!e)return"";var t=this,r=t.options,i=r.whiteList,n=r.onTag,s=r.onIgnoreTag,a=r.onTagAttr,o=r.onIgnoreTagAttr,l=r.safeAttrValue,c=r.escapeHtml,u=t.cssFilter;r.stripBlankChar&&(e=Yf.stripBlankChar(e)),r.allowCommentTag||(e=Yf.stripCommentTag(e));var h=!1;if(r.stripIgnoreTagBody){var h=Yf.StripTagBody(r.stripIgnoreTagBody,s);s=h.onIgnoreTag}var p=oWe(e,function(m,g,b,w,v){var x={sourcePosition:m,position:g,isClosing:v,isWhite:i.hasOwnProperty(b)},T=n(b,w,x);if(!XM(T))return T;if(x.isWhite){if(x.isClosing)return"</"+b+">";var E=cWe(w),C=i[b],A=lWe(E.html,function(I,L){var V=bL.indexOf(C,I)!==-1,G=a(b,I,L,V);if(!XM(G))return G;if(V)return L=l(b,I,L,u),L?I+'="'+L+'"':I;var G=o(b,I,L,V);return XM(G)?void 0:G}),w="<"+b;return A&&(w+=" "+A),E.closing&&(w+=" /"),w+=">",w}else{var T=s(b,w,x);return XM(T)?c(w):T}},c);return h&&(p=h.remove(p)),p};var uWe=n4e;(function(e,t){var r=ss,i=YV,n=uWe;function s(l,c){var u=new n(c);return u.process(l)}t=e.exports=s,t.filterXSS=s,t.FilterXSS=n;for(var a in r)t[a]=r[a];for(var a in i)t[a]=i[a];function o(){return typeof self<"u"&&typeof DedicatedWorkerGlobalScope<"u"&&self instanceof DedicatedWorkerGlobalScope}o()&&(self.filterXSS=e.exports)})(_3,_3.exports);var hWe=function(){function e(t,r){var i=this;this.arcgisWhiteList={a:["href","style","target"],abbr:["title"],audio:["autoplay","controls","loop","muted","preload"],b:[],br:[],dd:["style"],div:["align","style"],dl:["style"],dt:["style"],em:[],figcaption:["style"],figure:["style"],font:["color","face","size","style"],h1:["style"],h2:["style"],h3:["style"],h4:["style"],h5:["style"],h6:["style"],hr:[],i:[],img:["alt","border","height","src","style","width"],li:[],ol:[],p:["style"],source:["media","src","type"],span:["style"],strong:[],sub:["style"],sup:["style"],table:["border","cellpadding","cellspacing","height","style","width"],tbody:[],tr:["align","height","style","valign"],td:["align","colspan","height","nowrap","rowspan","style","valign","width"],th:["align","colspan","height","nowrap","rowspan","style","valign","width"],u:[],ul:[],video:["autoplay","controls","height","loop","muted","poster","preload","width"]},this.allowedProtocols=["http","https","mailto","iform","tel","flow","lfmobile","arcgis-navigator","arcgis-appstudio-player","arcgis-survey123","arcgis-collector","arcgis-workforce","arcgis-explorer","arcgis-trek2there","arcgis-quickcapture","mspbi","comgooglemaps","pdfefile","pdfehttp","pdfehttps","boxapp","boxemm","awb","awbs","gropen","radarscope"],this.arcgisFilterOptions={allowCommentTag:!0,safeAttrValue:function(s,a,o,l){return s==="a"&&a==="href"||(s==="img"||s==="source")&&a==="src"?i.sanitizeUrl(o):_3.exports.safeAttrValue(s,a,o,l)}};var n;t&&!r?n=t:t&&r?(n=Object.create(this.arcgisFilterOptions),Object.keys(t).forEach(function(s){s==="whiteList"?n.whiteList=i._extendObjectOfArrays([i.arcgisWhiteList,t.whiteList||{}]):n[s]=t[s]})):(n=Object.create(this.arcgisFilterOptions),n.whiteList=this.arcgisWhiteList),this.xssFilterOptions=n,this._xssFilter=new _3.exports.FilterXSS(n)}return e.prototype.sanitize=function(t,r){switch(r===void 0&&(r={}),typeof t){case"number":return isNaN(t)||!isFinite(t)?null:t;case"boolean":return t;case"string":return this._xssFilter.process(t);case"object":return this._iterateOverObject(t,r);default:return r.allowUndefined&&typeof t>"u"?void 0:null}},e.prototype.sanitizeUrl=function(t,r){var i=(r!=null?r:{}).isProtocolRequired,n=i===void 0?!0:i,s=this._trim(t.substring(0,t.indexOf(":"))),a=t==="/",o=/^#/.test(t),l=s&&this.allowedProtocols.indexOf(s.toLowerCase())>-1;return a||o||l?_3.exports.escapeAttrValue(t):!s&&!n?_3.exports.escapeAttrValue("https://".concat(t)):""},e.prototype.sanitizeHTMLAttribute=function(t,r,i,n){return typeof this.xssFilterOptions.safeAttrValue=="function"?this.xssFilterOptions.safeAttrValue(t,r,i,n):_3.exports.safeAttrValue(t,r,i,n)},e.prototype.validate=function(t,r){r===void 0&&(r={});var i=this.sanitize(t,r);return{isValid:t===i,sanitized:i}},e.prototype._extendObjectOfArrays=function(t){var r={};return t.forEach(function(i){Object.keys(i).forEach(function(n){Array.isArray(i[n])&&Array.isArray(r[n])?r[n]=r[n].concat(i[n]):r[n]=i[n]})}),r},e.prototype._iterateOverObject=function(t,r){var i=this;r===void 0&&(r={});try{var n=!1,s=void 0;if(Array.isArray(t))s=t.reduce(function(o,l){var c=i.validate(l,r);return c.isValid?o.concat([l]):(n=!0,o.concat([c.sanitized]))},[]);else if(THe(t)){var a=Object.keys(t);s=a.reduce(function(o,l){var c=t[l],u=i.validate(c,r);return u.isValid?o[l]=c:(n=!0,o[l]=u.sanitized),o},{})}else return r.allowUndefined&&typeof t>"u"?void 0:null;return n?s:t}catch{return null}},e.prototype._trim=function(t){return String.prototype.trim?t.trim():t.replace(/(^\s*)|(\s*$)/g,"")},e}();const ZV=new Map;function s4e(){ZV.clear()}function fWe(e){return ZV.get(e)}function pWe(e,t){ZV.set(e,t)}function TG(e){ZV.delete(e)}var zw,n9,mWe=function(e){if("WebkitTransition"in e.style)zw="webkitTransitionEnd",n9="webkitAnimationEnd";else{if(!("transition"in e.style))throw new Error("Your browser is not supported!");zw="transitionend",n9="animationend"}},a4e=function(e){zw||mWe(e)},gWe=function(e,t){return t===void 0&&(t=e+"-active"),function(r){a4e(r);var i=!1,n=function(s){i||(i=!0,r.removeEventListener(zw,n),r.removeEventListener(n9,n),r.classList.remove(e),r.classList.remove(t))};r.classList.add(e),r.addEventListener(zw,n),r.addEventListener(n9,n),requestAnimationFrame(function(){r.classList.add(t)})}},yWe=function(e,t){return t===void 0&&(t=e+"-active"),function(r,i){a4e(r);var n=!1,s=function(a){n||(n=!0,r.removeEventListener(zw,s),r.removeEventListener(n9,s),i())};r.classList.add(e),r.addEventListener(zw,s),r.addEventListener(n9,s),requestAnimationFrame(function(){r.classList.add(t)})}};const bWe=fe.getLogger("esri.widgets.support.widgetUtils");function h4(e){const t=Xc.acquire();for(let i=0;i<arguments.length;i++){const n=arguments[i],s=typeof n;if(s==="string")t.push(n);else if(Array.isArray(n))t.push.apply(t,n);else if(s==="object")for(const a in n)n[a]&&t.push(a)}const r=t.join(" ");return Xc.release(t),r}(()=>{const e=new Map,t=new ResizeObserver(r=>{s4e();for(const i of r)e.get(i.target)(i)});return(r,i,n)=>(e.has(r)&&bWe.error("Already observing element",r),e.set(r,i),t.observe(r,n),Hh(()=>{t.unobserve(r),e.delete(r)}))})();function gp(e){const t=e==null?void 0:e.closest("[dir]");return t!==null&&t instanceof HTMLElement&&t.dir==="rtl"||document.dir==="rtl"}function Vde(e){const t="data-node-ref";this[e.getAttribute(t)]=null}function pZ(e){const t="data-node-ref";this[e.getAttribute(t)]=e}function vWe(e,t){return(e==="enter"?gWe:yWe)(t)}const _We=["dd","dl","dt","h1","h2","h3","h4","h5","h6","sub","sup","animate","animatetransform","circle","clippath","defs","ellipse","g","image","line","lineargradient","marker","mask","path","pattern","polygon","polyline","radialgradient","rect","stop","svg","switch","symbol","text","textpath","tspan","use"],wWe=_We.reduce((e,t)=>(e[t]=[],e),{}),xWe=["align","alink","alt","bgcolor","border","cellpadding","cellspacing","class","color","cols","colspan","coords","d","dir","face","height","hspace","ismap","lang","marginheight","marginwidth","multiple","nohref","noresize","noshade","nowrap","ref","rel","rev","rows","rowspan","scrolling","shape","span","summary","tabindex","title","usemap","valign","value","vlink","vspace","width"],o4e=new hWe({whiteList:wWe,onTagAttr:(e,t,r)=>{const i=`${t}="${r}"`;if(xWe.includes(t))return i},stripIgnoreTag:!0,stripIgnoreTagBody:["script","style"]},!0);function TWe(e){return e==="Enter"||e===" "}const l4e="http://www.w3.org/",QV=`${l4e}2000/svg`,c4e=`${l4e}1999/xlink`;let tN,zde=[],yie=(e,t)=>{let r={};return Object.keys(e).forEach(i=>{r[i]=e[i]}),t&&Object.keys(t).forEach(i=>{r[i]=t[i]}),r},bie=(e,t)=>e.vnodeSelector===t.vnodeSelector&&(e.properties&&t.properties?e.properties.key===t.properties.key&&e.properties.bind===t.properties.bind:!e.properties&&!t.properties),d4e=e=>{if(typeof e!="string")throw new Error("Style values must be strings")},SWe=(e,t,r)=>{if(t.vnodeSelector!==""){for(let i=r;i<e.length;i++)if(bie(e[i],t))return i}return-1},SG=(e,t,r,i)=>{let n=e[t];if(n.vnodeSelector==="")return;let s=n.properties;if(!(s&&(s.key===void 0?s.bind:s.key))){for(let a=0;a<e.length;a++)if(a!==t){let o=e[a];if(bie(o,n))throw new Error(`${r.vnodeSelector} had a ${n.vnodeSelector} child ${i==="added"?i:"removed"}, but there is now more than one. You must add unique key properties to make them distinguishable.`)}}},EWe=e=>{if(e.properties){let t=e.properties.enterAnimation;t&&t(e.domNode,e.properties)}},mZ=[],gZ=!1,u4e=e=>{(e.children||[]).forEach(u4e),e.properties&&e.properties.afterRemoved&&e.properties.afterRemoved.apply(e.properties.bind||e.properties,[e.domNode])},Ude=()=>{gZ=!1,mZ.forEach(u4e),mZ.length=0},Bde=e=>{mZ.push(e),gZ||(gZ=!0,typeof window<"u"&&"requestIdleCallback"in window?window.requestIdleCallback(Ude,{timeout:16}):setTimeout(Ude,16))},Gde=e=>{let t=e.domNode;if(e.properties){let r=e.properties.exitAnimation;if(r)return t.style.pointerEvents="none",void r(t,()=>{t.parentNode&&(t.parentNode.removeChild(t),Bde(e))},e.properties)}t.parentNode&&(t.parentNode.removeChild(t),Bde(e))},CWe=(e,t,r)=>{if(!t)return;let i=r.eventHandlerInterceptor,n=Object.keys(t),s=n.length;for(let a=0;a<s;a++){let o=n[a],l=t[o];if(o==="className")throw new Error('Property "className" is not supported, use "class".');if(o==="class")yZ(e,l,!0);else if(o==="classes"){let c=Object.keys(l),u=c.length;for(let h=0;h<u;h++){let p=c[h];l[p]&&e.classList.add(p)}}else if(o==="styles"){let c=Object.keys(l),u=c.length;for(let h=0;h<u;h++){let p=c[h],m=l[p];m&&(d4e(m),r.styleApplyer(e,p,m))}}else if(o!=="key"&&l!=null){let c=typeof l;c==="function"?(o.lastIndexOf("on",0)===0&&(i&&(l=i(o,l,e,t)),o==="oninput"&&function(){let u=l;l=function(h){u.apply(this,[h]),h.target["oninput-value"]=h.target.value}}()),e[o]=l):r.namespace===QV?o==="href"?e.setAttributeNS(c4e,o,l):e.setAttribute(o,l):c==="string"&&o!=="value"?o==="innerHTML"?e[o]=o4e.sanitize(l):e.setAttribute(o,l):e[o]=l}}},AWe=(e,t,r)=>{if(t)for(let i of t)f4(i,e,void 0,r)},h4e=(e,t,r)=>{AWe(e,t.children,r),t.text&&(e.textContent=t.text),CWe(e,t.properties,r),t.properties&&t.properties.afterCreate&&t.properties.afterCreate.apply(t.properties.bind||t.properties,[e,r,t.vnodeSelector,t.properties,t.children])},f4=(e,t,r,i)=>{let n,s=0,a=e.vnodeSelector,o=t.ownerDocument;if(a==="")n=e.domNode=o.createTextNode(e.text),r!==void 0?t.insertBefore(n,r):t.appendChild(n);else{for(let l=0;l<=a.length;++l){let c=a.charAt(l);if(l===a.length||c==="."||c==="#"){let u=a.charAt(s-1),h=a.slice(s,l);u==="."?n.classList.add(h):u==="#"?n.id=h:(h==="svg"&&(i=yie(i,{namespace:QV})),i.namespace!==void 0?n=e.domNode=o.createElementNS(i.namespace,h):(n=e.domNode=e.domNode||o.createElement(h),h==="input"&&e.properties&&e.properties.type!==void 0&&n.setAttribute("type",e.properties.type)),r!==void 0?t.insertBefore(n,r):n.parentNode!==t&&t.appendChild(n)),s=l+1}}h4e(n,e,i)}},yZ=(e,t,r)=>{t&&t.split(" ").forEach(i=>{i&&e.classList.toggle(i,r)})},RWe=(e,t,r,i)=>{if(!r)return;let n=!1,s=Object.keys(r),a=s.length;for(let o=0;o<a;o++){let l=s[o],c=r[l],u=t[l];if(l==="class")u!==c&&(yZ(e,u,!1),yZ(e,c,!0));else if(l==="classes"){let h=e.classList,p=Object.keys(c),m=p.length;for(let g=0;g<m;g++){let b=p[g],w=!!c[b];w!==!!u[b]&&(n=!0,w?h.add(b):h.remove(b))}}else if(l==="styles"){let h=Object.keys(c),p=h.length;for(let m=0;m<p;m++){let g=h[m],b=c[g];b!==u[g]&&(n=!0,b?(d4e(b),i.styleApplyer(e,g,b)):i.styleApplyer(e,g,""))}}else if(c||typeof u!="string"||(c=""),l==="value"){let h=e[l];h!==c&&(e["oninput-value"]?h===e["oninput-value"]:c!==u)&&(e[l]=c,e["oninput-value"]=void 0),c!==u&&(n=!0)}else if(c!==u){let h=typeof c;h==="function"&&i.eventHandlerInterceptor||(i.namespace===QV?l==="href"?e.setAttributeNS(c4e,l,c):e.setAttribute(l,c):h==="string"?l==="innerHTML"?e[l]=o4e.sanitize(c):l==="role"&&c===""?e.removeAttribute(l):e.setAttribute(l,c):e[l]!==c&&(e[l]=c),n=!0)}}return n},OWe=(e,t,r,i,n)=>{if(r===i)return!1;i=i||zde;let s,a=(r=r||zde).length,o=i.length,l=0,c=0,u=!1;for(;c<o;){let h=l<a?r[l]:void 0,p=i[c];if(h!==void 0&&bie(h,p))u=tN(h,p,n)||u,l++;else{let m=SWe(r,p,l+1);if(m>=0){for(s=l;s<m;s++)Gde(r[s]),SG(r,s,e,"removed");u=tN(r[m],p,n)||u,l=m+1}else f4(p,t,l<a?r[l].domNode:void 0,n),EWe(p),SG(i,c,e,"added")}c++}if(a>l)for(s=l;s<a;s++)Gde(r[s]),SG(r,s,e,"removed");return u};tN=(e,t,r)=>{let i=e.domNode,n=!1;if(e===t)return!1;let s=!1;if(t.vnodeSelector===""){if(t.text!==e.text){let a=i.ownerDocument.createTextNode(t.text);return i.parentNode.replaceChild(a,i),t.domNode=a,n=!0,n}t.domNode=i}else t.vnodeSelector.lastIndexOf("svg",0)===0&&(r=yie(r,{namespace:QV})),e.text!==t.text&&(s=!0,t.text===void 0?i.removeChild(i.firstChild):i.textContent=t.text),t.domNode=i,s=OWe(t,i,e.children,t.children,r)||s,s=RWe(i,e.properties,t.properties,r)||s,t.properties&&t.properties.afterUpdate&&t.properties.afterUpdate.apply(t.properties.bind||t.properties,[i,r,t.vnodeSelector,t.properties,t.children]);return s&&t.properties&&t.properties.updateAnimation&&t.properties.updateAnimation(i,t.properties,e.properties),n};let W6=(e,t)=>({getLastRender:()=>e,update:r=>{if(e.vnodeSelector!==r.vnodeSelector)throw new Error("The selector for the root VNode may not be changed. (consider using dom.merge and add one extra level to the virtual DOM)");let i=e;e=r,tN(i,r,t)},domNode:e.domNode});const MWe={namespace:void 0,performanceLogger:()=>{},eventHandlerInterceptor:void 0,styleApplyer:(e,t,r)=>{t.charAt(0)==="-"?e.style.setProperty(t,r):e.style[t]=r}};let sS=e=>yie(MWe,e),dv={create:(e,t)=>(t=sS(t),f4(e,document.createElement("div"),void 0,t),W6(e,t)),append:(e,t,r)=>(r=sS(r),f4(t,e,void 0,r),W6(t,r)),insertBefore:(e,t,r)=>(r=sS(r),f4(t,e.parentNode,e,r),W6(t,r)),merge:(e,t,r)=>(r=sS(r),t.domNode=e,h4e(e,t,r),W6(t,r)),replace:(e,t,r)=>(r=sS(r),f4(t,e.parentNode,e,r),e.parentNode.removeChild(e),W6(t,r))},f4e,PWe=(e,t)=>{let r=[];for(;e&&e!==t;)r.push(e),e=e.parentNode;return r};f4e=Array.prototype.find?(e,t)=>e.find(t):(e,t)=>e.filter(t)[0];let IWe=(e,t)=>{let r=e;return t.forEach(i=>{r=r&&r.children?f4e(r.children,n=>n.domNode===i):void 0}),r},$We=(e,t,r)=>{let i=function(n){r("domEvent",n);let s=t(),a=PWe(n.currentTarget,s.domNode);a.reverse();let o,l=IWe(s.getLastRender(),a);return e.scheduleRender(),l&&(o=l.properties[`on${n.type}`].apply(l.properties.bind||this,arguments)),r("domEventProcessed",n),o};return(n,s,a,o)=>i},rN=e=>{let t,r,i=sS(e),n=i.performanceLogger,s=!0,a=!1,o=[],l=[],c=(h,p,m)=>{let g,b=()=>g;i.eventHandlerInterceptor=$We(t,b,n),g=h(p,m(),i),o.push(g),l.push(m)},u=()=>{if(r=void 0,s){s=!1,n("renderStart",void 0);for(let h=0;h<o.length;h++){let p=l[h]();n("rendered",void 0),o[h].update(p),n("patched",void 0)}n("renderDone",void 0),s=!0}};return t={renderNow:u,scheduleRender:()=>{r||a||(r=requestAnimationFrame(u))},stop:()=>{r&&(cancelAnimationFrame(r),r=void 0),a=!0},resume:()=>{a=!1,s=!0,t.scheduleRender()},append:(h,p)=>{c(dv.append,h,p)},insertBefore:(h,p)=>{c(dv.insertBefore,h,p)},merge:(h,p)=>{c(dv.merge,h,p)},replace:(h,p)=>{c(dv.replace,h,p)},detach:h=>{for(let p=0;p<l.length;p++)if(l[p]===h)return l.splice(p,1),o.splice(p,1)[0];throw new Error("renderFunction was not found")}},t},t1=class extends xe{constructor(){super(...arguments),this.items=new lt,this._watchUpdatingTracking=new tm,this._callbacks=new Map,this._projector=rN(),this._hiddenProjector=rN()}get needsRender(){return this.items.length>0}initialize(){const e=document.createElement("div");e.className="esri-overlay-surface",this._set("surface",e),this._hiddenSurface=document.createElement("div"),this._hiddenSurface.setAttribute("style","visibility: hidden;"),e.appendChild(this._hiddenSurface),this._watchUpdatingTracking.addOnCollectionChange(()=>this.items,t=>{for(const r of t.added){const i=()=>r.render();this._callbacks.set(r,i),this._projector.append(this.surface,i)}for(const r of t.removed){const i=this._projector.detach(this._callbacks.get(r));this.surface.removeChild(i.domNode),this._callbacks.delete(r)}})}addItem(e){this.items.add(e)}removeItem(e){this.items.remove(e)}destroy(){this.items.removeAll(),this._callbacks.forEach(e=>this._projector.detach(e)),this._callbacks=null,this._projector=null,this._watchUpdatingTracking.destroy()}render(){this._projector.renderNow()}computeBoundingRect(e){const t=this._hiddenSurface,r=this._hiddenProjector;let i=null;const n=()=>(i=e.render(),i);r.append(t,n),r.renderNow();const s={left:0,top:0,right:0,bottom:0};if(i&&i.domNode){const a=i.domNode.getBoundingClientRect();s.left=a.left,s.top=a.top,s.right=a.right,s.bottom=a.bottom}for(r.detach(n);t.firstChild;)t.removeChild(t.firstChild);return s}overlaps(e,t){const r=this.computeBoundingRect(e),i=this.computeBoundingRect(t);return Math.max(r.left,i.left)<=Math.min(r.right,i.right)&&Math.max(r.top,i.top)<=Math.min(r.bottom,i.bottom)}get hasVisibleItems(){return this.items.some(e=>e.visible)}renderCanvas(e){if(!this.items.some(r=>r.visible))return;const t=e.getContext("2d");t.save(),t.font=`10px ${getComputedStyle(this.surface).fontFamily}`,this.items.forEach(r=>{t.save(),r.renderCanvas(t),t.restore()}),t.restore()}};d([f({readOnly:!0})],t1.prototype,"surface",void 0),d([f({readOnly:!0})],t1.prototype,"items",void 0),d([f({readOnly:!0})],t1.prototype,"needsRender",null),d([f({readOnly:!0})],t1.prototype,"_watchUpdatingTracking",void 0),d([f({readOnly:!0,aliasOf:"_watchUpdatingTracking.updating"})],t1.prototype,"updating",void 0),t1=d([$("esri.views.overlay.ViewOverlay")],t1);const jde=t1;function vie(e,t,r,i){let n=null,s=1e3;typeof t=="number"?(s=t,i=r):(n=t!=null?t:null,s=r);let a,o=0;const l=()=>{o=0,e.apply(i,a)},c=(...u)=>{n&&n.apply(i,u),a=u,s?o||(o=setTimeout(l,s)):l()};return c.remove=()=>{o&&(clearTimeout(o),o=0)},c.forceUpdate=()=>{o&&(clearTimeout(o),l())},c.hasPendingUpdates=()=>!!o,c}function We(e,t){const r=t?{...t,source:e}:e;return f({aliasOf:r})}const LWe="randomUUID"in crypto;function _ie(){if(LWe)return crypto.randomUUID();const e=crypto.getRandomValues(new Uint16Array(8));e[3]=4095&e[3]|16384,e[4]=16383&e[4]|32768;const t=r=>e[r].toString(16);return t(0)+t(1)+"-"+t(2)+"-"+t(3)+"-"+t(4)+"-"+t(5)+t(6)+t(7)}const DWe={handleInterceptedEvent:(e,t,r,i)=>(e.scheduleRender(),t.properties[`on${i.type}`].apply(t.properties.bind||r,[i]))},FWe={namespace:void 0,performanceLogger:()=>{},eventHandlerInterceptor:void 0,styleApplyer:(e,t,r)=>{e.style[t]=r}},NWe=e=>({...FWe,...e}),kWe=(e,t)=>{const r=[];for(;e&&e!==t;)r.push(e),e=e.parentNode;return r},VWe=(e,t)=>e.find(t),qde=(e,t,r=!1)=>{let i=e;return t.forEach((n,s)=>{const a=i!=null&&i.children?VWe(i.children,o=>o.domNode===n):void 0;r&&!a&&s!==t.length-1||(i=a)}),i},zWe=e=>{let t;const r={...DWe,...e},i=NWe(r),n=i.performanceLogger;let s,a=!0,o=!1;const l=[],c=[],u=(p,m,g)=>{var v;let b;i.eventHandlerInterceptor=(x,T,E,C)=>function(A){let P;n("domEvent",A);const I=kWe(A.currentTarget,b.domNode),L=I.some(G=>{var B;return customElements.get((B=G==null?void 0:G.tagName)==null?void 0:B.toLowerCase())});if(A.eventPhase===Event.CAPTURING_PHASE||!L)I.reverse(),P=qde(b.getLastRender(),I);else{const G=A.composedPath(),B=G.slice(G.indexOf(A.currentTarget),G.indexOf(b.domNode)).filter(X=>X.getRootNode()===X.ownerDocument).reverse();P=qde(b.getLastRender(),B,!0)}let V;return P&&(V=r.handleInterceptedEvent(t,P,this,A)),n("domEventProcessed",A),V},(v=r.postProcessProjectionOptions)==null||v.call(r,i);const w=g();b=p(m,w,i),l.push(b),c.push(g),r.afterFirstVNodeRendered&&r.afterFirstVNodeRendered(b,w)};let h=()=>{if(s=void 0,a){a=!1,n("renderStart",void 0);for(let p=0;p<l.length;p++){const m=c[p]();n("rendered",void 0),l[p].update(m),n("patched",void 0)}n("renderDone",void 0),a=!0}};return r.modifyDoRenderImplementation&&(h=r.modifyDoRenderImplementation(h,l,c)),t={renderNow:h,scheduleRender:()=>{s||o||(s=requestAnimationFrame(h))},stop:()=>{s&&(cancelAnimationFrame(s),s=void 0),o=!0},resume:()=>{o=!1,a=!0,t.scheduleRender()},append:(p,m)=>{u(dv.append,p,m)},insertBefore:(p,m)=>{u(dv.insertBefore,p,m)},merge:(p,m)=>{u(dv.merge,p,m)},replace:(p,m)=>{u(dv.replace,p,m)},detach:p=>{for(let m=0;m<c.length;m++)if(c[m]===p)return c.splice(m,1),l.splice(m,1)[0];throw new Error("renderFunction was not found")}},t},Ir={allRenderFn:!1,cmpDidLoad:!0,cmpDidUnload:!1,cmpDidUpdate:!0,cmpDidRender:!0,cmpWillLoad:!0,cmpWillUpdate:!0,cmpWillRender:!0,connectedCallback:!0,disconnectedCallback:!0,element:!0,event:!0,hasRenderFn:!0,lifecycle:!0,hostListener:!0,hostListenerTargetWindow:!0,hostListenerTargetDocument:!0,hostListenerTargetBody:!0,hostListenerTargetParent:!1,hostListenerTarget:!0,member:!0,method:!0,mode:!0,observeAttribute:!0,prop:!0,propMutable:!0,reflect:!0,scoped:!0,shadowDom:!0,slot:!0,cssAnnotations:!0,state:!0,style:!0,svg:!0,updatable:!0,vdomAttribute:!0,vdomXlink:!0,vdomClass:!0,vdomFunctional:!0,vdomKey:!0,vdomListener:!0,vdomRef:!0,vdomPropOrAttr:!0,vdomRender:!0,vdomStyle:!0,vdomText:!0,watchCallback:!0,taskQueue:!0,hotModuleReplacement:!1,isDebug:!1,isDev:!1,isTesting:!1,hydrateServerSide:!1,hydrateClientSide:!1,lifecycleDOMEvents:!1,lazyLoad:!1,profile:!1,slotRelocation:!0,appendChildSlotFix:!1,cloneNodeFix:!1,hydratedAttribute:!1,hydratedClass:!0,safari10:!1,scriptDataOpts:!1,scopedSlotTextContentFix:!1,shadowDomShim:!1,slotChildNodesFix:!1,invisiblePrehydration:!0,propBoolean:!0,propNumber:!0,propString:!0,cssVarShim:!1,constructableCSS:!0,cmpShouldUpdate:!0,devTools:!1,dynamicImportShim:!1,shadowDelegatesFocus:!0,initializeNextTick:!1,asyncLoading:!1,asyncQueue:!1,transformTagName:!1,attachStyles:!0};let aS,p4e,JV,m4e=!1,iN=!1,wie=!1,Xd=!1,Hde=null,bZ=!1;const s6=typeof window<"u"?window:{};Ir.cssVarShim&&s6.CSS;const Sp=s6.document||{head:{}},e$t=s6.HTMLElement||class{},No={$flags$:0,$resourcesUrl$:"",jmp:e=>e(),raf:e=>requestAnimationFrame(e),ael:(e,t,r,i)=>e.addEventListener(t,r,i),rel:(e,t,r,i)=>e.removeEventListener(t,r,i),ce:(e,t)=>new CustomEvent(e,t)},nN=Ir.shadowDomShim&&Ir.shadowDom?(()=>(Sp.head.attachShadow+"").indexOf("[native")>-1)():!0,UWe=(()=>{let e=!1;try{Sp.addEventListener("e",null,Object.defineProperty({},"passive",{get(){e=!0}}))}catch{}return e})(),BWe=e=>Promise.resolve(e),GWe=Ir.constructableCSS?(()=>{try{return new CSSStyleSheet,typeof new CSSStyleSheet().replace=="function"}catch{}return!1})():!1,g4e=(e,t,r,i)=>{r&&r.map(([n,s,a])=>{const o=qWe(e,n),l=jWe(t,a),c=HWe(n);No.ael(o,s,l,c),(t.$rmListeners$=t.$rmListeners$||[]).push(()=>No.rel(o,s,l,c))})},jWe=(e,t)=>r=>{try{Ir.lazyLoad||e.$hostElement$[t](r)}catch(i){tO(i)}},qWe=(e,t)=>t&4?Sp:t&8?s6:t&16?Sp.body:e,HWe=e=>UWe?{passive:(e&1)!==0,capture:(e&2)!==0}:(e&2)!==0,Wde="http://www.w3.org/1999/xlink",Uw=(e,t="")=>()=>{},Xde=new WeakMap,WWe=(e,t,r)=>{let i=oN.get(e);GWe&&r?(i=i||new CSSStyleSheet,i.replace(t)):i=t,oN.set(e,i)},XWe=(e,t,r,i)=>{let n=y4e(t,r),s=oN.get(n);if(e=e.nodeType===11?e:Sp,s)if(typeof s=="string"){e=e.head||e;let a=Xde.get(e),o;a||Xde.set(e,a=new Set),a.has(n)||(o=Sp.createElement("style"),o.innerHTML=s,e.insertBefore(o,e.querySelector("link")),a&&a.add(n))}else e.adoptedStyleSheets.includes(s)||(e.adoptedStyleSheets=[...e.adoptedStyleSheets,s]);return n},YWe=e=>{const t=e.$cmpMeta$,r=e.$hostElement$,i=t.$flags$,n=Uw("attachStyles",t.$tagName$),s=XWe(nN&&r.shadowRoot?r.shadowRoot:r.getRootNode(),t,e.$modeName$);i&10&&(r["s-sc"]=s,r.classList.add(s+"-h"),i&2&&r.classList.add(s+"-s")),n()},y4e=(e,t)=>"sc-"+(t&&e.$flags$&32?e.$tagName$+"-"+t:e.$tagName$),ZWe=e=>CXe.map(t=>t(e)).find(t=>!!t),Yde={},QWe="http://www.w3.org/2000/svg",JWe="http://www.w3.org/1999/xhtml",KWe=e=>e!=null,xie=e=>(e=typeof e,e==="object"||e==="function"),b4e=(e,t,...r)=>{let i=null,n=null,s=null,a=!1,o=!1,l=[];const c=h=>{for(let p=0;p<h.length;p++)i=h[p],Array.isArray(i)?c(i):i!=null&&typeof i!="boolean"&&((a=typeof e!="function"&&!xie(i))&&(i=String(i)),a&&o?l[l.length-1].$text$+=i:l.push(a?sN(null,i):i),o=a)};if(c(r),t&&(Ir.isDev&&e==="input"&&iXe(t),Ir.vdomKey&&t.key&&(n=t.key),Ir.slotRelocation&&t.name&&(s=t.name),Ir.vdomClass)){const h=t.className||t.class;h&&(t.class=typeof h!="object"?h:Object.keys(h).filter(p=>h[p]).join(" "))}if(Ir.isDev&&l.some(v4e)&&EXe(`The <Host> must be the single root component. Make sure:
- You are NOT using hostData() and <Host> in the same component.
- <Host> is used once, and it's the single root component of the render() function.`),Ir.vdomFunctional&&typeof e=="function")return e(t===null?{}:t,l,tXe);const u=sN(e,null);return u.$attrs$=t,l.length>0&&(u.$children$=l),Ir.vdomKey&&(u.$key$=n),Ir.slotRelocation&&(u.$name$=s),u},sN=(e,t)=>{const r={$flags$:0,$tag$:e,$text$:t,$elm$:null,$children$:null};return Ir.vdomAttribute&&(r.$attrs$=null),Ir.vdomKey&&(r.$key$=null),Ir.slotRelocation&&(r.$name$=null),r},eXe={},v4e=e=>e&&e.$tag$===eXe,tXe={forEach:(e,t)=>e.map(Zde).forEach(t),map:(e,t)=>e.map(Zde).map(t).map(rXe)},Zde=e=>({vattrs:e.$attrs$,vchildren:e.$children$,vkey:e.$key$,vname:e.$name$,vtag:e.$tag$,vtext:e.$text$}),rXe=e=>{if(typeof e.vtag=="function"){const r=Object.assign({},e.vattrs);return e.vkey&&(r.key=e.vkey),e.vname&&(r.name=e.vname),b4e(e.vtag,r,...e.vchildren||[])}const t=sN(e.vtag,e.vtext);return t.$attrs$=e.vattrs,t.$children$=e.vchildren,t.$key$=e.vkey,t.$name$=e.vname,t},iXe=e=>{const t=Object.keys(e),r=t.indexOf("value");if(r===-1)return;const i=t.indexOf("type"),n=t.indexOf("min"),s=t.indexOf("max"),a=t.indexOf("step");(r<i||r<n||r<s||r<a)&&O4e('The "value" prop of <input> should be set after "min", "max", "type" and "step"')},Qde=(e,t,r,i,n,s)=>{if(r!==i){let a=tue(e,t),o=t.toLowerCase();if(t==="class"){const l=e.classList,c=Jde(r),u=Jde(i);l.remove(...c.filter(h=>h&&!u.includes(h))),l.add(...u.filter(h=>h&&!c.includes(h)))}else if(t==="style"){for(const l in r)(!i||i[l]==null)&&(l.includes("-")?e.style.removeProperty(l):e.style[l]="");for(const l in i)(!r||i[l]!==r[l])&&(l.includes("-")?e.style.setProperty(l,i[l]):e.style[l]=i[l])}else if(t!=="key")if(t==="ref")i&&i(e);else if(!e.__lookupSetter__(t)&&t[0]==="o"&&t[1]==="n")t[2]==="-"?t=t.slice(3):tue(s6,o)?t=o.slice(2):t=o[2]+t.slice(3),r&&No.rel(e,t,r,!1),i&&No.ael(e,t,i,!1);else{const l=xie(i);if((a||l&&i!==null)&&!n)try{if(e.tagName.includes("-"))e[t]=i;else{let u=i==null?"":i;t==="list"?a=!1:(r==null||e[t]!=u)&&(e[t]=u)}}catch{}let c=!1;o!==(o=o.replace(/^xlink\:?/,""))&&(t=o,c=!0),i==null||i===!1?(i!==!1||e.getAttribute(t)==="")&&(c?e.removeAttributeNS(Wde,t):e.removeAttribute(t)):(!a||s&4||n)&&!l&&(i=i===!0?"":i,c?e.setAttributeNS(Wde,t,i):e.setAttribute(t,i))}}},nXe=/\s/,Jde=e=>e?e.split(nXe):[],_4e=(e,t,r,i)=>{const n=t.$elm$.nodeType===11&&t.$elm$.host?t.$elm$.host:t.$elm$,s=e&&e.$attrs$||Yde,a=t.$attrs$||Yde;for(i in s)i in a||Qde(n,i,s[i],void 0,r,t.$flags$);for(i in a)Qde(n,i,s[i],a[i],r,t.$flags$)},aN=(e,t,r,i)=>{let n=t.$children$[r],s=0,a,o,l;if(m4e||(wie=!0,n.$tag$==="slot"&&(aS&&i.classList.add(aS+"-s"),n.$flags$|=n.$children$?2:1)),n.$text$!==null)a=n.$elm$=Sp.createTextNode(n.$text$);else if(n.$flags$&1)a=n.$elm$=Sp.createTextNode("");else{if(Xd||(Xd=n.$tag$==="svg"),a=n.$elm$=Sp.createElementNS(Xd?QWe:JWe,n.$flags$&2?"slot-fb":n.$tag$),Xd&&n.$tag$==="foreignObject"&&(Xd=!1),_4e(null,n,Xd),KWe(aS)&&a["s-si"]!==aS&&a.classList.add(a["s-si"]=aS),n.$children$)for(s=0;s<n.$children$.length;++s)o=aN(e,n,s,a),o&&a.appendChild(o);n.$tag$==="svg"?Xd=!1:a.tagName==="foreignObject"&&(Xd=!0)}return a["s-hn"]=JV,n.$flags$&3&&(a["s-sr"]=!0,a["s-cr"]=p4e,a["s-sn"]=n.$name$||"",l=e&&e.$children$&&e.$children$[r],l&&l.$tag$===n.$tag$&&e.$elm$&&_A(e.$elm$,!1)),a},_A=(e,t)=>{No.$flags$|=1;const r=e.childNodes;for(let i=r.length-1;i>=0;i--){const n=r[i];n["s-hn"]!==JV&&n["s-ol"]&&(T4e(n).insertBefore(n,Tie(n)),n["s-ol"].remove(),n["s-ol"]=void 0,wie=!0),t&&_A(n,t)}No.$flags$&=-2},w4e=(e,t,r,i,n,s)=>{let a=e["s-cr"]&&e["s-cr"].parentNode||e,o;for(a.shadowRoot&&a.tagName===JV&&(a=a.shadowRoot);n<=s;++n)i[n]&&(o=aN(null,r,n,e),o&&(i[n].$elm$=o,a.insertBefore(o,Tie(t))))},x4e=(e,t,r,i,n)=>{for(;t<=r;++t)(i=e[t])&&(n=i.$elm$,C4e(i),iN=!0,n["s-ol"]?n["s-ol"].remove():_A(n,!0),n.remove())},sXe=(e,t,r,i)=>{let n=0,s=0,a=0,o=0,l=t.length-1,c=t[0],u=t[l],h=i.length-1,p=i[0],m=i[h],g,b;for(;n<=l&&s<=h;)if(c==null)c=t[++n];else if(u==null)u=t[--l];else if(p==null)p=i[++s];else if(m==null)m=i[--h];else if(YM(c,p))oS(c,p),c=t[++n],p=i[++s];else if(YM(u,m))oS(u,m),u=t[--l],m=i[--h];else if(YM(c,m))(c.$tag$==="slot"||m.$tag$==="slot")&&_A(c.$elm$.parentNode,!1),oS(c,m),e.insertBefore(c.$elm$,u.$elm$.nextSibling),c=t[++n],m=i[--h];else if(YM(u,p))(c.$tag$==="slot"||m.$tag$==="slot")&&_A(u.$elm$.parentNode,!1),oS(u,p),e.insertBefore(u.$elm$,c.$elm$),u=t[--l],p=i[++s];else{for(a=-1,o=n;o<=l;++o)if(t[o]&&t[o].$key$!==null&&t[o].$key$===p.$key$){a=o;break}a>=0?(b=t[a],b.$tag$!==p.$tag$?g=aN(t&&t[s],r,a,e):(oS(b,p),t[a]=void 0,g=b.$elm$),p=i[++s]):(g=aN(t&&t[s],r,s,e),p=i[++s]),g&&T4e(c.$elm$).insertBefore(g,Tie(c.$elm$))}n>l?w4e(e,i[h+1]==null?null:i[h+1].$elm$,r,i,s,h):s>h&&x4e(t,n,l)},YM=(e,t)=>e.$tag$===t.$tag$?e.$tag$==="slot"?e.$name$===t.$name$:e.$key$===t.$key$:!1,Tie=e=>e&&e["s-ol"]||e,T4e=e=>(e["s-ol"]?e["s-ol"]:e).parentNode,oS=(e,t)=>{const r=t.$elm$=e.$elm$,i=e.$children$,n=t.$children$,s=t.$tag$,a=t.$text$;let o;a===null?(Xd=s==="svg"?!0:s==="foreignObject"?!1:Xd,s==="slot"||_4e(e,t,Xd),i!==null&&n!==null?sXe(r,i,t,n):n!==null?(e.$text$!==null&&(r.textContent=""),w4e(r,null,t,n,0,n.length-1)):i!==null&&x4e(i,0,i.length-1),Xd&&s==="svg"&&(Xd=!1)):(o=r["s-cr"])?o.parentNode.textContent=a:e.$text$!==a&&(r.data=a)},S4e=e=>{let t=e.childNodes,r,i,n,s,a,o;for(i=0,n=t.length;i<n;i++)if(r=t[i],r.nodeType===1){if(r["s-sr"]){for(a=r["s-sn"],r.hidden=!1,s=0;s<n;s++)if(o=t[s].nodeType,t[s]["s-hn"]!==r["s-hn"]||a!==""){if(o===1&&a===t[s].getAttribute("slot")){r.hidden=!0;break}}else if(o===1||o===3&&t[s].textContent.trim()!==""){r.hidden=!0;break}}S4e(r)}},rp=[],E4e=e=>{let t,r,i,n,s,a,o=0,l=e.childNodes,c=l.length;for(;o<c;o++){if(t=l[o],t["s-sr"]&&(r=t["s-cr"])&&r.parentNode)for(i=r.parentNode.childNodes,n=t["s-sn"],a=i.length-1;a>=0;a--)r=i[a],!r["s-cn"]&&!r["s-nr"]&&r["s-hn"]!==t["s-hn"]&&(Kde(r,n)?(s=rp.find(u=>u.$nodeToRelocate$===r),iN=!0,r["s-sn"]=r["s-sn"]||n,s?s.$slotRefNode$=t:rp.push({$slotRefNode$:t,$nodeToRelocate$:r}),r["s-sr"]&&rp.map(u=>{Kde(u.$nodeToRelocate$,r["s-sn"])&&(s=rp.find(h=>h.$nodeToRelocate$===r),s&&!u.$slotRefNode$&&(u.$slotRefNode$=s.$slotRefNode$))})):rp.some(u=>u.$nodeToRelocate$===r)||rp.push({$nodeToRelocate$:r}));t.nodeType===1&&E4e(t)}},Kde=(e,t)=>e.nodeType===1?e.getAttribute("slot")===null&&t===""||e.getAttribute("slot")===t:e["s-sn"]===t?!0:t==="",C4e=e=>{e.$attrs$&&e.$attrs$.ref&&e.$attrs$.ref(null),e.$children$&&e.$children$.map(C4e)},aXe=(e,t)=>{const r=e.$hostElement$,i=e.$cmpMeta$,n=e.$vnode$||sN(null,null),s=v4e(t)?t:b4e(null,null,t);JV=r.tagName,i.$attrsToReflect$&&(s.$attrs$=s.$attrs$||{},i.$attrsToReflect$.map(([a,o])=>s.$attrs$[o]=r[a])),s.$tag$=null,s.$flags$|=4,e.$vnode$=s,s.$elm$=n.$elm$=r.shadowRoot||r,aS=r["s-sc"],p4e=r["s-cr"],m4e=nN&&(i.$flags$&1)!==0,iN=!1,oS(n,s);{if(No.$flags$|=1,wie){E4e(s.$elm$);let a,o,l,c,u,h,p=0;for(;p<rp.length;p++)a=rp[p],o=a.$nodeToRelocate$,o["s-ol"]||(l=Sp.createTextNode(""),l["s-nr"]=o,o.parentNode.insertBefore(o["s-ol"]=l,o));for(p=0;p<rp.length;p++)if(a=rp[p],o=a.$nodeToRelocate$,a.$slotRefNode$){for(c=a.$slotRefNode$.parentNode,u=a.$slotRefNode$.nextSibling,l=o["s-ol"];l=l.previousSibling;)if(h=l["s-nr"],h&&h["s-sn"]===o["s-sn"]&&c===h.parentNode&&(h=h.nextSibling,!h||!h["s-nr"])){u=h;break}(!u&&c!==o.parentNode||o.nextSibling!==u)&&o!==u&&(!o["s-hn"]&&o["s-ol"]&&(o["s-hn"]=o["s-ol"].parentNode.nodeName),c.insertBefore(o,u))}else o.nodeType===1&&(o.hidden=!0)}iN&&S4e(s.$elm$),No.$flags$&=-2,rp.length=0}},oXe=e=>Ir.lazyLoad?a6(e).$hostElement$:e,t$t=(e,t,r)=>{const i=oXe(e);return{emit:n=>(Ir.isDev&&!i.isConnected&&O4e(`The "${t}" event was emitted, but the dispatcher node is no longer connected to the dom.`),lXe(i,t,{bubbles:!!(r&4),composed:!!(r&2),cancelable:!!(r&1),detail:n}))}},lXe=(e,t,r)=>{const i=No.ce(t,r);return e.dispatchEvent(i),i},cXe=(e,t)=>{},Sie=(e,t)=>(e.$flags$|=16,cXe(e,e.$ancestorComponent$),OXe(()=>dXe(e,t))),dXe=(e,t)=>{const r=e.$hostElement$,i=Uw("scheduleUpdate",e.$cmpMeta$.$tagName$),n=r;let s;return t?s=Q4(n,"componentWillLoad"):s=Q4(n,"componentWillUpdate"),s=eue(s,()=>Q4(n,"componentWillRender")),i(),eue(s,()=>uXe(e,n,t))},uXe=async(e,t,r)=>{const i=e.$hostElement$,n=Uw("update",e.$cmpMeta$.$tagName$);i["s-rc"],r&&YWe(e);const s=Uw("render",e.$cmpMeta$.$tagName$);hXe(e,t,i),s(),n(),fXe(e)},hXe=(e,t,r)=>{try{Hde=t,t=t.render&&t.render(),e.$flags$&=-17,e.$flags$|=2,(Ir.hasRenderFn||Ir.reflect)&&(Ir.vdomRender||Ir.reflect)&&(Ir.hydrateServerSide||aXe(e,t))}catch(o){tO(o,e.$hostElement$)}return Hde=null,null},fXe=e=>{const t=e.$cmpMeta$.$tagName$,r=e.$hostElement$,i=Uw("postUpdate",t),n=r;e.$ancestorComponent$,Q4(n,"componentDidRender"),e.$flags$&64?(Q4(n,"componentDidUpdate"),i()):(e.$flags$|=64,Q4(n,"componentDidLoad"),i())},r$t=e=>{if(Ir.updatable){const t=a6(e),r=t.$hostElement$.isConnected;return r&&(t.$flags$&18)===2&&Sie(t,!1),r}return!1},Q4=(e,t,r)=>{if(e&&e[t])try{return e[t](r)}catch(i){tO(i)}},eue=(e,t)=>e&&e.then?e.then(t):t(),pXe=(e,t)=>e!=null&&!xie(e)?t&4?e==="false"?!1:e===""||!!e:t&2?parseFloat(e):t&1?String(e):e:e,mXe=(e,t)=>a6(e).$instanceValues$.get(t),gXe=(e,t,r,i)=>{const n=a6(e),s=e,a=n.$instanceValues$.get(t),o=n.$flags$,l=s;r=pXe(r,i.$members$[t][0]);const c=Number.isNaN(a)&&Number.isNaN(r);if(r!==a&&!c){n.$instanceValues$.set(t,r);{if(i.$watchers$&&o&128){const h=i.$watchers$[t];h&&h.map(p=>{try{l[p](r,a,t)}catch(m){tO(m,s)}})}if((o&18)===2){if(l.componentShouldUpdate&&l.componentShouldUpdate(r,a,t)===!1)return;Sie(n,!1)}}}},yXe=(e,t,r)=>{if(t.$members$){e.watchers&&(t.$watchers$=e.watchers);const i=Object.entries(t.$members$),n=e.prototype;i.map(([s,[a]])=>{(a&31||a&32)&&Object.defineProperty(n,s,{get(){return mXe(this,s)},set(o){gXe(this,s,o,t)},configurable:!0,enumerable:!0})});{const s=new Map;n.attributeChangedCallback=function(a,o,l){No.jmp(()=>{const c=s.get(a);if(this.hasOwnProperty(c))l=this[c],delete this[c];else if(n.hasOwnProperty(c)&&typeof this[c]=="number"&&this[c]==l)return;this[c]=l===null&&typeof this[c]=="boolean"?!1:l})},e.observedAttributes=i.filter(([a,o])=>o[0]&15).map(([a,o])=>{const l=o[1]||a;return s.set(l,a),o[0]&512&&t.$attrsToReflect$.push([a,l]),l})}}return e},bXe=async(e,t,r,i,n)=>{if((t.$flags$&32)===0&&(n=e.constructor,t.$flags$|=32,customElements.whenDefined(r.$tagName$).then(()=>t.$flags$|=128),n.style)){let a=n.style;typeof a!="string"&&(a=a[t.$modeName$=ZWe(e)]);const o=y4e(r,t.$modeName$);if(!oN.has(o)){const l=Uw("registerStyles",r.$tagName$);WWe(o,a,!!(r.$flags$&1)),l()}}t.$ancestorComponent$,(()=>Sie(t,!0))()},vXe=e=>{},_Xe=e=>{if((No.$flags$&1)===0){const t=a6(e),r=t.$cmpMeta$,i=Uw("connectedCallback",r.$tagName$);t.$flags$&1?(g4e(e,t,r.$listeners$),vXe(t.$lazyInstance$)):(t.$flags$|=1,r.$flags$&12&&wXe(e),r.$members$&&Object.entries(r.$members$).map(([n,[s]])=>{if(s&31&&e.hasOwnProperty(n)){const a=e[n];delete e[n],e[n]=a}}),bXe(e,t,r)),i()}},wXe=e=>{const t=e["s-cr"]=Sp.createComment("");t["s-cn"]=!0,e.insertBefore(t,e.firstChild)},xXe=e=>{if((No.$flags$&1)===0){const t=a6(e);t.$rmListeners$&&(t.$rmListeners$.map(r=>r()),t.$rmListeners$=void 0)}},i$t=(e,t)=>{const r={$flags$:t[0],$tagName$:t[1]};Ir.member&&(r.$members$=t[2]),Ir.hostListener&&(r.$listeners$=t[3]),Ir.watchCallback&&(r.$watchers$=e.$watchers$),Ir.reflect&&(r.$attrsToReflect$=[]),Ir.shadowDom&&!nN&&r.$flags$&1&&(r.$flags$|=8);const i=e.prototype.connectedCallback,n=e.prototype.disconnectedCallback;return Object.assign(e.prototype,{__registerHost(){SXe(this,r)},connectedCallback(){_Xe(this),Ir.connectedCallback&&i&&i.call(this)},disconnectedCallback(){xXe(this),Ir.disconnectedCallback&&n&&n.call(this)},__attachShadow(){nN?Ir.shadowDelegatesFocus?this.attachShadow({mode:"open",delegatesFocus:!!(r.$flags$&16)}):this.attachShadow({mode:"open"}):this.shadowRoot=this}}),e.is=r.$tagName$,yXe(e,r)},n$t=e=>{const t=new URL(e,No.$resourcesUrl$);return t.origin!==s6.location.origin?t.href:t.pathname},TXe=e=>No.$resourcesUrl$=e,A4e=new WeakMap,a6=e=>A4e.get(e),SXe=(e,t)=>{const r={$flags$:0,$hostElement$:e,$cmpMeta$:t,$instanceValues$:new Map};return Ir.isDev&&(r.$renderCount$=0),Ir.method&&Ir.lazyLoad&&(r.$onInstancePromise$=new Promise(i=>r.$onInstanceResolve$=i)),Ir.asyncLoading&&(r.$onReadyPromise$=new Promise(i=>r.$onReadyResolve$=i),e["s-p"]=[],e["s-rc"]=[]),g4e(e,r,t.$listeners$),A4e.set(e,r)},tue=(e,t)=>t in e,tO=(e,t)=>(0,console.error)(e,t),R4e=Ir.isTesting?["STENCIL:"]:["%cstencil","color: white;background:#4c47ff;font-weight: bold; font-size:10px; padding:2px 6px; border-radius: 5px"],EXe=(...e)=>console.error(...R4e,...e),O4e=(...e)=>console.warn(...R4e,...e),oN=new Map,CXe=[],rue=[],M4e=[],AXe=(e,t)=>r=>{e.push(r),bZ||(bZ=!0,t&&No.$flags$&4?RXe(vZ):No.raf(vZ))},iue=e=>{for(let t=0;t<e.length;t++)try{e[t](performance.now())}catch(r){tO(r)}e.length=0},vZ=()=>{iue(rue),iue(M4e),(bZ=rue.length>0)&&No.raf(vZ)},RXe=e=>BWe().then(e),OXe=AXe(M4e,!0),s$t={isDev:!!Ir.isDev,isBrowser:!0,isServer:!1,isTesting:!!Ir.isTesting};let P4e;function MXe(){TXe(Fh(xr(P4e)))}P4e="components/assets";const I4e=Symbol("widget"),PXe=[],IXe={},lN=new WeakMap;function $4e(e,t){let r=t.children;if(r&&r.length)for(let n=0;n<r.length;++n)r[n]=$4e(e,r[n]);else r=PXe;const i=t.vnodeSelector;if(Eie(i)){const n=t.properties||IXe,s=n.key||i;return{vnodeSelector:"div",properties:{key:s,afterCreate:$Xe,afterUpdate:LXe,afterRemoved:L4e,parentWidget:e,widgetConstructor:i,widgetProperties:{...n,key:s,children:r}},children:void 0,text:void 0,domNode:null}}return t}function $Xe(e,t,r,{parentWidget:i,widgetConstructor:n,widgetProperties:s}){var o;const a=new n(s);a.container=e,lN.set(e,a),(o=a.afterCreate)==null||o.call(a,a,e),i._internalHandles.add(Hh(()=>L4e(e)))}function LXe(e,t,r,{widgetProperties:i}){var s;const n=lN.get(e);n&&(n.set(i),(s=n.afterUpdate)==null||s.call(n,n,e))}function L4e(e){const t=lN.get(e);t&&(t.destroy(),lN.delete(e))}function Eie(e){return typeof e=="function"&&e[I4e]}const nue=new Set;function DXe(e){nue.add(e),e.finally(()=>nue.delete(e))}const D4e="esri.widgets.Widget",FXe=fe.getLogger(D4e);let NXe=0;const kXe={widgetIcon:"esri-icon-checkbox-unchecked"};function F4e(e,t){for(const r in t)e[r]!=null&&(typeof e[r]=="object"&&typeof t[r]=="object"?F4e(e[r],t[r]):e[r]=t[r]);return e}const VXe=zWe({postProcessProjectionOptions(e){const t=e.eventHandlerInterceptor,r=/capture$/i;e.eventHandlerInterceptor=(i,n,s,a)=>{const o=t(i,n,s,a),l=r.test(i);if(!((i=i.replace(r,"")).toLowerCase()in s)||l){const c=i[2].toLowerCase()+i.slice(3),u=m=>o.call(s,m);s.addEventListener(c,u,l);const h=()=>s.removeEventListener(c,u,l),p=a.afterRemoved;a.afterRemoved=m=>{p==null||p(m),h()}}return o}},handleInterceptedEvent(e,t,r,i){const{eventPhase:n,type:s}=i,a=n===Event.CAPTURING_PHASE;let o=`on${s}${a?"capture":""}`;const l=t.properties;(o in l||(o=`on${s[0].toUpperCase()}${s.slice(1)}${a?"Capture":""}`,o in l))&&(s4e(),e.scheduleRender(),l[o].call(l.bind||r,i))}});let EG=!1,Hs=class extends XR(mn.EventedAccessor){constructor(e,t){super(e,t),this._attached=!1,this._internalHandles=new Ft,this._projector=VXe,this._readyForTrueRender=!1,this.domNode=null,this.iconClass=kXe.widgetIcon,this.label=this.declaredClass.split(".").pop(),this.visible=!0,this.key=this,this._loadLocale=qR(async()=>{if(this._messageBundleProps&&this._messageBundleProps.length){const s=await dn(this._messageBundleProps.map(async({bundlePath:a,propertyName:o})=>{let l=await ere(a);this.uiStrings&&Object.keys(this.uiStrings)&&(l=F4e(te(l),this.uiStrings)),this[o]=l}));for(const a of s)a.error&&FXe.error("widget-intl:locale-error",this.declaredClass,a.error)}await this.loadLocale()}),MXe();const r="esri-widget-uid-"+_ie(),i=this.render.bind(this);this._trackingTarget=new lV(()=>this.scheduleRender());const n=()=>{var u;if(!this._readyForTrueRender||this.destroyed)return null;if(!this.visible)return{vnodeSelector:"div",properties:{key:r,class:"",styles:{display:"none"}},domNode:void 0,children:void 0,text:void 0};const s=i();let{properties:a}=s;a||(s.properties=a={});let{key:o,styles:l}=a;o||(a.key=r),l||(a.styles=l={}),l.display||(l.display="");let c=0;return(u=s.children)==null||u.forEach(h=>{if(Eie(h.vnodeSelector))return;let{properties:p}=h;p||(h.properties=p={}),p.key||(p.key=`${this.id}--${c++}`)}),$4e(this,s)};this.render=()=>{if(EG)return n();let s=fWe(this);if(s)return s;this._trackingTarget.clear(),EG=!0;try{s=Cy(this._trackingTarget,n)}catch(a){throw console.error(a),a}finally{EG=!1}return pWe(this,s),s},this.addResolvingPromise(this._resourcesFetch=this.beforeFirstRender().then(()=>{this._readyForTrueRender=!0,this._postInitialize()})),DXe(this._resourcesFetch)}normalizeCtorArgs(e,t){const r={...e};return t&&(r.container=t),r}postInitialize(){}beforeFirstRender(){return Promise.all([this.loadDependencies(),this._loadLocale()]).then(()=>{}).catch(ZW)}async loadDependencies(){}async loadLocale(){}destroy(){this.destroyed||(ct(this._trackingTarget),ct(this.viewModel),this._detach(this.container),this._set("container",null),this._internalHandles.destroy(),this._emitter.clear(),this.render=()=>null,this._projector=null,TG(this))}set container(e){this._get("container")||this._set("container",e)}castContainer(e){return $V(e)}get id(){return this._get("id")||this.get("container.id")||Date.now().toString(16)+"-widget-"+NXe++}set id(e){e&&this._set("id",e)}get renderable(){return this._resourcesFetch}get test(){return{projector:this._projector}}render(){throw new Error("not implemented")}scheduleRender(){this.destroyed||(TG(this),this._projector.scheduleRender())}classes(...e){return h4.apply(this,e)}renderNow(){TG(this),this._projector.renderNow()}_postInitialize(){var t;if(this.destroyed)return;this.scheduleRender(),(t=this._delegatedEventNames)!=null&&t.length&&this._internalHandles.add(re(()=>this.viewModel,(r,i)=>{i&&this._internalHandles.remove("delegated-events"),r&&aV(r)&&this._internalHandles.add(this._delegatedEventNames.map(n=>jR(r,n,s=>{this.emit(n,s)})),"delegated-events")},Ot)),this.postInitialize();const e=async()=>{await this._loadLocale().catch(ZW),this.scheduleRender()};this._internalHandles.add([twe(e),re(()=>this.uiStrings,e),Fa(()=>this.container,r=>{this.destroyed||this._attach(r)},{initial:!0,once:!0})])}_attach(e){e&&(this._projector.merge(e,this.render),this._attached=!0)}_detach(e){e&&this._attached&&(this._projector.detach(this.render),e.parentNode&&e.parentNode.removeChild(e),this._attached=!1)}};Hs[I4e]=!0,d([f()],Hs.prototype,"_readyForTrueRender",void 0),d([f({value:null})],Hs.prototype,"container",null),d([Xt("container")],Hs.prototype,"castContainer",null),d([f({aliasOf:"container"})],Hs.prototype,"domNode",void 0),d([f()],Hs.prototype,"iconClass",void 0),d([f()],Hs.prototype,"id",null),d([f()],Hs.prototype,"label",void 0),d([f()],Hs.prototype,"renderable",null),d([f()],Hs.prototype,"uiStrings",void 0),d([f()],Hs.prototype,"viewModel",void 0),d([f()],Hs.prototype,"visible",void 0),d([f()],Hs.prototype,"key",void 0),d([f()],Hs.prototype,"children",void 0),d([f()],Hs.prototype,"afterCreate",void 0),d([f()],Hs.prototype,"afterUpdate",void 0),d([f()],Hs.prototype,"afterRemoved",void 0),Hs=d([$(D4e)],Hs);const Bs=Hs;function zXe(e,t,r){return e.units[t][r]}function KV(e,t,r,i=2,n="abbr"){return`${Xh(t,{minimumFractionDigits:i,maximumFractionDigits:i})} ${zXe(e,r,n)}`}function a$t(e,t,r,i=2,n="abbr"){const s=VGe(t,r);return KV(e,ps(t,r,s),s,i,n)}function o$t(e,t,r,i=2,n="abbr"){const s=zGe(t,r);return KV(e,ps(t,r,s),s,i,n)}function l$t(e,t,r,i=2,n="abbr"){const s=UGe(t,r);return KV(e,ps(t,r,s),s,i,n)}function c$t(e,t,r,i=2,n="abbr"){const s=BGe(t,r);return KV(e,ps(t,r,s),s,i,n)}const sue=["B","kB","MB","GB","TB"];function UXe(e,t){let r=t===0?0:Math.floor(Math.log(t)/Math.log(e9.KILOBYTES));r=Le(r,0,sue.length-1);const i=Xh(t/e9.KILOBYTES**r,{maximumFractionDigits:2});return lm(e.units.bytes[sue[r]],{fileSize:i})}function BXe(e){const{exifInfo:t,exifName:r,tagName:i}=e;if(!t||!r||!i)return null;const n=t.find(s=>s.name===r);return n?GXe({tagName:i,tags:n.tags}):null}function GXe(e){const{tagName:t,tags:r}=e;if(!r||!t)return null;const i=r.find(n=>n.name===t);return i&&i.value||null}var _Z;const jXe={1:{id:1,rotation:0,mirrored:!1},2:{id:2,rotation:0,mirrored:!0},3:{id:3,rotation:180,mirrored:!1},4:{id:4,rotation:180,mirrored:!0},5:{id:5,rotation:-90,mirrored:!0},6:{id:6,rotation:90,mirrored:!1},7:{id:7,rotation:90,mirrored:!0},8:{id:8,rotation:-90,mirrored:!1}};let Mc=_Z=class extends ge{constructor(e){super(e),this.contentType=null,this.exifInfo=null,this.id=null,this.globalId=null,this.keywords=null,this.name=null,this.parentGlobalId=null,this.parentObjectId=null,this.size=null,this.url=null}get orientationInfo(){const{exifInfo:e}=this,t=BXe({exifName:"Exif IFD0",tagName:"Orientation",exifInfo:e});return jXe[t]||null}clone(){return new _Z({contentType:this.contentType,exifInfo:this.exifInfo,id:this.id,globalId:this.globalId,keywords:this.keywords,name:this.name,parentGlobalId:this.parentGlobalId,parentObjectId:this.parentObjectId,size:this.size,url:this.url})}};d([f({type:String})],Mc.prototype,"contentType",void 0),d([f()],Mc.prototype,"exifInfo",void 0),d([f({readOnly:!0})],Mc.prototype,"orientationInfo",null),d([f({type:$i})],Mc.prototype,"id",void 0),d([f({type:String})],Mc.prototype,"globalId",void 0),d([f({type:String})],Mc.prototype,"keywords",void 0),d([f({type:String})],Mc.prototype,"name",void 0),d([f({json:{read:!1}})],Mc.prototype,"parentGlobalId",void 0),d([f({json:{read:!1}})],Mc.prototype,"parentObjectId",void 0),d([f({type:$i})],Mc.prototype,"size",void 0),d([f({json:{read:!1}})],Mc.prototype,"url",void 0),Mc=_Z=d([$("esri.layers.support.AttachmentInfo")],Mc);const N4e=Mc;var wZ;let Ha=wZ=class extends ge{constructor(e){super(e),this.attachmentTypes=null,this.attachmentsWhere=null,this.cacheHint=void 0,this.keywords=null,this.globalIds=null,this.name=null,this.num=null,this.objectIds=null,this.returnMetadata=!1,this.size=null,this.start=null,this.where=null}writeStart(e,t){t.resultOffset=this.start,t.resultRecordCount=this.num||10}clone(){return new wZ(te({attachmentTypes:this.attachmentTypes,attachmentsWhere:this.attachmentsWhere,cacheHint:this.cacheHint,keywords:this.keywords,where:this.where,globalIds:this.globalIds,name:this.name,num:this.num,objectIds:this.objectIds,returnMetadata:this.returnMetadata,size:this.size,start:this.start}))}};d([f({type:[String],json:{write:!0}})],Ha.prototype,"attachmentTypes",void 0),d([f({type:String,json:{read:{source:"attachmentsDefinitionExpression"},write:{target:"attachmentsDefinitionExpression"}}})],Ha.prototype,"attachmentsWhere",void 0),d([f({type:Boolean,json:{write:!0}})],Ha.prototype,"cacheHint",void 0),d([f({type:[String],json:{write:!0}})],Ha.prototype,"keywords",void 0),d([f({type:[Number],json:{write:!0}})],Ha.prototype,"globalIds",void 0),d([f({json:{write:!0}})],Ha.prototype,"name",void 0),d([f({type:Number,json:{read:{source:"resultRecordCount"}}})],Ha.prototype,"num",void 0),d([f({type:[Number],json:{write:!0}})],Ha.prototype,"objectIds",void 0),d([f({type:Boolean,json:{default:!1,write:!0}})],Ha.prototype,"returnMetadata",void 0),d([f({type:[Number],json:{write:!0}})],Ha.prototype,"size",void 0),d([f({type:Number,json:{read:{source:"resultOffset"}}})],Ha.prototype,"start",void 0),d([Xe("start"),Xe("num")],Ha.prototype,"writeStart",null),d([f({type:String,json:{read:{source:"definitionExpression"},write:{target:"definitionExpression"}}})],Ha.prototype,"where",void 0),Ha=wZ=d([$("esri.rest.support.AttachmentQuery")],Ha),Ha.from=rs(Ha);const cN=Ha,qXe="esri.widgets.Feature.support.featureUtils",aue=fe.getLogger(qXe),HXe=/href=(""|'')/gi,WXe=/(\{([^\{\r\n]+)\})/g,XXe=/\'/g,k4e=/^\s*expression\//i,YXe=/(\n)/gi,ZXe=/[\u00A0-\u9999<>\&]/gim,QXe=/href\s*=\s*(?:\"([^\"]+)\"|\'([^\']+)\')/gi,JXe=/^(?:mailto:|tel:)/,V4e="relationships/",xZ=QR("short-date-short-time");function z4e(e){if(!R(e))return e.get("sourceLayer")||e.get("layer")}async function dN(e,t){return typeof e=="function"?e.call(null,t):e}function U4e(e=""){if(e)return!JXe.test(e.trim().toLowerCase())}function B4e(e){return!!e&&k4e.test(e)}function KXe(e,t){if(!B4e(t)||!e)return null;const r=t.replace(k4e,"").toLowerCase();let i;return e.some(n=>n.name.toLowerCase()===r&&(i=n,!0)),i}function G4e(e,t){const r=KXe(t,e==null?void 0:e.fieldName);return r?r.title||null:e?e.label||e.fieldName:null}function eYe(e,t){const r=t.get(e.toLowerCase());return`{${r&&r.fieldName||e}}`}function tYe(e){return e.replace(HXe,"")}function uN(e,t){const r=Cie(t,e);return r?r.name:e}function rYe(e,t){return e&&e.map(r=>uN(r,t))}function Cie(e,t){return e&&typeof e.getField=="function"?e.getField(t):null}function j4e(e){return`${e}`.trim()}function B3({attributes:e,globalAttributes:t,layer:r,text:i,expressionAttributes:n,fieldInfoMap:s}){return i?TZ({formattedAttributes:t,template:aYe(i,{...t,...n,...e},r),fieldInfoMap:s}):""}function TZ({formattedAttributes:e,template:t,fieldInfoMap:r}){return j4e(tYe(lm(lm(t,i=>eYe(i,r)),e)))}function iYe(e,t,r=!1){const i=t[e];if(typeof i=="string"){const n="%27",s=(r?encodeURIComponent(i):i).replace(XXe,n);t[e]=s}}function nYe(e,t=!1){const r={...e};return Object.keys(r).forEach(i=>iYe(i,r,t)),r}function sYe(e,t,r){const i=(t=j4e(t))&&t[0]!=="{";return lm(e,nYe(r,i))}function SZ(e,t){return e.replace(WXe,(r,i,n)=>{const s=Cie(t,n);return s?`{${s.name}}`:i})}function aYe(e,t,r){const i=SZ(e,r);return i&&i.replace(QXe,(n,s,a)=>sYe(n,s||a,t))}function oYe(e,t){if(typeof e=="string"&&t&&t.dateFormat==null&&(t.places!=null||t.digitSeparator!=null)){const r=Number(e);if(!isNaN(r))return r}return e}function lYe(e){return(e==null?void 0:e.type)==="feature"}function oue(e){return!!(e!=null&&e.layer)}function cYe(e){return(e==null?void 0:e.type)==="map-image"}function dYe(e,t){var c;const r=t.fieldInfos,i=t.fieldName,n=(c=q4e(r,i))==null?void 0:c.clone(),s=t.preventPlacesFormatting,a=t.layer,o=Cie(a,i);if(n&&(o==null?void 0:o.type)==="date"){const u=n.format||new c4;u.dateFormat=u.dateFormat||"short-date-short-time",u.dateTimeFormatOptions=!oue(a)&&lYe(a)&&a.datesInUnknownTimezone||oue(a)&&cYe(a.layer)&&a.layer.datesInUnknownTimezone?{timeZone:"UTC"}:null,n.format=u}const l=n&&n.format;return typeof e=="string"&&exe(i)&&l?l.formatRasterPixelValue(e):typeof(e=oYe(e,l))=="string"||e==null||l==null?rO(e):s?Xh(e,{...nxe(l),minimumFractionDigits:0,maximumFractionDigits:20}):l.format(e)}function q4e(e,t){if(!e||!e.length||!t)return;const r=t.toLowerCase();let i;return e.some(n=>!(!n.fieldName||n.fieldName.toLowerCase()!==r)&&(i=n,!0)),i}function uYe({fieldName:e,graphic:t,layer:r}){if(Jg(e)||!r||typeof r.getFeatureType!="function")return null;const{typeIdField:i}=r;if(!i||e!==i)return null;const n=r.getFeatureType(t);return n?n.name:null}function hYe({fieldName:e,value:t,graphic:r,layer:i}){if(Jg(e)||!i||typeof i.getFieldDomain!="function")return null;const n=i.getFieldDomain(e,{feature:r});return n&&n.type==="coded-value"?n.getName(t):null}function fYe(e,t){const{creatorField:r,creationDateField:i,editorField:n,editDateField:s}=e;if(!t)return;const a=t[s];if(typeof a=="number"){const l=t[n];return{type:"edit",date:Ip(a,xZ),user:l}}const o=t[i];if(typeof o=="number"){const l=t[r];return{type:"create",date:Ip(o,xZ),user:l}}return null}function pYe(e,t){const r=new Map;return e&&e.forEach(i=>{const n=uN(i.fieldName,t);i.fieldName=n,r.set(n.toLowerCase(),i)}),r}function lue(e){const t=[];if(!e)return t;const{fieldInfos:r,content:i}=e;return r&&t.push(...r),i&&Array.isArray(i)&&i.forEach(n=>{if(n.type==="fields"){const s=n&&n.fieldInfos;s&&t.push(...s)}}),t}function Aie(e){return e.replace(ZXe,t=>`&#${t.charCodeAt(0)};`)}function rO(e){return typeof e=="string"?e.replace(YXe,'<br class="esri-text-new-line" />'):e}function H4e(e){const{value:t,fieldName:r,fieldInfos:i,fieldInfoMap:n,layer:s,graphic:a}=e;if(t==null)return"";const o=hYe({fieldName:r,value:t,graphic:a,layer:s});if(o)return o;const l=uYe({fieldName:r,graphic:a,layer:s});if(l)return l;if(n.get(r.toLowerCase()))return dYe(t,{fieldInfos:i||Array.from(n.values()),fieldName:r,layer:s});const c=s&&s.fieldsIndex;return c&&c.isDateField(r)?Ip(t,xZ):rO(t)}function CG({fieldInfos:e,attributes:t,layer:r,graphic:i,fieldInfoMap:n,relatedInfos:s}){const a={};return s==null||s.forEach(o=>vYe({attributes:a,relatedInfo:o,fieldInfoMap:n,fieldInfos:e,layer:r})),Object.keys(t).forEach(o=>{const l=t[o];a[o]=H4e({fieldName:o,fieldInfos:e,fieldInfoMap:n,layer:r,value:l,graphic:i})}),a}async function mYe(e,t){var u,h;const{layer:r,graphic:i,outFields:n,objectIds:s,returnGeometry:a,spatialReference:o}=e,l=s[0];if(typeof l!="number"&&typeof l!="string"){const p="Could not query required fields for the specified feature. The feature's ID is invalid.",m={layer:r,graphic:i,objectId:l,requiredFields:n};return aue.warn(p,m),null}if(!((h=(u=r.capabilities)==null?void 0:u.operations)!=null&&h.supportsQuery)){const p="The specified layer cannot be queried. The following fields will not be available.",m={layer:r,graphic:i,requiredFields:n,returnGeometry:a};return aue.warn(p,m),null}const c=r.createQuery();return c.objectIds=s,c.outFields=n!=null&&n.length?n:[r.objectIdField],c.returnGeometry=!!a,c.returnZ=!!a,c.returnM=!!a,c.outSpatialReference=o,(await r.queryFeatures(c,t)).features[0]}async function gYe(e){var i;if(!((i=e.expressionInfos)!=null&&i.length))return!1;const t=await Wh(),{arcadeUtils:{hasGeometryFunctions:r}}=t;return r(e)}async function yYe({graphic:e,popupTemplate:t,layer:r,spatialReference:i},n){if(!r||!t||(typeof r.load=="function"&&await r.load(n),!e.attributes))return;const s=e.attributes[r.objectIdField];if(s==null)return;const a=[s],o=await t.getRequiredFields(r.fieldsIndex),l=FUe(o,e),c=l?[]:o,u=t.returnGeometry||await gYe(t);if(l&&!u)return;const h=await mYe({layer:r,graphic:e,outFields:c,objectIds:a,returnGeometry:u,spatialReference:i},n);h&&(h.geometry&&(e.geometry=h.geometry),h.attributes&&(e.attributes={...e.attributes,...h.attributes}))}function Jg(e=""){return!!e&&e.includes(V4e)}function bYe(e){return e?`${V4e}${e.layerId}/${e.fieldName}`:""}function cue({attributes:e,graphic:t,relatedInfo:r,fieldInfos:i,fieldInfoMap:n,layer:s}){e&&t&&r&&Object.keys(t.attributes).forEach(a=>{const o=bYe({layerId:r.relation.id.toString(),fieldName:a}),l=t.attributes[a];e[o]=H4e({fieldName:o,fieldInfos:i,fieldInfoMap:n,layer:s,value:l,graphic:t})})}function vYe({attributes:e,relatedInfo:t,fieldInfoMap:r,fieldInfos:i,layer:n}){e&&t&&(t.relatedFeatures&&t.relatedFeatures&&t.relatedFeatures.forEach(s=>cue({attributes:e,graphic:s,relatedInfo:t,fieldInfoMap:r,fieldInfos:i,layer:n})),t.relatedStatsFeatures&&t.relatedStatsFeatures&&t.relatedStatsFeatures.forEach(s=>cue({attributes:e,graphic:s,relatedInfo:t,fieldInfoMap:r,fieldInfos:i,layer:n})))}const due=e=>{if(!e)return!1;const t=e.toUpperCase();return t.includes("CURRENT_TIMESTAMP")||t.includes("CURRENT_DATE")||t.includes("CURRENT_TIME")},W4e=({layer:e,method:t,query:r,definitionExpression:i})=>{var a,o;if(!((o=(a=e.capabilities)==null?void 0:a.query)!=null&&o.supportsCacheHint)||t==="attachments")return;const n=_(r.where)&&r.where,s=_(r.geometry)&&r.geometry;due(i)||due(n)||(s==null?void 0:s.type)==="extent"||r.resultType==="tile"||(r.cacheHint=!0)},_Ye=({query:e,layer:t,method:r})=>{W4e({layer:t,method:r,query:e,definitionExpression:`${t.definitionExpression} ${t.serviceDefinitionExpression}`})},wYe=({queryPayload:e,layer:t,method:r})=>{W4e({layer:t,method:r,query:e,definitionExpression:`${t.definitionExpression} ${t.serviceDefinitionExpression}`})},uue={editing:!1,operations:{add:!0,update:!0,delete:!0}},X4e=lt.ofType(N4e),xYe="graphic.layer.capabilities.operations.supportsResizeAttachments";let Rf=class extends xe{constructor(e){super(e),this._getAttachmentsPromise=null,this._attachmentLayer=null,this.abilities={...uue},this.activeAttachmentInfo=null,this.attachmentInfos=new X4e,this.graphic=null,this.mode="view",this.own(re(()=>this.graphic,()=>this._graphicChanged(),Ot))}destroy(){this._attachmentLayer=null,this.graphic=null}castAbilities(e){return{...uue,...e}}get state(){return this._getAttachmentsPromise?"loading":this.graphic?"ready":"disabled"}get supportsResizeAttachments(){return this.get(xYe)||!1}async getAttachments(){const{_attachmentLayer:e,attachmentInfos:t}=this;if(!e||typeof e.queryAttachments!="function")throw new k("invalid-layer","getAttachments(): A valid layer is required.");const r=this._getFeatureId(),i=new cN({objectIds:[r],returnMetadata:!0}),n=[],s=e.queryAttachments(i).then(o=>o[r]||n).catch(()=>n);this._getAttachmentsPromise=s,this.notifyChange("state");const a=await s;return t.removeAll(),a.length&&t.addMany(a),this._getAttachmentsPromise=null,this.notifyChange("state"),a}async addAttachment(e){const{_attachmentLayer:t,attachmentInfos:r,graphic:i,abilities:n}=this;if(!e)throw new k("invalid-attachment","addAttachment(): An attachment is required.",{attachment:e});if(!n.operations.add)throw new k("invalid-abilities","addAttachment(): add abilities are required.");if(!t||typeof t.addAttachment!="function")throw new k("invalid-layer","addAttachment(): A valid layer is required.");const s=t.addAttachment(i,e).then(o=>this._queryAttachment(o.objectId)),a=await s;return r.add(a),a}async deleteAttachment(e){const{_attachmentLayer:t,attachmentInfos:r,graphic:i,abilities:n}=this;if(!e)throw new k("invalid-attachment-info","deleteAttachment(): An attachmentInfo is required.",{attachmentInfo:e});if(!n.operations.delete)throw new k("invalid-abilities","deleteAttachment(): delete abilities are required.");if(!t||typeof t.deleteAttachments!="function")throw new k("invalid-layer","deleteAttachment(): A valid layer is required.");const s=t.deleteAttachments(i,[e.id]).then(()=>e),a=await s;return r.remove(a),a}async updateAttachment(e,t=this.activeAttachmentInfo){const{_attachmentLayer:r,attachmentInfos:i,graphic:n,abilities:s}=this;if(!e)throw new k("invalid-attachment","updateAttachment(): An attachment is required.",{attachment:e});if(!t)throw new k("invalid-attachment-info","updateAttachment(): An attachmentInfo is required.",{attachmentInfo:t});if(!s.operations.update)throw new k("invalid-abilities","updateAttachment(): Update abilities are required.");const a=i.findIndex(c=>c===t);if(!r||typeof r.updateAttachment!="function")throw new k("invalid-layer","updateAttachment(): A valid layer is required.");const o=r.updateAttachment(n,t.id,e).then(c=>this._queryAttachment(c.objectId)),l=await o;return i.splice(a,1,l),l}async _queryAttachment(e){if(!e)throw new k("invalid-attachment-id","Could not query attachment.");const{_attachmentLayer:t}=this,r=this._getFeatureId(),i=new cN({objectIds:[r],attachmentsWhere:`AttachmentId=${e}`,returnMetadata:!0});return t.queryAttachments(i).then(n=>n[r][0])}_getFeatureId(){const{_attachmentLayer:e,graphic:t}=this;if(!e||!t)return null;const{objectIdField:r}=e,{attributes:i}=t;return i&&i[r]}_graphicChanged(){this.graphic&&(this._setAttachmentLayer(),this.getAttachments().catch(()=>{}))}_setAttachmentLayer(){const{graphic:e}=this,t=z4e(e);this._attachmentLayer=t?t.type==="scene"&&_(t.associatedLayer)?t.associatedLayer:t:null}};d([f()],Rf.prototype,"abilities",void 0),d([Xt("abilities")],Rf.prototype,"castAbilities",null),d([f()],Rf.prototype,"activeAttachmentInfo",void 0),d([f({readOnly:!0,type:X4e})],Rf.prototype,"attachmentInfos",void 0),d([f({type:co})],Rf.prototype,"graphic",void 0),d([f()],Rf.prototype,"mode",void 0),d([f({readOnly:!0})],Rf.prototype,"state",null),d([f({readOnly:!0})],Rf.prototype,"supportsResizeAttachments",null),Rf=d([$("esri.widgets.Attachments.AttachmentsViewModel")],Rf);const Rie=Rf;function TYe(e){const t=e.toLowerCase();return t==="image/bmp"||t==="image/emf"||t==="image/exif"||t==="image/gif"||t==="image/x-icon"||t==="image/jpeg"||t==="image/png"||t==="image/tiff"||t==="image/x-wmf"}function SYe(e){const t=xr("esri/themes/base/images/files/");return e?e==="text/plain"?`${t}text-32.svg`:e==="application/pdf"?`${t}pdf-32.svg`:e==="text/csv"?`${t}csv-32.svg`:e==="application/gpx+xml"?`${t}gpx-32.svg`:e==="application/x-dwf"?`${t}cad-32.svg`:e==="application/postscript"||e==="application/json"||e==="text/xml"||e==="model/vrml"?`${t}code-32.svg`:e==="application/x-zip-compressed"||e==="application/x-7z-compressed"||e==="application/x-gzip"||e==="application/x-tar"||e==="application/x-gtar"||e==="application/x-bzip2"||e==="application/gzip"||e==="application/x-compress"||e==="application/x-apple-diskimage"||e==="application/x-rar-compressed"||e==="application/zip"?`${t}zip-32.svg`:e.includes("image/")?`${t}image-32.svg`:e.includes("audio/")?`${t}sound-32.svg`:e.includes("video/")?`${t}video-32.svg`:e.includes("msexcel")||e.includes("ms-excel")||e.includes("spreadsheetml")?`${t}excel-32.svg`:e.includes("msword")||e.includes("ms-word")||e.includes("wordprocessingml")?`${t}word-32.svg`:e.includes("powerpoint")||e.includes("presentationml")?`${t}report-32.svg`:`${t}generic-32.svg`:`${t}generic-32.svg`}function es(e){return(t,r)=>{t.hasOwnProperty("_messageBundleProps")||(t._messageBundleProps=t._messageBundleProps?t._messageBundleProps.slice():[]),t._messageBundleProps.push({bundlePath:e,propertyName:r})}}var EYe=function(e){return{vnodeSelector:"",properties:void 0,children:void 0,text:e.toString(),domNode:null}},Y4e=function(e,t){for(var r=0,i=e.length;r<i;r++){var n=e[r];Array.isArray(n)?Y4e(n,t):n!=null&&n!==!1&&(n.hasOwnProperty("vnodeSelector")||(n=EYe(n)),t.push(n))}},CYe=function(e,t){for(var r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];if(r.length===1&&typeof r[0]=="string")return{vnodeSelector:e,properties:t||void 0,children:void 0,text:r[0],domNode:null};var n=[];return Y4e(r,n),{vnodeSelector:e,properties:t||void 0,children:n,text:void 0,domNode:null}};function z(e,t,...r){return typeof e!="function"||Eie(e)?CYe(e,t,...r):e(t,...r)}const hue={addButton:!0,addSubmitButton:!0,cancelAddButton:!0,cancelUpdateButton:!0,deleteButton:!0,errorMessage:!0,progressBar:!0,updateButton:!0},rt={base:"esri-attachments",loaderContainer:"esri-attachments__loader-container",loader:"esri-attachments__loader",fadeIn:"esri-attachments--fade-in",container:"esri-attachments__container",containerList:"esri-attachments__container--list",containerPreview:"esri-attachments__container--preview",actions:"esri-attachments__actions",deleteButton:"esri-attachments__delete-button",addAttachmentButton:"esri-attachments__add-attachment-button",errorMessage:"esri-attachments__error-message",items:"esri-attachments__items",item:"esri-attachments__item",itemButton:"esri-attachments__item-button",itemMask:"esri-attachments__item-mask",itemMaskIcon:"esri-attachments__item-mask--icon",itemImage:"esri-attachments__image",itemImageResizable:"esri-attachments__image--resizable",itemLabel:"esri-attachments__label",itemFilename:"esri-attachments__filename",itemChevronIcon:"esri-attachments__item-chevron-icon",itemLink:"esri-attachments__item-link",itemLinkOverlay:"esri-attachments__item-link-overlay",itemLinkOverlayIcon:"esri-attachments__item-link-overlay-icon",itemEditIcon:"esri-attachments__item-edit-icon",itemAddIcon:"esri-attachments__item-add-icon",itemAddButton:"esri-attachments__item-add-button",formNode:"esri-attachments__form-node",fileFieldset:"esri-attachments__file-fieldset",fileLabel:"esri-attachments__file-label",fileName:"esri-attachments__file-name",fileInput:"esri-attachments__file-input",metadata:"esri-attachments__metadata",metadataFieldset:"esri-attachments__metadata-fieldset",progressBar:"esri-attachments__progress-bar",esriWidget:"esri-widget",esriButton:"esri-button",buttonDisabled:"esri-button--disabled",esriButtonSecondary:"esri-button--secondary",esriButtonTertiary:"esri-button--tertiary",esriButtonThird:"esri-button--third",esriButtonSmall:"esri-button--small",esriButtonHalf:"esri-button--half",empty:"esri-widget__content--empty",iconExternalLink:"esri-icon-link-external",iconEdit:"esri-icon-edit",iconRight:"esri-icon-right",iconLeft:"esri-icon-left",iconPlus:"esri-icon-plus"},AG=window.CSS;let Xo=class extends Bs{constructor(e,t){super(e,t),this.abilities=null,this.displayType="auto",this.graphic=null,this.label=void 0,this.messages=null,this.messagesUnits=null,this.selectedFile=null,this.submitting=!1,this.viewModel=new Rie,this.visibleElements={...hue},this._supportsImageOrientation=AG&&AG.supports&&AG.supports("image-orientation","from-image"),this._addAttachmentForm=null,this._updateAttachmentForm=null}initialize(){this.own([rn(()=>{var e;return(e=this.viewModel)==null?void 0:e.attachmentInfos},"change",()=>this.scheduleRender()),re(()=>{var e;return(e=this.viewModel)==null?void 0:e.mode},()=>this._modeChanged(),Ot)])}get effectiveDisplayType(){const{displayType:e}=this;return e&&e!=="auto"?e:this.viewModel.supportsResizeAttachments?"preview":"list"}castVisibleElements(e){return{...hue,...e}}addAttachment(){const{_addAttachmentForm:e,viewModel:t}=this;return this._set("submitting",!0),this._set("error",null),t.addAttachment(e).then(r=>(this._set("submitting",!1),this._set("error",null),t.mode="view",r)).catch(r=>{throw this._set("submitting",!1),this._set("error",new k("attachments:add-attachment",this.messages.addErrorMessage,r)),r})}deleteAttachment(e){const{viewModel:t}=this;return this._set("submitting",!0),this._set("error",null),t.deleteAttachment(e).then(r=>(this._set("submitting",!1),this._set("error",null),t.mode="view",r)).catch(r=>{throw this._set("submitting",!1),this._set("error",new k("attachments:delete-attachment",this.messages.deleteErrorMessage,r)),r})}updateAttachment(){const{viewModel:e}=this,{_updateAttachmentForm:t}=this;return this._set("submitting",!0),this._set("error",null),e.updateAttachment(t).then(r=>(this._set("submitting",!1),this._set("error",null),e.mode="view",r)).catch(r=>{throw this._set("submitting",!1),this._set("error",new k("attachments:update-attachment",this.messages.updateErrorMessage,r)),r})}render(){const{submitting:e,viewModel:t}=this,{state:r}=t;return z("div",{class:this.classes(rt.base,rt.esriWidget)},e?this.renderProgressBar():null,r==="loading"?this.renderLoading():this.renderAttachments(),this.renderErrorMessage())}renderErrorMessage(){const{error:e,visibleElements:t}=this;return e&&t.errorMessage?z("div",{key:"error-message",class:rt.errorMessage},e.message):null}renderAttachments(){const{mode:e,activeAttachmentInfo:t}=this.viewModel;return e==="add"?this.renderAddForm():e==="edit"?this.renderDetailsForm(t):this.renderAttachmentContainer()}renderLoading(){return z("div",{class:rt.loaderContainer,key:"loader"},z("div",{class:rt.loader}))}renderProgressBar(){return this.visibleElements.progressBar?z("div",{class:rt.progressBar,key:"progress-bar"}):null}renderAddForm(){const{submitting:e,selectedFile:t}=this,r=e||!t,i=this.visibleElements.cancelAddButton?z("button",{type:"button",bind:this,disabled:e,onclick:this._cancelForm,class:this.classes(rt.esriButton,rt.esriButtonTertiary,rt.esriButtonSmall,rt.esriButtonHalf,e&&rt.buttonDisabled)},this.messages.cancel):null,n=this.visibleElements.addSubmitButton?z("button",{type:"submit",disabled:r,class:this.classes(rt.esriButton,rt.esriButtonSecondary,rt.esriButtonSmall,rt.esriButtonHalf,{[rt.buttonDisabled]:r})},this.messages.add):null,s=t?z("span",{key:"file-name",class:rt.fileName},t.name):null,a=z("form",{bind:this,afterCreate:pZ,afterRemoved:Vde,"data-node-ref":"_addAttachmentForm",onsubmit:this._submitAddAttachment},z("fieldset",{class:rt.fileFieldset},s,z("label",{class:this.classes(rt.fileLabel,rt.esriButton,rt.esriButtonSecondary)},t?this.messages.changeFile:this.messages.selectFile,z("input",{class:rt.fileInput,type:"file",name:"attachment",bind:this,onchange:this._handleFileInputChange}))),n,i);return z("div",{key:"add-form-container",class:rt.formNode},a)}renderDetailsForm(e){const{visibleElements:t,viewModel:r,selectedFile:i,submitting:n}=this,{contentType:s,size:a,url:o}=e,{abilities:l}=r,c=n||!i,u=l.editing&&l.operations.delete&&t.deleteButton?z("button",{key:"delete-button",type:"button",disabled:n,bind:this,onclick:x=>this._submitDeleteAttachment(x,e),class:this.classes(rt.esriButton,rt.esriButtonSmall,rt.esriButtonTertiary,rt.deleteButton,{[rt.buttonDisabled]:n})},this.messages.delete):null,h=l.editing&&l.operations.update&&t.updateButton?z("button",{disabled:c,key:"update-button",type:"submit",class:this.classes(rt.esriButton,rt.esriButtonSmall,rt.esriButtonThird,{[rt.buttonDisabled]:c})},this.messages.update):null,p=this.visibleElements.cancelUpdateButton?z("button",{disabled:n,key:"cancel-button",type:"button",bind:this,onclick:this._cancelForm,class:this.classes(rt.esriButton,rt.esriButtonSmall,rt.esriButtonTertiary,rt.esriButtonThird,{[rt.buttonDisabled]:n})},this.messages.cancel):null,m=i?z("span",{key:"file-name",class:rt.fileName},i.name):null,g=l.editing&&l.operations.update?z("fieldset",{key:"file",class:rt.fileFieldset},m,z("label",{class:this.classes(rt.fileLabel,rt.esriButton,rt.esriButtonSecondary)},this.messages.changeFile,z("input",{class:rt.fileInput,type:"file",name:"attachment",bind:this,onchange:this._handleFileInputChange}))):null,b=z("fieldset",{key:"size",class:rt.metadataFieldset},z("label",null,UXe(this.messagesUnits,a))),w=z("fieldset",{key:"content-type",class:rt.metadataFieldset},z("label",null,s)),v=z("form",{bind:this,afterCreate:pZ,afterRemoved:Vde,"data-node-ref":"_updateAttachmentForm",onsubmit:this._submitUpdateAttachment},z("div",{class:rt.metadata},b,w),g,z("div",{class:rt.actions},u,p,h));return z("div",{key:"edit-form-container",class:rt.formNode},z("a",{class:rt.itemLink,href:o,rel:"noreferrer",target:"_blank"},this.renderImageMask({attachmentInfo:e,size:400}),z("div",{class:rt.itemLinkOverlay},z("span",{class:rt.itemLinkOverlayIcon},z("svg",{xmlns:"http://www.w3.org/2000/svg",width:"32",height:"32",viewBox:"0 0 32 32"},z("path",{d:"M28 13h1v16H3V3h16v1H4v24h24zm-5-9h4.293L15.646 15.638l.707.707L28 4.707V9h1V3h-6z"}),z("path",{fill:"none",d:"M0 0h32v32H0z"}))))),v)}renderImageMask({attachmentInfo:e,size:t}){const{supportsResizeAttachments:r}=this.viewModel,{contentType:i,name:n,url:s}=e,a=r&&TYe(i),o=this._getCSSTransform(e,a),l=o?{transform:o,"image-orientation":"none"}:{},c=s.includes("?")?"&":"?",u=a?`${s}${c}w=${t}`:SYe(i),h={[rt.itemMaskIcon]:!a},p={[rt.itemImageResizable]:r};return z("div",{class:this.classes(h,rt.itemMask)},z("img",{styles:l,alt:n,src:u,class:this.classes(p,rt.itemImage)}))}renderAttachmentInfo({attachmentInfo:e,displayType:t}){const{viewModel:r}=this,{abilities:i}=r,{name:n,url:s}=e,a=this.renderImageMask({attachmentInfo:e,size:t==="list"?48:400}),o=i.editing?z("span",{"aria-hidden":"true",class:this.classes(rt.itemChevronIcon,gp(this.container)?rt.iconLeft:rt.iconRight)}):null,l=[a,z("label",{class:rt.itemLabel},z("span",{class:rt.itemFilename},n||this.messages.noTitle),o)],c=i.editing?z("button",{key:"details-button",bind:this,class:rt.itemButton,title:this.messages.attachmentDetails,"aria-label":this.messages.attachmentDetails,"data-attachment-info-id":e.id,onclick:()=>this._startEditAttachment(e),type:"button"},l):z("a",{key:"details-link",class:rt.itemButton,href:s,target:"_blank"},l);return z("li",{class:rt.item,key:e},c)}renderAttachmentContainer(){const{effectiveDisplayType:e,viewModel:t,visibleElements:r}=this,{attachmentInfos:i,abilities:n}=t,s=i&&i.length,a={[rt.containerList]:e!=="preview",[rt.containerPreview]:e==="preview"},o=n.editing&&n.operations.add&&r.addButton?z("button",{bind:this,onclick:()=>this._startAddAttachment(),class:this.classes(rt.esriButton,rt.esriButtonTertiary,rt.addAttachmentButton),type:"button"},z("span",{"aria-hidden":"true",class:this.classes(rt.itemAddIcon,rt.iconPlus)}),this.messages.add):null,l=s?z("ul",{class:rt.items},i.toArray().map(c=>this.renderAttachmentInfo({attachmentInfo:c,displayType:e}))):z("div",{class:rt.empty},this.messages.noAttachments);return z("div",{key:"attachments-container",class:this.classes(rt.container,a)},l,o)}_modeChanged(){this._set("error",null),this._set("selectedFile",null)}_handleFileInputChange(e){const t=e.target,r=t&&t.files&&t.files.item(0);this._set("selectedFile",r)}_submitDeleteAttachment(e,t){e.preventDefault(),this.deleteAttachment(t)}_submitAddAttachment(e){e.preventDefault(),this.addAttachment()}_submitUpdateAttachment(e){e.preventDefault(),this.updateAttachment()}_startEditAttachment(e){const{viewModel:t}=this;t.activeAttachmentInfo=e,t.mode="edit"}_startAddAttachment(){this.viewModel.mode="add"}_cancelForm(e){e.preventDefault(),this.viewModel.mode="view"}_getCSSTransform(e,t){const{orientationInfo:r}=e;return!this._supportsImageOrientation&&t&&r?[r.rotation?`rotate(${r.rotation}deg)`:"",r.mirrored?"scaleX(-1)":""].join(" "):""}};d([We("viewModel.abilities")],Xo.prototype,"abilities",void 0),d([f()],Xo.prototype,"displayType",void 0),d([f({readOnly:!0})],Xo.prototype,"effectiveDisplayType",null),d([We("viewModel.graphic")],Xo.prototype,"graphic",void 0),d([f({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],Xo.prototype,"label",void 0),d([f(),es("esri/widgets/Attachments/t9n/Attachments")],Xo.prototype,"messages",void 0),d([f(),es("esri/core/t9n/Units")],Xo.prototype,"messagesUnits",void 0),d([f({readOnly:!0})],Xo.prototype,"selectedFile",void 0),d([f({readOnly:!0})],Xo.prototype,"submitting",void 0),d([f({readOnly:!0})],Xo.prototype,"error",void 0),d([f({type:Rie})],Xo.prototype,"viewModel",void 0),d([f()],Xo.prototype,"visibleElements",void 0),d([Xt("visibleElements")],Xo.prototype,"castVisibleElements",null),Xo=d([$("esri.widgets.Attachments")],Xo);const AYe=Xo;let IE=class extends Rie{constructor(e){super(e),this.description=null,this.title=null}};d([f()],IE.prototype,"description",void 0),d([f()],IE.prototype,"title",void 0),IE=d([$("esri.widgets.Feature.FeatureAttachments.FeatureAttachmentsViewModel")],IE);const Oie=IE,RYe={heading:"esri-widget__heading"};function Pv(e,t){const r=Z4e(e.level),i=`h${r}`;return delete e.level,z(i,{...e,class:h4(RYe.heading,e.class),role:"heading","aria-level":String(r)},t)}function Z4e(e){return Le(Math.ceil(e),1,6)}function OYe(e,t=1){return Z4e(e+t)}const RG={base:"esri-feature-element-info",title:"esri-feature-element-info__title",description:"esri-feature-element-info__description"};let lS=class extends Bs{constructor(e,t){super(e,t),this.description=null,this.headingLevel=2,this.title=null}render(){return z("div",{class:RG.base},this.renderTitle(),this.renderDescription())}renderTitle(){const{title:e}=this;return e?z(Pv,{level:this.headingLevel,class:RG.title},e):null}renderDescription(){const{description:e}=this;return e?z("div",{key:"description",class:RG.description},e):null}};d([f()],lS.prototype,"description",void 0),d([f()],lS.prototype,"headingLevel",void 0),d([f()],lS.prototype,"title",void 0),lS=d([$("esri.widgets.Feature.support.FeatureElementInfo")],lS);const Mie=lS,MYe={base:"esri-feature-attachments"};let g0=class extends Bs{constructor(e,t){super(e,t),this._featureElementInfo=null,this.attachmentsWidget=new AYe,this.description=null,this.displayType=null,this.graphic=null,this.headingLevel=2,this.title=null,this.viewModel=new Oie}initialize(){this._featureElementInfo=new Mie,this.own([re(()=>{var e,t;return[(e=this.viewModel)==null?void 0:e.description,(t=this.viewModel)==null?void 0:t.title,this.headingLevel]},()=>this._setupFeatureElementInfo(),Ot),re(()=>{var e;return(e=this.viewModel)==null?void 0:e.graphic},e=>this.attachmentsWidget.graphic=e,Ot)])}destroy(){this.attachmentsWidget.destroy(),this._featureElementInfo.destroy()}render(){var t;const{attachmentsWidget:e}=this;return z("div",{class:MYe.base},(t=this._featureElementInfo)==null?void 0:t.render(),e==null?void 0:e.render())}_setupFeatureElementInfo(){const{description:e,title:t,headingLevel:r}=this;this._featureElementInfo.set({description:e,title:t,headingLevel:r})}};d([f({readOnly:!0})],g0.prototype,"attachmentsWidget",void 0),d([We("viewModel.description")],g0.prototype,"description",void 0),d([We("attachmentsWidget.displayType")],g0.prototype,"displayType",void 0),d([We("viewModel.graphic")],g0.prototype,"graphic",void 0),d([f()],g0.prototype,"headingLevel",void 0),d([We("viewModel.title")],g0.prototype,"title",void 0),d([f({type:Oie})],g0.prototype,"viewModel",void 0),g0=d([$("esri.widgets.Feature.FeatureAttachments")],g0);const PYe=g0;let r1=class extends Cm(xe){constructor(e){super(e),this._loadingPromise=null,this.created=null,this.creator=null,this.destroyer=null,this.graphic=null,this.handles.add(re(()=>this.creator,t=>{this._destroyContent(),this._createContent(t)},Ot))}destroy(){this._destroyContent()}get state(){return this._loadingPromise?"loading":"ready"}_destroyContent(){const{created:e,graphic:t,destroyer:r}=this;e&&(dN(r,{graphic:t}).catch(()=>null),this._set("created",null))}async _createContent(e){const{graphic:t}=this,r=dN(e,{graphic:t}).catch(()=>null);this._loadingPromise=r,this.notifyChange("state");const i=await r;r===this._loadingPromise&&(this._loadingPromise=null,this.notifyChange("state"),this._set("created",i))}};d([f({readOnly:!0})],r1.prototype,"created",void 0),d([f()],r1.prototype,"creator",void 0),d([f()],r1.prototype,"destroyer",void 0),d([f({type:co})],r1.prototype,"graphic",void 0),d([f({readOnly:!0})],r1.prototype,"state",null),r1=d([$("esri.widgets.Feature.FeatureContent.FeatureContentViewModel")],r1);const hN=r1;function ol(){return function(e,t){if(!e[t])throw new TypeError(`Cannot auto bind undefined function '${t}'`);return{value:$Ye(e[t])}}}function IYe(e){const{type:t}=e;return e instanceof KeyboardEvent||t==="keyup"||t==="keydown"||t==="keypress"}function $Ye(e){return function(t,...r){IYe(t)?TWe(t.key)&&(t.preventDefault(),t.stopPropagation(),t.target.click()):e.call(this,t,...r)}}function LYe(e){return e.split(",").map(t=>t.trim())}function Q4e(e){return t=>{t.hasOwnProperty("_delegatedEventNames")||(t._delegatedEventNames=t._delegatedEventNames?t._delegatedEventNames.slice():[]);const r=t._delegatedEventNames,i=Array.isArray(e)?e:LYe(e);r.push(...i)}}const J4e="calcite-theme-";function DYe(){return getComputedStyle(document.body).getPropertyValue("--esri-calcite-theme-name").replace(/\s|'|"/g,"")}function Pie(){return DYe().startsWith("dark")}function FYe(){return`${J4e}${Pie()?"dark":"light"}`}function NYe(e){kYe(e),e.classList.add(FYe())}function kYe(e){Array.from(e.classList).forEach(t=>{t.startsWith(J4e)&&e.classList.remove(t)})}function fN(e){return e&&typeof e.render=="function"}function K4e(e){return e&&typeof e.postMixInProperties=="function"&&typeof e.buildRendering=="function"&&typeof e.postCreate=="function"&&typeof e.startup=="function"}const OG={base:"esri-feature-content",loaderContainer:"esri-feature-content__loader-container",loader:"esri-feature-content__loader"};let cS=class extends Bs{constructor(e,t){super(e,t),this.creator=null,this.graphic=null,this.viewModel=null,this._addTargetToAnchors=r=>{Array.from(r.querySelectorAll("a")).forEach(i=>{U4e(i.href)&&!i.hasAttribute("target")&&i.setAttribute("target","_blank")})}}renderLoading(){return z("div",{class:OG.loaderContainer,key:"loader"},z("div",{class:OG.loader}))}renderCreated(){var t;const e=(t=this.viewModel)==null?void 0:t.created;return e?e instanceof HTMLElement?z("div",{key:e,bind:e,afterCreate:this._attachToNode}):fN(e)?z("div",{key:e},!e.destroyed&&e.render()):z("div",{key:e,innerHTML:e,afterCreate:this._addTargetToAnchors}):null}render(){var t;const e=(t=this.viewModel)==null?void 0:t.state;return z("div",{class:OG.base},e==="loading"?this.renderLoading():this.renderCreated())}_attachToNode(e){const t=this;e.appendChild(t)}};d([We("viewModel.creator")],cS.prototype,"creator",void 0),d([We("viewModel.graphic")],cS.prototype,"graphic",void 0),d([f({type:hN})],cS.prototype,"viewModel",void 0),cS=d([$("esri.widgets.Feature.FeatureContent")],cS);const vL=cS;let lg=class extends xe{constructor(e){super(e),this.attributes=null,this.expressionInfos=null,this.description=null,this.fieldInfos=null,this.title=null}get formattedFieldInfos(){const{expressionInfos:e,fieldInfos:t}=this,r=[];return t==null||t.forEach(i=>{if(!(!i.hasOwnProperty("visible")||i.visible))return;const n=i.clone();n.label=G4e(n,e),r.push(n)}),r}};d([f()],lg.prototype,"attributes",void 0),d([f({type:[hxe]})],lg.prototype,"expressionInfos",void 0),d([f()],lg.prototype,"description",void 0),d([f({type:[JR]})],lg.prototype,"fieldInfos",void 0),d([f({readOnly:!0})],lg.prototype,"formattedFieldInfos",null),d([f()],lg.prototype,"title",void 0),lg=d([$("esri.widgets.Feature.FeatureFields.FeatureFieldsViewModel")],lg);const ez=lg,VYe=[{pattern:/^\s*(https?:\/\/([^\s]+))\s*$/i,target:"_blank",label:"{messages.view}"},{pattern:/^\s*(tel:([^\s]+))\s*$/i,label:"{hierPart}"},{pattern:/^\s*(mailto:([^\s]+))\s*$/i,label:"{hierPart}"},{pattern:/^\s*(arcgis-appstudio-player:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"App Studio Player"},{pattern:/^\s*(arcgis-collector:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Collector"},{pattern:/^\s*(arcgis-explorer:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Explorer"},{pattern:/^\s*(arcgis-navigator:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Navigator"},{pattern:/^\s*(arcgis-survey123:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Survey123"},{pattern:/^\s*(arcgis-trek2there:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Trek2There"},{pattern:/^\s*(arcgis-workforce:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Workforce"},{pattern:/^\s*(iform:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"iForm"},{pattern:/^\s*(flow:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"FlowFinity"},{pattern:/^\s*(lfmobile:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Laserfische"},{pattern:/^\s*(mspbi:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Microsoft Power Bi"}];function zYe(e){let t=null;return VYe.some(r=>(r.pattern.test(e)&&(t=r),!!t)),t}function UYe(e,t){if(typeof t!="string"||!t)return t;const r=zYe(t);if(!r)return t;const i=t.match(r.pattern),n=i&&i[2],s=lm(lm(r.label,{messages:e,hierPart:n}),{appName:r.appName}),a=r.target?` target="${r.target}"`:"",o=r.target==="_blank"?' rel="noreferrer"':"";return t.replace(r.pattern,`<a${a} href="$1"${o}>${s}</a>`)}const X6={base:"esri-feature-fields",fieldHeader:"esri-feature-fields__field-header",fieldData:"esri-feature-fields__field-data",fieldDataDate:"esri-feature-fields__field-data--date",esriTable:"esri-widget__table"};let Of=class extends Bs{constructor(e,t){super(e,t),this._featureElementInfo=null,this.attributes=null,this.description=null,this.expressionInfos=null,this.fieldInfos=null,this.title=null,this.viewModel=new ez,this.messages=null,this.messagesURIUtils=null}initialize(){this._featureElementInfo=new Mie,this.own(re(()=>{var e,t;return[(e=this.viewModel)==null?void 0:e.description,(t=this.viewModel)==null?void 0:t.title]},()=>this._setupFeatureElementInfo(),Ot))}destroy(){this._featureElementInfo.destroy()}renderFieldInfo(e,t){const{attributes:r}=this.viewModel,i=e.fieldName,n=e.label||i,s=r?r[i]==null?"":r[i]:"",a=!(!e.format||!e.format.dateFormat),o=typeof s=="number"&&!a?this._forceLTR(s):UYe(this.messagesURIUtils,s),l={[X6.fieldDataDate]:a};return z("tr",{key:`fields-element-info-row-${i}-${t}`},z("th",{key:`fields-element-info-row-header-${i}-${t}`,class:X6.fieldHeader,innerHTML:n}),z("td",{key:`fields-element-info-row-data-${i}-${t}`,class:this.classes(X6.fieldData,l),innerHTML:o}))}renderFields(){const{formattedFieldInfos:e}=this.viewModel;return e!=null&&e.length?z("table",{class:X6.esriTable,summary:this.messages.fieldsSummary},z("tbody",null,e.map((t,r)=>this.renderFieldInfo(t,r)))):null}render(){var e;return z("div",{class:X6.base},(e=this._featureElementInfo)==null?void 0:e.render(),this.renderFields())}_setupFeatureElementInfo(){const{description:e,title:t}=this;this._featureElementInfo.set({description:e,title:t})}_forceLTR(e){return`&lrm;${e}`}};d([We("viewModel.attributes")],Of.prototype,"attributes",void 0),d([We("viewModel.description")],Of.prototype,"description",void 0),d([We("viewModel.expressionInfos")],Of.prototype,"expressionInfos",void 0),d([We("viewModel.fieldInfos")],Of.prototype,"fieldInfos",void 0),d([We("viewModel.title")],Of.prototype,"title",void 0),d([f({type:ez})],Of.prototype,"viewModel",void 0),d([f(),es("esri/widgets/Feature/t9n/Feature")],Of.prototype,"messages",void 0),d([f(),es("esri/widgets/support/t9n/uriUtils")],Of.prototype,"messagesURIUtils",void 0),Of=d([$("esri.widgets.Feature.FeatureFields")],Of);const e5e=Of,BYe=/^-?(\d+)(\.(\d+))?$/i;function GYe(e,t){return e-t}function jYe(e,t){let r,i;return r=Number(e.toFixed(t)),r<e?i=r+1/10**t:(i=r,r-=1/10**t),r=Number(r.toFixed(t)),i=Number(i.toFixed(t)),[r,i]}function qYe(e,t,r,i,n){const s=_L(e,t,r,i),a=s.previous==null||s.previous<=n,o=s.next==null||s.next<=n;return a&&o||s.previous+s.next<=2*n}function pN(e){const t=String(e),r=t.match(BYe);if(r&&r[1])return{integer:r[1].split("").length,fractional:r[3]?r[3].split("").length:0};if(t.toLowerCase().includes("e")){const i=t.split("e"),n=i[0],s=i[1];if(n&&s){const a=Number(n);let o=Number(s);const l=o>0;l||(o=Math.abs(o));const c=pN(a);return l?(c.integer+=o,o>c.fractional?c.fractional=0:c.fractional-=o):(c.fractional+=o,o>c.integer?c.integer=1:c.integer-=o),c}}return{integer:0,fractional:0}}function _L(e,t,r,i){const n={previous:null,next:null};if(r!=null){const s=e-r,a=t-r-s;n.previous=Math.floor(Math.abs(100*a/s))}if(i!=null){const s=i-e,a=i-t-s;n.next=Math.floor(Math.abs(100*a/s))}return n}function mN(e,t={}){const r=e.slice(0),{tolerance:i=2,strictBounds:n=!1,indexes:s=r.map((a,o)=>o)}=t;s.sort(GYe);for(let a=0;a<s.length;a++){const o=s[a],l=r[o],c=o===0?null:r[o-1],u=o===r.length-1?null:r[o+1],h=pN(l).fractional;if(h){let p,m=0,g=!1;for(;m<=h&&!g;){const b=jYe(l,m);p=n&&a===0?b[1]:b[0],g=qYe(l,p,c,u,i),m++}g&&(r[o]=p)}}return r}const HYe={maximumFractionDigits:20};function t5e(e){return Xh(e,HYe)}var EZ;let M2=EZ=class extends ge{constructor(e){super(e),this.color=null,this.label=null,this.value=null}writeValue(e,t,r){t[r]=e==null?0:e}clone(){return new EZ({color:this.color&&this.color.clone(),label:this.label,value:this.value})}};d([f({type:Te,json:{type:[$i],write:!0}})],M2.prototype,"color",void 0),d([f({type:String,json:{write:!0}})],M2.prototype,"label",void 0),d([f({type:Number,json:{write:{writerEnsuresNonNull:!0}}})],M2.prototype,"value",void 0),d([Xe("value")],M2.prototype,"writeValue",null),M2=EZ=d([$("esri.renderers.visualVariables.support.ColorStop")],M2);const r5e=M2;function iO(){const e=new Float32Array(16);return e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function WYe(e){const t=new Float32Array(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function XYe(e,t,r,i,n,s,a,o,l,c,u,h,p,m,g,b){const w=new Float32Array(16);return w[0]=e,w[1]=t,w[2]=r,w[3]=i,w[4]=n,w[5]=s,w[6]=a,w[7]=o,w[8]=l,w[9]=c,w[10]=u,w[11]=h,w[12]=p,w[13]=m,w[14]=g,w[15]=b,w}function YYe(e,t){return new Float32Array(e,t,16)}const ZYe=iO();Object.freeze(Object.defineProperty({__proto__:null,create:iO,clone:WYe,fromValues:XYe,createView:YYe,IDENTITY:ZYe},Symbol.toStringTag,{value:"Module"}));const QYe=(e,t)=>{const r=Rm(e,t,0,0,0,0,t,0,0,0,0,t,0,0,0,0,1);return hc(r,r)},JYe=(e,t)=>{const r=Rm(e,t,0,0,.5-.5*t,0,t,0,.5-.5*t,0,0,t,.5-.5*t,0,0,0,1);return hc(r,r)},KYe=(e,t)=>{const r=1-t,i=Rm(e,.2126+.7874*r,.7152-.7152*r,.0722-.0722*r,0,.2126-.2126*r,.7152+.2848*r,.0722-.0722*r,0,.2126-.2126*r,.7152-.7152*r,.0722+.9278*r,0,0,0,0,1);return hc(i,i)},eZe=(e,t)=>{const r=Math.sin(t*Math.PI/180),i=Math.cos(t*Math.PI/180),n=Rm(e,.213+.787*i-.213*r,.715-.715*i-.715*r,.072-.072*i+.928*r,0,.213-.213*i+.143*r,.715+.285*i+.14*r,.072-.072*i-.283*r,0,.213-.213*i-.787*r,.715-.715*i+.715*r,.072+.928*i+.072*r,0,0,0,0,1);return hc(n,n)},tZe=(e,t)=>{const r=1-2*t,i=Rm(e,r,0,0,t,0,r,0,t,0,0,r,t,0,0,0,1);return hc(i,i)},rZe=(e,t)=>{const r=Rm(e,.213+.787*t,.715-.715*t,.072-.072*t,0,.213-.213*t,.715+.285*t,.072-.072*t,0,.213-.213*t,.715-.715*t,.072+.928*t,0,0,0,0,1);return hc(r,r)},iZe=(e,t)=>{const r=1-t,i=Rm(e,.393+.607*r,.769-.769*r,.189-.189*r,0,.349-.349*r,.686+.314*r,.168-.168*r,0,.272-.272*r,.534-.534*r,.131+.869*r,0,0,0,0,1);return hc(i,i)};class tz{constructor(t,r,i){this.strength=t,this.radius=r,this.threshold=i,this.type="bloom"}interpolate(t,r,i){this.strength=Gc(t.strength,r.strength,i),this.radius=Gc(t.radius,r.radius,i),this.threshold=Gc(t.threshold,r.threshold,i)}clone(){return new tz(this.strength,this.radius,this.threshold)}toJSON(){return{type:"bloom",radius:ZC(this.radius),strength:this.strength,threshold:this.threshold}}}class rz{constructor(t){this.radius=t,this.type="blur"}interpolate(t,r,i){this.radius=Math.round(Gc(t.radius,r.radius,i))}clone(){return new rz(this.radius)}toJSON(){return{type:"blur",radius:ZC(this.radius)}}}class wA{constructor(t,r){this.type=t,this.amount=r,this.type!=="invert"&&this.type!=="grayscale"&&this.type!=="sepia"||(this.amount=Math.min(this.amount,1))}get colorMatrix(){return this._colorMatrix||this._updateMatrix(),this._colorMatrix}interpolate(t,r,i){this.amount=Gc(t.amount,r.amount,i),this._updateMatrix()}clone(){return new wA(this.type,this.amount)}toJSON(){return{type:this.type,amount:this.amount}}_updateMatrix(){const t=this._colorMatrix||iO();switch(this.type){case"brightness":this._colorMatrix=QYe(t,this.amount);break;case"contrast":this._colorMatrix=JYe(t,this.amount);break;case"grayscale":this._colorMatrix=KYe(t,this.amount);break;case"invert":this._colorMatrix=tZe(t,this.amount);break;case"saturate":this._colorMatrix=rZe(t,this.amount);break;case"sepia":this._colorMatrix=iZe(t,this.amount)}}}class iz{constructor(t,r,i,n){this.offsetX=t,this.offsetY=r,this.blurRadius=i,this.color=n,this.type="drop-shadow"}interpolate(t,r,i){this.offsetX=Gc(t.offsetX,r.offsetX,i),this.offsetY=Gc(t.offsetY,r.offsetY,i),this.blurRadius=Gc(t.blurRadius,r.blurRadius,i),this.color[0]=Math.round(Gc(t.color[0],r.color[0],i)),this.color[1]=Math.round(Gc(t.color[1],r.color[1],i)),this.color[2]=Math.round(Gc(t.color[2],r.color[2],i)),this.color[3]=Gc(t.color[3],r.color[3],i)}clone(){return new iz(this.offsetX,this.offsetY,this.blurRadius,[...this.color])}toJSON(){const t=[...this.color];return t[3]*=255,{type:"drop-shadow",xoffset:ZC(this.offsetX),yoffset:ZC(this.offsetY),blurRadius:ZC(this.blurRadius),color:t}}}class nz{constructor(t){this.angle=t,this.type="hue-rotate"}get colorMatrix(){return this._colorMatrix||this._updateMatrix(),this._colorMatrix}interpolate(t,r,i){this.angle=Gc(t.angle,r.angle,i),this._updateMatrix()}clone(){return new nz(this.angle)}toJSON(){return{type:"hue-rotate",angle:this.angle}}_updateMatrix(){const t=this._colorMatrix||iO();this._colorMatrix=eZe(t,this.angle)}}class sz{constructor(t){this.amount=t,this.type="opacity",this.amount=Math.min(this.amount,1)}interpolate(t,r,i){this.amount=Gc(t.amount,r.amount,i)}clone(){return new sz(this.amount)}toJSON(){return{type:"opacity",amount:this.amount}}}function Gc(e,t,r){return e+(t-e)*r}function ZC(e){return Math.round(1e3*zs(e))/1e3}function nZe(e){switch(e.type){case"grayscale":case"sepia":case"invert":return new wA(e.type,0);case"saturate":case"brightness":case"contrast":return new wA(e.type,1);case"opacity":return new sz(1);case"hue-rotate":return new nz(0);case"blur":return new rz(0);case"drop-shadow":return new iz(0,0,0,[...rre("transparent")]);case"bloom":return new tz(0,0,1)}}function i5e(e,t){const r=e.length>t.length?e:t;return(e.length>t.length?t:e).every((i,n)=>i.type===r[n].type)}function n5e(e,t){const r=e.length>t.length?e:t,i=e.length>t.length?t:e;for(let n=i.length;n<r.length;n++)i.push(nZe(r[n]))}function sZe(e){const t=e[0];return!!t&&"type"in t}var fue,pue,s5e={exports:{}};function Iie(e){if(!e||e.length===0)return null;if(typeof e=="string"){const r=mue(e);return r&&r.length!==0?r:null}const t=e.map(r=>{if(!Number.isFinite(r.scale)||r.scale<=0)throw new k("effect:invalid-scale","scale must be finite and greater than 0",{stop:r});return{scale:r.scale,effects:mue(r.value)}});t.sort((r,i)=>i.effects.length-r.effects.length);for(let r=0;r<t.length-1;r++){if(!i5e(t[r].effects,t[r+1].effects))throw new k("effect:interpolation-impossible","Cannot interpolate by scale between 2 lists of mixed effects",{a:t[r].effects,b:t[r+1].effects});n5e(t[r].effects,t[r+1].effects)}return t.sort((r,i)=>i.scale-r.scale),t}function mue(e){let t;if(!e)return[];try{t=s5e.exports.parse(e)}catch(r){throw new k("effect:invalid-syntax","Invalid effect syntax",{value:e,error:r})}return t.map(r=>aZe(r))}function aZe(e){try{switch(e.name){case"grayscale":case"sepia":case"saturate":case"invert":case"brightness":case"contrast":return oZe(e);case"opacity":return lZe(e);case"hue-rotate":return cZe(e);case"blur":return dZe(e);case"drop-shadow":return uZe(e);case"bloom":return hZe(e)}}catch(t){throw t.details.filter=e,t}throw new k("effect:unknown-effect",`Effect '${e.name}' is not supported`,{effect:e})}function oZe(e){let t=1;return o6(e.parameters,1),e.parameters.length===1&&(t=Jf(e.parameters[0])),new wA(e.name,t)}function lZe(e){let t=1;return o6(e.parameters,1),e.parameters.length===1&&(t=Jf(e.parameters[0])),new sz(t)}function cZe(e){let t=0;return o6(e.parameters,1),e.parameters.length===1&&(t=bZe(e.parameters[0])),new nz(t)}function dZe(e){let t=0;return o6(e.parameters,1),e.parameters.length===1&&(t=Die(e.parameters[0]),nO(t,e.parameters[0])),new rz(t)}function uZe(e){const t=[];let r=null;for(const i of e.parameters)if(i.type==="color"){if(t.length&&Object.freeze(t),r)throw new k("effect:type-error","Accepts only one color",{});r=vZe(i)}else{const n=Die(i);if(Object.isFrozen(t))throw new k("effect:type-error","<length> parameters not consecutive",{lengths:t});t.push(n),t.length===3&&nO(n,i)}if(t.length<2||t.length>3)throw new k("effect:type-error",`Expected <length>{2,3}, Actual: <length>{${t.length}}`,{lengths:t});return new iz(t[0],t[1],t[2]||0,r||a5e("black"))}function hZe(e){let t=1,r=0,i=0;return o6(e.parameters,3),e.parameters[0]&&(t=Jf(e.parameters[0])),e.parameters[1]&&(r=Die(e.parameters[1]),nO(r,e.parameters[1])),e.parameters[2]&&(i=Jf(e.parameters[2])),new tz(t,r,i)}function o6(e,t){if(e.length>t)throw new k("effect:type-error",`Function supports up to ${t} parameters, Actual: ${e.length}`,{parameters:e})}function az(e){if(e.type==="color")return"<color>";if(e.unit){if(Lie[e.unit])return"<length>";if($ie[e.unit])return"<angle>";if(e.unit==="%")return"<percentage>"}return"<double>"}function nO(e,t){if(e<0)throw new k("effect:type-error",`Negative values are not allowed, Actual: ${e}`,{term:t})}function fZe(e){if(e.type!=="quantity"||e.unit!==null)throw new k("effect:type-error",`Expected <double>, Actual: ${az(e)}`,{term:e})}function pZe(e){if(e.type!=="quantity"||e.unit!==null&&e.unit!=="%")throw new k("effect:type-error",`Expected <double> or <percentage>, Actual: ${az(e)}`,{term:e})}pue=function(){function e(n,s){function a(){this.constructor=n}a.prototype=s.prototype,n.prototype=new a}function t(n,s,a,o){var l=Error.call(this,n);return Object.setPrototypeOf&&Object.setPrototypeOf(l,t.prototype),l.expected=s,l.found=a,l.location=o,l.name="SyntaxError",l}function r(n,s,a){return a=a||" ",n.length>s?n:(s-=n.length,n+(a+=a.repeat(s)).slice(0,s))}function i(n,s){var a,o={},l=(s=s!==void 0?s:{}).grammarSource,c={start:$oe},u=$oe,h="none",p=")",m=",",g="(",b="%",w="px",v="cm",x="mm",T="in",E="pt",C="pc",A="deg",P="rad",I="grad",L="turn",V="#",G=".",B="e",X=/^[ \t\n\r]/,Y=/^[a-z\-]/,ce=/^[0-9a-fA-F]/,se=/^[+\-]/,D=/^[0-9]/,F=cf("none"),U=Gs("none",!1),j=Gs(")",!1),W=Gs(",",!1),Z=cf("whitespace"),q=R_([" ","	",`
`,"\r"],!1,!1),ee=cf("function"),me=Gs("(",!1),_e=cf("identifier"),De=R_([["a","z"],"-"],!1,!1),be=cf("percentage"),ye=Gs("%",!1),Ce=cf("length"),Ne=Gs("px",!1),Fr=Gs("cm",!1),Br=Gs("mm",!1),hr=Gs("in",!1),Gr=Gs("pt",!1),mr=Gs("pc",!1),jr=cf("angle"),Qi=Gs("deg",!1),yn=Gs("rad",!1),st=Gs("grad",!1),Di=Gs("turn",!1),da=cf("number"),Sl=cf("color"),Vo=Gs("#",!1),of=R_([["0","9"],["a","f"],["A","F"]],!1,!1),lf=R_(["+","-"],!1,!1),zo=R_([["0","9"]],!1,!1),S_=Gs(".",!1),lB=Gs("e",!1),cB=function(){return[]},GO=function(Q,ve){return{type:"function",name:Q,parameters:ve||[]}},jO=function(Q,ve){return ve.length>0?m$e(Q,ve,3):[Q]},qO=function(Q){return{type:"quantity",value:Q.value,unit:Q.unit}},HO=function(Q){return{type:"color",colorType:Q.type,value:Q.value}},dB=function(Q){return Q},uB=function(){return A_()},hB=function(Q){return{value:Q,unit:"%"}},fB=function(Q){return{value:Q,unit:"px"}},E6=function(Q){return{value:Q,unit:"cm"}},WO=function(Q){return{value:Q,unit:"mm"}},XO=function(Q){return{value:Q,unit:"in"}},YO=function(Q){return{value:Q,unit:"pt"}},Lr=function(Q){return{value:Q,unit:"pc"}},fo=function(Q){return{value:Q,unit:"deg"}},Va=function(Q){return{value:Q,unit:"rad"}},_c=function(Q){return{value:Q,unit:"grad"}},E_=function(Q){return{value:Q,unit:"turn"}},ZO=function(Q){return{value:Q,unit:null}},QO=function(){return{type:"hex",value:A_()}},JO=function(Q){return{type:"function",value:Q}},KO=function(){return{type:"named",value:A_()}},Vp=function(){return parseFloat(A_())},de=0,Fi=0,Dx=[{line:1,column:1}],Fu=0,C_=[],ht=0;if("startRule"in s){if(!(s.startRule in c))throw new Error(`Can't start parsing from rule "`+s.startRule+'".');u=c[s.startRule]}function A_(){return n.substring(Fi,de)}function Gs(Q,ve){return{type:"literal",text:Q,ignoreCase:ve}}function R_(Q,ve,Me){return{type:"class",parts:Q,inverted:ve,ignoreCase:Me}}function eM(){return{type:"end"}}function cf(Q){return{type:"other",description:Q}}function C6(Q){var ve,Me=Dx[Q];if(Me)return Me;for(ve=Q-1;!Dx[ve];)ve--;for(Me={line:(Me=Dx[ve]).line,column:Me.column};ve<Q;)n.charCodeAt(ve)===10?(Me.line++,Me.column=1):Me.column++,ve++;return Dx[Q]=Me,Me}function tM(Q,ve){var Me=C6(Q),wr=C6(ve);return{source:l,start:{offset:Q,line:Me.line,column:Me.column},end:{offset:ve,line:wr.line,column:wr.column}}}function rr(Q){de<Fu||(de>Fu&&(Fu=de,C_=[]),C_.push(Q))}function n$e(Q,ve,Me){return new t(t.buildMessage(Q,ve),Q,ve,Me)}function $oe(){var Q;return(Q=s$e())===o&&(Q=a$e()),Q}function s$e(){var Q,ve;return ht++,Q=de,za(),n.substr(de,4)===h?(ve=h,de+=4):(ve=o,ht===0&&rr(U)),ve!==o?(za(),Fi=Q,Q=cB()):(de=Q,Q=o),ht--,Q===o&&ht===0&&rr(F),Q}function a$e(){var Q,ve;if(Q=[],(ve=pB())!==o)for(;ve!==o;)Q.push(ve),ve=pB();else Q=o;return Q}function pB(){var Q,ve,Me,wr;return Q=de,za(),(ve=l$e())!==o?(za(),(Me=o$e())===o&&(Me=null),za(),n.charCodeAt(de)===41?(wr=p,de++):(wr=o,ht===0&&rr(j)),wr!==o?(za(),Fi=Q,Q=GO(ve,Me)):(de=Q,Q=o)):(de=Q,Q=o),Q}function o$e(){var Q,ve,Me,wr,po,kn,ku,rM;if(Q=de,(ve=mB())!==o){for(Me=[],wr=de,po=za(),n.charCodeAt(de)===44?(kn=m,de++):(kn=o,ht===0&&rr(W)),kn===o&&(kn=null),ku=za(),(rM=mB())!==o?wr=po=[po,kn,ku,rM]:(de=wr,wr=o);wr!==o;)Me.push(wr),wr=de,po=za(),n.charCodeAt(de)===44?(kn=m,de++):(kn=o,ht===0&&rr(W)),kn===o&&(kn=null),ku=za(),(rM=mB())!==o?wr=po=[po,kn,ku,rM]:(de=wr,wr=o);Fi=Q,Q=jO(ve,Me)}else de=Q,Q=o;return Q}function mB(){var Q,ve;return Q=de,(ve=c$e())===o&&(ve=d$e())===o&&(ve=u$e())===o&&(ve=h$e()),ve!==o&&(Fi=Q,ve=qO(ve)),(Q=ve)===o&&(Q=de,(ve=f$e())!==o&&(Fi=Q,ve=HO(ve)),Q=ve),Q}function za(){var Q,ve;for(ht++,Q=[],X.test(n.charAt(de))?(ve=n.charAt(de),de++):(ve=o,ht===0&&rr(q));ve!==o;)Q.push(ve),X.test(n.charAt(de))?(ve=n.charAt(de),de++):(ve=o,ht===0&&rr(q));return ht--,ve=o,ht===0&&rr(Z),Q}function l$e(){var Q,ve,Me;return ht++,Q=de,(ve=Loe())!==o?(n.charCodeAt(de)===40?(Me=g,de++):(Me=o,ht===0&&rr(me)),Me!==o?(Fi=Q,Q=dB(ve)):(de=Q,Q=o)):(de=Q,Q=o),ht--,Q===o&&(ve=o,ht===0&&rr(ee)),Q}function Loe(){var Q,ve,Me;if(ht++,Q=de,ve=[],Y.test(n.charAt(de))?(Me=n.charAt(de),de++):(Me=o,ht===0&&rr(De)),Me!==o)for(;Me!==o;)ve.push(Me),Y.test(n.charAt(de))?(Me=n.charAt(de),de++):(Me=o,ht===0&&rr(De));else ve=o;return ve!==o&&(Fi=Q,ve=uB()),ht--,(Q=ve)===o&&(ve=o,ht===0&&rr(_e)),Q}function c$e(){var Q,ve,Me;return ht++,Q=de,za(),(ve=Nu())!==o?(n.charCodeAt(de)===37?(Me=b,de++):(Me=o,ht===0&&rr(ye)),Me!==o?(Fi=Q,Q=hB(ve)):(de=Q,Q=o)):(de=Q,Q=o),ht--,Q===o&&ht===0&&rr(be),Q}function d$e(){var Q,ve,Me;return ht++,Q=de,za(),(ve=Nu())!==o?(n.substr(de,2)===w?(Me=w,de+=2):(Me=o,ht===0&&rr(Ne)),Me!==o?(Fi=Q,Q=fB(ve)):(de=Q,Q=o)):(de=Q,Q=o),Q===o&&(Q=de,za(),(ve=Nu())!==o?(n.substr(de,2)===v?(Me=v,de+=2):(Me=o,ht===0&&rr(Fr)),Me!==o?(Fi=Q,Q=E6(ve)):(de=Q,Q=o)):(de=Q,Q=o),Q===o&&(Q=de,za(),(ve=Nu())!==o?(n.substr(de,2)===x?(Me=x,de+=2):(Me=o,ht===0&&rr(Br)),Me!==o?(Fi=Q,Q=WO(ve)):(de=Q,Q=o)):(de=Q,Q=o),Q===o&&(Q=de,za(),(ve=Nu())!==o?(n.substr(de,2)===T?(Me=T,de+=2):(Me=o,ht===0&&rr(hr)),Me!==o?(Fi=Q,Q=XO(ve)):(de=Q,Q=o)):(de=Q,Q=o),Q===o&&(Q=de,za(),(ve=Nu())!==o?(n.substr(de,2)===E?(Me=E,de+=2):(Me=o,ht===0&&rr(Gr)),Me!==o?(Fi=Q,Q=YO(ve)):(de=Q,Q=o)):(de=Q,Q=o),Q===o&&(Q=de,za(),(ve=Nu())!==o?(n.substr(de,2)===C?(Me=C,de+=2):(Me=o,ht===0&&rr(mr)),Me!==o?(Fi=Q,Q=Lr(ve)):(de=Q,Q=o)):(de=Q,Q=o)))))),ht--,Q===o&&ht===0&&rr(Ce),Q}function u$e(){var Q,ve,Me;return ht++,Q=de,(ve=Nu())!==o?(n.substr(de,3)===A?(Me=A,de+=3):(Me=o,ht===0&&rr(Qi)),Me!==o?(Fi=Q,Q=fo(ve)):(de=Q,Q=o)):(de=Q,Q=o),Q===o&&(Q=de,(ve=Nu())!==o?(n.substr(de,3)===P?(Me=P,de+=3):(Me=o,ht===0&&rr(yn)),Me!==o?(Fi=Q,Q=Va(ve)):(de=Q,Q=o)):(de=Q,Q=o),Q===o&&(Q=de,(ve=Nu())!==o?(n.substr(de,4)===I?(Me=I,de+=4):(Me=o,ht===0&&rr(st)),Me!==o?(Fi=Q,Q=_c(ve)):(de=Q,Q=o)):(de=Q,Q=o),Q===o&&(Q=de,(ve=Nu())!==o?(n.substr(de,4)===L?(Me=L,de+=4):(Me=o,ht===0&&rr(Di)),Me!==o?(Fi=Q,Q=E_(ve)):(de=Q,Q=o)):(de=Q,Q=o)))),ht--,Q===o&&(ve=o,ht===0&&rr(jr)),Q}function h$e(){var Q,ve;return ht++,Q=de,za(),(ve=Nu())!==o?(Fi=Q,Q=ZO(ve)):(de=Q,Q=o),ht--,Q===o&&ht===0&&rr(da),Q}function f$e(){var Q,ve,Me,wr;if(ht++,Q=de,n.charCodeAt(de)===35?(ve=V,de++):(ve=o,ht===0&&rr(Vo)),ve!==o){if(Me=[],ce.test(n.charAt(de))?(wr=n.charAt(de),de++):(wr=o,ht===0&&rr(of)),wr!==o)for(;wr!==o;)Me.push(wr),ce.test(n.charAt(de))?(wr=n.charAt(de),de++):(wr=o,ht===0&&rr(of));else Me=o;Me!==o?(Fi=Q,Q=QO()):(de=Q,Q=o)}else de=Q,Q=o;return Q===o&&(Q=de,(ve=pB())!==o&&(Fi=Q,ve=JO(ve)),(Q=ve)===o&&(Q=de,(ve=Loe())!==o&&(Fi=Q,ve=KO()),Q=ve)),ht--,Q===o&&(ve=o,ht===0&&rr(Sl)),Q}function Nu(){var Q,ve,Me,wr,po,kn,ku;for(Q=de,se.test(n.charAt(de))?(n.charAt(de),de++):ht===0&&rr(lf),ve=de,Me=[],D.test(n.charAt(de))?(wr=n.charAt(de),de++):(wr=o,ht===0&&rr(zo));wr!==o;)Me.push(wr),D.test(n.charAt(de))?(wr=n.charAt(de),de++):(wr=o,ht===0&&rr(zo));if(n.charCodeAt(de)===46?(wr=G,de++):(wr=o,ht===0&&rr(S_)),wr!==o){if(po=[],D.test(n.charAt(de))?(kn=n.charAt(de),de++):(kn=o,ht===0&&rr(zo)),kn!==o)for(;kn!==o;)po.push(kn),D.test(n.charAt(de))?(kn=n.charAt(de),de++):(kn=o,ht===0&&rr(zo));else po=o;po!==o?ve=Me=[Me,wr,po]:(de=ve,ve=o)}else de=ve,ve=o;if(ve===o)if(ve=[],D.test(n.charAt(de))?(Me=n.charAt(de),de++):(Me=o,ht===0&&rr(zo)),Me!==o)for(;Me!==o;)ve.push(Me),D.test(n.charAt(de))?(Me=n.charAt(de),de++):(Me=o,ht===0&&rr(zo));else ve=o;if(ve!==o){if(Me=de,n.charCodeAt(de)===101?(wr=B,de++):(wr=o,ht===0&&rr(lB)),wr!==o){if(se.test(n.charAt(de))?(po=n.charAt(de),de++):(po=o,ht===0&&rr(lf)),po===o&&(po=null),kn=[],D.test(n.charAt(de))?(ku=n.charAt(de),de++):(ku=o,ht===0&&rr(zo)),ku!==o)for(;ku!==o;)kn.push(ku),D.test(n.charAt(de))?(ku=n.charAt(de),de++):(ku=o,ht===0&&rr(zo));else kn=o;kn!==o?Me=wr=[wr,po,kn]:(de=Me,Me=o)}else de=Me,Me=o;Me===o&&(Me=null),Fi=Q,Q=Vp()}else de=Q,Q=o;return Q}function p$e(Q,ve){return Q.map(function(Me){return Me[ve]})}function m$e(Q,ve,Me){return[Q].concat(p$e(ve,Me))}if((a=u())!==o&&de===n.length)return a;throw a!==o&&de<n.length&&rr(eM()),n$e(C_,Fu<n.length?n.charAt(Fu):null,Fu<n.length?tM(Fu,Fu+1):tM(Fu,Fu))}return e(t,Error),t.prototype.format=function(n){var s="Error: "+this.message;if(this.location){var a,o=null;for(a=0;a<n.length;a++)if(n[a].source===this.location.source){o=n[a].text.split(/\r\n|\n|\r/g);break}var l=this.location.start,c=this.location.source+":"+l.line+":"+l.column;if(o){var u=this.location.end,h=r("",l.line.toString().length),p=o[l.line-1],m=l.line===u.line?u.column:p.length+1;s+=`
 --> `+c+`
`+h+` |
`+l.line+" | "+p+`
`+h+" | "+r("",l.column-1)+r("",m-l.column,"^")}else s+=`
 at `+c}return s},t.buildMessage=function(n,s){var a={literal:function(m){return'"'+l(m.text)+'"'},class:function(m){var g=m.parts.map(function(b){return Array.isArray(b)?c(b[0])+"-"+c(b[1]):c(b)});return"["+(m.inverted?"^":"")+g+"]"},any:function(){return"any character"},end:function(){return"end of input"},other:function(m){return m.description}};function o(m){return m.charCodeAt(0).toString(16).toUpperCase()}function l(m){return m.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(g){return"\\x0"+o(g)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(g){return"\\x"+o(g)})}function c(m){return m.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(g){return"\\x0"+o(g)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(g){return"\\x"+o(g)})}function u(m){return a[m.type](m)}function h(m){var g,b,w=m.map(u);if(w.sort(),w.length>0){for(g=1,b=1;g<w.length;g++)w[g-1]!==w[g]&&(w[b]=w[g],b++);w.length=b}switch(w.length){case 1:return w[0];case 2:return w[0]+" or "+w[1];default:return w.slice(0,-1).join(", ")+", or "+w[w.length-1]}}function p(m){return m?'"'+l(m)+'"':"end of input"}return"Expected "+h(n)+" but "+p(s)+" found."},{SyntaxError:t,parse:i}},(fue=s5e).exports&&(fue.exports=pue());const $ie={deg:1,grad:.9,rad:180/Math.PI,turn:360};function mZe(e){if(e.type!=="quantity"||!(e.value===0&&e.unit===null||e.unit&&$ie[e.unit]!=null))throw new k("effect:type-error",`Expected <angle>, Actual: ${az(e)}`,{term:e})}const Lie={px:1,cm:96/2.54,mm:96/2.54/10,in:96,pc:16,pt:96/72};function gZe(e){if(e.type!=="quantity"||!(e.value===0&&e.unit===null||e.unit&&Lie[e.unit]!=null))throw new k("effect:type-error",`Expected <length>, Actual: ${az(e)}`,{term:e})}function Jf(e){pZe(e);const t=e.value;return nO(t,e),e.unit==="%"?.01*t:t}function yZe(e){return fZe(e),nO(e.value,e),e.value}function bZe(e){return mZe(e),e.value*$ie[e.unit]||0}function Die(e){return gZe(e),e.value*Lie[e.unit]||0}function vZe(e){switch(e.colorType){case"hex":return VVe(e.value);case"named":return a5e(e.value);case"function":return xZe(e.value)}}function a5e(e){if(!swe(e))throw new k("effect:unknown-color",`color '${e}' isn't valid`,{namedColor:e});return kVe(e)}const _Ze=/^rgba?/i,wZe=/^hsla?/i;function xZe(e){if(o6(e.parameters,4),_Ze.test(e.name))return[Jf(e.parameters[0]),Jf(e.parameters[1]),Jf(e.parameters[2]),e.parameters[3]?Jf(e.parameters[3]):1];if(wZe.test(e.name))return awe(yZe(e.parameters[0]),Jf(e.parameters[1]),Jf(e.parameters[2]),e.parameters[3]?Jf(e.parameters[3]):1);throw new k("effect:syntax-error",`Invalid color function '${e.name}'`,{colorFunction:e})}function Fie(e,t,r){var i;try{return SZe(e)}catch(n){(i=r==null?void 0:r.messages)==null||i.push(n)}return null}function Nie(e,t,r,i){try{const n=TZe(e);ud(r,n,t)}catch(n){i.messages&&i.messages.push(n)}}function TZe(e){const t=Iie(e);return t?sZe(t)?t.map(r=>r.toJSON()):t.map(({scale:r,effects:i})=>({scale:r,value:i.map(n=>n.toJSON())})):null}function SZe(e){if(!e||e.length===0)return null;if(EZe(e)){const t=[];for(const r of e)t.push({scale:r.scale,value:gN(r.value)});return t}return gN(e)}function EZe(e){const t=e[0];return!!t&&"scale"in t}function gN(e){if(!e||!e.length)return"";const t=[];for(const r of e){let i=[];switch(r.type){case"grayscale":case"sepia":case"saturate":case"invert":case"brightness":case"contrast":case"opacity":i=[Vm(r,"amount")];break;case"blur":i=[Vm(r,"radius","pt")];break;case"hue-rotate":i=[Vm(r,"angle","deg")];break;case"drop-shadow":i=[Vm(r,"xoffset","pt"),Vm(r,"yoffset","pt"),Vm(r,"blurRadius","pt"),CZe(r,"color")];break;case"bloom":i=[Vm(r,"strength"),Vm(r,"radius","pt"),Vm(r,"threshold")]}const n=`${r.type}(${i.filter(Boolean).join(" ")})`;Iie(n),t.push(n)}return t.join(" ")}function Vm(e,t,r){if(e[t]==null)throw new k("effect:missing-parameter",`Missing parameter '${t}' in ${e.type} effect`,{effect:e});return r?e[t]+r:""+e[t]}function CZe(e,t){if(e[t]==null)throw new k("effect:missing-parameter",`Missing parameter '${t}' in ${e.type} effect`,{effect:e});const r=e[t];return`rgba(${r[0]||0}, ${r[1]||0}, ${r[2]||0}, ${r[3]/255||0})`}const wL=-3;var Bg;(function(e){e[e.ALL=0]="ALL",e[e.SOME=1]="SOME"})(Bg||(Bg={}));class AZe{constructor(t,r,i){this._namespace=t,this._storage=r,this._removeFunc=!1,this._hit=0,this._miss=0,this._storage.register(this),this._namespace+=":",i&&(this._storage.registerRemoveFunc(this._namespace,i),this._removeFunc=!0)}destroy(){this._storage.clear(this._namespace),this._removeFunc&&this._storage.deregisterRemoveFunc(this._namespace),this._storage.deregister(this),this._storage=null}get namespace(){return this._namespace.slice(0,-1)}get hitRate(){return this._hit/(this._hit+this._miss)}get size(){return this._storage.size}get maxSize(){return this._storage.maxSize}resetHitRate(){this._hit=this._miss=0}put(t,r,i,n=0){this._storage.put(this._namespace+t,r,i,n)}get(t){const r=this._storage.get(this._namespace+t);return r===void 0?++this._miss:++this._hit,r}pop(t){const r=this._storage.pop(this._namespace+t);return r===void 0?++this._miss:++this._hit,r}updateSize(t,r,i){this._storage.updateSize(this._namespace+t,r,i)}clear(){this._storage.clear(this._namespace)}clearAll(){this._storage.clearAll()}getStats(){return this._storage.getStats()}resetStats(){this._storage.resetStats()}}class kie{constructor(t=10485760){this._maxSize=t,this._db=new Map,this._size=0,this._hit=0,this._miss=0,this._removeFuncs=new Qt,this._users=new Qt}destroy(){this.clearAll(),this._removeFuncs.clear(),this._users.clear(),this._db=null}register(t){this._users.push(t)}deregister(t){this._users.removeUnordered(t)}registerRemoveFunc(t,r){this._removeFuncs.push([t,r])}deregisterRemoveFunc(t){this._removeFuncs.filterInPlace(r=>r[0]!==t)}get size(){return this._size}get maxSize(){return this._maxSize}set maxSize(t){this._maxSize=Math.max(t,0),this._checkSizeLimit()}put(t,r,i,n){const s=this._db.get(t);if(s&&(this._size-=s.size,this._db.delete(t),s.entry!==r&&this._notifyRemove(t,s.entry,Bg.ALL)),i>this._maxSize)return void this._notifyRemove(t,r,Bg.ALL);if(r===void 0)return void console.warn("Refusing to cache undefined entry ");if(!i||i<0)return void console.warn("Refusing to cache entry with invalid size "+i);const a=1+Math.max(n,wL)-wL;this._db.set(t,{entry:r,size:i,lifetime:a,lives:a}),this._size+=i,this._checkSizeLimit()}updateSize(t,r,i){const n=this._db.get(t);if(n&&n.entry===r){for(this._size-=n.size;i>this._maxSize;){const s=this._notifyRemove(t,r,Bg.SOME);if(!(_(s)&&s>0))return void this._db.delete(t);i=s}n.size=i,this._size+=i,this._checkSizeLimit()}}pop(t){const r=this._db.get(t);if(r)return this._size-=r.size,this._db.delete(t),++this._hit,r.entry;++this._miss}get(t){const r=this._db.get(t);if(r!==void 0)return this._db.delete(t),r.lives=r.lifetime,this._db.set(t,r),++this._hit,r.entry;++this._miss}getStats(){const t={Size:Math.round(this._size/1048576)+"/"+Math.round(this._maxSize/1048576)+"MB","Hit rate":Math.round(100*this._getHitRate())+"%",Entries:this._db.size.toString()},r={},i=new Array;this._db.forEach((a,o)=>{const l=a.lifetime;i[l]=(i[l]||0)+a.size,this._users.forAll(c=>{const u=c.namespace;if(o.startsWith(u)){const h=r[u]||0;r[u]=h+a.size}})});const n={};this._users.forAll(a=>{const o=a.namespace;if(!isNaN(a.hitRate)&&a.hitRate>0){const l=r[o]||0;r[o]=l,n[o]=Math.round(100*a.hitRate)+"%"}else n[o]="0%"});const s=Object.keys(r);s.sort((a,o)=>r[o]-r[a]),s.forEach(a=>t[a]=Math.round(r[a]/2**20)+"MB / "+n[a]);for(let a=i.length-1;a>=0;--a){const o=i[a];o&&(t["Priority "+(a+wL-1)]=Math.round(o/this.size*100)+"%")}return t}resetStats(){this._hit=this._miss=0,this._users.forAll(t=>t.resetHitRate())}clear(t){this._db.forEach((r,i)=>{i.startsWith(t)&&(this._size-=r.size,this._db.delete(i),this._notifyRemove(i,r.entry,Bg.ALL))})}clearAll(){this._db.forEach((t,r)=>this._notifyRemove(r,t.entry,Bg.ALL)),this._size=0,this._db.clear()}_getHitRate(){return this._hit/(this._hit+this._miss)}_notifyRemove(t,r,i){let n;return this._removeFuncs.some(s=>{if(t.startsWith(s[0])){const a=s[1](r,i);return typeof a=="number"&&(n=a),!0}return!1}),n}_checkSizeLimit(){if(!(this._size<=this._maxSize))for(const[t,r]of this._db){if(this._db.delete(t),r.lives<=1){this._size-=r.size;const i=this._notifyRemove(t,r.entry,Bg.SOME);_(i)&&i>0&&(this._size+=i,r.lives=r.lifetime,r.size=i,this._db.set(t,r))}else--r.lives,this._db.set(t,r);if(this._size<=.9*this.maxSize)return}}}class RZe{constructor(t,r){this._storage=new kie,this._storage.maxSize=t,r&&this._storage.registerRemoveFunc("",r)}put(t,r){this._storage.put(t,r,1,1)}pop(t){return this._storage.pop(t)}get(t){return this._storage.get(t)}clear(){this._storage.clearAll()}destroy(){this._storage.destroy()}}function OZe(e){return typeof e=="function"}function d$t(e,t,r,i){return OZe(e)?e(t,r,i):e}function u$t(e){return[e.r,e.g,e.b,e.a]}function h$t(e,t,r){const i=` /-,
`,n=l=>{let c=l.length;for(;c--;)if(!i.includes(l.charAt(c)))return!1;return!0},s=[];let a=0,o=-1;do if(o=t.indexOf("[",a),o>=a){if(o>a){const l=t.substr(a,o-a);s.push([l,null,n(l)])}if(a=o+1,o=t.indexOf("]",a),o>=a){if(o>a){const l=e[t.substr(a,o-a)];l&&s.push([null,l,!1])}a=o+1}}while(o!==-1);if(a<t.length-1){const l=t.substr(a);s.push([l,null,n(l)])}return l=>{let c="",u=null;for(const h of s){const[p,m,g]=h;if(p)g?u=p:(u&&(c+=u,u=null),c+=p);else{const b=l.attributes[m];b&&(u&&(c+=u,u=null),c+=b)}}return MZe(c,r)}}function MZe(e,t){switch(typeof e!="string"&&(e=String(e)),t){case"LowerCase":return e.toLowerCase();case"Allcaps":return e.toUpperCase();default:return e}}function f$t(e,t,r,i,n,s,a=!0){const o=t/n,l=r/s,c=Math.ceil(o/2),u=Math.ceil(l/2);for(let h=0;h<s;h++)for(let p=0;p<n;p++){const m=4*(p+(a?s-h-1:h)*n);let g=0,b=0,w=0,v=0,x=0,T=0,E=0;const C=(h+.5)*l;for(let A=Math.floor(h*l);A<(h+1)*l;A++){const P=Math.abs(C-(A+.5))/u,I=(p+.5)*o,L=P*P;for(let V=Math.floor(p*o);V<(p+1)*o;V++){let G=Math.abs(I-(V+.5))/c;const B=Math.sqrt(L+G*G);B>=-1&&B<=1&&(g=2*B*B*B-3*B*B+1,g>0&&(G=4*(V+A*t),E+=g*e[G+3],w+=g,e[G+3]<255&&(g=g*e[G+3]/250),v+=g*e[G],x+=g*e[G+1],T+=g*e[G+2],b+=g))}}i[m]=v/b,i[m+1]=x/b,i[m+2]=T/b,i[m+3]=E/w}}function PZe(e){return e?{r:e[0],g:e[1],b:e[2],a:e[3]/255}:{r:0,g:0,b:0,a:0}}function oz(e){var t;return(t=e.data)==null?void 0:t.symbol}function yN(e){return e.type==="CIMVectorMarker"||e.type==="CIMPictureMarker"||e.type==="CIMBarChartMarker"||e.type==="CIMCharacterMarker"||e.type==="CIMPieChartMarker"||e.type==="CIMStackedBarChartMarker"}function bN(e){return e.type==="CIMGradientStroke"||e.type==="CIMPictureStroke"||e.type==="CIMSolidStroke"}function o5e(e){return e.type==="CIMGradientFill"||e.type==="CIMHatchFill"||e.type==="CIMPictureFill"||e.type==="CIMSolidFill"||e.type==="CIMWaterFill"}function vN(e){return e.type==="CIMMarkerPlacementAlongLineRandomSize"||e.type==="CIMMarkerPlacementAlongLineSameSize"||e.type==="CIMMarkerPlacementAlongLineVariableSize"||e.type==="CIMMarkerPlacementAtExtremities"||e.type==="CIMMarkerPlacementAtMeasuredUnits"||e.type==="CIMMarkerPlacementAtRatioPositions"||e.type==="CIMMarkerPlacementOnLine"||e.type==="CIMMarkerPlacementOnVertices"}const p$t=e=>isNaN(e)||!e?0:e,m$t=e=>{if(!e)return!1;for(const t of e)switch(t.type){case"CIMGeometricEffectBuffer":case"CIMGeometricEffectOffset":return!0}return!1};function g$t(){return ie(()=>import("./geometryEngineJSON.ba1441a3.js"),["geometryEngineJSON.ba1441a3.js","geometryEngineBase.0f0d7ecf.js","geometryEngineJSON.5a1f200e.js","json.8bd707cf.js"],import.meta.url)}function IZe(e){const t=oz(e);if(t.type==="CIMTextSymbol")return t.height;let r=0;if(t.symbolLayers)for(const i of t.symbolLayers)yN(i)&&i.size>r?r=i.size:bN(i)&&i.width>r?r=i.width:o5e(i);return r}function y$t(e,t,r){const i=oz(e),n=IZe(e);if(n===0)return void $Ze(i,t);Vie(i,t/n,!1,r)}function $Ze(e,t){if(e.type!=="CIMTextSymbol"){if(e.symbolLayers)for(const r of e.symbolLayers)switch(r.type){case"CIMPictureMarker":case"CIMVectorMarker":r.size=t;break;case"CIMPictureStroke":case"CIMSolidStroke":r.width=t}}else e.height=t}function Vie(e,t,r,i){if(e.type!=="CIMTextSymbol"){if(r&&e.effects)for(const n of e.effects)FZe(n,t);if(e.symbolLayers)for(const n of e.symbolLayers)switch(n.type){case"CIMPictureMarker":case"CIMVectorMarker":LZe(n,t,i);break;case"CIMPictureStroke":case"CIMSolidStroke":!(i!=null&&i.preserveOutlineWidth)&&n.width&&(n.width*=t);break;case"CIMPictureFill":n.height&&(n.height*=t),n.offsetX&&(n.offsetX*=t),n.offsetY&&(n.offsetY*=t);break;case"CIMHatchFill":Vie(n.lineSymbol,t,!0,{...i,preserveOutlineWidth:!1}),n.offsetX&&(n.offsetX*=t),n.offsetY&&(n.offsetY*=t),n.separation&&(n.separation*=t)}}else e.height*=t}function LZe(e,t,r){if(e.markerPlacement&&DZe(e.markerPlacement,t),e.offsetX&&(e.offsetX*=t),e.offsetY&&(e.offsetY*=t),e.anchorPoint&&e.anchorPointUnits==="Absolute"&&(e.anchorPoint={x:e.anchorPoint.x*t,y:e.anchorPoint.y*t}),e.size*=t,e.type==="CIMVectorMarker"&&e.markerGraphics)for(const i of e.markerGraphics)e.scaleSymbolsProportionally||Vie(i.symbol,t,!0,r)}function DZe(e,t){switch(vN(e)&&e.offset&&(e.offset*=t),e.type){case"CIMMarkerPlacementAlongLineRandomSize":case"CIMMarkerPlacementAlongLineSameSize":if(e.customEndingOffset&&(e.customEndingOffset*=t),e.offsetAlongLine&&(e.offsetAlongLine*=t),e.placementTemplate&&e.placementTemplate.length){const r=e.placementTemplate.map(i=>i*t);e.placementTemplate=r}break;case"CIMMarkerPlacementAlongLineVariableSize":if(e.maxRandomOffset&&(e.maxRandomOffset*=t),e.placementTemplate&&e.placementTemplate.length){const r=e.placementTemplate.map(i=>i*t);e.placementTemplate=r}break;case"CIMMarkerPlacementOnLine":e.startPointOffset&&(e.startPointOffset*=t);break;case"CIMMarkerPlacementAtExtremities":e.offsetAlongLine&&(e.offsetAlongLine*=t);break;case"CIMMarkerPlacementAtMeasuredUnits":case"CIMMarkerPlacementOnVertices":break;case"CIMMarkerPlacementAtRatioPositions":e.beginPosition&&(e.beginPosition*=t),e.endPosition&&(e.endPosition*=t);break;case"CIMMarkerPlacementPolygonCenter":e.offsetX&&(e.offsetX*=t),e.offsetY&&(e.offsetY*=t);break;case"CIMMarkerPlacementInsidePolygon":e.offsetX&&(e.offsetX*=t),e.offsetY&&(e.offsetY*=t),e.stepX&&(e.stepX*=t),e.stepY&&(e.stepY*=t)}}function FZe(e,t){switch(e.type){case"CIMGeometricEffectArrow":case"CIMGeometricEffectDonut":e.width&&(e.width*=t);break;case"CIMGeometricEffectBuffer":e.size&&(e.size*=t);break;case"CIMGeometricEffectCut":e.beginCut&&(e.beginCut*=t),e.endCut&&(e.endCut*=t),e.middleCut&&(e.middleCut*=t);break;case"CIMGeometricEffectDashes":if(e.customEndingOffset&&(e.customEndingOffset*=t),e.offsetAlongLine&&(e.offsetAlongLine*=t),e.dashTemplate&&e.dashTemplate.length){const r=e.dashTemplate.map(i=>i*t);e.dashTemplate=r}break;case"CIMGeometricEffectExtension":case"CIMGeometricEffectJog":case"CIMGeometricEffectRadial":e.length&&(e.length*=t);break;case"CIMGeometricEffectMove":e.offsetX&&(e.offsetX*=t),e.offsetY&&(e.offsetY*=t);break;case"CIMGeometricEffectOffset":case"CIMGeometricEffectOffsetTangent":e.offset&&(e.offset*=t);break;case"CIMGeometricEffectRegularPolygon":e.radius&&(e.radius*=t);break;case"CIMGeometricEffectTaperedPolygon":e.fromWidth&&(e.fromWidth*=t),e.length&&(e.length*=t),e.toWidth&&(e.toWidth*=t);break;case"CIMGeometricEffectWave":e.amplitude&&(e.amplitude*=t),e.period&&(e.period*=t)}}function NZe(e){const t=[];return CZ(oz(e),t),t.length?new Te(PZe(t[0])):null}function CZ(e,t){let r;r=e.type==="CIMTextSymbol"?e.symbol:e;const i=e.type==="CIMPolygonSymbol";if(r.symbolLayers){for(const n of r.symbolLayers)if(!(n.colorLocked||i&&(bN(n)||yN(n)&&n.markerPlacement&&vN(n.markerPlacement))))switch(n.type){case"CIMPictureMarker":case"CIMPictureStroke":case"CIMPictureFill":n.tintColor&&gue(t,n.tintColor);break;case"CIMVectorMarker":n.markerGraphics.forEach(s=>{CZ(s.symbol,t)});break;case"CIMSolidStroke":case"CIMSolidFill":gue(t,n.color);break;case"CIMHatchFill":CZ(n.lineSymbol,t)}}}function gue(e,t){for(const r of e)if(r.join(".")===t.join("."))return;e.push(t)}function l5e(e,t,r){t instanceof Te||(t=new Te(t));const i=oz(e);i&&AZ(i,t,r)}function AZ(e,t,r){let i;i=e.type==="CIMTextSymbol"?e.symbol:e;const n=i.type==="CIMPolygonSymbol";if(i.symbolLayers)for(const s of i.symbolLayers){if(s.colorLocked)continue;if(n){if(r){const{layersToColor:o}=r;if((bN(s)||yN(s)&&s.markerPlacement&&vN(s.markerPlacement))&&o==="fill"||o5e(s)&&o==="outline")continue}else if(bN(s)||yN(s)&&s.markerPlacement&&vN(s.markerPlacement))continue}const a=t.toArray();switch(s.type){case"CIMPictureMarker":case"CIMPictureStroke":case"CIMPictureFill":s.tintColor=a;break;case"CIMVectorMarker":s.markerGraphics.forEach(o=>{AZ(o.symbol,t,r)});break;case"CIMSolidStroke":case"CIMSolidFill":s.color=a;break;case"CIMHatchFill":AZ(s.lineSymbol,t,r)}}}const c5e="picture-fill",d5e="simple-fill",kZe="simple-line",u5e="simple-marker",VZe="text",zZe="cim",MG=new RZe(1e3);function UZe(e){const t=e.style;let r=null;if(e)switch(e.type){case u5e:t!=="cross"&&t!=="x"&&(r=e.color);break;case d5e:t==="solid"?r=e.color:t!=="none"&&(r={type:"pattern",x:0,y:0,src:xr(`esri/symbols/patterns/${t}.png`),width:5,height:5});break;case c5e:r={type:"pattern",src:e.url,width:ur(e.width)*e.xscale,height:ur(e.height)*e.yscale,x:ur(e.xoffset),y:ur(e.yoffset)};break;case VZe:r=e.color;break;case zZe:r=NZe(e)}return r}function BZe(e,t){const r=e+"-"+t;return MG.get(r)!==void 0?Promise.resolve(MG.get(r)):qt(e,{responseType:"image"}).then(i=>{const n=i.data,s=n.naturalWidth,a=n.naturalHeight,o=document.createElement("canvas");o.width=s,o.height=a;const l=o.getContext("2d");l.fillStyle=t,l.fillRect(0,0,s,a),l.globalCompositeOperation="destination-in",l.drawImage(n,0,0);const c=o.toDataURL();return MG.put(r,c),c})}function xA(e){if(!e)return null;let t;switch(e.type){case d5e:case c5e:case u5e:t=xA(e.outline);break;case kZe:{const r=ur(e.width);e.style!=="none"&&r!==0&&(t={color:e.color,style:zie(e.style),width:r,cap:e.cap,join:e.join==="miter"?ur(e.miterLimit):e.join});break}default:t=null}return t}const zie=(()=>{const e={};return t=>{if(e[t])return e[t];const r=t.replace(/-/g,"");return e[t]=r,r}})(),GZe=new Te([128,128,128]),yue=/\/resource\/(.*?)\.svg$/,jZe=new Te("white");function qZe(e){const t=e.symbolLayers&&e.symbolLayers.length;if(!t)return;const r=e.symbolLayers.getItemAt(t-1);return"outline"in r?Vi(r,"outline","size"):void 0}function HZe(e){if(!e)return 0;if(hm(e)){const r=qZe(e);return _(r)?r:0}const t=xA(e);return t&&zs(t.width)||0}function lz(e){if(R(e)||!("symbolLayers"in e)||R(e.symbolLayers))return!1;switch(e.type){case"point-3d":return e.symbolLayers.some(t=>t.type==="object");case"line-3d":return e.symbolLayers.some(t=>t.type==="path");case"polygon-3d":return e.symbolLayers.some(t=>t.type==="object"||t.type==="extrude");default:return!1}}function h5e(e,t){const r=t.resource.href;return!ue("esri-canvas-svg-support")&&e.styleOrigin&&yue.test(r)?r.replace(yue,"/resource/png/$1.png"):r}function Ux(e,t){if(!e)return null;let r=null;return hm(e)?r=WZe(e):IV(e)&&(r=e.color?new Te(e.color):null),r?TA(r,t):null}function WZe(e){const t=e.symbolLayers;if(!t)return null;let r=null;return t.forEach(i=>{i.type==="object"&&i.resource.href!=null||(r=i.type==="water"?i.color:_(i.material)?i.material.color:null)}),r?new Te(r):null}function TA(e,t){if(t==null)return e;const r=e.toRgba();return r[3]=r[3]*t,new Te(r)}function XZe(e,t,r){const i=e.symbolLayers;if(!i)return;const n=s=>{const a=_(s)?s:null;return TA(t=t||a||r!=null&&jZe,r)};i.forEach(s=>{if(s.type!=="object"||s.resource.href==null||t)if(s.type==="water")s.color=n(s.color);else{const a=_(s.material)?s.material.color:null,o=n(a);R(s.material)?s.material=new yu({color:o}):s.material.color=o,r!=null&&"outline"in s&&_(s.outline)&&_(s.outline.color)&&(s.outline.color=TA(s.outline.color,r))}})}function YZe(e,t,r){(t=t||e.color)&&(e.color=TA(t,r)),r!=null&&"outline"in e&&e.outline&&e.outline.color&&(e.outline.color=TA(e.outline.color,r))}function PG(e,t,r){e&&(t||r!=null)&&(t&&(t=new Te(t)),hm(e)?XZe(e,t,r):IV(e)&&YZe(e,t,r))}async function ZZe(e,t){const r=e.symbolLayers;r&&await dV(r,async i=>QZe(i,t))}async function QZe(e,t){switch(e.type){case"extrude":KZe(e,t);break;case"icon":case"line":case"text":JZe(e,t);break;case"path":tQe(e,t);break;case"object":await eQe(e,t)}}function JZe(e,t){const r=f5e(t);_(r)&&(e.size=r)}function f5e(e){for(const t of e)if(typeof t=="number")return t;return null}function KZe(e,t){e.size=typeof t[2]=="number"?t[2]:0}async function eQe(e,t){const{resourceSize:r,symbolSize:i}=await rQe(e),n=p5e(t,r,i);e.width=QC(t[0],i[0],r[0],n),e.depth=QC(t[1],i[1],r[1],n),e.height=QC(t[2],i[2],r[2],n)}function tQe(e,t){const r=p5e(t,X0,[e.width,void 0,e.height]);e.width=QC(t[0],e.width,1,r),e.height=QC(t[2],e.height,1,r)}function p5e(e,t,r){for(let i=0;i<3;i++){const n=e[i];switch(n){case"symbol-value":return r[i]!=null?r[i]/t[i]:1;case"proportional":break;default:if(n&&t[i])return n/t[i]}}return 1}async function rQe(e){const t=await ie(()=>import("./symbolLayerUtils.2aabb290.js"),[],import.meta.url),r=await t.computeObjectLayerResourceSize(e,10),{width:i,height:n,depth:s}=e,a=[i,s,n];let o=1;for(let l=0;l<3;l++)if(a[l]!=null){o=a[l]/r[l];break}for(let l=0;l<3;l++)a[l]==null&&(a[l]=r[l]*o);return{resourceSize:r,symbolSize:a}}function QC(e,t,r,i){switch(e){case"proportional":return r*i;case"symbol-value":return t!=null?t:r;default:return e}}function iQe(e,t){const r=f5e(t);if(!R(r))switch(e.type){case"simple-marker":e.size=r;break;case"picture-marker":{const i=e.width/e.height;i>1?(e.width=r,e.height=r*i):(e.width=r*i,e.height=r);break}case"simple-line":e.width=r;break;case"text":e.font.size=r}}async function nQe(e,t){if(e&&t)return hm(e)?ZZe(e,t):void(IV(e)&&iQe(e,t))}function sQe(e,t,r){if(e&&t!=null)if(hm(e)){const i=e.symbolLayers;i&&i.forEach(n=>{if(n&&n.type==="object")switch(r){case"tilt":n.tilt=t;break;case"roll":n.roll=t;break;default:n.heading=t}})}else IV(e)&&(e.type!=="simple-marker"&&e.type!=="picture-marker"&&e.type!=="text"||(e.angle=t))}function SA(e){if(!e)return null;const t=e.effects.filter(r=>r.type!=="bloom").map(r=>r.toJSON());return gN(t)}const m5e="<",g5e=">",aQe=QR("short-date");function y5e(e,t,r,i){let n="";t===0?n=`${m5e} `:t===r&&(n=`${g5e} `);let s=null;return s=i?Ip(e,aQe):t5e(e),n+s}const oQe=["data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAAAAAAAAAHqZRakAAAANUlEQVQ4jWPMy8v7z0BFwMLAwMAwcdIkqhiWn5fHwEQVk5DAqIGjBo4aOGrgqIEQwEjtKgAATl0Hu6JrzFUAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAAAAAAAAAHqZRakAAAANUlEQVQ4jWPMy8v7z0BFwMLAwMAwaeIkqhiWl5/HwEQVk5DAqIGjBo4aOGrgqIEQwEjtKgAATl0Hu6sKxboAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAAAAAAAAAHqZRakAAAANUlEQVQ4jWPMy8v7z0BFwMLAwMAwadJEqhiWl5fPwEQVk5DAqIGjBo4aOGrgqIEQwEjtKgAATl0Hu75+IUcAAAAASUVORK5CYII="];async function RZ(e){if(!("visualVariables"in e)||!e.visualVariables)return null;const t=e.visualVariables.find(a=>a.type==="color");if(!t)return null;let r=null,i=null;if(t.stops){if(t.stops.length===1)return t.stops[0].color;r=t.stops[0].value,i=t.stops[t.stops.length-1].value}const n=r+(i-r)/2,{getColor:s}=await ie(()=>Promise.resolve().then(()=>Px),void 0,import.meta.url);return s(t,n)}async function b5e(e,t){const r=e.trailCap,i=e.trailWidth||1,n=t||await RZ(e)||e.color;return new bc({cap:r,color:n,width:i})}const lQe=new Te([64,64,64]);function v5e(e,t){const r=[],i=e.length-1;return e.length===5?r.push(0,2,4):r.push(0,i),e.map((n,s)=>r.includes(s)?y5e(n,s,i,t):null)}async function OZ(e,t,r){let i=!1,n=[],s=[];if(e.stops){const c=e.stops;n=c.map(u=>u.value),i=c.some(u=>!!u.label),i&&(s=c.map(u=>u.label))}const a=n[0],o=n[n.length-1];if(a==null&&o==null)return null;const l=i?null:v5e(n,r);return(await Promise.all(n.map(async(c,u)=>({value:c,color:e.type==="opacity"?await cQe(c,e,t):(await ie(()=>Promise.resolve().then(()=>Px),void 0,import.meta.url)).getColor(e,c),label:i?s[u]:l[u]})))).reverse()}async function cQe(e,t,r=lQe){const i=new Te(r),n=(await ie(()=>Promise.resolve().then(()=>Px),void 0,import.meta.url)).getOpacity(t,e);return n!=null&&(i.a=n),i}function dQe(e){let t=!1,r=[],i=[];r=e.map(o=>o.value),t=e.some(o=>!!o.label),t&&(i=e.map(o=>o.label));const n=r[0],s=r[r.length-1];if(n==null&&s==null)return null;const a=t?null:v5e(r,!1);return r.map((o,l)=>({value:o,color:_5e(o,e),label:t?i[l]:a[l]})).reverse()}function _5e(e,t){const{startIndex:r,endIndex:i,weight:n}=uQe(e,t);if(r===i)return t[r].color;const s=Te.blendColors(t[r].color,t[i].color,n);return new Te(s)}function uQe(e,t){let r=0,i=t.length-1;return t.some((n,s)=>e<n.value?(i=s,!0):(r=s,!1)),{startIndex:r,endIndex:i,weight:(e-t[r].value)/(t[i].value-t[r].value)}}function hQe(e,t){let r=[];if(e&&e.type==="multipart")e.colorRamps.reverse().forEach((i,n)=>{n===0?r.push({value:t.max,color:new Te(i.toColor),label:"high"}):r.push({value:null,color:new Te(i.toColor),label:""}),n===e.colorRamps.length-1?r.push({value:t.min,color:new Te(i.fromColor),label:"low"}):r.push({value:null,color:new Te(i.fromColor),label:""})});else{let i,n;e&&e.type==="algorithmic"?(i=e.fromColor,n=e.toColor):(i=[0,0,0,1],n=[255,255,255,1]),r=[{value:t.max,color:new Te(n),label:"high"},{value:t.min,color:new Te(i),label:"low"}]}return r}var MZ;let $E=MZ=class extends ge{constructor(e){super(e),this.color=null,this.ratio=null}clone(){return new MZ({color:this.color,ratio:this.ratio})}};d([f({type:Te,json:{type:[$i],default:null,write:!0}})],$E.prototype,"color",void 0),d([f({type:Number,json:{write:!0}})],$E.prototype,"ratio",void 0),$E=MZ=d([$("esri.renderers.support.HeatmapColorStop")],$E);const JC=$E;function w5e(e){if(!e.colorStops)return[];const t=[...e.colorStops].filter(i=>{var n;return((n=i.color)==null?void 0:n.a)>0});let r=t.length-1;if(t&&t[0]){const i=t[r];i&&i.ratio!==1&&(t.push(new JC({ratio:1,color:i.color})),r++)}return t.map((i,n)=>{var a,o;let s="";return n===0?s=((a=e.legendOptions)==null?void 0:a.minLabel)||"low":n===r&&(s=((o=e.legendOptions)==null?void 0:o.maxLabel)||"high"),{color:i.color,label:s,ratio:i.ratio}}).reverse()}fe.getLogger("esri.renderers.support.utils");const fQe={millisecond:0,second:1,minute:2,hour:3,day:4,month:5,year:6},pQe={millisecond:"long-month-day-year-long-time",second:"long-month-day-year-long-time",minute:"long-month-day-year-short-time",hour:"long-month-day-year-short-time",day:"long-month-day-year",month:"long-month-day-year",year:"year"};function _d(e,t,r){Ote(e,t,()=>[]).push(...r)}async function mQe(e){var r,i;const t=new Map;if("visualVariables"in e&&e.visualVariables){const n=e.visualVariables.filter(s=>s.type==="color");for(const s of n){const a=s.field||s.valueExpression,o=(await OZ(s)).map(l=>l.color);_d(t,a,o)}}if(e.type==="heatmap"){const n=w5e(e).map(s=>s.color);_d(t,e.field,n)}else if(e.type==="pie-chart"){for(const n of e.attributes)_d(t,n.field,[n.color]);_d(t,null,[(r=e==null?void 0:e.othersCategory)==null?void 0:r.color,Ux(e.backgroundFillSymbol,null)])}else if(e.type==="dot-density"){for(const n of e.attributes)_d(t,n.field,[n.color]);_d(t,null,[e.backgroundColor])}else if(e.type==="unique-value")if(((i=e.authoringInfo)==null?void 0:i.type)==="predominance")for(const n of e.uniqueValueInfos)_d(t,n.value.toString(),[Ux(n.symbol,null)]);else{const n=e.uniqueValueInfos.map(c=>Ux(c.symbol,null)),{field:s,field2:a,field3:o,valueExpression:l}=e;(s||l)&&_d(t,s||l,n),a&&_d(t,a,n),o&&_d(t,o,n)}else if(e.type==="class-breaks"){const n=e.classBreakInfos.map(s=>Ux(s.symbol,null));_d(t,e.field||e.valueExpression,n)}else e.type==="simple"&&_d(t,null,[Ux(e.symbol,null)]);return"defaultSymbol"in e&&e.defaultSymbol&&_d(t,null,[Ux(e.defaultSymbol,null)]),t.forEach((n,s)=>{const a=zR(n.filter(Boolean),(o,l)=>JSON.stringify(o)===JSON.stringify(l));t.set(s,a)}),t}function gQe(e){const t=e.map(s=>new Date(s)),r=t.length;let i=1/0,n=null;for(let s=0;s<r-1;s++){const a=t[s];let o=1/0,l=null;for(let c=s+1;c<r;c++){const u=t[c],h=(a.getFullYear()!==u.getFullYear()?"year":a.getMonth()!==u.getMonth()&&"month")||a.getDate()!==u.getDate()&&"day"||a.getHours()!==u.getHours()&&"hour"||a.getMinutes()!==u.getMinutes()&&"minute"||a.getSeconds()!==u.getSeconds()&&"second"||"millisecond",p=fQe[h];p<o&&(o=p,l=h)}o<i&&(i=o,n=l)}return n}function bue(e){const{value:t,domain:r,fieldInfo:i,dateFormatInterval:n}=e;let s=String(t);const a=r&&"codedValues"in r&&r.codedValues?r.getName(t):null;return a?s=a:typeof t=="number"&&(s=i&&i.type==="date"?Ip(t,n&&QR(pQe[n])):t5e(t)),s}var PZ;let LE=PZ=class extends ge{constructor(e){super(e),this.name=null,this.code=null}clone(){return new PZ({name:this.name,code:this.code})}};d([f({type:String,json:{write:!0}})],LE.prototype,"name",void 0),d([f({type:[String,Number],json:{write:!0}})],LE.prototype,"code",void 0),LE=PZ=d([$("esri.layers.support.CodedValue")],LE);const yQe=new tr({inherited:"inherited",codedValue:"coded-value",range:"range"});let DE=class extends ge{constructor(e){super(e),this.name=null,this.type=null}};d([f({type:String,json:{write:!0}})],DE.prototype,"name",void 0),d([Ze(yQe)],DE.prototype,"type",void 0),DE=d([$("esri.layers.support.Domain")],DE);const cz=DE;var IZ;let FE=IZ=class extends cz{constructor(e){super(e),this.codedValues=null,this.type="coded-value"}getName(e){let t=null;if(this.codedValues){const r=String(e);this.codedValues.some(i=>(String(i.code)===r&&(t=i.name),!!t))}return t}clone(){return new IZ({codedValues:te(this.codedValues),name:this.name})}};d([f({type:[LE],json:{write:!0}})],FE.prototype,"codedValues",void 0),d([Ze({codedValue:"coded-value"})],FE.prototype,"type",void 0),FE=IZ=d([$("esri.layers.support.CodedValueDomain")],FE);const x5e=FE;var $Z;let xL=$Z=class extends cz{constructor(e){super(e),this.type="inherited"}clone(){return new $Z}};d([Ze({inherited:"inherited"})],xL.prototype,"type",void 0),xL=$Z=d([$("esri.layers.support.InheritedDomain")],xL);const T5e=xL;var LZ;let dS=LZ=class extends cz{constructor(e){super(e),this.maxValue=null,this.minValue=null,this.type="range"}clone(){return new LZ({maxValue:this.maxValue,minValue:this.minValue,name:this.name})}};d([f({type:Number,json:{type:[Number],read:{source:"range",reader:(e,t)=>t.range&&t.range[1]},write:{enabled:!1,overridePolicy(){return{enabled:this.maxValue!=null&&this.minValue==null}},target:"range",writer(e,t,r){t[r]=[this.minValue||0,e]}}}})],dS.prototype,"maxValue",void 0),d([f({type:Number,json:{type:[Number],read:{source:"range",reader:(e,t)=>t.range&&t.range[0]},write:{target:"range",writer(e,t,r){t[r]=[e,this.maxValue||0]}}}})],dS.prototype,"minValue",void 0),d([Ze({range:"range"})],dS.prototype,"type",void 0),dS=LZ=d([$("esri.layers.support.RangeDomain")],dS);const S5e=dS,E5e={key:"type",base:cz,typeMap:{range:S5e,"coded-value":x5e,inherited:T5e}};function Uie(e){if(!e||!e.type)return null;switch(e.type){case"range":return S5e.fromJSON(e);case"codedValue":return x5e.fromJSON(e);case"inherited":return T5e.fromJSON(e)}return null}const Bie=new tr({esriFieldTypeSmallInteger:"small-integer",esriFieldTypeInteger:"integer",esriFieldTypeSingle:"single",esriFieldTypeDouble:"double",esriFieldTypeLong:"long",esriFieldTypeString:"string",esriFieldTypeDate:"date",esriFieldTypeOID:"oid",esriFieldTypeGeometry:"geometry",esriFieldTypeBlob:"blob",esriFieldTypeRaster:"raster",esriFieldTypeGUID:"guid",esriFieldTypeGlobalID:"global-id",esriFieldTypeXML:"xml"});var DZ;const bQe=new tr({binary:"binary",coordinate:"coordinate",countOrAmount:"count-or-amount",dateAndTime:"date-and-time",description:"description",locationOrPlaceName:"location-or-place-name",measurement:"measurement",nameOrTitle:"name-or-title",none:"none",orderedOrRanked:"ordered-or-ranked",percentageOrRatio:"percentage-or-ratio",typeOrCategory:"type-or-category",uniqueIdentifier:"unique-identifier"});let Fl=DZ=class extends ge{constructor(e){super(e),this.alias=null,this.defaultValue=void 0,this.description=null,this.domain=null,this.editable=!0,this.length=-1,this.name=null,this.nullable=!0,this.type=null,this.valueType=null}readDescription(e,{description:t}){let r;try{r=JSON.parse(t)}catch{}return r?r.value:null}readValueType(e,{description:t}){let r;try{r=JSON.parse(t)}catch{}return r?bQe.fromJSON(r.fieldValueType):null}clone(){return new DZ({alias:this.alias,defaultValue:this.defaultValue,description:this.description,domain:this.domain&&this.domain.clone()||null,editable:this.editable,length:this.length,name:this.name,nullable:this.nullable,type:this.type,valueType:this.valueType})}};d([f({type:String,json:{write:!0}})],Fl.prototype,"alias",void 0),d([f({type:[String,Number],json:{write:{allowNull:!0}}})],Fl.prototype,"defaultValue",void 0),d([f()],Fl.prototype,"description",void 0),d([$e("description")],Fl.prototype,"readDescription",null),d([f({types:E5e,json:{read:{reader:Uie},write:!0}})],Fl.prototype,"domain",void 0),d([f({type:Boolean,json:{write:!0}})],Fl.prototype,"editable",void 0),d([f({type:$i,json:{write:!0}})],Fl.prototype,"length",void 0),d([f({type:String,json:{write:!0}})],Fl.prototype,"name",void 0),d([f({type:Boolean,json:{write:!0}})],Fl.prototype,"nullable",void 0),d([Ze(Bie)],Fl.prototype,"type",void 0),d([f()],Fl.prototype,"valueType",void 0),d([$e("valueType",["description"])],Fl.prototype,"readValueType",null),Fl=DZ=d([$("esri.layers.support.Field")],Fl);const l6=Fl;var FZ;let uS=FZ=class extends ge{constructor(e){super(e),this.type="map-layer"}clone(){const{mapLayerId:e,gdbVersion:t}=this;return new FZ({mapLayerId:e,gdbVersion:t})}};d([Ze({mapLayer:"map-layer"})],uS.prototype,"type",void 0),d([f({type:$i,json:{write:!0}})],uS.prototype,"mapLayerId",void 0),d([f({type:String,json:{write:!0}})],uS.prototype,"gdbVersion",void 0),uS=FZ=d([$("esri.layers.support.source.MapLayerSource")],uS);var NZ;let cg=NZ=class extends ge{constructor(e){super(e),this.type="query-table"}clone(){var a;const{workspaceId:e,query:t,oidFields:r,spatialReference:i,geometryType:n}=this,s={workspaceId:e,query:t,oidFields:r,spatialReference:(a=i==null?void 0:i.clone())!=null?a:void 0,geometryType:n};return new NZ(s)}};d([Ze({queryTable:"query-table"})],cg.prototype,"type",void 0),d([f({type:String,json:{write:!0}})],cg.prototype,"workspaceId",void 0),d([f({type:String,json:{write:!0}})],cg.prototype,"query",void 0),d([f({type:String,json:{write:!0}})],cg.prototype,"oidFields",void 0),d([f({type:Ye,json:{write:!0}})],cg.prototype,"spatialReference",void 0),d([Ze(bV)],cg.prototype,"geometryType",void 0),cg=NZ=d([$("esri.layers.support.source.QueryTableDataSource")],cg);var kZ;let hS=kZ=class extends ge{constructor(e){super(e),this.type="raster"}clone(){const{workspaceId:e,dataSourceName:t}=this;return new kZ({workspaceId:e,dataSourceName:t})}};d([Ze({raster:"raster"})],hS.prototype,"type",void 0),d([f({type:String,json:{write:!0}})],hS.prototype,"dataSourceName",void 0),d([f({type:String,json:{write:!0}})],hS.prototype,"workspaceId",void 0),hS=kZ=d([$("esri.layers.support.source.RasterDataSource")],hS);var VZ;let P2=VZ=class extends ge{constructor(e){super(e),this.type="table"}clone(){const{workspaceId:e,gdbVersion:t,dataSourceName:r}=this;return new VZ({workspaceId:e,gdbVersion:t,dataSourceName:r})}};d([Ze({table:"table"})],P2.prototype,"type",void 0),d([f({type:String,json:{write:!0}})],P2.prototype,"workspaceId",void 0),d([f({type:String,json:{write:!0}})],P2.prototype,"gdbVersion",void 0),d([f({type:String,json:{write:!0}})],P2.prototype,"dataSourceName",void 0),P2=VZ=d([$("esri.layers.support.source.TableDataSource")],P2);var zZ,UZ;const vQe=uo()({esriLeftInnerJoin:"left-inner-join",esriLeftOuterJoin:"left-outer-join"});let $d=zZ=class extends ge{constructor(e){super(e),this.type="join-table"}readLeftTableSource(e,t,r){return vue()(e,t,r)}castLeftTableSource(e){return Mp(BZ(),e)}readRightTableSource(e,t,r){return vue()(e,t,r)}castRightTableSource(e){return Mp(BZ(),e)}clone(){var a,o;const{leftTableKey:e,rightTableKey:t,leftTableSource:r,rightTableSource:i,joinType:n}=this,s={leftTableKey:e,rightTableKey:t,leftTableSource:(a=r==null?void 0:r.clone())!=null?a:void 0,rightTableSource:(o=i==null?void 0:i.clone())!=null?o:void 0,joinType:n};return new zZ(s)}};d([Ze({joinTable:"join-table"})],$d.prototype,"type",void 0),d([f({type:String,json:{write:!0}})],$d.prototype,"leftTableKey",void 0),d([f({type:String,json:{write:!0}})],$d.prototype,"rightTableKey",void 0),d([f({json:{write:!0}})],$d.prototype,"leftTableSource",void 0),d([$e("leftTableSource")],$d.prototype,"readLeftTableSource",null),d([Xt("leftTableSource")],$d.prototype,"castLeftTableSource",null),d([f({json:{write:!0}})],$d.prototype,"rightTableSource",void 0),d([$e("rightTableSource")],$d.prototype,"readRightTableSource",null),d([Xt("rightTableSource")],$d.prototype,"castRightTableSource",null),d([Ze(vQe)],$d.prototype,"joinType",void 0),$d=zZ=d([$("esri.layers.support.source.JoinTableDataSource")],$d);let IG=null;function vue(){return IG||(IG=Y9({types:BZ()})),IG}let $G=null;function BZ(){return $G||($G={key:"type",base:null,typeMap:{"data-layer":jc,"map-layer":uS}}),$G}const _Qe={key:"type",base:null,typeMap:{"join-table":$d,"query-table":cg,raster:hS,table:P2}};let jc=UZ=class extends ge{constructor(e){super(e),this.type="data-layer"}clone(){const{fields:e,dataSource:t}=this;return new UZ({fields:e,dataSource:t})}};d([Ze({dataLayer:"data-layer"})],jc.prototype,"type",void 0),d([f({type:[l6],json:{write:!0}})],jc.prototype,"fields",void 0),d([f({types:_Qe,json:{write:!0}})],jc.prototype,"dataSource",void 0),jc=UZ=d([$("esri.layers.support.source.DataLayerSource")],jc),jc.from=rs(jc);function wQe(e,t){return t?{...t,query:{...e,...t.query}}:{query:e}}function Lu(e){return typeof e=="string"?pn(e):te(e)}function xQe(e,t,r){const i={};for(const n in e){if(n==="declaredClass")continue;const s=e[n];if(s!=null&&typeof s!="function")if(Array.isArray(s)){i[n]=[];for(let a=0;a<s.length;a++)i[n][a]=xQe(s[a])}else if(typeof s=="object")if(s.toJSON){const a=s.toJSON(r&&r[n]);i[n]=t?a:JSON.stringify(a)}else i[n]=t?s:JSON.stringify(s);else i[n]=s}return i}const ZM={102100:{maxX:20037508342788905e-9,minX:-20037508342788905e-9,plus180Line:new uu({paths:[[[20037508342788905e-9,-20037508342788905e-9],[20037508342788905e-9,20037508342788905e-9]]],spatialReference:Ye.WebMercator}),minus180Line:new uu({paths:[[[-20037508342788905e-9,-20037508342788905e-9],[-20037508342788905e-9,20037508342788905e-9]]],spatialReference:Ye.WebMercator})},4326:{maxX:180,minX:-180,plus180Line:new uu({paths:[[[180,-180],[180,180]]],spatialReference:Ye.WGS84}),minus180Line:new uu({paths:[[[-180,-180],[-180,180]]],spatialReference:Ye.WGS84})}};function G3(e,t){return Math.ceil((e-t)/(2*t))}function C5e(e,t){const r=KC(e);for(const i of r)for(const n of i)n[0]+=t;return e}function KC(e){return iw(e)?e.rings:e.paths}async function TQe(e,t,r,i){const n=typeof e=="string"?pn(e):e,s=t[0].spatialReference,a={...i,query:{...n.query,f:"json",sr:JSON.stringify(s),target:JSON.stringify({geometryType:yx(t[0]),geometries:t}),cutter:JSON.stringify(r)}},o=await qt(n.path+"/cut",a),{cutIndexes:l,geometries:c=[]}=o.data;return{cutIndexes:l,geometries:c.map(u=>{const h=Ry(u);return h.spatialReference=s,h})}}async function SQe(e,t,r){const i=typeof e=="string"?pn(e):e,n=t[0].spatialReference,s=yx(t[0]),a={...r,query:{...i.query,f:"json",sr:n.wkid?n.wkid:JSON.stringify(n),geometries:JSON.stringify(EQe(t))}};return CQe((await qt(i.path+"/simplify",a)).data,s,n)}function EQe(e){return{geometryType:yx(e[0]),geometries:e.map(t=>t.toJSON())}}function CQe(e,t,r){const i=qwe(t);return e.map(n=>{const s=i.fromJSON(n);return s.spatialReference=r,s})}const A5e=fe.getLogger("esri.geometry.support.normalizeUtils");function AQe(e){return e.type==="polygon"}function RQe(e){return e[0].type==="polygon"}function OQe(e){return e[0].type==="polyline"}function MQe(e,t){if(!(e instanceof uu||e instanceof $o)){const n="straightLineDensify: the input geometry is neither polyline nor polygon";throw A5e.error(n),new k(n)}const r=KC(e),i=[];for(const n of r){const s=[];i.push(s),s.push([n[0][0],n[0][1]]);for(let a=0;a<n.length-1;a++){const o=n[a][0],l=n[a][1],c=n[a+1][0],u=n[a+1][1],h=Math.sqrt((c-o)*(c-o)+(u-l)*(u-l)),p=(u-l)/h,m=(c-o)/h,g=h/t;if(g>1){for(let x=1;x<=g-1;x++){const T=x*t,E=m*T+o,C=p*T+l;s.push([E,C])}const b=(h+Math.floor(g-1)*t)/2,w=m*b+o,v=p*b+l;s.push([w,v])}s.push([c,u])}}return AQe(e)?new $o({rings:i,spatialReference:e.spatialReference}):new uu({paths:i,spatialReference:e.spatialReference})}function _ue(e,t,r){if(t){const i=MQe(e,1e6);e=aE(i,!0)}return r&&(e=C5e(e,r)),e}function wue(e,t,r){if(Array.isArray(e)){const i=e[0];if(i>t){const n=G3(i,t);e[0]=i+n*(-2*t)}else if(i<r){const n=G3(i,r);e[0]=i+n*(-2*r)}}else{const i=e.x;if(i>t){const n=G3(i,t);e=e.clone().offset(n*(-2*t),0)}else if(i<r){const n=G3(i,r);e=e.clone().offset(n*(-2*r),0)}}return e}function PQe(e,t){let r=-1;for(let i=0;i<t.cutIndexes.length;i++){const n=t.cutIndexes[i],s=t.geometries[i],a=KC(s);for(let o=0;o<a.length;o++){const l=a[o];l.some(c=>{if(c[0]<180)return!0;{let u=0;for(let p=0;p<l.length;p++){const m=l[p][0];u=m>u?m:u}u=Number(u.toFixed(9));const h=-360*G3(u,180);for(let p=0;p<l.length;p++){const m=s.getPoint(o,p);s.setPoint(o,p,m.clone().offset(h,0))}return!0}})}if(n===r){if(RQe(e))for(const o of KC(s))e[n]=e[n].addRing(o);else if(OQe(e))for(const o of KC(s))e[n]=e[n].addPath(o)}else r=n,e[n]=s}return e}async function Gie(e,t,r){var E;if(!Array.isArray(e))return Gie([e],t);t&&typeof t!="string"&&A5e.warn("normalizeCentralMeridian()","The url object is deprecated, use the url string instead");const i=typeof t=="string"?t:(E=t==null?void 0:t.url)!=null?E:Vr.geometryServiceUrl;let n,s,a,o,l,c,u,h,p=0;const m=[],g=[];for(const C of e)if(R(C))g.push(C);else if(n||(n=C.spatialReference,s=oy(n),a=n.isWebMercator,c=a?102100:4326,o=ZM[c].maxX,l=ZM[c].minX,u=ZM[c].plus180Line,h=ZM[c].minus180Line),s)if(C.type==="mesh")g.push(C);else if(C.type==="point")g.push(wue(C.clone(),o,l));else if(C.type==="multipoint"){const A=C.clone();A.points=A.points.map(P=>wue(P,o,l)),g.push(A)}else if(C.type==="extent"){const A=C.clone()._normalize(!1,!1,s);g.push(A.rings?new $o(A):A)}else if(C.extent){const A=C.extent,P=G3(A.xmin,l)*(2*o);let I=P===0?C.clone():C5e(C.clone(),P);A.offset(P,0),A.intersects(u)&&A.xmax!==o?(p=A.xmax>p?A.xmax:p,I=_ue(I,a),m.push(I),g.push("cut")):A.intersects(h)&&A.xmin!==l?(p=A.xmax*(2*o)>p?A.xmax*(2*o):p,I=_ue(I,a,360),m.push(I),g.push("cut")):g.push(I)}else g.push(C.clone());else g.push(C);let b=G3(p,o),w=-90;const v=b,x=new uu;for(;b>0;){const C=360*b-180;x.addPath([[C,w],[C,-1*w]]),w*=-1,b--}if(m.length>0&&v>0){const C=PQe(m,await TQe(i,m,x,r)),A=[],P=[];for(let V=0;V<g.length;V++){const G=g[V];if(G!=="cut")P.push(G);else{const B=C.shift(),X=e[V];_(X)&&X.type==="polygon"&&X.rings&&X.rings.length>1&&B.rings.length>=X.rings.length?(A.push(B),P.push("simplify")):P.push(a?ly(B):B)}}if(!A.length)return P;const I=await SQe(i,A,r),L=[];for(let V=0;V<P.length;V++){const G=P[V];G!=="simplify"?L.push(G):L.push(a?ly(I.shift()):I.shift())}return L}const T=[];for(let C=0;C<g.length;C++){const A=g[C];if(A!=="cut")T.push(A);else{const P=m.shift();T.push(a===!0?ly(P):P)}}return T}function sO(e){const t={};for(const r in e){if(r==="declaredClass")continue;const i=e[r];if(i!=null&&typeof i!="function")if(Array.isArray(i)){t[r]=[];for(let n=0;n<i.length;n++)t[r][n]=sO(i[n])}else typeof i=="object"?i.toJSON&&(t[r]=JSON.stringify(i)):t[r]=i}return t}var $1;(function(e){e[e.varint=0]="varint",e[e.fixed64=1]="fixed64",e[e.delimited=2]="delimited",e[e.fixed32=5]="fixed32",e[e.unknown=99]="unknown"})($1||($1={}));const xue=4294967296,IQe=new TextDecoder("utf-8"),$Qe=ue("safari")||ue("ios")?6:ue("ff")?12:32;class hw{constructor(t,r,i=0,n=t?t.byteLength:0){this._tag=0,this._dataType=$1.unknown,this._init(t,r,i,n)}_init(t,r,i,n){this._data=t,this._dataView=r,this._pos=i,this._end=n}clone(){return new hw(this._data,this._dataView,this._pos,this._end)}pos(){return this._pos}move(t){this._pos=t}nextTag(t){for(;;){if(this._pos===this._end)return!1;const r=this._decodeVarint();if(this._tag=r>>3,this._dataType=7&r,!t||t===this._tag)break;this.skip()}return!0}next(){if(this._pos===this._end)return!1;const t=this._decodeVarint();return this._tag=t>>3,this._dataType=7&t,!0}empty(){return this._pos>=this._end}tag(){return this._tag}getInt32(){return this._decodeVarint()}getInt64(){return this._decodeVarint()}getUInt32(){let t=4294967295;return t=(127&this._data[this._pos])>>>0,this._data[this._pos++]<128?t:(t=(t|(127&this._data[this._pos])<<7)>>>0,this._data[this._pos++]<128?t:(t=(t|(127&this._data[this._pos])<<14)>>>0,this._data[this._pos++]<128?t:(t=(t|(127&this._data[this._pos])<<21)>>>0,this._data[this._pos++]<128?t:(t=(t|(15&this._data[this._pos])<<28)>>>0,this._data[this._pos++]<128?t:void 0))))}getUInt64(){return this._decodeVarint()}getSInt32(){const t=this.getUInt32();return t>>>1^-(1&t)|0}getSInt64(){return this._decodeSVarint()}getBool(){const t=this._data[this._pos]!==0;return this._skip(1),t}getEnum(){return this._decodeVarint()}getFixed64(){const t=this._dataView,r=this._pos,i=t.getUint32(r,!0)+t.getUint32(r+4,!0)*xue;return this._skip(8),i}getSFixed64(){const t=this._dataView,r=this._pos,i=t.getUint32(r,!0)+t.getInt32(r+4,!0)*xue;return this._skip(8),i}getDouble(){const t=this._dataView.getFloat64(this._pos,!0);return this._skip(8),t}getFixed32(){const t=this._dataView.getUint32(this._pos,!0);return this._skip(4),t}getSFixed32(){const t=this._dataView.getInt32(this._pos,!0);return this._skip(4),t}getFloat(){const t=this._dataView.getFloat32(this._pos,!0);return this._skip(4),t}getString(){const t=this._getLength(),r=this._pos,i=this._toString(this._data,r,r+t);return this._skip(t),i}getBytes(){const t=this._getLength(),r=this._pos,i=this._toBytes(this._data,r,r+t);return this._skip(t),i}getLength(){return this._getLengthUnsafe()}processMessageWithArgs(t,r,i,n){const s=this.getMessage(),a=t(s,r,i,n);return s.release(),a}processMessage(t){const r=this.getMessage(),i=t(r);return r.release(),i}getMessage(){const t=this._getLength(),r=hw.pool.acquire();return r._init(this._data,this._dataView,this._pos,this._pos+t),this._skip(t),r}release(){hw.pool.release(this)}dataType(){return this._dataType}skip(){switch(this._dataType){case $1.varint:this._decodeVarint();break;case $1.fixed64:this._skip(8);break;case $1.delimited:this._skip(this._getLength());break;case $1.fixed32:this._skip(4);break;default:throw new Error("Invalid data type!")}}skipLen(t){this._skip(t)}_skip(t){if(this._pos+t>this._end)throw new Error("Attempt to skip past the end of buffer!");this._pos+=t}_decodeVarint(){const t=this._data;let r,i=this._pos,n=0;if(this._end-i>=10)do{if(r=t[i++],n|=127&r,(128&r)==0||(r=t[i++],n|=(127&r)<<7,(128&r)==0)||(r=t[i++],n|=(127&r)<<14,(128&r)==0)||(r=t[i++],n|=(127&r)<<21,(128&r)==0)||(r=t[i++],n+=268435456*(127&r),(128&r)==0)||(r=t[i++],n+=34359738368*(127&r),(128&r)==0)||(r=t[i++],n+=4398046511104*(127&r),(128&r)==0)||(r=t[i++],n+=562949953421312*(127&r),(128&r)==0)||(r=t[i++],n+=72057594037927940*(127&r),(128&r)==0)||(r=t[i++],n+=9223372036854776e3*(127&r),(128&r)==0))break;throw new Error("Varint too long!")}while(0);else{let s=1;for(;i!==this._end&&(r=t[i],(128&r)!=0);)++i,n+=(127&r)*s,s*=128;if(i===this._end)throw new Error("Varint overrun!");++i,n+=r*s}return this._pos=i,n}_decodeSVarint(){const t=this._decodeVarint();return t%2?-(t+1)/2:t/2}_getLength(){if(this._dataType!==$1.delimited)throw new Error("Not a delimited data type!");return this._decodeVarint()}_getLengthUnsafe(){return this.getUInt32()}_toString(t,r,i){if((i=Math.min(this._end,i))-r>$Qe){const a=t.subarray(r,i);return IQe.decode(a)}let n="",s="";for(let a=r;a<i;++a){const o=t[a];128&o?s+="%"+o.toString(16):(n+=decodeURIComponent(s)+String.fromCharCode(o),s="")}return s.length&&(n+=decodeURIComponent(s)),n}_toBytes(t,r,i){return i=Math.min(this._end,i),new Uint8Array(t.buffer,r,i-r)}}hw.pool=new Fn(hw,null,e=>{e._data=null,e._dataView=null});class ac{constructor(t=[],r=[],i=!1){this.lengths=t!=null?t:[],this.coords=r!=null?r:[],this.hasIndeterminateRingOrder=i}static fromRect(t){const[r,i,n,s]=t,a=n-r,o=s-i;return new ac([5],[r,i,a,0,0,o,-a,0,0,-o])}get isPoint(){return this.lengths.length===0}get maxLength(){return Math.max(...this.lengths)}get size(){return this.lengths.reduce((t,r)=>t+r)}forEachVertex(t){let r=0;this.lengths.length||t(this.coords[0],this.coords[1]);for(let i=0;i<this.lengths.length;i++){const n=this.lengths[i];for(let s=0;s<n;s++)t(this.coords[2*(s+r)],this.coords[2*(s+r)+1]);r+=n}}clone(t){return t?(t.set(this.coords),new ac(this.lengths.slice(),t,this.hasIndeterminateRingOrder)):new ac(this.lengths.slice(),this.coords.slice(),this.hasIndeterminateRingOrder)}}class gm{constructor(t=null,r={},i,n){this.geometry=t,this.attributes=r,this.centroid=i,this.objectId=n,this.displayId=0,this.geohashX=0,this.geohashY=0}weakClone(){const t=new gm(this.geometry,this.attributes,this.centroid,this.objectId);return t.displayId=this.displayId,t.geohashX=this.geohashX,t.geohashY=this.geohashY,t}}function LQe(e){return!(R(e.geometry)||!e.geometry.coords||!e.geometry.coords.length)}class b$t extends gm{}class dz{constructor(){this.objectIdFieldName=null,this.globalIdFieldName=null,this.geohashFieldName=null,this.geometryProperties=null,this.geometryType=null,this.spatialReference=null,this.hasZ=!1,this.hasM=!1,this.features=[],this.fields=[],this.transform=null,this.exceededTransferLimit=!1,this.uniqueIdField=null,this.queryGeometryType=null,this.queryGeometry=null}weakClone(){const t=new dz;return t.objectIdFieldName=this.objectIdFieldName,t.globalIdFieldName=this.globalIdFieldName,t.geohashFieldName=this.geohashFieldName,t.geometryProperties=this.geometryProperties,t.geometryType=this.geometryType,t.spatialReference=this.spatialReference,t.hasZ=this.hasZ,t.hasM=this.hasM,t.features=this.features,t.fields=this.fields,t.transform=this.transform,t.exceededTransferLimit=this.exceededTransferLimit,t.uniqueIdField=this.uniqueIdField,t.queryGeometry=this.queryGeometry,t.queryGeometryType=this.queryGeometryType,t}}const R5e=["esriGeometryPoint","esriGeometryMultipoint","esriGeometryPolyline","esriGeometryPolygon"];class v$t{constructor(t){this.options=t,this.geometryTypes=R5e,this._coordinatePtr=0,this._vertexDimension=0}createFeatureResult(){return new dz}prepareFeatures(t){this._vertexDimension=2,t.hasZ&&this._vertexDimension++,t.hasM&&this._vertexDimension++}finishFeatureResult(t){if(!t||!t.features||!t.hasZ||!this.options.sourceSpatialReference||!t.spatialReference||_l(t.spatialReference,this.options.sourceSpatialReference)||t.spatialReference.vcsWkid)return;const r=Z5(this.options.sourceSpatialReference)/Z5(t.spatialReference);if(r!==1)for(const i of t.features){if(!LQe(i))continue;const n=i.geometry.coords;for(let s=2;s<n.length;s+=3)n[s]*=r}}addFeature(t,r){t.features.push(r)}createFeature(){return new gm}createSpatialReference(){return{wkid:0}}createGeometry(){return new ac}addField(t,r){t.fields.push(r)}allocateCoordinates(t){t.coords.length=t.lengths.reduce((r,i)=>r+i,0)*this._vertexDimension,this._coordinatePtr=0}addCoordinate(t,r){t.coords[this._coordinatePtr++]=r}addCoordinatePoint(t,r){t.coords.push(r)}addLength(t,r){t.lengths.push(r)}addQueryGeometry(t,r){t.queryGeometry=r.queryGeometry,t.queryGeometryType=r.queryGeometryType}createPointGeometry(){return new ac}}const Tue=["esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble","esriFieldTypeString","esriFieldTypeDate","esriFieldTypeOID","esriFieldTypeGeometry","esriFieldTypeBlob","esriFieldTypeRaster","esriFieldTypeGUID","esriFieldTypeGlobalID","esriFieldTypeXML"],Sue=["sqlTypeBigInt","sqlTypeBinary","sqlTypeBit","sqlTypeChar","sqlTypeDate","sqlTypeDecimal","sqlTypeDouble","sqlTypeFloat","sqlTypeGeometry","sqlTypeGUID","sqlTypeInteger","sqlTypeLongNVarchar","sqlTypeLongVarbinary","sqlTypeLongVarchar","sqlTypeNChar","sqlTypeNVarchar","sqlTypeOther","sqlTypeReal","sqlTypeSmallInt","sqlTypeSqlXml","sqlTypeTime","sqlTypeTimestamp","sqlTypeTimestamp2","sqlTypeTinyInt","sqlTypeVarbinary","sqlTypeVarchar"],Eue=["upperLeft","lowerLeft"];function Cue(e){return e>=Tue.length?null:Tue[e]}function DQe(e){return e>=Sue.length?null:Sue[e]}function Aue(e){return e>=Eue.length?null:Eue[e]}function Rue(e,t){return t>=e.geometryTypes.length?null:e.geometryTypes[t]}function FQe(e,t,r){const n=t.createPointGeometry(r);for(;e.next();)switch(e.tag()){case 3:{const s=e.getUInt32(),a=e.pos()+s;let o=0;for(;e.pos()<a;)t.addCoordinatePoint(n,e.getSInt64(),o++);break}default:e.skip()}return n}function NQe(e,t,r){const s=t.createGeometry(r),a=2+(r.hasZ?1:0)+(r.hasM?1:0);for(;e.next();)switch(e.tag()){case 2:{const o=e.getUInt32(),l=e.pos()+o;let c=0;for(;e.pos()<l;)t.addLength(s,e.getUInt32(),c++);break}case 3:{const o=e.getUInt32(),l=e.pos()+o;let c=0;for(t.allocateCoordinates(s);e.pos()<l;)t.addCoordinate(s,e.getSInt64(),c),c++,c===a&&(c=0);break}default:e.skip()}return s}function kQe(e){const n=new ac;let s="esriGeometryPoint";for(;e.next();)switch(e.tag()){case 2:{const a=e.getUInt32(),o=e.pos()+a;for(;e.pos()<o;)n.lengths.push(e.getUInt32());break}case 3:{const a=e.getUInt32(),o=e.pos()+a;for(;e.pos()<o;)n.coords.push(e.getSInt64());break}case 1:s=R5e[e.getEnum()];break;default:e.skip()}return{queryGeometry:n,queryGeometryType:s}}function VQe(e){for(;e.next();)switch(e.tag()){case 1:return e.getString();case 2:return e.getFloat();case 3:return e.getDouble();case 4:return e.getSInt32();case 5:return e.getUInt32();case 6:return e.getInt64();case 7:return e.getUInt64();case 8:return e.getSInt64();case 9:return e.getBool();default:return e.skip(),null}return null}function zQe(e){const o={type:Cue(0)};for(;e.next();)switch(e.tag()){case 1:o.name=e.getString();break;case 2:o.type=Cue(e.getEnum());break;case 3:o.alias=e.getString();break;case 4:o.sqlType=DQe(e.getEnum());break;case 5:e.skip();break;case 6:o.defaultValue=e.getString();break;default:e.skip()}return o}function UQe(e){const i={};for(;e.next();)switch(e.tag()){case 1:i.name=e.getString();break;case 2:i.isSystemMaintained=e.getBool();break;default:e.skip()}return i}function BQe(e,t,r,i){const o=t.createFeature(r);let l=0;for(;e.next();)switch(e.tag()){case 1:{const c=i[l++].name;o.attributes[c]=e.processMessage(VQe);break}case 2:o.geometry=e.processMessageWithArgs(NQe,t,r);break;case 4:o.centroid=e.processMessageWithArgs(FQe,t,r);break;default:e.skip()}return o}function GQe(e){const s=[1,1,1,1];for(;e.next();)switch(e.tag()){case 1:s[0]=e.getDouble();break;case 2:s[1]=e.getDouble();break;case 4:s[2]=e.getDouble();break;case 3:s[3]=e.getDouble();break;default:e.skip()}return s}function jQe(e){const s=[0,0,0,0];for(;e.next();)switch(e.tag()){case 1:s[0]=e.getDouble();break;case 2:s[1]=e.getDouble();break;case 4:s[2]=e.getDouble();break;case 3:s[3]=e.getDouble();break;default:e.skip()}return s}function qQe(e){const n={originPosition:Aue(0)};for(;e.next();)switch(e.tag()){case 1:n.originPosition=Aue(e.getEnum());break;case 2:n.scale=e.processMessage(GQe);break;case 3:n.translate=e.processMessage(jQe);break;default:e.skip()}return n}function HQe(e){const n={};for(;e.next();)switch(e.tag()){case 1:n.shapeAreaFieldName=e.getString();break;case 2:n.shapeLengthFieldName=e.getString();break;case 3:n.units=e.getString();break;default:e.skip()}return n}function WQe(e,t){const o=t.createSpatialReference();for(;e.next();)switch(e.tag()){case 1:o.wkid=e.getUInt32();break;case 5:o.wkt=e.getString();break;case 2:o.latestWkid=e.getUInt32();break;case 3:o.vcsWkid=e.getUInt32();break;case 4:o.latestVcsWkid=e.getUInt32();break;default:e.skip()}return o}function XQe(e,t){const b=t.createFeatureResult();b.geometryType=Rue(t,0);let w=!1;for(;e.next();)switch(e.tag()){case 1:b.objectIdFieldName=e.getString();break;case 3:b.globalIdFieldName=e.getString();break;case 4:b.geohashFieldName=e.getString();break;case 5:b.geometryProperties=e.processMessage(HQe);break;case 7:b.geometryType=Rue(t,e.getEnum());break;case 8:b.spatialReference=e.processMessageWithArgs(WQe,t);break;case 10:b.hasZ=e.getBool();break;case 11:b.hasM=e.getBool();break;case 12:b.transform=e.processMessage(qQe);break;case 9:{const v=e.getBool();b.exceededTransferLimit=v;break}case 13:t.addField(b,e.processMessage(zQe));break;case 15:w||(t.prepareFeatures(b),w=!0),t.addFeature(b,e.processMessageWithArgs(BQe,t,b,b.fields));break;case 2:b.uniqueIdField=e.processMessage(UQe);break;default:e.skip()}return t.finishFeatureResult(b),b}function YQe(e,t){const n={};let s=null;for(;e.next();)switch(e.tag()){case 4:s=e.processMessageWithArgs(kQe);break;case 1:n.featureResult=e.processMessageWithArgs(XQe,t);break;default:e.skip()}return _(s)&&n.featureResult&&t.addQueryGeometry(n,s),n}function ZQe(e,t){try{const i=new hw(new Uint8Array(e),new DataView(e)),n={};for(;i.next();)i.tag()===2?n.queryResult=i.processMessageWithArgs(YQe,t):i.skip();return n}catch(r){throw new k("query:parsing-pbf","Error while parsing FeatureSet PBF payload",{error:r})}}function QQe(e,t){const r=ZQe(e,t),i=r.queryResult.featureResult,n=r.queryResult.queryGeometry,s=r.queryResult.queryGeometryType;if(i&&i.features&&i.features.length&&i.objectIdFieldName){const a=i.objectIdFieldName;for(const o of i.features)o.attributes&&(o.objectId=o.attributes[a])}return i&&(i.queryGeometry=n,i.queryGeometryType=s),i}function _N(e,t,r){if(!r||!r.features||!r.hasZ)return;const i=Wre(r.geometryType,t,e.outSpatialReference);if(!R(i))for(const n of r.features)i(n.geometry)}const Oue="Layer does not support extent calculation.";function O5e(e,t){if(t&&e.type==="extent")return`${e.xmin},${e.ymin},${e.xmax},${e.ymax}`;if(t&&e.type==="point")return`${e.x},${e.y}`;const r=e.toJSON();return delete r.spatialReference,JSON.stringify(r)}function M5e(e,t){const r=e.geometry,i=e.toJSON();delete i.compactGeometryEnabled,delete i.defaultSpatialReferenceEnabled;const n=i;let s,a,o;if(_(r)&&(a=r.spatialReference,o=r.spatialReference.wkid||JSON.stringify(r.spatialReference),n.geometryType=yx(r),n.geometry=O5e(r,e.compactGeometryEnabled),n.inSR=o),i.groupByFieldsForStatistics&&(n.groupByFieldsForStatistics=i.groupByFieldsForStatistics.join(",")),i.objectIds&&(n.objectIds=i.objectIds.join(",")),i.orderByFields&&(n.orderByFields=i.orderByFields.join(",")),!i.outFields||!i.returnDistinctValues&&((t==null?void 0:t.returnCountOnly)||(t==null?void 0:t.returnExtentOnly)||(t==null?void 0:t.returnIdsOnly))?delete n.outFields:i.outFields.includes("*")?n.outFields="*":n.outFields=i.outFields.join(","),i.outSR?(n.outSR=i.outSR.wkid||JSON.stringify(i.outSR),s=e.outSpatialReference):r&&(i.returnGeometry||i.returnCentroid)&&(n.outSR=n.inSR,s=a),i.returnGeometry&&delete i.returnGeometry,i.outStatistics&&(n.outStatistics=JSON.stringify(i.outStatistics)),i.pixelSize&&(n.pixelSize=JSON.stringify(i.pixelSize)),i.quantizationParameters&&(e.defaultSpatialReferenceEnabled&&_(a)&&_(e.quantizationParameters)&&_(e.quantizationParameters.extent)&&a.equals(e.quantizationParameters.extent.spatialReference)&&delete i.quantizationParameters.extent.spatialReference,n.quantizationParameters=JSON.stringify(i.quantizationParameters)),i.parameterValues&&(n.parameterValues=JSON.stringify(i.parameterValues)),i.rangeValues&&(n.rangeValues=JSON.stringify(i.rangeValues)),i.dynamicDataSource&&(n.layer=JSON.stringify({source:i.dynamicDataSource}),delete i.dynamicDataSource),i.timeExtent){const l=i.timeExtent,{start:c,end:u}=l;c==null&&u==null||(n.time=c===u?c:`${c==null?"null":c},${u==null?"null":u}`),delete i.timeExtent}return e.defaultSpatialReferenceEnabled&&_(a)&&_(s)&&a.equals(s)&&(n.defaultSR=n.inSR,delete n.inSR,delete n.outSR),n}async function P5e(e,t,r,i){const n=_(t.timeExtent)&&t.timeExtent.isEmpty?{data:{features:[]}}:await c6(e,t,"json",i);return _N(t,r,n.data),n}async function I5e(e,t,r,i){if(_(t.timeExtent)&&t.timeExtent.isEmpty)return{data:r.createFeatureResult()};const n=await $5e(e,t,i),s=n;return s.data=QQe(n.data,r),s}function $5e(e,t,r){return c6(e,t,"pbf",r)}function L5e(e,t,r){return _(t.timeExtent)&&t.timeExtent.isEmpty?Promise.resolve({data:{objectIds:[]}}):c6(e,t,"json",r,{returnIdsOnly:!0})}function D5e(e,t,r){return _(t.timeExtent)&&t.timeExtent.isEmpty?Promise.resolve({data:{count:0}}):c6(e,t,"json",r,{returnIdsOnly:!0,returnCountOnly:!0})}function F5e(e,t,r){return _(t.timeExtent)&&t.timeExtent.isEmpty?Promise.resolve({data:{count:0,extent:null}}):c6(e,t,"json",r,{returnExtentOnly:!0,returnCountOnly:!0}).then(i=>{const n=i.data;if(n.hasOwnProperty("extent"))return i;if(n.features)throw new Error(Oue);if(n.hasOwnProperty("count"))throw new Error(Oue);return i})}function c6(e,t,r,i={},n={}){const s=typeof e=="string"?pn(e):e,a=t.geometry?[t.geometry]:[];return i.responseType=r==="pbf"?"array-buffer":"json",Gie(a,null,i).then(o=>{const l=o&&o[0];_(l)&&((t=t.clone()).geometry=l);const c=sO({...s.query,f:r,...n,...M5e(t,n)});return qt(vl(s.path,"query"),{...i,query:{...c,...i.query}})})}const _$t=Object.freeze(Object.defineProperty({__proto__:null,encodeGeometry:O5e,executeQuery:P5e,executeQueryForCount:D5e,executeQueryForExtent:F5e,executeQueryForIds:L5e,executeQueryPBF:I5e,executeQueryPBFBuffer:$5e,queryToQueryStringParameters:M5e,runQuery:c6},Symbol.toStringTag,{value:"Module"}));var GZ;const jZ=new tr({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryEnvelope:"extent",mesh:"mesh","":null});let Wa=GZ=class extends ge{constructor(e){super(e),this.displayFieldName=null,this.exceededTransferLimit=!1,this.features=[],this.fields=null,this.geometryType=null,this.hasM=!1,this.hasZ=!1,this.queryGeometry=null,this.spatialReference=null}readFeatures(e,t){var n;const r=Ye.fromJSON(t.spatialReference),i=[];for(let s=0;s<e.length;s++){const a=e[s],o=co.fromJSON(a),l=a.geometry&&a.geometry.spatialReference;_(o.geometry)&&!l&&(o.geometry.spatialReference=r);const c=a.aggregateGeometries,u=o.aggregateGeometries;if(c&&_(u))for(const h in u){const p=u[h],m=(n=c[h])==null?void 0:n.spatialReference;_(p)&&!m&&(p.spatialReference=r)}i.push(o)}return i}writeGeometryType(e,t,r,i){if(e)return void jZ.write(e,t,r,i);const{features:n}=this;if(n){for(const s of n)if(s&&_(s.geometry))return void jZ.write(s.geometry.type,t,r,i)}}readQueryGeometry(e,t){if(!e)return null;const r=!!e.spatialReference,i=Ry(e);return!r&&t.spatialReference&&(i.spatialReference=Ye.fromJSON(t.spatialReference)),i}writeSpatialReference(e,t){if(e)return void(t.spatialReference=e.toJSON());const{features:r}=this;if(r){for(const i of r)if(i&&_(i.geometry)&&i.geometry.spatialReference)return void(t.spatialReference=i.geometry.spatialReference.toJSON())}}clone(){return new GZ(this.cloneProperties())}cloneProperties(){return te({displayFieldName:this.displayFieldName,exceededTransferLimit:this.exceededTransferLimit,features:this.features,fields:this.fields,geometryType:this.geometryType,hasM:this.hasM,hasZ:this.hasZ,queryGeometry:this.queryGeometry,spatialReference:this.spatialReference,transform:this.transform})}toJSON(e){const t=this.write();if(t.features&&Array.isArray(e)&&e.length>0)for(let r=0;r<t.features.length;r++){const i=t.features[r];if(i.geometry){const n=e&&e[r];i.geometry=n&&n.toJSON()||i.geometry}}return t}quantize(e){const{scale:[t,r],translate:[i,n]}=e,s=c=>Math.round((c-i)/t),a=c=>Math.round((n-c)/r),o=this.features,l=this._getQuantizationFunction(this.geometryType,s,a);for(let c=0,u=o.length;c<u;c++)l(o[c].geometry)||(o.splice(c,1),c--,u--);return this.transform=e,this}unquantize(){const{geometryType:e,features:t,transform:r}=this;if(!r)return this;const{translate:[i,n],scale:[s,a]}=r,o=u=>u*s+i,l=u=>n-u*a,c=this._getHydrationFunction(e,o,l);for(const{geometry:u}of t)_(u)&&c(u);return this.transform=null,this}_quantizePoints(e,t,r){let i,n;const s=[];for(let a=0,o=e.length;a<o;a++){const l=e[a];if(a>0){const c=t(l[0]),u=r(l[1]);c===i&&u===n||(s.push([c-i,u-n]),i=c,n=u)}else i=t(l[0]),n=r(l[1]),s.push([i,n])}return s.length>0?s:null}_getQuantizationFunction(e,t,r){return e==="point"?i=>(i.x=t(i.x),i.y=r(i.y),i):e==="polyline"||e==="polygon"?i=>{const n=iw(i)?i.rings:i.paths,s=[];for(let a=0,o=n.length;a<o;a++){const l=n[a],c=this._quantizePoints(l,t,r);c&&s.push(c)}return s.length>0?(iw(i)?i.rings=s:i.paths=s,i):null}:e==="multipoint"?i=>{const n=this._quantizePoints(i.points,t,r);return n.length>0?(i.points=n,i):null}:e==="extent"?i=>i:null}_getHydrationFunction(e,t,r){return e==="point"?i=>{i.x=t(i.x),i.y=r(i.y)}:e==="polyline"||e==="polygon"?i=>{const n=iw(i)?i.rings:i.paths;let s,a;for(let o=0,l=n.length;o<l;o++){const c=n[o];for(let u=0,h=c.length;u<h;u++){const p=c[u];u>0?(s+=p[0],a+=p[1]):(s=p[0],a=p[1]),p[0]=t(s),p[1]=r(a)}}}:e==="extent"?i=>{i.xmin=t(i.xmin),i.ymin=r(i.ymin),i.xmax=t(i.xmax),i.ymax=r(i.ymax)}:e==="multipoint"?i=>{const n=i.points;let s,a;for(let o=0,l=n.length;o<l;o++){const c=n[o];o>0?(s+=c[0],a+=c[1]):(s=c[0],a=c[1]),c[0]=t(s),c[1]=r(a)}}:void 0}};d([f({type:String,json:{write:!0}})],Wa.prototype,"displayFieldName",void 0),d([f({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],Wa.prototype,"exceededTransferLimit",void 0),d([f({type:[co],json:{write:!0}})],Wa.prototype,"features",void 0),d([$e("features")],Wa.prototype,"readFeatures",null),d([f({type:[l6],json:{write:!0}})],Wa.prototype,"fields",void 0),d([f({type:["point","multipoint","polyline","polygon","extent","mesh"],json:{read:{reader:jZ.read}}})],Wa.prototype,"geometryType",void 0),d([Xe("geometryType")],Wa.prototype,"writeGeometryType",null),d([f({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],Wa.prototype,"hasM",void 0),d([f({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],Wa.prototype,"hasZ",void 0),d([f({types:bx,json:{write:!0}})],Wa.prototype,"queryGeometry",void 0),d([$e("queryGeometry")],Wa.prototype,"readQueryGeometry",null),d([f({type:Ye,json:{write:!0}})],Wa.prototype,"spatialReference",void 0),d([Xe("spatialReference")],Wa.prototype,"writeSpatialReference",null),d([f({json:{write:!0}})],Wa.prototype,"transform",void 0),Wa=GZ=d([$("esri.rest.support.FeatureSet")],Wa),Wa.prototype.toJSON.isDefaultToJSON=!0;const ym=Wa,w$t=Object.freeze(Object.defineProperty({__proto__:null,default:ym},Symbol.toStringTag,{value:"Module"})),Mue={milliseconds:1,seconds:1e3,minutes:6e4,hours:36e5,days:864e5,weeks:6048e5,months:26784e5,years:31536e6,decades:31536e7,centuries:31536e8},JQe={milliseconds:{getter:"getMilliseconds",setter:"setMilliseconds",multiplier:1},seconds:{getter:"getSeconds",setter:"setSeconds",multiplier:1},minutes:{getter:"getMinutes",setter:"setMinutes",multiplier:1},hours:{getter:"getHours",setter:"setHours",multiplier:1},days:{getter:"getDate",setter:"setDate",multiplier:1},weeks:{getter:"getDate",setter:"setDate",multiplier:7},months:{getter:"getMonth",setter:"setMonth",multiplier:1},years:{getter:"getFullYear",setter:"setFullYear",multiplier:1},decades:{getter:"getFullYear",setter:"setFullYear",multiplier:10},centuries:{getter:"getFullYear",setter:"setFullYear",multiplier:100}};function KQe(e,t){const r=new Date(e,t+1,1);return r.setDate(0),r.getDate()}function fw(e,t,r){const i=new Date(e.getTime());if(t&&r){const n=JQe[r],{getter:s,setter:a,multiplier:o}=n;if(r==="months"){const l=KQe(i.getFullYear(),i.getMonth()+t);i.getDate()>l&&i.setDate(l)}i[a](i[s]()+t*o)}return i}function Pue(e,t){switch(t){case"milliseconds":return new Date(e.getTime());case"seconds":return new Date(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds());case"minutes":return new Date(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes());case"hours":return new Date(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours());case"days":return new Date(e.getFullYear(),e.getMonth(),e.getDate());case"weeks":return new Date(e.getFullYear(),e.getMonth(),e.getDate()-e.getDay());case"months":return new Date(e.getFullYear(),e.getMonth(),1);case"years":return new Date(e.getFullYear(),0,1);case"decades":return new Date(e.getFullYear()-e.getFullYear()%10,0,1);case"centuries":return new Date(e.getFullYear()-e.getFullYear()%100,0,1);default:return new Date}}function eJe(e,t,r){return e===0?0:e*Mue[t]/Mue[r]}var Mf;let qd=Mf=class extends ge{constructor(e){super(e),this.end=null,this.start=null}static get allTime(){return Iue}static get empty(){return tJe}readEnd(e,t){return t.end!=null?new Date(t.end):null}writeEnd(e,t){t.end=e?e.getTime():null}get isAllTime(){return this.equals(Mf.allTime)}get isEmpty(){return this.equals(Mf.empty)}readStart(e,t){return t.start!=null?new Date(t.start):null}writeStart(e,t){t.start=e?e.getTime():null}clone(){return new Mf({end:this.end,start:this.start})}equals(e){if(!e)return!1;const t=_(this.start)?this.start.getTime():this.start,r=_(this.end)?this.end.getTime():this.end,i=_(e.start)?e.start.getTime():e.start,n=_(e.end)?e.end.getTime():e.end;return t===i&&r===n}expandTo(e){if(this.isEmpty||this.isAllTime)return this.clone();const t=ys(this.start,i=>Pue(i,e)),r=ys(this.end,i=>fw(Pue(i,e),1,e));return new Mf({start:t,end:r})}intersection(e){if(!e)return this.clone();if(this.isEmpty||e.isEmpty)return Mf.empty;if(this.isAllTime)return e.clone();if(e.isAllTime)return this.clone();const t=tu(this.start,-1/0,o=>o.getTime()),r=tu(this.end,1/0,o=>o.getTime()),i=tu(e.start,-1/0,o=>o.getTime()),n=tu(e.end,1/0,o=>o.getTime());let s,a;if(i>=t&&i<=r?s=i:t>=i&&t<=n&&(s=t),r>=i&&r<=n?a=r:n>=t&&n<=r&&(a=n),!isNaN(s)&&!isNaN(a)){const o=new Mf;return o.start=s===-1/0?null:new Date(s),o.end=a===1/0?null:new Date(a),o}return Mf.empty}offset(e,t){if(this.isEmpty||this.isAllTime)return this.clone();const r=new Mf,{start:i,end:n}=this;return _(i)&&(r.start=fw(i,e,t)),_(n)&&(r.end=fw(n,e,t)),r}union(e){if(!e||e.isEmpty)return this.clone();if(this.isEmpty)return e.clone();if(this.isAllTime||e.isAllTime)return Iue.clone();const t=_(this.start)&&_(e.start)?new Date(Math.min(this.start.getTime(),e.start.getTime())):null,r=_(this.end)&&_(e.end)?new Date(Math.max(this.end.getTime(),e.end.getTime())):null;return new Mf({start:t,end:r})}};d([f({type:Date,json:{write:{allowNull:!0}}})],qd.prototype,"end",void 0),d([$e("end")],qd.prototype,"readEnd",null),d([Xe("end")],qd.prototype,"writeEnd",null),d([f({readOnly:!0,json:{read:!1}})],qd.prototype,"isAllTime",null),d([f({readOnly:!0,json:{read:!1}})],qd.prototype,"isEmpty",null),d([f({type:Date,json:{write:{allowNull:!0}}})],qd.prototype,"start",void 0),d([$e("start")],qd.prototype,"readStart",null),d([Xe("start")],qd.prototype,"writeStart",null),qd=Mf=d([$("esri.TimeExtent")],qd);const Iue=new qd,tJe=new qd({start:void 0,end:void 0}),Mm=qd;var qZ;const $ue=new tr({upperLeft:"upper-left",lowerLeft:"lower-left"});let I2=qZ=class extends ge{constructor(e){super(e),this.extent=null,this.mode="view",this.originPosition="upper-left",this.tolerance=1}clone(){return new qZ(te({extent:this.extent,mode:this.mode,originPosition:this.originPosition,tolerance:this.tolerance}))}};d([f({type:Zt,json:{write:{overridePolicy(){return{enabled:this.mode==="view"}}}}})],I2.prototype,"extent",void 0),d([f({type:["view","edit"],json:{write:!0}})],I2.prototype,"mode",void 0),d([f({type:String,json:{read:$ue.read,write:$ue.write}})],I2.prototype,"originPosition",void 0),d([f({type:Number,json:{write:{overridePolicy(){return{enabled:this.mode==="view"}}}}})],I2.prototype,"tolerance",void 0),I2=qZ=d([$("esri.rest.support.QuantizationParameters")],I2);const N5e=I2;var HZ;const Lue=new tr({count:"count",sum:"sum",min:"min",max:"max",avg:"avg",stddev:"stddev",var:"var",exceedslimit:"exceedslimit",percentile_cont:"percentile-continuous",percentile_disc:"percentile-discrete",EnvelopeAggregate:"envelope-aggregate",CentroidAggregate:"centroid-aggregate",ConvexHullAggregate:"convex-hull-aggregate"});let Pf=HZ=class extends ge{constructor(e){super(e),this.maxPointCount=void 0,this.maxRecordCount=void 0,this.maxVertexCount=void 0,this.onStatisticField=null,this.outStatisticFieldName=null,this.statisticType=null,this.statisticParameters=null}writeStatisticParameters(e,t){this.statisticType!=="percentile-continuous"&&this.statisticType!=="percentile-discrete"||(t.statisticParameters=te(e))}clone(){return new HZ({maxPointCount:this.maxPointCount,maxRecordCount:this.maxRecordCount,maxVertexCount:this.maxVertexCount,onStatisticField:this.onStatisticField,outStatisticFieldName:this.outStatisticFieldName,statisticType:this.statisticType,statisticParameters:te(this.statisticParameters)})}};d([f({type:Number,json:{write:!0}})],Pf.prototype,"maxPointCount",void 0),d([f({type:Number,json:{write:!0}})],Pf.prototype,"maxRecordCount",void 0),d([f({type:Number,json:{write:!0}})],Pf.prototype,"maxVertexCount",void 0),d([f({type:String,json:{write:!0}})],Pf.prototype,"onStatisticField",void 0),d([f({type:String,json:{write:!0}})],Pf.prototype,"outStatisticFieldName",void 0),d([f({type:String,json:{read:{source:"statisticType",reader:Lue.read},write:{target:"statisticType",writer:Lue.write}}})],Pf.prototype,"statisticType",void 0),d([f({type:Object})],Pf.prototype,"statisticParameters",void 0),d([Xe("statisticParameters")],Pf.prototype,"writeStatisticParameters",null),Pf=HZ=d([$("esri.rest.support.StatisticDefinition")],Pf);const pw=Pf;var J4;const rJe=new tr({esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"envelope-intersects",esriSpatialRelIndexIntersects:"index-intersects",esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:"relation"}),iJe=new tr({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"});let Pt=J4=class extends ge{constructor(e){super(e),this.aggregateIds=null,this.cacheHint=void 0,this.compactGeometryEnabled=!1,this.datumTransformation=null,this.defaultSpatialReferenceEnabled=!1,this.distance=void 0,this.dynamicDataSource=void 0,this.formatOf3DObjects=null,this.gdbVersion=null,this.geometry=null,this.geometryPrecision=void 0,this.groupByFieldsForStatistics=null,this.having=null,this.historicMoment=null,this.maxAllowableOffset=void 0,this.maxRecordCountFactor=1,this.multipatchOption=null,this.num=void 0,this.objectIds=null,this.orderByFields=null,this.outFields=null,this.outSpatialReference=null,this.outStatistics=null,this.parameterValues=null,this.pixelSize=null,this.quantizationParameters=null,this.rangeValues=null,this.relationParameter=null,this.resultType=null,this.returnCentroid=!1,this.returnDistinctValues=!1,this.returnExceededLimitFeatures=!0,this.returnGeometry=!1,this.returnQueryGeometry=!1,this.returnM=void 0,this.returnZ=void 0,this.sourceSpatialReference=null,this.spatialRelationship="intersects",this.start=void 0,this.sqlFormat=null,this.text=null,this.timeExtent=null,this.timeReferenceUnknownClient=!1,this.units=null,this.where=null}static from(e){return M5(J4,e)}castDatumTransformation(e){return typeof e=="number"||typeof e=="object"?e:null}writeHistoricMoment(e,t){t.historicMoment=e&&e.getTime()}writeParameterValues(e,t){if(e){const r={};for(const i in e){const n=e[i];Array.isArray(n)?r[i]=n.map(s=>s instanceof Date?s.getTime():s):n instanceof Date?r[i]=n.getTime():r[i]=n}t.parameterValues=r}}writeStart(e,t){t.resultOffset=this.start,t.resultRecordCount=this.num||10,t.where="1=1"}writeWhere(e,t){t.where=e||"1=1"}clone(){return new J4(te({aggregateIds:this.aggregateIds,cacheHint:this.cacheHint,compactGeometryEnabled:this.compactGeometryEnabled,datumTransformation:this.datumTransformation,defaultSpatialReferenceEnabled:this.defaultSpatialReferenceEnabled,distance:this.distance,gdbVersion:this.gdbVersion,geometry:this.geometry,geometryPrecision:this.geometryPrecision,groupByFieldsForStatistics:this.groupByFieldsForStatistics,having:this.having,historicMoment:_(this.historicMoment)?new Date(this.historicMoment.getTime()):null,maxAllowableOffset:this.maxAllowableOffset,maxRecordCountFactor:this.maxRecordCountFactor,multipatchOption:this.multipatchOption,num:this.num,objectIds:this.objectIds,orderByFields:this.orderByFields,outFields:this.outFields,outSpatialReference:this.outSpatialReference,outStatistics:this.outStatistics,parameterValues:this.parameterValues,pixelSize:this.pixelSize,quantizationParameters:this.quantizationParameters,rangeValues:this.rangeValues,relationParameter:this.relationParameter,resultType:this.resultType,returnDistinctValues:this.returnDistinctValues,returnGeometry:this.returnGeometry,returnCentroid:this.returnCentroid,returnExceededLimitFeatures:this.returnExceededLimitFeatures,returnQueryGeometry:this.returnQueryGeometry,returnM:this.returnM,returnZ:this.returnZ,dynamicDataSource:this.dynamicDataSource,sourceSpatialReference:this.sourceSpatialReference,spatialRelationship:this.spatialRelationship,start:this.start,sqlFormat:this.sqlFormat,text:this.text,timeExtent:this.timeExtent,timeReferenceUnknownClient:this.timeReferenceUnknownClient,units:this.units,where:this.where}))}};Pt.MAX_MAX_RECORD_COUNT_FACTOR=5,d([f({json:{write:!0}})],Pt.prototype,"aggregateIds",void 0),d([f({type:Boolean,json:{write:!0}})],Pt.prototype,"cacheHint",void 0),d([f({type:Boolean,json:{default:!1,write:!0}})],Pt.prototype,"compactGeometryEnabled",void 0),d([f({json:{write:!0}})],Pt.prototype,"datumTransformation",void 0),d([Xt("datumTransformation")],Pt.prototype,"castDatumTransformation",null),d([f({type:Boolean,json:{default:!1,write:!0}})],Pt.prototype,"defaultSpatialReferenceEnabled",void 0),d([f({type:Number,json:{write:{overridePolicy:e=>({enabled:e>0})}}})],Pt.prototype,"distance",void 0),d([f({type:jc,json:{write:!0}})],Pt.prototype,"dynamicDataSource",void 0),d([f({type:String,json:{write:!0}})],Pt.prototype,"formatOf3DObjects",void 0),d([f({type:String,json:{write:!0}})],Pt.prototype,"gdbVersion",void 0),d([f({types:bx,json:{read:Ry,write:!0}})],Pt.prototype,"geometry",void 0),d([f({type:Number,json:{write:!0}})],Pt.prototype,"geometryPrecision",void 0),d([f({type:[String],json:{write:!0}})],Pt.prototype,"groupByFieldsForStatistics",void 0),d([f({type:String,json:{write:!0}})],Pt.prototype,"having",void 0),d([f({type:Date})],Pt.prototype,"historicMoment",void 0),d([Xe("historicMoment")],Pt.prototype,"writeHistoricMoment",null),d([f({type:Number,json:{write:!0}})],Pt.prototype,"maxAllowableOffset",void 0),d([f({type:Number,cast:e=>e<1?1:e>J4.MAX_MAX_RECORD_COUNT_FACTOR?J4.MAX_MAX_RECORD_COUNT_FACTOR:e,json:{write:{overridePolicy:e=>({enabled:e>1})}}})],Pt.prototype,"maxRecordCountFactor",void 0),d([f({type:["xyFootprint"],json:{write:!0}})],Pt.prototype,"multipatchOption",void 0),d([f({type:Number,json:{read:{source:"resultRecordCount"}}})],Pt.prototype,"num",void 0),d([f({json:{write:!0}})],Pt.prototype,"objectIds",void 0),d([f({type:[String],json:{write:!0}})],Pt.prototype,"orderByFields",void 0),d([f({type:[String],json:{write:!0}})],Pt.prototype,"outFields",void 0),d([f({type:Ye,json:{name:"outSR",write:!0}})],Pt.prototype,"outSpatialReference",void 0),d([f({type:[pw],json:{write:{enabled:!0,overridePolicy(){return{enabled:_(this.outStatistics)&&this.outStatistics.length>0}}}}})],Pt.prototype,"outStatistics",void 0),d([f({json:{write:!0}})],Pt.prototype,"parameterValues",void 0),d([Xe("parameterValues")],Pt.prototype,"writeParameterValues",null),d([f({type:ot,json:{write:!0}})],Pt.prototype,"pixelSize",void 0),d([f({type:N5e,json:{write:!0}})],Pt.prototype,"quantizationParameters",void 0),d([f({type:[Object],json:{write:!0}})],Pt.prototype,"rangeValues",void 0),d([f({type:String,json:{read:{source:"relationParam"},write:{target:"relationParam",overridePolicy(){return{enabled:this.spatialRelationship==="relation"}}}}})],Pt.prototype,"relationParameter",void 0),d([f({type:String,json:{write:!0}})],Pt.prototype,"resultType",void 0),d([f({type:Boolean,json:{default:!1,write:!0}})],Pt.prototype,"returnCentroid",void 0),d([f({type:Boolean,json:{default:!1,write:!0}})],Pt.prototype,"returnDistinctValues",void 0),d([f({type:Boolean,json:{default:!0,write:!0}})],Pt.prototype,"returnExceededLimitFeatures",void 0),d([f({type:Boolean,json:{write:!0}})],Pt.prototype,"returnGeometry",void 0),d([f({type:Boolean,json:{default:!1,write:!0}})],Pt.prototype,"returnQueryGeometry",void 0),d([f({type:Boolean,json:{default:!1,write:!0}})],Pt.prototype,"returnM",void 0),d([f({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],Pt.prototype,"returnZ",void 0),d([f({type:Ye,json:{write:!0}})],Pt.prototype,"sourceSpatialReference",void 0),d([Ze(rJe,{ignoreUnknown:!1,name:"spatialRel"})],Pt.prototype,"spatialRelationship",void 0),d([f({type:Number,json:{read:{source:"resultOffset"}}})],Pt.prototype,"start",void 0),d([Xe("start"),Xe("num")],Pt.prototype,"writeStart",null),d([f({type:String,json:{write:!0}})],Pt.prototype,"sqlFormat",void 0),d([f({type:String,json:{write:!0}})],Pt.prototype,"text",void 0),d([f({type:Mm,json:{write:!0}})],Pt.prototype,"timeExtent",void 0),d([f({type:Boolean,json:{default:!1,write:!0}})],Pt.prototype,"timeReferenceUnknownClient",void 0),d([Ze(iJe,{ignoreUnknown:!1}),f({json:{write:{overridePolicy(e){return{enabled:e&&this.distance>0}}}}})],Pt.prototype,"units",void 0),d([f({type:String,json:{write:{overridePolicy(e){return{enabled:e!=null||this.start>0}}}}})],Pt.prototype,"where",void 0),d([Xe("where")],Pt.prototype,"writeWhere",null),Pt=J4=d([$("esri.rest.support.Query")],Pt);const Zn=Pt;async function LG(e,t,r){const i=await k5e(e,t,r);return ym.fromJSON(i)}async function k5e(e,t,r){const i=Lu(e),n={...r},s=Zn.from(t),{data:a}=await P5e(i,s,s.sourceSpatialReference,n);return a}function ko(e,t){return e?t?4:3:t?3:2}const aO=fe.getLogger("esri.layers.graphics.featureConversionUtils"),V5e={esriGeometryPoint:0,esriGeometryPolyline:2,esriGeometryPolygon:3,esriGeometryMultipoint:0},z5e=(e,t,r,i,n,s)=>{e[r]=n,e[r+1]=s},wN=(e,t,r,i,n,s)=>{e[r]=n,e[r+1]=s,e[r+2]=t[i+2]},nJe=(e,t,r,i,n,s)=>{e[r]=n,e[r+1]=s,e[r+2]=t[i+3]},U5e=(e,t,r,i,n,s)=>{e[r]=n,e[r+1]=s,e[r+2]=t[i+2],e[r+3]=t[i+3]};function jie(e,t,r,i){if(e){if(r)return t&&i?U5e:wN;if(t&&i)return nJe}else if(t&&i)return wN;return z5e}function DG({scale:e,translate:t},r){return Math.round((r-t[0])/e[0])}function FG({scale:e,translate:t},r){return Math.round((t[1]-r)/e[1])}function Due({scale:e,translate:t},r){return r*e[0]+t[0]}function Fue({scale:e,translate:t},r){return t[1]-r*e[1]}function x$t(e,t,r){return e?t?r?Wie(e):qie(e):r?Hie(e):uz(e):null}function uz(e){const t=e.coords;return{x:t[0],y:t[1]}}function B5e(e,t){return e.coords[0]=t.x,e.coords[1]=t.y,e}function qie(e){const t=e.coords;return{x:t[0],y:t[1],z:t[2]}}function sJe(e,t){return e.coords[0]=t.x,e.coords[1]=t.y,e.coords[2]=t.z,e}function Hie(e){const t=e.coords;return{x:t[0],y:t[1],m:t[2]}}function aJe(e,t){return e.coords[0]=t.x,e.coords[1]=t.y,e.coords[2]=t.m,e}function Wie(e){const t=e.coords;return{x:t[0],y:t[1],z:t[2],m:t[3]}}function oJe(e,t){return e.coords[0]=t.x,e.coords[1]=t.y,e.coords[2]=t.z,e.coords[3]=t.m,e}function lJe(e,t,r,i){let n=uz;r&&i?n=Wie:r?n=qie:i&&(n=Hie);for(const s of t){const{geometry:a,attributes:o}=s,l=_(a)?n(a):null;e.push({attributes:o,geometry:l})}return e}function Xie(e,t){return e&&t?oJe:e?sJe:t?aJe:B5e}function cJe(e,t,r,i,n){const s=Xie(r,i);for(const a of t){const{geometry:o,attributes:l}=a;let c;o&&(c=s(new ac,o)),e.push(new gm(c,l,null,l[n]))}return e}function T$t(e,t,r=Xie(t.z!=null,t.m!=null)){return r(e,t)}function dJe(e,t,r,i){for(const n of t){const{geometry:s,attributes:a}=n;let o;s&&(o=G5e(s,r,i)),e.push({attributes:a,geometry:o})}return e}function G5e(e,t,r){if(R(e))return null;const i=ko(t,r),n=[];for(let s=0;s<e.coords.length;s+=i){const a=[];for(let o=0;o<i;o++)a.push(e.coords[s+o]);n.push(a)}return t?r?{points:n,hasZ:t,hasM:r}:{points:n,hasZ:t}:r?{points:n,hasM:r}:{points:n}}function uJe(e,t,r,i,n){const s=ko(r,i);for(const a of t){const o=a.geometry,l=a.attributes;let c;o&&(c=j5e(new ac,o,s)),e.push(new gm(c,l,null,l[n]))}return e}function j5e(e,t,r=ko(t.hasZ,t.hasM)){e.lengths[0]=t.points.length;const i=e.coords;let n=0;for(const s of t.points)for(let a=0;a<r;a++)i[n++]=s[a];return e}function hJe(e,t,r,i){for(const n of t){const{geometry:s,attributes:a}=n;let o;_(s)&&(o=q5e(s,r,i)),e.push({attributes:a,geometry:o})}return e}function q5e(e,t,r){if(!e)return null;const i=ko(t,r),{coords:n,lengths:s}=e,a=[];let o=0;for(const l of s){const c=[];for(let u=0;u<l;u++){const h=[];for(let p=0;p<i;p++)h.push(n[o++]);c.push(h)}a.push(c)}return t?r?{paths:a,hasZ:t,hasM:r}:{paths:a,hasZ:t}:r?{paths:a,hasM:r}:{paths:a}}function fJe(e,t,r,i,n){const s=ko(r,i);for(const a of t){const o=a.geometry,l=a.attributes;let c;o&&(c=H5e(new ac,o,s)),e.push(new gm(c,l,null,l[n]))}return e}function H5e(e,t,r=ko(t.hasZ,t.hasM)){const{lengths:i,coords:n}=e;let s=0;for(const a of t.paths){for(const o of a)for(let l=0;l<r;l++)n[s++]=o[l];i.push(a.length)}return e}function pJe(e,t,r,i){for(const n of t){const{geometry:s,attributes:a,centroid:o}=n;let l;if(_(s)&&(l=W5e(s,r,i)),_(o)){const c=uz(o);e.push({attributes:a,centroid:c,geometry:l})}else e.push({attributes:a,geometry:l})}return e}function W5e(e,t,r){if(!e)return null;const i=ko(t,r),{coords:n,lengths:s}=e,a=[];let o=0;for(const l of s){const c=[];for(let u=0;u<l;u++){const h=[];for(let p=0;p<i;p++)h.push(n[o++]);c.push(h)}a.push(c)}return t?r?{rings:a,hasZ:t,hasM:r}:{rings:a,hasZ:t}:r?{rings:a,hasM:r}:{rings:a}}function mJe(e,t,r,i,n){for(const s of t){const a=s.geometry,o=s.centroid,l=s.attributes;let c;a&&(c=X5e(new ac,a,r,i)),_(o)?e.push(new gm(c,l,B5e(new ac,o),l[n])):e.push(new gm(c,l,null,l[n]))}return e}function X5e(e,t,r=t.hasZ,i=t.hasM){return gJe(e,t.rings,r,i),e}function gJe(e,t,r,i){const n=ko(r,i),{lengths:s,coords:a}=e;let o=0;s.length=a.length=0;for(const l of t){for(const c of l)for(let u=0;u<n;u++)a[o++]=c[u];s.push(l.length)}return e}const K4=[],e7=[];function S$t(e,t,r,i,n){K4[0]=e;const[s]=Y5e(e7,K4,t,r,i,n);return K4.length=e7.length=0,s}function Y5e(e,t,r,i,n,s){if(e.length=0,!r){for(const a of t){const o=a.attributes[s];e.push(new gm(null,a.attributes,null,o))}return e}switch(r){case"esriGeometryPoint":return cJe(e,t,i,n,s);case"esriGeometryMultipoint":return uJe(e,t,i,n,s);case"esriGeometryPolyline":return fJe(e,t,i,n,s);case"esriGeometryPolygon":return mJe(e,t,i,n,s);default:aO.error("convertToFeatureSet:unknown-geometry",new k(`Unable to parse unknown geometry type '${r}'`)),e.length=0}return e}function E$t(e,t,r,i){e7[0]=e,Q5e(K4,e7,t,r,i);const n=K4[0];return K4.length=e7.length=0,n}function yJe(e,t,r){if(R(e))return null;const i=new ac;return"hasZ"in e&&t==null&&(t=e.hasZ),"hasM"in e&&r==null&&(r=e.hasM),bre(e)?Xie(t!=null?t:e.z!=null,r!=null?r:e.m!=null)(i,e):iw(e)?X5e(i,e,t,r):vre(e)?H5e(i,e,ko(t,r)):yre(e)?j5e(i,e,ko(t,r)):void aO.error("convertFromGeometry:unknown-geometry",new k(`Unable to parse unknown geometry type '${e}'`))}function Z5e(e,t,r,i){const n=e&&("coords"in e?e:e.geometry);if(R(n))return null;switch(t){case"esriGeometryPoint":{let s=uz;return r&&i?s=Wie:r?s=qie:i&&(s=Hie),s(n)}case"esriGeometryMultipoint":return G5e(n,r,i);case"esriGeometryPolyline":return q5e(n,r,i);case"esriGeometryPolygon":return W5e(n,r,i);default:return void aO.error("convertToGeometry:unknown-geometry",new k(`Unable to parse unknown geometry type '${t}'`))}}function bJe(e,t){for(const r of t)e.push({attributes:r.attributes});return e}function Q5e(e,t,r,i,n){if(e.length=0,R(r))return bJe(e,t);switch(r){case"esriGeometryPoint":return lJe(e,t,i,n);case"esriGeometryMultipoint":return dJe(e,t,i,n);case"esriGeometryPolyline":return hJe(e,t,i,n);case"esriGeometryPolygon":return pJe(e,t,i,n);default:aO.error("convertToFeatureSet:unknown-geometry",new k(`Unable to parse unknown geometry type '${r}'`))}return e}function C$t(e){const{objectIdFieldName:t,spatialReference:r,transform:i,fields:n,hasM:s,hasZ:a,features:o,geometryType:l,exceededTransferLimit:c,uniqueIdField:u,queryGeometry:h,queryGeometryType:p}=e,m={features:Q5e([],o,l,a,s),fields:n,geometryType:l,objectIdFieldName:t,spatialReference:r,uniqueIdField:u,queryGeometry:Z5e(h,p,!1,!1)};return i&&(m.transform=i),c&&(m.exceededTransferLimit=c),s&&(m.hasM=s),a&&(m.hasZ=a),m}function A$t(e,t){const r=new dz,{hasM:i,hasZ:n,features:s,objectIdFieldName:a,spatialReference:o,geometryType:l,exceededTransferLimit:c,transform:u,fields:h}=e;return h&&(r.fields=h),r.geometryType=l,r.objectIdFieldName=a||t,r.spatialReference=o,r.objectIdFieldName?(s&&Y5e(r.features,s,l,n,i,r.objectIdFieldName),c&&(r.exceededTransferLimit=c),i&&(r.hasM=i),n&&(r.hasZ=n),u&&(r.transform=u),r):(aO.error(new k("optimized-features:invalid-objectIdFieldName","objectIdFieldName is missing")),r)}function R$t(e){const{transform:t,features:r,hasM:i,hasZ:n}=e;if(!t)return e;for(const s of r)_(s.geometry)&&XZ(s.geometry,s.geometry,i,n,t),_(s.centroid)&&XZ(s.centroid,s.centroid,i,n,t);return e.transform=null,e}function O$t(e,t){const{geometryType:r,features:i,hasM:n,hasZ:s}=t;if(!e)return t;for(let a=0;a<i.length;a++){const o=i[a],l=o.weakClone();l.geometry=new ac,Nue(l.geometry,o.geometry,n,s,r,e),o.centroid&&(l.centroid=new ac,Nue(l.centroid,o.centroid,n,s,"esriGeometryPoint",e)),i[a]=l}return t.transform=e,t}function Nue(e,t,r,i,n,s,a=r,o=i){if(e.lengths.length&&(e.lengths.length=0),e.coords.length&&(e.coords.length=0),R(t)||!t.coords.length)return null;const l=V5e[n],{coords:c,lengths:u}=t,h=ko(r,i),p=ko(r&&a,i&&o),m=jie(r,i,a,o);if(!u.length)return m(e.coords,c,0,0,DG(s,c[0]),FG(s,c[1])),e.lengths.length&&(e.lengths.length=0),e.coords.length=h,e;let g,b,w,v,x=0,T=0,E=T;for(const C of u){if(C<l)continue;let A=0;T=E,w=g=DG(s,c[x]),v=b=FG(s,c[x+1]),m(e.coords,c,T,x,w,v),A++,x+=h,T+=p;for(let P=1;P<C;P++,x+=h)w=DG(s,c[x]),v=FG(s,c[x+1]),w===g&&v===b||(m(e.coords,c,T,x,w-g,v-b),T+=p,A++,g=w,b=v);A>=l&&(e.lengths.push(A),E=T)}return e.coords.length=E,e.coords.length?e:null}function M$t(e,t,r,i,n,s,a=r,o=i){if(e.lengths.length&&(e.lengths.length=0),e.coords.length&&(e.coords.length=0),!t||!t.coords.length)return null;const l=V5e[n],{coords:c,lengths:u}=t,h=ko(r,i),p=ko(r&&a,i&&o),m=jie(r,i,a,o);if(!u.length)return m(e.coords,c,0,0,c[0],c[1]),e.lengths.length&&(e.lengths.length=0),e.coords.length=h,e;let g=0;const b=s*s;for(const w of u){if(w<l){g+=w*h;continue}const v=e.coords.length/p,x=g,T=g+(w-1)*h;m(e.coords,c,e.coords.length,x,c[x],c[x+1]),WZ(e.coords,c,h,b,m,x,T),m(e.coords,c,e.coords.length,T,c[T],c[T+1]);const E=e.coords.length/p-v;E>=l?e.lengths.push(E):e.coords.length=v*p,g+=w*h}return e.coords.length?e:null}function vJe(e,t,r,i){const n=e[t],s=e[t+1],a=e[r],o=e[r+1],l=e[i],c=e[i+1];let u=a,h=o,p=l-u,m=c-h;if(p!==0||m!==0){const g=((n-u)*p+(s-h)*m)/(p*p+m*m);g>1?(u=l,h=c):g>0&&(u+=p*g,h+=m*g)}return p=n-u,m=s-h,p*p+m*m}function WZ(e,t,r,i,n,s,a){let o,l=i,c=0;for(let u=s+r;u<a;u+=r)o=vJe(t,u,s,a),o>l&&(c=u,l=o);l>i&&(c-s>r&&WZ(e,t,r,i,n,s,c),n(e,t,e.length,c,t[c],t[c+1]),a-c>r&&WZ(e,t,r,i,n,c,a))}function P$t(e,t,r,i){if(R(t)||!t.coords||!t.coords.length)return null;const n=ko(r,i);let s=Number.POSITIVE_INFINITY,a=Number.POSITIVE_INFINITY,o=Number.NEGATIVE_INFINITY,l=Number.NEGATIVE_INFINITY;if(t&&t.coords){const c=t.coords;for(let u=0;u<c.length;u+=n){const h=c[u],p=c[u+1];s=Math.min(s,h),o=Math.max(o,h),a=Math.min(a,p),l=Math.max(l,p)}}return e[0]=s,e[1]=a,e[2]=o,e[3]=l,e}function XZ(e,t,r,i,n){const{coords:s,lengths:a}=t,o=r?i?U5e:wN:i?wN:z5e,l=ko(r,i);if(!s.length)return e!==t&&(e.lengths.length=0,e.coords.length=0),e;if(!a.length)return o(e.coords,s,0,0,Due(n,s[0]),Fue(n,s[1])),e!==t&&(e.lengths.length=0,e.coords.length=l),e;const[c,u]=n.scale;let h=0;for(let p=0;p<a.length;p++){const m=a[p];e.lengths[p]=m;let g=Due(n,s[h]),b=Fue(n,s[h+1]);o(e.coords,s,h,h,g,b),h+=l;for(let w=1;w<m;w++,h+=l)g+=s[h]*c,b-=s[h+1]*u,o(e.coords,s,h,h,g,b)}return e!==t&&(e.lengths.length=a.length,e.coords.length=s.length),e}function I$t(e,t,r,i,n,s){const a=ko(r,i),o=jie(r,i,n,s),l=t.coords;e.coords.length=0,e.lengths.length=0,e.lengths.push(...t.lengths);for(let c=0;c<l.length;c+=a)o(e.coords,l,e.coords.length,c,l[c],l[c+1]);return e}function _Je(e,t,r,i){let n=0,s=e[i*t],a=e[i*(t+1)];for(let o=1;o<r;o++){const l=s+e[i*(t+o)],c=a+e[i*(t+o)+1],u=(l-s)*(c+a);s=l,a=c,n+=u}return .5*n}function $$t(e,t){const{coords:r,lengths:i}=e;let n=0,s=0;for(let a=0;a<i.length;a++)s+=_Je(r,n,i[a],t),n+=a;return Math.abs(s)}function L$t(e,t){if(R(e))return null;const r=e.clone(),i=e.coords,n=e.lengths;let s=0;for(let a=0;a<n.length;a++){const o=n[a];let l=i[t*s],c=i[t*s+1];for(let u=1;u<o;u++){const h=l+i[t*(s+u)],p=c+i[t*(s+u)+1];r.coords[t*(s+u)]=h,r.coords[t*(s+u)+1]=p,l=h,c=p}s+=o}return r}var YZ;let On=YZ=class extends ge{constructor(e){super(e),this.cacheHint=void 0,this.dynamicDataSource=void 0,this.gdbVersion=null,this.geometryPrecision=void 0,this.historicMoment=null,this.maxAllowableOffset=void 0,this.objectIds=null,this.orderByFields=null,this.outFields=null,this.outSpatialReference=null,this.relationshipId=void 0,this.start=void 0,this.num=void 0,this.returnGeometry=!1,this.returnM=void 0,this.returnZ=void 0,this.where=null}_writeHistoricMoment(e,t){t.historicMoment=e&&e.getTime()}writeStart(e,t){t.resultOffset=this.start,t.resultRecordCount=this.num||10,this.start>0&&this.where==null&&(t.definitionExpression="1=1")}clone(){return new YZ(te({cacheHint:this.cacheHint,dynamicDataSource:this.dynamicDataSource,gdbVersion:this.gdbVersion,geometryPrecision:this.geometryPrecision,historicMoment:this.historicMoment&&new Date(this.historicMoment.getTime()),maxAllowableOffset:this.maxAllowableOffset,objectIds:this.objectIds,orderByFields:this.orderByFields,outFields:this.outFields,outSpatialReference:this.outSpatialReference,relationshipId:this.relationshipId,start:this.start,num:this.num,returnGeometry:this.returnGeometry,where:this.where,returnZ:this.returnZ,returnM:this.returnM}))}};d([f({type:Boolean,json:{write:!0}})],On.prototype,"cacheHint",void 0),d([f({type:jc,json:{write:!0}})],On.prototype,"dynamicDataSource",void 0),d([f({type:String,json:{write:!0}})],On.prototype,"gdbVersion",void 0),d([f({type:Number,json:{write:!0}})],On.prototype,"geometryPrecision",void 0),d([f({type:Date})],On.prototype,"historicMoment",void 0),d([Xe("historicMoment")],On.prototype,"_writeHistoricMoment",null),d([f({type:Number,json:{write:!0}})],On.prototype,"maxAllowableOffset",void 0),d([f({type:[Number],json:{write:!0}})],On.prototype,"objectIds",void 0),d([f({type:[String],json:{write:!0}})],On.prototype,"orderByFields",void 0),d([f({type:[String],json:{write:!0}})],On.prototype,"outFields",void 0),d([f({type:Ye,json:{read:{source:"outSR"},write:{target:"outSR"}}})],On.prototype,"outSpatialReference",void 0),d([f({json:{write:!0}})],On.prototype,"relationshipId",void 0),d([f({type:Number,json:{read:{source:"resultOffset"}}})],On.prototype,"start",void 0),d([Xe("start"),Xe("num")],On.prototype,"writeStart",null),d([f({type:Number,json:{read:{source:"resultRecordCount"}}})],On.prototype,"num",void 0),d([f({json:{write:!0}})],On.prototype,"returnGeometry",void 0),d([f({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],On.prototype,"returnM",void 0),d([f({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],On.prototype,"returnZ",void 0),d([f({type:String,json:{read:{source:"definitionExpression"},write:{target:"definitionExpression"}}})],On.prototype,"where",void 0),On=YZ=d([$("esri.rest.support.RelationshipQuery")],On),On.from=rs(On);const Bw=On;var ZZ;let fS=ZZ=class extends ge{constructor(e){super(e),this.groupByFields=void 0,this.topCount=void 0,this.orderByFields=void 0}clone(){return new ZZ({groupByFields:this.groupByFields,topCount:this.topCount,orderByFields:this.orderByFields})}};d([f({type:[String],json:{write:!0}})],fS.prototype,"groupByFields",void 0),d([f({type:Number,json:{write:!0}})],fS.prototype,"topCount",void 0),d([f({type:[String],json:{write:!0}})],fS.prototype,"orderByFields",void 0),fS=ZZ=d([$("esri.rest.support.TopFilter")],fS);const wJe=fS;var QZ;const kue=new tr({esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"envelope-intersects",esriSpatialRelIndexIntersects:"index-intersects",esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:"relation"}),Vue=new tr({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"});let on=QZ=class extends ge{constructor(e){super(e),this.cacheHint=void 0,this.distance=void 0,this.geometry=null,this.geometryPrecision=void 0,this.maxAllowableOffset=void 0,this.num=void 0,this.objectIds=null,this.orderByFields=null,this.outFields=null,this.outSpatialReference=null,this.resultType=null,this.returnGeometry=!1,this.returnM=void 0,this.returnZ=void 0,this.start=void 0,this.spatialRelationship="intersects",this.timeExtent=null,this.topFilter=void 0,this.units=null,this.where="1=1"}writeStart(e,t){t.resultOffset=this.start,t.resultRecordCount=this.num||10}clone(){return new QZ(te({cacheHint:this.cacheHint,distance:this.distance,geometry:this.geometry,geometryPrecision:this.geometryPrecision,maxAllowableOffset:this.maxAllowableOffset,num:this.num,objectIds:this.objectIds,orderByFields:this.orderByFields,outFields:this.outFields,outSpatialReference:this.outSpatialReference,resultType:this.resultType,returnGeometry:this.returnGeometry,returnZ:this.returnZ,returnM:this.returnM,start:this.start,spatialRelationship:this.spatialRelationship,timeExtent:this.timeExtent,topFilter:this.topFilter,units:this.units,where:this.where}))}};d([f({type:Boolean,json:{write:!0}})],on.prototype,"cacheHint",void 0),d([f({type:Number,json:{write:{overridePolicy:e=>({enabled:e>0})}}})],on.prototype,"distance",void 0),d([f({types:bx,json:{read:Ry,write:!0}})],on.prototype,"geometry",void 0),d([f({type:Number,json:{write:!0}})],on.prototype,"geometryPrecision",void 0),d([f({type:Number,json:{write:!0}})],on.prototype,"maxAllowableOffset",void 0),d([f({type:Number,json:{read:{source:"resultRecordCount"}}})],on.prototype,"num",void 0),d([f({json:{write:!0}})],on.prototype,"objectIds",void 0),d([f({type:[String],json:{write:!0}})],on.prototype,"orderByFields",void 0),d([f({type:[String],json:{write:!0}})],on.prototype,"outFields",void 0),d([f({type:Ye,json:{read:{source:"outSR"},write:{target:"outSR"}}})],on.prototype,"outSpatialReference",void 0),d([f({type:String,json:{write:!0}})],on.prototype,"resultType",void 0),d([f({json:{write:!0}})],on.prototype,"returnGeometry",void 0),d([f({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],on.prototype,"returnM",void 0),d([f({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],on.prototype,"returnZ",void 0),d([f({type:Number,json:{read:{source:"resultOffset"}}})],on.prototype,"start",void 0),d([Xe("start"),Xe("num")],on.prototype,"writeStart",null),d([f({type:String,json:{read:{source:"spatialRel",reader:kue.read},write:{target:"spatialRel",writer:kue.write}}})],on.prototype,"spatialRelationship",void 0),d([f({type:Mm,json:{write:!0}})],on.prototype,"timeExtent",void 0),d([f({type:wJe,json:{write:!0}})],on.prototype,"topFilter",void 0),d([f({type:String,json:{read:Vue.read,write:{writer:Vue.write,overridePolicy(e){return{enabled:e&&this.distance>0}}}}})],on.prototype,"units",void 0),d([f({type:String,json:{write:!0}})],on.prototype,"where",void 0),on=QZ=d([$("esri.rest.support.TopFeaturesQuery")],on),on.from=rs(on);const uv=on,xJe="esri.widgets.Feature.support.relatedFeatureUtils",zue=fe.getLogger(xJe),Uue=new Map;function JZ(e){if(!Jg(e))return null;const[t,r]=e.split("/").slice(1);return{layerId:t,fieldName:r}}function TJe(e,t){if(!t.relationships)return null;let r=null;const{relationships:i}=t;return i.some(n=>n.id===parseInt(e,10)&&(r=n,!0)),r}function SJe({originRelationship:e,relationships:t,layerId:r}){let i;return t&&t.some(n=>(`${n.relatedTableId}`===r&&n.id===e.id&&(i=n),!!i)),i}function EJe(e,t){const r=t.toLowerCase();for(const i in e)if(i.toLowerCase()===r)return e[i];return null}function CJe(e,t){const r=TJe(e,t);if(!!r)return{url:`${t.url}/${r.relatedTableId}`,sourceSpatialReference:t.spatialReference,relation:r,relatedFields:[],outStatistics:[]}}function AJe(e,t){if(!t||!e)return;const{features:r,statsFeatures:i}=e,n=r&&r.value;t.relatedFeatures=n?n.features:[];const s=i&&i.value;t.relatedStatsFeatures=s?s.features:[]}function RJe(e,t,r,i){const n=new Bw;return n.outFields=["*"],n.relationshipId=typeof t.id=="number"?t.id:parseInt(t.id,10),n.objectIds=[e.attributes[r.objectIdField]],r.queryRelatedFeatures(n,i)}function OJe(e,t,r){let i=0;const n=[];for(;i<t.length;)n.push(`${e} IN (${t.slice(i,r+i)})`),i+=r;return n.join(" OR ")}async function MJe(e,t,r,i){const n=r.layerId.toString(),{layerInfo:s,relation:a,relatedFields:o,outStatistics:l,url:c,sourceSpatialReference:u}=t,h=SJe({originRelationship:a,relationships:s.relationships,layerId:n});if(h.relationshipTableId&&h.keyFieldInRelationshipTable){const m=(await RJe(e,h,r,i))[e.attributes[r.objectIdField]];if(!m)return null;const g=m.features.map(b=>b.attributes[s.objectIdField]);if((l==null?void 0:l.length)>0&&s.supportsStatistics){const b=new Zn;b.where=OJe(s.objectIdField,g,1e3),b.outFields=o,b.outStatistics=l,b.sourceSpatialReference=u;const w={features:Promise.resolve(m),statsFeatures:LG(c,b)};return dn(w)}}const p=h==null?void 0:h.keyField;if(p){const m=J9(DJe(s.fields,p)),g=EJe(e.attributes,a.keyField),b=m?`${p}=${g}`:`${p}='${g}'`,w=LG(c,new Zn({where:b,outFields:t.relatedFields,sourceSpatialReference:u}),i),v=t.outStatistics&&t.outStatistics.length>0&&s.supportsStatistics?LG(c,new Zn({where:b,outFields:t.relatedFields,outStatistics:t.outStatistics,sourceSpatialReference:u}),i):null,x={features:w};return v&&(x.statsFeatures=v),dn(x)}return null}function PJe(e,t){return qt(e,{query:{f:"json"},signal:t&&t.signal})}function IJe({relatedInfos:e,layer:t},r){const i={};return e.forEach((n,s)=>{const{relation:a}=n;if(!a){const h=new k("relation-required","A relation is required on a layer to retrieve related records.");throw zue.error(h),h}const{relatedTableId:o}=a;if(typeof o!="number"){const h=new k("A related table ID is required on a layer to retrieve related records.");throw zue.error(h),h}const l=`${t.url}/${o}`,c=Uue.get(l),u=c||PJe(l,r);c||Uue.set(l,u),i[s]=u}),dn(i)}function $Je({graphic:e,relatedInfos:t,layer:r},i){const n={};return t.forEach((s,a)=>{s.layerInfo&&(n[a]=MJe(e,s,r,i))}),dn(n)}function LJe({relatedInfo:e,fieldName:t,fieldInfo:r}){if(e.relatedFields.push(t),r.statisticType){const i=new pw({statisticType:r.statisticType,onStatisticField:t,outStatisticFieldName:t});e.outStatistics.push(i)}}function DJe(e,t){if(e!=null){t=t.toLowerCase();for(const r of e)if(r&&r.name.toLowerCase()===t)return r}return null}const Bue={chartAnimation:!0};let ga=class extends xe{constructor(e){super(e),this.abilities={...Bue},this.activeMediaInfoIndex=0,this.attributes=null,this.description=null,this.fieldInfoMap=null,this.formattedAttributes=null,this.expressionAttributes=null,this.layer=null,this.mediaInfos=null,this.popupTemplate=null,this.relatedInfos=null,this.title=null}castAbilities(e){return{...Bue,...e}}get activeMediaInfo(){return this.formattedMediaInfos[this.activeMediaInfoIndex]||null}get formattedMediaInfos(){return this._formatMediaInfos()||[]}get formattedMediaInfoCount(){return this.formattedMediaInfos.length}setActiveMedia(e){this._setContentElementMedia(e)}next(){this._pageContentElementMedia(1)}previous(){this._pageContentElementMedia(-1)}_setContentElementMedia(e){const{formattedMediaInfoCount:t}=this,r=(e+t)%t;this.activeMediaInfoIndex=r}_pageContentElementMedia(e){const{activeMediaInfoIndex:t}=this,r=t+e;this._setContentElementMedia(r)}_formatMediaInfos(){const{attributes:e,mediaInfos:t,formattedAttributes:r,expressionAttributes:i,fieldInfoMap:n,layer:s}=this;return t==null?void 0:t.map(a=>{const o=a==null?void 0:a.clone();if(!o)return null;if(o.title=B3({attributes:e,fieldInfoMap:n,globalAttributes:r,expressionAttributes:i,layer:s,text:o.title}),o.caption=B3({attributes:e,fieldInfoMap:n,globalAttributes:r,expressionAttributes:i,layer:s,text:o.caption}),o.altText=B3({attributes:e,fieldInfoMap:n,globalAttributes:r,expressionAttributes:i,layer:s,text:o.altText}),o.type==="image"){const{value:l}=o;return this._setImageValue({value:l,formattedAttributes:r,layer:s}),o.value.sourceURL?o:void 0}if(o.type==="pie-chart"||o.type==="line-chart"||o.type==="column-chart"||o.type==="bar-chart"){const{value:l}=o;return this._setChartValue({value:l,chartType:o.type,attributes:e,formattedAttributes:r,layer:s}),o}return null}).filter(Boolean)}_setImageValue(e){const{fieldInfoMap:t}=this,{value:r,formattedAttributes:i,layer:n}=e,{linkURL:s,sourceURL:a}=r;if(a){const o=SZ(a,n);r.sourceURL=TZ({formattedAttributes:i,template:o,fieldInfoMap:t})}if(s){const o=SZ(s,n);r.linkURL=TZ({formattedAttributes:i,template:o,fieldInfoMap:t})}}_setChartValue(e){const{value:t,attributes:r,formattedAttributes:i,chartType:n,layer:s}=e,{popupTemplate:a,relatedInfos:o}=this,{fields:l,normalizeField:c}=t;if(t.fields=rYe(l,s),c&&(t.normalizeField=uN(c,s)),!l.some(h=>!!(i[h]!=null||Jg(h)&&o.size)))return;const u=a==null?void 0:a.fieldInfos;l.forEach(h=>{if(Jg(h))return void(t.series=[...t.series,...this._getRelatedChartInfos({fieldInfos:u,fieldName:h,formattedAttributes:i,chartType:n,value:t})]);const p=this._getChartOption({value:t,attributes:r,chartType:n,formattedAttributes:i,fieldName:h,fieldInfos:u});t.series.push(p)})}_getRelatedChartInfos(e){var g;const{fieldInfos:t,fieldName:r,formattedAttributes:i,chartType:n,value:s}=e,a=[],o=JZ(r),{layerId:l,fieldName:c}=o,u=(g=this.relatedInfos)==null?void 0:g.get(l.toString());if(!u)return a;const{relatedFeatures:h,relation:p}=u;if(!p||!h)return a;const{cardinality:m}=p;return h.forEach(b=>{const{attributes:w}=b;w&&Object.keys(w).forEach(v=>{v===c&&a.push(this._getChartOption({value:s,attributes:w,formattedAttributes:i,fieldName:r,chartType:n,relatedFieldName:v,fieldInfos:t}))})}),m==="one-to-many"||m==="many-to-many"?a:[a[0]]}_getTooltip({label:e,value:t,chartType:r}){return r==="pie-chart"?`${e}`:`${e}: ${t}`}_getChartOption(e){var T,E,C,A,P,I;const{value:t,attributes:r,formattedAttributes:i,fieldName:n,relatedFieldName:s,fieldInfos:a,chartType:o}=e,{layer:l,fieldInfoMap:c}=this,{normalizeField:u,tooltipField:h}=t,p=u?Jg(u)?r[JZ(u).fieldName]:r[u]:null,m=s&&r[s]!==void 0?r[s]:r[n]!==void 0?r[n]:i[n],g=new sxe({fieldName:n,value:m===void 0?null:m&&p?m/p:m});if(Jg(n)){const L=c.get(n.toLowerCase()),V=c.get(h.toLowerCase()),G=(T=L==null?void 0:L.fieldName)!=null?T:n,B=(P=(A=(C=i[(E=V==null?void 0:V.fieldName)!=null?E:h])!=null?C:L==null?void 0:L.label)!=null?A:L==null?void 0:L.fieldName)!=null?P:s,X=i[G];return g.tooltip=this._getTooltip({label:B,value:X,chartType:o}),g}const b=q4e(a,n),w=uN(n,l),v=h&&i[h]!==void 0?i[h]:G4e(b||new JR({fieldName:w}),(I=this.popupTemplate)==null?void 0:I.expressionInfos),x=i[w];return g.tooltip=this._getTooltip({label:v,value:x,chartType:o}),g}};d([f()],ga.prototype,"abilities",void 0),d([Xt("abilities")],ga.prototype,"castAbilities",null),d([f()],ga.prototype,"activeMediaInfoIndex",void 0),d([f({readOnly:!0})],ga.prototype,"activeMediaInfo",null),d([f()],ga.prototype,"attributes",void 0),d([f()],ga.prototype,"description",void 0),d([f()],ga.prototype,"fieldInfoMap",void 0),d([f()],ga.prototype,"formattedAttributes",void 0),d([f()],ga.prototype,"expressionAttributes",void 0),d([f({readOnly:!0})],ga.prototype,"formattedMediaInfos",null),d([f()],ga.prototype,"layer",void 0),d([f({readOnly:!0})],ga.prototype,"formattedMediaInfoCount",null),d([f()],ga.prototype,"mediaInfos",void 0),d([f()],ga.prototype,"popupTemplate",void 0),d([f()],ga.prototype,"relatedInfos",void 0),d([f()],ga.prototype,"title",void 0),ga=d([$("esri.widgets.Feature.FeatureMedia.FeatureMediaViewModel")],ga);const j3=ga;var Gue=["#ffffff","#858585","#ffbebe","#ffebbe","#ffebaf","#ffffbe","#e9ffbe","#d3ffbe","#beffe8","#bee8ff","#bed2ff","#e8beff","#ffbee8","#ebebeb","#707070","#ff7f7f","#ffa77f","#ffd37f","#ffff73","#d1ff73","#a3ff73","#73ffdf","#73dfff","#73b2ff","#df73ff","#ff73df","#d6d6d6","#5c5c5c","#ff0000","#ff5500","#ffaa00","#ffff00","#aaff00","#55ff00","#00ffc5","#00c5ff","#0070ff","#c500ff","#ff00c5","#c2c2c2","#474747","#e60000","#e64c00","#e69800","#e6e600","#98e600","#4ce600","#00e6a9","#00a9e6","#005ce6","#a900e6","#e600a9","#adadad","#242424","#a80000","#a83800","#a87000","#a8a800","#70a800","#38a800","#00a884","#0084a8","#004da8","#8400a8","#a80084","#999999","#1a1a1a","#730000","#732600","#734c00","#737300","#4c7300","#267300","#00734c","#004c73","#002673","#4c0073","#73004"],FJe=[].concat(Gue.slice(30,39),Gue.slice(28,30).reverse()),NJe=[{name:"default",colors:FJe},{name:"cat-dark",colors:["#ed5151","#149ece","#a7c636","#9e559c","#fc921f","#ffde3e","#f789d8","#b7814a","#3caf99","#6b6bd6","#b54779","#7f7f7f"]},{name:"tropical-bliss",colors:["#fce138","#ff9399","#fcd27e","#f1983c","#a553b7","#b1a9d0","#6ecffc","#4c81cd","#fc6f84","#fc3e5a","#6af689","#48885c"]},{name:"desert-blooms",colors:["#102432","#144d59","#ffc730","#ed9310","#a64f1b","#661510","#d9351a","#b31515","#4a0932","#8c213f","#18382e","#2c6954"]},{name:"under-the-sea",colors:["#bf9727","#607100","#00734c","#704489","#01acca","#024e76","#f09100","#ea311f","#c6004b","#7570b3","#666666","#333333"]},{name:"vibrant-rainbow",colors:["#fffb00","#f5cb11","#9fd40c","#46e39c","#32b8a6","#7ff2fa","#ac08cc","#dd33ff","#eb7200","#e8a784","#bf2e2e","#6c7000"]},{name:"ocean-bay",colors:["#191921","#11495c","#78b1c2","#454f4b","#8f8f82","#9be0c0","#87b051","#f7ec88","#ebdcc1","#dbb658","#c43541","#75351e"]},{name:"prairie-summer",colors:["#332424","#751555","#d47013","#d68989","#211173","#82aad6","#7bfaeb","#6ec9a8","#6b6408","#eada40","#ccc54a","#1fc235"]},{name:"pastel-chalk",colors:["#fffd99","#f5e6a4","#c1d48c","#b8e3d0","#a0b8b5","#cbf7fa","#d791f2","#dfc1eb","#f2b983","#e8c4b2","#bf8e8e","#94995c"]},{name:"seq-yellow-orange-red-bright",colors:["#910000","#b1260b","#c0370f","#e05919","#ef6a1d","#ff7b22","#ffa143","#ffb454","#ffda74","#ffed85"]},{name:"seq-reds-bright",colors:["#57453b","#7b4238","#9f4036","#c23d33","#d7483c","#ec5244","#f3696c","#f9816c","#ffc4ae","#fff0dc"]},{name:"seq-purples-bright",colors:["#4e465c","#5a4a78","#695291","#775baa","#8663c3","#946bdc","#aa89e8","#c1a6f3","#d7c4ff","#e6e1ff"]},{name:"seq-blues-bright",colors:["#404d54","#435c6c","#48799d","#4b88b6","#4d96ce","#50a5e7","#74bbed","#98d0f3","#bce6f9","#e6faff"]},{name:"seq-greens-bright",colors:["#39544c","#386757","#368165","#359b73","#33b581","#4bc392","#64d2a2","#7ce0b3","#cbf6d9","#f4ffea"]},{name:"seq-browns-bright",colors:["#524834","#715b38","#8f6e3c","#ae8140","#cc9444","#eba748","#eeb664","#f0c47f","#f9e0b7","#fff8eb"]}];const jue="en-us",Yie=new Map([["ar",()=>ie(()=>import("./ar.4dc6191a.js"),["ar.4dc6191a.js","_commonjsHelpers.ce2b5698.js"],import.meta.url).then(e=>e.a)],["bg-bg",()=>ie(()=>import("./bg_BG.c52f2d3f.js"),["bg_BG.c52f2d3f.js","_commonjsHelpers.ce2b5698.js"],import.meta.url).then(e=>e.b)],["bs-ba",()=>ie(()=>import("./bs_BA.dea32ce5.js"),["bs_BA.dea32ce5.js","_commonjsHelpers.ce2b5698.js"],import.meta.url).then(e=>e.b)],["ca-es",()=>ie(()=>import("./ca_ES.20b19104.js"),["ca_ES.20b19104.js","_commonjsHelpers.ce2b5698.js"],import.meta.url).then(e=>e.c)],["cs-cz",()=>ie(()=>import("./cs_CZ.30f0a0dc.js"),["cs_CZ.30f0a0dc.js","_commonjsHelpers.ce2b5698.js"],import.meta.url).then(e=>e.c)],["da-dk",()=>ie(()=>import("./da_DK.b8d0e7ac.js"),["da_DK.b8d0e7ac.js","_commonjsHelpers.ce2b5698.js"],import.meta.url).then(e=>e.d)],["de-de",()=>ie(()=>import("./de_DE.08196323.js"),["de_DE.08196323.js","_commonjsHelpers.ce2b5698.js"],import.meta.url).then(e=>e.d)],["de-ch",()=>ie(()=>import("./de_CH.5d6685a9.js"),["de_CH.5d6685a9.js","_commonjsHelpers.ce2b5698.js"],import.meta.url).then(e=>e.d)],["el-gr",()=>ie(()=>import("./el_GR.c34c39c2.js"),["el_GR.c34c39c2.js","_commonjsHelpers.ce2b5698.js"],import.meta.url).then(e=>e.e)],["en-us",()=>ie(()=>import("./en_US.58fb12c0.js"),["en_US.58fb12c0.js","_commonjsHelpers.ce2b5698.js"],import.meta.url).then(e=>e.e)],["en-ca",()=>ie(()=>import("./en_CA.bf2bc83b.js"),["en_CA.bf2bc83b.js","_commonjsHelpers.ce2b5698.js"],import.meta.url).then(e=>e.e)],["es-es",()=>ie(()=>import("./es_ES.990a5784.js"),["es_ES.990a5784.js","_commonjsHelpers.ce2b5698.js"],import.meta.url).then(e=>e.e)],["et-ee",()=>ie(()=>import("./et_EE.3eaec652.js"),["et_EE.3eaec652.js","_commonjsHelpers.ce2b5698.js"],import.meta.url).then(e=>e.e)],["fi-fi",()=>ie(()=>import("./fi_FI.5397a92e.js"),["fi_FI.5397a92e.js","_commonjsHelpers.ce2b5698.js"],import.meta.url).then(e=>e.f)],["fr-fr",()=>ie(()=>import("./fr_FR.1735cff8.js"),["fr_FR.1735cff8.js","_commonjsHelpers.ce2b5698.js"],import.meta.url).then(e=>e.f)],["he-il",()=>ie(()=>import("./he_IL.fa6085be.js"),["he_IL.fa6085be.js","_commonjsHelpers.ce2b5698.js"],import.meta.url).then(e=>e.h)],["hr-hr",()=>ie(()=>import("./hr_HR.e9361751.js"),["hr_HR.e9361751.js","_commonjsHelpers.ce2b5698.js"],import.meta.url).then(e=>e.h)],["hu-hu",()=>ie(()=>import("./hu_HU.37349893.js"),["hu_HU.37349893.js","_commonjsHelpers.ce2b5698.js"],import.meta.url).then(e=>e.h)],["id-id",()=>ie(()=>import("./id_ID.935d8150.js"),["id_ID.935d8150.js","_commonjsHelpers.ce2b5698.js"],import.meta.url).then(e=>e.i)],["it-it",()=>ie(()=>import("./it_IT.c73e8e5e.js"),["it_IT.c73e8e5e.js","_commonjsHelpers.ce2b5698.js"],import.meta.url).then(e=>e.i)],["ja-jp",()=>ie(()=>import("./ja_JP.17363a69.js"),["ja_JP.17363a69.js","_commonjsHelpers.ce2b5698.js"],import.meta.url).then(e=>e.j)],["ko-kr",()=>ie(()=>import("./ko_KR.b3c8049f.js"),["ko_KR.b3c8049f.js","_commonjsHelpers.ce2b5698.js"],import.meta.url).then(e=>e.k)],["lt-lt",()=>ie(()=>import("./lt_LT.520661ee.js"),["lt_LT.520661ee.js","_commonjsHelpers.ce2b5698.js"],import.meta.url).then(e=>e.l)],["lv-lv",()=>ie(()=>import("./lv_LV.c2022ffc.js"),["lv_LV.c2022ffc.js","_commonjsHelpers.ce2b5698.js"],import.meta.url).then(e=>e.l)],["nb-no",()=>ie(()=>import("./nb_NO.b81af806.js"),["nb_NO.b81af806.js","_commonjsHelpers.ce2b5698.js"],import.meta.url).then(e=>e.n)],["nl-nl",()=>ie(()=>import("./nl_NL.b5e4e1f8.js"),["nl_NL.b5e4e1f8.js","_commonjsHelpers.ce2b5698.js"],import.meta.url).then(e=>e.n)],["pl-pl",()=>ie(()=>import("./pl_PL.47a9df4a.js"),["pl_PL.47a9df4a.js","_commonjsHelpers.ce2b5698.js"],import.meta.url).then(e=>e.p)],["pt-br",()=>ie(()=>import("./pt_BR.512ff419.js"),["pt_BR.512ff419.js","_commonjsHelpers.ce2b5698.js"],import.meta.url).then(e=>e.p)],["pt-pt",()=>ie(()=>import("./pt_PT.89c766b3.js"),["pt_PT.89c766b3.js","_commonjsHelpers.ce2b5698.js"],import.meta.url).then(e=>e.p)],["ro-ro",()=>ie(()=>import("./ro_RO.cdb10687.js"),["ro_RO.cdb10687.js","_commonjsHelpers.ce2b5698.js"],import.meta.url).then(e=>e.r)],["ru-ru",()=>ie(()=>import("./ru_RU.fb5ffe9b.js"),["ru_RU.fb5ffe9b.js","_commonjsHelpers.ce2b5698.js"],import.meta.url).then(e=>e.r)],["sk-sk",()=>ie(()=>import("./sk_SK.c690c7d2.js"),["sk_SK.c690c7d2.js","_commonjsHelpers.ce2b5698.js"],import.meta.url).then(e=>e.s)],["sl-sl",()=>ie(()=>import("./sl_SL.b6513f33.js"),["sl_SL.b6513f33.js","_commonjsHelpers.ce2b5698.js"],import.meta.url).then(e=>e.s)],["sr-rs",()=>ie(()=>import("./sr_RS.71408a7c.js"),["sr_RS.71408a7c.js","_commonjsHelpers.ce2b5698.js"],import.meta.url).then(e=>e.s)],["sv-se",()=>ie(()=>import("./sv_SE.5f00a442.js"),["sv_SE.5f00a442.js","_commonjsHelpers.ce2b5698.js"],import.meta.url).then(e=>e.s)],["th-th",()=>ie(()=>import("./th_TH.e8c3ff07.js"),["th_TH.e8c3ff07.js","_commonjsHelpers.ce2b5698.js"],import.meta.url).then(e=>e.t)],["tr-tr",()=>ie(()=>import("./tr_TR.0d292c66.js"),["tr_TR.0d292c66.js","_commonjsHelpers.ce2b5698.js"],import.meta.url).then(e=>e.t)],["uk-ua",()=>ie(()=>import("./uk_UA.f4a29cdf.js"),["uk_UA.f4a29cdf.js","_commonjsHelpers.ce2b5698.js"],import.meta.url).then(e=>e.u)],["vi-vn",()=>ie(()=>import("./vi_VN.806d0c36.js"),["vi_VN.806d0c36.js","_commonjsHelpers.ce2b5698.js"],import.meta.url).then(e=>e.v)],["zh-cn",()=>ie(()=>import("./zh_Hans.a407cf98.js"),["zh_Hans.a407cf98.js","_commonjsHelpers.ce2b5698.js"],import.meta.url).then(e=>e.z)],["zh-hk",()=>ie(()=>import("./zh_Hant.7e13eee4.js"),["zh_Hant.7e13eee4.js","_commonjsHelpers.ce2b5698.js"],import.meta.url).then(e=>e.z)],["zh-tw",()=>ie(()=>import("./zh_Hant.7e13eee4.js"),["zh_Hant.7e13eee4.js","_commonjsHelpers.ce2b5698.js"],import.meta.url).then(e=>e.z)]]);function kJe(e){const t=e.split("-")[0].toLowerCase();let r=null;for(const i of Yie.keys())if(i.startsWith(t)){r=i;break}return r}function VJe(e){return e?Yie.has(e.toLowerCase())?e.toLowerCase():kJe(e)||jue:jue}let Bx,Y6;async function zJe(e=mu()){if(e=VJe(e),Bx&&e===Y6)return Bx;Bx=ie(()=>import("./index.80c6615c.js"),["index.80c6615c.js","_commonjsHelpers.ce2b5698.js"],import.meta.url).then(t=>t.i),Y6=e;try{const[t,r]=await Promise.all([Bx,Yie.get(Y6)()]);Y6===e&&(t.am4core.options.defaultLocale=r.default),t.am4core.options.suppressWarnings=!0,t.am4core.options.autoDispose=!0}catch{return Bx=null,Y6=null,null}return Bx}function UJe(e,t="default"){const r=NJe.find(i=>i.name===t);return r?r.colors.map(i=>e.color(i)):null}const Vn={base:"esri-feature-media",mediaContainer:"esri-feature-media__container",mediaItemContainer:"esri-feature-media__item-container",mediaItem:"esri-feature-media__item",mediaItemTitle:"esri-feature-media__item-title",mediaItemCaption:"esri-feature-media__item-caption",mediaPrevious:"esri-feature-media__previous",mediaPreviousIconLTR:"esri-feature-media__previous-icon",mediaPreviousIconRTL:"esri-feature-media__previous-icon--rtl",mediaNext:"esri-feature-media__next",mediaNextIconLTR:"esri-feature-media__next-icon",mediaNextIconRTL:"esri-feature-media__next-icon--rtl",mediaChart:"esri-feature-media__chart",mediaButton:"esri-feature-media__button",mediaIcon:"esri-feature-media__icon",iconLeftTriangleArrow:"esri-icon-left-triangle-arrow",iconRightTriangleArrow:"esri-icon-right-triangle-arrow"},NG=.05,kG=.95,VG=15,zm="color",ub="tooltip",Z6="value",que="default-line-value";let Pc=class extends Bs{constructor(e,t){super(e,t),this._refreshTimer=null,this._refreshIntervalInfo=null,this._featureElementInfo=null,this.attributes=null,this.activeMediaInfoIndex=null,this.description=null,this.fieldInfoMap=null,this.layer=null,this.mediaInfos=null,this.popupTemplate=null,this.relatedInfos=null,this.title=null,this.viewModel=new j3,this.messages=null,this._getChartDependencies=async r=>{const i=await zJe(),{destroyed:n,viewModel:s}=this;if(n||!s||!r)return;const{activeMediaInfo:a}=s,o=await this._getRendererColors(i);this._renderChart({chartDiv:r,mediaInfo:a,chartsModule:i,colorMap:o})}}initialize(){this._featureElementInfo=new Mie,this.own([re(()=>{var e,t;return[(e=this.viewModel)==null?void 0:e.activeMediaInfo,(t=this.viewModel)==null?void 0:t.activeMediaInfoIndex]},()=>this._setupMediaRefreshTimer(),Ot),re(()=>{var e,t;return[(e=this.viewModel)==null?void 0:e.description,(t=this.viewModel)==null?void 0:t.title]},()=>this._setupFeatureElementInfo(),Ot)])}destroy(){this._clearMediaRefreshTimer(),this._featureElementInfo.destroy()}render(){var e;return z("div",{bind:this,class:Vn.base,onkeyup:this._handleMediaKeyup},(e=this._featureElementInfo)==null?void 0:e.render(),this.renderMedia())}renderMedia(){const{formattedMediaInfoCount:e}=this.viewModel;return e?z("div",{key:"media-element-container",class:Vn.mediaContainer},this.renderMediaPageButton("previous"),this.renderMediaInfo(),this.renderMediaPageButton("next")):null}renderImageMediaInfo(e){const{_refreshIntervalInfo:t}=this,{activeMediaInfoIndex:r,formattedMediaInfoCount:i}=this.viewModel,{value:n,refreshInterval:s,altText:a,title:o,type:l}=e,{sourceURL:c,linkURL:u}=n,h=U4e(u)?"_blank":"_self",p=h==="_blank"?"noreferrer":"",m=s?t:null,g=m?m.timestamp:0,b=m?m.sourceURL:c,w=z("img",{alt:a||o,key:`media-${l}-${r}-${i}-${g}`,src:b});return(u?z("a",{title:o,href:u,rel:p,target:h},w):null)||w}renderChartMediaInfo(e){const{activeMediaInfoIndex:t,formattedMediaInfoCount:r}=this.viewModel;return z("div",{key:`media-${e.type}-${t}-${r}`,bind:this,class:Vn.mediaChart,afterCreate:this._getChartDependencies})}renderMediaInfoType(){const{activeMediaInfo:e}=this.viewModel;return e?e.type==="image"?this.renderImageMediaInfo(e):e.type.includes("chart")?this.renderChartMediaInfo(e):null:null}renderMediaInfo(){const{activeMediaInfo:e}=this.viewModel;if(!e)return null;const t=e.title?z("div",{key:"media-title",class:Vn.mediaItemTitle,innerHTML:e.title}):null,r=e.caption?z("div",{key:"media-caption",class:Vn.mediaItemCaption,innerHTML:e.caption}):null;return z("div",{key:"media-container",class:Vn.mediaItemContainer},z("div",{key:"media-item-container",class:Vn.mediaItem},this.renderMediaInfoType()),t,r)}renderMediaPageButton(e){if(this.viewModel.formattedMediaInfoCount<2)return null;const t=e==="previous",r=t?this.messages.previous:this.messages.next,i=t?this.classes(Vn.mediaButton,Vn.mediaPrevious):this.classes(Vn.mediaButton,Vn.mediaNext),n=t?this.classes(Vn.mediaIcon,Vn.mediaPreviousIconLTR,Vn.iconLeftTriangleArrow):this.classes(Vn.mediaIcon,Vn.mediaNextIconLTR,Vn.iconRightTriangleArrow),s=t?this.classes(Vn.mediaIcon,Vn.mediaPreviousIconRTL,Vn.iconRightTriangleArrow):this.classes(Vn.mediaIcon,Vn.mediaNextIconRTL,Vn.iconLeftTriangleArrow),a=t?"media-previous":"media-next",o=t?this._previous:this._next;return z("button",{type:"button",key:a,title:r,"aria-label":r,tabIndex:0,class:i,bind:this,onclick:o},z("span",{"aria-hidden":"true",class:n}),z("span",{"aria-hidden":"true",class:s}))}_setupFeatureElementInfo(){const{description:e,title:t}=this;this._featureElementInfo.set({description:e,title:t})}_next(){this.viewModel.next()}_previous(){this.viewModel.previous()}async _getRendererColors(e){var s;const{am4core:t}=e,r=(s=this.viewModel)==null?void 0:s.layer,i=new Map;if(!r)return i;const n=await mQe(r.renderer);return n.delete(null),Array.from(n.values()).every(a=>(a==null?void 0:a.length)===1)&&(i.set(que,t.color({r:50,g:50,b:50,a:1})),Array.from(n.keys()).forEach(a=>{a&&i.set(a,t.color(n.get(a)[0].toCss(!0)))})),i}_handleMediaKeyup(e){const t=p3(e);t==="ArrowLeft"&&(e.stopPropagation(),this.viewModel.previous()),t==="ArrowRight"&&(e.stopPropagation(),this.viewModel.next())}_renderChart(e){const{abilities:t}=this.viewModel,{chartsModule:r,chartDiv:i,mediaInfo:n,colorMap:s}=e,{value:a,type:o}=n,{am4core:l}=r,c=UJe(l);function u(m){m instanceof l.ColorSet&&c&&(m.list=c)}Pie()&&l.useTheme(r.am4themes_dark);const h=window.matchMedia("(prefers-reduced-motion: reduce)");t.chartAnimation&&!h.matches?l.useTheme(r.am4themes_animated):l.unuseTheme(r.am4themes_animated),l.useTheme(u);const p=o==="pie-chart"?this._createPieChart(e):this._createXYChart(e);i.setAttribute("aria-label",n.altText||n.title),p.data=a.series.map(m=>({[ub]:m.tooltip,[Z6]:m.value,[zm]:s.get(m.fieldName)})).filter(m=>o!=="pie-chart"||m.value>0)}_customizeChartTooltip(e,t){e.label.wrap=!0,e.label.maxWidth=200,e.autoTextColor=!1,e.getFillFromObject=!1,e.label.fill=t.color("#ffffff"),e.background.fill=t.color({r:0,g:0,b:0,a:.7})}_createPieChart(e){const{chartDiv:t,chartsModule:r}=e,{am4core:i,am4charts:n}=r,s=i.create(t,n.PieChart);s.rtl=gp(this.container);const a=s.series.push(new n.PieSeries);return a.labels.template.disabled=!0,a.ticks.template.disabled=!0,a.dataFields.value=Z6,a.dataFields.category=ub,this._customizeChartTooltip(a.tooltip,i),a.slices.template.tooltipText=s.rtl?"{category}: %{value.percent.formatNumber('#.0')}":"{category}: {value.percent.formatNumber('#.0')}%",a.slices.template.propertyFields.fill=zm,a.slices.template.propertyFields.stroke=zm,s}_getMinSeriesValue(e){let t=0;return e.forEach(r=>t=Math.min(r.value,t)),t}_createColumnChart(e,t){const{chartsModule:r,mediaInfo:i}=t,{value:n}=i,{am4core:s,am4charts:a}=r,o=e.xAxes.push(new a.CategoryAxis);o.dataFields.category=ub,o.renderer.labels.template.disabled=!0,this._customizeChartTooltip(o.tooltip,s),o.tooltip.events.on("sizechanged",()=>{o.tooltip.dy=-o.tooltip.contentHeight});const l=e.yAxes.push(new a.ValueAxis),c=l.renderer.labels.template;l.renderer.minLabelPosition=NG,l.renderer.maxLabelPosition=kG,l.min=this._getMinSeriesValue(n.series),this._customizeChartTooltip(l.tooltip,s),c.wrap=!0;const u=e.series.push(new a.ColumnSeries);u.dataFields.valueY=Z6,u.dataFields.categoryX=ub,u.columns.template.propertyFields.fill=zm,u.columns.template.propertyFields.stroke=zm,e.cursor=new a.XYCursor,n.series.length>VG&&(e.scrollbarX=new s.Scrollbar)}_createBarChart(e,t){const{chartsModule:r,mediaInfo:i}=t,{value:n}=i,{am4core:s,am4charts:a}=r,o=e.yAxes.push(new a.CategoryAxis);o.dataFields.category=ub,o.renderer.inversed=!0,o.renderer.labels.template.disabled=!0,this._customizeChartTooltip(o.tooltip,s),o.tooltip.events.on("sizechanged",()=>{o.tooltip.dx=o.tooltip.contentWidth});const l=e.xAxes.push(new a.ValueAxis),c=l.renderer.labels.template;l.renderer.minLabelPosition=NG,l.renderer.maxLabelPosition=kG,l.min=this._getMinSeriesValue(n.series),this._customizeChartTooltip(l.tooltip,s),c.wrap=!0;const u=e.series.push(new a.ColumnSeries);u.dataFields.valueX=Z6,u.dataFields.categoryY=ub,u.columns.template.propertyFields.fill=zm,u.columns.template.propertyFields.stroke=zm,e.cursor=new a.XYCursor,n.series.length>VG&&(e.scrollbarY=new s.Scrollbar)}_createLineChart(e,t){const{chartsModule:r,mediaInfo:i,colorMap:n}=t,{value:s}=i,{am4core:a,am4charts:o}=r,l=e.xAxes.push(new o.CategoryAxis);l.dataFields.category=ub,l.renderer.labels.template.disabled=!0,this._customizeChartTooltip(l.tooltip,a),l.tooltip.events.on("sizechanged",()=>{l.tooltip.dy=-l.tooltip.contentHeight});const c=e.yAxes.push(new o.ValueAxis),u=c.renderer.labels.template;c.renderer.minLabelPosition=NG,c.renderer.maxLabelPosition=kG,c.min=this._getMinSeriesValue(s.series),this._customizeChartTooltip(c.tooltip,a),u.wrap=!0;const h=e.series.push(new o.LineSeries);h.dataFields.categoryX=ub,h.dataFields.valueY=Z6,h.strokeWidth=1;const p=n.get(que);p&&(h.stroke=p);const m=h.bullets.push(new o.CircleBullet);m.propertyFields.fill=zm,m.propertyFields.stroke=zm,e.cursor=new o.XYCursor,s.series.length>VG&&(e.scrollbarX=new a.Scrollbar)}_createXYChart(e){const{chartDiv:t,chartsModule:r,mediaInfo:i}=e,{type:n}=i,{am4core:s,am4charts:a}=r,o=s.create(t,a.XYChart);return o.rtl=gp(this.container),n==="column-chart"&&this._createColumnChart(o,e),n==="bar-chart"&&this._createBarChart(o,e),n==="line-chart"&&this._createLineChart(o,e),o}_clearMediaRefreshTimer(){const{_refreshTimer:e}=this;e&&(clearTimeout(e),this._refreshTimer=null)}_updateMediaInfoTimestamp(e){const t=Date.now();this._refreshIntervalInfo={timestamp:t,sourceURL:this._getImageSource(e,t)},this.scheduleRender()}_setupMediaRefreshTimer(){this._clearMediaRefreshTimer();const{activeMediaInfo:e}=this.viewModel;e&&e.type==="image"&&e.refreshInterval&&this._setRefreshTimeout(e)}_setRefreshTimeout(e){const{refreshInterval:t,value:r}=e;if(!t)return;const i=6e4*t;this._updateMediaInfoTimestamp(r.sourceURL);const n=setInterval(()=>{this._updateMediaInfoTimestamp(r.sourceURL)},i);this._refreshTimer=n}_getImageSource(e,t){const r=e.includes("?")?"&":"?",[i,n=""]=e.split("#");return`${i}${r}timestamp=${t}${n?"#":""}${n}`}};d([We("viewModel.attributes")],Pc.prototype,"attributes",void 0),d([We("viewModel.activeMediaInfoIndex")],Pc.prototype,"activeMediaInfoIndex",void 0),d([We("viewModel.description")],Pc.prototype,"description",void 0),d([We("viewModel.fieldInfoMap")],Pc.prototype,"fieldInfoMap",void 0),d([We("viewModel.layer")],Pc.prototype,"layer",void 0),d([We("viewModel.mediaInfos")],Pc.prototype,"mediaInfos",void 0),d([We("viewModel.popupTemplate")],Pc.prototype,"popupTemplate",void 0),d([We("viewModel.relatedInfos")],Pc.prototype,"relatedInfos",void 0),d([We("viewModel.title")],Pc.prototype,"title",void 0),d([f({type:j3})],Pc.prototype,"viewModel",void 0),d([f(),es("esri/widgets/Feature/t9n/Feature")],Pc.prototype,"messages",void 0),Pc=d([$("esri.widgets.Feature.FeatureMedia")],Pc);const J5e=Pc;class BJe{constructor(t,r){this.definition=null,this.context=null,this.definition=t,this.context=r}}class Pm{constructor(t=[]){this._elements=t}length(){return this._elements.length}get(t){return this._elements[t]}toArray(){const t=[];for(let r=0;r<this.length();r++)t.push(this.get(r));return t}}class Ox extends Pm{constructor(t,r,i,n,s,a){super(t),this._lazyPt=[],this._hasZ=!1,this._hasM=!1,this._spRef=r,this._hasZ=i,this._hasM=n,this._cacheId=s,this._partId=a}get(t){if(this._lazyPt[t]===void 0){const r=this._elements[t];if(r===void 0)return;const i=this._hasZ,n=this._hasM;let s=null;s=i&&!n?new ot(r[0],r[1],r[2],void 0,this._spRef):n&&!i?new ot(r[0],r[1],void 0,r[2],this._spRef):i&&n?new ot(r[0],r[1],r[2],r[3],this._spRef):new ot(r[0],r[1],this._spRef),s.cache._arcadeCacheId=this._cacheId.toString()+"-"+this._partId.toString()+"-"+t.toString(),this._lazyPt[t]=s}return this._lazyPt[t]}equalityTest(t){return t===this||t!==null&&t instanceof Ox&&t.getUniqueHash()===this.getUniqueHash()}getUniqueHash(){return this._cacheId.toString()+"-"+this._partId.toString()}}class Zie extends Pm{constructor(t,r,i,n,s){super(t),this._lazyPath=[],this._hasZ=!1,this._hasM=!1,this._hasZ=i,this._hasM=n,this._spRef=r,this._cacheId=s}get(t){if(this._lazyPath[t]===void 0){const r=this._elements[t];if(r===void 0)return;this._lazyPath[t]=new Ox(r,this._spRef,this._hasZ,this._hasM,this._cacheId,t)}return this._lazyPath[t]}equalityTest(t){return t===this||t!==null&&t instanceof Zie&&t.getUniqueHash()===this.getUniqueHash()}getUniqueHash(){return this._cacheId.toString()}}class Mx extends Error{}class GJe extends Mx{constructor(t){super(`Invalid DateTime: ${t.toMessage()}`)}}class jJe extends Mx{constructor(t){super(`Invalid Interval: ${t.toMessage()}`)}}class qJe extends Mx{constructor(t){super(`Invalid Duration: ${t.toMessage()}`)}}class NE extends Mx{}class K5e extends Mx{constructor(t){super(`Invalid unit ${t}`)}}class Ch extends Mx{}class hb extends Mx{constructor(){super("Zone is an abstract class")}}const Je="numeric",Lp="short",vu="long",KZ={year:Je,month:Je,day:Je},e9e={year:Je,month:Lp,day:Je},HJe={year:Je,month:Lp,day:Je,weekday:Lp},t9e={year:Je,month:vu,day:Je},r9e={year:Je,month:vu,day:Je,weekday:vu},i9e={hour:Je,minute:Je},n9e={hour:Je,minute:Je,second:Je},s9e={hour:Je,minute:Je,second:Je,timeZoneName:Lp},a9e={hour:Je,minute:Je,second:Je,timeZoneName:vu},o9e={hour:Je,minute:Je,hourCycle:"h23"},l9e={hour:Je,minute:Je,second:Je,hourCycle:"h23"},c9e={hour:Je,minute:Je,second:Je,hourCycle:"h23",timeZoneName:Lp},d9e={hour:Je,minute:Je,second:Je,hourCycle:"h23",timeZoneName:vu},u9e={year:Je,month:Je,day:Je,hour:Je,minute:Je},h9e={year:Je,month:Je,day:Je,hour:Je,minute:Je,second:Je},f9e={year:Je,month:Lp,day:Je,hour:Je,minute:Je},p9e={year:Je,month:Lp,day:Je,hour:Je,minute:Je,second:Je},WJe={year:Je,month:Lp,day:Je,weekday:Lp,hour:Je,minute:Je},m9e={year:Je,month:vu,day:Je,hour:Je,minute:Je,timeZoneName:Lp},g9e={year:Je,month:vu,day:Je,hour:Je,minute:Je,second:Je,timeZoneName:Lp},y9e={year:Je,month:vu,day:Je,weekday:vu,hour:Je,minute:Je,timeZoneName:vu},b9e={year:Je,month:vu,day:Je,weekday:vu,hour:Je,minute:Je,second:Je,timeZoneName:vu};function Kr(e){return typeof e>"u"}function mw(e){return typeof e=="number"}function hz(e){return typeof e=="number"&&e%1===0}function XJe(e){return typeof e=="string"}function YJe(e){return Object.prototype.toString.call(e)==="[object Date]"}function v9e(){try{return typeof Intl<"u"&&!!Intl.RelativeTimeFormat}catch{return!1}}function ZJe(e){return Array.isArray(e)?e:[e]}function Hue(e,t,r){if(e.length!==0)return e.reduce((i,n)=>{const s=[t(n),n];return i&&r(i[0],s[0])===i[0]?i:s},null)[1]}function QJe(e,t){return t.reduce((r,i)=>(r[i]=e[i],r),{})}function s9(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function Kg(e,t,r){return hz(e)&&e>=t&&e<=r}function JJe(e,t){return e-t*Math.floor(e/t)}function ra(e,t=2){const r=e<0;let i;return r?i="-"+(""+-e).padStart(t,"0"):i=(""+e).padStart(t,"0"),i}function L1(e){if(!(Kr(e)||e===null||e===""))return parseInt(e,10)}function O_(e){if(!(Kr(e)||e===null||e===""))return parseFloat(e)}function Qie(e){if(!(Kr(e)||e===null||e==="")){const t=parseFloat("0."+e)*1e3;return Math.floor(t)}}function Jie(e,t,r=!1){const i=10**t;return(r?Math.trunc:Math.round)(e*i)/i}function oO(e){return e%4===0&&(e%100!==0||e%400===0)}function t7(e){return oO(e)?366:365}function xN(e,t){const r=JJe(t-1,12)+1,i=e+(t-r)/12;return r===2?oO(i)?29:28:[31,null,31,30,31,30,31,31,30,31,30,31][r-1]}function Kie(e){let t=Date.UTC(e.year,e.month-1,e.day,e.hour,e.minute,e.second,e.millisecond);return e.year<100&&e.year>=0&&(t=new Date(t),t.setUTCFullYear(t.getUTCFullYear()-1900)),+t}function TN(e){const t=(e+Math.floor(e/4)-Math.floor(e/100)+Math.floor(e/400))%7,r=e-1,i=(r+Math.floor(r/4)-Math.floor(r/100)+Math.floor(r/400))%7;return t===4||i===3?53:52}function eQ(e){return e>99?e:e>60?1900+e:2e3+e}function _9e(e,t,r,i=null){const n=new Date(e),s={hourCycle:"h23",year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"};i&&(s.timeZone=i);const a={timeZoneName:t,...s},o=new Intl.DateTimeFormat(r,a).formatToParts(n).find(l=>l.type.toLowerCase()==="timezonename");return o?o.value:null}function fz(e,t){let r=parseInt(e,10);Number.isNaN(r)&&(r=0);const i=parseInt(t,10)||0,n=r<0||Object.is(r,-0)?-i:i;return r*60+n}function w9e(e){const t=Number(e);if(typeof e=="boolean"||e===""||Number.isNaN(t))throw new Ch(`Invalid unit value ${e}`);return t}function SN(e,t){const r={};for(const i in e)if(s9(e,i)){const n=e[i];if(n==null)continue;r[t(i)]=w9e(n)}return r}function r7(e,t){const r=Math.trunc(Math.abs(e/60)),i=Math.trunc(Math.abs(e%60)),n=e>=0?"+":"-";switch(t){case"short":return`${n}${ra(r,2)}:${ra(i,2)}`;case"narrow":return`${n}${r}${i>0?`:${i}`:""}`;case"techie":return`${n}${ra(r,2)}${ra(i,2)}`;default:throw new RangeError(`Value format ${t} is out of range for property format`)}}function pz(e){return QJe(e,["hour","minute","second","millisecond"])}const x9e=/[A-Za-z_+-]{1,256}(?::?\/[A-Za-z0-9_+-]{1,256}(?:\/[A-Za-z0-9_+-]{1,256})?)?/,KJe=["January","February","March","April","May","June","July","August","September","October","November","December"],T9e=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],eKe=["J","F","M","A","M","J","J","A","S","O","N","D"];function S9e(e){switch(e){case"narrow":return[...eKe];case"short":return[...T9e];case"long":return[...KJe];case"numeric":return["1","2","3","4","5","6","7","8","9","10","11","12"];case"2-digit":return["01","02","03","04","05","06","07","08","09","10","11","12"];default:return null}}const E9e=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],C9e=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],tKe=["M","T","W","T","F","S","S"];function A9e(e){switch(e){case"narrow":return[...tKe];case"short":return[...C9e];case"long":return[...E9e];case"numeric":return["1","2","3","4","5","6","7"];default:return null}}const R9e=["AM","PM"],rKe=["Before Christ","Anno Domini"],iKe=["BC","AD"],nKe=["B","A"];function O9e(e){switch(e){case"narrow":return[...nKe];case"short":return[...iKe];case"long":return[...rKe];default:return null}}function sKe(e){return R9e[e.hour<12?0:1]}function aKe(e,t){return A9e(t)[e.weekday-1]}function oKe(e,t){return S9e(t)[e.month-1]}function lKe(e,t){return O9e(t)[e.year<0?0:1]}function cKe(e,t,r="always",i=!1){const n={years:["year","yr."],quarters:["quarter","qtr."],months:["month","mo."],weeks:["week","wk."],days:["day","day","days"],hours:["hour","hr."],minutes:["minute","min."],seconds:["second","sec."]},s=["hours","minutes","seconds"].indexOf(e)===-1;if(r==="auto"&&s){const h=e==="days";switch(t){case 1:return h?"tomorrow":`next ${n[e][0]}`;case-1:return h?"yesterday":`last ${n[e][0]}`;case 0:return h?"today":`this ${n[e][0]}`}}const a=Object.is(t,-0)||t<0,o=Math.abs(t),l=o===1,c=n[e],u=i?l?c[1]:c[2]||c[1]:l?n[e][0]:e;return a?`${o} ${u} ago`:`in ${o} ${u}`}function Wue(e,t){let r="";for(const i of e)i.literal?r+=i.val:r+=t(i.val);return r}const dKe={D:KZ,DD:e9e,DDD:t9e,DDDD:r9e,t:i9e,tt:n9e,ttt:s9e,tttt:a9e,T:o9e,TT:l9e,TTT:c9e,TTTT:d9e,f:u9e,ff:f9e,fff:m9e,ffff:y9e,F:h9e,FF:p9e,FFF:g9e,FFFF:b9e};class id{static create(t,r={}){return new id(t,r)}static parseFormat(t){let r=null,i="",n=!1;const s=[];for(let a=0;a<t.length;a++){const o=t.charAt(a);o==="'"?(i.length>0&&s.push({literal:n,val:i}),r=null,i="",n=!n):n||o===r?i+=o:(i.length>0&&s.push({literal:!1,val:i}),i=o,r=o)}return i.length>0&&s.push({literal:n,val:i}),s}static macroTokenToFormatOpts(t){return dKe[t]}constructor(t,r){this.opts=r,this.loc=t,this.systemLoc=null}formatWithSystemDefault(t,r){return this.systemLoc===null&&(this.systemLoc=this.loc.redefaultToSystem()),this.systemLoc.dtFormatter(t,{...this.opts,...r}).format()}formatDateTime(t,r={}){return this.loc.dtFormatter(t,{...this.opts,...r}).format()}formatDateTimeParts(t,r={}){return this.loc.dtFormatter(t,{...this.opts,...r}).formatToParts()}resolvedOptions(t,r={}){return this.loc.dtFormatter(t,{...this.opts,...r}).resolvedOptions()}num(t,r=0){if(this.opts.forceSimple)return ra(t,r);const i={...this.opts};return r>0&&(i.padTo=r),this.loc.numberFormatter(i).format(t)}formatDateTimeFromString(t,r){const i=this.loc.listingMode()==="en",n=this.loc.outputCalendar&&this.loc.outputCalendar!=="gregory",s=(m,g)=>this.loc.extract(t,m,g),a=m=>t.isOffsetFixed&&t.offset===0&&m.allowZ?"Z":t.isValid?t.zone.formatOffset(t.ts,m.format):"",o=()=>i?sKe(t):s({hour:"numeric",hourCycle:"h12"},"dayperiod"),l=(m,g)=>i?oKe(t,m):s(g?{month:m}:{month:m,day:"numeric"},"month"),c=(m,g)=>i?aKe(t,m):s(g?{weekday:m}:{weekday:m,month:"long",day:"numeric"},"weekday"),u=m=>{const g=id.macroTokenToFormatOpts(m);return g?this.formatWithSystemDefault(t,g):m},h=m=>i?lKe(t,m):s({era:m},"era"),p=m=>{switch(m){case"S":return this.num(t.millisecond);case"u":case"SSS":return this.num(t.millisecond,3);case"s":return this.num(t.second);case"ss":return this.num(t.second,2);case"uu":return this.num(Math.floor(t.millisecond/10),2);case"uuu":return this.num(Math.floor(t.millisecond/100));case"m":return this.num(t.minute);case"mm":return this.num(t.minute,2);case"h":return this.num(t.hour%12===0?12:t.hour%12);case"hh":return this.num(t.hour%12===0?12:t.hour%12,2);case"H":return this.num(t.hour);case"HH":return this.num(t.hour,2);case"Z":return a({format:"narrow",allowZ:this.opts.allowZ});case"ZZ":return a({format:"short",allowZ:this.opts.allowZ});case"ZZZ":return a({format:"techie",allowZ:this.opts.allowZ});case"ZZZZ":return t.zone.offsetName(t.ts,{format:"short",locale:this.loc.locale});case"ZZZZZ":return t.zone.offsetName(t.ts,{format:"long",locale:this.loc.locale});case"z":return t.zoneName;case"a":return o();case"d":return n?s({day:"numeric"},"day"):this.num(t.day);case"dd":return n?s({day:"2-digit"},"day"):this.num(t.day,2);case"c":return this.num(t.weekday);case"ccc":return c("short",!0);case"cccc":return c("long",!0);case"ccccc":return c("narrow",!0);case"E":return this.num(t.weekday);case"EEE":return c("short",!1);case"EEEE":return c("long",!1);case"EEEEE":return c("narrow",!1);case"L":return n?s({month:"numeric",day:"numeric"},"month"):this.num(t.month);case"LL":return n?s({month:"2-digit",day:"numeric"},"month"):this.num(t.month,2);case"LLL":return l("short",!0);case"LLLL":return l("long",!0);case"LLLLL":return l("narrow",!0);case"M":return n?s({month:"numeric"},"month"):this.num(t.month);case"MM":return n?s({month:"2-digit"},"month"):this.num(t.month,2);case"MMM":return l("short",!1);case"MMMM":return l("long",!1);case"MMMMM":return l("narrow",!1);case"y":return n?s({year:"numeric"},"year"):this.num(t.year);case"yy":return n?s({year:"2-digit"},"year"):this.num(t.year.toString().slice(-2),2);case"yyyy":return n?s({year:"numeric"},"year"):this.num(t.year,4);case"yyyyyy":return n?s({year:"numeric"},"year"):this.num(t.year,6);case"G":return h("short");case"GG":return h("long");case"GGGGG":return h("narrow");case"kk":return this.num(t.weekYear.toString().slice(-2),2);case"kkkk":return this.num(t.weekYear,4);case"W":return this.num(t.weekNumber);case"WW":return this.num(t.weekNumber,2);case"o":return this.num(t.ordinal);case"ooo":return this.num(t.ordinal,3);case"q":return this.num(t.quarter);case"qq":return this.num(t.quarter,2);case"X":return this.num(Math.floor(t.ts/1e3));case"x":return this.num(t.ts);default:return u(m)}};return Wue(id.parseFormat(r),p)}formatDurationFromString(t,r){const i=l=>{switch(l[0]){case"S":return"millisecond";case"s":return"second";case"m":return"minute";case"h":return"hour";case"d":return"day";case"w":return"week";case"M":return"month";case"y":return"year";default:return null}},n=l=>c=>{const u=i(c);return u?this.num(l.get(u),c.length):c},s=id.parseFormat(r),a=s.reduce((l,{literal:c,val:u})=>c?l:l.concat(u),[]),o=t.shiftTo(...a.map(i).filter(l=>l));return Wue(s,n(o))}}class yp{constructor(t,r){this.reason=t,this.explanation=r}toMessage(){return this.explanation?`${this.reason}: ${this.explanation}`:this.reason}}class lO{get type(){throw new hb}get name(){throw new hb}get ianaName(){return this.name}get isUniversal(){throw new hb}offsetName(t,r){throw new hb}formatOffset(t,r){throw new hb}offset(t){throw new hb}equals(t){throw new hb}get isValid(){throw new hb}}let zG=null;class ene extends lO{static get instance(){return zG===null&&(zG=new ene),zG}get type(){return"system"}get name(){return new Intl.DateTimeFormat().resolvedOptions().timeZone}get isUniversal(){return!1}offsetName(t,{format:r,locale:i}){return _9e(t,r,i)}formatOffset(t,r){return r7(this.offset(t),r)}offset(t){return-new Date(t).getTimezoneOffset()}equals(t){return t.type==="system"}get isValid(){return!0}}let TL={};function uKe(e){return TL[e]||(TL[e]=new Intl.DateTimeFormat("en-US",{hour12:!1,timeZone:e,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",era:"short"})),TL[e]}const hKe={year:0,month:1,day:2,era:3,hour:4,minute:5,second:6};function fKe(e,t){const r=e.format(t).replace(/\u200E/g,""),i=/(\d+)\/(\d+)\/(\d+) (AD|BC),? (\d+):(\d+):(\d+)/.exec(r),[,n,s,a,o,l,c,u]=i;return[a,n,s,o,l,c,u]}function pKe(e,t){const r=e.formatToParts(t),i=[];for(let n=0;n<r.length;n++){const{type:s,value:a}=r[n],o=hKe[s];s==="era"?i[o]=a:Kr(o)||(i[o]=parseInt(a,10))}return i}let QM={};class $y extends lO{static create(t){return QM[t]||(QM[t]=new $y(t)),QM[t]}static resetCache(){QM={},TL={}}static isValidSpecifier(t){return this.isValidZone(t)}static isValidZone(t){if(!t)return!1;try{return new Intl.DateTimeFormat("en-US",{timeZone:t}).format(),!0}catch{return!1}}constructor(t){super(),this.zoneName=t,this.valid=$y.isValidZone(t)}get type(){return"iana"}get name(){return this.zoneName}get isUniversal(){return!1}offsetName(t,{format:r,locale:i}){return _9e(t,r,i,this.name)}formatOffset(t,r){return r7(this.offset(t),r)}offset(t){const r=new Date(t);if(isNaN(r))return NaN;const i=uKe(this.name);let[n,s,a,o,l,c,u]=i.formatToParts?pKe(i,r):fKe(i,r);o==="BC"&&(n=-Math.abs(n)+1);const p=Kie({year:n,month:s,day:a,hour:l===24?0:l,minute:c,second:u,millisecond:0});let m=+r;const g=m%1e3;return m-=g>=0?g:1e3+g,(p-m)/(60*1e3)}equals(t){return t.type==="iana"&&t.name===this.name}get isValid(){return this.valid}}let UG=null;class ec extends lO{static get utcInstance(){return UG===null&&(UG=new ec(0)),UG}static instance(t){return t===0?ec.utcInstance:new ec(t)}static parseSpecifier(t){if(t){const r=t.match(/^utc(?:([+-]\d{1,2})(?::(\d{2}))?)?$/i);if(r)return new ec(fz(r[1],r[2]))}return null}constructor(t){super(),this.fixed=t}get type(){return"fixed"}get name(){return this.fixed===0?"UTC":`UTC${r7(this.fixed,"narrow")}`}get ianaName(){return this.fixed===0?"Etc/UTC":`Etc/GMT${r7(-this.fixed,"narrow")}`}offsetName(){return this.name}formatOffset(t,r){return r7(this.fixed,r)}get isUniversal(){return!0}offset(){return this.fixed}equals(t){return t.type==="fixed"&&t.fixed===this.fixed}get isValid(){return!0}}class mKe extends lO{constructor(t){super(),this.zoneName=t}get type(){return"invalid"}get name(){return this.zoneName}get isUniversal(){return!1}offsetName(){return null}formatOffset(){return""}offset(){return NaN}equals(){return!1}get isValid(){return!1}}function H1(e,t){if(Kr(e)||e===null)return t;if(e instanceof lO)return e;if(XJe(e)){const r=e.toLowerCase();return r==="local"||r==="system"?t:r==="utc"||r==="gmt"?ec.utcInstance:ec.parseSpecifier(r)||$y.create(e)}else return mw(e)?ec.instance(e):typeof e=="object"&&e.offset&&typeof e.offset=="number"?e:new mKe(e)}let Xue=()=>Date.now(),Yue="system",Zue=null,Que=null,Jue=null,Kue;class Sa{static get now(){return Xue}static set now(t){Xue=t}static set defaultZone(t){Yue=t}static get defaultZone(){return H1(Yue,ene.instance)}static get defaultLocale(){return Zue}static set defaultLocale(t){Zue=t}static get defaultNumberingSystem(){return Que}static set defaultNumberingSystem(t){Que=t}static get defaultOutputCalendar(){return Jue}static set defaultOutputCalendar(t){Jue=t}static get throwOnInvalid(){return Kue}static set throwOnInvalid(t){Kue=t}static resetCaches(){Wn.resetCache(),$y.resetCache()}}let ehe={};function gKe(e,t={}){const r=JSON.stringify([e,t]);let i=ehe[r];return i||(i=new Intl.ListFormat(e,t),ehe[r]=i),i}let tQ={};function rQ(e,t={}){const r=JSON.stringify([e,t]);let i=tQ[r];return i||(i=new Intl.DateTimeFormat(e,t),tQ[r]=i),i}let iQ={};function yKe(e,t={}){const r=JSON.stringify([e,t]);let i=iQ[r];return i||(i=new Intl.NumberFormat(e,t),iQ[r]=i),i}let nQ={};function bKe(e,t={}){const{base:r,...i}=t,n=JSON.stringify([e,i]);let s=nQ[n];return s||(s=new Intl.RelativeTimeFormat(e,t),nQ[n]=s),s}let kE=null;function vKe(){return kE||(kE=new Intl.DateTimeFormat().resolvedOptions().locale,kE)}function _Ke(e){const t=e.indexOf("-u-");if(t===-1)return[e];{let r;const i=e.substring(0,t);try{r=rQ(e).resolvedOptions()}catch{r=rQ(i).resolvedOptions()}const{numberingSystem:n,calendar:s}=r;return[i,n,s]}}function wKe(e,t,r){return(r||t)&&(e+="-u",r&&(e+=`-ca-${r}`),t&&(e+=`-nu-${t}`)),e}function xKe(e){const t=[];for(let r=1;r<=12;r++){const i=ar.utc(2016,r,1);t.push(e(i))}return t}function TKe(e){const t=[];for(let r=1;r<=7;r++){const i=ar.utc(2016,11,13+r);t.push(e(i))}return t}function JM(e,t,r,i,n){const s=e.listingMode(r);return s==="error"?null:s==="en"?i(t):n(t)}function SKe(e){return e.numberingSystem&&e.numberingSystem!=="latn"?!1:e.numberingSystem==="latn"||!e.locale||e.locale.startsWith("en")||new Intl.DateTimeFormat(e.intl).resolvedOptions().numberingSystem==="latn"}class EKe{constructor(t,r,i){this.padTo=i.padTo||0,this.floor=i.floor||!1;const{padTo:n,floor:s,...a}=i;if(!r||Object.keys(a).length>0){const o={useGrouping:!1,...i};i.padTo>0&&(o.minimumIntegerDigits=i.padTo),this.inf=yKe(t,o)}}format(t){if(this.inf){const r=this.floor?Math.floor(t):t;return this.inf.format(r)}else{const r=this.floor?Math.floor(t):Jie(t,3);return ra(r,this.padTo)}}}class CKe{constructor(t,r,i){this.opts=i;let n;if(t.zone.isUniversal){const a=-1*(t.offset/60),o=a>=0?`Etc/GMT+${a}`:`Etc/GMT${a}`;t.offset!==0&&$y.create(o).valid?(n=o,this.dt=t):(n="UTC",i.timeZoneName?this.dt=t:this.dt=t.offset===0?t:ar.fromMillis(t.ts+t.offset*60*1e3))}else t.zone.type==="system"?this.dt=t:(this.dt=t,n=t.zone.name);const s={...this.opts};n&&(s.timeZone=n),this.dtf=rQ(r,s)}format(){return this.dtf.format(this.dt.toJSDate())}formatToParts(){return this.dtf.formatToParts(this.dt.toJSDate())}resolvedOptions(){return this.dtf.resolvedOptions()}}class AKe{constructor(t,r,i){this.opts={style:"long",...i},!r&&v9e()&&(this.rtf=bKe(t,i))}format(t,r){return this.rtf?this.rtf.format(t,r):cKe(r,t,this.opts.numeric,this.opts.style!=="long")}formatToParts(t,r){return this.rtf?this.rtf.formatToParts(t,r):[]}}class Wn{static fromOpts(t){return Wn.create(t.locale,t.numberingSystem,t.outputCalendar,t.defaultToEN)}static create(t,r,i,n=!1){const s=t||Sa.defaultLocale,a=s||(n?"en-US":vKe()),o=r||Sa.defaultNumberingSystem,l=i||Sa.defaultOutputCalendar;return new Wn(a,o,l,s)}static resetCache(){kE=null,tQ={},iQ={},nQ={}}static fromObject({locale:t,numberingSystem:r,outputCalendar:i}={}){return Wn.create(t,r,i)}constructor(t,r,i,n){const[s,a,o]=_Ke(t);this.locale=s,this.numberingSystem=r||a||null,this.outputCalendar=i||o||null,this.intl=wKe(this.locale,this.numberingSystem,this.outputCalendar),this.weekdaysCache={format:{},standalone:{}},this.monthsCache={format:{},standalone:{}},this.meridiemCache=null,this.eraCache={},this.specifiedLocale=n,this.fastNumbersCached=null}get fastNumbers(){return this.fastNumbersCached==null&&(this.fastNumbersCached=SKe(this)),this.fastNumbersCached}listingMode(){const t=this.isEnglish(),r=(this.numberingSystem===null||this.numberingSystem==="latn")&&(this.outputCalendar===null||this.outputCalendar==="gregory");return t&&r?"en":"intl"}clone(t){return!t||Object.getOwnPropertyNames(t).length===0?this:Wn.create(t.locale||this.specifiedLocale,t.numberingSystem||this.numberingSystem,t.outputCalendar||this.outputCalendar,t.defaultToEN||!1)}redefaultToEN(t={}){return this.clone({...t,defaultToEN:!0})}redefaultToSystem(t={}){return this.clone({...t,defaultToEN:!1})}months(t,r=!1,i=!0){return JM(this,t,i,S9e,()=>{const n=r?{month:t,day:"numeric"}:{month:t},s=r?"format":"standalone";return this.monthsCache[s][t]||(this.monthsCache[s][t]=xKe(a=>this.extract(a,n,"month"))),this.monthsCache[s][t]})}weekdays(t,r=!1,i=!0){return JM(this,t,i,A9e,()=>{const n=r?{weekday:t,year:"numeric",month:"long",day:"numeric"}:{weekday:t},s=r?"format":"standalone";return this.weekdaysCache[s][t]||(this.weekdaysCache[s][t]=TKe(a=>this.extract(a,n,"weekday"))),this.weekdaysCache[s][t]})}meridiems(t=!0){return JM(this,void 0,t,()=>R9e,()=>{if(!this.meridiemCache){const r={hour:"numeric",hourCycle:"h12"};this.meridiemCache=[ar.utc(2016,11,13,9),ar.utc(2016,11,13,19)].map(i=>this.extract(i,r,"dayperiod"))}return this.meridiemCache})}eras(t,r=!0){return JM(this,t,r,O9e,()=>{const i={era:t};return this.eraCache[t]||(this.eraCache[t]=[ar.utc(-40,1,1),ar.utc(2017,1,1)].map(n=>this.extract(n,i,"era"))),this.eraCache[t]})}extract(t,r,i){const n=this.dtFormatter(t,r),s=n.formatToParts(),a=s.find(o=>o.type.toLowerCase()===i);return a?a.value:null}numberFormatter(t={}){return new EKe(this.intl,t.forceSimple||this.fastNumbers,t)}dtFormatter(t,r={}){return new CKe(t,this.intl,r)}relFormatter(t={}){return new AKe(this.intl,this.isEnglish(),t)}listFormatter(t={}){return gKe(this.intl,t)}isEnglish(){return this.locale==="en"||this.locale.toLowerCase()==="en-us"||new Intl.DateTimeFormat(this.intl).resolvedOptions().locale.startsWith("en-us")}equals(t){return this.locale===t.locale&&this.numberingSystem===t.numberingSystem&&this.outputCalendar===t.outputCalendar}}function d6(...e){const t=e.reduce((r,i)=>r+i.source,"");return RegExp(`^${t}$`)}function u6(...e){return t=>e.reduce(([r,i,n],s)=>{const[a,o,l]=s(t,n);return[{...r,...a},o||i,l]},[{},null,1]).slice(0,2)}function h6(e,...t){if(e==null)return[null,null];for(const[r,i]of t){const n=r.exec(e);if(n)return i(n)}return[null,null]}function M9e(...e){return(t,r)=>{const i={};let n;for(n=0;n<e.length;n++)i[e[n]]=L1(t[r+n]);return[i,null,r+n]}}const P9e=/(?:(Z)|([+-]\d\d)(?::?(\d\d))?)/,RKe=`(?:${P9e.source}?(?:\\[(${x9e.source})\\])?)?`,tne=/(\d\d)(?::?(\d\d)(?::?(\d\d)(?:[.,](\d{1,30}))?)?)?/,I9e=RegExp(`${tne.source}${RKe}`),rne=RegExp(`(?:T${I9e.source})?`),OKe=/([+-]\d{6}|\d{4})(?:-?(\d\d)(?:-?(\d\d))?)?/,MKe=/(\d{4})-?W(\d\d)(?:-?(\d))?/,PKe=/(\d{4})-?(\d{3})/,IKe=M9e("weekYear","weekNumber","weekDay"),$Ke=M9e("year","ordinal"),LKe=/(\d{4})-(\d\d)-(\d\d)/,$9e=RegExp(`${tne.source} ?(?:${P9e.source}|(${x9e.source}))?`),DKe=RegExp(`(?: ${$9e.source})?`);function e5(e,t,r){const i=e[t];return Kr(i)?r:L1(i)}function FKe(e,t){return[{year:e5(e,t),month:e5(e,t+1,1),day:e5(e,t+2,1)},null,t+3]}function f6(e,t){return[{hours:e5(e,t,0),minutes:e5(e,t+1,0),seconds:e5(e,t+2,0),milliseconds:Qie(e[t+3])},null,t+4]}function cO(e,t){const r=!e[t]&&!e[t+1],i=fz(e[t+1],e[t+2]),n=r?null:ec.instance(i);return[{},n,t+3]}function dO(e,t){const r=e[t]?$y.create(e[t]):null;return[{},r,t+1]}const NKe=RegExp(`^T?${tne.source}$`),kKe=/^-?P(?:(?:(-?\d{1,9}(?:\.\d{1,9})?)Y)?(?:(-?\d{1,9}(?:\.\d{1,9})?)M)?(?:(-?\d{1,9}(?:\.\d{1,9})?)W)?(?:(-?\d{1,9}(?:\.\d{1,9})?)D)?(?:T(?:(-?\d{1,9}(?:\.\d{1,9})?)H)?(?:(-?\d{1,9}(?:\.\d{1,9})?)M)?(?:(-?\d{1,20})(?:[.,](-?\d{1,9}))?S)?)?)$/;function VKe(e){const[t,r,i,n,s,a,o,l,c]=e,u=t[0]==="-",h=l&&l[0]==="-",p=(m,g=!1)=>m!==void 0&&(g||m&&u)?-m:m;return[{years:p(O_(r)),months:p(O_(i)),weeks:p(O_(n)),days:p(O_(s)),hours:p(O_(a)),minutes:p(O_(o)),seconds:p(O_(l),l==="-0"),milliseconds:p(Qie(c),h)}]}const zKe={GMT:0,EDT:-4*60,EST:-5*60,CDT:-5*60,CST:-6*60,MDT:-6*60,MST:-7*60,PDT:-7*60,PST:-8*60};function ine(e,t,r,i,n,s,a){const o={year:t.length===2?eQ(L1(t)):L1(t),month:T9e.indexOf(r)+1,day:L1(i),hour:L1(n),minute:L1(s)};return a&&(o.second=L1(a)),e&&(o.weekday=e.length>3?E9e.indexOf(e)+1:C9e.indexOf(e)+1),o}const UKe=/^(?:(Mon|Tue|Wed|Thu|Fri|Sat|Sun),\s)?(\d{1,2})\s(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s(\d{2,4})\s(\d\d):(\d\d)(?::(\d\d))?\s(?:(UT|GMT|[ECMP][SD]T)|([Zz])|(?:([+-]\d\d)(\d\d)))$/;function BKe(e){const[,t,r,i,n,s,a,o,l,c,u,h]=e,p=ine(t,n,i,r,s,a,o);let m;return l?m=zKe[l]:c?m=0:m=fz(u,h),[p,new ec(m)]}function GKe(e){return e.replace(/\([^)]*\)|[\n\t]/g," ").replace(/(\s\s+)/g," ").trim()}const jKe=/^(Mon|Tue|Wed|Thu|Fri|Sat|Sun), (\d\d) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) (\d{4}) (\d\d):(\d\d):(\d\d) GMT$/,qKe=/^(Monday|Tuesday|Wedsday|Thursday|Friday|Saturday|Sunday), (\d\d)-(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)-(\d\d) (\d\d):(\d\d):(\d\d) GMT$/,HKe=/^(Mon|Tue|Wed|Thu|Fri|Sat|Sun) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) ( \d|\d\d) (\d\d):(\d\d):(\d\d) (\d{4})$/;function the(e){const[,t,r,i,n,s,a,o]=e;return[ine(t,n,i,r,s,a,o),ec.utcInstance]}function WKe(e){const[,t,r,i,n,s,a,o]=e;return[ine(t,o,r,i,n,s,a),ec.utcInstance]}const XKe=d6(OKe,rne),YKe=d6(MKe,rne),ZKe=d6(PKe,rne),QKe=d6(I9e),L9e=u6(FKe,f6,cO,dO),JKe=u6(IKe,f6,cO,dO),KKe=u6($Ke,f6,cO,dO),eet=u6(f6,cO,dO);function tet(e){return h6(e,[XKe,L9e],[YKe,JKe],[ZKe,KKe],[QKe,eet])}function ret(e){return h6(GKe(e),[UKe,BKe])}function iet(e){return h6(e,[jKe,the],[qKe,the],[HKe,WKe])}function net(e){return h6(e,[kKe,VKe])}const set=u6(f6);function aet(e){return h6(e,[NKe,set])}const oet=d6(LKe,DKe),cet=d6($9e),det=u6(f6,cO,dO);function uet(e){return h6(e,[oet,L9e],[cet,det])}const het="Invalid Duration",D9e={weeks:{days:7,hours:7*24,minutes:7*24*60,seconds:7*24*60*60,milliseconds:7*24*60*60*1e3},days:{hours:24,minutes:24*60,seconds:24*60*60,milliseconds:24*60*60*1e3},hours:{minutes:60,seconds:60*60,milliseconds:60*60*1e3},minutes:{seconds:60,milliseconds:60*1e3},seconds:{milliseconds:1e3}},fet={years:{quarters:4,months:12,weeks:52,days:365,hours:365*24,minutes:365*24*60,seconds:365*24*60*60,milliseconds:365*24*60*60*1e3},quarters:{months:3,weeks:13,days:91,hours:91*24,minutes:91*24*60,seconds:91*24*60*60,milliseconds:91*24*60*60*1e3},months:{weeks:4,days:30,hours:30*24,minutes:30*24*60,seconds:30*24*60*60,milliseconds:30*24*60*60*1e3},...D9e},zu=146097/400,Gx=146097/4800,pet={years:{quarters:4,months:12,weeks:zu/7,days:zu,hours:zu*24,minutes:zu*24*60,seconds:zu*24*60*60,milliseconds:zu*24*60*60*1e3},quarters:{months:3,weeks:zu/28,days:zu/4,hours:zu*24/4,minutes:zu*24*60/4,seconds:zu*24*60*60/4,milliseconds:zu*24*60*60*1e3/4},months:{weeks:Gx/7,days:Gx,hours:Gx*24,minutes:Gx*24*60,seconds:Gx*24*60*60,milliseconds:Gx*24*60*60*1e3},...D9e},$2=["years","quarters","months","weeks","days","hours","minutes","seconds","milliseconds"],met=$2.slice(0).reverse();function M_(e,t,r=!1){const i={values:r?t.values:{...e.values,...t.values||{}},loc:e.loc.clone(t.loc),conversionAccuracy:t.conversionAccuracy||e.conversionAccuracy};return new li(i)}function get(e){return e<0?Math.floor(e):Math.ceil(e)}function F9e(e,t,r,i,n){const s=e[n][r],a=t[r]/s,o=Math.sign(a)===Math.sign(i[n]),l=!o&&i[n]!==0&&Math.abs(a)<=1?get(a):Math.trunc(a);i[n]+=l,t[r]-=l*s}function yet(e,t){met.reduce((r,i)=>Kr(t[i])?r:(r&&F9e(e,t,r,t,i),i),null)}class li{constructor(t){const r=t.conversionAccuracy==="longterm"||!1;this.values=t.values,this.loc=t.loc||Wn.create(),this.conversionAccuracy=r?"longterm":"casual",this.invalid=t.invalid||null,this.matrix=r?pet:fet,this.isLuxonDuration=!0}static fromMillis(t,r){return li.fromObject({milliseconds:t},r)}static fromObject(t,r={}){if(t==null||typeof t!="object")throw new Ch(`Duration.fromObject: argument expected to be an object, got ${t===null?"null":typeof t}`);return new li({values:SN(t,li.normalizeUnit),loc:Wn.fromObject(r),conversionAccuracy:r.conversionAccuracy})}static fromDurationLike(t){if(mw(t))return li.fromMillis(t);if(li.isDuration(t))return t;if(typeof t=="object")return li.fromObject(t);throw new Ch(`Unknown duration argument ${t} of type ${typeof t}`)}static fromISO(t,r){const[i]=net(t);return i?li.fromObject(i,r):li.invalid("unparsable",`the input "${t}" can't be parsed as ISO 8601`)}static fromISOTime(t,r){const[i]=aet(t);return i?li.fromObject(i,r):li.invalid("unparsable",`the input "${t}" can't be parsed as ISO 8601`)}static invalid(t,r=null){if(!t)throw new Ch("need to specify a reason the Duration is invalid");const i=t instanceof yp?t:new yp(t,r);if(Sa.throwOnInvalid)throw new qJe(i);return new li({invalid:i})}static normalizeUnit(t){const r={year:"years",years:"years",quarter:"quarters",quarters:"quarters",month:"months",months:"months",week:"weeks",weeks:"weeks",day:"days",days:"days",hour:"hours",hours:"hours",minute:"minutes",minutes:"minutes",second:"seconds",seconds:"seconds",millisecond:"milliseconds",milliseconds:"milliseconds"}[t&&t.toLowerCase()];if(!r)throw new K5e(t);return r}static isDuration(t){return t&&t.isLuxonDuration||!1}get locale(){return this.isValid?this.loc.locale:null}get numberingSystem(){return this.isValid?this.loc.numberingSystem:null}toFormat(t,r={}){const i={...r,floor:r.round!==!1&&r.floor!==!1};return this.isValid?id.create(this.loc,i).formatDurationFromString(this,t):het}toHuman(t={}){const r=$2.map(i=>{const n=this.values[i];return Kr(n)?null:this.loc.numberFormatter({style:"unit",unitDisplay:"long",...t,unit:i.slice(0,-1)}).format(n)}).filter(i=>i);return this.loc.listFormatter({type:"conjunction",style:t.listStyle||"narrow",...t}).format(r)}toObject(){return this.isValid?{...this.values}:{}}toISO(){if(!this.isValid)return null;let t="P";return this.years!==0&&(t+=this.years+"Y"),(this.months!==0||this.quarters!==0)&&(t+=this.months+this.quarters*3+"M"),this.weeks!==0&&(t+=this.weeks+"W"),this.days!==0&&(t+=this.days+"D"),(this.hours!==0||this.minutes!==0||this.seconds!==0||this.milliseconds!==0)&&(t+="T"),this.hours!==0&&(t+=this.hours+"H"),this.minutes!==0&&(t+=this.minutes+"M"),(this.seconds!==0||this.milliseconds!==0)&&(t+=Jie(this.seconds+this.milliseconds/1e3,3)+"S"),t==="P"&&(t+="T0S"),t}toISOTime(t={}){if(!this.isValid)return null;const r=this.toMillis();if(r<0||r>=864e5)return null;t={suppressMilliseconds:!1,suppressSeconds:!1,includePrefix:!1,format:"extended",...t};const i=this.shiftTo("hours","minutes","seconds","milliseconds");let n=t.format==="basic"?"hhmm":"hh:mm";(!t.suppressSeconds||i.seconds!==0||i.milliseconds!==0)&&(n+=t.format==="basic"?"ss":":ss",(!t.suppressMilliseconds||i.milliseconds!==0)&&(n+=".SSS"));let s=i.toFormat(n);return t.includePrefix&&(s="T"+s),s}toJSON(){return this.toISO()}toString(){return this.toISO()}toMillis(){return this.as("milliseconds")}valueOf(){return this.toMillis()}plus(t){if(!this.isValid)return this;const r=li.fromDurationLike(t),i={};for(const n of $2)(s9(r.values,n)||s9(this.values,n))&&(i[n]=r.get(n)+this.get(n));return M_(this,{values:i},!0)}minus(t){if(!this.isValid)return this;const r=li.fromDurationLike(t);return this.plus(r.negate())}mapUnits(t){if(!this.isValid)return this;const r={};for(const i of Object.keys(this.values))r[i]=w9e(t(this.values[i],i));return M_(this,{values:r},!0)}get(t){return this[li.normalizeUnit(t)]}set(t){if(!this.isValid)return this;const r={...this.values,...SN(t,li.normalizeUnit)};return M_(this,{values:r})}reconfigure({locale:t,numberingSystem:r,conversionAccuracy:i}={}){const n=this.loc.clone({locale:t,numberingSystem:r}),s={loc:n};return i&&(s.conversionAccuracy=i),M_(this,s)}as(t){return this.isValid?this.shiftTo(t).get(t):NaN}normalize(){if(!this.isValid)return this;const t=this.toObject();return yet(this.matrix,t),M_(this,{values:t},!0)}shiftTo(...t){if(!this.isValid)return this;if(t.length===0)return this;t=t.map(a=>li.normalizeUnit(a));const r={},i={},n=this.toObject();let s;for(const a of $2)if(t.indexOf(a)>=0){s=a;let o=0;for(const c in i)o+=this.matrix[c][a]*i[c],i[c]=0;mw(n[a])&&(o+=n[a]);const l=Math.trunc(o);r[a]=l,i[a]=(o*1e3-l*1e3)/1e3;for(const c in n)$2.indexOf(c)>$2.indexOf(a)&&F9e(this.matrix,n,c,r,a)}else mw(n[a])&&(i[a]=n[a]);for(const a in i)i[a]!==0&&(r[s]+=a===s?i[a]:i[a]/this.matrix[s][a]);return M_(this,{values:r},!0).normalize()}negate(){if(!this.isValid)return this;const t={};for(const r of Object.keys(this.values))t[r]=this.values[r]===0?0:-this.values[r];return M_(this,{values:t},!0)}get years(){return this.isValid?this.values.years||0:NaN}get quarters(){return this.isValid?this.values.quarters||0:NaN}get months(){return this.isValid?this.values.months||0:NaN}get weeks(){return this.isValid?this.values.weeks||0:NaN}get days(){return this.isValid?this.values.days||0:NaN}get hours(){return this.isValid?this.values.hours||0:NaN}get minutes(){return this.isValid?this.values.minutes||0:NaN}get seconds(){return this.isValid?this.values.seconds||0:NaN}get milliseconds(){return this.isValid?this.values.milliseconds||0:NaN}get isValid(){return this.invalid===null}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}equals(t){if(!this.isValid||!t.isValid||!this.loc.equals(t.loc))return!1;function r(i,n){return i===void 0||i===0?n===void 0||n===0:i===n}for(const i of $2)if(!r(this.values[i],t.values[i]))return!1;return!0}}const Q6="Invalid Interval";function bet(e,t){return!e||!e.isValid?ds.invalid("missing or invalid start"):!t||!t.isValid?ds.invalid("missing or invalid end"):t<e?ds.invalid("end before start",`The end of an interval must be after its start, but you had start=${e.toISO()} and end=${t.toISO()}`):null}class ds{constructor(t){this.s=t.start,this.e=t.end,this.invalid=t.invalid||null,this.isLuxonInterval=!0}static invalid(t,r=null){if(!t)throw new Ch("need to specify a reason the Interval is invalid");const i=t instanceof yp?t:new yp(t,r);if(Sa.throwOnInvalid)throw new jJe(i);return new ds({invalid:i})}static fromDateTimes(t,r){const i=e8(t),n=e8(r),s=bet(i,n);return s==null?new ds({start:i,end:n}):s}static after(t,r){const i=li.fromDurationLike(r),n=e8(t);return ds.fromDateTimes(n,n.plus(i))}static before(t,r){const i=li.fromDurationLike(r),n=e8(t);return ds.fromDateTimes(n.minus(i),n)}static fromISO(t,r){const[i,n]=(t||"").split("/",2);if(i&&n){let s,a;try{s=ar.fromISO(i,r),a=s.isValid}catch{a=!1}let o,l;try{o=ar.fromISO(n,r),l=o.isValid}catch{l=!1}if(a&&l)return ds.fromDateTimes(s,o);if(a){const c=li.fromISO(n,r);if(c.isValid)return ds.after(s,c)}else if(l){const c=li.fromISO(i,r);if(c.isValid)return ds.before(o,c)}}return ds.invalid("unparsable",`the input "${t}" can't be parsed as ISO 8601`)}static isInterval(t){return t&&t.isLuxonInterval||!1}get start(){return this.isValid?this.s:null}get end(){return this.isValid?this.e:null}get isValid(){return this.invalidReason===null}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}length(t="milliseconds"){return this.isValid?this.toDuration(t).get(t):NaN}count(t="milliseconds"){if(!this.isValid)return NaN;const r=this.start.startOf(t),i=this.end.startOf(t);return Math.floor(i.diff(r,t).get(t))+1}hasSame(t){return this.isValid?this.isEmpty()||this.e.minus(1).hasSame(this.s,t):!1}isEmpty(){return this.s.valueOf()===this.e.valueOf()}isAfter(t){return this.isValid?this.s>t:!1}isBefore(t){return this.isValid?this.e<=t:!1}contains(t){return this.isValid?this.s<=t&&this.e>t:!1}set({start:t,end:r}={}){return this.isValid?ds.fromDateTimes(t||this.s,r||this.e):this}splitAt(...t){if(!this.isValid)return[];const r=t.map(e8).filter(a=>this.contains(a)).sort(),i=[];let{s:n}=this,s=0;for(;n<this.e;){const a=r[s]||this.e,o=+a>+this.e?this.e:a;i.push(ds.fromDateTimes(n,o)),n=o,s+=1}return i}splitBy(t){const r=li.fromDurationLike(t);if(!this.isValid||!r.isValid||r.as("milliseconds")===0)return[];let{s:i}=this,n=1,s;const a=[];for(;i<this.e;){const o=this.start.plus(r.mapUnits(l=>l*n));s=+o>+this.e?this.e:o,a.push(ds.fromDateTimes(i,s)),i=s,n+=1}return a}divideEqually(t){return this.isValid?this.splitBy(this.length()/t).slice(0,t):[]}overlaps(t){return this.e>t.s&&this.s<t.e}abutsStart(t){return this.isValid?+this.e==+t.s:!1}abutsEnd(t){return this.isValid?+t.e==+this.s:!1}engulfs(t){return this.isValid?this.s<=t.s&&this.e>=t.e:!1}equals(t){return!this.isValid||!t.isValid?!1:this.s.equals(t.s)&&this.e.equals(t.e)}intersection(t){if(!this.isValid)return this;const r=this.s>t.s?this.s:t.s,i=this.e<t.e?this.e:t.e;return r>=i?null:ds.fromDateTimes(r,i)}union(t){if(!this.isValid)return this;const r=this.s<t.s?this.s:t.s,i=this.e>t.e?this.e:t.e;return ds.fromDateTimes(r,i)}static merge(t){const[r,i]=t.sort((n,s)=>n.s-s.s).reduce(([n,s],a)=>s?s.overlaps(a)||s.abutsStart(a)?[n,s.union(a)]:[n.concat([s]),a]:[n,a],[[],null]);return i&&r.push(i),r}static xor(t){let r=null,i=0;const n=[],s=t.map(l=>[{time:l.s,type:"s"},{time:l.e,type:"e"}]),a=Array.prototype.concat(...s),o=a.sort((l,c)=>l.time-c.time);for(const l of o)i+=l.type==="s"?1:-1,i===1?r=l.time:(r&&+r!=+l.time&&n.push(ds.fromDateTimes(r,l.time)),r=null);return ds.merge(n)}difference(...t){return ds.xor([this].concat(t)).map(r=>this.intersection(r)).filter(r=>r&&!r.isEmpty())}toString(){return this.isValid?`[${this.s.toISO()} \u2013 ${this.e.toISO()})`:Q6}toISO(t){return this.isValid?`${this.s.toISO(t)}/${this.e.toISO(t)}`:Q6}toISODate(){return this.isValid?`${this.s.toISODate()}/${this.e.toISODate()}`:Q6}toISOTime(t){return this.isValid?`${this.s.toISOTime(t)}/${this.e.toISOTime(t)}`:Q6}toFormat(t,{separator:r=" \u2013 "}={}){return this.isValid?`${this.s.toFormat(t)}${r}${this.e.toFormat(t)}`:Q6}toDuration(t,r){return this.isValid?this.e.diff(this.s,t,r):li.invalid(this.invalidReason)}mapEndpoints(t){return ds.fromDateTimes(t(this.s),t(this.e))}}class KM{static hasDST(t=Sa.defaultZone){const r=ar.now().setZone(t).set({month:12});return!t.isUniversal&&r.offset!==r.set({month:6}).offset}static isValidIANAZone(t){return $y.isValidZone(t)}static normalizeZone(t){return H1(t,Sa.defaultZone)}static months(t="long",{locale:r=null,numberingSystem:i=null,locObj:n=null,outputCalendar:s="gregory"}={}){return(n||Wn.create(r,i,s)).months(t)}static monthsFormat(t="long",{locale:r=null,numberingSystem:i=null,locObj:n=null,outputCalendar:s="gregory"}={}){return(n||Wn.create(r,i,s)).months(t,!0)}static weekdays(t="long",{locale:r=null,numberingSystem:i=null,locObj:n=null}={}){return(n||Wn.create(r,i,null)).weekdays(t)}static weekdaysFormat(t="long",{locale:r=null,numberingSystem:i=null,locObj:n=null}={}){return(n||Wn.create(r,i,null)).weekdays(t,!0)}static meridiems({locale:t=null}={}){return Wn.create(t).meridiems()}static eras(t="short",{locale:r=null}={}){return Wn.create(r,null,"gregory").eras(t)}static features(){return{relative:v9e()}}}function rhe(e,t){const r=n=>n.toUTC(0,{keepLocalTime:!0}).startOf("day").valueOf(),i=r(t)-r(e);return Math.floor(li.fromMillis(i).as("days"))}function vet(e,t,r){const i=[["years",(o,l)=>l.year-o.year],["quarters",(o,l)=>l.quarter-o.quarter],["months",(o,l)=>l.month-o.month+(l.year-o.year)*12],["weeks",(o,l)=>{const c=rhe(o,l);return(c-c%7)/7}],["days",rhe]],n={};let s,a;for(const[o,l]of i)if(r.indexOf(o)>=0){s=o;let c=l(e,t);a=e.plus({[o]:c}),a>t?(e=e.plus({[o]:c-1}),c-=1):e=a,n[o]=c}return[e,n,a,s]}function _et(e,t,r,i){let[n,s,a,o]=vet(e,t,r);const l=t-n,c=r.filter(h=>["hours","minutes","seconds","milliseconds"].indexOf(h)>=0);c.length===0&&(a<t&&(a=n.plus({[o]:1})),a!==n&&(s[o]=(s[o]||0)+l/(a-n)));const u=li.fromObject(s,i);return c.length>0?li.fromMillis(l,i).shiftTo(...c).plus(u):u}const nne={arab:"[\u0660-\u0669]",arabext:"[\u06F0-\u06F9]",bali:"[\u1B50-\u1B59]",beng:"[\u09E6-\u09EF]",deva:"[\u0966-\u096F]",fullwide:"[\uFF10-\uFF19]",gujr:"[\u0AE6-\u0AEF]",hanidec:"[\u3007|\u4E00|\u4E8C|\u4E09|\u56DB|\u4E94|\u516D|\u4E03|\u516B|\u4E5D]",khmr:"[\u17E0-\u17E9]",knda:"[\u0CE6-\u0CEF]",laoo:"[\u0ED0-\u0ED9]",limb:"[\u1946-\u194F]",mlym:"[\u0D66-\u0D6F]",mong:"[\u1810-\u1819]",mymr:"[\u1040-\u1049]",orya:"[\u0B66-\u0B6F]",tamldec:"[\u0BE6-\u0BEF]",telu:"[\u0C66-\u0C6F]",thai:"[\u0E50-\u0E59]",tibt:"[\u0F20-\u0F29]",latn:"\\d"},ihe={arab:[1632,1641],arabext:[1776,1785],bali:[6992,7001],beng:[2534,2543],deva:[2406,2415],fullwide:[65296,65303],gujr:[2790,2799],khmr:[6112,6121],knda:[3302,3311],laoo:[3792,3801],limb:[6470,6479],mlym:[3430,3439],mong:[6160,6169],mymr:[4160,4169],orya:[2918,2927],tamldec:[3046,3055],telu:[3174,3183],thai:[3664,3673],tibt:[3872,3881]},wet=nne.hanidec.replace(/[\[|\]]/g,"").split("");function xet(e){let t=parseInt(e,10);if(isNaN(t)){t="";for(let r=0;r<e.length;r++){const i=e.charCodeAt(r);if(e[r].search(nne.hanidec)!==-1)t+=wet.indexOf(e[r]);else for(const n in ihe){const[s,a]=ihe[n];i>=s&&i<=a&&(t+=i-s)}}return parseInt(t,10)}else return t}function pf({numberingSystem:e},t=""){return new RegExp(`${nne[e||"latn"]}${t}`)}const Tet="missing Intl.DateTimeFormat.formatToParts support";function _i(e,t=r=>r){return{regex:e,deser:([r])=>t(xet(r))}}const Eet=String.fromCharCode(160),N9e=`[ ${Eet}]`,k9e=new RegExp(N9e,"g");function Cet(e){return e.replace(/\./g,"\\.?").replace(k9e,N9e)}function nhe(e){return e.replace(/\./g,"").replace(k9e," ").toLowerCase()}function mf(e,t){return e===null?null:{regex:RegExp(e.map(Cet).join("|")),deser:([r])=>e.findIndex(i=>nhe(r)===nhe(i))+t}}function she(e,t){return{regex:e,deser:([,r,i])=>fz(r,i),groups:t}}function BG(e){return{regex:e,deser:([t])=>t}}function Aet(e){return e.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function Ret(e,t){const r=pf(t),i=pf(t,"{2}"),n=pf(t,"{3}"),s=pf(t,"{4}"),a=pf(t,"{6}"),o=pf(t,"{1,2}"),l=pf(t,"{1,3}"),c=pf(t,"{1,6}"),u=pf(t,"{1,9}"),h=pf(t,"{2,4}"),p=pf(t,"{4,6}"),m=w=>({regex:RegExp(Aet(w.val)),deser:([v])=>v,literal:!0}),b=(w=>{if(e.literal)return m(w);switch(w.val){case"G":return mf(t.eras("short",!1),0);case"GG":return mf(t.eras("long",!1),0);case"y":return _i(c);case"yy":return _i(h,eQ);case"yyyy":return _i(s);case"yyyyy":return _i(p);case"yyyyyy":return _i(a);case"M":return _i(o);case"MM":return _i(i);case"MMM":return mf(t.months("short",!0,!1),1);case"MMMM":return mf(t.months("long",!0,!1),1);case"L":return _i(o);case"LL":return _i(i);case"LLL":return mf(t.months("short",!1,!1),1);case"LLLL":return mf(t.months("long",!1,!1),1);case"d":return _i(o);case"dd":return _i(i);case"o":return _i(l);case"ooo":return _i(n);case"HH":return _i(i);case"H":return _i(o);case"hh":return _i(i);case"h":return _i(o);case"mm":return _i(i);case"m":return _i(o);case"q":return _i(o);case"qq":return _i(i);case"s":return _i(o);case"ss":return _i(i);case"S":return _i(l);case"SSS":return _i(n);case"u":return BG(u);case"uu":return BG(o);case"uuu":return _i(r);case"a":return mf(t.meridiems(),0);case"kkkk":return _i(s);case"kk":return _i(h,eQ);case"W":return _i(o);case"WW":return _i(i);case"E":case"c":return _i(r);case"EEE":return mf(t.weekdays("short",!1,!1),1);case"EEEE":return mf(t.weekdays("long",!1,!1),1);case"ccc":return mf(t.weekdays("short",!0,!1),1);case"cccc":return mf(t.weekdays("long",!0,!1),1);case"Z":case"ZZ":return she(new RegExp(`([+-]${o.source})(?::(${i.source}))?`),2);case"ZZZ":return she(new RegExp(`([+-]${o.source})(${i.source})?`),2);case"z":return BG(/[a-z_+-/]{1,256}?/i);default:return m(w)}})(e)||{invalidReason:Tet};return b.token=e,b}const Oet={year:{"2-digit":"yy",numeric:"yyyyy"},month:{numeric:"M","2-digit":"MM",short:"MMM",long:"MMMM"},day:{numeric:"d","2-digit":"dd"},weekday:{short:"EEE",long:"EEEE"},dayperiod:"a",dayPeriod:"a",hour:{numeric:"h","2-digit":"hh"},minute:{numeric:"m","2-digit":"mm"},second:{numeric:"s","2-digit":"ss"}};function Met(e,t,r){const{type:i,value:n}=e;if(i==="literal")return{literal:!0,val:n};const s=r[i];let a=Oet[i];if(typeof a=="object"&&(a=a[s]),a)return{literal:!1,val:a}}function Pet(e){return[`^${e.map(r=>r.regex).reduce((r,i)=>`${r}(${i.source})`,"")}$`,e]}function Iet(e,t,r){const i=e.match(t);if(i){const n={};let s=1;for(const a in r)if(s9(r,a)){const o=r[a],l=o.groups?o.groups+1:1;!o.literal&&o.token&&(n[o.token.val[0]]=o.deser(i.slice(s,s+l))),s+=l}return[i,n]}else return[i,{}]}function $et(e){const t=s=>{switch(s){case"S":return"millisecond";case"s":return"second";case"m":return"minute";case"h":case"H":return"hour";case"d":return"day";case"o":return"ordinal";case"L":case"M":return"month";case"y":return"year";case"E":case"c":return"weekday";case"W":return"weekNumber";case"k":return"weekYear";case"q":return"quarter";default:return null}};let r=null,i;return Kr(e.z)||(r=$y.create(e.z)),Kr(e.Z)||(r||(r=new ec(e.Z)),i=e.Z),Kr(e.q)||(e.M=(e.q-1)*3+1),Kr(e.h)||(e.h<12&&e.a===1?e.h+=12:e.h===12&&e.a===0&&(e.h=0)),e.G===0&&e.y&&(e.y=-e.y),Kr(e.u)||(e.S=Qie(e.u)),[Object.keys(e).reduce((s,a)=>{const o=t(a);return o&&(s[o]=e[a]),s},{}),r,i]}let GG=null;function Let(){return GG||(GG=ar.fromMillis(1555555555555)),GG}function Det(e,t){if(e.literal)return e;const r=id.macroTokenToFormatOpts(e.val);if(!r)return e;const s=id.create(t,r).formatDateTimeParts(Let()).map(a=>Met(a,t,r));return s.includes(void 0)?e:s}function Fet(e,t){return Array.prototype.concat(...e.map(r=>Det(r,t)))}function V9e(e,t,r){const i=Fet(id.parseFormat(r),e),n=i.map(a=>Ret(a,e)),s=n.find(a=>a.invalidReason);if(s)return{input:t,tokens:i,invalidReason:s.invalidReason};{const[a,o]=Pet(n),l=RegExp(a,"i"),[c,u]=Iet(t,l,o),[h,p,m]=u?$et(u):[null,null,void 0];if(s9(u,"a")&&s9(u,"H"))throw new NE("Can't include meridiem when specifying 24-hour format");return{input:t,tokens:i,regex:l,rawMatches:c,matches:u,result:h,zone:p,specificOffset:m}}}function Net(e,t,r){const{result:i,zone:n,specificOffset:s,invalidReason:a}=V9e(e,t,r);return[i,n,s,a]}const z9e=[0,31,59,90,120,151,181,212,243,273,304,334],U9e=[0,31,60,91,121,152,182,213,244,274,305,335];function Nh(e,t){return new yp("unit out of range",`you specified ${t} (of type ${typeof t}) as a ${e}, which is invalid`)}function B9e(e,t,r){const i=new Date(Date.UTC(e,t-1,r));e<100&&e>=0&&i.setUTCFullYear(i.getUTCFullYear()-1900);const n=i.getUTCDay();return n===0?7:n}function G9e(e,t,r){return r+(oO(e)?U9e:z9e)[t-1]}function j9e(e,t){const r=oO(e)?U9e:z9e,i=r.findIndex(s=>s<t),n=t-r[i];return{month:i+1,day:n}}function sQ(e){const{year:t,month:r,day:i}=e,n=G9e(t,r,i),s=B9e(t,r,i);let a=Math.floor((n-s+10)/7),o;return a<1?(o=t-1,a=TN(o)):a>TN(t)?(o=t+1,a=1):o=t,{weekYear:o,weekNumber:a,weekday:s,...pz(e)}}function ahe(e){const{weekYear:t,weekNumber:r,weekday:i}=e,n=B9e(t,1,4),s=t7(t);let a=r*7+i-n-3,o;a<1?(o=t-1,a+=t7(o)):a>s?(o=t+1,a-=t7(t)):o=t;const{month:l,day:c}=j9e(o,a);return{year:o,month:l,day:c,...pz(e)}}function jG(e){const{year:t,month:r,day:i}=e,n=G9e(t,r,i);return{year:t,ordinal:n,...pz(e)}}function ohe(e){const{year:t,ordinal:r}=e,{month:i,day:n}=j9e(t,r);return{year:t,month:i,day:n,...pz(e)}}function ket(e){const t=hz(e.weekYear),r=Kg(e.weekNumber,1,TN(e.weekYear)),i=Kg(e.weekday,1,7);return t?r?i?!1:Nh("weekday",e.weekday):Nh("week",e.week):Nh("weekYear",e.weekYear)}function Vet(e){const t=hz(e.year),r=Kg(e.ordinal,1,t7(e.year));return t?r?!1:Nh("ordinal",e.ordinal):Nh("year",e.year)}function q9e(e){const t=hz(e.year),r=Kg(e.month,1,12),i=Kg(e.day,1,xN(e.year,e.month));return t?r?i?!1:Nh("day",e.day):Nh("month",e.month):Nh("year",e.year)}function H9e(e){const{hour:t,minute:r,second:i,millisecond:n}=e,s=Kg(t,0,23)||t===24&&r===0&&i===0&&n===0,a=Kg(r,0,59),o=Kg(i,0,59),l=Kg(n,0,999);return s?a?o?l?!1:Nh("millisecond",n):Nh("second",i):Nh("minute",r):Nh("hour",t)}const qG="Invalid DateTime",lhe=864e13;function eP(e){return new yp("unsupported zone",`the zone "${e.name}" is not supported`)}function HG(e){return e.weekData===null&&(e.weekData=sQ(e.c)),e.weekData}function J6(e,t){const r={ts:e.ts,zone:e.zone,c:e.c,o:e.o,loc:e.loc,invalid:e.invalid};return new ar({...r,...t,old:r})}function W9e(e,t,r){let i=e-t*60*1e3;const n=r.offset(i);if(t===n)return[i,t];i-=(n-t)*60*1e3;const s=r.offset(i);return n===s?[i,n]:[e-Math.min(n,s)*60*1e3,Math.max(n,s)]}function che(e,t){e+=t*60*1e3;const r=new Date(e);return{year:r.getUTCFullYear(),month:r.getUTCMonth()+1,day:r.getUTCDate(),hour:r.getUTCHours(),minute:r.getUTCMinutes(),second:r.getUTCSeconds(),millisecond:r.getUTCMilliseconds()}}function SL(e,t,r){return W9e(Kie(e),t,r)}function dhe(e,t){const r=e.o,i=e.c.year+Math.trunc(t.years),n=e.c.month+Math.trunc(t.months)+Math.trunc(t.quarters)*3,s={...e.c,year:i,month:n,day:Math.min(e.c.day,xN(i,n))+Math.trunc(t.days)+Math.trunc(t.weeks)*7},a=li.fromObject({years:t.years-Math.trunc(t.years),quarters:t.quarters-Math.trunc(t.quarters),months:t.months-Math.trunc(t.months),weeks:t.weeks-Math.trunc(t.weeks),days:t.days-Math.trunc(t.days),hours:t.hours,minutes:t.minutes,seconds:t.seconds,milliseconds:t.milliseconds}).as("milliseconds"),o=Kie(s);let[l,c]=W9e(o,r,e.zone);return a!==0&&(l+=a,c=e.zone.offset(l)),{ts:l,o:c}}function K6(e,t,r,i,n,s){const{setZone:a,zone:o}=r;if(e&&Object.keys(e).length!==0){const l=t||o,c=ar.fromObject(e,{...r,zone:l,specificOffset:s});return a?c:c.setZone(o)}else return ar.invalid(new yp("unparsable",`the input "${n}" can't be parsed as ${i}`))}function tP(e,t,r=!0){return e.isValid?id.create(Wn.create("en-US"),{allowZ:r,forceSimple:!0}).formatDateTimeFromString(e,t):null}function WG(e,t){const r=e.c.year>9999||e.c.year<0;let i="";return r&&e.c.year>=0&&(i+="+"),i+=ra(e.c.year,r?6:4),t?(i+="-",i+=ra(e.c.month),i+="-",i+=ra(e.c.day)):(i+=ra(e.c.month),i+=ra(e.c.day)),i}function uhe(e,t,r,i,n,s){let a=ra(e.c.hour);return t?(a+=":",a+=ra(e.c.minute),(e.c.second!==0||!r)&&(a+=":")):a+=ra(e.c.minute),(e.c.second!==0||!r)&&(a+=ra(e.c.second),(e.c.millisecond!==0||!i)&&(a+=".",a+=ra(e.c.millisecond,3))),n&&(e.isOffsetFixed&&e.offset===0&&!s?a+="Z":e.o<0?(a+="-",a+=ra(Math.trunc(-e.o/60)),a+=":",a+=ra(Math.trunc(-e.o%60))):(a+="+",a+=ra(Math.trunc(e.o/60)),a+=":",a+=ra(Math.trunc(e.o%60)))),s&&(a+="["+e.zone.ianaName+"]"),a}const X9e={month:1,day:1,hour:0,minute:0,second:0,millisecond:0},zet={weekNumber:1,weekday:1,hour:0,minute:0,second:0,millisecond:0},Uet={ordinal:1,hour:0,minute:0,second:0,millisecond:0},Y9e=["year","month","day","hour","minute","second","millisecond"],Bet=["weekYear","weekNumber","weekday","hour","minute","second","millisecond"],Get=["year","ordinal","hour","minute","second","millisecond"];function hhe(e){const t={year:"year",years:"year",month:"month",months:"month",day:"day",days:"day",hour:"hour",hours:"hour",minute:"minute",minutes:"minute",quarter:"quarter",quarters:"quarter",second:"second",seconds:"second",millisecond:"millisecond",milliseconds:"millisecond",weekday:"weekday",weekdays:"weekday",weeknumber:"weekNumber",weeksnumber:"weekNumber",weeknumbers:"weekNumber",weekyear:"weekYear",weekyears:"weekYear",ordinal:"ordinal"}[e.toLowerCase()];if(!t)throw new K5e(e);return t}function fhe(e,t){const r=H1(t.zone,Sa.defaultZone),i=Wn.fromObject(t),n=Sa.now();let s,a;if(Kr(e.year))s=n;else{for(const c of Y9e)Kr(e[c])&&(e[c]=X9e[c]);const o=q9e(e)||H9e(e);if(o)return ar.invalid(o);const l=r.offset(n);[s,a]=SL(e,l,r)}return new ar({ts:s,zone:r,loc:i,o:a})}function phe(e,t,r){const i=Kr(r.round)?!0:r.round,n=(a,o)=>(a=Jie(a,i||r.calendary?0:2,!0),t.loc.clone(r).relFormatter(r).format(a,o)),s=a=>r.calendary?t.hasSame(e,a)?0:t.startOf(a).diff(e.startOf(a),a).get(a):t.diff(e,a).get(a);if(r.unit)return n(s(r.unit),r.unit);for(const a of r.units){const o=s(a);if(Math.abs(o)>=1)return n(o,a)}return n(e>t?-0:0,r.units[r.units.length-1])}function mhe(e){let t={},r;return e.length>0&&typeof e[e.length-1]=="object"?(t=e[e.length-1],r=Array.from(e).slice(0,e.length-1)):r=Array.from(e),[t,r]}class ar{constructor(t){const r=t.zone||Sa.defaultZone;let i=t.invalid||(Number.isNaN(t.ts)?new yp("invalid input"):null)||(r.isValid?null:eP(r));this.ts=Kr(t.ts)?Sa.now():t.ts;let n=null,s=null;if(!i)if(t.old&&t.old.ts===this.ts&&t.old.zone.equals(r))[n,s]=[t.old.c,t.old.o];else{const o=r.offset(this.ts);n=che(this.ts,o),i=Number.isNaN(n.year)?new yp("invalid input"):null,n=i?null:n,s=i?null:o}this._zone=r,this.loc=t.loc||Wn.create(),this.invalid=i,this.weekData=null,this.c=n,this.o=s,this.isLuxonDateTime=!0}static now(){return new ar({})}static local(){const[t,r]=mhe(arguments),[i,n,s,a,o,l,c]=r;return fhe({year:i,month:n,day:s,hour:a,minute:o,second:l,millisecond:c},t)}static utc(){const[t,r]=mhe(arguments),[i,n,s,a,o,l,c]=r;return t.zone=ec.utcInstance,fhe({year:i,month:n,day:s,hour:a,minute:o,second:l,millisecond:c},t)}static fromJSDate(t,r={}){const i=YJe(t)?t.valueOf():NaN;if(Number.isNaN(i))return ar.invalid("invalid input");const n=H1(r.zone,Sa.defaultZone);return n.isValid?new ar({ts:i,zone:n,loc:Wn.fromObject(r)}):ar.invalid(eP(n))}static fromMillis(t,r={}){if(mw(t))return t<-lhe||t>lhe?ar.invalid("Timestamp out of range"):new ar({ts:t,zone:H1(r.zone,Sa.defaultZone),loc:Wn.fromObject(r)});throw new Ch(`fromMillis requires a numerical input, but received a ${typeof t} with value ${t}`)}static fromSeconds(t,r={}){if(mw(t))return new ar({ts:t*1e3,zone:H1(r.zone,Sa.defaultZone),loc:Wn.fromObject(r)});throw new Ch("fromSeconds requires a numerical input")}static fromObject(t,r={}){t=t||{};const i=H1(r.zone,Sa.defaultZone);if(!i.isValid)return ar.invalid(eP(i));const n=Sa.now(),s=Kr(r.specificOffset)?i.offset(n):r.specificOffset,a=SN(t,hhe),o=!Kr(a.ordinal),l=!Kr(a.year),c=!Kr(a.month)||!Kr(a.day),u=l||c,h=a.weekYear||a.weekNumber,p=Wn.fromObject(r);if((u||o)&&h)throw new NE("Can't mix weekYear/weekNumber units with year/month/day or ordinals");if(c&&o)throw new NE("Can't mix ordinal dates with month/day");const m=h||a.weekday&&!u;let g,b,w=che(n,s);m?(g=Bet,b=zet,w=sQ(w)):o?(g=Get,b=Uet,w=jG(w)):(g=Y9e,b=X9e);let v=!1;for(const I of g){const L=a[I];Kr(L)?v?a[I]=b[I]:a[I]=w[I]:v=!0}const x=m?ket(a):o?Vet(a):q9e(a),T=x||H9e(a);if(T)return ar.invalid(T);const E=m?ahe(a):o?ohe(a):a,[C,A]=SL(E,s,i),P=new ar({ts:C,zone:i,o:A,loc:p});return a.weekday&&u&&t.weekday!==P.weekday?ar.invalid("mismatched weekday",`you can't specify both a weekday of ${a.weekday} and a date of ${P.toISO()}`):P}static fromISO(t,r={}){const[i,n]=tet(t);return K6(i,n,r,"ISO 8601",t)}static fromRFC2822(t,r={}){const[i,n]=ret(t);return K6(i,n,r,"RFC 2822",t)}static fromHTTP(t,r={}){const[i,n]=iet(t);return K6(i,n,r,"HTTP",r)}static fromFormat(t,r,i={}){if(Kr(t)||Kr(r))throw new Ch("fromFormat requires an input string and a format");const{locale:n=null,numberingSystem:s=null}=i,a=Wn.fromOpts({locale:n,numberingSystem:s,defaultToEN:!0}),[o,l,c,u]=Net(a,t,r);return u?ar.invalid(u):K6(o,l,i,`format ${r}`,t,c)}static fromString(t,r,i={}){return ar.fromFormat(t,r,i)}static fromSQL(t,r={}){const[i,n]=uet(t);return K6(i,n,r,"SQL",t)}static invalid(t,r=null){if(!t)throw new Ch("need to specify a reason the DateTime is invalid");const i=t instanceof yp?t:new yp(t,r);if(Sa.throwOnInvalid)throw new GJe(i);return new ar({invalid:i})}static isDateTime(t){return t&&t.isLuxonDateTime||!1}get(t){return this[t]}get isValid(){return this.invalid===null}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}get locale(){return this.isValid?this.loc.locale:null}get numberingSystem(){return this.isValid?this.loc.numberingSystem:null}get outputCalendar(){return this.isValid?this.loc.outputCalendar:null}get zone(){return this._zone}get zoneName(){return this.isValid?this.zone.name:null}get year(){return this.isValid?this.c.year:NaN}get quarter(){return this.isValid?Math.ceil(this.c.month/3):NaN}get month(){return this.isValid?this.c.month:NaN}get day(){return this.isValid?this.c.day:NaN}get hour(){return this.isValid?this.c.hour:NaN}get minute(){return this.isValid?this.c.minute:NaN}get second(){return this.isValid?this.c.second:NaN}get millisecond(){return this.isValid?this.c.millisecond:NaN}get weekYear(){return this.isValid?HG(this).weekYear:NaN}get weekNumber(){return this.isValid?HG(this).weekNumber:NaN}get weekday(){return this.isValid?HG(this).weekday:NaN}get ordinal(){return this.isValid?jG(this.c).ordinal:NaN}get monthShort(){return this.isValid?KM.months("short",{locObj:this.loc})[this.month-1]:null}get monthLong(){return this.isValid?KM.months("long",{locObj:this.loc})[this.month-1]:null}get weekdayShort(){return this.isValid?KM.weekdays("short",{locObj:this.loc})[this.weekday-1]:null}get weekdayLong(){return this.isValid?KM.weekdays("long",{locObj:this.loc})[this.weekday-1]:null}get offset(){return this.isValid?+this.o:NaN}get offsetNameShort(){return this.isValid?this.zone.offsetName(this.ts,{format:"short",locale:this.locale}):null}get offsetNameLong(){return this.isValid?this.zone.offsetName(this.ts,{format:"long",locale:this.locale}):null}get isOffsetFixed(){return this.isValid?this.zone.isUniversal:null}get isInDST(){return this.isOffsetFixed?!1:this.offset>this.set({month:1,day:1}).offset||this.offset>this.set({month:5}).offset}get isInLeapYear(){return oO(this.year)}get daysInMonth(){return xN(this.year,this.month)}get daysInYear(){return this.isValid?t7(this.year):NaN}get weeksInWeekYear(){return this.isValid?TN(this.weekYear):NaN}resolvedLocaleOptions(t={}){const{locale:r,numberingSystem:i,calendar:n}=id.create(this.loc.clone(t),t).resolvedOptions(this);return{locale:r,numberingSystem:i,outputCalendar:n}}toUTC(t=0,r={}){return this.setZone(ec.instance(t),r)}toLocal(){return this.setZone(Sa.defaultZone)}setZone(t,{keepLocalTime:r=!1,keepCalendarTime:i=!1}={}){if(t=H1(t,Sa.defaultZone),t.equals(this.zone))return this;if(t.isValid){let n=this.ts;if(r||i){const s=t.offset(this.ts),a=this.toObject();[n]=SL(a,s,t)}return J6(this,{ts:n,zone:t})}else return ar.invalid(eP(t))}reconfigure({locale:t,numberingSystem:r,outputCalendar:i}={}){const n=this.loc.clone({locale:t,numberingSystem:r,outputCalendar:i});return J6(this,{loc:n})}setLocale(t){return this.reconfigure({locale:t})}set(t){if(!this.isValid)return this;const r=SN(t,hhe),i=!Kr(r.weekYear)||!Kr(r.weekNumber)||!Kr(r.weekday),n=!Kr(r.ordinal),s=!Kr(r.year),a=!Kr(r.month)||!Kr(r.day),o=s||a,l=r.weekYear||r.weekNumber;if((o||n)&&l)throw new NE("Can't mix weekYear/weekNumber units with year/month/day or ordinals");if(a&&n)throw new NE("Can't mix ordinal dates with month/day");let c;i?c=ahe({...sQ(this.c),...r}):Kr(r.ordinal)?(c={...this.toObject(),...r},Kr(r.day)&&(c.day=Math.min(xN(c.year,c.month),c.day))):c=ohe({...jG(this.c),...r});const[u,h]=SL(c,this.o,this.zone);return J6(this,{ts:u,o:h})}plus(t){if(!this.isValid)return this;const r=li.fromDurationLike(t);return J6(this,dhe(this,r))}minus(t){if(!this.isValid)return this;const r=li.fromDurationLike(t).negate();return J6(this,dhe(this,r))}startOf(t){if(!this.isValid)return this;const r={},i=li.normalizeUnit(t);switch(i){case"years":r.month=1;case"quarters":case"months":r.day=1;case"weeks":case"days":r.hour=0;case"hours":r.minute=0;case"minutes":r.second=0;case"seconds":r.millisecond=0;break}if(i==="weeks"&&(r.weekday=1),i==="quarters"){const n=Math.ceil(this.month/3);r.month=(n-1)*3+1}return this.set(r)}endOf(t){return this.isValid?this.plus({[t]:1}).startOf(t).minus(1):this}toFormat(t,r={}){return this.isValid?id.create(this.loc.redefaultToEN(r)).formatDateTimeFromString(this,t):qG}toLocaleString(t=KZ,r={}){return this.isValid?id.create(this.loc.clone(r),t).formatDateTime(this):qG}toLocaleParts(t={}){return this.isValid?id.create(this.loc.clone(t),t).formatDateTimeParts(this):[]}toISO({format:t="extended",suppressSeconds:r=!1,suppressMilliseconds:i=!1,includeOffset:n=!0,extendedZone:s=!1}={}){if(!this.isValid)return null;const a=t==="extended";let o=WG(this,a);return o+="T",o+=uhe(this,a,r,i,n,s),o}toISODate({format:t="extended"}={}){return this.isValid?WG(this,t==="extended"):null}toISOWeekDate(){return tP(this,"kkkk-'W'WW-c")}toISOTime({suppressMilliseconds:t=!1,suppressSeconds:r=!1,includeOffset:i=!0,includePrefix:n=!1,extendedZone:s=!1,format:a="extended"}={}){return this.isValid?(n?"T":"")+uhe(this,a==="extended",r,t,i,s):null}toRFC2822(){return tP(this,"EEE, dd LLL yyyy HH:mm:ss ZZZ",!1)}toHTTP(){return tP(this.toUTC(),"EEE, dd LLL yyyy HH:mm:ss 'GMT'")}toSQLDate(){return this.isValid?WG(this,!0):null}toSQLTime({includeOffset:t=!0,includeZone:r=!1,includeOffsetSpace:i=!0}={}){let n="HH:mm:ss.SSS";return(r||t)&&(i&&(n+=" "),r?n+="z":t&&(n+="ZZ")),tP(this,n,!0)}toSQL(t={}){return this.isValid?`${this.toSQLDate()} ${this.toSQLTime(t)}`:null}toString(){return this.isValid?this.toISO():qG}valueOf(){return this.toMillis()}toMillis(){return this.isValid?this.ts:NaN}toSeconds(){return this.isValid?this.ts/1e3:NaN}toUnixInteger(){return this.isValid?Math.floor(this.ts/1e3):NaN}toJSON(){return this.toISO()}toBSON(){return this.toJSDate()}toObject(t={}){if(!this.isValid)return{};const r={...this.c};return t.includeConfig&&(r.outputCalendar=this.outputCalendar,r.numberingSystem=this.loc.numberingSystem,r.locale=this.loc.locale),r}toJSDate(){return new Date(this.isValid?this.ts:NaN)}diff(t,r="milliseconds",i={}){if(!this.isValid||!t.isValid)return li.invalid("created by diffing an invalid DateTime");const n={locale:this.locale,numberingSystem:this.numberingSystem,...i},s=ZJe(r).map(li.normalizeUnit),a=t.valueOf()>this.valueOf(),o=a?this:t,l=a?t:this,c=_et(o,l,s,n);return a?c.negate():c}diffNow(t="milliseconds",r={}){return this.diff(ar.now(),t,r)}until(t){return this.isValid?ds.fromDateTimes(this,t):this}hasSame(t,r){if(!this.isValid)return!1;const i=t.valueOf(),n=this.setZone(t.zone,{keepLocalTime:!0});return n.startOf(r)<=i&&i<=n.endOf(r)}equals(t){return this.isValid&&t.isValid&&this.valueOf()===t.valueOf()&&this.zone.equals(t.zone)&&this.loc.equals(t.loc)}toRelative(t={}){if(!this.isValid)return null;const r=t.base||ar.fromObject({},{zone:this.zone}),i=t.padding?this<r?-t.padding:t.padding:0;let n=["years","months","days","hours","minutes","seconds"],s=t.unit;return Array.isArray(t.unit)&&(n=t.unit,s=void 0),phe(r,this.plus(i),{...t,numeric:"always",units:n,unit:s})}toRelativeCalendar(t={}){return this.isValid?phe(t.base||ar.fromObject({},{zone:this.zone}),this,{...t,numeric:"auto",units:["years","months","days"],calendary:!0}):null}static min(...t){if(!t.every(ar.isDateTime))throw new Ch("min requires all arguments be DateTimes");return Hue(t,r=>r.valueOf(),Math.min)}static max(...t){if(!t.every(ar.isDateTime))throw new Ch("max requires all arguments be DateTimes");return Hue(t,r=>r.valueOf(),Math.max)}static fromFormatExplain(t,r,i={}){const{locale:n=null,numberingSystem:s=null}=i,a=Wn.fromOpts({locale:n,numberingSystem:s,defaultToEN:!0});return V9e(a,t,r)}static fromStringExplain(t,r,i={}){return ar.fromFormatExplain(t,r,i)}static get DATE_SHORT(){return KZ}static get DATE_MED(){return e9e}static get DATE_MED_WITH_WEEKDAY(){return HJe}static get DATE_FULL(){return t9e}static get DATE_HUGE(){return r9e}static get TIME_SIMPLE(){return i9e}static get TIME_WITH_SECONDS(){return n9e}static get TIME_WITH_SHORT_OFFSET(){return s9e}static get TIME_WITH_LONG_OFFSET(){return a9e}static get TIME_24_SIMPLE(){return o9e}static get TIME_24_WITH_SECONDS(){return l9e}static get TIME_24_WITH_SHORT_OFFSET(){return c9e}static get TIME_24_WITH_LONG_OFFSET(){return d9e}static get DATETIME_SHORT(){return u9e}static get DATETIME_SHORT_WITH_SECONDS(){return h9e}static get DATETIME_MED(){return f9e}static get DATETIME_MED_WITH_SECONDS(){return p9e}static get DATETIME_MED_WITH_WEEKDAY(){return WJe}static get DATETIME_FULL(){return m9e}static get DATETIME_FULL_WITH_SECONDS(){return g9e}static get DATETIME_HUGE(){return y9e}static get DATETIME_HUGE_WITH_SECONDS(){return b9e}}function e8(e){if(ar.isDateTime(e))return e;if(e&&e.valueOf&&mw(e.valueOf()))return ar.fromJSDate(e);if(e&&typeof e=="object")return ar.fromObject(e);throw new Ch(`Unknown datetime argument: ${e}, of type ${typeof e}`)}const XG={ar:[".",","],bg:[",","\xA0"],bs:[",","."],ca:[",","."],cs:[",","\xA0"],da:[",","."],de:[",","."],"de-ch":[".","\u2019"],el:[",","."],en:[".",","],"en-au":[".",","],es:[",","."],"es-mx":[".",","],et:[",","\xA0"],fi:[",","\xA0"],fr:[",","\u202F"],"fr-ch":[",","\u202F"],he:[".",","],hi:[".",",","#,##,##0.###"],hr:[",","."],hu:[",","\xA0"],id:[",","."],it:[",","."],"it-ch":[".","\u2019"],ja:[".",","],ko:[".",","],lt:[",","\xA0"],lv:[",","\xA0"],mk:[",","."],nb:[",","\xA0"],nl:[",","."],pl:[",","\xA0"],pt:[",","."],"pt-pt":[",","\xA0"],ro:[",","."],ru:[",","\xA0"],sk:[",","\xA0"],sl:[",","."],sr:[",","."],sv:[",","\xA0"],th:[".",","],tr:[",","."],uk:[",","\xA0"],vi:[",","."],zh:[".",","]};function Z9e(e){e||(e=mu());let t=e in XG;if(!t){const s=e.split("-");s.length>1&&s[0]in XG&&(e=s[0],t=!0),t||(e="en")}const[r,i,n="#,##0.###"]=XG[e];return{decimal:r,group:i,pattern:n}}function jet(e,t){const r=Z9e((t={...t}).locale);t.customs=r;const i=t.pattern||r.pattern;return isNaN(e)||Math.abs(e)===1/0?null:qet(e,i,t)}const Q9e=/[#0,]*[#0](?:\.0*#*)?/;function qet(e,t,r){const i=(r=r||{}).customs.group,n=r.customs.decimal,s=t.split(";"),a=s[0];if((t=s[e<0?1:0]||"-"+a).includes("%"))e*=100;else if(t.includes("\u2030"))e*=1e3;else{if(t.includes("\xA4"))throw new Error("currency notation not supported");if(t.includes("E"))throw new Error("exponential notation not supported")}const o=Q9e,l=a.match(o);if(!l)throw new Error("unable to find a number expression in pattern: "+t);return r.fractional===!1&&(r.places=0),t.replace(o,Het(e,l[0],{decimal:n,group:i,places:r.places,round:r.round}))}function Het(e,t,r){(r=r||{}).places===!0&&(r.places=0),r.places===1/0&&(r.places=6);const i=t.split("."),n=typeof r.places=="string"&&r.places.indexOf(",");let s=r.places;n?s=r.places.substring(n+1):s>=0||(s=(i[1]||[]).length),r.round<0||(e=Number(e.toFixed(Number(s))));const a=String(Math.abs(e)).split("."),o=a[1]||"";if(i[1]||r.places){n&&(r.places=r.places.substring(0,n));const g=r.places!==void 0?r.places:i[1]&&i[1].lastIndexOf("0")+1;g>o.length&&(a[1]=o.padEnd(Number(g),"0")),s<o.length&&(a[1]=o.substr(0,Number(s)))}else a[1]&&a.pop();const l=i[0].replace(",","");let c=l.indexOf("0");c!==-1&&(c=l.length-c,c>a[0].length&&(a[0]=a[0].padStart(c,"0")),l.includes("#")||(a[0]=a[0].substr(a[0].length-c)));let u,h,p=i[0].lastIndexOf(",");if(p!==-1){u=i[0].length-p-1;const g=i[0].substr(0,p);p=g.lastIndexOf(","),p!==-1&&(h=g.length-p-1)}const m=[];for(let g=a[0];g;){const b=g.length-u;m.push(b>0?g.substr(b):g),g=b>0?g.slice(0,b):"",h&&(u=h,h=void 0)}return a[0]=m.reverse().join(r.group||","),a.join(r.decimal||".")}function Wet(e){const t=Z9e((e=e||{}).locale),r=e.pattern||t.pattern,i=t.group,n=t.decimal;let s=1;if(r.includes("%"))s/=100;else if(r.includes("\u2030"))s/=1e3;else if(r.includes("\xA4"))throw new Error("currency notation not supported");const a=r.split(";");return a.length===1&&a.push("-"+a[0]),{regexp:EA(a,l=>(l="(?:"+F2e(l,".")+")").replace(Q9e,c=>{const u={signed:!1,separator:e.strict?i:[i,""],fractional:e.fractional,decimal:n,exponent:!1},h=c.split(".");let p=e.places;h.length===1&&s!==1&&(h[1]="###"),h.length===1||p===0?u.fractional=!1:(p===void 0&&(p=e.pattern?h[1].lastIndexOf("0")+1:1/0),p&&e.fractional==null&&(u.fractional=!0),!e.places&&p<h[1].length&&(p+=","+h[1].length),u.places=p);const m=h[0].split(",");return m.length>1&&(u.groupSize=m.pop().length,m.length>1&&(u.groupSize2=m.pop().length)),"("+Yet(u)+")"}),!0).replace(/[\xa0 ]/g,"[\\s\\xa0]"),group:i,decimal:n,factor:s}}function Xet(e,t){const r=Wet(t),i=new RegExp("^"+r.regexp+"$").exec(e);if(!i)return NaN;let n=i[1];if(!i[1]){if(!i[2])return NaN;n=i[2],r.factor*=-1}return n=n.replace(new RegExp("["+r.group+"\\s\\xa0]","g"),"").replace(r.decimal,"."),Number(n)*r.factor}function Yet(e){"places"in(e=e||{})||(e.places=1/0),typeof e.decimal!="string"&&(e.decimal="."),"fractional"in e&&!/^0/.test(String(e.places))||(e.fractional=[!0,!1]),"exponent"in e||(e.exponent=[!0,!1]),"eSigned"in e||(e.eSigned=[!0,!1]);const t=ghe(e),r=EA(e.fractional,n=>{let s="";return n&&e.places!==0&&(s="\\"+e.decimal,e.places===1/0?s="(?:"+s+"\\d+)?":s+="\\d{"+e.places+"}"),s},!0);let i=t+r;return r&&(i="(?:(?:"+i+")|(?:"+r+"))"),i+EA(e.exponent,n=>n?"([eE]"+ghe({signed:e.eSigned})+")":"")}function ghe(e){return"signed"in(e=e||{})||(e.signed=[!0,!1]),"separator"in e?"groupSize"in e||(e.groupSize=3):e.separator="",EA(e.signed,t=>t?"[-+]":"",!0)+EA(e.separator,t=>{if(!t)return"(?:\\d+)";(t=F2e(t))===" "?t="\\s":t==="\xA0"&&(t="\\s\\xa0");const r=e.groupSize,i=e.groupSize2;if(i){const n="(?:0|[1-9]\\d{0,"+(i-1)+"}(?:["+t+"]\\d{"+i+"})*["+t+"]\\d{"+r+"})";return r-i>0?"(?:"+n+"|(?:0|[1-9]\\d{0,"+(r-1)+"}))":n}return"(?:0|[1-9]\\d{0,"+(r-1)+"}(?:["+t+"]\\d{"+r+"})*)"},!0)}const EA=(e,t,r)=>{if(!(e instanceof Array))return t(e);const i=[];for(let n=0;n<e.length;n++)i.push(t(e[n]));return Zet(i.join("|"),r)},Zet=(e,t)=>"("+(t?"?:":"")+e+")";var yhe,bhe;function D$t(e){return l6.fromJSON(e.toJSON())}function Qet(e){return e.toJSON?e.toJSON():e}function F$t(e){return typeof e=="string"||e instanceof String}function N$t(e){return typeof e=="number"}function vhe(e){return e instanceof Date}function k$t(e,t){return e===t||!(!vhe(e)||!vhe(t))&&e.getTime()===t.getTime()}function V$t(e){if(e===void 0)return null;if(typeof e=="number")return e;switch(e.toLowerCase()){case"meters":case"meter":return 109404;case"miles":case"mile":return 109413;case"kilometers":case"kilometer":case"km":return 109414}return null}function z$t(e){if(e===null)return null;switch(e.type){case"polygon":case"multipoint":case"polyline":return e.extent;case"point":return new Zt({xmin:e.x,ymin:e.y,xmax:e.x,ymax:e.y,spatialReference:e.spatialReference});case"extent":return e}return null}function U$t(e){if(e===void 0)return null;if(typeof e=="number"||typeof e=="number")return e;switch(e.toLowerCase()){case"meters":case"meter":return 9001;case"miles":case"mile":return 9035;case"kilometers":case"kilometer":case"km":return 9036}return null}(function(e){e[e.Standardised=0]="Standardised",e[e.StandardisedNoInterval=1]="StandardisedNoInterval",e[e.SqlServer=2]="SqlServer",e[e.Oracle=3]="Oracle",e[e.Postgres=4]="Postgres",e[e.PGDB=5]="PGDB",e[e.FILEGDB=6]="FILEGDB",e[e.NotEvaluated=7]="NotEvaluated"})(yhe||(yhe={})),function(e){e[e.InFeatureSet=0]="InFeatureSet",e[e.NotInFeatureSet=1]="NotInFeatureSet",e[e.Unknown=2]="Unknown"}(bhe||(bhe={}));const B$t=1e3,G$t={point:"point",polygon:"polygon",polyline:"polyline",multipoint:"multipoint",extent:"extent",esriGeometryPoint:"point",esriGeometryPolygon:"polygon",esriGeometryPolyline:"polyline",esriGeometryMultipoint:"multipoint",esriGeometryEnvelope:"extent",envelope:"extent"},_he={point:"esriGeometryPoint",polygon:"esriGeometryPolygon",polyline:"esriGeometryPolyline",multipoint:"esriGeometryMultipoint",extent:"esriGeometryEnvelope",esriGeometryPoint:"esriGeometryPoint",esriGeometryPolygon:"esriGeometryPolygon",esriGeometryPolyline:"esriGeometryPolyline",esriGeometryMultipoint:"esriGeometryMultipoint",esriGeometryEnvelope:"esriGeometryEnvelope",envelope:"esriGeometryEnvelope"},j$t={"small-integer":"esriFieldTypeSmallInteger",integer:"esriFieldTypeInteger",long:"esriFieldTypeLong",single:"esriFieldTypeSingle",double:"esriFieldTypeDouble",string:"esriFieldTypeString",date:"esriFieldTypeDate",oid:"esriFieldTypeOID",geometry:"esriFieldTypeGeometry",blob:"esriFieldTypeBlob",raster:"esriFieldTypeRaster",guid:"esriFieldTypeGUID","global-id":"esriFieldTypeGlobalID",xml:"eesriFieldTypeXML",esriFieldTypeSmallInteger:"esriFieldTypeSmallInteger",esriFieldTypeInteger:"esriFieldTypeInteger",esriFieldTypeLong:"esriFieldTypeLong",esriFieldTypeSingle:"esriFieldTypeSingle",esriFieldTypeDouble:"esriFieldTypeDouble",esriFieldTypeString:"esriFieldTypeString",esriFieldTypeDate:"esriFieldTypeDate",esriFieldTypeOID:"esriFieldTypeOID",esriFieldTypeGeometry:"esriFieldTypeGeometry",esriFieldTypeBlob:"esriFieldTypeBlob",esriFieldTypeRaster:"esriFieldTypeRaster",esriFieldTypeGUID:"esriFieldTypeGUID",esriFieldTypeGlobalID:"esriFieldTypeGlobalID",esriFieldTypeXML:"eesriFieldTypeXML"};function q$t(e){return e===void 0?"":e=(e=(e=e.replace(/\/featureserver\/[0-9]*/i,"/FeatureServer")).replace(/\/mapserver\/[0-9]*/i,"/MapServer")).split("?")[0]}function H$t(e,t){t||(t={}),typeof t=="function"&&(t={cmp:t});const r=typeof t.cycles=="boolean"&&t.cycles,i=t.cmp&&(n=t.cmp,function(a){return function(o,l){const c={key:o,value:a[o]},u={key:l,value:a[l]};return n(c,u)}});var n;const s=[];return function a(o){if(o&&o.toJSON&&typeof o.toJSON=="function"&&(o=o.toJSON()),o===void 0)return;if(typeof o=="number")return isFinite(o)?""+o:"null";if(typeof o!="object")return JSON.stringify(o);let l,c;if(Array.isArray(o)){for(c="[",l=0;l<o.length;l++)l&&(c+=","),c+=a(o[l])||"null";return c+"]"}if(o===null)return"null";if(s.includes(o)){if(r)return JSON.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}const u=s.push(o)-1,h=Object.keys(o).sort(i&&i(o));for(c="",l=0;l<h.length;l++){const p=h[l],m=a(o[p]);m&&(c&&(c+=","),c+=JSON.stringify(p)+":"+m)}return s.splice(u,1),"{"+c+"}"}(e)}class J9e{constructor(t){this.value=t}}class K9e{constructor(t){this.value=t}}class sne{constructor(t){this.fn=t}}class ane{constructor(t,r){this.paramCount=r,this.fn=t}}const Jet=sne,Ket=K9e,ett=J9e,ttt=ane,Kd={type:"VOID"},rtt={type:"BREAK"},itt={type:"CONTINUE"};function CA(e,t,r){return t===""||t==null||t===r||t===r?e:e=e.split(t).join(r)}function one(e){return e instanceof sne||e instanceof BJe||e instanceof ane}function EN(e){return!!Co(e)||!!Yl(e)||!!ll(e)||!!Xl(e)||e===null||e===Kd||typeof e=="number"}function ntt(e,t){return e===void 0?t:e}function Co(e){return typeof e=="string"||e instanceof String}function Xl(e){return typeof e=="boolean"}function Yl(e){return typeof e=="number"}function stt(e){return typeof e=="number"&&isFinite(e)&&Math.floor(e)===e}function Qh(e){return e instanceof Array}function att(e){return(e==null?void 0:e.arcadeDeclaredClass)==="esri.arcade.Feature"}function ott(e){return(e&&e.declaredRootClass&&e.declaredRootClass==="esri.arcade.featureset.support.FeatureSet")===!0}function ltt(e){return(e&&e.declaredRootClass&&e.declaredRootClass==="esri.arcade.featureSetCollection")===!0}function Gw(e){return e instanceof Pm}function ll(e){return e instanceof Date}function ctt(e,t,r){if(e.length<t||e.length>r)throw new Error("Function called with wrong number of Parameters")}function dtt(e){return e<0?-Math.round(-e):Math.round(e)}function utt(){let e=Date.now();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){const r=(e+16*Math.random())%16|0;return e=Math.floor(e/16),(t==="x"?r:3&r|8).toString(16)})}function lne(e,t){return isNaN(e)===!1?t==null||t===""?e.toString():(t=CA(t,"\u2030",""),t=CA(t,"\xA4",""),jet(e,{pattern:t})):e.toString()}function mz(e,t){const r=ar.fromJSDate(e);return t==null||t===""?r.toISO({suppressMilliseconds:!0}):r.toFormat(e6e(t),{locale:mu(),numberingSystem:"latn"})}function e6e(e){e=e.replace(/LTS|LT|LL?L?L?|l{1,4}/g,"[$&]");let t="";const r=/(\[[^\[]*\])|(\\)?([Hh]mm(ss)?|Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|Qo?|N{1,5}|YYYYYY|YYYYY|YYYY|YY|y{2,4}|yo?|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|kk?|mm?|ss?|S{1,9}|x|X|zz?|ZZ?|.)/g;for(const i of e.match(r))switch(i){case"D":t+="d";break;case"DD":t+="dd";break;case"DDD":t+="o";break;case"d":t+="c";break;case"ddd":t+="ccc";break;case"dddd":t+="cccc";break;case"M":t+="L";break;case"MM":t+="LL";break;case"MMM":t+="LLL";break;case"MMMM":t+="LLLL";break;case"YY":t+="yy";break;case"Y":case"YYYY":t+="yyyy";break;case"Q":t+="q";break;case"Z":t+="ZZ";break;case"ZZ":t+="ZZZ";break;case"S":t+="'S'";break;case"SS":t+="'SS'";break;case"SSS":t+="u";break;case"A":case"a":t+="a";break;case"m":case"mm":case"h":case"hh":case"H":case"HH":case"s":case"ss":case"X":case"x":t+=i;break;default:i.length>=2&&i.slice(0,1)==="["&&i.slice(-1)==="]"?t+=`'${i.slice(1,-1)}'`:t+=`'${i}'`}return t}function Ci(e,t,r){switch(r){case">":return e>t;case"<":return e<t;case">=":return e>=t;case"<=":return e<=t}return!1}function htt(e,t,r){if(e===null){if(t===null||t===Kd)return Ci(null,null,r);if(Yl(t))return Ci(0,t,r);if(Co(t)||Xl(t))return Ci(0,jn(t),r);if(ll(t))return Ci(0,t.getTime(),r)}if(e===Kd){if(t===null||t===Kd)return Ci(null,null,r);if(Yl(t))return Ci(0,t,r);if(Co(t)||Xl(t))return Ci(0,jn(t),r);if(ll(t))return Ci(0,t.getTime(),r)}else if(Yl(e)){if(Yl(t))return Ci(e,t,r);if(Xl(t))return Ci(e,jn(t),r);if(t===null||t===Kd)return Ci(e,0,r);if(Co(t))return Ci(e,jn(t),r);if(ll(t))return Ci(e,t.getTime(),r)}else if(Co(e)){if(Co(t))return Ci(Iv(e),Iv(t),r);if(ll(t))return Ci(jn(e),t.getTime(),r);if(Yl(t))return Ci(jn(e),t,r);if(t===null||t===Kd)return Ci(jn(e),0,r);if(Xl(t))return Ci(jn(e),jn(t),r)}else if(ll(e)){if(ll(t))return Ci(e,t,r);if(t===null||t===Kd)return Ci(e.getTime(),0,r);if(Yl(t))return Ci(e.getTime(),t,r);if(Xl(t)||Co(t))return Ci(e.getTime(),jn(t),r)}else if(Xl(e)){if(Xl(t))return Ci(e,t,r);if(Yl(t))return Ci(jn(e),jn(t),r);if(ll(t))return Ci(jn(e),t.getTime(),r);if(t===null||t===Kd)return Ci(jn(e),0,r);if(Co(t))return Ci(jn(e),jn(t),r)}return!!t6e(e,t)&&(r==="<="||r===">=")}function t6e(e,t){if(e===t||e===null&&t===Kd||t===null&&e===Kd)return!0;if(ll(e)&&ll(t))return e.getTime()===t.getTime();if(e instanceof Zie||e instanceof Ox)return e.equalityTest(t);if(e instanceof ot&&t instanceof ot){const r=e.cache._arcadeCacheId,i=t.cache._arcadeCacheId;if(r!=null)return r===i}return e!==void 0&&t!==void 0&&e!==null&&t!==null&&typeof e=="object"&&typeof t=="object"&&(e._arcadeCacheId===t._arcadeCacheId&&e._arcadeCacheId!==void 0&&e._arcadeCacheId!==null||e._underlyingGraphic===t._underlyingGraphic&&e._underlyingGraphic!==void 0&&e._underlyingGraphic!==null)}function Iv(e,t){if(Co(e))return e;if(e===null)return"";if(Yl(e))return lne(e,t);if(Xl(e))return e.toString();if(ll(e))return mz(e,t);if(e instanceof fd)return JSON.stringify(e.toJSON());if(Qh(e)){const r=[];for(let i=0;i<e.length;i++)r[i]=CN(e[i]);return"["+r.join(",")+"]"}if(e instanceof Pm){const r=[];for(let i=0;i<e.length();i++)r[i]=CN(e.get(i));return"["+r.join(",")+"]"}return e!==null&&typeof e=="object"&&e.castToText!==void 0?e.castToText():one(e)?"object, Function":""}function ftt(e){const t=[];if(Qh(e)===!1)return null;if(e instanceof Pm){for(let r=0;r<e.length();r++)t[r]=jn(e.get(r));return t}for(let r=0;r<e.length;r++)t[r]=jn(e[r]);return t}function EL(e,t){if(Co(e))return e;if(e===null)return"";if(Yl(e))return lne(e,t);if(Xl(e))return e.toString();if(ll(e))return mz(e,t);if(e instanceof fd)return e instanceof Zt?'{"xmin":'+e.xmin.toString()+',"ymin":'+e.ymin.toString()+","+(e.hasZ?'"zmin":'+e.zmin.toString()+",":"")+(e.hasM?'"mmin":'+e.mmin.toString()+",":"")+'"xmax":'+e.xmax.toString()+',"ymax":'+e.ymax.toString()+","+(e.hasZ?'"zmax":'+e.zmax.toString()+",":"")+(e.hasM?'"mmax":'+e.mmax.toString()+",":"")+'"spatialReference":'+aQ(e.spatialReference)+"}":aQ(e.toJSON(),(r,i)=>r.key===i.key?0:r.key==="spatialReference"?1:i.key==="spatialReference"||r.key<i.key?-1:r.key>i.key?1:0);if(Qh(e)){const r=[];for(let i=0;i<e.length;i++)r[i]=CN(e[i]);return"["+r.join(",")+"]"}if(e instanceof Pm){const r=[];for(let i=0;i<e.length();i++)r[i]=CN(e.get(i));return"["+r.join(",")+"]"}return e!==null&&typeof e=="object"&&e.castToText!==void 0?e.castToText():one(e)?"object, Function":""}function CN(e){if(e===null)return"null";if(Xl(e)||Yl(e)||Co(e))return JSON.stringify(e);if(e instanceof fd||e instanceof Pm||e instanceof Array)return EL(e);if(e instanceof Date)return JSON.stringify(mz(e,""));if(e!==null&&typeof e=="object"){if(e.castToText!==void 0)return e.castToText()}else if(e===Kd)return"null";return"null"}function jn(e,t){return Yl(e)?e:e===null||e===""?0:ll(e)?NaN:Xl(e)?e?1:0:Qh(e)||e===""||e===void 0?NaN:t!==void 0&&Co(e)?(t=CA(t,"\u2030",""),t=CA(t,"\xA4",""),Xet(e,{pattern:t})):e===Kd?0:Number(e)}function ptt(e){if(ll(e))return e;if(Co(e)){const t=r6e(e);if(t)return t.toJSDate()}return null}function mtt(e){return ll(e)?ar.fromJSDate(e):Co(e)?r6e(e):null}function r6e(e){const t=/ (\d\d)/;let r=ar.fromISO(e);return r.isValid||t.test(e)&&(e=e.replace(t,"T$1"),r=ar.fromISO(e),r.isValid)?r:null}function gtt(e){return Xl(e)?e:Co(e)?(e=e.toLowerCase())==="true":!!Yl(e)&&e!==0&&!isNaN(e)}function ytt(e,t){return R(e)?null:(e.spatialReference!==null&&e.spatialReference!==void 0||(e.spatialReference=t),e)}function btt(e){if(e===null)return null;if(e instanceof ot)return e.x==="NaN"||e.x===null||isNaN(e.x)?null:e;if(e instanceof $o){if(e.rings.length===0)return null;for(const t of e.rings)if(t.length>0)return e;return null}if(e instanceof uu){if(e.paths.length===0)return null;for(const t of e.paths)if(t.length>0)return e;return null}return e instanceof gx?e.points.length===0?null:e:e instanceof Zt?e.xmin==="NaN"||e.xmin===null||isNaN(e.xmin)?null:e:null}function i6e(e,t){if(!e||!e.domain)return t;let r=null;if(e.field.type==="string"||e.field.type==="esriFieldTypeString")t=Iv(t);else{if(t==null)return null;if(t==="")return t;t=jn(t)}for(let i=0;i<e.domain.codedValues.length;i++){const n=e.domain.codedValues[i];n.code===t&&(r=n)}return r===null?t:r.name}function n6e(e,t){if(!e||!e.domain)return t;let r=null;t=Iv(t);for(let i=0;i<e.domain.codedValues.length;i++){const n=e.domain.codedValues[i];n.name===t&&(r=n)}return r===null?t:r.code}function gz(e,t,r=null,i=null){if(!t||!t.fields)return null;let n,s,a=null;for(let o=0;o<t.fields.length;o++){const l=t.fields[o];l.name.toLowerCase()===e.toString().toLowerCase()&&(a=l)}if(a===null)throw new Error("Field not found");return i===null&&r&&t.typeIdField&&(i=r.hasField(t.typeIdField)?r.field(t.typeIdField):null),i!=null&&t.types.some(function(o){return o.id===i&&(n=o.domains&&o.domains[a.name],n&&n.type==="inherited"&&(n=whe(a.name,t),s=!0),!0)}),s||n||(n=whe(e,t)),{field:a,domain:n}}function whe(e,t){let r;return t.fields.some(function(i){return i.name.toLowerCase()===e.toLowerCase()&&(r=i.domain),!!r}),r}function aQ(e,t){t||(t={}),typeof t=="function"&&(t={cmp:t});const r=typeof t.cycles=="boolean"&&t.cycles,i=t.cmp&&(n=t.cmp,function(a){return function(o,l){const c={key:o,value:a[o]},u={key:l,value:a[l]};return n(c,u)}});var n;const s=[];return function a(o){if(o&&o.toJSON&&typeof o.toJSON=="function"&&(o=o.toJSON()),o===void 0)return;if(typeof o=="number")return isFinite(o)?""+o:"null";if(typeof o!="object")return JSON.stringify(o);let l,c;if(Array.isArray(o)){for(c="[",l=0;l<o.length;l++)l&&(c+=","),c+=a(o[l])||"null";return c+"]"}if(o===null)return"null";if(s.includes(o)){if(r)return JSON.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}const u=s.push(o)-1,h=Object.keys(o).sort(i&&i(o));for(c="",l=0;l<h.length;l++){const p=h[l],m=a(o[p]);m&&(c&&(c+=","),c+=JSON.stringify(p)+":"+m)}return s.splice(u,1),"{"+c+"}"}(e)}function vtt(e){if(e===null)return null;const t=[];for(const r of e)r&&r.arcadeDeclaredClass&&r.arcadeDeclaredClass==="esri.arcade.Feature"?t.push(r.geometry()):t.push(r);return t}function a9(e,t){if(!(t instanceof ot))throw new Error("Invalid Argument");e.push(t.hasZ?t.hasM?[t.x,t.y,t.z,t.m]:[t.x,t.y,t.z]:[t.x,t.y])}function _tt(e,t){if(Qh(e)||Gw(e)){let r=!1,i=!1,n=[],s=t;if(Qh(e)){for(const a of e)a9(n,a);n.length>0&&(s=e[0].spatialReference,r=e[0].hasZ,i=e[0].hasM)}else if(e instanceof Ox)n=e._elements,n.length>0&&(r=e._hasZ,i=e._hasM,s=e.get(0).spatialReference);else{if(!Gw(e))throw new Error("Invalid Argument");for(const a of e.toArray())a9(n,a);n.length>0&&(s=e.get(0).spatialReference,r=e.get(0).hasZ===!0,i=e.get(0).hasM===!0)}return n.length===0?null:(fre(n,i,r)===!1&&(n=n.slice(0).reverse()),new $o({rings:[n],spatialReference:s,hasZ:r,hasM:i}))}return e}function wtt(e,t){if(Qh(e)||Gw(e)){let r=!1,i=!1,n=[],s=t;if(Qh(e)){for(const a of e)a9(n,a);n.length>0&&(s=e[0].spatialReference,r=e[0].hasZ===!0,i=e[0].hasM===!0)}else if(e instanceof Ox)n=e._elements,n.length>0&&(r=e._hasZ,i=e._hasM,s=e.get(0).spatialReference);else if(Gw(e)){for(const a of e.toArray())a9(n,a);n.length>0&&(s=e.get(0).spatialReference,r=e.get(0).hasZ===!0,i=e.get(0).hasM===!0)}return n.length===0?null:new uu({paths:[n],spatialReference:s,hasZ:r,hasM:i})}return e}function xtt(e,t){if(Qh(e)||Gw(e)){let r=!1,i=!1,n=[],s=t;if(Qh(e)){for(const a of e)a9(n,a);n.length>0&&(s=e[0].spatialReference,r=e[0].hasZ===!0,i=e[0].hasM===!0)}else if(e instanceof Ox)n=e._elements,n.length>0&&(r=e._hasZ,i=e._hasM,s=e.get(0).spatialReference);else if(Gw(e)){for(const a of e.toArray())a9(n,a);n.length>0&&(s=e.get(0).spatialReference,r=e.get(0).hasZ===!0,i=e.get(0).hasM===!0)}return n.length===0?null:new gx({points:n,spatialReference:s,hasZ:r,hasM:i})}return e}function Ttt(e,t=!1){const r=[];if(e===null)return r;if(Qh(e)===!0){for(let i=0;i<e.length;i++){const n=Iv(e[i]);n===""&&t!==!0||r.push(n)}return r}if(e instanceof Pm){for(let i=0;i<e.length();i++){const n=Iv(e.get(i));n===""&&t!==!0||r.push(n)}return r}if(EN(e)){const i=Iv(e);return i===""&&t!==!0||r.push(i),r}return[]}let YG=0;function Stt(e){return YG++,YG%100==0?(YG=0,new Promise(t=>{setTimeout(()=>{t(e)},0)})):e}function Ett(e,t,r){switch(r){case"&":return e&t;case"|":return e|t;case"^":return e^t;case"<<":return e<<t;case">>":return e>>t;case">>>":return e>>>t}}function AA(e,t=null){return e==null?null:Xl(e)||Yl(e)||Co(e)?e:e instanceof fd?(t==null?void 0:t.keepGeometryType)===!0?e:e.toJSON():e instanceof Pm?e.toArray().map(r=>AA(r,t)):e instanceof Array?e.map(r=>AA(r,t)):e instanceof Date?e:e!==null&&typeof e=="object"&&e.castAsJson!==void 0?e.castAsJson(t):null}async function Ctt(e,t,r,i,n){const s=await cne(e,t,r);n[i]=s}async function cne(e,t=null,r=null){if(e instanceof Pm&&(e=e.toArray()),e==null)return null;if(EN(e)||e instanceof fd||e instanceof Date)return AA(e,r);if(e instanceof Array){const i=[],n=[];for(const s of e)s===null||EN(s)||s instanceof fd||s instanceof Date?n.push(AA(s,r)):(n.push(null),i.push(Ctt(s,t,r,n.length-1,n)));return i.length>0&&await Promise.all(i),n}return e!==null&&typeof e=="object"&&e.castAsJsonAsync!==void 0?e.castAsJsonAsync(t,r):null}function Att(e,t,r){const i=e.fullSchema();return i===null||!i.fields?null:gz(t,i,e,r)}function Rtt(e){const t=e.fullSchema();return t===null?null:t.fields&&t.typeIdField?{subtypeField:t.typeIdField,subtypes:t.types?t.types.map(r=>({name:r.name,code:r.id})):[]}:null}function Ott(e,t,r,i){const n=e.fullSchema();if(n===null||!n.fields)return null;const s=gz(t,n,e,i);if(r===void 0)try{r=e.field(t)}catch{return null}return i6e(s,r)}function Mtt(e,t,r,i){const n=e.fullSchema();if(n===null||!n.fields)return null;if(r===void 0){try{r=e.field(t)}catch{return null}return r}return n6e(gz(t,n,e,i),r)}function Ptt(e){const t=e.fullSchema();if(t===null||!t.fields)return null;const r=[];for(const i of t.fields)r.push(Qet(i));return{objectIdField:t.objectIdField,globalIdField:t.globalIdField,geometryType:_he[t.geometryType]===void 0?"":_he[t.geometryType],fields:r}}const W$t=Object.freeze(Object.defineProperty({__proto__:null,ReturnResultE:J9e,ImplicitResultE:K9e,NativeFunctionE:sne,SizzleFunctionE:ane,NativeFunction:Jet,ImplicitResult:Ket,ReturnResult:ett,SizzleFunction:ttt,voidOperation:Kd,breakResult:rtt,continueResult:itt,multiReplace:CA,isFunctionParameter:one,isSimpleType:EN,defaultUndefined:ntt,isString:Co,isBoolean:Xl,isNumber:Yl,isInteger:stt,isArray:Qh,isFeature:att,isFeatureSet:ott,isFeatureSetCollection:ltt,isImmutableArray:Gw,isDate:ll,pcCheck:ctt,absRound:dtt,generateUUID:utt,formatNumber:lne,formatDate:mz,standardiseDateFormat:e6e,greaterThanLessThan:htt,equalityTest:t6e,toString:Iv,toNumberArray:ftt,toStringExplicit:EL,toNumber:jn,toDate:ptt,toDateTime:mtt,toBoolean:gtt,fixSpatialReference:ytt,fixNullGeometry:btt,getDomainValue:i6e,getDomainCode:n6e,getDomain:gz,stableStringify:aQ,autoCastFeatureToGeometry:vtt,autoCastArrayOfPointsToPolygon:_tt,autoCastArrayOfPointsToPolyline:wtt,autoCastArrayOfPointsToMultiPoint:xtt,toStringArray:Ttt,tick:Stt,binaryOperator:Ett,castAsJson:AA,castAsJsonAsync:cne,featureFullDomain:Att,featureSubtypes:Rtt,featureDomainValueLookup:Ott,featureDomainCodeLookup:Mtt,featureSchema:Ptt},Symbol.toStringTag,{value:"Module"}));var oQ;let VE=oQ=class extends ge{constructor(e){super(e),this.minValue=0,this.maxValue=0}clone(){return new oQ({minValue:this.minValue,maxValue:this.maxValue})}};d([f({type:Number,json:{write:!0}})],VE.prototype,"minValue",void 0),d([f({type:Number,json:{write:!0}})],VE.prototype,"maxValue",void 0),VE=oQ=d([$("esri.renderer.support.AuthoringInfoClassBreakInfo")],VE);var lQ;let D1=lQ=class extends ge{constructor(e){super(e),this.field="",this.normalizationField="",this.label="",this.classBreakInfos=[]}clone(){return new lQ({field:this.field,normalizationField:this.normalizationField,label:this.label,classBreakInfos:te(this.classBreakInfos)})}};d([f({type:String,json:{write:!0}})],D1.prototype,"field",void 0),d([f({type:String,json:{write:!0}})],D1.prototype,"normalizationField",void 0),d([f({type:String,json:{write:!0}})],D1.prototype,"label",void 0),d([f({type:[VE],json:{write:!0}})],D1.prototype,"classBreakInfos",void 0),D1=lQ=d([$("esri.renderers.support.AuthoringInfoFieldInfo")],D1);var cQ;const rP=new tr({percentTotal:"percent-of-total",ratio:"ratio",percent:"percent"}),iP=new tr({sizeInfo:"size",colorInfo:"color",transparencyInfo:"opacity",rotationInfo:"rotation"}),xhe={key:e=>typeof e=="number"?"number":"string",typeMap:{number:Number,string:String},base:null},The=["high-to-low","above-and-below","centered-on","extremes"],She=[...new Set(["high-to-low","above-and-below","centered-on","extremes","90-10","above","below","high-to-low","above-and-below","90-10","above","below"])],Ehe=["seconds","minutes","hours","days","months","years"];let Ic=cQ=class extends ge{constructor(e){super(e),this.endTime=null,this.field=null,this.maxSliderValue=null,this.minSliderValue=null,this.startTime=null,this.type=null,this.units=null}castEndTime(e){return typeof e=="string"||typeof e=="number"?e:null}castStartTime(e){return typeof e=="string"||typeof e=="number"?e:null}get style(){return this.type==="color"?this._get("style"):null}set style(e){this._set("style",e)}get theme(){return this.type==="color"||this.type==="size"?this._get("theme")||"high-to-low":null}set theme(e){this._set("theme",e)}clone(){return new cQ({endTime:this.endTime,field:this.field,maxSliderValue:this.maxSliderValue,minSliderValue:this.minSliderValue,startTime:this.startTime,style:this.style,theme:this.theme,type:this.type,units:this.units})}};d([f({types:xhe,json:{write:!0}})],Ic.prototype,"endTime",void 0),d([Xt("endTime")],Ic.prototype,"castEndTime",null),d([f({type:String,json:{write:!0}})],Ic.prototype,"field",void 0),d([f({type:Number,json:{write:!0}})],Ic.prototype,"maxSliderValue",void 0),d([f({type:Number,json:{write:!0}})],Ic.prototype,"minSliderValue",void 0),d([f({types:xhe,json:{write:!0}})],Ic.prototype,"startTime",void 0),d([Xt("startTime")],Ic.prototype,"castStartTime",null),d([f({type:rP.apiValues,value:null,json:{type:rP.jsonValues,read:rP.read,write:rP.write}})],Ic.prototype,"style",null),d([f({type:She,value:null,json:{type:She,origins:{"web-scene":{type:The,write:{writer:(e,t)=>{The.includes(e)&&(t.theme=e)}}}},write:!0}})],Ic.prototype,"theme",null),d([f({type:iP.apiValues,json:{type:iP.jsonValues,read:iP.read,write:iP.write}})],Ic.prototype,"type",void 0),d([f({type:Ehe,json:{type:Ehe,write:!0}})],Ic.prototype,"units",void 0),Ic=cQ=d([$("esri.renderers.support.AuthoringInfoVisualVariable")],Ic);const Itt=Ic;let CL=class extends ge{constructor(e){super(e),this.type=null}};d([f({readOnly:!0,json:{read:!1,write:!0}})],CL.prototype,"type",void 0),CL=d([$("esri.rest.support.ColorRamp")],CL);const dne=CL;var dQ;let L2=dQ=class extends dne{constructor(e){super(e),this.algorithm=null,this.fromColor=null,this.toColor=null,this.type="algorithmic"}clone(){return new dQ({fromColor:te(this.fromColor),toColor:te(this.toColor),algorithm:this.algorithm})}};d([Ze({esriCIELabAlgorithm:"cie-lab",esriHSVAlgorithm:"hsv",esriLabLChAlgorithm:"lab-lch"})],L2.prototype,"algorithm",void 0),d([f({type:Te,json:{type:[$i],write:!0}})],L2.prototype,"fromColor",void 0),d([f({type:Te,json:{type:[$i],write:!0}})],L2.prototype,"toColor",void 0),d([f({type:["algorithmic"]})],L2.prototype,"type",void 0),L2=dQ=d([$("esri.rest.support.AlgorithmicColorRamp")],L2);const une=L2;var uQ;let zE=uQ=class extends dne{constructor(e){super(e),this.colorRamps=null,this.type="multipart"}clone(){return new uQ({colorRamps:te(this.colorRamps)})}};d([f({type:[une],json:{write:!0}})],zE.prototype,"colorRamps",void 0),d([f({type:["multipart"]})],zE.prototype,"type",void 0),zE=uQ=d([$("esri.rest.support.MultipartColorRamp")],zE);const s6e=zE,a6e={key:"type",base:dne,typeMap:{algorithmic:une,multipart:s6e}};function o6e(e){return e&&e.type?e.type==="algorithmic"?une.fromJSON(e):e.type==="multipart"?s6e.fromJSON(e):null:null}var hQ;const P_=new tr({esriClassifyDefinedInterval:"defined-interval",esriClassifyEqualInterval:"equal-interval",esriClassifyManual:"manual",esriClassifyNaturalBreaks:"natural-breaks",esriClassifyQuantile:"quantile",esriClassifyStandardDeviation:"standard-deviation"}),nP=new tr({pieChart:"pie-chart",classedSize:"class-breaks-size",classedColor:"class-breaks-color",univariateColorSize:"univariate-color-size",relationship:"relationship",predominance:"predominance",dotDensity:"dot-density",flow:"flow"}),Che=new tr({classedSize:"class-breaks-size",classedColor:"class-breaks-color",univariateColorSize:"univariate-color-size",relationship:"relationship",predominance:"predominance",dotDensity:"dot-density"}),Ahe=["inches","feet","yards","miles","nautical-miles","millimeters","centimeters","decimeters","meters","kilometers","decimal-degrees"],$tt=["high-to-low","above-and-below","above","below","90-10"],Ltt=["flow-line","wave-front"],Dtt=["caret","circle-caret","arrow","circle-arrow","plus-minus","circle-plus-minus","square","circle","triangle","happy-sad","thumb","custom"];let Ps=hQ=class extends ge{constructor(e){super(e),this.colorRamp=null,this.lengthUnit=null,this.maxSliderValue=null,this.minSliderValue=null,this.visualVariables=null}get classificationMethod(){const e=this._get("classificationMethod"),t=this.type;return t&&t!=="relationship"?t==="class-breaks-size"||t==="class-breaks-color"?e||"manual":null:e}set classificationMethod(e){this._set("classificationMethod",e)}readColorRamp(e){if(e)return o6e(e)}get fields(){return this.type&&this.type!=="predominance"?null:this._get("fields")}set fields(e){this._set("fields",e)}get field1(){return this.type&&this.type!=="relationship"?null:this._get("field1")}set field1(e){this._set("field1",e)}get field2(){return this.type&&this.type!=="relationship"?null:this._get("field2")}set field2(e){this._set("field2",e)}get flowTheme(){return this.type==="flow"?this._get("flowTheme"):null}set flowTheme(e){this._set("flowTheme",e)}get focus(){return this.type&&this.type!=="relationship"?null:this._get("focus")}set focus(e){this._set("focus",e)}get numClasses(){return this.type&&this.type!=="relationship"?null:this._get("numClasses")}set numClasses(e){this._set("numClasses",e)}get statistics(){return this.type==="univariate-color-size"&&this.univariateTheme==="above-and-below"?this._get("statistics"):null}set statistics(e){this._set("statistics",e)}get standardDeviationInterval(){const e=this.type;return e&&e!=="relationship"&&e!=="class-breaks-size"&&e!=="class-breaks-color"||this.classificationMethod&&this.classificationMethod!=="standard-deviation"?null:this._get("standardDeviationInterval")}set standardDeviationInterval(e){this._set("standardDeviationInterval",e)}get type(){return this._get("type")}set type(e){let t=e;e==="classed-size"?t="class-breaks-size":e==="classed-color"&&(t="class-breaks-color"),this._set("type",t)}get univariateSymbolStyle(){return this.type==="univariate-color-size"&&this.univariateTheme==="above-and-below"?this._get("univariateSymbolStyle"):null}set univariateSymbolStyle(e){this._set("univariateSymbolStyle",e)}get univariateTheme(){return this.type==="univariate-color-size"?this._get("univariateTheme"):null}set univariateTheme(e){this._set("univariateTheme",e)}clone(){return new hQ({classificationMethod:this.classificationMethod,colorRamp:te(this.colorRamp),fields:this.fields&&this.fields.slice(0),field1:te(this.field1),field2:te(this.field2),focus:this.focus,numClasses:this.numClasses,maxSliderValue:this.maxSliderValue,minSliderValue:this.minSliderValue,lengthUnit:this.lengthUnit,statistics:this.statistics,standardDeviationInterval:this.standardDeviationInterval,type:this.type,visualVariables:this.visualVariables&&this.visualVariables.map(e=>e.clone()),univariateSymbolStyle:this.univariateSymbolStyle,univariateTheme:this.univariateTheme,flowTheme:this.flowTheme})}};d([f({type:P_.apiValues,value:null,json:{type:P_.jsonValues,read:P_.read,write:P_.write,origins:{"web-document":{default:"manual",type:P_.jsonValues,read:P_.read,write:P_.write}}}})],Ps.prototype,"classificationMethod",null),d([f({types:a6e,json:{write:!0}})],Ps.prototype,"colorRamp",void 0),d([$e("colorRamp")],Ps.prototype,"readColorRamp",null),d([f({type:[String],value:null,json:{write:!0}})],Ps.prototype,"fields",null),d([f({type:D1,value:null,json:{write:!0}})],Ps.prototype,"field1",null),d([f({type:D1,value:null,json:{write:!0}})],Ps.prototype,"field2",null),d([f({type:Ltt,value:null,json:{write:!0,origins:{"web-scene":{write:!1}}}})],Ps.prototype,"flowTheme",null),d([f({type:["HH","HL","LH","LL"],value:null,json:{write:!0}})],Ps.prototype,"focus",null),d([f({type:Number,value:null,json:{type:$i,write:!0}})],Ps.prototype,"numClasses",null),d([f({type:Ahe,json:{type:Ahe,read:!1,write:!1,origins:{"web-scene":{read:!0,write:!0}}}})],Ps.prototype,"lengthUnit",void 0),d([f({type:Number,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],Ps.prototype,"maxSliderValue",void 0),d([f({type:Number,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],Ps.prototype,"minSliderValue",void 0),d([f({type:Object,value:null,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],Ps.prototype,"statistics",null),d([f({type:[.25,.33,.5,1],value:null,json:{type:[.25,.33,.5,1],write:!0}})],Ps.prototype,"standardDeviationInterval",null),d([f({type:nP.apiValues,value:null,json:{type:nP.jsonValues,read:nP.read,write:nP.write,origins:{"web-scene":{type:Che.jsonValues,write:{writer:Che.write,overridePolicy:e=>({enabled:e!=="flow"})}}}}})],Ps.prototype,"type",null),d([f({type:[Itt],json:{write:!0}})],Ps.prototype,"visualVariables",void 0),d([f({type:Dtt,value:null,json:{write:!0,origins:{"web-scene":{write:!1}}}})],Ps.prototype,"univariateSymbolStyle",null),d([f({type:$tt,value:null,json:{write:!0,origins:{"web-scene":{write:!1}}}})],Ps.prototype,"univariateTheme",null),Ps=hQ=d([$("esri.renderers.support.AuthoringInfo")],Ps);const l6e=Ps,ZG=new tr({simple:"simple",uniqueValue:"unique-value",classBreaks:"class-breaks",heatmap:"heatmap",dotDensity:"dot-density",dictionary:"dictionary",pieChart:"pie-chart"},{ignoreUnknown:!0});let UE=class extends ge{constructor(e){super(e),this.authoringInfo=null,this.type=null}async getRequiredFields(e){if(!this.collectRequiredFields)return[];const t=new Set;return await this.collectRequiredFields(t,e),Array.from(t).sort()}getSymbol(e,t){}async getSymbolAsync(e,t){}getSymbols(){return[]}getAttributeHash(){return JSON.stringify(this)}getMeshHash(){return JSON.stringify(this)}};d([f({type:l6e,json:{write:!0}})],UE.prototype,"authoringInfo",void 0),d([f({type:ZG.apiValues,readOnly:!0,json:{type:ZG.jsonValues,read:!1,write:{writer:ZG.write,ignoreOrigin:!0}}})],UE.prototype,"type",void 0),UE=d([$("esri.renderers.Renderer")],UE);const Hy=UE;var fQ;let nm=fQ=class extends ge{constructor(){super(...arguments),this.title=null}clone(){return new fQ({title:this.title})}};d([f({type:String,json:{write:!0}})],nm.prototype,"title",void 0),nm=fQ=d([$("esri.renderers.support.LegendOptions")],nm);var pQ;let AL=pQ=class extends nm{constructor(){super(...arguments),this.showLegend=null}clone(){return new pQ({title:this.title,showLegend:this.showLegend})}};d([f({type:Boolean,json:{write:!0}})],AL.prototype,"showLegend",void 0),AL=pQ=d([$("esri.renderers.visualVariables.support.VisualVariableLegendOptions")],AL);const c6e=AL,Ftt=fe.getLogger("esri.renderers.visualVariables.VisualVariable"),QG=new tr({colorInfo:"color",transparencyInfo:"opacity",rotationInfo:"rotation",sizeInfo:"size"});let If=class extends ge{constructor(e){super(e),this.index=null,this.type=null,this.field=null,this.valueExpression=null,this.valueExpressionTitle=null,this.legendOptions=null}castField(e){return e==null?e:typeof e=="function"?(Ftt.error(".field: field must be a string value"),null):WR(e)}get arcadeRequired(){return!!this.valueExpression}clone(){}getAttributeHash(){return`${this.type}-${this.field}-${this.valueExpression}`}};d([f()],If.prototype,"index",void 0),d([f({type:QG.apiValues,readOnly:!0,json:{read:QG.read,write:QG.write}})],If.prototype,"type",void 0),d([f({type:String,json:{write:!0}})],If.prototype,"field",void 0),d([Xt("field")],If.prototype,"castField",null),d([f({type:String,json:{write:!0}})],If.prototype,"valueExpression",void 0),d([f({type:String,json:{write:!0}})],If.prototype,"valueExpressionTitle",void 0),d([f({readOnly:!0})],If.prototype,"arcadeRequired",null),d([f({type:c6e,json:{write:!0}})],If.prototype,"legendOptions",void 0),If=d([$("esri.renderers.visualVariables.VisualVariable")],If);const uO=If;var mQ;let D2=mQ=class extends uO{constructor(e){super(e),this.type="color",this.normalizationField=null}get cache(){return{ipData:this._interpolateData(),hasExpression:!!this.valueExpression,compiledFunc:null}}set stops(e){e&&Array.isArray(e)&&(e=e.filter(t=>!!t)).sort((t,r)=>t.value-r.value),this._set("stops",e)}clone(){return new mQ({field:this.field,normalizationField:this.normalizationField,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,stops:this.stops&&this.stops.map(e=>e.clone()),legendOptions:this.legendOptions&&this.legendOptions.clone()})}getAttributeHash(){return`${super.getAttributeHash()}-${this.normalizationField}`}_interpolateData(){return this.stops&&this.stops.map(e=>e.value||0)}};d([f({readOnly:!0})],D2.prototype,"cache",null),d([f({type:["color"],json:{type:["colorInfo"]}})],D2.prototype,"type",void 0),d([f({type:String,json:{write:!0}})],D2.prototype,"normalizationField",void 0),d([f({type:[r5e],json:{write:!0}})],D2.prototype,"stops",null),D2=mQ=d([$("esri.renderers.visualVariables.ColorVariable")],D2);const d6e=D2;var gQ;let i1=gQ=class extends ge{constructor(e){super(e),this.label=null,this.opacity=null,this.value=null}readOpacity(e,t){return F5(t.transparency)}writeOpacity(e,t,r){t[r]=gV(e)}clone(){return new gQ({label:this.label,opacity:this.opacity,value:this.value})}};d([f({type:String,json:{write:!0}})],i1.prototype,"label",void 0),d([f({type:Number,json:{type:$i,write:{target:"transparency"}}})],i1.prototype,"opacity",void 0),d([$e("opacity",["transparency"])],i1.prototype,"readOpacity",null),d([Xe("opacity")],i1.prototype,"writeOpacity",null),d([f({type:Number,json:{write:!0}})],i1.prototype,"value",void 0),i1=gQ=d([$("esri.renderers.visualVariables.support.OpacityStop")],i1);const Ntt=i1;var yQ;let F2=yQ=class extends uO{constructor(e){super(e),this.type="opacity",this.normalizationField=null}get cache(){return{ipData:this._interpolateData(),hasExpression:!!this.valueExpression,compiledFunc:null}}set stops(e){e&&Array.isArray(e)&&(e=e.filter(t=>!!t)).sort((t,r)=>t.value-r.value),this._set("stops",e)}clone(){return new yQ({field:this.field,normalizationField:this.normalizationField,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,stops:this.stops&&this.stops.map(e=>e.clone()),legendOptions:this.legendOptions&&this.legendOptions.clone()})}getAttributeHash(){return`${super.getAttributeHash()}-${this.normalizationField}`}_interpolateData(){return this.stops&&this.stops.map(e=>e.value||0)}};d([f({readOnly:!0})],F2.prototype,"cache",null),d([f({type:["opacity"],json:{type:["transparencyInfo"]}})],F2.prototype,"type",void 0),d([f({type:String,json:{write:!0}})],F2.prototype,"normalizationField",void 0),d([f({type:[Ntt],json:{write:!0}})],F2.prototype,"stops",null),F2=yQ=d([$("esri.renderers.visualVariables.OpacityVariable")],F2);const u6e=F2;var bQ;let dg=bQ=class extends uO{constructor(e){super(e),this.axis=null,this.type="rotation",this.rotationType="geographic",this.valueExpressionTitle=null}get cache(){return{hasExpression:!!this.valueExpression,compiledFunc:null}}writeValueExpressionTitleWebScene(e,t,r,i){if(i&&i.messages){const n=`visualVariables[${this.index}]`;i.messages.push(new k("property:unsupported",this.type+"VisualVariable.valueExpressionTitle is not supported in Web Scene. Please remove this property to save the Web Scene.",{instance:this,propertyName:n+".valueExpressionTitle",context:i}))}}clone(){return new bQ({axis:this.axis,rotationType:this.rotationType,field:this.field,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,legendOptions:this.legendOptions&&this.legendOptions.clone()})}};d([f({readOnly:!0})],dg.prototype,"cache",null),d([f({type:["heading","tilt","roll"],json:{origins:{"web-scene":{default:"heading",write:!0}}}})],dg.prototype,"axis",void 0),d([f({type:["rotation"],json:{type:["rotationInfo"]}})],dg.prototype,"type",void 0),d([f({type:["geographic","arithmetic"],json:{write:!0,origins:{"web-document":{write:!0,default:"geographic"}}}})],dg.prototype,"rotationType",void 0),d([f({type:String,json:{write:!0}})],dg.prototype,"valueExpressionTitle",void 0),d([Xe("web-scene","valueExpressionTitle")],dg.prototype,"writeValueExpressionTitleWebScene",null),dg=bQ=d([$("esri.renderers.visualVariables.RotationVariable")],dg);const h6e=dg;var vQ;let pS=vQ=class extends ge{constructor(e){super(e),this.label=null,this.size=null,this.value=null}clone(){return new vQ({label:this.label,size:this.size,value:this.value})}};d([f({type:String,json:{write:!0}})],pS.prototype,"label",void 0),d([f({type:Number,cast:Xr,json:{write:!0}})],pS.prototype,"size",void 0),d([f({type:Number,json:{write:!0}})],pS.prototype,"value",void 0),pS=vQ=d([$("esri.renderers.visualVariables.support.SizeStop")],pS);const ktt=pS;var _Q;let RL=_Q=class extends c6e{constructor(){super(...arguments),this.customValues=null}clone(){return new _Q({title:this.title,showLegend:this.showLegend,customValues:this.customValues&&this.customValues.slice(0)})}};d([f({type:[Number],json:{write:!0}})],RL.prototype,"customValues",void 0),RL=_Q=d([$("esri.renderers.visualVariables.support.SizeVariableLegendOptions")],RL);const f6e=RL;var dy,Aa;function p4(e){return e&&e.declaredClass==="esri.renderers.visualVariables.SizeVariable"}function RA(e){return e!=null&&!isNaN(e)&&isFinite(e)}function p6e(e){return e.valueExpression?dy.Expression:e.field&&typeof e.field=="string"?dy.Field:dy.Unknown}function Vtt(e,t){const r=t||p6e(e),i=e.valueUnit||"unknown";return r===dy.Unknown?Aa.Constant:e.stops?Aa.Stops:e.minSize!=null&&e.maxSize!=null&&e.minDataValue!=null&&e.maxDataValue!=null?Aa.ClampedLinear:i==="unknown"?e.minSize!=null&&e.minDataValue!=null?e.minSize&&e.minDataValue?Aa.Proportional:Aa.Additive:Aa.Identity:Aa.RealWorldSize}(function(e){e.Unknown="unknown",e.Expression="expression",e.Field="field"})(dy||(dy={})),function(e){e.Unknown="unknown",e.Stops="stops",e.ClampedLinear="clamped-linear",e.Proportional="proportional",e.Additive="additive",e.Constant="constant",e.Identity="identity",e.RealWorldSize="real-world-size"}(Aa||(Aa={}));const o9={inches:ps(1,"meters","inches"),feet:ps(1,"meters","feet"),"us-feet":ps(1,"meters","us-feet"),yards:ps(1,"meters","yards"),miles:ps(1,"meters","miles"),"nautical-miles":ps(1,"meters","nautical-miles"),millimeters:ps(1,"meters","millimeters"),centimeters:ps(1,"meters","centimeters"),decimeters:ps(1,"meters","decimeters"),meters:ps(1,"meters","meters"),kilometers:ps(1,"meters","kilometers"),"decimal-degrees":1/GGe(1,"meters",$r.radius)},Qv=fe.getLogger("esri.renderers.visualVariables.support.visualVariableUtils"),Rhe=new co,OL=Math.PI,m6e=/^\s*(return\s+)?\$view\.scale\s*(;)?\s*$/i;function g6e(e,t,r){const i="visualVariables"in e&&e.visualVariables?e.visualVariables.find(g=>g.type==="color"):e;if(!i)return;if(i.declaredClass!=="esri.renderers.visualVariables.ColorVariable")return void Qv.warn("The visualVariable should be an instance of esri.renderers.visualVariables.ColorVariable");const n=typeof t=="number",s=n?null:t,a=s&&s.attributes;let o=n?t:null;const l=i.field,{ipData:c,hasExpression:u}=i.cache;let h=i.cache.compiledFunc;if(!l&&!u){const g=i.stops;return g&&g[0]&&g[0].color}if(typeof o!="number")if(u){if(R(r)||R(r.arcade))return void Qv.error("Use of arcade expressions requires an arcade context");const g={viewingMode:r.viewingMode,scale:r.scale,spatialReference:r.spatialReference},b=r.arcade.arcadeUtils,w=b.getViewInfo(g),v=b.createExecContext(s,w);if(!h){const x=b.createSyntaxTree(i.valueExpression);h=b.createFunction(x),i.cache.compiledFunc=h}o=b.executeFunction(h,v)}else a&&(o=a[l]);const p=i.normalizationField,m=a?parseFloat(a[p]):void 0;if(o!=null&&(!p||n||!isNaN(m)&&m!==0)){isNaN(m)||n||(o/=m);const g=fne(o,c);if(g){const b=g[0],w=g[1],v=b===w?i.stops[b].color:Te.blendColors(i.stops[b].color,i.stops[w].color,g[2],_(r)?r.color:void 0);return new Te(v)}}}function y6e(e,t,r){const i="visualVariables"in e&&e.visualVariables?e.visualVariables.find(g=>g.type==="opacity"):e;if(!i)return;if(i.declaredClass!=="esri.renderers.visualVariables.OpacityVariable")return void Qv.warn("The visualVariable should be an instance of esri.renderers.visualVariables.OpacityVariable");const n=typeof t=="number",s=n?null:t,a=s&&s.attributes;let o=n?t:null;const l=i.field,{ipData:c,hasExpression:u}=i.cache;let h=i.cache.compiledFunc;if(!l&&!u){const g=i.stops;return g&&g[0]&&g[0].opacity}if(typeof o!="number")if(u){if(R(r)||R(r.arcade))return void Qv.error("Use of arcade expressions requires an arcade context");const g={viewingMode:r.viewingMode,scale:r.scale,spatialReference:r.spatialReference},b=r.arcade.arcadeUtils,w=b.getViewInfo(g),v=b.createExecContext(s,w);if(!h){const x=b.createSyntaxTree(i.valueExpression);h=b.createFunction(x),i.cache.compiledFunc=h}o=b.executeFunction(h,v)}else a&&(o=a[l]);const p=i.normalizationField,m=a?parseFloat(a[p]):void 0;if(o!=null&&(!p||n||!isNaN(m)&&m!==0)){isNaN(m)||n||(o/=m);const g=fne(o,c);if(g){const b=g[0],w=g[1];if(b===w)return i.stops[b].opacity;{const v=i.stops[b].opacity;return v+(i.stops[w].opacity-v)*g[2]}}}}function b6e(e,t,r){const i="visualVariables"in e&&e.visualVariables?e.visualVariables.find(m=>m.type==="rotation"):e;if(!i)return;if(i.declaredClass!=="esri.renderers.visualVariables.RotationVariable")return void Qv.warn("The visualVariable should be an instance of esri.renderers.visualVariables.RotationVariable");const n=i.axis||"heading",s=n==="heading"&&i.rotationType==="arithmetic"?90:0,a=n==="heading"&&i.rotationType==="arithmetic"?-1:1,o=typeof t=="number"?null:t,l=o&&o.attributes,c=i.field,{hasExpression:u}=i.cache;let h=i.cache.compiledFunc,p=0;if(!c&&!u)return p;if(u){if(R(r)||R(r.arcade))return void Qv.error("Use of arcade expressions requires an arcade context");const m={viewingMode:r.viewingMode,scale:r.scale,spatialReference:r.spatialReference},g=r.arcade.arcadeUtils,b=g.getViewInfo(m),w=g.createExecContext(o,b);if(!h){const v=g.createSyntaxTree(i.valueExpression);h=g.createFunction(v),i.cache.compiledFunc=h}p=g.executeFunction(h,w)}else l&&(p=l[c]||0);return p=typeof p!="number"||isNaN(p)?null:s+a*p,p}function ztt(e,t,r){const i=typeof t=="number",n=i?null:t,s=n&&n.attributes;let a=i?t:null;const{isScaleDriven:o}=e.cache;let l=e.cache.compiledFunc;if(o){const u=_(r)?r.scale:void 0,h=_(r)?r.view:void 0;a=u==null||h==="3d"?Utt(e):u}else if(!i)switch(e.inputValueType){case dy.Expression:{if(R(r)||R(r.arcade))return void Qv.error("Use of arcade expressions requires an arcade context");const u={viewingMode:r.viewingMode,scale:r.scale,spatialReference:r.spatialReference},h=r.arcade.arcadeUtils,p=h.getViewInfo(u),m=h.createExecContext(n,p);if(!l){const g=h.createSyntaxTree(e.valueExpression);l=h.createFunction(g),e.cache.compiledFunc=l}a=h.executeFunction(l,m);break}case dy.Field:s&&(a=s[e.field]);break;case dy.Unknown:a=null}if(!RA(a))return null;if(i||!e.normalizationField)return a;const c=s?parseFloat(s[e.normalizationField]):null;return RA(c)&&c!==0?a/c:null}function Utt(e){let t=null,r=null;const i=e.stops;return i?(t=i[0].value,r=i[i.length-1].value):(t=e.minDataValue||0,r=e.maxDataValue||0),(t+r)/2}function yz(e,t,r){const i="visualVariables"in e&&e.visualVariables?e.visualVariables.find(s=>s.type==="size"):e;if(!i)return;if(i.declaredClass!=="esri.renderers.visualVariables.SizeVariable")return void Qv.warn("The visualVariable should be an instance of esri.renderers.visualVariables.SizeVariable");const n=_6e(ztt(i,t,r),i,t,r,i.cache.ipData);return n==null||isNaN(n)?0:n}function dd(e,t,r){return e==null?null:p4(e)?yz(e,t,r):RA(e)?e:null}function v6e(e,t,r){return RA(r)&&e>r?r:RA(t)&&e<t?t:e}function Btt(e,t,r,i){return e+(dd(t.minSize,r,i)||t.minDataValue)}function Gtt(e,t,r){const i=e.stops;let n=i&&i.length&&i[0].size;return n==null&&(n=e.minSize),dd(n,t,r)}function jtt(e,t,r,i){const n=(e-t.minDataValue)/(t.maxDataValue-t.minDataValue),s=dd(t.minSize,r,i),a=dd(t.maxSize,r,i),o=_(i)?i.shape:void 0;if(e<=t.minDataValue)return s;if(e>=t.maxDataValue)return a;if(t.scaleBy==="area"&&o){const l=o==="circle",c=l?OL*(s/2)**2:s*s,u=c+n*((l?OL*(a/2)**2:a*a)-c);return l?2*Math.sqrt(u/OL):Math.sqrt(u)}return s+n*(a-s)}function qtt(e,t,r,i){const n=_(i)?i.shape:void 0,s=e/t.minDataValue,a=dd(t.minSize,r,i),o=dd(t.maxSize,r,i);let l=null;return l=n==="circle"?2*Math.sqrt(s*(a/2)**2):n==="square"||n==="diamond"||n==="image"?Math.sqrt(s*a**2):s*a,v6e(l,a,o)}function Htt(e,t,r,i,n){const[s,a,o]=fne(e,n);if(s===a)return dd(t.stops[s].size,r,i);{const l=dd(t.stops[s].size,r,i);return l+(dd(t.stops[a].size,r,i)-l)*o}}function Wtt(e,t,r,i){const n=(_(i)&&i.resolution?i.resolution:1)*o9[t.valueUnit],s=dd(t.minSize,r,i),a=dd(t.maxSize,r,i),{valueRepresentation:o}=t;let l=null;return l=o==="area"?2*Math.sqrt(e/OL)/n:o==="radius"||o==="distance"?2*e/n:e/n,v6e(l,s,a)}function _6e(e,t,r,i,n){switch(t.transformationType){case Aa.Additive:return Btt(e,t,r,i);case Aa.Constant:return Gtt(t,r,i);case Aa.ClampedLinear:return jtt(e,t,r,i);case Aa.Proportional:return qtt(e,t,r,i);case Aa.Stops:return Htt(e,t,r,i,n);case Aa.RealWorldSize:return Wtt(e,t,r,i);case Aa.Identity:return e;case Aa.Unknown:return null}}function Xtt(e,t,r){const{isScaleDriven:i}=e.cache;if(!(i&&r==="3d"||t))return null;const n={scale:t,view:r};let s=dd(e.minSize,Rhe,n),a=dd(e.maxSize,Rhe,n);if(s!=null||a!=null){if(s>a){const o=a;a=s,s=o}return{minSize:s,maxSize:a}}}function hne(e,t,r){if(!e.visualVariables)return;const i=[],n=[],s=[],a=[],o=[];for(const l of e.visualVariables)switch(l.type){case"color":n.push(l);break;case"opacity":s.push(l);break;case"rotation":o.push(l);break;case"size":a.push(l)}return n.forEach(l=>{const c=g6e(l,t,r);i.push({variable:l,value:c})}),s.forEach(l=>{const c=y6e(l,t,r);i.push({variable:l,value:c})}),o.forEach(l=>{const c=b6e(l,t,r);i.push({variable:l,value:c})}),a.forEach(l=>{const c=yz(l,t,r);i.push({variable:l,value:c})}),i.filter(l=>l.value!=null)}function fne(e,t){if(!t)return;let r=0,i=t.length-1;return t.some((n,s)=>e<n?(i=s,!0):(r=s,!1)),[r,i,(e-t[r])/(t[i]-t[r])]}function Ytt(e,t,r){const i=["proportional","proportional","proportional"];for(const n of e){const s=n.useSymbolValue?"symbol-value":yz(n,t,r);switch(n.axis){case"width":i[0]=s;break;case"depth":i[1]=s;break;case"height":i[2]=s;break;case"width-and-depth":i[0]=s,i[1]=s;break;case"all":case void 0:case null:i[0]=s,i[1]=s,i[2]=s;break;default:n.axis}}return i}const Px=Object.freeze(Object.defineProperty({__proto__:null,getAllSizes:Ytt,getColor:g6e,getOpacity:y6e,getRotationAngle:b6e,getSize:yz,getSizeForValue:_6e,getSizeFromNumberOrVariable:dd,getSizeRangeAtScale:Xtt,getVisualVariableValues:hne,viewScaleRE:m6e},Symbol.toStringTag,{value:"Module"}));var wQ;const jx=fe.getLogger("esri.renderers.visualVariables.SizeVariable"),sP=new tr({width:"width",depth:"depth",height:"height",widthAndDepth:"width-and-depth",all:"all"}),xQ=new tr({unknown:"unknown",inch:"inches",foot:"feet",yard:"yards",mile:"miles","nautical-mile":"nautical-miles",millimeter:"millimeters",centimeter:"centimeters",decimeter:"decimeters",meter:"meters",kilometer:"kilometers","decimal-degree":"decimal-degrees"});function Ohe(e){if(e!=null)return typeof e=="string"||typeof e=="number"?Xr(e):e.type==="size"?p4(e)?e:(delete(e={...e}).type,new oi(e)):void 0}function Mhe(e,t,r){if(typeof e!="object")return e;const i=new oi;return i.read(e,r),i}let oi=wQ=class extends uO{constructor(e){super(e),this.axis=null,this.legendOptions=null,this.normalizationField=null,this.scaleBy=null,this.target=null,this.type="size",this.useSymbolValue=null,this.valueExpression=null,this.valueRepresentation=null,this.valueUnit=null}get cache(){return{ipData:this._interpolateData(),hasExpression:!!this.valueExpression,compiledFunc:null,isScaleDriven:m6e.test(this.valueExpression)}}set expression(e){jx.warn("'expression' is deprecated since version 4.2. Use 'valueExpression' instead. The only supported expression is 'view.scale'."),e==="view.scale"?(this.valueExpression="$view.scale",this._set("expression",e)):this._set("expression",null)}set index(e){p4(this.maxSize)&&(this.maxSize.index=`visualVariables[${e}].maxSize`),p4(this.minSize)&&(this.minSize.index=`visualVariables[${e}].minSize`),this._set("index",e)}get inputValueType(){return p6e(this)}set maxDataValue(e){e&&this.stops&&(jx.warn("cannot set maxDataValue when stops is not null."),e=null),this._set("maxDataValue",e)}set maxSize(e){e&&this.stops&&(jx.warn("cannot set maxSize when stops is not null."),e=null),this._set("maxSize",e)}castMaxSize(e){return Ohe(e)}readMaxSize(e,t,r){return Mhe(e,t,r)}set minDataValue(e){e&&this.stops&&(jx.warn("cannot set minDataValue when stops is not null."),e=null),this._set("minDataValue",e)}set minSize(e){e&&this.stops&&(jx.warn("cannot set minSize when stops is not null."),e=null),this._set("minSize",e)}castMinSize(e){return Ohe(e)}readMinSize(e,t,r){return Mhe(e,t,r)}get arcadeRequired(){return!!this.valueExpression||this.minSize&&typeof this.minSize=="object"&&this.minSize.arcadeRequired||this.maxSize&&typeof this.maxSize=="object"&&this.maxSize.arcadeRequired}set stops(e){this.minDataValue==null&&this.maxDataValue==null&&this.minSize==null&&this.maxSize==null?e&&Array.isArray(e)&&(e=e.filter(t=>!!t)).sort((t,r)=>t.value-r.value):e&&(jx.warn("cannot set stops when one of minDataValue, maxDataValue, minSize or maxSize is not null."),e=null),this._set("stops",e)}get transformationType(){return Vtt(this,this.inputValueType)}readValueExpression(e,t){return e||t.expression&&"$view.scale"}writeValueExpressionWebScene(e,t,r,i){if(e==="$view.scale"){if(i&&i.messages){const n=this.index,s=typeof n=="string"?n:`visualVariables[${n}]`;i.messages.push(new k("property:unsupported",this.type+"VisualVariable.valueExpression = '$view.scale' is not supported in Web Scene. Please remove this property to save the Web Scene.",{instance:this,propertyName:s+".valueExpression",context:i}))}}else t[r]=e}readValueUnit(e){return e?xQ.read(e):null}clone(){return new wQ({axis:this.axis,field:this.field,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,maxDataValue:this.maxDataValue,maxSize:p4(this.maxSize)?this.maxSize.clone():this.maxSize,minDataValue:this.minDataValue,minSize:p4(this.minSize)?this.minSize.clone():this.minSize,normalizationField:this.normalizationField,stops:this.stops&&this.stops.map(e=>e.clone()),target:this.target,useSymbolValue:this.useSymbolValue,valueRepresentation:this.valueRepresentation,valueUnit:this.valueUnit,legendOptions:this.legendOptions&&this.legendOptions.clone()})}flipSizes(){if(this.transformationType===Aa.ClampedLinear){const{minSize:e,maxSize:t}=this;return this.minSize=t,this.maxSize=e,this}if(this.transformationType===Aa.Stops){const e=this.stops,t=e.map(i=>i.size).reverse(),r=e.length;for(let i=0;i<r;i++)e[i].size=t[i];return this}return this}getAttributeHash(){return`${super.getAttributeHash()}-${this.target}-${this.normalizationField}`}_interpolateData(){return this.stops&&this.stops.map(e=>e.value||0)}};d([f({readOnly:!0})],oi.prototype,"cache",null),d([f({type:sP.apiValues,json:{type:sP.jsonValues,origins:{"web-map":{read:!1}},read:sP.read,write:sP.write}})],oi.prototype,"axis",void 0),d([f({type:String,value:null,json:{read:!1}})],oi.prototype,"expression",null),d([f()],oi.prototype,"index",null),d([f({type:String,readOnly:!0})],oi.prototype,"inputValueType",null),d([f({type:f6e,json:{write:!0}})],oi.prototype,"legendOptions",void 0),d([f({type:Number,value:null,json:{write:!0}})],oi.prototype,"maxDataValue",null),d([f({type:Number,value:null,json:{write:!0}})],oi.prototype,"maxSize",null),d([Xt("maxSize")],oi.prototype,"castMaxSize",null),d([$e("maxSize")],oi.prototype,"readMaxSize",null),d([f({type:Number,value:null,json:{write:!0}})],oi.prototype,"minDataValue",null),d([f({type:Number,value:null,json:{write:!0}})],oi.prototype,"minSize",null),d([Xt("minSize")],oi.prototype,"castMinSize",null),d([$e("minSize")],oi.prototype,"readMinSize",null),d([f({type:String,json:{write:!0}})],oi.prototype,"normalizationField",void 0),d([f({readOnly:!0})],oi.prototype,"arcadeRequired",null),d([f({type:String})],oi.prototype,"scaleBy",void 0),d([f({type:[ktt],value:null,json:{write:!0}})],oi.prototype,"stops",null),d([f({type:["outline"],json:{write:!0}})],oi.prototype,"target",void 0),d([f({type:String,readOnly:!0})],oi.prototype,"transformationType",null),d([f({type:["size"],json:{type:["sizeInfo"]}})],oi.prototype,"type",void 0),d([f({type:Boolean,json:{write:!0,origins:{"web-map":{read:!1}}}})],oi.prototype,"useSymbolValue",void 0),d([f({type:String,json:{write:!0}})],oi.prototype,"valueExpression",void 0),d([$e("valueExpression",["valueExpression","expression"])],oi.prototype,"readValueExpression",null),d([Xe("web-scene","valueExpression")],oi.prototype,"writeValueExpressionWebScene",null),d([f({type:["radius","diameter","area","width","distance"],json:{write:!0}})],oi.prototype,"valueRepresentation",void 0),d([f({type:xQ.apiValues,json:{write:xQ.write,origins:{"web-map":{read:!1},"web-scene":{write:!0}}}})],oi.prototype,"valueUnit",void 0),d([$e("valueUnit")],oi.prototype,"readValueUnit",null),oi=wQ=d([$("esri.renderers.visualVariables.SizeVariable")],oi);const bm=oi,Ztt=fe.getLogger("esri.renderers.visualVariables.VisualVariableFactory"),Qtt={color:d6e,size:bm,opacity:u6e,rotation:h6e},Jtt=new tr({colorInfo:"color",transparencyInfo:"opacity",rotationInfo:"rotation",sizeInfo:"size"}),Ktt=/^\[([^\]]+)\]$/i;let ML=class extends xe{constructor(){super(...arguments),this.colorVariables=null,this.opacityVariables=null,this.rotationVariables=null,this.sizeVariables=null}set visualVariables(e){if(this._resetVariables(),(e=e&&e.filter(t=>!!t))&&e.length){for(const t of e)switch(t.type){case"color":this.colorVariables.push(t);break;case"opacity":this.opacityVariables.push(t);break;case"rotation":this.rotationVariables.push(t);break;case"size":this.sizeVariables.push(t)}this.sizeVariables.length&&this.sizeVariables.some(t=>!!t.target)&&e.sort((t,r)=>{let i=null;return i=t.target===r.target?0:t.target?1:-1,i});for(let t=0;t<e.length;t++)e[t].index=t;this._set("visualVariables",e)}else this._set("visualVariables",e)}readVariables(e,t,r){const{rotationExpression:i,rotationType:n}=t,s=i&&i.match(Ktt),a=s&&s[1];if(a&&(e||(e=[]),e.push({type:"rotationInfo",rotationType:n,field:a})),e)return e.map(o=>{const l=Jtt.read(o.type),c=Qtt[l];c||(Ztt.warn(`Unknown variable type: ${l}`),r&&r.messages&&r.messages.push(new cc("visual-variable:unsupported",`visualVariable of type '${l}' is not supported`,{definition:o,context:r})));const u=new c;return u.read(o,r),u})}writeVariables(e,t){const r=[];for(const i of e){const n=i.toJSON(t);n&&r.push(n)}return r}_resetVariables(){this.colorVariables=[],this.opacityVariables=[],this.rotationVariables=[],this.sizeVariables=[]}};d([f()],ML.prototype,"visualVariables",null),ML=d([$("esri.renderers.visualVariables.VisualVariableFactory")],ML);const ert=ML,trt={base:uO,key:"type",typeMap:{opacity:u6e,color:d6e,rotation:h6e,size:bm}},p6=e=>{let t=class extends e{constructor(){super(...arguments),this._vvFactory=new ert}set visualVariables(r){this._vvFactory.visualVariables=r,this._set("visualVariables",this._vvFactory.visualVariables)}readVisualVariables(r,i,n){return this._vvFactory.readVariables(r,i,n)}writeVisualVariables(r,i,n,s){i[n]=this._vvFactory.writeVariables(r,s)}get arcadeRequiredForVisualVariables(){if(!this.visualVariables)return!1;for(const r of this.visualVariables)if(r.arcadeRequired)return!0;return!1}hasVisualVariables(r,i){return r?this.getVisualVariablesForType(r,i).length>0:this.getVisualVariablesForType("size",i).length>0||this.getVisualVariablesForType("color",i).length>0||this.getVisualVariablesForType("opacity",i).length>0||this.getVisualVariablesForType("rotation",i).length>0}getVisualVariablesForType(r,i){const n=this.visualVariables;return n?n.filter(s=>s.type===r&&(typeof i=="string"?s.target===i:i!==!1||!s.target)):[]}async collectVVRequiredFields(r,i){let n=[];this.visualVariables&&(n=n.concat(this.visualVariables));for(const s of n)s&&(s.field&&Uh(r,i,s.field),s.normalizationField&&Uh(r,i,s.normalizationField),s.valueExpression&&await uc(r,i,s.valueExpression))}};return d([f({types:[trt],value:null,json:{write:!0}})],t.prototype,"visualVariables",null),d([$e("visualVariables",["visualVariables","rotationType","rotationExpression"])],t.prototype,"readVisualVariables",null),d([Xe("visualVariables")],t.prototype,"writeVisualVariables",null),t=d([$("esri.renderers.mixins.VisualVariablesMixin")],t),t},t8={retainId:!1,ignoreDrivers:!1,hasLabelingContext:!0};function l9(e,t=t8){var o,l;if(!e)return{symbol:null};const{retainId:r=t8.retainId,ignoreDrivers:i=t8.ignoreDrivers,hasLabelingContext:n=t8.hasLabelingContext,retainCIM:s=t8.retainCIM}=t;let a;if(hm(e)||e instanceof Sx)a=e.clone();else if(e.type==="cim"){const c=(l=(o=e.data)==null?void 0:o.symbol)==null?void 0:l.type;if(c!=="CIMPointSymbol")return{error:new k("symbol-conversion:unsupported-cim-symbol",`CIM symbol of type '${c||"unknown"}' is unsupported in 3D`,{symbol:e})};a=s?e.clone():Y0.fromCIMSymbol(e)}else if(e instanceof bc)a=Y5.fromSimpleLineSymbol(e);else if(e instanceof nc)a=Y0.fromSimpleMarkerSymbol(e);else if(e instanceof PV)a=Y0.fromPictureMarkerSymbol(e);else if(e instanceof kp)a=Fw.fromSimpleFillSymbol(e);else{if(!(e instanceof i6))return{error:new k("symbol-conversion:unsupported-2d-symbol",`2D symbol of type '${e.type||e.declaredClass}' is unsupported in 3D`,{symbol:e})};a=n?OV.fromTextSymbol(e):Y0.fromTextSymbol(e)}if(r&&a.type!=="cim"&&(a.id=e.id),i&&hm(a))for(let c=0;c<a.symbolLayers.length;++c)a.symbolLayers.getItemAt(c)._ignoreDrivers=!0;return{symbol:a}}const rrt=["building-scene","integrated-mesh","point-cloud","scene"];function AN(e,t,r,i){const n=w6e(e,{},{context:i,isLabelSymbol:!1});_(n)&&(t[r]=n)}function Phe(e,t,r,i){const n=w6e(e,{},{context:i,isLabelSymbol:!0});_(n)&&(t[r]=n)}function Ihe(e){return e instanceof r6||e instanceof Sx}function w6e(e,t,r){var o;if(R(e))return null;const{context:i,isLabelSymbol:n}=r,s=i==null?void 0:i.origin,a=i==null?void 0:i.messages;if(s==="web-scene"&&!Ihe(e)){const l=l9(e,{retainCIM:!0,hasLabelingContext:n});return _(l.symbol)?l.symbol.write(t,i):(a==null||a.push(new k("symbol:unsupported",`Symbols of type '${e.declaredClass}' are not supported in scenes. Use 3D symbology instead when working with WebScene and SceneView`,{symbol:e,context:i,error:l.error})),null)}return(s==="web-map"||s==="portal-item"&&!rrt.includes((o=i==null?void 0:i.layer)==null?void 0:o.type))&&Ihe(e)?(a==null||a.push(new k("symbol:unsupported",`Symbols of type '${e.declaredClass}' are not supported in web maps and portal items. Use 2D symbology and CIMSymbol instead when working with MapView`,{symbol:e,context:i})),null):e.write(t,i)}function x6e(e,t){return JBe(e,null,t)}const hO={types:nTe,json:{write:{writer:AN},origins:{"web-scene":{types:ade,write:{writer:AN},read:{reader:Y9({types:ade})}}}}},T6e={types:{base:yc,key:"type",typeMap:{"simple-fill":ow.typeMap["simple-fill"],"picture-fill":ow.typeMap["picture-fill"],"polygon-3d":ow.typeMap["polygon-3d"]}},json:{write:{writer:AN},origins:{"web-scene":{type:Fw,write:{writer:AN}}}}};var TQ;let n1=TQ=class extends ge{constructor(e){super(e),this.description=null,this.label=null,this.minValue=null,this.maxValue=0,this.symbol=null}clone(){return new TQ({description:this.description,label:this.label,minValue:this.minValue,maxValue:this.maxValue,symbol:this.symbol?this.symbol.clone():null})}getMeshHash(){const e=JSON.stringify(this.symbol);return`${this.minValue}.${this.maxValue}.${e}`}};d([f({type:String,json:{write:!0}})],n1.prototype,"description",void 0),d([f({type:String,json:{write:!0}})],n1.prototype,"label",void 0),d([f({type:Number,json:{read:{source:"classMinValue"},write:{target:"classMinValue"}}})],n1.prototype,"minValue",void 0),d([f({type:Number,json:{read:{source:"classMaxValue"},write:{target:"classMaxValue"}}})],n1.prototype,"maxValue",void 0),d([f(hO)],n1.prototype,"symbol",void 0),n1=TQ=d([$("esri.renderers.support.ClassBreakInfo")],n1);const RN=n1;var SQ;const aP=fe.getLogger("esri.renderers.ClassBreaksRenderer"),S6e="log",PL="percent-of-total",IL="field",oP=new tr({esriNormalizeByLog:S6e,esriNormalizeByPercentOfTotal:PL,esriNormalizeByField:IL}),irt=rs(RN);let Ws=SQ=class extends p6(Hy){constructor(e){super(e),this._compiledValueExpression={valueExpression:null,compiledFunction:null},this.backgroundFillSymbol=null,this.classBreakInfos=null,this.defaultLabel=null,this.defaultSymbol=null,this.field=null,this.isMaxInclusive=!0,this.legendOptions=null,this.normalizationField=null,this.normalizationTotal=null,this.type="class-breaks",this.valueExpression=null,this.valueExpressionTitle=null,this._set("classBreakInfos",[])}readClassBreakInfos(e,t,r){if(!Array.isArray(e))return;let i=t.minValue;return e.map(n=>{const s=new RN;return s.read(n,r),s.minValue==null&&(s.minValue=i),s.maxValue==null&&(s.maxValue=s.minValue),i=s.maxValue,s})}writeClassBreakInfos(e,t,r,i){const n=e.map(s=>s.write({},i));this._areClassBreaksConsecutive()&&n.forEach(s=>delete s.classMinValue),t[r]=n}castField(e){return e==null?e:typeof e=="function"?(aP.error(".field: field must be a string value"),null):WR(e)}get minValue(){return this.classBreakInfos&&this.classBreakInfos[0]&&this.classBreakInfos[0].minValue||0}get normalizationType(){let e=this._get("normalizationType");const t=!!this.normalizationField,r=this.normalizationTotal!=null;return t||r?(e=t&&IL||r&&PL||null,t&&r&&aP.warn("warning: both normalizationField and normalizationTotal are set!")):e!==IL&&e!==PL||(e=null),e}set normalizationType(e){this._set("normalizationType",e)}addClassBreakInfo(e,t,r){let i=null;i=typeof e=="number"?new RN({minValue:e,maxValue:t,symbol:sTe(r)}):irt(te(e)),this.classBreakInfos.push(i),this.classBreakInfos.length===1&&this.notifyChange("minValue")}removeClassBreakInfo(e,t){const r=this.classBreakInfos.length;for(let i=0;i<r;i++){const n=[this.classBreakInfos[i].minValue,this.classBreakInfos[i].maxValue];if(n[0]===e&&n[1]===t){this.classBreakInfos.splice(i,1);break}}}getBreakIndex(e,t){return this.valueExpression&&(R(t)||R(t.arcade))&&aP.warn(""),this.valueExpression?this._getBreakIndexForExpression(e,t):this._getBreakIndexForField(e)}async getClassBreakInfo(e,t){let r=t;this.valueExpression&&(R(t)||R(t.arcade))&&(r={...r,arcade:await Wh()});const i=this.getBreakIndex(e,r);return i!==-1?this.classBreakInfos[i]:null}getSymbol(e,t){if(this.valueExpression&&(R(t)||R(t.arcade)))return void aP.error("#getSymbol()","Please use getSymbolAsync if valueExpression is used");const r=this.getBreakIndex(e,t);return r>-1?this.classBreakInfos[r].symbol:this.defaultSymbol}async getSymbolAsync(e,t){let r=t;if(this.valueExpression&&(R(t)||R(t.arcade))){const n=await Wh(),{arcadeUtils:s}=n;s.hasGeometryOperations(this.valueExpression)&&await s.enableGeometryOperations(),r={...r,arcade:n}}const i=this.getBreakIndex(e,r);return i>-1?this.classBreakInfos[i].symbol:this.defaultSymbol}getSymbols(){const e=[];return this.classBreakInfos.forEach(t=>{t.symbol&&e.push(t.symbol)}),this.defaultSymbol&&e.push(this.defaultSymbol),e}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce((e,t)=>e+t.getAttributeHash(),"")}getMeshHash(){const e=JSON.stringify(this.backgroundFillSymbol),t=JSON.stringify(this.defaultSymbol),r=`${this.normalizationField}.${this.normalizationType}.${this.normalizationTotal}`;return`${e}.${t}.${this.classBreakInfos.reduce((i,n)=>i+n.getMeshHash(),"")}.${r}.${this.field}.${this.valueExpression}`}get arcadeRequired(){return this.arcadeRequiredForVisualVariables||!!this.valueExpression}clone(){return new SQ({field:this.field,backgroundFillSymbol:this.backgroundFillSymbol&&this.backgroundFillSymbol.clone(),defaultLabel:this.defaultLabel,defaultSymbol:this.defaultSymbol&&this.defaultSymbol.clone(),valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,classBreakInfos:te(this.classBreakInfos),isMaxInclusive:this.isMaxInclusive,normalizationField:this.normalizationField,normalizationTotal:this.normalizationTotal,normalizationType:this.normalizationType,visualVariables:te(this.visualVariables),legendOptions:te(this.legendOptions),authoringInfo:this.authoringInfo&&this.authoringInfo.clone()})}async collectRequiredFields(e,t){const r=[this.collectVVRequiredFields(e,t),this.collectSymbolFields(e,t)];await Promise.all(r)}async collectSymbolFields(e,t){const r=[...this.getSymbols().map(i=>i.collectRequiredFields(e,t)),uc(e,t,this.valueExpression)];Uh(e,t,this.field),Uh(e,t,this.normalizationField),await Promise.all(r)}_getBreakIndexForExpression(e,t){const{viewingMode:r,scale:i,spatialReference:n,arcade:s}=vt(t,{});let a=this._compiledValueExpression.valueExpression===this.valueExpression?this._compiledValueExpression.compiledFunction:null;const o=s.arcadeUtils;if(!a){const c=o.createSyntaxTree(this.valueExpression);a=o.createFunction(c),this._compiledValueExpression.compiledFunction=a}this._compiledValueExpression.valueExpression=this.valueExpression;const l=o.executeFunction(a,o.createExecContext(e,o.getViewInfo({viewingMode:r,scale:i,spatialReference:n})));return this._getBreakIndexfromInfos(l)}_getBreakIndexForField(e){const t=this.field,r=e.attributes,i=this.normalizationType;let n=parseFloat(r[t]);if(i){const s=this.normalizationTotal,a=parseFloat(r[this.normalizationField]);if(i===S6e)n=Math.log(n)*Math.LOG10E;else if(i!==PL||isNaN(s)){if(i===IL&&!isNaN(a)){if(isNaN(n)||isNaN(a))return-1;n/=a}}else n=n/s*100}return this._getBreakIndexfromInfos(n)}_getBreakIndexfromInfos(e){const t=this.isMaxInclusive;if(e!=null&&typeof e=="number"&&!isNaN(e))for(let r=0;r<this.classBreakInfos.length;r++){const i=[this.classBreakInfos[r].minValue,this.classBreakInfos[r].maxValue];if(i[0]<=e&&(t?e<=i[1]:e<i[1]))return r}return-1}_areClassBreaksConsecutive(){const e=this.classBreakInfos,t=e.length;for(let r=1;r<t;r++)if(e[r-1].maxValue!==e[r].minValue)return!1;return!0}};d([f(T6e)],Ws.prototype,"backgroundFillSymbol",void 0),d([f({type:[RN]})],Ws.prototype,"classBreakInfos",void 0),d([$e("classBreakInfos")],Ws.prototype,"readClassBreakInfos",null),d([Xe("classBreakInfos")],Ws.prototype,"writeClassBreakInfos",null),d([f({type:String,json:{write:!0}})],Ws.prototype,"defaultLabel",void 0),d([f(hO)],Ws.prototype,"defaultSymbol",void 0),d([f({type:String,json:{write:!0}})],Ws.prototype,"field",void 0),d([Xt("field")],Ws.prototype,"castField",null),d([f({type:Boolean})],Ws.prototype,"isMaxInclusive",void 0),d([f({type:nm,json:{write:!0}})],Ws.prototype,"legendOptions",void 0),d([f({type:Number,readOnly:!0,value:null,json:{read:!1,write:{overridePolicy(){return this.classBreakInfos.length!==0&&this._areClassBreaksConsecutive()?{enabled:!0}:{enabled:!1}}}}})],Ws.prototype,"minValue",null),d([f({type:String,json:{write:!0}})],Ws.prototype,"normalizationField",void 0),d([f({type:Number,cast:e=>Eh(e),json:{write:!0}})],Ws.prototype,"normalizationTotal",void 0),d([f({type:oP.apiValues,value:null,json:{type:oP.jsonValues,read:oP.read,write:oP.write}})],Ws.prototype,"normalizationType",null),d([Ze({classBreaks:"class-breaks"})],Ws.prototype,"type",void 0),d([f({type:String,json:{write:!0}})],Ws.prototype,"valueExpression",void 0),d([f({type:String,json:{write:!0}})],Ws.prototype,"valueExpressionTitle",void 0),Ws=SQ=d([$("esri.renderers.ClassBreaksRenderer")],Ws);const E6e=Ws;class nrt{constructor(t,r){this._storage=new kie,this._storage.maxSize=t,r&&this._storage.registerRemoveFunc("",r)}put(t,r,i){this._storage.put(t,r,i,1)}pop(t){return this._storage.pop(t)}get(t){return this._storage.get(t)}clear(){this._storage.clearAll()}destroy(){this._storage.destroy()}get maxSize(){return this._storage.maxSize}set maxSize(t){this._storage.maxSize=t}}const $he=fe.getLogger("esri.renderers.support.DictionaryLoader"),srt={type:"CIMSimpleLineCallout",lineSymbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMSolidStroke",width:.5,color:[0,0,0,255]}]}};class pne{constructor(t,r,i){this.config=null,this.fieldMap=null,this.url=null,this._ongoingRequests=new Map,this._symbolCache=new nrt(100),this.url=t,this.config=r,this.fieldMap=i}getSymbolFields(){return this._symbolFields}async getSymbolAsync(t,r){let i;this._dictionaryPromise||(this._dictionaryPromise=this.fetchResources(r));try{i=await this._dictionaryPromise}catch(m){if(Ui(m))return this._dictionaryPromise=null,null}const n={};if(this.fieldMap)for(const m of this._symbolFields){const g=this.fieldMap[m];if(g&&t.attributes[g]!=null){const b=""+t.attributes[g];n[m]=b}else n[m]=""}const s=i(n,r);if(!s||typeof s!="string")return null;const a=Ste(s).toString(),o=this._symbolCache.get(a);if(o)return o.catch(()=>{this._symbolCache.pop(a)}),o;const l=s.split(";"),c=[],u=[];for(const m of l)if(m)if(m.includes("po:")){const g=m.substr(3).split("|");if(g.length===3){const b=g[0],w=g[1];let v=g[2];if(w==="DashTemplate")v=v.split(" ").map(x=>Number(x));else if(w==="Color"){const x=new Te(v).toRgba();v=[x[0],x[1],x[2],255*x[3]]}else v=Number(v);u.push({primitiveName:b,propertyName:w,value:v})}}else if(m.includes("|")){for(const g of m.split("|"))if(this._itemNames.has(g)){c.push(g);break}}else this._itemNames.has(m)&&c.push(m);const h=!_(t.geometry)||!t.geometry.hasZ&&t.geometry.type==="point",p=this._cimPartsToCIMSymbol(c,u,h,r);return this._symbolCache.put(a,p,1),p}async fetchResources(t){if(this._dictionaryPromise)return this._dictionaryPromise;if(!this.url)return void $he.error("no valid URL!");const r=qt(this.url+"/resources/styles/dictionary-info.json",{responseType:"json",query:{f:"json"},signal:_(t)?t.signal:null}),[{data:i}]=await Promise.all([r,Wh()]);if(!i)throw this._dictionaryPromise=null,new k("esri.renderers.DictionaryRenderer","Bad dictionary data!");const n=i.expression,s=i.authoringInfo;this._refSymbolUrlTemplate=this.url+"/"+i.cimRefTemplateUrl,this._itemNames=new Set(i.itemsNames),this._symbolFields=s.symbol;const a={};if(this.config){const l=this.config;for(const c in l)a[c]=l[c]}if(s.configuration)for(const l of s.configuration)a.hasOwnProperty(l.name)||(a[l.name]=l.value);const o=[];if(_(t)&&t.fields&&this.fieldMap)for(const l of this._symbolFields){const c=this.fieldMap[l],u=t.fields.filter(h=>h.name===c);u.length>0&&o.push({...u[0],name:l})}return this._dictionaryPromise=mUe(n,_(t)?t.spatialReference:null,o,a).then(l=>{const c={scale:0};return(u,h)=>{const p=l.repurposeFeature({geometry:null,attributes:u});return c.scale=_(h)?h.scale:void 0,l.evaluate({$feature:p,$view:c})}}).catch(l=>($he.error("Creating dictinoary expression failed:",l),null)),this._dictionaryPromise}async _cimPartsToCIMSymbol(t,r,i,n){const s=new Array(t.length);for(let l=0;l<t.length;l++)s[l]=this._getSymbolPart(t[l],n);const a=await Promise.all(s),o=this.fieldMap;for(const l of a)C6e(l,o);return new e6({data:this._combineSymbolParts(a,r,i)})}async _getSymbolPart(t,r){if(this._ongoingRequests.has(t))return this._ongoingRequests.get(t).then(s=>s.data);const i=this._refSymbolUrlTemplate.replace(/\{itemName\}/gi,t),n=qt(i,{responseType:"json",query:{f:"json"},...r});this._ongoingRequests.set(t,n);try{return(await n).data}catch(s){throw this._ongoingRequests.delete(t),s}}_combineSymbolParts(t,r,i){if(!t||t.length===0)return null;const n={...t[0]};if(t.length>1){n.symbolLayers=[];for(const s of t){const a=s;n.symbolLayers.unshift(...a.symbolLayers)}}return i&&(n.callout=srt),{type:"CIMSymbolReference",symbol:n,primitiveOverrides:r}}}function C6e(e,t){if(!e)return;const r=e.symbolLayers;if(!r)return;let i=r.length;for(;i--;){const n=r[i];n&&n.enable!==!1&&n.type==="CIMVectorMarker"&&art(n,t)}}function art(e,t){const r=e.markerGraphics;if(r)for(const i of r){if(!i)continue;const n=i.symbol;if(n)switch(n.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":C6e(n,t);break;case"CIMTextSymbol":n.fieldMap=t}}}const X$t=Object.freeze(Object.defineProperty({__proto__:null,DictionaryLoader:pne},Symbol.toStringTag,{value:"Module"}));var EQ;let $f=EQ=class extends p6(Hy){constructor(e){super(e),this.config=null,this.fieldMap=null,this.scaleExpression=null,this.scaleExpressionTitle=null,this.url=null,this.type="dictionary"}get _loader(){return new pne(this.url,this.config,this.fieldMap)}writeData(e,t){e&&(t.scalingExpressionInfo={expression:e,returnType:"number"})}writeVisualVariables(e,t,r,i){i!=null&&i.origin||super.writeVisualVariables(e,t,r,i)}clone(){return new EQ({config:te(this.config),scaleExpression:this.scaleExpression,scaleExpressionTitle:this.scaleExpressionTitle,fieldMap:te(this.fieldMap),url:te(this.url),visualVariables:te(this.visualVariables)})}async getSymbolAsync(e,t){return this._loader.getSymbolAsync(e,t)}async collectRequiredFields(e,t){await this.collectVVRequiredFields(e,t),this.scaleExpression&&await uc(e,t,this.scaleExpression);for(const r in this.fieldMap){const i=this.fieldMap[r];t.has(i)&&e.add(i)}}get arcadeRequired(){return!0}getSymbol(){return null}getSymbols(){return[]}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce((e,t)=>e+t.getAttributeHash(),"")}getMeshHash(){return`${this.url}-${JSON.stringify(this.fieldMap)}`}getSymbolFields(){return this._loader.getSymbolFields()}};d([f({type:pne})],$f.prototype,"_loader",null),d([f({type:Object,json:{read:{source:"configuration"},write:{target:"configuration"}}})],$f.prototype,"config",void 0),d([f({type:Object,json:{write:!0}})],$f.prototype,"fieldMap",void 0),d([f({type:String,json:{read:{source:"scalingExpressionInfo.expression"},write:!0}})],$f.prototype,"scaleExpression",void 0),d([Xe("scaleExpression")],$f.prototype,"writeData",null),d([f({type:String,json:{read:{source:"scalingExpressionInfo.title"},write:{target:"scalingExpressionInfo.title",overridePolicy(e){return{enabled:!!e&&!!this.scaleExpression}}}}})],$f.prototype,"scaleExpressionTitle",void 0),d([f({type:String,json:{write:!0}})],$f.prototype,"url",void 0),d([Xe("visualVariables")],$f.prototype,"writeVisualVariables",null),$f=EQ=d([$("esri.renderers.DictionaryRenderer")],$f);const ort=$f;var CQ;const lrt=fe.getLogger("esri.renderers.support.AttributeColorInfo");let ug=CQ=class extends ge{constructor(e){super(e),this.color=null,this.field=null,this.label=null,this.valueExpression=null,this.valueExpressionTitle=null}castField(e){return e==null?e:typeof e=="function"?(lrt.error(".field: field must be a string value"),null):WR(e)}getAttributeHash(){return`${this.field}-${this.valueExpression}`}clone(){return new CQ({color:this.color&&this.color.clone(),field:this.field,label:this.label,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle})}};d([f({type:Te,json:{type:[Number],write:!0}})],ug.prototype,"color",void 0),d([f({type:String,json:{write:!0}})],ug.prototype,"field",void 0),d([Xt("field")],ug.prototype,"castField",null),d([f({type:String,json:{write:!0}})],ug.prototype,"label",void 0),d([f({type:String,json:{write:!0}})],ug.prototype,"valueExpression",void 0),d([f({type:String,json:{write:!0}})],ug.prototype,"valueExpressionTitle",void 0),ug=CQ=d([$("esri.renderers.support.AttributeColorInfo")],ug);const A6e=ug;var AQ;let $L=AQ=class extends ge{constructor(){super(...arguments),this.unit=null}clone(){return new AQ({unit:this.unit})}};d([f({type:String,json:{write:!0}})],$L.prototype,"unit",void 0),$L=AQ=d([$("esri.renderers.support.DotDensityLegendOptions")],$L);const crt=$L;var RQ;let Yo=RQ=class extends p6(Hy){constructor(e){super(e),this.attributes=null,this.backgroundColor=new Te([0,0,0,0]),this.blendDots=!0,this.dotBlendingEnabled=!0,this.dotShape="square",this.dotSize=1,this.legendOptions=null,this.outline=new bc,this.dotValue=null,this.referenceDotValue=null,this.referenceScale=null,this.seed=1,this.type="dot-density"}calculateDotValue(e){if(this.referenceScale==null)return this.dotValue;const t=e/this.referenceScale*this.dotValue;return t<1?1:t}getSymbol(){return new kp({outline:this.outline})}async getSymbolAsync(){return this.getSymbol()}getSymbols(){return[this.getSymbol()]}getAttributeHash(){return this.attributes&&this.attributes.reduce((e,t)=>e+t.getAttributeHash(),"")}getMeshHash(){return JSON.stringify(this.outline)}clone(){return new RQ({attributes:te(this.attributes),backgroundColor:te(this.backgroundColor),dotBlendingEnabled:te(this.dotBlendingEnabled),dotShape:te(this.dotShape),dotSize:te(this.dotSize),dotValue:te(this.dotValue),legendOptions:te(this.legendOptions),outline:te(this.outline),referenceScale:te(this.referenceScale),visualVariables:te(this.visualVariables),authoringInfo:this.authoringInfo&&this.authoringInfo.clone()})}getControllerHash(){return`${this.attributes.map(e=>e.field||e.valueExpression||"")}-${this.outline&&JSON.stringify(this.outline.toJSON())||""}`}async collectRequiredFields(e,t){await this.collectVVRequiredFields(e,t);for(const r of this.attributes)r.valueExpression&&await uc(e,t,r.valueExpression),r.field&&e.add(r.field)}};d([f({type:[A6e],json:{write:!0}})],Yo.prototype,"attributes",void 0),d([f({type:Te,json:{write:!0}})],Yo.prototype,"backgroundColor",void 0),d([f({type:Boolean}),We("dotBlendingEnabled")],Yo.prototype,"blendDots",void 0),d([f({type:Boolean,json:{write:!0}})],Yo.prototype,"dotBlendingEnabled",void 0),d([f({type:String,json:{write:!1}})],Yo.prototype,"dotShape",void 0),d([f({type:Number,json:{write:!0,origins:{"web-map":{write:!1},"web-scene":{write:!1}}}})],Yo.prototype,"dotSize",void 0),d([f({type:crt,json:{write:!0}})],Yo.prototype,"legendOptions",void 0),d([f({type:bc,json:{default:null,write:!0}})],Yo.prototype,"outline",void 0),d([f({type:Number,json:{write:!0}})],Yo.prototype,"dotValue",void 0),d([f({type:Number}),We("dotValue")],Yo.prototype,"referenceDotValue",void 0),d([f({type:Number,json:{write:!0}})],Yo.prototype,"referenceScale",void 0),d([f({type:Number,json:{write:!0}})],Yo.prototype,"seed",void 0),d([Ze({dotDensity:"dot-density"})],Yo.prototype,"type",void 0),Yo=RQ=d([$("esri.renderers.DotDensityRenderer")],Yo);const drt=Yo;let mS=class extends yd(ge){constructor(){super(...arguments),this.minLabel=null,this.maxLabel=null,this.title=null}};d([f({type:String,json:{write:!0}})],mS.prototype,"minLabel",void 0),d([f({type:String,json:{write:!0}})],mS.prototype,"maxLabel",void 0),d([f({type:String,json:{write:!0}})],mS.prototype,"title",void 0),mS=d([$("esri.renderers.support.HeatmapLegendOptions")],mS);const mne=2.4;function urt(e){return zs(e*mne)}function hrt(e){return ur(e)/mne}function frt(e,t,r,i){let{color:n,ratio:s}=t,{color:a,ratio:o}=r;o===s&&(o===1?s-=1e-6:o+=1e-6);const l=Le((i-s)/(o-s),0,1);mV(e,n.toArray(),a.toArray(),l)}function Y$t(e){const r=new Uint8ClampedArray(2048);if(e=e.filter(({ratio:o})=>o>=0&&o<=1).sort((o,l)=>o.ratio-l.ratio).map(({color:o,ratio:l})=>({color:o,ratio:Math.max(l,.001)})),e.length<1)return r;let i=e[0],n=e[0],s=1;const a=Jt();for(let o=0;o<512;o++){const l=(o+.5)/512;for(;l>n.ratio&&s<e.length;)i=n,n=e[s++];frt(a,i,n,l),r.set(a,4*o)}return r}function Z$t(e,t,r,i){const{radius:n,fieldOffset:s,field:a}=t,o=Math.round(ur(n)),l=new Float64Array(r*i);let c,u=Number.NEGATIVE_INFINITY;const h=mrt(a,s),p=new Set;for(const m of e){const g=m.getCursor();for(;g.next();){const b=g.getObjectId();if(p.has(b))continue;p.add(b);const w=g.readLegacyPointGeometry(),v=128;if(w.x<-v||w.x>=r+v||w.y<-v||w.y>i+v)continue;const x=+h(g),T=Math.max(0,Math.round(w.x)-o),E=Math.max(0,Math.round(w.y)-o),C=Math.min(i,Math.round(w.y)+o),A=Math.min(r,Math.round(w.x)+o);for(let P=E;P<C;P++)for(let I=T;I<A;I++){const L=P*r+I,V=R6e(w.x-I,w.y-P,o);c=l[L]+=V*x,c>u&&(u=c)}}}return{matrix:l.buffer,max:u}}function R6e(e,t,r){const i=Math.sqrt(e**2+t**2)/r;return i>1?0:3/(Math.PI*r**2)*(1-i**2)**2}function prt(e,t){return typeof e=="function"?e:e?typeof t=="string"?r=>-1*+r[e]:r=>+r[e]+t:()=>1}function mrt(e,t){return e!=null?typeof t=="string"?r=>-1*+r.readAttribute(e):r=>+r.readAttribute(e)+t:r=>1}var OQ;const grt=fe.getLogger("esri.renderers.HeatmapRenderer");function Lhe(e){if(e!=null){const{maxDensity:t,minDensity:r,radius:i}=e;if(t!=null||r!=null||i!=null){const{blurRadius:n,maxPixelIntensity:s,minPixelIntensity:a,...o}=e;return o}}return e}let ya=OQ=class extends Hy{constructor(e){super(e),this.authoringInfo=null,this.colorStops=[new JC({ratio:0,color:new Te("rgba(255, 140, 0, 0)")}),new JC({ratio:.75,color:new Te("rgba(255, 140, 0, 1)")}),new JC({ratio:.9,color:new Te("rgba(255, 0,   0, 1)")})],this.field=null,this.fieldOffset=0,this.legendOptions=null,this.maxDensity=.04,this.minDensity=0,this.radius=18,this.referenceScale=0,this.type="heatmap",this.valueExpression=null,this.valueExpressionTitle=null,this._warnedProps={blurRadius:!1,maxPixelIntensity:!1,minPixelIntensity:!1}}normalizeCtorArgs(e){return Lhe(e)}get blurRadius(){return hrt(this.radius)}set blurRadius(e){const t=this.maxPixelIntensity,r=this.minPixelIntensity;this._set("radius",urt(e)),this._warnAboutDeprecatedGaussianBlurProp("blurRadius","radius"),this._set("maxDensity",t*this._pixelIntensityToDensity),this._set("minDensity",r*this._pixelIntensityToDensity)}get maxPixelIntensity(){return this.maxDensity/this._pixelIntensityToDensity}set maxPixelIntensity(e){this._set("maxDensity",e*this._pixelIntensityToDensity),this._warnAboutDeprecatedGaussianBlurProp("maxPixelIntensity","maxDensity")}get minPixelIntensity(){return this.minDensity/this._pixelIntensityToDensity}set minPixelIntensity(e){this._set("minDensity",e*this._pixelIntensityToDensity),this._warnAboutDeprecatedGaussianBlurProp("minPixelIntensity","minDensity")}get _pixelIntensityToDensity(){return 24/(mne**2*this.blurRadius**4)}_warnAboutDeprecatedGaussianBlurProp(e,t){this._warnedProps[e]||Do(this).getDefaultOrigin()==="user"&&(this._warnedProps[e]=!0,X9(()=>{AFe(grt,e,{replacement:`${String(t)} (suggested value: ${this._get(t)})`,version:"4.24"})}))}read(e,t){e=Lhe(e),super.read(e,t)}getSymbol(){const e=this.referenceScale!==0?5:1,t=Math.min(this.radius*e,zs(256));return new nc({size:t})}async getSymbolAsync(){return this.getSymbol()}getSymbols(){return[this.getSymbol()]}async collectRequiredFields(e,t){const r=this.field,i=this.valueExpression;r&&typeof r=="string"&&await Uh(e,t,r),i&&typeof i=="string"&&await uc(e,t,i)}getAttributeHash(){return null}getMeshHash(){return`${JSON.stringify(this.colorStops)}.${this.blurRadius}.${this.field}`}clone(){return new OQ({colorStops:te(this.colorStops),field:this.field,legendOptions:te(this.legendOptions),maxDensity:this.maxDensity,minDensity:this.minDensity,radius:this.radius,referenceScale:this.referenceScale,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle})}};d([f({type:l6e,json:{write:!1}})],ya.prototype,"authoringInfo",void 0),d([f({type:Number,json:{origins:{"portal-item":{write:!0},"web-map":{write:!0}}}})],ya.prototype,"blurRadius",null),d([f({type:[JC],json:{write:!0}})],ya.prototype,"colorStops",void 0),d([f({type:String,json:{write:!0}})],ya.prototype,"field",void 0),d([f({type:Number,json:{write:{overridePolicy:(e,t,r)=>({enabled:r==null})},origins:{"web-scene":{write:!1}}}})],ya.prototype,"fieldOffset",void 0),d([f({type:mS,json:{write:!0}})],ya.prototype,"legendOptions",void 0),d([f({type:Number,json:{write:!0}})],ya.prototype,"maxDensity",void 0),d([f({type:Number,json:{origins:{"portal-item":{write:!0},"web-map":{write:!0}}}})],ya.prototype,"maxPixelIntensity",null),d([f({type:Number,json:{write:!0}})],ya.prototype,"minDensity",void 0),d([f({type:Number,json:{origins:{"portal-item":{write:!0},"web-map":{write:!0}}}})],ya.prototype,"minPixelIntensity",null),d([f({type:Number,cast:Xr,json:{write:!0}})],ya.prototype,"radius",void 0),d([f({type:Number,range:{min:0},json:{default:0,write:!0}})],ya.prototype,"referenceScale",void 0),d([Ze({heatmap:"heatmap"})],ya.prototype,"type",void 0),d([f({type:String,json:{write:!0,origins:{"web-document":{write:!1},"portal-item":{write:!1}}}})],ya.prototype,"valueExpression",void 0),d([f({type:String})],ya.prototype,"valueExpressionTitle",void 0),d([f({readOnly:!0})],ya.prototype,"_pixelIntensityToDensity",null),ya=OQ=d([$("esri.renderers.HeatmapRenderer")],ya);const O6e=ya;let w3=class extends yd(ge){constructor(){super(...arguments),this.color=new Te([0,0,0,0]),this.label=null,this.threshold=0}};d([f({type:Te,json:{write:!0}})],w3.prototype,"color",void 0),d([f({type:String,json:{write:!0}})],w3.prototype,"label",void 0),d([f({type:Number,range:{min:0,max:1},json:{write:!0}})],w3.prototype,"threshold",void 0),w3=d([$("esri.renderers.support.OthersCategory")],w3);let LL=class extends yd(ge){constructor(){super(...arguments),this.title=null}};d([f({type:String,json:{write:!0}})],LL.prototype,"title",void 0),LL=d([$("esri.renderers.support.PieChartLegendOptions")],LL);let Ld=class extends p6(yd(Hy)){constructor(e){super(e),this.attributes=null,this.backgroundFillSymbol=null,this.defaultColor=new Te([0,0,0,0]),this.defaultLabel=null,this.holePercentage=0,this.othersCategory=new w3,this.legendOptions=null,this.outline=null,this.size=12,this.type="pie-chart"}getSymbol(){var e;return new nc({size:this.size?this.size/2+(((e=this.outline)==null?void 0:e.width)||0):0})}async getSymbolAsync(){return this.getSymbol()}getSymbols(){return[this.getSymbol(),this.backgroundFillSymbol]}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce((e,t)=>e+t.getAttributeHash(),"")}getMeshHash(){return this.getSymbols().reduce((e,t)=>e+JSON.stringify(t),"")}async collectRequiredFields(e,t){await this.collectVVRequiredFields(e,t);for(const r of this.attributes)r.valueExpression&&await uc(e,t,r.valueExpression),r.field&&e.add(r.field)}};d([f({type:[A6e],json:{write:!0}})],Ld.prototype,"attributes",void 0),d([f({type:kp,json:{default:null,write:!0}})],Ld.prototype,"backgroundFillSymbol",void 0),d([f({type:Te,json:{write:!0}})],Ld.prototype,"defaultColor",void 0),d([f({type:String,json:{write:!0}})],Ld.prototype,"defaultLabel",void 0),d([f({type:Number,range:{min:0,max:1},json:{write:!0}})],Ld.prototype,"holePercentage",void 0),d([f({type:w3,json:{write:!0}})],Ld.prototype,"othersCategory",void 0),d([f({type:LL,json:{write:!0}})],Ld.prototype,"legendOptions",void 0),d([f({type:bc,json:{default:null,write:!0}})],Ld.prototype,"outline",void 0),d([f({type:Number,cast:Xr,json:{write:!0}})],Ld.prototype,"size",void 0),d([Ze({pieChart:"pie-chart"})],Ld.prototype,"type",void 0),Ld=d([$("esri.renderers.PieChartRenderer")],Ld);const yrt=Ld;var MQ;let N2=MQ=class extends p6(Hy){constructor(e){super(e),this.description=null,this.label=null,this.symbol=null,this.type="simple"}async collectRequiredFields(e,t){await Promise.all([this.collectSymbolFields(e,t),this.collectVVRequiredFields(e,t)])}async collectSymbolFields(e,t){await Promise.all(this.getSymbols().map(r=>r.collectRequiredFields(e,t)))}getSymbol(e,t){return this.symbol}async getSymbolAsync(e,t){return this.symbol}getSymbols(){return this.symbol?[this.symbol]:[]}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce((e,t)=>e+t.getAttributeHash(),"")}getMeshHash(){return this.getSymbols().reduce((e,t)=>e+JSON.stringify(t),"")}get arcadeRequired(){return this.arcadeRequiredForVisualVariables}clone(){return new MQ({description:this.description,label:this.label,symbol:this.symbol&&this.symbol.clone(),visualVariables:te(this.visualVariables),authoringInfo:this.authoringInfo&&this.authoringInfo.clone()})}};d([f({type:String,json:{write:!0}})],N2.prototype,"description",void 0),d([f({type:String,json:{write:!0}})],N2.prototype,"label",void 0),d([f(hO)],N2.prototype,"symbol",void 0),d([Ze({simple:"simple"})],N2.prototype,"type",void 0),N2=MQ=d([$("esri.renderers.SimpleRenderer")],N2);const gne=N2,brt=["esri.Color","esri.portal.Portal","esri.symbols.support.Symbol3DAnchorPosition2D","esri.symbols.support.Symbol3DAnchorPosition3D"];function PQ(e){return e instanceof xe}function Dhe(e){return e instanceof lt?Object.keys(e.items):PQ(e)?Do(e).keys():e?Object.keys(e):[]}function lP(e,t){return e instanceof lt?e.items[t]:e[t]}function vrt(e,t){return!(!Array.isArray(e)||!Array.isArray(t))&&e.length!==t.length}function i7(e){return e?e.declaredClass:null}function M6e(e,t){const r=e.diff;if(r&&typeof r=="function")return r(e,t);const i=Dhe(e),n=Dhe(t);if(i.length===0&&n.length===0)return;if(!i.length||!n.length||vrt(e,t))return{type:"complete",oldValue:e,newValue:t};const s=n.filter(h=>!i.includes(h)),a=i.filter(h=>!n.includes(h)),o=i.filter(h=>n.includes(h)&&lP(e,h)!==lP(t,h)).concat(s,a).sort(),l=i7(e);if(l&&brt.includes(l)&&o.length)return{type:"complete",oldValue:e,newValue:t};let c;const u=PQ(e)&&PQ(t);for(const h of o){const p=lP(e,h),m=lP(t,h);let g;if((u||typeof p!="function"&&typeof m!="function")&&p!==m&&(p!=null||m!=null)){if(r&&r[h]&&typeof r[h]=="function")g=r[h](p,m);else if(p instanceof Date&&m instanceof Date){if(p.getTime()===m.getTime())continue;g={type:"complete",oldValue:p,newValue:m}}else g=typeof p=="object"&&typeof m=="object"&&i7(p)===i7(m)?M6e(p,m):{type:"complete",oldValue:p,newValue:m};_(g)&&(_(c)?c.diff[h]=g:c={type:"partial",diff:{[h]:g}})}}return c}function _rt(e,t){if(R(e))return!1;const r=t.split(".");let i=e;for(const n of r){if(i.type==="complete")return!0;if(i.type!=="partial")return!1;{const s=i.diff[n];if(!s)return!1;i=s}}return!0}function Q$t(e,t){for(const r of t)if(_rt(e,r))return!0;return!1}function wrt(e,t){if(!(typeof e=="function"||typeof t=="function"||R(e)&&R(t)))return R(e)||R(t)||typeof e=="object"&&typeof t=="object"&&i7(e)!==i7(t)?{type:"complete",oldValue:e,newValue:t}:M6e(e,t)}function cP(e){if(R(e))return!0;switch(e.type){case"complete":return!1;case"collection":{const t=e;for(const r of t.added)if(!cP(r))return!1;for(const r of t.removed)if(!cP(r))return!1;for(const r of t.changed)if(!cP(r))return!1;return!0}case"partial":for(const t in e.diff)if(!cP(e.diff[t]))return!1;return!0}}var IQ;let s1=IQ=class extends ge{constructor(e){super(e),this.description=null,this.label=null,this.symbol=null,this.value=null}castValue(e){return e==null||typeof e=="string"||typeof e=="number"?e:`${e}`}clone(){return new IQ({value:this.value,description:this.description,label:this.label,symbol:this.symbol?this.symbol.clone():null})}getMeshHash(){const e=JSON.stringify(this.symbol&&this.symbol.toJSON());return`${this.value}.${e}`}};d([f({type:String,json:{write:!0}})],s1.prototype,"description",void 0),d([f({type:String,json:{write:!0}})],s1.prototype,"label",void 0),d([f(hO)],s1.prototype,"symbol",void 0),d([f({json:{type:String,write:{writer:(e,t)=>{t.value=e==null?void 0:e.toString()}}}})],s1.prototype,"value",void 0),d([Xt("value")],s1.prototype,"castValue",null),s1=IQ=d([$("esri.renderers.support.UniqueValueInfo")],s1);const ON=s1,xrt=()=>!!ue("enable-feature:force-wosr"),J$t=()=>!!ue("enable-feature:direct-3d-object-feature-layer-display"),JG={};async function Trt(e,t){try{return{data:(await yne(e,t)).data,baseUrl:jte(e),styleUrl:e}}catch(r){return pu(r),null}}function Srt(e,t,r){const i=_(t.portal)?t.portal:Cs.getDefault();let n;const s=`${i.url} - ${i.user&&i.user.username} - ${e}`;return JG[s]||(JG[s]=Ert(e,i,r).then(a=>(n=a,a.fetchData())).then(a=>({data:a,baseUrl:n.itemUrl,styleName:e}))),JG[s]}function Ert(e,t,r){return t.load(r).then(()=>{const i=new jg({disableExtraQuery:!0,query:`owner:${Fhe} AND type:${Nhe} AND typekeywords:"${e}"`});return t.queryItems(i,r)}).then(({results:i})=>{let n=null;const s=e.toLowerCase();if(i&&Array.isArray(i)){for(const a of i)if(a.typeKeywords.some(o=>o.toLowerCase()===s)&&a.type===Nhe&&a.owner===Fhe){n=a;break}}if(!n)throw new k("symbolstyleutils:style-not-found",`The style '${e}' could not be found`,{styleName:e});return n.load(r)})}function P6e(e,t,r){return e.styleUrl?Trt(e.styleUrl,r):e.styleName?Srt(e.styleName,t,r):Promise.reject(new k("symbolstyleutils:style-url-and-name-missing","Either styleUrl or styleName is required to resolve a style"))}function I6e(e){return e===null||e.type==="CIMSymbolReference"?e:{type:"CIMSymbolReference",symbol:e}}function Crt(e,t){if(t==="cimRef")return e.cimRef;if(e.formatInfos&&!xrt()){for(const r of e.formatInfos)if(r.type==="gltf")return r.href}return e.webRef}function yne(e,t){const r={responseType:"json",query:{f:"json"},...t};return qt(zh(e),r)}const Fhe="esri_en",Nhe="Style",Art="https://cdn.arcgis.com/sharing/rest/content/items/220936cc6ed342c9937abd8f180e7d1e/resources/styles/cim/{SymbolName}.json?f=json";var BE;const I_=fe.getLogger("esri.renderers.UniqueValueRenderer"),Rrt=rs(ON);let zn=BE=class extends p6(Hy){constructor(e){super(e),this._valueInfoMap={},this._isDefaultSymbolDerived=!1,this.type="unique-value",this.backgroundFillSymbol=null,this.field=null,this.field2=null,this.field3=null,this.valueExpression=null,this.valueExpressionTitle=null,this.legendOptions=null,this.defaultLabel=null,this.fieldDelimiter=null,this.portal=null,this.styleOrigin=null,this.diff={uniqueValueInfos(t,r){if(!t&&!r)return;if(!t||!r)return{type:"complete",oldValue:t,newValue:r};let i=!1;const n={type:"collection",added:[],removed:[],changed:[],unchanged:[]};for(let s=0;s<r.length;s++){const a=t.find(o=>o.value===r[s].value);a?wrt(a,r[s])?(n.changed.push({type:"complete",oldValue:a,newValue:r[s]}),i=!0):n.unchanged.push({oldValue:a,newValue:r[s]}):(n.added.push(r[s]),i=!0)}for(let s=0;s<t.length;s++)r.find(a=>a.value===t[s].value)||(n.removed.push(t[s]),i=!0);return i?n:void 0}},this._set("uniqueValueInfos",[])}get _cache(){return{compiledFunc:null}}castField(e){return e==null||typeof e=="function"?e:WR(e)}writeField(e,t,r,i){typeof e=="string"?t[r]=e:i&&i.messages?i.messages.push(new k("property:unsupported","UniqueValueRenderer.field set to a function cannot be written to JSON")):I_.error(".field: cannot write field to JSON since it's not a string value")}set defaultSymbol(e){this._isDefaultSymbolDerived=!1,this._set("defaultSymbol",e)}readPortal(e,t,r){return r.portal||Cs.getDefault()}readStyleOrigin(e,t,r){if(t.styleName)return Object.freeze({styleName:t.styleName});if(t.styleUrl){const i=My(t.styleUrl,r);return Object.freeze({styleUrl:i})}}writeStyleOrigin(e,t,r,i){e.styleName?t.styleName=e.styleName:e.styleUrl&&(t.styleUrl=Py(e.styleUrl,i))}set uniqueValueInfos(e){this.styleOrigin?I_.error("#uniqueValueInfos=","Cannot modify unique value infos of a UniqueValueRenderer created from a web style"):(this._set("uniqueValueInfos",e),this._updateValueInfoMap())}addUniqueValueInfo(e,t){if(this.styleOrigin)return void I_.error("#addUniqueValueInfo()","Cannot modify unique value infos of a UniqueValueRenderer created from a web style");let r;r=typeof e=="object"?Rrt(e):new ON({value:e,symbol:sTe(t)}),this.uniqueValueInfos.push(r),this._valueInfoMap[r.value]=r}removeUniqueValueInfo(e){if(this.styleOrigin)I_.error("#removeUniqueValueInfo()","Cannot modify unique value infos of a UniqueValueRenderer created from a web style");else for(let t=0;t<this.uniqueValueInfos.length;t++)if(this.uniqueValueInfos[t].value===e+""){delete this._valueInfoMap[e],this.uniqueValueInfos.splice(t,1);break}}async getUniqueValueInfo(e,t){let r=t;return this.valueExpression&&(R(t)||R(t.arcade))&&(r={...r,arcade:await Wh()}),this._getUniqueValueInfo(e,r)}getSymbol(e,t){if(this.valueExpression&&(R(t)||R(t.arcade)))return void I_.error("#getSymbol()","Please use getSymbolAsync if valueExpression is used");const r=this._getUniqueValueInfo(e,t);return r&&r.symbol||this.defaultSymbol}async getSymbolAsync(e,t){let r=t;if(this.valueExpression&&(R(r)||R(r.arcade))){const n=await Wh(),{arcadeUtils:s}=n;s.hasGeometryOperations(this.valueExpression)&&await s.enableGeometryOperations(),r={...r,arcade:n}}const i=this._getUniqueValueInfo(e,r);return i&&i.symbol||this.defaultSymbol}getSymbols(){const e=[];for(const t of this.uniqueValueInfos)t.symbol&&e.push(t.symbol);return this.defaultSymbol&&e.push(this.defaultSymbol),e}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce((e,t)=>e+t.getAttributeHash(),"")}getMeshHash(){return`${JSON.stringify(this.backgroundFillSymbol)}.${JSON.stringify(this.defaultSymbol)}.${this.uniqueValueInfos.reduce((e,t)=>e+t.getMeshHash(),"")}.${`${this.field}.${this.field2}.${this.field3}.${this.fieldDelimiter}`}.${this.valueExpression}`}clone(){const e=new BE({field:this.field,field2:this.field2,field3:this.field3,defaultLabel:this.defaultLabel,defaultSymbol:te(this.defaultSymbol),valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,fieldDelimiter:this.fieldDelimiter,visualVariables:te(this.visualVariables),legendOptions:te(this.legendOptions),authoringInfo:this.authoringInfo&&this.authoringInfo.clone(),backgroundFillSymbol:te(this.backgroundFillSymbol)});this._isDefaultSymbolDerived&&(e._isDefaultSymbolDerived=!0),e._set("portal",this.portal);const t=te(this.uniqueValueInfos);return this.styleOrigin&&(e._set("styleOrigin",Object.freeze(te(this.styleOrigin))),Object.freeze(t)),e._set("uniqueValueInfos",t),e._updateValueInfoMap(),e}get arcadeRequired(){return this.arcadeRequiredForVisualVariables||!!this.valueExpression}async collectRequiredFields(e,t){const r=[this.collectVVRequiredFields(e,t),this.collectSymbolFields(e,t)];await Promise.all(r)}async collectSymbolFields(e,t){const r=[...this.getSymbols().map(i=>i.collectRequiredFields(e,t)),uc(e,t,this.valueExpression)];Uh(e,t,this.field),Uh(e,t,this.field2),Uh(e,t,this.field3),await Promise.all(r)}populateFromStyle(){return P6e(this.styleOrigin,{portal:this.portal}).then(e=>{const t=[];return this._valueInfoMap={},e&&e.data&&Array.isArray(e.data.items)&&e.data.items.forEach(r=>{const i=new Sx({styleUrl:e.styleUrl,styleName:e.styleName,portal:this.portal,name:r.name});this.defaultSymbol||r.name!==e.data.defaultItem||(this.defaultSymbol=i,this._isDefaultSymbolDerived=!0);const n=new ON({value:r.name,symbol:i});t.push(n),this._valueInfoMap[r.name]=n}),this._set("uniqueValueInfos",Object.freeze(t)),!this.defaultSymbol&&this.uniqueValueInfos.length&&(this.defaultSymbol=this.uniqueValueInfos[0].symbol,this._isDefaultSymbolDerived=!0),this})}_updateValueInfoMap(){this._valueInfoMap={},this.uniqueValueInfos.forEach(e=>this._valueInfoMap[e.value+""]=e)}_getUniqueValueInfo(e,t){return this.valueExpression?this._getUnqiueValueInfoForExpression(e,t):this._getUnqiueValueInfoForFields(e)}_getUnqiueValueInfoForExpression(e,t){const{viewingMode:r,scale:i,spatialReference:n,arcade:s}=vt(t,{});let a=this._cache.compiledFunc;const o=s.arcadeUtils;if(!a){const c=o.createSyntaxTree(this.valueExpression);a=o.createFunction(c),this._cache.compiledFunc=a}const l=o.executeFunction(a,o.createExecContext(e,o.getViewInfo({viewingMode:r,scale:i,spatialReference:n})));return this._valueInfoMap[l+""]}_getUnqiueValueInfoForFields(e){const t=this.field,r=e.attributes;let i;if(typeof t!="function"&&this.field2){const n=this.field2,s=this.field3,a=[];t&&a.push(r[t]),n&&a.push(r[n]),s&&a.push(r[s]),i=a.join(this.fieldDelimiter||"")}else typeof t=="function"?i=t(e):t&&(i=r[t]);return this._valueInfoMap[i+""]}static fromPortalStyle(e,t){const r=new BE(t&&t.properties);r._set("styleOrigin",Object.freeze({styleName:e})),r._set("portal",t&&t.portal||Cs.getDefault());const i=r.populateFromStyle();return i.catch(n=>{I_.error(`#fromPortalStyle('${e}'[, ...])`,"Failed to create unique value renderer from style name",n)}),i}static fromStyleUrl(e,t){const r=new BE(t&&t.properties);r._set("styleOrigin",Object.freeze({styleUrl:e}));const i=r.populateFromStyle();return i.catch(n=>{I_.error(`#fromStyleUrl('${e}'[, ...])`,"Failed to create unique value renderer from style URL",n)}),i}};d([f({readOnly:!0})],zn.prototype,"_cache",null),d([Ze({uniqueValue:"unique-value"})],zn.prototype,"type",void 0),d([f(T6e)],zn.prototype,"backgroundFillSymbol",void 0),d([f({json:{type:String,read:{source:"field1"},write:{target:"field1"}}})],zn.prototype,"field",void 0),d([Xt("field")],zn.prototype,"castField",null),d([Xe("field")],zn.prototype,"writeField",null),d([f({type:String,json:{write:!0}})],zn.prototype,"field2",void 0),d([f({type:String,json:{write:!0}})],zn.prototype,"field3",void 0),d([f({type:String,json:{write:!0}})],zn.prototype,"valueExpression",void 0),d([f({type:String,json:{write:!0}})],zn.prototype,"valueExpressionTitle",void 0),d([f({type:nm,json:{write:!0}})],zn.prototype,"legendOptions",void 0),d([f({type:String,json:{write:!0}})],zn.prototype,"defaultLabel",void 0),d([f($2e({...hO},{json:{write:{overridePolicy(){return{enabled:!this._isDefaultSymbolDerived}}},origins:{"web-scene":{write:{overridePolicy(){return{enabled:!this._isDefaultSymbolDerived}}}}}}}))],zn.prototype,"defaultSymbol",null),d([f({type:String,json:{write:!0}})],zn.prototype,"fieldDelimiter",void 0),d([f({type:Cs,readOnly:!0})],zn.prototype,"portal",void 0),d([$e("portal",["styleName"])],zn.prototype,"readPortal",null),d([f({readOnly:!0,json:{write:{enabled:!1,overridePolicy:()=>({enabled:!0})}}})],zn.prototype,"styleOrigin",void 0),d([$e("styleOrigin",["styleName","styleUrl"])],zn.prototype,"readStyleOrigin",null),d([Xe("styleOrigin",{styleName:{type:String},styleUrl:{type:String}})],zn.prototype,"writeStyleOrigin",null),d([f({type:[ON],json:{write:{overridePolicy(){return this.styleOrigin?{enabled:!1}:{enabled:!0}}}}})],zn.prototype,"uniqueValueInfos",null),zn=BE=d([$("esri.renderers.UniqueValueRenderer")],zn);const bz=zn,fO={key:"type",base:Hy,typeMap:{heatmap:O6e,simple:gne,"unique-value":bz,"class-breaks":E6e,"dot-density":drt,dictionary:ort,"pie-chart":yrt},errorContext:"renderer"},bne={key:"type",base:Hy,typeMap:{simple:gne,"unique-value":bz,"class-breaks":E6e,heatmap:O6e},errorContext:"renderer"};function $6e(e,t){return L6e(e,null,t)}const Ort=Y9({types:fO});function L6e(e,t,r){return e?e&&(e.styleName||e.styleUrl)&&e.type!=="uniqueValue"?(r&&r.messages&&r.messages.push(new cc("renderer:unsupported","Only UniqueValueRenderer can be referenced from a web style, but found '"+e.type+"'",{definition:e,context:r})),null):Ort(e,t,r):null}class vne{constructor(){this._propertyOriginMap=new Map,this._originStores=new Array(XW),this._values=new Map,this.multipleOriginsSupported=!0}clone(t){const r=new vne,i=this._originStores[Gt.DEFAULTS];i&&i.forEach((n,s)=>{r.set(s,te(n),Gt.DEFAULTS)});for(let n=Gt.SERVICE;n<XW;n++){const s=this._originStores[n];s&&s.forEach((a,o)=>{t&&t.has(o)||r.set(o,te(a),n)})}return r}get(t,r){const i=r===void 0?this._values:this._originStores[r];return i?i.get(t):void 0}keys(t){const r=t==null?this._values:this._originStores[t];return r?[...r.keys()]:[]}set(t,r,i=Gt.USER){let n=this._originStores[i];if(n||(n=new Map,this._originStores[i]=n),n.set(t,r),!this._values.has(t)||this._propertyOriginMap.get(t)<=i){const s=this._values.get(t);return this._values.set(t,r),this._propertyOriginMap.set(t,i),s!==r}return!1}delete(t,r=Gt.USER){const i=this._originStores[r];if(!i)return;const n=i.get(t);if(i.delete(t),this._values.has(t)&&this._propertyOriginMap.get(t)===r){this._values.delete(t);for(let s=r-1;s>=0;s--){const a=this._originStores[s];if(a&&a.has(t)){this._values.set(t,a.get(t)),this._propertyOriginMap.set(t,s);break}}}return n}has(t,r){const i=r===void 0?this._values:this._originStores[r];return!!i&&i.has(t)}revert(t,r){for(;r>0&&!this.has(t,r);)--r;const i=this._originStores[r],n=i&&i.get(t),s=this._values.get(t);return this._values.set(t,n),this._propertyOriginMap.set(t,r),s!==n}originOf(t){return this._propertyOriginMap.get(t)||Gt.DEFAULTS}forEach(t){this._values.forEach(t)}}const D6e=e=>{let t=class extends e{constructor(...r){super(...r);const i=Do(this),n=i.store,s=new vne;i.store=s,_3e(i,n,s)}read(r,i){x3e(this,r,i)}getAtOrigin(r,i){const n=KG(this),s=Zg(i);if(typeof r=="string")return n.get(r,s);const a={};return r.forEach(o=>{a[o]=n.get(o,s)}),a}originOf(r){return bF(this.originIdOf(r))}originIdOf(r){return KG(this).originOf(r)}revert(r,i){const n=KG(this),s=Zg(i),a=Do(this);let o;o=typeof r=="string"?r==="*"?n.keys(s):[r]:r,o.forEach(l=>{a.invalidate(l),n.revert(l,s),a.commit(l)})}};return t=d([$("esri.core.ReadOnlyMultiOriginJSONSupport")],t),t};function KG(e){return Do(e).store}let khe=class extends D6e(xe){};khe=d([$("esri.core.ReadOnlyMultiOriginJSONSupport")],khe);const Mrt=e=>{let t=class extends e{constructor(...r){super(...r)}clear(r,i="user"){return ej(this).delete(r,Zg(i))}write(r={},i){return S3e(this,r=r||{},i),r}setAtOrigin(r,i,n){Do(this).setAtOrigin(r,i,Zg(n))}removeOrigin(r){const i=ej(this),n=Zg(r),s=i.keys(n);for(const a of s)i.originOf(a)===n&&i.set(a,i.get(a,n),Gt.USER)}updateOrigin(r,i){const n=ej(this),s=Zg(i),a=this.get(r);for(let o=s+1;o<XW;++o)n.delete(r,o);n.set(r,a,s)}toJSON(r){return this.write({},r)}};return t=d([$("esri.core.WriteableMultiOriginJSONSupport")],t),t.prototype.toJSON.isDefaultToJSON=!0,t};function ej(e){return Do(e).store}const vz=e=>{let t=class extends Mrt(D6e(e)){constructor(...r){super(...r)}};return t=d([$("esri.core.MultiOriginJSONSupport")],t),t};let Vhe=class extends vz(xe){};Vhe=d([$("esri.core.MultiOriginJSONSupport")],Vhe);async function Prt(e,t){const{WhereClause:r}=await ie(()=>import("./WhereClause.ecb0bafc.js"),[],import.meta.url);return r.create(e,t)}function F6e(e,t){return _(e)?_(t)?`(${e}) AND (${t})`:e:t}var $Q;let k2=$Q=class extends ge{constructor(e){super(e),this.expression=null,this.name=null,this.returnType="boolean",this.title=null}clone(){return new $Q({name:this.name,title:this.title,expression:this.expression,returnType:this.returnType})}};d([f({type:String,json:{write:!0}})],k2.prototype,"expression",void 0),d([f({type:String,json:{write:!0}})],k2.prototype,"name",void 0),d([f({type:["boolean","date","number","string"],json:{write:!0}})],k2.prototype,"returnType",void 0),d([f({type:String,json:{write:!0}})],k2.prototype,"title",void 0),k2=$Q=d([$("esri.form.ExpressionInfo")],k2);const Irt=k2;let V2=class extends ge{constructor(e){super(e),this.description=null,this.label=null,this.type=null,this.visibilityExpression=null}};d([f({type:String,json:{write:!0}})],V2.prototype,"description",void 0),d([f({type:String,json:{write:!0}})],V2.prototype,"label",void 0),d([f()],V2.prototype,"type",void 0),d([f({type:String,json:{write:!0}})],V2.prototype,"visibilityExpression",void 0),V2=d([$("esri.form.elements.Element")],V2);const c9=V2;var LQ;let DL=LQ=class extends ge{constructor(e){super(e),this.type=null}clone(){return new LQ({type:this.type})}};d([f({type:["attachment","audio","document","image","signature","video"],json:{write:!0}})],DL.prototype,"type",void 0),DL=LQ=d([$("esri.form.elements.inputs.AttachmentInput")],DL);const $rt=DL;var DQ;let z2=DQ=class extends c9{constructor(e){super(e),this.attachmentKeyword=null,this.editable=!0,this.input=null,this.type="attachment"}clone(){return new DQ({attachmentKeyword:this.attachmentKeyword,description:this.description,editable:this.editable,input:this.input,label:this.label,visibilityExpression:this.visibilityExpression})}};d([f({type:String,json:{write:!0}})],z2.prototype,"attachmentKeyword",void 0),d([f({type:Boolean,json:{write:!0}})],z2.prototype,"editable",void 0),d([f({type:$rt,json:{read:{source:"inputType"},write:{target:"inputType"}}})],z2.prototype,"input",void 0),d([f({type:["attachment"],json:{read:!1,write:!0}})],z2.prototype,"type",void 0),z2=DQ=d([$("esri.form.elements.AttachmentElement")],z2);const zhe=z2;let FL=class extends ge{constructor(e){super(e),this.type=null}};d([f()],FL.prototype,"type",void 0),FL=d([$("esri.form.elements.inputs.Input")],FL);const m6=FL;let GE=class extends m6{constructor(e){super(e),this.maxLength=null,this.minLength=0}};d([f({type:Number,json:{write:!0}})],GE.prototype,"maxLength",void 0),d([f({type:Number,json:{write:!0}})],GE.prototype,"minLength",void 0),GE=d([$("esri.form.elements.inputs.TextInput")],GE);const _ne=GE;var FQ;let NL=FQ=class extends _ne{constructor(e){super(e),this.type="barcode-scanner"}clone(){return new FQ({maxLength:this.maxLength,minLength:this.minLength})}};d([f({type:["barcode-scanner"],json:{read:!1,write:!0}})],NL.prototype,"type",void 0),NL=FQ=d([$("esri.form.elements.inputs.BarcodeScannerInput")],NL);const Lrt=NL;var NQ;let gS=NQ=class extends m6{constructor(e){super(e),this.noValueOptionLabel=null,this.showNoValueOption=!1,this.type="combo-box"}clone(){return new NQ({showNoValueOption:this.showNoValueOption,noValueOptionLabel:this.noValueOptionLabel})}};d([f({type:String,json:{write:!0}})],gS.prototype,"noValueOptionLabel",void 0),d([f({type:Boolean,json:{write:!0}})],gS.prototype,"showNoValueOption",void 0),d([f({type:["combo-box"],json:{read:!1,write:!0}})],gS.prototype,"type",void 0),gS=NQ=d([$("esri.form.elements.inputs.ComboBoxInput")],gS);const Drt=gS;var kQ;function Uhe(e){return e!=null?new Date(e):null}function Bhe(e){return e?e.getTime():null}let Lf=kQ=class extends m6{constructor(e){super(e),this.includeTime=!1,this.max=null,this.min=null,this.type="datetime-picker"}readMax(e,t){return Uhe(t.max)}writeMax(e,t){t.max=Bhe(e)}readMin(e,t){return Uhe(t.min)}writeMin(e,t){t.min=Bhe(e)}clone(){return new kQ({includeTime:this.includeTime,max:this.max,min:this.min,type:this.type})}};d([f({type:Boolean,json:{write:!0}})],Lf.prototype,"includeTime",void 0),d([f({type:Date,json:{type:Number,write:!0}})],Lf.prototype,"max",void 0),d([$e("max")],Lf.prototype,"readMax",null),d([Xe("max")],Lf.prototype,"writeMax",null),d([f({type:Date,json:{type:Number,write:!0}})],Lf.prototype,"min",void 0),d([$e("min")],Lf.prototype,"readMin",null),d([Xe("min")],Lf.prototype,"writeMin",null),d([f({type:["datetime-picker"],json:{read:!1,write:!0}})],Lf.prototype,"type",void 0),Lf=kQ=d([$("esri.form.elements.inputs.DateTimePickerInput")],Lf);const Frt=Lf;var VQ;let yS=VQ=class extends m6{constructor(e){super(e),this.noValueOptionLabel=null,this.showNoValueOption=!1,this.type="radio-buttons"}clone(){return new VQ({noValueOptionLabel:this.noValueOptionLabel,showNoValueOption:this.showNoValueOption})}};d([f({type:String,json:{write:!0}})],yS.prototype,"noValueOptionLabel",void 0),d([f({type:Boolean,json:{write:!0}})],yS.prototype,"showNoValueOption",void 0),d([f({type:["radio-buttons"],json:{read:!1,write:!0}})],yS.prototype,"type",void 0),yS=VQ=d([$("esri.form.elements.inputs.RadioButtonsInput")],yS);const Nrt=yS;var zQ;let bS=zQ=class extends m6{constructor(e){super(e),this.offValue=null,this.onValue=null,this.type="switch"}clone(){return new zQ({offValue:this.offValue,onValue:this.onValue})}};d([f({type:[String,Number],json:{write:!0}})],bS.prototype,"offValue",void 0),d([f({type:[String,Number],json:{write:!0}})],bS.prototype,"onValue",void 0),d([f({type:["switch"],json:{read:!1,write:!0}})],bS.prototype,"type",void 0),bS=zQ=d([$("esri.form.elements.inputs.SwitchInput")],bS);const krt=bS;var UQ;let kL=UQ=class extends _ne{constructor(e){super(e),this.type="text-area"}clone(){return new UQ({maxLength:this.maxLength,minLength:this.minLength})}};d([f({type:["text-area"],json:{read:!1,write:!0}})],kL.prototype,"type",void 0),kL=UQ=d([$("esri.form.elements.inputs.TextAreaInput")],kL);const Vrt=kL;var BQ;let VL=BQ=class extends _ne{constructor(e){super(e),this.type="text-box"}clone(){return new BQ({maxLength:this.maxLength,minLength:this.minLength})}};d([f({type:["text-box"],json:{read:!1,write:!0}})],VL.prototype,"type",void 0),VL=BQ=d([$("esri.form.elements.inputs.TextBoxInput")],VL);const zrt=VL,Urt={base:m6,key:"type",typeMap:{"barcode-scanner":Lrt,"combo-box":Drt,"datetime-picker":Frt,"radio-buttons":Nrt,switch:krt,"text-area":Vrt,"text-box":zrt}};var GQ;let ih=GQ=class extends c9{constructor(e){super(e),this.domain=null,this.editable=!0,this.editableExpression=null,this.fieldName=null,this.hint=null,this.input=null,this.requiredExpression=null,this.type="field",this.valueExpression=null}clone(){return new GQ({description:this.description,domain:this.domain,editable:this.editable,editableExpression:this.editableExpression,fieldName:this.fieldName,hint:this.hint,input:this.input,label:this.label,requiredExpression:this.requiredExpression,valueExpression:this.valueExpression,visibilityExpression:this.visibilityExpression})}};d([f({types:E5e,json:{read:{reader:Uie},write:!0}})],ih.prototype,"domain",void 0),d([f({type:Boolean,json:{write:!0}})],ih.prototype,"editable",void 0),d([f({type:String,json:{write:!0}})],ih.prototype,"editableExpression",void 0),d([f({type:String,json:{write:!0}})],ih.prototype,"fieldName",void 0),d([f({type:String,json:{write:!0}})],ih.prototype,"hint",void 0),d([f({types:Urt,json:{read:{source:"inputType"},write:{target:"inputType"}}})],ih.prototype,"input",void 0),d([f({type:String,json:{write:!0}})],ih.prototype,"requiredExpression",void 0),d([f({type:String,json:{read:!1,write:!0}})],ih.prototype,"type",void 0),d([f({type:String,json:{write:!0}})],ih.prototype,"valueExpression",void 0),ih=GQ=d([$("esri.form.elements.FieldElement")],ih);const Ghe=ih;var jQ;let hg=jQ=class extends c9{constructor(e){super(e),this.displayCount=null,this.displayType="list",this.editable=!0,this.orderByFields=null,this.relationshipId=null,this.type="relationship"}clone(){return new jQ({description:this.description,displayCount:this.displayCount,displayType:this.displayType,editable:this.editable,label:this.label,orderByFields:te(this.orderByFields),relationshipId:this.relationshipId,visibilityExpression:this.visibilityExpression})}};d([f({type:Number,json:{write:!0}})],hg.prototype,"displayCount",void 0),d([f({type:["list"],json:{write:!0}})],hg.prototype,"displayType",void 0),d([f({type:Boolean,json:{write:!0}})],hg.prototype,"editable",void 0),d([f({type:[fxe],json:{write:!0}})],hg.prototype,"orderByFields",void 0),d([f({type:Number,json:{write:!0}})],hg.prototype,"relationshipId",void 0),d([f({type:["relationship"],json:{read:!1,write:!0}})],hg.prototype,"type",void 0),hg=jQ=d([$("esri.form.elements.RelationshipElement")],hg);const jhe=hg;function N6e(e){return{typesWithGroup:{base:c9,key:"type",typeMap:{attachment:zhe,field:Ghe,group:e,relationship:jhe}},typesWithoutGroup:{base:c9,key:"type",typeMap:{attachment:zhe,field:Ghe,relationship:jhe}}}}function k6e(e,t,r=!0){if(!e)return null;const i=r?t.typesWithGroup.typeMap:t.typesWithoutGroup.typeMap;return e.filter(n=>i[n.type]).map(n=>i[n.type].fromJSON(n))}function V6e(e,t,r=!0){if(!e)return null;const i=r?t.typesWithGroup.typeMap:t.typesWithoutGroup.typeMap;return e.filter(n=>i[n.type]).map(n=>n.toJSON())}function z6e(e,t,r=!0){return e?e.map(i=>Mp(r?t.typesWithGroup:t.typesWithoutGroup,i)):null}var qQ;let $0=qQ=class extends c9{constructor(e){super(e),this.elements=null,this.initialState="expanded",this.type="group"}castElements(e){return z6e(e,tj,!1)}readElements(e,t){return k6e(t.formElements,tj,!1)}writeElements(e,t){t.formElements=V6e(e,tj,!1)}clone(){return new qQ({description:this.description,elements:te(this.elements),initialState:this.initialState,label:this.label,visibilityExpression:this.visibilityExpression})}};d([f({json:{write:!0}})],$0.prototype,"elements",void 0),d([Xt("elements")],$0.prototype,"castElements",null),d([$e("elements",["formElements"])],$0.prototype,"readElements",null),d([Xe("elements")],$0.prototype,"writeElements",null),d([f({type:["collapsed","expanded"],json:{write:!0}})],$0.prototype,"initialState",void 0),d([f({type:String,json:{read:!1,write:!0}})],$0.prototype,"type",void 0),$0=qQ=d([$("esri.form.elements.GroupElement")],$0);const tj=N6e($0),Brt=$0;var HQ;const rj=N6e(Brt);let y0=HQ=class extends ge{constructor(e){super(e),this.description=null,this.elements=null,this.expressionInfos=null,this.title=null}castElements(e){return z6e(e,rj)}readElements(e,t){return k6e(t.formElements,rj)}writeElements(e,t){t.formElements=V6e(e,rj)}clone(){return new HQ({description:this.description,expressionInfos:te(this.expressionInfos),elements:te(this.elements),title:this.title})}};d([f({type:String,json:{write:!0}})],y0.prototype,"description",void 0),d([f({json:{write:!0}})],y0.prototype,"elements",void 0),d([Xt("elements")],y0.prototype,"castElements",null),d([$e("elements",["formElements"])],y0.prototype,"readElements",null),d([Xe("elements")],y0.prototype,"writeElements",null),d([f({type:[Irt],json:{write:!0}})],y0.prototype,"expressionInfos",void 0),d([f({type:String,json:{write:!0}})],y0.prototype,"title",void 0),y0=HQ=d([$("esri.form.FormTemplate")],y0);const Grt=y0;function qhe(e,t,r){if(e.hasM==null||e.hasZ)for(const i of t)for(const n of i)n.length>2&&(n[2]*=r)}function jrt(e,t,r){if(!e&&!t||!r)return;const i=Z5(r);Hhe(e,r,i),Hhe(t,r,i)}function Hhe(e,t,r){if(e)for(const i of e)qrt(i.geometry,t,r)}function qrt(e,t,r){if(R(e)||!e.spatialReference||_l(e.spatialReference,t))return;const i=Z5(e.spatialReference)/r;if(i!==1){if("x"in e)e.z!=null&&(e.z*=i);else if("rings"in e)qhe(e,e.rings,i);else if("paths"in e)qhe(e,e.paths,i);else if("points"in e&&(e.hasM==null||e.hasZ))for(const n of e.points)n.length>2&&(n[2]*=i)}}let Hrt=0;const ij=fe.getLogger("esri.layers.graphics.sources.MemorySource");let $g=class extends hd.LoadableMixin(XR(Cm(lt))){constructor(e){super(e),this._idToClientGraphic=null,this.type="memory"}load(e){const t=_(e)?e.signal:null;return this.addResolvingPromise(this._startWorker(t)),Promise.resolve(this)}destroy(){var e;(e=this._connection)==null||e.close(),this._connection=null}get workerGeometryType(){var t;const e=(t=this.layer)==null?void 0:t.geometryType;return e?this._geometryTypeRequiresClientGraphicMapping(e)?"polygon":e:null}applyEdits(e){return this.load().then(()=>this._applyEdits(e))}openPorts(){return this.load().then(()=>this._connection.openPorts())}async queryFeatures(e,t={}){await this.load(t);const r=await this._connection.invoke("queryFeatures",e?e.toJSON():null,t);_N(e,this.layer.spatialReference,r);const i=ym.fromJSON(r);if(!this._requiresClientGraphicMapping())return i;const n=this.layer.objectIdField;for(const s of i.features){const a=s.attributes[n],o=this._idToClientGraphic.get(a);o&&(s.geometry=o.geometry)}return i.geometryType=this.layer.geometryType,i}async queryFeaturesJSON(e,t={}){if(this._requiresClientGraphicMapping())throw new k("query-features-json:unsupported","Cannot query in JSON format for client only geometry types (mesh and extent)");await this.load(t);const r=await this._connection.invoke("queryFeatures",e?e.toJSON():null,t);return _N(e,this.layer.spatialReference,r),r}queryFeatureCount(e,t={}){return this.load(t).then(()=>this._connection.invoke("queryFeatureCount",e?e.toJSON():null,t))}queryObjectIds(e,t={}){return this.load(t).then(()=>this._connection.invoke("queryObjectIds",e?e.toJSON():null,t))}queryExtent(e,t={}){return this.load(t).then(()=>this._connection.invoke("queryExtent",e?e.toJSON():null,t)).then(r=>({count:r.count,extent:Zt.fromJSON(r.extent)}))}querySnapping(e,t={}){return this.load(t).then(()=>this._connection.invoke("querySnapping",e,t))}async _applyEdits(e){if(!this._connection)throw new k("feature-layer-source:edit-failure","Memory source not loaded");const t=this.layer.objectIdField;let r=null;const i=[],n=[];await Promise.all([this._prepareClientMapping(e.addFeatures,null),this._prepareClientMapping(e.updateFeatures,null)]);const s=c=>"objectId"in c&&c.objectId!=null?c.objectId:"attributes"in c&&c.attributes[t]!=null?c.attributes[t]:null;if(e.addFeatures&&(r=this._prepareAddFeatures(e.addFeatures)),e.deleteFeatures)for(const c of e.deleteFeatures){const u=s(c);u!=null&&i.push(u)}const a=e.updateFeatures&&this._idToClientGraphic?new Map:null;if(e.updateFeatures){for(const c of e.updateFeatures)if(n.push(this._serializeFeature(c)),a){const u=s(c);u!=null&&a.set(u,c)}}jrt(r?r.features:null,n,this.layer.spatialReference);const{fullExtent:o,featureEditResults:l}=await this._connection.invoke("applyEdits",{adds:r?r.features:[],updates:n,deletes:i});return this.fullExtent=o,r&&r.finish(l.uidToObjectId),this._updateClientGraphicIds(a,l),this._createEditsResult(l)}async _prepareClientMapping(e,t){if(this.layerOrSourceGeometryType!=="mesh"||R(e))return;const r=[];for(const{geometry:i}of e)!_(i)||i.type!=="mesh"||i.hasExtent||i.loaded||r.push(i.load({signal:t}));r.length&&await Promise.all(r)}_updateClientGraphicIds(e,t){if(this._idToClientGraphic){if(e)for(const r of t.updateResults){if(!r.success)continue;const i=e.get(r.objectId);i!=null&&this._addIdToClientGraphic(i)}for(const r of t.deleteResults)r.success&&this._idToClientGraphic.delete(r.objectId)}}_createEditsResult(e){return{addFeatureResults:e.addResults?e.addResults.map(this._createFeatureEditResult,this):[],updateFeatureResults:e.updateResults?e.updateResults.map(this._createFeatureEditResult,this):[],deleteFeatureResults:e.deleteResults?e.deleteResults.map(this._createFeatureEditResult,this):[],addAttachmentResults:[],updateAttachmentResults:[],deleteAttachmentResults:[]}}_createFeatureEditResult(e){const t=e.success===!0?null:e.error||{code:void 0,description:void 0};return{objectId:e.objectId,globalId:e.globalId,error:t?new k("feature-layer-source:edit-failure",t.description,{code:t.code}):null}}_prepareAddFeatures(e){const t=new Map,r=new Array(e.length);let i=null;for(let s=0;s<e.length;s++){const a=e[s],o=this._serializeFeature(a);!i&&_(a.geometry)&&(i=a.geometry.type),r[s]=o,t.set(`${o.uid}`,a)}const n=this;return{features:r,inferredGeometryType:i,finish(s){const a=n.sourceJSON.objectIdField;for(const o in s){const l=s[o],c=t.get(o);c&&(c.attributes||(c.attributes={}),l===-1?delete c.attributes[a]:c.attributes[a]=l,n._addIdToClientGraphic(c))}}}}_addIdToClientGraphic(e){if(!this._idToClientGraphic)return;const t=this.sourceJSON.objectIdField,r=e.attributes&&e.attributes[t];r!=null&&this._idToClientGraphic.set(r,e)}get layerOrSourceGeometryType(){var e,t,r;return(r=(e=this.layer)==null?void 0:e.geometryType)!=null?r:(t=this.sourceJSON)==null?void 0:t.geometryType}_requiresClientGraphicMapping(){return this._geometryTypeRequiresClientGraphicMapping(this.layerOrSourceGeometryType)}_geometryRequiresClientGraphicMapping(e){return this._geometryTypeRequiresClientGraphicMapping(e.type)}_geometryTypeRequiresClientGraphicMapping(e){return e==="mesh"||e==="multipatch"||e==="extent"}_serializeFeature(e){const{attributes:t}=e,r=this._geometryForSerialization(e),i=(Hrt++).toString();return r?{uid:i,geometry:r.toJSON(),attributes:t}:{uid:i,attributes:t}}_geometryForSerialization(e){const{geometry:t}=e;return R(t)?null:this._geometryRequiresClientGraphicMapping(t)?t.extent?$o.fromExtent(t.extent):null:t}async _startWorker(e){this._connection=await LV("MemorySourceWorker",{strategy:ue("feature-layers-workers")?"dedicated":"local",signal:e});const{fields:t,spatialReference:r,objectIdField:i,hasM:n,hasZ:s,timeInfo:a}=this.layer,o=this.layer.originOf("spatialReference")==="defaults";await this._prepareClientMapping(this.items,e);const l=this._prepareAddFeatures(this.items);this.handles.add(this.on("before-changes",p=>{ij.error("Source modifications will not propagate after layer has been loaded. Please use .applyEdits() instead"),p.preventDefault()}));const c={features:l.features,fields:t&&t.map(p=>p.toJSON()),geometryType:Xce.toJSON(this.workerGeometryType),hasM:this.layerOrSourceGeometryType!=="mesh"&&n,hasZ:this.layerOrSourceGeometryType==="mesh"||s,objectIdField:i,spatialReference:o?null:r&&r.toJSON(),timeInfo:a?a.toJSON():null},u=await this._connection.invoke("load",c,{signal:e});for(const p of u.warnings)ij.warn(p.message,{layer:this.layer,warning:p});u.featureErrors.length&&ij.warn(`Encountered ${u.featureErrors.length} validation errors while loading features`,u.featureErrors);const h=u.layerDefinition;this._geometryTypeRequiresClientGraphicMapping(l.inferredGeometryType)&&(h.geometryType=Xce.toJSON(l.inferredGeometryType)),this.sourceJSON=h,this._requiresClientGraphicMapping()&&(this._idToClientGraphic=new Map),l.finish(u.assignedObjectIds)}};d([Dte({Type:co,ensureType:rs(co)})],$g.prototype,"itemType",void 0),d([f()],$g.prototype,"type",void 0),d([f({constructOnly:!0})],$g.prototype,"layer",void 0),d([f({readOnly:!0})],$g.prototype,"workerGeometryType",null),d([f()],$g.prototype,"sourceJSON",void 0),$g=d([$("esri.layers.graphics.sources.MemorySource")],$g);function Wrt(e){return"portalItem"in e}const U6e=e=>{let t=class extends e{get apiKey(){var r;return this._isOverridden("apiKey")?this._get("apiKey"):Wrt(this)?(r=this.portalItem)==null?void 0:r.apiKey:null}set apiKey(r){r!=null?this._override("apiKey",r):(this._clearOverride("apiKey"),this.clear("apiKey","user"))}};return d([f({type:String})],t.prototype,"apiKey",null),t=d([$("esri.layers.mixins.APIKeyMixin")],t),t},B6e={mapserver:"MapServer",imageserver:"ImageServer",featureserver:"FeatureServer",sceneserver:"SceneServer",streamserver:"StreamServer",vectortileserver:"VectorTileServer"},G6e=Object.values(B6e),j6e=new RegExp(`^((?:https?:)?\\/\\/\\S+?\\/rest\\/services\\/(.+?)\\/(${G6e.join("|")}))(?:\\/(?:layers\\/)?(\\d+))?`,"i"),Xrt=new RegExp(`^((?:https?:)?\\/\\/\\S+?\\/([^\\/\\n]+)\\/(${G6e.join("|")}))(?:\\/(?:layers\\/)?(\\d+))?`,"i"),Yrt=/(.*?)\/(?:layers\/)?(\d+)\/?$/i;function K$t(e){return!!j6e.test(e)}function jw(e){if(R(e))return null;const t=pn(e),r=t.path.match(j6e)||t.path.match(Xrt);if(!r)return null;const[,i,n,s,a]=r,o=n.indexOf("/");return{title:_z(o!==-1?n.slice(o+1):n),serverType:B6e[s.toLowerCase()],sublayer:a!=null&&a!==""?parseInt(a,10):null,url:{path:i}}}function Zrt(e){const t=pn(e).path.match(Yrt);return t?{serviceUrl:t[1],sublayerId:Number(t[2])}:null}function _z(e){return(e=e.replace(/\s*[/_]+\s*/g," "))[0].toUpperCase()+e.slice(1)}function q6e(e,t){const r=[];if(e){const i=jw(e);_(i)&&i.title&&r.push(i.title)}if(t){const i=_z(t);r.push(i)}if(r.length===2){if(r[0].toLowerCase().includes(r[1].toLowerCase()))return r[0];if(r[1].toLowerCase().includes(r[0].toLowerCase()))return r[1]}return r.join(" - ")}function wne(e){if(!e)return!1;const t=".arcgis.com/",r="//services",i="//tiles",n="//features",s=(e=e.toLowerCase()).includes(t),a=e.includes(r)||e.includes(i)||e.includes(n);return s&&a}function Qrt(e,t){return e&&D3e(F3e(e,t))}function H6e(e){let{url:t}=e;if(!t)return{url:t};t=F3e(t,e.logger);const r=pn(t),i=jw(r.path);let n;if(_(i))i.sublayer!=null&&e.layer.layerId==null&&(n=i.sublayer),t=i.url.path;else if(e.nonStandardUrlAllowed){const s=Zrt(r.path);_(s)&&(t=s.serviceUrl,n=s.sublayerId)}return{url:D3e(t),layerId:n}}function W6e(e,t,r,i,n){Xv(t,i,"url",n),i.url&&e.layerId!=null&&(i.url=vl(i.url,r,e.layerId.toString()))}function eLt(e){if(!e)return!1;const t=e.toLowerCase(),r=t.includes("/services/"),i=t.includes("/mapserver/wmsserver"),n=t.includes("/imageserver/wmsserver"),s=t.includes("/wmsserver");return r&&(i||n||s)}const X6e=e=>{let t=class extends e{get title(){if(this._get("title")&&this.originOf("title")!=="defaults")return this._get("title");if(this.url){const r=jw(this.url);if(_(r)&&r.title)return r.title}return this._get("title")||""}set title(r){this._set("title",r)}set url(r){this._set("url",Qrt(r,fe.getLogger(this.declaredClass)))}};return d([f()],t.prototype,"title",null),d([f({type:String})],t.prototype,"url",null),t=d([$("esri.layers.mixins.ArcGISService")],t),t},Whe={read:{reader:Fie},write:{allowNull:!0,writer:Nie}},Y6e=e=>{let t=class extends e{constructor(){super(...arguments),this.blendMode="normal",this.effect=null}};return d([f({type:["average","color-burn","color-dodge","color","darken","destination-atop","destination-in","destination-out","destination-over","difference","exclusion","hard-light","hue","invert","lighten","lighter","luminosity","minus","multiply","normal","overlay","plus","reflect","saturation","screen","soft-light","source-atop","source-in","source-out","vivid-light","xor"],nonNullable:!0,json:{read:!1,write:!1,origins:{"web-map":{read:!0,write:!0},"portal-item":{read:!0,write:!0}}}})],t.prototype,"blendMode",void 0),d([f({json:{read:!1,write:!1,origins:{"web-map":Whe,"portal-item":Whe}}})],t.prototype,"effect",void 0),t=d([$("esri.layers.mixins.BlendLayer")],t),t},Z6e=e=>{let t=class extends e{constructor(){super(...arguments),this.customParameters=null}};return d([f({type:Object,json:{write:{overridePolicy:r=>({enabled:!!(r&&Object.keys(r).length>0)})}}})],t.prototype,"customParameters",void 0),t=d([$("esri.layers.mixins.CustomParametersMixin")],t),t};var WQ;const nj=new tr({esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"envelope-intersects",esriSpatialRelIndexIntersects:"index-intersects",esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:"relation"}),sj=new tr({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"});let b0=WQ=class extends ge{constructor(e){super(e),this.where=null,this.geometry=null,this.spatialRelationship="intersects",this.distance=void 0,this.objectIds=null,this.units=null,this.timeExtent=null}createQuery(e={}){const{where:t,geometry:r,spatialRelationship:i,timeExtent:n,objectIds:s,units:a,distance:o}=this;return new Zn({geometry:te(r),objectIds:te(s),spatialRelationship:i,timeExtent:te(n),where:t,units:a,distance:o,...e})}clone(){const{where:e,geometry:t,spatialRelationship:r,timeExtent:i,objectIds:n,units:s,distance:a}=this;return new WQ({geometry:te(t),objectIds:te(n),spatialRelationship:r,timeExtent:te(i),where:e,units:s,distance:a})}};d([f({type:String,json:{write:!0}})],b0.prototype,"where",void 0),d([f({types:bx,json:{write:!0}})],b0.prototype,"geometry",void 0),d([f({type:nj.apiValues,json:{name:"spatialRel",read:{reader:nj.read},write:{allowNull:!1,writer:nj.write,overridePolicy(){return{enabled:_(this.geometry)}}}}})],b0.prototype,"spatialRelationship",void 0),d([f({type:Number,json:{write:{overridePolicy(e){return{enabled:e!=null&&this.geometry!=null}}}}})],b0.prototype,"distance",void 0),d([f({type:[Number],json:{write:!0}})],b0.prototype,"objectIds",void 0),d([f({type:sj.apiValues,json:{read:sj.read,write:{writer:sj.write,overridePolicy(e){return{enabled:e!=null&&this.geometry!=null}}}}})],b0.prototype,"units",void 0),d([f({type:Mm,json:{write:!0}})],b0.prototype,"timeExtent",void 0),b0=WQ=d([$("esri.layers.support.FeatureFilter")],b0);const Jrt=b0;var XQ;const Xhe={read:{reader:Fie},write:{writer:Nie,overridePolicy(){return{allowNull:this.excludedEffect!=null,isRequired:this.excludedEffect==null}}}},Yhe={read:{reader:Fie},write:{writer:Nie,overridePolicy(){return{allowNull:this.includedEffect!=null,isRequired:this.includedEffect==null}}}},Zhe={name:"showExcludedLabels",default:!0};let U2=XQ=class extends ge{constructor(e){super(e),this.filter=null,this.includedEffect=null,this.excludedEffect=null,this.excludedLabelsVisible=!1}write(e,t){var i,n;const r=super.write(e,t);if(t!=null&&t.origin){if(r.filter){const s=Object.keys(r.filter);if(s.length>1||s[0]!=="where")return(i=t.messages)==null||i.push(new k("web-document-write:unsupported-feature-effect","Invalid feature effect 'filter'. A filter can only contain a 'where' property",{layer:t.layer,effect:this})),null}if("showExcludedLabels"in r)return(n=t.messages)==null||n.push(new k("web-document-write:unsupported-feature-effect","Invalid value for property 'excludedLabelsVisible' which should always be 'true'",{layer:t.layer,effect:this})),null}return r}clone(){return new XQ({filter:_(this.filter)&&this.filter.clone(),includedEffect:this.includedEffect,excludedEffect:this.excludedEffect,excludedLabelsVisible:this.excludedLabelsVisible})}};d([f({type:Jrt,json:{write:{allowNull:!0,writer(e,t,r,i){const n=e==null?void 0:e.write({},i);n&&Object.keys(n).length!==0?ud(r,n,t):ud(r,null,t)}}}})],U2.prototype,"filter",void 0),d([f({json:{write:!0,origins:{"web-map":Xhe,"portal-item":Xhe}}})],U2.prototype,"includedEffect",void 0),d([f({json:{write:!0,origins:{"web-map":Yhe,"portal-item":Yhe}}})],U2.prototype,"excludedEffect",void 0),d([f({type:Boolean,json:{write:!0,name:"showExcludedLabels",origins:{"web-map":Zhe,"portal-item":Zhe}}})],U2.prototype,"excludedLabelsVisible",void 0),U2=XQ=d([$("esri.layers.support.FeatureEffect")],U2);const Krt=U2,Qhe={write:{allowNull:!0}},Q6e=e=>{let t=class extends e{constructor(){super(...arguments),this.featureEffect=null}};return d([f({type:Krt,json:{origins:{"web-map":Qhe,"portal-item":Qhe}}})],t.prototype,"featureEffect",void 0),t=d([$("esri.layers.mixins.FeatureEffectLayer")],t),t},eit={"web-scene/operational-layers":{ArcGISFeatureLayer:!0,ArcGISImageServiceLayer:!0,ArcGISMapServiceLayer:!0,ArcGISSceneServiceLayer:!0,ArcGISTiledElevationServiceLayer:!0,ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,BuildingSceneLayer:!0,GroupLayer:!0,IntegratedMeshLayer:!0,OGCFeatureLayer:!0,PointCloudLayer:!0,WebTiledLayer:!0,CSV:!0,GeoJSON:!0,VectorTileLayer:!0,WFS:!0,WMS:!0,KML:!0,RasterDataLayer:!0,Voxel:!0,LineOfSightLayer:!0},"web-scene/basemap":{ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,WebTiledLayer:!0,OpenStreetMap:!0,VectorTileLayer:!0,ArcGISImageServiceLayer:!0,WMS:!0,ArcGISMapServiceLayer:!0},"web-scene/ground":{ArcGISTiledElevationServiceLayer:!0,RasterDataElevationLayer:!0},"web-map/operational-layers":{ArcGISAnnotationLayer:!0,ArcGISDimensionLayer:!0,ArcGISFeatureLayer:!0,ArcGISImageServiceLayer:!0,ArcGISImageServiceVectorLayer:!0,ArcGISMapServiceLayer:!0,ArcGISStreamLayer:!0,ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,BingMapsAerial:!0,BingMapsHybrid:!0,BingMapsRoad:!0,CSV:!0,GeoRSS:!0,GeoJSON:!0,GroupLayer:!0,KML:!0,OGCFeatureLayer:!0,SubtypeGroupLayer:!0,VectorTileLayer:!0,WFS:!0,WMS:!0,WebTiledLayer:!0},"web-map/basemap":{ArcGISImageServiceLayer:!0,ArcGISImageServiceVectorLayer:!0,ArcGISMapServiceLayer:!0,ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,OpenStreetMap:!0,VectorTileLayer:!0,WMS:!0,WebTiledLayer:!0,BingMapsAerial:!0,BingMapsRoad:!0,BingMapsHybrid:!0},"web-map/tables":{ArcGISFeatureLayer:!0},"portal-item/operational-layers":{ArcGISFeatureLayer:!0,ArcGISSceneServiceLayer:!0,PointCloudLayer:!0,BuildingSceneLayer:!0,IntegratedMeshLayer:!0}};function tit(e){if(!e)return e;const{start:t,end:r}=e;return new Mm({start:_(t)?fw(t,-t.getTimezoneOffset(),"minutes"):t,end:_(r)?fw(r,-r.getTimezoneOffset(),"minutes"):r})}function rit(e){if(!e)return e;const{start:t,end:r}=e;return new Mm({start:_(t)?fw(t,t.getTimezoneOffset(),"minutes"):t,end:_(r)?fw(r,r.getTimezoneOffset(),"minutes"):r})}var YQ;let jE=YQ=class extends ge{async collectRequiredFields(e,t){return uc(e,t,this.expression)}clone(){return new YQ({expression:this.expression,title:this.title})}equals(e){return this.expression===e.expression&&this.title===e.title}};d([f({type:String,json:{write:!0}})],jE.prototype,"expression",void 0),d([f({type:String,json:{write:!0}})],jE.prototype,"title",void 0),jE=YQ=d([$("esri.layers.support.FeatureExpressionInfo")],jE);const Jhe=jE;function iit(e){return o9[e]!=null}function nit(e){return 1/(o9[e]||1)}function sit(){const e=Object.keys(o9);return e.sort(),e}const ait=sit();var ZQ;const dP=uo()({onTheGround:"on-the-ground",relativeToGround:"relative-to-ground",relativeToScene:"relative-to-scene",absoluteHeight:"absolute-height"}),Khe=new tr({foot:"feet",kilometer:"kilometers",meter:"meters",mile:"miles","us-foot":"us-feet",yard:"yards"});let fg=ZQ=class extends ge{constructor(){super(...arguments),this.offset=null}readFeatureExpressionInfo(e,t){return e!=null?e:t.featureExpression&&t.featureExpression.value===0?{expression:"0"}:void 0}writeFeatureExpressionInfo(e,t,r,i){t[r]=e.write({},i),e.expression==="0"&&(t.featureExpression={value:0})}get mode(){const{offset:e,featureExpressionInfo:t}=this;return this._isOverridden("mode")?this._get("mode"):_(e)||t?"relative-to-ground":"on-the-ground"}set mode(e){this._override("mode",e)}set unit(e){this._set("unit",e)}write(e,t){return this.offset||this.mode||this.featureExpressionInfo||this.unit?super.write(e,t):null}clone(){return new ZQ({mode:this.mode,offset:this.offset,featureExpressionInfo:this.featureExpressionInfo?this.featureExpressionInfo.clone():void 0,unit:this.unit})}equals(e){return this.mode===e.mode&&this.offset===e.offset&&this.unit===e.unit&&UDe(this.featureExpressionInfo,e.featureExpressionInfo)}};d([f({type:Jhe,json:{write:!0}})],fg.prototype,"featureExpressionInfo",void 0),d([$e("featureExpressionInfo",["featureExpressionInfo","featureExpression"])],fg.prototype,"readFeatureExpressionInfo",null),d([Xe("featureExpressionInfo",{featureExpressionInfo:{type:Jhe},"featureExpression.value":{type:[0]}})],fg.prototype,"writeFeatureExpressionInfo",null),d([f({type:dP.apiValues,nonNullable:!0,json:{type:dP.jsonValues,read:dP.read,write:{writer:dP.write,isRequired:!0}}})],fg.prototype,"mode",null),d([f({type:Number,json:{write:!0}})],fg.prototype,"offset",void 0),d([f({type:ait,json:{type:String,read:Khe.read,write:Khe.write}})],fg.prototype,"unit",null),fg=ZQ=d([$("esri.layers.support.ElevationInfo")],fg);const oit=fg,xne={type:Boolean,value:!0,json:{origins:{service:{read:!1,write:!1},"web-map":{read:!1,write:!1}},name:"screenSizePerspective",write:!0}},pO={type:Boolean,value:!0,json:{name:"disablePopup",read:{reader:(e,t)=>!t.disablePopup},write:{enabled:!0,writer(e,t,r){t[r]=!e}}}},mO={type:Boolean,value:!0,json:{name:"showLabels",write:!0}},Tne={type:String,json:{origins:{"portal-item":{write:!1}},write:{isRequired:!0,ignoreOrigin:!0,writer:Xv}}},Sne={type:Boolean,value:!0,json:{origins:{service:{read:{enabled:!1}}},name:"showLegend",write:!0}},Ene={value:null,type:oit,json:{origins:{service:{name:"elevationInfo",write:!0}},name:"layerDefinition.elevationInfo",write:!0}};function tLt(e){return{type:e,readOnly:!0,json:{origins:{service:{read:!0}},read:!1}}}const n7={type:Number,json:{origins:{"web-document":{write:!0,read:!0},"portal-item":{write:!0}}}},lit={...n7,json:{...n7.json,origins:{"web-document":{...n7.json.origins["web-document"],write:{enabled:!0,target:{opacity:{type:Number},"layerDefinition.drawingInfo.transparency":{type:Number}}}}},read:{source:["layerDefinition.drawingInfo.transparency","drawingInfo.transparency"],reader:(e,t,r)=>r&&r.origin!=="service"||!t.drawingInfo||t.drawingInfo.transparency===void 0?t.layerDefinition&&t.layerDefinition.drawingInfo&&t.layerDefinition.drawingInfo.transparency!==void 0?F5(t.layerDefinition.drawingInfo.transparency):void 0:F5(t.drawingInfo.transparency)}}},cit={type:Mm,readOnly:!0,get(){var o,l;if(!((o=this.layer)!=null&&o.timeInfo))return null;const{datesInUnknownTimezone:e,timeOffset:t,useViewTime:r}=this.layer,i=(l=this.view)==null?void 0:l.timeExtent;let n=this.layer.timeExtent;e&&(n=rit(n));let s=r?i&&n?i.intersection(n):i||n:n;if(!s||s.isEmpty||s.isAllTime)return s;t&&(s=s.offset(-t.value,t.unit)),e&&(s=tit(s));const a=this._get("timeExtent");return s.equals(a)?a:s}},rLt={type:Zt,readOnly:!0,json:{origins:{service:{read:{source:["fullExtent","spatialReference"],reader:(e,t)=>{const r=Zt.fromJSON(e);return t.spatialReference!=null&&typeof t.spatialReference=="object"&&(r.spatialReference=Ye.fromJSON(t.spatialReference)),r}}}},read:!1}},Cne={type:String,json:{origins:{service:{read:!1},"portal-item":{read:!1}}}},dit={type:Number,json:{origins:{service:{write:{enabled:!1}}},read:{source:"layerDefinition.minScale"},write:{target:"layerDefinition.minScale"}}},uit={type:Number,json:{origins:{service:{write:{enabled:!1}}},read:{source:"layerDefinition.maxScale"},write:{target:"layerDefinition.maxScale"}}},J6e={json:{write:{ignoreOrigin:!0},origins:{"web-map":{read:!1,write:!1}}}},Ane=e=>{let t=class extends e{constructor(){super(...arguments),this.title=null}writeListMode(r,i,n,s){(s&&s.layerContainerType==="ground"||r&&zNe(this,n,{},s))&&(i[n]=r)}writeOperationalLayerType(r,i,n,s){!r||s&&s.layerContainerType==="tables"||(i.layerType=r)}writeTitle(r,i){i.title=r||"Layer"}read(r,i){i&&(i.layer=this),FNe(this,r,n=>super.read(r,n),i)}write(r,i){var a,o;if(i!=null&&i.origin){const l=`${i.origin}/${i.layerContainerType||"operational-layers"}`,c=eit[l];let u=c&&c[this.operationalLayerType];if(this.operationalLayerType==="ArcGISTiledElevationServiceLayer"&&l==="web-scene/operational-layers"&&(u=!1),!u)return(a=i.messages)==null||a.push(new k("layer:unsupported",`Layers (${this.title}, ${this.id}) of type '${this.declaredClass}' are not supported in the context of '${l}'`,{layer:this})),null}const n=super.write(r,{...i,layer:this}),s=!!i&&!!i.messages&&!!i.messages.filter(l=>l instanceof k&&l.name==="web-document-write:property-required").length;return qv(n==null?void 0:n.url)?((o=i==null?void 0:i.messages)==null||o.push(new k("layer:invalid-url",`Layer (${this.title}, ${this.id}) of type '${this.declaredClass}' using a Blob URL cannot be written to web scenes and web maps`,{layer:this})),null):!this.url&&s?null:n}beforeSave(){}};return d([f({type:String,json:{write:{ignoreOrigin:!0},origins:{"web-scene":{write:{isRequired:!0,ignoreOrigin:!0}},"portal-item":{write:!1}}}})],t.prototype,"id",void 0),d([f(J6e)],t.prototype,"listMode",void 0),d([Xe("listMode")],t.prototype,"writeListMode",null),d([f({type:String,readOnly:!0,json:{read:!1,write:{target:"layerType",ignoreOrigin:!0},origins:{"portal-item":{write:!1}}}})],t.prototype,"operationalLayerType",void 0),d([Xe("operationalLayerType")],t.prototype,"writeOperationalLayerType",null),d([f(n7)],t.prototype,"opacity",void 0),d([f({type:String,json:{write:{ignoreOrigin:!0,writerEnsuresNonNull:!0},origins:{"web-scene":{write:{isRequired:!0,ignoreOrigin:!0,writerEnsuresNonNull:!0}},"portal-item":{write:!1}}},value:"Layer"})],t.prototype,"title",void 0),d([Xe([void 0,"web-scene"],"title")],t.prototype,"writeTitle",null),d([f({type:Boolean,json:{name:"visibility"}})],t.prototype,"visible",void 0),t=d([$("esri.layers.mixins.OperationalLayer")],t),t};var QQ;const aj=new tr({asc:"ascending",desc:"descending"});let vS=QQ=class extends ge{constructor(e){super(e),this.field=null,this.valueExpression=null,this.order="ascending"}clone(){return new QQ({field:this.field,valueExpression:this.valueExpression,order:this.order})}};d([f({type:String,json:{write:!0}})],vS.prototype,"field",void 0),d([f({type:String,json:{write:!0}})],vS.prototype,"valueExpression",void 0),d([f({type:aj.apiValues,json:{read:aj.read,write:aj.write}})],vS.prototype,"order",void 0),vS=QQ=d([$("esri.layers.support.OrderByInfo")],vS);const K6e=vS;function hit(e,t,r){if(!e)return null;const i=e.find(s=>!!s.field);if(!i)return null;const n=new K6e;return n.read(i,r),[n]}function fit(e,t,r,i){const n=e.find(s=>!!s.field);n&&ud(r,[n.toJSON()],t)}const e8e=e=>{let t=class extends e{constructor(){super(...arguments),this.orderBy=null}};return d([f({type:[K6e],json:{origins:{"web-scene":{write:!1,read:!1}},read:{source:"layerDefinition.orderBy",reader:hit},write:{target:"layerDefinition.orderBy",writer:fit}}})],t.prototype,"orderBy",void 0),t=d([$("esri.layers.mixins.OrderedLayer")],t),t},pit=fe.getLogger("esri.layers.mixins.PortalLayer"),t8e=e=>{let t=class extends e{constructor(){super(...arguments),this.resourceReferences={portalItem:null,paths:[]},this.userHasEditingPrivileges=!0}destroy(){var r;(r=this.portalItem)==null||r.destroy(),this.portalItem=null}set portalItem(r){r!==this._get("portalItem")&&(this.removeOrigin("portal-item"),this._set("portalItem",r))}readPortalItem(r,i,n){if(i.itemId)return new I5({id:i.itemId,portal:n&&n.portal})}writePortalItem(r,i){r&&r.id&&(i.itemId=r.id)}async loadFromPortal(r,i){if(this.portalItem&&this.portalItem.id)try{const n=await ie(()=>import("./layersLoader.315a9bc7.js").then(s=>s.l),["layersLoader.315a9bc7.js","lazyLayerLoader.5e7c3b38.js","jsonContext.b1feec67.js"],import.meta.url);return Et(i),await n.load({instance:this,supportedTypes:r.supportedTypes,validateItem:r.validateItem,supportsData:r.supportsData},i)}catch(n){throw Ui(n)||pit.warn(`Failed to load layer (${this.title}, ${this.id}) portal item (${this.portalItem.id})
  ${n}`),n}}async finishLoadEditablePortalLayer(r){this._set("userHasEditingPrivileges",await this._fetchUserHasEditingPrivileges(r).catch(i=>(pu(i),!0)))}async _fetchUserHasEditingPrivileges(r){const i=this.url?Xi==null?void 0:Xi.findCredential(this.url):null;if(!i)return!0;const n=uP.credential===i?uP.user:await this._fetchEditingUser(r);return uP.credential=i,uP.user=n,R(n)||n.privileges==null||n.privileges.includes("features:user:edit")}async _fetchEditingUser(r){var u,h;const i=(h=(u=this.portalItem)==null?void 0:u.portal)==null?void 0:h.user;if(i)return i;const n=Xi.findServerInfo(this.url);if(!(n!=null&&n.owningSystemUrl))return null;const s=`${n.owningSystemUrl}/sharing/rest`,a=Cs.getDefault();if(a&&a.loaded&&zh(a.restUrl)===zh(s))return a.user;const o=`${s}/community/self`,l=_(r)?r.signal:null,c=await Tu(qt(o,{authMode:"no-prompt",query:{f:"json"},signal:l}));return c.ok?Kte.fromJSON(c.value.data):null}read(r,i){i&&(i.layer=this),super.read(r,i)}write(r,i){const n=i&&i.portal,s=this.portalItem&&this.portalItem.id&&(this.portalItem.portal||Cs.getDefault());return n&&s&&!P3e(s.restUrl,n.restUrl)?(i.messages&&i.messages.push(new k("layer:cross-portal",`The layer '${this.title} (${this.id})' cannot be persisted because it refers to an item on a different portal than the one being saved to. To save, set layer.portalItem to null or save to the same portal as the item associated with the layer`,{layer:this})),null):super.write(r,{...i,layer:this})}};return d([f({type:I5})],t.prototype,"portalItem",null),d([$e("web-document","portalItem",["itemId"])],t.prototype,"readPortalItem",null),d([Xe("web-document","portalItem",{itemId:{type:String}})],t.prototype,"writePortalItem",null),d([f({clonable:!1})],t.prototype,"resourceReferences",void 0),d([f({readOnly:!0})],t.prototype,"userHasEditingPrivileges",void 0),t=d([$("esri.layers.mixins.PortalLayer")],t),t},uP={credential:null,user:null},OA=new lt,s7=new WeakMap;function mit(e){r8e(e)&&OA.push(e)}function git(e){r8e(e)&&OA.includes(e)&&OA.remove(e)}function r8e(e){return e&&typeof e=="object"&&"refreshInterval"in e&&"refresh"in e}function i8e(e,t){return Number.isFinite(e)&&Number.isFinite(t)?t<=0?e:i8e(t,e%t):0}let oj=0,hP=0;function yit(){var t;const e=Date.now();for(const r of OA)r.refreshInterval&&e-((t=s7.get(r))!=null?t:0)+5>=6e4*r.refreshInterval&&(s7.set(r,e),r.refresh(e))}K2e(()=>{const e=Date.now();let t=0;for(const r of OA)t=i8e(Math.round(6e4*r.refreshInterval),t),r.refreshInterval?s7.get(r)||s7.set(r,e):s7.delete(r);if(t!==hP){if(hP=t,clearInterval(oj),hP===0)return void(oj=0);oj=setInterval(yit,hP)}});function bit(e){return e&&typeof e=="object"&&"refreshTimestamp"in e&&"refresh"in e}const n8e=e=>{let t=class extends e{constructor(...r){super(...r),this.refreshInterval=0,this.refreshTimestamp=0,this._debounceHasDataChanged=qR(()=>this.hasDataChanged()),this.when().then(()=>{mit(this)},()=>{})}destroy(){git(this)}get refreshParameters(){return{_ts:this.refreshTimestamp||null}}refresh(r=Date.now()){QW(this._debounceHasDataChanged()).then(i=>{i&&this._set("refreshTimestamp",r),this.emit("refresh",{dataChanged:i})},i=>{fe.getLogger(this.declaredClass).error(i),this.emit("refresh",{dataChanged:!1,error:i})})}async hasDataChanged(){return!0}};return d([f({type:Number,cast:r=>r>=.1?r:r<=0?0:.1,json:{write:!0}})],t.prototype,"refreshInterval",void 0),d([f({readOnly:!0})],t.prototype,"refreshTimestamp",void 0),d([f()],t.prototype,"refreshParameters",null),t=d([$("esri.layers.mixins.RefreshableLayer")],t),t},Rne=e=>{let t=class extends e{constructor(){super(...arguments),this.minScale=0,this.maxScale=0}get effectiveScaleRange(){const r={minScale:this.minScale,maxScale:this.maxScale},i=this.parent;i&&"effectiveScaleRange"in i&&vit(r,i.effectiveScaleRange);const n=this._get("effectiveScaleRange");return n&&n.minScale===r.minScale&&n.maxScale===r.maxScale?n:r}};return d([f({type:Number,nonNullable:!0,json:{write:!0}})],t.prototype,"minScale",void 0),d([f({type:Number,nonNullable:!0,json:{write:!0}})],t.prototype,"maxScale",void 0),d([f({readOnly:!0})],t.prototype,"effectiveScaleRange",null),t=d([$("esri.layers.mixins.ScaleRangeLayer")],t),t};function vit(e,t){return e.minScale=e.minScale>0?t.minScale>0?Math.min(e.minScale,t.minScale):e.minScale:t.minScale,e.maxScale=e.maxScale>0?t.maxScale>0?Math.max(e.maxScale,t.maxScale):e.maxScale:t.maxScale,e}const q3=uo()({esriTimeUnitsMilliseconds:"milliseconds",esriTimeUnitsSeconds:"seconds",esriTimeUnitsMinutes:"minutes",esriTimeUnitsHours:"hours",esriTimeUnitsDays:"days",esriTimeUnitsWeeks:"weeks",esriTimeUnitsMonths:"months",esriTimeUnitsYears:"years",esriTimeUnitsDecades:"decades",esriTimeUnitsCenturies:"centuries",esriTimeUnitsUnknown:void 0});var JQ;let qE=JQ=class extends ge{constructor(e){super(e),this.value=0,this.unit="milliseconds"}toMilliseconds(){return eJe(this.value,this.unit,"milliseconds")}clone(){return new JQ({value:this.value,unit:this.unit})}};d([f({type:Number,json:{write:!0},nonNullable:!0})],qE.prototype,"value",void 0),d([f({type:q3.apiValues,json:{type:q3.jsonValues,read:q3.read,write:q3.write},nonNullable:!0})],qE.prototype,"unit",void 0),qE=JQ=d([$("esri.TimeInterval")],qE);const MA=qE;var KQ;let _S=KQ=class extends ge{constructor(e){super(e),this.respectsDaylightSaving=!1,this.timezone=null}readRespectsDaylightSaving(e,t){return t.respectsDaylightSaving!==void 0?t.respectsDaylightSaving:t.respectDaylightSaving!==void 0&&t.respectDaylightSaving}clone(){const{respectsDaylightSaving:e,timezone:t}=this;return new KQ({respectsDaylightSaving:e,timezone:t})}};d([f({type:Boolean,json:{write:!0}})],_S.prototype,"respectsDaylightSaving",void 0),d([$e("respectsDaylightSaving",["respectsDaylightSaving","respectDaylightSaving"])],_S.prototype,"readRespectsDaylightSaving",null),d([f({type:String,json:{read:{source:"timeZone"},write:{target:"timeZone"}}})],_S.prototype,"timezone",void 0),_S=KQ=d([$("esri.layers.support.TimeReference")],_S);const _it=_S;var eJ;let Zo=eJ=class extends ge{constructor(e){super(e),this.cumulative=!1,this.endField=null,this.fullTimeExtent=null,this.hasLiveData=!1,this.interval=null,this.startField=null,this.timeReference=null,this.trackIdField=null,this.useTime=!0}readFullTimeExtent(e,t){if(!t.timeExtent||!Array.isArray(t.timeExtent)||t.timeExtent.length!==2)return null;const r=new Date(t.timeExtent[0]),i=new Date(t.timeExtent[1]);return new Mm({start:r,end:i})}writeFullTimeExtent(e,t){e&&_(e.start)&&_(e.end)?t.timeExtent=[e.start.getTime(),e.end.getTime()]:t.timeExtent=null}readInterval(e,t){return t.timeInterval&&t.timeIntervalUnits?new MA({value:t.timeInterval,unit:q3.fromJSON(t.timeIntervalUnits)}):t.defaultTimeInterval&&t.defaultTimeIntervalUnits?new MA({value:t.defaultTimeInterval,unit:q3.fromJSON(t.defaultTimeIntervalUnits)}):null}writeInterval(e,t){if(e){const r=e.toJSON();t.timeInterval=r.value,t.timeIntervalUnits=r.unit}else t.timeInterval=null,t.timeIntervalUnits=null}clone(){const{cumulative:e,endField:t,hasLiveData:r,interval:i,startField:n,timeReference:s,fullTimeExtent:a,trackIdField:o,useTime:l}=this;return new eJ({cumulative:e,endField:t,hasLiveData:r,interval:i,startField:n,timeReference:te(s),fullTimeExtent:te(a),trackIdField:o,useTime:l})}};d([f({type:Boolean,json:{read:{source:"exportOptions.timeDataCumulative"},write:{target:"exportOptions.timeDataCumulative"}}})],Zo.prototype,"cumulative",void 0),d([f({type:String,json:{read:{source:"endTimeField"},write:{target:"endTimeField",allowNull:!0}}})],Zo.prototype,"endField",void 0),d([f({type:Mm,json:{write:{enabled:!0,allowNull:!0}}})],Zo.prototype,"fullTimeExtent",void 0),d([$e("fullTimeExtent",["timeExtent"])],Zo.prototype,"readFullTimeExtent",null),d([Xe("fullTimeExtent")],Zo.prototype,"writeFullTimeExtent",null),d([f({type:Boolean,json:{write:!0}})],Zo.prototype,"hasLiveData",void 0),d([f({type:MA,json:{write:{enabled:!0,allowNull:!0}}})],Zo.prototype,"interval",void 0),d([$e("interval",["timeInterval","timeIntervalUnits","defaultTimeInterval","defaultTimeIntervalUnits"])],Zo.prototype,"readInterval",null),d([Xe("interval")],Zo.prototype,"writeInterval",null),d([f({type:String,json:{read:{source:"startTimeField"},write:{target:"startTimeField",allowNull:!0}}})],Zo.prototype,"startField",void 0),d([f({type:_it,json:{write:{enabled:!0,allowNull:!0}}})],Zo.prototype,"timeReference",void 0),d([f({type:String,json:{write:{enabled:!0,allowNull:!0}}})],Zo.prototype,"trackIdField",void 0),d([f({type:Boolean,json:{read:{source:"exportOptions.useTime"},write:{target:"exportOptions.useTime"}}})],Zo.prototype,"useTime",void 0),Zo=eJ=d([$("esri.layers.support.TimeInfo")],Zo);const s8e=Zo,a8e=e=>{let t=class extends e{constructor(){super(...arguments),this.timeExtent=null,this.timeOffset=null,this.useViewTime=!0}readOffset(r,i){const n=i.timeInfo.exportOptions;if(!n)return null;const s=n.timeOffset,a=q3.fromJSON(n.timeOffsetUnits);return s&&a?new MA({value:s,unit:a}):null}set timeInfo(r){Tre(r,this.fieldsIndex),this._set("timeInfo",r)}};return d([f({type:Mm,json:{write:!1}})],t.prototype,"timeExtent",void 0),d([f({type:MA})],t.prototype,"timeOffset",void 0),d([$e("service","timeOffset",["timeInfo.exportOptions"])],t.prototype,"readOffset",null),d([f({value:null,type:s8e,json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],t.prototype,"timeInfo",null),d([f({type:Boolean,json:{read:{source:"timeAnimation"},write:{target:"timeAnimation"},origins:{"web-scene":{read:!1,write:!1}}}})],t.prototype,"useViewTime",void 0),t=d([$("esri.layers.mixins.TemporalLayer")],t),t};var tJ;let Lg=tJ=class extends ge{constructor(e){super(e)}clone(){const{name:e,fields:t,isAscending:r,isUnique:i,description:n}=this;return new tJ({name:e,fields:t,isAscending:r,isUnique:i,description:n})}};d([f({constructOnly:!0})],Lg.prototype,"name",void 0),d([f({constructOnly:!0})],Lg.prototype,"fields",void 0),d([f({constructOnly:!0})],Lg.prototype,"isAscending",void 0),d([f({constructOnly:!0})],Lg.prototype,"isUnique",void 0),d([f({constructOnly:!0})],Lg.prototype,"description",void 0),Lg=tJ=d([$("esri.layers.support.FeatureIndex")],Lg);let uy=class extends ge{constructor(){super(...arguments),this.type=null}};d([f({type:["selection","cluster","binning"],readOnly:!0,json:{read:!1,write:!0}})],uy.prototype,"type",void 0),uy=d([$("esri.layers.support.FeatureReduction")],uy);var rJ;let wS=rJ=class extends ge{constructor(){super(...arguments),this.statisticType=null,this.onStatisticField=null,this.onStatisticValueExpression=null}clone(){return new rJ({statisticType:this.statisticType,onStatisticField:this.onStatisticField,onStatisticValueExpression:this.onStatisticValueExpression})}};d([f({type:String,json:{write:!0}})],wS.prototype,"statisticType",void 0),d([f({type:String,json:{write:!0}})],wS.prototype,"onStatisticField",void 0),d([f({type:String,json:{write:!0}})],wS.prototype,"onStatisticValueExpression",void 0),wS=rJ=d([$("esri.layers.support.OutStatistic")],wS);const wit=wS;var iJ;let HE=iJ=class extends ge{constructor(){super(...arguments),this.name=null,this.outStatistic=null}clone(){return new iJ({name:this.name,outStatistic:this.outStatistic.clone()})}};d([f({type:String,json:{write:!0}})],HE.prototype,"name",void 0),d([f({type:wit,json:{write:!0}})],HE.prototype,"outStatistic",void 0),HE=iJ=d([$("esri.layers.support.AggregateField")],HE);const o8e=HE,One="__begin__",Mne="__end__",xit=new RegExp(One,"ig"),Tit=new RegExp(Mne,"ig"),efe=new RegExp("^"+One,"i"),tfe=new RegExp(Mne+"$","i"),MN='"',Sit=MN+" + ",Eit=" + "+MN;function Cit(e){return e.replace(new RegExp("\\[","g"),"{").replace(new RegExp("\\]","g"),"}")}function Ait(e){return e.replace(new RegExp("\\{","g"),"[").replace(new RegExp("\\}","g"),"]")}function wz(e){const t={expression:"",type:"none"};return e.labelExpressionInfo?e.labelExpressionInfo.value?(t.expression=e.labelExpressionInfo.value,t.type="conventional"):e.labelExpressionInfo.expression&&(t.expression=e.labelExpressionInfo.expression,t.type="arcade"):e.labelExpression!=null&&(t.expression=Cit(e.labelExpression),t.type="conventional"),t}function Rit(e){const t=wz(e);if(!t)return null;switch(t.type){case"conventional":return nJ(t.expression);case"arcade":return t.expression}return null}function Oit(e){const t=wz(e);if(!t)return null;switch(t.type){case"conventional":return Pit(t.expression);case"arcade":return Pne(t.expression)}return null}function nJ(e){let t;return e?(t=lm(e,r=>One+'$feature["'+r+'"]'+Mne),t=efe.test(t)?t.replace(efe,""):MN+t,t=tfe.test(t)?t.replace(tfe,""):t+MN,t=t.replace(xit,Sit).replace(Tit,Eit)):t='""',t}const Mit=/^\s*\{([^}]+)\}\s*$/i;function Pit(e){const t=e.match(Mit);return t&&t[1].trim()||null}const Iit=/^\s*(?:(?:\$feature\.(\w+))|(?:\$feature\[(["'])([\w\s]+)(\2)\]));?\s*$/i,$it=/^\s*(?:(?:\$feature\.(\w+))|(?:\$feature\[(["'])([\w\s]+)(\2)\]));?\s*(?:DomainName\(\s*\$feature\s*,\s*(["'])(\1|\3)(\5)\s*\));?\s*$/i,Lit=/^\s*(?:DomainName\(\s*\$feature\s*,\s*(["'])([\w\s]+)(\1)\s*\));?\s*$/i;function Pne(e){if(!e)return null;let t=Iit.exec(e)||$it.exec(e);return t?t[1]||t[3]:(t=Lit.exec(e),t?t[2]:null)}var sJ;let a1=sJ=class extends ge{constructor(){super(...arguments),this.expression=null,this.title=null,this.value=null}readExpression(e,t){return t.value?nJ(t.value):e}writeExpression(e,t,r){this.value!=null&&(e=nJ(this.value)),e!=null&&(t[r]=e)}clone(){return new sJ({expression:this.expression,title:this.title,value:this.value})}};d([f({type:String,json:{write:{writerEnsuresNonNull:!0}}})],a1.prototype,"expression",void 0),d([$e("expression",["expression","value"])],a1.prototype,"readExpression",null),d([Xe("expression")],a1.prototype,"writeExpression",null),d([f({type:String,json:{write:!0,origins:{"web-scene":{write:!1}}}})],a1.prototype,"title",void 0),d([f({json:{read:!1,write:!1}})],a1.prototype,"value",void 0),a1=sJ=d([$("esri.layers.support.LabelExpressionInfo")],a1);const l8e=a1,c8e=[252,146,31,255],iLt=[153,153,153,255],d8e={type:"esriSMS",style:"esriSMSCircle",size:6,color:c8e,outline:{type:"esriSLS",style:"esriSLSSolid",width:.75,color:[153,153,153,255]}},u8e={type:"esriSLS",style:"esriSLSSolid",width:.75,color:c8e},h8e={type:"esriSFS",style:"esriSFSSolid",color:[252,146,31,196],outline:{type:"esriSLS",style:"esriSLSSolid",width:.75,color:[255,255,255,191]}},Dit={type:"esriTS",color:[255,255,255,255],font:{family:"arial-unicode-ms",size:10,weight:"bold"},horizontalAlignment:"center",kerning:!0,haloColor:[0,0,0,255],haloSize:1,rotated:!1,text:"",xoffset:0,yoffset:0,angle:0},Fit={type:"esriSMS",style:"esriSMSCircle",color:[0,0,0,255],outline:null,size:10.5},Nit={type:"esriSLS",style:"esriSLSSolid",color:[0,0,0,255],width:1.5},kit={type:"esriSFS",style:"esriSFSSolid",color:[0,0,0,255],outline:null},nLt=nc.fromJSON(d8e),sLt=bc.fromJSON(u8e),aLt=kp.fromJSON(h8e),Vit=i6.fromJSON(Dit);nc.fromJSON(Fit);bc.fromJSON(Nit);kp.fromJSON(kit);var aJ;const fP=new tr({esriServerPointLabelPlacementAboveCenter:"above-center",esriServerPointLabelPlacementAboveLeft:"above-left",esriServerPointLabelPlacementAboveRight:"above-right",esriServerPointLabelPlacementBelowCenter:"below-center",esriServerPointLabelPlacementBelowLeft:"below-left",esriServerPointLabelPlacementBelowRight:"below-right",esriServerPointLabelPlacementCenterCenter:"center-center",esriServerPointLabelPlacementCenterLeft:"center-left",esriServerPointLabelPlacementCenterRight:"center-right",esriServerLinePlacementAboveAfter:"above-after",esriServerLinePlacementAboveAlong:"above-along",esriServerLinePlacementAboveBefore:"above-before",esriServerLinePlacementAboveStart:"above-start",esriServerLinePlacementAboveEnd:"above-end",esriServerLinePlacementBelowAfter:"below-after",esriServerLinePlacementBelowAlong:"below-along",esriServerLinePlacementBelowBefore:"below-before",esriServerLinePlacementBelowStart:"below-start",esriServerLinePlacementBelowEnd:"below-end",esriServerLinePlacementCenterAfter:"center-after",esriServerLinePlacementCenterAlong:"center-along",esriServerLinePlacementCenterBefore:"center-before",esriServerLinePlacementCenterStart:"center-start",esriServerLinePlacementCenterEnd:"center-end",esriServerPolygonPlacementAlwaysHorizontal:"always-horizontal"},{ignoreUnknown:!0});function f8e(e){var t;return!e||e.origin!=="service"&&((t=e.layer)==null?void 0:t.type)!=="map-image"}function zit(e){return(e==null?void 0:e.type)==="map-image"}function p8e(e){var t,r;return!!zit(e)&&!!((r=(t=e.capabilities)==null?void 0:t.exportMap)!=null&&r.supportsArcadeExpressionForLabeling)}function Uit(e){return f8e(e)||p8e(e.layer)}let ls=aJ=class extends ge{constructor(e){super(e),this.type="label",this.name=null,this.allowOverrun=!1,this.deconflictionStrategy="static",this.labelExpression=null,this.labelExpressionInfo=null,this.labelPlacement=null,this.labelPosition="curved",this.maxScale=0,this.minScale=0,this.repeatLabel=!0,this.repeatLabelDistance=null,this.symbol=Vit,this.useCodedValues=void 0,this.where=null}static evaluateWhere(e,t){const r=(i,n,s)=>{switch(n){case"=":return i==s;case"<>":return i!=s;case">":return i>s;case">=":return i>=s;case"<":return i<s;case"<=":return i<=s}return!1};try{if(e==null)return!0;const i=e.split(" ");if(i.length===3)return r(t[i[0]],i[1],i[2]);if(i.length===7){const n=r(t[i[0]],i[1],i[2]),s=i[3],a=r(t[i[4]],i[5],i[6]);switch(s){case"AND":return n&&a;case"OR":return n||a}}return!1}catch{console.log("Error.: can't parse = "+e)}}readLabelExpression(e,t){const r=t.labelExpressionInfo;if(!r||!r.value&&!r.expression)return e}writeLabelExpression(e,t,r){if(this.labelExpressionInfo){if(this.labelExpressionInfo.value!=null)e=Ait(this.labelExpressionInfo.value);else if(this.labelExpressionInfo.expression!=null){const i=Pne(this.labelExpressionInfo.expression);i&&(e="["+i+"]")}}e!=null&&(t[r]=e)}writeLabelExpressionInfo(e,t,r,i){if(e==null&&this.labelExpression!=null&&f8e(i))e=new l8e({expression:this.getLabelExpressionArcade()});else if(!e)return;const n=e.toJSON(i);n.expression&&(t[r]=n)}writeMaxScale(e,t){(e||this.minScale)&&(t.maxScale=e)}writeMinScale(e,t){(e||this.maxScale)&&(t.minScale=e)}getLabelExpression(){return wz(this)}getLabelExpressionArcade(){return Rit(this)}getLabelExpressionSingleField(){return Oit(this)}hash(){return JSON.stringify(this)}clone(){return new aJ({allowOverrun:this.allowOverrun,deconflictionStrategy:this.deconflictionStrategy,labelExpression:this.labelExpression,labelExpressionInfo:te(this.labelExpressionInfo),labelPosition:this.labelPosition,labelPlacement:this.labelPlacement,maxScale:this.maxScale,minScale:this.minScale,name:this.name,repeatLabel:this.repeatLabel,repeatLabelDistance:this.repeatLabelDistance,symbol:te(this.symbol),where:this.where,useCodedValues:this.useCodedValues})}};d([f({type:String,json:{write:!0}})],ls.prototype,"name",void 0),d([f({type:Boolean,json:{write:!0,default:!1,origins:{"web-scene":{write:!1}}}})],ls.prototype,"allowOverrun",void 0),d([f({type:String,json:{write:!0,default:"static",origins:{"web-scene":{write:!1}}}})],ls.prototype,"deconflictionStrategy",void 0),d([f({type:String,json:{write:{overridePolicy(e,t,r){return this.labelExpressionInfo&&(r==null?void 0:r.origin)==="service"&&p8e(r.layer)?{enabled:!1}:{allowNull:!0}}}}})],ls.prototype,"labelExpression",void 0),d([$e("labelExpression")],ls.prototype,"readLabelExpression",null),d([Xe("labelExpression")],ls.prototype,"writeLabelExpression",null),d([f({type:l8e,json:{write:{overridePolicy:(e,t,r)=>Uit(r)?{allowNull:!0}:{enabled:!1}}}})],ls.prototype,"labelExpressionInfo",void 0),d([Xe("labelExpressionInfo")],ls.prototype,"writeLabelExpressionInfo",null),d([f({type:fP.apiValues,json:{type:fP.jsonValues,read:fP.read,write:fP.write}})],ls.prototype,"labelPlacement",void 0),d([f({type:["curved","parallel"],json:{write:!0,origins:{"web-map":{write:!1},"web-scene":{write:!1},"portal-item":{write:!1}}}})],ls.prototype,"labelPosition",void 0),d([f({type:Number})],ls.prototype,"maxScale",void 0),d([Xe("maxScale")],ls.prototype,"writeMaxScale",null),d([f({type:Number})],ls.prototype,"minScale",void 0),d([Xe("minScale")],ls.prototype,"writeMinScale",null),d([f({type:Boolean,json:{write:!0,origins:{"web-scene":{write:!1},"portal-item":{write:!1}}}})],ls.prototype,"repeatLabel",void 0),d([f({type:Number,cast:Xr,json:{write:!0,origins:{"web-scene":{write:!1}}}})],ls.prototype,"repeatLabelDistance",void 0),d([f({types:KBe,json:{origins:{"web-scene":{types:eGe,write:Phe,default:null}},write:Phe,default:null}})],ls.prototype,"symbol",void 0),d([f({type:Boolean,json:{write:!0}})],ls.prototype,"useCodedValues",void 0),d([f({type:String,json:{write:!0}})],ls.prototype,"where",void 0),ls=aJ=d([$("esri.layers.support.LabelClass")],ls);const g6=ls;var oJ;let Df=oJ=class extends uy{constructor(e){super(e),this.type="binning",this.fixedBinLevel=3,this.labelingInfo=null,this.labelsVisible=!0,this.popupEnabled=!0,this.popupTemplate=null,this.fields=[],this.renderer=null}clone(){return new oJ({fields:te(this.fields),fixedBinLevel:this.fixedBinLevel,labelingInfo:te(this.labelingInfo),labelsVisible:this.labelsVisible,popupEnabled:this.popupEnabled,popupTemplate:te(this.popupTemplate),renderer:te(this.renderer)})}};d([Ze({binning:"binning"})],Df.prototype,"type",void 0),d([f({type:Number,json:{write:!0}})],Df.prototype,"fixedBinLevel",void 0),d([f({type:[g6],json:{read:{source:"drawingInfo.labelingInfo"},write:{target:"drawingInfo.labelingInfo"}}})],Df.prototype,"labelingInfo",void 0),d([f(mO)],Df.prototype,"labelsVisible",void 0),d([f(pO)],Df.prototype,"popupEnabled",void 0),d([f({type:_x,json:{name:"popupInfo",write:!0}})],Df.prototype,"popupTemplate",void 0),d([f({type:[o8e],json:{write:!0,origins:{"web-document":{write:!1},"portal-item":{write:!1}}}})],Df.prototype,"fields",void 0),d([f({types:fO,json:{write:!0}})],Df.prototype,"renderer",void 0),Df=oJ=d([$("esri.layers.support.FeatureReductionBinning")],Df);const Bit=Df;var lJ;let $c=lJ=class extends ge{constructor(e){super(e),this.type="cluster",this.clusterRadius=Xr("80px"),this.clusterMinSize=Xr("12px"),this.clusterMaxSize=Xr("50px"),this.popupEnabled=!0,this.popupTemplate=null,this.symbol=null,this.labelingInfo=null,this.labelsVisible=!0,this.fields=null}clone(){return new lJ({clusterRadius:this.clusterRadius,clusterMinSize:this.clusterMinSize,clusterMaxSize:this.clusterMaxSize,labelingInfo:te(this.labelingInfo),labelsVisible:this.labelsVisible,fields:te(this.fields),renderer:te(this.renderer),popupEnabled:this.popupEnabled,popupTemplate:te(this.popupTemplate)})}};d([f({type:["cluster"],readOnly:!0,json:{write:!0}})],$c.prototype,"type",void 0),d([f({type:Number,cast:e=>e==="auto"?e:Xr(e),json:{write:!0}})],$c.prototype,"clusterRadius",void 0),d([f({type:Number,cast:Xr,json:{write:!0}})],$c.prototype,"clusterMinSize",void 0),d([f({type:Number,cast:Xr,json:{write:!0}})],$c.prototype,"clusterMaxSize",void 0),d([f(pO)],$c.prototype,"popupEnabled",void 0),d([f({type:_x,json:{read:{source:"popupInfo"},write:{target:"popupInfo"}}})],$c.prototype,"popupTemplate",void 0),d([f({types:fO,json:{write:!0}})],$c.prototype,"renderer",void 0),d([f({types:QBe})],$c.prototype,"symbol",void 0),d([f({type:[g6],json:{read:{source:"drawingInfo.labelingInfo"},write:{target:"drawingInfo.labelingInfo"}}})],$c.prototype,"labelingInfo",void 0),d([f(mO)],$c.prototype,"labelsVisible",void 0),d([f({type:[o8e],json:{write:!0,origins:{"web-document":{write:!1},"portal-item":{write:!1}}}})],$c.prototype,"fields",void 0),$c=lJ=d([$("esri.layers.support.FeatureReductionCluster")],$c);const m8e=$c;var cJ;let zL=cJ=class extends uy{constructor(e){super(e),this.type="selection"}clone(){return new cJ}};d([f({type:["selection"]})],zL.prototype,"type",void 0),zL=cJ=d([$("esri.layers.support.FeatureReductionSelection")],zL);const dJ=zL,rfe={key:"type",base:uy,typeMap:{selection:m8e}},g8e={types:{key:"type",base:uy,typeMap:{selection:dJ,cluster:m8e,binning:Bit}},json:{name:"layerDefinition.featureReduction",write:{allowNull:!0},origins:{"web-map":{types:rfe},"portal-item":{types:rfe},"web-scene":{types:{key:"type",base:uy,typeMap:{selection:dJ}}}}}},ife=new tr({esriFeatureEditToolAutoCompletePolygon:"auto-complete-polygon",esriFeatureEditToolCircle:"circle",esriFeatureEditToolEllipse:"ellipse",esriFeatureEditToolFreehand:"freehand",esriFeatureEditToolLine:"line",esriFeatureEditToolNone:"none",esriFeatureEditToolPoint:"point",esriFeatureEditToolPolygon:"polygon",esriFeatureEditToolRectangle:"rectangle",esriFeatureEditToolArrow:"arrow",esriFeatureEditToolTriangle:"triangle",esriFeatureEditToolLeftArrow:"left-arrow",esriFeatureEditToolRightArrow:"right-arrow",esriFeatureEditToolUpArrow:"up-arrow",esriFeatureEditToolDownArrow:"down-arrow"});let o1=class extends yd(ge){constructor(e){super(e),this.name=null,this.description=null,this.drawingTool=null,this.prototype=null,this.thumbnail=null}};d([f({json:{write:!0}})],o1.prototype,"name",void 0),d([f({json:{write:!0}})],o1.prototype,"description",void 0),d([f({json:{read:ife.read,write:ife.write}})],o1.prototype,"drawingTool",void 0),d([f({json:{write:!0}})],o1.prototype,"prototype",void 0),d([f({json:{write:!0}})],o1.prototype,"thumbnail",void 0),o1=d([$("esri.layers.support.FeatureTemplate")],o1);const xz=o1;let pg=class extends yd(ge){constructor(e){super(e),this.id=null,this.name=null,this.domains=null,this.templates=null}readDomains(e){const t={};for(const r of Object.keys(e))t[r]=Uie(e[r]);return t}writeDomains(e,t){var i;const r={};for(const n of Object.keys(e))e[n]&&(r[n]=(i=e[n])==null?void 0:i.toJSON());t.domains=r}};d([f({json:{write:!0}})],pg.prototype,"id",void 0),d([f({json:{write:!0}})],pg.prototype,"name",void 0),d([f({json:{write:!0}})],pg.prototype,"domains",void 0),d([$e("domains")],pg.prototype,"readDomains",null),d([Xe("domains")],pg.prototype,"writeDomains",null),d([f({type:[xz],json:{write:!0}})],pg.prototype,"templates",void 0),pg=d([$("esri.layers.support.FeatureType")],pg);const Ine=pg;function Git(e){return e.type==="date"||e.type==="esriFieldTypeDate"}function nfe(e){return e.type==="oid"||e.type==="esriFieldTypeOID"}function sfe(e){return e.type==="global-id"||e.type==="esriFieldTypeGlobalID"}class y8e{constructor(t){if(this.fields=t,this._fieldsMap=new Map,this._dateFieldsSet=new Set,this._numericFieldsSet=new Set,this.dateFields=[],this.numericFields=[],this._requiredFields=null,!t)return;const r=[];for(const i of t){const n=i&&i.name;if(n){const s=afe(n);this._fieldsMap.set(n,i),this._fieldsMap.set(s,i),r.push(s),Git(i)?(this.dateFields.push(i),this._dateFieldsSet.add(i)):J9(i)&&(this._numericFieldsSet.add(i),this.numericFields.push(i)),nfe(i)||sfe(i)||(i.editable=i.editable==null||!!i.editable,i.nullable=i.nullable==null||!!i.nullable)}}r.sort(),this.uid=r.join(",")}destroy(){this._fieldsMap.clear()}get requiredFields(){if(!this._requiredFields){this._requiredFields=[];for(const t of this.fields)nfe(t)||sfe(t)||t.nullable||TUe(t)!==void 0||this._requiredFields.push(t)}return this._requiredFields}has(t){return this.get(t)!=null}get(t){return t!=null?this._fieldsMap.get(t)||this._fieldsMap.get(afe(t)):void 0}isDateField(t){return this._dateFieldsSet.has(this.get(t))}isNumericField(t){return this._numericFieldsSet.has(this.get(t))}normalizeFieldName(t){const r=this.get(t);if(r)return r.name}}function afe(e){return e.toLowerCase().trim()}const jit=fe.getLogger("esri.layers.support.fieldProperties");function $ne(){return{fields:{type:[l6],value:null},fieldsIndex:{readOnly:!0,get(){return new y8e(this.fields||[])}},outFields:{type:[String],json:{read:!1},set:function(e){this._userOutFields=e,this.notifyChange("outFields")},get:function(){const e=this._userOutFields;if(!e||!e.length)return null;if(e.includes("*"))return["*"];if(!this.fields)return e;for(const t of e)this.fieldsIndex.has(t)||jit.error("field-attributes-layer:invalid-field",`Invalid field ${t} found in outFields`,{layer:this,outFields:e});return Xwe(this.fieldsIndex,e)}}}}let xS=class extends yd(ge){constructor(e){super(e),this.shapeAreaField=null,this.shapeLengthField=null,this.units=null}};d([f({type:String,json:{read:{source:"shapeAreaFieldName"}}})],xS.prototype,"shapeAreaField",void 0),d([f({type:String,json:{read:{source:"shapeLengthFieldName"}}})],xS.prototype,"shapeLengthField",void 0),d([f({type:String,json:{read:e=>YGe.read(e)||ZGe.read(e)}})],xS.prototype,"units",void 0),xS=d([$("esri.layers.support.GeometryFieldsInfo")],xS);const qit=xS,Hit=/\[([^\[\]]+)\]/gi;function PA(e,t,r){return e?e.map(i=>{const n=new g6;if(n.read(i,r),n.labelExpression){const s=t.fields||t.layerDefinition&&t.layerDefinition.fields||this.fields;n.labelExpression=n.labelExpression.replace(Hit,(a,o)=>`[${Wit(o,s)}]`)}return n}):null}function Wit(e,t){if(!t)return e;const r=e.toLowerCase();for(let i=0;i<t.length;i++){const n=t[i].name;if(n.toLowerCase()===r)return n}return e}var uJ;let TS=uJ=class extends ge{constructor(e){super(e),this.floorField=null,this.viewAllMode=!1,this.viewAllLevelIds=new lt}clone(){return new uJ({floorField:this.floorField,viewAllMode:this.viewAllMode,viewAllLevelIds:this.viewAllLevelIds})}};d([f({type:String,json:{write:!0}})],TS.prototype,"floorField",void 0),d([f({json:{read:!1,write:!1}})],TS.prototype,"viewAllMode",void 0),d([f({json:{read:!1,write:!1}})],TS.prototype,"viewAllLevelIds",void 0),TS=uJ=d([$("esri.layers.support.LayerFloorInfo")],TS);const b8e=TS,ofe=new tr({esriRelCardinalityOneToOne:"one-to-one",esriRelCardinalityOneToMany:"one-to-many",esriRelCardinalityManyToMany:"many-to-many"}),lfe=new tr({esriRelRoleOrigin:"origin",esriRelRoleDestination:"destination"});let nh=class extends yd(ge){constructor(e){super(e),this.cardinality=null,this.composite=null,this.id=null,this.keyField=null,this.keyFieldInRelationshipTable=null,this.name=null,this.relatedTableId=null,this.relationshipTableId=null,this.role=null}};d([f({json:{read:ofe.read,write:ofe.write}})],nh.prototype,"cardinality",void 0),d([f({json:{read:!0,write:!0}})],nh.prototype,"composite",void 0),d([f({json:{read:!0,write:!0}})],nh.prototype,"id",void 0),d([f({json:{read:!0,write:!0}})],nh.prototype,"keyField",void 0),d([f({json:{read:!0,write:!0}})],nh.prototype,"keyFieldInRelationshipTable",void 0),d([f({json:{read:!0,write:!0}})],nh.prototype,"name",void 0),d([f({json:{read:!0,write:!0}})],nh.prototype,"relatedTableId",void 0),d([f({json:{read:!0,write:!0}})],nh.prototype,"relationshipTableId",void 0),d([f({json:{read:lfe.read,write:lfe.write}})],nh.prototype,"role",void 0),nh=d([$("esri.layers.support.Relationship")],nh);const Xit=nh,Ff=[];function Yit(e,t){if(wne(e.url))return!0;const{wkid:r}=t;for(const i of Ff){if(e.version>=i[0])return!0;if(typeof i[1]=="function"&&(i[1]=i[1]()),i[1].has(r))return!1}return!0}Ff.push([10.91,()=>{const e=new Set([9709,9716,9741,9761,9766]);for(let t=9712;t<=9713;t++)e.add(t);for(let t=9748;t<=9749;t++)e.add(t);for(let t=20904;t<=20932;t++)e.add(t);for(let t=21004;t<=21032;t++)e.add(t);for(let t=21207;t<=21264;t++)e.add(t);for(let t=21307;t<=21364;t++)e.add(t);for(let t=102759;t<=102760;t++)e.add(t);for(let t=102901;t<=102955;t++)e.add(t);return e}]),Ff.push([10.9,()=>{const e=new Set([9300,9354,9364,9367,9373,9377,9387,9456,9473,9498,9678,9680,29874,103599,103872,104028]);for(let t=9356;t<=9360;t++)e.add(t);for(let t=9404;t<=9407;t++)e.add(t);for(let t=9476;t<=9482;t++)e.add(t);for(let t=9487;t<=9494;t++)e.add(t);for(let t=9697;t<=9699;t++)e.add(t);return e}]),Ff.push([10.81,()=>{const e=new Set([9265,9333,103598,103699]);for(let t=9248;t<=9254;t++)e.add(t);for(let t=9271;t<=9273;t++)e.add(t);for(let t=9284;t<=9285;t++)e.add(t);for(let t=21453;t<=21463;t++)e.add(t);return e}]),Ff.push([10.8,()=>{const e=new Set([8088,8395,8428,8433,8531,8687,8692,8694,8699,8900,9003,9006,9009,9012,9017,9191]);for(let t=8035;t<=8036;t++)e.add(t);for(let t=8455;t<=8456;t++)e.add(t);for(let t=8518;t<=8529;t++)e.add(t);for(let t=8533;t<=8536;t++)e.add(t);for(let t=8538;t<=8540;t++)e.add(t);for(let t=8677;t<=8679;t++)e.add(t);for(let t=8902;t<=8903;t++)e.add(t);for(let t=8907;t<=8910;t++)e.add(t);for(let t=8949;t<=8951;t++)e.add(t);for(let t=8972;t<=8987;t++)e.add(t);for(let t=9039;t<=9040;t++)e.add(t);for(let t=9068;t<=9069;t++)e.add(t);for(let t=9140;t<=9141;t++)e.add(t);for(let t=9148;t<=9150;t++)e.add(t);for(let t=9153;t<=9159;t++)e.add(t);for(let t=9205;t<=9218;t++)e.add(t);for(let t=9221;t<=9222;t++)e.add(t);for(let t=54098;t<=54101;t++)e.add(t);return e}]),Ff.push([10.71,()=>{const e=new Set([6316]);for(let t=8351;t<=8353;t++)e.add(t);for(let t=9294;t<=9297;t++)e.add(t);for(let t=103586;t<=103594;t++)e.add(t);for(let t=103696;t<=103698;t++)e.add(t);return e}]),Ff.push([10.7,()=>{const e=new Set([8387,8391,8427,8545,8682,8685,8818,31370,104022,104024,104975]);for(let t=8065;t<=8068;t++)e.add(t);for(let t=8082;t<=8083;t++)e.add(t);for(let t=8379;t<=8385;t++)e.add(t);for(let t=8836;t<=8840;t++)e.add(t);for(let t=8857;t<=8860;t++)e.add(t);for(let t=53035;t<=53037;t++)e.add(t);for(let t=54090;t<=54091;t++)e.add(t);for(let t=102498;t<=102499;t++)e.add(t);return e}]),Ff.push([10.61,()=>new Set([102497])]),Ff.push([10.6,()=>{const e=new Set([7803,7805,7887,8086,8232,8237,8240,8246,8249,8252,8255,9019,9391]);for(let t=7755;t<=7787;t++)e.add(t);for(let t=7791;t<=7795;t++)e.add(t);for(let t=7799;t<=7801;t++)e.add(t);for(let t=7825;t<=7831;t++)e.add(t);for(let t=7877;t<=7878;t++)e.add(t);for(let t=7882;t<=7883;t++)e.add(t);for(let t=7991;t<=7992;t++)e.add(t);for(let t=8042;t<=8043;t++)e.add(t);for(let t=8058;t<=8059;t++)e.add(t);for(let t=8311;t<=8348;t++)e.add(t);for(let t=9060;t<=9067;t++)e.add(t);for(let t=102562;t<=102568;t++)e.add(t);for(let t=102799;t<=102900;t++)e.add(t);return e}]),Ff.push([10.51,()=>{const e=new Set([7683,7881,7886,7899,8888,9e3]);for(let t=8013;t<=8032;t++)e.add(t);for(let t=9053;t<=9057;t++)e.add(t);for(let t=104017;t<=104018;t++)e.add(t);for(let t=104971;t<=104974;t++)e.add(t);return e}]),Ff.push([10.5,()=>{const e=new Set([6962,7035,7037,7039,7041,7084,7086,7133,7798,102399]);for(let t=4087;t<=4088;t++)e.add(t);for(let t=5896;t<=5899;t++)e.add(t);for(let t=7005;t<=7007;t++)e.add(t);for(let t=7057;t<=7070;t++)e.add(t);for(let t=7073;t<=7082;t++)e.add(t);for(let t=7109;t<=7128;t++)e.add(t);for(let t=7844;t<=7859;t++)e.add(t);return e}]);async function v8e(e,t,r){const i=e&&e.getAtOrigin&&e.getAtOrigin("renderer",t.origin);if(i&&i.type==="unique-value"&&i.styleOrigin){const n=await Tu(i.populateFromStyle());if(Et(r),n.ok===!1){const s=n.error;t&&t.messages&&t.messages.push(new cc("renderer:style-reference",`Failed to create unique value renderer from style reference: ${s.message}`,{error:s,context:t})),e.clear("renderer",t.origin)}}}const Zit=["oid","global-id"],Qit=["oid","global-id","guid"];function Lne({displayField:e,editFieldsInfo:t,fields:r,objectIdField:i,title:n},s){if(!r)return null;const a=int({editFieldsInfo:t,fields:r,objectIdField:i},s);if(!a.length)return null;const o=ant({titleBase:n,fields:r,displayField:e}),l=snt();return new _x({title:o,content:l,fieldInfos:a})}const Jit=[/^fnode_$/i,/^tnode_$/i,/^lpoly_$/i,/^rpoly_$/i,/^poly_$/i,/^subclass$/i,/^subclass_$/i,/^rings_ok$/i,/^rings_nok$/i,/shape/i,/perimeter/i,/objectid/i,/_i$/i],Kit=(e,{editFieldsInfo:t,objectIdField:r,visibleFieldNames:i})=>i?i.has(e.name):!_8e(e.name,t)&&(!r||e.name!==r)&&!Zit.includes(e.type)&&!Jit.some(n=>n.test(e.name));function ent(e,t){const r=e;return t&&(e=e.filter(i=>!t.includes(i.type))),e===r&&(e=e.slice()),e.sort(tnt),e}function tnt(e,t){return e.type==="oid"?-1:t.type==="oid"?1:cfe(e)?-1:cfe(t)?1:(e.alias||e.name).toLocaleLowerCase().localeCompare((t.alias||t.name).toLocaleLowerCase())}function _8e(e,t){if(!e||!t)return!1;const{creationDateField:r,creatorField:i,editDateField:n,editorField:s}=t;return[r&&r.toLowerCase(),i&&i.toLowerCase(),n&&n.toLowerCase(),s&&s.toLowerCase()].includes(e.toLowerCase())}function rnt(e,t){return e.editable&&!Qit.includes(e.type)&&!_8e(e.name,t)}function int({editFieldsInfo:e,fields:t,objectIdField:r},i){return ent(t,(i==null?void 0:i.ignoreFieldTypes)||ont).map(n=>new JR({fieldName:n.name,isEditable:rnt(n,e),label:n.alias,format:nnt(n),visible:Kit(n,{editFieldsInfo:e,objectIdField:r,visibleFieldNames:i==null?void 0:i.visibleFieldNames})}))}function nnt(e){switch(e.type){case"small-integer":case"integer":case"single":return new c4({digitSeparator:!0,places:0});case"double":return new c4({digitSeparator:!0,places:2});case"date":return new c4({dateFormat:"long-month-day-year"});default:return e.type==="string"&&exe(e.name)?new c4({digitSeparator:!0,places:0}):null}}function snt(){return[new j5,new dA]}function ant(e){const t=bUe(e),{titleBase:r}=e;return t?`${r}: {${t.trim()}}`:r}function cfe(e){return(e.name&&e.name.toLowerCase())==="name"?!0:(e.alias&&e.alias.toLowerCase())==="name"||void 0}const ont=["geometry","blob","raster","guid","xml"],lj=new tr({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryMultiPatch:"multipatch"}),lnt={name:"supportsName",size:"supportsSize",contentType:"supportsContentType",keywords:"supportsKeywords",exifInfo:"supportsExifInfo"},os="FeatureLayer",dfe=fe.getLogger("esri.layers.FeatureLayer");function pP(e,t){return new k("layer:unsupported",`Layer (${e.title}, ${e.id}) of type '${e.declaredClass}' ${t}`,{layer:e})}function ufe(e){return e&&e instanceof lt}function Ut(e,t,r){return!!(e&&e.hasOwnProperty(t)?e[t]:r)}function mP(e,t,r){return e&&e.hasOwnProperty(t)?e[t]:r}function cnt(e){var r;const t=(r=e==null?void 0:e.supportedSpatialAggregationStatistics)==null?void 0:r.map(i=>i.toLowerCase());return{envelope:!!(t!=null&&t.includes("envelopeaggregate")),centroid:!!(t!=null&&t.includes("centroidaggregate")),convexHull:!!(t!=null&&t.includes("convexhullaggregate"))}}function r8(e,t){var i;const r=(i=e==null?void 0:e.supportedOperationsWithCacheHint)==null?void 0:i.map(n=>n.toLowerCase());return!!(r!=null&&r.includes(t.toLowerCase()))}const cj=$ne();function dj(e,t,r){const i=!!(r!=null&&r.writeLayerSchema);return{enabled:i,ignoreOrigin:i}}let Ie=class extends Q6e(Y6e(e8e(a8e(Rne(n8e(X6e(Ane(t8e(vz(Z6e(U6e(yd(U5))))))))))))){constructor(...e){super(...e),this._handles=new Ft,this.capabilities=null,this.charts=null,this.copyright=null,this.datesInUnknownTimezone=!1,this.displayField=null,this.definitionExpression=null,this.dynamicDataSource=null,this.editFieldsInfo=null,this.editingInfo=null,this.elevationInfo=null,this.featureReduction=null,this.fields=null,this.fieldsIndex=null,this.floorInfo=null,this.formTemplate=null,this.fullExtent=null,this.gdbVersion=null,this.geometryFieldsInfo=null,this.geometryType=null,this.hasM=void 0,this.hasZ=void 0,this.heightModelInfo=null,this.historicMoment=null,this.infoFor3D=null,this.isTable=!1,this.labelsVisible=!0,this.labelingInfo=null,this.layerId=void 0,this.legendEnabled=!0,this.minScale=0,this.maxScale=0,this.globalIdField=null,this.objectIdField=null,this.outFields=null,this.path=null,this.popupEnabled=!0,this.popupTemplate=null,this.relationships=null,this.sourceJSON=null,this.returnM=void 0,this.returnZ=void 0,this.screenSizePerspectiveEnabled=!0,this.serviceDefinitionExpression=null,this.spatialReference=Ye.WGS84,this.subtypeCode=null,this.subtypeField=null,this.templates=null,this.timeInfo=null,this.title=null,this.sublayerTitleMode="item-title",this.trackIdField=null,this.type="feature",this.typeIdField=null,this.types=null,this.indexes=new(lt.ofType(Lg)),this.userIsAdmin=!1,this.version=void 0,this.visible=!0}destroy(){var e;(e=this.source)==null||e.destroy(),this._handles=ct(this._handles)}normalizeCtorArgs(e,t){return typeof e=="string"?{url:e,...t}:e}load(e){const t=_(e)?e.signal:null;if(this.portalItem&&this.portalItem.loaded&&this.source)return void this.addResolvingPromise(this.createGraphicsSource(t).then(i=>this._initLayerProperties(i)));const r=this.loadFromPortal({supportedTypes:["Feature Service","Feature Collection"]},e).catch(pu).then(async()=>{if(this.url&&this.layerId==null&&/FeatureServer|MapServer\/*$/i.test(this.url)){const i=await this._fetchFirstLayerId(t);i!=null&&(this.layerId=i)}if(!this.url&&!this._hasMemorySource())throw new k("feature-layer:missing-url-or-source","Feature layer must be created with either a url or a source");return this._initLayerProperties(await this.createGraphicsSource(t))}).then(()=>this.finishLoadEditablePortalLayer(e));return this.addResolvingPromise(r),Promise.resolve(this)}readCapabilities(e,t){return t=t.layerDefinition||t,{analytics:this._readAnalyticsCapabilities(t),attachment:this._readAttachmentCapabilities(t),data:this._readDataCapabilities(t),metadata:this._readMetadataCapabilities(t),operations:this._readOperationsCapabilities(t.capabilities||e,t),query:this._readQueryCapabilities(t),queryRelated:this._readQueryRelatedCapabilities(t),queryTopFeatures:this._readQueryTopFeaturesCapabilities(t),editing:this._readEditingCapabilities(t)}}get createQueryVersion(){return this.commitProperty("definitionExpression"),this.commitProperty("dynamicDataSource"),this.commitProperty("timeExtent"),this.commitProperty("timeOffset"),this.commitProperty("geometryType"),this.commitProperty("gdbVersion"),this.commitProperty("historicMoment"),this.commitProperty("returnZ"),this.commitProperty("capabilities"),this.commitProperty("returnM"),(this._get("createQueryVersion")||0)+1}get editingEnabled(){return!(this.loaded&&!this.capabilities.operations.supportsEditing)&&(this._isOverridden("editingEnabled")?this._get("editingEnabled"):this._hasMemorySource()||this.userHasEditingPrivileges)}set editingEnabled(e){e!=null?this._override("editingEnabled",e):this._clearOverride("editingEnabled")}readEditingEnabled(e,t){return this._readEditingEnabled(t,!1)}readEditingEnabledFromWebMap(e,t,r){return this._readEditingEnabled(t,!0,r)}writeEditingEnabled(e,t){this._writeEditingEnabled(e,t,!1)}writeEditingEnabledToWebMap(e,t,r,i){this._writeEditingEnabled(e,t,!0,i)}readEditingInfo(e,t){const{editingInfo:r}=t;return r?{lastEditDate:r.lastEditDate!=null?new Date(r.lastEditDate):null}:null}readIsTable(e,t){return(t=t&&t.layerDefinition||t).type==="Table"||!t.geometryType}writeIsTable(e,t,r,i){i!=null&&i.writeLayerSchema&&ud(r,e?"Table":"Feature Layer",t)}readMinScale(e,t){return t.effectiveMinScale||e||0}readMaxScale(e,t){return t.effectiveMaxScale||e||0}readGlobalIdFieldFromService(e,t){if((t=t.layerDefinition||t).globalIdField)return t.globalIdField;if(t.fields){for(const r of t.fields)if(r.type==="esriFieldTypeGlobalID")return r.name}}readObjectIdFieldFromService(e,t){if((t=t.layerDefinition||t).objectIdField)return t.objectIdField;if(t.fields){for(const r of t.fields)if(r.type==="esriFieldTypeOID")return r.name}}get parsedUrl(){const e=this.url?pn(this.url):null;return e!=null&&(this.dynamicDataSource!=null?e.path=vl(e.path,"dynamicLayer"):this.layerId!=null&&(e.path=vl(e.path,this.layerId.toString()))),e}get defaultPopupTemplate(){return this.createPopupTemplate()}set renderer(e){G5(e,this.fieldsIndex),this._set("renderer",e)}readRenderer(e,t,r){const i=(t=t.layerDefinition||t).drawingInfo&&t.drawingInfo.renderer||void 0;if(i){const n=L6e(i,t,r)||void 0;return n||dfe.error("Failed to create renderer",{rendererDefinition:t.drawingInfo.renderer,layer:this,context:r}),n}if(t.defaultSymbol)return t.types&&t.types.length?new bz({defaultSymbol:uj(t.defaultSymbol,t,r),field:t.typeIdField,uniqueValueInfos:t.types.map(n=>({id:n.id,symbol:uj(n.symbol,n,r)}))}):new gne({symbol:uj(t.defaultSymbol,t,r)})}set source(e){const t=this._get("source");t!==e&&(ufe(t)&&this._resetMemorySource(t),ufe(e)&&this._initMemorySource(e),this._set("source",e))}castSource(e){return e?Array.isArray(e)||e instanceof lt?new $g({layer:this,items:e}):e:null}readSource(e,t){const r=ym.fromJSON(t.featureSet);return new $g({layer:this,items:r&&r.features||[]})}readServiceDefinitionExpression(e,t){return t.definitionQuery||t.definitionExpression}readTemplates(e,t){const r=t.editFieldsInfo,i=r&&r.creatorField,n=r&&r.editorField;return e=e&&e.map(s=>xz.fromJSON(s)),this._fixTemplates(e,i),this._fixTemplates(e,n),e}readTitle(e,t){const r=t.layerDefinition&&t.layerDefinition.name||t.name,i=t.title||t.layerDefinition&&t.layerDefinition.title;if(r){const n=this.portalItem&&this.portalItem.title;if(this.sublayerTitleMode==="item-title")return this.url?q6e(this.url,r):r;let s=r;if(!s&&this.url){const a=jw(this.url);_(a)&&(s=a.title)}return s?(this.sublayerTitleMode==="item-title-and-service-name"&&n&&n!==s&&(s=n+" - "+s),_z(s)):void 0}if(this.sublayerTitleMode==="item-title"&&i)return i}readTitleFromWebMap(e,t){return t.title||t.layerDefinition&&t.layerDefinition.name}readTypeIdField(e,t){let r=(t=t.layerDefinition||t).typeIdField;if(r&&t.fields){r=r.toLowerCase();const i=t.fields.find(n=>n.name.toLowerCase()===r);i&&(r=i.name)}return r}readTypes(e,t){e=(t=t.layerDefinition||t).types;const r=t.editFieldsInfo,i=r&&r.creatorField,n=r&&r.editorField;return e&&e.map(s=>(s=Ine.fromJSON(s),this._fixTemplates(s.templates,i),this._fixTemplates(s.templates,n),s))}set url(e){const t=H6e({layer:this,url:e,nonStandardUrlAllowed:!0,logger:dfe});this._set("url",t.url),t.layerId!=null&&this._set("layerId",t.layerId)}writeUrl(e,t,r,i){W6e(this,e,null,t,i)}readVersion(e,t){return t.currentVersion?t.currentVersion:t.hasOwnProperty("capabilities")||t.hasOwnProperty("drawingInfo")||t.hasOwnProperty("hasAttachments")||t.hasOwnProperty("htmlPopupType")||t.hasOwnProperty("relationships")||t.hasOwnProperty("timeInfo")||t.hasOwnProperty("typeIdField")||t.hasOwnProperty("types")?10:9.3}readVisible(e,t){return t.layerDefinition&&t.layerDefinition.defaultVisibility!=null?!!t.layerDefinition.defaultVisibility:t.visibility!=null?!!t.visibility:void 0}addAttachment(e,t){return this.load().then(()=>this._checkAttachmentSupport(e)).then(()=>{if(!("addAttachment"in this.source))throw new k(os,"Layer source does not support addAttachment capability");return this.source.addAttachment(e,t)})}updateAttachment(e,t,r){return this.load().then(()=>this._checkAttachmentSupport(e)).then(()=>{if(!("updateAttachment"in this.source))throw new k(os,"Layer source does not support updateAttachment capability");return this.source.updateAttachment(e,t,r)})}async applyEdits(e,t){const r=await ie(()=>import("./editingSupport.d59c083d.js"),[],import.meta.url);return await this.load(),r.applyEdits(this,this.source,e,t)}on(e,t){return super.on(e,t)}createPopupTemplate(e){return Lne(this,e)}async createGraphicsSource(e){if(this._hasMemorySource())return this.source.load({signal:e});const{default:t}=await q2e(ie(()=>import("./FeatureLayerSource.27ec9bb2.js"),[],import.meta.url),e);return new t({layer:this}).load({signal:e})}createQuery(){const e=new Zn,t=this.get("capabilities.data"),r=this.get("capabilities.query");e.dynamicDataSource=this.dynamicDataSource,e.historicMoment=this.historicMoment,e.gdbVersion=this.gdbVersion,e.returnGeometry=!0,r&&(e.compactGeometryEnabled=r.supportsCompactGeometry,e.defaultSpatialReferenceEnabled=r.supportsDefaultSpatialReference),t&&(t.supportsZ&&this.returnZ!=null&&(e.returnZ=this.returnZ),t.supportsM&&this.returnM!=null&&(e.returnM=this.returnM)),e.outFields=["*"];const i=_(this.subtypeCode)?`${this.subtypeField} = ${this.subtypeCode}`:null,n=F6e(this.definitionExpression,i);e.where=n||"1=1";const{timeOffset:s,timeExtent:a}=this;return e.timeExtent=s!=null&&a!=null?a.offset(-s.value,s.unit):a||null,e.multipatchOption=this.geometryType==="multipatch"?"xyFootprint":null,e}deleteAttachments(e,t){return this.load().then(()=>this._checkAttachmentSupport(e)).then(()=>{if(!("deleteAttachments"in this.source))throw new k(os,"Layer source does not support deleteAttachments capability");return this.source.deleteAttachments(e,t)})}fetchRecomputedExtents(e){return this.load({signal:e==null?void 0:e.signal}).then(()=>{if(this.source.fetchRecomputedExtents)return this.source.fetchRecomputedExtents(e);throw new k(os,"Layer source does not support fetchUpdates capability")})}getFeatureType(e){const{typeIdField:t,types:r}=this;if(!t||!e)return null;const i=e.attributes?e.attributes[t]:void 0;if(i==null)return null;let n=null;return r.some(s=>{const{id:a}=s;return a!=null&&(a.toString()===i.toString()&&(n=s),!!n)}),n}getFieldDomain(e,t){const r=t&&t.feature,i=this.getFeatureType(r);if(i){const n=i.domains&&i.domains[e];if(n&&n.type!=="inherited")return n}return this._getLayerDomain(e)}getField(e){return this.fieldsIndex.get(e)}queryAttachments(e,t){return e=cN.from(e),this.load().then(()=>{if(!this.get("capabilities.data.supportsAttachment"))throw new k(os,"this layer doesn't support attachments");const{attachmentTypes:r,objectIds:i,globalIds:n,num:s,size:a,start:o,where:l}=e;if(!this.get("capabilities.operations.supportsQueryAttachments")){const c=i&&i.length>1,u=r&&r.length,h=n&&n.length,p=a&&a.length;if(c||u||h||p||s||o||l)throw new k(os,"when 'supportsQueryAttachments' is false, only objectIds of length 1 are supported",e)}if(!(i&&i.length||l))throw new k(os,"'objectIds' or 'where' are required to perform attachment query",e);if(!("queryAttachments"in this.source))throw new k(os,"Layer source does not support queryAttachments capability",e);return this.source.queryAttachments(e)})}queryFeatures(e,t){return this.load().then(()=>this.source.queryFeatures(Zn.from(e)||this.createQuery(),t)).then(r=>{if(r!=null&&r.features)for(const i of r.features)i.layer=i.sourceLayer=this;return r})}queryObjectIds(e,t){return this.load().then(()=>{if(this.source.queryObjectIds)return this.source.queryObjectIds(Zn.from(e)||this.createQuery(),t);throw new k(os,"Layer source does not support queryObjectIds capability")})}queryFeatureCount(e,t){return this.load().then(()=>{if(this.source.queryFeatureCount)return this.source.queryFeatureCount(Zn.from(e)||this.createQuery(),t);throw new k(os,"Layer source does not support queryFeatureCount capability")})}queryExtent(e,t){return this.load().then(()=>{if(this.source.queryExtent)return this.source.queryExtent(Zn.from(e)||this.createQuery(),t);throw new k(os,"Layer source does not support queryExtent capability")})}queryRelatedFeatures(e,t){return this.load().then(()=>{if("queryRelatedFeatures"in this.source)return this.source.queryRelatedFeatures(Bw.from(e),t);throw new k(os,"Layer source does not support queryRelatedFeatures capability")})}queryRelatedFeaturesCount(e,t){return this.load().then(()=>{if("queryRelatedFeaturesCount"in this.source)return this.source.queryRelatedFeaturesCount(Bw.from(e),t);throw new k(os,"Layer source does not support queryRelatedFeaturesCount capability")})}queryTopFeatures(e,t){return this.load().then(()=>{if("queryTopFeatures"in this.source&&this.get("capabilities.query.supportsTopFeaturesQuery"))return this.source.queryTopFeatures(uv.from(e),t).then(r=>{if(r!=null&&r.features)for(const i of r.features)i.layer=i.sourceLayer=this;return r});throw new k(os,"Layer source does not support queryTopFeatures capability")})}queryTopObjectIds(e,t){return this.load().then(()=>{if("queryTopObjectIds"in this.source&&this.get("capabilities.query.supportsTopFeaturesQuery"))return this.source.queryTopObjectIds(uv.from(e),t);throw new k(os,"Layer source does not support queryTopObjectIds capability")})}queryTopFeaturesExtent(e,t){return this.load().then(()=>{if("queryTopExtents"in this.source&&this.get("capabilities.query.supportsTopFeaturesQuery"))return this.source.queryTopExtents(uv.from(e),t);throw new k(os,"Layer source does not support queryTopExtents capability")})}queryTopFeatureCount(e,t){return this.load().then(()=>{if("queryTopCount"in this.source&&this.get("capabilities.query.supportsTopFeaturesQuery"))return this.source.queryTopCount(uv.from(e),t);throw new k(os,"Layer source does not support queryFeatureCount capability")})}read(e,t){const r=e.featureCollection;if(r){const i=r.layers;i&&i.length===1&&(super.read(i[0],t),r.showLegend!=null&&super.read({showLegend:r.showLegend},t))}super.read(e,t),t&&t.origin==="service"&&this.revert(["objectIdField","fields","timeInfo","spatialReference"],"service")}write(e,t){var s;t={...t,writeLayerSchema:(s=t==null?void 0:t.writeLayerSchema)!=null?s:this._hasMemorySource()};const{origin:r,layerContainerType:i,messages:n}=t;if(this.dynamicDataSource)return n==null||n.push(pP(this,"using a dynamic data source cannot be written to web scenes, web maps and feature service items")),null;if(this.isTable){if(r==="web-scene"||r==="web-map"&&i!=="tables")return n==null||n.push(pP(this,"using a table source cannot be written to web scenes and web maps")),null;if(this._hasMemorySource())return n==null||n.push(pP(this,"using an in-memory table source cannot be written to web scenes and web maps")),null}else if(this.loaded&&r==="web-map"&&i==="tables")return n==null||n.push(pP(this,"using a non-table source cannot be written to tables in web maps")),null;return super.write(e,t)}clone(){if(this._hasMemorySource())throw new k(os,`FeatureLayer (title: ${this.title}, id: ${this.id}) created using in-memory source cannot be cloned`);return super.clone()}serviceSupportsSpatialReference(e){return!!this.loaded&&(this.source.type==="memory"||Yit(this,e))}async save(e){return(await ie(()=>import("./featureLayerUtils.1c187505.js"),["featureLayerUtils.1c187505.js","arcgisLayers.0a615040.js","lazyLayerLoader.5e7c3b38.js","jsonContext.b1feec67.js","portalItemUtils.59cab615.js"],import.meta.url)).save(this,e)}async saveAs(e,t){return(await ie(()=>import("./featureLayerUtils.1c187505.js"),["featureLayerUtils.1c187505.js","arcgisLayers.0a615040.js","lazyLayerLoader.5e7c3b38.js","jsonContext.b1feec67.js","portalItemUtils.59cab615.js"],import.meta.url)).saveAs(this,e,t)}_readEditingEnabled(e,t,r){var n;let i=(n=e.layerDefinition)==null?void 0:n.capabilities;return i?this._hasEditingCapability(i):(i=e.capabilities,t&&(r==null?void 0:r.origin)==="web-map"&&!this._hasMemorySource()&&i?this._hasEditingCapability(i):void 0)}_hasEditingCapability(e){return e.toLowerCase().split(",").map(t=>t.trim()).includes("editing")}_writeEditingEnabled(e,t,r,i){var n,s;if(!e){const a=(s=(n=this.capabilities)==null?void 0:n.operations)!=null&&s.supportsSync?"Query,Sync":"Query";ud("layerDefinition.capabilities",a,t),r&&!(i!=null&&i.writeLayerSchema)&&(t.capabilities=a)}}_checkAttachmentSupport(e){const{attributes:t}=e,{objectIdField:r}=this;return this.get("capabilities.data.supportsAttachment")?e?t?t[r]?void 0:Promise.reject(new k(os,`feature is missing the identifying attribute ${r}`)):Promise.reject(new k(os,"'attributes' are required on a feature to query attachments")):Promise.reject(new k(os,"A feature is required to add/delete/update attachments")):Promise.reject(new k(os,"this layer doesn't support attachments"))}_getLayerDomain(e){const t=this.fieldsIndex.get(e);return t?t.domain:null}_fetchFirstLayerId(e){return qt(this.url,{query:{f:"json",...this.customParameters,token:this.apiKey},responseType:"json",signal:e}).then(t=>{const r=t.data;if(r)return Array.isArray(r.layers)&&r.layers.length>0?r.layers[0].id:Array.isArray(r.tables)&&r.tables.length>0?r.tables[0].id:void 0})}async _initLayerProperties(e){return this._set("source",e),e.sourceJSON&&(this.sourceJSON=e.sourceJSON,this.read(e.sourceJSON,{origin:"service",url:this.parsedUrl})),this._verifySource(),this._verifyFields(),G5(this.renderer,this.fieldsIndex),Tre(this.timeInfo,this.fieldsIndex),v8e(this,{origin:"service"})}async hasDataChanged(){var e,t;if((e=this.source)!=null&&e.refresh)try{const{dataChanged:r,updates:i}=await((t=this.source)==null?void 0:t.refresh());if(_(i)&&(this.sourceJSON={...this.sourceJSON,...i},this.read(i,{origin:"service",url:this.parsedUrl})),r)return!0}catch{}if(this.definitionExpression)try{return(await Prt(this.definitionExpression,this.fieldsIndex)).hasDateFunctions}catch{}return!1}_verifyFields(){var t;const e=this.parsedUrl&&this.parsedUrl.path||"undefined";this.objectIdField||console.log("FeatureLayer: 'objectIdField' property is not defined (url: "+e+")"),this.isTable||this._hasMemorySource()||e.search(/\/FeatureServer\//i)!==-1||((t=this.fields)==null?void 0:t.some(r=>r.type==="geometry"))||console.log("FeatureLayer: unable to find field of type 'geometry' in the layer 'fields' list. If you are using a map service layer, features will not have geometry (url: "+e+")")}_fixTemplates(e,t){e&&e.forEach(r=>{const i=r.prototype&&r.prototype.attributes;i&&t&&delete i[t]})}_verifySource(){if(this._hasMemorySource()){if(this.url)throw new k("feature-layer:mixed-source-and-url","FeatureLayer cannot be created with both an in-memory source and a url")}else if(!this.url)throw new k("feature-layer:source-or-url-required","FeatureLayer requires either a url, a valid portal item or a source")}_initMemorySource(e){e.forEach(t=>{t.layer=this,t.sourceLayer=this}),this._handles.add([e.on("after-add",t=>{t.item.layer=this,t.item.sourceLayer=this}),e.on("after-remove",t=>{t.item.layer=null,t.item.sourceLayer=null})],"fl-source")}_resetMemorySource(e){e.forEach(t=>{t.layer=null,t.sourceLayer=null}),this._handles.remove("fl-source")}_hasMemorySource(){return!(this.url||!this.source)}_readAnalyticsCapabilities(e){return{supportsCacheHint:r8(e.advancedQueryCapabilities,"queryAnalytics")}}_readAttachmentCapabilities(e){const t=e.attachmentProperties,r={supportsName:!1,supportsSize:!1,supportsContentType:!1,supportsKeywords:!1,supportsExifInfo:!1,supportsCacheHint:r8(e.advancedQueryCapabilities,"queryAttachments"),supportsResize:Ut(e,"supportsAttachmentsResizing",!1)};return t&&Array.isArray(t)&&t.forEach(i=>{const n=lnt[i.name];n&&(r[n]=!!i.isEnabled)}),r}_readDataCapabilities(e){return{isVersioned:Ut(e,"isDataVersioned",!1),supportsAttachment:Ut(e,"hasAttachments",!1),supportsM:Ut(e,"hasM",!1),supportsZ:Ut(e,"hasZ",!1)}}_readMetadataCapabilities(e){return{supportsAdvancedFieldProperties:Ut(e,"supportsFieldDescriptionProperty",!1)}}_readOperationsCapabilities(e,t){const r=e?e.toLowerCase().split(",").map(h=>h.trim()):[],i=this.url?jw(this.url):null,n=r.includes(_(i)&&i.serverType==="MapServer"?"data":"query"),s=r.includes("editing")&&!t.datesInUnknownTimezone;let a=s&&r.includes("create"),o=s&&r.includes("delete"),l=s&&r.includes("update");const c=r.includes("changetracking"),u=t.advancedQueryCapabilities;return s&&!(a||o||l)&&(a=o=l=!0),{supportsCalculate:Ut(t,"supportsCalculate",!1),supportsTruncate:Ut(t,"supportsTruncate",!1),supportsValidateSql:Ut(t,"supportsValidateSql",!1),supportsAdd:a,supportsDelete:o,supportsEditing:s,supportsChangeTracking:c,supportsQuery:n,supportsQueryAnalytics:Ut(u,"supportsQueryAnalytic",!1),supportsQueryAttachments:Ut(u,"supportsQueryAttachments",!1),supportsQueryTopFeatures:Ut(u,"supportsTopFeaturesQuery",!1),supportsResizeAttachments:Ut(t,"supportsAttachmentsResizing",!1),supportsSync:r.includes("sync"),supportsUpdate:l,supportsExceedsLimitStatistics:Ut(t,"supportsExceedsLimitStatistics",!1)}}_readQueryCapabilities(e){var l;const t=e.advancedQueryCapabilities,r=e.ownershipBasedAccessControlForFeatures,i=e.archivingInfo,n=(l=this.url)==null?void 0:l.includes("MapServer"),s=!ue("mapserver-pbf-enabled")&&n&&this.version<10.81,a=wne(this.url),o=(e.supportedQueryFormats||"").split(",").reduce((c,u)=>{const h=u.toLowerCase().trim();return h&&c.add(h),c},new Set);return{supportsStatistics:Ut(t,"supportsStatistics",e.supportsStatistics),supportsPercentileStatistics:Ut(t,"supportsPercentileStatistics",!1),supportsSpatialAggregationStatistics:Ut(t,"supportsSpatialAggregationStatistics",!1),supportedSpatialAggregationStatistics:cnt(t),supportsCentroid:Ut(t,"supportsReturningGeometryCentroid",!1),supportsDistance:Ut(t,"supportsQueryWithDistance",!1),supportsDistinct:Ut(t,"supportsDistinct",e.supportsAdvancedQueries),supportsExtent:Ut(t,"supportsReturningQueryExtent",!1),supportsGeometryProperties:Ut(t,"supportsReturningGeometryProperties",!1),supportsHavingClause:Ut(t,"supportsHavingClause",!1),supportsOrderBy:Ut(t,"supportsOrderBy",e.supportsAdvancedQueries),supportsPagination:Ut(t,"supportsPagination",!1),supportsQuantization:Ut(e,"supportsCoordinatesQuantization",!1),supportsQuantizationEditMode:Ut(e,"supportsQuantizationEditMode",!1),supportsQueryGeometry:Ut(e,"supportsReturningQueryGeometry",!1),supportsResultType:Ut(t,"supportsQueryWithResultType",!1),supportsMaxRecordCountFactor:Ut(t,"supportsMaxRecordCountFactor",!1),supportsSqlExpression:Ut(t,"supportsSqlExpression",!1),supportsStandardizedQueriesOnly:Ut(e,"useStandardizedQueries",!1),supportsTopFeaturesQuery:Ut(t,"supportsTopFeaturesQuery",!1),supportsQueryByOthers:Ut(r,"allowOthersToQuery",!0),supportsHistoricMoment:Ut(i,"supportsQueryWithHistoricMoment",!1),supportsFormatPBF:!s&&o.has("pbf"),supportsDisjointSpatialRelationship:Ut(t,"supportsDisjointSpatialRel",!1),supportsCacheHint:Ut(t,"supportsQueryWithCacheHint",!1)||r8(t,"query"),supportsDefaultSpatialReference:Ut(t,"supportsDefaultSR",!1),supportsCompactGeometry:a,maxRecordCountFactor:mP(e,"maxRecordCountFactor",void 0),maxRecordCount:mP(e,"maxRecordCount",void 0),standardMaxRecordCount:mP(e,"standardMaxRecordCount",void 0),tileMaxRecordCount:mP(e,"tileMaxRecordCount",void 0)}}_readQueryRelatedCapabilities(e){const t=e.advancedQueryCapabilities,r=Ut(t,"supportsAdvancedQueryRelated",!1);return{supportsPagination:Ut(t,"supportsQueryRelatedPagination",!1),supportsCount:r,supportsOrderBy:r,supportsCacheHint:r8(t,"queryRelated")}}_readQueryTopFeaturesCapabilities(e){return{supportsCacheHint:r8(e.advancedQueryCapabilities,"queryTopFilter")}}_readEditingCapabilities(e){const t=e.ownershipBasedAccessControlForFeatures;return{supportsGeometryUpdate:Ut(e,"allowGeometryUpdates",!0),supportsGlobalId:Ut(e,"supportsApplyEditsWithGlobalIds",!1),supportsReturnServiceEditsInSourceSpatialReference:Ut(e,"supportsReturnServiceEditsInSourceSR",!1),supportsRollbackOnFailure:Ut(e,"supportsRollbackOnFailureParameter",!1),supportsUpdateWithoutM:Ut(e,"allowUpdateWithoutMValues",!1),supportsUploadWithItemId:Ut(e,"supportsAttachmentsByUploadId",!1),supportsDeleteByAnonymous:Ut(t,"allowAnonymousToDelete",!0),supportsDeleteByOthers:Ut(t,"allowOthersToDelete",!0),supportsUpdateByAnonymous:Ut(t,"allowAnonymousToUpdate",!0),supportsUpdateByOthers:Ut(t,"allowOthersToUpdate",!0)}}};d([f({readOnly:!0,json:{read:!1}})],Ie.prototype,"capabilities",void 0),d([$e("service","capabilities",["advancedQueryCapabilities","allowGeometryUpdates","allowUpdateWithoutMValues","archivingInfo","capabilities","datesInUnknownTimezone","hasAttachments","hasM","hasZ","maxRecordCount","maxRecordCountFactor","ownershipBasedAccessControlForFeatures","standardMaxRecordCount","supportedQueryFormats","supportsAdvancedQueries","supportsApplyEditsWithGlobalIds","supportsAttachmentsByUploadId","supportsAttachmentsResizing","supportsCalculate","supportsCoordinatesQuantization","supportsExceedsLimitStatistics","supportsFieldDescriptionProperty","supportsQuantizationEditMode","supportsRollbackOnFailureParameter","supportsStatistics","supportsTruncate","supportsValidateSql","tileMaxRecordCount","useStandardizedQueries"])],Ie.prototype,"readCapabilities",null),d([f({json:{origins:{"portal-item":{write:!0},"web-map":{write:!0}}}})],Ie.prototype,"charts",void 0),d([f({readOnly:!0})],Ie.prototype,"createQueryVersion",null),d([f({type:String,json:{read:{source:"layerDefinition.copyrightText"},origins:{service:{read:{source:"copyrightText"}}}}})],Ie.prototype,"copyright",void 0),d([f({type:Boolean})],Ie.prototype,"datesInUnknownTimezone",void 0),d([f({type:String,json:{read:{source:"layerDefinition.displayField"},origins:{service:{read:{source:"displayField"}}}}})],Ie.prototype,"displayField",void 0),d([f({type:String,json:{origins:{service:{read:!1,write:!1}},name:"layerDefinition.definitionExpression",write:{enabled:!0,allowNull:!0}}})],Ie.prototype,"definitionExpression",void 0),d([f({types:ow,readOnly:!0})],Ie.prototype,"defaultSymbol",void 0),d([f({type:jc})],Ie.prototype,"dynamicDataSource",void 0),d([f({readOnly:!0})],Ie.prototype,"editFieldsInfo",void 0),d([f({type:Boolean})],Ie.prototype,"editingEnabled",null),d([$e(["portal-item","web-scene"],"editingEnabled",["layerDefinition.capabilities"])],Ie.prototype,"readEditingEnabled",null),d([$e("web-map","editingEnabled",["capabilities","layerDefinition.capabilities"])],Ie.prototype,"readEditingEnabledFromWebMap",null),d([Xe(["portal-item","web-scene"],"editingEnabled",{"layerDefinition.capabilities":{type:String}})],Ie.prototype,"writeEditingEnabled",null),d([Xe("web-map","editingEnabled",{capabilities:{type:String},"layerDefinition.capabilities":{type:String}})],Ie.prototype,"writeEditingEnabledToWebMap",null),d([f({readOnly:!0})],Ie.prototype,"editingInfo",void 0),d([$e("editingInfo")],Ie.prototype,"readEditingInfo",null),d([f((()=>{const e=te(Ene),t=e.json.origins;return t["web-map"]={read:!1,write:!1},t["portal-item"]={read:!1,write:!1},e})())],Ie.prototype,"elevationInfo",void 0),d([f(g8e)],Ie.prototype,"featureReduction",void 0),d([f({...cj.fields,json:{read:{source:"layerDefinition.fields"},origins:{service:{name:"fields"},"web-map":{write:{target:"layerDefinition.fields",overridePolicy:dj}}}}})],Ie.prototype,"fields",void 0),d([f(cj.fieldsIndex)],Ie.prototype,"fieldsIndex",void 0),d([f({type:b8e,json:{read:{source:"layerDefinition.floorInfo"},write:{target:"layerDefinition.floorInfo"}}})],Ie.prototype,"floorInfo",void 0),d([f({type:Grt,json:{name:"formInfo",write:!0,origins:{"web-scene":{read:!1,write:!1}}}})],Ie.prototype,"formTemplate",void 0),d([f({type:Zt,json:{origins:{service:{read:{source:"extent"}}},read:{source:"layerDefinition.extent"}}})],Ie.prototype,"fullExtent",void 0),d([f()],Ie.prototype,"gdbVersion",void 0),d([f({readOnly:!0,type:qit,json:{read:{source:"geometryProperties"}}})],Ie.prototype,"geometryFieldsInfo",void 0),d([f({type:["point","polygon","polyline","multipoint","multipatch","mesh"],json:{origins:{service:{read:lj.read},"web-map":{write:{target:"layerDefinition.geometryType",overridePolicy:dj,writer(e,t,r){const i=e?lj.toJSON(e):null;i&&ud(r,i,t)}}}},read:{source:"layerDefinition.geometryType",reader:lj.read}}})],Ie.prototype,"geometryType",void 0),d([f({type:Boolean,json:{origins:{service:{read:!0}},read:{source:"layerDefinition.hasM"}}})],Ie.prototype,"hasM",void 0),d([f({type:Boolean,json:{origins:{service:{read:!0}},read:{source:"layerDefinition.hasZ"}}})],Ie.prototype,"hasZ",void 0),d([f({readOnly:!0,type:Ex})],Ie.prototype,"heightModelInfo",void 0),d([f({type:Date})],Ie.prototype,"historicMoment",void 0),d([f(Cne)],Ie.prototype,"id",void 0),d([f({readOnly:!0,json:{origins:{service:{read:!0}},read:!1}})],Ie.prototype,"infoFor3D",void 0),d([f({readOnly:!0,json:{origins:{"web-map":{write:{target:"layerDefinition.type"}}}}})],Ie.prototype,"isTable",void 0),d([$e("service","isTable",["type","geometryType"]),$e("isTable",["layerDefinition.type","layerDefinition.geometryType"])],Ie.prototype,"readIsTable",null),d([Xe("web-map","isTable")],Ie.prototype,"writeIsTable",null),d([f(mO)],Ie.prototype,"labelsVisible",void 0),d([f({type:[g6],json:{origins:{service:{read:{source:"drawingInfo.labelingInfo",reader:PA},write:{target:"drawingInfo.labelingInfo",enabled:!1}}},read:{source:"layerDefinition.drawingInfo.labelingInfo",reader:PA},write:{target:"layerDefinition.drawingInfo.labelingInfo"}}})],Ie.prototype,"labelingInfo",void 0),d([f((()=>{const e=te(lit);return e.json.origins["portal-item"]={write:{target:"layerDefinition.drawingInfo.transparency",writer(t,r,i){ud(i,gV(t),r)}}},e})())],Ie.prototype,"opacity",void 0),d([f({type:Number,json:{origins:{service:{read:{source:"id"}},"portal-item":{read:!1,write:{target:"id"}}},read:!1}})],Ie.prototype,"layerId",void 0),d([f(Sne)],Ie.prototype,"legendEnabled",void 0),d([f({type:["show","hide"],json:(()=>{const e=te(J6e.json);return e.origins["portal-item"]={read:!1,write:!1},e})()})],Ie.prototype,"listMode",void 0),d([f(dit)],Ie.prototype,"minScale",void 0),d([$e("service","minScale",["minScale","effectiveMinScale"])],Ie.prototype,"readMinScale",null),d([f(uit)],Ie.prototype,"maxScale",void 0),d([$e("service","maxScale",["maxScale","effectiveMaxScale"])],Ie.prototype,"readMaxScale",null),d([f({type:String})],Ie.prototype,"globalIdField",void 0),d([$e("globalIdField",["layerDefinition.globalIdField","layerDefinition.fields"]),$e("service","globalIdField",["globalIdField","fields"])],Ie.prototype,"readGlobalIdFieldFromService",null),d([f({type:String,json:{origins:{"web-map":{write:{target:"layerDefinition.objectIdField",overridePolicy:dj}}}}})],Ie.prototype,"objectIdField",void 0),d([$e("objectIdField",["layerDefinition.objectIdField","layerDefinition.fields"]),$e("service","objectIdField",["objectIdField","fields"])],Ie.prototype,"readObjectIdFieldFromService",null),d([f({value:"ArcGISFeatureLayer",type:["ArcGISFeatureLayer"]})],Ie.prototype,"operationalLayerType",void 0),d([f(cj.outFields)],Ie.prototype,"outFields",void 0),d([f({readOnly:!0})],Ie.prototype,"parsedUrl",null),d([f({type:String,json:{origins:{"web-scene":{read:!0,write:!0}},read:!1}})],Ie.prototype,"path",void 0),d([f(pO)],Ie.prototype,"popupEnabled",void 0),d([f({type:_x,json:{name:"popupInfo",write:!0}})],Ie.prototype,"popupTemplate",void 0),d([f({readOnly:!0})],Ie.prototype,"defaultPopupTemplate",null),d([f({type:[Xit],readOnly:!0})],Ie.prototype,"relationships",void 0),d([f({types:fO,json:{origins:{service:{write:{target:"drawingInfo.renderer",enabled:!1}},"web-scene":{types:bne,name:"layerDefinition.drawingInfo.renderer",write:{overridePolicy:(e,t,r)=>({ignoreOrigin:r==null?void 0:r.writeLayerSchema})}}},write:{target:"layerDefinition.drawingInfo.renderer",overridePolicy:(e,t,r)=>({ignoreOrigin:r==null?void 0:r.writeLayerSchema})}}})],Ie.prototype,"renderer",null),d([$e("service","renderer",["drawingInfo.renderer","defaultSymbol"]),$e("renderer",["layerDefinition.drawingInfo.renderer","layerDefinition.defaultSymbol"])],Ie.prototype,"readRenderer",null),d([f()],Ie.prototype,"sourceJSON",void 0),d([f({type:Boolean})],Ie.prototype,"returnM",void 0),d([f({type:Boolean})],Ie.prototype,"returnZ",void 0),d([f((()=>{const e=te(xne);return e.json.origins["portal-item"]={read:!1,write:!1},e})())],Ie.prototype,"screenSizePerspectiveEnabled",void 0),d([f({clonable:!1})],Ie.prototype,"source",null),d([Xt("source")],Ie.prototype,"castSource",null),d([$e("portal-item","source",["featureSet"]),$e("web-map","source",["featureSet"])],Ie.prototype,"readSource",null),d([f({readOnly:!0})],Ie.prototype,"serviceDefinitionExpression",void 0),d([$e("service","serviceDefinitionExpression",["definitionQuery","definitionExpression"])],Ie.prototype,"readServiceDefinitionExpression",null),d([f({type:Ye,json:{origins:{service:{read:{source:"extent.spatialReference"}}},read:{source:"layerDefinition.extent.spatialReference"}}})],Ie.prototype,"spatialReference",void 0),d([f({type:Number})],Ie.prototype,"subtypeCode",void 0),d([f({type:String,json:{origins:{service:{read:!0}}}})],Ie.prototype,"subtypeField",void 0),d([f({type:[xz]})],Ie.prototype,"templates",void 0),d([$e("templates",["editFieldsInfo","creatorField","editorField","templates"])],Ie.prototype,"readTemplates",null),d([f({type:s8e})],Ie.prototype,"timeInfo",void 0),d([f()],Ie.prototype,"title",void 0),d([$e("service","title",["name"]),$e("portal-item","title",["layerDefinition.title","layerDefinition.name","title"])],Ie.prototype,"readTitle",null),d([$e("web-map","title",["layerDefinition.name","title"])],Ie.prototype,"readTitleFromWebMap",null),d([f({type:String})],Ie.prototype,"sublayerTitleMode",void 0),d([f({type:String,json:{read:{source:"timeInfo.trackIdField"}}})],Ie.prototype,"trackIdField",void 0),d([f({json:{read:!1}})],Ie.prototype,"type",void 0),d([f({type:String})],Ie.prototype,"typeIdField",void 0),d([$e("service","typeIdField"),$e("typeIdField",["layerDefinition.typeIdField"])],Ie.prototype,"readTypeIdField",null),d([f({type:[Ine]})],Ie.prototype,"types",void 0),d([$e("service","types",["types"]),$e("types",["layerDefinition.types"])],Ie.prototype,"readTypes",null),d([f({readOnly:!0,json:{write:!1}})],Ie.prototype,"serverGens",void 0),d([f({type:lt.ofType(Lg),readOnly:!0})],Ie.prototype,"indexes",void 0),d([f(Tne)],Ie.prototype,"url",null),d([Xe("url")],Ie.prototype,"writeUrl",null),d([f({readOnly:!0})],Ie.prototype,"userIsAdmin",void 0),d([f({json:{origins:{service:{read:!0}},read:!1}})],Ie.prototype,"version",void 0),d([$e("service","version",["currentVersion","capabilities","drawingInfo","hasAttachments","htmlPopupType","relationships","timeInfo","typeIdField","types"])],Ie.prototype,"readVersion",null),d([f({type:Boolean,json:{origins:{"portal-item":{write:{target:"layerDefinition.defaultVisibility"}}}}})],Ie.prototype,"visible",void 0),d([$e("portal-item","visible",["visibility","layerDefinition.defaultVisibility"])],Ie.prototype,"readVisible",null),Ie=d([$("esri.layers.FeatureLayer")],Ie);const uj=Y9({types:nTe}),PN=Ie,oLt=Object.freeze(Object.defineProperty({__proto__:null,default:PN},Symbol.toStringTag,{value:"Module"})),dnt=["$datastore","$map","$layer","$aggregatedfeatures"],unt="esri.widgets.Feature.support.arcadeFeatureUtils",hnt=fe.getLogger(unt);function fnt(e){return typeof e=="string"?rO(Aie(e)):Array.isArray(e)?pnt(e):(e==null?void 0:e.declaredClass)==="esri.arcade.Dictionary"?mnt(e):e}function pnt(e){return`<ul class="esri-widget__list">${e.map(t=>`<li>${typeof t=="string"?rO(Aie(t)):t}</li>`).join("")}</ul>`}function mnt(e){return`<table class="esri-widget__table">${e.keys().map(t=>{const r=e.field(t);return`<tr><th>${t}</th><td>${typeof r=="string"?rO(Aie(r)):r}</td></tr>`}).join("")}</table>`}function gnt({aggregatedFeatures:e,arcadeUtils:t,featureSetVars:r,context:i,viewInfo:n,map:s,graphic:a,interceptor:o}){r.forEach(l=>{const c=l.toLowerCase(),u={map:s,spatialReference:n.sr,interceptor:o};if(c==="$map"&&(i.vars[c]=t.convertMapToFeatureSetCollection(u)),c==="$layer"&&(i.vars[c]=t.convertFeatureLayerToFeatureSet({layer:a.sourceLayer,spatialReference:n.sr,interceptor:o})),c==="$datastore"&&(i.vars[c]=t.convertServiceUrlToWorkspace({url:a.sourceLayer.url,spatialReference:n.sr,interceptor:o})),c==="$aggregatedfeatures"){const h=a.layer,{fields:p,objectIdField:m,geometryType:g,spatialReference:b,displayField:w}=h,v=new PN({fields:p,objectIdField:m,geometryType:g,spatialReference:b,displayField:w,...h.type==="feature"?{templates:h.templates,typeIdField:h.typeIdField,types:h.types}:null,source:e});i.vars[c]=t.convertFeatureLayerToFeatureSet({layer:v,spatialReference:n.sr,interceptor:o})}})}function w8e(){return ie(()=>import("./arcadeUtils.813d410b.js").then(e=>e.t),[],import.meta.url)}async function ynt({graphic:e,view:t}){const{isAggregate:r,layer:i}=e;if(!r||!i||(t==null?void 0:t.type)!=="2d")return[];const n=await t.whenLayerView(i);if(!n.createQuery||!n.queryFeatures)return[];const s=n.createQuery();s.aggregateIds=[e.getObjectId()];const{features:a}=await n.queryFeatures(s);return a}async function x8e({expressionInfo:e,arcadeUtils:t,interceptor:r,spatialReference:i,map:n,graphic:s,view:a}){if(!e||!e.expression)return null;const o=t.createSyntaxTree(e.expression),l=dnt.filter(m=>t.hasVariable(o,m)),[c]=await Promise.all([ynt({graphic:s,view:a}),t.loadScriptDependencies(o,!0,l)]),u=t.getViewInfo({spatialReference:i}),h=t.createExecContext(s,u);h.interceptor=r,h.useAsync=!0,gnt({aggregatedFeatures:c,arcadeUtils:t,featureSetVars:l,context:h,viewInfo:u,map:n,graphic:s,interceptor:r});const p=t.createFunction(o,h);return t.executeAsyncFunction(p,h).catch(m=>hnt.error("arcade-execution-error",{error:m,graphic:s,expressionInfo:e}))}async function bnt({expressionInfos:e,spatialReference:t,graphic:r,interceptor:i,map:n,view:s}){if(!e||!e.length)return{};const a=await w8e(),o={};for(const u of e)o[`expression/${u.name}`]=x8e({expressionInfo:u,arcadeUtils:a,interceptor:i,spatialReference:t,map:n,graphic:r,view:s});const l=await dn(o),c={};for(const u in l)c[u]=fnt(l[u].value);return c}const vnt=1;let Dd=class extends Cm(xe){constructor(e){super(e),this._abortController=null,this.expressionInfo=null,this.graphic=null,this.contentElement=null,this.contentElementViewModel=null,this.interceptor=null,this.view=null,this._cancelQuery=()=>{const{_abortController:t}=this;t&&t.abort(),this._abortController=null},this._createVM=()=>{var i,n;const t=(i=this.contentElement)==null?void 0:i.type;(n=this.contentElementViewModel)==null||n.destroy();const r=t==="fields"?new ez:t==="media"?new j3:t==="text"?new hN:null;this._set("contentElementViewModel",r)},this._compile=async()=>{this._cancelQuery();const t=new AbortController;this._abortController=t,await this._compileExpression(),this._abortController===t&&(this._abortController=null)},this._compileThrottled=vie(this._compile,vnt,this),this._compileExpression=async()=>{const{expressionInfo:t,graphic:r,interceptor:i,spatialReference:n,map:s,view:a,_abortController:o}=this;if(!(t&&r&&n&&s))return void this._set("contentElement",null);const l=await w8e();if(o!==this._abortController)return;const c=await x8e({arcadeUtils:l,expressionInfo:t,graphic:r,interceptor:i,map:s,spatialReference:n,view:a});if(!c||c.declaredClass!=="esri.arcade.Dictionary")return void this._set("contentElement",null);const u=await cne(c,o.signal),h=u==null?void 0:u.type,p=h==="media"?fA.fromJSON(u):h==="text"?q5.fromJSON(u):h==="fields"?j5.fromJSON(u):null;this._set("contentElement",p)},this.handles.add([re(()=>[this.expressionInfo,this.graphic,this.map,this.spatialReference,this.view],()=>this._compileThrottled(),Ot),re(()=>[this.contentElement],()=>this._createVM(),Ot)])}destroy(){var e;this._cancelQuery(),(e=this.contentElementViewModel)==null||e.destroy(),this._set("contentElementViewModel",null),this._set("contentElement",null)}get spatialReference(){var e;return((e=this.view)==null?void 0:e.spatialReference)||null}set spatialReference(e){e!==void 0?this._override("spatialReference",e):this._clearOverride("spatialReference")}get state(){const{_abortController:e,contentElement:t,contentElementViewModel:r}=this;return e?"loading":t||r?"ready":"disabled"}get map(){var e;return((e=this.view)==null?void 0:e.map)||null}set map(e){e!==void 0?this._override("map",e):this._clearOverride("map")}};d([f()],Dd.prototype,"_abortController",void 0),d([f({type:txe})],Dd.prototype,"expressionInfo",void 0),d([f({type:co})],Dd.prototype,"graphic",void 0),d([f({readOnly:!0})],Dd.prototype,"contentElement",void 0),d([f({readOnly:!0})],Dd.prototype,"contentElementViewModel",void 0),d([f()],Dd.prototype,"interceptor",void 0),d([f()],Dd.prototype,"spatialReference",null),d([f({readOnly:!0})],Dd.prototype,"state",null),d([f()],Dd.prototype,"map",null),d([f()],Dd.prototype,"view",void 0),Dd=d([$("esri.widgets.Feature.FeatureExpression.FeatureExpressionViewModel")],Dd);const Dne=Dd,gP={iconLoading:"esri-icon-loading-indicator esri-rotating",base:"esri-feature-expression",loadingSpinnerContainer:"esri-feature__loading-container",spinner:"esri-feature__loading-spinner"};let UL=class extends Bs{constructor(e,t){super(e,t),this.viewModel=new Dne}initialize(){this.own(re(()=>{var e;return(e=this.viewModel)==null?void 0:e.contentElementViewModel},()=>this._setupExpressionWidget(),Ot))}destroy(){this._destroyContentWidget()}renderLoading(){return z("div",{key:"loading-container",class:gP.loadingSpinnerContainer},z("span",{class:this.classes(gP.iconLoading,gP.spinner)}))}render(){var t;const{state:e}=this.viewModel;return z("div",{class:gP.base},e==="loading"?this.renderLoading():e==="disabled"?null:(t=this._contentWidget)==null?void 0:t.render())}_destroyContentWidget(){const{_contentWidget:e}=this;e&&(e.viewModel=null,e.destroy()),this._contentWidget=null}_setupExpressionWidget(){const{contentElementViewModel:e,contentElement:t}=this.viewModel,r=t==null?void 0:t.type;this._destroyContentWidget();const i=e?r==="fields"?new e5e({viewModel:e}):r==="media"?new J5e({viewModel:e}):r==="text"?new vL({viewModel:e}):null:null;this._contentWidget=i,this.scheduleRender()}};d([f({type:Dne})],UL.prototype,"viewModel",void 0),UL=d([$("esri.widgets.Feature.FeatureExpression")],UL);const _nt=UL;class wnt{constructor(t,r){this.preLayerQueryCallback=t,this.preRequestCallback=r,this.preLayerQueryCallback||(this.preLayerQueryCallback=i=>{}),this.preRequestCallback||(this.preLayerQueryCallback=i=>{})}}var BL;const xnt=1,hfe="content-view-models",T8e="esri.widgets.FeatureViewModel",Tnt=fe.getLogger(T8e),ffe={attachmentsContent:!0,chartAnimation:!0,customContent:!0,expressionContent:!0,fieldsContent:!0,mediaContent:!0,textContent:!0};let Mn=BL=class extends xe{constructor(e){super(e),this._handles=new Ft,this._error=null,this._featureAbortController=null,this.graphicChangedThrottled=vie(this._graphicChanged,xnt,this),this._expressionAttributes=null,this._graphicExpressionAttributes=null,this.abilities={...ffe},this.content=null,this.contentViewModels=[],this.defaultPopupTemplateEnabled=!1,this.formattedAttributes=null,this.lastEditInfo=null,this.relatedInfos=new Map,this.title="",this.view=null,this._isAllowedContentType=t=>{const{abilities:r}=this;return t.type==="attachments"&&r.attachmentsContent||t.type==="custom"&&r.customContent||t.type==="fields"&&r.fieldsContent||t.type==="media"&&r.mediaContent||t.type==="text"&&r.textContent||t.type==="expression"&&r.expressionContent},this._handles.add(re(()=>[this.graphic,this._effectivePopupTemplate,this.abilities],()=>this.graphicChangedThrottled(),Ot))}destroy(){this._clear(),this._cancelFeatureQuery(),this._error=null,this._handles.destroy(),this._handles=null,this.graphic=null,this._destroyContentViewModels(),this.relatedInfos.clear()}get _effectivePopupTemplate(){return _(this.graphic)?this.graphic.getEffectivePopupTemplate(this.defaultPopupTemplateEnabled):null}get _fieldInfoMap(){return pYe(lue(this._effectivePopupTemplate),this._sourceLayer)}get _sourceLayer(){return z4e(this.graphic)}castAbilities(e){return{...ffe,...e}}get state(){return this.graphic?this._error?"error":this.waitingForContent?"loading":"ready":"disabled"}set graphic(e){this._set("graphic",e?e.clone():null)}get spatialReference(){return this.get("view.spatialReference")||null}set spatialReference(e){e!==void 0?this._override("spatialReference",e):this._clearOverride("spatialReference")}get map(){return this.get("view.map")||null}set map(e){e!==void 0?this._override("map",e):this._clearOverride("map")}get waitingForContent(){return!!this._featureAbortController}setActiveMedia(e,t){const r=this.contentViewModels[e];r instanceof j3&&r.setActiveMedia(t)}nextMedia(e){const t=this.contentViewModels[e];t instanceof j3&&t.next()}previousMedia(e){const t=this.contentViewModels[e];t instanceof j3&&t.previous()}_clear(){this._set("title",""),this._set("content",null),this._set("formattedAttributes",null)}async _graphicChanged(){this._cancelFeatureQuery(),this._error=null,this._clear();const{graphic:e}=this;if(!e)return;const t=new AbortController;this._featureAbortController=t;try{await this._queryFeature({signal:t.signal})}catch(r){Ui(r)||(this._error=r,Tnt.error("error","The popupTemplate could not be displayed for this feature.",{error:r,graphic:e,popupTemplate:this._effectivePopupTemplate}))}this._featureAbortController===t&&(this._featureAbortController=null)}_cancelFeatureQuery(){const{_featureAbortController:e}=this;e&&e.abort(),this._featureAbortController=null}_compileContentElement(e,t){return e.type==="attachments"?this._compileAttachments(e,t):e.type==="custom"?this._compileCustom(e,t):e.type==="fields"?this._compileFields(e,t):e.type==="media"?this._compileMedia(e,t):e.type==="text"?this._compileText(e,t):e.type==="expression"?this._compileExpression(e,t):void 0}_compileContent(e){if(this._destroyContentViewModels(),this.graphic)return Array.isArray(e)?e.filter(this._isAllowedContentType).map((t,r)=>this._compileContentElement(t,r)):typeof e=="string"?this._compileText(new q5({text:e}),0).text:e}_destroyContentViewModels(){var e;(e=this._handles)==null||e.remove(hfe),this.contentViewModels.forEach(t=>t&&!t.destroyed&&t.destroy()),this._set("contentViewModels",[])}_setExpressionContentVM(e,t){const{formattedAttributes:r}=this,{contentElement:i,contentElementViewModel:n}=e,s=i==null?void 0:i.type;n&&s&&(s==="fields"&&(this._createFieldsFormattedAttributes({contentElement:i,contentElementIndex:t,formattedAttributes:r}),n.set(this._createFieldsVMParams(i,t))),s==="media"&&(this._createMediaFormattedAttributes({contentElement:i,contentElementIndex:t,formattedAttributes:r}),n.set(this._createMediaVMParams(i,t))),s==="text"&&n.set(this._createTextVMParams(i)))}_compileExpression(e,t){const{expressionInfo:r}=e,{graphic:i,map:n,spatialReference:s,view:a}=this,o=new Dne({expressionInfo:r,graphic:i,interceptor:BL.interceptor,map:n,spatialReference:s,view:a});return this.contentViewModels[t]=o,this._handles.add(re(()=>o.contentElementViewModel,()=>this._setExpressionContentVM(o,t),Ot),hfe),e}_compileAttachments(e,t){const{graphic:r}=this,{description:i,title:n}=e;return this.contentViewModels[t]=new Oie({graphic:r,...this._compileTitleAndDesc({title:n,description:i})}),e}_compileCustom(e,t){const{graphic:r}=this,{creator:i,destroyer:n}=e;return this.contentViewModels[t]=new hN({graphic:r,creator:i,destroyer:n}),e}_compileTitleAndDesc({title:e,description:t}){const{_fieldInfoMap:r,_sourceLayer:i,graphic:n,formattedAttributes:s,_expressionAttributes:a}=this,{attributes:o}=n,l=s.global;return{title:B3({attributes:o,fieldInfoMap:r,globalAttributes:l,expressionAttributes:a,layer:i,text:e}),description:B3({attributes:o,fieldInfoMap:r,globalAttributes:l,expressionAttributes:a,layer:i,text:t})}}_createFieldsVMParams(e,t){var c;const{_effectivePopupTemplate:r,formattedAttributes:i}=this,n={...i.global,...i.content[t]},s=(c=(e==null?void 0:e.fieldInfos)||(r==null?void 0:r.fieldInfos))==null?void 0:c.filter(({fieldName:u})=>B4e(u)||Jg(u)||n.hasOwnProperty(u)),a=r==null?void 0:r.expressionInfos,{description:o,title:l}=e;return{attributes:n,expressionInfos:a,fieldInfos:s,...this._compileTitleAndDesc({title:l,description:o})}}_compileFields(e,t){const r=e.clone(),i=new ez(this._createFieldsVMParams(e,t));return this.contentViewModels[t]=i,r.fieldInfos=i.formattedFieldInfos.slice(0),r}_createMediaVMParams(e,t){const{abilities:r,graphic:i,_fieldInfoMap:n,formattedAttributes:s,_effectivePopupTemplate:a,relatedInfos:o,_sourceLayer:l,_expressionAttributes:c}=this,{attributes:u}=i,{description:h,mediaInfos:p,title:m}=e;return{abilities:{chartAnimation:r.chartAnimation},activeMediaInfoIndex:e.activeMediaInfoIndex||0,attributes:u,layer:l,fieldInfoMap:n,formattedAttributes:{...s.global,...s.content[t]},expressionAttributes:c,mediaInfos:p,popupTemplate:a,relatedInfos:o,...this._compileTitleAndDesc({title:m,description:h})}}_compileMedia(e,t){const r=e.clone(),i=new j3(this._createMediaVMParams(e,t));return r.mediaInfos=i.formattedMediaInfos.slice(0),this.contentViewModels[t]=i,r}_createTextVMParams(e){const{graphic:t,_fieldInfoMap:r,_sourceLayer:i,_expressionAttributes:n}=this;if(e&&e.text){const{attributes:s}=t,a=this.formattedAttributes.global;e.text=B3({attributes:s,fieldInfoMap:r,globalAttributes:a,expressionAttributes:n,layer:i,text:e.text})}return{graphic:t,creator:e.text}}_compileText(e,t){const r=e.clone();return this.contentViewModels[t]=new hN(this._createTextVMParams(r)),r}_compileLastEditInfo(){const{_effectivePopupTemplate:e,_sourceLayer:t,graphic:r}=this;if(!e)return;const{lastEditInfoEnabled:i}=e,n=t==null?void 0:t.editFieldsInfo;return i&&n?fYe(n,r.attributes):void 0}_compileTitle(e){const{_fieldInfoMap:t,_sourceLayer:r,graphic:i,_expressionAttributes:n}=this,{attributes:s}=i,a=this.formattedAttributes.global;return B3({attributes:s,fieldInfoMap:t,globalAttributes:a,expressionAttributes:n,layer:r,text:e})}async _getTitle(){const{_effectivePopupTemplate:e,graphic:t}=this,r=e==null?void 0:e.title;return dN(r,{graphic:t})}async _getContent(){const{_effectivePopupTemplate:e,graphic:t}=this,r=e==null?void 0:e.content;return dN(r,{graphic:t})}async _queryFeature(e){const{_featureAbortController:t,_sourceLayer:r,graphic:i,_effectivePopupTemplate:n,spatialReference:s,map:a,view:o}=this,{content:{value:l},title:{value:c}}=await dn({content:this._getContent(),title:this._getTitle()});if(t!==this._featureAbortController||!i)return;await yYe({graphic:i,popupTemplate:n,layer:r,spatialReference:s},e);const{expressionAttributes:{value:u}}=await dn({checkForRelatedFeatures:this._checkForRelatedFeatures(e),expressionAttributes:bnt({expressionInfos:n==null?void 0:n.expressionInfos,spatialReference:s,graphic:i,map:a,interceptor:BL.interceptor,view:o})});t===this._featureAbortController&&i&&(this._expressionAttributes=u,this._graphicExpressionAttributes={...i.attributes,...u},this._set("formattedAttributes",this._createFormattedAttributes(l)),this._set("title",this._compileTitle(c)),this._set("lastEditInfo",this._compileLastEditInfo()||null),this._set("content",this._compileContent(l)||null))}_createMediaFormattedAttributes({contentElement:e,contentElementIndex:t,formattedAttributes:r}){const{_effectivePopupTemplate:i,graphic:n,relatedInfos:s,_sourceLayer:a,_fieldInfoMap:o,_graphicExpressionAttributes:l}=this;r.content[t]=CG({fieldInfos:i==null?void 0:i.fieldInfos,graphic:n,attributes:{...l,...e.attributes},layer:a,fieldInfoMap:o,relatedInfos:s})}_createFieldsFormattedAttributes({contentElement:e,contentElementIndex:t,formattedAttributes:r}){if(e.fieldInfos){const{graphic:i,relatedInfos:n,_sourceLayer:s,_fieldInfoMap:a,_graphicExpressionAttributes:o}=this;r.content[t]=CG({fieldInfos:e.fieldInfos,graphic:i,attributes:{...o,...e.attributes},layer:s,fieldInfoMap:a,relatedInfos:n})}}_createFormattedAttributes(e){const{_effectivePopupTemplate:t,graphic:r,relatedInfos:i,_sourceLayer:n,_fieldInfoMap:s,_graphicExpressionAttributes:a}=this,o=t==null?void 0:t.fieldInfos,l={global:CG({fieldInfos:o,graphic:r,attributes:a,layer:n,fieldInfoMap:s,relatedInfos:i}),content:[]};return Array.isArray(e)&&e.forEach((c,u)=>{c.type==="fields"&&this._createFieldsFormattedAttributes({contentElement:c,contentElementIndex:u,formattedAttributes:l}),c.type==="media"&&this._createMediaFormattedAttributes({contentElement:c,contentElementIndex:u,formattedAttributes:l})}),l}_checkForRelatedFeatures(e){const{graphic:t,_effectivePopupTemplate:r}=this;return this._queryRelatedInfos(t,lue(r),e)}async _queryRelatedInfos(e,t,r){const{relatedInfos:i,_sourceLayer:n}=this;i.clear();const s=_(n.associatedLayer)?await n.associatedLayer.load(r):n;if(!s)return;const a=t.filter(c=>c&&Jg(c.fieldName));if(!a||!a.length)return;t.forEach(c=>this._configureRelatedInfo(c,s));const o=await IJe({relatedInfos:i,layer:s},r);Object.keys(o).forEach(c=>{var p;const u=i.get(c.toString()),h=(p=o[c])==null?void 0:p.value;u&&h&&(u.layerInfo=h.data)});const l=await $Je({graphic:e,relatedInfos:i,layer:s},r);Object.keys(l).forEach(c=>{var u;AJe((u=l[c])==null?void 0:u.value,i.get(c.toString()))})}_configureRelatedInfo(e,t){const{relatedInfos:r}=this,i=JZ(e.fieldName);if(!i)return;const{layerId:n,fieldName:s}=i;if(!n)return;const a=r.get(n.toString())||CJe(n,t);a&&(LJe({relatedInfo:a,fieldName:s,fieldInfo:e}),this.relatedInfos.set(n,a))}};Mn.interceptor=new wnt(_Ye,wYe),d([f()],Mn.prototype,"_error",void 0),d([f()],Mn.prototype,"_featureAbortController",void 0),d([f({readOnly:!0})],Mn.prototype,"_effectivePopupTemplate",null),d([f({readOnly:!0})],Mn.prototype,"_fieldInfoMap",null),d([f({readOnly:!0})],Mn.prototype,"_sourceLayer",null),d([f()],Mn.prototype,"abilities",void 0),d([Xt("abilities")],Mn.prototype,"castAbilities",null),d([f({readOnly:!0})],Mn.prototype,"content",void 0),d([f({readOnly:!0})],Mn.prototype,"contentViewModels",void 0),d([f({type:Boolean})],Mn.prototype,"defaultPopupTemplateEnabled",void 0),d([f({readOnly:!0})],Mn.prototype,"state",null),d([f({readOnly:!0})],Mn.prototype,"formattedAttributes",void 0),d([f({type:co,value:null})],Mn.prototype,"graphic",null),d([f({readOnly:!0})],Mn.prototype,"lastEditInfo",void 0),d([f({readOnly:!0})],Mn.prototype,"relatedInfos",void 0),d([f()],Mn.prototype,"spatialReference",null),d([f({readOnly:!0})],Mn.prototype,"title",void 0),d([f()],Mn.prototype,"map",null),d([f({readOnly:!0})],Mn.prototype,"waitingForContent",null),d([f()],Mn.prototype,"view",void 0),Mn=BL=d([$(T8e)],Mn);const Fne=Mn,S8e=e=>{let t=class extends e{constructor(){super(...arguments),this.renderNodeContent=r=>fN(r)&&!r.destroyed?z("div",{key:r},r.render()):r instanceof HTMLElement?z("div",{key:r,bind:r,afterCreate:this._attachToNode}):K4e(r)?z("div",{key:r,bind:r.domNode,afterCreate:this._attachToNode}):null}_attachToNode(r){const i=this;r.appendChild(i)}};return t=d([$("esri.widgets.Feature.ContentMixin")],t),t},mo={iconText:"esri-icon-font-fallback-text",iconLoading:"esri-icon-loading-indicator esri-rotating",esriTable:"esri-widget__table",esriWidget:"esri-widget",base:"esri-feature",container:"esri-feature__size-container",title:"esri-feature__title",main:"esri-feature__main-container",btn:"esri-feature__button",icon:"esri-feature__icon",content:"esri-feature__content",contentElement:"esri-feature__content-element",text:"esri-feature__text",lastEditedInfo:"esri-feature__last-edited-info",fields:"esri-feature__fields",fieldHeader:"esri-feature__field-header",fieldData:"esri-feature__field-data",fieldDataDate:"esri-feature__field-data--date",loadingSpinnerContainer:"esri-feature__loading-container",spinner:"esri-feature__loading-spinner"},pfe={title:!0,content:!0,lastEditedInfo:!0};let wo=class extends S8e(Bs){constructor(e,t){super(e,t),this._contentWidgets=[],this.graphic=null,this.defaultPopupTemplateEnabled=!1,this.headingLevel=2,this.label=void 0,this.messages=null,this.messagesCommon=null,this.messagesURIUtils=null,this.spatialReference=null,this.title=null,this.visibleElements={...pfe},this.map=null,this.view=null,this.viewModel=new Fne}initialize(){this.own(re(()=>{var e;return(e=this.viewModel)==null?void 0:e.contentViewModels},()=>this._setupContentWidgets(),Ot))}loadDependencies(){return ie(()=>import("./calcite-notice.b91a2793.js"),[],import.meta.url)}destroy(){this._destroyContentWidgets()}castVisibleElements(e){return{...pfe,...e}}render(){const{state:e}=this.viewModel,t=z("div",{class:mo.container,key:"container"},this.renderTitle(),e==="error"?this.renderError():e==="loading"?this.renderLoading():this.renderContentContainer());return z("div",{class:this.classes(mo.base,mo.esriWidget)},t)}setActiveMedia(e,t){this.viewModel.setActiveMedia(e,t)}nextMedia(e){this.viewModel.nextMedia(e)}previousMedia(e){this.viewModel.previousMedia(e)}renderError(){const{messagesCommon:e,messages:t,visibleElements:r}=this;return z("calcite-notice",{active:!0,color:"red",icon:"exclamation-mark-circle",scale:"s"},r.title?z("div",{key:"error-title",slot:"title"},e.errorMessage):null,z("div",{key:"error-message",slot:"message"},t.loadingError))}renderLoading(){return z("div",{key:"loading-container",class:mo.loadingSpinnerContainer},z("span",{class:this.classes(mo.iconLoading,mo.spinner)}))}renderContentContainer(){const{visibleElements:e}=this;return e.content?z("div",{class:mo.main},[this.renderContent(),this.renderLastEditInfo()]):null}renderTitle(){const{visibleElements:e,title:t}=this;return e.title?z(Pv,{level:this.headingLevel,class:mo.title,innerHTML:t}):null}renderContent(){const e=this.viewModel.content,t="content";if(!e)return null;if(Array.isArray(e))return e.length?z("div",{key:`${t}-content-elements`},e.map(this.renderContentElement,this)):null;if(typeof e=="string"){const r=this._contentWidgets[0];return!r||r.destroyed?null:z("div",{key:`${t}-content`},r.render())}return this.renderNodeContent(e)}renderContentElement(e,t){const{visibleElements:r}=this;if(typeof r.content!="boolean"&&!r.content[e.type])return null;switch(e.type){case"attachments":return this.renderAttachments(t);case"custom":return this.renderCustom(e,t);case"fields":return this.renderFields(t);case"media":return this.renderMedia(t);case"text":return this.renderText(e,t);case"expression":return this.renderExpression(t);default:return null}}renderAttachments(e){const t=this._contentWidgets[e];if(!t||t.destroyed)return null;const{state:r,attachmentInfos:i}=t.viewModel;return r==="loading"||i.length>0?z("div",{key:this._buildKey("attachments-element",e),class:this.classes(mo.contentElement)},t.render()):null}renderExpression(e){const t=this._contentWidgets[e];return!t||t.destroyed?null:z("div",{key:this._buildKey("expression-element",e),class:mo.contentElement},t.render())}renderCustom(e,t){const{creator:r}=e,i=this._contentWidgets[t];return!i||i.destroyed?null:r?z("div",{key:this._buildKey("custom-element",t),class:mo.contentElement},i.render()):null}renderFields(e){const t=this._contentWidgets[e];return!t||t.destroyed?null:z("div",{key:this._buildKey("fields-element",e),class:mo.contentElement},t.render())}renderMedia(e){const t=this._contentWidgets[e];return!t||t.destroyed?null:z("div",{key:this._buildKey("media-element",e),class:mo.contentElement},t.render())}renderLastEditInfo(){const{visibleElements:e,messages:t}=this,{lastEditInfo:r}=this.viewModel;if(!r||!e.lastEditedInfo)return null;const{date:i,user:n}=r,s=r.type==="edit"?n?t.lastEditedByUser:t.lastEdited:n?t.lastCreatedByUser:t.lastCreated,a=fh(s,{date:i,user:n});return z("div",{key:"edit-info-element",class:this.classes(mo.lastEditedInfo,mo.contentElement)},a)}renderText(e,t){const r=e.text,i=this._contentWidgets[t];return!i||i.destroyed?null:r?z("div",{key:this._buildKey("text-element",t),class:this.classes(mo.contentElement,mo.text)},i.render()):null}_buildKey(e,...t){return`${e}__${this.get("viewModel.graphic.uid")||"0"}-${t.join("-")}`}_destroyContentWidget(e){e&&(e.viewModel=null,!e.destroyed&&e.destroy())}_destroyContentWidgets(){this._contentWidgets.forEach(e=>this._destroyContentWidget(e)),this._contentWidgets=[]}_setupContentWidgets(){this._destroyContentWidgets();const{headingLevel:e,visibleElements:t}=this,r=this.get("viewModel.content"),{contentViewModels:i}=this.viewModel;if(Array.isArray(r))r.forEach((n,s)=>{n.type==="attachments"&&(this._contentWidgets[s]=new PYe({displayType:n.displayType,headingLevel:t.title?e+1:e,viewModel:i[s]})),n.type==="fields"&&(this._contentWidgets[s]=new e5e({viewModel:i[s]})),n.type==="media"&&(this._contentWidgets[s]=new J5e({viewModel:i[s]})),n.type==="text"&&(this._contentWidgets[s]=new vL({viewModel:i[s]})),n.type==="custom"&&(this._contentWidgets[s]=new vL({viewModel:i[s]})),n.type==="expression"&&(this._contentWidgets[s]=new _nt({viewModel:i[s]}))},this);else{const n=i[0];n&&!n.destroyed&&(this._contentWidgets[0]=new vL({viewModel:n}))}this.scheduleRender()}};d([We("viewModel.graphic")],wo.prototype,"graphic",void 0),d([We("viewModel.defaultPopupTemplateEnabled")],wo.prototype,"defaultPopupTemplateEnabled",void 0),d([f()],wo.prototype,"headingLevel",void 0),d([f({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],wo.prototype,"label",void 0),d([f(),es("esri/widgets/Feature/t9n/Feature")],wo.prototype,"messages",void 0),d([f(),es("esri/t9n/common")],wo.prototype,"messagesCommon",void 0),d([f(),es("esri/widgets/support/t9n/uriUtils")],wo.prototype,"messagesURIUtils",void 0),d([We("viewModel.spatialReference")],wo.prototype,"spatialReference",void 0),d([We("viewModel.title")],wo.prototype,"title",void 0),d([f()],wo.prototype,"visibleElements",void 0),d([Xt("visibleElements")],wo.prototype,"castVisibleElements",null),d([We("viewModel.map")],wo.prototype,"map",void 0),d([We("viewModel.view")],wo.prototype,"view",void 0),d([f({type:Fne})],wo.prototype,"viewModel",void 0),wo=d([$("esri.widgets.Feature")],wo);const Snt=wo;var E8e;const GL=Symbol("anchorHandles");let B2=class extends mn.EventedAccessor{constructor(e){super(e),this[E8e]=new Ft,this.location=null,this.screenLocationEnabled=!1,this.view=null,this[GL].add([Fa(()=>ys(this.screenLocationEnabled?this.view:null,t=>[t.size,t.type==="3d"?t.camera:t.viewpoint]),()=>this.notifyChange("screenLocation")),re(()=>this.screenLocation,(t,r)=>{_(t)&&_(r)&&this.emit("view-change")})])}destroy(){this.view=null,this[GL]=ct(this[GL])}get screenLocation(){const{location:e,view:t,screenLocationEnabled:r}=this;return r&&_(e)&&_(t)&&t.ready?t.toScreen(e):null}};E8e=GL,d([f()],B2.prototype,"location",void 0),d([f()],B2.prototype,"screenLocation",null),d([f()],B2.prototype,"screenLocationEnabled",void 0),d([f()],B2.prototype,"view",void 0),B2=d([$("esri.widgets.support.AnchorElementViewModel")],B2);const C8e=B2,Ent="esri.widgets.CompassViewModel";let jL=class extends C8e{constructor(e){super(e),this.visible=!1}};d([f()],jL.prototype,"visible",void 0),jL=d([$(Ent)],jL);const A8e=jL,hj={base:"esri-spinner",spinnerStart:"esri-spinner--start",spinnerFinish:"esri-spinner--finish"};let G2=class extends Bs{constructor(e,t){super(e,t),this._animationDelay=500,this._animationPromise=null,this.location=null,this.view=null,this.viewModel=new A8e,this.visible=!1}initialize(){this.own([re(()=>this.visible,e=>this._visibleChange(e))])}destroy(){this._animationPromise=null}show(e){const{location:t,promise:r}=e;t&&(this.viewModel.location=t),this.visible=!0;const i=()=>this.hide();r&&r.catch(()=>{}).then(i)}hide(){this.visible=!1}render(){const{visible:e}=this,{screenLocation:t}=this.viewModel,r=!!t,i=e&&r,n=!e&&r,s={[hj.spinnerStart]:i,[hj.spinnerFinish]:n},a=this._getPositionStyles();return z("div",{class:this.classes(hj.base,s),styles:a})}_visibleChange(e){if(e)return void(this.viewModel.screenLocationEnabled=!0);const t=O5(this._animationDelay);this._animationPromise=t,t.catch(()=>{}).then(()=>{this._animationPromise===t&&(this.viewModel.screenLocationEnabled=!1,this._animationPromise=null)})}_getPositionStyles(){const{screenLocation:e,view:t}=this.viewModel;if(R(t)||R(e))return{};const{padding:r}=t;return{left:e.x-r.left+"px",top:e.y-r.top+"px"}}};d([We("viewModel.location")],G2.prototype,"location",void 0),d([We("viewModel.view")],G2.prototype,"view",void 0),d([f({type:A8e})],G2.prototype,"viewModel",void 0),d([We("viewModel.visible")],G2.prototype,"visible",void 0),G2=d([$("esri.widgets.Spinner")],G2);const Cnt=G2;var la;(function(e){e[e.size=22]="size",e[e.lineWidth=50]="lineWidth",e[e.maxSize=120]="maxSize",e[e.maxOutlineSize=80]="maxOutlineSize",e[e.tallSymbolWidth=20]="tallSymbolWidth"})(la||(la={}));const hJ={fill:[{type:"path",path:"M -10,-10 L 10,0 L 10,10 L -10,10 L -10,-10 Z"}],squareFill:[{type:"path",path:"M -10,-10 L 10,-10 L 10,10 L -10,10 L -10,-10 Z"}],pathSymbol3DLayer:[{type:"path",path:"M 3,12 L 12,0 L 11,-2 L -4,5 L -1,5 L 1,7 L 3,10 L 3,12 Z"},{type:"circle",cx:-2,cy:10,r:5}],extrudeSymbol3DLayer:[{type:"path",path:"M -7,-5 L -2,0 L -2,7 L -7,3 L -7,-5 Z"},{type:"path",path:"M -2,0 L -2,7 L 10,-3 L 10,-10 L -2,0 Z"},{type:"path",path:"M -7,-5 L -2,0 L 10,-10 L -2,-10 L -7,-5 Z"}],cone:[{type:"path",path:"M 0,-10 L -8,5 L -4,6.5 L 0,7 L 4,6.5 L 8,5 Z"}],tallCone:[{type:"path",path:"M 0,-9 L -3.5,7 L -1.5,7.8 L 0,8 L 1.5,7.8 L 3.5,7 L 0,-9 Z"}],invertedCone:[{type:"path",path:"M 0,7 L -8,-8 L 8,-8 Z"},{type:"path",path:"M -8,-8 L -4,-9.5 L 0,-10 L 4,-9.5 L 8,-8 L 4,-6.5 L 0,-6 L -4,-6.5 Z"}],cube:[{type:"path",path:"M -10,-7 L 0,-12 L 10,-7 L 0,-2 L -10,-7 Z"},{type:"path",path:"M -10,-7 L 0,-2 L 0,12 L -10,7 L -10,-7 Z"},{type:"path",path:"M 0,-2 L 10,-7 L 10,7 L 0,12 L 0,-2 Z"}],tallCube:[{type:"path",path:"M -3.5,-8.5 L 0,-9.5 L 3.5,-8.5 L 0,-7.5 L -3.5,-8.5 Z"},{type:"path",path:"M -3.5,-8.5 L 0,-7.5 L 0,9 L -3.5,8 L -3.5,-8.5 Z"},{type:"path",path:"M 0,-7.5 L 3.5,-8.5 L 3.5,8 L 0,9 L 0,-7.5 Z"}],cylinder:[{type:"path",path:"M -8,-9 L -8,7 L -4,8.5 L 0,9 L 4,8.5 L 8,7 L 8,-9 Z"},{type:"ellipse",cx:0,cy:-9,rx:8,ry:2}],tallCylinder:[{type:"path",path:"M -3.5,-9 L -3.5,7 L -1.5,7.8 L 0,8 L 1.5,7.8 L 3.5,7 L 3.5,-9 Z"},{type:"ellipse",cx:0,cy:-9,rx:3.5,ry:1}],diamond:[{type:"path",path:"M 0,-10 L 10,-1 L -1,1 L 0,-10 Z"},{type:"path",path:"M 0,-10 L -1,1 L -8,-1 L 0,-10 Z"},{type:"path",path:"M -1,1 L 0,10 L -8,-1 L -1,1 Z"},{type:"path",path:"M -1,0 L 0,10 L 10,-1 L -1,1 Z"}],tetrahedron:[{type:"path",path:"M 0,-10 L 10,7 L 0,0 L 0,-10 Z"},{type:"path",path:"M 0,-10 L 0,0 L -8,7 L 0,-10 Z"},{type:"path",path:"M 10,7 L 0,0 L -8,7 L 10,7 Z"}]};function Ant(e,t,r){const i=la.size;let n=i,s=i;e<1?n*=.75:e>1&&(s*=1.25);const a=0,o=0;let l=i,c=i;return t&&r&&(n=s=l=c=0),[{type:"path",path:[{command:"M",values:[l,a]},{command:"L",values:[r?l:.875*l,a]},{command:"L",values:[r?n-.5*l:o,s-.5*c]},{command:"L",values:[n-.5*l,s-.5*c]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[l,a]},{command:"L",values:[l,t?a:.125*c]},{command:"L",values:[n-.5*l,t?s-.5*c:c]},{command:"L",values:[n-.5*l,s-.5*c]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[n-.5*l,s-.5*c]},{command:"L",values:[r?n-.5*l:o,s-.5*c]},{command:"L",values:[r?n-.5*l:o,t?s-.5*c:c]},{command:"L",values:[n-.5*l,t?s-.5*c:c]},{command:"Z",values:[]}]}]}function Rnt(e){const t=la.size,r=.5*e,i=0,n=0;return[{type:"path",path:[{command:"M",values:[n,.7*t*.5]},{command:"L",values:[.3*t,.7*t]},{command:"L",values:[.3*t,.7*t+r]},{command:"L",values:[n,.7*t+r-.7*t*.5]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[.3*t,.7*t]},{command:"L",values:[.3*t,.7*t+r]},{command:"L",values:[t,r]},{command:"L",values:[t,i]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[.3*t,i]},{command:"L",values:[t,i]},{command:"L",values:[.3*t,.7*t]},{command:"L",values:[n,.7*t*.5]},{command:"Z",values:[]}]}]}function Ont(){return[{type:"path",path:"M80,80.2v-27c-1.5,0.7-2.8,1.6-3.9,2.8c-1.8,2.1-4.4,3.3-7.1,3.5c-2.7-0.1-5.3-1.4-7.1-3.4c-2.2-2.3-4.7-3.6-7.4-3.6s-5.1,1.3-7.3,3.6c-1.8,2.1-4.4,3.3-7.2,3.4c-2.7-0.1-5.3-1.4-7.1-3.4c-2.2-2.3-4.7-3.6-7.4-3.6s-5.1,1.3-7.4,3.6c-1.8,2.1-4.4,3.3-7.2,3.4C8.3,59.3,5.7,58,3.9,56c-1.1-1.2-2.4-2.1-3.9-2.8v27"},{type:"path",path:"M11,59.4c2.7-0.1,5.3-1.4,7.1-3.4c2.2-2.3,4.7-3.6,7.4-3.6s5.1,1.3,7.4,3.6c1.8,2,4.4,3.3,7.2,3.4c2.7-0.1,5.3-1.4,7.1-3.4c2.2-2.3,4.7-3.6,7.3-3.6s5.1,1.3,7.4,3.6c1.8,2.1,4.4,3.3,7.2,3.4c2.7-0.1,5.3-1.4,7.1-3.4c1.1-1.2,2.4-2.1,3.9-2.8v-24c-1.5,0.7-2.8,1.6-3.9,2.8c-1.8,2.1-4.4,3.3-7.1,3.5c-2.7-0.1-5.3-1.4-7.1-3.4c-2.2-2.3-4.7-3.6-7.4-3.6s-5.1,1.3-7.3,3.6c-1.8,2.1-4.4,3.3-7.2,3.4c-2.7-0.1-5.3-1.4-7.1-3.4c-2.2-2.3-4.7-3.6-7.4-3.6s-5.1,1.3-7.4,3.6c-1.8,2.1-4.4,3.3-7.2,3.4c-2.7-0.1-5.3-1.4-7.1-3.4c-1.1-1.2-2.4-2.1-3.9-2.8v24c1.5,0.7,2.8,1.6,3.9,2.8C5.7,58,8.3,59.3,11,59.4z"},{type:"path",path:"M11,35.4c2.7-0.1,5.3-1.4,7.1-3.4c2.2-2.3,4.7-3.6,7.4-3.6s5.1,1.3,7.4,3.6c1.8,2,4.4,3.3,7.2,3.4c2.7-0.1,5.3-1.4,7.1-3.4c2.2-2.3,4.7-3.6,7.3-3.6s5.1,1.3,7.4,3.6c1.8,2.1,4.4,3.3,7.2,3.4c2.7-0.1,5.3-1.4,7.1-3.4c1.1-1.2,2.4-2.1,3.9-2.8V3.6c-1.5,0.7-2.8,1.6-3.9,2.8c-2.2,2.1-4.6,3.4-7.1,3.4s-5-1.3-7.1-3.4s-4.7-3.6-7.4-3.6s-5.1,1.3-7.3,3.6S42.5,9.9,40,9.9s-5-1.3-7.1-3.4s-4.7-3.6-7.4-3.6s-5.1,1.3-7.3,3.6c-1.8,2.1-4.4,3.3-7.2,3.4c-2.5,0-5-1.3-7.1-3.4C2.8,5.3,1.4,4.3,0,3.6v25.6c1.5,0.7,2.8,1.6,3.9,2.8C5.7,34.1,8.3,35.3,11,35.4z"}]}function Mnt(e,t){let r=t?la.tallSymbolWidth:e;const i=e,n=t?4:6;r<=la.size?r-=.5*n:r-=n;const s=0,a=0,o=t?.35*r:.5*r;return[{type:"path",path:[{command:"M",values:[.5*r,s]},{command:"L",values:[r,.5*o]},{command:"L",values:[.5*r,o]},{command:"L",values:[a,.5*o]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[s,.5*o]},{command:"L",values:[.5*r,o]},{command:"L",values:[.5*r,i]},{command:"L",values:[a,i-.5*o]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[.5*r,o]},{command:"L",values:[.5*r,i]},{command:"L",values:[r,i-.5*o]},{command:"L",values:[r,.5*o]},{command:"Z",values:[]}]}]}function Pnt(e,t){let r=t?la.tallSymbolWidth:e;const i=e,n=t?4:6;r<=la.size?r-=.5*n:r-=n;const s=.5*r,a=.15*r,o=0,l=i-a;return[{type:"ellipse",cx:.5*r,cy:l,rx:s,ry:a},{type:"path",path:[{command:"M",values:[o,a]},{command:"L",values:[o,l]},{command:"L",values:[r,l]},{command:"L",values:[r,a]},{command:"Z",values:[]}]},{type:"ellipse",cx:.5*r,cy:a,rx:s,ry:a}]}function Int(e,t){let r=t?la.tallSymbolWidth:e;const i=e,n=t?4:6;r<=la.size?r-=.5*n:r-=n;const s=.15*r,a=i-s;return[{type:"ellipse",cx:.5*r,cy:a,rx:.5*r,ry:s},{type:"path",path:[{command:"M",values:[.5*r,0]},{command:"L",values:[r,a]},{command:"L",values:[0,a]},{command:"Z",values:[]}]}]}function $nt(e){let t=e;const r=e,i=6;t<la.size?t-=.5*i:t-=i;const n=.15*t,s=0;return[{type:"path",path:[{command:"M",values:[0,s]},{command:"L",values:[t,s]},{command:"L",values:[.5*t,r-n]},{command:"Z",values:[]}]},{type:"ellipse",cx:.5*t,cy:s,rx:.5*t,ry:n}]}function Lnt(e){let t=e;const r=e,i=4;t<la.size?t-=.5*i:t-=i;const n=0,s=0,a=t,o=r,l=Math.floor(e/10)-1||1;return[{type:"path",path:[{command:"M",values:[.45*a,n]},{command:"L",values:[a,.5*o-l]},{command:"L",values:[.45*a-l,.5*o+l]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[.45*a,n]},{command:"L",values:[.45*a-l,.5*o+l]},{command:"L",values:[s,.5*o-l]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[s,.5*o-l]},{command:"L",values:[.45*a-l,.5*o+l]},{command:"L",values:[.45*a,r]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[.45*a,r]},{command:"L",values:[a,.5*o-l]},{command:"L",values:[.45*a-l,.5*o+l]},{command:"Z",values:[]}]}]}function Dnt(e){const t=e,r=2;let i=e;i<la.size?i-=.5*r:i-=r;const n=0,s=0;return[{type:"path",path:[{command:"M",values:[.45*t,n]},{command:"L",values:[t,i]},{command:"L",values:[.45*t,.6*i]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[.45*t,n]},{command:"L",values:[.45*t,.6*i]},{command:"L",values:[s,i]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[s,i]},{command:"L",values:[.45*t,.6*i]},{command:"L",values:[t,i]},{command:"Z",values:[]}]}]}function $v(e,t){return Math.round(Math.min(Math.max(e+255*t*.75,0),255))}function lLt(e,t){if("type"in e&&(e.type==="linear"||e.type==="pattern"))return e;const r=new Te(e);return new Te([$v(r.r,t),$v(r.g,t),$v(r.b,t),r.a])}function Fnt(e){return"r"in e&&"g"in e&&"b"in e}function R8e(e){return"h"in e&&"s"in e&&"v"in e}function O8e(e){return"l"in e&&"a"in e&&"b"in e}function M8e(e){return"l"in e&&"c"in e&&"h"in e}function Nnt(e){return"x"in e&&"y"in e&&"z"in e}const knt=[[.4124,.3576,.1805],[.2126,.7152,.0722],[.0193,.1192,.9505]],Vnt=[[3.2406,-1.5372,-.4986],[-.9689,1.8758,.0415],[.0557,-.204,1.057]];function P8e(e,t){const r=[];let i,n;if(e[0].length!==t.length)throw"dimensions do not match";const s=e.length,a=e[0].length;let o=0;for(i=0;i<s;i++){for(o=0,n=0;n<a;n++)o+=e[i][n]*t[n];r.push(o)}return r}function I8e(e){const t=[e.r/255,e.g/255,e.b/255].map(i=>i<=.04045?i/12.92:((i+.055)/1.055)**2.4),r=P8e(knt,t);return{x:100*r[0],y:100*r[1],z:100*r[2]}}function Nne(e){const t=P8e(Vnt,[e.x/100,e.y/100,e.z/100]).map(r=>{const i=r<=.0031308?12.92*r:1.055*r**.4166666666666667-.055;return Math.min(1,Math.max(i,0))});return{r:Math.round(255*t[0]),g:Math.round(255*t[1]),b:Math.round(255*t[2])}}function $8e(e){const t=[e.x/95.047,e.y/100,e.z/108.883].map(r=>r>.008856451679035631?r**.3333333333333333:7.787037037037035*r+.13793103448275862);return{l:116*t[1]-16,a:500*(t[0]-t[1]),b:200*(t[1]-t[2])}}function L8e(e){const t=e.l,r=[(t+16)/116+e.a/500,(t+16)/116,(t+16)/116-e.b/200].map(i=>i>6/29?i**3:3*(6/29)**2*(i-4/29));return{x:95.047*r[0],y:100*r[1],z:108.883*r[2]}}function znt(e){const t=e.l,r=e.a,i=e.b,n=Math.sqrt(r*r+i*i);let s=Math.atan2(i,r);return s=s>0?s:s+2*Math.PI,{l:t,c:n,h:s}}function Unt(e){const t=e.l,r=e.c,i=e.h;return{l:t,a:r*Math.cos(i),b:r*Math.sin(i)}}function Bnt(e){return $8e(I8e(e))}function Gnt(e){return Nne(L8e(e))}function jnt(e){return znt($8e(I8e(e)))}function qnt(e){return Nne(L8e(Unt(e)))}function Hnt(e){const t=e.r,r=e.g,i=e.b,n=Math.max(t,r,i),s=n-Math.min(t,r,i);let a=n,o=s===0?0:n===t?(r-i)/s%6:n===r?(i-t)/s+2:(t-r)/s+4,l=s===0?0:s/a;return o<0&&(o+=6),o*=60,l*=100,a*=100/255,{h:o,s:l,v:a}}function Wnt(e){const t=(e.h+360)%360/60,r=e.s/100,i=e.v/100*255,n=i*r,s=n*(1-Math.abs(t%2-1));let a;switch(Math.floor(t)){case 0:a={r:n,g:s,b:0};break;case 1:a={r:s,g:n,b:0};break;case 2:a={r:0,g:n,b:s};break;case 3:a={r:0,g:s,b:n};break;case 4:a={r:s,g:0,b:n};break;case 5:case 6:a={r:n,g:0,b:s};break;default:a={r:0,g:0,b:0}}return a.r=Math.round(a.r+i-n),a.g=Math.round(a.g+i-n),a.b=Math.round(a.b+i-n),a}function gO(e){return Fnt(e)?e:M8e(e)?qnt(e):O8e(e)?Gnt(e):Nnt(e)?Nne(e):R8e(e)?Wnt(e):e}function kne(e){return R8e(e)?e:Hnt(gO(e))}function cLt(e){return O8e(e)?e:Bnt(gO(e))}function dLt(e){return M8e(e)?e:jnt(gO(e))}function IN(){const e=new Float32Array(6);return e[0]=1,e[3]=1,e}function Xnt(e){const t=new Float32Array(6);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t}function Ynt(e,t,r,i,n,s){const a=new Float32Array(6);return a[0]=e,a[1]=t,a[2]=r,a[3]=i,a[4]=n,a[5]=s,a}function Znt(e,t){return new Float32Array(e,t,6)}function D8e(e,t,r,i){const n=t[i],s=t[i+1];e[i]=r[0]*n+r[2]*s+r[4],e[i+1]=r[1]*n+r[3]*s+r[5]}function Qnt(e,t,r,i=0,n=0,s=2){const a=n||t.length/s;for(let o=i;o<a;o++)D8e(e,t,r,o*s)}Object.freeze(Object.defineProperty({__proto__:null,create:IN,clone:Xnt,fromValues:Ynt,createView:Znt,transform:D8e,transformMany:Qnt},Symbol.toStringTag,{value:"Module"}));function Jnt(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e}function Tz(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e}function Knt(e,t,r,i,n,s,a){return e[0]=t,e[1]=r,e[2]=i,e[3]=n,e[4]=s,e[5]=a,e}function F8e(e,t){const r=t[0],i=t[1],n=t[2],s=t[3],a=t[4],o=t[5];let l=r*s-i*n;return l?(l=1/l,e[0]=s*l,e[1]=-i*l,e[2]=-n*l,e[3]=r*l,e[4]=(n*o-s*a)*l,e[5]=(i*a-r*o)*l,e):null}function est(e){return e[0]*e[3]-e[1]*e[2]}function x3(e,t,r){const i=t[0],n=t[1],s=t[2],a=t[3],o=t[4],l=t[5],c=r[0],u=r[1],h=r[2],p=r[3],m=r[4],g=r[5];return e[0]=i*c+s*u,e[1]=n*c+a*u,e[2]=i*h+s*p,e[3]=n*h+a*p,e[4]=i*m+s*g+o,e[5]=n*m+a*g+l,e}function Sz(e,t,r){const i=t[0],n=t[1],s=t[2],a=t[3],o=t[4],l=t[5],c=Math.sin(r),u=Math.cos(r);return e[0]=i*u+s*c,e[1]=n*u+a*c,e[2]=i*-c+s*u,e[3]=n*-c+a*u,e[4]=o,e[5]=l,e}function Vne(e,t,r){const i=t[0],n=t[1],s=t[2],a=t[3],o=t[4],l=t[5],c=r[0],u=r[1];return e[0]=i*c,e[1]=n*c,e[2]=s*u,e[3]=a*u,e[4]=o,e[5]=l,e}function Ez(e,t,r){const i=t[0],n=t[1],s=t[2],a=t[3],o=t[4],l=t[5],c=r[0],u=r[1];return e[0]=i,e[1]=n,e[2]=s,e[3]=a,e[4]=i*c+s*u+o,e[5]=n*c+a*u+l,e}function tst(e,t){const r=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=r,e[2]=-r,e[3]=i,e[4]=0,e[5]=0,e}function rst(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=t[1],e[4]=0,e[5]=0,e}function zne(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=t[0],e[5]=t[1],e}function ist(e){return"mat2d("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+")"}function nst(e){return Math.sqrt(e[0]**2+e[1]**2+e[2]**2+e[3]**2+e[4]**2+e[5]**2+1)}function sst(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e[4]=t[4]+r[4],e[5]=t[5]+r[5],e}function N8e(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e[4]=t[4]-r[4],e[5]=t[5]-r[5],e}function ast(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*r,e[5]=t[5]*r,e}function ost(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e[2]=t[2]+r[2]*i,e[3]=t[3]+r[3]*i,e[4]=t[4]+r[4]*i,e[5]=t[5]+r[5]*i,e}function lst(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]}function cst(e,t){const r=e[0],i=e[1],n=e[2],s=e[3],a=e[4],o=e[5],l=t[0],c=t[1],u=t[2],h=t[3],p=t[4],m=t[5];return Math.abs(r-l)<=Rt*Math.max(1,Math.abs(r),Math.abs(l))&&Math.abs(i-c)<=Rt*Math.max(1,Math.abs(i),Math.abs(c))&&Math.abs(n-u)<=Rt*Math.max(1,Math.abs(n),Math.abs(u))&&Math.abs(s-h)<=Rt*Math.max(1,Math.abs(s),Math.abs(h))&&Math.abs(a-p)<=Rt*Math.max(1,Math.abs(a),Math.abs(p))&&Math.abs(o-m)<=Rt*Math.max(1,Math.abs(o),Math.abs(m))}const dst=x3,ust=N8e;Object.freeze(Object.defineProperty({__proto__:null,copy:Jnt,identity:Tz,set:Knt,invert:F8e,determinant:est,multiply:x3,rotate:Sz,scale:Vne,translate:Ez,fromRotation:tst,fromScaling:rst,fromTranslation:zne,str:ist,frob:nst,add:sst,subtract:N8e,multiplyScalar:ast,multiplyScalarAndAdd:ost,exactEquals:lst,equals:cst,mul:dst,sub:ust},Symbol.toStringTag,{value:"Module"}));const hst="http://www.w3.org/2000/svg";let fst=0,pst=0;const mfe=ue("android"),mst=ue("chrome")||mfe&&mfe>=4?"auto":"optimizeLegibility",gst={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7,z:0},yst=/([A-DF-Za-df-z])|([-+]?\d*[.]?\d+(?:[eE][-+]?\d+)?)/g;let Js={},yi={};const gfe={solid:"none",shortdash:[4,1],shortdot:[1,1],shortdashdot:[4,1,1,1],shortdashdotdot:[4,1,1,1,1,1],dot:[1,3],dash:[4,3],longdash:[8,3],dashdot:[4,3,1,3],longdashdot:[8,3,1,3],longdashdotdot:[8,3,1,3,1,3]},bst=Math.PI;let vst=1;function m4(e,t){const r=e*(bst/180);return Math.abs(t*Math.sin(r))+Math.abs(t*Math.cos(r))}function k8e(e){return e.map(t=>`${t.command} ${t.values.join(" ")}`).join(" ").trim()}function Une(e,t,r,i){if(e){if(e.type==="circle")return z("circle",{fill:t,"fill-rule":"evenodd",stroke:r.color,"stroke-width":r.width,"stroke-linecap":r.cap,"stroke-linejoin":r.join,"stroke-dasharray":r.dashArray,"stroke-dashoffset":r.dashOffset,"stroke-miterlimit":"4",cx:e.cx,cy:e.cy,r:e.r});if(e.type==="ellipse")return z("ellipse",{fill:t,"fill-rule":"evenodd",stroke:r.color,"stroke-width":r.width,"stroke-linecap":r.cap,"stroke-linejoin":r.join,"stroke-dasharray":r.dashArray,"stroke-miterlimit":"4",cx:e.cx,cy:e.cy,rx:e.rx,ry:e.ry});if(e.type==="rect")return z("rect",{fill:t,"fill-rule":"evenodd",stroke:r.color,"stroke-width":r.width,"stroke-linecap":r.cap,"stroke-linejoin":r.join,"stroke-dasharray":r.dashArray,"stroke-miterlimit":"4",x:e.x,y:e.y,width:e.width,height:e.height});if(e.type==="image")return z("image",{href:e.src,x:e.x,y:e.y,width:e.width,height:e.height,preserveAspectRatio:"none"});if(e.type==="path"){const n=typeof e.path!="string"?k8e(e.path):e.path;return z("path",{fill:t,"fill-rule":"evenodd",stroke:r.color,"stroke-width":r.width,"stroke-linecap":r.cap,"stroke-linejoin":r.join,"stroke-dasharray":r.dashArray,"stroke-miterlimit":"4",d:n})}if(e.type==="text")return z("text",{"alignment-baseline":i.alignBaseline,fill:t,"fill-rule":"evenodd",stroke:r.color,"stroke-width":r.width,"stroke-linecap":r.cap,"stroke-linejoin":r.join,"stroke-dasharray":r.dashArray,"stroke-miterlimit":"4","text-anchor":i.align,"text-decoration":i.decoration,kerning:i.kerning,rotate:i.rotate,"text-rendering":mst,"font-style":i.font.style,"font-variant":i.font.variant,"font-weight":i.font.weight,"font-size":i.font.size,"font-family":i.font.family,x:e.x,y:e.y},e.text)}return null}function Bne(e){const t={fill:"none",pattern:null,linearGradient:null};if(e){if("type"in e&&e.type==="pattern"){const r="patternId-"+ ++fst;t.fill=`url(#${r})`,t.pattern={id:r,x:e.x,y:e.y,width:e.width,height:e.height,image:{x:0,y:0,width:e.width,height:e.height,href:e.src}}}else if("type"in e&&e.type==="linear"){const r="linearGradientId-"+ ++pst;t.fill=`url(#${r})`,t.linearGradient={id:r,x1:e.x1,y1:e.y1,x2:e.x2,y2:e.y2,stops:e.colors.map(i=>({offset:i.offset,color:i.color&&new Te(i.color).toString()}))}}else if(e){const r=new Te(e);t.fill=r.toString()}}return t}function Gne(e){const t={color:"none",width:1,cap:"butt",join:"4",dashArray:"none",dashOffset:"0"};if(e&&(e.width!=null&&(t.width=e.width),e.cap&&(t.cap=e.cap),e.join&&(t.join=e.join.toString()),e.color&&(t.color=new Te(e.color).toString()),e.dashArray&&(t.dashArray=e.dashArray),e.dashArray&&(t.dashOffset=e.dashoffset),e.style)){let r=null;if(e.style in gfe&&(r=gfe[e.style]),Array.isArray(r)){r=r.slice(0);for(let i=0;i<r.length;++i)r[i]*=e.width;if(e.cap!=="butt"){for(let i=0;i<r.length;i+=2)r[i]-=e.width,r[i]<1&&(r[i]=1);for(let i=1;i<r.length;i+=2)r[i]+=e.width}r=r.join(",")}t.dashArray=r}return t}function V8e(e,t){const r={align:null,decoration:null,kerning:null,rotate:null,font:{style:null,variant:null,weight:null,size:null,family:null}};return e&&(r.align=e.align,r.alignBaseline=e.alignBaseline,r.decoration=e.decoration,r.kerning=e.kerning?"auto":"0",r.rotate=e.rotated?"90":"0",r.font.style=t.style||"normal",r.font.variant=t.variant||"normal",r.font.weight=t.weight||"normal",r.font.size=t.size&&t.size.toString()||"10pt",r.font.family=t.family||"serif"),r}function z8e(e){const{pattern:t,linearGradient:r}=e;if(t)return z("pattern",{id:t.id,patternUnits:"userSpaceOnUse",x:t.x,y:t.y,width:t.width,height:t.height},z("image",{x:t.image.x,y:t.image.y,width:t.image.width,height:t.image.height,href:t.image.href}));if(r){const i=r.stops.map((n,s)=>z("stop",{key:`${s}-stop`,offset:n.offset,"stop-color":n.color}));return z("linearGradient",{id:r.id,gradientUnits:"userSpaceOnUse",x1:r.x1,y1:r.y1,x2:r.x2,y2:r.y2},i)}return null}function _st(e,t){if(!e)return null;const r=[];for(const i of e){const{shape:n,fill:s,stroke:a,font:o}=i,l=Bne(s),c=Gne(a),u=n.type==="text"?V8e(n,o):null;r.push(Une(n,l.fill,c,u))}return z("mask",{id:t,maskUnits:"userSpaceOnUse"},z("g",null,r))}function yfe(e,t,r){return Ez(e,Tz(e),[t,r])}function bfe(e,t,r,i,n){return Vne(e,Tz(e),[t,r]),e[4]=e[4]*t-i*t+i,e[5]=e[5]*r-n*r+n,e}function wst(e,t,r,i){const n=t%360*Math.PI/180;Sz(e,Tz(e),n);const s=Math.cos(n),a=Math.sin(n),o=e[4],l=e[5];return e[4]=o*s-l*a+i*a-r*s+r,e[5]=l*s+o*a-r*a-i*s+i,e}function El(e,t){Js&&"left"in Js?(Js.left>e&&(Js.left=e),Js.right<e&&(Js.right=e),Js.top>t&&(Js.top=t),Js.bottom<t&&(Js.bottom=t)):Js={left:e,bottom:t,right:e,top:t}}function vfe(e){const t=e.args,r=t.length;let i;switch(e.action){case"M":case"L":case"C":case"S":case"Q":case"T":for(i=0;i<r;i+=2)El(t[i],t[i+1]);yi.x=t[r-2],yi.y=t[r-1];break;case"H":for(i=0;i<r;++i)El(t[i],yi.y);yi.x=t[r-1];break;case"V":for(i=0;i<r;++i)El(yi.x,t[i]);yi.y=t[r-1];break;case"m":{let n=0;for(("x"in yi)||(El(yi.x=t[0],yi.y=t[1]),n=2),i=n;i<r;i+=2)El(yi.x+=t[i],yi.y+=t[i+1]);break}case"l":case"t":for(i=0;i<r;i+=2)El(yi.x+=t[i],yi.y+=t[i+1]);break;case"h":for(i=0;i<r;++i)El(yi.x+=t[i],yi.y);break;case"v":for(i=0;i<r;++i)El(yi.x,yi.y+=t[i]);break;case"c":for(i=0;i<r;i+=6)El(yi.x+t[i],yi.y+t[i+1]),El(yi.x+t[i+2],yi.y+t[i+3]),El(yi.x+=t[i+4],yi.y+=t[i+5]);break;case"s":case"q":for(i=0;i<r;i+=4)El(yi.x+t[i],yi.y+t[i+1]),El(yi.x+=t[i+2],yi.y+=t[i+3]);break;case"A":for(i=0;i<r;i+=7)El(t[i+5],t[i+6]);yi.x=t[r-2],yi.y=t[r-1];break;case"a":for(i=0;i<r;i+=7)El(yi.x+=t[i+5],yi.y+=t[i+6])}}function _fe(e,t,r){const i=gst[e.toLowerCase()];let n;typeof i=="number"&&(i?t.length>=i&&(n={action:e,args:t.slice(0,t.length-t.length%i)},r.push(n),vfe(n)):(n={action:e,args:[]},r.push(n),vfe(n)))}function xst(e){const t=(typeof e.path!="string"?k8e(e.path):e.path).match(yst),r=[];if(Js={},yi={},!t)return null;let i="",n=[];const s=t.length;for(let o=0;o<s;++o){const l=t[o],c=parseFloat(l);isNaN(c)?(i&&_fe(i,n,r),n=[],i=l):n.push(c)}_fe(i,n,r);const a={x:0,y:0,width:0,height:0};return Js&&"left"in Js&&(a.x=Js.left,a.y=Js.top,a.width=Js.right-Js.left,a.height=Js.bottom-Js.top),a}function U8e(e){const t={x:0,y:0,width:0,height:0};if(e.type==="circle")t.x=e.cx-e.r,t.y=e.cy-e.r,t.width=2*e.r,t.height=2*e.r;else if(e.type==="ellipse")t.x=e.cx-e.rx,t.y=e.cy-e.ry,t.width=2*e.rx,t.height=2*e.ry;else if(e.type==="image"||e.type==="rect")t.x=e.x,t.y=e.y,t.width=e.width,t.height=e.height;else if(e.type==="path"){const r=xst(e);t.x=r.x,t.y=r.y,t.width=r.width,t.height=r.height}return t}function B8e(e){const t={x:0,y:0,width:0,height:0};let r=null,i=Number.NEGATIVE_INFINITY,n=Number.NEGATIVE_INFINITY;for(const s of e)r?(r.x=Math.min(r.x,s.x),r.y=Math.min(r.y,s.y),i=Math.max(i,s.x+s.width),n=Math.max(n,s.y+s.height)):(r=t,r.x=s.x,r.y=s.y,i=s.x+s.width,n=s.y+s.height);return r&&(r.width=i-r.x,r.height=n-r.y),r}function fJ(e,t,r,i,n,s,a,o,l){let c=(a&&s?m4(s,t):t)/2,u=(a&&s?m4(s,r):r)/2;if(l){const x=l[0],T=l[1];c=(a&&s?m4(s,x):x)/2,u=(a&&s?m4(s,T):T)/2}const h=e.width+i,p=e.height+i,m=IN(),g=IN();let b=!1;if(n&&h!==0&&p!==0){const x=t!==r?t/r:h/p,T=t>r?t:r;let E=1,C=1;isNaN(T)||(x>1?(E=T/h,C=T/x/p):(C=T/p,E=T*x/h)),x3(g,g,bfe(m,E,C,c,u)),b=!0}const w=e.x+(h-i)/2,v=e.y+(p-i)/2;if(x3(g,g,yfe(m,c-w,u-v)),!b&&(h>t||p>r)){const x=h/t>p/r,T=(x?t:r)/(x?h:p);x3(g,g,bfe(m,T,T,w,v))}return s&&x3(g,g,wst(m,s,w,v)),o&&x3(g,g,yfe(m,o[0],o[1])),`matrix(${g[0]},${g[1]},${g[2]},${g[3]},${g[4]},${g[5]})`}function Tst(e,t,r){const i=e==null?void 0:e.effects.find(c=>c.type==="bloom");if(!i)return null;const{strength:n,radius:s}=i,a=n>0?s:0,o=(n+a)*t,l=4*n+1;return z("filter",{id:`bloom${r}`,x:"-100%",y:"-100%",width:"300%",height:"300%",filterUnits:"userSpaceOnUse"},z("feMorphology",{operator:"dilate",radius:(n+.5*a)*(5**(t/100)*(.4+t/100)),in:"SourceGraphic",result:"dilate"}),z("feGaussianBlur",{in:"dilate",stdDeviation:o/25,result:"blur"}),z("feGaussianBlur",{in:"blur",stdDeviation:o/50,result:"intensityBlur"}),z("feComponentTransfer",{in:"SourceGraphic",result:"intensityBrightness"},z("feFuncR",{type:"linear",slope:l}),z("feFuncG",{type:"linear",slope:l}),z("feFuncB",{type:"linear",slope:l})),z("feMerge",null,z("feMergeNode",{in:"intensityBlur"}),z("feMergeNode",{in:"intensityBrightness"}),z("feGaussianBlur",{stdDeviation:n/10})))}function G8e(e,t,r,i={}){var c;const n=[],s=[],a=++vst,o=Tst(i.effectView,t,a);let l=null;if(o){const u=(c=i.effectView)==null?void 0:c.effects.find(g=>g.type==="bloom"),h=(u.strength?u.strength+u.radius/2:0)/3,p=t+t*h,m=r+r*h;l=[Math.max(p,10),Math.max(m,10)]}for(let u=0;u<e.length;u++){const h=e[u],p=[],m=[];let g=0,b=0,w=0;for(const T of h){const{shape:E,fill:C,stroke:A,font:P,offset:I}=T;i.ignoreStrokeWidth||(g+=A&&A.width||0);const L=Bne(C),V=Gne(A),G=E.type==="text"?V8e(E,P):null;n.push(z8e(L)),p.push(Une(E,L.fill,V,G)),m.push(U8e(E)),I&&(b+=I[0],w+=I[1])}const v=fJ(B8e(m),t,r,g,i.scale,i.rotation,i.useRotationSize,[b,w],l);let x=null;if(i.masking){const T=`mask-${u}`,E=i.masking[u];n.push(_st(E,T)),x=`url(#${T})`}s.push(x?z("g",{mask:x},z("g",{transform:v},p)):z("g",{transform:v},p))}return i.useRotationSize&&i.rotation&&(t=m4(i.rotation,t),r=m4(i.rotation,r)),o&&(t=l[0],r=l[1]),z("svg",{xmlns:hst,width:t,height:r,style:"display: block;"},o,z("defs",null,n),o?z("g",{filter:`url(#bloom${a})`},s):s)}const Sst=rN();function yO(e,t,r){const i=Math.ceil(t[0]),n=Math.ceil(t[1]);if(!e.some(a=>!!a.length))return null;const s=r&&r.node||document.createElement("div");return r.opacity!=null&&(s.style.opacity=r.opacity.toString()),r.effectView!=null&&(s.style.filter=SA(r.effectView)),Sst.append(s,G8e.bind(null,e,i,n,r)),s}function Est(e,t){e=Math.ceil(e),t=Math.ceil(t);const r=document.createElement("canvas");r.width=e,r.height=t,r.style.width=e+"px",r.style.height=t+"px";const i=r.getContext("2d");return i.clearRect(0,0,e,t),i}function Cst(e,t,r){return e?qt(e,{responseType:"image"}).then(i=>{const n=i.data,s=n.width,a=n.height,o=s/a;let l=t;if(r){const c=Math.max(s,a);l=Math.min(l,c)}return{image:n,width:o<=1?Math.ceil(l*o):l,height:o<=1?l:Math.ceil(l/o)}}):Promise.reject(new k("renderUtils: imageDataSize","href not provided."))}function Ast(e,t){return!(!e||t==="ignore")&&(t!=="multiply"||e.r!==255||e.g!==255||e.b!==255||e.a!==1)}function Rst(e,t,r,i,n){switch(n){case"multiply":e[t+0]*=r[0],e[t+1]*=r[1],e[t+2]*=r[2],e[t+3]*=r[3];break;default:{const s=kne({r:e[t+0],g:e[t+1],b:e[t+2]});s.h=i.h,s.s=i.s,s.v=s.v/100*i.v;const a=gO(s);e[t+0]=a.r,e[t+1]=a.g,e[t+2]=a.b,e[t+3]*=r[3];break}}}function Ost(e,t,r,i,n){return Cst(e,t,n).then(s=>{const a=s.width?s.width:t,o=s.height?s.height:t;if(s.image&&Ast(r,i)){let l=s.image.width,c=s.image.height;ue("edge")&&/\.svg$/i.test(e)&&(l-=1,c-=1);const u=Est(a,o);u.drawImage(s.image,0,0,l,c,0,0,a,o);const h=u.getImageData(0,0,a,o),p=[r.r/255,r.g/255,r.b/255,r.a],m=kne(r);for(let g=0;g<h.data.length;g+=4)Rst(h.data,g,p,m,i);u.putImageData(h,0,0),e=u.canvas.toDataURL("image/png")}else{const l=Xi&&Xi.findCredential(e);if(l&&l.token){const c=e.includes("?")?"&":"?";e=`${e}${c}token=${l.token}`}}return{url:e,width:a,height:o}}).catch(()=>({url:e,width:t,height:t}))}let qx=null;const wfe=[255,255,255];function xfe(e,t){return Math.floor(Math.random()*(t-e+1)+e)}function Mst(e,t,r){const{backgroundColor:i,outline:n,dotSize:s}=e,a=r&&r.swatchSize||la.size,o=.8,l=Math.round(a*a/s**2*o),c=window.devicePixelRatio,u=document.createElement("canvas"),h=a*c;u.width=h,u.height=h,u.style.width=u.width/c+"px",u.style.height=u.height/c+"px";const p=u.getContext("2d");if(i&&(p.fillStyle=i.toCss(!0),p.fillRect(0,0,h,h),p.fill()),p.fillStyle=t.toCss(!0),qx&&qx.length/2===l)for(let g=0;g<2*l;g+=2){const b=qx[g],w=qx[g+1];p.fillRect(b,w,s*c,s*c),p.fill()}else{qx=[];for(let g=0;g<2*l;g+=2){const b=xfe(0,h),w=xfe(0,h);qx.push(b,w),p.fillRect(b,w,s*c,s*c),p.fill()}}n&&(n.color&&(p.strokeStyle=n.color.toCss(!0)),p.lineWidth=n.width,p.strokeRect(0,0,h,h));const m=new Image(a,a);return m.src=u.toDataURL(),m}function Pst(e,t={}){const r=t.radius||40,i=2*Math.PI*r,n=e.length,s=i/n,a=[],o=xA(t.outline);o&&(o.width*=2),(o||t.backgroundColor)&&a.push({shape:{type:"circle",cx:r,cy:r,r},fill:t.backgroundColor,stroke:o,offset:[0,0]});const l=t.values,c=l&&l.length===n&&l.reduce((g,b)=>g+b,0)===100,u=[0];for(let g=0;g<n;g++){const b=c?l[g]*i/100:null;c&&u.push(b+u[g]),a.push({shape:{type:"circle",cx:r,cy:r,r:r/2},fill:[0,0,0,0],stroke:{width:r,dashArray:`${b||s} ${i}`,dashoffset:"-"+(c?u[g]/2:g*(s/2)),color:e[g]},offset:[0,0]})}let h=null;const p=2*r+((o==null?void 0:o.width)||0),m=t.holePercentage;if(m){o&&a.push({shape:{type:"circle",cx:r,cy:r,r:r*m},fill:null,stroke:o,offset:[0,0]});const g=p/2;h=[[{shape:{type:"circle",cx:g,cy:g,r:g},fill:wfe,stroke:o?{...o,color:wfe}:null,offset:[0,0]},{shape:{type:"circle",cx:g,cy:g,r:r*m},fill:[0,0,0],stroke:null,offset:[0,0]}]]}return yO([a],[p,p],{effectView:t.effectList,ignoreStrokeWidth:!0,masking:h,rotation:-90})}function j2(e,t={}){const n=t.align==="horizontal",s=n?75:24,a=n?24:75,{width:o=s,height:l=a,gradient:c=!0}=t,u=window.devicePixelRatio,h=o*u,p=l*u,m=document.createElement("canvas");m.width=h,m.height=p,m.style.width=`${o}px`,m.style.height=`${l}px`;const g=m.getContext("2d"),b=n?h:0,w=n?0:p;if(c){const x=g.createLinearGradient(0,0,b,w),T=e.length,E=T===1?0:1/(T-1);e.forEach((C,A)=>x.addColorStop(A*E,C.toString())),g.fillStyle=x,g.fillRect(0,0,h,p)}else{const x=n?h/e.length:h,T=n?p:p/e.length;let E=0,C=0;for(const A of e)g.fillStyle=A.toString(),g.fillRect(E,C,x,T),E=n?E+x:0,C=n?0:C+T}const v=document.createElement("div");return v.style.width=`${o}px`,v.style.height=`${l}px`,Ist(v,t==null?void 0:t.effectList),v.appendChild(m),v}function Ist(e,t){if(!t)return;e.style.filter=SA(t);const r=t.effects;if(r){for(const i of r)if((i==null?void 0:i.type)==="drop-shadow"){i.offsetX<0?e.style.marginLeft=`${Math.abs(i.offsetX)}px`:e.style.marginRight=`${i.offsetX}px`;break}}}async function j8e(e,t){switch(e.type){case"web-style":{const{previewWebStyleSymbol:r}=await ie(()=>import("./previewWebStyleSymbol.80fc9124.js"),[],import.meta.url);return r(e,j8e,t)}case"label-3d":case"line-3d":case"mesh-3d":case"point-3d":case"polygon-3d":{const{previewSymbol3D:r}=await ie(()=>Promise.resolve().then(()=>oAt),void 0,import.meta.url);return r(e,t)}case"simple-marker":case"simple-line":case"simple-fill":case"picture-marker":case"picture-fill":case"text":{const{previewSymbol2D:r}=await ie(()=>import("./previewSymbol2D.e3e52974.js"),[],import.meta.url);return r(e,t)}case"cim":{const{previewCIMSymbol:r}=await ie(()=>import("./previewCIMSymbol.e4afe305.js"),["previewCIMSymbol.e4afe305.js","CIMSymbolRasterizer.f963c8a7.js","cimAnalyzer.370e7d9c.js","CIMSymbolHelper.7933df34.js","BidiEngine.210f7ff8.js","enums.4de5fe56.js","number.6e30c64a.js"],import.meta.url);return r(e,t)}default:return}}function q8e(e){return e&&"opacity"in e?e.opacity*q8e(e.parent):1}async function $st(e,t){var w;if(!e)return;const r=e.sourceLayer,i=(w=_(t)&&t.useSourceLayer?r:e.layer)!=null?w:r,n=q8e(i);if(_(e.symbol)&&(!_(t)||t.ignoreGraphicSymbol!==!0)){const v=e.symbol.type==="web-style"?await e.symbol.fetchSymbol({...t,cache:_(t)?t.webStyleCache:null}):e.symbol.clone();return PG(v,null,n),v}const s=_(t)&&t.renderer||i&&"renderer"in i&&i.renderer;let a=s&&"getSymbolAsync"in s?await s.getSymbolAsync(e,t):null;if(!a)return;if(a=a.type==="web-style"?await a.fetchSymbol({...t,cache:_(t)?t.webStyleCache:null}):a.clone(),!("visualVariables"in s)||!s.visualVariables||!s.visualVariables.length)return PG(a,null,n),a;if("arcadeRequiredForVisualVariables"in s&&s.arcadeRequiredForVisualVariables&&(R(t)||R(t.arcade))){const v={...t};v.arcade=await Wh(),t=v}const o=await ie(()=>Promise.resolve().then(()=>Px),void 0,import.meta.url),l=[],c=[],u=[],h=[];for(const v of s.visualVariables)switch(v.type){case"color":l.push(v);break;case"opacity":c.push(v);break;case"rotation":h.push(v);break;case"size":v.target||u.push(v)}const p=!!l.length&&l[l.length-1],m=p?o.getColor(p,e,t):null,g=!!c.length&&c[c.length-1];let b=g?o.getOpacity(g,e,t):null;if(n!=null&&(b=b!=null?b*n:n),PG(a,m,b),u.length){const v=o.getAllSizes(u,e,t);await nQe(a,v)}for(const v of h)sQe(a,o.getRotationAngle(v,e,t),v.axis);return a}class Ly{constructor(t,r){this.owner=r,this.properties={},this.afterDispatchHandle=null;for(const i in t){const n=t[i],s=new B2e(n,null,null,2,2);this.properties[i]={pool:s,acquired:[]}}this.afterDispatchHandle=r3e(()=>this._release())}destroy(){this.afterDispatchHandle&&(this.afterDispatchHandle.remove(),this.afterDispatchHandle=null);for(const t in this.properties){const r=this.properties[t];for(const i of r.acquired)sce(i)||r.pool.release(i);r.pool.destroy(),r.pool=null,r.acquired=null}this.properties=null,this.owner=null}get(t){const r=this.owner._get(t),i=this.properties[t];let n=i.pool.acquire();for(i.acquired.push(n);n===r;)i.acquired.push(n),n=i.pool.acquire();return n}_release(){for(const t in this.properties){const r=this.properties[t];let i=0;for(const n of r.acquired)sce(n)?r.acquired[i++]=n:r.pool.release(n);r.acquired.length=i}}}const Lst=ue("mac")?"Meta":"Ctrl",Cz={8:"Backspace",9:"Tab",13:"Enter",27:"Escape",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete"};for(let e=48;e<58;e++)Cz[e]=String.fromCharCode(e);for(let e=1;e<25;e++)Cz[111+e]=`F${e}`;for(let e=65;e<91;e++)Cz[e]=[String.fromCharCode(e+32),String.fromCharCode(e)];function Dst(e){if(e.key!==void 0)return p3(e);const t=Cz[e.keyCode];return Array.isArray(t)?e.shiftKey?t[1]:t[0]:t}function Fst(e){switch(e){case"Ctrl":case"Alt":case"Shift":case"Meta":case"Primary":return!0}return!1}class Nst{constructor(t,r=[]){this.eventType=t,this.keyModifiers=r}matches(t){if(t.type!==this.eventType)return!1;if(this.keyModifiers.length===0)return!0;const r=t.modifiers;for(const i of this.keyModifiers)if(!r.has(i))return!1;return!0}}const Tfe=fe.getLogger("esri.views.input.InputHandler");class ho{constructor(t){this._manager=null,this._incoming={},this._outgoing={},this._incomingEventMatches=null,this._incomingEventTypes=null,this._outgoingEventTypes=null,this._hasSideEffects=t}get incomingEventMatches(){if(!this._incomingEventMatches){this._incomingEventMatches=[];for(const t in this._incoming){const r=this._incoming[t];for(const i of r)this._incomingEventMatches.push(i.match)}}return this._incomingEventMatches}get incomingEventTypes(){return this._incomingEventTypes||(this._incomingEventTypes=this.incomingEventMatches.map(t=>t.eventType)),this._incomingEventTypes}get outgoingEventTypes(){return this._outgoingEventTypes||(this._outgoingEventTypes=Object.keys(this._outgoing)),this._outgoingEventTypes}get hasSideEffects(){return this._hasSideEffects}get hasPendingInputs(){return!1}onInstall(t){this._manager?Tfe.error("This InputHandler has already been registered with an InputManager"):(t.setEventCallback(r=>this._handleEvent(r)),t.setUninstallCallback(()=>this._onUninstall()),this._manager=t)}onUninstall(){}registerIncoming(t,r,i){let n;typeof r=="function"?(i=r,n=[]):n=r||[];const s=typeof t=="string"?new Nst(t,n):t,a=()=>{this._incomingEventTypes=null,this._incomingEventMatches=null},o=u=>{const h=this._incoming[u.match.eventType];if(h){const p=h.indexOf(u);h.splice(p,1),a(),this._manager&&this._manager.updateDependencies()}},l=new kst(s,i,{onPause:o,onRemove:o,onResume:u=>{const h=this._incoming[u.match.eventType];h&&!h.includes(u)&&(h.push(u),a(),this._manager&&this._manager.updateDependencies())}});let c=this._incoming[s.eventType];return c||(c=[],this._incoming[s.eventType]=c),c.push(l),a(),this._manager&&this._manager.updateDependencies(),l}registerOutgoing(t){if(this._outgoing[t])throw Error("There is already a callback registered for this outgoing InputEvent: "+t);const r=new Vst(t,{onEmit:(i,n,s,a)=>{this._manager.emit(i.eventType,n,s,a)},onRemove:i=>{delete this._outgoing[i.eventType],this._manager.updateDependencies()}});return this._outgoing[t]=r,this._outgoingEventTypes=null,this._manager&&this._manager.updateDependencies(),r}startCapturingPointer(t){this._manager.setPointerCapture(t,!0)}stopCapturingPointer(t){this._manager.setPointerCapture(t,!1)}refreshHasPendingInputs(){this._manager.refreshHasPendingInputs()}_onUninstall(){this._manager?(this.onUninstall(),this._manager=null):Tfe.error("This InputHandler is not registered with an InputManager")}_handleEvent(t){const r=this._incoming[t.type];if(r){for(const i of r)if(i.match.matches(t)&&(i.callback(t),t.shouldStopPropagation()))break}}}class kst{constructor(t,r,i){this.match=t,this._callback=r,this._handler=i}pause(){this._handler.onPause(this)}resume(){this._handler.onResume(this)}remove(){this._handler.onRemove(this)}get callback(){return this._callback}}class Vst{constructor(t,r){this.eventType=t,this._removed=!1,this._handler=r}emit(t,r,i){this._removed||this._handler.onEmit(this,t,r,i)}remove(){this._removed=!0,this._handler.onRemove(this)}}class zst extends ho{constructor(t){super(!0),this._onChange=t,this._value="mouse",this._x=null,this._y=null,this.registerIncoming("pointer-move",r=>{const i=r.data.native.pointerType==="touch";this._setValue(i?"touch":"mouse",r.data.x,r.data.y)})}_setValue(t,r,i){t===this._value&&this._x===r&&this._y===i||(this._value=t,this._x=r,this._y=i,this._onChange(t,r,i))}}const fj=fe.getLogger("esri.views.input.InputManager");let l1=class extends xe{constructor(e){super(e),this._pointerCaptures=new Map,this._nameToGroup={},this._handlers=[],this._currentPropagation=null,this._updateDependenciesAfterPropagation=!1,this._sourceEvents=new Set,this._keyModifiers=new Set,this._activeKeyModifiers=new Set,this._stoppedPropagationEventIds=new Set,this.primaryKey=Lst,this.latestPointerType="mouse",this._propertiesPool=new Ly({latestPointerLocation:Bst},this),this.latestPointerLocation=null,this.test={timestamp:void 0,hasCurrentPropagation:()=>!!this._currentPropagation}}initialize(){this.eventSource.onEventReceived=this._onEventReceived.bind(this),this._installRecognizers()}destroy(){const e=Object.keys(this._nameToGroup);for(const t of e)this.uninstallHandlers(t);this.eventSource=null,this._currentPropagation=null,this._propertiesPool.destroy()}get hasPendingInputs(){return this._handlers.some(e=>e.handler.hasPendingInputs)}installHandlers(e,t,r=Lv.INTERNAL){if(this._nameToGroup[e])return void fj.error("There is already an InputHandler group registered under the name `"+e+"`");if(t.length===0)return void fj.error("Can't register a group of zero handlers");const i={name:e,handlers:t.map(n=>({handler:n,active:!0,removed:!1,priorityIndex:0,groupPriority:r,eventCallback:null,uninstallCallback:null}))};this._nameToGroup[e]=i;for(let n=i.handlers.length-1;n>=0;n--){const s=i.handlers[n];this._handlers.push(s),s.handler.onInstall({updateDependencies:()=>{this.updateDependencies()},emit:(a,o,l,c,u)=>{this._emitInputEvent(s.priorityIndex+1,a,o,l,u,c)},setPointerCapture:(a,o)=>{this._setPointerCapture(i,s,a,o)},setEventCallback:a=>{s.eventCallback=a},setUninstallCallback:a=>{s.uninstallCallback=a},refreshHasPendingInputs:()=>{this.notifyChange("hasPendingInputs")}})}this.updateDependencies()}uninstallHandlers(e){const t=this._nameToGroup[e];t?(t.handlers.forEach(r=>{r.removed=!0,r.uninstallCallback()}),delete this._nameToGroup[e],this._currentPropagation?this._currentPropagation.needsHandlerGarbageCollect=!0:this._garbageCollectRemovedHandlers()):fj.error("There is no InputHandler group registered under the name `"+e+"`")}hasHandlers(e){return this._nameToGroup[e]!==void 0}updateDependencies(){if(this._currentPropagation)return void(this._updateDependenciesAfterPropagation=!0);this._updateDependenciesAfterPropagation=!1;const e=new Set,t=new Set;this._handlersPriority=[];for(let r=this._handlers.length-1;r>=0;r--){const i=this._handlers[r];i.priorityIndex=r,this._handlersPriority.push(i)}this._handlersPriority=this._sortHandlersPriority(this._handlersPriority);for(let r=this._handlersPriority.length-1;r>=0;r--){const i=this._handlersPriority[r];i.priorityIndex=r;let n=i.handler.hasSideEffects;if(!n){for(const s of i.handler.outgoingEventTypes)if(e.has(s)){n=!0;break}}if(n)for(const s of i.handler.incomingEventMatches){e.add(s.eventType);for(const a of s.keyModifiers)Fst(a)||t.add(a)}i.active=n}this._sourceEvents=e,this._keyModifiers=t,this._pointerCaptures.size>0&&this._sourceEvents.add("pointer-capture-lost"),this._keyModifiers.size>0&&(this._sourceEvents.add("key-down"),this._sourceEvents.add("key-up")),this.eventSource&&(this.eventSource.activeEvents=this._sourceEvents)}_setLatestPointer(e,t,r){this._get("latestPointerType")!==e&&this._set("latestPointerType",e);const i=this._get("latestPointerLocation");if(R(i)||i.x!==t||i.y!==r){const n=this._propertiesPool.get("latestPointerLocation");n.x=t,n.y=r,this._set("latestPointerLocation",n)}}_onEventReceived(e,t){if(e==="pointer-capture-lost"){const n=t;this._pointerCaptures.delete(n.native.pointerId)}this._updateKeyModifiers(e,t);const r=this.test.timestamp!=null?this.test.timestamp:t.native?t.native.timestamp:void 0,i=t.native?t.native.cancelable:void 0;this._emitInputEventFromSource(e,t,r,i)}_updateKeyModifiers(e,t){if(!t)return;let r=!1;const i=()=>{if(!r){const a=new Set;this._activeKeyModifiers.forEach(o=>{a.add(o)}),this._activeKeyModifiers=a,r=!0}},n=(a,o)=>{o&&!this._activeKeyModifiers.has(a)?(i(),this._activeKeyModifiers.add(a)):!o&&this._activeKeyModifiers.has(a)&&(i(),this._activeKeyModifiers.delete(a))};if(e==="key-down"||e==="key-up"){const a=t.key;this._keyModifiers.has(a)&&n(a,e==="key-down")}const s=t.native;n("Alt",!(!s||!s.altKey)),n("Ctrl",!(!s||!s.ctrlKey)),n("Shift",!(!s||!s.shiftKey)),n("Meta",!(!s||!s.metaKey)),n("Primary",this._activeKeyModifiers.has(this.primaryKey))}_installRecognizers(){this._latestPointerHandler=new zst((e,t,r)=>this._setLatestPointer(e,t,r)),this.installHandlers("input-manager-logic",[this._latestPointerHandler],Lv.ALWAYS),this.recognizers.length>0&&this.installHandlers("default",this.recognizers,Lv.INTERNAL)}_setPointerCapture(e,t,r,i){const n=e.name+"-"+t.priorityIndex,s=this._pointerCaptures.get(r.pointerId)||new Set;this._pointerCaptures.set(r.pointerId,s),i?(s.add(n),s.size===1&&this.eventSource&&this.eventSource.setPointerCapture(r,!0)):s.has(n)&&(s.delete(n),s.size===0&&(this._pointerCaptures.delete(r.pointerId),this.eventSource&&this.eventSource.setPointerCapture(r,!1)))}_garbageCollectRemovedHandlers(){this._handlers=this._handlers.filter(e=>!e.removed),this.updateDependencies()}_emitInputEventFromSource(e,t,r,i){this._emitInputEvent(0,e,t,r,i)}_emitInputEvent(e,t,r,i,n,s){const a=i!==void 0?i:this._currentPropagation?this._currentPropagation.timestamp:performance.now(),o=n!==void 0&&n,l={event:new Ust(t,r,a,s||this._activeKeyModifiers,o),priorityIndex:e};this._currentPropagation?this._currentPropagation.events.push(l):this._doNewPropagation(l)}_doNewPropagation(e){this._currentPropagation={events:new qY,currentHandler:null,needsHandlerGarbageCollect:!1,timestamp:e.event.timestamp},this._currentPropagation.events.push(e),this._continuePropagation()}_continuePropagation(){const e=this._currentPropagation;if(e){for(;this._currentPropagation.events.length>0;){const{event:t,priorityIndex:r}=this._currentPropagation.events.pop(),i=t.data&&t.data.eventId;if(!(i!=null&&this._stoppedPropagationEventIds.has(i)))for(e.currentHandler=this._handlersPriority[r];e.currentHandler;){if(e.currentHandler.removed)e.needsHandlerGarbageCollect=!0;else{if(e.currentHandler.active&&!t.shouldStopPropagation()&&e.currentHandler.eventCallback(t),t.shouldStopPropagation()){i!=null&&this._stoppedPropagationEventIds.add(i);break}if(t.shouldPausePropagation(()=>this._continuePropagation()))return void this._pausePropagation({event:t,priorityIndex:e.currentHandler.priorityIndex+1})}e.currentHandler=this._handlersPriority[e.currentHandler.priorityIndex+1]}}e.needsHandlerGarbageCollect&&this._garbageCollectRemovedHandlers(),this.hasPendingInputs||this._stoppedPropagationEventIds.clear(),this._currentPropagation=null,this._updateDependenciesAfterPropagation&&this.updateDependencies()}}_pausePropagation(e){const t=new qY;for(t.push(e);this._currentPropagation.events.length;)t.push(this._currentPropagation.events.pop());this._currentPropagation.events=t,this._currentPropagation.currentHandler=null}_compareHandlerPriority(e,t){if(e.handler.hasSideEffects!==t.handler.hasSideEffects)return e.handler.hasSideEffects?1:-1;if(e.groupPriority!==t.groupPriority)return e.groupPriority>t.groupPriority?-1:1;for(const r of e.handler.incomingEventMatches)for(const i of t.handler.incomingEventMatches){if(r.eventType!==i.eventType)continue;const n=r.keyModifiers.filter(s=>i.keyModifiers.includes(s));if(n.length===r.keyModifiers.length!=(n.length===i.keyModifiers.length))return r.keyModifiers.length>i.keyModifiers.length?-1:1}return e.priorityIndex>t.priorityIndex?-1:1}_sortHandlersPriority(e){const t=[];for(const r of e){let i=0;for(;i<t.length&&this._compareHandlerPriority(r,t[i])>=0;)i++;t.splice(i,0,r)}return t}get debug(){const e=t=>{const r=this._setPointerCapture;this._setPointerCapture=()=>{},t(),this._setPointerCapture=r};return{injectEvent:(t,r)=>{e(()=>{this._onEventReceived(t,r)})},disablePointerCapture:e}}};d([f({readOnly:!0})],l1.prototype,"hasPendingInputs",null),d([f()],l1.prototype,"eventSource",void 0),d([f()],l1.prototype,"recognizers",void 0),d([f({readOnly:!0})],l1.prototype,"latestPointerType",void 0),d([f({readOnly:!0})],l1.prototype,"latestPointerLocation",void 0),l1=d([$("esri.views.input.InputManager")],l1);class Ust{constructor(t,r,i,n,s){this.type=t,this.data=r,this.timestamp=i,this.modifiers=n,this.cancelable=s,this._propagationState=F1.NONE,this._resumeCallback=null}stopPropagation(){this._propagationState|=F1.STOPPED}shouldStopPropagation(){return(this._propagationState&F1.STOPPED)!=0}async(t){this._propagationState|=F1.PAUSED;const r=(i,n)=>{this._propagationState&=~F1.PAUSED;const s=this._resumeCallback;if(this._resumeCallback=null,s&&s(),n)throw i;return i};return(typeof t=="function"?t():t).then(i=>r(i,!1),i=>r(i,!0))}shouldPausePropagation(t){return!!(this._propagationState&F1.PAUSED)&&(this._resumeCallback=t,!0)}preventDefault(){this.data.native.preventDefault()}}var F1;(function(e){e[e.NONE=0]="NONE",e[e.STOPPED=1]="STOPPED",e[e.PAUSED=2]="PAUSED"})(F1||(F1={}));const Lv={ALWAYS:1,DEFAULT:0,TOOL:-1,WIDGET:-2,INTERNAL:-3};class Bst{}function Sfe(e){return e&&typeof e.highlight=="function"}function Gst(e){return e&&typeof e.maskOccludee=="function"}function uLt(e,t,r){return R(e)||e>r&&(t===0||e<t)}function hLt(e,t){return e>0||t>0}function fLt(e){var r,i;const t=e.effectiveScaleRange;return{minScale:(r=t==null?void 0:t.minScale)!=null?r:0,maxScale:(i=t==null?void 0:t.maxScale)!=null?i:0}}const Az={iconZoom:"esri-icon-zoom-in-magnifying-glass",iconTrash:"esri-icon-trash",iconBrowseClusteredFeatures:"esri-icon-table"},H3=new K9({id:"zoom-to-feature",title:"{messages.zoom}",className:Az.iconZoom}),Efe=new K9({id:"remove-selected-feature",title:"{messages.remove}",className:Az.iconTrash}),g4=new K9({id:"zoom-to-clustered-features",title:"{messages.zoom}",className:Az.iconZoom}),y4=new K9({id:"browse-clustered-features",title:"{messages.browseClusteredFeatures}",className:Az.iconBrowseClusteredFeatures}),jst="esri.widgets.Popup.PopupViewModel",$N=fe.getLogger(jst),qst=e=>{const{event:t,view:r}=e,{action:i}=t,n=r&&r.popup;if(!i)return Promise.reject(new k("trigger-action:missing-arguments","Event has no action"));if(!n)return Promise.reject(new k("trigger-action:missing-arguments","view.popup is missing"));const{disabled:s,id:a}=i;if(!a)return Promise.reject(new k("trigger-action:invalid-action","action.id is missing"));if(s)return Promise.reject(new k("trigger-action:invalid-action","Action is disabled"));if(a===H3.id)return Wst(n.viewModel).catch(ZW);if(a===g4.id)return Xst(n.viewModel);if(a===y4.id)return n.featureMenuOpen=!n.featureMenuOpen,n.viewModel.browseClusterEnabled=!n.viewModel.browseClusterEnabled,Promise.resolve();if(n.viewModel.browseClusterEnabled=!1,a===Efe.id){n.close();const{selectedFeature:o}=n;if(!o)return Promise.reject(new k(`trigger-action:${Efe.id}`,"selectedFeature is required",{selectedFeature:o}));const{sourceLayer:l}=o;return l?l.remove(o):r.graphics.remove(o),Promise.resolve()}return Promise.resolve()};function H8e(e){const{selectedFeature:t,location:r,view:i}=e;return i?i.type==="3d"?t||r:e.get("selectedFeature.geometry")||r:null}function T3(e){var t,r;return(e==null?void 0:e.isAggregate)&&((r=(t=e==null?void 0:e.sourceLayer)==null?void 0:t.featureReduction)==null?void 0:r.type)==="cluster"}function Hst(e,t){if((t==null?void 0:t.type)!=="3d"||!e||e.declaredClass!=="esri.Graphic")return!0;const r=t.getViewForGraphic(e);if(r&&"whenGraphicBounds"in r){let i=!1;return r.whenGraphicBounds(e,{useViewElevation:!0}).then(n=>{i=!n||!n.boundingBox||n.boundingBox[0]===n.boundingBox[3]&&n.boundingBox[1]===n.boundingBox[4]&&n.boundingBox[2]===n.boundingBox[5]}).catch(()=>{const n=new k("zoom-to:invalid-graphic","Could not zoom to the location of the graphic.",{graphic:e});$N.error(n)}),i}return!0}async function Wst(e){const{location:t,selectedFeature:r,view:i,zoomFactor:n}=e,s=H8e(e);if(!s){const c=new k("zoom-to:invalid-target-or-view","Cannot zoom to location without a target and view.",{target:s,view:i});throw $N.error(c),c}const a=i.scale/n,o=e.get("selectedFeature.geometry")||t,l=o&&o.type==="point"&&Hst(r,i);H3.active=!0,H3.disabled=!0;try{await e.view.goTo({target:s,scale:l?a:void 0})}finally{H3.active=!1,H3.disabled=!1,e.zoomToLocation=null,l&&(e.location=o)}}async function Xst(e){const{selectedFeature:t,view:r}=e;if((r==null?void 0:r.type)!=="2d"){const o=new k("zoomToCluster:invalid-view","View must be 2d MapView.",{view:r});throw $N.error(o),o}if(!T3(t)){const o=new k("zoomToCluster:invalid-selectedFeature","Selected feature must represent an aggregate/cluster graphic.",{selectedFeature:t});throw $N.error(o),o}const i=t.sourceLayer,n=await r.whenLayerView(i),s=n.createQuery();s.aggregateIds=[t.getObjectId()],g4.active=!0,g4.disabled=!0;const{extent:a}=await n.queryExtent(s);await r.goTo({target:a}),g4.active=!1,g4.disabled=!1}async function Yst(e){const{selectedFeature:t,view:r}=e,i=t.sourceLayer,n=await r.whenLayerView(i),s=n.createQuery();s.aggregateIds=[t.getObjectId()];const{extent:a}=await n.queryExtent(s);e.selectedClusterBoundaryFeature.geometry=a,r.graphics.add(e.selectedClusterBoundaryFeature)}async function Zst(e){const{selectedFeature:t,view:r}=e,i=t.sourceLayer,n=await r.whenLayerView(i),s=n.createQuery();s.aggregateIds=[t.getObjectId()],y4.active=!0,y4.disabled=!0;const{features:a}=await n.queryFeatures(s);y4.active=!1,y4.disabled=!1,r.popup.open({features:[t].concat(a),featureMenuOpen:!0})}function Qst(e){const t=e.features.filter(r=>T3(r));t.length&&(e.features=t)}const jne=e=>{let t=class extends e{constructor(...r){super(...r),this.goToOverride=null,this.view=null}callGoTo(r){const{view:i}=this;return this.goToOverride?this.goToOverride(i,r):i.goTo(r.target,r.options)}};return d([f()],t.prototype,"goToOverride",void 0),d([f()],t.prototype,"view",void 0),t=d([$("esri.widgets.support.GoTo")],t),t},a7=lt.ofType({key:"type",defaultKeyValue:"button",base:wV,typeMap:{button:K9,toggle:pxe}}),Jst=()=>[H3.clone()],Kst=()=>[g4.clone(),y4.clone()],W8e="esri.widgets.Popup.PopupViewModel",yP=fe.getLogger(W8e);let Rr=class extends jne(C8e){constructor(e){super(e),this._handles=new Ft,this._pendingPromises=new Set,this._fetchFeaturesController=null,this._selectedClusterFeature=null,this.featurePage=null,this.actions=new a7,this.activeFeature=null,this.defaultPopupTemplateEnabled=!1,this.autoCloseEnabled=!1,this.autoOpenEnabled=!0,this.browseClusterEnabled=!1,this.content=null,this.featuresPerPage=20,this.featureViewModelAbilities=null,this.featureViewModels=[],this.highlightEnabled=!0,this.includeDefaultActions=!0,this.selectedClusterBoundaryFeature=new co({symbol:new kp({outline:{width:1.5,color:"cyan"},style:"none"})}),this.title=null,this.updateLocationEnabled=!1,this.view=null,this.visible=!1,this.zoomFactor=4,this.zoomToLocation=null}get isLoadingFeature(){return this.featureViewModels.some(e=>e.waitingForContent)}initialize(){this._handles.add([re(()=>[this.autoOpenEnabled,this.view],()=>this._autoOpenEnabledChange()),this.on("view-change",()=>this._autoClose()),re(()=>[this.highlightEnabled,this.selectedFeature,this.visible,this.view],()=>this._highlightSelectedFeature()),re(()=>[this.highlightEnabled,this.activeFeature,this.visible,this.view],()=>this._highlightActiveFeature()),re(()=>{var e,t;return(t=(e=this.view)==null?void 0:e.animation)==null?void 0:t.state},e=>this._animationStateChange(e)),re(()=>this.location,e=>this._locationChange(e)),re(()=>this.selectedFeature,e=>this._selectedFeatureChange(e)),re(()=>[this.selectedFeatureIndex,this.featureCount,this.featuresPerPage],()=>this._selectedFeatureIndexChange()),re(()=>[this.featurePage,this.selectedFeatureIndex,this.featureCount,this.featuresPerPage,this.featureViewModels],()=>this._setGraphicOnFeatureViewModels()),re(()=>this.featureViewModels,()=>this._featureViewModelsChange()),this.on("trigger-action",e=>qst({event:e,view:this.view})),Fa(()=>!this.waitingForResult,()=>this._waitingForResultChange(),ti),re(()=>{var e,t;return[this.features,(e=this.view)==null?void 0:e.map,(t=this.view)==null?void 0:t.spatialReference]},()=>this._updateFeatureVMs()),re(()=>{var e;return(e=this.view)==null?void 0:e.scale},()=>this._viewScaleChange()),Fa(()=>!this.visible,()=>this.browseClusterEnabled=!1),re(()=>this.browseClusterEnabled,e=>e?this.enableClusterBrowsing():this.disableClusterBrowsing())])}destroy(){this._cancelFetchingFeatures(),this._handles.destroy(),this._handles=null,this._pendingPromises.clear(),this.browseClusterEnabled=!1,this.view=null}get active(){return!(!this.visible||this.waitingForResult)}get allActions(){const e=this._get("allActions")||new a7;e.removeAll();const{actions:t,defaultActions:r,defaultPopupTemplateEnabled:i,includeDefaultActions:n,selectedFeature:s}=this,a=n?r.concat(t):t,o=s&&(typeof s.getEffectivePopupTemplate=="function"&&s.getEffectivePopupTemplate(i)||s.popupTemplate),l=o&&o.actions,c=o&&o.overwriteActions?l:l?l.concat(a):a;return c&&c.filter(Boolean).forEach(u=>e.add(u)),e}get defaultActions(){const e=this._get("defaultActions")||new a7;return e.removeAll(),e.addMany(T3(this.selectedFeature)?Kst():Jst()),e}get featureCount(){return this.features.length}get features(){return this._get("features")||[]}set features(e){const t=e||[];this._set("features",t);const{pendingPromisesCount:r,promiseCount:i,selectedFeatureIndex:n}=this,s=i&&t.length;s&&r&&n===-1?this.selectedFeatureIndex=0:s&&n!==-1||(this.selectedFeatureIndex=t.length?0:-1)}get location(){return this._get("location")||null}set location(e){const t=this.get("view.spatialReference.isWebMercator");e&&e.get("spatialReference.isWGS84")&&t&&(e=ly(e)),this._set("location",e)}get pendingPromisesCount(){return this._pendingPromises.size}get waitingForResult(){return!(!(!!this._fetchFeaturesController||this.pendingPromisesCount>0)||this.featureCount!==0)}get promiseCount(){return this.promises.length}get promises(){return this._get("promises")||[]}set promises(e){if(this._pendingPromises.clear(),this.features=[],!Array.isArray(e)||!e.length)return this._set("promises",[]),void this.notifyChange("pendingPromisesCount");this._set("promises",e),(e=e.slice(0)).forEach(t=>{this._pendingPromises.add(t);const r=n=>{this._pendingPromises.has(t)&&this._updateFeatures(n),this._updatePendingPromises(t)},i=()=>this._updatePendingPromises(t);t.then(r,i)}),this.notifyChange("pendingPromisesCount")}get selectedFeature(){const{features:e,selectedFeatureIndex:t}=this;return t===-1?null:e[t]||null}get selectedFeatureIndex(){const e=this._get("selectedFeatureIndex");return typeof e=="number"?e:-1}set selectedFeatureIndex(e){const{featureCount:t}=this;e=isNaN(e)||e<-1||!t?-1:(e+t)%t,this.activeFeature=null,this._set("selectedFeatureIndex",e)}get selectedFeatureViewModel(){return this.featureViewModels[this.selectedFeatureIndex]||null}get state(){return this.get("view.ready")?"ready":"disabled"}centerAtLocation(){const{view:e}=this,t=H8e(this);if(!t){const r=new k("center-at-location:invalid-target-or-view","Cannot center at a location without a target and view.",{target:t,view:e});return yP.error(r),Promise.reject(r)}return this.callGoTo({target:{target:t,scale:e.scale}})}clear(){this.set({promises:[],features:[],content:null,title:null,location:null,activeFeature:null})}fetchFeatures(e,t){const{view:r}=this;if(!r||!e){const i=new k("fetch-features:invalid-screenpoint-or-view","Cannot fetch features without a screenPoint and view.",{screenPoint:e,view:r});return yP.error(i),Promise.reject(i)}return r.fetchPopupFeatures(e,{event:t&&t.event,defaultPopupTemplateEnabled:this.defaultPopupTemplateEnabled,signal:t&&t.signal})}open(e){const t={updateLocationEnabled:!1,promises:[],fetchFeatures:!1,...e,visible:!0},{fetchFeatures:r}=t;delete t.fetchFeatures,r&&this._setFetchFeaturesPromises(t.location);const i=["actionsMenuOpen","collapsed","featureMenuOpen"];for(const n of i)delete t[n];this.set(t)}triggerAction(e){const t=this.allActions.getItemAt(e);t&&!t.disabled&&this.emit("trigger-action",{action:t})}next(){return this.selectedFeatureIndex=this.selectedFeatureIndex+1,this}previous(){return this.selectedFeatureIndex=this.selectedFeatureIndex-1,this}disableClusterBrowsing(){Qst(this),this._clearBrowsedClusterGraphics()}async enableClusterBrowsing(){const{view:e,selectedFeature:t}=this;(e==null?void 0:e.type)==="2d"?T3(t)?(await Yst(this),await Zst(this)):yP.warn("enableClusterBrowsing:invalid-selectedFeature: Selected feature must represent an aggregate/cluster graphic.",t):yP.warn("enableClusterBrowsing:invalid-view: View must be 2d MapView.",t)}_animationStateChange(e){this.zoomToLocation||(H3.disabled=e==="waiting-for-target")}_clearBrowsedClusterGraphics(){var t;const e=(t=this.view)==null?void 0:t.graphics;e&&(e.remove(this.selectedClusterBoundaryFeature),e.remove(this._selectedClusterFeature)),this._selectedClusterFeature=null,this.selectedClusterBoundaryFeature.geometry=null}_viewScaleChange(){if(T3(this.selectedFeature))return this.browseClusterEnabled=!1,this.visible=!1,void this.clear();this.browseClusterEnabled&&(this.features=[this.selectedFeature])}_locationChange(e){const{selectedFeature:t,updateLocationEnabled:r}=this;r&&e&&(!t||t.geometry)&&this.centerAtLocation()}_selectedFeatureIndexChange(){this.featurePage=this.featureCount>1?Math.floor(this.selectedFeatureIndex/this.featuresPerPage)+1:null}_featureViewModelsChange(){this.featurePage=this.featureCount>1?1:null}_setGraphicOnFeatureViewModels(){const{features:e,featureCount:t,featurePage:r,featuresPerPage:i,featureViewModels:n}=this;if(r===null)return;const s=((r-1)*i+t)%t,a=s+i;n.slice(s,a).forEach((o,l)=>{o&&!o.graphic&&(o.graphic=e[s+l])})}async _selectedFeatureChange(e){if(!e)return;const{location:t,updateLocationEnabled:r,view:i}=this;if(this.browseClusterEnabled)return this._selectedClusterFeature&&(i.graphics.remove(this._selectedClusterFeature),this._selectedClusterFeature=null),T3(e)?void 0:(e.symbol=await $st(e),this._selectedClusterFeature=e,void i.graphics.add(this._selectedClusterFeature));!r&&t||!e.geometry?r&&!e.geometry&&this.centerAtLocation().then(()=>{this.location=i.center.clone()}):this.location=this._getPointFromGeometry(e.geometry)}_waitingForResultChange(){!this.featureCount&&this.promises&&(this.visible=!1)}_setFetchFeaturesPromises(e){return this._fetchFeaturesWithController(this._getScreenPoint(e||this.location)).then(t=>{const{clientOnlyGraphics:r,promisesPerLayerView:i}=t,n=Promise.resolve(r),s=i.map(a=>a.promise);this.promises=[n,...s]})}_destroyFeatureVMs(){this.featureViewModels.forEach(e=>e&&!e.destroyed&&e.destroy()),this._set("featureViewModels",[])}_updateFeatureVMs(){const{selectedFeature:e,features:t,featureViewModels:r}=this;if(T3(e)||(this.browseClusterEnabled=!1),this._destroyFeatureVMs(),!t||!t.length)return;const i=r.slice(0),n=[];t.forEach((s,a)=>{var l,c;if(!s)return;let o=null;if(i.some((u,h)=>(u&&u.graphic===s&&(o=u,i.splice(h,1)),!!o)),o)n[a]=o;else{const u=new Fne({abilities:this.featureViewModelAbilities,defaultPopupTemplateEnabled:this.defaultPopupTemplateEnabled,spatialReference:(l=this.view)==null?void 0:l.spatialReference,graphic:s===e?s:null,map:(c=this.view)==null?void 0:c.map,view:this.view});n[a]=u}}),i.forEach(s=>s&&!s.destroyed&&s.destroy()),this._set("featureViewModels",n)}_getScreenPoint(e){const{view:t}=this;return t&&e&&typeof t.toScreen=="function"?t.toScreen(e):null}_autoOpenEnabledChange(){const e="auto-fetch-features",{_handles:t,autoOpenEnabled:r}=this;if(t.remove(e),r&&this.view){const i=this.view.on("click",n=>{n.pointerType==="mouse"&&n.button!==0||this._fetchFeaturesAndOpen(n)},Lv.WIDGET);t.add(i,e)}}_cancelFetchingFeatures(){const e=this._fetchFeaturesController;e&&e.abort(),this._fetchFeaturesController=null,this.notifyChange("waitingForResult")}_fetchFeaturesWithController(e,t){this._cancelFetchingFeatures();const r=new AbortController,{signal:i}=r;this._fetchFeaturesController=r,this.notifyChange("waitingForResult");const n=this.fetchFeatures(e,{signal:i,event:t});return n.catch(()=>{}).then(()=>{this._fetchFeaturesController=null,this.notifyChange("waitingForResult")}),n}_fetchFeaturesAndOpen(e){const{screenPoint:t,mapPoint:r}=e,{view:i}=this;this._fetchFeaturesWithController(t,e).then(n=>{const{clientOnlyGraphics:s,promisesPerLayerView:a,location:o}=n,l=[Promise.resolve(s),...a.map(c=>c.promise)];return i.popup.open({location:o||r,promises:l}),n})}_updatePendingPromises(e){e&&this._pendingPromises.has(e)&&(this._pendingPromises.delete(e),this.notifyChange("pendingPromisesCount"))}_autoClose(){this.autoCloseEnabled&&(this.visible=!1)}_getPointFromGeometry(e){return R(e)?null:e.type==="point"?e:e.type==="extent"?e.center:e.type==="polygon"?e.centroid:e.type==="multipoint"||e.type==="polyline"?e.extent.center:null}async _getLayerView(e,t){return await e.when(),e.whenLayerView(t)}_getHighlightLayer(e){const{layer:t,sourceLayer:r}=e;return(r==null?void 0:r.type)==="map-notes"||(r==null?void 0:r.type)==="subtype-group"?r:t}_getHighlightTarget(e,t){const r=t.type==="imagery"?void 0:"objectIdField"in t&&t.objectIdField,i=e.attributes;return i&&r&&i[r]||e}async _highlightActiveFeature(){const e="highlight-active-feature";this._handles.remove(e);const{highlightEnabled:t,view:r,activeFeature:i,visible:n}=this;if(!(i&&r&&t&&n))return;const s=this._getHighlightLayer(i);if(!(s&&s instanceof U5))return;const a=this._getLayerView(r,s);this._highlightActiveFeaturePromise=a;const o=await a;if(!(o&&Sfe(o)&&this._highlightActiveFeaturePromise===a&&this.activeFeature&&this.highlightEnabled))return;const l=o.highlight(this._getHighlightTarget(i,s));this._handles.add(l,e)}async _highlightSelectedFeature(){const e="highlight-selected-feature";this._handles.remove(e);const{selectedFeature:t,highlightEnabled:r,view:i,visible:n}=this;if(!(t&&i&&r&&n))return;const s=this._getHighlightLayer(t);if(!(s&&s instanceof U5))return;const a=this._getLayerView(i,s);this._highlightSelectedFeaturePromise=a;const o=await a;if(!(o&&Sfe(o)&&this._highlightSelectedFeaturePromise===a&&this.selectedFeature&&this.highlightEnabled&&this.visible))return;const l=o.highlight(this._getHighlightTarget(t,s));this._handles.add(l,e)}_updateFeatures(e){const{features:t}=this;if(!e||!e.length)return;if(!t.length)return void(this.features=e);const r=e.filter(i=>!t.includes(i));this.features=t.concat(r)}};d([f()],Rr.prototype,"featurePage",void 0),d([f()],Rr.prototype,"isLoadingFeature",null),d([f({type:a7})],Rr.prototype,"actions",void 0),d([f({readOnly:!0})],Rr.prototype,"active",null),d([f()],Rr.prototype,"activeFeature",void 0),d([f({readOnly:!0})],Rr.prototype,"allActions",null),d([f({type:Boolean})],Rr.prototype,"defaultPopupTemplateEnabled",void 0),d([f()],Rr.prototype,"autoCloseEnabled",void 0),d([f()],Rr.prototype,"autoOpenEnabled",void 0),d([f()],Rr.prototype,"browseClusterEnabled",void 0),d([f()],Rr.prototype,"content",void 0),d([f({type:a7,readOnly:!0})],Rr.prototype,"defaultActions",null),d([f({readOnly:!0})],Rr.prototype,"featureCount",null),d([f()],Rr.prototype,"features",null),d([f()],Rr.prototype,"featuresPerPage",void 0),d([f()],Rr.prototype,"featureViewModelAbilities",void 0),d([f({readOnly:!0})],Rr.prototype,"featureViewModels",void 0),d([f()],Rr.prototype,"highlightEnabled",void 0),d([f()],Rr.prototype,"includeDefaultActions",void 0),d([f({type:ot})],Rr.prototype,"location",null),d([f({readOnly:!0})],Rr.prototype,"pendingPromisesCount",null),d([f({readOnly:!0})],Rr.prototype,"selectedClusterBoundaryFeature",void 0),d([f({readOnly:!0})],Rr.prototype,"waitingForResult",null),d([f({readOnly:!0})],Rr.prototype,"promiseCount",null),d([f()],Rr.prototype,"promises",null),d([f({value:null,readOnly:!0})],Rr.prototype,"selectedFeature",null),d([f({value:-1})],Rr.prototype,"selectedFeatureIndex",null),d([f({readOnly:!0})],Rr.prototype,"selectedFeatureViewModel",null),d([f({readOnly:!0})],Rr.prototype,"state",null),d([f()],Rr.prototype,"title",void 0),d([f()],Rr.prototype,"updateLocationEnabled",void 0),d([f()],Rr.prototype,"view",void 0),d([f()],Rr.prototype,"visible",void 0),d([f()],Rr.prototype,"zoomFactor",void 0),d([f()],Rr.prototype,"zoomToLocation",void 0),d([f()],Rr.prototype,"centerAtLocation",null),Rr=d([$(W8e)],Rr);const X8e=Rr,Cfe="selected-index",eat=0,Afe="popup-spinner",Pe={iconLeftTriangleArrow:"esri-icon-left-triangle-arrow",iconRightTriangleArrow:"esri-icon-right-triangle-arrow",iconDockToTop:"esri-icon-maximize",iconDockToBottom:"esri-icon-dock-bottom",iconDockToLeft:"esri-icon-dock-left",iconDockToRight:"esri-icon-dock-right",iconClose:"esri-icon-close",iconUndock:"esri-icon-minimize",iconCheckMark:"esri-icon-check-mark",iconLoading:"esri-icon-loading-indicator",iconDefaultAction:"esri-icon-default-action",iconActionsMenu:"esri-icon-handle-horizontal",rotating:"esri-rotating",base:"esri-popup",widget:"esri-widget",main:"esri-popup__main-container",loadingContainer:"esri-popup__loading-container",isCollapsible:"esri-popup--is-collapsible",isCollapsed:"esri-popup--is-collapsed",shadow:"esri-popup--shadow",isDocked:"esri-popup--is-docked",isDockedTopLeft:"esri-popup--is-docked-top-left",isDockedTopCenter:"esri-popup--is-docked-top-center",isDockedTopRight:"esri-popup--is-docked-top-right",isDockedBottomLeft:"esri-popup--is-docked-bottom-left",isDockedBottomCenter:"esri-popup--is-docked-bottom-center",isDockedBottomRight:"esri-popup--is-docked-bottom-right",alignTopCenter:"esri-popup--aligned-top-center",alignBottomCenter:"esri-popup--aligned-bottom-center",alignTopLeft:"esri-popup--aligned-top-left",alignBottomLeft:"esri-popup--aligned-bottom-left",alignTopRight:"esri-popup--aligned-top-right",alignBottomRight:"esri-popup--aligned-bottom-right",isFeatureMenuOpen:"esri-popup--feature-menu-open",isActionsMenuOpen:"esri-popup--actions-menu-open",hasFeatureUpdated:"esri-popup--feature-updated",header:"esri-popup__header",headerButtons:"esri-popup__header-buttons",headerContainer:"esri-popup__header-container",headerContainerButton:"esri-popup__header-container--button",headerTitle:"esri-popup__header-title",content:"esri-popup__content",footer:"esri-popup__footer",footerHasPagination:"esri-popup__footer--has-pagination",footerHasActions:"esri-popup__footer--has-actions",footerHasActionsMenu:"esri-popup__footer--has-actions-menu",button:"esri-popup__button",buttonDisabled:"esri-popup__button--disabled",buttonDock:"esri-popup__button--dock",icon:"esri-popup__icon",iconDock:"esri-popup__icon--dock-icon",inlineActionsContainer:"esri-popup__inline-actions-container",actionsMenuButton:"esri-popup__actions-menu-button",actions:"esri-popup__actions",action:"esri-popup__action",actionImage:"esri-popup__action-image",actionText:"esri-popup__action-text",actionToggle:"esri-popup__action-toggle",actionToggleOn:"esri-popup__action-toggle--on",pointer:"esri-popup__pointer",pointerDirection:"esri-popup__pointer-direction",navigation:"esri-popup__navigation",paginationPrevious:"esri-popup__pagination-previous",paginationNext:"esri-popup__pagination-next",paginationPreviousIconLTR:"esri-popup__pagination-previous-icon",paginationPreviousIconRTL:"esri-popup__pagination-previous-icon--rtl",paginationNextIconLTR:"esri-popup__pagination-next-icon",paginationNextIconRTL:"esri-popup__pagination-next-icon--rtl",featureMenu:"esri-popup__feature-menu",featureMenuList:"esri-popup__feature-menu-list",featureMenuItem:"esri-popup__feature-menu-item",featureMenuViewport:"esri-popup__feature-menu-viewport",featureMenuHeader:"esri-popup__feature-menu-header",featureMenuNote:"esri-popup__feature-menu-note",featureMenuSelected:"esri-popup__feature-menu-item--selected",featureMenuButton:"esri-popup__feature-menu-button",featureMenuTitle:"esri-popup__feature-menu-title",featureMenuObserver:"esri-popup__feature-menu-observer",featureMenuLoader:"esri-popup__feature-menu-loader",collapseButton:"esri-popup__collapse-button"},Rfe={buttonEnabled:!0,position:"auto",breakpoint:{width:544}},Ofe="esri-popup";function Um(e,t){return t===void 0?`${Ofe}__${e}`:`${Ofe}__${e}-${t}`}const Y8e="esri.widgets.Popup",Mfe=fe.getLogger(Y8e),Pfe={closeButton:!0,featureNavigation:!0};let Ct=class extends S8e(Bs){constructor(e,t){super(e,t),this._blurClose=!1,this._blurContainer=!1,this._containerNode=null,this._mainContainerNode=null,this._featureMenuNode=null,this._actionsMenuNode=null,this._focusClose=!1,this._focusContainer=!1,this._focusDockButton=!1,this._focusFeatureMenuButton=!1,this._focusActionsMenuButton=!1,this._focusFirstFeature=!1,this._focusFirstAction=!1,this._handles=new Ft,this._pointerOffsetInPx=16,this._spinner=null,this._feature=null,this._featureMenuIntersectionObserverCallback=([r])=>{r!=null&&r.isIntersecting&&this.viewModel.featurePage++},this._featureMenuIntersectionObserver=new IntersectionObserver(this._featureMenuIntersectionObserverCallback,{root:window.document}),this._displaySpinnerThrottled=vie(()=>this._displaySpinner(),eat),this.actions=null,this.alignment="auto",this.autoCloseEnabled=null,this.autoOpenEnabled=null,this.defaultPopupTemplateEnabled=null,this.content=null,this.collapsed=!1,this.collapseEnabled=!0,this.dockEnabled=!1,this.featureCount=null,this.featureMenuOpen=!1,this.features=null,this.goToOverride=null,this.headingLevel=2,this.highlightEnabled=null,this.location=null,this.label=void 0,this.maxInlineActions=3,this.messages=null,this.messagesCommon=null,this.promises=null,this.selectedFeature=null,this.selectedFeatureIndex=null,this.spinnerEnabled=!0,this.title=null,this.updateLocationEnabled=null,this.view=null,this.viewModel=new X8e,this.visible=null,this.visibleElements={...Pfe},this._addSelectedFeatureIndexHandle(),this.own([re(()=>{var r;return(r=this.viewModel)==null?void 0:r.screenLocation},()=>this._positionContainer()),re(()=>{var r;return[(r=this.viewModel)==null?void 0:r.active,this.dockEnabled]},()=>this._toggleScreenLocationEnabled()),re(()=>{var r;return(r=this.viewModel)==null?void 0:r.screenLocation},(r,i)=>{!!r!=!!i&&this.reposition()}),re(()=>{var r,i,n,s,a,o;return[(i=(r=this.viewModel)==null?void 0:r.view)==null?void 0:i.padding,(s=(n=this.viewModel)==null?void 0:n.view)==null?void 0:s.size,(a=this.viewModel)==null?void 0:a.active,(o=this.viewModel)==null?void 0:o.location,this.alignment]},()=>this.reposition()),re(()=>this.spinnerEnabled,r=>this._spinnerEnabledChange(r)),re(()=>{var r,i;return(i=(r=this.viewModel)==null?void 0:r.view)==null?void 0:i.size},(r,i)=>this._updateDockEnabledForViewSize(r,i)),re(()=>{var r;return(r=this.viewModel)==null?void 0:r.view},(r,i)=>this._viewChange(r,i)),re(()=>{var r,i;return(i=(r=this.viewModel)==null?void 0:r.view)==null?void 0:i.ready},(r,i)=>this._viewReadyChange(r,i)),re(()=>{var r,i;return[(r=this.viewModel)==null?void 0:r.waitingForResult,(i=this.viewModel)==null?void 0:i.location]},()=>{this._hideSpinner(),this._displaySpinnerThrottled()}),re(()=>{var r,i,n,s;return[(i=(r=this.selectedFeatureWidget)==null?void 0:r.viewModel)==null?void 0:i.title,(s=(n=this.selectedFeatureWidget)==null?void 0:n.viewModel)==null?void 0:s.state]},()=>this._setTitleFromFeatureWidget()),re(()=>{var r,i,n,s;return[(i=(r=this.selectedFeatureWidget)==null?void 0:r.viewModel)==null?void 0:i.content,(s=(n=this.selectedFeatureWidget)==null?void 0:n.viewModel)==null?void 0:s.state]},()=>this._setContentFromFeatureWidget()),Fa(()=>!this.collapsed,()=>{var r,i;((i=(r=this.viewModel)==null?void 0:r.view)==null?void 0:i.widthBreakpoint)==="xsmall"&&this.viewModel.active&&this.collapseEnabled&&this.viewModel.centerAtLocation()}),rn(()=>{var r;return(r=this.viewModel)==null?void 0:r.allActions},"change",()=>this._watchActions()),re(()=>{var r;return(r=this.viewModel)==null?void 0:r.allActions},()=>this._watchActions(),Ot),re(()=>{var r;return(r=this.viewModel)==null?void 0:r.featureViewModels},()=>this._featureMenuViewportScrollTop())])}destroy(){var e,t;this._destroySelectedFeatureWidget(),this._destroySpinner(),(e=this._handles)==null||e.destroy(),this._unobserveFeatureMenuObserver(),(t=this._featureMenuIntersectionObserver)==null||t.disconnect(),this._handles=null}get actionsMenuId(){return`${this.id}-actions-menu`}get actionsMenuButtonId(){return`${this.id}-actions-menu-button`}get featureMenuId(){return`${this.id}-feature-menu`}get titleId(){return`${this.id}-popup-title`}get contentId(){return`${this.id}-popup-content`}get hasContent(){var e,t,r,i,n,s,a;return!!(this.selectedFeatureWidget?((t=(e=this.selectedFeatureWidget)==null?void 0:e.viewModel)==null?void 0:t.waitingForContent)||((i=(r=this.selectedFeatureWidget)==null?void 0:r.viewModel)==null?void 0:i.state)==="error"||((s=(n=this.selectedFeatureWidget)==null?void 0:n.viewModel)==null?void 0:s.content):(a=this.viewModel)==null?void 0:a.content)}get featureNavigationVisible(){return this.viewModel.active&&this.viewModel.featureCount>1&&this.visibleElements.featureNavigation}get collapsible(){return!!(this.collapseEnabled&&this.viewModel.title&&this.hasContent)}get featureMenuVisible(){return this.featureNavigationVisible&&this.featureMenuOpen}get contentCollapsed(){return this.collapsible&&!this.featureMenuVisible&&this.collapsed}get dividedActions(){return this._divideActions()}set actionsMenuOpen(e){this._set("actionsMenuOpen",!!e)}get actionsMenuOpen(){return!!this.viewModel.active&&this._get("actionsMenuOpen")}get currentAlignment(){return this._getCurrentAlignment()}get currentDockPosition(){return this._getCurrentDockPosition()}get dockOptions(){return this._get("dockOptions")||Rfe}set dockOptions(e){const t={...Rfe},r=this.get("viewModel.view.breakpoints"),i={};r&&(i.width=r.xsmall,i.height=r.xsmall);const n={...t,...e},s={...t.breakpoint,...i},{breakpoint:a}=n;a===!0?n.breakpoint=s:typeof a=="object"&&(n.breakpoint={...s,...a}),this._set("dockOptions",n),this._setCurrentDockPosition(),this.reposition()}get selectedFeatureWidget(){const{_feature:e,visibleElements:t,headingLevel:r}=this,{selectedFeatureViewModel:i}=this.viewModel,n={...t,title:!1};return i?(e?(e.viewModel=i,e.visibleElements=n):this._feature=new Snt({headingLevel:r+1,viewModel:i,visibleElements:n}),this._feature):null}castVisibleElements(e){return{...Pfe,...e}}blur(){const{active:e}=this.viewModel;e||Mfe.warn("Popup can only be blurred when currently active."),this.visibleElements.closeButton?this._blurClose=!0:this._blurContainer=!0,this.scheduleRender()}clear(){this.viewModel.clear()}close(){this.visible=!1}fetchFeatures(e,t){return this.viewModel.fetchFeatures(e,t)}focus(){const{active:e}=this.viewModel;e||Mfe.warn("Popup can only be focused when currently active."),this.visibleElements.closeButton?this._focusClose=!0:this._focusContainer=!0,this.scheduleRender()}next(){return this.viewModel.next()}open(e){var n,s;this._handles.remove(Cfe);const t=!!e&&!!e.featureMenuOpen,r=!!e&&!!e.actionsMenuOpen,i={collapsed:!!e&&!!e.collapsed,actionsMenuOpen:r,featureMenuOpen:t};((s=(n=this.viewModel)==null?void 0:n.view)==null?void 0:s.widthBreakpoint)==="xsmall"&&(i.collapsed=!0),this.set(i),this.viewModel.open(e),this._shouldFocus(e),this._addSelectedFeatureIndexHandle()}previous(){return this.viewModel.previous()}reposition(){this.renderNow(),this._positionContainer(),this._setCurrentAlignment()}triggerAction(e){this.viewModel.triggerAction(e)}render(){var g,b,w,v;const{actionsMenuOpen:e,dockEnabled:t,featureMenuVisible:r,dividedActions:i,currentAlignment:n,currentDockPosition:s}=this,{active:a}=this.viewModel,{menuActions:o}=i,l=a&&o.length>1&&e,c=a&&t,u=a&&!t,h=(b=(g=this.selectedFeature)==null?void 0:g.layer)==null?void 0:b.title,p=(v=(w=this.selectedFeature)==null?void 0:w.layer)==null?void 0:v.id,m={[Pe.alignTopCenter]:n==="top-center",[Pe.alignBottomCenter]:n==="bottom-center",[Pe.alignTopLeft]:n==="top-left",[Pe.alignBottomLeft]:n==="bottom-left",[Pe.alignTopRight]:n==="top-right",[Pe.alignBottomRight]:n==="bottom-right",[Pe.isDocked]:c,[Pe.shadow]:u,[Pe.isDockedTopLeft]:s==="top-left",[Pe.isDockedTopCenter]:s==="top-center",[Pe.isDockedTopRight]:s==="top-right",[Pe.isDockedBottomLeft]:s==="bottom-left",[Pe.isDockedBottomCenter]:s==="bottom-center",[Pe.isDockedBottomRight]:s==="bottom-right",[Pe.isFeatureMenuOpen]:r,[Pe.isActionsMenuOpen]:l};return z("div",{class:this.classes(Pe.base,m),role:"presentation","data-layer-title":h,"data-layer-id":p,bind:this,afterCreate:this._positionContainer,afterUpdate:this._positionContainer},a?[this.renderMainContainer(),this.renderPointer()]:null)}renderLoadingIcon(){return z("span",{"aria-hidden":"true",class:this.classes(Pe.icon,Pe.iconLoading,Pe.rotating)})}renderNavigationLoading(){const{messagesCommon:e}=this;return this.viewModel.pendingPromisesCount?z("div",{key:Um("loading-container"),role:"presentation",class:Pe.loadingContainer,"aria-label":e.loading,title:e.loading},this.renderLoadingIcon()):null}renderPreviousIcon(){const e=gp(this.container),t={[Pe.iconRightTriangleArrow]:e,[Pe.paginationPreviousIconRTL]:e,[Pe.iconLeftTriangleArrow]:!e,[Pe.paginationPreviousIconLTR]:!e};return z("span",{"aria-hidden":"true",class:this.classes(Pe.icon,t)})}renderPreviousButton(){const{messages:e}=this;return z("div",{role:"button",tabIndex:0,bind:this,onclick:this._previous,onkeydown:this._previous,class:this.classes(Pe.button,Pe.paginationPrevious),"aria-label":e.previous,title:e.previous},this.renderPreviousIcon())}renderNextIcon(){const e=gp(this.container),t={[Pe.iconLeftTriangleArrow]:e,[Pe.paginationNextIconRTL]:e,[Pe.iconRightTriangleArrow]:!e,[Pe.paginationNextIconLTR]:!e};return z("span",{"aria-hidden":"true",class:this.classes(Pe.icon,t)})}renderNextButton(){const{messages:e}=this;return z("div",{role:"button",tabIndex:0,bind:this,onclick:this._next,onkeydown:this._next,class:this.classes(Pe.button,Pe.paginationNext),"aria-label":e.next,title:e.next},this.renderNextIcon())}renderFeatureMenuButton(){const{featureMenuOpen:e,featureMenuId:t,messagesCommon:r}=this,{featureCount:i,selectedFeatureIndex:n}=this.viewModel;return z("div",{role:"button",tabIndex:0,bind:this,onclick:this._toggleFeatureMenu,onkeydown:this._toggleFeatureMenu,afterCreate:this._focusFeatureMenuButtonNode,afterUpdate:this._focusFeatureMenuButtonNode,class:this.classes(Pe.button,Pe.featureMenuButton),"aria-haspopup":"true","aria-controls":t,"aria-expanded":e.toString(),"aria-label":r.menu,title:r.menu},this._getPageText(i,n))}renderNavigationButtons(){return this.featureNavigationVisible?[this.renderPreviousButton(),this.renderNavigationLoading()||this.renderFeatureMenuButton(),this.renderNextButton()]:null}renderDockIcon(){const{dockEnabled:e}=this,t=this._wouldDockTo(),r={[Pe.iconUndock]:e,[Pe.iconDock]:!e,[Pe.iconDockToRight]:!e&&(t==="top-right"||t==="bottom-right"),[Pe.iconDockToLeft]:!e&&(t==="top-left"||t==="bottom-left"),[Pe.iconDockToTop]:!e&&t==="top-center",[Pe.iconDockToBottom]:!e&&t==="bottom-center"};return z("span",{"aria-hidden":"true",class:this.classes(r,Pe.icon)})}renderDockButton(){var n,s,a;const{dockEnabled:e,messages:t}=this,r=(s=(n=this.viewModel)==null?void 0:n.view)==null?void 0:s.widthBreakpoint,i=e?t.undock:t.dock;return r!=="xsmall"&&((a=this.dockOptions)==null?void 0:a.buttonEnabled)?z("div",{role:"button","aria-label":i,title:i,tabIndex:0,bind:this,onclick:this._toggleDockEnabled,onkeydown:this._toggleDockEnabled,afterCreate:this._focusDockButtonNode,afterUpdate:this._focusDockButtonNode,class:this.classes(Pe.button,Pe.buttonDock)},this.renderDockIcon()):null}renderTitle(){const{title:e}=this.viewModel,{titleId:t,collapsible:r,contentCollapsed:i,messagesCommon:n}=this,s={[Pe.headerContainerButton]:r},a=z(Pv,{level:this.headingLevel,class:Pe.headerTitle,innerHTML:e}),o=r?z("button",{key:`${e}--collapsible`,id:t,title:i?n.expand:n.collapse,bind:this,enterAnimation:this._createFeatureUpdatedAnimation(),class:this.classes(Pe.headerContainer,s),"aria-expanded":i?"false":"true",onclick:this._toggleCollapsed,type:"button"},a):z("div",{key:e,id:t,bind:this,enterAnimation:this._createFeatureUpdatedAnimation(),class:this.classes(Pe.headerContainer,s)},a);return e?o:null}renderCloseIcon(){return z("span",{"aria-hidden":"true",class:this.classes(Pe.icon,Pe.iconClose)})}renderCloseButton(){const{visibleElements:e,messagesCommon:t}=this;return e.closeButton?z("div",{role:"button",tabIndex:0,bind:this,onclick:this._close,onkeydown:this._close,class:Pe.button,"aria-label":t.close,title:t.close,afterCreate:this._closeButtonNodeUpdated,afterUpdate:this._closeButtonNodeUpdated},this.renderCloseIcon()):null}renderHeader(){return z("header",{class:Pe.header},this.renderTitle(),z("div",{class:Pe.headerButtons},this.renderDockButton(),this.renderCloseButton()))}renderContentContainer(){const{contentId:e,hasContent:t,contentCollapsed:r}=this,{content:i}=this.viewModel;return t&&!r?z("article",{key:i,enterAnimation:this._createFeatureUpdatedAnimation(),id:e,class:Pe.content},this.renderContent()):null}renderActionsMenuButton(){const{actionsMenuId:e,actionsMenuButtonId:t,actionsMenuOpen:r,dividedActions:i,messagesCommon:n}=this,s=r?n.close:n.open,{menuActions:a}=i;return a.length?z("div",{key:Um("actions-menu-button"),class:this.classes(Pe.button,Pe.actionsMenuButton),role:"button",id:t,"aria-haspopup":"true","aria-controls":r?e:null,tabIndex:0,bind:this,onclick:this._toggleActionsMenu,onkeydown:this._toggleActionsMenu,afterCreate:this._focusActionsMenuButtonNode,afterUpdate:this._focusActionsMenuButtonNode,"aria-label":s,title:s},z("span",{"aria-hidden":"true",class:Pe.iconActionsMenu})):null}renderMenuActions(){const{actionsMenuId:e,actionsMenuButtonId:t,actionsMenuOpen:r,dividedActions:i}=this,{menuActions:n}=i;return n.length&&r?z("ul",{id:e,role:"menu","aria-labelledby":t,key:Um("actions"),class:Pe.actions,bind:this,onkeyup:this._handleActionMenuKeyup,afterCreate:this._actionsMenuNodeUpdated,afterUpdate:this._actionsMenuNodeUpdated},n.toArray().map(s=>this.renderAction({action:s,type:"menu-item"}))):null}renderInlineActions(){const{inlineActions:e}=this.dividedActions;return!!e.length&&e.toArray().map(t=>this.renderAction({action:t,type:"inline"}))}renderInlineActionsContainer(){const{inlineActions:e,menuActions:t}=this.dividedActions,r=!!e.length,i=!!t.length;return r||i?z("div",{key:"inline-actions-container","data-inline-actions":r.toString(),"data-menu-actions":i.toString(),class:Pe.inlineActionsContainer},this.renderInlineActions(),this.renderActionsMenuButton(),this.renderMenuActions()):null}renderNavigation(){return this.featureNavigationVisible?z("section",{key:Um("navigation"),class:this.classes(Pe.navigation)},this.renderNavigationButtons()):null}renderFooter(){const{featureNavigationVisible:e,dividedActions:t}=this,{inlineActions:r,menuActions:i}=t,n=!!r.length,s=!!i.length,a={[Pe.footerHasPagination]:e,[Pe.footerHasActions]:n,[Pe.footerHasActionsMenu]:s};return e||n?z("div",{key:Um("feature-buttons"),class:this.classes(Pe.footer,a)},this.renderInlineActionsContainer(),this.renderNavigation()):null}renderFeatureMenuContainer(){const{messages:e}=this,{featureViewModels:t,isLoadingFeature:r}=this.viewModel,i=fh(e.selectedFeatures,{total:t.length});return z("section",{key:Um("menu"),class:Pe.featureMenu},z("strong",{class:Pe.featureMenuHeader},i),z("nav",{bind:this,class:Pe.featureMenuViewport,"data-node-ref":"_featureMenuViewportNode",afterCreate:pZ},this.renderFeatureMenu(),z("div",{class:Pe.featureMenuObserver,bind:this,afterCreate:this._featureMenuIntersectionObserverCreated}),r?z("div",{class:Pe.featureMenuLoader},this.renderLoadingIcon()):null))}renderPointer(){return this.dockEnabled?null:z("div",{key:Um("pointer"),class:Pe.pointer,role:"presentation"},z("div",{class:this.classes(Pe.pointerDirection,Pe.shadow)}))}renderMainContainer(){const{dockEnabled:e,currentAlignment:t,currentDockPosition:r,titleId:i,contentId:n,collapsible:s,hasContent:a,contentCollapsed:o,visibleElements:l}=this,{title:c}=this.viewModel,u=t==="bottom-left"||t==="bottom-center"||t==="bottom-right"||r==="top-left"||r==="top-center"||r==="top-right",h=t==="top-left"||t==="top-center"||t==="top-right"||r==="bottom-left"||r==="bottom-center"||r==="bottom-right",p={[Pe.shadow]:e,[Pe.isCollapsible]:s,[Pe.isCollapsed]:o};return z("div",{class:this.classes(Pe.main,Pe.widget,p),tabIndex:l.closeButton?null:-1,role:"dialog","aria-labelledby":c?i:"","aria-describedby":a&&!o?n:"",bind:this,onkeyup:this._handleMainKeyup,afterCreate:this._mainContainerNodeUpdated,afterUpdate:this._mainContainerNodeUpdated},u?this.renderFooter():null,u?this.renderFeatureMenuContainer():null,this.renderHeader(),this.renderContentContainer(),h?this.renderFooter():null,h?this.renderFeatureMenuContainer():null)}renderContent(){var t;const e=(t=this.viewModel)==null?void 0:t.content;return e?typeof e=="string"?z("div",{key:e,innerHTML:e}):this.renderNodeContent(e):null}renderActionText(e){return z("span",{key:"text",class:Pe.actionText},e)}renderActionIcon(e){const t=this._getActionClass(e),r=this._getActionImage(e),i={[Pe.iconLoading]:e.active,[Pe.rotating]:e.active,[Pe.icon]:!!t,[Pe.actionImage]:!e.active&&!!r};return t&&(i[t]=!e.active),z("span",{key:"icon","aria-hidden":"true",class:this.classes(Pe.icon,i),styles:this._getIconStyles(r)})}renderAction(e){const{action:t,type:r}=e,i=this._getActionTitle(t),n={[Pe.action]:t.type!=="toggle",[Pe.actionToggle]:t.type==="toggle",[Pe.actionToggleOn]:t.type==="toggle"&&t.value,[Pe.buttonDisabled]:t.disabled},s=[this.renderActionIcon(t),this.renderActionText(i)],a=r==="menu-item"?z("li",{key:t.uid,role:"menuitem",tabIndex:0,title:i,"aria-label":i,class:this.classes(Pe.button,n),onkeyup:this._handleActionMenuItemKeyup,bind:this,"data-action-uid":t.uid,onclick:this._triggerAction,onkeydown:this._triggerAction},s):z("div",{key:t.uid,role:"button",tabIndex:0,title:i,"aria-label":i,class:this.classes(Pe.button,n),onkeyup:this._handleActionMenuItemKeyup,bind:this,"data-action-uid":t.uid,onclick:this._triggerAction,onkeydown:this._triggerAction},s);return t.visible?a:null}renderFeatureMenuItem(e,t){const{messages:r,messagesCommon:i}=this,{selectedFeatureIndex:n,selectedFeatureViewModel:s}=this.viewModel,a=e===s,o={[Pe.featureMenuSelected]:a},l=a?z("span",{key:Um(`feature-menu-selected-feature-${n}`),title:r.selectedFeature,"aria-label":r.selectedFeature,class:Pe.iconCheckMark}):null,c=z("span",{innerHTML:e.title||i.untitled});return z("li",{role:"menuitem",tabIndex:-1,key:Um(`feature-menu-feature-${n}`),class:this.classes(o,Pe.featureMenuItem),bind:this,"data-feature-index":t,onblur:this._removeActiveFeature,onfocus:this._setActiveFeature,onkeyup:this._handleFeatureMenuItemKeyup,onclick:this._selectFeature,onkeydown:this._selectFeature,onmouseover:this._setActiveFeature,onmouseleave:this._removeActiveFeature},z("span",{class:Pe.featureMenuTitle},c,l))}renderFeatureMenu(){const{featureMenuId:e}=this,{featureViewModels:t}=this.viewModel;return t.length>1?z("ol",{class:Pe.featureMenuList,id:e,bind:this,afterCreate:this._featureMenuNodeUpdated,afterUpdate:this._featureMenuNodeUpdated,onkeyup:this._handleFeatureMenuKeyup,role:"menu"},t.filter(r=>!!r.graphic).map((r,i)=>this.renderFeatureMenuItem(r,i))):null}_getActionTitle(e){const{messages:t,selectedFeature:r,messagesCommon:i}=this,{id:n}=e,s=r==null?void 0:r.attributes,a=n==="zoom-to-feature"?fh(e.title,{messages:t}):n==="remove-selected-feature"?fh(e.title,{messages:i}):n==="zoom-to-clustered-features"||n==="browse-clustered-features"?fh(e.title,{messages:t}):e.title;return a&&s?fh(a,s):a}_getActionClass(e){const{selectedFeature:t}=this,r=t==null?void 0:t.attributes,{className:i,image:n}=e,s=n||i?i:Pe.iconDefaultAction;return s&&r?fh(s,r):s}_getActionImage(e){const{selectedFeature:t}=this,r=t==null?void 0:t.attributes,{image:i}=e;return i&&r?fh(i,r):i}_createFeatureUpdatedAnimation(){return vWe("enter",Pe.hasFeatureUpdated)}_getInlineActionCount(){const{maxInlineActions:e,featureNavigationVisible:t}=this;if(typeof e!="number")return null;const r=Math.round(e);return Math.max(t?r-1:r,0)}_watchActions(){const{allActions:e}=this.viewModel;this.notifyChange("dividedActions");const t="actions";this._handles.remove(t),e&&e.forEach(r=>{this._handles.add(re(()=>[r.uid,r.active,r.className,r.disabled,r.id,r.title,r.image,r.visible],()=>this.scheduleRender()),t)})}_divideActions(){const{allActions:e}=this.viewModel,t=e.filter(s=>s.visible),r=this._getInlineActionCount(),i=r===null,n=r===0;return{inlineActions:i?t.slice(0):n?new lt:t.slice(0,r),menuActions:i?new lt:n?t.slice(0):t.slice(r)}}_featureMenuOpenChanged(e){e?this._focusFirstFeature=!0:this._focusFeatureMenuButton=!0}_actionsMenuOpenChanged(e){e?this._focusFirstAction=!0:this._focusActionsMenuButton=!0}_setTitleFromFeatureWidget(){var r,i;const{selectedFeatureWidget:e,messagesCommon:t}=this;e&&(this.viewModel.title=((r=e.viewModel)==null?void 0:r.state)==="error"?t.errorMessage:((i=e.viewModel)==null?void 0:i.title)||"")}_setContentFromFeatureWidget(){const{selectedFeatureWidget:e}=this;e&&(this.viewModel.content=e)}_unobserveFeatureMenuObserver(){this._featureMenuIntersectionObserverNode&&this._featureMenuIntersectionObserver.unobserve(this._featureMenuIntersectionObserverNode)}_featureMenuIntersectionObserverCreated(e){this._unobserveFeatureMenuObserver(),this._featureMenuIntersectionObserver.observe(e),this._featureMenuIntersectionObserverNode=e}_handleFeatureMenuKeyup(e){p3(e)==="Escape"&&(e.stopPropagation(),this._focusFeatureMenuButton=!0,this.featureMenuOpen=!1,this.scheduleRender())}_handleActionMenuKeyup(e){p3(e)==="Escape"&&(e.stopPropagation(),this._focusActionsMenuButton=!0,this.actionsMenuOpen=!1,this.scheduleRender())}_setActiveFeature(e){const{viewModel:t}=this,r=e.currentTarget["data-feature-index"];t.activeFeature=t.features[r]||null}_removeActiveFeature(){this.viewModel.activeFeature=null}_handleFeatureMenuItemKeyup(e){const t=p3(e),{_featureMenuNode:r}=this,i=e.currentTarget["data-feature-index"];if(!r)return;const n=r.querySelectorAll("li"),s=n.length;t!=="ArrowUp"?t!=="ArrowDown"?t!=="Home"?t!=="End"||(e.stopPropagation(),n[n.length-1].focus()):(e.stopPropagation(),n[0].focus()):(e.stopPropagation(),n[(i+1+s)%s].focus()):(e.stopPropagation(),n[(i-1+s)%s].focus())}_handleActionMenuItemKeyup(e){const t=p3(e),{_actionsMenuNode:r}=this,i=e.currentTarget.dataset.actionUid,{menuActions:n}=this.dividedActions,s=n.findIndex(l=>l.uid===i);if(!r)return;const a=r.querySelectorAll("li"),o=a.length;t!=="ArrowUp"?t!=="ArrowDown"?t!=="Home"?t!=="End"||(e.stopPropagation(),a[a.length-1].focus()):(e.stopPropagation(),a[0].focus()):(e.stopPropagation(),a[(s+1+o)%o].focus()):(e.stopPropagation(),a[(s-1+o)%o].focus())}_handleMainKeyup(e){const t=p3(e);t==="ArrowLeft"&&(e.stopPropagation(),this.previous()),t==="ArrowRight"&&(e.stopPropagation(),this.next())}_spinnerEnabledChange(e){if(this._destroySpinner(),!e)return;const t=this.get("viewModel.view");this._createSpinner(t)}_hideSpinner(){const{_spinner:e}=this;e&&(e.location=null,e.hide())}_displaySpinner(){const{_spinner:e}=this;if(!e)return;const{location:t,waitingForResult:r}=this.viewModel;r?e.show({location:t}):e.hide()}_getIconStyles(e){return{"background-image":e?`url(${e})`:""}}async _shouldFocus(e){e.shouldFocus&&(await td(()=>{var t;return((t=this.viewModel)==null?void 0:t.active)===!0}),this.focus())}_addSelectedFeatureIndexHandle(){const e=re(()=>{var t;return(t=this.viewModel)==null?void 0:t.selectedFeatureIndex},(t,r)=>this._selectedFeatureIndexUpdated(t,r));this._handles.add(e,Cfe)}_selectedFeatureIndexUpdated(e,t){const{featureCount:r}=this;r&&e!==t&&e!==-1&&(this.actionsMenuOpen=!1,this.featureMenuOpen=!1)}_destroySelectedFeatureWidget(){const{_feature:e}=this;e&&(e.viewModel=null,e&&!e.destroyed&&e.destroy()),this._feature=null}_isScreenLocationWithinView(e,t){return e.x>-1&&e.y>-1&&e.x<=t.width&&e.y<=t.height}_isOutsideView(e){const{popupHeight:t,popupWidth:r,screenLocation:i,side:n,view:s}=e;if(isNaN(r)||isNaN(t)||!s||!i)return!1;const a=s.padding;return n==="right"&&i.x+r/2>s.width-a.right||n==="left"&&i.x-r/2<a.left||n==="top"&&i.y-t<a.top||n==="bottom"&&i.y+t>s.height-a.bottom}_calculateAutoAlignment(e){if(e!=="auto")return e;const{_pointerOffsetInPx:t,_containerNode:r,_mainContainerNode:i,viewModel:n}=this,{screenLocation:s,view:a}=n;if(R(s)||!a||!r)return"top-center";if(!this._isScreenLocationWithinView(s,a))return this._get("currentAlignment")||"top-center";function o(T){return parseInt(T.replace(/[^-\d\.]/g,""),10)}const l=i?window.getComputedStyle(i,null):null,c=l?o(l.getPropertyValue("max-height")):0,u=l?o(l.getPropertyValue("height")):0,{height:h,width:p}=r.getBoundingClientRect(),m=p+t,g=Math.max(h,c,u)+t,b=this._isOutsideView({popupHeight:g,popupWidth:m,screenLocation:s,side:"right",view:a}),w=this._isOutsideView({popupHeight:g,popupWidth:m,screenLocation:s,side:"left",view:a}),v=this._isOutsideView({popupHeight:g,popupWidth:m,screenLocation:s,side:"top",view:a}),x=this._isOutsideView({popupHeight:g,popupWidth:m,screenLocation:s,side:"bottom",view:a});return w?v?"bottom-right":"top-right":b?v?"bottom-left":"top-left":v?x?"top-center":"bottom-center":"top-center"}_callCurrentAlignment(e){return typeof e=="function"?e.call(this):e}_getCurrentAlignment(){const{alignment:e,dockEnabled:t}=this;return t||!this.viewModel.active?null:this._calculatePositionResult(this._calculateAutoAlignment(this._callCurrentAlignment(e)))}_setCurrentAlignment(){this._set("currentAlignment",this._getCurrentAlignment())}_setCurrentDockPosition(){this._set("currentDockPosition",this._getCurrentDockPosition())}_calculatePositionResult(e){const t=["left","right"];return gp(this.container)&&t.reverse(),e.replace(/leading/gi,t[0]).replace(/trailing/gi,t[1])}_callDockPosition(e){return typeof e=="function"?e.call(this):e}_getDockPosition(){var e;return this._calculatePositionResult(this._calculateAutoDockPosition(this._callDockPosition((e=this.dockOptions)==null?void 0:e.position)))}_getCurrentDockPosition(){return this.dockEnabled&&this.viewModel.active?this._getDockPosition():null}_wouldDockTo(){return this.dockEnabled?null:this._getDockPosition()}_calculateAutoDockPosition(e){var a;if(e!=="auto")return e;const t=(a=this.viewModel)==null?void 0:a.view,r=gp(this.container)?"top-left":"top-right";if(!t)return r;const i=t.padding||{left:0,right:0,top:0,bottom:0},n=t.width-i.left-i.right,{breakpoints:s}=t;return s&&n<=s.xsmall?"bottom-center":r}_positionContainer(e=this._containerNode){if(e&&(this._containerNode=e),!e)return;const{screenLocation:t}=this.viewModel,{width:r}=e.getBoundingClientRect(),i=this._calculatePositionStyle(t,r);i&&(e.style.top=i.top,e.style.left=i.left,e.style.bottom=i.bottom,e.style.right=i.right)}_calculateFullWidth(e){const{currentAlignment:t,_pointerOffsetInPx:r}=this;return t==="top-left"||t==="bottom-left"||t==="top-right"||t==="bottom-right"?e+r:e}_calculateAlignmentPosition(e,t,r,i){const{currentAlignment:n,_pointerOffsetInPx:s}=this,a=i/2,o=r.height-t,l=r.width-e,{padding:c}=this.view;return n==="bottom-center"?{top:t+s-c.top,left:e-a-c.left}:n==="top-left"?{bottom:o+s-c.bottom,right:l+s-c.right}:n==="bottom-left"?{top:t+s-c.top,right:l+s-c.right}:n==="top-right"?{bottom:o+s-c.bottom,left:e+s-c.left}:n==="bottom-right"?{top:t+s-c.top,left:e+s-c.left}:n==="top-center"?{bottom:o+s-c.bottom,left:e-a-c.left}:void 0}_calculatePositionStyle(e,t){const{dockEnabled:r,view:i}=this;if(!i)return;if(r)return{left:"",top:"",right:"",bottom:""};if(R(e)||!t)return;const n=this._calculateFullWidth(t),s=this._calculateAlignmentPosition(e.x,e.y,i,n);return s?{top:s.top!==void 0?`${s.top}px`:"auto",left:s.left!==void 0?`${s.left}px`:"auto",bottom:s.bottom!==void 0?`${s.bottom}px`:"auto",right:s.right!==void 0?`${s.right}px`:"auto"}:void 0}_viewChange(e,t){e&&t&&(this.close(),this.clear())}_viewReadyChange(e,t){if(e){const r=this.get("viewModel.view");this._wireUpView(r)}else t&&(this.close(),this.clear())}_wireUpView(e){if(this._destroySpinner(),!e)return;const{spinnerEnabled:t}=this;t&&this._createSpinner(e),this._setDockEnabledForViewSize(this.dockOptions)}_dockingThresholdCrossed(e,t,r){const[i,n]=e,[s,a]=t,{width:o,height:l}=r;return i<=o&&s>o||i>o&&s<=o||n<=l&&a>l||n>l&&a<=l}_updateDockEnabledForViewSize(e,t){if(!e||!t)return;const r=this.get("viewModel.view.padding")||{left:0,right:0,top:0,bottom:0},i=r.left+r.right,n=r.top+r.bottom,s=[],a=[];s[0]=e[0]-i,s[1]=e[1]-n,a[0]=t[0]-i,a[1]=t[1]-n;const{dockOptions:o}=this,l=o.breakpoint;this._dockingThresholdCrossed(s,a,l)&&this._setDockEnabledForViewSize(o),this._setCurrentDockPosition()}_focusDockButtonNode(e){this._focusDockButton&&(this._focusDockButton=!1,e.focus())}_closeButtonNodeUpdated(e){return this._focusClose?(this._focusClose=!1,void e.focus()):this._blurClose?(this._blurClose=!1,void e.blur()):void 0}_mainContainerNodeUpdated(e){return this._mainContainerNode=e,this._focusContainer?(this._focusContainer=!1,void e.focus()):this._blurContainer?(this._blurContainer=!1,void e.blur()):void 0}_featureMenuNodeUpdated(e){if(this._featureMenuNode=e,!e||!this._focusFirstFeature)return;this._focusFirstFeature=!1;const t=e.querySelectorAll("li");t.length&&t[0].focus()}_actionsMenuNodeUpdated(e){if(this._actionsMenuNode=e,!e||!this._focusFirstAction)return;this._focusFirstAction=!1;const t=e.querySelectorAll("li");t.length&&t[0].focus()}_focusFeatureMenuButtonNode(e){this._focusFeatureMenuButton&&(this._focusFeatureMenuButton=!1,e.focus())}_focusActionsMenuButtonNode(e){this._focusActionsMenuButton&&(this._focusActionsMenuButton=!1,e.focus())}_featureMenuViewportScrollTop(){this._featureMenuViewportNode&&(this._featureMenuViewportNode.scrollTop=0)}_toggleScreenLocationEnabled(){const{dockEnabled:e,viewModel:t}=this;if(!t)return;const r=t.active&&!e;t.screenLocationEnabled=r}_shouldDockAtCurrentViewSize(e){var o,l;const t=e.breakpoint,r=(l=(o=this.viewModel)==null?void 0:o.view)==null?void 0:l.ui;if(!r)return!1;const{width:i,height:n}=r;if(isNaN(i)||isNaN(n))return!1;const s=t.hasOwnProperty("width")&&i<=t.width,a=t.hasOwnProperty("height")&&n<=t.height;return s||a}_setDockEnabledForViewSize(e){e.breakpoint&&(this.dockEnabled=this._shouldDockAtCurrentViewSize(e))}_getPageText(e,t){return this.featureNavigationVisible?fh(this.messages.pageText,{index:t+1,total:e}):null}_destroySpinner(){const{_spinner:e,view:t}=this;e&&(t&&t.ui&&t.ui.remove(this._spinner,Afe),e.destroy(),this._spinner=null)}_createSpinner(e){e&&(this._spinner=new Cnt({view:e}),e.ui.add(this._spinner,{key:Afe,position:"manual"}))}_toggleCollapsed(){this.collapsed=!this.collapsed}_close(){this.close(),this.view&&this.view.focus()}_toggleDockEnabled(){this.dockEnabled=!this.dockEnabled,this._focusDockButton=!0,this.scheduleRender()}_toggleFeatureMenu(){const e=!this.featureMenuOpen;this._featureMenuOpenChanged(e),this.actionsMenuOpen=!1,this.featureMenuOpen=e}_toggleActionsMenu(){const e=!this.actionsMenuOpen;this._actionsMenuOpenChanged(e),this.featureMenuOpen=!1,this.actionsMenuOpen=e}_triggerAction(e){const t=e.currentTarget.dataset.actionUid,{allActions:r}=this.viewModel,i=r.findIndex(s=>s.uid===t),n=r.getItemAt(i);n&&n.type==="toggle"&&(n.value=!n.value),this.actionsMenuOpen=!1,this.viewModel.triggerAction(i)}_selectFeature(e){const t=e.currentTarget["data-feature-index"];isNaN(t)||(this.viewModel.selectedFeatureIndex=t),this.featureMenuOpen=!1,this._focusFeatureMenuButton=!0,this.scheduleRender()}_next(){this.next()}_previous(){this.previous()}};d([f({readOnly:!0})],Ct.prototype,"actionsMenuId",null),d([f({readOnly:!0})],Ct.prototype,"actionsMenuButtonId",null),d([f({readOnly:!0})],Ct.prototype,"featureMenuId",null),d([f({readOnly:!0})],Ct.prototype,"titleId",null),d([f({readOnly:!0})],Ct.prototype,"contentId",null),d([f({readOnly:!0})],Ct.prototype,"hasContent",null),d([f({readOnly:!0})],Ct.prototype,"featureNavigationVisible",null),d([f({readOnly:!0})],Ct.prototype,"collapsible",null),d([f({readOnly:!0})],Ct.prototype,"featureMenuVisible",null),d([f({readOnly:!0})],Ct.prototype,"contentCollapsed",null),d([f({readOnly:!0})],Ct.prototype,"dividedActions",null),d([We("viewModel.actions")],Ct.prototype,"actions",void 0),d([f()],Ct.prototype,"actionsMenuOpen",null),d([f()],Ct.prototype,"alignment",void 0),d([We("viewModel.autoCloseEnabled")],Ct.prototype,"autoCloseEnabled",void 0),d([We("viewModel.autoOpenEnabled")],Ct.prototype,"autoOpenEnabled",void 0),d([We("viewModel.defaultPopupTemplateEnabled")],Ct.prototype,"defaultPopupTemplateEnabled",void 0),d([We("viewModel.content")],Ct.prototype,"content",void 0),d([f()],Ct.prototype,"collapsed",void 0),d([f()],Ct.prototype,"collapseEnabled",void 0),d([f({readOnly:!0})],Ct.prototype,"currentAlignment",null),d([f({readOnly:!0})],Ct.prototype,"currentDockPosition",null),d([f()],Ct.prototype,"dockOptions",null),d([f()],Ct.prototype,"dockEnabled",void 0),d([We("viewModel.featureCount")],Ct.prototype,"featureCount",void 0),d([f()],Ct.prototype,"featureMenuOpen",void 0),d([We("viewModel.features")],Ct.prototype,"features",void 0),d([We("viewModel.goToOverride")],Ct.prototype,"goToOverride",void 0),d([f()],Ct.prototype,"headingLevel",void 0),d([We("viewModel.highlightEnabled")],Ct.prototype,"highlightEnabled",void 0),d([We("viewModel.location")],Ct.prototype,"location",void 0),d([f({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],Ct.prototype,"label",void 0),d([f()],Ct.prototype,"maxInlineActions",void 0),d([f(),es("esri/widgets/Popup/t9n/Popup")],Ct.prototype,"messages",void 0),d([f(),es("esri/t9n/common")],Ct.prototype,"messagesCommon",void 0),d([We("viewModel.promises")],Ct.prototype,"promises",void 0),d([We("viewModel.selectedFeature")],Ct.prototype,"selectedFeature",void 0),d([We("viewModel.selectedFeatureIndex")],Ct.prototype,"selectedFeatureIndex",void 0),d([f({readOnly:!0})],Ct.prototype,"selectedFeatureWidget",null),d([f()],Ct.prototype,"spinnerEnabled",void 0),d([We("viewModel.title")],Ct.prototype,"title",void 0),d([We("viewModel.updateLocationEnabled")],Ct.prototype,"updateLocationEnabled",void 0),d([We("viewModel.view")],Ct.prototype,"view",void 0),d([f({type:X8e}),Q4e(["triggerAction","trigger-action"])],Ct.prototype,"viewModel",void 0),d([We("viewModel.visible")],Ct.prototype,"visible",void 0),d([f()],Ct.prototype,"visibleElements",void 0),d([Xt("visibleElements")],Ct.prototype,"castVisibleElements",null),d([ol()],Ct.prototype,"_close",null),d([ol()],Ct.prototype,"_toggleDockEnabled",null),d([ol()],Ct.prototype,"_toggleFeatureMenu",null),d([ol()],Ct.prototype,"_toggleActionsMenu",null),d([ol()],Ct.prototype,"_triggerAction",null),d([ol()],Ct.prototype,"_selectFeature",null),d([ol()],Ct.prototype,"_next",null),d([ol()],Ct.prototype,"_previous",null),Ct=d([$(Y8e)],Ct);const Ife=Ct,pj=[0,0];function tat(e){const t=(e.ownerDocument||window.document).defaultView,r=e.getBoundingClientRect();return pj[0]=r.left+t.pageXOffset,pj[1]=r.top+t.pageYOffset,pj}function $fe(e){e&&(aTe(e),e.parentNode&&e.parentNode.removeChild(e))}function rat(e){const t=document.createElement("div");return e.appendChild(t),t}const i8=16,bP=750,iat=512,nat=2,sat=e=>{let t=class extends e{constructor(...r){super(...r),this._freqInfo={freq:i8,time:bP},this._overlayRenderTaskHandle=null,this.height=0,this.position=null,this.resizing=!1,this.root=null,this.surface=null,this.suspended=!0,this.ui=null,this.userContent=null,this.width=0,this.widthBreakpoint=null,this.handles.add([re(()=>this.cursor,i=>{const{surface:n}=this;n&&n.setAttribute("data-cursor",i)}),re(()=>this.interacting,i=>{const{surface:n}=this;n&&n.setAttribute("data-interacting",i.toString())})])}initialize(){this.handles.add(re(()=>this.ui,(r,i)=>this._handleUIChange(r,i))),this._wireUI(this.ui),this.handles.add([this.on("focus",()=>this.notifyChange("focused")),this.on("blur",()=>this.notifyChange("focused"))])}destroy(){this.destroyed||(this.ui&&(this.ui.destroy(),this.ui=null),this.popup&&!this.popup.destroyed&&this.popup.destroy(),this.container=null)}set container(r){const i=this._get("container");if(i===r)return;const n="dom-size";if(this.handles.remove(n),this._stopMeasuring(),i&&(i.classList.remove("esri-view"),this._overlayRenderTaskHandle&&(this._overlayRenderTaskHandle.remove(),this._overlayRenderTaskHandle=null),this.overlay.destroy(),this._set("overlay",null),$fe(this.root),this._set("root",null),lde(this.userContent,i),$fe(this.userContent),this._set("userContent",null)),r){r.classList.add("esri-view");const s=document.createElement("div");s.className="esri-view-user-storage",lde(r,s),r.appendChild(s),this._set("userContent",s);const a=document.createElement("div");a.className="esri-view-root",r.insertBefore(a,r.firstChild),this._set("root",a);const o=document.createElement("div");o.className="esri-view-surface",o.setAttribute("role","application"),o.tabIndex=0,a.appendChild(o),this._set("surface",o);const l=new jde;a.appendChild(l.surface),this._set("overlay",l),re(()=>l.needsRender,c=>{c&&!this._overlayRenderTaskHandle?this._overlayRenderTaskHandle=Aw({render:()=>{this.overlay.render()}}):this._overlayRenderTaskHandle&&(this._overlayRenderTaskHandle.remove(),this._overlayRenderTaskHandle=null)}),this.forceDOMReadyCycle(),this.handles.add(re(()=>this.size,c=>{const[u,h]=c,p="esri-view-surface--inset-outline";u>=document.body.clientWidth||h>=document.body.clientHeight?o.classList.add(p):o.classList.remove(p)},Ot),n),this._set("container",r),this._startMeasuring()}else this._set("width",0),this._set("height",0),this._set("position",null),this._set("suspended",!0),this._set("surface",null),this._set("container",null)}get focused(){const r=document.activeElement===this.surface;return document.hasFocus()&&r}get popup(){return this._get("popup")||new Ife({view:this})}set popup(r){const i=this._get("popup");i&&i!==r&&i.destroy(),this._set("popup",r)}get size(){return[this.width,this.height]}blur(){this.surface&&this.surface.blur()}focus(){this.surface&&this.surface.focus()}pageToContainer(r,i,n){const s=this.position;return r-=s[0],i-=s[1],n?(n[0]=r,n[1]=i):n=[r,i],n}containerToPage(r,i,n){const s=this.position;return r+=s[0],i+=s[1],n?(n[0]=r,n[1]=i):n=[r,i],n}_handleUIChange(r,i){i&&(this.handles.remove("ui"),i.destroy()),r&&this._wireUI(r),this._set("ui",r)}_wireUI(r){this.handles.remove("ui"),r&&(r.view=this,this.handles.add([re(()=>this.root,i=>{r.container=i?rat(i):null},Ot),re(()=>this.popup,(i,n)=>{const s="popup",a="manual";n&&r.remove(n,s),i&&(i.view=r.view,r.add(i,{key:s,position:a}))},Ot)],"ui"))}_stopMeasuring(){this.handles.remove("measuring"),this._get("resizing")&&this._set("resizing",!1)}_startMeasuring(){const r=this._freqInfo;r.freq=i8,r.time=bP,this.handles.add([(()=>{const i=()=>{r.freq=i8,r.time=bP};return window.addEventListener("resize",i),{remove(){window.removeEventListener("resize",i)}}})(),Aw({prepare:i=>{const n=this._measure(),s=this._freqInfo;if(s.time+=i.deltaTime,n&&(s.freq=i8,this._get("resizing")||this._set("resizing",!0)),s.time<s.freq)return;s.time=0;const a=this._position();s.freq=a||n?i8:Math.min(bP,s.freq*nat),!n&&s.freq>=iat&&this._get("resizing")&&this._set("resizing",!1)}})],"measuring"),this._measure(),this._position()}_measure(){const r=this.container,i=r?r.clientWidth:0,n=r?r.clientHeight:0;if(i===0||n===0)return this.suspended||this._set("suspended",!0),!1;const s=this.width,a=this.height;return i===s&&n===a?(this.suspended&&this._set("suspended",!1),!1):(this._set("width",i),this._set("height",n),this.suspended&&this._set("suspended",!1),this.emit("resize",{oldWidth:s,oldHeight:a,width:i,height:n}),!0)}_position(){const r=this.container,i=this.position,n=tat(r);return(!i||n[0]!==i[0]||n[1]!==i[1])&&(this._set("position",[n[0],n[1]]),!0)}forceDOMReadyCycle(){}};return d([f({value:null,cast:r=>$V(r)})],t.prototype,"container",null),d([f({readOnly:!0})],t.prototype,"focused",null),d([f({readOnly:!0})],t.prototype,"height",void 0),d([f({type:Ife})],t.prototype,"popup",null),d([f({type:jde})],t.prototype,"overlay",void 0),d([f({readOnly:!0})],t.prototype,"position",void 0),d([f({readOnly:!0})],t.prototype,"resizing",void 0),d([f({readOnly:!0})],t.prototype,"root",void 0),d([f({value:null,readOnly:!0})],t.prototype,"size",null),d([f({readOnly:!0})],t.prototype,"surface",void 0),d([f({readOnly:!0})],t.prototype,"suspended",void 0),d([f()],t.prototype,"ui",void 0),d([f({readOnly:!0})],t.prototype,"userContent",void 0),d([f({readOnly:!0})],t.prototype,"width",void 0),d([f()],t.prototype,"widthBreakpoint",void 0),t=d([$("esri.views.DOMContainer")],t),t};function pLt(e){return e&&"focus"in e}const qne=fe.getLogger("esri.layers.support.ElevationSampler");class Z8e{queryElevation(t){return Q8e(t.clone(),this)}on(){return dat}projectIfRequired(t,r){return J8e(t,r)}}class aat extends Z8e{constructor(t,r,i){super(),this.tile=t,this.noDataValue=i,this.extent=xV(t.tile.extent,r.spatialReference),this.extent.zmin=t.zmin,this.extent.zmax=t.zmax,this.aaExtent=t.tile.extent;const n=vc(r.spatialReference),s=r.lodAt(t.tile.level).resolution*n;this.demResolution={min:s,max:s}}get spatialReference(){return this.extent.spatialReference}contains(t){const r=this.projectIfRequired(t,this.spatialReference);return!R(r)&&this.containsAt(r.x,r.y)}containsAt(t,r){return $re(this.aaExtent,t,r)}elevationAt(t,r){if(!this.containsAt(t,r)){const i=this.extent,n=`${i.xmin}, ${i.ymin}, ${i.xmax}, ${i.ymax}`;return qne.warn("#elevationAt()",`Point used to sample elevation (${t}, ${r}) is outside of the sampler extent (${n})`),this.noDataValue}return vt(this.tile.sample(t,r),this.noDataValue)}}class mLt extends Z8e{constructor(t,r,i){let n;super(),typeof r=="number"?(this.noDataValue=r,n=null):(n=r,this.noDataValue=i),this.samplers=n?t.map(a=>new aat(a,n,this.noDataValue)):t;const s=this.samplers[0];if(s){this.extent=s.extent.clone();const{min:a,max:o}=s.demResolution;this.demResolution={min:a,max:o};for(let l=1;l<this.samplers.length;l++){const c=this.samplers[l];this.extent.union(c.extent),this.demResolution.min=Math.min(this.demResolution.min,c.demResolution.min),this.demResolution.max=Math.max(this.demResolution.max,c.demResolution.max)}}else this.extent=xV(zt(),n.spatialReference),this.demResolution={min:0,max:0}}get spatialReference(){return this.extent.spatialReference}elevationAt(t,r){for(const i of this.samplers)if(i.containsAt(t,r))return i.elevationAt(t,r);return qne.warn("#elevationAt()",`Point used to sample elevation (${t}, ${r}) is outside of the sampler`),this.noDataValue}}function Q8e(e,t){const r=J8e(e,t.spatialReference);if(!r)return null;switch(e.type){case"point":oat(e,r,t);break;case"polyline":lat(e,r,t);break;case"multipoint":cat(e,r,t)}return e}function J8e(e,t){if(R(e))return null;const r=e.spatialReference;if(r.equals(t))return e;const i=mx(e,t);return i||qne.error(`Cannot project geometry spatial reference (wkid:${r.wkid}) to elevation sampler spatial reference (wkid:${t.wkid})`),i}function oat(e,t,r){e.z=r.elevationAt(t.x,t.y)}function lat(e,t,r){j0.spatialReference=t.spatialReference;const i=e.hasM&&!e.hasZ;for(let n=0;n<e.paths.length;n++){const s=e.paths[n],a=t.paths[n];for(let o=0;o<s.length;o++){const l=s[o],c=a[o];j0.x=c[0],j0.y=c[1],i&&(l[3]=l[2]),l[2]=r.elevationAt(j0.x,j0.y)}}e.hasZ=!0}function cat(e,t,r){j0.spatialReference=t.spatialReference;const i=e.hasM&&!e.hasZ;for(let n=0;n<e.points.length;n++){const s=e.points[n],a=t.points[n];j0.x=a[0],j0.y=a[1],i&&(s[3]=s[2]),s[2]=r.elevationAt(j0.x,j0.y)}e.hasZ=!0}const j0=new ot,dat={remove(){}};var pJ;let v0=pJ=class extends ge{constructor(e){super(e),this.cols=null,this.level=0,this.levelValue=null,this.origin=null,this.resolution=0,this.rows=null,this.scale=0}clone(){return new pJ({cols:this.cols,level:this.level,levelValue:this.levelValue,resolution:this.resolution,rows:this.rows,scale:this.scale})}};d([f({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],v0.prototype,"cols",void 0),d([f({type:$i,json:{write:!0}})],v0.prototype,"level",void 0),d([f({type:String,json:{write:!0}})],v0.prototype,"levelValue",void 0),d([f({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],v0.prototype,"origin",void 0),d([f({type:Number,json:{write:!0}})],v0.prototype,"resolution",void 0),d([f({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],v0.prototype,"rows",void 0),d([f({type:Number,json:{write:!0}})],v0.prototype,"scale",void 0),v0=pJ=d([$("esri.layers.support.LOD")],v0);const K8e=v0;var c1;const Lfe=new tr({PNG:"png",PNG8:"png8",PNG24:"png24",PNG32:"png32",JPEG:"jpg",JPG:"jpg",DIB:"dib",TIFF:"tiff",EMF:"emf",PS:"ps",PDF:"pdf",GIF:"gif",SVG:"svg",SVGZ:"svgz",Mixed:"mixed",MIXED:"mixed",LERC:"lerc",LERC2D:"lerc2d",RAW:"raw",pbf:"pbf"});let ba=c1=class extends ge{constructor(e){super(e),this.dpi=96,this.format=null,this.origin=null,this.minScale=0,this.maxScale=0,this.size=null,this.spatialReference=null}static create(e={}){const{resolutionFactor:t=1,scales:r,size:i=256,spatialReference:n=Ye.WebMercator,numLODs:s=24}=e;if(!dc(n)){const h=[];if(r)for(let p=0;p<r.length;p++){const m=r[p];h.push({level:p,scale:m,resolution:m})}else{let p=5e-4;for(let m=s-1;m>=0;m--)h.unshift({level:m,scale:p,resolution:p}),p*=2}return new c1({dpi:96,lods:h,origin:new ot(0,0,n),size:[i,i],spatialReference:n})}const a=oy(n),o=e.origin?new ot({x:e.origin.x,y:e.origin.y,spatialReference:n}):new ot(a?{x:a.origin[0],y:a.origin[1],spatialReference:n}:{x:0,y:0,spatialReference:n}),l=96,c=1/(vc(n)*39.37*l),u=[];if(r)for(let h=0;h<r.length;h++){const p=r[h],m=p*c;u.push({level:h,scale:p,resolution:m})}else{let h=V3e(n)?512/i*5916575275917094e-7:256/i*591657527591555e-6;const p=Math.ceil(s/t);u.push({level:0,scale:h,resolution:h*c});for(let m=1;m<p;m++){const g=h/2**t,b=g*c;u.push({level:m,scale:g,resolution:b}),h=g}}return new c1({dpi:l,lods:u,origin:o,size:[i,i],spatialReference:n})}get isWrappable(){const{spatialReference:e,origin:t}=this;if(e&&t){const r=oy(e);return e.isWrappable&&Math.abs(r.origin[0]-t.x)<=r.dx}return!1}readOrigin(e,t){return ot.fromJSON({spatialReference:t.spatialReference,...e})}set lods(e){let t=0,r=0;const i=[];this._levelToLOD={},e&&(t=-1/0,r=1/0,e.forEach(n=>{i.push(n.scale),t=n.scale>t?n.scale:t,r=n.scale<r?n.scale:r,this._levelToLOD[n.level]=n})),this._set("scales",i),this._set("minScale",t),this._set("maxScale",r),this._set("lods",e),this._initializeUpsampleLevels()}readSize(e,t){return[t.cols,t.rows]}writeSize(e,t){t.cols=e[0],t.rows=e[1]}zoomToScale(e){const t=this.scales;if(e<=0)return t[0];if(e>=t.length-1)return t[t.length-1];{const r=Math.floor(e),i=r+1;return t[r]/(t[r]/t[i])**(e-r)}}scaleToZoom(e){const t=this.scales,r=t.length-1;let i=0;for(;i<r;i++){const n=t[i],s=t[i+1];if(n<=e)return i;if(s===e)return i+1;if(n>e&&s<e)return i+Math.log(n/e)/Math.log(n/s)}return i}snapScale(e,t=.95){const r=this.scaleToZoom(e);return r%Math.floor(r)>=t?this.zoomToScale(Math.ceil(r)):this.zoomToScale(Math.floor(r))}tileAt(e,t,r,i){const n=this.lodAt(e);if(!n)return null;let s,a;if(typeof t=="number")s=t,a=r;else if(_l(t.spatialReference,this.spatialReference))s=t.x,a=t.y,i=r;else{const c=mx(t,this.spatialReference);if(R(c))return null;s=c.x,a=c.y,i=r}const o=n.resolution*this.size[0],l=n.resolution*this.size[1];return i||(i={id:null,level:0,row:0,col:0,extent:zt()}),i.level=e,i.row=Math.floor((this.origin.y-a)/l+.001),i.col=Math.floor((s-this.origin.x)/o+.001),this.updateTileInfo(i),i}updateTileInfo(e,t=c1.ExtrapolateOptions.NONE){let r=this.lodAt(e.level);if(!r&&t===c1.ExtrapolateOptions.POWER_OF_TWO){const a=this.lods[this.lods.length-1];a.level<e.level&&(r=a)}if(!r)return;const i=e.level-r.level,n=r.resolution*this.size[0]/2**i,s=r.resolution*this.size[1]/2**i;e.id=`${e.level}/${e.row}/${e.col}`,e.extent||(e.extent=zt()),e.extent[0]=this.origin.x+e.col*n,e.extent[1]=this.origin.y-(e.row+1)*s,e.extent[2]=e.extent[0]+n,e.extent[3]=e.extent[1]+s}upsampleTile(e){const t=this._upsampleLevels[e.level];return!(!t||t.parentLevel===-1)&&(e.level=t.parentLevel,e.row=Math.floor(e.row/t.factor+.001),e.col=Math.floor(e.col/t.factor+.001),this.updateTileInfo(e),!0)}getTileBounds(e,t){const{resolution:r}=this.lodAt(t.level),i=r*this.size[0],n=r*this.size[1];return e[0]=this.origin.x+t.col*i,e[1]=this.origin.y-(t.row+1)*n,e[2]=e[0]+i,e[3]=e[1]+n,e}lodAt(e){return this._levelToLOD&&this._levelToLOD[e]||null}clone(){return c1.fromJSON(this.write({}))}getOrCreateCompatible(e,t){if(this.size[0]===256&&this.size[1]===256)return e===256?this:null;const r=[],i=this.lods.length;for(let n=0;n<i;n++){const s=this.lods[n],a=s.resolution*t;r.push(new K8e({level:s.level,scale:s.scale,resolution:a}))}return new c1({size:[e,e],dpi:this.dpi,format:this.format,compressionQuality:this.compressionQuality,origin:this.origin,spatialReference:this.spatialReference,lods:r})}_initializeUpsampleLevels(){const e=this.lods;this._upsampleLevels=[];let t=null;for(let r=0;r<e.length;r++){const i=e[r];this._upsampleLevels[i.level]={parentLevel:t?t.level:-1,factor:t?t.resolution/i.resolution:0},t=i}}};d([f({type:Number,json:{write:!0}})],ba.prototype,"compressionQuality",void 0),d([f({type:Number,json:{write:!0}})],ba.prototype,"dpi",void 0),d([f({type:String,json:{read:Lfe.read,write:Lfe.write,origins:{"web-scene":{read:!1,write:!1}}}})],ba.prototype,"format",void 0),d([f({readOnly:!0})],ba.prototype,"isWrappable",null),d([f({type:ot,json:{write:!0}})],ba.prototype,"origin",void 0),d([$e("origin")],ba.prototype,"readOrigin",null),d([f({type:[K8e],value:null,json:{write:!0}})],ba.prototype,"lods",null),d([f({readOnly:!0})],ba.prototype,"minScale",void 0),d([f({readOnly:!0})],ba.prototype,"maxScale",void 0),d([f({readOnly:!0})],ba.prototype,"scales",void 0),d([f({cast:e=>Array.isArray(e)?e:typeof e=="number"?[e,e]:[256,256]})],ba.prototype,"size",void 0),d([$e("size",["rows","cols"])],ba.prototype,"readSize",null),d([Xe("size",{cols:{type:$i},rows:{type:$i}})],ba.prototype,"writeSize",null),d([f({type:Ye,json:{write:!0}})],ba.prototype,"spatialReference",void 0),ba=c1=d([$("esri.layers.support.TileInfo")],ba),function(e){var t;(t=e.ExtrapolateOptions||(e.ExtrapolateOptions={}))[t.NONE=0]="NONE",t[t.POWER_OF_TWO=1]="POWER_OF_TWO"}(ba||(ba={}));const qL=ba,uat=12;class Mi{constructor(t){const r=Mi.checkUnsupported(t);if(_(r))throw r;const i=t;this.spatialReference=i.spatialReference,this._isWebMercator=this.spatialReference.isWebMercator,this._isGCS=kw(this.spatialReference)||Sm(this.spatialReference)||Em(this.spatialReference),this.origin=[i.origin.x,i.origin.y],this.pixelSize=i.size[0],this.dpi=i.dpi;const n=i.lods.reduce((c,u,h)=>(u.level<c.min&&(c.min=u.level,c.minIndex=h),c.max=Math.max(c.max,u.level),c),{min:1/0,minIndex:0,max:-1/0}),s=i.lods[n.minIndex],a=2**s.level;let o=s.resolution*a,l=s.scale*a;this.levels=new Array(n.max+1);for(let c=0;c<this.levels.length;c++)this.levels[c]={resolution:o,scale:l,tileSize:[o*i.size[0],o*i.size[1]]},o/=2,l/=2}clone(){return new Mi(this.toTileInfo())}toTileInfo(){return new qL({dpi:this.dpi,origin:{x:this.origin[0],y:this.origin[1],spatialReference:this.spatialReference},size:[this.pixelSize,this.pixelSize],spatialReference:this.spatialReference,lods:this.levels.map((t,r)=>({level:r,scale:t.scale,resolution:t.resolution}))})}getExtent(t,r,i,n){const s=this.levels[t],a=s.tileSize[0],o=s.tileSize[1];n[0]=this.origin[0]+i*a,n[2]=this.origin[0]+(i+1)*a,n[3]=this.origin[1]-r*o,n[1]=this.origin[1]-(r+1)*o}convertExtentToRadians(t,r){this._isWebMercator?(r[0]=Sce(t[0]),r[1]=$F(t[1]),r[2]=Sce(t[2]),r[3]=$F(t[3])):this._isGCS&&(r[0]=kt(t[0]),r[1]=kt(t[1]),r[2]=kt(t[2]),r[3]=kt(t[3]))}getExtentGeometry(t,r,i,n=new Zt){return this.getExtent(t,r,i,Gp),n.spatialReference=this.spatialReference,n.xmin=Gp[0],n.ymin=Gp[1],n.xmax=Gp[2],n.ymax=Gp[3],n.zmin=void 0,n.zmax=void 0,n}ensureMaxLod(t){if(t==null)return!1;let r=!1;for(;this.levels.length<=t;){const i=this.levels[this.levels.length-1],n=i.resolution/2;this.levels.push({resolution:n,scale:i.scale/2,tileSize:[n*this.pixelSize,n*this.pixelSize]}),r=!0}return r}capMaxLod(t){this.levels.length>t+1&&(this.levels.length=t+1)}getMaxLod(){return this.levels.length-1}scaleAtLevel(t){return this.levels[0].scale/2**t}levelAtScale(t){const r=this.levels[0].scale;return t>=r?0:Math.log(r/t)*Math.LOG2E}resolutionAtLevel(t){return this.levels[0].resolution/2**t}compatibleWith(t){if(!(t instanceof Mi)){if(Mi.checkUnsupported(t))return!1;t=new Mi(t)}if(!t.spatialReference.equals(this.spatialReference)||t.pixelSize!==this.pixelSize)return!1;const r=Math.min(this.levels.length,t.levels.length)-1,i=this.levels[r].resolution;let n=.5*i;return!W4(t.origin[0],this.origin[0],n)||!W4(t.origin[1],this.origin[1],n)?!1:(n=.5*i/2**r/this.pixelSize*uat,W4(i,t.levels[r].resolution,n))}rootTilesInExtent(t,r=null,i=1/0){const n=new Array,s=this.levels[0].tileSize;if(R(t)||s[0]===0||s[1]===0)return n;Mi.computeRowColExtent(t,s,this.origin,Gp);let a=Gp[1],o=Gp[3],l=Gp[0],c=Gp[2];const u=c-l,h=o-a;if(u*h>i){const p=Math.floor(Math.sqrt(i));h>p&&(a=a+Math.floor(.5*h)-Math.floor(.5*p),o=a+p),u>p&&(l=l+Math.floor(.5*u)-Math.floor(.5*p),c=l+p)}for(let p=a;p<o;p++)for(let m=l;m<c;m++)n.push([0,p,m]);return _(r)&&(r[0]=this.origin[0]+l*s[0],r[1]=this.origin[1]-o*s[1],r[2]=this.origin[0]+c*s[0],r[3]=this.origin[1]-a*s[1]),n}static computeRowColExtent(t,r,i,n){const s=.001*(t[2]-t[0]+(t[3]-t[1]));n[0]=Math.max(0,Math.floor((t[0]+s-i[0])/r[0])),n[2]=Math.max(0,Math.ceil((t[2]-s-i[0])/r[0])),n[1]=Math.max(0,Math.floor((i[1]-t[3]+s)/r[1])),n[3]=Math.max(0,Math.ceil((i[1]-t[1]-s)/r[1]))}static isPowerOfTwo(t){const r=t.lods,i=r[0].resolution*2**r[0].level;return!r.some(n=>!Eze(n.resolution,i/2**n.level))}static hasGapInLevels(t){const r=t.lods.map(i=>i.level);r.sort((i,n)=>i-n);for(let i=1;i<r.length;i++)if(r[i]!==r[0]+i)return!0;return!1}static tileSizeSupported(t){const r=t.size[1];return r===t.size[0]&&(r&r-1)==0&&r>=128&&r<=512}static hasOriginPerLODs(t){const r=t.origin;return t.lods.some(i=>i.origin!=null&&(i.origin[0]!==r.x||i.origin[1]!==r.y))}static getMissingTileInfoError(){return new k("tilingscheme:tile-info-missing","Tiling scheme must have tiling information")}static checkUnsupported(t){return R(t)?Hne():t.lods.length<1?new k("tilingscheme:generic","Tiling scheme must have at least one level"):Mi.isPowerOfTwo(t)?Mi.hasGapInLevels(t)?new k("tilingscheme:gaps","Tiling scheme levels must not have gaps between min and max level"):Mi.tileSizeSupported(t)?Mi.hasOriginPerLODs(t)?new k("tilingscheme:multiple-origin","Tiling scheme levels must not have their own origin"):null:new k("tilingscheme:tile-size","Tiles must be square and size must be one of [128, 256, 512]"):new k("tilingscheme:power-of-two","Tiling scheme must be power of two")}static fromExtent(t,r){const i=t[2]-t[0],n=t[3]-t[1],s=vc(r),a=1.2*Math.max(i,n),o=256,l=96,c=.0254,u=new Mi(new qL({size:[o,o],origin:{x:t[0]-.5*(a-i),y:t[3]+.5*(a-n)},lods:[{level:0,resolution:a/o,scale:1/(o/l*c/(a*s))}],spatialReference:r}));return u.ensureMaxLod(20),u}static makeWebMercatorAuxiliarySphere(t){const r=new Mi(Mi.WebMercatorAuxiliarySphereTileInfo);return r.ensureMaxLod(t),r}static makeGCSWithTileSize(t,r=256,i=16){const n=256/r,s=new Mi(new qL({size:[r,r],origin:{x:-180,y:90,spatialReference:t},spatialReference:t,lods:[{level:0,resolution:.703125*n,scale:295497598570834e-6*n}]}));return s.ensureMaxLod(i),s}get test(){return{isWebMercator:this._isWebMercator,isGCS:this._isGCS}}}function Hne(){return new k("tilingscheme:tile-info-missing","Tiling scheme must have tiling information")}Mi.WebMercatorAuxiliarySphereTileInfo=new qL({size:[256,256],origin:{x:-20037508342787e-6,y:20037508342787e-6,spatialReference:Ye.WebMercator},spatialReference:Ye.WebMercator,lods:[{level:0,resolution:156543.03392800014,scale:591657527591555e-6}]}),Mi.WebMercatorAuxiliarySphere=Mi.makeWebMercatorAuxiliarySphere(19);const Gp=zt(),b4=64,mJ=512,hat=2.5,IA=Cze(CX/10),eEe=4,fat=4,HL=e=>e<4?3:fat,tEe=zt();Mi.WebMercatorAuxiliarySphere.getExtent(0,0,0,tEe);const pat=zt([-180,-90,180,90]),mat="Cannot extend surface to encompass all layers because it would result in too many root tiles.",gat="Surface extent is too large for tile resolution at level 0.",ph=8,yat=fe.getLogger("esri.views.support.GroundViewElevationSampler");let d1=class extends mn.EventedAccessor{constructor(e){super(e),this.demResolution={min:-1,max:-1},this.noDataValue=IA}initialize(){this.view.basemapTerrain.on("elevation-change",()=>this.emit("changed",{}))}get extent(){const e=this.view.basemapTerrain;if(R(e.extent)||!e.spatialReference)return null;const t=xV(e.extent,e.spatialReference);return t.zmin=e.elevationBounds.min,t.zmax=e.elevationBounds.max,t}elevationAt(e,t){if(R(this.extent)||!sl(this.extent,e,t)){const r=_(this.extent)?`${this.extent.xmin}, ${this.extent.ymin}, ${this.extent.xmax}, ${this.extent.ymax}`:null;return yat.warn("#elevationAt()",`Point used to sample elevation (${e}, ${t}) is outside of the sampler extent (${r})`),this.noDataValue}return vt(this.view.elevationProvider.getElevation(e,t,0,this.spatialReference,"ground"),this.noDataValue)}queryElevation(e){return Q8e(e.clone(),this)}};d([f({readOnly:!0})],d1.prototype,"demResolution",void 0),d([f({readOnly:!0})],d1.prototype,"extent",null),d([f({readOnly:!0})],d1.prototype,"noDataValue",void 0),d([f({readOnly:!0,aliasOf:"view.basemapTerrain.spatialReference"})],d1.prototype,"spatialReference",void 0),d([f({constructOnly:!0})],d1.prototype,"view",void 0),d1=d([$("esri.views.support.GroundViewElevationSampler")],d1);const bat=d1;let u1=class extends xe{constructor(e){super(e),this.handles=new Ft,this.view=null,this.layerViews=new lt}initialize(){this.handles.add(Fa(()=>{var e,t;return(t=(e=this.view)==null?void 0:e.map)==null?void 0:t.ground},e=>e.load())),this.handles.add(this.layerViews.on("after-changes",()=>this._layerViewsAfterChangesHandler()))}destroy(){this._set("view",null),this.handles&&(this.handles.destroy(),this.handles=null)}get elevationSampler(){return this.view?this.view.type==="2d"?null:this.view.ready&&this.view.basemapTerrain&&this.view.basemapTerrain.ready?new bat({view:this.view}):null:null}get updating(){return!this.suspended&&this.layerViews.some(e=>e.updating)}get suspended(){return!this.view||this.view.suspended}_layerViewsAfterChangesHandler(){this.handles.remove("updating"),this.handles.add(this.layerViews.map(e=>re(()=>e.updating,()=>this._updateUpdating(),ti)).toArray(),"updating"),this._updateUpdating()}_updateUpdating(){this.notifyChange("updating")}};d([f({readOnly:!0})],u1.prototype,"elevationSampler",null),d([f({type:Boolean,readOnly:!0})],u1.prototype,"updating",null),d([f({constructOnly:!0})],u1.prototype,"view",void 0),d([f({type:lt,readOnly:!0})],u1.prototype,"layerViews",void 0),d([f({readOnly:!0})],u1.prototype,"suspended",null),u1=d([$("esri.views.GroundView")],u1);const vat=u1,_at=e=>{let t=class extends e{async fetchPopupFeatures(r,i){await this.when();const{location:n,queryArea:s,layerViewsAndGraphics:a,clientOnlyGraphics:o}=await this._prepareFetchPopupFeatures(r,i),l=Promise.resolve(o),c=this._queryLayerPopupFeatures(s,a,i),u=c.map(h=>h.promise);return{location:n,clientOnlyGraphics:o,allGraphicsPromise:OFe([l,...u]).then(h=>Array.from(new Set(h.flat()))),promisesPerLayerView:c}}_queryLayerPopupFeatures(r,i,n){return i.map(({layerView:s,graphics:a})=>{const o={clientGraphics:a,event:_(n)?n.event:null,signal:_(n)?n.signal:null,defaultPopupTemplateEnabled:!!_(n)&&!!n.defaultPopupTemplateEnabled},l=s.fetchPopupFeatures(r,o);return{layerView:s,promise:l}})}_isValidPopupGraphic(r,i){return r&&!!r.getEffectivePopupTemplate(_(i)&&i.defaultPopupTemplateEnabled)}async _prepareFetchPopupFeatures(r,i){const{clientGraphics:n,queryArea:s,location:a}=await this._popupHitTestGraphics(r,i),o=this._getFetchPopupLayerViews(),{layerViewsAndGraphics:l,clientOnlyGraphics:c}=this._graphicsPerFetchPopupLayerView(n,o);return{clientOnlyGraphics:c,layerViewsAndGraphics:l,queryArea:s,location:a}}async _popupHitTestGraphics(r,i){const{results:n,mapPoint:s}=await this.popupHitTest(r),a=n.filter(l=>l.type==="graphic"&&this._isValidPopupGraphic(l.graphic,i)),o=a.length?a[0].mapPoint:null;return{clientGraphics:a.map(l=>l.graphic),queryArea:s,location:s||o}}_getFetchPopupLayerViews(){const r=[];return this.allLayerViews.forEach(i=>{this._isValidPopupLayerView(i)&&r.push(i)}),_(this.graphicsView)&&this._isValidPopupLayerView(this.graphicsView)&&r.push(this.graphicsView),r.reverse()}_isValidPopupLayerView(r){return _(r)&&(!("layer"in r)||!r.suspended)&&"fetchPopupFeatures"in r}_graphicsPerFetchPopupLayerView(r,i){const n=[],s=new Map,a=i.map(o=>{const l=[];return"layer"in o?s.set(o.layer,l):s.set(o.graphics,l),{layerView:o,graphics:l}});for(const o of r){const l=s.get(o.layer)||s.get(o.sourceLayer)||null;l?l.push(o):n.push(o)}return{layerViewsAndGraphics:a,clientOnlyGraphics:n}}};return t=d([$("esri.views.PopupView")],t),t};let o7=class extends HC{_own(e){e.layer&&"remove"in e.layer&&e.layer!==this.owner&&e.layer.remove(e),e.layer=this.owner}_release(e){e.layer===this.owner&&(e.layer=null)}};d([Dte({Type:co,ensureType:rs(co)})],o7.prototype,"itemType",void 0),o7=d([$("esri.support.GraphicsCollection")],o7);let h1=class extends xe{constructor(e){super(e),this.view=null,this.baseLayerViews=new lt,this.referenceLayerViews=new lt,this._loadingHandle=re(()=>{var t,r;return(r=(t=this.view)==null?void 0:t.map)==null?void 0:r.basemap},t=>{t&&t.load().catch(()=>{})},Ot)}destroy(){this._set("view",null),this._loadingHandle&&(this._loadingHandle.remove(),this._loadingHandle=null)}get suspended(){return!this.view||this.view.suspended}get updating(){var t,r;if(this.view&&this.view.suspended)return!1;const e=(r=(t=this.view)==null?void 0:t.map)==null?void 0:r.basemap;return!!e&&!!e.loaded&&(this.baseLayerViews.some(i=>i.updating)||this.referenceLayerViews.some(i=>i.updating))}};d([f({constructOnly:!0})],h1.prototype,"view",void 0),d([f({readOnly:!0})],h1.prototype,"baseLayerViews",void 0),d([f({readOnly:!0})],h1.prototype,"referenceLayerViews",void 0),d([f({readOnly:!0})],h1.prototype,"suspended",null),d([f({type:Boolean,readOnly:!0})],h1.prototype,"updating",null),h1=d([$("esri.views.BasemapView")],h1);const wat=fe.getLogger("esri.views.LayerViewManager");class xat{constructor(t,r,i){this.layer=t,this.view=r,this.layerViewImporter=i,this._controller=new AbortController,this._deferred=jv(),this._started=!1,this.done=!1,Fo(this._controller.signal,()=>{const n=new k("cancelled:layerview-create","layerview creation cancelled",{layer:t});this._deferred.reject(n)})}get promise(){return this._deferred.promise}destroy(){this._controller.abort();const{layerView:t}=this;if(!t)return;const{layer:r,view:i}=this;r.emit("layerview-destroy",{view:i,layerView:t}),i.emit("layerview-destroy",{layer:r,layerView:t}),this.done=!0,this.layer=null,this.layerView=null,this.view=null,this.layerViewImporter=null}async start(){var n,s;if(this._started)return;this._started=!0;const{_controller:{signal:t},layer:r,view:i}=this;this._map=i.map;try{let a,o;if(await r.load({signal:t}),"prefetchResources"in r&&await r.prefetchResources({signal:t}),r.createLayerView)a=await r.createLayerView(i,{signal:t});else{if(!this.layerViewImporter.hasLayerViewModule(r))throw new k("layer:view-not-supported","No layerview implementation was found");const u=await this.layerViewImporter.importLayerView(r);Et(t),a="default"in u?new u.default({layer:r,view:i}):new u({layer:r,view:i})}const l=()=>{o=Ts(o),a.destroyed||a.destroy(),a.layer=null,a.parent=null,a.view=null,this.done=!0};o=Fo(t,l),Et(t);try{await a.when()}catch(u){throw l(),u}if(!((s=(n=this._map)==null?void 0:n.allLayers)==null?void 0:s.includes(r)))return l(),void this._deferred.reject(new k("view:no-layerview-for-layer","The layer has been removed from the map",{layer:r}));this.layerView=a,r.emit("layerview-create",{view:i,layerView:a}),i.emit("layerview-create",{layer:r,layerView:a}),this.done=!0,this._deferred.resolve(a)}catch(a){r.emit("layerview-create-error",{view:i,error:a}),i.emit("layerview-create-error",{layer:r,error:a}),this.done=!0,this._deferred.reject(new k("layerview:create-error","layerview creation failed",{layer:r,error:a}))}}}let sh=class extends N5{constructor(e){super(e),this._layerLayerViewInfoMap=new Map,this._watchUpdatingTracking=new tm,this.supportsGround=!0,this._preloadLayerViewModules=()=>{var r;const t=(r=this.view.map)==null?void 0:r.allLayers;if(t)for(const i of t)this.layerViewImporter.hasLayerViewModule(i)&&this.layerViewImporter.importLayerView(i)},this._reschedule=()=>(R(this._workPromise)&&(this._workPromise=jv()),this.handles.remove("reschedule"),this.handles.add(X9(this._doWork),"reschedule"),this._workPromise.promise),this._doWork=()=>{var s,a,o;const t=this.view.map;if(this._map!==t&&(this.clear(),this._map=t),R(this._workPromise))return void this.notifyChange("updating");this.handles.remove("reschedule"),this.handles.remove("collection-change");const r=new k5({getCollections:()=>this._rootCollectionNames.map(l=>this.get(l)),getChildrenFunction:l=>l&&"layers"in l?l.layers:null});if(!r)return this._workPromise.resolve(),void(this._workPromise=null);for(const l of r)this._createLayerView(l);this._refreshCollections();for(const[l,c]of this._layerLayerViewInfoMap)r.includes(l)||(this._layerLayerViewInfoMap.delete(c.layer),c.destroy());const i=r.filter(l=>l.type==="group").map(l=>l.layers),n=[(s=t==null?void 0:t.ground)==null?void 0:s.layers,(a=t==null?void 0:t.basemap)==null?void 0:a.baseLayers,(o=t==null?void 0:t.basemap)==null?void 0:o.referenceLayers,t==null?void 0:t.layers,...i].filter(l=>!!l);this.handles.add(n.map(l=>this._watchUpdatingTracking.addOnCollectionChange(()=>l,this._reschedule)),"collection-change"),this._workPromise.resolve(),this._workPromise=null}}initialize(){this.handles.add([rn(()=>{var e,t;return(t=(e=this.view)==null?void 0:e.map)==null?void 0:t.allLayers},"change",this._preloadLayerViewModules,{onListenerAdd:this._preloadLayerViewModules}),re(()=>{const e=this.view,t=e==null?void 0:e.map;return[t==null?void 0:t.basemap,t==null?void 0:t.ground,t==null?void 0:t.layers,e==null?void 0:e.ready]},()=>this._reschedule(),Yn)]),this._preloadLayerViewModules(),this._reschedule()}destroy(){this.clear(),this._watchUpdatingTracking.destroy(),this._map=null}get _layersToLayerViews(){const e=[["view.map.basemap.baseLayers","view.basemapView.baseLayerViews"],["view.map.layers","view.layerViews"],["view.map.basemap.referenceLayers","view.basemapView.referenceLayerViews"]];return this.supportsGround&&e.push(["view.map.ground.layers","view.groundView.layerViews"]),new Map(e)}get _rootCollectionNames(){return Array.from(this._layersToLayerViews.keys())}get updating(){return _(this._workPromise)||this._watchUpdatingTracking.updating||vs(this._layerLayerViewInfoMap,e=>!e.done)}get updatingRemaining(){let e=0;for(const t of this._layerLayerViewInfoMap.values())t.done||++e;return e}clear(){if(!this.destroyed){for(const e of this._layerLayerViewInfoMap.values())e.destroy();this._layerLayerViewInfoMap.clear(),this._refreshCollections()}}async whenLayerView(e){if(await this._reschedule(),!this._layerLayerViewInfoMap.has(e))throw new k("view:no-layerview-for-layer","No layerview has been found for the layer",{layer:e});return this._layerLayerViewInfoMap.get(e).promise}_refreshCollections(){for(const[e,t]of this._layersToLayerViews)this._populateLayerViewsOwners(this.get(e),this.get(t),this.view);this.notifyChange("updating"),this.notifyChange("updatingRemaining")}_populateLayerViewsOwners(e,t,r){if(!e||!t)return void(t&&t.removeAll());let i=0;for(const n of e){const s=this._layerLayerViewInfoMap.get(n);if(!s||!s.layerView)continue;const a=s.layerView;a.layer=n,a.parent=r,t.getItemAt(i)!==a&&t.splice(i,0,a),n.layers&&this._populateLayerViewsOwners(n.layers,a.layerViews,a),i+=1}i<t.length&&t.splice(i,t.length)}_createLayerView(e){if(this._layerLayerViewInfoMap.has(e))return this.view.ready&&this._layerLayerViewInfoMap.get(e).start(),this.notifyChange("updating"),void this.notifyChange("updatingRemaining");e.load().catch(()=>{}),this.layerViewImporter.hasLayerViewModule(e)&&this.layerViewImporter.importLayerView(e);const t=new xat(e,this.view,this.layerViewImporter);t.promise.then(()=>this._refreshCollections(),r=>{var i,n;r&&(Ui(r)||r.name==="cancelled:layerview-create")||wat.error(`Failed to create layerview for layer title:'${(i=e.title)!=null?i:"no title"}', id:'${(n=e.id)!=null?n:"no id"}' of type '${e.type}'.`,{layer:e,error:r}),this._refreshCollections()}),this._layerLayerViewInfoMap.set(e,t),this.view.ready&&t.start(),this.notifyChange("updating"),this.notifyChange("updatingRemaining")}};d([f()],sh.prototype,"_workPromise",void 0),d([f({readOnly:!0})],sh.prototype,"_watchUpdatingTracking",void 0),d([f({readOnly:!0})],sh.prototype,"_layersToLayerViews",null),d([f({readOnly:!0})],sh.prototype,"_rootCollectionNames",null),d([f()],sh.prototype,"layerViewImporter",void 0),d([f()],sh.prototype,"supportsGround",void 0),d([f({readOnly:!0})],sh.prototype,"updating",null),d([f({readOnly:!0})],sh.prototype,"updatingRemaining",null),d([f({constructOnly:!0})],sh.prototype,"view",void 0),sh=d([$("esri.views.LayerViewManager")],sh);const Tat=sh;let Fd=class extends xe{constructor(e){super(e),this.factor=1.5,this.offset=Su(0,0),this.position=null,this.size=120,this.maskUrl=null,this.maskEnabled=!0,this.overlayUrl=null,this.overlayEnabled=!0,this.visible=!0}get version(){return this.commitProperty("factor"),this.commitProperty("offset"),this.commitProperty("position"),this.commitProperty("visible"),this.commitProperty("size"),this.commitProperty("maskUrl"),this.commitProperty("maskEnabled"),this.commitProperty("overlayUrl"),this.commitProperty("overlayEnabled"),(this._get("version")||0)+1}};d([f({type:Number})],Fd.prototype,"factor",void 0),d([f({nonNullable:!0})],Fd.prototype,"offset",void 0),d([f()],Fd.prototype,"position",void 0),d([f({type:Number,range:{min:0}})],Fd.prototype,"size",void 0),d([f()],Fd.prototype,"maskUrl",void 0),d([f()],Fd.prototype,"maskEnabled",void 0),d([f()],Fd.prototype,"overlayUrl",void 0),d([f()],Fd.prototype,"overlayEnabled",void 0),d([f({readOnly:!0})],Fd.prototype,"version",null),d([f({type:Boolean})],Fd.prototype,"visible",void 0),Fd=d([$("esri.views.Magnifier")],Fd);const rEe=Fd;let WL=class extends xe{constructor(){super(...arguments),this._tasks=new Array,this.running=!1}get length(){return this._tasks.length}destroy(){this.cancelAll()}runTask(e){for(;!e.done&&this._process(e);)e.madeProgress()}push(e,t,r){return this.running=!0,new Promise((i,n)=>this._tasks.push(new Dfe(i,n,e,t,r)))}unshift(e,t,r){return this.running=!0,new Promise((i,n)=>this._tasks.unshift(new Dfe(i,n,e,t,r)))}_process(e){if(this._tasks.length===0)return!1;const t=this._tasks.shift();try{const r=bs(t.signal);if(r&&!t.abortCallback)t.reject(br());else{const i=r?t.abortCallback(br()):t.callback(e);$u(i)?i.then(t.resolve,t.reject):t.resolve(i)}}catch(r){t.reject(r)}return this.running=this._tasks.length>0,!0}cancelAll(){const e=br();for(const t of this._tasks)if(t.abortCallback){const r=t.abortCallback(e);t.resolve(r)}else t.reject(e);this._tasks.length=0,this.running=!1}};d([f()],WL.prototype,"running",void 0),WL=d([$("esri.layers.support.PromiseQueue")],WL);class Dfe{constructor(t,r,i,n,s){this.resolve=t,this.reject=r,this.callback=i,this.signal=n,this.abortCallback=s}}let WE=class extends xe{constructor(){super(...arguments),this.SCHEDULER_LOG_SLOW_TASKS=!1,this.FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES=!1}};d([f()],WE.prototype,"SCHEDULER_LOG_SLOW_TASKS",void 0),d([f()],WE.prototype,"FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES",void 0),WE=d([$("esri.views.support.DebugFlags")],WE);const Sat=new WE,Eat=fe.getLogger("esri.views.support.Scheduler");function Cat(){return new LN.Scheduler}var bt;(function(e){e.RESOURCE_CONTROLLER="schedule",e.SLIDE="slide",e.STREAM_DATA_LOADER="stream loader",e.ELEVATION_QUERY="elevation query",e.TERRAIN_SURFACE="terrain",e.SURFACE_GEOMETRY_UPDATES="surface geometry updates",e.GRAPHICS_CORE="Graphics3D",e.I3S_CONTROLLER="I3S",e.POINT_CLOUD_LAYER="point cloud",e.FEATURE_TILE_FETCHER="feature fetcher",e.OVERLAY="overlay",e.STAGE="stage",e.GRAPHICS_DECONFLICTOR="graphics deconflictor",e.FILTER_VISIBILITY="Graphics3D filter visibility",e.SCALE_VISIBILITY="Graphics3D scale visibility",e.FRUSTUM_VISIBILITY="Graphics3D frustum visibility",e.POINT_OF_INTEREST_FREQUENT="POI frequent",e.POINT_OF_INTEREST_INFREQUENT="POI infrequent",e.LABELER="labeler",e.FEATURE_QUERY_ENGINE="feature query",e.FEATURE_TILE_TREE="feature tile tree",e.FEATURE_TILE_TREE_ACTIVE="fast feature tile tree",e.ELEVATION_ALIGNMENT="elevation alignment",e.TEXT_TEXTURE_ATLAS="text texture atlas",e.TEXTURE_UNLOAD="texture unload",e.LINE_OF_SIGHT_TOOL="line of sight tool",e.LINE_OF_SIGHT_TOOL_INTERACTIVE="interactive line of sight tool",e.ELEVATION_PROFILE="elevation profile",e.SNAPPING="snapping",e.SHADOW_ACCUMULATOR="shadow accumulator",e.CLOUDS_GENERATOR="cloud generator",e[e.TEST_PRIO=1]="TEST_PRIO"})(bt||(bt={}));const N0=0,Ffe=new Map([[bt.RESOURCE_CONTROLLER,N0],[bt.SLIDE,N0],[bt.STREAM_DATA_LOADER,N0],[bt.ELEVATION_QUERY,N0],[bt.TERRAIN_SURFACE,1],[bt.SURFACE_GEOMETRY_UPDATES,1],[bt.GRAPHICS_CORE,2],[bt.I3S_CONTROLLER,2],[bt.POINT_CLOUD_LAYER,2],[bt.FEATURE_TILE_FETCHER,2],[bt.OVERLAY,4],[bt.STAGE,4],[bt.GRAPHICS_DECONFLICTOR,4],[bt.FILTER_VISIBILITY,4],[bt.SCALE_VISIBILITY,4],[bt.FRUSTUM_VISIBILITY,4],[bt.POINT_OF_INTEREST_FREQUENT,6],[bt.POINT_OF_INTEREST_INFREQUENT,30],[bt.LABELER,8],[bt.FEATURE_QUERY_ENGINE,8],[bt.FEATURE_TILE_TREE,16],[bt.FEATURE_TILE_TREE_ACTIVE,N0],[bt.ELEVATION_ALIGNMENT,12],[bt.TEXT_TEXTURE_ATLAS,12],[bt.CLOUDS_GENERATOR,12],[bt.TEXTURE_UNLOAD,12],[bt.LINE_OF_SIGHT_TOOL,16],[bt.LINE_OF_SIGHT_TOOL_INTERACTIVE,N0],[bt.SNAPPING,N0],[bt.SHADOW_ACCUMULATOR,30]]);function Nfe(e){return Ffe.has(e)?Ffe.get(e):typeof e=="number"?e:1}var Ks;(function(e){e[e.ANIMATING=0]="ANIMATING",e[e.INTERACTING=1]="INTERACTING",e[e.IDLE=2]="IDLE"})(Ks||(Ks={}));const kfe=6.5,Vfe=1,Aat=30,zfe=1e3/30,Ufe=100,Bfe=.9;var LN,$_;(function(e){let t=class extends xe{constructor(){super(),this.updating=!0,this._microTaskQueued=!1,this.performanceInfo={total:new Rv("total"),tasks:new Map},this._frameTaskTimes=new Map,this._budget=new i,this._state=Ks.INTERACTING,this._tasks=new Qt,this._runQueue=new Qt,this._load=0,this._idleStateCallbacks=new Qt,this._idleUpdatesStartFired=!1,this._maxReschedule=vP,this._forceTask=!1,this._debug=!1,this._debugHandle=re(()=>Sat.SCHEDULER_LOG_SLOW_TASKS,a=>this._debug=a,Ot);for(const a of Object.keys(bt))this.performanceInfo.tasks.set(bt[a],new Rv(bt[a]));let n;const s=this;this._test={get state(){return vt(n,s._state)},set state(a){n=a},FRAME_SAFETY_BUDGET:kfe,INTERACTING_BUDGET:zfe,IDLE_BUDGET:Ufe,get availableBudget(){return s._budget.budget},usedBudget:0,getBudget:()=>s._budget,setBudget:a=>s._budget=a,updateTask:a=>this._updateTask(a),getState:a=>this._getState(a),getRuntime:a=>this._getRuntime(a),frameTaskTimes:this._frameTaskTimes,resetRuntimes:()=>this._resetRuntimes(),getRunning:()=>this._getRunning()}}destroy(){this._tasks.toArray().forEach(n=>n.remove()),this._tasks.clear(),Ts(this._debugHandle),this._microTaskQueued=!1,this.updating=!1}activate(){this._budget.done||this._microTaskQueued||(this._microTaskQueued=!0,queueMicrotask(()=>{this._microTaskQueued&&(this._microTaskQueued=!1,this._budget.done||(this._maxReschedule=vP,this._schedule(),this.frame()))}))}registerTask(n,s){const a=Nfe(n),o=new r(this,n,s,a);return this._tasks.push(o),this.performanceInfo.tasks.has(n)||this.performanceInfo.tasks.set(n,new Rv(n)),o}registerIdleStateCallbacks(n,s){const a={idleBegin:n,idleEnd:s};this._idleStateCallbacks.push(a),this.state===Ks.IDLE&&this._idleUpdatesStartFired&&a.idleBegin();const o=this;return{remove:()=>this._removeIdleStateCallbacks(a),set idleBegin(l){o._idleUpdatesStartFired&&(a.idleEnd(),o._state===Ks.IDLE&&l()),a.idleBegin=l},set idleEnd(l){a.idleEnd=l}}}get load(){return this._load}set state(n){this._state!==n&&(this._state=n,this.state!==Ks.IDLE&&this._idleUpdatesStartFired&&(this._idleUpdatesStartFired=!1,this._idleStateCallbacks.forAll(s=>s.idleEnd())))}get state(){return R(this._test.state)?this._state:this._test.state}updateBudget(n){this._test.usedBudget=0;let s=kfe,a=n.frameDuration,o=Vfe;switch(this.state){case Ks.IDLE:s=0,a=Math.max(Ufe,n.frameDuration),o=Aat;break;case Ks.INTERACTING:a=Math.max(zfe,n.frameDuration);case Ks.ANIMATING:}return a=a-n.elapsedFrameTime-s,this.state!==Ks.IDLE&&a<Vfe&&!this._forceTask?(this._forceTask=!0,!1):(a=Math.max(a,o),this._budget.reset(a,this.state),this._maxReschedule=vP,this._updateLoad(),this._schedule())}frame(){switch(this._forceTask=!1,this._microTaskQueued=!1,this.state){case Ks.IDLE:this._idleUpdatesStartFired||(this._idleUpdatesStartFired=!0,this._idleStateCallbacks.forAll(n=>n.idleBegin())),this._runIdle();break;case Ks.INTERACTING:this._runInteracting();break;default:this._runAnimating()}this._test.usedBudget=this._budget.elapsed}stopFrame(){this._budget.reset(0,this._state),this._budget.madeProgress()}_removeIdleStateCallbacks(n){this._idleUpdatesStartFired&&n.idleEnd(),this._idleStateCallbacks.removeUnordered(n)}removeTask(n){this._tasks.removeUnordered(n),this._runQueue.removeUnordered(n)}_updateTask(n){this._tasks.forAll(s=>{s.name===n&&s.setPriority(n)})}_getState(n){if(this._runQueue.some(a=>a.name===n))return $_.SCHEDULED;let s=$_.IDLE;return this._tasks.forAll(a=>{a.name===n&&a.needsUpdate&&(a.schedulePriority<=1?s=$_.READY:s!==$_.READY&&(s=$_.WAITING))}),s}_getRuntime(n){let s=0;return this._tasks.forAll(a=>{a.name===n&&(s+=a.runtime)}),s}_resetRuntimes(){this._tasks.forAll(n=>n.runtime=0)}_getRunning(){const n=new Map;if(this._tasks.forAll(a=>{a.needsUpdate&&n.set(a.name,(n.get(a.name)||0)+1)}),n.size===0)return null;let s="";return n.forEach((a,o)=>{s+=a>1?` ${a}x ${o}`:` ${o}`}),s}_runIdle(){this._run()}_runInteracting(){this._run()}_runAnimating(){this._run()}_updateLoad(){const n=this._tasks.reduce((s,a)=>a.needsUpdate?++s:s,0);this._load=this._load*Bfe+n*(1-Bfe)}_schedule(){if(this._maxReschedule<=0)return!1;for(this._runQueue.filterInPlace(n=>!!n.needsUpdate||(n.schedulePriority=n.basePriority,!1)),this._tasks.forAll(n=>{n.basePriority===N0&&n.needsUpdate&&!this._runQueue.includes(n)&&this._runQueue.unshift(n)});this._runQueue.length===0;){let n=!1,s=0;if(this._tasks.forAll(a=>{a.needsUpdate&&a.schedulePriority!==0&&a.basePriority!==N0&&(n=!0,s=Math.max(s,a.basePriority),a.schedulePriority===1?(a.schedulePriority=0,this._runQueue.push(a)):--a.schedulePriority)}),!n)return this.updating=!1,!1;this._maxReschedule===vP&&(this._maxReschedule=s),--this._maxReschedule}return this.updating=!0,!0}_run(){const n=this._budget.now();this._startFrameTaskTimes();do for(;this._runQueue.length>0;){const s=this._budget.now(),a=this._runQueue.pop();this._budget.resetProgress();try{a.task.runTask(this._budget)}catch(l){Eat.error(`Exception in task "${a.name}"`,l)}a.schedulePriority=a.basePriority;const o=this._budget.now()-s;if(a.runtime+=o,this._frameTaskTimes.set(a.priority,this._frameTaskTimes.get(a.priority)+o),this._debug&&this._budget.elapsed>2*this._budget.budget&&console.log("Task",a.name,"used",this._budget.elapsed,"of max",this._budget.budget,"ms"),this._budget.remaining<=0)return this.updating=this._tasks.some(l=>l.needsUpdate),void this._recordFrameTaskTimes(this._budget.now()-n)}while(this._schedule());this.updating=this._tasks.some(s=>s.needsUpdate),this._recordFrameTaskTimes(this._budget.now()-n)}_startFrameTaskTimes(){for(const n of Object.keys(bt))this._frameTaskTimes.set(bt[n],0)}_recordFrameTaskTimes(n){this._frameTaskTimes.forEach((s,a)=>this.performanceInfo.tasks.get(a).record(s)),this.performanceInfo.total.record(n)}get test(){return this._test}};d([f()],t.prototype,"updating",void 0),t=d([$("esri.views.support.Scheduler")],t),e.Scheduler=t;let r=class extends xe{constructor(n,s,a,o){super({}),this._scheduler=n,this.name=s,this._basePriority=o,this.runtime=0,this._queue=new WL,this._handles=new Ft,this.schedulePriority=this._basePriority,this.task=_(a)?a:this._queue,this._handles.add(Fa(()=>this.task.running,()=>n.activate()))}get updating(){return this._queue.running}normalizeCtorArgs(){return{}}remove(){this.processQueue(y6),this._scheduler.removeTask(this),this.schedule=d9.schedule,this.reschedule=d9.reschedule,this._handles.destroy()}get basePriority(){return this._basePriority}setPriority(n){this.name=n;const s=Nfe(n);this._basePriority!==N0&&this.schedulePriority===0||(this.schedulePriority=s),this._basePriority=s}get priority(){return this.name}set priority(n){this.setPriority(n)}get needsUpdate(){return this.updating||this.task.running}schedule(n,s,a){return this._queue.push(n,s,a)}reschedule(n,s,a){return this._queue.unshift(n,s,a)}processQueue(n){this._queue.runTask(n)}};d([f({constructOnly:!0})],r.prototype,"task",void 0),d([f({readOnly:!0})],r.prototype,"updating",null),r=d([$("esri.views.support.SchedulerTask")],r);class i{constructor(){this._begin=typeof performance<"u"?performance.now():0,this._budget=0,this._state=Ks.IDLE,this._didWork=!1,this._enabled=!0}run(s){return!this.done&&(s()===!0&&(this._didWork=!0),!0)}get done(){return this._didWork&&this.elapsed>=this._budget&&this._enabled}get budget(){return this._budget}madeProgress(){this._didWork=!0}get state(){return this._state}get enabled(){return this._enabled}set enabled(s){this._enabled=s}reset(s,a){this._begin=this.now(),this._budget=s,this._state=a,this._didWork=!1}get remaining(){return Math.max(this._budget-this.elapsed,0)}now(){return performance.now()}get elapsed(){return performance.now()-this._begin}resetProgress(){this._didWork=!1}get hasProgressed(){return this._didWork}}e.Budget=i})(LN||(LN={})),function(e){e.SCHEDULED="s",e.READY="r",e.WAITING="w",e.IDLE="i"}($_||($_={}));const y6=(()=>{const e=new LN.Budget;return e.enabled=!1,e})();class Rat{remove(){}processQueue(){}schedule(t,r,i){try{if(bs(r)){const n=br();return i?Promise.resolve(i(n)):Promise.reject(n)}return JW(t(y6))}catch(n){return Promise.reject(n)}}reschedule(t,r,i){return this.schedule(t,r,i)}}const d9=new Rat,vP=Number.MAX_SAFE_INTEGER;let v4=class extends xe{constructor(e,t){var r;super({}),this._stage=e,this._textureRequests=new Map,this._frameTask=(r=t==null?void 0:t.registerTask(bt.TEXTURE_UNLOAD))!=null?r:d9}normalizeCtorArgs(){return{}}destroy(){super.destroy(),this._frameTask.remove(),this._textureRequests.forEach(e=>this._releaseTextureRequest(e)),this._textureRequests.clear()}get updating(){return this._frameTask.updating}fromData(e,t,r){const i=this.makeUid(e);let n=this._textureRequests.get(i);return n||(n={referenceCount:0,texture:t(),textureAsync:null,abortController:null,onRemove:r},this._stage&&(this._stage.add(n.texture),this._stage.loadImmediate(n.texture)),this._textureRequests.set(i,n)),n.referenceCount++,{uid:i,texture:n.texture,release:()=>this._release(i)}}_release(e){const t=this._textureRequests.get(e);t?(t.referenceCount<1&&console.warn("TextureCollection: reference count is < 1 for "+e),t.referenceCount--,t.referenceCount<1&&this._frameTask.schedule(()=>this._releaseNow(e))):console.warn(`TextureCollection: texture doesn't exist: '${e}'`)}get test(){return{textureRequests:this._textureRequests}}_releaseNow(e){if(!this._textureRequests)return;const t=this._textureRequests.get(e);!t||t.referenceCount>0||(this._releaseTextureRequest(t),this._textureRequests.delete(e))}_releaseTextureRequest(e){var t;e.onRemove&&e.onRemove(),e.texture?(t=this._stage)==null||t.remove(e.texture):e.abortController&&(e.abortController.abort(),e.abortController=null)}makeUid(e,t=null){return _(t)?`${e}.${t}px`:e}};d([f()],v4.prototype,"_frameTask",void 0),d([f()],v4.prototype,"updating",null),v4=d([$("esri.views.3d.support.TextureCollection")],v4);var Gfe;(function(e){e[e.Left=0]="Left",e[e.Middle=1]="Middle",e[e.Right=2]="Right"})(Gfe||(Gfe={}));const iEe=["click","double-click","immediate-click","immediate-double-click","hold","drag","key-down","key-up","pointer-down","pointer-move","pointer-up","pointer-drag","mouse-wheel","pointer-enter","pointer-leave","gamepad","focus","blur"],nEe={};function sEe(e){return!!nEe[e]}function Oat(e){for(const t of e)if(!sEe(t))return!1;return!0}iEe.forEach(e=>{nEe[e]=!0});class Mat{constructor(t){this.handlers=new Map,this.counter=0,this.handlerCounts=new Map,this.view=t,this.inputManager=null}connect(t){t&&this.disconnect(),this.inputManager=t,this.handlers.forEach(({handler:r,priority:i},n)=>this.inputManager.installHandlers(n,[r],i))}disconnect(){this.inputManager&&this.handlers.forEach((t,r)=>this.inputManager.uninstallHandlers(r)),this.inputManager=null}destroy(){this.disconnect(),this.handlers.clear(),this.view=null}on(t,r,i,n){const s=Array.isArray(t)?t:t.split(",");if(!Oat(s))return s.some(sEe)&&console.error("Error: registering input events and other events on the view at the same time is not supported."),null;let a,o;Array.isArray(r)?o=r:(a=r,o=[]),typeof i=="function"?a=i:n=i,n=n!=null?n:Lv.DEFAULT;const l=this._createUniqueGroupName(),c=new Pat(this.view,s,o,a);this.handlers.set(l,{handler:c,priority:n});for(const u of s){const h=this.handlerCounts.get(u)||0;this.handlerCounts.set(u,h+1)}return this.inputManager&&this.inputManager.installHandlers(l,[c],n),{remove:()=>this._removeHandler(l,s)}}hasHandler(t){return!!this.handlerCounts.get(t)}_removeHandler(t,r){if(this.handlers.has(t)){this.handlers.delete(t);for(const i of r){const n=this.handlerCounts.get(i);n===void 0?console.error("Trying to remove handler for event that has no handlers registered: ",i):n===1?this.handlerCounts.delete(i):this.handlerCounts.set(i,n-1)}}this.inputManager&&this.inputManager.uninstallHandlers(t)}_createUniqueGroupName(){return this.counter+=1,`viewEvents_${this.counter}`}}class Pat extends ho{constructor(t,r,i,n){super(!0),this.view=t;for(const s of r)switch(s){case"click":this.registerIncoming("click",i,a=>n(this._wrapClick(a)));break;case"double-click":this.registerIncoming("double-click",i,a=>n(this._wrapDoubleClick(a)));break;case"immediate-click":this.registerIncoming("immediate-click",i,a=>n(this._wrapImmediateClick(a)));break;case"immediate-double-click":this.registerIncoming("immediate-double-click",i,a=>n(this._wrapImmediateDoubleClick(a)));break;case"hold":this.registerIncoming("hold",i,a=>n(this._wrapHold(a)));break;case"drag":this.registerIncoming("drag",i,a=>{const o=this._wrapDrag(a);o&&n(o)});break;case"key-down":this.registerIncoming("key-down",i,a=>n(this._wrapKeyDown(a)));break;case"key-up":this.registerIncoming("key-up",i,a=>n(this._wrapKeyUp(a)));break;case"pointer-down":this.registerIncoming("pointer-down",i,a=>n(this._wrapPointer(a,"pointer-down")));break;case"pointer-move":this.registerIncoming("pointer-move",i,a=>n(this._wrapPointer(a,"pointer-move")));break;case"pointer-up":this.registerIncoming("pointer-up",i,a=>n(this._wrapPointer(a,"pointer-up")));break;case"pointer-drag":this.registerIncoming("pointer-drag",i,a=>n(this._wrapPointerDrag(a)));break;case"mouse-wheel":this.registerIncoming("mouse-wheel",i,a=>n(this._wrapMouseWheel(a)));break;case"pointer-enter":this.registerIncoming("pointer-enter",i,a=>n(this._wrapPointer(a,"pointer-enter")));break;case"pointer-leave":this.registerIncoming("pointer-leave",i,a=>n(this._wrapPointer(a,"pointer-leave")));break;case"gamepad":this.registerIncoming("gamepad",i,a=>{n(this._wrapGamepad(a))});break;case"focus":this.registerIncoming("focus",i,a=>{n(this._wrapFocus(a))});break;case"blur":this.registerIncoming("blur",i,a=>{n(this._wrapBlur(a))})}}_wrapFocus(t){return{type:"focus",timestamp:t.timestamp,native:t.data.native,cancelable:t.cancelable,stopPropagation:()=>t.stopPropagation(),async:r=>t.async(r),preventDefault:()=>t.preventDefault()}}_wrapBlur(t){return{type:"blur",timestamp:t.timestamp,native:t.data.native,cancelable:t.cancelable,stopPropagation:()=>t.stopPropagation(),async:r=>t.async(r),preventDefault:()=>t.preventDefault()}}_wrapClick(t){const{pointerType:r,button:i,buttons:n,x:s,y:a,native:o,eventId:l}=t.data,{cancelable:c,timestamp:u}=t;return{type:"click",pointerType:r,button:i,buttons:n,x:s,y:a,native:o,timestamp:u,screenPoint:Su(s,a),mapPoint:this._getMapPoint(s,a),eventId:l,cancelable:c,stopPropagation:()=>t.stopPropagation(),async:h=>t.async(h),preventDefault:()=>t.preventDefault()}}_wrapDoubleClick(t){const{pointerType:r,button:i,buttons:n,x:s,y:a,native:o,eventId:l}=t.data,{cancelable:c,timestamp:u}=t;return{type:"double-click",pointerType:r,button:i,buttons:n,x:s,y:a,native:o,timestamp:u,mapPoint:this._getMapPoint(s,a),eventId:l,cancelable:c,stopPropagation:()=>t.stopPropagation(),async:h=>t.async(h),preventDefault:()=>t.preventDefault()}}_wrapImmediateClick(t){const{pointerType:r,button:i,buttons:n,x:s,y:a,native:o,eventId:l}=t.data,c=o.pointerId,{cancelable:u,timestamp:h}=t;return{type:"immediate-click",pointerId:c,pointerType:r,button:i,buttons:n,x:s,y:a,native:o,timestamp:h,mapPoint:this._getMapPoint(s,a),eventId:l,cancelable:u,stopPropagation:()=>t.stopPropagation(),async:p=>t.async(p),preventDefault:()=>t.preventDefault()}}_wrapImmediateDoubleClick(t){const{pointerType:r,button:i,buttons:n,x:s,y:a,native:o,eventId:l}=t.data,c=o.pointerId,{cancelable:u,timestamp:h}=t;return{type:"immediate-double-click",pointerId:c,pointerType:r,button:i,buttons:n,x:s,y:a,native:o,timestamp:h,mapPoint:this._getMapPoint(s,a),eventId:l,cancelable:u,stopPropagation:()=>t.stopPropagation(),async:p=>t.async(p),preventDefault:()=>t.preventDefault()}}_wrapHold(t){const{pointerType:r,button:i,buttons:n,x:s,y:a,native:o}=t.data,{cancelable:l,timestamp:c}=t;return{type:"hold",pointerType:r,button:i,buttons:n,x:s,y:a,native:o,timestamp:c,mapPoint:this._getMapPoint(s,a),cancelable:l,stopPropagation:()=>t.stopPropagation(),async:u=>t.async(u),preventDefault:()=>t.preventDefault()}}_getMapPoint(t,r){return this.view.toMap(Su(t,r),{exclude:[]})}_wrapDrag(t){const r=t.data,{x:i,y:n}=r.center,{action:s,pointerType:a,button:o}=r;if(s==="start"&&(this.latestDragStart=r),!this.latestDragStart)return;const l=r.pointer.native,c=r.buttons,{cancelable:u,timestamp:h}=t,p={x:this.latestDragStart.center.x,y:this.latestDragStart.center.y};return s==="end"&&(this.latestDragStart=void 0),{type:"drag",action:s,x:i,y:n,origin:p,pointerType:a,button:o,buttons:c,radius:r.radius,angle:md(r.angle),native:l,timestamp:h,cancelable:u,stopPropagation:()=>t.stopPropagation(),async:m=>t.async(m),preventDefault:()=>t.preventDefault()}}_wrapKeyDown(t){const{key:r,repeat:i,native:n}=t.data,{cancelable:s,timestamp:a}=t;return{type:"key-down",key:r,repeat:i,native:n,timestamp:a,cancelable:s,stopPropagation:()=>t.stopPropagation(),async:o=>t.async(o),preventDefault:()=>t.preventDefault()}}_wrapKeyUp(t){const{key:r,native:i}=t.data,{cancelable:n,timestamp:s}=t;return{type:"key-up",key:r,native:i,timestamp:s,cancelable:n,stopPropagation:()=>t.stopPropagation(),async:a=>t.async(a),preventDefault:()=>t.preventDefault()}}_wrapPointer(t,r){const{x:i,y:n,button:s,buttons:a,native:o,eventId:l}=t.data,c=o.pointerId,u=o.pointerType,{cancelable:h,timestamp:p}=t;return{type:r,x:i,y:n,pointerId:c,pointerType:u,button:s,buttons:a,native:o,timestamp:p,eventId:l,cancelable:h,stopPropagation:()=>t.stopPropagation(),async:m=>t.async(m),preventDefault:()=>t.preventDefault()}}_wrapPointerDrag(t){const{x:r,y:i,buttons:n,native:s,eventId:a}=t.data.currentEvent,{button:o}=t.data.startEvent,l=t.data.startEvent.native.pointerId,c=t.data.startEvent.native.pointerType,u=t.data.action,h={x:t.data.startEvent.x,y:t.data.startEvent.y},{cancelable:p,timestamp:m}=t;return{type:"pointer-drag",x:r,y:i,pointerId:l,pointerType:c,button:o,buttons:n,action:u,origin:h,native:s,timestamp:m,eventId:a,cancelable:p,stopPropagation:()=>t.stopPropagation(),async:g=>t.async(g),preventDefault:()=>t.preventDefault()}}_wrapMouseWheel(t){const{cancelable:r,data:i,timestamp:n}=t,{x:s,y:a,deltaY:o,native:l}=i;return{type:"mouse-wheel",x:s,y:a,deltaY:o,native:l,timestamp:n,cancelable:r,stopPropagation:()=>t.stopPropagation(),async:c=>t.async(c),preventDefault:()=>t.preventDefault()}}_wrapGamepad(t){const{action:r,state:i,device:n}=t.data,{cancelable:s,timestamp:a}=t,{buttons:o,axes:l}=i;return{type:"gamepad",device:n,timestamp:a,action:r,buttons:o,axes:l,cancelable:s,stopPropagation:()=>t.stopPropagation(),async:c=>t.async(c),preventDefault:()=>t.preventDefault()}}}var $A,jfe,qfe;(function(e){e[e.USER=0]="USER",e[e.MANAGER=1]="MANAGER"})($A||($A={})),function(e){e[e.None=0]="None",e[e.Unfocused=1]="Unfocused",e[e.Focused=2]="Focused",e[e.Unselected=4]="Unselected",e[e.Selected=8]="Selected",e[e.All=15]="All"}(jfe||(jfe={})),function(e){e[e.None=0]="None",e[e.Custom1=16]="Custom1",e[e.Custom2=32]="Custom2",e[e.Custom3=64]="Custom3",e[e.Custom4=128]="Custom4",e[e.Custom5=256]="Custom5",e[e.Custom6=512]="Custom6",e[e.Custom7=1024]="Custom7",e[e.Custom8=2048]="Custom8",e[e.Custom9=4096]="Custom9",e[e.Custom10=8192]="Custom10",e[e.Custom11=16384]="Custom11",e[e.Custom12=32768]="Custom12",e[e.All=65520]="All"}(qfe||(qfe={}));const Iat=fe.getLogger("esri.views.interactive.interactiveToolUtils");function $at(e){return[e.on("before-add",t=>{const r=t.item;if(r==null||e.includes(r))return Iat.warn("Tool is either already in the list of tools or tool is `null`. Not adding tool."),void t.preventDefault();r.onAdd()}),e.on("after-remove",t=>{const r=t.item;r.visible=!1,r.active&&(r.view.activeTool=null),r.destroy()})]}function DN(e){return e.visible&&e.getEditableFlag($A.USER)&&e.getEditableFlag($A.MANAGER)}function _0(e){return Su(e.x,e.y)}function gLt(e){return tn(e.x,e.y)}function aEe(e,t){const r=(e instanceof HTMLElement?e:e.surface).getBoundingClientRect();return Su(t.clientX-r.left,t.clientY-r.top)}function Hfe(e,t){return t instanceof Event?aEe(e,t):_0(t)}function Wfe(e){if(e instanceof Event)return!0;if(typeof e=="object"&&"type"in e)switch(e.type){case"click":case"double-click":case"pointer-down":case"pointer-drag":case"pointer-enter":case"pointer-leave":case"pointer-up":case"pointer-move":case"immediate-click":case"immediate-double-click":case"hold":case"drag":case"mouse-wheel":return!0;default:return!1}return!1}class Lat{constructor(){this._pointerLocations=new Map,this._hoveredManipulators=new Map,this._grabbedManipulators=new Map,this._draggedManipulators=new Map,this._stopDrag=!1,this._currentlyActiveTool=null,this._revertToActiveTool=!1,this._cursor=null}get cursor(){return this._cursor}handleInputEvent(t,r){const i=()=>t.stopPropagation();switch(t.type){case"pointer-move":Xfe(t.pointerType)&&this._pointerLocations.set(t.pointerId,{x:t.x,y:t.y,pointerType:t.pointerType});break;case"drag":this._grabbedManipulators.size>0&&(this._stopDrag=!0),this._stopDrag&&(i(),t.action==="end"&&(this._stopDrag=!1));break;case"pointer-down":{if(!Yfe(t))break;const n=_0(t),s=this._intersect(n,t.pointerType,r.forEachTool);if(R(s))break;const a=this._findToolAndManipulatorByKey(s,r.forEachTool,_P),o=ys(a,c=>c.manipulator),l=ys(a,c=>c.tool);!(_(o)&&_(l)&&o.interactive)||o.grabbable&&o.grabbableForEvent(t)||!o.grabbing||o.dragging||this._ungrabManipulatorBeforeDragging(o,l,t),_(o)&&o.interactive&&o.grabbable&&o.grabbableForEvent(t)&&!o.grabbing&&(this._grabbedManipulators.set(t.pointerId,{key:s,start:n,pointerType:t.pointerType}),this._grabbedManipulators.size===1&&r.activeTool!==s.tool&&(this._currentlyActiveTool=r.activeTool,this._revertToActiveTool=!0,r.setActiveTool(s.tool)),o.grabbing=!0,o.events.emit("grab-changed",{action:"start",pointerType:t.pointerType,screenPoint:n}),i());break}case"pointer-up":this._handlePointerEnd(t,r);break;case"pointer-drag":{if(!Yfe(t))break;const n=this._grabbedManipulators.get(t.pointerId),s=this._draggedManipulators.get(t.pointerId),a=ys(n||s,({key:u})=>u),o=this._findManipulatorByKey(a,r.forEachTool);if(R(o))break;const l=_0(t);l.x=Le(l.x,0,r.view.width),l.y=Le(l.y,0,r.view.height);const c=(n||s).start;switch(t.action){case"start":case"update":t.action!=="update"&&this._grabbedManipulators.size!==1||(o.dragging=!0,s?o.events.emit("drag",{action:"update",start:c,screenPoint:l}):o.events.emit("drag",{action:"start",start:c,screenPoint:l,pointerType:t.pointerType}),this._draggedManipulators.set(t.pointerId,{key:a,start:c}));break;case"end":o.dragging=!1,s&&o.events.emit("drag",{action:"end",start:c,screenPoint:l}),this._draggedManipulators.delete(t.pointerId),this._handlePointerEnd(t,r)}i();break}case"immediate-click":{const n=_0(t),s=this._intersect(n,t.pointerType,r.forEachTool),a=this._findToolAndManipulatorByKey(s,r.forEachTool,_P);if(Dat(t)||r.forEachTool(u=>{if((!_(a)||a.tool!==u||u.automaticManipulatorSelection)&&u.manipulators){let h=!1;u.manipulators.forEach(({manipulator:p})=>{p.selected&&(p.selected=!1,h=!0)}),h&&u.manipulatorSelectionChanged&&u.manipulatorSelectionChanged()}}),R(a))break;const{manipulator:o,tool:l}=a;if(!o.interactive)break;o.selectable&&l.automaticManipulatorSelection&&(o.selected=!o.selected,l.manipulatorSelectionChanged&&l.manipulatorSelectionChanged());const c=t.native.shiftKey;o.events.emit("immediate-click",{screenPoint:n,button:t.button,pointerType:t.pointerType,shiftKey:c,stopPropagation:i});break}case"click":{const n=_0(t),s=this._intersect(n,t.pointerType,r.forEachTool),a=this._findManipulatorByKey(s,r.forEachTool);if(R(a)||!a.interactive)break;const o=t.native.shiftKey;a.events.emit(t.type,{screenPoint:n,button:t.button,pointerType:t.pointerType,shiftKey:o}),i();break}case"double-click":{const n=_0(t),s=this._intersect(n,t.pointerType,r.forEachTool),a=this._findManipulatorByKey(s,r.forEachTool);if(R(a)||!a.interactive)break;const o=t.native.shiftKey;a.events.emit("double-click",{screenPoint:n,button:t.button,pointerType:t.pointerType,shiftKey:o,stopPropagation:i});break}case"immediate-double-click":{const n=_0(t),s=this._intersect(n,t.pointerType,r.forEachTool),a=this._findManipulatorByKey(s,r.forEachTool);if(R(a)||!a.interactive)break;const o=t.native.shiftKey;a.events.emit("immediate-double-click",{screenPoint:n,button:t.button,pointerType:t.pointerType,shiftKey:o,stopPropagation:i});break}}this._onFocusChange(r.forEachTool)}_ungrabManipulatorBeforeDragging(t,r,i){t.grabbing=!1,t.events.emit("grab-changed",{action:"end",pointerType:i.pointerType,screenPoint:_0(i)}),this._grabbedManipulators.forEach(({key:n},s)=>{n.tool===r&&r.manipulators.findById(n.manipulatorId)===t&&this._grabbedManipulators.delete(s)})}_handlePointerEnd(t,r){const i=ys(this._grabbedManipulators.get(t.pointerId),({key:s})=>s),n=this._findManipulatorByKey(i,r.forEachTool);_(n)&&!n.dragging&&(this._grabbedManipulators.size===1&&this._draggedManipulators.size===0&&this._revertToActiveTool&&(r.setActiveTool(this._currentlyActiveTool),this._revertToActiveTool=!1,this._currentlyActiveTool=null),n.grabbing&&(n.grabbing=!1,n.events.emit("grab-changed",{action:"end",pointerType:t.pointerType,screenPoint:_0(t)})),this._grabbedManipulators.delete(t.pointerId))}_cursorFromMap(t,r){let i=null;return vs(t,({key:n})=>{const s=this._findManipulatorByKey(n,r);return!!(_(s)&&s.interactive&&"cursor"in s&&s.cursor)&&(i=s.cursor,!0)}),i}_onFocusChange(t){this._updateCursor(t),this._updateFocusedManipulatorTools(t)}_updateCursor(t){this._grabbedManipulators.size>0?this._cursor=this._cursorFromMap(this._grabbedManipulators,t)||"grabbing":this._hoveredManipulators.size>0?this._cursor=this._cursorFromMap(this._hoveredManipulators,t)||"pointer":this._cursor=null}_updateFocusedManipulatorTools(t){const r=new Set;this._grabbedManipulators.forEach(({key:{tool:i}})=>{r.add(i)}),this._hoveredManipulators.forEach(({key:{tool:i}})=>{r.add(i)}),t(i=>{i.hasFocusedManipulators=r.has(i)})}clearPointers(t,r,i=!0,n){const s=a=>a.tool===t&&(R(n)||a.manipulatorId===n);this._grabbedManipulators.forEach(({key:a,pointerType:o},l)=>{if(s(a)){this._grabbedManipulators.delete(l);const c=this._findManipulatorByKey(a,r);_(c)&&(c.grabbing=!1,c.events.emit("grab-changed",{action:"end",screenPoint:null,pointerType:o}))}}),this._draggedManipulators.forEach(({key:a},o)=>{if(s(a)){this._draggedManipulators.delete(o);const l=this._findManipulatorByKey(a,r);_(l)&&(l.dragging=!1,l.events.emit("drag",{action:"cancel"}))}}),i&&this._hoveredManipulators.forEach(({key:a},o)=>{if(s(a)){this._hoveredManipulators.delete(o);const l=this._findManipulatorByKey(a,r);_(l)&&(l.hovering=!1)}}),this._onFocusChange(r)}_intersect(t,r,i){let n=null;return i(s=>{if(s.manipulators==null||!DN(s))return!1;const a=s.manipulators.intersect(t,r);return!R(a)&&(n={manipulatorId:a.id,tool:s},!0)}),n}updateHoveredStateFromKnownPointers(t){this._pointerLocations.forEach((r,i)=>{this._updateHoveredStateForPointerAtScreenPosition(Su(r.x,r.y),i,r.pointerType,t)})}handleHoverEvent(t,r){t.type!=="pointer-up"&&t.type!=="immediate-click"&&t.type!=="pointer-move"||!Xfe(t.pointerType)||this._updateHoveredStateForPointerAtScreenPosition(_0(t),t.pointerId,t.pointerType,r)}_updateHoveredStateForPointerAtScreenPosition(t,r,i,n){const s=this._intersect(t,i,n);let a=this._findManipulatorByKey(s,n);const o=ys(this._hoveredManipulators.get(r),({key:c})=>c),l=this._findManipulatorByKey(o,n);_(a)&&!a.interactive&&(a=null),l!==a&&(_(l)&&(l.hovering=!1),_(a)?(a.hovering=!0,this._hoveredManipulators.set(r,{key:s})):this._hoveredManipulators.delete(r),this._onFocusChange(n))}_findManipulatorByKey(t,r){return this._findToolAndManipulatorByKey(t,r,_P)?_P.manipulator:null}_findToolAndManipulatorByKey(t,r,i){return R(t)?null:(i.tool=null,i.manipulator=null,r(n=>{if(n!==t.tool||n.manipulators==null||!DN(n))return!1;const s=n.manipulators.findById(t.manipulatorId);return!!_(s)&&(i.manipulator=s,i.tool=n,!0)}),i.manipulator?i:null)}}function Xfe(e){return e==="mouse"}function Yfe(e){return e.pointerType!=="mouse"||e.button===0}function Dat(e){return!!e.native.shiftKey}const _P={manipulator:null,tool:null},Fat=fe.getLogger("esri.views.ToolViewManager"),Zfe="attached",mj="tools";let mg=class extends N5{constructor(e){super(e),this._manipulatorState=new Lat,this.tools=new lt,this.cursor=null,this._forEachTool=t=>{for(const r of this.tools.items)if(t(r))return}}initialize(){this.handles.add([this.view.on(iEe,e=>{this._handleInputEvent(e)},Lv.TOOL),...$at(this.tools),this.tools.on("before-remove",({item:e})=>{this._manipulatorState.clearPointers(e,this._forEachTool)}),this.tools.on("change",()=>{this._refreshToolWatchers()})])}destroy(){this.detach(),this.handles.removeAll()}set activeTool(e){if(_(e)&&!this.view.ready)return void Fat.error("Cannot set active tool while view is not ready.");if(e===this.activeTool)return;const t=this.activeTool;this._set("activeTool",e),_(t)&&t.deactivate(),_(e)&&e.activate(),this._removeIncompleteTools(e);const r=R(this.activeTool);for(const i of this.tools){i.setEditableFlag($A.MANAGER,r||i===this.activeTool);const n=DN(i);!r&&n||this._manipulatorState.clearPointers(i,this._forEachTool,!n)}this._updateCursor()}get updating(){var e,t;return this.updatingHandles.updating||this.tools.some(r=>r.updating)||((t=(e=this.textures)==null?void 0:e.updating)!=null?t:!1)}attach(){this.view.type==="3d"?(this._set("textures",new v4(this.view._stage,this.view.resourceController.scheduler)),this.handles.add([re(()=>{const{state:e}=this.view;return"camera"in e&&e.camera},()=>{this._forEachManipulator(e=>{e.onViewChange!=null&&e.onViewChange()})}),this.view.elevationProvider.on("elevation-change",e=>{this._forEachManipulator(t=>{t.onElevationChange!=null&&t.onElevationChange(e)})}),Hh(()=>this._set("textures",ct(this.textures)))],Zfe)):this.handles.add(re(()=>this.view.extent,()=>{this._forEachManipulator(e=>{e.onViewChange!=null&&e.onViewChange()})}))}detach(){_(this.activeTool)&&(this.activeTool=null),this.tools.removeAll(),this.handles.remove(Zfe)}_forEachManipulator(e){this._forEachTool(t=>{t.manipulators&&t.manipulators.forEach(({manipulator:r})=>e(r,t))})}_handleInputEvent(e){let t=!1;const r={...e,stopPropagation:()=>{t=!0,e.stopPropagation()}};_(this.activeTool)?this.activeTool.handleInputEvent&&this.activeTool.handleInputEvent(r):this._forEachTool(i=>{!t&&i.visible&&i.handleInputEvent(r)}),!t&&e.type==="key-down"&&e.key==="Escape"&&this.activeTool&&(e.stopPropagation(),this.activeTool=null),this._manipulatorState.handleInputEvent(r,{forEachTool:this._forEachTool,activeTool:this.activeTool,setActiveTool:i=>{this.activeTool=i},view:this.view}),!t&&_(this.activeTool)&&this.activeTool.handleInputEventAfter(r),this._manipulatorState.handleHoverEvent(r,this._forEachTool),this._updateCursor()}_refreshToolWatchers(){this.handles.remove(mj),this._forEachTool(e=>{if(e instanceof xe){const t=re(()=>[e.cursor,e.visible,e.editable],()=>{DN(e)||this._manipulatorState.clearPointers(e,this._forEachTool),this._updateCursor()});this.handles.add(t,mj)}e.manipulators&&this.handles.add(e.manipulators.on("change",t=>{t.removed.forEach(({id:r})=>{this._manipulatorState.clearPointers(e,this._forEachTool,!0,r)}),this._manipulatorState.updateHoveredStateFromKnownPointers(this._forEachTool),this._updateCursor()}),mj)}),this._manipulatorState.updateHoveredStateFromKnownPointers(this._forEachTool),this._updateCursor()}_updateCursor(){const e=this._manipulatorState.cursor;let t=e;this._forEachTool(r=>!(!_(r.cursor)||!r.visible||!R(e)&&r.preferManipulatorCursor)&&(t=r.cursor,!0)),this._get("cursor")!==t&&this._set("cursor",t)}_removeIncompleteTools(e){this.tools.filter(t=>(R(e)||t!==e)&&!t.created&&t.removeIncompleteOnCancel).forEach(t=>{this.tools.remove(t)})}};d([f({constructOnly:!0,nonNullable:!0})],mg.prototype,"view",void 0),d([f({readOnly:!0,nonNullable:!0})],mg.prototype,"textures",void 0),d([f({value:null})],mg.prototype,"activeTool",null),d([f({readOnly:!0,type:lt})],mg.prototype,"tools",void 0),d([f({readOnly:!0})],mg.prototype,"cursor",void 0),d([f({readOnly:!0})],mg.prototype,"updating",null),mg=d([$("esri.views.ToolViewManager")],mg);const Nat=mg;let SS=class extends xe{constructor(e){super(),this.nativeIndex=null,this._detectedDeviceType="unknown",e.mapping==="standard"?this._detectedDeviceType="standard":kat.test(e.id)?this._detectedDeviceType="spacemouse":this._detectedDeviceType="unknown",this.nativeIndex=e.index}get native(){return(navigator.getGamepads?navigator.getGamepads():[])[this.nativeIndex]}get deviceType(){return this._detectedDeviceType}get axisThreshold(){return Vat[this.deviceType]}};d([f({nonNullable:!0,readOnly:!0})],SS.prototype,"nativeIndex",void 0),d([f({type:String,readOnly:!0})],SS.prototype,"deviceType",null),d([f({type:Number,readOnly:!0})],SS.prototype,"axisThreshold",null),SS=d([$("esri.views.input.gamepad.GamepadInputDevice")],SS);const kat=new RegExp("^(3dconnexion|space(mouse|navigator|pilot|explorer))","i"),Vat={standard:.15,spacemouse:.025,unknown:0},Wne=SS;let XE=class extends xe{constructor(...e){super(...e),this.devices=new lt,this.enabledFocusMode="document"}};d([f({type:lt.ofType(Wne),readOnly:!0})],XE.prototype,"devices",void 0),d([f({type:["document","view","none"]})],XE.prototype,"enabledFocusMode",void 0),XE=d([$("esri.views.input.gamepad.GamepadSettings")],XE);const zat=XE;let XL=class extends xe{constructor(){super(...arguments),this.gamepad=new zat}};d([f({readOnly:!0})],XL.prototype,"gamepad",void 0),XL=d([$("esri.views.input.Input")],XL);const Uat=XL;let f1=class extends xe{constructor(e){super(e),this.enabled=!0,this.device=null,this.mode="pan",this.tiltDirection="forward-down",this.velocityFactor=1}};d([f({type:Boolean,nonNullable:!0})],f1.prototype,"enabled",void 0),d([f({type:Wne})],f1.prototype,"device",void 0),d([f({type:["pan","zoom"],nonNullable:!0})],f1.prototype,"mode",void 0),d([f({type:["forward-down","forward-up"],nonNullable:!0})],f1.prototype,"tiltDirection",void 0),d([f({type:Number,nonNullable:!0})],f1.prototype,"velocityFactor",void 0),f1=d([$("esri.views.navigation.gamepad.GamepadSettings")],f1);const oEe=f1;let q2=class extends xe{constructor(e){super(e),this.browserTouchPanEnabled=!0,this.gamepad=new oEe,this.momentumEnabled=!0,this.mouseWheelZoomEnabled=!0}};d([f({type:Boolean})],q2.prototype,"browserTouchPanEnabled",void 0),d([f({type:oEe,nonNullable:!0})],q2.prototype,"gamepad",void 0),d([f({type:Boolean})],q2.prototype,"momentumEnabled",void 0),d([f({type:Boolean})],q2.prototype,"mouseWheelZoomEnabled",void 0),q2=d([$("esri.views.navigation.Navigation")],q2);const lEe=q2;function yLt(e,t,r){const i=cEe(e),n=t,s=Bat(i,n,r);if(i){const a=Ex.deriveUnitFromSR(i,e.spatialReference).heightUnit;if(!r&&a!==i.heightUnit){const o=new k("layerview:unmatched-height-unit",`The vertical units of the layer must match the horizontal units (${a})`,{horizontalUnit:a});return new k("layerview:unsupported-height-model-info","The vertical coordinate system of the layer is not supported",{heightModelInfo:i,error:o})}}if(!Gat(e)||s===zc.Unsupported)return new k("layerview:unsupported-height-model-info","The vertical coordinate system of the layer is not supported",{heightModelInfo:i});switch(s){case zc.Units:{const a=i.heightUnit||"unknown",o=n.heightUnit||"unknown",l=new k("layerview:incompatible-height-unit",`The vertical units of the layer (${a}) must match the vertical units of the scene (${o})`,{layerUnit:a,sceneUnit:o});return new k("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:i,sceneHeightModelInfo:n,error:l})}case zc.HeightModel:{const a=i.heightModel||"unknown",o=n.heightModel||"unknown",l=new k("layerview:incompatible-height-model",`The height model of the layer (${a}) must match the height model of the scene (${o})`,{layerHeightModel:a,sceneHeightModel:o});return new k("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:i,sceneHeightModelInfo:n,error:l})}case zc.CRS:{const a=i.vertCRS||"unknown",o=n.vertCRS||"unknown",l=new k("layerview:incompatible-vertical-datum",`The vertical datum of the layer (${a}) must match the vertical datum of the scene (${o})`,{layerDatum:a,sceneDatum:o});return new k("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:i,sceneHeightModelInfo:n,error:l})}}return null}function Bat(e,t,r){if(!Qfe(e)||!Qfe(t))return zc.Unsupported;if(e==null||t==null)return zc.Ok;if(!r&&e.heightUnit!==t.heightUnit)return zc.Units;if(e.heightModel!==t.heightModel)return zc.HeightModel;switch(e.heightModel){case"gravity-related-height":return zc.Ok;case"ellipsoidal":return e.vertCRS===t.vertCRS?zc.Ok:zc.CRS;default:return zc.Unsupported}}var zc;function Qfe(e){return e==null||e.heightModel!=null&&e.heightUnit!=null}function Gat(e){return"heightModelInfo"in e&&e.heightModelInfo!=null||e.spatialReference!=null||!hEe(e)}function cEe(e){const t=e.url&&jw(e.url);return!((e.spatialReference&&e.spatialReference.vcsWkid)==null&&_(t)&&t.serverType==="ImageServer")&&dEe(e)&&e.heightModelInfo?e.heightModelInfo:hEe(e)?Ex.deriveUnitFromSR(qat,e.spatialReference):null}function dEe(e){return"heightModelInfo"in e}function uEe(e){if(e.type==="unknown"||!("capabilities"in e))return!1;switch(e.type){case"csv":case"feature":case"geojson":case"subtype-group":case"ogc-feature":case"wfs":return!0;default:return!1}}function hEe(e){return uEe(e)?!!(e.capabilities&&e.capabilities.data&&e.capabilities.data.supportsZ):fEe(e)}function jat(e){return e.layers!=null||fEe(e)||uEe(e)||dEe(e)}function fEe(e){switch(e.type){case"building-scene":case"elevation":case"integrated-mesh":case"point-cloud":case"scene":case"voxel":return!0;case"line-of-sight":case"base-dynamic":case"base-elevation":case"base-tile":case"bing-maps":case"csv":case"geojson":case"feature":case"subtype-group":case"geo-rss":case"graphics":case"group":case"imagery":case"imagery-tile":case"kml":case"map-image":case"map-notes":case"media":case"ogc-feature":case"open-street-map":case"route":case"stream":case"tile":case"unknown":case"unsupported":case"vector-tile":case"wcs":case"web-tile":case"wfs":case"wms":case"wmts":case null:return!1}return!1}(function(e){e[e.Ok=0]="Ok",e[e.Units=1]="Units",e[e.HeightModel=2]="HeightModel",e[e.CRS=3]="CRS",e[e.Unsupported=4]="Unsupported"})(zc||(zc={}));const qat=new Ex({heightModel:"gravity-related-height"});var Be;function Jfe(e){return e==="global"?Be.Global:Be.Local}function l7(e){return e===Be.Global?"global":"local"}(function(e){e[e.Global=1]="Global",e[e.Local=2]="Local"})(Be||(Be={}));let gJ,gj=null;async function Hat(e){gj||(gj=ie(()=>Promise.resolve().then(()=>zxt),void 0,import.meta.url).then(t=>gJ=t)),await gj,Et(e)}async function pEe(e,t,r,i){if(!e)return null;const n=e.spatialReference;return VV()||mm(n,t)?eO(e,t):gJ?gJ.projectGeometry(e,t,r,i):(await Promise.race([Hat(i),yA(i)]),pEe(e,t,r,i))}let Ni=class extends xe{constructor(e){super(e),this.required={tileInfo:!1,heightModelInfo:!1,extent:!1},this.defaultSpatialReference=null,this.userSpatialReference=null,this.sourcePreloadCount=10,this.priorityCollection=null,this.requiresExtentInSpatialReference=!0,this.suspended=!1,this._projectExtentTask={task:null,input:null,output:null,spatialReference:null}}destroy(){this._projectExtentTask.task&&(this._projectExtentTask.task=qh(this._projectExtentTask.task)),this._set("map",null)}get ready(){return!this._spatialReferenceTask.updating&&!this._tileInfoTask.updating&&!this._extentTask.updating}get heightModelInfoReady(){return!this._heightModelInfoTask.updating}get spatialReference(){return _(this.userSpatialReference)?this.userSpatialReference:this._spatialReferenceTask.spatialReference}get extent(){return this._extentTask.extent}get heightModelInfo(){return this._heightModelInfoTask.heightModelInfo}get vcsWkid(){return this._heightModelInfoTask.vcsWkid}get latestVcsWkid(){return this._heightModelInfoTask.latestVcsWkid}get viewingMode(){return R(this.userSpatialReference)||this.userSpatialReference.equals(this._spatialReferenceTask.spatialReference)?this._spatialReferenceTask.viewingMode:null}get tileInfo(){return this._tileInfoTask.tileInfo}get mapCollections(){var r,i,n,s;const e=(r=this.map)==null?void 0:r.call(this),t=[];return _(this.priorityCollection)&&t.push(this.priorityCollection),t.push({parent:e==null?void 0:e.basemap,layers:(i=e==null?void 0:e.basemap)==null?void 0:i.baseLayers},{layers:e==null?void 0:e.layers},{parent:e==null?void 0:e.ground,layers:(n=e==null?void 0:e.ground)==null?void 0:n.layers},{parent:e==null?void 0:e.basemap,layers:(s=e==null?void 0:e.basemap)==null?void 0:s.referenceLayers}),t}get _allLayers(){return this._collectLayers(this.mapCollections)}get _spatialReferenceTask(){var n;if(this.suspended)return(n=this._get("_spatialReferenceTask"))!=null?n:{updating:!1};const{layers:e,updating:t}=this._allLayers;let r=null;for(const s of e){const a=this._getSupportedSpatialReferences(s);if(a.length>0){const o=this._narrowDownSpatialReferenceCandidates(r,a);_(o)&&(r=o)}if(_(r)&&r.length===1)break}if(t&&(R(r)||r.length!==1))return{updating:!0};const i=this._pickSpatialReferenceCandidate(r);return{spatialReference:_(i)?i.spatialReference:null,viewingMode:_(i)?i.viewingMode:null,updating:!1}}get _tileInfoTask(){var r,i,n,s,a,o,l,c;if(!this.required.tileInfo)return(r=this._get("_tileInfoTask"))!=null?r:{updating:!1};if(!this.spatialReference)return{updating:this._spatialReferenceTask.updating};const{layers:e,updating:t}=this._collectLayers([{parent:(n=(i=this.map)==null?void 0:i.call(this))==null?void 0:n.basemap,layers:(o=(a=(s=this.map)==null?void 0:s.call(this))==null?void 0:a.basemap)==null?void 0:o.baseLayers},{layers:(c=(l=this.map)==null?void 0:l.call(this))==null?void 0:c.layers}]);if(e&&e.length>0&&"tileInfo"in e[0]){const u=e[0].tileInfo;return{tileInfo:u&&u.spatialReference.equals(this.spatialReference)?u:null,updating:!1}}return{updating:t}}get _heightModelInfoTask(){var r,i,n,s;if(!this.required.heightModelInfo||this.suspended&&((r=this._get("_heightModelInfoTask"))==null?void 0:r.heightModelInfo))return(i=this._get("_heightModelInfoTask"))!=null?i:{updating:!1};const{layers:e,updating:t}=this._allLayers;for(const a of e)if(jat(a)){const o=cEe(a);if(o)return{heightModelInfo:o,vcsWkid:(n=a.spatialReference)==null?void 0:n.vcsWkid,latestVcsWkid:(s=a.spatialReference)==null?void 0:s.latestVcsWkid,updating:!1}}return{updating:t}}get _extentCandidatesTask(){var i,n;if(this.suspended||!this.required.extent)return(i=this._get("_extentCandidatesTask"))!=null?i:{updating:!1};if(!this.spatialReference)return{updating:this._spatialReferenceTask.updating};const e=this._allLayers,t=e.updating,r=[];for(const s of e.layers){const a="fullExtents"in s&&s.fullExtents||(_(s.fullExtent)?[s.fullExtent]:[]),o=this.requiresExtentInSpatialReference?null:a[0],l=(n=a.find(c=>c.spatialReference.equals(this.spatialReference)))!=null?n:o;if(l)return{candidates:[{extent:l,layer:s}],updating:!1};if(this._getSupportedSpatialReferences(s).length>0)for(const c of a)r.push({extent:c,layer:s})}return{candidates:r,updating:t}}get _extentTask(){const{candidates:e,updating:t}=this._extentCandidatesTask;if(t)return{updating:t};if(R(e)||e.length===0)return{updating:!1};if(!this.spatialReference)return{updating:this._spatialReferenceTask.updating};const r=this._pickExtentCandidate(e),i=this.spatialReference;return r.extent.equals(this._projectExtentTask.input)&&i.equals(this._projectExtentTask.spatialReference)?{extent:this._projectExtentTask.output,updating:_(this._projectExtentTask.task)&&!this._projectExtentTask.task.finished}:(_(this._projectExtentTask.task)&&(this._projectExtentTask.task=qh(this._projectExtentTask.task)),this._projectExtentTask={input:r.extent.clone(),output:null,spatialReference:i.clone(),task:HR(async n=>{try{const s=await pEe(r.extent,i,r.layer.portalItem,n);this._projectExtentTask={...this._projectExtentTask,task:null,output:s}}catch{if(bs(n))return;this._projectExtentTask={...this._projectExtentTask,task:null}}})},{updating:!0})}_narrowDownSpatialReferenceCandidates(e,t){if(R(e))return t;const r=[],i=(n,s)=>_(n)?_(s)?n===s&&n:n:s;for(const n of e)for(const s of t){if(!n.spatialReference.equals(s.spatialReference))continue;const a=i(n.viewingMode,s.viewingMode);if(a!==!1){r.push({spatialReference:n.spatialReference,viewingMode:a});break}}return r.length>0?r:null}_pickSpatialReferenceCandidate(e){const t=this.defaultSpatialReference;return R(e)||e.length<1?_(t)?{spatialReference:t,viewingMode:null}:null:(_(t)&&e.length>1&&e.some(({spatialReference:r})=>r.equals(t))&&(e=e.filter(({spatialReference:r})=>r.equals(t))),e.length>1&&e.some(({viewingMode:r})=>r!==Be.Local)&&(e=e.filter(({viewingMode:r})=>r!==Be.Local)),e[0])}_getSupportedSpatialReferences(e){const t="supportedSpatialReferences"in e&&e.supportedSpatialReferences||(e.spatialReference?[e.spatialReference]:[]);if(t.length===0)return[];const r=[];for(const i of t){const n=this.getSpatialReferenceSupport({spatialReference:i,layer:e});if(_(n)){const s=_(n.constraints)?n.constraints:[{spatialReference:i,viewingMode:null}];for(const{spatialReference:a,viewingMode:o}of s)(!this.requiresExtentInSpatialReference||R(this.userSpatialReference)||a.equals(this.userSpatialReference))&&r.push({spatialReference:a,viewingMode:o})}}return r}_pickExtentCandidate(e){const t=this.spatialReference;return e.find(({extent:r})=>t.equals(r.spatialReference))||e[0]}_collectLayers(e){var r;if(this._loadMaybe((r=this.map)==null?void 0:r.call(this))!=="loaded")return{layers:[],updating:!0};const t={layers:[],preloading:-1,updating:!1};for(const i of e)if(this._collectCollection(i,t),t.preloading===this.sourcePreloadCount)break;return{layers:t.layers,updating:t.updating}}_collectCollection(e,t){if(e.layers){switch(this._loadMaybe(e.parent)){case"loading":return t.updating=!0,void++t.preloading;case"failed":return}for(const r of e.layers){switch(this._loadMaybe(r)){case"failed":continue;case"loading":t.updating=!0,++t.preloading;break;case"loaded":t.updating||t.layers.push(r),"layers"in r&&this._collectCollection({layers:r.layers},t)}if(t.preloading===this.sourcePreloadCount)break}}}_loadMaybe(e){return e&&"loadStatus"in e?e.loadStatus==="not-loaded"?(e.load(),"loading"):e.loadStatus:"loaded"}};d([f()],Ni.prototype,"required",void 0),d([f({constructOnly:!0})],Ni.prototype,"map",void 0),d([f({constructOnly:!0})],Ni.prototype,"getSpatialReferenceSupport",void 0),d([f()],Ni.prototype,"defaultSpatialReference",void 0),d([f()],Ni.prototype,"userSpatialReference",void 0),d([f()],Ni.prototype,"sourcePreloadCount",void 0),d([f()],Ni.prototype,"priorityCollection",void 0),d([f()],Ni.prototype,"requiresExtentInSpatialReference",void 0),d([f()],Ni.prototype,"suspended",void 0),d([f({readOnly:!0})],Ni.prototype,"ready",null),d([f({readOnly:!0})],Ni.prototype,"heightModelInfoReady",null),d([f({readOnly:!0})],Ni.prototype,"spatialReference",null),d([f({readOnly:!0})],Ni.prototype,"extent",null),d([f({readOnly:!0})],Ni.prototype,"heightModelInfo",null),d([f({readOnly:!0})],Ni.prototype,"vcsWkid",null),d([f({readOnly:!0})],Ni.prototype,"latestVcsWkid",null),d([f({readOnly:!0})],Ni.prototype,"viewingMode",null),d([f({readOnly:!0})],Ni.prototype,"tileInfo",null),d([f({readOnly:!0})],Ni.prototype,"mapCollections",null),d([f({readOnly:!0})],Ni.prototype,"_allLayers",null),d([f({readOnly:!0})],Ni.prototype,"_spatialReferenceTask",null),d([f({readOnly:!0})],Ni.prototype,"_tileInfoTask",null),d([f({readOnly:!0})],Ni.prototype,"_heightModelInfoTask",null),d([f({readOnly:!0})],Ni.prototype,"_extentCandidatesTask",null),d([f()],Ni.prototype,"_extentTask",null),d([f()],Ni.prototype,"_projectExtentTask",void 0),Ni=d([$("esri.views.support.DefaultsFromMap")],Ni);var YL;const wP=fe.getLogger("esri.views.View");let $t=YL=class extends Cm(mn.EventedMixin(XR(xe))){constructor(e){super(e),this._userSpatialReference=null,this._cursor=null,this.allLayerViews=new k5({getCollections:()=>{var t,r,i;return[(t=this.basemapView)==null?void 0:t.baseLayerViews,(r=this.groundView)==null?void 0:r.layerViews,this.layerViews,(i=this.basemapView)==null?void 0:i.referenceLayerViews]},getChildrenFunction:t=>t.layerViews}),this.groundView=null,this.animation=null,this.basemapView=null,this.fatalError=null,this.extent=null,this.graphics=new o7,this.analyses=new i9,this.navigating=!1,this.typeSpecificPreconditionsReady=!0,this.layerViews=new lt,this.magnifier=new rEe,this.padding={left:0,top:0,right:0,bottom:0},this.ready=!1,this.spatialReferenceWarningDelay=1e3,this.supportsGround=!0,this.timeExtent=null,this.type=null,this.scale=null,this.updating=!1,this.initialExtentRequired=!0,this.input=new Uat,this.navigation=new lEe,this.layerViewManager=null,this.analysisViewManager=null,this.isHeightModelInfoRequired=!1,this.width=null,this.height=null,this.resizing=!1,this.suspended=!1,this.viewEvents=new Mat(this),this.persistableViewModels=new lt,this._isValid=!1,this._readyCycleForced=!1,this.handles.add(re(()=>this.preconditionsReady,t=>{var r,i;t?(this._currentSpatialReference=this.spatialReference,YL.views.add(this)):(this._currentSpatialReference=null,YL.views.remove(this)),this.notifyChange("spatialReference"),!t&&this.ready?((r=this.layerViewManager)==null||r.clear(),(i=this.toolViewManager)==null||i.detach(),_(this.analysisViewManager)&&this.analysisViewManager.detach(),this._teardown()):t&&!this.ready&&(this._startup(),_(this.analysisViewManager)&&this.analysisViewManager.attach(),this.toolViewManager.attach())},ti))}initialize(){this.addResolvingPromise(this.validate().then(()=>(this._isValid=!0,td(()=>this.ready)))),this.basemapView=new h1({view:this}),this.layerViewManager=new Tat({view:this,layerViewImporter:{importLayerView:e=>this.importLayerView(e),hasLayerViewModule:e=>this.hasLayerViewModule(e)},supportsGround:this.supportsGround}),this.toolViewManager=new Nat({view:this}),this._setupSpatialReferenceLogger(),this.handles.add([re(()=>this.initialExtentRequired,e=>this.defaultsFromMap.required={...this.defaultsFromMap.required,extent:e},{sync:!0,initial:!0}),re(()=>this.ready,e=>{this.defaultsFromMap&&(this.defaultsFromMap.suspended=e,this.defaultsFromMap.userSpatialReference=e?this.spatialReference:this._userSpatialReference)},{sync:!0}),re(()=>this._userSpatialReference,e=>{this.defaultsFromMap&&(this.defaultsFromMap.userSpatialReference=e)},{sync:!0,initial:!0})])}_setupSpatialReferenceLogger(){let e=null;this.handles.add([re(()=>{var t;return(t=this.defaultsFromMap)==null?void 0:t.ready},t=>{var i;const r=((i=this.map)==null?void 0:i.allLayers.length)>0;if(t&&!this.spatialReference&&r){if(_(e))return;const n=Hh(()=>e=qh(e));e=HR(async s=>{try{await O5(this.spatialReferenceWarningDelay,null,s)}catch{return}finally{e=null}wP.warn("#spatialReference","no spatial reference could be derived from the currently added map layers")}),this.handles.add(n,"spatial-reference-logger-task")}else this.handles.remove("spatial-reference-logger-task")},{sync:!0})])}destroy(){if(this.destroyed)return;this.viewEvents.destroy(),this.allLayerViews.destroy(),this.navigation&&(this.navigation.destroy(),this._set("navigation",null)),this.graphics=ct(this.graphics),this.analyses=ct(this.analyses),this.handles.remove("defaultsFromMap"),this.defaultsFromMap.destroy(),this._set("defaultsFromMap",null),ct(this.analysisViewManager),this.toolViewManager=ct(this.toolViewManager),this.layerViewManager=ct(this.layerViewManager),this.basemapView=ct(this.basemapView),this.invalidate(),this._emitter.clear(),this.handles.removeAll();const e=this.map;this.map=null,e==null||e.destroy()}_startup(){this._set("ready",!0)}_teardown(){this._set("ready",!1)}whenReady(){return Promise.resolve(this)}toMap(){return wP.error("#toMap()","Not implemented on this instance of View"),null}get _defaultsFromMapSettings(){return{}}get defaultsFromMap(){return new Ni({required:{tileInfo:!1,heightModelInfo:!1,extent:!1},map:()=>this.map,getSpatialReferenceSupport:e=>this.getSpatialReferenceSupport(e),...this._defaultsFromMapSettings})}get heightModelInfo(){return this.getDefaultHeightModelInfo()}get interacting(){return this.navigating}get preconditionsReady(){var e;return!(this.fatalError||!this._isValid||this._readyCycleForced||!this.map||hd.isLoadable(this.map)&&!this.map.loaded||this.width===0||this.height===0||!this.spatialReference||!this._validateSpatialReference(this.spatialReference)||!this._currentSpatialReference&&!((e=this.defaultsFromMap)!=null&&e.ready)||!this.typeSpecificPreconditionsReady)}set map(e){e!==this._get("map")&&(e!=null&&e.destroyed&&(wP.warn("#map","The provided map is already destroyed",{map:e}),e=null),hd.isLoadable(e)&&e.load().catch(()=>{}),this.initialized&&(this.forceReadyCycle(),this._currentSpatialReference=null),this._set("map",e))}get spatialReference(){var t,r;let e=this._userSpatialReference||this._currentSpatialReference||this.getDefaultSpatialReference()||null;return e&&((r=(t=this.defaultsFromMap)==null?void 0:t.required)==null?void 0:r.heightModelInfo)&&(e=e.clone(),e.vcsWkid=this.defaultsFromMap.vcsWkid,e.latestVcsWkid=this.defaultsFromMap.latestVcsWkid),e}set spatialReference(e){const t=!_l(e,this._get("spatialReference"));this._set("_userSpatialReference",e),t&&(this._set("spatialReference",e),this._spatialReferenceChanged(e))}_spatialReferenceChanged(e){}get stationary(){return!this.animation&&!this.navigating&&!this.resizing}get initialExtent(){var e;return(e=this.defaultsFromMap)==null?void 0:e.extent}get cursor(){const e=this.toolViewManager?this.toolViewManager.cursor:null;return _(e)?e:this._cursor||"default"}set cursor(e){this._cursor=e,this.notifyChange("cursor")}get size(){return[this.width,this.height]}whenLayerView(e){return this.layerViewManager.whenLayerView(e)}getDefaultSpatialReference(){var e;return(e=this.defaultsFromMap)==null?void 0:e.spatialReference}getDefaultHeightModelInfo(){var e,t,r;return(r=(t=this.map&&"heightModelInfo"in this.map?this.map.heightModelInfo:void 0)!=null?t:(e=this.defaultsFromMap)==null?void 0:e.heightModelInfo)!=null?r:null}importLayerView(e){throw new k("importLayerView() not implemented")}hasLayerViewModule(e){return!1}async validate(){}invalidate(){this._isValid=!1}getSpatialReferenceSupport(){return{constraints:null}}_validateSpatialReference(e){return _(this.getSpatialReferenceSupport({spatialReference:e}))}when(e,t){return this.isResolved()&&!this.ready&&wP.warn("#when()","Calling view.when() while the view is no longer ready but was already resolved once will resolve immediately. Use reactiveUtils.whenOnce(() => view.ready).then(...) instead."),super.when(e,t)}forceReadyCycle(){this.ready&&(Fa(()=>this.preconditionsReady===!1,()=>this._readyCycleForced=!1,{once:!0}),this._readyCycleForced=!0)}addAndActivateTool(e){this.toolViewManager.tools.add(e),this.activeTool=e}tryFatalErrorRecovery(){this.fatalError=null}};$t.views=new lt,d([f()],$t.prototype,"_userSpatialReference",void 0),d([We("toolViewManager.activeTool")],$t.prototype,"activeTool",void 0),d([f({readOnly:!0})],$t.prototype,"allLayerViews",void 0),d([f()],$t.prototype,"groundView",void 0),d([f()],$t.prototype,"animation",void 0),d([f()],$t.prototype,"basemapView",void 0),d([f({readOnly:!0})],$t.prototype,"_defaultsFromMapSettings",null),d([f()],$t.prototype,"defaultsFromMap",null),d([f()],$t.prototype,"fatalError",void 0),d([f({type:Zt})],$t.prototype,"extent",void 0),d([f(WY(o7,"graphics"))],$t.prototype,"graphics",void 0),d([f(WY(i9,"analyses"))],$t.prototype,"analyses",void 0),d([f({readOnly:!0,type:Ex})],$t.prototype,"heightModelInfo",null),d([f({readOnly:!0})],$t.prototype,"interacting",null),d([f({readOnly:!0})],$t.prototype,"navigating",void 0),d([f({readOnly:!0,dependsOn:["fatalError","_isValid","_readyCycleForced","map","map.loaded?","width","height","spatialReference","_currentSpatialReference","defaultsFromMap.ready","typeSpecificPreconditionsReady"]})],$t.prototype,"preconditionsReady",null),d([f({readOnly:!0})],$t.prototype,"typeSpecificPreconditionsReady",void 0),d([f({type:lt,readOnly:!0})],$t.prototype,"layerViews",void 0),d([f({type:rEe})],$t.prototype,"magnifier",void 0),d([f({value:null,type:Wwe})],$t.prototype,"map",null),d([f()],$t.prototype,"padding",void 0),d([f({readOnly:!0})],$t.prototype,"ready",void 0),d([f({type:Ye})],$t.prototype,"spatialReference",null),d([f()],$t.prototype,"spatialReferenceWarningDelay",void 0),d([f()],$t.prototype,"stationary",null),d([f({readOnly:!0})],$t.prototype,"supportsGround",void 0),d([f({type:Mm})],$t.prototype,"timeExtent",void 0),d([We("toolViewManager.tools")],$t.prototype,"tools",void 0),d([f()],$t.prototype,"toolViewManager",void 0),d([f({readOnly:!0})],$t.prototype,"type",void 0),d([f({type:Number})],$t.prototype,"scale",void 0),d([f({readOnly:!0})],$t.prototype,"updating",void 0),d([f({readOnly:!0})],$t.prototype,"initialExtentRequired",void 0),d([f({readOnly:!0})],$t.prototype,"initialExtent",null),d([f()],$t.prototype,"cursor",null),d([f({readOnly:!0})],$t.prototype,"input",void 0),d([f({type:lEe,nonNullable:!0})],$t.prototype,"navigation",void 0),d([f()],$t.prototype,"layerViewManager",void 0),d([f()],$t.prototype,"analysisViewManager",void 0),d([f()],$t.prototype,"width",void 0),d([f()],$t.prototype,"height",void 0),d([f({readOnly:!0})],$t.prototype,"resizing",void 0),d([f({value:null,readOnly:!0})],$t.prototype,"size",null),d([f({readOnly:!0})],$t.prototype,"suspended",void 0),d([f({readOnly:!0})],$t.prototype,"viewEvents",void 0),d([f({readOnly:!0})],$t.prototype,"persistableViewModels",void 0),d([f()],$t.prototype,"_isValid",void 0),d([f()],$t.prototype,"_readyCycleForced",void 0),d([f()],$t.prototype,"_currentSpatialReference",void 0),$t=YL=d([$("esri.views.View")],$t);const Wat=$t;let p1=class extends MF{constructor(e){super(e),this.state="running",this.target=null}initialize(){this.addResolvingPromise(new Promise((e,t)=>this._dfd={resolve:e,reject:t}))}get done(){return this.state==="finished"||this.state==="stopped"}stop(){this.state!=="stopped"&&this.state!=="finished"&&(this._set("state","stopped"),this._dfd.reject(new k("ViewAnimation stopped")))}finish(){this.state!=="stopped"&&this.state!=="finished"&&(this._set("state","finished"),this._dfd.resolve())}update(e,t){t||(t=$u(e)?"waiting-for-target":"running"),this._set("target",e),this._set("state",t)}};d([f({readOnly:!0})],p1.prototype,"done",null),d([f({readOnly:!0,type:String})],p1.prototype,"state",void 0),d([f()],p1.prototype,"target",void 0),p1=d([$("esri.views.ViewAnimation")],p1),function(e){e.State={RUNNING:"running",STOPPED:"stopped",FINISHED:"finished",WAITING_FOR_TARGET:"waiting-for-target"}}(p1||(p1={}));const u9=p1,n8=()=>ie(()=>import("./TileLayerView3D.f586bfa0.js"),["TileLayerView3D.f586bfa0.js","LayerView3D.991b8b75.js","TiledLayerView3D.fa5e0184.js","LayerView.2ae763a3.js","RefreshableLayerView.6bdc41d3.js","clickToleranceUtils.dc236802.js","drapedUtils.979ab5a7.js"],import.meta.url),Kfe=()=>ie(()=>import("./ElevationLayerView3D.fa0c76f4.js"),["ElevationLayerView3D.fa0c76f4.js","LayerView3D.991b8b75.js","TiledLayerView3D.fa5e0184.js","LayerView.2ae763a3.js"],import.meta.url),epe={"base-dynamic":()=>ie(()=>import("./BaseDynamicLayerView3D.bca2787e.js"),["BaseDynamicLayerView3D.bca2787e.js","DynamicLayerView3D.fc1c4428.js","LayerView3D.991b8b75.js","projectExtentUtils.96c62d46.js","ImageMaterial.5daf2188.js","LayerView.2ae763a3.js","RefreshableLayerView.6bdc41d3.js"],import.meta.url),"base-elevation":Kfe,"base-tile":n8,"bing-maps":n8,"building-scene":()=>ie(()=>import("./BuildingSceneLayerView3D.20d2c024.js"),["BuildingSceneLayerView3D.20d2c024.js","BuildingGroupSublayer.a67500b2.js","BuildingComponentSublayer.0d11bf8b.js","WhereClause.ecb0bafc.js","I3SMeshView3D.09237d2c.js","I3SAttributeOverrides.38b5f3cf.js","I3SNode.cc916286.js","SceneModification.9a6eef20.js","Graphics3DScaleVisibility.94299010.js","optimizedFeatureQueryEngineAdapter.bfa7c41c.js","centroid.80c9450e.js","PooledRBush.1dfcdd85.js","quickselect.bb286034.js","SceneLayerWorker.9ea3db21.js","attributeUtils.72e006d3.js","I3SQueryFeatureStore.ef92bec5.js","QueryEngine.fba17b75.js","QueryEngineResult.5def21e8.js","json.8bd707cf.js","DefinitionExpressionSceneLayerView.87c961ae.js","popupUtils.58a7d584.js","LayerView3D.991b8b75.js","LayerView.2ae763a3.js"],import.meta.url),csv:()=>ie(()=>import("./CSVLayerView3D.acaf4e41.js"),["CSVLayerView3D.acaf4e41.js","FeatureLayerViewBase3D.ff60e398.js","FeatureLikeLayerView3D.7597c0ce.js","dehydratedFeatureComparison.0839a103.js","Graphics3DFeatureProcessor.482e29a9.js","Graphics3DScaleVisibility.94299010.js","optimizedFeatureQueryEngineAdapter.bfa7c41c.js","centroid.80c9450e.js","PooledRBush.1dfcdd85.js","quickselect.bb286034.js","Graphics3DObjectStates.fe70f60a.js","QueryEngine.fba17b75.js","QueryEngineResult.5def21e8.js","WhereClause.ecb0bafc.js","json.8bd707cf.js","attributeUtils.72e006d3.js","FeatureStore.90eb75d8.js","projectExtentUtils.96c62d46.js","LayerView3D.991b8b75.js","EventedSet.03ecbca9.js","popupUtils.58a7d584.js","LayerView.2ae763a3.js","RefreshableLayerView.6bdc41d3.js"],import.meta.url),elevation:Kfe,feature:()=>ie(()=>import("./FeatureLayerView3D.8cdf69ea.js"),["FeatureLayerView3D.8cdf69ea.js","FeatureLayerViewBase3D.ff60e398.js","FeatureLikeLayerView3D.7597c0ce.js","dehydratedFeatureComparison.0839a103.js","Graphics3DFeatureProcessor.482e29a9.js","Graphics3DScaleVisibility.94299010.js","optimizedFeatureQueryEngineAdapter.bfa7c41c.js","centroid.80c9450e.js","PooledRBush.1dfcdd85.js","quickselect.bb286034.js","Graphics3DObjectStates.fe70f60a.js","QueryEngine.fba17b75.js","QueryEngineResult.5def21e8.js","WhereClause.ecb0bafc.js","json.8bd707cf.js","attributeUtils.72e006d3.js","FeatureStore.90eb75d8.js","projectExtentUtils.96c62d46.js","LayerView3D.991b8b75.js","EventedSet.03ecbca9.js","popupUtils.58a7d584.js","LayerView.2ae763a3.js","RefreshableLayerView.6bdc41d3.js"],import.meta.url),geojson:()=>ie(()=>import("./GeoJSONLayerView3D.af2d1952.js"),["GeoJSONLayerView3D.af2d1952.js","FeatureLayerViewBase3D.ff60e398.js","FeatureLikeLayerView3D.7597c0ce.js","dehydratedFeatureComparison.0839a103.js","Graphics3DFeatureProcessor.482e29a9.js","Graphics3DScaleVisibility.94299010.js","optimizedFeatureQueryEngineAdapter.bfa7c41c.js","centroid.80c9450e.js","PooledRBush.1dfcdd85.js","quickselect.bb286034.js","Graphics3DObjectStates.fe70f60a.js","QueryEngine.fba17b75.js","QueryEngineResult.5def21e8.js","WhereClause.ecb0bafc.js","json.8bd707cf.js","attributeUtils.72e006d3.js","FeatureStore.90eb75d8.js","projectExtentUtils.96c62d46.js","LayerView3D.991b8b75.js","EventedSet.03ecbca9.js","popupUtils.58a7d584.js","LayerView.2ae763a3.js","RefreshableLayerView.6bdc41d3.js"],import.meta.url),graphics:()=>ie(()=>import("./GraphicsLayerView3D.8ae2f585.js"),["GraphicsLayerView3D.8ae2f585.js","LayerView3D.991b8b75.js","GraphicsProcessor.54147b4e.js","Graphics3DScaleVisibility.94299010.js","optimizedFeatureQueryEngineAdapter.bfa7c41c.js","centroid.80c9450e.js","PooledRBush.1dfcdd85.js","quickselect.bb286034.js","Graphics3DObjectStates.fe70f60a.js","projectExtentUtils.96c62d46.js","LayerView.2ae763a3.js"],import.meta.url),group:()=>ie(()=>import("./GroupLayerView.7b8c0832.js"),["GroupLayerView.7b8c0832.js","LayerView.2ae763a3.js"],import.meta.url),imagery:()=>ie(()=>import("./ImageryLayerView3D.d8a5b46b.js"),["ImageryLayerView3D.d8a5b46b.js","DynamicLayerView3D.fc1c4428.js","LayerView3D.991b8b75.js","projectExtentUtils.96c62d46.js","ImageMaterial.5daf2188.js","LayerView.2ae763a3.js","RefreshableLayerView.6bdc41d3.js","popupUtils.58a7d584.js"],import.meta.url),"integrated-mesh":()=>ie(()=>import("./IntegratedMeshLayerView3D.fde11ab5.js"),["IntegratedMeshLayerView3D.fde11ab5.js","I3SMeshView3D.09237d2c.js","I3SAttributeOverrides.38b5f3cf.js","I3SNode.cc916286.js","SceneModification.9a6eef20.js","Graphics3DScaleVisibility.94299010.js","optimizedFeatureQueryEngineAdapter.bfa7c41c.js","centroid.80c9450e.js","PooledRBush.1dfcdd85.js","quickselect.bb286034.js","SceneLayerWorker.9ea3db21.js","attributeUtils.72e006d3.js","LayerView3D.991b8b75.js","LayerView.2ae763a3.js"],import.meta.url),"line-of-sight":()=>ie(()=>import("./LineOfSightLayerView3D.855d1b47.js"),["LineOfSightLayerView3D.855d1b47.js","LayerView3D.991b8b75.js","LayerView.2ae763a3.js"],import.meta.url),"map-image":()=>ie(()=>import("./MapImageLayerView3D.2e38f409.js"),["MapImageLayerView3D.2e38f409.js","DynamicLayerView3D.fc1c4428.js","LayerView3D.991b8b75.js","projectExtentUtils.96c62d46.js","ImageMaterial.5daf2188.js","LayerView.2ae763a3.js","RefreshableLayerView.6bdc41d3.js","clickToleranceUtils.dc236802.js","popupUtils.58a7d584.js","drapedUtils.979ab5a7.js"],import.meta.url),media:()=>ie(()=>import("./MediaLayerView3D.d931b1b5.js"),["MediaLayerView3D.d931b1b5.js","normalizeUtilsSync.26af66b5.js","LayerView3D.991b8b75.js","ImageMaterial.5daf2188.js","LayerView.2ae763a3.js"],import.meta.url),"ogc-feature":()=>ie(()=>import("./OGCFeatureLayerView3D.42da7c47.js"),["OGCFeatureLayerView3D.42da7c47.js","FeatureLayerViewBase3D.ff60e398.js","FeatureLikeLayerView3D.7597c0ce.js","dehydratedFeatureComparison.0839a103.js","Graphics3DFeatureProcessor.482e29a9.js","Graphics3DScaleVisibility.94299010.js","optimizedFeatureQueryEngineAdapter.bfa7c41c.js","centroid.80c9450e.js","PooledRBush.1dfcdd85.js","quickselect.bb286034.js","Graphics3DObjectStates.fe70f60a.js","QueryEngine.fba17b75.js","QueryEngineResult.5def21e8.js","WhereClause.ecb0bafc.js","json.8bd707cf.js","attributeUtils.72e006d3.js","FeatureStore.90eb75d8.js","projectExtentUtils.96c62d46.js","LayerView3D.991b8b75.js","EventedSet.03ecbca9.js","popupUtils.58a7d584.js","LayerView.2ae763a3.js","RefreshableLayerView.6bdc41d3.js"],import.meta.url),"open-street-map":n8,"point-cloud":()=>ie(()=>import("./PointCloudLayerView3D.096100e6.js").then(e=>e.P),["PointCloudLayerView3D.096100e6.js","LayerView3D.991b8b75.js","PointCloudWorkerUtil.b88b3926.js","PopupSceneLayerView.ec846c94.js","popupUtils.58a7d584.js","LayerView.2ae763a3.js"],import.meta.url),voxel:()=>ie(()=>import("./VoxelLayerView3D.655d7732.js"),["VoxelLayerView3D.655d7732.js","LayerView3D.991b8b75.js","LayerView.2ae763a3.js"],import.meta.url),route:()=>ie(()=>import("./RouteLayerView3D.2738c591.js"),["RouteLayerView3D.2738c591.js","Stop.d9cae37d.js","LayerView3D.991b8b75.js","GraphicsProcessor.54147b4e.js","Graphics3DScaleVisibility.94299010.js","optimizedFeatureQueryEngineAdapter.bfa7c41c.js","centroid.80c9450e.js","PooledRBush.1dfcdd85.js","quickselect.bb286034.js","Graphics3DObjectStates.fe70f60a.js","projectExtentUtils.96c62d46.js","EventedSet.03ecbca9.js","LayerView.2ae763a3.js"],import.meta.url),scene:e=>e.profile==null||e.profile==="mesh-pyramids"?ie(()=>import("./SceneLayerView3D.48a68f1f.js"),["SceneLayerView3D.48a68f1f.js","WhereClause.ecb0bafc.js","I3SMeshView3D.09237d2c.js","I3SAttributeOverrides.38b5f3cf.js","I3SNode.cc916286.js","SceneModification.9a6eef20.js","Graphics3DScaleVisibility.94299010.js","optimizedFeatureQueryEngineAdapter.bfa7c41c.js","centroid.80c9450e.js","PooledRBush.1dfcdd85.js","quickselect.bb286034.js","SceneLayerWorker.9ea3db21.js","attributeUtils.72e006d3.js","LayerView3D.991b8b75.js","SceneLayerView.4fce442e.js","LayerView.2ae763a3.js","I3SQueryFeatureStore.ef92bec5.js","QueryEngine.fba17b75.js","QueryEngineResult.5def21e8.js","json.8bd707cf.js","DefinitionExpressionSceneLayerView.87c961ae.js","PopupSceneLayerView.ec846c94.js","popupUtils.58a7d584.js"],import.meta.url):ie(()=>import("./SceneLayerGraphicsView3D.b1d8393d.js"),["SceneLayerGraphicsView3D.b1d8393d.js","I3SAttributeOverrides.38b5f3cf.js","I3SNode.cc916286.js","LayerView3D.991b8b75.js","Graphics3DFeatureProcessor.482e29a9.js","Graphics3DScaleVisibility.94299010.js","optimizedFeatureQueryEngineAdapter.bfa7c41c.js","centroid.80c9450e.js","PooledRBush.1dfcdd85.js","quickselect.bb286034.js","Graphics3DObjectStates.fe70f60a.js","QueryEngine.fba17b75.js","QueryEngineResult.5def21e8.js","WhereClause.ecb0bafc.js","json.8bd707cf.js","attributeUtils.72e006d3.js","SceneLayerView.4fce442e.js","LayerView.2ae763a3.js","DefinitionExpressionSceneLayerView.87c961ae.js","PopupSceneLayerView.ec846c94.js","popupUtils.58a7d584.js"],import.meta.url),stream:()=>ie(()=>import("./StreamLayerView3D.de3fbce8.js"),["StreamLayerView3D.de3fbce8.js","createConnection.2d7fd802.js","EventedSet.03ecbca9.js","FeatureLikeLayerView3D.7597c0ce.js","dehydratedFeatureComparison.0839a103.js","Graphics3DFeatureProcessor.482e29a9.js","Graphics3DScaleVisibility.94299010.js","optimizedFeatureQueryEngineAdapter.bfa7c41c.js","centroid.80c9450e.js","PooledRBush.1dfcdd85.js","quickselect.bb286034.js","Graphics3DObjectStates.fe70f60a.js","QueryEngine.fba17b75.js","QueryEngineResult.5def21e8.js","WhereClause.ecb0bafc.js","json.8bd707cf.js","attributeUtils.72e006d3.js","FeatureStore.90eb75d8.js","projectExtentUtils.96c62d46.js","LayerView3D.991b8b75.js","LayerView.2ae763a3.js"],import.meta.url),tile:n8,"imagery-tile":()=>ie(()=>import("./ImageryTileLayerView3D.4d732ee7.js"),["ImageryTileLayerView3D.4d732ee7.js","LayerView3D.991b8b75.js","TiledLayerView3D.fa5e0184.js","rasterProjectionHelper.c4fee2f8.js","popupUtils.58a7d584.js","LayerView.2ae763a3.js","RefreshableLayerView.6bdc41d3.js","drapedUtils.979ab5a7.js"],import.meta.url),"vector-tile":()=>ie(()=>import("./VectorTileLayerView3D.52971803.js"),["VectorTileLayerView3D.52971803.js","GeometryUtils.2547656a.js","CIMSymbolHelper.7933df34.js","BidiEngine.210f7ff8.js","enums.4de5fe56.js","number.6e30c64a.js","StyleRepository.fd472b71.js","Geometry.f2d62961.js","PixelBlock.db4f59f3.js","Utils.be0af777.js","MaterialKey.27689d0b.js","LayerView3D.991b8b75.js","TiledLayerView3D.fa5e0184.js","LayerView.2ae763a3.js"],import.meta.url),wcs:()=>ie(()=>import("./ImageryTileLayerView3D.4d732ee7.js"),["ImageryTileLayerView3D.4d732ee7.js","LayerView3D.991b8b75.js","TiledLayerView3D.fa5e0184.js","rasterProjectionHelper.c4fee2f8.js","popupUtils.58a7d584.js","LayerView.2ae763a3.js","RefreshableLayerView.6bdc41d3.js","drapedUtils.979ab5a7.js"],import.meta.url),"web-tile":n8,wfs:()=>ie(()=>import("./WFSLayerView3D.78b72070.js"),["WFSLayerView3D.78b72070.js","FeatureLayerViewBase3D.ff60e398.js","FeatureLikeLayerView3D.7597c0ce.js","dehydratedFeatureComparison.0839a103.js","Graphics3DFeatureProcessor.482e29a9.js","Graphics3DScaleVisibility.94299010.js","optimizedFeatureQueryEngineAdapter.bfa7c41c.js","centroid.80c9450e.js","PooledRBush.1dfcdd85.js","quickselect.bb286034.js","Graphics3DObjectStates.fe70f60a.js","QueryEngine.fba17b75.js","QueryEngineResult.5def21e8.js","WhereClause.ecb0bafc.js","json.8bd707cf.js","attributeUtils.72e006d3.js","FeatureStore.90eb75d8.js","projectExtentUtils.96c62d46.js","LayerView3D.991b8b75.js","EventedSet.03ecbca9.js","popupUtils.58a7d584.js","LayerView.2ae763a3.js","RefreshableLayerView.6bdc41d3.js"],import.meta.url),wms:()=>ie(()=>import("./WMSLayerView3D.4b2d5a46.js"),["WMSLayerView3D.4b2d5a46.js","DynamicLayerView3D.fc1c4428.js","LayerView3D.991b8b75.js","projectExtentUtils.96c62d46.js","ImageMaterial.5daf2188.js","LayerView.2ae763a3.js","RefreshableLayerView.6bdc41d3.js","ExportWMSImageParameters.048ea103.js"],import.meta.url),wmts:()=>ie(()=>import("./WMTSLayerView3D.ee228273.js"),["WMTSLayerView3D.ee228273.js","LayerView3D.991b8b75.js","TiledLayerView3D.fa5e0184.js","LayerView.2ae763a3.js","RefreshableLayerView.6bdc41d3.js"],import.meta.url),"geo-rss":null,kml:null,"map-notes":null,"subtype-group":null,unknown:null,unsupported:null};function Xat(e){const t=e.declaredClass?e.declaredClass.slice(e.declaredClass.lastIndexOf(".")+1):"Unknown",r=t.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase();return new k(`${r}:view-not-supported`,`${t} is not supported in 3D`)}const tpe={hasLayerViewModule:e=>_(epe[e.type]),importLayerView:e=>{const t=epe[e.type];if(R(t))throw Xat(e);return t(e)}},Yat=fe.getLogger("esri.views.3d.analysis.AnalysisViewManager3D"),rpe="analyses-owner-handles";var _4,S3;(function(e){e[e.PENDING=0]="PENDING",e[e.CREATED=1]="CREATED"})(_4||(_4={})),function(e){e[e.ADDED=0]="ADDED",e[e.REMOVED=1]="REMOVED"}(S3||(S3={}));let H2=class extends N5{constructor(e){super(e),this._allAnalysisViews=new lt,this._creatingViewCount=0,this._items=new Map,this._scheduledUpdateHandle=null,this._attachedToViewResolver=Op(),this._analysisModules={"area-measurement":{module:null},dimensioning:{module:null},"direct-line-measurement":{module:null},"line-of-sight":{module:null},slice:{module:null}}}destroy(){this._disconnectOwners(),this._attachedToViewResolver.reject(br("AnalysisViewManager was destroyed"))}attach(){this._connectOwners(),this._attachedToViewResolver.resolve()}detach(){this._disconnectOwners(),this._attachedToViewResolver.reject(br()),this._attachedToViewResolver=Op(),this._attachedToViewResolver.promise.catch(()=>{})}get updating(){return!this.view.ready||this._creatingViewCount!==0||this._allAnalysisViews.some(e=>e.updating)}get testInfo(){return{allAnalysisViews:this._allAnalysisViews}}async whenAnalysisView(e){await this._attachedToViewResolver.promise;const t=this._items.get(e);if(R(t)||t.state.list===S3.REMOVED)throw new k("AnalysisViewManager:no-analysisview-for-analysis","The analysis has not been added to view.analyses",{analysis:e});return t.createAnalysisViewTask.promise}_connectOwners(){this.handles.add(this._connectAnalysesCollection(this.view.analyses),rpe)}_disconnectOwners(){this.handles.remove(rpe),this._update(),this._creatingViewCount=0}_connectAnalysesCollection(e){for(const i of e)this._addAnalysis(i);const t=e.on("after-add",i=>this._addAnalysis(i.item)),r=e.on("after-remove",i=>this._removeAnalysis(i.item));return{remove:()=>{t.remove(),r.remove();for(const i of e)this._removeAnalysis(i)}}}_addAnalysis(e){const t=this._items.get(e);if(t==null){const r={state:{view:_4.PENDING,list:S3.ADDED},analysis:e,view:null,createAnalysisViewTask:null};this._items.set(e,r),r.createAnalysisViewTask=HR(i=>this._createAnalysisViewPromise(r,i))}else t.state.list=S3.ADDED}_removeAnalysis(e){const t=this._items.get(e);t!=null?(t.state.list=S3.REMOVED,this._scheduleUpdate()):Yat.error("Trying to remove analysis which was not added")}_scheduleUpdate(){_(this._scheduledUpdateHandle)||(this._scheduledUpdateHandle=X9(()=>this._update()))}_update(){this._scheduledUpdateHandle=Ts(this._scheduledUpdateHandle),this._items.forEach(e=>{if(e.state.list===S3.REMOVED)switch(this._items.delete(e.analysis),e.state.view){case _4.PENDING:e.createAnalysisViewTask=qh(e.createAnalysisViewTask);break;case _4.CREATED:_(e.view)&&(this._allAnalysisViews.remove(e.view),e.view=ct(e.view),e.createAnalysisViewTask=null)}})}async _createAnalysisViewPromise(e,t){const r=e.analysis,i=r.type,n=this._analysisModules[i];if(this._creatingViewCount+=1,R(n.module))try{n.module=await this._loadAnalysisModule(i)}catch(a){throw this._creatingViewCount-=1,a}if(bs(t))throw this._creatingViewCount-=1,br("AnalysisView creation aborted");const s=new n.module.default({analysis:r,view:this.view});try{await s.when()}catch(a){throw this._creatingViewCount-=1,a}if(bs(t))throw this._creatingViewCount-=1,s.destroy(),br("AnalysisView creation aborted");return e.view=s,e.state.view=_4.CREATED,this._allAnalysisViews.add(s),this._creatingViewCount-=1,s}_loadAnalysisModule(e){switch(e){case"area-measurement":return ie(()=>import("./AreaMeasurementAnalysisView3D.98626aaa.js").then(t=>t.A),["AreaMeasurementAnalysisView3D.98626aaa.js","quantityFormatUtils.38859ed7.js","Segment.bc68cf19.js","LineVisualElement.6dace62e.js","elevationInfoUtils.cdee1c92.js","geometryEngine.7daf51bb.js","geometryEngineBase.0f0d7ecf.js","hydrated.e7f04c19.js","projectionUtils.32c3d3f8.js","EditGeometryOperations.b4e4ecae.js"],import.meta.url);case"dimensioning":return ie(()=>import("./DimensioningAnalysisView3D.17111058.js").then(t=>t.D),["DimensioningAnalysisView3D.17111058.js","LineVisualElement.6dace62e.js","analysisViewUtils.80a36a20.js","PointVisualElement.aa681768.js","RightAngleQuadVisualElement.3e887bdf.js","Segment.bc68cf19.js","elevationInfoUtils.cdee1c92.js","dragEventPipeline3D.92b60e9b.js","EditGeometryOperations.b4e4ecae.js","QueryEngineResult.5def21e8.js","WhereClause.ecb0bafc.js","json.8bd707cf.js","dehydratedFeatureComparison.0839a103.js"],import.meta.url);case"direct-line-measurement":return ie(()=>import("./DirectLineMeasurementAnalysisView3D.6d7c56da.js").then(t=>t.D),["DirectLineMeasurementAnalysisView3D.6d7c56da.js","quantityFormatUtils.38859ed7.js","Segment.bc68cf19.js","LineVisualElement.6dace62e.js","elevationInfoUtils.cdee1c92.js","geometryEngine.7daf51bb.js","geometryEngineBase.0f0d7ecf.js","hydrated.e7f04c19.js","projectionUtils.32c3d3f8.js","RightAngleQuadVisualElement.3e887bdf.js"],import.meta.url);case"line-of-sight":return ie(()=>import("./LineOfSightAnalysisView3D.2b95b4b4.js"),["LineOfSightAnalysisView3D.2b95b4b4.js","LineVisualElement.6dace62e.js","LineOfSightAnalysisTarget.ad7cc2f2.js","elevationInfoUtils.cdee1c92.js","projectionUtils.32c3d3f8.js","analysisViewUtils.80a36a20.js","PointVisualElement.aa681768.js"],import.meta.url);case"slice":return ie(()=>import("./SliceAnalysisView3D.d377fe22.js").then(t=>t.S),["SliceAnalysisView3D.d377fe22.js","LineVisualElement.6dace62e.js","BuildingComponentSublayer.0d11bf8b.js","projectionUtils.32c3d3f8.js","analysisViewUtils.80a36a20.js","ImageMaterial.5daf2188.js","dragEventPipeline3D.92b60e9b.js"],import.meta.url)}}};d([f()],H2.prototype,"updating",null),d([f({constructOnly:!0})],H2.prototype,"view",void 0),d([f()],H2.prototype,"_allAnalysisViews",void 0),d([f()],H2.prototype,"_creatingViewCount",void 0),H2=d([$("esri.views.3d.analysis.AnalysisViewManager3D")],H2);const Zat=H2,Qat=fe.getLogger("esri.views.3d.state.Constraints");let gg=class extends xe{constructor(e){super(e),this.collision=new YE,this.distance=1/0,this.minimumPoiDistance=4}get altitude(){return this.mode===Be.Local?null:this._get("altitude")||null}set altitude(e){this.mode!==Be.Local?this._set("altitude",e):Qat.warn("Altitude constraint is ignored in local scenes")}clampAltitude(e){return this.altitude?Le(e,this.altitude.min,this.altitude.max):e}clampTilt(e,t){if(!this.tilt)return t;const r=this.tilt(e);return Le(t,r.min,r.max)}clampDistance(e){return Math.min(e,this.distance)}createDefaultTilt(){return this.mode===Be.Local?this._createDefaultTiltLocal():this._createDefaultTiltGlobal()}createConstantMaxTilt(e){return(t,r=yj)=>(r.min=Ka.min,r.max=e,r)}_createDefaultTiltLocal(){const e=this.collision.enabled?gL([[4e3,Ka.max],[1e4,kt(88)],[6e6,kt(88)]]):()=>Ka.max;return(t,r=yj)=>(r.min=Ka.min,r.max=e(t),r)}_createDefaultTiltGlobal(){const e=this.collision.enabled?gL([[4e3,Ka.max],[5e4,kt(88)],[6e6,kt(88)],[2e7,Ka.min]]):gL([[3e5,Ka.max],[3e6,kt(88)],[6e6,kt(88)],[2e7,Ka.min]]);return(t,r=yj)=>(r.min=Ka.min,r.max=e(t),r)}};function Jat(e){return{min:-2e5,max:4*e.radius}}d([f()],gg.prototype,"altitude",null),d([f({readOnly:!0})],gg.prototype,"collision",void 0),d([f()],gg.prototype,"distance",void 0),d([f({readOnly:!0})],gg.prototype,"minimumPoiDistance",void 0),d([f()],gg.prototype,"tilt",void 0),d([f({constructOnly:!0})],gg.prototype,"mode",void 0),gg=d([$("esri.views.3d.state.Constraints")],gg);const ipe=Jat($r),Ka={min:kt(.5),max:kt(179.5)},yj={min:0,max:0};let YE=class extends xe{constructor(){super(...arguments),this.enabled=!0,this.elevationMargin=5}};d([f({type:Boolean})],YE.prototype,"enabled",void 0),d([f({type:Number})],YE.prototype,"elevationMargin",void 0),YE=d([$("esri.views.3d.state.Constraints.CollisionConstraint")],YE);let w4=class extends xe{constructor(){super(...arguments),this.min=ipe.min,this.max=ipe.max}};d([f({type:Number})],w4.prototype,"min",void 0),d([f({type:Number})],w4.prototype,"max",void 0),w4=d([$("esri.views.3d.constraints.AltitudeConstraint")],w4);let Dg=class extends xe{constructor(){super(...arguments),this.mode="auto"}get near(){return this._get("near")}set near(e){this._set("near",e),e>=this._get("far")&&(this.far=e+1e-9),this.mode="manual"}castNear(e){return Math.max(1e-8,e)}get far(){return this._get("far")}set far(e){this._set("far",e),e<=this._get("near")&&(this.near=e-1e-9),this.mode="manual"}castFar(e){return Math.max(1e-8,e)}autoUpdate(e,t){this.mode==="auto"&&(this._get("near")!==e&&this._set("near",e),this._get("far")!==t&&this._set("far",t))}};d([f({type:Number,value:1e-8})],Dg.prototype,"near",null),d([Xt("near")],Dg.prototype,"castNear",null),d([f({type:Number,value:1e-8})],Dg.prototype,"far",null),d([Xt("far")],Dg.prototype,"castFar",null),d([f({type:["auto","manual"]})],Dg.prototype,"mode",void 0),Dg=d([$("esri.views.3d.constraints.ClipDistanceConstraint")],Dg);const yJ={min:md(Ka.min),max:md(Ka.max)};let E3=class extends xe{constructor(){super(...arguments),this.mode="auto"}get max(){return this._get("max")}set max(e){this._set("max",e),this.mode="manual"}castMax(e){return Le(e,yJ.min,yJ.max)}autoUpdate(e){this.mode==="auto"&&this._get("max")!==e&&this._set("max",e)}};d([f({type:["auto","manual"]})],E3.prototype,"mode",void 0),d([f({type:Number,value:yJ.max})],E3.prototype,"max",null),d([Xt("max")],E3.prototype,"castMax",null),E3=d([$("esri.views.3d.constraints.TiltConstraint")],E3);let C3=class extends xe{constructor(){super(...arguments),this.tilt=new E3,this.altitude=new w4,this.clipDistance=new Dg}};d([f({type:E3})],C3.prototype,"tilt",void 0),d([f({type:w4})],C3.prototype,"altitude",void 0),d([f({type:Dg})],C3.prototype,"clipDistance",void 0),C3=d([$("esri.views.3d.constraints.Constraints")],C3);var bJ;let ah=bJ=class extends ge{constructor(e){super(e),this.type="sun",this.date=null,this.directShadowsEnabled=!1,this.displayUTCOffset=null}readDate(e,t){return t.datetime!=null&&new Date(t.datetime)||null}writeDate(e,t,r){t[r]=e.getTime()}readDirectShadowsEnabled(e,t){return!!t.directShadows}writedirectShadowsEnabled(e,t,r){e&&(t[r]=e)}writeDisplayUTCOffset(e,t){e!=null&&(t.displayUTCOffset=e)}clone(){return new bJ(this.cloneConstructProperties())}cloneConstructProperties(){const e={directShadowsEnabled:this.directShadowsEnabled,displayUTCOffset:this.displayUTCOffset!=null?this.displayUTCOffset:null};return this.date!=null&&(e.date=new Date(this.date.getTime())),e}};d([f({readOnly:!0,type:["sun"],json:{write:!0}})],ah.prototype,"type",void 0),d([f({type:Date,json:{type:Number,write:{target:"datetime"}}})],ah.prototype,"date",void 0),d([$e("date",["datetime"])],ah.prototype,"readDate",null),d([Xe("date")],ah.prototype,"writeDate",null),d([f({type:Boolean,json:{default:!1,write:{target:"directShadows"}}})],ah.prototype,"directShadowsEnabled",void 0),d([$e("directShadowsEnabled",["directShadows"])],ah.prototype,"readDirectShadowsEnabled",null),d([Xe("directShadowsEnabled")],ah.prototype,"writedirectShadowsEnabled",null),d([f({type:Number,json:{write:!0}})],ah.prototype,"displayUTCOffset",void 0),d([Xe("displayUTCOffset")],ah.prototype,"writeDisplayUTCOffset",null),ah=bJ=d([$("esri.webscene.SunLighting")],ah);const LA=ah;var ES;let w0=ES=class extends mn.EventedMixin(LA){constructor(e){super(e),this.cameraTrackingEnabled=!0,this.ambientOcclusionEnabled=!1,this.waterReflectionEnabled=!1,this.positionTimezoneInfo={hours:0,minutes:0,seconds:0,autoUpdated:!0};const t=new Date().getFullYear(),r=new Date("March 15, "+t+" 12:00:00 UTC");this._set("defaultDate",r),this._set("date",r)}get defaultDate(){return new Date(this._get("defaultDate").getTime())}static fromWebsceneLighting(e){return new ES(e.cloneConstructProperties())}set defaultDate(e){const t=this._get("date")===this._get("defaultDate");e=new Date(e.getTime()),this._set("defaultDate",e),t&&this._set("date",e)}set date(e){e!=null&&(this.positionTimezoneInfo.autoUpdated=!1,this._set("date",new Date(e.getTime())))}autoUpdate(e,t){const r=ES.calculateTimezoneOffset(this.positionTimezoneInfo);this.positionTimezoneInfo.hours=t.hours,this.positionTimezoneInfo.minutes=t.minutes,this.positionTimezoneInfo.seconds=t.seconds;let i=null;e!=null&&(this.positionTimezoneInfo.autoUpdated=!0,i=this.date&&this.date.getTime(),this._set("date",new Date(e.getTime())));const n=ES.calculateTimezoneOffset(this.positionTimezoneInfo);if(r!==n&&(bj.target=this,bj.timezoneOffset=n,this.emit("timezone-will-change",bj)),e!=null)return i!==e.getTime()}clone(){const e=this._get("date")===this._get("defaultDate"),t=new ES({...this.cloneConstructProperties(),defaultDate:this.defaultDate,cameraTrackingEnabled:this.cameraTrackingEnabled,ambientOcclusionEnabled:this.ambientOcclusionEnabled,waterReflectionEnabled:this.waterReflectionEnabled});return e&&t._set("date",t._get("defaultDate")),t.positionTimezoneInfo.autoUpdated=this.positionTimezoneInfo.autoUpdated,t.positionTimezoneInfo.hours=this.positionTimezoneInfo.hours,t.positionTimezoneInfo.minutes=this.positionTimezoneInfo.minutes,t.positionTimezoneInfo.seconds=this.positionTimezoneInfo.seconds,t}cloneWithWebsceneLighting(e){const t=this.clone();return e.date!=null&&(t.date=e.date),t.directShadowsEnabled=e.directShadowsEnabled,t.displayUTCOffset=e.displayUTCOffset,t}};d([f({type:Boolean})],w0.prototype,"cameraTrackingEnabled",void 0),d([f({type:Boolean})],w0.prototype,"ambientOcclusionEnabled",void 0),d([f({type:Boolean})],w0.prototype,"waterReflectionEnabled",void 0),d([f({type:Date})],w0.prototype,"defaultDate",null),d([f({type:Date})],w0.prototype,"date",null),w0=ES=d([$("esri.views.3d.environment.SunLighting")],w0),function(e){function t({hours:r,minutes:i,seconds:n}){return Math.round(r+i/60+n/3600)}e.calculateTimezoneOffset=t}(w0||(w0={}));const bj={target:null,timezoneOffset:0},m1=w0;var vJ;let ZE=vJ=class extends ge{constructor(e){super(e),this.type="virtual",this.directShadowsEnabled=!1}clone(){return new vJ(this.cloneConstructProperties())}cloneConstructProperties(){return{directShadowsEnabled:this.directShadowsEnabled}}};d([f({readOnly:!0,type:["virtual"],json:{write:!0}})],ZE.prototype,"type",void 0),d([f({type:Boolean,json:{default:!1,name:"directShadows",write:!0}})],ZE.prototype,"directShadowsEnabled",void 0),ZE=vJ=d([$("esri.webscene.VirtualLighting")],ZE);const Rz=ZE;var ZL;let QE=ZL=class extends mn.EventedMixin(Rz){constructor(e){super(e),this.ambientOcclusionEnabled=!1,this.waterReflectionEnabled=!1}clone(){return new ZL({...this.cloneConstructProperties(),ambientOcclusionEnabled:this.ambientOcclusionEnabled,waterReflectionEnabled:this.waterReflectionEnabled})}static fromWebsceneLighting(e){return new ZL(e.cloneConstructProperties())}cloneWithWebsceneLighting(e){const t=this.clone();return t.directShadowsEnabled=e.directShadowsEnabled,t}};d([f({type:Boolean})],QE.prototype,"ambientOcclusionEnabled",void 0),d([f({type:Boolean})],QE.prototype,"waterReflectionEnabled",void 0),QE=ZL=d([$("esri.views.3d.environment.VirtualLighting")],QE);const JE=QE,Kat={key:"type",defaultKeyValue:"sun",base:null,typeMap:{sun:m1,virtual:JE}};var _J;let c7=_J=class extends xe{set quality(e){["low","high"].includes(e)&&this._set("quality",e)}clone(){return new _J({quality:this.quality})}};d([f({type:["low","high"],value:"low"})],c7.prototype,"quality",null),c7=_J=d([$("esri.views.3d.environment.SceneViewAtmosphere")],c7);var wJ;let KE=wJ=class extends ge{constructor(e){super(e),this.type="sunny",this.cloudCover=.5}clone(){return new wJ({cloudCover:this.cloudCover})}};d([Ze({sunny:"sunny"})],KE.prototype,"type",void 0),d([f({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],KE.prototype,"cloudCover",void 0),KE=wJ=d([$("esri.views.3d.environment.SunnyWeather")],KE);const xJ=KE;var TJ;let eC=TJ=class extends ge{constructor(e){super(e),this.type="cloudy",this.cloudCover=.5}clone(){return new TJ({cloudCover:this.cloudCover})}};d([Ze({cloudy:"cloudy"})],eC.prototype,"type",void 0),d([f({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],eC.prototype,"cloudCover",void 0),eC=TJ=d([$("esri.views.3d.environment.CloudyWeather")],eC);const eot=eC;var SJ;let tC=SJ=class extends ge{constructor(e){super(e),this.type="foggy",this.fogStrength=.5}clone(){return new SJ({fogStrength:this.fogStrength})}};d([Ze({foggy:"foggy"})],tC.prototype,"type",void 0),d([f({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],tC.prototype,"fogStrength",void 0),tC=SJ=d([$("esri.views.3d.environment.FoggyWeather")],tC);const tot=tC;var EJ;let CS=EJ=class extends ge{constructor(e){super(e),this.type="rainy",this.cloudCover=.5,this.precipitation=.5}clone(){return new EJ({cloudCover:this.cloudCover,precipitation:this.precipitation})}};d([Ze({rainy:"rainy"})],CS.prototype,"type",void 0),d([f({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],CS.prototype,"cloudCover",void 0),d([f({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],CS.prototype,"precipitation",void 0),CS=EJ=d([$("esri.views.3d.environment.RainyWeather")],CS);const rot=CS;var CJ;let W2=CJ=class extends ge{constructor(e){super(e),this.type="snowy",this.cloudCover=.5,this.precipitation=.5,this.snowCover="disabled"}clone(){return new CJ({cloudCover:this.cloudCover,precipitation:this.precipitation,snowCover:this.snowCover})}};d([Ze({snowy:"snowy"})],W2.prototype,"type",void 0),d([f({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],W2.prototype,"cloudCover",void 0),d([f({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],W2.prototype,"precipitation",void 0),d([f({type:["enabled","disabled"],nonNullable:!0,json:{write:!0}})],W2.prototype,"snowCover",void 0),W2=CJ=d([$("esri.views.3d.environment.SnowyWeather")],W2);const iot=W2,mEe={key:"type",base:xJ,typeMap:{sunny:xJ,cloudy:eot,rainy:rot,snowy:iot,foggy:tot}},not=Object.keys(mEe.typeMap);function sot(e,t){return!!not.includes(e)||(t.error(`"${e}" is not a valid weather type`),!1)}const _h=1e4,aot={key:"type",defaultKeyValue:"sun",base:null,typeMap:{sun:LA,virtual:Rz}};let QL=class extends ge{constructor(e){super(e)}clone(){}};d([f({readOnly:!0,json:{read:!1}})],QL.prototype,"type",void 0),QL=d([$("esri.webscene.background.Background")],QL);const gEe=QL;var AJ;const oot={...Gy,nonNullable:!0};let rC=AJ=class extends gEe{constructor(e){super(e),this.type="color",this.color=new Te([0,0,0,1])}clone(){return new AJ(this.cloneProperties())}cloneProperties(){return{color:this.color.clone()}}};d([Ze({color:"color"},{readOnly:!0})],rC.prototype,"type",void 0),d([f(oot)],rC.prototype,"color",void 0),rC=AJ=d([$("esri.webscene.background.ColorBackground")],rC);const yEe=rC,npe={base:gEe,key:"type",typeMap:{color:yEe}};function lot(e){return(t,r,i)=>{if(!t)return t;for(const n in e.typeMap)if(t.type===n){const s=new e.typeMap[n];return s.read(t,i),s}}}const cot={types:npe,json:{read:lot(npe),write:{overridePolicy:(e,t,r)=>({enabled:!r||!r.isPresentation})}}};var RJ;const dot=fe.getLogger("esri.webscene.Environment"),spe=(e,t,r)=>({enabled:!r||!r.isPresentation});let g1=RJ=class extends ge{constructor(e){super(e),this.lighting=new LA,this.background=null,this.atmosphereEnabled=!0,this.starsEnabled=!0}set weather(e){sot(e==null?void 0:e.type,dot)&&this._set("weather",e)}clone(){return new RJ(this.cloneConstructProperties())}cloneConstructProperties(){return{lighting:this.lighting&&this.lighting.type==="virtual"?Rz.prototype.clone.call(this.lighting):LA.prototype.clone.call(this.lighting),background:te(this.background),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,weather:this.weather.clone()}}};d([f({types:aot,nonNullable:!0,json:{write:!0}})],g1.prototype,"lighting",void 0),d([f(cot)],g1.prototype,"background",void 0),d([f({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:spe}}})],g1.prototype,"atmosphereEnabled",void 0),d([f({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:spe}}})],g1.prototype,"starsEnabled",void 0),d([f({types:mEe,nonNullable:!0,json:{write:!0},value:new xJ})],g1.prototype,"weather",null),g1=RJ=d([$("esri.webscene.Environment")],g1);const bEe=g1;var iC;let AS=iC=class extends bEe{constructor(e){super(e),this.atmosphere=new c7,this.lighting=new m1}static fromWebsceneEnvironment(e){const t=e.cloneConstructProperties();return new iC({...t,lighting:t.lighting.type==="virtual"?JE.fromWebsceneLighting(t.lighting):m1.fromWebsceneLighting(t.lighting)})}castLighting(e){return this._convertLighting(e)}applyLighting(e){this.lighting=this._convertLighting(e)}_convertLighting(e){return e?e instanceof m1||e instanceof JE?e:e instanceof LA?this.lighting&&this.lighting.type==="sun"?this.lighting.cloneWithWebsceneLighting(e):new m1(e.cloneConstructProperties()):e instanceof Rz?this.lighting&&this.lighting.type==="virtual"?this.lighting.cloneWithWebsceneLighting(e):new JE(e.cloneConstructProperties()):Mp(Kat,e):new m1}clone(){return new iC({lighting:this.lighting.clone(),atmosphere:this.atmosphere.clone(),weather:this.weather.clone(),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,background:te(this.background)})}cloneWithWebsceneEnvironment(e){return new iC({atmosphere:this.atmosphere.clone(),weather:this.weather.clone(),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,background:te(this.background),...e.cloneConstructProperties(),lighting:this._getLighting(e)})}_getLighting(e){return e.lighting.type==="sun"?this.lighting&&this.lighting.type==="sun"?this.lighting.cloneWithWebsceneLighting(e.lighting):m1.fromWebsceneLighting(e.lighting):e.lighting.type==="virtual"?this.lighting&&this.lighting.type==="virtual"?this.lighting.cloneWithWebsceneLighting(e.lighting):JE.fromWebsceneLighting(e.lighting):m1.fromWebsceneLighting(e.lighting)}};d([f({type:c7,json:{read:!1},nonNullable:!0})],AS.prototype,"atmosphere",void 0),d([f({nonNullable:!0})],AS.prototype,"lighting",void 0),d([Xt("lighting")],AS.prototype,"castLighting",null),AS=iC=d([$("esri.views.3d.environment.SceneViewEnvironment")],AS);const RS=AS;function Na(e,t){return e[0]=t[0],e[1]=t[1],e}function vr(e,t,r){return e[0]=t,e[1]=r,e}function Kf(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e}function q0(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e}function vEe(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e}function _Ee(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e}function uot(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e}function hot(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e}function fot(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e}function pot(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e}function mot(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e}function Qc(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e}function got(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e}function Xne(e,t){const r=t[0]-e[0],i=t[1]-e[1];return Math.sqrt(r*r+i*i)}function FN(e,t){const r=t[0]-e[0],i=t[1]-e[1];return r*r+i*i}function Yne(e){const t=e[0],r=e[1];return Math.sqrt(t*t+r*r)}function wEe(e){const t=e[0],r=e[1];return t*t+r*r}function Zne(e,t){return e[0]=-t[0],e[1]=-t[1],e}function yot(e,t){return e[0]=1/t[0],e[1]=1/t[1],e}function DA(e,t){const r=t[0],i=t[1];let n=r*r+i*i;return n>0&&(n=1/Math.sqrt(n),e[0]=t[0]*n,e[1]=t[1]*n),e}function us(e,t){return e[0]*t[0]+e[1]*t[1]}function bot(e,t,r){const i=t[0]*r[1]-t[1]*r[0];return e[0]=e[1]=0,e[2]=i,e}function OS(e,t,r,i){const n=t[0],s=t[1];return e[0]=n+i*(r[0]-n),e[1]=s+i*(r[1]-s),e}function vot(e,t){t=t||1;const r=2*up()*Math.PI;return e[0]=Math.cos(r)*t,e[1]=Math.sin(r)*t,e}function OJ(e,t,r){const i=t[0],n=t[1];return e[0]=r[0]*i+r[2]*n,e[1]=r[1]*i+r[3]*n,e}function X2(e,t,r){const i=t[0],n=t[1];return e[0]=r[0]*i+r[2]*n+r[4],e[1]=r[1]*i+r[3]*n+r[5],e}function _ot(e,t,r){const i=t[0],n=t[1];return e[0]=r[0]*i+r[3]*n+r[6],e[1]=r[1]*i+r[4]*n+r[7],e}function wot(e,t,r){const i=t[0],n=t[1];return e[0]=r[0]*i+r[4]*n+r[12],e[1]=r[1]*i+r[5]*n+r[13],e}function xot(e,t,r,i){const n=t[0]-r[0],s=t[1]-r[1],a=Math.sin(i),o=Math.cos(i);return e[0]=n*o-s*a+r[0],e[1]=n*a+s*o+r[1],e}function Tot(e,t){const r=e[0],i=e[1],n=t[0],s=t[1];let a=r*r+i*i;a>0&&(a=1/Math.sqrt(a));let o=n*n+s*s;o>0&&(o=1/Math.sqrt(o));const l=(r*n+i*s)*a*o;return l>1?0:l<-1?Math.PI:Math.acos(l)}function Sot(e){return"vec2("+e[0]+", "+e[1]+")"}function xEe(e,t){return e[0]===t[0]&&e[1]===t[1]}function Eot(e,t){const r=e[0],i=e[1],n=t[0],s=t[1];return Math.abs(r-n)<=Rt*Math.max(1,Math.abs(r),Math.abs(n))&&Math.abs(i-s)<=Rt*Math.max(1,Math.abs(i),Math.abs(s))}function Cot(e,t,r,i,n){let s=t[0]-r[0],a=t[1]-r[1];const o=(i[0]*s+i[1]*a)*(n-1);return s=i[0]*o,a=i[1]*o,e[0]=t[0]+s,e[1]=t[1]+a,e}const Aot=Yne,Rot=q0,Oot=vEe,Mot=_Ee,TEe=Xne,Pot=FN,Iot=wEe;Object.freeze(Object.defineProperty({__proto__:null,copy:Na,set:vr,add:Kf,subtract:q0,multiply:vEe,divide:_Ee,ceil:uot,floor:hot,min:fot,max:pot,round:mot,scale:Qc,scaleAndAdd:got,distance:Xne,squaredDistance:FN,length:Yne,squaredLength:wEe,negate:Zne,inverse:yot,normalize:DA,dot:us,cross:bot,lerp:OS,random:vot,transformMat2:OJ,transformMat2d:X2,transformMat3:_ot,transformMat4:wot,rotate:xot,angle:Tot,str:Sot,exactEquals:xEe,equals:Eot,projectAndScale:Cot,len:Aot,sub:Rot,mul:Oot,div:Mot,dist:TEe,sqrDist:Pot,sqrLen:Iot},Symbol.toStringTag,{value:"Module"}));function SEe(e){return Math.min(1,Math.max(0,(e-1e5)/(1e6-1e5)))}const MJ=1e4,Hx=Ve(5802e-9,13558e-9,331e-7),vj=3,_j=Ve(65e-8*vj,1881e-9*vj,85e-9*vj),$ot=3996e-9,Lot=.085,JL=1e5;class as{}function S(e,...t){let r="";for(let i=0;i<t.length;i++)r+=e[i]+t[i];return r+=e[e.length-1],r}(function(e){function t(i){return Math.round(i).toString()}function r(i){return i.toPrecision(8)}e.int=t,e.float=r})(S||(S={}));var O;(function(e){e.POSITION="position",e.NORMAL="normal",e.UV0="uv0",e.AUXPOS1="auxpos1",e.AUXPOS2="auxpos2",e.MAPPOS="mapPos",e.COLOR="color",e.SYMBOLCOLOR="symbolColor",e.SIZE="size",e.TANGENT="tangent",e.OFFSET="offset",e.SUBDIVISIONFACTOR="subdivisionFactor",e.COLORFEATUREATTRIBUTE="colorFeatureAttribute",e.SIZEFEATUREATTRIBUTE="sizeFeatureAttribute",e.OPACITYFEATUREATTRIBUTE="opacityFeatureAttribute",e.DISTANCETOSTART="distanceToStart",e.UVMAPSPACE="uvMapSpace",e.BOUNDINGRECT="boundingRect",e.UVREGION="uvRegion",e.NORMALCOMPRESSED="normalCompressed",e.PROFILERIGHT="profileRight",e.PROFILEUP="profileUp",e.PROFILEVERTEXANDNORMAL="profileVertexAndNormal",e.FEATUREVALUE="featureValue",e.MODELORIGINHI="modelOriginHi",e.MODELORIGINLO="modelOriginLo",e.MODEL="model",e.MODELNORMAL="modelNormal",e.INSTANCECOLOR="instanceColor",e.INSTANCEFEATUREATTRIBUTE="instanceFeatureAttribute",e.LOCALTRANSFORM="localTransform",e.GLOBALTRANSFORM="globalTransform",e.BOUNDINGSPHERE="boundingSphere",e.MODELORIGIN="modelOrigin",e.MODELSCALEFACTORS="modelScaleFactors",e.FEATUREATTRIBUTE="featureAttribute",e.STATE="state",e.LODLEVEL="lodLevel",e.POSITION0="position0",e.POSITION1="position1",e.NORMALA="normalA",e.NORMALB="normalB",e.COMPONENTINDEX="componentIndex",e.VARIANTOFFSET="variantOffset",e.VARIANTSTROKE="variantStroke",e.VARIANTEXTENSION="variantExtension",e.U8PADDING="u8padding",e.U16PADDING="u16padding",e.SIDENESS="sideness",e.START="start",e.END="end",e.UP="up",e.EXTRUDE="extrude"})(O||(O={}));var ws;function hy(e,t){switch(t.textureCoordinateType){case ws.Default:return e.attributes.add(O.UV0,"vec2"),e.varyings.add("vuv0","vec2"),void e.vertex.code.add(S`void forwardTextureCoordinates() {
vuv0 = uv0;
}`);case ws.Atlas:return e.attributes.add(O.UV0,"vec2"),e.varyings.add("vuv0","vec2"),e.attributes.add(O.UVREGION,"vec4"),e.varyings.add("vuvRegion","vec4"),void e.vertex.code.add(S`void forwardTextureCoordinates() {
vuv0 = uv0;
vuvRegion = uvRegion;
}`);case ws.None:return void e.vertex.code.add(S`void forwardTextureCoordinates() {}`);default:t.textureCoordinateType;case ws.COUNT:return}}(function(e){e[e.None=0]="None",e[e.Default=1]="Default",e[e.Atlas=2]="Atlas",e[e.COUNT=3]="COUNT"})(ws||(ws={}));function bd(e){e.code.add(S`const float MAX_RGBA_FLOAT =
255.0 / 256.0 +
255.0 / 256.0 / 256.0 +
255.0 / 256.0 / 256.0 / 256.0 +
255.0 / 256.0 / 256.0 / 256.0 / 256.0;
const vec4 FIXED_POINT_FACTORS = vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);
vec4 float2rgba(const float value) {
float valueInValidDomain = clamp(value, 0.0, MAX_RGBA_FLOAT);
vec4 fixedPointU8 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);
const float toU8AsFloat = 1.0 / 255.0;
return fixedPointU8 * toU8AsFloat;
}
const vec4 RGBA_2_FLOAT_FACTORS = vec4(
255.0 / (256.0),
255.0 / (256.0 * 256.0),
255.0 / (256.0 * 256.0 * 256.0),
255.0 / (256.0 * 256.0 * 256.0 * 256.0)
);
float rgba2float(vec4 rgba) {
return dot(rgba, RGBA_2_FLOAT_FACTORS);
}`)}function Ou(e){e.include(bd),e.code.add(S`float linearDepthFromFloat(float depth, vec2 nearFar) {
return -(depth * (nearFar[1] - nearFar[0]) + nearFar[0]);
}
float linearDepthFromTexture(sampler2D depthTex, vec2 uv, vec2 nearFar) {
return linearDepthFromFloat(rgba2float(texture2D(depthTex, uv)), nearFar);
}`)}function Oz(e){e.fragment.code.add(S`const float GAMMA = 2.2;
const float INV_GAMMA = 0.4545454545;
vec4 delinearizeGamma(vec4 color) {
return vec4(pow(color.rgb, vec3(INV_GAMMA)), color.w);
}
vec3 linearizeGamma(vec3 color) {
return pow(color, vec3(GAMMA));
}`)}var zr;(function(e){e[e.Pass=0]="Pass",e[e.Draw=1]="Draw"})(zr||(zr={}));class sn{constructor(t,r,i,n,s=null){this.name=t,this.type=r,this.arraySize=s,this.bind={[zr.Pass]:null,[zr.Draw]:null},_(i)&&_(n)&&(this.bind[i]=n)}equals(t){return this.type===t.type&&this.name===t.name&&this.arraySize===t.arraySize}}class _r extends sn{constructor(t,r){super(t,"vec2",zr.Pass,(i,n,s)=>i.setUniform2fv(t,r(n,s)))}}class fy extends sn{constructor(t){super(t,"vec2")}}class St extends sn{constructor(t,r){super(t,"vec3",zr.Pass,(i,n,s)=>i.setUniform3fv(t,r(n,s)))}}class tc extends sn{constructor(t){super(t,"vec3")}}class pl extends sn{constructor(t){super(t,"vec4")}}class kr extends sn{constructor(t){super(t,"float")}}class Ei extends sn{constructor(t,r){super(t,"mat4",zr.Pass,(i,n,s)=>i.setUniformMatrix4fv(t,r(n,s)))}}const Dot=fe.getLogger("esri.views.3d.webgl-engine.core.shaderModules.shaderBuilder");class EEe{constructor(){this.includedModules=new Map}include(t,r){if(this.includedModules.has(t)){const i=this.includedModules.get(t);if(i!==r){Dot.error("Trying to include shader module multiple times with different sets of options.");const n=new Set;for(const s of Object.keys(i))i[s]!==t[s]&&n.add(s);for(const s of Object.keys(t))i[s]!==t[s]&&n.add(s);n.forEach(s=>console.error(`  ${s}: current ${i[s]} new ${t[s]}`))}}else this.includedModules.set(t,r),t(this.builder,r)}}class Qr extends EEe{constructor(){super(...arguments),this.vertex=new ape,this.fragment=new ape,this.attributes=new kot,this.varyings=new Vot,this.extensions=new h9,this.constants=new Pn}get fragmentUniforms(){return this.fragment.uniforms.entries}get builder(){return this}generate(t){const r=this.extensions.generateSource(t),i=this.attributes.generateSource(t),n=this.varyings.generateSource(),s=t==="vertex"?this.vertex:this.fragment,a=s.uniforms.generateSource(),o=s.code.generateSource(),l=t==="vertex"?Uot:zot,c=this.constants.generateSource().concat(s.constants.generateSource());return`
${r.join(`
`)}

${l}

${c.join(`
`)}

${a.join(`
`)}

${i.join(`
`)}

${n.join(`
`)}

${o.join(`
`)}`}generateBind(t,r){const i=new Map;this.vertex.uniforms.entries.forEach(a=>{const o=a.bind[t];_(o)&&i.set(a.name,o)}),this.fragment.uniforms.entries.forEach(a=>{const o=a.bind[t];_(o)&&i.set(a.name,o)});const n=Array.from(i.values()),s=n.length;return(a,o)=>{for(let l=0;l<s;++l)n[l](r,a,o)}}}class Fot{constructor(){this._entries=new Map}add(t){if(!Array.isArray(t))return this._add(t);for(const r of t)this._add(r)}_add(t){if(this._entries.has(t.name)&&!this._entries.get(t.name).equals(t))throw new k(`Duplicate uniform name ${t.name} for different uniform type`);this._entries.set(t.name,t)}generateSource(){return Array.from(this._entries.values()).map(t=>_(t.arraySize)?`uniform ${t.type} ${t.name}[${t.arraySize}];`:`uniform ${t.type} ${t.name};`)}get entries(){return Array.from(this._entries.values())}}class Not{constructor(){this._entries=new Array}add(t){this._entries.push(t)}generateSource(){return this._entries}}class ape extends EEe{constructor(){super(...arguments),this.uniforms=new Fot,this.code=new Not,this.constants=new Pn}get builder(){return this}}class kot{constructor(){this._entries=new Array}add(t,r){this._entries.push([t,r])}generateSource(t){return t==="fragment"?[]:this._entries.map(r=>`attribute ${r[1]} ${r[0]};`)}}class Vot{constructor(){this._entries=new Array}add(t,r){this._entries.push([t,r])}generateSource(){return this._entries.map(t=>`varying ${t[1]} ${t[0]};`)}}class h9{constructor(){this._entries=new Set}add(t){this._entries.add(t)}generateSource(t){const r=t==="vertex"?h9.ALLOWLIST_VERTEX:h9.ALLOWLIST_FRAGMENT;return Array.from(this._entries).filter(i=>r.includes(i)).map(i=>`#extension ${i} : enable`)}}h9.ALLOWLIST_FRAGMENT=["GL_EXT_shader_texture_lod","GL_OES_standard_derivatives"],h9.ALLOWLIST_VERTEX=[];class Pn{constructor(){this._entries=new Set}add(t,r,i){let n="ERROR_CONSTRUCTOR_STRING";switch(r){case"float":n=Pn._numberToFloatStr(i);break;case"int":n=Pn._numberToIntStr(i);break;case"bool":n=i.toString();break;case"vec2":n=`vec2(${Pn._numberToFloatStr(i[0])},                            ${Pn._numberToFloatStr(i[1])})`;break;case"vec3":n=`vec3(${Pn._numberToFloatStr(i[0])},                            ${Pn._numberToFloatStr(i[1])},                            ${Pn._numberToFloatStr(i[2])})`;break;case"vec4":n=`vec4(${Pn._numberToFloatStr(i[0])},                            ${Pn._numberToFloatStr(i[1])},                            ${Pn._numberToFloatStr(i[2])},                            ${Pn._numberToFloatStr(i[3])})`;break;case"ivec2":n=`ivec2(${Pn._numberToIntStr(i[0])},                             ${Pn._numberToIntStr(i[1])})`;break;case"ivec3":n=`ivec3(${Pn._numberToIntStr(i[0])},                             ${Pn._numberToIntStr(i[1])},                             ${Pn._numberToIntStr(i[2])})`;break;case"ivec4":n=`ivec4(${Pn._numberToIntStr(i[0])},                             ${Pn._numberToIntStr(i[1])},                             ${Pn._numberToIntStr(i[2])},                             ${Pn._numberToIntStr(i[3])})`;break;case"mat2":case"mat3":case"mat4":n=`${r}(${Array.prototype.map.call(i,s=>Pn._numberToFloatStr(s)).join(", ")})`}return this._entries.add(`const ${r} ${t} = ${n};`),this}static _numberToIntStr(t){return t.toFixed(0)}static _numberToFloatStr(t){return Number.isInteger(t)?t.toFixed(1):t.toString()}generateSource(){return Array.from(this._entries)}}const zot=`#ifdef GL_FRAGMENT_PRECISION_HIGH
  precision highp float;
  precision highp sampler2D;
#else
  precision mediump float;
  precision mediump sampler2D;
#endif`,Uot=`precision highp float;
precision highp sampler2D;`;class Hi extends sn{constructor(t){super(t,"sampler2D")}}function Bot(e){const t=new Qr;t.attributes.add(O.POSITION,"vec2"),t.include(hy,{textureCoordinateType:ws.Default}),t.varyings.add("worldRay","vec3"),t.varyings.add("eyeDir","vec3");const{vertex:r,fragment:i}=t;return r.uniforms.add([new Ei("inverseProjectionMatrix",(n,s)=>s.camera.inverseProjectionMatrix),new Ei("inverseViewMatrix",(n,s)=>Rn(Got,s.camera.viewMatrix))]),r.code.add(S`void main(void) {
vec3 posViewNear = (inverseProjectionMatrix * vec4(position, -1, 1)).xyz;
eyeDir = posViewNear;
worldRay = (inverseViewMatrix * vec4(posViewNear, 0)).xyz;
forwardTextureCoordinates();
gl_Position = vec4(position, 1, 1);
}`),i.uniforms.add([new St("lightingMainDirection",(n,s)=>s.lighting.lightingMainDirection),new fy("radii"),new kr("scaleHeight"),new tc("cameraPosition"),new pl("heightParameters"),new kr("innerFadeDistance"),new kr("altitudeFade"),new Hi("depthTex"),new tc("betaRayleigh"),new tc("betaCombined"),new kr("betaMie"),new kr("hazeStrength")]),t.include(Oz),e.haze&&(i.include(Ou),i.uniforms.add(new _r("nearFar",(n,s)=>s.camera.nearFar))),i.code.add(S`vec2 sphereIntersect(vec3 start, vec3 dir, float radius, bool planet) {
float a = dot(dir, dir);
float b = 2.0 * dot(dir, start);
float c = planet ? heightParameters[1] - radius * radius : heightParameters[2];
float d = (b * b) - 4.0 * a * c;
if (d < 0.0) {
return vec2(1e5, -1e5);
}
return vec2((-b - sqrt(d)) / (2.0 * a), (-b + sqrt(d)) / (2.0 * a));
}`),i.code.add(S`float chapmanApproximation(float X, float h, float cosZenith) {
float c = sqrt(X + h);
float cExpH = c * exp(-h);
if (cosZenith >= 0.0) {
return cExpH / (c * cosZenith + 1.0);
} else {
float x0 = sqrt(1.0 - cosZenith * cosZenith) * (X + h);
float c0 = sqrt(x0);
return 2.0 * c0 * exp(X - x0) - cExpH / (1.0 - c * cosZenith);
}
}`),i.code.add(S`float getOpticalDepth(vec3 position, vec3 dir, float h) {
return scaleHeight * chapmanApproximation(radii[0] / scaleHeight, h, dot(normalize(position), dir));
}`),i.code.add(S`
    const int STEPS = 6;

    float getGlow(float dist, float radius, float intensity) {
      return pow(radius / max(dist, 1e-6), intensity);
    }

    vec3 getAtmosphereColour(vec3 cameraPos, vec3 rayDir, vec3 lightDir, float terrainDepth) {
      float reducedPlanetRadius = radii[0] - 20000.0;
      vec2 rayPlanetIntersect = sphereIntersect(cameraPos, rayDir, reducedPlanetRadius, true);
      vec2 rayAtmosphereIntersect = sphereIntersect(cameraPos, rayDir, radii[1], false);
      bool hitsAtmosphere = (rayAtmosphereIntersect.x <= rayAtmosphereIntersect.y) && rayAtmosphereIntersect.x > 0.0;
      bool insideAtmosphere = heightParameters[0] < radii[1];

      if (!(hitsAtmosphere || insideAtmosphere)) {
        return vec3(0);
      }

      bool hitsPlanet = (rayPlanetIntersect.x <= rayPlanetIntersect.y) && rayPlanetIntersect.x > 0.0;

      float start = insideAtmosphere ? 0.0 : rayAtmosphereIntersect.x;

      if (heightParameters[0] < reducedPlanetRadius) {
        // Long light rays from the night side of the planet lead to numerical instability
        // Do not render the atmosphere in such cases
        if (dot(rayDir, normalize(cameraPos)) < -0.025) {
          return vec3(0);
        }
        start = rayPlanetIntersect.y;
      }

      float end = hitsPlanet ? rayPlanetIntersect.x : rayAtmosphereIntersect.y;
      float maxEnd = end;

      ${e.haze?S`if (terrainDepth != -1.0) { end = terrainDepth; }`:""}

      vec3 samplePoint = cameraPos + rayDir * end;
      float multiplier = hitsPlanet ? -1.0 : 1.0;

      vec3 scattering = vec3(0);
      float scaleFract = (length(samplePoint) - radii[0]) / scaleHeight;
      float lastOpticalDepth = getOpticalDepth(samplePoint, rayDir, scaleFract);
      float stepSize = (end - start) / float(STEPS);
      for (int i = 0; i < STEPS; i++) {
        samplePoint -= stepSize * rayDir;
        scaleFract = (length(samplePoint) - radii[0]) / scaleHeight;
        float opticalDepth = multiplier * getOpticalDepth(samplePoint, rayDir * multiplier, scaleFract);

        if (i > 0) {
          scattering *= ${e.haze?S``:" mix(2.5, 1.0, clamp((length(cameraPos) - radii[0]) / 50e3, 0.0, 1.0)) * "} exp(-(mix(betaCombined, betaRayleigh, 0.5) + betaMie) * max(0.0, (opticalDepth - lastOpticalDepth)));
        }

        if (dot(normalize(samplePoint), lightDir) > -0.3) {

          float scale = exp(-scaleFract);
          float lightDepth = getOpticalDepth(samplePoint, lightDir, scaleFract);

          scattering += scale * exp(-(betaCombined + betaMie) * lightDepth);
          ${e.haze?"":S`scattering += scale * exp(-(0.25 * betaCombined ) * lightDepth);`}
        }

        lastOpticalDepth = opticalDepth;

      }

      float mu = dot(rayDir, lightDir);
      float mumu = 1.0 + mu * mu;

      float phaseRayleigh = 0.05968310365 * mumu;

      ${e.haze?S`return 3.0 * scattering * stepSize * phaseRayleigh * betaRayleigh;`:S`
            const float g = 0.8;
            const float gg = g * g;
            float phaseMie = end == maxEnd ? 0.11936620731 * ((1.0 - gg) * mumu) / (pow(1.0 + gg - 2.0 * mu * g, 1.5) * (2.0 + gg)) : 0.0;
            phaseMie += getGlow(1.0 - mu, 5e-5, 3.0) * smoothstep(0.01, 0.1, length(scattering));
            phaseMie = clamp(phaseMie, 0.0, 128.0);
            return 3.0 * scattering * stepSize * (phaseRayleigh * betaRayleigh + 0.025 * phaseMie * betaMie);`}
    }

    vec3 tonemapACES(vec3 x) {
      return clamp((x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14), 0.0, 1.0);
    }

    vec4 applyUndergroundAtmosphere(vec3 rayDir, vec3 lightDirection, vec4 fragColor) {
      vec2 rayPlanetIntersect = sphereIntersect(cameraPosition, rayDir, radii[0], true);
      if (!((rayPlanetIntersect.x <= rayPlanetIntersect.y) && rayPlanetIntersect.y > 0.0)) {
        return fragColor;
      }

      float lightAngle = dot(lightDirection, normalize(cameraPosition + rayDir * max(0.0, rayPlanetIntersect.x)));
      vec4 surfaceColor = vec4(vec3(max(0.0, (smoothstep(-1.0, 0.8, 2.0 * lightAngle)))), 1.0 - altitudeFade);
      float relDist = (rayPlanetIntersect.y - max(0.0, rayPlanetIntersect.x)) / innerFadeDistance;
      if (relDist > 1.0) {
        return surfaceColor;
      }

      return mix(gl_FragColor, surfaceColor, smoothstep(0.0, 1.0, relDist * relDist));
    }

    void main() {
      vec3 rayDir = normalize(worldRay);
      float terrainDepth = -1.0;
      ${e.haze?S`
          vec4 depthSample = texture2D(depthTex, vuv0).rgba;
          if (depthSample != vec4(0)) {
            vec3 cameraSpaceRay = normalize(eyeDir);
            cameraSpaceRay /= cameraSpaceRay.z;
            cameraSpaceRay *= -linearDepthFromTexture(depthTex, vuv0, nearFar);
            terrainDepth = max(0.0, length(cameraSpaceRay));
          }`:S`
          float depthSample = texture2D(depthTex, vuv0).r;
          if (depthSample != 1.0) {
            gl_FragColor = vec4(0);
            return;
          }`}

      ${e.haze?S`
            vec3 col = vec3(0);
            float fadeOut = smoothstep(-10000.0, -15000.0, heightParameters[0] - radii[0]);
            if(depthSample != vec4(0)){
              col = (1.0 - fadeOut) * hazeStrength * getAtmosphereColour(cameraPosition, rayDir, lightingMainDirection, terrainDepth);
            }
            float alpha = 1.0 - fadeOut;`:S`
            vec3 col = getAtmosphereColour(cameraPosition, rayDir, lightingMainDirection, terrainDepth);;
            float alpha = smoothstep(0.0, mix(0.15, 0.01, heightParameters[3]), length(col));`}
      col = tonemapACES(col);
      gl_FragColor = delinearizeGamma(vec4(col, alpha));
      ${e.haze?"":S`
          if (depthSample == 1.0) {
            gl_FragColor = applyUndergroundAtmosphere(rayDir, lightingMainDirection, gl_FragColor);
          }`}
    }
  `),t}const Got=Ae(),jot=Object.freeze(Object.defineProperty({__proto__:null,build:Bot},Symbol.toStringTag,{value:"Module"}));class si{constructor(t,r){this._module=t,this._loadModule=r}get(){return this._module}async reload(){return this._module=await this._loadModule(),this._module}}var ii,Dt,Re,Dy,Tt,bp,f9,ft,vi,fn,tt,xt,mt,Ue,gt,At,cl,Cr,iu,ea,hn,Pr;(function(e){e[e.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",e[e.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",e[e.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT"})(ii||(ii={})),function(e){e[e.POINTS=0]="POINTS",e[e.LINES=1]="LINES",e[e.LINE_LOOP=2]="LINE_LOOP",e[e.LINE_STRIP=3]="LINE_STRIP",e[e.TRIANGLES=4]="TRIANGLES",e[e.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",e[e.TRIANGLE_FAN=6]="TRIANGLE_FAN"}(Dt||(Dt={})),function(e){e[e.ZERO=0]="ZERO",e[e.ONE=1]="ONE",e[e.SRC_COLOR=768]="SRC_COLOR",e[e.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",e[e.SRC_ALPHA=770]="SRC_ALPHA",e[e.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",e[e.DST_ALPHA=772]="DST_ALPHA",e[e.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",e[e.DST_COLOR=774]="DST_COLOR",e[e.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",e[e.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",e[e.CONSTANT_COLOR=32769]="CONSTANT_COLOR",e[e.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",e[e.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",e[e.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA"}(Re||(Re={})),function(e){e[e.ADD=32774]="ADD",e[e.SUBTRACT=32778]="SUBTRACT",e[e.REVERSE_SUBTRACT=32779]="REVERSE_SUBTRACT"}(Dy||(Dy={})),function(e){e[e.ARRAY_BUFFER=34962]="ARRAY_BUFFER",e[e.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",e[e.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",e[e.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER",e[e.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER",e[e.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER",e[e.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER"}(Tt||(Tt={})),function(e){e[e.FRONT=1028]="FRONT",e[e.BACK=1029]="BACK",e[e.FRONT_AND_BACK=1032]="FRONT_AND_BACK"}(bp||(bp={})),function(e){e[e.CW=2304]="CW",e[e.CCW=2305]="CCW"}(f9||(f9={})),function(e){e[e.BYTE=5120]="BYTE",e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.SHORT=5122]="SHORT",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.INT=5124]="INT",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.FLOAT=5126]="FLOAT"}(ft||(ft={})),function(e){e[e.NEVER=512]="NEVER",e[e.LESS=513]="LESS",e[e.EQUAL=514]="EQUAL",e[e.LEQUAL=515]="LEQUAL",e[e.GREATER=516]="GREATER",e[e.NOTEQUAL=517]="NOTEQUAL",e[e.GEQUAL=518]="GEQUAL",e[e.ALWAYS=519]="ALWAYS"}(vi||(vi={})),function(e){e[e.ZERO=0]="ZERO",e[e.KEEP=7680]="KEEP",e[e.REPLACE=7681]="REPLACE",e[e.INCR=7682]="INCR",e[e.DECR=7683]="DECR",e[e.INVERT=5386]="INVERT",e[e.INCR_WRAP=34055]="INCR_WRAP",e[e.DECR_WRAP=34056]="DECR_WRAP"}(fn||(fn={})),function(e){e[e.NEAREST=9728]="NEAREST",e[e.LINEAR=9729]="LINEAR",e[e.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",e[e.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",e[e.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",e[e.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR"}(tt||(tt={})),function(e){e[e.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",e[e.REPEAT=10497]="REPEAT",e[e.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT"}(xt||(xt={})),function(e){e[e.TEXTURE_2D=3553]="TEXTURE_2D",e[e.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",e[e.TEXTURE_3D=32879]="TEXTURE_3D",e[e.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",e[e.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",e[e.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",e[e.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",e[e.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY"}(mt||(mt={})),function(e){e[e.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",e[e.DEPTH_STENCIL=34041]="DEPTH_STENCIL",e[e.ALPHA=6406]="ALPHA",e[e.RGB=6407]="RGB",e[e.RGBA=6408]="RGBA",e[e.LUMINANCE=6409]="LUMINANCE",e[e.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",e[e.RED=6403]="RED",e[e.RG=33319]="RG",e[e.RED_INTEGER=36244]="RED_INTEGER",e[e.RG_INTEGER=33320]="RG_INTEGER",e[e.RGB_INTEGER=36248]="RGB_INTEGER",e[e.RGBA_INTEGER=36249]="RGBA_INTEGER"}(Ue||(Ue={})),function(e){e[e.RGBA4=32854]="RGBA4",e[e.R16F=33325]="R16F",e[e.RG16F=33327]="RG16F",e[e.RGB32F=34837]="RGB32F",e[e.RGBA16F=34842]="RGBA16F",e[e.R32F=33326]="R32F",e[e.RG32F=33328]="RG32F",e[e.RGBA32F=34836]="RGBA32F",e[e.R11F_G11F_B10F=35898]="R11F_G11F_B10F",e[e.RGB8=32849]="RGB8",e[e.RGBA8=32856]="RGBA8",e[e.RGB5_A1=32855]="RGB5_A1",e[e.R8=33321]="R8",e[e.RG8=33323]="RG8",e[e.R8I=33329]="R8I",e[e.R8UI=33330]="R8UI",e[e.R16I=33331]="R16I",e[e.R16UI=33332]="R16UI",e[e.R32I=33333]="R32I",e[e.R32UI=33334]="R32UI",e[e.RG8I=33335]="RG8I",e[e.RG8UI=33336]="RG8UI",e[e.RG16I=33337]="RG16I",e[e.RG16UI=33338]="RG16UI",e[e.RG32I=33339]="RG32I",e[e.RG32UI=33340]="RG32UI",e[e.RGB16F=34843]="RGB16F",e[e.RGB9_E5=35901]="RGB9_E5",e[e.SRGB8=35905]="SRGB8",e[e.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",e[e.RGB565=36194]="RGB565",e[e.RGBA32UI=36208]="RGBA32UI",e[e.RGB32UI=36209]="RGB32UI",e[e.RGBA16UI=36214]="RGBA16UI",e[e.RGB16UI=36215]="RGB16UI",e[e.RGBA8UI=36220]="RGBA8UI",e[e.RGB8UI=36221]="RGB8UI",e[e.RGBA32I=36226]="RGBA32I",e[e.RGB32I=36227]="RGB32I",e[e.RGBA16I=36232]="RGBA16I",e[e.RGB16I=36233]="RGB16I",e[e.RGBA8I=36238]="RGBA8I",e[e.RGB8I=36239]="RGB8I",e[e.R8_SNORM=36756]="R8_SNORM",e[e.RG8_SNORM=36757]="RG8_SNORM",e[e.RGB8_SNORM=36758]="RGB8_SNORM",e[e.RGBA8_SNORM=36759]="RGBA8_SNORM",e[e.RGB10_A2=32857]="RGB10_A2",e[e.RGB10_A2UI=36975]="RGB10_A2UI"}(gt||(gt={})),function(e){e[e.FLOAT=5126]="FLOAT",e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",e[e.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",e[e.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",e[e.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",e[e.BYTE=5120]="BYTE",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.SHORT=5122]="SHORT",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.INT=5124]="INT",e[e.HALF_FLOAT=5131]="HALF_FLOAT",e[e.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",e[e.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",e[e.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",e[e.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV"}(At||(At={})),function(e){e[e.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",e[e.STENCIL_INDEX8=36168]="STENCIL_INDEX8",e[e.DEPTH_STENCIL=34041]="DEPTH_STENCIL",e[e.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",e[e.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",e[e.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",e[e.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8"}(cl||(cl={})),function(e){e[e.STATIC_DRAW=35044]="STATIC_DRAW",e[e.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",e[e.STREAM_DRAW=35040]="STREAM_DRAW",e[e.STATIC_READ=35045]="STATIC_READ",e[e.DYNAMIC_READ=35049]="DYNAMIC_READ",e[e.STREAM_READ=35041]="STREAM_READ",e[e.STATIC_COPY=35046]="STATIC_COPY",e[e.DYNAMIC_COPY=35050]="DYNAMIC_COPY",e[e.STREAM_COPY=35042]="STREAM_COPY"}(Cr||(Cr={})),function(e){e[e.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",e[e.VERTEX_SHADER=35633]="VERTEX_SHADER"}(iu||(iu={})),function(e){e[e.FRAMEBUFFER=36160]="FRAMEBUFFER",e[e.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER",e[e.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER"}(ea||(ea={})),function(e){e[e.TEXTURE=0]="TEXTURE",e[e.RENDER_BUFFER=1]="RENDER_BUFFER",e[e.CUBEMAP=2]="CUBEMAP"}(hn||(hn={})),function(e){e[e.NONE=0]="NONE",e[e.DEPTH_RENDER_BUFFER=1]="DEPTH_RENDER_BUFFER",e[e.STENCIL_RENDER_BUFFER=2]="STENCIL_RENDER_BUFFER",e[e.DEPTH_STENCIL_RENDER_BUFFER=3]="DEPTH_STENCIL_RENDER_BUFFER",e[e.DEPTH_STENCIL_TEXTURE=4]="DEPTH_STENCIL_TEXTURE"}(Pr||(Pr={}));const wj=33984;var ks,Hd;(function(e){e[e.Texture=0]="Texture",e[e.BufferObject=1]="BufferObject",e[e.VertexArrayObject=2]="VertexArrayObject",e[e.Shader=3]="Shader",e[e.Program=4]="Program",e[e.FramebufferObject=5]="FramebufferObject",e[e.Renderbuffer=6]="Renderbuffer",e[e.Sync=7]="Sync",e[e.COUNT=8]="COUNT"})(ks||(ks={})),function(e){e[e.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",e[e.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1",e[e.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2",e[e.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3",e[e.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4",e[e.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5",e[e.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6",e[e.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7",e[e.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8",e[e.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9",e[e.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10",e[e.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11",e[e.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12",e[e.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13",e[e.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14",e[e.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15"}(Hd||(Hd={}));const ope=33306;var cn,lpe,cpe,dpe,NN,PJ,upe;(function(e){e[e.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",e[e.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",e[e.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",e[e.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",e[e.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",e[e.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",e[e.COMPRESSED_SRGB8_ETC2=37493]="COMPRESSED_SRGB8_ETC2",e[e.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",e[e.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",e[e.COMPRESSED_RGBA8_ETC2_EAC=37496]="COMPRESSED_RGBA8_ETC2_EAC",e[e.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC"})(cn||(cn={})),function(e){e[e.FLOAT=5126]="FLOAT",e[e.FLOAT_VEC2=35664]="FLOAT_VEC2",e[e.FLOAT_VEC3=35665]="FLOAT_VEC3",e[e.FLOAT_VEC4=35666]="FLOAT_VEC4",e[e.INT=5124]="INT",e[e.INT_VEC2=35667]="INT_VEC2",e[e.INT_VEC3=35668]="INT_VEC3",e[e.INT_VEC4=35669]="INT_VEC4",e[e.BOOL=35670]="BOOL",e[e.BOOL_VEC2=35671]="BOOL_VEC2",e[e.BOOL_VEC3=35672]="BOOL_VEC3",e[e.BOOL_VEC4=35673]="BOOL_VEC4",e[e.FLOAT_MAT2=35674]="FLOAT_MAT2",e[e.FLOAT_MAT3=35675]="FLOAT_MAT3",e[e.FLOAT_MAT4=35676]="FLOAT_MAT4",e[e.SAMPLER_2D=35678]="SAMPLER_2D",e[e.SAMPLER_CUBE=35680]="SAMPLER_CUBE",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2",e[e.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3",e[e.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4",e[e.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3",e[e.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4",e[e.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2",e[e.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4",e[e.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2",e[e.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3",e[e.SAMPLER_3D=35679]="SAMPLER_3D",e[e.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW",e[e.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY",e[e.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW",e[e.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW",e[e.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D",e[e.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D",e[e.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE",e[e.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY",e[e.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D",e[e.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D",e[e.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE",e[e.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY"}(lpe||(lpe={})),function(e){e[e.OBJECT_TYPE=37138]="OBJECT_TYPE",e[e.SYNC_CONDITION=37139]="SYNC_CONDITION",e[e.SYNC_STATUS=37140]="SYNC_STATUS",e[e.SYNC_FLAGS=37141]="SYNC_FLAGS"}(cpe||(cpe={})),function(e){e[e.UNSIGNALED=37144]="UNSIGNALED",e[e.SIGNALED=37145]="SIGNALED"}(dpe||(dpe={})),function(e){e[e.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED",e[e.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED",e[e.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED",e[e.WAIT_FAILED=37149]="WAIT_FAILED"}(NN||(NN={})),function(e){e[e.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE"}(PJ||(PJ={})),function(e){e[e.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT"}(upe||(upe={}));class gi{constructor(t,r,i){this.release=i,r&&(this.initializeConfiguration(t,r),this._configuration=r.snapshot()),this._program=this.initializeProgram(t),this._pipeline=this.initializePipeline(t.rctx.capabilities)}destroy(){this._program=Qe(this._program),this._pipeline=this._configuration=null}reload(t){Qe(this._program),this._program=this.initializeProgram(t),this._pipeline=this.initializePipeline(t.rctx.capabilities)}get program(){return this._program}get compiled(){return this.program.isCompiled}get key(){return this._configuration.key}get configuration(){return this._configuration}bindPass(t,r){this.program.bindPass(t,r)}bindDraw(t,r){this.program.bindDraw(t,r),this.program.rebindTextures()}bindPipelineState(t,r=null,i){t.setPipelineState(this.getPipelineState(r,i))}ensureAttributeLocations(t){this.program.assertCompatibleVertexAttributeLocations(t)}get primitiveType(){return Dt.TRIANGLES}getPipelineState(t,r){return this._pipeline}initializeConfiguration(t,r){}}const Ur=new Map([[O.POSITION,0],[O.NORMAL,1],[O.UV0,2],[O.COLOR,3],[O.SIZE,4],[O.TANGENT,4],[O.AUXPOS1,5],[O.SYMBOLCOLOR,5],[O.AUXPOS2,6],[O.FEATUREATTRIBUTE,6],[O.INSTANCEFEATUREATTRIBUTE,6],[O.INSTANCECOLOR,7],[O.MODEL,8],[O.MODELNORMAL,12],[O.MODELORIGINHI,11],[O.MODELORIGINLO,15]]),qot=fe.getLogger("esri/views/webgl");function Hot(e,t){switch(t){case e.INVALID_ENUM:return"Invalid Enum. An unacceptable value has been specified for an enumerated argument.";case e.INVALID_VALUE:return"Invalid Value. A numeric argument is out of range.";case e.INVALID_OPERATION:return"Invalid Operation. The specified command is not allowed for the current state.";case e.INVALID_FRAMEBUFFER_OPERATION:return"Invalid Framebuffer operation. The currently bound framebuffer is not framebuffer complete when trying to render to or to read from it.";case e.OUT_OF_MEMORY:return"Out of memory. Not enough memory is left to execute the command.";case e.CONTEXT_LOST_WEBGL:return"WebGL context has been lost";default:return"Unknown error"}}const CEe=!!ue("enable-feature:webgl-debug");function mh(){return CEe}function FA(){return CEe}function hv(e){if(mh()){const t=e.getError();if(t){const r=Hot(e,t),i=new Error().stack;qot.error(new k("webgl-error","WebGL error occured",{message:r,stack:i}))}}}class ai{constructor(t,r,i){this._context=t,this._locations=i,this._textures=new Map,this._freeTextureUnits=new Qt({deallocator:null}),this._glProgram=t.programCache.acquire(r.generate("vertex"),r.generate("fragment"),i),this._glProgram.stop=()=>{throw new Error("Wrapped _glProgram used directly")},this.bindPass=r.generateBind(zr.Pass,this),this.bindDraw=r.generateBind(zr.Draw,this),this._fragmentUniforms=mh()?r.fragmentUniforms:null}dispose(){this._glProgram.dispose()}get glName(){return this._glProgram.glName}get isCompiled(){return this._glProgram.isCompiled}setUniform1b(t,r){this._glProgram.setUniform1i(t,r?1:0)}setUniform1i(t,r){this._glProgram.setUniform1i(t,r)}setUniform1f(t,r){this._glProgram.setUniform1f(t,r)}setUniform2f(t,r,i){this._glProgram.setUniform2f(t,r,i)}setUniform2fv(t,r){this._glProgram.setUniform2fv(t,r)}setUniform3f(t,r,i,n){this._glProgram.setUniform3f(t,r,i,n)}setUniform3fv(t,r){this._glProgram.setUniform3fv(t,r)}setUniform4f(t,r,i,n,s){this._glProgram.setUniform4f(t,r,i,n,s)}setUniform4fv(t,r){this._glProgram.setUniform4fv(t,r)}setUniformMatrix3fv(t,r){this._glProgram.setUniformMatrix3fv(t,r)}setUniformMatrix4fv(t,r){this._glProgram.setUniformMatrix4fv(t,r)}setUniform1fv(t,r){this._glProgram.setUniform1fv(t,r)}setUniform1iv(t,r){this._glProgram.setUniform1iv(t,r)}setUniform2iv(t,r){this._glProgram.setUniform3iv(t,r)}setUniform3iv(t,r){this._glProgram.setUniform3iv(t,r)}setUniform4iv(t,r){this._glProgram.setUniform4iv(t,r)}assertCompatibleVertexAttributeLocations(t){t.locations!==this._locations&&console.error("VertexAttributeLocations are incompatible")}stop(){this._textures.clear(),this._freeTextureUnits.clear()}bindTexture(t,r){if(R(r)||r.glName==null){const n=this._textures.get(t);return n&&(this._context.bindTexture(null,n.unit),this._freeTextureUnit(n),this._textures.delete(t)),null}let i=this._textures.get(t);return i==null?(i=this._allocTextureUnit(r),this._textures.set(t,i)):i.texture=r,this._context.useProgram(this),this.setUniform1i(t,i.unit),this._context.bindTexture(r,i.unit),i.unit}rebindTextures(){this._context.useProgram(this),this._textures.forEach((t,r)=>{this._context.bindTexture(t.texture,t.unit),this.setUniform1i(r,t.unit)}),_(this._fragmentUniforms)&&this._fragmentUniforms.forEach(t=>{t.type!=="sampler2D"&&t.type!=="samplerCube"||this._textures.has(t.name)||console.error(`Texture sampler ${t.name} has no bound texture`)})}_allocTextureUnit(t){return{texture:t,unit:this._freeTextureUnits.length===0?this._textures.size:this._freeTextureUnits.pop()}}_freeTextureUnit(t){this._freeTextureUnits.push(t.unit)}}var pi,qw,A3,yt,Xn,qc,oc,p9,Fy,lc,Dv,m9,ui,Hw;(function(e){e[e.None=0]="None",e[e.Front=1]="Front",e[e.Back=2]="Back",e[e.COUNT=3]="COUNT"})(pi||(pi={})),function(e){e[e.Less=0]="Less",e[e.Lequal=1]="Lequal",e[e.COUNT=2]="COUNT"}(qw||(qw={})),function(e){e[e.NONE=0]="NONE",e[e.SMAA=1]="SMAA"}(A3||(A3={})),function(e){e[e.Color=0]="Color",e[e.Alpha=1]="Alpha",e[e.FrontFace=2]="FrontFace",e[e.NONE=3]="NONE",e[e.COUNT=4]="COUNT"}(yt||(yt={})),function(e){e[e.BACKGROUND=0]="BACKGROUND",e[e.UPDATE=1]="UPDATE"}(Xn||(Xn={})),function(e){e[e.NOT_LOADED=0]="NOT_LOADED",e[e.LOADING=1]="LOADING",e[e.LOADED=2]="LOADED"}(qc||(qc={})),function(e){e[e.IntegratedMeshMaskExcluded=1]="IntegratedMeshMaskExcluded",e[e.OutlineVisualElementMask=2]="OutlineVisualElementMask"}(oc||(oc={})),function(e){e[e.ASYNC=0]="ASYNC",e[e.SYNC=1]="SYNC"}(p9||(p9={})),function(e){e[e.Highlight=0]="Highlight",e[e.MaskOccludee=1]="MaskOccludee",e[e.COUNT=2]="COUNT"}(Fy||(Fy={})),function(e){e[e.Triangle=0]="Triangle",e[e.Point=1]="Point",e[e.Line=2]="Line"}(lc||(lc={})),function(e){e[e.STRETCH=1]="STRETCH",e[e.PAD=2]="PAD"}(Dv||(Dv={})),function(e){e[e.CHANGED=0]="CHANGED",e[e.UNCHANGED=1]="UNCHANGED"}(m9||(m9={})),function(e){e[e.Blend=0]="Blend",e[e.Opaque=1]="Opaque",e[e.Mask=2]="Mask",e[e.MaskBlend=3]="MaskBlend",e[e.COUNT=4]="COUNT"}(ui||(ui={})),function(e){e[e.OFF=0]="OFF",e[e.ON=1]="ON"}(Hw||(Hw={}));function Im(e,t,r=Dy.ADD,i=[0,0,0,0]){return{srcRgb:e,srcAlpha:e,dstRgb:t,dstAlpha:t,opRgb:r,opAlpha:r,color:{r:i[0],g:i[1],b:i[2],a:i[3]}}}function ka(e,t,r,i,n=Dy.ADD,s=Dy.ADD,a=[0,0,0,0]){return{srcRgb:e,srcAlpha:t,dstRgb:r,dstAlpha:i,opRgb:n,opAlpha:s,color:{r:a[0],g:a[1],b:a[2],a:a[3]}}}const Qne={face:bp.BACK,mode:f9.CCW},AEe={face:bp.FRONT,mode:f9.CCW},Mz=e=>e===pi.Back?Qne:e===pi.Front?AEe:null,fc={zNear:0,zFar:1},or={r:!0,g:!0,b:!0,a:!0};function Wot(e){return tlt.intern(e)}function Xot(e){return rlt.intern(e)}function Yot(e){return ilt.intern(e)}function Zot(e){return nlt.intern(e)}function Qot(e){return slt.intern(e)}function Jot(e){return alt.intern(e)}function Kot(e){return olt.intern(e)}function elt(e){return llt.intern(e)}function jt(e){return clt.intern(e)}class Wy{constructor(t,r){this.makeKey=t,this.makeRef=r,this.interns=new Map}intern(t){if(!t)return null;const r=this.makeKey(t),i=this.interns;return i.has(r)||i.set(r,this.makeRef(t)),i.get(r)}}function Xy(e){return"["+e.join(",")+"]"}const tlt=new Wy(REe,e=>({__tag:"Blending",...e}));function REe(e){return e?Xy([e.srcRgb,e.srcAlpha,e.dstRgb,e.dstAlpha,e.opRgb,e.opAlpha,e.color.r,e.color.g,e.color.b,e.color.a]):null}const rlt=new Wy(OEe,e=>({__tag:"Culling",...e}));function OEe(e){return e?Xy([e.face,e.mode]):null}const ilt=new Wy(MEe,e=>({__tag:"PolygonOffset",...e}));function MEe(e){return e?Xy([e.factor,e.units]):null}const nlt=new Wy(PEe,e=>({__tag:"DepthTest",...e}));function PEe(e){return e?Xy([e.func]):null}const slt=new Wy(IEe,e=>({__tag:"StencilTest",...e}));function IEe(e){return e?Xy([e.function.func,e.function.ref,e.function.mask,e.operation.fail,e.operation.zFail,e.operation.zPass]):null}const alt=new Wy($Ee,e=>({__tag:"DepthWrite",...e}));function $Ee(e){return e?Xy([e.zNear,e.zFar]):null}const olt=new Wy(LEe,e=>({__tag:"ColorWrite",...e}));function LEe(e){return e?Xy([e.r,e.g,e.b,e.a]):null}const llt=new Wy(DEe,e=>({__tag:"StencilWrite",...e}));function DEe(e){return e?Xy([e.mask]):null}const clt=new Wy(dlt,e=>({blending:Wot(e.blending),culling:Xot(e.culling),polygonOffset:Yot(e.polygonOffset),depthTest:Zot(e.depthTest),stencilTest:Qot(e.stencilTest),depthWrite:Jot(e.depthWrite),colorWrite:Kot(e.colorWrite),stencilWrite:elt(e.stencilWrite)}));function dlt(e){return e?Xy([REe(e.blending),OEe(e.culling),MEe(e.polygonOffset),PEe(e.depthTest),IEe(e.stencilTest),$Ee(e.depthWrite),LEe(e.colorWrite),DEe(e.stencilWrite)]):null}class ult{constructor(t){this._pipelineInvalid=!0,this._blendingInvalid=!0,this._cullingInvalid=!0,this._polygonOffsetInvalid=!0,this._depthTestInvalid=!0,this._stencilTestInvalid=!0,this._depthWriteInvalid=!0,this._colorWriteInvalid=!0,this._stencilWriteInvalid=!0,this._stateSetters=t}setPipeline(t){(this._pipelineInvalid||t!==this._pipeline)&&(this._setBlending(t.blending),this._setCulling(t.culling),this._setPolygonOffset(t.polygonOffset),this._setDepthTest(t.depthTest),this._setStencilTest(t.stencilTest),this._setDepthWrite(t.depthWrite),this._setColorWrite(t.colorWrite),this._setStencilWrite(t.stencilWrite),this._pipeline=t),this._pipelineInvalid=!1}invalidateBlending(){this._blendingInvalid=!0,this._pipelineInvalid=!0}invalidateCulling(){this._cullingInvalid=!0,this._pipelineInvalid=!0}invalidatePolygonOffset(){this._polygonOffsetInvalid=!0,this._pipelineInvalid=!0}invalidateDepthTest(){this._depthTestInvalid=!0,this._pipelineInvalid=!0}invalidateStencilTest(){this._stencilTestInvalid=!0,this._pipelineInvalid=!0}invalidateDepthWrite(){this._depthWriteInvalid=!0,this._pipelineInvalid=!0}invalidateColorWrite(){this._colorWriteInvalid=!0,this._pipelineInvalid=!0}invalidateStencilWrite(){this._stencilTestInvalid=!0,this._pipelineInvalid=!0}_setBlending(t){this._blending=this._setSubState(t,this._blending,this._blendingInvalid,this._stateSetters.setBlending),this._blendingInvalid=!1}_setCulling(t){this._culling=this._setSubState(t,this._culling,this._cullingInvalid,this._stateSetters.setCulling),this._cullingInvalid=!1}_setPolygonOffset(t){this._polygonOffset=this._setSubState(t,this._polygonOffset,this._polygonOffsetInvalid,this._stateSetters.setPolygonOffset),this._polygonOffsetInvalid=!1}_setDepthTest(t){this._depthTest=this._setSubState(t,this._depthTest,this._depthTestInvalid,this._stateSetters.setDepthTest),this._depthTestInvalid=!1}_setStencilTest(t){this._stencilTest=this._setSubState(t,this._stencilTest,this._stencilTestInvalid,this._stateSetters.setStencilTest),this._stencilTestInvalid=!1}_setDepthWrite(t){this._depthWrite=this._setSubState(t,this._depthWrite,this._depthWriteInvalid,this._stateSetters.setDepthWrite),this._depthWriteInvalid=!1}_setColorWrite(t){this._colorWrite=this._setSubState(t,this._colorWrite,this._colorWriteInvalid,this._stateSetters.setColorWrite),this._colorWriteInvalid=!1}_setStencilWrite(t){this._stencilWrite=this._setSubState(t,this._stencilWrite,this._stencilWriteInvalid,this._stateSetters.setStencilWrite),this._stencilTestInvalid=!1}_setSubState(t,r,i,n){return(i||t!==r)&&(n(t),this._pipelineInvalid=!0),t}}class NA extends gi{initializeProgram(t){const r=NA.shader.get().build(this.configuration);return new ai(t.rctx,r,Ur)}initializePipeline(){return this.configuration.haze?jt({blending:ka(Re.ONE,Re.ZERO,Re.ONE_MINUS_SRC_COLOR,Re.ONE),colorWrite:or}):jt({blending:ka(Re.SRC_ALPHA,Re.ONE,Re.ONE_MINUS_SRC_ALPHA,Re.ONE_MINUS_SRC_ALPHA),depthTest:{func:vi.LEQUAL},colorWrite:or})}}NA.shader=new si(jot,()=>ie(()=>import("./ChapmanAtmosphere.glsl.a858da42.js"),[],import.meta.url));class xl{constructor(){this._key="",this._keyDirty=!1,this._parameterBits=this._parameterBits?this._parameterBits.map(()=>0):[],this._parameterNames||(this._parameterNames=[])}get key(){return this._keyDirty&&(this._keyDirty=!1,this._key=String.fromCharCode.apply(String,this._parameterBits)),this._key}snapshot(){const t=this._parameterNames,r={key:this.key};for(const i of t)r[i]=this[i];return r}}function H(e={}){return(t,r)=>{var i,n;if(t._parameterNames=(i=t._parameterNames)!=null?i:[],t._parameterNames.push(r),e.constValue!=null)Object.defineProperty(t,r,{get:()=>e.constValue});else{const s=t._parameterNames.length-1,a=e.count||2,o=Math.ceil(Math.log2(a)),l=(n=t._parameterBits)!=null?n:[0];let c=0;for(;l[c]+o>16;)c++,c>=l.length&&l.push(0);t._parameterBits=l;const u=l[c],h=(1<<o)-1<<u;l[c]+=o,Object.defineProperty(t,r,{get(){return this[s]},set(p){if(this[s]!==p&&(this[s]=p,this._keyDirty=!0,this._parameterBits[c]=this._parameterBits[c]&~h|+p<<u&h,typeof p!="number"&&typeof p!="boolean"))throw"Configuration value for "+r+" must be boolean or number, got "+typeof p}})}}}class FEe extends xl{constructor(){super(...arguments),this.haze=!1}}d([H()],FEe.prototype,"haze",void 0);class La{constructor(t,r,i,n,s,a=!1,o=0){this.name=t,this.count=r,this.type=i,this.offset=n,this.stride=s,this.normalized=a,this.divisor=o}}new La(O.POSITION,3,ft.FLOAT,0,12);new La(O.POSITION,3,ft.FLOAT,0,20),new La(O.UV0,2,ft.FLOAT,12,20);new La(O.POSITION,3,ft.FLOAT,0,32),new La(O.NORMAL,3,ft.FLOAT,12,32),new La(O.UV0,2,ft.FLOAT,24,32);new La(O.POSITION,3,ft.FLOAT,0,16),new La(O.COLOR,4,ft.UNSIGNED_BYTE,12,16);const Jne=[new La(O.POSITION,2,ft.FLOAT,0,8)],bO=[new La(O.POSITION,2,ft.FLOAT,0,16),new La(O.UV0,2,ft.FLOAT,8,16)];var yr;function hlt(e,t,r={}){const i=NEe(e);for(;i.length>1;){const n=kN(t,i.shift(),r);if(_(n))return n}return flt(t,i.shift(),r)}function NEe(e){const t=ue("esri-force-webgl");if(t===yr.WEBGL1||t===yr.WEBGL2)return[t];switch(e){case"2d":return ue("mac")&&ue("chrome")?[yr.WEBGL1,yr.WEBGL2]:[yr.WEBGL2,yr.WEBGL1];case"3d":return[yr.WEBGL2,yr.WEBGL1]}}function flt(e,t,r={}){if(!window.WebGLRenderingContext)return hpe(e,plt),null;const i=kN(e,t,r);return R(i)&&hpe(e,mlt),i}function kN(e,t,r={}){const i=t===yr.WEBGL1?["webgl","experimental-webgl","webkit-3d","moz-webgl"]:["webgl2"];let n=null;for(const s of i){try{n=e.getContext(s,r)}catch{}if(n)break}return n}function hpe(e,t){const r=e.parentNode;r&&(r.innerHTML='<table style="background-color: #8CE; width: 100%; height: 100%;"><tr><td align="center"><div style="display: table-cell; vertical-align: middle;"><div style="">'+t+"</div></div></td></tr></table>")}(function(e){e[e.WEBGL1=1]="WEBGL1",e[e.WEBGL2=2]="WEBGL2"})(yr||(yr={}));const plt='This page requires a browser that supports WebGL.<br/><a href="http://get.webgl.org">Click here to upgrade your browser.</a>',mlt=`It doesn't appear your computer can support WebGL.<br/><a href="http://get.webgl.org/troubleshooting/">Click here for more information.</a>`,wd=fe.getLogger("esri.views.webgl.BufferObject");function glt(e){return qDe(e)}class dr{constructor(t,r,i,n){this._context=t,this.bufferType=r,this.usage=i,this._glName=null,this._size=-1,this._indexType=void 0,t.instanceCounter.increment(ks.BufferObject,this),this._glName=this._context.gl.createBuffer(),hv(this._context.gl),n&&this.setData(n)}static createIndex(t,r,i){return new dr(t,Tt.ELEMENT_ARRAY_BUFFER,r,i)}static createVertex(t,r,i){return new dr(t,Tt.ARRAY_BUFFER,r,i)}static createUniform(t,r,i){if(t.type!==yr.WEBGL2)throw new Error("Uniform buffers are supported in WebGL2 only!");return new dr(t,Tt.UNIFORM_BUFFER,r,i)}static createPixelPack(t,r=Cr.STREAM_READ,i){if(t.type!==yr.WEBGL2)throw new Error("Pixel pack buffers are supported in WebGL2 only!");const n=new dr(t,Tt.PIXEL_PACK_BUFFER,r);return i&&n.setSize(i),n}static createPixelUnpack(t,r=Cr.STREAM_DRAW,i){if(t.type!==yr.WEBGL2)throw new Error("Pixel unpack buffers are supported in WebGL2 only!");return new dr(t,Tt.PIXEL_UNPACK_BUFFER,r,i)}get glName(){return this._glName}get size(){return this._size}get indexType(){return this._indexType}get byteSize(){return this.bufferType===Tt.ELEMENT_ARRAY_BUFFER?this._indexType===ft.UNSIGNED_INT?4*this._size:2*this._size:this._size}get _isVAOAware(){return this.bufferType===Tt.ELEMENT_ARRAY_BUFFER||this.bufferType===Tt.ARRAY_BUFFER}dispose(){var t;(t=this._context)!=null&&t.gl?(this._glName&&(this._context.gl.deleteBuffer(this._glName),this._glName=null),this._context.instanceCounter.decrement(ks.BufferObject,this),this._context=null):this._glName&&wd.warn("Leaked WebGL buffer object")}setSize(t,r=null){if(t<=0&&wd.error("Buffer size needs to be positive!"),this.bufferType===Tt.ELEMENT_ARRAY_BUFFER&&_(r))switch(this._indexType=r,r){case ft.UNSIGNED_SHORT:t*=2;break;case ft.UNSIGNED_INT:t*=4}this._setBufferData(t)}setData(t){if(!t)return;let r=t.byteLength;this.bufferType===Tt.ELEMENT_ARRAY_BUFFER&&(pF(t)&&(r/=2,this._indexType=ft.UNSIGNED_SHORT),mF(t)&&(r/=4,this._indexType=ft.UNSIGNED_INT)),this._setBufferData(r,t)}_setBufferData(t,r=null){this._size=t;const i=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null),this._context.bindBuffer(this);const n=this._context.gl;_(r)?n.bufferData(this.bufferType,r,this.usage):n.bufferData(this.bufferType,t,this.usage),hv(n),this._isVAOAware&&this._context.bindVAO(i)}setSubData(t,r=0,i=0,n=t.byteLength){if(!t)return;(r<0||r>=this._size)&&wd.error("offset is out of range!");let s=r,a=i,o=n,l=t.byteLength;this.bufferType===Tt.ELEMENT_ARRAY_BUFFER&&(pF(t)?(l/=2,s*=2,a*=2,o*=2):mF(t)&&(l/=4,s*=4,a*=4,o*=4)),n===void 0&&(n=l-1),i>=n&&wd.error("end must be bigger than start!"),r+i-n>this._size&&wd.error("An attempt to write beyond the end of the buffer!");const c=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null),this._context.bindBuffer(this);const u=this._context.gl,h=ArrayBuffer.isView(t)?t.buffer:t,p=a===0&&o===t.byteLength?h:h.slice(a,o);u.bufferSubData(this.bufferType,s,p),hv(u),this._isVAOAware&&this._context.bindVAO(c)}setSubDataFromView(t,r,i,n){if(!t)return;(r<0||r>=this._size)&&wd.error("offset is out of range!"),i>=n&&wd.error("end must be bigger than start!"),r+i-n>this._size&&wd.error("An attempt to write beyond the end of the buffer!");const s=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null),this._context.bindBuffer(this);const a=this._context.gl;if(this._context.type===yr.WEBGL2)a.bufferSubData(this.bufferType,r*t.BYTES_PER_ELEMENT,t,i,n-i);else{const o=i===0&&n===t.length?t:t.subarray(i,n);a.bufferSubData(this.bufferType,r*t.BYTES_PER_ELEMENT,o)}hv(a),this._isVAOAware&&this._context.bindVAO(s)}getSubData(t,r=0,i,n){if(this._context.type!==yr.WEBGL2)return void wd.error("Get buffer subdata is supported in WebGL2 only!");if(i<0||n<0)return void wd.error("Problem getting subdata: offset and length were less than zero!");const s=glt(t)?t.BYTES_PER_ELEMENT:1;if(s*((i!=null?i:0)+(n!=null?n:0))>t.byteLength)return void wd.error("Problem getting subdata: offset and length exceeded destination size!");r+s*(n!=null?n:0)>this.byteSize&&wd.warn("Potential problem getting subdata: requested data exceeds buffer size!");const a=this._context.gl;this._context.bindBuffer(this,Tt.COPY_READ_BUFFER),a.getBufferSubData(Tt.COPY_READ_BUFFER,r,t,i,n),this._context.unbindBuffer(Tt.COPY_READ_BUFFER)}async getSubDataAsync(t,r=0,i,n){this._context.type===yr.WEBGL2?(await this._context.clientWaitAsync(),this.getSubData(t,r,i,n)):wd.error("Get buffer subdata is supported in WebGL2 only!")}}function ia(e){return window.WebGL2RenderingContext&&e instanceof window.WebGL2RenderingContext}const fpe=4;class at{constructor(t,r,i=null){if(this._context=t,this.type="texture",this._glName=null,this._descriptor=void 0,this._samplingModeDirty=!1,this._wrapModeDirty=!1,this._wasImmutablyAllocated=!1,t.instanceCounter.increment(ks.Texture,this),this._descriptor={target:mt.TEXTURE_2D,samplingMode:tt.LINEAR,wrapMode:xt.REPEAT,flipped:!1,hasMipmap:!1,isOpaque:!1,unpackAlignment:4,preMultiplyAlpha:!1,isImmutable:!1,...r},t.type!==yr.WEBGL2&&(this._descriptor.isImmutable&&(this._descriptor.isImmutable=!1),L_(this._descriptor.target)))throw new Error("3D and array textures are not supported in WebGL1");this._descriptor.target===mt.TEXTURE_CUBE_MAP?this._setDataCubeMap(i):this.setData(i)}get glName(){return this._glName}get descriptor(){return this._descriptor}get isDirty(){return this._samplingModeDirty||this._wrapModeDirty}dispose(){this._context.gl&&this._glName&&(this._context.unbindTexture(this),this._context.gl.deleteTexture(this._glName),this._glName=null,this._context.instanceCounter.decrement(ks.Texture,this))}release(){this.dispose()}resize(t,r){const i=this._descriptor;if(i.width!==t||i.height!==r){if(this._wasImmutablyAllocated)throw new Error("Immutable textures can't be resized!");i.width=t,i.height=r,this._descriptor.target===mt.TEXTURE_CUBE_MAP?this._setDataCubeMap(null):this.setData(null)}}_setDataCubeMap(t=null){for(let r=mt.TEXTURE_CUBE_MAP_POSITIVE_X;r<=mt.TEXTURE_CUBE_MAP_NEGATIVE_Z;r++)this._setData(t,r)}setData(t){this._setData(t)}_setData(t,r){var c;if(!this._context||!this._context.gl)return;const i=this._context.gl;this._glName||(this._glName=i.createTexture()),t===void 0&&(t=null);const n=this._descriptor;r!=null||(r=n.target);const s=L_(r);t===null&&(n.width=n.width||fpe,n.height=n.height||fpe,s&&(n.depth=(c=n.depth)!=null?c:1));const a=this._context.bindTexture(this,at.TEXTURE_UNIT_FOR_UPDATES);this._context.setActiveTexture(at.TEXTURE_UNIT_FOR_UPDATES),at._validateTexture(this._context,n),this._configurePixelStorage();const o=n.pixelFormat;let l=n.internalFormat?n.internalFormat:this._deriveInternalFormat(o,n.dataType);if(xj(t)){let u=t.width,h=t.height;const p=1;t instanceof HTMLVideoElement&&(u=t.videoWidth,h=t.videoHeight),n.width&&n.height,s&&n.depth,n.isImmutable&&!this._wasImmutablyAllocated&&this._texStorage(r,l,n.hasMipmap,u,h,p),this._texImage(r,0,l,u,h,p,t),hv(i),n.hasMipmap&&this.generateMipmap(),n.width===void 0&&(n.width=u),n.height===void 0&&(n.height=h),s&&n.depth===void 0&&(n.depth=p)}else{const{width:u,height:h,depth:p}=n;if(u!=null&&h!=null||console.error("Width and height must be specified!"),s&&p==null&&console.error("Depth must be specified!"),n.isImmutable&&!this._wasImmutablyAllocated&&this._texStorage(r,l,n.hasMipmap,u,h,p),i.DEPTH24_STENCIL8&&l===i.DEPTH_STENCIL&&(l=i.DEPTH24_STENCIL8),KL(t)){const m=t.levels,g=ppe(r,u,h,p),b=Math.min(g-1,m.length-1);ia(i)?i.texParameteri(n.target,i.TEXTURE_MAX_LEVEL,b):n.hasMipmap=n.hasMipmap&&g===m.length;const w=l;if(!blt(w))throw new Error("Attempting to use compressed data with an umcompressed format!");this._forEachMipmapLevel((v,x,T,E)=>{const C=m[Math.min(v,m.length-1)];this._compressedTexImage(r,v,w,x,T,E,C)},b)}else _(t)?(this._texImage(r,0,l,u,h,p,t),hv(i),n.hasMipmap&&this.generateMipmap()):this._forEachMipmapLevel((m,g,b,w)=>{this._texImage(r,m,l,g,b,w,null),hv(i)})}at._applySamplingMode(i,this._descriptor),at._applyWrapMode(i,this._descriptor),at._applyAnisotropicFilteringParameters(this._context,this._descriptor),hv(i),this._context.bindTexture(a,at.TEXTURE_UNIT_FOR_UPDATES)}updateData(t,r,i,n,s,a){a||console.error("An attempt to use uninitialized data!"),this._glName||console.error("An attempt to update uninitialized texture!");const o=this._context.gl,l=this._descriptor,{pixelFormat:c,internalFormat:u,dataType:h,isImmutable:p,target:m}=l;if(p&&!this._wasImmutablyAllocated)throw new Error("Cannot update immutable texture before allocation!");const g=this._context.bindTexture(this,at.TEXTURE_UNIT_FOR_UPDATES);(r<0||i<0||n>l.width||s>l.height||r+n>l.width||i+s>l.height)&&console.error("An attempt to update out of bounds of the texture!"),this._configurePixelStorage(),xj(a)?o.texSubImage2D(m,t,r,i,c,h,a):KL(a)?o.compressedTexSubImage2D(m,t,r,i,n,s,u,a.levels[t]):o.texSubImage2D(m,t,r,i,n,s,c,h,a),this._context.bindTexture(g,at.TEXTURE_UNIT_FOR_UPDATES)}updateData3D(t,r,i,n,s,a,o,l){l||console.error("An attempt to use uninitialized data!"),this._glName||console.error("An attempt to update uninitialized texture!");const c=this._context.gl;if(!ia(c))throw new Error("3D textures are not supported in WebGL1");const u=this._descriptor,{pixelFormat:h,dataType:p,isImmutable:m,target:g,internalFormat:b}=u;if(m&&!this._wasImmutablyAllocated)throw new Error("Cannot update immutable texture before allocation!");L_(g)||console.warn("Attempting to set 3D texture data on a non-3D texture");const w=this._context.bindTexture(this,at.TEXTURE_UNIT_FOR_UPDATES);if(this._context.setActiveTexture(at.TEXTURE_UNIT_FOR_UPDATES),(r<0||i<0||n<0||s>u.width||a>u.height||o>u.depth||r+s>u.width||i+a>u.height||n+o>u.depth)&&console.error("An attempt to update out of bounds of the texture!"),this._configurePixelStorage(),KL(l))l=l.levels[t],c.compressedTexSubImage3D(g,t,r,i,n,s,a,o,b,l);else{const v=l;c.texSubImage3D(g,t,r,i,n,s,a,o,h,p,v)}this._context.bindTexture(w,at.TEXTURE_UNIT_FOR_UPDATES)}generateMipmap(){const t=this._descriptor;if(!t.hasMipmap){if(this._wasImmutablyAllocated)throw new Error("Cannot add mipmaps to immutable texture after allocation");t.hasMipmap=!0,this._samplingModeDirty=!0,at._validateTexture(this._context,t)}t.samplingMode===tt.LINEAR?(this._samplingModeDirty=!0,t.samplingMode=tt.LINEAR_MIPMAP_NEAREST):t.samplingMode===tt.NEAREST&&(this._samplingModeDirty=!0,t.samplingMode=tt.NEAREST_MIPMAP_NEAREST);const r=this._context.bindTexture(this,at.TEXTURE_UNIT_FOR_UPDATES);this._context.setActiveTexture(at.TEXTURE_UNIT_FOR_UPDATES),this._context.gl.generateMipmap(t.target),this._context.bindTexture(r,at.TEXTURE_UNIT_FOR_UPDATES)}setSamplingMode(t){t!==this._descriptor.samplingMode&&(this._descriptor.samplingMode=t,this._samplingModeDirty=!0)}setWrapMode(t){t!==this._descriptor.wrapMode&&(this._descriptor.wrapMode=t,at._validateTexture(this._context,this._descriptor),this._wrapModeDirty=!0)}applyChanges(){const t=this._context.gl,r=this._descriptor;this._samplingModeDirty&&(at._applySamplingMode(t,r),this._samplingModeDirty=!1),this._wrapModeDirty&&(at._applyWrapMode(t,r),this._wrapModeDirty=!1)}_deriveInternalFormat(t,r){if(this._context.type===yr.WEBGL1)return t;switch(r){case At.FLOAT:switch(t){case Ue.RGBA:return gt.RGBA32F;case Ue.RGB:return gt.RGB32F;default:throw new Error("Unable to derive format")}case At.UNSIGNED_BYTE:switch(t){case Ue.RGBA:return gt.RGBA8;case Ue.RGB:return gt.RGB8}default:return t}}_configurePixelStorage(){const t=this._context.gl,{unpackAlignment:r,flipped:i,preMultiplyAlpha:n}=this._descriptor;t.pixelStorei(t.UNPACK_ALIGNMENT,r),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,i?1:0),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,n?1:0)}_texStorage(t,r,i,n,s,a){const o=this._context.gl;if(!ia(o))throw new Error("Immutable textures are not supported in WebGL1");if(!ylt(r))throw new Error("Immutable textures must have a sized internal format");if(!this._descriptor.isImmutable)return;const l=i?ppe(t,n,s,a):1;L_(t)?o.texStorage3D(t,l,r,n,s,a):o.texStorage2D(t,l,r,n,s),this._wasImmutablyAllocated=!0}_texImage(t,r,i,n,s,a,o){const l=this._context.gl;let c=null;const u=this._context.type===yr.WEBGL2,h=L_(t),{isImmutable:p,pixelFormat:m,dataType:g}=this._descriptor;if(u&&(c=l),u||!xj(o))if(p){if(_(o)){const b=o;h?c.texSubImage3D(t,r,0,0,0,n,s,a,m,g,b):l.texSubImage2D(t,r,0,0,n,s,m,g,b)}}else{const b=o;h?c.texImage3D(t,r,i,n,s,a,0,m,g,b):l.texImage2D(t,r,i,n,s,0,m,g,b)}else l.texImage2D(t,0,i,m,g,o)}_compressedTexImage(t,r,i,n,s,a,o){const l=this._context.gl;let c=null;const u=L_(t),h=this._descriptor.isImmutable;if(u){if(this._context.type!==yr.WEBGL2)throw new Error("3D textures are not supported in WebGL1");c=l}h?_(o)&&(u?c.compressedTexSubImage3D(t,r,0,0,0,n,s,a,i,o):l.compressedTexSubImage2D(t,r,0,0,n,s,i,o)):u?c.compressedTexImage3D(t,r,i,n,s,a,0,o):l.compressedTexImage2D(t,r,i,n,s,0,o)}_forEachMipmapLevel(t,r=1/0){let{width:i,height:n,depth:s,hasMipmap:a,target:o}=this._descriptor;const l=o===mt.TEXTURE_3D;for(let c=0;t(c,i,n,s),a&&(i!==1||n!==1||l&&s!==1)&&!(c>=r);++c)i=Math.max(1,i>>1),n=Math.max(1,n>>1),l&&(s=Math.max(1,s>>1))}static _validateTexture(t,r){(r.width<0||r.height<0||r.depth<0)&&console.error("Negative dimension parameters are not allowed!");const i=ia(t.gl),n=L5(r.width)&&L5(r.height);i||!r.isImmutable&&!L_(r.target)||console.error("Immutable and 3D-like textures are not supported in WebGL1!"),i||n||(typeof r.wrapMode=="number"?r.wrapMode!==xt.CLAMP_TO_EDGE&&console.error("Non-power-of-two textures must have a wrap mode of CLAMP_TO_EDGE!"):r.wrapMode.s===xt.CLAMP_TO_EDGE&&r.wrapMode.t===xt.CLAMP_TO_EDGE||console.error("Non-power-of-two textures must have a wrap mode of CLAMP_TO_EDGE!"),r.hasMipmap&&console.error("Mipmapping requires power-of-two textures!"))}static _applySamplingMode(t,r){let i=r.samplingMode,n=r.samplingMode;i===tt.LINEAR_MIPMAP_NEAREST||i===tt.LINEAR_MIPMAP_LINEAR?(i=tt.LINEAR,r.hasMipmap||(n=tt.LINEAR)):i!==tt.NEAREST_MIPMAP_NEAREST&&i!==tt.NEAREST_MIPMAP_LINEAR||(i=tt.NEAREST,r.hasMipmap||(n=tt.NEAREST)),t.texParameteri(r.target,t.TEXTURE_MAG_FILTER,i),t.texParameteri(r.target,t.TEXTURE_MIN_FILTER,n)}static _applyWrapMode(t,r){typeof r.wrapMode=="number"?(t.texParameteri(r.target,t.TEXTURE_WRAP_S,r.wrapMode),t.texParameteri(r.target,t.TEXTURE_WRAP_T,r.wrapMode)):(t.texParameteri(r.target,t.TEXTURE_WRAP_S,r.wrapMode.s),t.texParameteri(r.target,t.TEXTURE_WRAP_T,r.wrapMode.t))}static _applyAnisotropicFilteringParameters(t,r){var n;const i=t.capabilities.textureFilterAnisotropic;!i||t.gl.texParameterf(r.target,i.TEXTURE_MAX_ANISOTROPY,(n=r.maxAnisotropy)!=null?n:1)}}function ylt(e){return e in gt}function blt(e){return e in cn}function KL(e){return _(e)&&"type"in e&&e.type==="compressed"}function vlt(e){return _(e)&&"byteLength"in e}function xj(e){return _(e)&&!KL(e)&&!vlt(e)}function L_(e){return e===mt.TEXTURE_3D||e===mt.TEXTURE_2D_ARRAY}function ppe(e,t,r,i=1){let n=Math.max(t,r);return e===mt.TEXTURE_3D&&(n=Math.max(n,i)),Math.round(Math.log(n)/Math.LN2)+1}at.TEXTURE_UNIT_FOR_UPDATES=0;function mpe(e){const t=e.gl;switch(t.getError()){case t.NO_ERROR:return null;case t.INVALID_ENUM:return"An unacceptable value has been specified for an enumerated argument";case t.INVALID_VALUE:return"A numeric argument is out of range";case t.INVALID_OPERATION:return"The specified command is not allowed for the current state";case t.INVALID_FRAMEBUFFER_OPERATION:return"The currently bound framebuffer is not framebuffer complete";case t.OUT_OF_MEMORY:return"Not enough memory is left to execute the command";case t.CONTEXT_LOST_WEBGL:return"WebGL context is lost"}return"Unknown error"}function io(e,t){return e.vertexBuffers[t].size/_lt(e.layout[t])}function _lt(e){return e[0].stride}function Kne(e,t,r,i,n=0){const s=e.gl,a=e.capabilities.instancing;e.bindBuffer(r);for(const o of i){const l=t.get(o.name);l===void 0&&console.error(`There is no location for vertex attribute '${o.name}' defined.`);const c=n*o.stride;if(o.count<=4)s.vertexAttribPointer(l,o.count,o.type,o.normalized,o.stride,o.offset+c),s.enableVertexAttribArray(l),o.divisor>0&&a&&a.vertexAttribDivisor(l,o.divisor);else if(o.count===9)for(let u=0;u<3;u++)s.vertexAttribPointer(l+u,3,o.type,o.normalized,o.stride,o.offset+12*u+c),s.enableVertexAttribArray(l+u),o.divisor>0&&a&&a.vertexAttribDivisor(l+u,o.divisor);else if(o.count===16)for(let u=0;u<4;u++)s.vertexAttribPointer(l+u,4,o.type,o.normalized,o.stride,o.offset+16*u+c),s.enableVertexAttribArray(l+u),o.divisor>0&&a&&a.vertexAttribDivisor(l+u,o.divisor);else console.error("Unsupported vertex attribute element count: "+o.count)}}function ese(e,t,r,i){const n=e.gl,s=e.capabilities.instancing;e.bindBuffer(r);for(const a of i){const o=t.get(a.name);if(a.count<=4)n.disableVertexAttribArray(o),a.divisor&&a.divisor>0&&s&&s.vertexAttribDivisor(o,0);else if(a.count===9)for(let l=0;l<3;l++)n.disableVertexAttribArray(o+l),a.divisor&&a.divisor>0&&s&&s.vertexAttribDivisor(o+l,0);else if(a.count===16)for(let l=0;l<4;l++)n.disableVertexAttribArray(o+l),a.divisor&&a.divisor>0&&s&&s.vertexAttribDivisor(o+l,0);else console.error("Unsupported vertex attribute element count: "+a.count)}e.unbindBuffer(Tt.ARRAY_BUFFER)}function kEe(e){switch(e){case Ue.ALPHA:case Ue.LUMINANCE:case Ue.RED:case Ue.RED_INTEGER:case gt.R8:case gt.R8I:case gt.R8UI:case gt.R8_SNORM:case cl.STENCIL_INDEX8:return 1;case Ue.LUMINANCE_ALPHA:case Ue.RG:case Ue.RG_INTEGER:case gt.RGBA4:case gt.R16F:case gt.R16I:case gt.R16UI:case gt.RG8:case gt.RG8I:case gt.RG8UI:case gt.RG8_SNORM:case gt.RGB565:case gt.RGB5_A1:case cl.DEPTH_COMPONENT16:return 2;case Ue.DEPTH_COMPONENT:case Ue.RGB:case Ue.RGB_INTEGER:case gt.RGB8:case gt.RGB8I:case gt.RGB8UI:case gt.RGB8_SNORM:case gt.SRGB8:case cl.DEPTH_COMPONENT24:return 3;case Ue.DEPTH_STENCIL:case Ue.RGBA:case Ue.RGBA_INTEGER:case gt.RGBA8:case gt.R32F:case gt.R11F_G11F_B10F:case gt.RG16F:case gt.R32I:case gt.R32UI:case gt.RG16I:case gt.RG16UI:case gt.RGBA8I:case gt.RGBA8UI:case gt.RGBA8_SNORM:case gt.SRGB8_ALPHA8:case gt.RGB9_E5:case gt.RGB10_A2UI:case gt.RGB10_A2:case cl.DEPTH_STENCIL:case cl.DEPTH_COMPONENT32F:case cl.DEPTH24_STENCIL8:return 4;case cl.DEPTH32F_STENCIL8:return 5;case gt.RGB16F:case gt.RGB16I:case gt.RGB16UI:return 6;case gt.RG32F:case gt.RG32I:case gt.RG32UI:case gt.RGBA16F:case gt.RGBA16I:case gt.RGBA16UI:return 8;case gt.RGB32F:case gt.RGB32I:case gt.RGB32UI:return 12;case gt.RGBA32F:case gt.RGBA32I:case gt.RGBA32UI:return 16;case cn.COMPRESSED_RGB_S3TC_DXT1_EXT:case cn.COMPRESSED_RGBA_S3TC_DXT1_EXT:return .5;case cn.COMPRESSED_RGBA_S3TC_DXT3_EXT:case cn.COMPRESSED_RGBA_S3TC_DXT5_EXT:return 1;case cn.COMPRESSED_R11_EAC:case cn.COMPRESSED_SIGNED_R11_EAC:case cn.COMPRESSED_RGB8_ETC2:case cn.COMPRESSED_SRGB8_ETC2:case cn.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:case cn.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:return .5;case cn.COMPRESSED_RG11_EAC:case cn.COMPRESSED_SIGNED_RG11_EAC:case cn.COMPRESSED_RGBA8_ETC2_EAC:case cn.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:return 1}return 0}function Ww(e){if(R(e))return 0;if("descriptor"in e)return e.glName?Ww(e.descriptor):0;const t=e.internalFormat||"pixelFormat"in e&&e.pixelFormat;if(!t)return 0;const r="hasMipmap"in e&&e.hasMipmap?1.3:1,i=e.width*e.height;return kEe(t)*i*r}const D_=fe.getLogger("esri.views.webgl.VertexArrayObject");class ns{constructor(t,r,i,n,s=null){this._context=t,this._locations=r,this._layout=i,this._buffers=n,this._indexBuffer=s,this._glName=null,this._initialized=!1,t.instanceCounter.increment(ks.VertexArrayObject,this)}get glName(){return this._glName}get context(){return this._context}get vertexBuffers(){return this._buffers}get indexBuffer(){return this._indexBuffer}get size(){return Object.keys(this._buffers).reduce((t,r)=>t+this._buffers[r].size,_(this._indexBuffer)?this._indexBuffer.size:0)}get layout(){return this._layout}get locations(){return this._locations}dispose(t=!0){var r,i;if(!this._context)return void((this._glName||t&&Object.getOwnPropertyNames(this._buffers).length>0)&&D_.warn("Leaked WebGL VAO"));if(this._glName){const n=(i=(r=this._context)==null?void 0:r.capabilities)==null?void 0:i.vao;n?(n.deleteVertexArray(this._glName),this._glName=null):D_.warn("Leaked WebGL VAO")}if(this._context.getBoundVAO()===this&&this._context.bindVAO(null),t){for(const n in this._buffers)this._buffers[n].dispose(),delete this._buffers[n];this._indexBuffer=Qe(this._indexBuffer)}this._context.instanceCounter.decrement(ks.VertexArrayObject,this),this._context=null}initialize(){if(this._initialized)return;const t=this._context.capabilities.vao;if(t){const r=t.createVertexArray();t.bindVertexArray(r),this._bindLayout(),t.bindVertexArray(null),this._glName=r}this._initialized=!0}bind(){this.initialize();const t=this._context.capabilities.vao;t?t.bindVertexArray(this.glName):(this._context.bindVAO(null),this._bindLayout())}_bindLayout(){const{_buffers:t,_layout:r,_indexBuffer:i}=this;t||D_.error("Vertex buffer dictionary is empty!");const n=this._context.gl;for(const s in t){const a=t[s];a||D_.error("Vertex buffer is uninitialized!");const o=r[s];o||D_.error("Vertex element descriptor is empty!"),Kne(this._context,this._locations,a,o)}_(i)&&(this._context.capabilities.vao?n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,i.glName):this._context.bindBuffer(i))}unbind(){this.initialize();const t=this._context.capabilities.vao;t?t.bindVertexArray(null):this._unbindLayout()}_unbindLayout(){const{_buffers:t,_layout:r}=this;t||D_.error("Vertex buffer dictionary is empty!");for(const i in t){const n=t[i];n||D_.error("Vertex buffer is uninitialized!");const s=r[i];ese(this._context,this._locations,n,s)}_(this._indexBuffer)&&this._context.unbindBuffer(this._indexBuffer.bufferType)}}function Tl(e,t=Jne,r=Ur,i=-1,n=1){let s=null;return t===bO?s=new Float32Array([i,i,0,0,n,i,1,0,i,n,0,1,n,n,1,1]):s=new Float32Array([i,i,n,i,i,n,n,n]),new ns(e,r,{geometry:t},{geometry:dr.createVertex(e,Cr.STATIC_DRAW,s)})}function wlt(e,t=Jne,r=Ur){const i=new Float32Array([-1,-1,3,-1,-1,3]);return new ns(e,r,{geometry:t},{geometry:dr.createVertex(e,Cr.STATIC_DRAW,i)})}const VEe=4;function zEe(e,t=VEe){return new at(e,{target:mt.TEXTURE_2D,pixelFormat:Ue.RGBA,dataType:At.UNSIGNED_BYTE,samplingMode:tt.NEAREST,width:t,height:t})}function xlt(e,t,r=VEe){const i=new Uint8Array(r*r*4);for(let n=0;n<i.length;n+=4)i[n+0]=255*t[0],i[n+1]=255*t[1],i[n+2]=255*t[2],i[n+3]=255*t[3];return new at(e,{target:mt.TEXTURE_2D,pixelFormat:Ue.RGBA,dataType:At.UNSIGNED_BYTE,samplingMode:tt.NEAREST,width:r,height:r},i)}function UEe(e){return new at(e,{target:mt.TEXTURE_2D,pixelFormat:Ue.RGBA,dataType:At.UNSIGNED_BYTE,samplingMode:tt.NEAREST,width:1,height:1},new Uint8Array([255,255,255,255]))}class gpe{constructor(t){this._view=t,this.type="realistic",this.canRender=!0,this._cameraPosition=M(),this._heightParameters=Jt(),this._betasRayleigh=M(),this._betasCombined=M(),this._scaleHeight=0,this._radii=it(),this._cameraHeight=0,this._cameraHeightSq=0,this._cAtmosphere=0,this._innerFadeDistance=0,this._altitudeFade=0,this._lowerElevationBoundRadius=0,this._lowerBoundEarthRadius=$r.radius,this._hazeStrength=1,this._darkenHaze=!1,this._updateRadius($r.radius)}destroy(){this._atmosphereTechnique=ri(this._atmosphereTechnique),this._atmosphereHazeTechnique=ri(this._atmosphereHazeTechnique),this._vao=Qe(this._vao),this._handles=ct(this._handles)}when(){return Promise.resolve()}initializeRenderContext(t){const r=t.renderContext.rctx,i=this._handles=new Ft,n=this._view.basemapTerrain;_(n.rootTiles)&&this._updateElevation({spatialReference:n.spatialReference,tile:n.rootTiles[0],extent:n.rootTiles[0].extent,context:"ground"}),i.add(rn(()=>this._view.basemapTerrain,"elevation-change",a=>this._updateElevation(a),{onListenerAdd:()=>this._updateElevation()})),i.add(rn(()=>this._view.basemapTerrain,"elevation-bounds-change",()=>this._updateVisibleElevationBounds()));const s=new FEe;s.haze=!1,this._atmosphereTechnique=t.shaderTechniqueRepository.acquire(NA,s),s.haze=!0,this._atmosphereHazeTechnique=t.shaderTechniqueRepository.acquire(NA,s),this._vao=Tl(r,bO),this._scaleHeight=Lot*JL,ne(this._betasRayleigh,Hx[0],Hx[1],Hx[2]),ne(this._betasCombined,Hx[0]+_j[0],Hx[1]+_j[1],Hx[2]+_j[2])}render(t){this._render(t,this._atmosphereTechnique,t.offscreenRenderingHelper.depthTexture)}renderHaze(t,r){this._darkenHaze=r,this._render(t,this._atmosphereHazeTechnique,t.offscreenRenderingHelper.linearDepthTexture)}_render(t,r,i){this._update(t.bindParameters.camera);const n=t.rctx.bindTechnique(r,Tlt,t.bindParameters);t.offscreenRenderingHelper.renderDepthDetached(()=>{n.bindTexture("depthTex",i),this._renderCommon(r.program,t)})}_renderCommon(t,r){if(R(this._vao))return;const i=r.rctx;t.setUniform4fv("heightParameters",this._heightParameters),t.setUniform3fv("cameraPosition",this._cameraPosition),t.setUniform2fv("radii",this._radii),t.setUniform1f("scaleHeight",this._scaleHeight),t.setUniform1f("betaMie",$ot),t.setUniform3fv("betaRayleigh",this._betasRayleigh),t.setUniform3fv("betaCombined",this._betasCombined),t.setUniform1f("innerFadeDistance",this._innerFadeDistance),t.setUniform1f("altitudeFade",this._altitudeFade),t.setUniform1f("hazeStrength",this._hazeStrength),i.bindVAO(this._vao),t.assertCompatibleVertexAttributeLocations(this._vao),i.drawArrays(Dt.TRIANGLE_STRIP,0,4)}_adjustRadiusForTesselation(t){return t*Math.cos(Math.PI/16/16)}_updateElevation(t){const r=t?t.tile:vt(this._view.basemapTerrain.rootTiles,[null])[0];if(R(r)||r.level!==0)return;const i=this._adjustRadiusForTesselation($r.radius+r.elevationBounds[0]);i!==this._lowerElevationBoundRadius&&(this._lowerElevationBoundRadius=i,this._lowerBoundEarthRadius=-1,this._updateVisibleElevationBounds())}_updateVisibleElevationBounds(){const t=this._adjustRadiusForTesselation($r.radius+this._view.basemapTerrain.elevationBounds.min);(this._lowerBoundEarthRadius<0||t<this._lowerBoundEarthRadius)&&this._updateRadius(t)}_updateRadius(t){this._lowerBoundEarthRadius=t,vr(this._radii,t,t+JL),this._innerFadeDistance=2*Math.sqrt((2*t-MJ)*MJ)}_update(t){if(R(t))return;this._cameraHeight=Oe(t.eye),this._cameraHeightSq=this._cameraHeight*this._cameraHeight,this._cAtmosphere=this._cameraHeightSq-this._radii[1]*this._radii[1];const r=Math.min(1,Math.max(0,(this._cameraHeight-this._radii[0])/JL));this._heightParameters=Tr(this._cameraHeight,this._cameraHeightSq,this._cAtmosphere,r),oe(this._cameraPosition,t.eye),this._altitudeFade=SEe(this._cameraHeight-this._lowerBoundEarthRadius),this._hazeStrength=this._darkenHaze?Kt(.6,1,D5(9500,10500,this._cameraHeight-$r.radius)):1}static isSupported(t){return t.renderContext.rctx.capabilities.depthTexture}}const Tlt=new as;function Slt(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e}function BEe(e,t,r){r*=.5;const i=Math.sin(r);return e[0]=i*t[0],e[1]=i*t[1],e[2]=i*t[2],e[3]=Math.cos(r),e}function GEe(e,t){const r=2*Math.acos(t[3]),i=Math.sin(r/2);return i>Rt?(e[0]=t[0]/i,e[1]=t[1]/i,e[2]=t[2]/i):(e[0]=1,e[1]=0,e[2]=0),r}function tse(e,t,r){const i=t[0],n=t[1],s=t[2],a=t[3],o=r[0],l=r[1],c=r[2],u=r[3];return e[0]=i*u+a*o+n*c-s*l,e[1]=n*u+a*l+s*o-i*c,e[2]=s*u+a*c+i*l-n*o,e[3]=a*u-i*o-n*l-s*c,e}function Elt(e,t,r){r*=.5;const i=t[0],n=t[1],s=t[2],a=t[3],o=Math.sin(r),l=Math.cos(r);return e[0]=i*l+a*o,e[1]=n*l+s*o,e[2]=s*l-n*o,e[3]=a*l-i*o,e}function Clt(e,t,r){r*=.5;const i=t[0],n=t[1],s=t[2],a=t[3],o=Math.sin(r),l=Math.cos(r);return e[0]=i*l-s*o,e[1]=n*l+a*o,e[2]=s*l+i*o,e[3]=a*l-n*o,e}function Alt(e,t,r){r*=.5;const i=t[0],n=t[1],s=t[2],a=t[3],o=Math.sin(r),l=Math.cos(r);return e[0]=i*l+n*o,e[1]=n*l-i*o,e[2]=s*l+a*o,e[3]=a*l-s*o,e}function Rlt(e,t){const r=t[0],i=t[1],n=t[2];return e[0]=r,e[1]=i,e[2]=n,e[3]=Math.sqrt(Math.abs(1-r*r-i*i-n*n)),e}function eD(e,t,r,i){const n=t[0],s=t[1],a=t[2],o=t[3];let l,c,u,h,p,m=r[0],g=r[1],b=r[2],w=r[3];return c=n*m+s*g+a*b+o*w,c<0&&(c=-c,m=-m,g=-g,b=-b,w=-w),1-c>Rt?(l=Math.acos(c),u=Math.sin(l),h=Math.sin((1-i)*l)/u,p=Math.sin(i*l)/u):(h=1-i,p=i),e[0]=h*n+p*m,e[1]=h*s+p*g,e[2]=h*a+p*b,e[3]=h*o+p*w,e}function Olt(e){const t=up(),r=up(),i=up(),n=Math.sqrt(1-t),s=Math.sqrt(t);return e[0]=n*Math.sin(2*Math.PI*r),e[1]=n*Math.cos(2*Math.PI*r),e[2]=s*Math.sin(2*Math.PI*i),e[3]=s*Math.cos(2*Math.PI*i),e}function Mlt(e,t){const r=t[0],i=t[1],n=t[2],s=t[3],a=r*r+i*i+n*n+s*s,o=a?1/a:0;return e[0]=-r*o,e[1]=-i*o,e[2]=-n*o,e[3]=s*o,e}function Ny(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e}function jEe(e,t){const r=t[0]+t[4]+t[8];let i;if(r>0)i=Math.sqrt(r+1),e[3]=.5*i,i=.5/i,e[0]=(t[5]-t[7])*i,e[1]=(t[6]-t[2])*i,e[2]=(t[1]-t[3])*i;else{let n=0;t[4]>t[0]&&(n=1),t[8]>t[3*n+n]&&(n=2);const s=(n+1)%3,a=(n+2)%3;i=Math.sqrt(t[3*n+n]-t[3*s+s]-t[3*a+a]+1),e[n]=.5*i,i=.5/i,e[3]=(t[3*s+a]-t[3*a+s])*i,e[s]=(t[3*s+n]+t[3*n+s])*i,e[a]=(t[3*a+n]+t[3*n+a])*i}return e}function Plt(e,t,r,i){const n=.5*Math.PI/180;t*=n,r*=n,i*=n;const s=Math.sin(t),a=Math.cos(t),o=Math.sin(r),l=Math.cos(r),c=Math.sin(i),u=Math.cos(i);return e[0]=s*l*u-a*o*c,e[1]=a*o*u+s*l*c,e[2]=a*l*c-s*o*u,e[3]=a*l*u+s*o*c,e}function Ilt(e){return"quat("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}const vO=hp,$lt=ei,Llt=lre,Dlt=tse,Flt=YR,Nlt=vwe,klt=mV,qEe=cre,Vlt=qEe,HEe=dre,zlt=HEe,rse=bwe,Ult=lA,Blt=_we;function Glt(e,t,r){const i=Se(t,r);return i<-.999999?(dt(jp,jlt,t),ore(jp)<1e-6&&dt(jp,qlt,t),we(jp,jp),BEe(e,jp,Math.PI),e):i>.999999?(e[0]=0,e[1]=0,e[2]=0,e[3]=1,e):(dt(jp,t,r),e[0]=jp[0],e[1]=jp[1],e[2]=jp[2],e[3]=1+i,rse(e,e))}const jp=M(),jlt=Ve(1,0,0),qlt=Ve(0,1,0);function Hlt(e,t,r,i,n,s){return eD(ype,t,n,s),eD(bpe,r,i,s),eD(e,ype,bpe,2*s*(1-s)),e}const ype=qy(),bpe=qy();function Wlt(e,t,r,i){const n=Xlt;return n[0]=r[0],n[3]=r[1],n[6]=r[2],n[1]=i[0],n[4]=i[1],n[7]=i[2],n[2]=-t[0],n[5]=-t[1],n[8]=-t[2],rse(e,jEe(e,n))}const Xlt=Li();Object.freeze(Object.defineProperty({__proto__:null,identity:Slt,setAxisAngle:BEe,getAxisAngle:GEe,multiply:tse,rotateX:Elt,rotateY:Clt,rotateZ:Alt,calculateW:Rlt,slerp:eD,random:Olt,invert:Mlt,conjugate:Ny,fromMat3:jEe,fromEuler:Plt,str:Ilt,copy:vO,set:$lt,add:Llt,mul:Dlt,scale:Flt,dot:Nlt,lerp:klt,length:qEe,len:Vlt,squaredLength:HEe,sqrLen:zlt,normalize:rse,exactEquals:Ult,equals:Blt,rotationTo:Glt,sqlerp:Hlt,setAxes:Wlt},Symbol.toStringTag,{value:"Module"}));function b6(e=Zlt){return[e[0],e[1],e[2],e[3]]}function kA(e,t){return Ylt(e[0],e[1],e[2],t,iie.get())}function Ylt(e,t,r,i,n=b6()){return n[0]=e,n[1]=t,n[2]=r,n[3]=i,n}function VA(e,t,r=b6()){return dt(r,e,t),we(r,r),r[3]=aie(e,t),r}const Zlt=[0,0,1,0];class Qlt{constructor(){this.startTime=0,this.startTimeHeightFade=0,this.cameraPositionLastFrame=M(),this.parallax={anchorPointClouds:M(),cloudsHeight:1e5,radiusCurvatureCorrectionFactor:0,transform:Ae()},this.parallaxNew={anchorPointClouds:M(),cloudsHeight:1e5,radiusCurvatureCorrectionFactor:0,transform:Ae()},this.crossFade={enabled:!1,factor:0,distanceThresholdFactor:.3},this.fadeInOut={stage:xa.FINISHED,factor:0,distanceThresholdFactor:.6},this.fadeIn={stage:gh.FINISHED,factor:0,distanceThresholdFactor:2},this.fadeInOutHeight={stage:Fv.FINISHED,factor:-1}}}var gh,xa,Fv;(function(e){e[e.FINISHED=0]="FINISHED",e[e.CHANGE_ANCHOR=1]="CHANGE_ANCHOR",e[e.FADE_IN=2]="FADE_IN"})(gh||(gh={})),function(e){e[e.FINISHED=0]="FINISHED",e[e.FADE_OUT=1]="FADE_OUT",e[e.SWITCH=2]="SWITCH",e[e.FADE_IN=3]="FADE_IN"}(xa||(xa={})),function(e){e[e.FINISHED=0]="FINISHED",e[e.HEIGHT_FADE=1]="HEIGHT_FADE"}(Fv||(Fv={}));function Mr(){return new Float32Array(3)}function VN(e){const t=new Float32Array(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function Dr(e,t,r){const i=new Float32Array(3);return i[0]=e,i[1]=t,i[2]=r,i}function WEe(e,t){return new Float32Array(e,t,3)}function ise(){return Mr()}function XEe(){return Dr(1,1,1)}function YEe(){return Dr(1,0,0)}function ZEe(){return Dr(0,1,0)}function QEe(){return Dr(0,0,1)}const Jlt=ise(),Klt=XEe(),ect=YEe(),tct=ZEe(),rct=QEe();Object.freeze(Object.defineProperty({__proto__:null,create:Mr,clone:VN,fromValues:Dr,createView:WEe,zeros:ise,ones:XEe,unitX:YEe,unitY:ZEe,unitZ:QEe,ZEROS:Jlt,ONES:Klt,UNIT_X:ect,UNIT_Y:tct,UNIT_Z:rct},Symbol.toStringTag,{value:"Module"}));function JEe(e){e.extensions.add("GL_EXT_shader_texture_lod"),e.extensions.add("GL_OES_standard_derivatives"),e.fragment.code.add(S`#ifndef GL_EXT_shader_texture_lod
float calcMipMapLevel(const vec2 ddx, const vec2 ddy) {
float deltaMaxSqr = max(dot(ddx, ddx), dot(ddy, ddy));
return max(0.0, 0.5 * log2(deltaMaxSqr));
}
#endif
vec4 textureAtlasLookup(sampler2D texture, vec2 textureSize, vec2 textureCoordinates, vec4 atlasRegion) {
vec2 atlasScale = atlasRegion.zw - atlasRegion.xy;
vec2 uvAtlas = fract(textureCoordinates) * atlasScale + atlasRegion.xy;
float maxdUV = 0.125;
vec2 dUVdx = clamp(dFdx(textureCoordinates), -maxdUV, maxdUV) * atlasScale;
vec2 dUVdy = clamp(dFdy(textureCoordinates), -maxdUV, maxdUV) * atlasScale;
#ifdef GL_EXT_shader_texture_lod
return texture2DGradEXT(texture, uvAtlas, dUVdx, dUVdy);
#else
vec2 dUVdxAuto = dFdx(uvAtlas);
vec2 dUVdyAuto = dFdy(uvAtlas);
float mipMapLevel = calcMipMapLevel(dUVdx * textureSize, dUVdy * textureSize);
float autoMipMapLevel = calcMipMapLevel(dUVdxAuto * textureSize, dUVdyAuto * textureSize);
return texture2D(texture, uvAtlas, mipMapLevel - autoMipMapLevel);
#endif
}`)}function nse(e,t){switch(e.include(hy,t),e.fragment.code.add(S`
  struct TextureLookupParameter {
    vec2 uv;
    ${t.supportsTextureAtlas?"vec2 size;":""}
  } vtc;
  `),t.textureCoordinateType){case ws.Default:return void e.fragment.code.add(S`vec4 textureLookup(sampler2D texture, TextureLookupParameter params) {
return texture2D(texture, params.uv);
}`);case ws.Atlas:return e.include(JEe),void e.fragment.code.add(S`vec4 textureLookup(sampler2D texture, TextureLookupParameter params) {
return textureAtlasLookup(texture, params.size, params.uv, vuvRegion);
}`);default:t.textureCoordinateType;case ws.None:case ws.COUNT:return}}class yl extends sn{constructor(t,r){super(t,"vec3",zr.Draw,(i,n,s)=>i.setUniform3fv(t,r(n,s)))}}class sse extends sn{constructor(t,r){super(t,"vec2",zr.Draw,(i,n,s)=>i.setUniform2fv(t,r(n,s)))}}class ase extends sn{constructor(t,r){super(t,"sampler2D",zr.Draw,(i,n,s)=>i.bindTexture(t,r(n,s)))}}function d7(e,t,r){const i=[new ase(e,t)];if(r){const n=e+"Size";i.push(new sse(n,(s,a)=>{const o=t(s,a);return _(o)?vr(ict,o.descriptor.width,o.descriptor.height):Zh}))}return i}const ict=it();class Wt extends sn{constructor(t,r){super(t,"sampler2D",zr.Pass,(i,n,s)=>i.bindTexture(t,r(n,s)))}}function tD(e,t,r){const i=[new Wt(e,t)];if(r){const n=e+"Size";i.push(new _r(n,(s,a)=>{const o=t(s,a);return _(o)?vr(nct,o.descriptor.width,o.descriptor.height):Zh}))}return i}const nct=it();class v_{constructor(t){this._material=t.material,this._techniqueRepository=t.techniqueRep,this._output=t.output}dispose(){this._techniqueRepository.release(this._technique)}get technique(){return this._technique}ensureTechnique(t,r,i=this._output){return this._technique=this._techniqueRepository.releaseAndAcquire(t,this._material.getConfiguration(i,r),this._technique),this._technique}ensureResources(t){return qc.LOADED}}class ose extends v_{constructor(t){super(t),this._numLoading=0,this._disposed=!1,this._textureRepository=t.textureRep,this._textureId=t.textureId,this._acquire(t.textureId,r=>this._texture=r),this._acquire(t.normalTextureId,r=>this._textureNormal=r),this._acquire(t.emissiveTextureId,r=>this._textureEmissive=r),this._acquire(t.occlusionTextureId,r=>this._textureOcclusion=r),this._acquire(t.metallicRoughnessTextureId,r=>this._textureMetallicRoughness=r)}dispose(){this._texture=ri(this._texture),this._textureNormal=ri(this._textureNormal),this._textureEmissive=ri(this._textureEmissive),this._textureOcclusion=ri(this._textureOcclusion),this._textureMetallicRoughness=ri(this._textureMetallicRoughness),this._disposed=!0}ensureResources(t){return this._numLoading===0?qc.LOADED:qc.LOADING}get textureBindParameters(){return new KEe(_(this._texture)?this._texture.glTexture:null,_(this._textureNormal)?this._textureNormal.glTexture:null,_(this._textureEmissive)?this._textureEmissive.glTexture:null,_(this._textureOcclusion)?this._textureOcclusion.glTexture:null,_(this._textureMetallicRoughness)?this._textureMetallicRoughness.glTexture:null)}updateTexture(t){(R(this._texture)||t!==this._texture.id)&&(this._texture=ri(this._texture),this._textureId=t,this._acquire(this._textureId,r=>this._texture=r))}_acquire(t,r){if(R(t))return void r(null);const i=this._textureRepository.acquire(t);if($u(i))return++this._numLoading,void i.then(n=>{if(this._disposed)return ri(n),void r(null);r(n)}).finally(()=>--this._numLoading);r(i)}}class KEe extends as{constructor(t=null,r=null,i=null,n=null,s=null){super(),this.texture=t,this.textureNormal=r,this.textureEmissive=i,this.textureOcclusion=n,this.textureMetallicRoughness=s}}const bLt=Dr(0,.6,.2);var It;(function(e){e[e.Disabled=0]="Disabled",e[e.Normal=1]="Normal",e[e.Schematic=2]="Schematic",e[e.Water=3]="Water",e[e.WaterOnIntegratedMesh=4]="WaterOnIntegratedMesh",e[e.COUNT=5]="COUNT"})(It||(It={}));function lse(e,t){const r=e.fragment,i=t.hasMetalnessAndRoughnessTexture||t.hasEmissionTexture||t.hasOcclusionTexture;if(t.pbrMode===It.Normal&&i&&e.include(nse,t),t.pbrMode!==It.Schematic)if(t.pbrMode!==It.Disabled){if(t.pbrMode===It.Normal){r.code.add(S`vec3 mrr;
vec3 emission;
float occlusion;`);const n=t.supportsTextureAtlas,s=t.pbrTextureBindType;t.hasMetalnessAndRoughnessTexture&&(r.uniforms.add(s===zr.Pass?tD("texMetallicRoughness",a=>a.textureMetallicRoughness,n):d7("texMetallicRoughness",a=>a.textureMetallicRoughness,n)),r.code.add(S`void applyMetallnessAndRoughness(TextureLookupParameter params) {
vec3 metallicRoughness = textureLookup(texMetallicRoughness, params).rgb;
mrr[0] *= metallicRoughness.b;
mrr[1] *= metallicRoughness.g;
}`)),t.hasEmissionTexture&&(r.uniforms.add(s===zr.Pass?tD("texEmission",a=>a.textureEmissive,n):d7("texEmission",a=>a.textureEmissive,n)),r.code.add(S`void applyEmission(TextureLookupParameter params) {
emission *= textureLookup(texEmission, params).rgb;
}`)),t.hasOcclusionTexture?(r.uniforms.add(s===zr.Pass?tD("texOcclusion",a=>a.textureOcclusion,n):d7("texOcclusion",a=>a.textureOcclusion,n)),r.code.add(S`void applyOcclusion(TextureLookupParameter params) {
occlusion *= textureLookup(texOcclusion, params).r;
}
float getBakedOcclusion() {
return occlusion;
}`)):r.code.add(S`float getBakedOcclusion() { return 1.0; }`),r.uniforms.add(s===zr.Pass?[new St("emissionFactor",a=>a.emissiveFactor),new St("mrrFactors",a=>a.mrrFactors)]:[new yl("emissionFactor",a=>a.emissiveFactor),new yl("mrrFactors",a=>a.mrrFactors)]),r.code.add(S`
    void applyPBRFactors() {
      mrr = mrrFactors;
      emission = emissionFactor;
      occlusion = 1.0;
      ${i?"vtc.uv = vuv0;":""}
      ${t.hasMetalnessAndRoughnessTexture?t.supportsTextureAtlas?"vtc.size = texMetallicRoughnessSize; applyMetallnessAndRoughness(vtc);":"applyMetallnessAndRoughness(vtc);":""}
      ${t.hasEmissionTexture?t.supportsTextureAtlas?"vtc.size = texEmissionSize; applyEmission(vtc);":"applyEmission(vtc);":""}
      ${t.hasOcclusionTexture?t.supportsTextureAtlas?"vtc.size = texOcclusionSize; applyOcclusion(vtc);":"applyOcclusion(vtc);":""}
    }
  `)}}else r.code.add(S`float getBakedOcclusion() { return 1.0; }`);else r.code.add(S`vec3 mrr = vec3(0.0, 0.6, 0.2);
vec3 emission = vec3(0.0);
float occlusion = 1.0;
void applyPBRFactors() {}
float getBakedOcclusion() { return 1.0; }`)}class cr extends sn{constructor(t,r){super(t,"vec4",zr.Pass,(i,n,s)=>i.setUniform4fv(t,r(n,s)))}}function cse(e,t){const r=e.fragment,i=t.lightingSphericalHarmonicsOrder!==void 0?t.lightingSphericalHarmonicsOrder:2;i===0?(r.uniforms.add(new St("lightingAmbientSH0",(n,s)=>ne(vpe,s.lighting.sh.r[0],s.lighting.sh.g[0],s.lighting.sh.b[0]))),r.code.add(S`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec3 ambientLight = 0.282095 * lightingAmbientSH0;
return ambientLight * (1.0 - ambientOcclusion);
}`)):i===1?(r.uniforms.add([new cr("lightingAmbientSH_R",(n,s)=>ei(Bm,s.lighting.sh.r[0],s.lighting.sh.r[1],s.lighting.sh.r[2],s.lighting.sh.r[3])),new cr("lightingAmbientSH_G",(n,s)=>ei(Bm,s.lighting.sh.g[0],s.lighting.sh.g[1],s.lighting.sh.g[2],s.lighting.sh.g[3])),new cr("lightingAmbientSH_B",(n,s)=>ei(Bm,s.lighting.sh.b[0],s.lighting.sh.b[1],s.lighting.sh.b[2],s.lighting.sh.b[3]))]),r.code.add(S`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec4 sh0 = vec4(
0.282095,
0.488603 * normal.x,
0.488603 * normal.z,
0.488603 * normal.y
);
vec3 ambientLight = vec3(
dot(lightingAmbientSH_R, sh0),
dot(lightingAmbientSH_G, sh0),
dot(lightingAmbientSH_B, sh0)
);
return ambientLight * (1.0 - ambientOcclusion);
}`)):i===2&&(r.uniforms.add([new St("lightingAmbientSH0",(n,s)=>ne(vpe,s.lighting.sh.r[0],s.lighting.sh.g[0],s.lighting.sh.b[0])),new cr("lightingAmbientSH_R1",(n,s)=>ei(Bm,s.lighting.sh.r[1],s.lighting.sh.r[2],s.lighting.sh.r[3],s.lighting.sh.r[4])),new cr("lightingAmbientSH_G1",(n,s)=>ei(Bm,s.lighting.sh.g[1],s.lighting.sh.g[2],s.lighting.sh.g[3],s.lighting.sh.g[4])),new cr("lightingAmbientSH_B1",(n,s)=>ei(Bm,s.lighting.sh.b[1],s.lighting.sh.b[2],s.lighting.sh.b[3],s.lighting.sh.b[4])),new cr("lightingAmbientSH_R2",(n,s)=>ei(Bm,s.lighting.sh.r[5],s.lighting.sh.r[6],s.lighting.sh.r[7],s.lighting.sh.r[8])),new cr("lightingAmbientSH_G2",(n,s)=>ei(Bm,s.lighting.sh.g[5],s.lighting.sh.g[6],s.lighting.sh.g[7],s.lighting.sh.g[8])),new cr("lightingAmbientSH_B2",(n,s)=>ei(Bm,s.lighting.sh.b[5],s.lighting.sh.b[6],s.lighting.sh.b[7],s.lighting.sh.b[8]))]),r.code.add(S`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec3 ambientLight = 0.282095 * lightingAmbientSH0;
vec4 sh1 = vec4(
0.488603 * normal.x,
0.488603 * normal.z,
0.488603 * normal.y,
1.092548 * normal.x * normal.y
);
vec4 sh2 = vec4(
1.092548 * normal.y * normal.z,
0.315392 * (3.0 * normal.z * normal.z - 1.0),
1.092548 * normal.x * normal.z,
0.546274 * (normal.x * normal.x - normal.y * normal.y)
);
ambientLight += vec3(
dot(lightingAmbientSH_R1, sh1),
dot(lightingAmbientSH_G1, sh1),
dot(lightingAmbientSH_B1, sh1)
);
ambientLight += vec3(
dot(lightingAmbientSH_R2, sh2),
dot(lightingAmbientSH_G2, sh2),
dot(lightingAmbientSH_B2, sh2)
);
return ambientLight * (1.0 - ambientOcclusion);
}`),t.pbrMode!==It.Normal&&t.pbrMode!==It.Schematic||r.code.add(S`const vec3 skyTransmittance = vec3(0.9, 0.9, 1.0);
vec3 calculateAmbientRadiance(float ambientOcclusion)
{
vec3 ambientLight = 1.2 * (0.282095 * lightingAmbientSH0) - 0.2;
return ambientLight *= (1.0 - ambientOcclusion) * skyTransmittance;
}`))}const vpe=M(),Bm=Jt();class He extends sn{constructor(t,r){super(t,"float",zr.Pass,(i,n,s)=>i.setUniform1f(t,r(n,s)))}}function dse(e,t){const r=e.fragment;t.isGround?r.uniforms.add(new He("lightingFixedFactor",(i,n)=>(1-n.lighting.groundLightingFactor)*(1-n.lighting.globalFactor))):r.constants.add("lightingFixedFactor","float",0),r.uniforms.add([new St("lightingMainDirection",(i,n)=>n.lighting.lightingMainDirection),new St("lightingMainIntensity",(i,n)=>n.lighting.mainLight.intensity)]),r.code.add(S`vec3 evaluateMainLighting(vec3 normal_global, float shadowing) {
float dotVal = clamp(dot(normal_global, lightingMainDirection), 0.0, 1.0);
dotVal = mix(dotVal, 1.0, lightingFixedFactor);
return lightingMainIntensity * ((1.0 - shadowing) * dotVal);
}`)}function Pz(e){e.vertex.code.add(S`const float PI = 3.141592653589793;`),e.fragment.code.add(S`const float PI = 3.141592653589793;
const float LIGHT_NORMALIZATION = 1.0 / PI;
const float INV_PI = 0.3183098861837907;
const float HALF_PI = 1.570796326794897;`)}class Xw extends sn{constructor(t,r){super(t,"bool",zr.Pass,(i,n,s)=>i.setUniform1b(t,r(n,s)))}}class sct extends sn{constructor(t,r){super(t,"samplerCube",zr.Pass,(i,n,s)=>i.bindTexture(t,r(n,s)))}}function eCe(e){const t=e.fragment;t.uniforms.add([new Ei("rotationMatrixClouds",(r,i)=>i.clouds.parallax.transform),new Ei("rotationMatrixCloudsCrossFade",(r,i)=>i.clouds.parallaxNew.transform),new St("anchorPosition",(r,i)=>i.clouds.parallax.anchorPointClouds),new St("anchorPositionCrossFade",(r,i)=>i.clouds.parallaxNew.anchorPointClouds),new _r("cloudVariables",(r,i)=>_(i.clouds.data)?vr(act,i.clouds.data.coverage,i.clouds.data.absorption):Zh),new He("cloudsHeight",(r,i)=>i.clouds.parallax.cloudsHeight),new He("radiusCurvatureCorrectionFactor",(r,i)=>i.clouds.parallax.radiusCurvatureCorrectionFactor),new He("totalFadeInOut",(r,i)=>i.clouds.fadeInOut.stage===xa.FINISHED?i.clouds.fadeInOutHeight.factor+Math.max(Le(i.clouds.fadeIn.factor,0,1)):i.clouds.fadeInOutHeight.factor+Math.max(Le(i.clouds.fadeInOut.factor,0,1))),new He("crossFadeAnchorFactor",(r,i)=>Le(i.clouds.crossFade.factor,0,1)),new sct("cubeMap",(r,i)=>_(i.clouds.data)?i.clouds.data.cubeMap.colorTexture:null),new Xw("crossFade",(r,i)=>i.clouds.crossFade.enabled)]),t.constants.add("planetRadius","float",$r.radius),t.code.add(S`vec3 intersectWithCloudLayer(vec3 dir, vec3 cameraPosition, vec3 spherePos)
{
float radiusClouds = planetRadius + cloudsHeight;
float B = 2.0 * dot(cameraPosition, dir);
float C = dot(cameraPosition, cameraPosition) - radiusClouds * radiusClouds;
float det = B * B - 4.0 * C;
float pointIntDist = max(0.0, 0.5 *(-B + sqrt(det)));
vec3 intersectionPont = cameraPosition + dir * pointIntDist;
intersectionPont =  intersectionPont - spherePos;
return intersectionPont;
}`),t.code.add(S`vec3 correctForPlanetCurvature(vec3 dir)
{
dir.z = dir.z*(1.-radiusCurvatureCorrectionFactor) + radiusCurvatureCorrectionFactor;
return dir;
}`),t.code.add(S`vec3 rotateDirectionToAnchorPoint(mat4 rotMat, vec3 inVec)
{
return (rotMat * vec4(inVec, 0.0)).xyz;
}`),t.uniforms.add([new St("lightingMainDirection",(r,i)=>i.lighting.lightingMainDirection),new St("lightingMainIntensity",(r,i)=>i.lighting.mainLight.intensity)]),t.code.add(S`const float SUNSET_TRANSITION_FACTOR = 0.3;
const vec3 RIM_COLOR = vec3(0.28, 0.175, 0.035);
const float RIM_SCATTERING_FACTOR = 140.0;
const float BACKLIGHT_FACTOR = 0.2;
const float BACKLIGHT_SCATTERING_FACTOR = 10.0;
const float BACKLIGHT_TRANSITION_FACTOR = 0.3;
vec3 calculateCloudColor(vec3 cameraPosition, vec3 worldSpaceRay, vec4 clouds)
{
float upDotLight = dot(normalize(cameraPosition), normalize(lightingMainDirection));
float dirDotLight = max(dot(normalize(-worldSpaceRay), normalize(lightingMainDirection)), 0.0);
float sunsetTransition = clamp(pow(max(upDotLight, 0.0), SUNSET_TRANSITION_FACTOR), 0.0, 1.0);
vec3 ambientLight = calculateAmbientIrradiance(normalize(cameraPosition),  0.0);
vec3 mainLight = evaluateMainLighting(normalize(cameraPosition),  0.0);
vec3 combinedLight = clamp((lightingMainIntensity + ambientLight )/PI, vec3(0.0), vec3(1.0));
vec3 baseCloudColor = pow(combinedLight * pow(clouds.xyz, vec3(GAMMA)), vec3(INV_GAMMA));
float scatteringMod = max(clouds.a < 0.5 ? clouds.a / 0.5 : - clouds.a / 0.5 + 2.0, 0.0);
float rimLightIntensity = 0.5 + 0.5 *pow(max(upDotLight, 0.0), 0.35);
vec3 directSunScattering = RIM_COLOR * rimLightIntensity * pow(dirDotLight, RIM_SCATTERING_FACTOR) * scatteringMod;
float additionalLight = BACKLIGHT_FACTOR * pow(dirDotLight, BACKLIGHT_SCATTERING_FACTOR) * (1. - pow(sunsetTransition, BACKLIGHT_TRANSITION_FACTOR)) ;
return vec3(baseCloudColor * (1. + additionalLight) + directSunScattering);
}`),t.code.add(S`vec4 getCloudData(vec3 rayDir)
{
vec4 cloudData = textureCube(cubeMap, rayDir);
float mu = dot(rayDir, vec3(0, 0, 1));
return mix(vec4(vec3(clamp(1.0 - cloudVariables.y, 0.6, 1.0)), 0.0), cloudData, smoothstep(-0.01, mix(0.0, 0.075, cloudVariables.x), abs(mu)));
}`),t.code.add(S`vec4 renderCloudsNoFade(vec3 worldRay, vec3 cameraPosition)
{
vec3 intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPosition);
vec3 worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixClouds, normalize(intersectionPoint));
vec3 worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
vec4 cloudData = getCloudData(worldRayRotatedCorrected);
float totalTransmittance = clamp(cloudData.a * (1.0 - totalFadeInOut) + totalFadeInOut, 0.0 , 1.0);
if (length(cloudData.rgb) == 0.0) {
totalTransmittance = 1.0;
}
return vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), totalTransmittance);
}`),t.code.add(S`vec4 renderCloudsCrossFade(vec3 worldRay, vec3 cameraPosition)
{
vec3 intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPosition);
vec3 worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixClouds, normalize(intersectionPoint));
vec3 worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
vec4 cloudData = getCloudData(worldRayRotatedCorrected);
vec4 cloudColor = vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), cloudData.a);
intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPositionCrossFade);
worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixCloudsCrossFade, normalize(intersectionPoint));
worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
cloudData = getCloudData(worldRayRotatedCorrected);
vec4 cloudColorCrossFade = vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), cloudData.a);
cloudColor = mix(cloudColor, cloudColorCrossFade, crossFadeAnchorFactor);
float totalTransmittance = clamp(cloudColor.a * (1.0 - totalFadeInOut) + totalFadeInOut, 0.0 , 1.0);
if (length(cloudColor.rgb) == 0.0) {
totalTransmittance = 1.0;
}
return vec4(cloudColor.rgb, totalTransmittance);
}`),t.code.add(S`vec4 renderClouds(vec3 worldRay, vec3 cameraPosition)
{
return crossFade ? renderCloudsCrossFade(worldRay, cameraPosition) : renderCloudsNoFade(worldRay, cameraPosition);
}`)}const act=it();function $m(e){e.code.add(S`vec4 premultiplyAlpha(vec4 v) {
return vec4(v.rgb * v.a, v.a);
}
vec3 rgb2hsv(vec3 c) {
vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);
vec4 p = c.g < c.b ? vec4(c.bg, K.wz) : vec4(c.gb, K.xy);
vec4 q = c.r < p.x ? vec4(p.xyw, c.r) : vec4(c.r, p.yzx);
float d = q.x - min(q.w, q.y);
float e = 1.0e-10;
return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), min(d / (q.x + e), 1.0), q.x);
}
vec3 hsv2rgb(vec3 c) {
vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);
vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);
return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);
}
float rgb2v(vec3 c) {
return max(c.x, max(c.y, c.z));
}`)}function oct(){const e=new Qr;e.attributes.add(O.POSITION,"vec2"),e.varyings.add("worldRay","vec3");const{vertex:t,fragment:r}=e;return t.uniforms.add([new Ei("inverseProjectionMatrix",(i,n)=>n.camera.inverseProjectionMatrix),new Ei("inverseViewMatrix",(i,n)=>Rn(lct,n.camera.viewMatrix))]),t.code.add(S`void main(void) {
vec3 posViewNear = (inverseProjectionMatrix * vec4(position, -1.0, 1.0)).xyz;
worldRay = (inverseViewMatrix * vec4(posViewNear, 0.0)).xyz;
gl_Position = vec4(position, 1.0, 1.0);
}`),r.include($m),r.include(bd),e.include(cse,{pbrMode:It.Disabled,lightingSphericalHarmonicsOrder:2}),e.include(Pz),e.include(Oz),e.include(dse,{isGround:!1}),e.include(eCe,{instancedDoublePrecision:!1,isGround:!1}),r.uniforms.add([new St("cameraPosition",(i,n)=>n.camera.eye)]),r.code.add(S`void main() {
vec4 cloudsColor = renderClouds(normalize(worldRay), cameraPosition);
gl_FragColor = vec4((1.0 - totalFadeInOut) * cloudsColor.rgb, cloudsColor.a);
}`),e}const lct=Ae(),cct=Object.freeze(Object.defineProperty({__proto__:null,build:oct},Symbol.toStringTag,{value:"Module"}));class Iz extends gi{constructor(t){super(t,null,()=>this.destroy())}initializeProgram(t){const r=Iz.shader.get().build();return new ai(t.rctx,r,Ur)}initializePipeline(){return jt({blending:Im(Re.ONE,Re.SRC_ALPHA),depthTest:{func:vi.LEQUAL},colorWrite:or})}}Iz.shader=new si(cct,()=>ie(()=>import("./CloudsComposition.glsl.caa43e08.js"),[],import.meta.url));function dct(e){return _(e)&&_(e.cubeMap)&&e.coverage>0}function _pe(e){return _(e)&&!e.running}let Y2=class extends xe{constructor(e){super(e),this._technique=new Iz(e),this._vao=Tl(e.rctx)}destroy(){this._technique=ri(this._technique),this._vao=Qe(this._vao)}render(e,t){const r=e.bindParameters.clouds;if(R(this._vao)||R(r.data))return;if(!this._technique.compiled)return void this.requestRender();this._setParallaxParameters(r,e.bindParameters.camera.eye,t);const i=e.rctx.bindTechnique(this._technique,gct,e.bindParameters);e.rctx.bindVAO(this._vao),i.assertCompatibleVertexAttributeLocations(this._vao),e.rctx.drawArrays(Dt.TRIANGLE_STRIP,0,4),mct(r)&&this.requestRender()}_setFadeInStage(e,t){const r=performance.now(),i=e.parallax.anchorPointClouds;e.fadeIn.stage===gh.FINISHED&&(e.fadeIn.factor=1,oe(i,qp),e.fadeIn.stage=gh.CHANGE_ANCHOR,e.crossFade.enabled=!1,e.fadeInOut.stage=xa.FINISHED);const n=Tpe(e,t);e.fadeIn.stage===gh.CHANGE_ANCHOR&&n&&_pe(e.data)&&(oe(i,qp),e.fadeIn.stage=gh.FADE_IN,e.startTime=r),e.fadeIn.factor>0&&e.fadeIn.stage===gh.FADE_IN&&(e.fadeIn.factor=1-(r-e.startTime)/xpe),e.fadeIn.factor<=0&&e.fadeIn.stage===gh.FADE_IN&&(e.fadeIn.stage=gh.FINISHED,e.fadeIn.factor=0)}_setCrossFadingStage(e){const t=performance.now(),{crossFade:r}=e,i=e.parallax.anchorPointClouds;e.crossFade.enabled||(oe(e.parallaxNew.anchorPointClouds,qp),e.startTime=t,r.factor=0,e.crossFade.enabled=!0),r.factor<1&&e.crossFade.enabled&&(r.factor=(t-e.startTime)/fct),r.factor>=1&&e.crossFade.enabled&&(e.crossFade.enabled=!1,r.factor=1,oe(i,e.parallaxNew.anchorPointClouds))}_setFadeInOutStage(e,t){const r=performance.now(),{fadeInOut:i,crossFade:n}=e;i.stage===xa.FINISHED&&(e.startTime=r,i.factor=0,i.stage=xa.FADE_OUT),i.factor<1&&i.stage===xa.FADE_OUT&&(i.factor=(r-e.startTime)/hct),i.factor>=1&&i.stage===xa.FADE_OUT&&(i.factor=1,oe(e.parallax.anchorPointClouds,qp)),i.factor>=1&&i.stage===xa.FADE_OUT&&Tpe(e,t)&&(i.factor=1,i.stage=xa.SWITCH,e.crossFade.enabled=!1,n.factor=1),_pe(e.data)&&i.stage===xa.SWITCH&&(e.startTime=r,i.factor=1,i.stage=xa.FADE_IN,oe(e.parallax.anchorPointClouds,qp),e.crossFade.enabled=!1,n.factor=1),i.factor>0&&i.stage===xa.FADE_IN&&(i.factor=1-(r-e.startTime)/xpe),i.factor<=0&&i.stage===xa.FADE_IN&&(i.stage=xa.FINISHED,i.factor=0)}_setFadeInOutHeight(e,t){const r=performance.now(),i=e.fadeInOutHeight,n=(r-(i.stage===Fv.FINISHED?r:e.startTimeHeightFade))/pct;i.factor+=t?-n:n,e.startTimeHeightFade=r,i.factor=Le(i.factor,0,1),i.stage=Fv.HEIGHT_FADE}_setParallaxParameters(e,t,r){const{parallax:i}=e;e.fadeInOutHeight.factor<0&&(e.fadeInOutHeight.factor=Oe(t)-this.planetRadius>_h?1:0),we(qp,t),le(qp,qp,this.planetRadius),i.anchorPointClouds[0]===0&&i.anchorPointClouds[1]===0&&i.anchorPointClouds[2]===0&&oe(i.anchorPointClouds,qp);const n=Oe(pe(uct,i.anchorPointClouds,qp));let s=!0;n>e.fadeIn.distanceThresholdFactor*i.cloudsHeight||e.fadeIn.stage!==gh.FINISHED?this._setFadeInStage(e,t):n>e.fadeInOut.distanceThresholdFactor*i.cloudsHeight||e.fadeInOut.stage!==xa.FINISHED?this._setFadeInOutStage(e,t):n>e.crossFade.distanceThresholdFactor*i.cloudsHeight&&!r||e.crossFade.enabled?this._setCrossFadingStage(e):s=!1;const a=Oe(t),o=a-this.planetRadius;if((o>1.7*_h||o<-_h)&&e.fadeInOutHeight.factor<1?e.fadeInOutHeight.factor=1:(o>_h||o<-.35*_h)&&e.fadeInOutHeight.factor<1?this._setFadeInOutHeight(e,!1):o<_h&&o>-.35*_h&&e.fadeInOutHeight.factor>0?this._setFadeInOutHeight(e,!0):e.fadeInOutHeight.stage=Fv.FINISHED,i.radiusCurvatureCorrectionFactor=.84*Math.sqrt(Math.max(a*a-this.planetRadius*this.planetRadius,0))/a,VA(wpe,i.anchorPointClouds,Wx),i.transform=Ae(),rd(i.transform,i.transform,Wx[3],Wx),s){const{parallaxNew:l}=e;VA(wpe,l.anchorPointClouds,Wx),l.transform=Ae(),rd(l.transform,l.transform,Wx[3],Wx)}oe(e.cameraPositionLastFrame,t)}};d([f({constructOnly:!0})],Y2.prototype,"rctx",void 0),d([f({constructOnly:!0})],Y2.prototype,"viewingMode",void 0),d([f({constructOnly:!0})],Y2.prototype,"planetRadius",void 0),d([f({constructOnly:!0})],Y2.prototype,"requestRender",void 0),Y2=d([$("esri.views.3d.environment.CloudsComposition")],Y2);const wpe=Ve(0,0,1),Wx=b6(),qp=M(),uct=M(),xpe=500,hct=250,fct=500,pct=500;function mct(e){return e.crossFade.enabled||e.fadeInOut.stage!==xa.FINISHED||e.fadeIn.stage!==gh.FINISHED||e.fadeInOutHeight.stage!==Fv.FINISHED}function Tpe(e,t){return Lw(e.cameraPositionLastFrame,t)}const gct=new as;function Jh(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10],e}function yct(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function use(e,t,r,i,n,s,a,o,l,c){return e[0]=t,e[1]=r,e[2]=i,e[3]=n,e[4]=s,e[5]=a,e[6]=o,e[7]=l,e[8]=c,e}function hse(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function Kh(e,t){if(e===t){const r=t[1],i=t[2],n=t[5];e[1]=t[3],e[2]=t[6],e[3]=r,e[5]=t[7],e[6]=i,e[7]=n}else e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8];return e}function Ix(e,t){const r=t[0],i=t[1],n=t[2],s=t[3],a=t[4],o=t[5],l=t[6],c=t[7],u=t[8],h=u*a-o*c,p=-u*s+o*l,m=c*s-a*l;let g=r*h+i*p+n*m;return g?(g=1/g,e[0]=h*g,e[1]=(-u*i+n*c)*g,e[2]=(o*i-n*a)*g,e[3]=p*g,e[4]=(u*r-n*l)*g,e[5]=(-o*r+n*s)*g,e[6]=m*g,e[7]=(-c*r+i*l)*g,e[8]=(a*r-i*s)*g,e):null}function bct(e,t){const r=t[0],i=t[1],n=t[2],s=t[3],a=t[4],o=t[5],l=t[6],c=t[7],u=t[8];return e[0]=a*u-o*c,e[1]=n*c-i*u,e[2]=i*o-n*a,e[3]=o*l-s*u,e[4]=r*u-n*l,e[5]=n*s-r*o,e[6]=s*c-a*l,e[7]=i*l-r*c,e[8]=r*a-i*s,e}function vct(e){const t=e[0],r=e[1],i=e[2],n=e[3],s=e[4],a=e[5],o=e[6],l=e[7],c=e[8];return t*(c*s-a*l)+r*(-c*n+a*o)+i*(l*n-s*o)}function $z(e,t,r){const i=t[0],n=t[1],s=t[2],a=t[3],o=t[4],l=t[5],c=t[6],u=t[7],h=t[8],p=r[0],m=r[1],g=r[2],b=r[3],w=r[4],v=r[5],x=r[6],T=r[7],E=r[8];return e[0]=p*i+m*a+g*c,e[1]=p*n+m*o+g*u,e[2]=p*s+m*l+g*h,e[3]=b*i+w*a+v*c,e[4]=b*n+w*o+v*u,e[5]=b*s+w*l+v*h,e[6]=x*i+T*a+E*c,e[7]=x*n+T*o+E*u,e[8]=x*s+T*l+E*h,e}function zN(e,t,r){const i=t[0],n=t[1],s=t[2],a=t[3],o=t[4],l=t[5],c=t[6],u=t[7],h=t[8],p=r[0],m=r[1];return e[0]=i,e[1]=n,e[2]=s,e[3]=a,e[4]=o,e[5]=l,e[6]=p*i+m*a+c,e[7]=p*n+m*o+u,e[8]=p*s+m*l+h,e}function fse(e,t,r){const i=t[0],n=t[1],s=t[2],a=t[3],o=t[4],l=t[5],c=t[6],u=t[7],h=t[8],p=Math.sin(r),m=Math.cos(r);return e[0]=m*i+p*a,e[1]=m*n+p*o,e[2]=m*s+p*l,e[3]=m*a-p*i,e[4]=m*o-p*n,e[5]=m*l-p*s,e[6]=c,e[7]=u,e[8]=h,e}function pse(e,t,r){const i=r[0],n=r[1],s=r[2];return e[0]=i*t[0],e[1]=i*t[1],e[2]=i*t[2],e[3]=n*t[3],e[4]=n*t[4],e[5]=n*t[5],e[6]=s*t[6],e[7]=s*t[7],e[8]=s*t[8],e}function _ct(e,t,r){const i=r[0],n=r[1];return e[0]=i*t[0],e[1]=i*t[1],e[2]=i*t[2],e[3]=n*t[3],e[4]=n*t[4],e[5]=n*t[5],e}function wct(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=t[0],e[7]=t[1],e[8]=1,e}function xct(e,t){const r=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=r,e[2]=0,e[3]=-r,e[4]=i,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function Tct(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=t[1],e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function Sct(e,t){return e[0]=t[0],e[1]=t[1],e[2]=0,e[3]=t[2],e[4]=t[3],e[5]=0,e[6]=t[4],e[7]=t[5],e[8]=1,e}function Lz(e,t){const r=t[0],i=t[1],n=t[2],s=t[3],a=r+r,o=i+i,l=n+n,c=r*a,u=i*a,h=i*o,p=n*a,m=n*o,g=n*l,b=s*a,w=s*o,v=s*l;return e[0]=1-h-g,e[3]=u-v,e[6]=p+w,e[1]=u+v,e[4]=1-c-g,e[7]=m-b,e[2]=p-w,e[5]=m+b,e[8]=1-c-h,e}function tCe(e,t){const r=t[0],i=t[1],n=t[2],s=t[4],a=t[5],o=t[6],l=t[8],c=t[9],u=t[10],h=u*a-o*c,p=-u*s+o*l,m=c*s-a*l,g=r*h+i*p+n*m;if(!g)return null;const b=1/g;return e[0]=h*b,e[1]=(-u*i+n*c)*b,e[2]=(o*i-n*a)*b,e[3]=p*b,e[4]=(u*r-n*l)*b,e[5]=(-o*r+n*s)*b,e[6]=m*b,e[7]=(-c*r+i*l)*b,e[8]=(a*r-i*s)*b,e}function g9(e,t){const r=t[0],i=t[1],n=t[2],s=t[3],a=t[4],o=t[5],l=t[6],c=t[7],u=t[8],h=t[9],p=t[10],m=t[11],g=t[12],b=t[13],w=t[14],v=t[15],x=r*o-i*a,T=r*l-n*a,E=r*c-s*a,C=i*l-n*o,A=i*c-s*o,P=n*c-s*l,I=u*b-h*g,L=u*w-p*g,V=u*v-m*g,G=h*w-p*b,B=h*v-m*b,X=p*v-m*w;let Y=x*X-T*B+E*G+C*V-A*L+P*I;return Y?(Y=1/Y,e[0]=(o*X-l*B+c*G)*Y,e[1]=(l*V-a*X-c*L)*Y,e[2]=(a*B-o*V+c*I)*Y,e[3]=(n*B-i*X-s*G)*Y,e[4]=(r*X-n*V+s*L)*Y,e[5]=(i*V-r*B-s*I)*Y,e[6]=(b*P-w*A+v*C)*Y,e[7]=(w*E-g*P-v*T)*Y,e[8]=(g*A-b*E+v*x)*Y,e):null}function Ect(e,t,r){return e[0]=2/t,e[1]=0,e[2]=0,e[3]=0,e[4]=-2/r,e[5]=0,e[6]=-1,e[7]=1,e[8]=1,e}function Cct(e){return"mat3("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+")"}function Act(e){return Math.sqrt(e[0]**2+e[1]**2+e[2]**2+e[3]**2+e[4]**2+e[5]**2+e[6]**2+e[7]**2+e[8]**2)}function Rct(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e[4]=t[4]+r[4],e[5]=t[5]+r[5],e[6]=t[6]+r[6],e[7]=t[7]+r[7],e[8]=t[8]+r[8],e}function rCe(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e[4]=t[4]-r[4],e[5]=t[5]-r[5],e[6]=t[6]-r[6],e[7]=t[7]-r[7],e[8]=t[8]-r[8],e}function Oct(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=t[7]*r,e[8]=t[8]*r,e}function Mct(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e[2]=t[2]+r[2]*i,e[3]=t[3]+r[3]*i,e[4]=t[4]+r[4]*i,e[5]=t[5]+r[5]*i,e[6]=t[6]+r[6]*i,e[7]=t[7]+r[7]*i,e[8]=t[8]+r[8]*i,e}function Pct(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]}function Ict(e,t){const r=e[0],i=e[1],n=e[2],s=e[3],a=e[4],o=e[5],l=e[6],c=e[7],u=e[8],h=t[0],p=t[1],m=t[2],g=t[3],b=t[4],w=t[5],v=t[6],x=t[7],T=t[8];return Math.abs(r-h)<=Rt*Math.max(1,Math.abs(r),Math.abs(h))&&Math.abs(i-p)<=Rt*Math.max(1,Math.abs(i),Math.abs(p))&&Math.abs(n-m)<=Rt*Math.max(1,Math.abs(n),Math.abs(m))&&Math.abs(s-g)<=Rt*Math.max(1,Math.abs(s),Math.abs(g))&&Math.abs(a-b)<=Rt*Math.max(1,Math.abs(a),Math.abs(b))&&Math.abs(o-w)<=Rt*Math.max(1,Math.abs(o),Math.abs(w))&&Math.abs(l-v)<=Rt*Math.max(1,Math.abs(l),Math.abs(v))&&Math.abs(c-x)<=Rt*Math.max(1,Math.abs(c),Math.abs(x))&&Math.abs(u-T)<=Rt*Math.max(1,Math.abs(u),Math.abs(T))}function mse(e){const t=Rt,r=e[0],i=e[1],n=e[2],s=e[3],a=e[4],o=e[5],l=e[6],c=e[7],u=e[8];return Math.abs(1-(r*r+s*s+l*l))<=t&&Math.abs(1-(i*i+a*a+c*c))<=t&&Math.abs(1-(n*n+o*o+u*u))<=t}const $ct=$z,Lct=rCe;Object.freeze(Object.defineProperty({__proto__:null,fromMat4:Jh,copy:yct,set:use,identity:hse,transpose:Kh,invert:Ix,adjoint:bct,determinant:vct,multiply:$z,translate:zN,rotate:fse,scale:pse,scaleByVec2:_ct,fromTranslation:wct,fromRotation:xct,fromScaling:Tct,fromMat2d:Sct,fromQuat:Lz,normalFromMat4Legacy:tCe,normalFromMat4:g9,projection:Ect,str:Cct,frob:Act,add:Rct,subtract:rCe,multiplyScalar:Oct,multiplyScalarAndAdd:Mct,exactEquals:Pct,equals:Ict,isOrthoNormal:mse,mul:$ct,sub:Lct},Symbol.toStringTag,{value:"Module"}));function gse(){return new Float32Array(2)}function Dct(e){const t=new Float32Array(2);return t[0]=e[0],t[1]=e[1],t}function ul(e,t){const r=new Float32Array(2);return r[0]=e,r[1]=t,r}function Fct(e,t){return new Float32Array(e,t,2)}function iCe(){return gse()}function nCe(){return ul(1,1)}function sCe(){return ul(1,0)}function aCe(){return ul(0,1)}const Nct=iCe(),kct=nCe(),Vct=sCe(),zct=aCe();Object.freeze(Object.defineProperty({__proto__:null,create:gse,clone:Dct,fromValues:ul,createView:Fct,zeros:iCe,ones:nCe,unitX:sCe,unitY:aCe,ZEROS:Nct,ONES:kct,UNIT_X:Vct,UNIT_Y:zct},Symbol.toStringTag,{value:"Module"}));var ap;(function(e){e[e.SIXTEEN=0]="SIXTEEN",e[e.HUNDRED=1]="HUNDRED",e[e.TWOHUNDRED=2]="TWOHUNDRED",e[e.COUNT=3]="COUNT"})(ap||(ap={}));class oCe extends xl{constructor(){super(...arguments),this.steps=ap.SIXTEEN}}d([H({count:ap.COUNT})],oCe.prototype,"steps",void 0);const wh=ue("esri-mobile")?64:128,Uct=wh/128,qf=Math.ceil(Math.sqrt(wh)),ip=(wh+2)*qf,Bct=1e5,Tj=128,Gct=ip/1560;function __(e,t=!0){e.attributes.add(O.POSITION,"vec2"),t&&e.varyings.add("uv","vec2"),e.vertex.code.add(S`
    void main(void) {
      gl_Position = vec4(position, 0.0, 1.0);
      ${t?S`uv = position * 0.5 + vec2(0.5);`:""}
    }
  `)}class zA extends sn{constructor(t,r){super(t,"mat3",zr.Draw,(i,n,s)=>i.setUniformMatrix3fv(t,r(n,s)))}}class lCe extends as{constructor(){super(...arguments),this.viewMatrix=Li()}}function jct(e){const t=new Qr;return t.include(__,!1),t.fragment.uniforms.add(new kr("cloudRadius")),t.fragment.uniforms.add(new kr("halfCubeMapSize")),t.fragment.uniforms.add(new kr("power")),t.fragment.uniforms.add(new kr("sigmaE")),t.fragment.uniforms.add(new kr("density")),t.fragment.uniforms.add(new kr("cloudSize")),t.fragment.uniforms.add(new kr("detailSize")),t.fragment.uniforms.add(new kr("smoothness")),t.fragment.uniforms.add(new kr("cloudHeight")),t.fragment.uniforms.add(new kr("coverage")),t.fragment.uniforms.add(new zA("view",r=>r.viewMatrix)),t.fragment.uniforms.add(new Hi("cloudShapeTexture")),t.fragment.code.add(S`
    const int STEPS = ${e.steps===ap.SIXTEEN?S`16`:e.steps===ap.HUNDRED?S`100`:S`200`};
    const int STEPS_LIGHT = 6;
    const float stepL = 300.0 / float(STEPS_LIGHT);
    const float cloudStart = 1500.0;

    vec3 rayDirection(vec2 fragCoord) {
      vec2 xy = fragCoord - halfCubeMapSize;
      return normalize(vec3(-xy, -halfCubeMapSize));
    }

    float remap(float x, float low1, float high1, float low2, float high2) {
      return low2 + (x - low1) * (high2 - low2) / (high1 - low1);
    }

    float saturate(float x) {
      return clamp(x, 0.0, 1.0);
    }`),t.fragment.code.add(S`
    float getCloudShape(vec3 pos, float pOffset) {
      const float textureWidth = ${S.float(ip)};
      const float dataWidth = ${S.float(ip)};
      const float tileRows = ${S.float(qf)};
      const vec3 atlasDimensions = vec3(${S.float(wh)}, ${S.float(wh)}, tileRows * tileRows);

      //Change from Y being height to Z being height
      vec3 p = float(${S.float(Uct)}) * pos.xzy;

      //Pixel coordinates of point in the 3D data
      vec3 coord = vec3(mod(p - pOffset * atlasDimensions, atlasDimensions));
      float f = fract(coord.z);
      float level = floor(coord.z);
      float tileY = floor(level / tileRows);
      float tileX = level - tileY * tileRows;

      //The data coordinates are offset by the x and y tile, the two boundary cells between each tile pair and the initial boundary cell on the first row/column
      vec2 offset = atlasDimensions.x * vec2(tileX, tileY) + 2.0 * vec2(tileX, tileY) + 1.0;
      vec2 pixel = coord.xy + offset;
      vec2 data = texture2D(cloudShapeTexture, mod(pixel, dataWidth) / textureWidth).xy;

      return 1.0 - mix(data.x, data.y, f);
    }

    float getCloudMap(vec2 p){
      // Non-power-of-two textures can't be tiled using WebGL1
      // Get fractional part of uv to tile
      // Shift the texture center to origin to avoid seam artifacts
      vec2 uv = fract((${S.float(Gct)} * p) / ${S.float(ip)} + 0.5);

      return texture2D(cloudShapeTexture, uv).a;
    }
    `),t.fragment.code.add(S`float clouds(vec3 p) {
float cloud = saturate(0.5 * mix(0.0, 1.0, min(2.0 * coverage, 1.0)));
if (cloud <= 0.0) {
return 0.0;
}
float cloudMap = getCloudMap(cloudSize * p.xy);
cloud = mix(cloud, min(2.0 * (coverage), 1.0) * cloudMap, min(2.0 * (1.0 - coverage), 1.0));
if (cloud <= 0.0) {
return 0.0;
}
float shape = getCloudShape(8.0 * cloudSize * p, 0.0);
cloud = saturate(remap(cloud, smoothness * shape, 1.0, 0.0, 1.0));
if (cloud <= 0.0) {
return 0.0;
}
float heightFraction = saturate((length(p) - cloudRadius - cloudStart) / cloudHeight);
cloud *= saturate(remap(heightFraction, 0.0, 0.25, 0.0, 1.0)) * smoothstep(1.0, 0.25, heightFraction);
if (cloud <= 0.0) {
return 0.0;
}
return density * saturate(remap(cloud, 0.35 * smoothness * getCloudShape(detailSize * p, 0.0), 1.0, 0.0, 1.0));
}`),t.fragment.code.add(S`vec2 sphereIntersections(vec3 start, vec3 dir, float radius) {
float a = dot(dir, dir);
float b = 2.0 * dot(dir, start);
float c = dot(start, start) - (radius * radius);
float d = (b * b) - 4.0 * a * c;
if (d < 0.0) {
return vec2(1e5, -1e5);
}
return vec2((-b - sqrt(d)) / (2.0 * a), (-b + sqrt(d)) / (2.0 * a));
}
float HenyeyGreenstein(float g, float costh) {
return (1.0 / (4.0 * 3.1415))  * ((1.0 - g * g) / pow(1.0 + g * g - 2.0 * g * costh, 1.5));
}`),t.fragment.code.add(`
    vec3 multipleOctaves(float extinction, float mu, float stepL) {
      float attenuation = 1.0;
      float contribution = 1.0;
      float phaseAttenuation = 1.0;
      vec3 luminance = vec3(0);

      for (int i = 0; i < 4; i++) {
        float phase = mix(HenyeyGreenstein(0.0, mu), HenyeyGreenstein(0.3 * phaseAttenuation, mu), 0.7);
        luminance += contribution * phase * exp(-stepL * extinction * sigmaE * attenuation);
        attenuation *= 0.2;
        contribution *= 0.6;
        phaseAttenuation *= 0.5;
      }

      return luminance;
    }`),t.fragment.code.add(S`vec3 lightRay(vec3 org, vec3 p, float phaseFunction, float mu, vec3 sunDirection) {
float lightRayDensity = clouds(p);
lightRayDensity += clouds(p + sunDirection * 1.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 2.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 3.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 4.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 5.0 * stepL);
vec3 beersLaw = multipleOctaves(lightRayDensity, mu, stepL);
return mix(beersLaw * 2.0 * (1.0 - (exp(-stepL * lightRayDensity * 2.0 * sigmaE ))), beersLaw, 0.5 + 0.5 * mu);
}`),t.fragment.code.add(S`vec3 mainRay(vec3 org, vec3 dir, vec3 sunDirection, float distToStart, float totalDistance, out float totalTransmittance) {
if (dir.z < 0.0) {
return vec3(0);
}
totalTransmittance = 1.0;
float stepS = totalDistance / float(STEPS);
float cameraHeight = length(org);
float mu = 0.5 + 0.5 * dot(sunDirection, dir);
float phaseFunction = mix(HenyeyGreenstein(-0.3, mu), HenyeyGreenstein(0.3, mu), 0.7);
vec3 p = org + distToStart  * dir;
float dist = distToStart;
vec3 color = vec3(0.0);
for (int i = 0; i < STEPS; i++) {
float sampleDensity = clouds(p);
float sampleSigmaE = sampleDensity * sigmaE;
if (sampleDensity > 0.0 ) {
float ambient = mix((1.2), (1.6), saturate((length(p) - cloudRadius - cloudStart) / cloudHeight));
vec3 luminance = sampleDensity * (ambient + power * phaseFunction * lightRay(org, p, phaseFunction, mu, sunDirection));
float transmittance = exp(-sampleSigmaE * stepS);
color += totalTransmittance * (luminance - luminance * transmittance) / sampleSigmaE;
totalTransmittance *= transmittance;
if (totalTransmittance <= 0.001) {
totalTransmittance = 0.0;
break;
}
}
dist += stepS;
p = org + dir * dist;
}
return color;
}`),t.fragment.code.add(S`void main() {
vec3 rayDir = rayDirection(gl_FragCoord.xy);
rayDir = normalize(view * rayDir);
vec3 viewPos = vec3(0, 0, cloudRadius + 1.0);
bool hitsPlanet = rayDir.z < 0.0;
if (hitsPlanet) {
gl_FragColor = vec4(vec3(0), 1);
return;
}
vec2 rayStartIntersect = sphereIntersections(viewPos, rayDir, cloudRadius + cloudStart);
vec2 rayEndIntersect = sphereIntersections(viewPos, rayDir, cloudRadius + cloudStart + cloudHeight);
float distToStart = rayStartIntersect.y;
float totalDistance = rayEndIntersect.y - distToStart;
float totalTransmittance = 1.0;
vec3 sunDirection = normalize(vec3(0, 0, 1));
vec3 col = 0.5 * mainRay(viewPos, rayDir, sunDirection, distToStart, totalDistance, totalTransmittance).rgb;
gl_FragColor = vec4(col, totalTransmittance);
}`),t}const qct=Object.freeze(Object.defineProperty({__proto__:null,CloudsDrawParameters:lCe,build:jct},Symbol.toStringTag,{value:"Module"}));class s8{constructor(t,r,i,n,s,a,o,l,c=.5){this.coverage=t,this.density=r,this.absorption=i,this.cloudSize=n,this.detailSize=s,this.smoothness=a,this.cloudHeight=o,this.raymarchingStepType=l,this.median=c}}const cCe={sunny:new s8([0,.6],[.03,.03],[0,0],[.9,.9],[.8,.8],[.7,.7],[.05,.05],ap.SIXTEEN),cloudy:new s8([.3,.65],[.2,.4],[0,0],[.85,.85],[.75,.75],[.3,.4],[1,1],ap.TWOHUNDRED,.6),rainy:new s8([.6,.8],[.5,.8],[.1,.5],[.9,.9],[.75,.75],[.5,.5],[1,1],ap.TWOHUNDRED,.4),snowy:new s8([.25,.75],[.3,.3],[0,0],[.95,.95],[.7,.7],[.69,.75],[.3,1],ap.HUNDRED,.65),foggy:new s8([.8,.8],[.5,.5],[0,0],[.95,.95],[.9,.9],[.55,.55],[.3,.3],ap.SIXTEEN)};class Dz extends gi{constructor(t,r){super(t,r,()=>this.destroy())}initializeProgram(t){const r=Dz.shader.get().build(this.configuration);return new ai(t.rctx,r,Ur)}initializePipeline(){return jt({blending:ka(Re.ONE,Re.ONE,Re.ZERO,Re.ZERO),depthTest:{func:vi.LEQUAL},colorWrite:or})}}Dz.shader=new si(qct,()=>ie(()=>import("./Clouds.glsl.0aa24801.js"),[],import.meta.url));var au;(function(e){e[e.Full=0]="Full",e[e.WeatherMap=1]="WeatherMap",e[e.COUNT=2]="COUNT"})(au||(au={}));class IJ extends xl{constructor(){super(...arguments),this.mode=au.Full}}d([H({count:au.COUNT})],IJ.prototype,"mode",void 0);function Hct(e){const t=new Qr;return t.include(__,!1),t.fragment.code.add(S`float remap(float x, float low1, float high1, float low2, float high2) {
return low2 + (x - low1) * (high2 - low2) / (high1 - low1);
}`),t.fragment.uniforms.add(new fy("weatherTile")),e.mode===au.Full&&t.fragment.code.add(S`
    float saturate(float x) {
      return clamp(x, 0.0, 1.0);
    }

    // Safer modulo for positive and negative values
    vec3 modulo(vec3 m, float n){
      return mod(mod(m, n) + n, n);
    }

    vec3 hash(vec3 p3, float frequency){
      p3 = modulo(p3, frequency);
      p3 = fract(p3 * vec3(0.1031, 0.1030, 0.0973));
      p3 += dot(p3, p3.yxz + 33.33);
      return -1.0 + 2.0 * fract((p3.xxy + p3.yxx) * p3.zyx);
    }

    // 5th order polynomial interpolation
    vec3 fade(vec3 t){
      return (t * t * t) * (t * (t * 6.0 - 15.0) + 10.0);
    }

    float gradientNoise(vec3 p, float frequency){
      // Cell point is in
      vec3 i = floor(p);

      // Position in the cell in [0, 1]
      vec3 f = fract(p);

      // Interpolation value for gradient mixing
      vec3 u = fade(f);

      // Trilinear interpolation of gradients at cube vertices around point
      return mix( mix( mix( dot( hash( i + vec3(0.0,0.0,0.0), frequency), f - vec3(0.0,0.0,0.0) ),
                            dot( hash( i + vec3(1.0,0.0,0.0), frequency), f - vec3(1.0,0.0,0.0) ), u.x),
                       mix( dot( hash( i + vec3(0.0,1.0,0.0), frequency), f - vec3(0.0,1.0,0.0) ),
                            dot( hash( i + vec3(1.0,1.0,0.0), frequency), f - vec3(1.0,1.0,0.0) ), u.x), u.y),
                  mix( mix( dot( hash( i + vec3(0.0,0.0,1.0), frequency), f - vec3(0.0,0.0,1.0) ),
                            dot( hash( i + vec3(1.0,0.0,1.0), frequency), f - vec3(1.0,0.0,1.0) ), u.x),
                       mix( dot( hash( i + vec3(0.0,1.0,1.0), frequency), f - vec3(0.0,1.0,1.0) ),
                            dot( hash( i + vec3(1.0,1.0,1.0), frequency), f - vec3(1.0,1.0,1.0) ), u.x), u.y), u.z );
    }

    float getPerlinNoise(vec3 pos, float frequency) {
      float octaveFrequencyFactor = 2.0;
      float sum = 0.0;
      float weightSum = 0.0;
      float weight = 1.0;

      for (int oct = 0; oct < 3; oct++) {
        vec3 p = pos * frequency;
        float val = 0.5 + 0.5 * gradientNoise(p, frequency);
        sum += val * weight;
        weightSum += weight;
        weight *= 0.5;
        frequency *= octaveFrequencyFactor;
      }

      float noise = (sum / weightSum);
      noise = saturate(noise);
      return noise;
    }

    float worley(vec3 pos, float numCells) {
      vec3 p = pos * numCells;
      float d = 1.0e10;

      for (int x = -1; x <= 1; x++) {
        for (int y = -1; y <= 1; y++) {
          for (int z = -1; z <= 1; z++) {
            vec3 tp = floor(p) + vec3(x, y, z);
            tp = p - tp - (hash(tp, numCells) * 0.5 + 0.5);
            d = min(d, dot(tp, tp));
          }
        }
      }

      return 1.0 - clamp(d, 0.0, 1.0);
    }

    vec3 get3Dfrom2D(vec2 uv) {
      vec2 tile = floor(uv);
      float z = floor(${S.float(qf)} * tile.y + tile.x);
      return vec3(fract(uv), z);
    }

    float getTextureForPointPerlinWorley(vec3 p) {
      float perlinNoise = getPerlinNoise(p, ${S.float(8)});

      float worley0 = worley(p, ${S.float(2)} * 2.0);
      float worley1 = worley(p, ${S.float(2)} * 8.0);
      float worley2 = worley(p, ${S.float(2)} * 14.0);

      float worleyFBM = worley0 * 0.625 + worley1 * 0.25 + worley2 * 0.125;
      return remap(perlinNoise, 0.0, 1.0, worleyFBM, 1.0);
    }

    float getTextureForPointWorley(vec3 p) {
      float worley0 = worley(p, ${S.float(2)});
      float worley1 = worley(p, ${S.float(2)} * 2.0);
      float worley2 = worley(p, ${S.float(2)} * 4.0);
      float worley3 = worley(p, ${S.float(2)} * 8.0);

      float FBM0 = worley0 * 0.625 + worley1 * 0.25 + worley2 * 0.125;
      float FBM1 = worley1 * 0.625 + worley2 * 0.25 + worley3 * 0.125;
      float FBM2 = worley2 * 0.75 + worley3 * 0.25;

      return FBM0 * 0.625 + FBM1 * 0.25 + FBM2 * 0.125;
    }
  `),t.fragment.code.add(S`
    vec2 modulo(vec2 m, float n){
      return mod(mod(m, n) + n, n);
    }

    vec2 hash(vec2 p){
      // Get position of p in weather tile
      p = modulo(p, ${S.float(Tj)});

      // Get global coordinates of p
      p += weatherTile * ${S.float(Tj)};

      // Limit position to avoid numerical instability
      p = modulo(p, ${S.float(Bct)});

      vec3 p3 = fract(vec3(p.xyx) * vec3(0.1031, 0.1030, 0.0973));
      p3 += dot(p3, p3.yzx + 33.33);
      return 2.0 * fract((p3.xx + p3.yz) * p3.zy) - 1.0;
    }

    vec2 fade(vec2 t){
      return (t * t * t) * (t * (t * 6.0 - 15.0) + 10.0);
    }

    float gradientNoise(vec2 p){
      vec2 i = floor( p );
      vec2 f = fract( p );

      vec2 u = fade(f);

      // Bilinear interpolation of gradients at cell vertices around point
      return  mix(
                mix(dot( hash( i + vec2(0.0,0.0) ), f - vec2(0.0,0.0) ),
                    dot( hash( i + vec2(1.0,0.0) ), f - vec2(1.0,0.0) ), u.x),
                mix(dot( hash( i + vec2(0.0,1.0) ), f - vec2(0.0,1.0) ),
                    dot( hash( i + vec2(1.0,1.0) ), f - vec2(1.0,1.0) ), u.x),
                u.y);
    }

    float worley(vec2 p){
      float d = 1.0e10;
      for (int x = -1; x <= 1; x++){
        for (int y = -1; y <= 1; y++){
                vec2 tp = floor(p) + vec2(x, y);
                tp = p - tp - (0.5 + 0.5 * hash(tp));
                d = min(d, dot(tp, tp));
            }
        }
      return 1.0 - clamp(d, 0.0, 1.0);
    }
  `),t.fragment.code.add(S`void main() {`),e.mode===au.Full&&t.fragment.code.add(S`
        float padWidth = 1.0;
        float paddedSize = ${S.float(wh)} + 2.0 * padWidth;
        float tileCount = ${S.float(qf)} * ${S.float(qf)};
        vec2 tile = floor((gl_FragCoord.xy - 0.5) / paddedSize);

        bool padCell = false;
        if (mod(gl_FragCoord.x, paddedSize) == 0.5 || mod(gl_FragCoord.x, paddedSize) == paddedSize - 0.5) {
          padCell = true;
        }

        if (mod(gl_FragCoord.y, paddedSize) == 0.5 || mod(gl_FragCoord.y, paddedSize) == paddedSize - 0.5) {
          padCell = true;
        }

        bool startPadX = false;
        bool startPadY = false;
        bool endPadX = false;
        bool endPadY = false;

        if (gl_FragCoord.x == tile.x * paddedSize + 0.5) {
          startPadX = true;
        }

        if (gl_FragCoord.y == tile.y * paddedSize + 0.5) {
          startPadY = true;
        }

        if (gl_FragCoord.x == (tile.x + 1.0) * paddedSize - 0.5) {
          endPadX = true;
        }

        if (gl_FragCoord.y == (tile.y + 1.0) * paddedSize - 0.5) {
          endPadY = true;
        }

        vec2 padding = vec2(2.0 * padWidth) * tile;
        vec2 uv;

        if (padCell) {
          vec2 pixel = gl_FragCoord.xy - padWidth - padding;

          if (startPadX) {
            pixel.x += ${S.float(wh)};
          }

          if (startPadY) {
            pixel.y += ${S.float(wh)};
          }

          if (endPadX) {
            pixel.x -= ${S.float(wh)};
          }

          if (endPadY) {
            pixel.y -= ${S.float(wh)};
          }

          uv = vec2(pixel.xy / ${S.float(wh)});
        } else {
          vec2 pixel = gl_FragCoord.xy - padWidth - padding;
          uv = vec2(pixel.xy / ${S.float(wh)});
        }

        vec3 p_ = get3Dfrom2D(uv);
        vec3 p = p_;
        p.z /= (${S.float(qf)} * ${S.float(qf)});

        float worleyPerlinNoise = getTextureForPointPerlinWorley(p);
        float worleyNoise = getTextureForPointWorley(p);

        gl_FragColor.r = saturate(remap(worleyPerlinNoise, worleyNoise, 1.0, 0.0, 1.0));

        p_ = mod(p_ + 1.0, ${S.float(qf)} * ${S.float(qf)});
        p = p_;
        p.z /= (${S.float(qf)} * ${S.float(qf)});

        worleyPerlinNoise = getTextureForPointPerlinWorley(p);
        worleyNoise = getTextureForPointWorley(p);

        gl_FragColor.g = saturate(remap(worleyPerlinNoise, worleyNoise, 1.0, 0.0, 1.0));
      `),t.fragment.code.add(S`
      vec2 mapUV = ${S.float(Tj)} * (gl_FragCoord.xy / ${S.float(ip)});
      float map = abs(gradientNoise(mapUV));
      map = remap(map, 0.25 * (1.0 - worley(8.0 * mapUV)), 1.0, 0.0, 1.0);

      ${e.mode===au.Full?S`gl_FragColor.ba = vec2(0.0, map);`:S`gl_FragColor = vec4(map);`};
    }
  `),t}const Wct=Object.freeze(Object.defineProperty({__proto__:null,build:Hct},Symbol.toStringTag,{value:"Module"}));class UA extends gi{initializeProgram(t){const r=UA.shader.get().build(this.configuration);return new ai(t.rctx,r,Ur)}initializePipeline(){return jt({blending:this.configuration.mode===au.Full?Im(Re.ONE,Re.ZERO):ka(Re.ZERO,Re.ONE,Re.ONE,Re.ZERO),depthTest:{func:vi.ALWAYS},colorWrite:or})}}UA.shader=new si(Wct,()=>ie(()=>import("./NoiseTextureAtlas.glsl.a1412640.js"),[],import.meta.url));class MS{constructor(t,r){this._context=t,this._desc=r,this.type="renderbuffer",this._context.instanceCounter.increment(ks.Renderbuffer,this);const i=this._context.gl;this.glName=i.createRenderbuffer(),this._context.bindRenderbuffer(this);const{width:n,height:s,internalFormat:a,multisampled:o}=r;if(o){if(this._context.type!==yr.WEBGL2)throw new Error("Multisampled renderbuffers are not supported in WebGL1!");i.renderbufferStorageMultisample(i.RENDERBUFFER,this.samples,a,n,s)}else i.renderbufferStorage(i.RENDERBUFFER,a,n,s)}get descriptor(){return this._desc}get samples(){const t=this._desc.samples,r=this._context.parameters.maxSamples;return t?Math.min(t,r):r}resize(t,r){const i=this._desc;if(i.width===t&&i.height===r)return;i.width=t,i.height=r;const n=this._context.gl;this._context.bindRenderbuffer(this),i.multisampled?n.renderbufferStorageMultisample(n.RENDERBUFFER,this.samples,i.internalFormat,i.width,i.height):n.renderbufferStorage(n.RENDERBUFFER,i.internalFormat,i.width,i.height)}dispose(){this._context&&(this._context.gl.deleteRenderbuffer(this.glName),this._context.instanceCounter.decrement(ks.Renderbuffer,this),this._context=null)}}const Xct=fe.getLogger("esri.views.webgl.FrameBufferObject");class Pi{constructor(t,r,i=null,n=null){var s;if(this._context=t,this._glName=null,this._depthAttachment=null,this._stencilAttachment=null,this._colorAttachments=new Map,this._initialized=!1,this._desc={...r},t.instanceCounter.increment(ks.FramebufferObject,this),_(i)){Array.isArray(i)||(i=[i]);for(let a=0;a<i.length;++a){const o=i[a],l=Hd.COLOR_ATTACHMENT0+a;let c;Epe(o)?(yg(o)?(c=o.descriptor,this._colorAttachments.set(l,o)):(c=o,this._colorAttachments.set(l,new at(this._context,c))),xP(c,this._desc)):(Spe(o)?(c=o.descriptor,this._colorAttachments.set(l,o)):(c=o,this._colorAttachments.set(l,new MS(this._context,c))),Sj(c,this._desc)),this._validateColorAttachmentPoint(l)}}if(_(n)){let a,o;if(Epe(n))this._context.capabilities.depthTexture||console.error("Setting the depth/stencil texture as an attachment requires WEBGL_depth_texture or WebGL2"),yg(n)?(o=n.descriptor,this._depthStencilTexture=n):(o=n,this._depthStencilTexture=new at(this._context,o)),xP(o,this._desc);else{Spe(n)?(o=n.descriptor,a=n):(o=n,a=new MS(this._context,o));const l=(s=this._desc.depthStencilTarget)!=null?s:Pr.DEPTH_STENCIL_RENDER_BUFFER;l===Pr.STENCIL_RENDER_BUFFER?this._stencilAttachment=a:l===Pr.DEPTH_RENDER_BUFFER||l===Pr.DEPTH_STENCIL_RENDER_BUFFER?this._depthAttachment=a:console.error('If a Renderbuffer is provided, "depthStencilTarget" must be one of STENCIL_RENDER_BUFFER, DEPTH_RENDER_BUFFER or DEPTH_STENCIL_RENDER_BUFFER'),Sj(o,this._desc)}}}dispose(){if(!this._desc)return;const t=this._context.getBoundFramebufferObject();this._disposeColorAttachments(),this._disposeDepthStencilAttachments(),this._glName&&(this._context.gl.deleteFramebuffer(this._glName),this._glName=null),this._context.bindFramebuffer(t),this._context.instanceCounter.decrement(ks.FramebufferObject,this),this._desc=null}get glName(){return this._glName}get descriptor(){return this._desc}get colorTexture(){const t=this._colorAttachments.get(Hd.COLOR_ATTACHMENT0);return t&&yg(t)?t:null}get colorAttachment(){return this._colorAttachments.get(Hd.COLOR_ATTACHMENT0)}get depthStencilAttachment(){return this._depthStencilTexture||this._depthAttachment||this._stencilAttachment}get depthStencilTexture(){return this._depthStencilTexture}get width(){return this._desc.width}get height(){return this._desc.height}get gpuMemoryUsage(){return[...this._colorAttachments].reduce((t,[r,i])=>t+Ww(i),0)+Ww(this.depthStencilAttachment)}getColorTexture(t){const r=this._colorAttachments.get(t);return r&&yg(r)?r:null}attachColorTexture(t,r=Hd.COLOR_ATTACHMENT0){!t||(this._validateColorAttachmentPoint(r),xP(t.descriptor,this._desc),this._disposeColorAttachments(),this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(t.glName,r)),this._colorAttachments.set(r,t))}detachColorTexture(t=Hd.COLOR_ATTACHMENT0){const r=this._colorAttachments.get(t);if(yg(r)){const i=r;return this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,t)),this._colorAttachments.delete(t),i}}setColorTextureTarget(t,r=Hd.COLOR_ATTACHMENT0){const i=this._colorAttachments.get(r);yg(i)&&this._framebufferTexture2D(i.glName,r,t)}attachDepthStencilTexture(t){if(R(t))return;const r=t.descriptor;r.pixelFormat!==Ue.DEPTH_STENCIL&&console.error("Depth/Stencil texture must have a pixel type of DEPTH_STENCIL!"),r.dataType!==At.UNSIGNED_INT_24_8&&console.error("Depth/Stencil texture must have data type of UNSIGNED_INT_24_8!"),this._context.capabilities.depthTexture||console.error("Extension WEBGL_depth_texture isn't supported therefore it is no possible to set the depth/stencil texture!"),xP(r,this._desc),this._desc.depthStencilTarget&&this._desc.depthStencilTarget!==Pr.DEPTH_STENCIL_TEXTURE&&(this._desc.depthStencilTarget=Pr.DEPTH_STENCIL_TEXTURE),this._disposeDepthStencilAttachments(),this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(t.glName,ope)),this._depthStencilTexture=t}detachDepthStencilTexture(){const t=this._depthStencilTexture;return t&&this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,ope)),this._depthStencilTexture=null,t}attachDepthStencilBuffer(t){if(R(t))return;const r=t.descriptor;if(r.internalFormat!==cl.DEPTH_STENCIL&&r.internalFormat!==cl.DEPTH_COMPONENT16&&console.error("Depth/Stencil buffer must have correct internalFormat"),Sj(r,this._desc),this._disposeDepthStencilAttachments(),this._desc.depthStencilTarget=r.internalFormat===cl.DEPTH_STENCIL?Pr.DEPTH_STENCIL_RENDER_BUFFER:Pr.DEPTH_RENDER_BUFFER,this._initialized){this._context.bindFramebuffer(this);const i=this._context.gl,n=this._desc.depthStencilTarget===Pr.DEPTH_RENDER_BUFFER?i.DEPTH_ATTACHMENT:i.DEPTH_STENCIL_ATTACHMENT;i.framebufferRenderbuffer(ea.FRAMEBUFFER,n,i.RENDERBUFFER,t.glName)}this._depthAttachment=t}detachDepthStencilBuffer(){const t=this._context.gl,r=this._depthAttachment;if(r&&this._initialized){this._context.bindFramebuffer(this);const i=this._desc.depthStencilTarget===Pr.DEPTH_RENDER_BUFFER?t.DEPTH_ATTACHMENT:t.DEPTH_STENCIL_ATTACHMENT;t.framebufferRenderbuffer(ea.FRAMEBUFFER,i,t.RENDERBUFFER,null)}return this._depthAttachment=null,r}detachAll(){this._colorAttachments.forEach((t,r)=>this._detachColorAttachment(r)),this.detachDepthStencilBuffer(),this.detachDepthStencilTexture()}copyToTexture(t,r,i,n,s,a,o){(t<0||r<0||s<0||a<0)&&console.error("Offsets cannot be negative!"),(i<=0||n<=0)&&console.error("Copy width and height must be greater than zero!");const l=this._desc,c=o.descriptor;o.descriptor.target!==mt.TEXTURE_2D&&console.error("Texture target must be TEXTURE_2D!"),(t+i>l.width||r+n>l.height||s+i>c.width||a+n>c.height)&&console.error("Bad dimensions, the current input values will attempt to read or copy out of bounds!");const u=this._context,h=u.bindTexture(o,at.TEXTURE_UNIT_FOR_UPDATES);u.setActiveTexture(at.TEXTURE_UNIT_FOR_UPDATES),u.bindFramebuffer(this),u.gl.copyTexSubImage2D(mt.TEXTURE_2D,0,s,a,t,r,i,n),u.bindTexture(h,at.TEXTURE_UNIT_FOR_UPDATES)}readPixels(t,r,i,n,s,a,o){(i<=0||n<=0)&&console.error("Copy width and height must be greater than zero!"),o||console.error("Target memory is not initialized!"),this._context.bindFramebuffer(this),this._context.gl.readPixels(t,r,i,n,s,a,o)}async readPixelsAsync(t,r,i,n,s,a,o){if(this._context.type!==yr.WEBGL2)return mh()&&console.warn("Attempting to read pixels using pixel buffer object without WebGL2"),void this.readPixels(t,r,i,n,s,a,o);const l=this._context.gl,c=dr.createPixelPack(this._context,Cr.STREAM_READ,o.byteLength);this._context.bindBuffer(c),this._context.bindFramebuffer(this),l.readPixels(t,r,i,n,s,a,0),this._context.unbindBuffer(Tt.PIXEL_PACK_BUFFER),await c.getSubDataAsync(o),c.dispose()}resize(t,r){const i=this._desc;if(i.width!==t||i.height!==r){if(!this._initialized)return i.width=t,i.height=r,this._colorAttachments.forEach(n=>{n&&n.resize(t,r)}),void(this._depthStencilTexture&&this._depthStencilTexture.resize(t,r));i.width=t,i.height=r,this._colorAttachments.forEach(n=>{n&&n.resize(t,r)}),this._depthStencilTexture!=null?this._depthStencilTexture.resize(t,r):(this._depthAttachment||this._stencilAttachment)&&(this._depthAttachment&&this._depthAttachment.resize(t,r),this._stencilAttachment&&this._stencilAttachment.resize(t,r)),this._context.getBoundFramebufferObject()===this&&this._context.bindFramebuffer(null),this._initialized=!1}}initializeAndBind(t=ea.FRAMEBUFFER){var u,h,p,m;const r=this._context.gl;if(this._initialized)return void r.bindFramebuffer(t,this.glName);this._glName&&r.deleteFramebuffer(this._glName);const i=this._context,n=r.createFramebuffer(),s=this._desc,a=(u=s.colorTarget)!=null?u:hn.RENDER_BUFFER,o=(h=s.width)!=null?h:1,l=(p=s.height)!=null?p:1;if(r.bindFramebuffer(t,n),this._colorAttachments.size===0)if(a===hn.TEXTURE||a===hn.CUBEMAP)this._colorAttachments.set(Hd.COLOR_ATTACHMENT0,Yct(i,s,this.descriptor.colorTarget===hn.CUBEMAP?mt.TEXTURE_CUBE_MAP:mt.TEXTURE_2D));else{const g=new MS(i,{internalFormat:gt.RGBA4,width:o,height:l});this._colorAttachments.set(Hd.COLOR_ATTACHMENT0,g)}this._colorAttachments.forEach((g,b)=>{g&&(yg(g)?this._framebufferTexture2D(g.glName,b,Cpe(g),t):r.framebufferRenderbuffer(t,b,r.RENDERBUFFER,g.glName))});const c=(m=s.depthStencilTarget)!=null?m:Pr.NONE;switch(c){case Pr.DEPTH_RENDER_BUFFER:case Pr.DEPTH_STENCIL_RENDER_BUFFER:{this._depthAttachment||(this._depthAttachment=new MS(i,{internalFormat:s.depthStencilTarget===Pr.DEPTH_RENDER_BUFFER?cl.DEPTH_COMPONENT16:cl.DEPTH_STENCIL,width:o,height:l}));const g=c===Pr.DEPTH_RENDER_BUFFER?r.DEPTH_ATTACHMENT:r.DEPTH_STENCIL_ATTACHMENT;r.framebufferRenderbuffer(t,g,r.RENDERBUFFER,this._depthAttachment.glName);break}case Pr.STENCIL_RENDER_BUFFER:this._stencilAttachment||(this._stencilAttachment=new MS(i,{internalFormat:cl.STENCIL_INDEX8,width:o,height:l})),r.framebufferRenderbuffer(t,r.STENCIL_ATTACHMENT,r.RENDERBUFFER,this._stencilAttachment.glName);break;case Pr.DEPTH_STENCIL_TEXTURE:if(!this._depthStencilTexture){i.capabilities.depthTexture||console.error("Extension WEBGL_depth_texture isn't supported therefore it is no possible to set the depth/stencil texture as an attachment!");const g={target:mt.TEXTURE_2D,pixelFormat:Ue.DEPTH_STENCIL,dataType:At.UNSIGNED_INT_24_8,samplingMode:tt.NEAREST,wrapMode:xt.CLAMP_TO_EDGE,width:o,height:l};this._depthStencilTexture=new at(i,g)}this._framebufferTexture2D(this._depthStencilTexture.glName,r.DEPTH_STENCIL_ATTACHMENT,Cpe(this._depthStencilTexture),t)}FA()&&r.checkFramebufferStatus(t)!==r.FRAMEBUFFER_COMPLETE&&console.error("Framebuffer is incomplete!"),this._glName=n,this._initialized=!0}_framebufferTexture2D(t,r=Hd.COLOR_ATTACHMENT0,i=mt.TEXTURE_2D,n=ea.FRAMEBUFFER,s=0){this._context.gl.framebufferTexture2D(n,r,i,t,s)}_detachColorAttachment(t){mh()&&console.warn("Detaching an FBO attachment can be a slow due to invalidating framebuffer completeness!");const r=this._context.gl,i=this._colorAttachments.get(t);return yg(i)?this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,t)):this._initialized&&(this._context.bindFramebuffer(this),r.framebufferRenderbuffer(ea.FRAMEBUFFER,t,r.RENDERBUFFER,null)),this._colorAttachments.delete(t),i}_disposeColorAttachments(){this._colorAttachments.forEach((t,r)=>{this._detachColorAttachment(r),t.dispose()}),this._colorAttachments.clear()}_disposeDepthStencilAttachments(){const t=this._context.gl;if(this._depthAttachment){if(this._initialized){this._context.bindFramebuffer(this);const r=this._desc.depthStencilTarget===Pr.DEPTH_RENDER_BUFFER?t.DEPTH_ATTACHMENT:t.DEPTH_STENCIL_ATTACHMENT;t.framebufferRenderbuffer(ea.FRAMEBUFFER,r,t.RENDERBUFFER,null)}this._depthAttachment.dispose(),this._depthAttachment=null}this._stencilAttachment&&(this._initialized&&(this._context.bindFramebuffer(this),t.framebufferRenderbuffer(ea.FRAMEBUFFER,t.STENCIL_ATTACHMENT,t.RENDERBUFFER,null)),this._stencilAttachment.dispose(),this._stencilAttachment=null),this._depthStencilTexture&&(this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,t.DEPTH_STENCIL_ATTACHMENT)),this._depthStencilTexture.dispose(),this._depthStencilTexture=null)}_validateColorAttachmentPoint(t){if(Pi._MAX_COLOR_ATTACHMENTS===-1){const i=this._context.capabilities.drawBuffers;if(i){const n=this._context.gl;Pi._MAX_COLOR_ATTACHMENTS=n.getParameter(i.MAX_COLOR_ATTACHMENTS)}else Pi._MAX_COLOR_ATTACHMENTS=1}const r=t-Hd.COLOR_ATTACHMENT0;r+1>Pi._MAX_COLOR_ATTACHMENTS&&Xct.error("esri.FrameBufferObject",`illegal attachment point for color attachment: ${r+1}. Implementation supports up to ${Pi._MAX_COLOR_ATTACHMENTS} color attachments`)}}function yg(e){return"type"in e&&e.type==="texture"}function Spe(e){return"type"in e&&e.type==="renderbuffer"}function Epe(e){return yg(e)||"pixelFormat"in e}function Yct(e,t,r){return new at(e,{target:r,pixelFormat:Ue.RGBA,dataType:At.UNSIGNED_BYTE,samplingMode:tt.NEAREST,wrapMode:xt.CLAMP_TO_EDGE,width:t.width,height:t.height})}function xP(e,t){e.target!==mt.TEXTURE_2D&&e.target!==mt.TEXTURE_CUBE_MAP&&console.error("Texture type must be TEXTURE_2D or TEXTURE_CUBE_MAP!"),t.width!==void 0&&t.width>=0&&t.height!==void 0&&t.height>=0?t.width===e.width&&t.height===e.height||console.error("Color attachment texture must match the framebuffer's!"):(t.width=e.width,t.height=e.height)}function Sj(e,t){t.width!==void 0&&t.width>=0&&t.height!==void 0&&t.height>=0?t.width===e.width&&t.height===e.height||console.error("Renderbuffer dimensions must match the framebuffer's!"):(t.width=e.width,t.height=e.height)}function Cpe(e){return e.descriptor.target===mt.TEXTURE_CUBE_MAP?mt.TEXTURE_CUBE_MAP_POSITIVE_X:mt.TEXTURE_2D}Pi._MAX_COLOR_ATTACHMENTS=-1;class dCe extends xe{constructor(t){let r;super(t),this._weatherTile=ul(0,0),this._needsRender=!0,this._frameBuffer=new Pi(t.context.renderContext.rctx,{colorTarget:hn.TEXTURE,width:ip,height:ip},{target:mt.TEXTURE_2D,pixelFormat:Ue.RGBA,dataType:At.UNSIGNED_BYTE,wrapMode:xt.CLAMP_TO_EDGE,samplingMode:tt.LINEAR,hasMipmap:!1,width:ip,height:ip}),this._vao=Tl(t.context.renderContext.rctx),this._shaderTechniqueRepository=t.context.shaderTechniqueRepository,this._ensureRendered=()=>(_(r)?_(this.weatherMapTechnique)&&this.weatherMapTechnique.compiled&&this._needsRender&&(r=this._render(t.context.renderContext.rctx,au.WeatherMap)):_(this.fullTechnique)&&this.fullTechnique.compiled&&(r=this._render(t.context.renderContext.rctx,au.Full)),r)}get textureAtlas(){return this._ensureRendered()}_setDirty(){this._needsRender=!0}updateWeatherMap(t){this._weatherTile[0]===t[0]&&this._weatherTile[1]===t[1]||(this._weatherTile=t,this._setDirty())}destroy(){this._fullTechnique=ri(this._fullTechnique),this._weatherMapTechnique=ri(this._weatherMapTechnique),this._frameBuffer=Qe(this._frameBuffer),this._vao=Qe(this._vao)}get fullTechnique(){if(R(this._fullTechnique)){const t=new IJ;t.mode=au.Full,this._fullTechnique=this._shaderTechniqueRepository.acquire(UA,t)}return this._fullTechnique}get weatherMapTechnique(){if(R(this._weatherMapTechnique)){const t=new IJ;t.mode=au.WeatherMap,this._weatherMapTechnique=this._shaderTechniqueRepository.acquire(UA,t)}return this._weatherMapTechnique}_render(t,r){if(R(this._vao)||R(this._frameBuffer))return null;const i=r===au.Full?this.fullTechnique:this.weatherMapTechnique;if(R(i))return null;const n=t.getViewport();t.setViewport(0,0,ip,ip),t.bindFramebuffer(this._frameBuffer);const s=t.bindTechnique(i);return s.setUniform2f("weatherTile",this._weatherTile[0],this._weatherTile[1]),t.bindVAO(this._vao),s.assertCompatibleVertexAttributeLocations(this._vao),t.gl.drawArrays(t.gl.TRIANGLE_STRIP,0,4),t.setViewport(n.x,n.y,n.width,n.height),this._needsRender=!1,this._frameBuffer.colorTexture}}d([f({constructOnly:!0})],dCe.prototype,"context",void 0);function uCe(e){e.include(Ou),e.uniforms.add([new Wt("geometryDepthTexture",(t,r)=>r.multipassGeometry.linearDepthTexture),new _r("nearFar",(t,r)=>r.camera.nearFar)]),e.code.add(S`bool geometryDepthTest(vec2 pos, float elementDepth) {
float geometryDepth = linearDepthFromTexture(geometryDepthTexture, pos, nearFar);
return (elementDepth < (geometryDepth - 1.0));
}`)}class Zct{constructor(){this.enabled=!1}}function Mu(e,t){t.hasMultipassTerrain&&(e.fragment.include(Ou),e.fragment.uniforms.add(new Wt("terrainDepthTexture",(r,i)=>i.multipassTerrain.linearDepthTexture)),e.fragment.uniforms.add(new _r("nearFar",(r,i)=>i.camera.nearFar)),e.fragment.uniforms.add(new _r("inverseViewport",(r,i)=>i.inverseViewport)),e.fragment.code.add(S`
    void terrainDepthTest(vec4 fragCoord, float fragmentDepth){
      float terrainDepth = linearDepthFromTexture(terrainDepthTexture, fragCoord.xy * inverseViewport, nearFar);
      if(fragmentDepth ${t.cullAboveGround?">":"<="} terrainDepth){
        discard;
      }
    }
  `))}class Qct{constructor(){this.enabled=!1,this.cullAboveGround=!1}}function Jct(e,t){const r=e.fragment.uniforms;r.add(new _r("nearFar",(i,n)=>n.camera.nearFar)),r.add(new Wt("depthMap",(i,n)=>n.linearDepthTexture)),r.add(new Ei("view",(i,n)=>n.ssr.camera.viewMatrix)),r.add(new Ei("proj",(i,n)=>n.ssr.camera.projectionMatrix)),r.add(new He("invResolutionHeight",(i,n)=>1/n.ssr.camera.height)),r.add(new Wt("lastFrameColorMap",(i,n)=>n.ssr.lastFrameColorTexture)),r.add(new Ei("reprojectionMatrix",(i,n)=>n.ssr.reprojectionMatrix)),e.fragment.include(Ou),e.fragment.code.add(S`
  vec2 reprojectionCoordinate(vec3 projectionCoordinate)
  {
    vec4 zw = proj * vec4(0.0, 0.0, -projectionCoordinate.z, 1.0);
    vec4 reprojectedCoord = reprojectionMatrix * vec4(zw.w * (projectionCoordinate.xy * 2.0 - 1.0), zw.z, zw.w);
    reprojectedCoord.xy /= reprojectedCoord.w;
    return reprojectedCoord.xy * 0.5 + 0.5;
  }

  const int maxSteps = ${t.highStepCount?"150;":"75;"}

  vec4 applyProjectionMat(mat4 projectionMat, vec3 x)
  {
    vec4 projectedCoord =  projectionMat * vec4(x, 1.0);
    projectedCoord.xy /= projectedCoord.w;
    projectedCoord.xy = projectedCoord.xy*0.5 + 0.5;
    return projectedCoord;
  }

  vec3 screenSpaceIntersection(vec3 dir, vec3 startPosition, vec3 viewDir, vec3 normal)
  {
    vec3 viewPos = startPosition;
    vec3 viewPosEnd = startPosition;

    // Project the start position to the screen
    vec4 projectedCoordStart = applyProjectionMat(proj, viewPos);
    vec3  Q0 = viewPos / projectedCoordStart.w; // homogeneous camera space
    float k0 = 1.0/ projectedCoordStart.w;

    // advance the position in the direction of the reflection
    viewPos += dir;

    vec4 projectedCoordVanishingPoint = applyProjectionMat(proj, dir);

    // Project the advanced position to the screen
    vec4 projectedCoordEnd = applyProjectionMat(proj, viewPos);
    vec3  Q1 = viewPos / projectedCoordEnd.w; // homogeneous camera space
    float k1 = 1.0/ projectedCoordEnd.w;

    // calculate the reflection direction in the screen space
    vec2 projectedCoordDir = (projectedCoordEnd.xy - projectedCoordStart.xy);
    vec2 projectedCoordDistVanishingPoint = (projectedCoordVanishingPoint.xy - projectedCoordStart.xy);

    float yMod = min(abs(projectedCoordDistVanishingPoint.y), 1.0);

    float projectedCoordDirLength = length(projectedCoordDir);
    float maxSt = float(maxSteps);

    // normalize the projection direction depending on maximum steps
    // this determines how blocky the reflection looks
    vec2 dP = yMod * (projectedCoordDir)/(maxSt * projectedCoordDirLength);

    // Normalize the homogeneous camera space coordinates
    vec3  dQ = yMod * (Q1 - Q0)/(maxSt * projectedCoordDirLength);
    float dk = yMod * (k1 - k0)/(maxSt * projectedCoordDirLength);

    // initialize the variables for ray marching
    vec2 P = projectedCoordStart.xy;
    vec3 Q = Q0;
    float k = k0;
    float rayStartZ = -startPosition.z; // estimated ray start depth value
    float rayEndZ = -startPosition.z;   // estimated ray end depth value
    float prevEstimateZ = -startPosition.z;
    float rayDiffZ = 0.0;
    float dDepth;
    float depth;
    float rayDiffZOld = 0.0;

    // early outs
    if (dot(normal, dir) < 0.0 || dot(-viewDir, normal) < 0.0)
      return vec3(P, 0.0);

    for(int i = 0; i < maxSteps-1; i++)
    {
      depth = -linearDepthFromTexture(depthMap, P, nearFar); // get linear depth from the depth buffer

      // estimate depth of the marching ray
      rayStartZ = prevEstimateZ;
      dDepth = -rayStartZ - depth;
      rayEndZ = (dQ.z * 0.5 + Q.z)/ ((dk * 0.5 + k));
      rayDiffZ = rayEndZ- rayStartZ;
      prevEstimateZ = rayEndZ;

      if(-rayEndZ > nearFar[1] || -rayEndZ < nearFar[0] || P.y < 0.0  || P.y > 1.0 )
      {
        return vec3(P, 0.);
      }

      // If we detect a hit - return the intersection point, two conditions:
      //  - dDepth > 0.0 - sampled point depth is in front of estimated depth
      //  - if difference between dDepth and rayDiffZOld is not too large
      //  - if difference between dDepth and 0.025/abs(k) is not too large
      //  - if the sampled depth is not behind far plane or in front of near plane

      if((dDepth) < 0.025/abs(k) + abs(rayDiffZ) && dDepth > 0.0 && depth > nearFar[0] && depth < nearFar[1] && abs(P.y - projectedCoordStart.y) > invResolutionHeight)
      {
        return vec3(P, depth);
      }

      // continue with ray marching
      P += dP;
      Q.z += dQ.z;
      k += dk;
      rayDiffZOld = rayDiffZ;
    }
    return vec3(P, 0.0);
  }
  `)}class Kct{constructor(){this.reprojectionMatrix=Ae()}}var Ee;(function(e){e[e.INTEGRATED_MESH=0]="INTEGRATED_MESH",e[e.OPAQUE_TERRAIN=1]="OPAQUE_TERRAIN",e[e.OPAQUE_MATERIAL=2]="OPAQUE_MATERIAL",e[e.TRANSPARENT_MATERIAL=3]="TRANSPARENT_MATERIAL",e[e.TRANSPARENT_TERRAIN=4]="TRANSPARENT_TERRAIN",e[e.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL=5]="TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL",e[e.OCCLUDED_TERRAIN=6]="OCCLUDED_TERRAIN",e[e.OCCLUDER_MATERIAL=7]="OCCLUDER_MATERIAL",e[e.TRANSPARENT_OCCLUDER_MATERIAL=8]="TRANSPARENT_OCCLUDER_MATERIAL",e[e.OCCLUSION_PIXELS=9]="OCCLUSION_PIXELS",e[e.POSTPROCESSING_ENVIRONMENT_OPAQUE=10]="POSTPROCESSING_ENVIRONMENT_OPAQUE",e[e.POSTPROCESSING_ENVIRONMENT_TRANSPARENT=11]="POSTPROCESSING_ENVIRONMENT_TRANSPARENT",e[e.LASERLINES=12]="LASERLINES",e[e.LASERLINES_CONTRAST_CONTROL=13]="LASERLINES_CONTRAST_CONTROL",e[e.HUD_MATERIAL=14]="HUD_MATERIAL",e[e.LABEL_MATERIAL=15]="LABEL_MATERIAL",e[e.LINE_CALLOUTS=16]="LINE_CALLOUTS",e[e.LINE_CALLOUTS_HUD_DEPTH=17]="LINE_CALLOUTS_HUD_DEPTH",e[e.DRAPED_MATERIAL=18]="DRAPED_MATERIAL",e[e.DRAPED_WATER=19]="DRAPED_WATER",e[e.VOXEL=20]="VOXEL",e[e.MAX_SLOTS=21]="MAX_SLOTS"})(Ee||(Ee={}));class yse{constructor(t=M()){this.intensity=t}}class hCe{constructor(t=M(),r=Ve(.57735,.57735,.57735)){this.intensity=t,this.direction=r}}class $J{constructor(t=M(),r=Ve(.57735,.57735,.57735),i=!0,n=1,s=1){this.intensity=t,this.direction=r,this.castShadows=i,this.specularStrength=n,this.environmentStrength=s}}class fCe{constructor(){this.r=[0],this.g=[0],this.b=[0]}}function edt(e,t,r){(r=r||e).length=e.length;for(let i=0;i<e.length;i++)r[i]=e[i]*t[i];return r}function Ej(e,t,r){(r=r||e).length=e.length;for(let i=0;i<e.length;i++)r[i]=e[i]*t;return r}function t5(e,t,r){(r=r||e).length=e.length;for(let i=0;i<e.length;i++)r[i]=e[i]+t[i];return r}function pCe(e){return(e+1)*(e+1)}function tdt(e){return Le(Math.floor(Math.sqrt(e)-1),0,2)}function mCe(e,t,r){const i=e[0],n=e[1],s=e[2],a=r||[];return a.length=pCe(t),t>=0&&(a[0]=.28209479177),t>=1&&(a[1]=.4886025119*i,a[2]=.4886025119*s,a[3]=.4886025119*n),t>=2&&(a[4]=1.09254843059*i*n,a[5]=1.09254843059*n*s,a[6]=.31539156525*(3*s*s-1),a[7]=1.09254843059*i*s,a[8]=.54627421529*(i*i-n*n)),a}function rdt(e,t){const r=pCe(e),i=t||{r:[],g:[],b:[]};i.r.length=i.g.length=i.b.length=r;for(let n=0;n<r;n++)i.r[n]=i.g[n]=i.b[n]=0;return i}function idt(e,t){const r=tdt(t.r.length);for(const i of e)Io(LJ,i.direction),mCe(LJ,r,Hg),edt(Hg,rD),Ej(Hg,i.intensity[0],Xx),t5(t.r,Xx),Ej(Hg,i.intensity[1],Xx),t5(t.g,Xx),Ej(Hg,i.intensity[2],Xx),t5(t.b,Xx);return t}function ndt(e,t){mCe(LJ,0,Hg);for(const r of e)t.r[0]+=Hg[0]*rD[0]*r.intensity[0]*4*Math.PI,t.g[0]+=Hg[0]*rD[0]*r.intensity[1]*4*Math.PI,t.b[0]+=Hg[0]*rD[0]*r.intensity[2]*4*Math.PI;return t}function sdt(e,t,r,i){rdt(t,i),ne(r.intensity,0,0,0);let n=!1;const s=adt,a=odt,o=ldt;s.length=0,a.length=0,o.length=0;for(const l of e)l instanceof $J&&!n?(oe(r.direction,l.direction),oe(r.intensity,l.intensity),r.specularStrength=l.specularStrength,r.environmentStrength=l.environmentStrength,r.castShadows=l.castShadows,n=!0):l instanceof $J||l instanceof hCe?s.push(l):l instanceof yse?a.push(l):l instanceof fCe&&o.push(l);idt(s,i),ndt(a,i);for(const l of o)t5(i.r,l.r),t5(i.g,l.g),t5(i.b,l.b)}const adt=[],odt=[],ldt=[],Hg=[0],Xx=[0],LJ=M(),rD=[3.141593,2.094395,2.094395,2.094395,.785398,.785398,.785398,.785398,.785398],v6=.4;class cdt{constructor(){this._shOrder=2,this._oldSunlight={direction:M(),ambient:{color:M(),intensity:1},diffuse:{color:M(),intensity:1}},this.globalFactor=.5,this.groundLightingFactor=.5,this._sphericalHarmonics=new fCe,this._mainLight={intensity:M(),direction:Ve(1,0,0),castShadows:!1,specularStrength:1,environmentStrength:1}}get sh(){return this._sphericalHarmonics}get mainLight(){return this._mainLight}get lightingMainDirection(){return this._mainLight.direction}set(t){sdt(t,this._shOrder,this._mainLight,this._sphericalHarmonics),oe(this._oldSunlight.direction,this._mainLight.direction);const r=1/Math.PI;this._oldSunlight.ambient.color[0]=.282095*this._sphericalHarmonics.r[0]*r,this._oldSunlight.ambient.color[1]=.282095*this._sphericalHarmonics.g[0]*r,this._oldSunlight.ambient.color[2]=.282095*this._sphericalHarmonics.b[0]*r,le(this._oldSunlight.diffuse.color,this._mainLight.intensity,r),oe(TP,this._oldSunlight.diffuse.color),le(TP,TP,v6*this.globalFactor),he(this._oldSunlight.ambient.color,this._oldSunlight.ambient.color,TP)}get old(){return this._oldSunlight}}const TP=M();class Fz{constructor(t,r,i){this.shadowMap=t,this.ssaoHelper=r,this.slicePlane=i,this.slot=Ee.OPAQUE_MATERIAL,this.hasOccludees=!1,this.enableFillLights=!0,this._inverseViewport=it(),this.lighting=new cdt,this.ssr=new Kct,this.multipassTerrain=new Qct,this.multipassGeometry=new Zct,this.clouds=new Qlt,this.overlays=[]}get camera(){return this._camera}set camera(t){this._camera=this.ssr.camera=t,this._inverseViewport[0]=1/t.fullViewport[2],this._inverseViewport[1]=1/t.fullViewport[3]}get inverseViewport(){return this._inverseViewport}}let Qo=class extends xe{constructor(e){super(e),this._frameTask=null,this._handles=new Ft,this._cubeMapSize=ue("esri-mobile")?1024:2048,this._techniques=[],this._techniqueConfiguration=new oCe,this._bindParameters=new Fz(null,null,null),this._drawParameters=new lCe,this._weatherTile=ul(0,0),this._weatherTileCount=128,this.coverage=Kt(Cl.coverage[0],Cl.coverage[1],.5),this.density=Kt(Cl.density[0],Cl.density[1],.5),this.absorption=Kt(Cl.absorption[0],Cl.absorption[1],.5),this.cloudSize=Kt(Cl.cloudSize[0],Cl.cloudSize[1],.5),this.detailSize=Kt(Cl.detailSize[0],Cl.detailSize[1],.5),this.smoothness=Kt(Cl.smoothness[0],Cl.smoothness[1],.5),this.cloudHeight=Kt(Cl.cloudHeight[0],Cl.cloudHeight[1],.5),this.raymarchingStepType=Cl.raymarchingStepType,this._cloudRadius=0,this._viewMatrix=Ae(),this._cameraPositionLastFrame=M(),this.running=!1}_getTechnique(e){return this._techniques[e]||(this._techniqueConfiguration.steps=e,this._techniques[e]=new Dz({rctx:this.context.renderContext.rctx,viewingMode:this.view.state.viewingMode},this._techniqueConfiguration),this._techniques[e])}_getWeatherTile(){const e=this.view.camera.position.latitude,t=this.view.camera.position.longitude;let r=ul((e+90)/180,(t+180)/360);const i=Math.floor(this._weatherTileCount*Math.abs(2*r[0]-1));r=ul(Math.floor(2*this._weatherTileCount*r[0]),Math.floor(4*(this._weatherTileCount-i)*r[1]));let n=0,s=0;if(_(this.view.environment)&&this.view.environment.lighting.type==="sun"&&_(this.view.environment.lighting.date)){const a=new Date(this.view.environment.lighting.date);a.setUTCHours(this.view.environment.lighting.date.getUTCHours()+this.view.environment.lighting.displayUTCOffset),n=31*a.getUTCMonth()+a.getUTCDate(),s=a.getUTCFullYear()}return r[0]=(r[0]+n)%(2*this._weatherTileCount),r[1]=(r[1]+s%100)%(4*this._weatherTileCount),r}initialize(){this._vao=Tl(this.context.renderContext.rctx);const e=Ar(this.view.spatialReference);this._cloudRadius=.5*e.radius,this.setDirty(),this._weatherTile=this._getWeatherTile(),this._frameTask=this.view.resourceController.scheduler.registerTask(bt.CLOUDS_GENERATOR,this),this._handles.add(this._frameTask),this._handles.add(re(()=>[this.coverage,this.density,this.absorption,this.cloudSize,this.detailSize,this.smoothness,this.cloudHeight,this.raymarchingStepType],()=>this.setDirty(),Ot))}destroy(){this._handles.destroy(),this._techniques.forEach(e=>ri(e)),this._techniques=null,this._frameBufferCube=Qe(this._frameBufferCube),this._vao=Qe(this._vao),this._noiseTexture=ct(this._noiseTexture)}_ensureNoiseTexture(){if(R(this._noiseTexture)){const e=this.context;this._noiseTexture=new dCe({context:e}),this._noiseTexture.updateWeatherMap(this._weatherTile)}return this._noiseTexture.textureAtlas}ensureWeatherTile(){const e=this._getWeatherTile();_(this._noiseTexture)&&_(this.context)&&this._noiseTexture.updateWeatherMap(e),e[0]===this._weatherTile[0]&&e[1]===this._weatherTile[1]||(this._weatherTile=e,this.setDirty())}get frameBufferCube(){if(R(this._frameBufferCube)){const e={target:mt.TEXTURE_CUBE_MAP,pixelFormat:Ue.RGBA,dataType:At.UNSIGNED_BYTE,wrapMode:xt.CLAMP_TO_EDGE,samplingMode:tt.LINEAR,hasMipmap:!1,width:this._cubeMapSize,height:this._cubeMapSize};this._frameBufferCube=new Pi(this.context.renderContext.rctx,{colorTarget:hn.CUBEMAP,width:this._cubeMapSize,height:this._cubeMapSize},e)}return this._frameBufferCube}get cubeMap(){return this._frameBufferCube}isFading(e){return e.crossFade.enabled||e.fadeInOut.stage===xa.FADE_OUT||e.fadeInOutHeight.stage!==Fv.FINISHED}applyPreset(e,t){const r=e.median,i=n=>{const s=Kt(n[0],n[1],r);return t<.5?Kt(n[0],s,2*t):Kt(s,n[1],2*(t-.5))};this.coverage=i(e.coverage),this.density=i(e.density),this.absorption=i(e.absorption),this.cloudSize=i(e.cloudSize),this.detailSize=i(e.detailSize),this.smoothness=i(e.smoothness),this.cloudHeight=i(e.cloudHeight),this.raymarchingStepType=e.raymarchingStepType}setDirty(){this.running=!0}runTask(e){if(this.coverage===0||R(this._vao))return void(this.running=!1);const t=this._getTechnique(this.raymarchingStepType);if(!t.compiled)return;if(!Lw(this._cameraPositionLastFrame,this.context.renderContext.bindParameters.camera.eye)||this.isFading(this.context.renderContext.bindParameters.clouds))return void oe(this._cameraPositionLastFrame,this.context.renderContext.bindParameters.camera.eye);this.ensureWeatherTile();const r=this._ensureNoiseTexture();if(R(r))return;const i=this.context.renderContext.rctx,n=i.bindTechnique(t),s=1+this.absorption,a=Kt(35,120,this.absorption);n.bindTexture("cloudShapeTexture",r),n.setUniform1f("cloudRadius",this._cloudRadius),n.setUniform1f("halfCubeMapSize",.5*this._cubeMapSize),n.setUniform1f("power",a),n.setUniform1f("sigmaE",s),n.setUniform1f("density",Kt(0,.3,this.density)),n.setUniform1f("cloudSize",Kt(0,.02,Math.max(.01,1-this.cloudSize))),n.setUniform1f("detailSize",Kt(0,.2,Math.max(.01,1-this.detailSize))),n.setUniform1f("smoothness",Kt(0,.5,1-this.smoothness)),n.setUniform1f("cloudHeight",Kt(0,1500,this.cloudHeight)),n.setUniform1f("coverage",this.coverage),i.bindVAO(this._vao),n.assertCompatibleVertexAttributeLocations(this._vao);const o=i.getViewport();i.setViewport(0,0,this._cubeMapSize,this._cubeMapSize),i.bindFramebuffer(this.frameBufferCube);for(let l=0;l<5;l++){const c=ddt[l],u=udt[l];CTe(this._viewMatrix,hdt,c,u),Jh(this._drawParameters.viewMatrix,this._viewMatrix);const h=mt.TEXTURE_CUBE_MAP_POSITIVE_X+l;this.frameBufferCube.setColorTextureTarget(h),n.bindDraw(this._drawParameters,this._bindParameters),i.gl.drawArrays(i.gl.TRIANGLE_STRIP,0,4),i.gl.flush()}this.running=!1,i.setViewport(o.x,o.y,o.width,o.height),this.requestRender(),e.madeProgress()}};d([f({constructOnly:!0})],Qo.prototype,"context",void 0),d([f({constructOnly:!0})],Qo.prototype,"view",void 0),d([f({constructOnly:!0})],Qo.prototype,"requestRender",void 0),d([f()],Qo.prototype,"_frameTask",void 0),d([f()],Qo.prototype,"coverage",void 0),d([f()],Qo.prototype,"density",void 0),d([f()],Qo.prototype,"absorption",void 0),d([f()],Qo.prototype,"cloudSize",void 0),d([f()],Qo.prototype,"detailSize",void 0),d([f()],Qo.prototype,"smoothness",void 0),d([f()],Qo.prototype,"cloudHeight",void 0),d([f()],Qo.prototype,"raymarchingStepType",void 0),d([f()],Qo.prototype,"running",void 0),Qo=d([$("esri.views.3d.environment.CloudsGenerator")],Qo);const ddt=[Dr(1,0,0),Dr(-1,0,0),Dr(0,1,0),Dr(0,-1,0),Dr(0,0,1)],udt=[Dr(0,1,0),Dr(0,1,0),Dr(0,0,-1),Dr(0,0,1),Dr(0,1,0)],hdt=ise(),Cl=cCe.sunny;function fdt(e){const t=new Qr;t.attributes.add(O.POSITION,"vec2"),t.include(hy,{textureCoordinateType:ws.Default}),t.varyings.add("worldRay","vec3"),t.varyings.add("eyeDir","vec3");const{vertex:r,fragment:i}=t;return r.uniforms.add([new Ei("inverseProjectionMatrix",(n,s)=>s.camera.inverseProjectionMatrix),new Ei("inverseViewMatrix",(n,s)=>Rn(pdt,s.camera.viewMatrix))]),r.code.add(S`void main(void) {
vec3 posViewNear = (inverseProjectionMatrix * vec4(position, -1, 1)).xyz;
eyeDir = posViewNear;
worldRay = (inverseViewMatrix * vec4(posViewNear, 0)).xyz;
forwardTextureCoordinates();
gl_Position = vec4(position, 1, 1);
}`),i.uniforms.add(new kr("atmosphereC")),i.uniforms.add(new tc("cameraPosition")),i.uniforms.add(new _r("nearFar",(n,s)=>s.camera.nearFar)),i.uniforms.add(new Hi("depthTex")),i.uniforms.add(new kr("fogStrength")),i.uniforms.add(new kr("fogAmount")),i.uniforms.add(new tc("fogColor")),t.include(Oz),i.include(Ou),i.code.add(S`vec2 sphereIntersect(vec3 start, vec3 dir) {
float a = dot(dir, dir);
float b = 2.0 * dot(dir, start);
float d = (b * b) - 4.0 * a * atmosphereC;
if (d < 0.0) {
return vec2(1e5, -1e5);
}
return vec2((-b - sqrt(d)) / (2.0 * a), (-b + sqrt(d)) / (2.0 * a));
}`),i.code.add(S`vec4 applyFog(float dist, vec3 rayDir){
if(dist == -1.0){
vec2 rayAtmosphereIntersect = sphereIntersect(cameraPosition, rayDir);
dist = 0.055 * rayAtmosphereIntersect.y;
}
float fogAmount = fogAmount * (1.0 - exp(-dist * fogStrength));
return vec4(fogAmount * fogColor, fogAmount);
}`),i.code.add(S`
    vec3 tonemapACES(vec3 x) {
      return clamp((x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14), 0.0, 1.0);
    }

    void main() {
      vec3 rayDir = normalize(worldRay);
      float terrainDepth = -1.0;

      float depthSample = texture2D(depthTex, vuv0).r;
      float zNorm = 2.0 * depthSample - 1.0;
      float linDepth = 2.0 * nearFar[0] * nearFar[1] / (nearFar[1] + nearFar[0] - zNorm * (nearFar[1] - nearFar[0]));
      if(depthSample < 1.0 && depthSample > 0.0){
        vec3 cameraSpaceRay = normalize(eyeDir);
        cameraSpaceRay /= cameraSpaceRay.z;
        cameraSpaceRay *= linDepth;
        terrainDepth = max(0.0, length(cameraSpaceRay));
      }

      ${e.haze?S`
          if(terrainDepth == -1.0){
            gl_FragColor = vec4(0);
            return;
          }`:""}

      vec4 fog = applyFog(terrainDepth, rayDir);

      gl_FragColor = delinearizeGamma(vec4(tonemapACES(fog.rgb), fog.a));
    }
  `),t}const pdt=Ae(),mdt=Object.freeze(Object.defineProperty({__proto__:null,build:fdt},Symbol.toStringTag,{value:"Module"}));class BA extends gi{initializeProgram(t){const r=BA.shader.get().build(this.configuration);return new ai(t.rctx,r,Ur)}initializePipeline(){return this.configuration.haze?jt({blending:ka(Re.ONE,Re.ZERO,Re.ONE_MINUS_SRC_COLOR,Re.ONE),colorWrite:or}):jt({blending:ka(Re.SRC_ALPHA,Re.ZERO,Re.ONE_MINUS_SRC_ALPHA,Re.ONE),colorWrite:or})}}BA.shader=new si(mdt,()=>ie(()=>import("./Fog.glsl.00acc7e9.js"),[],import.meta.url));class DJ extends xl{constructor(){super(...arguments),this.haze=!1}}d([H()],DJ.prototype,"haze",void 0);let nC=class extends xe{constructor(e){super(e),this._fogColor=Mr(),this._fogColorAtNight=Mr(),this._cameraDirection=Mr(),this._foggyFadeStart=.95,this._foggyFadeEnd=1,this._hazeFadeStart=.7,this._hazeFadeEnd=1,this._strength=4e-6;const t=e.context.renderContext.rctx;this._vao=Tl(t,bO);const r=Ar(e.view.spatialReference);this._planetRadius=r.radius,this._atmosphereRadius=r.radius+JL}destroy(){this._hazeFogTechnique=ri(this._hazeFogTechnique),this._thickFogTechnique=ri(this._thickFogTechnique),this._vao=Qe(this._vao)}get _shaderTechniqueRepository(){return this.context.shaderTechniqueRepository}set strength(e){this._strength=e}get strength(){return this._strength}get thickFogTechnique(){if(R(this._thickFogTechnique)){const e=new DJ;e.haze=!1,this._thickFogTechnique=this._shaderTechniqueRepository.acquire(BA,e)}return this._thickFogTechnique}get hazeFogTechnique(){if(R(this._hazeFogTechnique)){const e=new DJ;e.haze=!0,this._hazeFogTechnique=this._shaderTechniqueRepository.acquire(BA,e)}return this._hazeFogTechnique}when(){return Promise.resolve()}render(e,t,r){if(this.view.basemapTerrain.baseOpacity===0&&!t||(this._update(e,t,r),this._fogAmount<=0))return;const i=t?this.thickFogTechnique:this.hazeFogTechnique;if(!i.compiled)return void this.context.requestRender();const n=e.offscreenRenderingHelper,s=e.rctx.bindTechnique(i,gdt,e.bindParameters);n.renderDepthDetached(()=>{s.bindTexture("depthTex",n.depthTexture),this._renderFog(i.program,e)})}_renderFog(e,t){if(R(this._vao))return!1;const r=t.rctx,i=t.bindParameters.camera;return e.setUniform3fv("cameraPosition",i.eye),e.setUniform1f("atmosphereC",this._atmosphereC),e.setUniform1f("fogStrength",this._strength),e.setUniform1f("fogAmount",this._fogAmount),e.setUniform3fv("fogColor",this._fogColor),r.bindVAO(this._vao),e.assertCompatibleVertexAttributeLocations(this._vao),r.drawArrays(Dt.TRIANGLE_STRIP,0,4),!0}_update(e,t,r){const i=e.bindParameters.camera,n=t?.1:0;r?ne(this._fogColor,.5,.5,.5):t?ne(this._fogColor,1.5,1.5,1.5):ne(this._fogColor,.24,.44,.8),le(this._fogColorAtNight,this._fogColor,n),we(this._cameraDirection,i.eye);const s=Math.max(0,Se(this._cameraDirection,e.bindParameters.lighting.lightingMainDirection));As(this._fogColor,this._fogColorAtNight,this._fogColor,s);const a=Oe(i.eye),o=a*a;this._atmosphereC=o-this._atmosphereRadius*this._atmosphereRadius,this._fogAmount=t?1-D5(this._foggyFadeStart*_h,this._foggyFadeEnd*_h,Math.abs(a-this._planetRadius)):1-D5(this._hazeFadeStart*_h,this._hazeFadeEnd*_h,Math.abs(a-this._planetRadius))}static isSupported(e){return e.capabilities.depthTexture}};d([f({constructOnly:!0})],nC.prototype,"context",void 0),d([f({constructOnly:!0})],nC.prototype,"view",void 0),nC=d([$("esri.views.3d.environment.Fog")],nC);const gdt=new as;async function Dp(e,t){const{data:r}=await qt(e,{responseType:"image",...t});return r}var vm;(function(e){e[e.Cone=0]="Cone",e[e.Cylinder=1]="Cylinder",e[e.Underground=2]="Underground",e[e.COUNT=3]="COUNT"})(vm||(vm={}));class UN extends xl{constructor(){super(...arguments),this.geometry=vm.Cone}}d([H({count:vm.COUNT})],UN.prototype,"geometry",void 0);function no(e,t={hasModelTransformation:!1,linearDepth:!1}){if(t.hasModelTransformation)return t.linearDepth?void e.vertex.code.add(S`vec4 transformPositionWithDepth(mat4 proj, mat4 view, mat4 model, vec3 pos, vec2 nearFar, out float depth) {
vec4 eye = view * (model * vec4(pos, 1.0));
depth = (-eye.z - nearFar[0]) / (nearFar[1] - nearFar[0]) ;
return proj * eye;
}`):void e.vertex.code.add(S`vec4 transformPosition(mat4 proj, mat4 view, mat4 model, vec3 pos) {
return proj * (view * (model * vec4(pos, 1.0)));
}`);t.linearDepth?e.vertex.code.add(S`vec4 transformPositionWithDepth(mat4 proj, mat4 view, vec3 pos, vec2 nearFar, out float depth) {
vec4 eye = view * vec4(pos, 1.0);
depth = (-eye.z - nearFar[0]) / (nearFar[1] - nearFar[0]) ;
return proj * eye;
}`):e.vertex.code.add(S`vec4 transformPosition(mat4 proj, mat4 view, vec3 pos) {
return proj * (view * vec4(pos, 1.0));
}`)}class Jv extends sn{constructor(t){super(t,"mat4")}}class bse extends as{}function ydt(e){const t=new Qr,{vertex:r,fragment:i}=t;if(e.geometry===vm.Underground)t.attributes.add(O.POSITION,"vec2"),t.varyings.add("color","vec4"),r.uniforms.add([new St("lightingMainDirection",(n,s)=>s.lighting.lightingMainDirection),new tc("cameraPosition"),new kr("undergroundFadeAlpha")]),r.code.add(S`void main(void) {
float ndotl = dot(normalize(cameraPosition), lightingMainDirection);
float lighting = max(0.0, smoothstep(-1.0, 0.8, 2.0 * ndotl));
color = vec4(vec3(lighting), undergroundFadeAlpha);
gl_Position = vec4(position.xy, 1.0, 1.0);
}`),i.code.add(S`void main() {
gl_FragColor = color;
}`);else{t.include(no),t.attributes.add(O.POSITION,"vec3"),t.varyings.add("vtc","vec2"),t.varyings.add("falloff","float");const n=e.geometry===vm.Cylinder;r.uniforms.add([new Ei("proj",(o,l)=>l.camera.projectionMatrix),new Jv("view"),new St("lightingMainDirection",(o,l)=>l.lighting.lightingMainDirection)]),n||(t.varyings.add("innerFactor","float"),r.uniforms.add(new tc("silCircleCenter")),r.uniforms.add(new tc("silCircleV1")),r.uniforms.add(new tc("silCircleV2")),r.uniforms.add(new fy("texV")),r.uniforms.add(new kr("innerScale")));const s=6.2831853,a=1/128;r.code.add(S`
		void main(void) {
      ${n?S`
      vec3 pos = position;
      float ndotl = lightingMainDirection.z;
      vtc = vec2(0.0, position.z + 0.05);`:S`
      innerFactor = clamp(-position.z, 0.0, 1.0);
      float scale = position.y * (1.0 + innerFactor * innerScale);
      float phi = position.x * ${S.float(s*a)} + 1.0;
      vec3 pos =  (silCircleCenter + sin(phi) * silCircleV1 + cos(phi) * silCircleV2) * scale;
      float ndotl = dot(normalize(position.y > 0.0 ? pos: silCircleCenter), lightingMainDirection);
      vtc.x = position.x  * ${S.float(a)};
      vtc.y = texV.x * (1.0 - position.z) + texV.y * position.z;
      `}
      falloff = max(0.0, smoothstep(-1.0, 0.8, 2.0 * ndotl));

		  gl_Position = transformPosition(proj, view, pos);
		  gl_Position.z = gl_Position.w; // project atmosphere onto the far plane
    }
	  `),i.uniforms.add(new Wt("tex",o=>o.texture)),n||i.uniforms.add(new kr("altitudeFade")),i.code.add(S`
		void main() {
			vec4 atmosphereColor = texture2D(tex, vtc) * falloff;
      ${n?S`gl_FragColor = atmosphereColor;`:S`
			vec4 innerColor = vec4(atmosphereColor.rgb, 1.0 - altitudeFade);
			gl_FragColor = mix(atmosphereColor, innerColor, smoothstep(0.0, 1.0, innerFactor));
      `}
    }`)}return t}const bdt=Object.freeze(Object.defineProperty({__proto__:null,SimpleAtmospherePassParameters:bse,build:ydt},Symbol.toStringTag,{value:"Module"}));class y9 extends gi{initializeProgram(t){const r=y9.shader.get().build(this.configuration);return new ai(t.rctx,r,Ur)}initializePipeline(){return this.configuration.geometry===vm.Cylinder?jt({blending:ka(Re.SRC_ALPHA,Re.ONE,Re.ONE_MINUS_SRC_ALPHA,Re.ONE_MINUS_SRC_ALPHA),culling:Qne,depthTest:{func:vi.LEQUAL},colorWrite:or}):jt({blending:ka(Re.SRC_ALPHA,Re.ONE,Re.ONE_MINUS_SRC_ALPHA,Re.ONE_MINUS_SRC_ALPHA),depthTest:{func:vi.LEQUAL},colorWrite:or})}}y9.shader=new si(bdt,()=>ie(()=>import("./SimpleAtmosphere.glsl.bcc425e3.js"),[],import.meta.url));const gCe="data:image/png;base64, iVBORw0KGgoAAAANSUhEUgAAAAEAAAIACAYAAABD1gYFAAAACXBIWXMAAC4jAAAuIwF4pT92AAAKT2lDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVNnVFPpFj333vRCS4iAlEtvUhUIIFJCi4AUkSYqIQkQSoghodkVUcERRUUEG8igiAOOjoCMFVEsDIoK2AfkIaKOg6OIisr74Xuja9a89+bN/rXXPues852zzwfACAyWSDNRNYAMqUIeEeCDx8TG4eQuQIEKJHAAEAizZCFz/SMBAPh+PDwrIsAHvgABeNMLCADATZvAMByH/w/qQplcAYCEAcB0kThLCIAUAEB6jkKmAEBGAYCdmCZTAKAEAGDLY2LjAFAtAGAnf+bTAICd+Jl7AQBblCEVAaCRACATZYhEAGg7AKzPVopFAFgwABRmS8Q5ANgtADBJV2ZIALC3AMDOEAuyAAgMADBRiIUpAAR7AGDIIyN4AISZABRG8lc88SuuEOcqAAB4mbI8uSQ5RYFbCC1xB1dXLh4ozkkXKxQ2YQJhmkAuwnmZGTKBNA/g88wAAKCRFRHgg/P9eM4Ors7ONo62Dl8t6r8G/yJiYuP+5c+rcEAAAOF0ftH+LC+zGoA7BoBt/qIl7gRoXgugdfeLZrIPQLUAoOnaV/Nw+H48PEWhkLnZ2eXk5NhKxEJbYcpXff5nwl/AV/1s+X48/Pf14L7iJIEyXYFHBPjgwsz0TKUcz5IJhGLc5o9H/LcL//wd0yLESWK5WCoU41EScY5EmozzMqUiiUKSKcUl0v9k4t8s+wM+3zUAsGo+AXuRLahdYwP2SycQWHTA4vcAAPK7b8HUKAgDgGiD4c93/+8//UegJQCAZkmScQAAXkQkLlTKsz/HCAAARKCBKrBBG/TBGCzABhzBBdzBC/xgNoRCJMTCQhBCCmSAHHJgKayCQiiGzbAdKmAv1EAdNMBRaIaTcA4uwlW4Dj1wD/phCJ7BKLyBCQRByAgTYSHaiAFiilgjjggXmYX4IcFIBBKLJCDJiBRRIkuRNUgxUopUIFVIHfI9cgI5h1xGupE7yAAygvyGvEcxlIGyUT3UDLVDuag3GoRGogvQZHQxmo8WoJvQcrQaPYw2oefQq2gP2o8+Q8cwwOgYBzPEbDAuxsNCsTgsCZNjy7EirAyrxhqwVqwDu4n1Y8+xdwQSgUXACTYEd0IgYR5BSFhMWE7YSKggHCQ0EdoJNwkDhFHCJyKTqEu0JroR+cQYYjIxh1hILCPWEo8TLxB7iEPENyQSiUMyJ7mQAkmxpFTSEtJG0m5SI+ksqZs0SBojk8naZGuyBzmULCAryIXkneTD5DPkG+Qh8lsKnWJAcaT4U+IoUspqShnlEOU05QZlmDJBVaOaUt2ooVQRNY9aQq2htlKvUYeoEzR1mjnNgxZJS6WtopXTGmgXaPdpr+h0uhHdlR5Ol9BX0svpR+iX6AP0dwwNhhWDx4hnKBmbGAcYZxl3GK+YTKYZ04sZx1QwNzHrmOeZD5lvVVgqtip8FZHKCpVKlSaVGyovVKmqpqreqgtV81XLVI+pXlN9rkZVM1PjqQnUlqtVqp1Q61MbU2epO6iHqmeob1Q/pH5Z/YkGWcNMw09DpFGgsV/jvMYgC2MZs3gsIWsNq4Z1gTXEJrHN2Xx2KruY/R27iz2qqaE5QzNKM1ezUvOUZj8H45hx+Jx0TgnnKKeX836K3hTvKeIpG6Y0TLkxZVxrqpaXllirSKtRq0frvTau7aedpr1Fu1n7gQ5Bx0onXCdHZ4/OBZ3nU9lT3acKpxZNPTr1ri6qa6UbobtEd79up+6Ynr5egJ5Mb6feeb3n+hx9L/1U/W36p/VHDFgGswwkBtsMzhg8xTVxbzwdL8fb8VFDXcNAQ6VhlWGX4YSRudE8o9VGjUYPjGnGXOMk423GbcajJgYmISZLTepN7ppSTbmmKaY7TDtMx83MzaLN1pk1mz0x1zLnm+eb15vft2BaeFostqi2uGVJsuRaplnutrxuhVo5WaVYVVpds0atna0l1rutu6cRp7lOk06rntZnw7Dxtsm2qbcZsOXYBtuutm22fWFnYhdnt8Wuw+6TvZN9un2N/T0HDYfZDqsdWh1+c7RyFDpWOt6azpzuP33F9JbpL2dYzxDP2DPjthPLKcRpnVOb00dnF2e5c4PziIuJS4LLLpc+Lpsbxt3IveRKdPVxXeF60vWdm7Obwu2o26/uNu5p7ofcn8w0nymeWTNz0MPIQ+BR5dE/C5+VMGvfrH5PQ0+BZ7XnIy9jL5FXrdewt6V3qvdh7xc+9j5yn+M+4zw33jLeWV/MN8C3yLfLT8Nvnl+F30N/I/9k/3r/0QCngCUBZwOJgUGBWwL7+Hp8Ib+OPzrbZfay2e1BjKC5QRVBj4KtguXBrSFoyOyQrSH355jOkc5pDoVQfujW0Adh5mGLw34MJ4WHhVeGP45wiFga0TGXNXfR3ENz30T6RJZE3ptnMU85ry1KNSo+qi5qPNo3ujS6P8YuZlnM1VidWElsSxw5LiquNm5svt/87fOH4p3iC+N7F5gvyF1weaHOwvSFpxapLhIsOpZATIhOOJTwQRAqqBaMJfITdyWOCnnCHcJnIi/RNtGI2ENcKh5O8kgqTXqS7JG8NXkkxTOlLOW5hCepkLxMDUzdmzqeFpp2IG0yPTq9MYOSkZBxQqohTZO2Z+pn5mZ2y6xlhbL+xW6Lty8elQfJa7OQrAVZLQq2QqboVFoo1yoHsmdlV2a/zYnKOZarnivN7cyzytuQN5zvn//tEsIS4ZK2pYZLVy0dWOa9rGo5sjxxedsK4xUFK4ZWBqw8uIq2Km3VT6vtV5eufr0mek1rgV7ByoLBtQFr6wtVCuWFfevc1+1dT1gvWd+1YfqGnRs+FYmKrhTbF5cVf9go3HjlG4dvyr+Z3JS0qavEuWTPZtJm6ebeLZ5bDpaql+aXDm4N2dq0Dd9WtO319kXbL5fNKNu7g7ZDuaO/PLi8ZafJzs07P1SkVPRU+lQ27tLdtWHX+G7R7ht7vPY07NXbW7z3/T7JvttVAVVN1WbVZftJ+7P3P66Jqun4lvttXa1ObXHtxwPSA/0HIw6217nU1R3SPVRSj9Yr60cOxx++/p3vdy0NNg1VjZzG4iNwRHnk6fcJ3/ceDTradox7rOEH0x92HWcdL2pCmvKaRptTmvtbYlu6T8w+0dbq3nr8R9sfD5w0PFl5SvNUyWna6YLTk2fyz4ydlZ19fi753GDborZ752PO32oPb++6EHTh0kX/i+c7vDvOXPK4dPKy2+UTV7hXmq86X23qdOo8/pPTT8e7nLuarrlca7nuer21e2b36RueN87d9L158Rb/1tWeOT3dvfN6b/fF9/XfFt1+cif9zsu72Xcn7q28T7xf9EDtQdlD3YfVP1v+3Njv3H9qwHeg89HcR/cGhYPP/pH1jw9DBY+Zj8uGDYbrnjg+OTniP3L96fynQ89kzyaeF/6i/suuFxYvfvjV69fO0ZjRoZfyl5O/bXyl/erA6xmv28bCxh6+yXgzMV70VvvtwXfcdx3vo98PT+R8IH8o/2j5sfVT0Kf7kxmTk/8EA5jz/GMzLdsAAAAgY0hSTQAAeiUAAICDAAD5/wAAgOkAAHUwAADqYAAAOpgAABdvkl/FRgAAAXVJREFUeNq0k9GWhDAIQ3PjzP9/cuehFqhW19mz++IhkCZAq1prsqT+kSQS9g8Vnqp6VGVWkYVktR6tj3Gr968nLnfwlHzHYyHapkKS73bPd/39eI38AYWj24OGvqdwWjZ3l8IDgacXyl1Dj9tdLOzZiicj+P1YcGk0H2O2vN/VQpTveEHmPHQxZxYlqsQdhUeuCWREuDEvAjqlCqDIMYwIo2ijR1HdYUS58dQrKpgQ0EGeMocsTNXrxzyOhS9kfzlWjn82YuWLqwAnvfNEWJFjYXkJCT0s7AmS0NG4x7Lt6Cpy2MiVPBZmS668QT5AR1cevp7b6CpzQ/ZSNH0vmhy5CsNtdax0MBpXDBiFsrDiMSLKMc8b6hH93bNbEpRsIyHDUhNcfTyeKF16PC7c/2QdczvUnvOB1ylZHVFSMtd5s8C2IW/7w6hwM5GLavLCd1zkiFjB+BwH1DSgctQ7mPOimBLJrw35beSXkd8BM/cCqbXWPgMA+GQQ5sIgkfAAAAAASUVORK5CYII=";function vd(e,t=0){const r=e.stride;return e.fieldNames.filter(i=>{const n=e.fields.get(i).optional;return!(n&&n.glPadding)}).map(i=>{const n=e.fields.get(i),s=n.constructor.ElementCount,a=vdt(n.constructor.ElementType),o=n.offset,l=!(!n.optional||!n.optional.glNormalized);return new La(i,s,a,o,r,l,t)})}function vdt(e){const t=_dt[e];if(t)return t;throw new Error("BufferType not supported in WebGL")}const _dt={u8:ft.UNSIGNED_BYTE,u16:ft.UNSIGNED_SHORT,u32:ft.UNSIGNED_INT,i8:ft.BYTE,i16:ft.SHORT,i32:ft.INT,f32:ft.FLOAT};class vse{constructor(t,r,i=0,n,s){this.TypedArrayConstructor=t,this.elementCount=9;const a=this.TypedArrayConstructor;n===void 0&&(n=9*a.BYTES_PER_ELEMENT);const o=r.byteLength===0?0:i;this.typedBuffer=s==null?new a(r,o):new a(r,o,(s-i)/a.BYTES_PER_ELEMENT),this.typedBufferStride=n/a.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(t,r,i=this.count-r){const n=this.typedBuffer.byteOffset+r*this.stride;return new t(this.buffer,n,this.stride,n+i*this.stride)}getMat(t,r){let i=t*this.typedBufferStride;for(let n=0;n<9;n++)r[n]=this.typedBuffer[i++];return r}setMat(t,r){let i=t*this.typedBufferStride;for(let n=0;n<9;n++)this.typedBuffer[i++]=r[n]}get(t,r){return this.typedBuffer[t*this.typedBufferStride+r]}set(t,r,i){this.typedBuffer[t*this.typedBufferStride+r]=i}copyFrom(t,r,i){const n=this.typedBuffer,s=r.typedBuffer;let a=t*this.typedBufferStride,o=i*r.typedBufferStride;for(let l=0;l<9;++l)n[a++]=s[o++]}get buffer(){return this.typedBuffer.buffer}}vse.ElementCount=9;class _se{constructor(t,r,i=0,n,s){this.TypedArrayConstructor=t,this.elementCount=16;const a=this.TypedArrayConstructor;n===void 0&&(n=16*a.BYTES_PER_ELEMENT);const o=r.byteLength===0?0:i;this.typedBuffer=s==null?new a(r,o):new a(r,o,(s-i)/a.BYTES_PER_ELEMENT),this.typedBufferStride=n/a.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(t,r,i=this.count-r){const n=this.typedBuffer.byteOffset+r*this.stride;return new t(this.buffer,n,this.stride,n+i*this.stride)}getMat(t,r){let i=t*this.typedBufferStride;for(let n=0;n<16;n++)r[n]=this.typedBuffer[i++];return r}setMat(t,r){let i=t*this.typedBufferStride;for(let n=0;n<16;n++)this.typedBuffer[i++]=r[n]}get(t,r){return this.typedBuffer[t*this.typedBufferStride+r]}set(t,r,i){this.typedBuffer[t*this.typedBufferStride+r]=i}copyFrom(t,r,i){const n=this.typedBuffer,s=r.typedBuffer;let a=t*this.typedBufferStride,o=i*r.typedBufferStride;for(let l=0;l<16;++l)n[a++]=s[o++]}get buffer(){return this.typedBuffer.buffer}}_se.ElementCount=16;class Yy{constructor(t,r,i=0,n,s){this.TypedArrayConstructor=t,this.elementCount=1;const a=this.TypedArrayConstructor;n===void 0&&(n=a.BYTES_PER_ELEMENT);const o=r.byteLength===0?0:i;this.typedBuffer=s==null?new a(r,o):new a(r,o,(s-i)/a.BYTES_PER_ELEMENT),this.typedBufferStride=n/a.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(t,r,i=this.count-r){const n=this.typedBuffer.byteOffset+r*this.stride;return new t(this.buffer,n,this.stride,n+i*this.stride)}get(t){return this.typedBuffer[t*this.typedBufferStride]}set(t,r){this.typedBuffer[t*this.typedBufferStride]=r}get buffer(){return this.typedBuffer.buffer}}Yy.ElementCount=1;class Zy{constructor(t,r,i=0,n,s){this.TypedArrayConstructor=t,this.elementCount=2;const a=this.TypedArrayConstructor;n===void 0&&(n=2*a.BYTES_PER_ELEMENT);const o=r.byteLength===0?0:i;this.typedBuffer=s==null?new a(r,o):new a(r,o,(s-i)/a.BYTES_PER_ELEMENT),this.typedBufferStride=n/a.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(t,r,i=this.count-r){const n=this.typedBuffer.byteOffset+r*this.stride;return new t(this.buffer,n,this.stride,n+i*this.stride)}getVec(t,r){return t*=this.typedBufferStride,vr(r,this.typedBuffer[t],this.typedBuffer[t+1])}setVec(t,r){t*=this.typedBufferStride,this.typedBuffer[t++]=r[0],this.typedBuffer[t]=r[1]}get(t,r){return this.typedBuffer[t*this.typedBufferStride+r]}set(t,r,i){this.typedBuffer[t*this.typedBufferStride+r]=i}setValues(t,r,i){t*=this.typedBufferStride,this.typedBuffer[t++]=r,this.typedBuffer[t]=i}copyFrom(t,r,i){const n=this.typedBuffer,s=r.typedBuffer;let a=t*this.typedBufferStride,o=i*r.typedBufferStride;n[a++]=s[o++],n[a]=s[o]}get buffer(){return this.typedBuffer.buffer}}Zy.ElementCount=2;class Qy{constructor(t,r,i=0,n,s){this.TypedArrayConstructor=t,this.elementCount=3;const a=this.TypedArrayConstructor;n===void 0&&(n=3*a.BYTES_PER_ELEMENT);const o=r.byteLength===0?0:i;this.typedBuffer=s==null?new a(r,o):new a(r,o,(s-i)/a.BYTES_PER_ELEMENT),this.typedBufferStride=n/a.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(t,r,i=this.count-r){const n=this.typedBuffer.byteOffset+r*this.stride;return new t(this.buffer,n,this.stride,n+i*this.stride)}getVec(t,r){return t*=this.typedBufferStride,ne(r,this.typedBuffer[t],this.typedBuffer[t+1],this.typedBuffer[t+2])}setVec(t,r){t*=this.typedBufferStride,this.typedBuffer[t++]=r[0],this.typedBuffer[t++]=r[1],this.typedBuffer[t]=r[2]}get(t,r){return this.typedBuffer[t*this.typedBufferStride+r]}set(t,r,i){this.typedBuffer[t*this.typedBufferStride+r]=i}setValues(t,r,i,n){t*=this.typedBufferStride,this.typedBuffer[t++]=r,this.typedBuffer[t++]=i,this.typedBuffer[t]=n}copyFrom(t,r,i){const n=this.typedBuffer,s=r.typedBuffer;let a=t*this.typedBufferStride,o=i*r.typedBufferStride;n[a++]=s[o++],n[a++]=s[o++],n[a]=s[o]}get buffer(){return this.typedBuffer.buffer}}Qy.ElementCount=3;class Jy{constructor(t,r,i=0,n,s){this.TypedArrayConstructor=t,this.elementCount=4;const a=this.TypedArrayConstructor;n===void 0&&(n=4*a.BYTES_PER_ELEMENT);const o=r.byteLength===0?0:i;this.typedBuffer=s==null?new a(r,o):new a(r,o,(s-i)/a.BYTES_PER_ELEMENT),this.typedBufferStride=n/a.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(t,r,i=this.count-r){const n=this.typedBuffer.byteOffset+r*this.stride;return new t(this.buffer,n,this.stride,n+i*this.stride)}getVec(t,r){return t*=this.typedBufferStride,ei(r,this.typedBuffer[t++],this.typedBuffer[t++],this.typedBuffer[t++],this.typedBuffer[t])}setVec(t,r){t*=this.typedBufferStride,this.typedBuffer[t++]=r[0],this.typedBuffer[t++]=r[1],this.typedBuffer[t++]=r[2],this.typedBuffer[t]=r[3]}get(t,r){return this.typedBuffer[t*this.typedBufferStride+r]}set(t,r,i){this.typedBuffer[t*this.typedBufferStride+r]=i}setValues(t,r,i,n,s){t*=this.typedBufferStride,this.typedBuffer[t++]=r,this.typedBuffer[t++]=i,this.typedBuffer[t++]=n,this.typedBuffer[t]=s}copyFrom(t,r,i){const n=this.typedBuffer,s=r.typedBuffer;let a=t*this.typedBufferStride,o=i*r.typedBufferStride;n[a++]=s[o++],n[a++]=s[o++],n[a++]=s[o++],n[a]=s[o]}get buffer(){return this.typedBuffer.buffer}}Jy.ElementCount=4;class _O extends Yy{constructor(t,r=0,i,n){super(Float32Array,t,r,i,n),this.elementType="f32"}static fromTypedArray(t,r){return new _O(t.buffer,t.byteOffset,r,t.byteOffset+t.byteLength)}}_O.ElementType="f32";class ef extends Zy{constructor(t,r=0,i,n){super(Float32Array,t,r,i,n),this.elementType="f32"}slice(t,r){return this.sliceBuffer(ef,t,r)}static fromTypedArray(t,r){return new ef(t.buffer,t.byteOffset,r,t.byteOffset+t.byteLength)}}ef.ElementType="f32";class Zr extends Qy{constructor(t,r=0,i,n){super(Float32Array,t,r,i,n),this.elementType="f32"}slice(t,r){return this.sliceBuffer(Zr,t,r)}static fromTypedArray(t,r){return new Zr(t.buffer,t.byteOffset,r,t.byteOffset+t.byteLength)}}Zr.ElementType="f32";class ca extends Jy{constructor(t,r=0,i,n){super(Float32Array,t,r,i,n),this.elementType="f32"}slice(t,r){return this.sliceBuffer(ca,t,r)}static fromTypedArray(t,r){return new ca(t.buffer,t.byteOffset,r,t.byteOffset+t.byteLength)}}ca.ElementType="f32";class Fp extends vse{constructor(t,r=0,i,n){super(Float32Array,t,r,i,n),this.elementType="f32"}slice(t,r){return this.sliceBuffer(Fp,t,r)}static fromTypedArray(t,r){return new Fp(t.buffer,t.byteOffset,r,t.byteOffset+t.byteLength)}}Fp.ElementType="f32";class Kv extends vse{constructor(t,r=0,i,n){super(Float64Array,t,r,i,n),this.elementType="f64"}slice(t,r){return this.sliceBuffer(Kv,t,r)}static fromTypedArray(t,r){return new Kv(t.buffer,t.byteOffset,r,t.byteOffset+t.byteLength)}}Kv.ElementType="f64";class b9 extends _se{constructor(t,r=0,i,n){super(Float32Array,t,r,i,n),this.elementType="f32"}slice(t,r){return this.sliceBuffer(b9,t,r)}static fromTypedArray(t,r){return new b9(t.buffer,t.byteOffset,r,t.byteOffset+t.byteLength)}}b9.ElementType="f32";class e_ extends _se{constructor(t,r=0,i,n){super(Float64Array,t,r,i,n),this.elementType="f64"}slice(t,r){return this.sliceBuffer(e_,t,r)}static fromTypedArray(t,r){return new e_(t.buffer,t.byteOffset,r,t.byteOffset+t.byteLength)}}e_.ElementType="f64";class v9 extends Yy{constructor(t,r=0,i,n){super(Float64Array,t,r,i,n),this.elementType="f64"}slice(t,r){return this.sliceBuffer(v9,t,r)}static fromTypedArray(t,r){return new v9(t.buffer,t.byteOffset,r,t.byteOffset+t.byteLength)}}v9.ElementType="f64";class _9 extends Zy{constructor(t,r=0,i,n){super(Float64Array,t,r,i,n),this.elementType="f64"}slice(t,r){return this.sliceBuffer(_9,t,r)}static fromTypedArray(t,r){return new _9(t.buffer,t.byteOffset,r,t.byteOffset+t.byteLength)}}_9.ElementType="f64";class Nn extends Qy{constructor(t,r=0,i,n){super(Float64Array,t,r,i,n),this.elementType="f64"}slice(t,r){return this.sliceBuffer(Nn,t,r)}static fromTypedArray(t,r){return new Nn(t.buffer,t.byteOffset,r,t.byteOffset+t.byteLength)}}Nn.ElementType="f64";class Yw extends Jy{constructor(t,r=0,i,n){super(Float64Array,t,r,i,n),this.elementType="f64"}slice(t,r){return this.sliceBuffer(Yw,t,r)}static fromTypedArray(t,r){return new Yw(t.buffer,t.byteOffset,r,t.byteOffset+t.byteLength)}}Yw.ElementType="f64";class ky extends Yy{constructor(t,r=0,i,n){super(Uint8Array,t,r,i,n),this.elementType="u8"}slice(t,r){return this.sliceBuffer(ky,t,r)}static fromTypedArray(t,r){return new ky(t.buffer,t.byteOffset,r,t.byteOffset+t.byteLength)}}ky.ElementType="u8";class Zw extends Zy{constructor(t,r=0,i,n){super(Uint8Array,t,r,i,n),this.elementType="u8"}slice(t,r){return this.sliceBuffer(Zw,t,r)}static fromTypedArray(t,r){return new Zw(t.buffer,t.byteOffset,r,t.byteOffset+t.byteLength)}}Zw.ElementType="u8";class t_ extends Qy{constructor(t,r=0,i,n){super(Uint8Array,t,r,i,n),this.elementType="u8"}slice(t,r){return this.sliceBuffer(t_,t,r)}static fromTypedArray(t,r){return new t_(t.buffer,t.byteOffset,r,t.byteOffset+t.byteLength)}}t_.ElementType="u8";class pc extends Jy{constructor(t,r=0,i,n){super(Uint8Array,t,r,i,n),this.elementType="u8"}slice(t,r){return this.sliceBuffer(pc,t,r)}static fromTypedArray(t,r){return new pc(t.buffer,t.byteOffset,r,t.byteOffset+t.byteLength)}}pc.ElementType="u8";class Qw extends Yy{constructor(t,r=0,i,n){super(Uint16Array,t,r,i,n),this.elementType="u16"}slice(t,r){return this.sliceBuffer(Qw,t,r)}static fromTypedArray(t,r){return new Qw(t.buffer,t.byteOffset,r,t.byteOffset+t.byteLength)}}Qw.ElementType="u16";class w9 extends Zy{constructor(t,r=0,i,n){super(Uint16Array,t,r,i,n),this.elementType="u16"}slice(t,r){return this.sliceBuffer(w9,t,r)}static fromTypedArray(t,r){return new w9(t.buffer,t.byteOffset,r,t.byteOffset+t.byteLength)}}w9.ElementType="u16";class Jw extends Qy{constructor(t,r=0,i,n){super(Uint16Array,t,r,i,n),this.elementType="u16"}slice(t,r){return this.sliceBuffer(Jw,t,r)}static fromTypedArray(t,r){return new Jw(t.buffer,t.byteOffset,r,t.byteOffset+t.byteLength)}}Jw.ElementType="u16";class r_ extends Jy{constructor(t,r=0,i,n){super(Uint16Array,t,r,i,n),this.elementType="u16"}slice(t,r){return this.sliceBuffer(r_,t,r)}static fromTypedArray(t,r){return new r_(t.buffer,t.byteOffset,r,t.byteOffset+t.byteLength)}}r_.ElementType="u16";class Kw extends Yy{constructor(t,r=0,i,n){super(Uint32Array,t,r,i,n),this.elementType="u32"}slice(t,r){return this.sliceBuffer(Kw,t,r)}static fromTypedArray(t,r){return new Kw(t.buffer,t.byteOffset,r,t.byteOffset+t.byteLength)}}Kw.ElementType="u32";class x9 extends Zy{constructor(t,r=0,i,n){super(Uint32Array,t,r,i,n),this.elementType="u32"}slice(t,r){return this.sliceBuffer(x9,t,r)}static fromTypedArray(t,r){return new x9(t.buffer,t.byteOffset,r,t.byteOffset+t.byteLength)}}x9.ElementType="u32";class GA extends Qy{constructor(t,r=0,i,n){super(Uint32Array,t,r,i,n),this.elementType="u32"}slice(t,r){return this.sliceBuffer(GA,t,r)}static fromTypedArray(t,r){return new GA(t.buffer,t.byteOffset,r,t.byteOffset+t.byteLength)}}GA.ElementType="u32";class jA extends Jy{constructor(t,r=0,i,n){super(Uint32Array,t,r,i,n),this.elementType="u32"}slice(t,r){return this.sliceBuffer(jA,t,r)}static fromTypedArray(t,r){return new jA(t.buffer,t.byteOffset,r,t.byteOffset+t.byteLength)}}jA.ElementType="u32";class T9 extends Yy{constructor(t,r=0,i,n){super(Int8Array,t,r,i,n),this.elementType="i8"}slice(t,r){return this.sliceBuffer(T9,t,r)}static fromTypedArray(t,r){return new T9(t.buffer,t.byteOffset,r,t.byteOffset+t.byteLength)}}T9.ElementType="i8";class ex extends Zy{constructor(t,r=0,i,n){super(Int8Array,t,r,i,n),this.elementType="i8"}slice(t,r){return this.sliceBuffer(ex,t,r)}static fromTypedArray(t,r){return new ex(t.buffer,t.byteOffset,r,t.byteOffset+t.byteLength)}}ex.ElementType="i8";class qA extends Qy{constructor(t,r=0,i,n){super(Int8Array,t,r,i,n),this.elementType="i8"}slice(t,r){return this.sliceBuffer(qA,t,r)}static fromTypedArray(t,r){return new qA(t.buffer,t.byteOffset,r,t.byteOffset+t.byteLength)}}qA.ElementType="i8";class HA extends Jy{constructor(t,r=0,i,n){super(Int8Array,t,r,i,n),this.elementType="i8"}slice(t,r){return this.sliceBuffer(HA,t,r)}static fromTypedArray(t,r){return new HA(t.buffer,t.byteOffset,r,t.byteOffset+t.byteLength)}}HA.ElementType="i8";class WA extends Yy{constructor(t,r=0,i,n){super(Int16Array,t,r,i,n),this.elementType="i16"}slice(t,r){return this.sliceBuffer(WA,t,r)}static fromTypedArray(t,r){return new WA(t.buffer,t.byteOffset,r,t.byteOffset+t.byteLength)}}WA.ElementType="i16";class tx extends Zy{constructor(t,r=0,i,n){super(Int16Array,t,r,i,n),this.elementType="i16"}slice(t,r){return this.sliceBuffer(tx,t,r)}static fromTypedArray(t,r){return new tx(t.buffer,t.byteOffset,r,t.byteOffset+t.byteLength)}}tx.ElementType="i16";class XA extends Qy{constructor(t,r=0,i,n){super(Int16Array,t,r,i,n),this.elementType="i16"}slice(t,r){return this.sliceBuffer(XA,t,r)}static fromTypedArray(t,r){return new XA(t.buffer,t.byteOffset,r,t.byteOffset+t.byteLength)}}XA.ElementType="i16";class YA extends Jy{constructor(t,r=0,i,n){super(Int16Array,t,r,i,n),this.elementType="i16"}slice(t,r){return this.sliceBuffer(YA,t,r)}static fromTypedArray(t,r){return new YA(t.buffer,t.byteOffset,r,t.byteOffset+t.byteLength)}}YA.ElementType="i16";class ZA extends Yy{constructor(t,r=0,i,n){super(Int32Array,t,r,i,n),this.elementType="i32"}slice(t,r){return this.sliceBuffer(ZA,t,r)}static fromTypedArray(t,r){return new ZA(t.buffer,t.byteOffset,r,t.byteOffset+t.byteLength)}}ZA.ElementType="i32";class QA extends Zy{constructor(t,r=0,i,n){super(Int32Array,t,r,i,n),this.elementType="i32"}slice(t,r){return this.sliceBuffer(QA,t,r)}static fromTypedArray(t,r){return new QA(t.buffer,t.byteOffset,r,t.byteOffset+t.byteLength)}}QA.ElementType="i32";class JA extends Qy{constructor(t,r=0,i,n){super(Int32Array,t,r,i,n),this.elementType="i32"}slice(t,r){return this.sliceBuffer(JA,t,r)}static fromTypedArray(t,r){return new JA(t.buffer,t.byteOffset,r,t.byteOffset+t.byteLength)}}JA.ElementType="i32";class KA extends Jy{constructor(t,r=0,i,n){super(Int32Array,t,r,i,n),this.elementType="i32"}slice(t,r){return this.sliceBuffer(KA,t,r)}static fromTypedArray(t,r){return new KA(t.buffer,t.byteOffset,r,t.byteOffset+t.byteLength)}}KA.ElementType="i32";function yCe(e){switch(e){case"u8":case"i8":return 1;case"u16":case"i16":return 2;case"u32":case"i32":case"f32":return 4;case"f64":return 8;default:return}}function wdt(e){switch(e){case"u8":case"u16":case"u32":return!1;case"i8":case"i16":case"i32":case"f32":case"f64":return!0;default:return}}function xdt(e){switch(e){case"u8":case"u16":case"u32":case"i8":case"i16":case"i32":return!0;case"f32":case"f64":return!1;default:return}}function Tdt(e){switch(e){case"u8":return 255;case"u16":return 65535;case"u32":return 4294967295;case"i8":return 127;case"i16":return 32767;case"i32":return 2147483647;case"f32":return 3402823e32;case"f64":return 179769e303;default:return}}class BN{constructor(t,r){this.layout=t,this.buffer=typeof r=="number"?new ArrayBuffer(r*t.stride):r;for(const i of t.fieldNames){const n=t.fields.get(i);this[i]=new n.constructor(this.buffer,n.offset,this.stride)}}get stride(){return this.layout.stride}get count(){return this.buffer.byteLength/this.stride}get byteLength(){return this.buffer.byteLength}getField(t,r){const i=this[t];return i&&i.elementCount===r.ElementCount&&i.elementType===r.ElementType?i:null}slice(t,r){return new BN(this.layout,this.buffer.slice(t*this.stride,r*this.stride))}copyFrom(t,r,i,n){const s=this.stride;if(s%4==0){const a=new Uint32Array(t.buffer,r*s,n*s/4);new Uint32Array(this.buffer,i*s,n*s/4).set(a)}else{const a=new Uint8Array(t.buffer,r*s,n*s);new Uint8Array(this.buffer,i*s,n*s).set(a)}}}class wse{constructor(){this.stride=0,this.fields=new Map,this.fieldNames=[]}vec2f(t,r){return this._appendField(t,ef,r),this}vec2f64(t,r){return this._appendField(t,_9,r),this}vec3f(t,r){return this._appendField(t,Zr,r),this}vec3f64(t,r){return this._appendField(t,Nn,r),this}vec4f(t,r){return this._appendField(t,ca,r),this}vec4f64(t,r){return this._appendField(t,Yw,r),this}mat3f(t,r){return this._appendField(t,Fp,r),this}mat3f64(t,r){return this._appendField(t,Kv,r),this}mat4f(t,r){return this._appendField(t,b9,r),this}mat4f64(t,r){return this._appendField(t,e_,r),this}vec4u8(t,r){return this._appendField(t,pc,r),this}f32(t,r){return this._appendField(t,_O,r),this}f64(t,r){return this._appendField(t,v9,r),this}u8(t,r){return this._appendField(t,ky,r),this}u16(t,r){return this._appendField(t,Qw,r),this}i8(t,r){return this._appendField(t,T9,r),this}vec2i8(t,r){return this._appendField(t,ex,r),this}vec2i16(t,r){return this._appendField(t,tx,r),this}vec2u8(t,r){return this._appendField(t,Zw,r),this}vec4u16(t,r){return this._appendField(t,r_,r),this}u32(t,r){return this._appendField(t,Kw,r),this}_appendField(t,r,i){const n=r.ElementCount*yCe(r.ElementType),s=this.stride;this.fields.set(t,{size:n,constructor:r,offset:s,optional:i}),this.stride+=n,this.fieldNames.push(t)}alignTo(t){return this.stride=Math.floor((this.stride+t-1)/t)*t,this}hasField(t){return this.fieldNames.includes(t)}createBuffer(t){return new BN(this,t)}createView(t){return new BN(this,t)}clone(){const t=new wse;return t.stride=this.stride,t.fields=new Map,this.fields.forEach((r,i)=>t.fields.set(i,r)),t.fieldNames=this.fieldNames.slice(),t.BufferType=this.BufferType,t}}function gn(){return new wse}var FJ;(function(e){function t(a,o){const l=a[o],c=a[o+1],u=a[o+2];return Math.sqrt(l*l+c*c+u*u)}function r(a,o){const l=a[o],c=a[o+1],u=a[o+2],h=1/Math.sqrt(l*l+c*c+u*u);a[o]*=h,a[o+1]*=h,a[o+2]*=h}function i(a,o,l){a[o]*=l,a[o+1]*=l,a[o+2]*=l}function n(a,o,l,c,u,h=o){(u=u||a)[h]=a[o]+l[c],u[h+1]=a[o+1]+l[c+1],u[h+2]=a[o+2]+l[c+2]}function s(a,o,l,c,u,h=o){(u=u||a)[h]=a[o]-l[c],u[h+1]=a[o+1]-l[c+1],u[h+2]=a[o+2]-l[c+2]}e.length=t,e.normalize=r,e.scale=i,e.add=n,e.subtract=s})(FJ||(FJ={}));const Go=Jt();class Sdt{constructor(t){this.message=t}toString(){return`AssertException: ${this.message}`}}function pt(e,t){if(!e)throw t=t||"assert",console.log(new Error(t).stack),new Sdt(t)}function Yx(e,t){e||(t=t||"",console.warn("Verify failed: "+t+`
`+new Error("verify").stack))}function Ape(e,t,r,i){let n,s=(r[0]-e[0])/t[0],a=(i[0]-e[0])/t[0];s>a&&(n=s,s=a,a=n);let o=(r[1]-e[1])/t[1],l=(i[1]-e[1])/t[1];if(o>l&&(n=o,o=l,l=n),s>l||o>a)return!1;o>s&&(s=o),l<a&&(a=l);let c=(r[2]-e[2])/t[2],u=(i[2]-e[2])/t[2];return c>u&&(n=c,c=u,u=n),!(s>u||c>a)&&(u<a&&(a=u),!(a<0))}function SP(e,t,r,i,n,s=it()){const a=(i[n]-r[n])*(t[0]-e[0])-(i[0]-r[0])*(t[n]-e[n]),o=(i[0]-r[0])*(e[n]-r[n])-(i[n]-r[n])*(e[0]-r[0]);if(a===0)return!1;const l=o/a;return s[0]=e[0]+l*(t[0]-e[0]),s[1]=e[n]+l*(t[n]-e[n]),!0}function Rpe(e,t,r,i,n){n||(n=e),Go[0]=e[0],Go[1]=e[1],Go[2]=e[2],Go[3]=1,du(Go,Go,t),n.length>2&&(n[2]=-Go[2]),du(Go,Go,r),pt(Go[3]!==0),n[0]=Go[0]/Go[3],n[1]=Go[1]/Go[3],n[2]=Go[2]/Go[3],n[0]=(.5*n[0]+.5)*i[2]+i[0],n[1]=(.5*n[1]+.5)*i[3]+i[1]}function Edt(e,t){return Math.log(e)/Math.log(t)}function bCe(e,t,r,i){e[12]=t,e[13]=r,e[14]=i}function vCe(e){return e[0]===1&&e[1]===0&&e[2]===0&&e[3]===0&&e[4]===0&&e[5]===1&&e[6]===0&&e[7]===0&&e[8]===0&&e[9]===0&&e[10]===1&&e[11]===0&&e[15]===1}function Cdt(e,t,r){return 2*Math.atan(Math.sqrt(t*t+r*r)*Math.tan(.5*e)/t)}function Adt(e,t,r){return 2*Math.atan(Math.sqrt(t*t+r*r)*Math.tan(.5*e)/r)}function Rdt(e,t,r){return 2*Math.atan(t*Math.tan(.5*e)/Math.sqrt(t*t+r*r))}function Odt(e,t,r){return 2*Math.atan(r*Math.tan(.5*e)/Math.sqrt(t*t+r*r))}class Nz{constructor(t,r,i,n){this.primitiveIndices=t,this._numIndexPerPrimitive=r,this.indices=i,this.position=n,this.center=M(),pt(t.length>=1),pt(i.length%this._numIndexPerPrimitive==0),pt(i.length>=t.length*this._numIndexPerPrimitive),pt(n.size===3||n.size===4);const{data:s,size:a}=n,o=t.length;let l=a*i[this._numIndexPerPrimitive*t[0]];F_.clear(),F_.push(l),this.bbMin=Ve(s[l],s[l+1],s[l+2]),this.bbMax=Kn(this.bbMin);for(let u=0;u<o;++u){const h=this._numIndexPerPrimitive*t[u];for(let p=0;p<this._numIndexPerPrimitive;++p){l=a*i[h+p],F_.push(l);let m=s[l];this.bbMin[0]=Math.min(m,this.bbMin[0]),this.bbMax[0]=Math.max(m,this.bbMax[0]),m=s[l+1],this.bbMin[1]=Math.min(m,this.bbMin[1]),this.bbMax[1]=Math.max(m,this.bbMax[1]),m=s[l+2],this.bbMin[2]=Math.min(m,this.bbMin[2]),this.bbMax[2]=Math.max(m,this.bbMax[2])}}As(this.center,this.bbMin,this.bbMax,.5),this.radius=.5*Math.max(Math.max(this.bbMax[0]-this.bbMin[0],this.bbMax[1]-this.bbMin[1]),this.bbMax[2]-this.bbMin[2]);let c=this.radius*this.radius;for(let u=0;u<F_.length;++u){l=F_.getItemAt(u);const h=s[l]-this.center[0],p=s[l+1]-this.center[1],m=s[l+2]-this.center[2],g=h*h+p*p+m*m;if(g<=c)continue;const b=Math.sqrt(g),w=.5*(b-this.radius);this.radius=this.radius+w,c=this.radius*this.radius;const v=w/b;this.center[0]+=h*v,this.center[1]+=p*v,this.center[2]+=m*v}F_.clear()}getCenter(){return this.center}getBSRadius(){return this.radius}getBBMin(){return this.bbMin}getBBMax(){return this.bbMax}getChildren(){if(this._children)return this._children;if(Vs(this.bbMin,this.bbMax)>1){const t=As(M(),this.bbMin,this.bbMax,.5),r=this.primitiveIndices.length,i=new Uint8Array(r),n=new Array(8);for(let c=0;c<8;++c)n[c]=0;const{data:s,size:a}=this.position;for(let c=0;c<r;++c){let u=0;const h=this._numIndexPerPrimitive*this.primitiveIndices[c];let p=a*this.indices[h],m=s[p],g=s[p+1],b=s[p+2];for(let w=1;w<this._numIndexPerPrimitive;++w){p=a*this.indices[h+w];const v=s[p],x=s[p+1],T=s[p+2];v<m&&(m=v),x<g&&(g=x),T<b&&(b=T)}m<t[0]&&(u|=1),g<t[1]&&(u|=2),b<t[2]&&(u|=4),i[c]=u,++n[u]}let o=0;for(let c=0;c<8;++c)n[c]>0&&++o;if(o<2)return;const l=new Array(8);for(let c=0;c<8;++c)l[c]=n[c]>0?new Uint32Array(n[c]):void 0;for(let c=0;c<8;++c)n[c]=0;for(let c=0;c<r;++c){const u=i[c];l[u][n[u]++]=this.primitiveIndices[c]}this._children=new Array(8);for(let c=0;c<8;++c)l[c]!==void 0&&(this._children[c]=new Nz(l[c],this._numIndexPerPrimitive,this.indices,this.position))}return this._children}static prune(){F_.prune()}}const F_=new Qt({deallocator:null});class wO{constructor(){this.id=ic()}unload(){}}var Np;(function(e){e[e.Layer=0]="Layer",e[e.Object=1]="Object",e[e.Geometry=2]="Geometry",e[e.Material=3]="Material",e[e.Texture=4]="Texture",e[e.COUNT=5]="COUNT"})(Np||(Np={}));function Ope(e,t,r){const i=t[0]-e[0],n=t[1]-e[1],s=r[0]-e[0],a=r[1]-e[1];return .5*Math.abs(i*a-n*s)}function Mdt(e,t,r){return pe(Cj,t,e),pe(Mpe,r,e),Oe(dt(Cj,Cj,Mpe))/2}new jy(Om);new jy(()=>({p0:null,p1:null,p2:null}));const Cj=M(),Mpe=M();let N1=(()=>{const e=new Uint32Array(131072);for(let t=0;t<e.length;++t)e[t]=t;return e})();const _Ce=new Uint16Array([0]),GN=(()=>{const e=new Uint16Array(65536);for(let t=0;t<e.length;++t)e[t]=t;return e})();function S9(e){if(e===1)return _Ce;if(e<GN.length)return new Uint16Array(GN.buffer,0,e);if(e>N1.length){const t=Math.max(2*N1.length,e);N1=new Uint32Array(t);for(let r=0;r<N1.length;r++)N1[r]=r}return new Uint32Array(N1.buffer,0,e)}function vLt(e){if(e===1)return new Uint16Array(_Ce);if(e<GN.length)return new Uint16Array(GN.slice(0,e));if(e>N1.length){const t=new Uint32Array(e);for(let r=0;r<t.length;r++)t[r]=r;return t}return new Uint32Array(N1.slice(0,e))}function wCe(e,t,r){if(!e)return!1;const{size:i,data:n}=e;ne(r,0,0,0),ne(yh,0,0,0);let s=0,a=0;for(let o=0;o<t.length-2;o+=3){const l=t[o+0]*i,c=t[o+1]*i,u=t[o+2]*i;ne(ta,n[l+0],n[l+1],n[l+2]),ne(Wg,n[c+0],n[c+1],n[c+2]),ne(EP,n[u+0],n[u+1],n[u+2]);const h=Mdt(ta,Wg,EP);h?(he(ta,ta,Wg),he(ta,ta,EP),le(ta,ta,1/3*h),he(r,r,ta),s+=h):(he(yh,yh,ta),he(yh,yh,Wg),he(yh,yh,EP),a+=3)}return(a!==0||s!==0)&&(s!==0?(le(r,r,1/s),!0):a!==0&&(le(r,yh,1/a),!0))}function xCe(e,t,r){if(!e||!t)return!1;const{size:i,data:n}=e;ne(r,0,0,0);let s=-1,a=0;for(let o=0;o<t.length;o++){const l=t[o]*i;s!==l&&(r[0]+=n[l+0],r[1]+=n[l+1],r[2]+=n[l+2],a++),s=l}return a>1&&le(r,r,1/a),a>0}function xse(e,t,r,i){if(!e)return!1;const{size:n,data:s}=e;ne(i,0,0,0),ne(yh,0,0,0);let a=0,o=0;const l=t?t.length-1:s.length/n-1,c=l+(r?2:0);for(let u=0;u<c;u+=2){const h=u<l?u:l,p=u<l?u+1:0,m=(t?t[h]:h)*n,g=(t?t[p]:p)*n;ta[0]=s[m+0],ta[1]=s[m+1],ta[2]=s[m+2],Wg[0]=s[g+0],Wg[1]=s[g+1],Wg[2]=s[g+2],le(ta,he(ta,ta,Wg),.5);const b=sre(ta,Wg);b>0?(he(i,i,le(ta,ta,b)),a+=b):(he(yh,yh,ta),o++)}return a!==0?(le(i,i,1/a),!0):o!==0&&(le(i,yh,1/o),!0)}const ta=M(),Wg=M(),EP=M(),yh=M();class Gi extends wO{constructor(t,r=[],i=lc.Triangle,n=-1){super(),this._primitiveType=i,this.edgeIndicesLength=n,this.type=Np.Geometry,this._vertexAttributes=new Map,this._indices=new Map,this._boundingInfo=null;for(const[s,a]of t)a&&this._vertexAttributes.set(s,{...a});if(r==null||r.length===0){const s=Pdt(this._vertexAttributes),a=S9(s);this.edgeIndicesLength=this.edgeIndicesLength<0?s:this.edgeIndicesLength;for(const o of this._vertexAttributes.keys())this._indices.set(o,a)}else for(const[s,a]of r)a&&(this._indices.set(s,Idt(a)),s===O.POSITION&&(this.edgeIndicesLength=this.edgeIndicesLength<0?this._indices.get(s).length:this.edgeIndicesLength))}cloneShallow(){const t=new Gi([],void 0,this._primitiveType,void 0),{_vertexAttributes:r,_indices:i}=t;return this._vertexAttributes.forEach((n,s)=>{r.set(s,n)}),this._indices.forEach((n,s)=>{i.set(s,n)}),t.screenToWorldRatio=this.screenToWorldRatio,t._boundingInfo=this._boundingInfo,t}get vertexAttributes(){return this._vertexAttributes}getMutableAttribute(t){const r=this._vertexAttributes.get(t);return r&&!r.exclusive&&(r.data=Array.from(r.data),r.exclusive=!0),r}get indices(){return this._indices}get indexCount(){const t=this._indices.values().next().value;return t?t.length:0}get primitiveType(){return this._primitiveType}get faceCount(){return this.indexCount/3}get boundingInfo(){return R(this._boundingInfo)&&(this._boundingInfo=this._calculateBoundingInfo()),this._boundingInfo}computeAttachmentOrigin(t){return this.primitiveType===lc.Triangle?this._computeAttachmentOriginTriangles(t):this._computeAttachmentOriginPoints(t)}_computeAttachmentOriginTriangles(t){const r=this.indices.get(O.POSITION),i=this.vertexAttributes.get(O.POSITION);return wCe(i,r,t)}_computeAttachmentOriginPoints(t){const r=this.indices.get(O.POSITION),i=this.vertexAttributes.get(O.POSITION);return xCe(i,r,t)}invalidateBoundingInfo(){this._boundingInfo=null}_calculateBoundingInfo(){const t=this.indices.get(O.POSITION);if(t.length===0)return null;const r=this.primitiveType===lc.Triangle?3:1;pt(t.length%r==0,"Indexing error: "+t.length+" not divisible by "+r);const i=S9(t.length/r),n=this.vertexAttributes.get(O.POSITION);return new Nz(i,r,t,n)}}function Pdt(e){const t=e.values().next().value;return t==null?0:t.data.length/t.size}function Idt(e){if(e.BYTES_PER_ELEMENT===Uint16Array.BYTES_PER_ELEMENT)return e;for(const t of e)if(t>=65536)return e;return new Uint16Array(e)}const Zx=FJ;var Aj,Rj,Oj,NJ;(function(e){const r=[[-.5,-.5,.5],[.5,-.5,.5],[.5,.5,.5],[-.5,.5,.5],[-.5,-.5,-.5],[.5,-.5,-.5],[.5,.5,-.5],[-.5,.5,-.5]],i=[0,0,1,-1,0,0,1,0,0,0,-1,0,0,1,0,0,0,-1],n=[0,0,1,0,1,1,0,1],s=new Uint16Array([0,1,2,2,3,0,4,0,3,3,7,4,1,5,6,6,2,1,1,0,4,4,5,1,3,2,6,6,7,3,5,4,7,7,6,5]),a=new Uint16Array(36);for(let c=0;c<6;c++)for(let u=0;u<6;u++)a[6*c+u]=c;const o=new Uint16Array(36);for(let c=0;c<6;c++)o[6*c+0]=0,o[6*c+1]=1,o[6*c+2]=2,o[6*c+3]=2,o[6*c+4]=3,o[6*c+5]=0;function l(c){Array.isArray(c)||(c=[c,c,c]);const u=new Array(24);for(let h=0;h<8;h++)u[3*h]=r[h][0]*c[0],u[3*h+1]=r[h][1]*c[1],u[3*h+2]=r[h][2]*c[2];return new Gi([[O.POSITION,{size:3,data:u,exclusive:!0}],[O.NORMAL,{size:3,data:i}],[O.UV0,{size:2,data:n}]],[[O.POSITION,s],[O.NORMAL,a],[O.UV0,o]])}e.createGeometry=l})(Aj||(Aj={})),function(e){const r=[[-.5,0,-.5],[.5,0,-.5],[.5,0,.5],[-.5,0,.5],[0,-.5,0],[0,.5,0]],i=[0,1,-1,1,1,0,0,1,1,-1,1,0,0,-1,-1,1,-1,0,0,-1,1,-1,-1,0],n=new Uint16Array([5,1,0,5,2,1,5,3,2,5,0,3,4,0,1,4,1,2,4,2,3,4,3,0]),s=new Uint16Array([0,0,0,1,1,1,2,2,2,3,3,3,4,4,4,5,5,5,6,6,6,7,7,7]);function a(o){Array.isArray(o)||(o=[o,o,o]);const l=new Array(18);for(let c=0;c<6;c++)l[3*c]=r[c][0]*o[0],l[3*c+1]=r[c][1]*o[1],l[3*c+2]=r[c][2]*o[2];return new Gi([[O.POSITION,{size:3,data:l,exclusive:!0}],[O.NORMAL,{size:3,data:i}]],[[O.POSITION,n],[O.NORMAL,s]])}e.createGeometry=a}(Rj||(Rj={})),function(e){const i=Dr(-.5,0,-.5),n=Dr(.5,0,-.5),s=Dr(0,0,.5),a=Dr(0,0+.5,0),o=Mr(),l=Mr(),c=Mr(),u=Mr(),h=Mr();pe(o,i,a),pe(l,i,n),dt(c,o,l),we(c,c),pe(o,n,a),pe(l,n,s),dt(u,o,l),we(u,u),pe(o,s,a),pe(l,s,i),dt(h,o,l),we(h,h);const p=[i,n,s,a],m=[0,-1,0,c[0],c[1],c[2],u[0],u[1],u[2],h[0],h[1],h[2]],g=[0,1,2,3,1,0,3,2,1,3,0,2],b=[0,0,0,1,1,1,2,2,2,3,3,3];function w(v){Array.isArray(v)||(v=[v,v,v]);const x=new Array(12);for(let T=0;T<4;T++)x[3*T]=p[T][0]*v[0],x[3*T+1]=p[T][1]*v[1],x[3*T+2]=p[T][2]*v[2];return new Gi([[O.POSITION,{size:3,data:x,exclusive:!0}],[O.NORMAL,{size:3,data:m}]],[[O.POSITION,new Uint16Array(g)],[O.NORMAL,new Uint16Array(b)]])}e.createGeometry=w}(Oj||(Oj={})),function(e){function t(T,E,C,A={uv:!0}){const P=-Math.PI,I=2*Math.PI,L=-Math.PI/2,V=Math.PI,G=Math.max(3,Math.floor(E)),B=Math.max(2,Math.floor(C)),X=(G+1)*(B+1),Y=new Float32Array(3*X),ce=new Float32Array(3*X),se=new Float32Array(2*X),D=[];let F=0;for(let Z=0;Z<=B;Z++){const q=[],ee=Z/B,me=L+ee*V,_e=Math.cos(me);for(let De=0;De<=G;De++){const be=De/G,ye=P+be*I,Ce=Math.cos(ye)*_e,Ne=Math.sin(me),Fr=-Math.sin(ye)*_e;Y[3*F]=Ce*T,Y[3*F+1]=Ne*T,Y[3*F+2]=Fr*T,ce[3*F]=Ce,ce[3*F+1]=Ne,ce[3*F+2]=Fr,se[2*F]=be,se[2*F+1]=ee,q.push(F),++F}D.push(q)}const U=new Uint32Array(2*G*(B-1)*3);F=0;for(let Z=0;Z<B;Z++)for(let q=0;q<G;q++){const ee=D[Z][q],me=D[Z][q+1],_e=D[Z+1][q+1],De=D[Z+1][q];Z===0?(U[F++]=ee,U[F++]=_e,U[F++]=De):Z===B-1?(U[F++]=ee,U[F++]=me,U[F++]=_e):(U[F++]=ee,U[F++]=me,U[F++]=_e,U[F++]=_e,U[F++]=De,U[F++]=ee)}const j=[[O.POSITION,U],[O.NORMAL,U]],W=[[O.POSITION,{size:3,data:Y,exclusive:!0}],[O.NORMAL,{size:3,data:ce,exclusive:!0}]];return A.uv&&(W.push([O.UV0,{size:2,data:se,exclusive:!0}]),j.push([O.UV0,U])),A.offset&&(j[0][0]=O.OFFSET,W[0][0]=O.OFFSET,j.push([O.POSITION,new Uint32Array(U.length)]),W.push([O.POSITION,{size:3,data:Float64Array.from(A.offset),exclusive:!0}])),new Gi(W,j)}function r(T,E,C){const A=T;let P,I;if(C)P=[0,-1,0,1,0,0,0,0,1,-1,0,0,0,0,-1,0,1,0],I=new Uint32Array([0,1,2,0,2,3,0,3,4,0,4,1,1,5,2,2,5,3,3,5,4,4,5,1]);else{const Y=A*(1+Math.sqrt(5))/2;P=[-A,Y,0,A,Y,0,-A,-Y,0,A,-Y,0,0,-A,Y,0,A,Y,0,-A,-Y,0,A,-Y,Y,0,-A,Y,0,A,-Y,0,-A,-Y,0,A],I=new Uint32Array([0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1])}for(let Y=0;Y<P.length;Y+=3)Zx.scale(P,Y,T/Zx.length(P,Y));let L={};function V(Y,ce){Y>ce&&([Y,ce]=[ce,Y]);const se=Y.toString()+"."+ce.toString();if(L[se])return L[se];let D=P.length;return P.length+=3,Zx.add(P,3*Y,P,3*ce,P,D),Zx.scale(P,D,T/Zx.length(P,D)),D/=3,L[se]=D,D}for(let Y=0;Y<E;Y++){const ce=I.length,se=new Uint32Array(4*ce);for(let D=0;D<ce;D+=3){const F=I[D],U=I[D+1],j=I[D+2],W=V(F,U),Z=V(U,j),q=V(j,F),ee=4*D;se[ee]=F,se[ee+1]=W,se[ee+2]=q,se[ee+3]=U,se[ee+4]=Z,se[ee+5]=W,se[ee+6]=j,se[ee+7]=q,se[ee+8]=Z,se[ee+9]=W,se[ee+10]=Z,se[ee+11]=q}I=se,L={}}const G=new Float32Array(P);for(let Y=0;Y<G.length;Y+=3)Zx.normalize(G,Y);const B=[[O.POSITION,I],[O.NORMAL,I]],X=[[O.POSITION,{size:3,data:new Float32Array(P),exclusive:!0}],[O.NORMAL,{size:3,data:G,exclusive:!0}]];return new Gi(X,B)}function i(T,E,C,A,P,I,L){const V=E?[E[0],E[1],E[2]]:[0,0,0],G=T?[T[0],T[1],T[2]]:[0,0,1];I=I||[0,0];const B=C?[255*C[0],255*C[1],255*C[2],C.length>3?255*C[3]:255]:[255,255,255,255],X=A!=null&&A.length===2?A:[1,1],Y=[[O.POSITION,{size:3,data:V,exclusive:!0}],[O.NORMAL,{size:3,data:G,exclusive:!0}],[O.UV0,{size:I.length,data:I}],[O.COLOR,{size:4,data:B,exclusive:!0}],[O.SIZE,{size:2,data:X}]];if(P!=null){const ce=new Float32Array([P[0],P[1],P[2],P[3]]);Y.push([O.AUXPOS1,{size:4,data:ce}])}if(L!=null){const ce=new Float32Array([L[0],L[1],L[2],L[3]]);Y.push([O.AUXPOS2,{size:4,data:ce}])}return new Gi(Y,null,lc.Point)}function n(T,E,C,A,P,I,L,V){if(T!=null){const{data:G}=V.getMutableAttribute(O.NORMAL);G[0]=T[0],G[1]=T[1],G[2]=T[2]}if(E!=null){const{data:G}=V.getMutableAttribute(O.POSITION);G[0]=E[0],G[1]=E[1],G[2]=E[2]}if(C!=null){const{data:G}=V.getMutableAttribute(O.COLOR);G[0]=C[0],G[1]=C[1],G[2]=C[2],G[3]=C[3]}if(A!=null){const{data:G}=V.getMutableAttribute(O.SIZE);G[0]=A[0],G[1]=A[1]}if(P!=null){const{data:G}=V.getMutableAttribute(O.AUXPOS1);G[0]=P[0],G[1]=P[1],G[2]=P[2],G[3]=P[3]}if(I!=null){const{data:G}=V.getMutableAttribute(O.UV0);G[0]=I[0],G[1]=I[1]}if(L!=null){const{data:G}=V.getMutableAttribute(O.AUXPOS2);G[0]=L[0],G[1]=L[1],G[2]=L[2],G[3]=L[3]}}function s(T,E){const C=new Float32Array(3*T.length),A=new Float32Array(E?3*T.length:3),P=new Uint32Array(T.length),I=new Uint32Array(T.length);for(let B=0;B<T.length;B++)C[3*B]=T[B][0],C[3*B+1]=T[B][1],C[3*B+2]=T[B][2],E&&(A[3*B]=E[B][0],A[3*B+1]=E[B][1],A[3*B+2]=E[B][2]),P[B]=B,I[B]=0;E||(A[0]=0,A[1]=1,A[2]=0);const L=[0,0],V=[[O.POSITION,P],[O.NORMAL,E?P:I],[O.UV0,I]],G=[[O.POSITION,{size:3,data:C,exclusive:!0}],[O.NORMAL,{size:3,data:A,exclusive:!0}],[O.UV0,{size:2,data:L,exclusive:!0}]];return new Gi(G,V,lc.Point)}function a(){const T=[0,0,0,0,0,100,100,0,0],E=new Uint16Array([0,1,2]),C=[0,1,0],A=new Uint16Array([0,0,0]),P=[0,0],I=new Uint16Array([0,0,0]),L=[[O.POSITION,E],[O.NORMAL,A],[O.UV0,I]],V=[[O.POSITION,{size:3,data:T,exclusive:!0}],[O.NORMAL,{size:3,data:C,exclusive:!0}],[O.UV0,{size:2,data:P,exclusive:!0}]];return new Gi(V,L)}e.createBoxGeometry=Aj.createGeometry,e.createDiamondGeometry=Rj.createGeometry,e.createTetrahedronGeometry=Oj.createGeometry,e.createSphereGeometry=t,e.createPolySphereGeometry=r,e.createPointGeometry=i,e.updatePointGeometry=n,e.createPointArrayGeometry=s,e.createTriangleGeometry=a;const o=[[-1,-1,0],[1,-1,0],[1,1,0],[-1,1,0]];function l(T=o){const E=new Array(12);for(let B=0;B<4;B++)for(let X=0;X<3;X++)E[3*B+X]=T[B][X];const C=new Uint32Array([0,1,2,2,3,0]),A=[0,0,1],P=new Uint32Array([0,0,0,0,0,0]),I=[0,0,1,0,1,1,0,1],L=[255,255,255,255],V=[[O.POSITION,C],[O.NORMAL,P],[O.UV0,C],[O.COLOR,P]],G=[[O.POSITION,{size:3,data:E,exclusive:!0}],[O.NORMAL,{size:3,data:A,exclusive:!0}],[O.UV0,{size:2,data:I,exclusive:!0}],[O.COLOR,{size:4,data:L,exclusive:!0}]];return new Gi(G,V)}function c(T,E,C,A,P=!0,I=!0){let L=0;const V=E,G=T;let B=Dr(0,L,0),X=Dr(0,L+G,0),Y=Dr(0,-1,0),ce=Dr(0,1,0);A&&(L=G,X=Dr(0,0,0),B=Dr(0,L,0),Y=Dr(0,1,0),ce=Dr(0,-1,0));const se=[X,B],D=[Y,ce],F=C+2,U=Math.sqrt(G*G+V*V);if(A)for(let be=C-1;be>=0;be--){const ye=be*(2*Math.PI/C),Ce=Dr(Math.cos(ye)*V,L,Math.sin(ye)*V);se.push(Ce);const Ne=Dr(G*Math.cos(ye)/U,-V/U,G*Math.sin(ye)/U);D.push(Ne)}else for(let be=0;be<C;be++){const ye=be*(2*Math.PI/C),Ce=Dr(Math.cos(ye)*V,L,Math.sin(ye)*V);se.push(Ce);const Ne=Dr(G*Math.cos(ye)/U,V/U,G*Math.sin(ye)/U);D.push(Ne)}const j=new Uint32Array(2*(C+2)*3),W=new Uint32Array(2*(C+2)*3);let Z=0,q=0;if(P){for(let be=3;be<se.length;be++)j[Z++]=1,j[Z++]=be-1,j[Z++]=be,W[q++]=0,W[q++]=0,W[q++]=0;j[Z++]=se.length-1,j[Z++]=2,j[Z++]=1,W[q++]=0,W[q++]=0,W[q++]=0}if(I){for(let be=3;be<se.length;be++)j[Z++]=be,j[Z++]=be-1,j[Z++]=0,W[q++]=be,W[q++]=be-1,W[q++]=1;j[Z++]=0,j[Z++]=2,j[Z++]=se.length-1,W[q++]=1,W[q++]=2,W[q++]=D.length-1}const ee=new Float32Array(3*F);for(let be=0;be<F;be++)ee[3*be]=se[be][0],ee[3*be+1]=se[be][1],ee[3*be+2]=se[be][2];const me=new Float32Array(3*F);for(let be=0;be<F;be++)me[3*be]=D[be][0],me[3*be+1]=D[be][1],me[3*be+2]=D[be][2];const _e=[[O.POSITION,j],[O.NORMAL,W]],De=[[O.POSITION,{size:3,data:ee,exclusive:!0}],[O.NORMAL,{size:3,data:me,exclusive:!0}]];return new Gi(De,_e)}function u(T,E,C,A,P,I){const L=A?VN(A):Dr(1,0,0),V=P?VN(P):Dr(0,0,0);I=I==null||I;const G=Mr();we(G,L);const B=Mr();le(B,G,Math.abs(T));const X=Mr();le(X,B,-.5),he(X,X,V);const Y=Dr(0,1,0);Math.abs(1-Se(G,Y))<.2&&ne(Y,0,0,1);const ce=Mr();dt(ce,G,Y),we(ce,ce),dt(Y,ce,G);const se=2*C+(I?2:0),D=C+(I?2:0),F=new Float32Array(3*se),U=new Float32Array(3*D),j=new Float32Array(2*se),W=new Uint32Array(3*C*(I?4:2)),Z=new Uint32Array(3*C*(I?4:2));I&&(F[3*(se-2)+0]=X[0],F[3*(se-2)+1]=X[1],F[3*(se-2)+2]=X[2],j[2*(se-2)]=0,j[2*(se-2)+1]=0,F[3*(se-1)+0]=F[3*(se-2)+0]+B[0],F[3*(se-1)+1]=F[3*(se-2)+1]+B[1],F[3*(se-1)+2]=F[3*(se-2)+2]+B[2],j[2*(se-1)]=1,j[2*(se-1)+1]=1,U[3*(D-2)+0]=-G[0],U[3*(D-2)+1]=-G[1],U[3*(D-2)+2]=-G[2],U[3*(D-1)+0]=G[0],U[3*(D-1)+1]=G[1],U[3*(D-1)+2]=G[2]);const q=(ye,Ce,Ne)=>{W[ye]=Ce,Z[ye]=Ne};let ee=0;const me=Mr(),_e=Mr();for(let ye=0;ye<C;ye++){const Ce=ye*(2*Math.PI/C);le(me,Y,Math.sin(Ce)),le(_e,ce,Math.cos(Ce)),he(me,me,_e),U[3*ye+0]=me[0],U[3*ye+1]=me[1],U[3*ye+2]=me[2],le(me,me,E),he(me,me,X),F[3*ye+0]=me[0],F[3*ye+1]=me[1],F[3*ye+2]=me[2],j[2*ye+0]=ye/C,j[2*ye+1]=0,F[3*(ye+C)+0]=F[3*ye+0]+B[0],F[3*(ye+C)+1]=F[3*ye+1]+B[1],F[3*(ye+C)+2]=F[3*ye+2]+B[2],j[2*(ye+C)+0]=ye/C,j[2*ye+1]=1;const Ne=(ye+1)%C;q(ee++,ye,ye),q(ee++,ye+C,ye),q(ee++,Ne,Ne),q(ee++,Ne,Ne),q(ee++,ye+C,ye),q(ee++,Ne+C,Ne)}if(I){for(let ye=0;ye<C;ye++){const Ce=(ye+1)%C;q(ee++,se-2,D-2),q(ee++,ye,D-2),q(ee++,Ce,D-2)}for(let ye=0;ye<C;ye++){const Ce=(ye+1)%C;q(ee++,ye+C,D-1),q(ee++,se-1,D-1),q(ee++,Ce+C,D-1)}}const De=[[O.POSITION,W],[O.NORMAL,Z],[O.UV0,W]],be=[[O.POSITION,{size:3,data:F,exclusive:!0}],[O.NORMAL,{size:3,data:U,exclusive:!0}],[O.UV0,{size:2,data:j,exclusive:!0}]];return new Gi(be,De)}function h(T,E,C,A,P){C=C||10,A=A==null||A,pt(T.length>1);const I=[[0,0,0]],L=[],V=[];for(let G=0;G<C;G++){L.push([0,-G-1,-(G+1)%C-1]);const B=G/C*2*Math.PI;V.push([Math.cos(B)*E,Math.sin(B)*E])}return e.createPathExtrusionGeometry(V,T,I,L,A,P)}function p(T,E,C,A,P,I=Dr(0,0,0)){const L=T.length,V=new Float32Array(E.length*L*3+(6*C.length||0)),G=new Float32Array(E.length*L*3+(C?6:0)),B=(E.length-1)*L*6+3*A.length*2,X=new Uint32Array(B),Y=new Uint32Array(B);let ce=0,se=0,D=0,F=0;const U=Mr(),j=Mr(),W=Mr(),Z=Mr(),q=Mr(),ee=Mr(),me=Mr(),_e=M(),De=Mr(),be=Mr(),ye=Mr(),Ce=Mr(),Ne=Mr(),Fr=Er();ne(De,0,1,0),pe(j,E[1],E[0]),we(j,j),P?(he(_e,E[0],I),we(W,_e)):ne(W,0,0,1),x(j,W,De,De,q,W,Ppe),oe(Z,W),oe(Ce,q);for(let st=0;st<C.length;st++)le(ee,q,C[st][0]),le(_e,W,C[st][2]),he(ee,ee,_e),he(ee,ee,E[0]),V[ce++]=ee[0],V[ce++]=ee[1],V[ce++]=ee[2];G[se++]=-j[0],G[se++]=-j[1],G[se++]=-j[2];for(let st=0;st<A.length;st++)X[D++]=A[st][0]>0?A[st][0]:-A[st][0]-1+C.length,X[D++]=A[st][1]>0?A[st][1]:-A[st][1]-1+C.length,X[D++]=A[st][2]>0?A[st][2]:-A[st][2]-1+C.length,Y[F++]=0,Y[F++]=0,Y[F++]=0;let Br=C.length;const hr=C.length-1;for(let st=0;st<E.length;st++){let Di=!1;st>0&&(oe(U,j),st<E.length-1?(pe(j,E[st+1],E[st]),we(j,j)):Di=!0,he(be,U,j),we(be,be),he(ye,E[st-1],Z),r9(E[st],be,Fr),Cx(Fr,Ru(ye,U),_e)?(pe(_e,_e,E[st]),we(W,_e),dt(q,be,W),we(q,q)):x(be,Z,Ce,De,q,W,Ppe),oe(Z,W),oe(Ce,q)),P&&(he(_e,E[st],I),we(Ne,_e));for(let da=0;da<L;da++)if(le(ee,q,T[da][0]),le(_e,W,T[da][1]),he(ee,ee,_e),we(me,ee),G[se++]=me[0],G[se++]=me[1],G[se++]=me[2],he(ee,ee,E[st]),V[ce++]=ee[0],V[ce++]=ee[1],V[ce++]=ee[2],!Di){const Sl=(da+1)%L;X[D++]=Br+da,X[D++]=Br+L+da,X[D++]=Br+Sl,X[D++]=Br+Sl,X[D++]=Br+L+da,X[D++]=Br+L+Sl;for(let Vo=0;Vo<6;Vo++)Y[F++]=X[D-6+Vo]-hr}Br+=L}const Gr=E[E.length-1];for(let st=0;st<C.length;st++)le(ee,q,C[st][0]),le(_e,W,C[st][1]),he(ee,ee,_e),he(ee,ee,Gr),V[ce++]=ee[0],V[ce++]=ee[1],V[ce++]=ee[2];const mr=se/3;G[se++]=j[0],G[se++]=j[1],G[se++]=j[2];const jr=Br-L;for(let st=0;st<A.length;st++)X[D++]=A[st][0]>=0?Br+A[st][0]:-A[st][0]-1+jr,X[D++]=A[st][2]>=0?Br+A[st][2]:-A[st][2]-1+jr,X[D++]=A[st][1]>=0?Br+A[st][1]:-A[st][1]-1+jr,Y[F++]=mr,Y[F++]=mr,Y[F++]=mr;const Qi=[[O.POSITION,X],[O.NORMAL,Y]],yn=[[O.POSITION,{size:3,data:V,exclusive:!0}],[O.NORMAL,{size:3,data:G,exclusive:!0}]];return new Gi(yn,Qi)}function m(T,E,C){pt(T.length>1,"createPolylineGeometry(): polyline needs at least 2 points"),pt(T[0].length===3,"createPolylineGeometry(): malformed vertex"),pt(E==null||E.length===T.length,"createPolylineGeometry: need same number of points and normals"),pt(E==null||E[0].length===3,"createPolylineGeometry(): malformed normal");const A=new Float64Array(3*T.length),P=new Uint32Array(2*(T.length-1));let I=0,L=0;for(let B=0;B<T.length;B++){for(let X=0;X<3;X++)A[I++]=T[B][X];B>0&&(P[L++]=B-1,P[L++]=B)}const V=[],G=[];if(V.push([O.POSITION,P]),G.push([O.POSITION,{size:3,data:A,exclusive:!0}]),E){const B=new Float32Array(3*E.length);let X=0;for(let Y=0;Y<T.length;Y++)for(let ce=0;ce<3;ce++)B[X++]=E[Y][ce];V.push([O.NORMAL,P]),G.push([O.NORMAL,{size:3,data:B,exclusive:!0}])}return C&&(G.push([O.COLOR,{size:4,data:C}]),V.push([O.COLOR,S9(C.length/4)])),new Gi(G,V,lc.Line)}function g(T,E,C,A,P=0){const I=new Array(18),L=[[-E,P,A/2],[C,P,A/2],[0,T+P,A/2],[-E,P,-A/2],[C,P,-A/2],[0,T+P,-A/2]],V=new Uint16Array([0,1,2,3,0,2,2,5,3,1,4,5,5,2,1,1,0,3,3,4,1,4,3,5]);for(let G=0;G<6;G++)I[3*G]=L[G][0],I[3*G+1]=L[G][1],I[3*G+2]=L[G][2];return new Gi([[O.POSITION,{size:3,data:I,exclusive:!0}]],[[O.POSITION,V]])}function b(T,E){const C=T.getMutableAttribute(O.POSITION).data;for(let A=0;A<C.length;A+=3){const P=C[A],I=C[A+1],L=C[A+2];ne(Qx,P,I,L),ze(Qx,Qx,E),C[A]=Qx[0],C[A+1]=Qx[1],C[A+2]=Qx[2]}}function w(T,E=T){const C=T.vertexAttributes,A=C.get(O.POSITION).data,P=C.get(O.NORMAL).data;if(P){const I=E.getMutableAttribute(O.NORMAL).data;for(let L=0;L<P.length;L+=3){const V=P[L+1];I[L+1]=-P[L+2],I[L+2]=V}}if(A){const I=E.getMutableAttribute(O.POSITION).data;for(let L=0;L<A.length;L+=3){const V=A[L+1];I[L+1]=-A[L+2],I[L+2]=V}}return E}function v(T,E,C,A,P){return!(Math.abs(Se(E,T))>P)&&(dt(C,T,E),we(C,C),dt(A,C,T),we(A,A),!0)}function x(T,E,C,A,P,I,L){return v(T,E,P,I,L)||v(T,C,P,I,L)||v(T,A,P,I,L)}e.createSquareGeometry=l,e.createConeGeometry=c,e.createCylinderGeometry=u,e.createTubeGeometry=h,e.createPathExtrusionGeometry=p,e.createPolylineGeometry=m,e.createExtrudedTriangle=g,e.transformInPlace=b,e.cgToGIS=w,e.makeOrthoBasisDirUp=v,e.makeOrthoBasisDirUpFallback=x}(NJ||(NJ={}));const Ppe=.99619469809,Qx=Mr(),Uc=NJ,$dt=fe.getLogger("esri.views.3d.environment.PanoramicAtmosphere");class Ldt{constructor(){this.type="panoramic",this._techniqueConfig=new UN,this._passParameters=new bse,this._readyResolver=Op(),this._readyController=new AbortController}destroy(){this._readyResolver.reject(),this._passParameters.texture=Qe(this._passParameters.texture),this._vao=Qe(this._vao),this._readyController=qh(this._readyController)}when(){return this._readyResolver.promise}initializeRenderContext(t){this._techniqueConfig.geometry=vm.Cylinder,this._technique=t.shaderTechniqueRepository.acquire(y9,this._techniqueConfig);const r=t.renderContext.rctx;this._vao=this._createVertexArrayObject(r),this._vaoCount=io(this._vao,"geometry"),Dp(gCe,{signal:this._readyController.signal}).then(i=>{this._passParameters.texture=new at(r,{pixelFormat:Ue.RGBA,dataType:At.UNSIGNED_BYTE,wrapMode:xt.CLAMP_TO_EDGE,samplingMode:tt.LINEAR,flipped:!0},i),t.requestRender(),this._readyController=null,this._readyResolver.resolve()}).catch(i=>{Ui(i)||$dt.error("Unable to initialize atmosphere: image request failed",i),this._readyResolver.reject()})}get canRender(){return this._passParameters.texture!=null}render(t){const r=t.rctx,i=r.bindTechnique(this._technique,this._passParameters,t.bindParameters);Ddt(Ipe,t.bindParameters.camera.viewMatrix),i.setUniformMatrix4fv("view",Ipe),r.bindVAO(this._vao),i.assertCompatibleVertexAttributeLocations(this._vao),r.drawArrays(Dt.TRIANGLES,0,this._vaoCount)}renderHaze(){return!1}_createVertexArrayObject(t){const r=Uc.createPolySphereGeometry(1,2,!1),i=r.indices.get(O.POSITION);for(let o=0;o<i.length;o+=3){const l=i[o];i[o]=i[o+2],i[o+2]=l}const n=r.vertexAttributes.get(O.POSITION).data,s=$pe.createBuffer(i.length),a=s.position;for(let o=0;o<i.length;++o){const l=3*i[o];a.set(o,0,n[l]),a.set(o,1,n[l+1]),a.set(o,2,n[l+2])}return new ns(t,Ur,{geometry:vd($pe)},{geometry:dr.createVertex(t,Cr.STATIC_DRAW,s.buffer)})}}function Ddt(e,t){Ln(e,t),e[12]=0,e[13]=0,e[14]=0,e[15]=1}const Ipe=Ae(),$pe=gn().vec3f(O.POSITION);var i_;(function(e){e[e.Rain=0]="Rain",e[e.Snow=1]="Snow",e[e.COUNT=2]="COUNT"})(i_||(i_={}));class kJ extends xl{constructor(){super(...arguments),this.type=i_.Rain}}d([H({count:i_.COUNT})],kJ.prototype,"type",void 0);function Fdt(e){const t=new Qr;return t.attributes.add(O.POSITION,"vec3"),t.attributes.add(O.INSTANCEFEATUREATTRIBUTE,"float"),t.vertex.uniforms.add(new tc("cameraPosition")),t.vertex.uniforms.add(new tc("offset")),t.vertex.uniforms.add(new kr("width")),t.vertex.uniforms.add(new Ei("proj",(r,i)=>i.camera.projectionMatrix)),t.vertex.uniforms.add(new Jv("view")),t.vertex.uniforms.add(new kr("time")),t.varyings.add("vUv","vec2"),t.vertex.code.add(S`
    vec3 hash31(float p){
      vec3 p3 = fract(vec3(p) * vec3(0.1031, 0.1030, 0.0973));
      p3 += dot(p3, p3.yzx + 33.33);
      return fract((p3.xxy + p3.yzz) * p3.zyx);
    }

    float hash11(float p){
      p = fract(p * 0.1031);
      p *= p + 33.33;
      p *= p + p;
      return fract(p);
    }

    //https://www.geeks3d.com/20141201/how-to-rotate-a-vertex-by-a-quaternion-in-glsl/
    vec3 rotateVectorByQuaternion(vec3 v, vec4 q){
      return 2.0 * cross(q.xyz, v * q.w + cross(q.xyz, v)) + v;
    }

    void main(void) {

      vUv = position.xz;

      vec3 rand = hash31(instanceFeatureAttribute);

      // Set random position for all particles
      // The hash function space is not high resolution so offset particles by an additional random value
      // This creates grids of 1000 particles which are shifted by random hundreths of the tile width
      // overlaying multiple identical but offset grids
      vec3 randomPosition = 2.0 * (rand + (0.01 + 0.01 * rand) * floor(0.001 * instanceFeatureAttribute)) - 1.0;

      // Random orientation of rain drops
      float angle = 3.1415 * hash11(instanceFeatureAttribute);

      vec3 up = vec3(0, 0, 1);

      // Gravity and wind direction
      vec3 direction = normalize(cameraPosition);

      vec3 tangent = normalize(cross(direction, up));

      // Gravity
      vec3 animatedPos = randomPosition + direction * -time;

      // Rain particles fall straight down and are randomly oriented
      // Snow particles have random sinusoid trajectories and are rotated to face the camera
      ${e.type===i_.Rain?S`
            // Random rotation for particle
            vec3 rotationAxis = up;
            vec4 quat = vec4(rotationAxis * sin(angle), cos(angle));
            vec3 transformedPos = rotateVectorByQuaternion(vec3(0.2, 0.2, 4.0) * (position - vec3(0.5, 0.0, 0.5)), quat);

            // Rotate particle to planetary position
            rotationAxis = tangent;
            angle = 0.5 * -acos(dot(direction, up));
            quat = vec4(rotationAxis * sin(angle), cos(angle));
            transformedPos = rotateVectorByQuaternion(transformedPos, quat);

            vec4 pos = mat4(mat3(view)) * vec4(transformedPos + (mod(width * animatedPos - offset, width) - 0.5 * width), 1.0);
            gl_Position = proj * pos;
      `:S`
            vec3 rotationAxis = direction;
            vec4 quat = vec4(rotationAxis * sin(angle), cos(angle));

            tangent = rotateVectorByQuaternion(tangent, quat);
            // Random sinusoid from friction
            animatedPos += tangent * 0.25 * sin(dot(animatedPos, direction));
            vec4 pos = mat4(mat3(view)) * vec4((mod(width * animatedPos - offset, width) - 0.5 * width), 1.0);
            gl_Position = proj * (0.5 * vec4(position.xzy, 0.0) + pos);
      `}
    }
  `),t.fragment.uniforms.add(new kr("opacity")),t.fragment.uniforms.add(new tc("particleColor")),t.fragment.code.add(S`
    void main() {

      // Cut off corners of the triangle
      if(vUv.x < 0.0 || vUv.y < 0.0){
        discard;
      }

      float d = length(vUv - vec2(0.5));

      ${e.type===i_.Rain?S`d = 0.35 * smoothstep(0.5, 0.0, d);`:S`d = smoothstep(0.5, 0.1, d);`}
      gl_FragColor = opacity * vec4(particleColor * d, d);
    }
  `),t}const Ndt=Object.freeze(Object.defineProperty({__proto__:null,build:Fdt},Symbol.toStringTag,{value:"Module"}));class kdt extends as{constructor(){super(...arguments),this.time=0,this.radius=1}}class ey extends gi{initializeProgram(t){const r=ey.shader.get().build(this.configuration);return new ai(t.rctx,r,ey.attributeLocation)}initializePipeline(){return jt({blending:ka(Re.ONE,Re.ONE,Re.ONE_MINUS_SRC_ALPHA,Re.ONE_MINUS_SRC_ALPHA),depthTest:{func:vi.LEQUAL},colorWrite:or})}}ey.shader=new si(Ndt,()=>ie(()=>import("./Precipitation.glsl.abe62170.js"),[],import.meta.url)),ey.attributeLocation=new Map([[O.POSITION,0],[O.INSTANCEFEATUREATTRIBUTE,1]]);class TCe{constructor(){this.enabled=!0,this._time=0}get time(){return this._time}advance(t){return _(t.forcedTime)?this._time!==t.forcedTime&&(this._time=t.forcedTime,!0):!(!this.enabled||t.dt===0)&&(this._time+=t.dt,!0)}}let Z2=class extends xe{constructor(e){super(e),this._numParticles=25e4,this._rainSpeed=.1,this._snowSpeed=.01,this._opacity=1,this._width=500,this._offset=M(),this._tile=M(),this._particleColor=Mr(),this._particleColorAtNight=Mr(),this._nightMultiplier=.7,this._cameraDirection=Mr(),this._renderParameters=new kdt,this._animation=new TCe,this._updatingTracking=new tm,this._renderParameters.time=0,this._renderParameters.radius=Ar(e.view.spatialReference).radius,this._shaderTechniqueRepository=e.context.shaderTechniqueRepository}destroy(){this._updatingTracking.destroy(),this._numParticles=0,this._snowTechnique=ri(this._snowTechnique),this._rainTechnique=ri(this._rainTechnique),this._vao=Qe(this._vao),this._instanceIdBuffer=Qe(this._instanceIdBuffer)}get updating(){return this._updatingTracking.updating}get rainTechnique(){if(R(this._rainTechnique)){const e=new kJ;e.type=i_.Rain,this._rainTechnique=this._shaderTechniqueRepository.acquire(ey,e)}return this._rainTechnique}get snowTechnique(){if(R(this._snowTechnique)){const e=new kJ;e.type=i_.Snow,this._snowTechnique=this._shaderTechniqueRepository.acquire(ey,e)}return this._snowTechnique}update(e){return this._animation.advance(e)}render(e,t,r){const i=r==="rainy",n=i?this.rainTechnique:this.snowTechnique;if(!n.compiled)return void this.context.requestRender();const s=e.rctx;if(this._ensureResources(s),R(n)||R(this._vao)||R(this._instanceIdBuffer)||(_(e.bindParameters.clouds.data)&&(this._opacity=1-e.bindParameters.clouds.fadeInOutHeight.factor),this._opacity<=0))return;const a=.35;t=t<.5?Kt(0,a,2*t):Kt(a,1,2*(t-.5));const o=s.bindTechnique(n);this._renderParameters.camera=e.bindParameters.camera,this._renderParameters.time=(i?this._rainSpeed:this._snowSpeed)*Rte(this._animation.time),this._renderParameters.time=this._renderParameters.time%1e5,this._update(o,r,e),s.bindVAO(this._vao);const l=ey.attributeLocation;o.assertCompatibleVertexAttributeLocations(this._vao),Kne(s,l,this._instanceIdBuffer,Lpe,0),s.capabilities.instancing.drawArraysInstanced(Dt.TRIANGLES,0,3,this._numParticles*t),ese(s,l,this._instanceIdBuffer,Lpe)}_update(e,t,r){const i=r.bindParameters.camera,n=i.eye;this._tile[0]=Math.floor((n[0]+.5*this._width)/this._width),this._tile[1]=Math.floor((n[1]+.5*this._width)/this._width),this._tile[2]=Math.floor((n[2]+.5*this._width)/this._width),this._offset[0]=n[0]-this._tile[0]*this._width,this._offset[1]=n[1]-this._tile[1]*this._width,this._offset[2]=n[2]-this._tile[2]*this._width,e.setUniform1f("width",this._width),e.setUniform3fv("offset",this._offset),e.setUniformMatrix4fv("view",i.viewMatrix),e.setUniform3fv("cameraPosition",n),e.bindPass(null,r.bindParameters),e.setUniform1f("time",this._renderParameters.time),t==="rainy"?ne(this._particleColor,.85,.85,.85):ne(this._particleColor,1,1,1),le(this._particleColorAtNight,this._particleColor,this._nightMultiplier),we(this._cameraDirection,n);const s=Math.max(0,Se(this._cameraDirection,r.bindParameters.lighting.lightingMainDirection));As(this._particleColor,this._particleColorAtNight,this._particleColor,s),e.setUniform3fv("particleColor",this._particleColor),e.setUniform1f("opacity",this._opacity)}_ensureResources(e){R(this._vao)&&(this._vao=this._createVertexArrayObject(e)),R(this._instanceIdBuffer)&&(this._instanceIdBuffer=this._createInstanceIndices(e))}_createInstanceIndices(e){const t=[];for(let r=0;r<this._numParticles;r++)t.push(r);return dr.createVertex(e,Cr.STATIC_DRAW,new Float32Array(t))}_createVertexArrayObject(e){const t=new Float32Array([-1,0,1,1,0,-1,1,0,1]);return new ns(e,ey.attributeLocation,{geometry:vd(Vdt)},{geometry:dr.createVertex(e,Cr.STATIC_DRAW,t)})}};d([f({constructOnly:!0})],Z2.prototype,"context",void 0),d([f({constructOnly:!0})],Z2.prototype,"view",void 0),d([f({readOnly:!0})],Z2.prototype,"updating",null),d([f()],Z2.prototype,"_updatingTracking",void 0),Z2=d([$("esri.views.3d.environment.Precipitation")],Z2);const Vdt=gn().vec3f(O.POSITION),Lpe=vd(gn().f32(O.INSTANCEFEATUREATTRIBUTE),1),zdt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAIACAYAAAE00TaTAAAACXBIWXMAAA7AAAAOwAFq1okJAAAKT2lDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVNnVFPpFj333vRCS4iAlEtvUhUIIFJCi4AUkSYqIQkQSoghodkVUcERRUUEG8igiAOOjoCMFVEsDIoK2AfkIaKOg6OIisr74Xuja9a89+bN/rXXPues852zzwfACAyWSDNRNYAMqUIeEeCDx8TG4eQuQIEKJHAAEAizZCFz/SMBAPh+PDwrIsAHvgABeNMLCADATZvAMByH/w/qQplcAYCEAcB0kThLCIAUAEB6jkKmAEBGAYCdmCZTAKAEAGDLY2LjAFAtAGAnf+bTAICd+Jl7AQBblCEVAaCRACATZYhEAGg7AKzPVopFAFgwABRmS8Q5ANgtADBJV2ZIALC3AMDOEAuyAAgMADBRiIUpAAR7AGDIIyN4AISZABRG8lc88SuuEOcqAAB4mbI8uSQ5RYFbCC1xB1dXLh4ozkkXKxQ2YQJhmkAuwnmZGTKBNA/g88wAAKCRFRHgg/P9eM4Ors7ONo62Dl8t6r8G/yJiYuP+5c+rcEAAAOF0ftH+LC+zGoA7BoBt/qIl7gRoXgugdfeLZrIPQLUAoOnaV/Nw+H48PEWhkLnZ2eXk5NhKxEJbYcpXff5nwl/AV/1s+X48/Pf14L7iJIEyXYFHBPjgwsz0TKUcz5IJhGLc5o9H/LcL//wd0yLESWK5WCoU41EScY5EmozzMqUiiUKSKcUl0v9k4t8s+wM+3zUAsGo+AXuRLahdYwP2SycQWHTA4vcAAPK7b8HUKAgDgGiD4c93/+8//UegJQCAZkmScQAAXkQkLlTKsz/HCAAARKCBKrBBG/TBGCzABhzBBdzBC/xgNoRCJMTCQhBCCmSAHHJgKayCQiiGzbAdKmAv1EAdNMBRaIaTcA4uwlW4Dj1wD/phCJ7BKLyBCQRByAgTYSHaiAFiilgjjggXmYX4IcFIBBKLJCDJiBRRIkuRNUgxUopUIFVIHfI9cgI5h1xGupE7yAAygvyGvEcxlIGyUT3UDLVDuag3GoRGogvQZHQxmo8WoJvQcrQaPYw2oefQq2gP2o8+Q8cwwOgYBzPEbDAuxsNCsTgsCZNjy7EirAyrxhqwVqwDu4n1Y8+xdwQSgUXACTYEd0IgYR5BSFhMWE7YSKggHCQ0EdoJNwkDhFHCJyKTqEu0JroR+cQYYjIxh1hILCPWEo8TLxB7iEPENyQSiUMyJ7mQAkmxpFTSEtJG0m5SI+ksqZs0SBojk8naZGuyBzmULCAryIXkneTD5DPkG+Qh8lsKnWJAcaT4U+IoUspqShnlEOU05QZlmDJBVaOaUt2ooVQRNY9aQq2htlKvUYeoEzR1mjnNgxZJS6WtopXTGmgXaPdpr+h0uhHdlR5Ol9BX0svpR+iX6AP0dwwNhhWDx4hnKBmbGAcYZxl3GK+YTKYZ04sZx1QwNzHrmOeZD5lvVVgqtip8FZHKCpVKlSaVGyovVKmqpqreqgtV81XLVI+pXlN9rkZVM1PjqQnUlqtVqp1Q61MbU2epO6iHqmeob1Q/pH5Z/YkGWcNMw09DpFGgsV/jvMYgC2MZs3gsIWsNq4Z1gTXEJrHN2Xx2KruY/R27iz2qqaE5QzNKM1ezUvOUZj8H45hx+Jx0TgnnKKeX836K3hTvKeIpG6Y0TLkxZVxrqpaXllirSKtRq0frvTau7aedpr1Fu1n7gQ5Bx0onXCdHZ4/OBZ3nU9lT3acKpxZNPTr1ri6qa6UbobtEd79up+6Ynr5egJ5Mb6feeb3n+hx9L/1U/W36p/VHDFgGswwkBtsMzhg8xTVxbzwdL8fb8VFDXcNAQ6VhlWGX4YSRudE8o9VGjUYPjGnGXOMk423GbcajJgYmISZLTepN7ppSTbmmKaY7TDtMx83MzaLN1pk1mz0x1zLnm+eb15vft2BaeFostqi2uGVJsuRaplnutrxuhVo5WaVYVVpds0atna0l1rutu6cRp7lOk06rntZnw7Dxtsm2qbcZsOXYBtuutm22fWFnYhdnt8Wuw+6TvZN9un2N/T0HDYfZDqsdWh1+c7RyFDpWOt6azpzuP33F9JbpL2dYzxDP2DPjthPLKcRpnVOb00dnF2e5c4PziIuJS4LLLpc+Lpsbxt3IveRKdPVxXeF60vWdm7Obwu2o26/uNu5p7ofcn8w0nymeWTNz0MPIQ+BR5dE/C5+VMGvfrH5PQ0+BZ7XnIy9jL5FXrdewt6V3qvdh7xc+9j5yn+M+4zw33jLeWV/MN8C3yLfLT8Nvnl+F30N/I/9k/3r/0QCngCUBZwOJgUGBWwL7+Hp8Ib+OPzrbZfay2e1BjKC5QRVBj4KtguXBrSFoyOyQrSH355jOkc5pDoVQfujW0Adh5mGLw34MJ4WHhVeGP45wiFga0TGXNXfR3ENz30T6RJZE3ptnMU85ry1KNSo+qi5qPNo3ujS6P8YuZlnM1VidWElsSxw5LiquNm5svt/87fOH4p3iC+N7F5gvyF1weaHOwvSFpxapLhIsOpZATIhOOJTwQRAqqBaMJfITdyWOCnnCHcJnIi/RNtGI2ENcKh5O8kgqTXqS7JG8NXkkxTOlLOW5hCepkLxMDUzdmzqeFpp2IG0yPTq9MYOSkZBxQqohTZO2Z+pn5mZ2y6xlhbL+xW6Lty8elQfJa7OQrAVZLQq2QqboVFoo1yoHsmdlV2a/zYnKOZarnivN7cyzytuQN5zvn//tEsIS4ZK2pYZLVy0dWOa9rGo5sjxxedsK4xUFK4ZWBqw8uIq2Km3VT6vtV5eufr0mek1rgV7ByoLBtQFr6wtVCuWFfevc1+1dT1gvWd+1YfqGnRs+FYmKrhTbF5cVf9go3HjlG4dvyr+Z3JS0qavEuWTPZtJm6ebeLZ5bDpaql+aXDm4N2dq0Dd9WtO319kXbL5fNKNu7g7ZDuaO/PLi8ZafJzs07P1SkVPRU+lQ27tLdtWHX+G7R7ht7vPY07NXbW7z3/T7JvttVAVVN1WbVZftJ+7P3P66Jqun4lvttXa1ObXHtxwPSA/0HIw6217nU1R3SPVRSj9Yr60cOxx++/p3vdy0NNg1VjZzG4iNwRHnk6fcJ3/ceDTradox7rOEH0x92HWcdL2pCmvKaRptTmvtbYlu6T8w+0dbq3nr8R9sfD5w0PFl5SvNUyWna6YLTk2fyz4ydlZ19fi753GDborZ752PO32oPb++6EHTh0kX/i+c7vDvOXPK4dPKy2+UTV7hXmq86X23qdOo8/pPTT8e7nLuarrlca7nuer21e2b36RueN87d9L158Rb/1tWeOT3dvfN6b/fF9/XfFt1+cif9zsu72Xcn7q28T7xf9EDtQdlD3YfVP1v+3Njv3H9qwHeg89HcR/cGhYPP/pH1jw9DBY+Zj8uGDYbrnjg+OTniP3L96fynQ89kzyaeF/6i/suuFxYvfvjV69fO0ZjRoZfyl5O/bXyl/erA6xmv28bCxh6+yXgzMV70VvvtwXfcdx3vo98PT+R8IH8o/2j5sfVT0Kf7kxmTk/8EA5jz/GMzLdsAAAAgY0hSTQAAeiUAAICDAAD5/wAAgOkAAHUwAADqYAAAOpgAABdvkl/FRgAAAp1JREFUSMd9lcmSEzEQRCtflnqxYZgIThBDAP//kXDQ0pJtuDhqycxWZ5fKERFCERARIAVEyCjCtSFFEjWVa9q7OdJE0oiidIhKhRBROlhloiGVhaYERQHJWFEwMpYKrjUlibI2cqSJIJEpKNmM2c3GkRTOJDnThTMpnMWu0VFszs3Jfbe5bza3w+a229yOIs6zmP3czfn1K2w/for8+EVU15pNmmyqkeJyclinXNJRu1xrUaJmjmdzJiejVNt7zZVBRAIq1RwrsrrWnez+SR7WmQQP/1itKz2q/pmzuJtYnNy2bth9x9z2NLfDcB7FHOcGx6ebOb9/iPzxG/ztg4iorglFiKjzF9HSNphCoRb1OY3RZQJrYgRdT68bmgXGDdBzrTG8qNS7QP/m19ef7tGlcoH7vESYkK70uoPuOLEetz0IqeGoWQW6MlB/j36EnipYGKPWwDRg/RkNhXCNJIzAhMk6PrDePJNII6JHqM5VWqYApCtNFPe0GFFGtOWopWCrEVBSoiQi06KkRRaD08IlxXa/ifz8Jvz2LvjyLnh7F/r8Rei8a8xfjNkIrpmMOQ1C02COrkTEHxGhh+6DQJfXc/eZprXxcIyVIf1LJVgWvKaHvwI/1aQxtv851SQ/nqGXL6MHFVY3nmhLyqKsWO/+qzWif+yS1TpNKq8NezjGPCV69ciZoQj1PwfN6QRpWyCGVMe1D/AAHt3/gefu1Ign3AVpjOiNXkN90JlpL6TUnzFEUU+Jvks0tkp/dY3Fy1TzI24BWwsYJPyg11Q0FqDwK72xIz2kLojbeuxS1FpgtfNWyMX1gFw0j3W7RNeSHTVEe3VaV7SdCzVywFaEt02w7QH7Eeg4AvZDNdJ+Cu1HENsutO+Byi6ilEBZ9BeCNBJceJIjHgAAAABJRU5ErkJggg==",Udt=fe.getLogger("esri.views.3d.environment.SimpleAtmosphere"),CP=128,Dpe=-MJ,Fpe=0,Mj=50,Bdt=()=>1-511/512,Gdt=gL([[50,.1015625],[500,.21875],[5e3,1-250/512],[5e4,.4140625]]);class jdt{constructor(t){this.view=t,this.type="simple",this._renderData={texV:it(),silCircleCenter:M(),silCircleV1:M(),silCircleV2:M(),altitudeFade:0,innerScale:0,undergroundFadeAlpha:0},this._passParameters=new bse,this._fadeVaoCount=0,this._readyResolver=Op(),this._readyController=new AbortController,this.texV1=1,this.canRender=!0,this.isOnMars=Sm(t.spatialReference);const r=Ar(t.spatialReference);this.planetRadius=r.radius,this.outerRimWidth=r.outerAtmosphereRimWidth,this.innerRimFactor=(this.planetRadius+Dpe)/this.planetRadius,this.middleRimFactor=(this.planetRadius+Fpe)/this.planetRadius,this.outerRimFactor=(this.planetRadius+this.outerRimWidth)/this.planetRadius,this.texV0=Fpe/this.outerRimWidth,this.texVScale=this.texV1-this.texV0}destroy(){this._readyResolver.reject(),this._cameraChangeHandle=Ts(this._cameraChangeHandle),this._passParameters.texture=Qe(this._passParameters.texture),this._fadeVao=Qe(this._fadeVao),this._vao=Qe(this._vao),this._readyController=qh(this._readyController)}when(){return this._readyResolver.promise}async initializeRenderContext(t){this._shaderTechniqueRepository=t.shaderTechniqueRepository;const r=t.renderContext.rctx;this._cameraChangeHandle=re(()=>{var s;return(s=this.view.state)==null?void 0:s.camera},()=>t.requestRender(),Yn),this._vao=this._createRibbon(r),this._vaoCount=io(this._vao,"geometry"),this._fadeVao=Tl(r),this._fadeVaoCount=io(this._fadeVao,"geometry");const i=this.isOnMars?zdt:gCe,n=this._readyController.signal;try{const s=await Dp(i,{signal:n});Et(n),this._passParameters.texture=new at(r,{pixelFormat:Ue.RGBA,dataType:At.UNSIGNED_BYTE,wrapMode:xt.CLAMP_TO_EDGE,samplingMode:tt.LINEAR,flipped:!0},s),t.requestRender(),this._readyController=null,this._readyResolver.resolve()}catch(s){Ui(s)||Udt.error("Unable to initialize simple atmosphere: image request failed",s),this._readyResolver.reject(s)}}get coneTechnique(){if(R(this._coneTechnique)){const t=new UN;t.geometry=vm.Cone,this._coneTechnique=this._shaderTechniqueRepository.acquire(y9,t)}return this._coneTechnique}get undergroundTechnique(){if(R(this._undergroundTechnique)){const t=new UN;t.geometry=vm.Underground,this._undergroundTechnique=this._shaderTechniqueRepository.acquire(y9,t)}return this._undergroundTechnique}render(t){const r=t.bindParameters.camera;this._update(r);const i=t.rctx;if(this._renderData.undergroundFadeAlpha<1){const n=i.bindTechnique(this.coneTechnique,this._passParameters,t.bindParameters);n.setUniformMatrix4fv("proj",r.projectionMatrix),n.setUniformMatrix4fv("view",r.viewMatrix),n.setUniform3fv("silCircleCenter",this._renderData.silCircleCenter),n.setUniform3fv("silCircleV1",this._renderData.silCircleV1),n.setUniform3fv("silCircleV2",this._renderData.silCircleV2),n.setUniform2fv("texV",this._renderData.texV),n.setUniform1f("altitudeFade",this._renderData.altitudeFade),n.setUniform1f("innerScale",this._renderData.innerScale),i.bindVAO(this._vao),i.drawArrays(Dt.TRIANGLES,0,this._vaoCount)}if(this._renderData.undergroundFadeAlpha>0){const n=i.bindTechnique(this.undergroundTechnique,this._passParameters,t.bindParameters);n.setUniform1f("undergroundFadeAlpha",this._renderData.undergroundFadeAlpha),n.setUniform3fv("cameraPosition",r.eye),i.bindVAO(this._fadeVao),i.drawArrays(Dt.TRIANGLE_STRIP,0,this._fadeVaoCount)}}renderHaze(){return!1}_update(t){const r=M(),i=this.planetRadius,n=Oe(t.eye),s=n-i;if(s<0){const m=Math.min(-s/5e3,1);this._renderData.undergroundFadeAlpha=m}else this._renderData.undergroundFadeAlpha=0;const a=Math.max(Mj,s),o=i+Dpe;this._renderData.innerScale=qdt(i+a,i,o)-1,this._renderData.altitudeFade=SEe(s),le(r,t.eye,(i+Mj)/n),Npe(r,t.center,t.up,i,this._renderData);const l=this._computeScreenRimWidth(t,r,t.up,this._renderData),c=Bdt(),u=Gdt(s);let h=this.texV0+c*this.texVScale,p=this.texV0+l*u*this.texVScale;if(s>Mj){Npe(t.eye,t.center,t.up,i,this._renderData);const m=this._computeScreenRimWidth(t,t.eye,t.up,this._renderData),g=Le((m-1.5)/(l-1.5),0,1);h=this.texV0+g*c*this.texVScale,p=this.texV0+Kt(this.texV1,l*u,g)*this.texVScale}vr(this._renderData.texV,h,p)}_createRibbon(t){const r=new Float32Array(3+3*CP*3),i=new Uint32Array(3*CP*5);r[0]=0,r[1]=0,r[2]=-1;for(let a=0;a<CP;a++){const o=9*a+3;r[o+0]=a,r[o+1]=this.innerRimFactor,r[o+2]=-1,r[o+3]=a,r[o+4]=this.middleRimFactor,r[o+5]=0,r[o+6]=a,r[o+7]=this.outerRimFactor,r[o+8]=1;const l=3*a+1,c=a===CP-1?1:l+3,u=15*a;i[u+0]=l,i[u+1]=l+1,i[u+2]=c+1,i[u+3]=c+1,i[u+4]=c,i[u+5]=l,i[u+6]=l+1,i[u+7]=l+2,i[u+8]=c+2,i[u+9]=c+2,i[u+10]=c+1,i[u+11]=l+1,i[u+12]=l,i[u+13]=c,i[u+14]=0}const n=kpe.createBuffer(i.length),s=n.position;for(let a=0;a<i.length;++a){const o=3*i[a];s.set(a,0,r[o]),s.set(a,1,r[o+1]),s.set(a,2,r[o+2])}return new ns(t,Ur,{geometry:vd(kpe)},{geometry:dr.createVertex(t,Cr.STATIC_DRAW,n.buffer)})}_computeScreenRimWidth(t,r,i,n){return he(a8,n.silCircleCenter,n.silCircleV2),le(Ij,a8,this.outerRimFactor),kV(Pj,r,a8,i),Rpe(a8,Pj,t.projectionMatrix,t.viewport),Rpe(Ij,Pj,t.projectionMatrix,t.viewport),fi(a8,Ij)/t.height}}function Npe(e,t,r,i,n){const s=Oe(e),a=i*Math.sqrt(s*s-i*i)/s,o=Math.sqrt(i*i-a*a),l=n.silCircleV1,c=n.silCircleV2;return le(n.silCircleCenter,e,o/s),dt(l,e,t),fl(l)<1&&dt(l,e,r),le(l,l,a/Oe(l)),dt(c,l,e),le(c,c,a/Oe(c)),a}const Pj=Ae(),a8=M(),Ij=M();function qdt(e,t,r){return e*e/(Math.sqrt(e*e-t*t)*Math.sqrt(e*e-r*r)+t*r)}const kpe=gn().vec3f(O.POSITION);function Tse(e){const t=S`vec4 alignToPixelCenter(vec4 clipCoord, vec2 widthHeight) {
vec2 xy = vec2(0.500123) + 0.5 * clipCoord.xy / clipCoord.w;
vec2 pixelSz = vec2(1.0) / widthHeight;
vec2 ij = (floor(xy * widthHeight) + vec2(0.5)) * pixelSz;
vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;
return vec4(result, clipCoord.zw);
}`,r=S`vec4 alignToPixelOrigin(vec4 clipCoord, vec2 widthHeight) {
vec2 xy = vec2(0.5) + 0.5 * clipCoord.xy / clipCoord.w;
vec2 pixelSz = vec2(1.0) / widthHeight;
vec2 ij = floor((xy + 0.5 * pixelSz) * widthHeight) * pixelSz;
vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;
return vec4(result, clipCoord.zw);
}`;e.vertex.code.add(t),e.vertex.code.add(r),e.fragment.code.add(t),e.fragment.code.add(r)}function Hdt(){const e=new Qr;return e.attributes.add(O.POSITION,"vec3"),e.attributes.add(O.COLOR,"vec4"),e.attributes.add(O.SIZE,"float"),e.varyings.add("vcolor","vec4"),e.varyings.add("vsize","float"),e.vertex.uniforms.add([new Ei("transform",(t,r)=>Wdt(t,r)),new cr("viewport",(t,r)=>r.camera.fullViewport),new He("pixelRatio",(t,r)=>r.camera.pixelRatio)]),e.include(Tse),e.vertex.code.add(S`void main(void) {
vec4 posProj = transform * vec4(position, 0);
gl_Position = alignToPixelCenter(posProj, viewport.zw);
vcolor = color / 1.2;
vsize = size * 5.0 * pixelRatio;
gl_PointSize = vsize;
}`),e.fragment.code.add(S`void main() {
float cap = 0.7;
float scale = 1.0 / cap;
float helper = clamp(length(abs(gl_PointCoord - vec2(0.5))), 0.0, cap);
float alpha = clamp((cap - helper) * scale, 0.0, 1.0);
float intensity = alpha * alpha * alpha;
if (vsize < 3.0) {
intensity *= 0.5;
}
gl_FragColor = vec4(vcolor.xyz, intensity);
}`),e}function Wdt(e,t){return Ln(fb,t.camera.projectionMatrix),fb[10]=24e-8-1,fb[11]=-1,fb[14]=(24e-8-2)*t.camera.near,Zi(fb,fb,t.camera.viewMatrix),Zi(fb,fb,e.modelMatrix)}const fb=Ae(),Xdt=Object.freeze(Object.defineProperty({__proto__:null,build:Hdt},Symbol.toStringTag,{value:"Module"}));class Ydt extends as{constructor(){super(...arguments),this.modelMatrix=Ae()}}class kz extends gi{constructor(t){super(t,null,()=>this.destroy())}initializeProgram(t){const r=kz.shader.get().build();return new ai(t.rctx,r,Ur)}initializePipeline(){return jt({blending:ka(Re.SRC_ALPHA,Re.ONE,Re.ONE_MINUS_SRC_ALPHA,Re.ONE_MINUS_SRC_ALPHA),depthTest:{func:vi.LEQUAL},colorWrite:or})}}kz.shader=new si(Xdt,()=>ie(()=>import("./Stars.glsl.c0d9cca3.js"),[],import.meta.url));const Zdt=fe.getLogger("esri.views.3d.environment.Stars");let y1=class extends xe{constructor(e){super(e),this._loadDataTask=null,this._numPoints=0,this._renderParameter=new Ydt,this._updatingTracking=new tm}get updating(){return this._updatingTracking.updating||this.loading}get loading(){return _(this._loadDataTask)&&!this._loadDataTask.finished}initialize(){this._loadDataTask=this._createLoadDataTask()}destroy(){this._loadDataTask=qh(this._loadDataTask),this._updatingTracking.destroy(),this._numPoints=0,this._technique=ri(this._technique),this._vao=Qe(this._vao)}render(e){const{rctx:t}=e;if(this._ensureResources(t),R(this._technique)||R(this._vao))return;if(!this._technique.compiled)return void this.requestRender();const r=t.bindTechnique(this._technique,this._renderParameter,e.bindParameters);t.bindVAO(this._vao),r.assertCompatibleVertexAttributeLocations(this._vao),t.drawArrays(Dt.POINTS,0,this._numPoints)}_ensureResources(e){if(_(this._technique)||R(Jx))return;this._technique=new kz({rctx:e,viewingMode:this.view.state.viewingMode}),this._numPoints=Jx.byteLength/Vpe;const t=new Float32Array(Jx,0,2*this._numPoints),r=new Uint8Array(Jx,2*this._numPoints*4,this._numPoints);this._vao=this._createVertexArrayObject(e,t,r,this._numPoints),this._updatingTracking.add(()=>this.view.environment.lighting.type==="sun"?this.view.environment.lighting.date:null,i=>this._update(i),Ot)}_computeDayDuration(e){const t=e,r=new Date(e.getFullYear(),0,1,11,58,56);return(+t-+r)/(+new Date(e.getFullYear()+1,0,1,11,58,55)-+r)}_update(e){if(!e)return;const t=(e.getHours()/12+e.getMinutes()/60*(2/24)+e.getSeconds()/60*(2/1440)-.9972222)%2,r=2*this._computeDayDuration(e),i=Ln(this._renderParameter.modelMatrix,Kdt);J5(i,i,-r*Math.PI),Zi(i,Jdt,i),J5(i,i,-t*Math.PI),this.requestRender()}_hexToRGB(e){return[parseInt(e.substring(0,2),16),parseInt(e.substring(2,4),16),parseInt(e.substring(4,6),16)]}_unpackUint8Attributes(e){return e>=192?[2.9,e-192]:e>=160?[2.5,e-160]:e>=128?[2,e-128]:e>=96?[1.5,e-96]:e>=64?[1,e-64]:e>=32?[.7,e-32]:[.4,e]}_createVertexArrayObject(e,t,r,i){const n=zpe.createBuffer(i),s=n.position,a=n.color,o=n.size;for(let l=0;l<i;l++){const c=t[2*l+0],u=t[2*l+1];s.set(l,0,-Math.cos(c)*Math.sin(u)),s.set(l,1,-Math.sin(c)*Math.sin(u)),s.set(l,2,-Math.cos(u));const h=this._unpackUint8Attributes(r[l]),p=this._hexToRGB(Qdt[h[1]]);a.set(l,0,255*p[0]),a.set(l,1,255*p[1]),a.set(l,2,255*p[2]),a.set(l,3,255),o.set(l,h[0])}return new ns(e,Ur,{geometry:vd(zpe)},{geometry:dr.createVertex(e,Cr.STATIC_DRAW,n.buffer)})}_createLoadDataTask(){if(_(Jx))return null;const e=HR(async t=>{const{data:r}=await _Ve("esri/views/3d/environment/resources/stars.wsv",{responseType:"array-buffer",signal:t});this._verifyStarData(r),Jx=r});return e.promise.catch(t=>{Ui(t)||Zdt.error(t)}).then(()=>{this.destroyed||(this.requestRender(),this.notifyChange("updating"))}),e}_verifyStarData(e){if(!e)throw new k("stars:no-data-received","Failed to create stars because star catalogue is missing");const t=e.byteLength/Vpe;if(t%1!=0||t>5e4||t<5e3)throw new k("stars:invalid-data","Failed to create stars because star catalogue data is invalid")}};d([f({constructOnly:!0})],y1.prototype,"view",void 0),d([f({constructOnly:!0})],y1.prototype,"requestRender",void 0),d([f({readOnly:!0})],y1.prototype,"updating",null),d([f()],y1.prototype,"_loadDataTask",void 0),d([f()],y1.prototype,"_updatingTracking",void 0),y1=d([$("esri.views.3d.environment.Stars")],y1);const Qdt=["9bb2ff","9eb5ff","aabfff","bbccff","ccd8ff ","dae2ff","e4e9ff","eeefff","f8f6ff","fff9fb","fff5ef","fff1e5","ffeddb","ffe9d2","ffe6ca","ffe3c3","ffe0bb","ffddb4","ffdaad","ffd6a5","ffd29c","ffcc8f","ffc178","ffa94b","ff7b00"],Jdt=tie(1,0,0,0,0,.9174771405229186,.39778850739794974,0,0,-.39778850739794974,.9174771405229186,0,0,0,0,1),Kdt=tie(1,0,0,0,0,.9174771405229186,-.39778850739794974,0,0,.39778850739794974,.9174771405229186,0,0,0,0,1),Vpe=9,zpe=gn().vec3f(O.POSITION).vec4u8(O.COLOR).f32(O.SIZE);let Jx=null;var je;(function(e){e[e.MATERIAL=0]="MATERIAL",e[e.MATERIAL_ALPHA=1]="MATERIAL_ALPHA",e[e.MATERIAL_DEPTH=2]="MATERIAL_DEPTH",e[e.MATERIAL_NORMAL=3]="MATERIAL_NORMAL",e[e.MATERIAL_DEPTH_SHADOWMAP_ALL=4]="MATERIAL_DEPTH_SHADOWMAP_ALL",e[e.MATERIAL_HIGHLIGHT=5]="MATERIAL_HIGHLIGHT",e[e.MATERIAL_DEPTH_SHADOWMAP_DEFAULT=6]="MATERIAL_DEPTH_SHADOWMAP_DEFAULT",e[e.MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT=7]="MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT"})(je||(je={}));var sC;const eut=[Ee.POSTPROCESSING_ENVIRONMENT_OPAQUE,Ee.POSTPROCESSING_ENVIRONMENT_TRANSPARENT];let Upe,Jo=sC=class extends xe{constructor(e){super(e),this._handles=new Ft,this._context=null,this._pendingAtmosphere=null,this._atmosphere=null}initialize(){this.view._stage.addRenderPlugin(eut,this)}destroy(){var e;this._pendingAtmosphere=ct(this._pendingAtmosphere),((e=this.view)==null?void 0:e._stage)!=null&&this.view._stage.removeRenderPlugin(this),this._handles=ct(this._handles),this._set("view",null)}get atmosphereType(){return _(this._pendingAtmosphere)?this._pendingAtmosphere.type:_(this._atmosphere)?this._atmosphere.type:"none"}get canRender(){var e;return!!((e=this.view.basemapTerrain)!=null&&e.renderer.canRender)||this.view.viewingMode!=="global"}get needsLinearDepth(){return this._selectAtmosphereType()==="realistic"}updateAnimation(e){return!!_(this._precipitation)&&this._precipitation.update(e)}get updating(){return _(this._pendingAtmosphere)||_(this._stars)&&this._stars.updating||_(this._clouds)&&this._clouds.running}get weatherVisible(){return Oe(this.view.state.camera.eye)-Ar(this.view.spatialReference).radius<=_h}get _stars(){var i,n;const e=this.view,t=(n=(i=e.environment)==null?void 0:i.starsEnabled)!=null?n:!1,r=this._get("_stars");return!t||R(this._context)?(ct(r),null):_(r)?r:new y1({view:e,requestRender:()=>this._setNeedsRender()})}get _precipitation(){const e=this._get("_precipitation");if(!this._precipitationEnabled||R(this._context))return ct(e),null;const t=this.view,r=this._context;return _(e)&&e.context===r?e:(ct(e),new Z2({context:r,view:t}))}get _clouds(){const e=this._get("_clouds");if(!this.weatherEnabled||R(this._context))return ct(e),null;if(_(e))return e;const t=this.view,r=this._context;return ct(e),new Qo({context:r,view:t,requestRender:()=>this._setNeedsRender()})}get _cloudsComposition(){const e=this._get("_cloudsComposition");if(!this.weatherEnabled||R(this._context))return ct(e),null;const t=this.view.state.viewingMode,r=this._context.renderContext.rctx,i=Ar(this.view.spatialReference).radius;return _(e)&&e.viewingMode===t&&e.planetRadius===i?e:(ct(e),new Y2({rctx:r,viewingMode:t,planetRadius:i,requestRender:()=>this._setNeedsRender()}))}get _fog(){const e=this._get("_fog");if(!this.weatherEnabled||R(this._context))return ct(e),null;if(_(e))return e;const t=this.view,r=this._context;return ct(e),new nC({context:r,view:t})}get weatherEnabled(){var e,t;return!!((t=(e=this.view)==null?void 0:e.environmentManager)!=null&&t.weatherEnabled)}get _precipitationEnabled(){return this.weatherEnabled&&(this.view.environment.weather.type==="rainy"||this.view.environment.weather.type==="snowy")}initializeRenderContext(e=null){this._context=e,this._handles.add([Fa(()=>{var t;return(t=this.view)==null?void 0:t.basemapTerrain},()=>this._updateBasemapTerrain(),Yn),re(()=>({viewingMode:this.view.viewingMode,atmosphereEnabled:this.view.environment.atmosphereEnabled,atmosphereQuality:this.view.environment.atmosphere.quality}),()=>this._updateAtmosphere(),Yn),re(()=>this._stars,()=>this._setNeedsRender()),re(()=>this._clouds,()=>this._updateWeather(this._weatherUpdateParameters),Ot),re(()=>this._precipitation,()=>this._setNeedsRender()),re(()=>this._fog,()=>this._updateFog(this._weatherUpdateParameters),Ot),re(()=>this._weatherUpdateParameters,t=>{this._updateWeather(t),this._updateFog(t)},Yn)])}uninitializeRenderContext(){this._context=null,this._atmosphere=ct(this._atmosphere),this._set("_stars",ct(this._stars)),this._set("_precipitation",ct(this._precipitation)),this._set("_clouds",ct(this._clouds)),this._set("_cloudsComposition",ct(this._cloudsComposition)),this._set("_fog",ct(this._fog))}prepareRender(e){e.bindParameters.clouds.data=dct(this._clouds)?this._clouds:null}render(e){if(e.pass===je.MATERIAL)switch(e.bindParameters.slot){case Ee.POSTPROCESSING_ENVIRONMENT_OPAQUE:_(this._stars)&&this._stars.render(e),_(this._atmosphere)&&this._atmosphere.canRender&&(this._atmosphere.render(e),_(this._cloudsComposition)&&_(e.bindParameters.clouds.data)&&(this.weatherVisible&&_(this._clouds)&&this._clouds.ensureWeatherTile(),this._cloudsComposition.render(e,_(this.view.animation))));break;case Ee.POSTPROCESSING_ENVIRONMENT_TRANSPARENT:if(_(this._atmosphere)&&this._atmosphere.canRender){const t=this.weatherEnabled?this.view.environment.weather.type:"disabled";if(this._atmosphere.renderHaze(e,t==="rainy"),_(this._fog)){const r=t==="foggy"||t==="rainy"||t==="snowy";(r||this._selectAtmosphereType()!=="realistic")&&this._fog.render(e,r,t==="rainy")}if(_(this._precipitation)){const r=this.view.environment.weather;r.type!=="rainy"&&r.type!=="snowy"||this._precipitation.render(e,r.precipitation,r.type)}}}}get _weatherUpdateParameters(){const e=this.weatherEnabled?this.view.environment.weather:null;return R(e)?null:e.type==="rainy"||e.type==="snowy"?{type:e.type,weatherAdjustment:e.cloudCover,effect:e.precipitation}:{type:e.type,weatherAdjustment:e.type==="foggy"?e.fogStrength:e.cloudCover}}_updateWeather(e){R(e)||R(this._clouds)||(this._clouds.applyPreset(cCe[e.type],e.weatherAdjustment),this._setNeedsRender())}_setNeedsRender(){_(this._context)&&this._context.requestRender()}_updateFog(e){if(!R(this._fog)&&!R(e))switch(e.type){case"foggy":this._fog.strength=Kt(3e-5,.005,e.weatherAdjustment**3),this._setNeedsRender();break;case"rainy":case"snowy":this._fog.strength=Kt(4e-6,2e-4,e.effect**3),this._setNeedsRender();break;default:this._fog.strength=4e-6,this._setNeedsRender()}}_updateAtmosphere(){const e=this._selectAtmosphereType();if(this.atmosphereType===e)return;_(this._pendingAtmosphere)&&(this._pendingAtmosphere!==this._atmosphere&&this._pendingAtmosphere.destroy(),this._pendingAtmosphere=null);const t=this._getAtmosphereClass();if(!t)return _(this._atmosphere)&&(this._atmosphere.destroy(),this._atmosphere=null,this._setNeedsRender()),void this._updateBasemapTerrain();const r=new t(this.view);_(this._context)&&r.initializeRenderContext(this._context),R(this._atmosphere)&&(this._atmosphere=r,this._setNeedsRender()),this._pendingAtmosphere=r,r.when().then(()=>{_(this._atmosphere)&&this._pendingAtmosphere&&this._pendingAtmosphere!==this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=this._pendingAtmosphere),this._pendingAtmosphere=null,this._setNeedsRender(),this._updateBasemapTerrain()}).catch(()=>{this._pendingAtmosphere===r&&(this._pendingAtmosphere=null)})}_getAtmosphereClass(){switch(this._selectAtmosphereType()){case"none":return null;case"realistic":return gpe;case"panoramic":return Ldt;case"simple":return jdt;default:return}}_selectAtmosphereType(){const e=this.view.get("environment.atmosphereEnabled"),t=this.view.get("environment.atmosphere.quality"),r=this.view.viewingMode;return!e||t==null||Em(this.view.spatialReference)?"none":r==="local"?"panoramic":t==="high"&&_(this._context)&&gpe.isSupported(this._context)&&nA(this.view.spatialReference)?"realistic":"simple"}_updateBasemapTerrain(){this.view.basemapTerrain&&(this.view.basemapTerrain.velvetOverground=_(this._atmosphere)&&this.atmosphereType==="simple")}get test(){return{atmosphere:this._atmosphere,clouds:this._clouds,selectAtmosphereType:()=>this._selectAtmosphereType(),stubGetAtmosphereClass:e=>{Upe=sC.prototype._getAtmosphereClass,sC.prototype._getAtmosphereClass=e},restoreGetAtmosphereClass:()=>{sC.prototype._getAtmosphereClass=Upe}}}};d([f({constructOnly:!0})],Jo.prototype,"view",void 0),d([f({type:Boolean,readOnly:!0})],Jo.prototype,"updating",null),d([f({readOnly:!0})],Jo.prototype,"weatherVisible",null),d([f()],Jo.prototype,"_context",void 0),d([f()],Jo.prototype,"_pendingAtmosphere",void 0),d([f({readOnly:!0})],Jo.prototype,"_stars",null),d([f({readOnly:!0})],Jo.prototype,"_precipitation",null),d([f({readOnly:!0})],Jo.prototype,"_clouds",null),d([f({readOnly:!0})],Jo.prototype,"_cloudsComposition",null),d([f({readOnly:!0})],Jo.prototype,"_fog",null),d([f({readOnly:!0})],Jo.prototype,"weatherEnabled",null),d([f({readOnly:!0})],Jo.prototype,"_precipitationEnabled",null),d([f({readOnly:!0})],Jo.prototype,"_weatherUpdateParameters",null),Jo=sC=d([$("esri.views.3d.environment.EnvironmentRenderer")],Jo);function Bpe(e,t,r){return tut(e,t.longitude,t.latitude,r.longitude,r.latitude)}function tut(e,t,r,i,n){const s=kt(r),a=kt(n),o=s-a,l=kt(t)-kt(i),c=Math.sin(o/2),u=Math.sin(l/2),h=2*Pp(Math.sqrt(c*c+Math.cos(s)*Math.cos(a)*u*u))*e;return Math.round(1e4*h)/1e4}function rut(e,t,r){const i=t.spatialReference,n=Ar(i),s=new ot(t.x,e.y,i),a=new ot(r.x,e.y,i),o=new ot(e.x,t.y,i),l=new ot(e.x,r.y,i);return{lon:Bpe(n.radius,s,a),lat:Bpe(n.radius,o,l)}}function iut(e,t,r){const i=t/r,n=kt(e),s=Math.sin(i/2),a=Math.cos(n),o=2*Pp(Math.sqrt(s*s/(a*a)));return md(o)}function nut(e,t){let r=e/15;return t||(r=Math.round(r)),r}function Gpe(e,t){t||(t={hours:0,minutes:0,seconds:0}),t.hours=nut(e[0],!0);const r=t.hours%1;t.hours-=r,t.minutes=60*r;const i=t.minutes%1;return t.minutes-=i,t.seconds=Math.round(60*i),t}var jpe,qpe,Hpe,SCe={exports:{}};jpe=SCe,qpe=function(){var e=Math.PI,t=Math.sin,r=Math.cos,i=Math.tan,n=Math.asin,s=Math.atan2,a=Math.acos,o=e/180,l=864e5,c=2440588,u=2451545,h={dec:0,ra:0};function p(D){return D.valueOf()/l-.5+c}function m(D){return new Date((D+.5-c)*l)}function g(D){return p(D)-u}var b=23.4397*o;function w(D,F){return s(t(D)*r(b)-i(F)*t(b),r(D))}function v(D,F){return n(t(F)*r(b)+r(F)*t(b)*t(D))}function x(D,F,U){return s(t(D),r(D)*t(F)-i(U)*r(F))}function T(D,F,U){return n(t(F)*t(U)+r(F)*r(U)*r(D))}function E(D,F){return o*(280.16+360.9856235*D)-F}function C(D){return o*(357.5291+.98560028*D)}function A(D){return o*(1.9148*t(D)+.02*t(2*D)+3e-4*t(3*D))}function P(D,F){return D+F+102.9372*o+e}function I(D,F){var U=C(D),j=P(U,A(U));return F||(F={dec:0,ra:0}),F.dec=v(j,0),F.ra=w(j,0),F}var L={PolarException:{NORMAL:0,MIDNIGHT_SUN:1,POLAR_NIGHT:2},getPosition:function(D,F,U,j){var W=o*-U,Z=o*F,q=g(D),ee=I(q,h),me=E(q,W)-ee.ra;return j||(j={azimuth:0,altitude:0}),j.azimuth=x(me,Z,ee.dec),j.altitude=T(me,Z,ee.dec),j}},V=[[-.83,"sunrise","sunset"]];L.addTime=function(D,F,U){V.push([D,F,U])};var G=9e-4;function B(D,F){return Math.round(D-G-F/(2*e))}function X(D,F,U){return G+(D+F)/(2*e)+U}function Y(D,F,U){return u+D+.0053*t(F)-.0069*t(2*U)}function ce(D,F,U){return a((t(D)-t(F)*t(U))/(r(F)*r(U)))}function se(D){var F=o*(134.963+13.064993*D),U=o*(93.272+13.22935*D),j=o*(218.316+13.176396*D)+6.289*o*t(F),W=5.128*o*t(U),Z=385001-20905*r(F);return{ra:w(j,W),dec:v(j,W),dist:Z}}return L.getTimes=function(D,F,U){var j=o*-U,W=o*F,Z=B(g(D),j),q=X(0,j,Z),ee=C(q),me=A(ee),_e=P(ee,me),De=v(_e,0),be=Y(q,ee,_e);function ye(jr){return Y(X(ce(jr,W,De),j,Z),ee,_e)}function Ce(jr){var Qi=(t(jr)-t(W)*t(De))/(r(W)*r(De));return Qi<-1?L.PolarException.MIDNIGHT_SUN:Qi>1?L.PolarException.POLAR_NIGHT:L.PolarException.NORMAL}var Ne,Fr,Br,hr,Gr,mr={solarNoon:m(be),nadir:m(be-.5),polarException:L.PolarException.NORMAL};for(Ne=0,Fr=V.length;Ne<Fr;Ne+=1)Gr=be-((hr=ye((Br=V[Ne])[0]*o))-be),mr[Br[1]]=m(Gr),mr[Br[2]]=m(hr);return mr.polarException=Ce(V[0][0]*o),mr},L.getMoonPosition=function(D,F,U){var j=o*-U,W=o*F,Z=g(D),q=se(Z),ee=E(Z,j)-q.ra,me=T(ee,W,q.dec);return me+=.017*o/i(me+10.26*o/(me+5.1*o)),{azimuth:x(ee,W,q.dec),altitude:me,distance:q.dist}},L.getMoonFraction=function(D){var F=g(D),U=I(F),j=se(F),W=149598e3,Z=a(t(U.dec)*t(j.dec)+r(U.dec)*r(j.dec)*r(U.ra-j.ra)),q=s(W*t(Z),j.dist-W*r(Z));return(1+r(q))/2},L},(Hpe=qpe())!==void 0&&(jpe.exports=Hpe);const rx=SCe.exports,k0={local:{altitude:1500,ambientAtNight:.1,ambientAtNoon:.45,ambientAtTwilight:.2,directAtNoon:.65,directAtTwilight:.7},global:{altitude:8e5,ambient:.015,direct:.75},planarDirection:{localAltitude:1e4,globalAltitude:1e6,globalAngles:{azimuth:1.3*Math.PI,altitude:.6*Math.PI}}};function sut(e,t,r,i,n,s,a){ne(a.ambient.color,1,1,1),a.ambient.intensity=k0.global.ambient,ne(a.direct.color,1,1,1),a.direct.intensity=k0.global.direct;const o=t[2],l=Le((Math.abs(o)-k0.local.altitude)/(k0.global.altitude-k0.local.altitude),0,1);let c;if(a.globalFactor=l,s==="sun"&&(c=rx.getTimes(e,t[1],t[0])),l<1){let u;if(s==="sun")u=fut(e,c,i);else{const h=CCe(i);u={direct:{intensity:k0.local.directAtNoon*h.direct,color:Ve(1,1,1)},ambient:{intensity:k0.local.ambientAtNoon*h.ambient,color:Ve(1,1,1)},timeOfDay:"early afternoon"}}As(a.ambient.color,u.ambient.color,a.ambient.color,l),a.ambient.intensity=Kt(u.ambient.intensity,a.ambient.intensity,l),As(a.direct.color,u.direct.color,a.direct.color,l),a.direct.intensity=Kt(u.direct.intensity,a.direct.intensity,l),a.specularStrength=i==="rainy"||i==="snowy"||i==="foggy"?0:1,a.environmentStrength=i==="rainy"?.7:i==="snowy"||i==="foggy"?.75:1}a.noonFactor=s==="sun"?hut(e,c):1,s==="sun"?out(e,t,r,a.direct.directionToLightSource):aut(n,r,a.direct.directionToLightSource)}function aut(e,t,r){t===Be.Global?we($j,e.eye):ne($j,0,0,1),le(Lj,e.viewForward,-1);const i=mL(Lj,$j),n=Math.max(i-2*Dj,0),s=.85*n/(n+1),a=Math.max(Dj,i-Dj-s);Cu(Xpe,-a,e.viewRight),ze(r,Lj,Xpe),he(r,r,le(put,e.viewRight,mut)),we(r,r)}function out(e,t,r,i){const n=uut,s=pm(dut);if(r===Be.Global)rx.getPosition(e,0,0,n),ne(i,0,0,-1),Q5(s,s,-n.azimuth),FV(s,s,-n.altitude),ze(i,i,s);else{const a=k0.planarDirection,o=a.globalAngles,l=t[2];let c=(Math.abs(l)-a.localAltitude)/(a.globalAltitude-a.localAltitude);c=Le(c,0,1),c<1?(rx.getPosition(e,t[1],t[0],n),n.azimuth=(1-c)*n.azimuth+c*o.azimuth,n.altitude=(1-c)*n.altitude+c*o.altitude):(n.azimuth=o.azimuth,n.altitude=o.altitude),ne(i,0,-1,0),J5(s,s,-n.azimuth),Q5(s,s,-n.altitude),ze(i,i,s)}}function lut(e,t){if(t===Be.Global)return!0;const r=k0.planarDirection;return Math.abs(e)<r.localAltitude}const cut=Ve(.5773502691896258,-.5773502691896258,.5773502691896258);class ECe{constructor(){this.ambient={color:Ve(1,1,1),intensity:.55},this.direct={color:Ve(1,1,1),intensity:.55,directionToLightSource:Kn(cut)},this.noonFactor=.5,this.globalFactor=0,this.specularStrength=1,this.environmentStrength=1}}const dut=Ae(),uut={azimuth:0,altitude:0};function hut(e,t){const r=e.valueOf();let i,n;t.polarException===rx.PolarException.MIDNIGHT_SUN?(i=r-60*(e.getHours()+48)*60*1e3-60*e.getMinutes()*1e3,n=i+432e6):t.polarException===rx.PolarException.POLAR_NIGHT?(i=r-2,n=r-1):(i=t.sunrise.valueOf(),n=t.sunset.valueOf());const s=i+(n-i)/2;return 1-Le(Math.abs(r-s)/432e5,0,1)}function CCe(e){switch(e){case"disabled":case"sunny":case"cloudy":return{direct:1,ambient:1};case"rainy":return{direct:.4,ambient:1.2};case"snowy":return{direct:.5,ambient:1.3};case"foggy":return{direct:.2,ambient:1.6}}}function Wpe(e,t){const r=(e[0]+e[1]+e[2])/3;for(let i=0;i<3;i++)e[i]=e[i]+(r-e[i])*t;return e}function fut(e,t,r){const i=e.valueOf();let n,s;t.polarException===rx.PolarException.MIDNIGHT_SUN?(n=i-60*(e.getHours()+48)*60*1e3-60*e.getMinutes()*1e3,s=n+432e6):t.polarException===rx.PolarException.POLAR_NIGHT?(n=i-2,s=i-1):(n=t.sunrise.valueOf(),s=t.sunset.valueOf());const a=s-n,o=n+a/2,l=a/4,c=o-l,u=o+l,h=.06*a,p=n-h/2,m=n+h/2,g=s-h/2,b=s+h/2,w=k0.local,v=[.01,w.ambientAtNight],x=[.8,.8,1],T=[.01,.01,.01],E=[w.directAtTwilight,w.ambientAtTwilight],C=[1,.6,.5],A=[.8,.8,1],P=[.9*w.directAtNoon,w.ambientAtNoon],I=[1,.98,.98],L=[.98,.98,1],V=[w.directAtNoon,w.ambientAtNoon],G=[1,1,1],B=[1,1,1],X=P,Y=I,ce=L,se=E,D=C,F=A;let U,j,W=[0,0],Z=[0,0,0],q=[0,0,0];i<p||i>b?(W=v,Z=T,q=x,j="night"):i<m?(U=m-p,W=Ba(i-p,U,v,E),Z=Ba(i-p,U,T,C),q=Ba(i-p,U,x,A),j="sun rising"):i<c?(U=c-m,W=Ba(i-m,U,E,P),Z=Ba(i-m,U,C,I),q=Ba(i-m,U,A,L),j="early morning"):i<o?(U=o-c,W=Ba(i-c,U,P,V),Z=Ba(i-c,U,I,G),q=Ba(i-c,U,L,B),j="late morning"):i<u?(U=u-o,W=Ba(i-o,U,V,X),Z=Ba(i-o,U,G,Y),q=Ba(i-o,U,B,ce),j="early afternoon"):i<g?(U=g-u,W=Ba(i-u,U,X,se),Z=Ba(i-u,U,Y,D),q=Ba(i-u,U,ce,F),j="late afternoon"):i<b&&(U=b-g,W=Ba(i-g,U,se,v),Z=Ba(i-g,U,D,T),q=Ba(i-g,U,F,x),j="sun setting");let ee=0;switch(r){case"rainy":case"foggy":ee=.9;case"snowy":ee=.5}ee>0&&(Z=Wpe(Z,ee),q=Wpe(q,ee));const me=Ve(Z[0],Z[1],Z[2]),_e=Ve(q[0],q[1],q[2]),De=CCe(r);return{direct:{intensity:W[0]*De.direct,color:me},ambient:{intensity:W[1]*De.ambient,color:_e},timeOfDay:j}}function Ba(e,t,r,i){const n=[];for(let s=0;s<r.length;s++)n[s]=(i[s]-r[s])*e/t+r[s];return n}const Xpe=Ae(),$j=M(),Lj=M(),put=M(),Dj=.25,mut=.2;let Nf=class extends mn.EventedAccessor{constructor(){super(),this._referencePointUpdateDelay=200,this._referencePointUpdateInterval=3e3,this._referencePointUpdateDistThreshold=1e6,this._referencePosUpdateQuery=null,this._referencePosMapCoordsRequested=null,this._viewHandles=new Ft,this._preserveAbsoluteDateTime=!1,this._trackingEnabled=!1,this._referencePosResetPreserveAbsoluteTime=!1,this._referencePosUpdateTimer=null,this._referencePosMapCoords=null,this._mainLight=new $J,this._ambientLight=new yse,this._moonLight=new hCe,this.disableQueries=!1,this._disableWeather=!1,this._renderer=null,this._referencePosWGS84Comparable=null,this._resetReferencePosition()}destroy(){this.disconnectView(),this._viewHandles.destroy()}get _view(){var e;return(e=this._renderer)==null?void 0:e.view}get updating(){var e;return!((this.disableQueries||!this._referencePosUpdateQuery&&!this._referencePosMapCoordsRequested)&&!((e=this._renderer)!=null&&e.updating))}get weatherEnabled(){var e,t,r;return((e=this._view)==null?void 0:e.environment.atmosphereEnabled)&&!this._disableWeather&&((r=(t=this._view)==null?void 0:t.state)==null?void 0:r.viewingMode)===Be.Global&&nA(this._view.spatialReference)}get weatherVisible(){var e;return this.weatherEnabled&&((e=this._renderer)==null?void 0:e.weatherVisible)}get referencePositionWGS84Comparable(){return this._referencePosWGS84Comparable}connectView(e){if(this._renderer)return;this._renderer=new Jo({view:e});const t=()=>this._updateRenderParameters(),r=()=>this._cameraHandler(),i=()=>this._updateLighting();this._viewHandles.add([re(()=>e.environment.lighting,n=>this._updateLightingHandler(n),ti),re(()=>e.environment.lighting.type==="sun"?e.environment.lighting.date:null,n=>this._lightingDateHandler(n),ti),re(()=>e.stationary,()=>this._interactingStationaryHandler()),re(()=>e.environment.lighting.directShadowsEnabled,t,ti),re(()=>e.environment.lighting.ambientOcclusionEnabled,t,ti),re(()=>e.environment.lighting.waterReflectionEnabled,t,ti),re(()=>{var n;return(n=e.environment.background)==null?void 0:n.color},t,ti),re(()=>e.spatialReference,()=>this._resetReferencePosition(!0),ti),re(()=>e.environment.weather.type,i,ti),re(()=>this.weatherEnabled,i,ti),re(()=>e.viewingMode,()=>this._resetReferencePosition(!0),Yn),re(()=>e.environment.lighting.type==="sun"&&e.environment.lighting.cameraTrackingEnabled,n=>this._updateCameraTracking(n),Yn),re(()=>e.state.camera,r,Yn),re(()=>this.disableQueries,r)]),this._updateRenderParameters(),this._updateLighting(),this._cameraHandler(),this.notifyChange("updating")}disconnectView(){this._viewHandles.removeAll(),this._resetReferencePosition(),this._renderer=ct(this._renderer)}_updateLightingHandler(e){this._updateCameraTracking(e.type==="sun"&&e.cameraTrackingEnabled),this._lightingDateHandler(e.type==="sun"?e.date:null),this._updateRenderParameters()}_updateCameraTracking(e){if(this._trackingEnabled=e,e)this._cameraHandler();else{const t=this._view.environment.lighting;(t==null?void 0:t.type)==="sun"&&(t.positionTimezoneInfo.autoUpdated=!1)}}_lightingDateHandler(e){const t=this._view.environment.lighting;if((t==null?void 0:t.type)!=="virtual"){if(e){if(!t.positionTimezoneInfo.autoUpdated){this._preserveAbsoluteDateTime=!0;const r=this._view.spatialReference;if(!kw(r)){const i=this._view.camera.position;if(!this._referencePosMapCoords||!this._referencePosMapCoords.equals(i))return void this._requestReferencePositionUpdate(i)}if(this._preupdateTracking(e),_(this._referencePosWGS84Comparable)){const i=Gpe(this._referencePosWGS84Comparable,Ype);_(i)&&(t.autoUpdate(null,i),this._trackingEnabled&&(t.positionTimezoneInfo.autoUpdated=!0))}}this._updateLighting(e)}}else this._updateLighting()}_preupdateTracking(e){!this._trackingEnabled&&this._view.environment.lighting.type==="sun"&&this._view.environment.lighting.cameraTrackingEnabled&&this._cameraHandler(e)}_cameraHandler(e=null){const t=this._view;if(!t.ready)return;const r=t.stateManager.camera;r&&(this._cameraHandlerClientSide(r,e)||this._cameraHandlerServerSide(r))}_cameraHandlerClientSide(e,t){const r=nA(this._view.spatialReference);if(r&&!kw(this._view.spatialReference))return!1;const i=e.position;return R(this._referencePosWGS84Comparable)&&(this._referencePosWGS84Comparable=M()),r?Lje(i,this._referencePosWGS84Comparable):ne(this._referencePosWGS84Comparable,i.longitude,i.latitude,i.z),this.notifyChange("referencePositionWGS84Comparable"),this._autoUpdateTimezone(this._referencePosWGS84Comparable,t)||this._updateLighting(t),!0}_cameraHandlerServerSide(e){const t=e.position;(!this._referencePosMapCoords||this._referencePosMapCoordsRequested||this._exceedsReferencePosDistThreshold(t))&&this._requestReferencePositionUpdate(t,!0),this._view.mapCoordsHelper&&this._referencePosWGS84Comparable&&(this._referencePosWGS84Comparable[2]=t.z*this._view.mapCoordsHelper.unitInMeters,this._referencePosChanged())}_interactingStationaryHandler(){this._view.stationary&&this._executePendingReferencePositionUpdate()}_updateLighting(e){const t=this._view,r=e||(t.environment.lighting.type==="sun"?t.environment.lighting.date:null),i=this._referencePosWGS84Comparable,n=_(i)?gut:yut;if(_(i)){const u=this.weatherVisible?t.environment.weather.type:"disabled";sut(r,i,t.state.viewingMode,u,t.state.camera,t.environment.lighting.type,n)}const s=this._mainLight,a=n.direct;le(s.intensity,a.color,a.intensity*Math.PI),oe(s.direction,a.directionToLightSource),s.specularStrength=n.specularStrength,s.environmentStrength=n.environmentStrength;const o=this._ambientLight;le(o.intensity,n.ambient.color,n.ambient.intensity);const l=this._moonLight;As(l.intensity,vut,_ut,n.globalFactor);const c=(1-.5*n.globalFactor)*(1-.4*n.noonFactor*(1-n.globalFactor));le(l.intensity,l.intensity,c),oe(l.direction,a.directionToLightSource),t._stage.renderView.updateLightSources([s,o,l],1-n.noonFactor,n.globalFactor),this._updateRenderParameters()}_autoUpdateTimezone(e,t=null){if(this._view.environment.lighting.type==="virtual"||!this._view.environment.lighting.cameraTrackingEnabled||R(e))return!1;const r=but;r.setTime((t||this._view.environment.lighting.date).getTime());const i=Gpe(e,Ype);if(R(i))return!1;let n=this._view.environment.lighting.positionTimezoneInfo;if(n.autoUpdated){if(n.hours===i.hours&&n.minutes===i.minutes&&n.seconds===i.seconds)return!1}else n=i;const s=r.getUTCHours()-(i.hours-n.hours),a=r.getUTCMinutes()-(i.minutes-n.minutes),o=r.getUTCSeconds()-(i.seconds-n.seconds);return r.setUTCHours(s),r.setUTCMinutes(a),r.setUTCSeconds(o),!t&&this._view.environment.lighting.autoUpdate(r,i)}_updateRenderParameters(){const e=this._view._stage;if(!e)return;const t=tu(this._referencePosWGS84Comparable,!0,n=>lut(n[2],this._view.state.viewingMode)),r=this._view.environment.background,i=r instanceof yEe?{type:"color",color:rie(Te.toUnitRGBA(r.color))}:{type:"color",color:Tr(0,0,0,1)};e.renderView.setRenderParameters({shadowMap:this._view.environment.lighting.directShadowsEnabled&&t,background:i,environment:this._view.environment,weatherVisible:this._view.environmentManager.weatherVisible})}_resetReferencePosition(e=!1){this._cancelReferencePosUpdates(),this._referencePosMapCoords=null,this._referencePosMapCoordsRequested=null,this._referencePosResetPreserveAbsoluteTime=null,this._referencePosWGS84Comparable=null,this.notifyChange("updating"),e&&this._cameraHandler()}_requestReferencePositionUpdate(e,t=!1){if(!this.disableQueries&&(this._referencePosMapCoordsRequested?this._referencePosMapCoordsRequested.copy(e):this._referencePosMapCoordsRequested=e.clone(),this._referencePosResetPreserveAbsoluteTime=!!t,!this._referencePosUpdateQuery&&!this._referencePosUpdateTimer&&this._view.stationary)){const r=this._referencePosUpdateQuery=O5(this._referencePointUpdateDelay).then(()=>{if(this._referencePosUpdateQuery===r){const n=()=>this._referencePosUpdateQuery!==r;return this._doReferencePositionUpdateQuery(n)}}).catch(n=>{n.name==="mapcoordshelper:missing-geometry-service"&&(this.disableQueries=!0)}).then(()=>{this._referencePosUpdateQuery===r&&(this._referencePosUpdateQuery=null,this._referencePosUpdateTimer||this._executePendingReferencePositionUpdate(),this.notifyChange("updating"))}),i=this._referencePosUpdateTimer=O5(this._referencePointUpdateInterval).then(()=>{this._referencePosUpdateTimer===i&&(this._referencePosUpdateTimer=null,this._referencePosUpdateQuery||this._executePendingReferencePositionUpdate())});this.notifyChange("updating")}}async _doReferencePositionUpdateQuery(e){this._referencePosResetPreserveAbsoluteTime&&(this._preserveAbsoluteDateTime=!1),this._referencePosMapCoords?this._referencePosMapCoords.copy(this._referencePosMapCoordsRequested):this._referencePosMapCoords=this._referencePosMapCoordsRequested.clone(),this._referencePosResetPreserveAbsoluteTime=null,this._referencePosMapCoordsRequested=null;const t=await this._view.mapCoordsHelper.toGeographic(this._referencePosMapCoords);if(!e()&&!isNaN(t[0])&&!isNaN(t[1])){const r=this._referencePosMapCoords.z*this._view.mapCoordsHelper.unitInMeters;this._referencePosWGS84Comparable?(this._referencePosWGS84Comparable[0]=t[0],this._referencePosWGS84Comparable[1]=t[1],this._referencePosWGS84Comparable[2]=r):this._referencePosWGS84Comparable=[t[0],t[1],r],this._referencePosChanged()}}_executePendingReferencePositionUpdate(){const e=this._referencePosMapCoordsRequested;e&&this._requestReferencePositionUpdate(e,this._referencePosResetPreserveAbsoluteTime)}_referencePosChanged(){this._preserveAbsoluteDateTime?this._updateLighting():this._autoUpdateTimezone(this._referencePosWGS84Comparable)||this._updateLighting(),this.notifyChange("referencePositionWGS84Comparable")}_exceedsReferencePosDistThreshold(e){if(this._referencePosMapCoords){let t=this._referencePosMapCoords.distance(e);return this._view.mapCoordsHelper&&(t*=this._view.mapCoordsHelper.unitInMeters),t>this._referencePointUpdateDistThreshold}return!0}_cancelReferencePosUpdates(){const e=!!this._referencePosUpdateQuery;return this._referencePosUpdateQuery=null,this._referencePosUpdateTimer=null,e}get test(){const e=this;return{get renderer(){return e._renderer},set referencePointUpdateInterval(t){e._referencePointUpdateInterval=t},set referencePointUpdateDistThreshold(t){e._referencePointUpdateDistThreshold=t},set referencePosUpdateTimer(t){e._referencePosUpdateTimer=t},set referencePointUpdateDelay(t){e._referencePointUpdateDelay=t},set disableWeather(t){e._disableWeather=t}}}};d([f({type:Boolean,readOnly:!0})],Nf.prototype,"updating",null),d([f()],Nf.prototype,"disableQueries",void 0),d([f()],Nf.prototype,"_disableWeather",void 0),d([f()],Nf.prototype,"weatherEnabled",null),d([f()],Nf.prototype,"weatherVisible",null),d([f()],Nf.prototype,"referencePositionWGS84Comparable",null),d([f()],Nf.prototype,"_renderer",void 0),d([f()],Nf.prototype,"_referencePosWGS84Comparable",void 0),Nf=d([$("esri.views.3d.environment.SceneViewEnvironmentManager")],Nf);const gut=new ECe,yut=new ECe,but=new Date,Ype={hours:0,minutes:0,seconds:0},vut=Ve(.22,.22,.33),_ut=Ve(.22,.22,.22);function eR(e,t){return(e&t)!=0}function jN(e,t,r,i,n,s){e!==0&&(r?(s.min=Math.min(s.min,t),s.max=Math.max(s.max,t)):i!=null?(s.min-=Math.max(0,(t-s.min)*(1-i)),s.max+=Math.max(0,(t-s.max)*(1-i))):n&&(s.min-=Math.max(0,t-s.min-n),s.max+=Math.max(0,t-s.max-n)))}var Ht,Ti,aa;(function(e){e[e.NONE=0]="NONE",e[e.ZOOM=1]="ZOOM",e[e.TUMBLE=2]="TUMBLE",e[e.LOOK_AROUND=3]="LOOK_AROUND",e[e.PAN=4]="PAN",e[e.ASCEND=5]="ASCEND"})(Ht||(Ht={})),function(e){e[e.NONE=0]="NONE",e[e.TILT=1]="TILT",e[e.ALTITUDE=2]="ALTITUDE",e[e.DISTANCE=4]="DISTANCE",e[e.COLLISION=8]="COLLISION",e[e.ALL=15]="ALL",e[e.ALL_EXCEPT_COLLISION=7]="ALL_EXCEPT_COLLISION"}(Ti||(Ti={})),function(e){e[e.TUMBLE=0]="TUMBLE",e[e.LOOK_AROUND=1]="LOOK_AROUND"}(aa||(aa={}));const n_={selection:Ti.NONE,interactionType:Ht.NONE,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:aa.TUMBLE};function ACe(e,t,r,i){return t=t||e.viewForward,oe(i,t),le(i,i,Math.sign(Se(t,r))),i}function wut(e,t,r,i){return Cut(e,t,r,Sut(i,t,r,!0))}function xut(e,t,r,i){const n=Se(r,pe(e,i,t));return he(e,t,le(e,r,n))}const Tut={dir:M(),len:0,clip:it()};function Sut(e,t,r,i){const n=Tut;return e?(r&&i&&(n.len=fi(t,r)),oe(n.dir,e)):i?(n.len=fi(t,r),pe(n.dir,r,t),le(n.dir,n.dir,1/n.len)):(pe(n.dir,r,t),we(n.dir,n.dir)),n}function Eut(e,t,r){const i=Se(e,r.dir),n=-di(e,t);if(n<0&&i>=0)return!1;if(i>-1e-6&&i<1e-6)return n>0;if((n<0||i<0)&&!(n<0&&i<0))return!0;const s=n/i;return i>0?s<r.clip[1]&&(r.clip[1]=s):s>r.clip[0]&&(r.clip[0]=s),r.clip[0]<=r.clip[1]}function Cut(e,t,r,i){i.clip[0]=0,i.clip[1]=r?i.len:Number.MAX_VALUE;for(let n=0;n<e.length;n++)if(!Eut(e[n],t,i))return!1;return!0}function Aut(e,t,r=n_){const i=Sse(e,t,r);if(i===0)return!1;const n=e.renderCoordsHelper,s=n.getAltitude(t.eye)+i,a=ACe(t,r.interactionDirection,Mut(e,t,Math.sign(i),Lut),$ut),o=oe(Dut,t.viewForward),l=n.intersectInfiniteManifold(Ru(t.eye,a),s,Fj);return t.eye=_(l)?l:n.setAltitude(Fj,s,t.eye),t.center=xut(Fj,t.eye,o,t.center),!0}function Sse(e,t,r=n_){if(!Rut(e,r))return 0;const i=Put(e.state.constraints.altitude,Iut);Out(e,r,i);const n=e.renderCoordsHelper.getAltitude(t.eye),s=Le(n,i.min,i.max)-n;return Math.abs(s)<=1e-6?0:s}function Rut(e,t){const r=e.state.constraints.altitude;return!(!e.state.isGlobal||!r)&&(t.interactionType!==Ht.TUMBLE||!eR(t.selection,Ti.TILT))}function Out(e,t,r){const i=t.interactionType;if(i===Ht.NONE)return;const{min:n,max:s}=r,{interactionStartCamera:a,interactionFactor:o}=t,l=i===Ht.TUMBLE||i===Ht.ZOOM,c=Sse(e,a),u=c===0?0:e.renderCoordsHelper.getAltitude(a.eye);r.min=n,r.max=s,jN(c,u,l,o,.05*u,r)}function Mut(e,t,r,i){return e.renderCoordsHelper.worldUpAtPosition(t.eye,i),le(i,i,r),i}function Put(e,t){return t.min=e.min,t.max=e.max,t}const Iut={min:0,max:0},$ut=M(),Lut=M(),Dut=M(),Fj=M();function Ese(e,t,r=n_){if(!e.state.isLocal)return 0;const i=e.state.constraints.distance;if(!e.pointsOfInterest.surfaceOrigin.renderLocation||i===1/0)return 0;AP.min=0,AP.max=i,Nut(e,r,AP);const n=Cse(e,t),s=AP.max-n;return s>=-1e-6?0:s}function Fut(e,t,r=n_){const i=Ese(e,t,r);if(i===0)return!1;const n=e.pointsOfInterest.surfaceOrigin,s=Cse(e,t)+i,a=oe(Vut,t.eye),o=ACe(t,r.interactionDirection,kut(e,t,But),Uut);if(!y_(gSe(n.renderLocation,s),Ru(t.eye,o),RP))return!1;t.eye=RP;const l=pe(zut,t.eye,a);t.center=he(RP,t.center,l);const c=e.renderCoordsHelper.getAltitude(t.center),u=e.renderCoordsHelper.intersectInfiniteManifold(t.ray,c,RP);return _(u)&&(t.center=u),!0}function Nut(e,t,r){const i=t.interactionType;if(i===Ht.NONE)return;const{min:n,max:s}=r,{interactionStartCamera:a,interactionFactor:o}=t,l=i===Ht.ZOOM||i===Ht.PAN,c=Ese(e,a),u=c===0?0:Cse(e,a);r.min=n,r.max=s,jN(c,u,l,o,.05*u,r)}function Cse(e,t){const r=e.pointsOfInterest.surfaceOrigin;return fi(t.eye,r.renderLocation)}function kut(e,t,r){const i=e.pointsOfInterest.surfaceOrigin;return By(r,t.eye,i.renderLocation)}const AP={min:0,max:0},Vut=M(),zut=M(),Uut=M(),But=M(),RP=M();var Wi,Da;(function(e){e[e.OBJECT=0]="OBJECT",e[e.HUD=1]="HUD",e[e.TERRAIN=2]="TERRAIN",e[e.OVERLAY=3]="OVERLAY",e[e.I3S=4]="I3S",e[e.PCL=5]="PCL",e[e.LOD=6]="LOD",e[e.VOXEL=7]="VOXEL"})(Wi||(Wi={}));class Gut{constructor(){this.verticalOffset=0,this.selectionMode=!1,this.hud=!0,this.selectOpaqueTerrainOnly=!0,this.invisibleTerrain=!1,this.backfacesTerrain=!0,this.isFiltered=!1,this.store=Da.ALL}}(function(e){e[e.MIN=0]="MIN",e[e.MINMAX=1]="MINMAX",e[e.ALL=2]="ALL"})(Da||(Da={}));function Lm(e){return _(e)&&_(e.dist)}function Zpe(e){return(t,r,i)=>(As(Qpe,t,r,i),!uie(e,Qpe))}function Vz(e){return Lm(e)&&e.intersector===Wi.OBJECT&&!!e.target}function zz(e){return Lm(e)&&e.intersector===Wi.HUD&&!!e.target&&_(e.target.center)}const Qpe=M();class jut{constructor(){this._transform=Ae(),this._transformInverse=new OP({value:this._transform},Rn,Ae),this._transformInverseTranspose=new OP(this._transformInverse,hc,Ae),this._transformTranspose=new OP({value:this._transform},hc,Ae),this._transformInverseRotation=new OP({value:this._transform},tCe,Li)}_invalidateLazyTransforms(){this._transformInverse.invalidate(),this._transformInverseTranspose.invalidate(),this._transformTranspose.invalidate(),this._transformInverseRotation.invalidate()}get transform(){return this._transform}get inverse(){return this._transformInverse.value}get inverseTranspose(){return this._transformInverseTranspose.value}get inverseRotation(){return this._transformInverseRotation.value}get transpose(){return this._transformTranspose.value}setTransformMatrix(t){Ln(this._transform,t)}multiplyTransform(t){Zi(this._transform,this._transform,t)}set(t){Ln(this._transform,t),this._invalidateLazyTransforms()}setAndInvalidateLazyTransforms(t,r){this.setTransformMatrix(t),this.multiplyTransform(r),this._invalidateLazyTransforms()}}class OP{constructor(t,r,i){this.original=t,this.update=r,this.dirty=!0,this.transform=i()}invalidate(){this.dirty=!0}get value(){return this.dirty&&(this.update(this.transform,this.original.value),this.dirty=!1),this.transform}}class qut{constructor(t=0){this.offset=t,this.tmpVertex=M()}applyToVertex(t,r,i){const n=t+this.localOrigin[0],s=r+this.localOrigin[1],a=i+this.localOrigin[2],o=this.offset/Math.sqrt(n*n+s*s+a*a);return this.tmpVertex[0]=t+n*o,this.tmpVertex[1]=r+s*o,this.tmpVertex[2]=i+a*o,this.tmpVertex}applyToAabb(t){for(let s=0;s<3;++s)pb[s]=t[0+s]+this.localOrigin[s],MP[s]=t[3+s]+this.localOrigin[s],Kx[s]=pb[s];const r=this.applyToVertex(pb[0],pb[1],pb[2]);for(let s=0;s<3;++s)t[s]=r[s],t[s+3]=r[s];const i=s=>{const a=this.applyToVertex(s[0],s[1],s[2]);for(let o=0;o<3;++o)t[o+0]=Math.min(t[o+0],a[o]),t[o+3]=Math.max(t[o+3],a[o])};for(let s=1;s<8;++s){for(let a=0;a<3;++a)Kx[a]=(s&1<<a)==0?pb[a]:MP[a];i(Kx)}let n=0;for(let s=0;s<3;++s)pb[s]*MP[s]<0&&(n|=1<<s);if(n!==0&&n!==7){for(let s=0;s<8;++s)if((n&s)==0){for(let a=0;a<3;++a)n[a]?Kx[a]=0:Kx[a]=(s&1<<a)!=0?pb[a]:MP[a];i(Kx)}}for(let s=0;s<3;++s)t[s+0]-=this.localOrigin[s],t[s+3]-=this.localOrigin[s];return t}}const pb=M(),MP=M(),Kx=M();class Hut{constructor(t=0){this.componentLocalOriginLength=0,this._tmpVertex=M(),this._mbs=Us(),this._obb={center:M(),halfSize:Mr(),quaternion:null},this._totalOffset=0,this._offset=0,this._resetOffset(t)}_resetOffset(t){this._offset=t,this._totalOffset=t}set offset(t){this._resetOffset(t)}get offset(){return this._offset}set componentOffset(t){this._totalOffset=this._offset+t}set localOrigin(t){this.componentLocalOriginLength=Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2])}applyToVertex(t,r,i){const n=t,s=r,a=i+this.componentLocalOriginLength,o=this._totalOffset/Math.sqrt(n*n+s*s+a*a);return this._tmpVertex[0]=t+n*o,this._tmpVertex[1]=r+s*o,this._tmpVertex[2]=i+a*o,this._tmpVertex}applyToAabb(t){const r=t[0],i=t[1],n=t[2]+this.componentLocalOriginLength,s=t[3],a=t[4],o=t[5]+this.componentLocalOriginLength,l=r*s<0?0:Math.min(Math.abs(r),Math.abs(s)),c=i*a<0?0:Math.min(Math.abs(i),Math.abs(a)),u=n*o<0?0:Math.min(Math.abs(n),Math.abs(o)),h=Math.sqrt(l*l+c*c+u*u);if(h<this._totalOffset)return t[0]-=r<0?this._totalOffset:0,t[1]-=i<0?this._totalOffset:0,t[2]-=n<0?this._totalOffset:0,t[3]+=s>0?this._totalOffset:0,t[4]+=a>0?this._totalOffset:0,t[5]+=o>0?this._totalOffset:0,t;const p=Math.max(Math.abs(r),Math.abs(s)),m=Math.max(Math.abs(i),Math.abs(a)),g=Math.max(Math.abs(n),Math.abs(o)),b=Math.sqrt(p*p+m*m+g*g),w=this._totalOffset/b,v=this._totalOffset/h;return t[0]+=r*(r>0?w:v),t[1]+=i*(i>0?w:v),t[2]+=n*(n>0?w:v),t[3]+=s*(s<0?w:v),t[4]+=a*(a<0?w:v),t[5]+=o*(o<0?w:v),t}applyToMbs(t){const r=Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]),i=this._totalOffset/r;return this._mbs[0]=t[0]+t[0]*i,this._mbs[1]=t[1]+t[1]*i,this._mbs[2]=t[2]+t[2]*i,this._mbs[3]=t[3]+t[3]*this._totalOffset/r,this._mbs}applyToObb(t){const r=t.center,i=this._totalOffset/Math.sqrt(r[0]*r[0]+r[1]*r[1]+r[2]*r[2]);this._obb.center[0]=r[0]+r[0]*i,this._obb.center[1]=r[1]+r[1]*i,this._obb.center[2]=r[2]+r[2]*i,gu(this._obb.halfSize,t.halfSize,t.quaternion),he(this._obb.halfSize,this._obb.halfSize,t.center);const n=this._totalOffset/Math.sqrt(this._obb.halfSize[0]*this._obb.halfSize[0]+this._obb.halfSize[1]*this._obb.halfSize[1]+this._obb.halfSize[2]*this._obb.halfSize[2]);return this._obb.halfSize[0]+=this._obb.halfSize[0]*n,this._obb.halfSize[1]+=this._obb.halfSize[1]*n,this._obb.halfSize[2]+=this._obb.halfSize[2]*n,pe(this._obb.halfSize,this._obb.halfSize,t.center),Ny(t0e,t.quaternion),gu(this._obb.halfSize,this._obb.halfSize,t0e),this._obb.halfSize[0]*=this._obb.halfSize[0]<0?-1:1,this._obb.halfSize[1]*=this._obb.halfSize[1]<0?-1:1,this._obb.halfSize[2]*=this._obb.halfSize[2]<0?-1:1,this._obb.quaternion=t.quaternion,this._obb}}class Wut{constructor(t=0){this.offset=t,this.sphere=Us(),this.tmpVertex=M()}applyToVertex(t,r,i){const n=this.objectTransform.transform;let s=n[0]*t+n[4]*r+n[8]*i+n[12],a=n[1]*t+n[5]*r+n[9]*i+n[13],o=n[2]*t+n[6]*r+n[10]*i+n[14];const l=this.offset/Math.sqrt(s*s+a*a+o*o);s+=s*l,a+=a*l,o+=o*l;const c=this.objectTransform.inverse;return this.tmpVertex[0]=c[0]*s+c[4]*a+c[8]*o+c[12],this.tmpVertex[1]=c[1]*s+c[5]*a+c[9]*o+c[13],this.tmpVertex[2]=c[2]*s+c[6]*a+c[10]*o+c[14],this.tmpVertex}applyToMinMax(t,r){const i=this.offset/Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);t[0]+=t[0]*i,t[1]+=t[1]*i,t[2]+=t[2]*i;const n=this.offset/Math.sqrt(r[0]*r[0]+r[1]*r[1]+r[2]*r[2]);r[0]+=r[0]*n,r[1]+=r[1]*n,r[2]+=r[2]*n}applyToAabb(t){const r=this.offset/Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);t[0]+=t[0]*r,t[1]+=t[1]*r,t[2]+=t[2]*r;const i=this.offset/Math.sqrt(t[3]*t[3]+t[4]*t[4]+t[5]*t[5]);return t[3]+=t[3]*i,t[4]+=t[4]*i,t[5]+=t[5]*i,t}applyToBoundingSphere(t){const r=Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]),i=this.offset/r;return this.sphere[0]=t[0]+t[0]*i,this.sphere[1]=t[1]+t[1]*i,this.sphere[2]=t[2]+t[2]*i,this.sphere[3]=t[3]+t[3]*this.offset/r,this.sphere}}const Jpe=new Wut;function VJ(e){return _(e)?(Jpe.offset=e,Jpe):null}const Kpe=new Hut;function Xut(e){return _(e)?(Kpe.offset=e,Kpe):null}const e0e=new qut;function Yut(e){return _(e)?(e0e.offset=e,e0e):null}const op="terrain",t0e=qy();function zJ(e,t,r){for(let i=0;i<r;++i)t[2*i]=e[i],t[2*i+1]=e[i]-t[2*i]}function Zut(e,t){const r=e.length;for(let i=0;i<r;++i)x4[0]=e[i],t[i]=x4[0];return t}function Qut(e,t){const r=e.length;for(let i=0;i<r;++i)x4[0]=e[i],x4[1]=e[i]-x4[0],t[i]=x4[1];return t}const x4=new Float32Array(2);function UJ(e,t){return R(e)&&(e=[]),e.push(t),e}function BJ(e,t){if(R(e))return null;const r=e.filter(i=>i!==t);return r.length===0?null:r}function xO(e){return!!_(e)&&!e.visible}function Jut(e,t,r){const i=e.origin.vec3;bCe(Nj,-i[0],-i[1],-i[2]),_(e.transformation)?Zi(t,Nj,e.transformation):Ln(t,Nj),r&&(Rn(r,t),hc(r,r))}function Kut(e,t,r,i,n){PP[0]=e.get(t,0),PP[1]=e.get(t,1),PP[2]=e.get(t,2),zJ(PP,N_,3),r.set(n,0,N_[0]),i.set(n,0,N_[1]),r.set(n,1,N_[2]),i.set(n,1,N_[3]),r.set(n,2,N_[4]),i.set(n,2,N_[5])}const PP=new Float64Array(3),N_=new Float32Array(6),Nj=Ae(),E9=1e-5;class eht{constructor(t){this.options=new Gut,this._results=new tht,this.transform=new jut,this.tolerance=E9,this.verticalOffset=null,this._ray=Ma(),this._rayEnd=M(),this._rayBeginTransformed=M(),this._rayEndTransformed=M(),this.viewingMode=t==null?Be.Global:t}get results(){return this._results}get ray(){return this._ray}get rayBegin(){return this._ray.origin}get rayEnd(){return this._rayEnd}reset(t,r,i){this.resetWithRay(lqe(t,r,this._ray),i)}resetWithRay(t,r){this.camera=r,t!==this._ray&&JF(t,this._ray),this.options.verticalOffset!==0?this.viewingMode===Be.Local?this._ray.origin[2]-=this.options.verticalOffset:this.verticalOffset=this.options.verticalOffset:this.verticalOffset=null,he(this._rayEnd,this._ray.origin,this._ray.direction),this._results.init(this._ray)}intersect(t=null,r,i,n,s){this.point=r,this.filterPredicate=n,this.tolerance=i==null?E9:i;const a=VJ(this.verticalOffset);if(_(t)&&t.length>0){const o=s?l=>{s(l)&&this.intersectObject(l)}:l=>{this.intersectObject(l)};for(const l of t){const c=l.getSpatialQueryAccelerator&&l.getSpatialQueryAccelerator();_(c)?(_(a)?c.forEachAlongRayWithVerticalOffset(this._ray.origin,this._ray.direction,o,a):c.forEachAlongRay(this._ray.origin,this._ray.direction,o),this.options.selectionMode&&this.options.hud&&c.forEachDegenerateObject(o)):l.objects.forAll(u=>o(u))}}this.sortResults()}intersectObject(t){const r=t.geometryRecords;if(!r)return;const i=t.transformation,n=VJ(this.verticalOffset);for(const s of r){const{geometry:a,material:o,instanceParameters:l}=s;if(xO(l))continue;const c=a.id;this.transform.setAndInvalidateLazyTransforms(i,s.getShaderTransformation()),ze(this._rayBeginTransformed,this.rayBegin,this.transform.inverse),ze(this._rayEndTransformed,this.rayEnd,this.transform.inverse);const u=this.transform.transform;_(n)&&(n.objectTransform=this.transform),o.intersect(a,l,this.transform.transform,this,this._rayBeginTransformed,this._rayEndTransformed,(h,p,m,g,b,w)=>{if(h>=0){if(_(this.filterPredicate)&&!this.filterPredicate(this._ray.origin,this._rayEnd,h))return;const v=g?this._results.hud:this._results,x=g?T=>{const E={object:t,geometryId:c,triangleNr:m,center:_(w)?[w[0],w[1],w[2]]:null};T.set(Wi.HUD,E,h,p,Es,b)}:T=>T.set(Wi.OBJECT,{object:t,geometryId:c,triangleNr:m},h,p,u,b);if((v.min.drapedLayerOrder==null||b>=v.min.drapedLayerOrder)&&(v.min.dist==null||h<v.min.dist)&&x(v.min),this.options.store!==Da.MIN&&(v.max.drapedLayerOrder==null||b<v.max.drapedLayerOrder)&&(v.max.dist==null||h>v.max.dist)&&x(v.max),this.options.store===Da.ALL)if(g){const T=new GJ(this._ray);x(T),this._results.hud.all.push(T)}else{const T=new r5(this._ray);x(T),this._results.all.push(T)}}},s.shaderTransformation)}}sortResults(t=this._results.all){t.sort((r,i)=>r.dist!==i.dist?vt(r.dist,0)-vt(i.dist,0):r.drapedLayerOrder!==i.drapedLayerOrder?vt(r.drapedLayerOrder,Number.MAX_VALUE)-vt(i.drapedLayerOrder,Number.MAX_VALUE):vt(i.drapedLayerGraphicOrder,Number.MIN_VALUE)-vt(r.drapedLayerGraphicOrder,Number.MIN_VALUE))}}function tf(e){return new eht(e)}class tht{constructor(){this.min=new r5(Ma()),this.max=new r5(Ma()),this.hud={min:new GJ(Ma()),max:new GJ(Ma()),all:new Array},this.ground=new r5(Ma()),this.all=[]}init(t){this.min.init(t),this.max.init(t),this.ground.init(t),this.all.length=0,this.hud.min.init(t),this.hud.max.init(t),this.hud.all.length=0}}class r5{constructor(t){this.intersector=Wi.OBJECT,this.normal=M(),this.transformation=Ae(),this._ray=Ma(),this.init(t)}get ray(){return this._ray}get distanceInRenderSpace(){return _(this.dist)?(le(IP,this.ray.direction,this.dist),Oe(IP)):null}getIntersectionPoint(t){return!!Lm(this)&&(le(IP,this.ray.direction,this.dist),he(t,this.ray.origin,IP),!0)}getTransformedNormal(t){return oe(o8,this.normal),o8[3]=0,du(o8,o8,this.transformation),oe(t,o8),we(t,t)}init(t){this.dist=null,this.target=null,this.drapedLayerOrder=null,this.drapedLayerGraphicOrder=null,this.intersector=Wi.OBJECT,JF(t,this._ray)}set(t,r,i,n,s,a,o){this.intersector=t,this.dist=i,oe(this.normal,vt(n,uwe)),Ln(this.transformation,vt(s,Es)),this.target=r,this.drapedLayerOrder=a,this.drapedLayerGraphicOrder=o}copy(t){JF(t.ray,this._ray),this.intersector=t.intersector,this.dist=t.dist,this.target=t.target,this.drapedLayerOrder=t.drapedLayerOrder,this.drapedLayerGraphicOrder=t.drapedLayerGraphicOrder,oe(this.normal,t.normal),Ln(this.transformation,t.transformation)}}class GJ extends r5{constructor(){super(...arguments),this.intersector=Wi.HUD}}function Ase(e){return new r5(e)}const IP=M(),o8=Jt();function RCe(e,t,r,i){return _(e.renderCoordsHelper.fromRenderCoords(t.eye,qN,i))&&Rxe(r,qN)}function Uz(e,t){return e.elevationProvider?vt(e.elevationProvider.getElevation(t[0],t[1],t[2],e.renderCoordsHelper.spatialReference,"ground"),0):0}function $x(e,t,r,i){const n=e.state.camera.clone();t&&(n.eye=t,n.center=r,n.up=i),rht(e,n.ray,mb)||oe(mb,n.center);const s=e.state.constraints,a=s.minimumPoiDistance;if(Vs(n.eye,mb)<a){const o=s.collision.enabled;oe(k_,n.viewForward),le(k_,k_,a),o?n.eye=pe(qN,mb,k_):he(mb,n.eye,k_);const l=e.renderCoordsHelper,c=l.getAltitude(n.eye),u=s.collision.elevationMargin;o&&c<u&&(pe(k_,mb,n.eye),n.eye=l.setAltitude(qN,u,n.eye),he(mb,n.eye,k_))}return n.center=mb,n}function r0e(e,t,r){if(!e.state.isGlobal)return!1;const i=Uz(e,t),n=e.stateManager.constraintsManager.nearFarHeuristic,{far:s}=n.compute(t,r,e.renderDataExtent,i,nht),a=s*s;return Vs(t,r)>a}function rht(e,t,r){let i=i0e[e.viewingMode];i||(i=tf(e.state.viewingMode),i.options.backfacesTerrain=!e.state.isGlobal,i.options.invisibleTerrain=!0,i0e[e.viewingMode]=i);const{isGlobal:n}=e.state;return!(!e.sceneIntersectionHelper.intersectRay(t,i,r)||r0e(e,t.origin,r))||!(!e.renderCoordsHelper.intersectManifold(t,0,r)||r0e(e,t.origin,r))||!!n&&iht(t,r,Ar(e.spatialReference).radius)}function iht(e,t,r){const i=Se(e.origin,e.origin)-r*r,n=i>0?Math.sqrt(i)/3:1;return le(t,e.direction,n/Oe(e.direction)),he(t,t,e.origin),!0}const i0e={},qN=M(),mb=M(),k_=M(),nht={near:0,far:0};function _6(e,t,r=kh.EYE){const i=e.state.constraints;if(!i.collision.enabled)return!1;const n=Uz(e,t.eye),s=e.renderCoordsHelper.getAltitude(t.eye),a=n+i.collision.elevationMargin;if(s>=a)return!1;const o=Oe(t.eye);if(pe($P,t.center,t.eye),t.eye=e.renderCoordsHelper.setAltitude(sht,a,t.eye),r===kh.EYE_AND_CENTER)t.center=he($P,t.eye,$P);else if(r===kh.EYE_AND_CENTER_SCALE){const l=(o-s+a)/o;t.center=le($P,t.center,l)}return!0}var kh;(function(e){e[e.EYE=0]="EYE",e[e.EYE_AND_CENTER=1]="EYE_AND_CENTER",e[e.EYE_AND_CENTER_SCALE=2]="EYE_AND_CENTER_SCALE"})(kh||(kh={}));const $P=M(),sht=M();function s_(e,t,r){e.worldUpAtPosition(t,n0e),pe(kj,r,t);const i=Oe(kj);return i===0?0:Rs(Se(kj,n0e)/i)}const n0e=M(),kj=M();function OCe(e,t,r=n_,i=!0){l8.eyeCenterDistance=0,l8.requiresTwoSteps=!1;const n=Rse(e,t,r,void 0,l8);if(n===0)return!1;switch(Cu(LP,-n,t.viewRight),r.tiltMode){case aa.LOOK_AROUND:ze(gb,t.viewForward,LP),le(gb,gb,l8.eyeCenterDistance),t.center=he(W1,t.eye,gb);break;case aa.TUMBLE:pe(gb,t.center,t.eye),ze(gb,gb,LP),t.eye=pe(W1,t.center,gb);break;default:r.tiltMode}return t.up=ze(W1,t.up,LP),!l8.requiresTwoSteps||!i||OCe(e,t,r,!1)}function Rse(e,t,r=n_,i=n_,n){if(!e.state.constraints.tilt)return 0;const s=t.distance,a=e.state.constraints.tilt(s,mht);return pht(e,r,a),i.interactionType===Ht.TUMBLE&&eR(i.selection,Ti.ALTITUDE)&&MCe(e,i.interactionStartCamera,a),r.tiltMode===aa.LOOK_AROUND||i.tiltMode===aa.LOOK_AROUND?oht(e,t,a,n):aht(e,t,a)}function aht(e,t,r){const i=s_(e.renderCoordsHelper,t.center,t.eye),n=i-Le(i,r.min,r.max);return tR(n)?n:0}function oht(e,t,r,i){switch(i&&(i.requiresTwoSteps=!1),e.viewingMode){case"global":return cht(e,t,r,i);case"local":return lht(e,t,r,i);default:return void(e.viewingMode,void 0)}}function lht(e,t,r,i){const n=s_(e.renderCoordsHelper,t.center,t.eye),s=Le(n,r.min,r.max),a=n-s;if(!tR(a))return 0;if(i){const o=e.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,l=e.renderCoordsHelper.getAltitude(t.eye)-o,c=Math.cos(s);Math.abs(c)>1e-4?i.eyeCenterDistance=l/c:i.eyeCenterDistance=t.distance}return a}function cht(e,t,r,i){const n=dht(e,t,ght),s=Le(n.tiltAtCenter,r.min,r.max);if(!tR(n.tiltAtCenter-s))return 0;let a,o;return n.centerIsOnSurface?(a=uht(n),o=hht(n,a)):(a=n.constraints.clampTilt(n.eyeCenterDistance,n.tiltAtCenter),i&&a<Math.PI/2&&(i.requiresTwoSteps=!0,a=Math.PI/2-1e-5),o=fht(n,a)),i&&(i.eyeCenterDistance=jJ(n,a)),o}function dht(e,t,r){const i=e.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,n=i+Ar(e.spatialReference).radius,s=e.renderCoordsHelper.intersectManifold(t.ray,i,W1);return r.eyeCenterDistance=t.distance,r.centerIsOnSurface=!1,_(s)?(r.eyeCenterDistance=fi(t.eye,s),r.tiltAtCenter=s_(e.renderCoordsHelper,s,t.eye),r.centerIsOnSurface=!0):e.state.isLocal?r.tiltAtCenter=s_(e.renderCoordsHelper,t.center,t.eye):(n6(GV(jV,n),t.ray,W1),r.eyeCenterDistance=fi(t.eye,W1),r.tiltAtCenter=Rs(-Se(t.viewForward,we(W1,W1)))),r.radius=n,r.eyeRadius=Oe(t.eye),r.constraints=e.state.constraints,r}function tR(e){return Math.abs(e)>1e-9}function uht(e){const{constraints:t,eyeCenterDistance:r,tiltAtCenter:i}=e;let n=i,s=t.clampTilt(r,i);const a=jJ(e,s);if(t.clampTilt(a,i)===s)return s;let o=0;for(;o<10&&tR(s-n);){const l=(n+s)/2,c=jJ(e,l);tR(t.clampTilt(c,l)-l)?n=l:s=l,o++}return s}function jJ(e,t){if(!e.centerIsOnSurface)return e.eyeCenterDistance;const r=Math.PI-Le(t,0,Math.PI),i=Pp(e.radius/e.eyeRadius*Math.sin(r)),n=Math.PI-r-i,s=Math.sin(n)/Math.sin(r);if(e.eyeRadius<e.radius&&s>1){const a=Math.PI-i,o=Math.PI-r-a;return Math.sin(o)/Math.sin(r)*e.eyeRadius}return s*e.eyeRadius}function hht(e,t){const r=Pp(e.radius/e.eyeRadius*Math.sin(e.tiltAtCenter)),i=Pp(e.radius/e.eyeRadius*Math.sin(t));return e.eyeRadius>e.radius?r-i:i-r}function fht(e,t){return e.tiltAtCenter-Math.PI/2-(t-Math.PI/2)}function pht(e,t,r){if(t.interactionType===Ht.NONE)return;const{interactionStartCamera:i,interactionFactor:n}=t,{min:s,max:a}=r,o=Rse(e,i,n_,t),l=o===0?0:s_(e.renderCoordsHelper,i.center,i.eye);r.min=s,r.max=a,t.interactionType===Ht.TUMBLE?(eR(t.selection,Ti.ALTITUDE)&&MCe(e,i,r),jN(o,l,!0,n,s0e,r)):jN(o,l,!1,n,s0e,r)}function MCe(e,t,r){if(e.state.isLocal)return;const i=e.state.constraints;if(!i.altitude)return;const n=fl(t.center),s=Math.sqrt(n),a=t.distance,o=Ar(e.spatialReference).radius,l=i.altitude.min+o,c=i.altitude.max+o,u=(l*l-a*a-n)/(-2*s*a),h=(c*c-a*a-n)/(-2*s*a);r.min=Math.max(r.min,Math.min(Math.PI-Rs(h),r.max)),r.max=Math.min(r.max,Math.PI-Rs(u))}const gb=M(),LP=Ae(),W1=M(),s0e=kt(5),mht={min:0,max:0},ght={constraints:null,radius:0,eyeRadius:0,centerIsOnSurface:!0,eyeCenterDistance:0,tiltAtCenter:0},l8={eyeCenterDistance:0,requiresTwoSteps:!1};function yht(e){return e}const Bz=e=>e*e,Ose=e=>1-Bz(1-e),bht=e=>e<.5?Bz(2*e)/2:(Ose(2*(e-.5))+1)/2,Mse=e=>e*e*e,PCe=e=>1-Mse(1-e),ICe=e=>e<.5?Mse(2*e)/2:(PCe(2*(e-.5))+1)/2,Pse=e=>e*e*e*e,$Ce=e=>1-Pse(1-e),vht=e=>e<.5?Pse(2*e)/2:($Ce(2*(e-.5))+1)/2,Ise=e=>e*e*e*e*e,LCe=e=>1-Ise(1-e),_ht=e=>e<.5?Ise(2*e)/2:(LCe(2*(e-.5))+1)/2,$se=e=>1-Math.cos(e*Math.PI/2),DCe=e=>1-$se(1-e),wht=e=>e<.5?$se(2*e)/2:(DCe(2*(e-.5))+1)/2,Lse=e=>2**(10*(e-1)),TO=e=>1-Lse(1-e),xht=e=>e<.5?Lse(2*e)/2:(TO(2*(e-.5))+1)/2,Dse=e=>-(Math.sqrt(1-e*e)-1),FCe=e=>1-Dse(1-e),Tht=e=>e<.5?Dse(2*e)/2:(FCe(2*(e-.5))+1)/2;function sf(e){const t=2*(e-Math.sqrt((e-1)*e)),r=t/2/e;return i=>i<r?e*i*i:t*i-t+1}function af(e,t){return(r,i)=>r<t?t*e(r/t,i):1-e((1-r)/(1-t),i)*(1-t)}const Sht=af(sf(1),1),Eht=af(sf(1),0),NCe=af(sf(1),.5),Cht=af(sf(2),1),Aht=af(sf(2),0),Rht=af(sf(2),.5),Oht=af(sf(3),1),Mht=af(sf(3),0),Pht=af(sf(3),.5),Iht=af(sf(4),1),$ht=af(sf(4),0),Lht=af(sf(4),.5),Dht={linear:yht,"in-quad":Bz,"out-quad":Ose,"in-out-quad":bht,"in-coast-quad":Sht,"out-coast-quad":Eht,"in-out-coast-quad":NCe,"in-cubic":Mse,"out-cubic":PCe,"in-out-cubic":ICe,"in-coast-cubic":Cht,"out-coast-cubic":Aht,"in-out-coast-cubic":Rht,"in-quart":Pse,"out-quart":$Ce,"in-out-quart":vht,"in-coast-quart":Oht,"out-coast-quart":Mht,"in-out-coast-quart":Pht,"in-quint":Ise,"out-quint":LCe,"in-out-quint":_ht,"in-coast-quint":Iht,"out-coast-quint":$ht,"in-out-coast-quint":Lht,"in-sine":$se,"out-sine":DCe,"in-out-sine":wht,"in-expo":Lse,"out-expo":TO,"in-out-expo":xht,"in-circ":Dse,"out-circ":FCe,"in-out-circ":Tht};function En(e,t,r=Vht,i=t){let n=!1;i!==t&&i.copyFrom(t),i.computeUp(e.state.viewingMode);for(let o=0;o<zht;o++){let l=0;for(const c of kht)if(eR(r.selection,c.type)){const u=Math.abs(c.error(e,i,r));c.apply(e,i,r)&&(n=!0,l+=u)}if(l===0)break}const s=eR(r.selection,Ti.COLLISION),a=Fht(r.interactionType,e);return s&&_6(e,i,a)&&(n=!0),n&&i.computeUp(e.state.viewingMode),n}function Fht(e,t){switch(e){case Ht.PAN:return kh.EYE_AND_CENTER;case Ht.ASCEND:return t.state.isGlobal?kh.EYE_AND_CENTER_SCALE:kh.EYE_AND_CENTER;default:return kh.EYE}}function np(e,t){const r=typeof e=="number"?e:Xne(e,t),i=Math.min(1,r/150);return ICe(i)}function Nht(e,t,r){return Rse(e,t,r)*t.distance}const kht=[{type:Ti.TILT,error:Nht,apply:OCe},{type:Ti.ALTITUDE,error:Sse,apply:Aut},{type:Ti.DISTANCE,error:Ese,apply:Fut}],Vht={selection:Ti.ALL,interactionType:Ht.NONE,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:aa.TUMBLE},zht=5,xd=M(),wc=M(),yb=M(),go=M(),V_=M(),Uht=M(),Td={upward:Ve(0,0,1),forward:Ve(0,1,0),sideway:Ve(1,0,0)},a0e=Li();class o0e{constructor(t=Be.Global){this.viewingMode=t,this.center=M(),this.pitch=0,this.yaw=0,this.distance=0,this.lookAtDirection=Kn(Td.forward)}pixelsPerPanAtZoom(t){return this.size/2/(this._zoomToPanScale*t)}zoomAtPixelsPerPan(t){return this.size/2/(this._zoomToPanScale*t)}pixelsPerRotateAtZoom(){const t=Math.max(Math.cos(Math.abs(this.pitch)),.5);return this.size/2/t}compareTo(t,r){if(r||(r={pan:0,rotate:0,sourceZoom:0,targetZoom:0}),this.viewingMode===Be.Global){const s=(Oe(this.center)+Oe(t.center))/2;r.pan=mL(this.center,t.center)*s}else r.pan=fi(this.center,t.center);let i=Math.abs(t.yaw-this.yaw);i>=Math.PI&&(i=2*Math.PI-i);const n=Math.abs(t.pitch-this.pitch);return r.rotate=Math.max(i,n),r.sourceZoom=this.distance,r.targetZoom=t.distance,r}interpolate(t,r,i){this.viewingMode===Be.Global?Cqe(t.center,r.center,i.pan,this.center):As(this.center,t.center,r.center,i.pan),this.distance=Kt(t.distance,r.distance,i.zoom),this.pitch=Kt(t.pitch,r.pitch,i.rotate);let n=t.yaw;const s=r.yaw;Math.abs(s-n)>=Math.PI&&(n+=2*(n<s?1:-1)*Math.PI),this.yaw=Kt(n,s,i.rotate)}copyFrom(t){oe(this.center,t.center),this.pitch=t.pitch,this.yaw=t.yaw,this.distance=t.distance,oe(this.lookAtDirection,t.lookAtDirection),this.size=t.size,this.copyFromCommon(t),this.viewingMode=t.viewingMode}copyFromRenderCamera(t){const r=this._lookAtOrientation(t.center,a0e);oe(this.center,t.center),pe(go,t.center,t.eye),ed(go,go,r),ed(V_,t.up,r),this.distance=Oe(go),go[0]/=this.distance,go[1]/=this.distance,go[2]/=this.distance,this.pitch=this._eyeUpToPitch(go),this.yaw=this._eyeUpToYaw(go,V_),this.size=Math.sqrt(t.width*t.width+t.height*t.height),this.copyFromCommon(t)}copyFromCommon(t){this.fov=t.fov,this._zoomToPanScale=Math.atan(.5*this.fov)}copyToRenderCamera(t){const r=this._lookAtOrientation(this.center,a0e);Kh(r,r),this._axisAngleVec3(Td.sideway,this.pitch-Math.PI/2,Td.forward,go),this._axisAngleVec3(Td.upward,this.yaw,go),this._axisAngleVec3(Td.sideway,this.pitch-Math.PI/2,Td.upward,V_),this._axisAngleVec3(Td.upward,this.yaw,V_),le(go,go,this.distance),ed(go,go,r),ed(V_,V_,r),t.center=this.center,t.eye=pe(go,this.center,go),t.up=V_}_axisAngleVec3(t,r,i,n=i){const s=Math.cos(r),a=Math.sin(r);return le(xd,i,s),dt(wc,t,i),le(wc,wc,a),le(yb,t,(1-s)*Se(t,i)),he(n,he(n,xd,wc),yb)}_lookAtOrientation(t,r=Li()){return this._upAtLookAt(t,yb),dt(xd,this.lookAtDirection,yb),we(xd,xd),xd[0]===0&&xd[1]===0&&xd[2]===0&&oe(xd,Td.sideway),dt(wc,yb,xd),we(wc,wc),r[0]=xd[0],r[1]=wc[0],r[2]=yb[0],r[3]=xd[1],r[4]=wc[1],r[5]=yb[1],r[6]=xd[2],r[7]=wc[2],r[8]=yb[2],r}_upAtLookAt(t,r){return this.viewingMode===Be.Local?oe(r,Td.upward):we(r,t)}_eyeUpToPitch(t){return Math.PI-mL(Td.upward,t)}_eyeUpToYaw(t,r){const i=Uht;return Math.abs(r[2])<.5?(oe(i,r),t[2]>0&&le(i,i,-1)):oe(i,t),dt(wc,i,Td.upward),we(wc,wc),mL(Td.sideway,wc,Td.upward)}}function Fse(e){return e?{ray:Ma(e.ray),c0:e.c0,c1:e.c1}:{ray:Ma(),c0:0,c1:Number.MAX_VALUE}}function Bht(e,t=Fse()){return JF(e,t.ray),t.c0=0,t.c1=Number.MAX_VALUE,t}function Ght(e,t,r=Fse()){const i=Oe(e.vector);return mSe(e.origin,t,r.ray),r.c0=0,r.c1=i,r}function _Lt(e,t){return kCe(e,e.c0,t)}function wLt(e,t){return kCe(e,e.c1,t)}function kCe(e,t,r){return he(r,e.ray.origin,le(r,e.ray.direction,t))}new jy(()=>({c0:0,c1:0,ray:null}));function rR(e){return e?[Er(e[0]),Er(e[1]),Er(e[2]),Er(e[3]),Er(e[4]),Er(e[5])]:[Er(),Er(),Er(),Er(),Er(),Er()]}function VCe(){return[M(),M(),M(),M(),M(),M(),M(),M()]}function HN(e,t){for(let r=0;r<Vy.NUM;r++)qV(e[r],t[r])}function zCe(e,t,r,i=Yht){const n=Zi(nie.get(),t,e);Rn(n,n);for(let s=0;s<qJ.NUM;++s){const a=du(iie.get(),Xht[s],n);ne(i[s],a[0]/a[3],a[1]/a[3],a[2]/a[3])}UCe(r,i)}function UCe(e,t){Ao(t[et.FAR_BOTTOM_LEFT],t[et.NEAR_BOTTOM_LEFT],t[et.NEAR_TOP_LEFT],e[ci.LEFT]),Ao(t[et.NEAR_BOTTOM_RIGHT],t[et.FAR_BOTTOM_RIGHT],t[et.FAR_TOP_RIGHT],e[ci.RIGHT]),Ao(t[et.FAR_BOTTOM_LEFT],t[et.FAR_BOTTOM_RIGHT],t[et.NEAR_BOTTOM_RIGHT],e[ci.BOTTOM]),Ao(t[et.NEAR_TOP_LEFT],t[et.NEAR_TOP_RIGHT],t[et.FAR_TOP_RIGHT],e[ci.TOP]),Ao(t[et.NEAR_BOTTOM_LEFT],t[et.NEAR_BOTTOM_RIGHT],t[et.NEAR_TOP_RIGHT],e[ci.NEAR]),Ao(t[et.FAR_BOTTOM_RIGHT],t[et.FAR_BOTTOM_LEFT],t[et.FAR_TOP_LEFT],e[ci.FAR])}function fv(e,t){for(let r=0;r<Vy.NUM;r++){const i=e[r];if(i[0]*t[0]+i[1]*t[1]+i[2]*t[2]+i[3]>=t[3])return!1}return!0}function jht(e,t){return GCe(e,Bht(t,jCe.get()))}function xLt(e,t){for(let r=0;r<Vy.NUM;r++){const i=e[r];if(!Lqe(i,t))return!1}return!0}function qht(e,t,r){return GCe(e,Ght(t,r,jCe.get()))}function BCe(e,t){for(let r=0;r<Vy.NUM;r++)if(di(e[r],t)>0)return!1;return!0}function Hht(e,t){for(let r=0;r<Vy.NUM;r++)if(Iqe(e[r],t))return!1;return!0}function GCe(e,t){for(let r=0;r<Vy.NUM;r++)if(!$qe(e[r],t))return!1;return!0}var ci,et;(function(e){e[e.LEFT=0]="LEFT",e[e.RIGHT=1]="RIGHT",e[e.BOTTOM=2]="BOTTOM",e[e.TOP=3]="TOP",e[e.NEAR=4]="NEAR",e[e.FAR=5]="FAR"})(ci||(ci={})),function(e){e[e.NEAR_BOTTOM_LEFT=0]="NEAR_BOTTOM_LEFT",e[e.NEAR_BOTTOM_RIGHT=1]="NEAR_BOTTOM_RIGHT",e[e.NEAR_TOP_RIGHT=2]="NEAR_TOP_RIGHT",e[e.NEAR_TOP_LEFT=3]="NEAR_TOP_LEFT",e[e.FAR_BOTTOM_LEFT=4]="FAR_BOTTOM_LEFT",e[e.FAR_BOTTOM_RIGHT=5]="FAR_BOTTOM_RIGHT",e[e.FAR_TOP_RIGHT=6]="FAR_TOP_RIGHT",e[e.FAR_TOP_LEFT=7]="FAR_TOP_LEFT"}(et||(et={}));const Wht={bottom:[et.FAR_BOTTOM_RIGHT,et.NEAR_BOTTOM_RIGHT,et.NEAR_BOTTOM_LEFT,et.FAR_BOTTOM_LEFT],near:[et.NEAR_BOTTOM_LEFT,et.NEAR_BOTTOM_RIGHT,et.NEAR_TOP_RIGHT,et.NEAR_TOP_LEFT],far:[et.FAR_BOTTOM_RIGHT,et.FAR_BOTTOM_LEFT,et.FAR_TOP_LEFT,et.FAR_TOP_RIGHT],right:[et.NEAR_BOTTOM_RIGHT,et.FAR_BOTTOM_RIGHT,et.FAR_TOP_RIGHT,et.NEAR_TOP_RIGHT],left:[et.FAR_BOTTOM_LEFT,et.NEAR_BOTTOM_LEFT,et.NEAR_TOP_LEFT,et.FAR_TOP_LEFT],top:[et.FAR_TOP_LEFT,et.NEAR_TOP_LEFT,et.NEAR_TOP_RIGHT,et.FAR_TOP_RIGHT]};var Vy,qJ;(function(e){e[e.NUM=6]="NUM"})(Vy||(Vy={})),function(e){e[e.NUM=8]="NUM"}(qJ||(qJ={}));const Xht=[Tr(-1,-1,-1,1),Tr(1,-1,-1,1),Tr(1,1,-1,1),Tr(-1,1,-1,1),Tr(-1,-1,1,1),Tr(1,-1,1,1),Tr(1,1,1,1),Tr(-1,1,1,1)],jCe=new jy(Fse),Yht=VCe(),Zht=fe.getLogger("esri.views.3d.webgl-engine.lib.Camera");class ni{constructor(t=null,r=null,i=null){this._viewUp=M(),this._viewForward=M(),this._viewRight=M(),this._ray=Ma(),this._viewport=Tr(0,0,1,1),this._padding=Tr(0,0,0,0),this._fov=55/180*Math.PI,this._nearFar=Nr(1,1e3),this._viewDirty=!0,this._viewMatrix=Ae(),this._projectionDirty=!0,this._projectionMatrix=Ae(),this._viewProjectionDirty=!0,this._viewProjectionMatrix=Ae(),this._viewInverseTransposeMatrixDirty=!0,this._viewInverseTransposeMatrix=Ae(),this._inverseProjectionDirty=!0,this._inverseProjectionMatrix=null,this._frustumDirty=!0,this._frustum=rR(),this._fullViewport=Jt(),this._pixelRatio=1,this.relativeElevation=0,_(t)&&oe(this._ray.origin,t),this._center=_(r)?Kn(r):M(),this._up=_(i)?Kn(i):Ve(0,0,1)}get pixelRatio(){return this._pixelRatio}set pixelRatio(t){this._pixelRatio=t>0?t:1}get eye(){return this._ray.origin}set eye(t){this._compareAndSetView(t,this._ray.origin)}get center(){return this._center}set center(t){this._compareAndSetView(t,this._center)}get ray(){return pe(this._ray.direction,this.center,this.eye),this._ray}get up(){return this._up}set up(t){this._compareAndSetView(t,this._up)}get viewMatrix(){return this._ensureViewClean(),this._viewMatrix}set viewMatrix(t){Ln(this._viewMatrix,t),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}get viewForward(){return this._ensureViewClean(),this._viewForward}get viewUp(){return this._ensureViewClean(),this._viewUp}get viewRight(){return this._ensureViewClean(),this._viewRight}get nearFar(){return this._nearFar}get near(){return this._nearFar[0]}set near(t){this._nearFar[0]!==t&&(this._nearFar[0]=t,this._projectionDirty=!0,this._inverseProjectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}get far(){return this._nearFar[1]}set far(t){this._nearFar[1]!==t&&(this._nearFar[1]=t,this._projectionDirty=!0,this._inverseProjectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}get viewport(){return this._viewport}set viewport(t){this.x=t[0],this.y=t[1],this.width=t[2],this.height=t[3]}get x(){return this._viewport[0]}set x(t){t+=this._padding[Mt.LEFT],this._viewport[0]!==t&&(this._viewport[0]=t,this._projectionDirty=!0,this._inverseProjectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}get y(){return this._viewport[1]}set y(t){t+=this._padding[Mt.BOTTOM],this._viewport[1]!==t&&(this._viewport[1]=t,this._projectionDirty=!0,this._inverseProjectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}get width(){return this._viewport[2]}set width(t){this._viewport[2]!==t&&(this._viewport[2]=t,this._projectionDirty=!0,this._inverseProjectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}get height(){return this._viewport[3]}set height(t){this._viewport[3]!==t&&(this._viewport[3]=t,this._projectionDirty=!0,this._inverseProjectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}get fullWidth(){return this._viewport[2]+this._padding[Mt.RIGHT]+this._padding[Mt.LEFT]}set fullWidth(t){this.width=t-(this._padding[Mt.RIGHT]+this._padding[Mt.LEFT])}get fullHeight(){return this._viewport[3]+this._padding[Mt.TOP]+this._padding[Mt.BOTTOM]}set fullHeight(t){this.height=t-(this._padding[Mt.TOP]+this._padding[Mt.BOTTOM])}get fullViewport(){return this._fullViewport[0]=this._viewport[0]-this._padding[Mt.LEFT],this._fullViewport[1]=this._viewport[1]-this._padding[Mt.BOTTOM],this._fullViewport[2]=this.fullWidth,this._fullViewport[3]=this.fullHeight,this._fullViewport}get aspect(){return this.width/this.height}get padding(){return this._padding}set padding(t){this._padding[Mt.TOP]===t[Mt.TOP]&&this._padding[Mt.RIGHT]===t[Mt.RIGHT]&&this._padding[Mt.BOTTOM]===t[Mt.BOTTOM]&&this._padding[Mt.LEFT]===t[Mt.LEFT]||(this._viewport[0]+=t[Mt.LEFT]-this._padding[Mt.LEFT],this._viewport[1]+=t[Mt.BOTTOM]-this._padding[Mt.BOTTOM],this._viewport[2]-=t[Mt.RIGHT]+t[Mt.LEFT]-(this._padding[Mt.RIGHT]+this._padding[Mt.LEFT]),this._viewport[3]-=t[Mt.TOP]+t[Mt.BOTTOM]-(this._padding[Mt.TOP]+this._padding[Mt.BOTTOM]),hp(this._padding,t),this._projectionDirty=!0,this._inverseProjectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}get viewProjectionMatrix(){return this._viewProjectionDirty&&(Zi(this._viewProjectionMatrix,this.projectionMatrix,this.viewMatrix),this._viewProjectionDirty=!1),this._viewProjectionMatrix}get projectionMatrix(){if(this._projectionDirty){const t=this.width,r=this.height,i=this.near*Math.tan(this.fovY/2),n=i*this.aspect;ETe(this._projectionMatrix,-n*(1+2*this._padding[Mt.LEFT]/t),n*(1+2*this._padding[Mt.RIGHT]/t),-i*(1+2*this._padding[Mt.BOTTOM]/r),i*(1+2*this._padding[Mt.TOP]/r),this.near,this.far),this._projectionDirty=!1}return this._projectionMatrix}get inverseProjectionMatrix(){return R(this._inverseProjectionMatrix)&&(this._inverseProjectionMatrix=Ae()),this._inverseProjectionDirty&&Rn(this._inverseProjectionMatrix,this.projectionMatrix),this._inverseProjectionMatrix}set projectionMatrix(t){Ln(this._projectionMatrix,t),this._projectionDirty=!1,this._inverseProjectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}get fov(){return this._fov}set fov(t){this._fov=t,this._projectionDirty=!0,this._inverseProjectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}get fovX(){return Rdt(this._fov,this.width,this.height)}set fovX(t){this._fov=Cdt(t,this.width,this.height),this._projectionDirty=!0,this._inverseProjectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}get fovY(){return Odt(this._fov,this.width,this.height)}set fovY(t){this._fov=Adt(t,this.width,this.height),this._projectionDirty=!0,this._inverseProjectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}get distance(){return fi(this._center,this.eye)}get frustum(){return this._recomputeFrustum(),this._frustum}get viewInverseTransposeMatrix(){return(this._viewInverseTransposeMatrixDirty||this._viewDirty)&&(Rn(this._viewInverseTransposeMatrix,this.viewMatrix),hc(this._viewInverseTransposeMatrix,this._viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),this._viewInverseTransposeMatrix}depthNDCToWorld(t){const r=2*t-1;return 2*this.near*this.far/(this.far+this.near-r*(this.far-this.near))}get perRenderPixelRatio(){return Math.tan(this.fovX/2)/(this.width/2)}get perScreenPixelRatio(){return this.perRenderPixelRatio*this._pixelRatio}get aboveGround(){return this.relativeElevation&&this.relativeElevation>=0}copyFrom(t){oe(this._ray.origin,t.eye),oe(this._center,t.center),oe(this._up,t.up),hp(this._viewport,t.viewport),hp(this._padding,t.padding),Na(this._nearFar,t.nearFar),this._fov=t.fov,this.relativeElevation=t.relativeElevation;const r=t;return this._viewDirty=r._viewDirty,this._viewDirty||(Ln(this._viewMatrix,t.viewMatrix),oe(this._viewRight,t.viewRight),oe(this._viewUp,t.viewUp),oe(this._viewForward,t.viewForward)),r._projectionDirty?this._projectionDirty=!0:(Ln(this._projectionMatrix,t.projectionMatrix),this._projectionDirty=!1),this._viewProjectionDirty=!0,this._inverseProjectionDirty=!0,this._frustumDirty=r._frustumDirty,this._frustumDirty||(HN(this._frustum,t.frustum),this._frustumDirty=!1),r._viewInverseTransposeMatrixDirty?this._viewInverseTransposeMatrixDirty=!0:(Ln(this._viewInverseTransposeMatrix,t.viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),hp(this._fullViewport,t.fullViewport),this._pixelRatio=t.pixelRatio,this}copyViewFrom(t){this.eye=t.eye,this.center=t.center,this.up=t.up}clone(){return new ni().copyFrom(this)}equals(t){return Kl(this.eye,t.eye)&&Kl(this._center,t.center)&&Kl(this._up,t.up)&&lA(this._viewport,t.viewport)&&lA(this._padding,t.padding)&&xEe(this._nearFar,t.nearFar)&&this._fov===t.fov&&this._pixelRatio===t.pixelRatio&&this.relativeElevation===t.relativeElevation}almostEquals(t){if(this._pixelRatio!==t.pixelRatio||Math.abs(t.fov-this._fov)>=.001)return!1;const r=5e-4,i=1-1e-10;pd(yo,t.eye,t.center),pd(Vj,this.eye,this._center);const n=Se(yo,Vj),s=SX(yo),a=SX(Vj);return n*n>=i*s*a&&are(t.eye,this.eye)<Math.max(s,a)*r*r&&NF(t.padding,this._padding)<.5&&NF(t.viewport,this._viewport)<.5}computeRenderPixelSizeAt(t){return this.computeRenderPixelSizeAtDist(this._viewDirectionDistance(t))}computeRenderPixelSizeAtDist(t){return t*this.perRenderPixelRatio}computeScreenPixelSizeAt(t){return this.computeScreenPixelSizeAtDist(this._viewDirectionDistance(t))}_viewDirectionDistance(t){return Math.abs(YC(this.viewForward,pe(yo,t,this.eye)))}computeScreenPixelSizeAtDist(t){return t*this.perScreenPixelRatio}computeDistanceFromRadius(t,r){return t/Math.tan(Math.min(this.fovX,this.fovY)/(2*(r||1)))}getScreenCenter(t=tn()){return t[0]=(this.padding[Mt.LEFT]+this.width/2)/this._pixelRatio,t[1]=(this.padding[Mt.TOP]+this.height/2)/this._pixelRatio,t}getRenderCenter(t,r=.5,i=.5){return t[0]=this.padding[Mt.LEFT]+this.width*r,t[1]=this.padding[Mt.BOTTOM]+this.height*i,t[2]=.5,t}setGLViewport(t){const r=this.viewport,i=this.padding;t.setViewport(r[0]-i[3],r[1]-i[2],r[2]+i[1]+i[3],r[3]+i[0]+i[2])}applyProjection(t,r){t!==Yt&&oe(Yt,t),Yt[3]=1,du(Yt,Yt,this.projectionMatrix);const i=Math.abs(Yt[3]);le(Yt,Yt,1/i);const n=this.fullViewport;r[0]=Kt(0,n[0]+n[2],.5+.5*Yt[0]),r[1]=Kt(0,n[1]+n[3],.5+.5*Yt[1]),r[2]=.5*(Yt[2]+1),r[3]=i}unapplyProjection(t,r){const i=this.fullViewport;Yt[0]=(t[0]/(i[0]+i[2])*2-1)*t[3],Yt[1]=(t[1]/(i[1]+i[3])*2-1)*t[3],Yt[2]=(2*t[2]-1)*t[3],Yt[3]=t[3],du(Yt,Yt,this.inverseProjectionMatrix),r[0]=Yt[0],r[1]=Yt[1],r[2]=Yt[2]}projectToScreen(t,r){this.projectToRenderScreen(t,zj),this.renderToScreen(zj,r)}projectToRenderScreen(t,r){if(Yt[0]=t[0],Yt[1]=t[1],Yt[2]=t[2],Yt[3]=1,du(Yt,Yt,this.viewProjectionMatrix),Yt[3]===0)return null;le(Yt,Yt,1/Math.abs(Yt[3]));const i=this.fullViewport;return"x"in r?(r.x=Kt(0,i[0]+i[2],.5+.5*Yt[0]),r.y=Kt(0,i[1]+i[3],.5+.5*Yt[1])):(r[0]=Kt(0,i[0]+i[2],.5+.5*Yt[0]),r[1]=Kt(0,i[1]+i[3],.5+.5*Yt[1]),r.length>2&&(r[2]=.5*(Yt[2]+1))),r}unprojectFromScreen(t,r){return this.unprojectFromRenderScreen(this.screenToRender(t,zj),r)}unprojectFromRenderScreen(t,r){if(Zi(DP,this.projectionMatrix,this.viewMatrix),!Rn(DP,DP))return null;const i=this.fullViewport;return Yt[0]=2*(t[0]-i[0])/i[2]-1,Yt[1]=2*(t[1]-i[1])/i[3]-1,Yt[2]=2*t[2]-1,Yt[3]=1,du(Yt,Yt,DP),Yt[3]===0?null:(r[0]=Yt[0]/Yt[3],r[1]=Yt[1]/Yt[3],r[2]=Yt[2]/Yt[3],r)}constrainWindowSize(t,r,i,n=i){const s=t*this._pixelRatio,a=r*this._pixelRatio,o=Math.max(s-i/2,0),l=Math.max(this.fullHeight-a-n/2,0),c=-Math.min(s-i/2,0),u=-Math.min(this.fullHeight-a-n/2,0);return[o,l,i-c- -Math.min(this.fullWidth-s-i/2,0),n-u- -Math.min(a-n/2,0)]}computeUp(t){t===Be.Global?this._computeUpGlobal():this._computeUpLocal()}screenToRender(t,r){const i=t[0]*this._pixelRatio,n=this.fullHeight-t[1]*this._pixelRatio;return r[0]=i,r[1]=n,r}renderToScreen(t,r){const i=t[0]/this._pixelRatio,n=(this.fullHeight-t[1])/this._pixelRatio;r[0]=i,r[1]=n}_computeUpGlobal(){pe(yo,this.center,this.eye);const t=Oe(this.center);t<1?(ne(this._up,0,0,1),this._markViewDirty()):Math.abs(Se(yo,this.center))>.9999*Oe(yo)*t||(dt(this._up,yo,this.center),dt(this._up,this._up,yo),we(this._up,this._up),this._markViewDirty())}_computeUpLocal(){By(yo,this.eye,this.center),Math.abs(yo[2])<=.9999&&(le(yo,yo,yo[2]),ne(this._up,-yo[0],-yo[1],1-yo[2]),we(this._up,this._up),this._markViewDirty())}_compareAndSetView(t,r){typeof t[0]=="number"&&isFinite(t[0])&&typeof t[1]=="number"&&isFinite(t[1])&&typeof t[2]=="number"&&isFinite(t[2])?Kl(t,r)||(oe(r,t),this._markViewDirty()):Zht.warn("Camera vector contains invalid number, ignoring value")}_markViewDirty(){this._viewDirty=!0,this._frustumDirty=!0,this._viewProjectionDirty=!0}_recomputeFrustum(){this._frustumDirty&&(zCe(this.viewMatrix,this.projectionMatrix,this._frustum),this._frustumDirty=!1)}_ensureViewClean(){this._viewDirty&&(kV(this._viewMatrix,this.eye,this._center,this._up),ne(this._viewForward,-this._viewMatrix[2],-this._viewMatrix[6],-this._viewMatrix[10]),ne(this._viewUp,this._viewMatrix[1],this._viewMatrix[5],this._viewMatrix[9]),ne(this._viewRight,this._viewMatrix[0],this._viewMatrix[4],this._viewMatrix[8]),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0)}}const Yt=Jt(),DP=Ae(),yo=M(),Vj=M(),zj=ro();var Mt;(function(e){e[e.TOP=0]="TOP",e[e.RIGHT=1]="RIGHT",e[e.BOTTOM=2]="BOTTOM",e[e.LEFT=3]="LEFT"})(Mt||(Mt={}));const WN={desiredScreenFlow:2,minDuration:500,maxDuration:8e3};class Nse{constructor(t){this.createCamera=t,this.compared={sourceZoom:0,targetZoom:0,pan:0,rotate:0},this.settings={desiredScreenFlow:WN.desiredScreenFlow},this.source=t(),this.target=t()}clone(){const t=new Nse(this.createCamera);return t.copyFrom(this),t}copyFrom(t){this.update(t.source,t.target,t.settings)}update(t,r,i){this.source!==t&&this.source.copyFrom(t),this.target!==r&&this.target.copyFrom(r),this.compared=this.source.compareTo(this.target,this.compared),this.settings.desiredScreenFlow=i.desiredScreenFlow!=null?i.desiredScreenFlow:WN.desiredScreenFlow,this.desiredPixelFlow=this.settings.desiredScreenFlow*this.target.size,this.halfWindowSize=this.target.size/2}halfWindowPanAtZoom(t){const r=this.target.pixelsPerPanAtZoom(t);return this.halfWindowSize/r}get hasZoom(){return Math.abs(this.compared.sourceZoom-this.compared.targetZoom)>1e-5}get hasPan(){return this.compared.pan>1e-9}get hasRotate(){return this.compared.rotate>1e-9}}class Qht{constructor(){this.segments=[]}get time(){return this.segments.reduce((t,r)=>t+r.time,0)}interpolateComponentsAt(t,r){t=Math.min(Math.max(t,0),1),t*=this.time;let i=0,n=0;const s=this.definition;for(let a=0;a<this.segments.length;a++){const o=this.segments[a],l=o.definition;if(t<=o.time||a===this.segments.length-1){r=this.segmentInterpolateComponentsAt(o,t/o.time,r),s.hasPan?r.pan=(i+l.compared.pan*r.pan)/s.compared.pan:r.pan=1,s.hasRotate?r.rotate=(n+l.compared.rotate*r.rotate)/s.compared.rotate:r.rotate=1;const c=r.zoom*(l.compared.targetZoom-l.compared.sourceZoom)+l.compared.sourceZoom,u=this.segments[0].definition.compared.sourceZoom,h=this.segments[this.segments.length-1].definition.compared.targetZoom;return s.hasZoom?r.zoom=(c-u)/(h-u):r.zoom=1,r}t-=o.time,i+=l.compared.pan,n+=l.compared.rotate}}segmentInterpolateComponentsAt(t,r,i){return t.interpolateComponentsAt(r,i)}}class Uj{constructor(t){t&&this.update(t)}get time(){return this._time}update(t){t&&(this.definition?this.definition.copyFrom(t):this.definition=t.clone()),this._updatePrecomputedVariables(),this._updatePixelFlow()}_updatePrecomputedVariables(){const t=this.definition,r=t.compared,i=r.sourceZoom,n=r.targetZoom;this._zoomSign=i>n?1:-1,this._panPixelsAtSource=r.pan*t.source.pixelsPerPanAtZoom(i);const s=(t.source.pixelsPerRotateAtZoom(i)+t.target.pixelsPerRotateAtZoom(n))/2;this._rotatePixels=r.rotate*s}_updatePixelFlow(){const t=this.definition.compared.sourceZoom,r=this.definition.compared.targetZoom,{hasZoom:i,hasPan:n,hasRotate:s}=this.definition;let a=0,o=0;i&&(n&&(a=(r/t-1)/(-1/(this._zoomSign*this.definition.halfWindowSize)*Math.LN2*this._panPixelsAtSource)),s&&(o=this._zoomSign*(Math.log(t/r)/Math.LN2)*this.definition.halfWindowSize/this._rotatePixels)),this._zoomPixelFlow=0,this._panPixelFlow=0,this._rotatePixelFlow=0;const l=this.definition.desiredPixelFlow;if(i&&n&&s){const c=a+o+a*o;this._zoomPixelFlow=a*o/c*l,this._panPixelFlow=o/c*l,this._rotatePixelFlow=a/c*l}else if(i&&n){const c=1+a;this._zoomPixelFlow=a/c*l,this._panPixelFlow=1/c*l}else if(i&&s){const c=1+o;this._zoomPixelFlow=o/c*l,this._rotatePixelFlow=1/c*l}else if(n&&s){const c=this._panPixelsAtSource/this._rotatePixels,u=1+c;this._panPixelFlow=c/u*l,this._rotatePixelFlow=1/u*l}else n?this._panPixelFlow=l:i?this._zoomPixelFlow=l:s&&(this._rotatePixelFlow=l);this._time=s?this.rotateTime:i?this.zoomTime:n?this.panTime:0}get rotateTime(){return this.definition.hasRotate?this._rotatePixels/this._rotatePixelFlow:0}get zoomTime(){return this.definition.hasZoom?this._zoomSign*(Math.log(this.definition.compared.sourceZoom/this.definition.compared.targetZoom)/Math.LN2)*this.definition.halfWindowSize/this._zoomPixelFlow:0}get panTime(){if(this.definition.hasPan){if(this.definition.hasZoom){const t=-1/(this._zoomSign*this.definition.halfWindowSize)*Math.LN2,r=t*this._panPixelsAtSource;return Math.log(r*(this._zoomPixelFlow/this._panPixelFlow)+1)/(t*this._zoomPixelFlow)}return this._panPixelsAtSource/this._panPixelFlow}return 0}_interpolateComponentsZoom(t){if(t===0||t===1)return t;if(this.definition.hasZoom){const r=this.definition.compared.sourceZoom,i=this.definition.compared.targetZoom;return(r*(r/i)**-t-r)/(i-r)}return t}_interpolateComponentsPan(t){if(t===0||t===1)return t;if(this.definition.hasPan&&this.definition.hasZoom){const r=-1/(this._zoomSign*this.definition.halfWindowSize)*this._zoomPixelFlow;return 1/this._panPixelsAtSource*(this._panPixelFlow*(2**(r*t*this._time)-1))/(r*Math.LN2)}return t}_interpolateComponentsRotate(t){return t}interpolateComponentsAt(t,r){t=Math.min(Math.max(t,0),1);const i=this._interpolateComponentsZoom(t),n=this._interpolateComponentsPan(t),s=this._interpolateComponentsRotate(t);return r?(r.zoom=i,r.pan=n,r.rotate=s):r={zoom:i,pan:n,rotate:s},r}}function Jht(e,t,r){const i=t-e.compared.sourceZoom,n=e.halfWindowPanAtZoom(i);return-e.halfWindowSize*(r.ascensionFactor*Math.LN2*e.compared.pan+n)*Math.log(e.compared.sourceZoom/t)/(e.desiredPixelFlow*Math.LN2*n)}function Kht(e,t,r){const i=1/t,n=Math.log(e.compared.sourceZoom*i),s=1/e.desiredPixelFlow,a=1/Math.LN2,o=t-e.compared.sourceZoom,l=1/o,c=(r.ascensionFactor*Math.LN2*e.compared.pan+e.halfWindowPanAtZoom(o))/e.halfWindowPanAtZoom(1);return e.halfWindowSize*i*s*a*l*c-e.halfWindowSize*n*s*a*l+e.halfWindowSize*n*s*a*c/(o*o)}function eft(e,t,r){const i=t-e.compared.sourceZoom,n=1/i,s=1/t,a=Math.log(e.compared.sourceZoom*s),o=(r.ascensionFactor*Math.LN2*e.compared.pan+e.halfWindowPanAtZoom(i))/e.halfWindowPanAtZoom(1);return e.halfWindowSize*n*(-2*n*s*o+2*n*a+2*s-2*a*o/(i*i)-o/(t*t))/(e.desiredPixelFlow*Math.LN2)}function tft(e,t){return-e.halfWindowSize*Math.log(e.compared.sourceZoom/t)/(e.desiredPixelFlow*Math.LN2)}function rft(e,t){return e.halfWindowSize/(t*e.desiredPixelFlow*Math.LN2)}function ift(e,t){return-e.halfWindowSize/(t*t*e.desiredPixelFlow*Math.LN2)}function nft(e,t,r){return-e.compared.pan*e.halfWindowSize*(r.ascensionFactor+r.descensionFactor-1)/(e.desiredPixelFlow*e.halfWindowPanAtZoom(t))}function sft(e,t,r){return e.compared.pan*e.halfWindowSize*(r.ascensionFactor+r.descensionFactor-1)/(e.desiredPixelFlow*e.halfWindowPanAtZoom(t*t))}function aft(e,t,r){return-2*e.compared.pan*e.halfWindowSize*(r.ascensionFactor+r.descensionFactor-1)/(e.desiredPixelFlow*e.halfWindowPanAtZoom(t*t*t))}function oft(e,t,r){return e.halfWindowSize*(-e.halfWindowPanAtZoom(t)-r.descensionFactor*Math.LN2*e.compared.pan+e.halfWindowPanAtZoom(e.compared.targetZoom))*Math.log(t/e.compared.targetZoom)/(e.desiredPixelFlow*Math.LN2*e.halfWindowPanAtZoom(-t+e.compared.targetZoom))}function lft(e,t,r){const i=Math.log(t/e.compared.targetZoom),n=1/e.desiredPixelFlow,s=1/Math.LN2,a=-t+e.compared.targetZoom,o=1/a,l=(-e.halfWindowPanAtZoom(t)-r.descensionFactor*Math.LN2*e.compared.pan+e.halfWindowPanAtZoom(e.compared.targetZoom))/e.halfWindowPanAtZoom(1);return-e.halfWindowSize*i*n*s*o+e.halfWindowSize*i*n*s*l/(a*a)+e.halfWindowSize*n*s*o*l/t}function cft(e,t,r){const i=t-e.compared.targetZoom,n=1/i,s=1/t,a=Math.log(t/e.compared.targetZoom),o=(e.halfWindowPanAtZoom(t)+r.descensionFactor*Math.LN2*e.compared.pan-e.halfWindowPanAtZoom(e.compared.targetZoom))/e.halfWindowPanAtZoom(1);return e.halfWindowSize*n*(-2*n*s*o-2*n*a+2*s+2*a*o/(i*i)-o/(t*t))/(e.desiredPixelFlow*Math.LN2)}function dft(e,t){return e.halfWindowSize*Math.log(t/e.compared.targetZoom)/(e.desiredPixelFlow*Math.LN2)}function uft(e,t){return e.halfWindowSize/(t*e.desiredPixelFlow*Math.LN2)}function hft(e,t){return-e.halfWindowSize/(t*t*e.desiredPixelFlow*Math.LN2)}function fft(e){const t=Math.LN2*e.compared.pan,r=e.compared.sourceZoom-e.compared.targetZoom,i=e.halfWindowPanAtZoom(r),n=e.halfWindowSize*Math.log(e.compared.sourceZoom/e.compared.targetZoom)/(e.desiredPixelFlow*Math.LN2*i);return e.compared.sourceZoom<=e.compared.targetZoom?n*(t-i):n*(t+i)}function pft(e,t){let r=mft(e,t);const i={ascensionFactor:t.ascensionFactor!=null?t.ascensionFactor:.5,descensionFactor:t.descensionFactor!=null?t.descensionFactor:.5},n=i.ascensionFactor===0,s=i.descensionFactor===0,a=n?tft:Jht,o=n?rft:Kht,l=n?ift:eft,c=s?dft:oft,u=s?uft:lft,h=s?hft:cft,p=E=>a(e,E,i)+nft(e,E,i)+c(e,E,i),m=E=>o(e,E,i)+sft(e,E,i)+u(e,E,i),g=E=>l(e,E,i)+aft(e,E,i)+h(e,E,i);let b=p(r);const w=fft(e);let v;const x=t.maximumIterations||20,T=t.maximumDistance!=null?t.maximumDistance:1/0;for(v=0;v<x;v++){const C=(m(r)+1e-6)/g(r);if(isNaN(C)||r>=T&&C<0){if(!isFinite(T))return null;r=T,b=p(r);break}if(r-=C,r<e.compared.sourceZoom||r<e.compared.targetZoom)return null;const A=p(r);if(Math.abs(A-b)/b<=.005)break;b=A}return b>w*(1-.3)||r<e.compared.sourceZoom||r<e.compared.targetZoom?null:r}function mft(e,t){const r=Math.max(e.compared.sourceZoom,e.compared.targetZoom),i=e.source.zoomAtPixelsPerPan(e.desiredPixelFlow/e.compared.pan)/2;return i<r?t.maximumDistance!=null?r+(t.maximumDistance-r)/2:1.5*r:t.maximumDistance?Math.min(t.maximumDistance,i):i}class gft extends Qht{constructor(t,r){super(),this._preallocSegments=[new Uj,new Uj,new Uj],this.update(t,r)}update(t,r){if(!t)return;this.definition?this.definition.copyFrom(t):this.definition=t.clone();let i=null;r&&r.apex&&(i=pft(t,r.apex)),this.segments.length=0,this._ascensionSegment=null,this._descensionSegment=null,i==null?this._updateWithoutApex():this._updateWithApex(i,r.apex)}segmentInterpolateComponentsAt(t,r,i){return i=t.interpolateComponentsAt(r,i),t===this._ascensionSegment?i.zoom=Ose(i.zoom):t===this._descensionSegment&&(i.zoom=Bz(i.zoom)),i}_updateWithApex(t,r){const[i,n,s]=this._preallocSegments,a=r.ascensionFactor!=null?r.ascensionFactor:.5,o=Math.min(1-a,r.ascensionFactor!=null?r.descensionFactor:.5),l=1-a-o;i.definition?i.definition.copyFrom(this.definition):i.definition=this.definition.clone(),i.definition.compared.targetZoom=t,i.definition.compared.pan=this.definition.compared.pan*a,i.definition.compared.rotate=this.definition.compared.rotate*a,i.update(),this._ascensionSegment=i,this.segments.push(i),l>0&&(n.definition?n.definition.copyFrom(this.definition):n.definition=this.definition.clone(),n.definition.copyFrom(this.definition),n.definition.compared.sourceZoom=t,n.definition.compared.targetZoom=t,n.definition.compared.pan=this.definition.compared.pan*l,n.definition.compared.rotate=this.definition.compared.rotate*l,n.update(),this.segments.push(n)),s.definition?s.definition.copyFrom(this.definition):s.definition=this.definition.clone(),s.definition.compared.sourceZoom=t,s.definition.compared.pan=this.definition.compared.pan*o,s.definition.compared.rotate=this.definition.compared.rotate*o,s.update(),this._descensionSegment=s,this.segments.push(s)}_updateWithoutApex(){const[t]=this._preallocSegments;t.update(this.definition),this.segments.push(t)}}const yft={zoom:0,pan:0,rotate:0};class bft{constructor(t){this.createCamera=t,this._time=0,this.definition=new Nse(t),this.path=new gft}get time(){return this._time}update(t,r,i){this.definition.update(t,r,i),this.path.update(this.definition,i),this._time=this._applyTimeSettings(W2e(this.path.time),i),this._easing=i.easing?i.easing:this._time>=1e3?NCe:TO}cameraAt(t,r){r=r||this.createCamera(),t=Math.min(Math.max(0,t),1),t=this._normalizedEasing(t);const i=this.path.interpolateComponentsAt(t,yft);return r.interpolate(this.definition.source,this.definition.target,i),r}_normalizedEasing(t){const r=this._easing(0,this._time),i=this._easing(1,this._time);return(this._easing(t,this._time)-r)/(i-r)}_applyTimeSettings(t,r){const i=r.speedFactor!=null?r.speedFactor:1;r.duration!=null?t=r.duration:r.speedFactor!=null&&(t=t/i);const n=r.minDuration!=null?r.minDuration:WN.minDuration/i,s=r.maxDuration!=null?r.maxDuration:WN.maxDuration/i;return Math.min(Math.max(n,t),s)}}const vft=M();class _ft{constructor(t){this.currentTime=0,this._animation=new bft(()=>new o0e(t)),this._current=new o0e(t)}get finished(){return this.currentTime>=this._animation.time}get time(){return this._animation.time}update(t,r,i){const n=this._animation.definition.source,s=this._animation.definition.target,a=pe(vft,r.center,t.center),o=Oe(a);o>=1e-5?(a[0]/=o,a[1]/=o,a[2]/=o):(a[0]=0,a[1]=1,a[0]=0),oe(n.lookAtDirection,a),oe(s.lookAtDirection,a),n.copyFromRenderCamera(t),s.copyFromRenderCamera(r),this._current.copyFrom(n),this._animation.update(n,s,i),this.currentTime=0,t.almostEquals(r)&&(this.currentTime=this._animation.time)}cameraAt(t,r){return this._animation.cameraAt(t,this._current),r=r||new ni,this._current.copyToRenderCamera(r),r}step(t,r){return this.finished||(this.currentTime=this.currentTime+W2e(t),this.currentTime>=this.time&&(this.currentTime=this.time)),this.cameraAt(this.currentTime/this.time,r)}}var qi;(function(e){e.Ready="ready",e.Rejected="rejected",e.Running="running",e.Stopped="stopped",e.Finished="finished"})(qi||(qi={}));let W3=class extends xe{constructor(){super(...arguments),this.state=qi.Ready}get active(){return this.state===qi.Running}get isInteractive(){return!1}get canStop(){return!1}stopController(){return!!this.canStop&&(this.state=qi.Stopped,!0)}finishController(){this.state=qi.Finished}get steppingFinished(){return!1}};d([f({readOnly:!0})],W3.prototype,"active",null),d([f()],W3.prototype,"state",void 0),W3=d([$("esri.views.3d.state.controllers.CameraController")],W3);let iR=class extends W3{get canStop(){return!0}set asyncResult(e){this._asyncResult&&(this._asyncResult.reject(br()),this._asyncResult=null),this.state===qi.Finished||this.state===qi.Stopped?this.state===qi.Finished?e.resolve():e.reject(br()):this._asyncResult=e}get asyncResult(){return this._asyncResult}onControllerStart(){this.state=qi.Running,_(this.viewAnimation)&&this.viewAnimation.when(()=>this.updateStateFromViewAnimation(),()=>this.updateStateFromViewAnimation())}updateStateFromViewAnimation(){!_(this.viewAnimation)||this.state!==qi.Ready&&this.state!==qi.Running||(this.viewAnimation.state===u9.State.FINISHED?this.finish():this.viewAnimation.state===u9.State.STOPPED&&(this.state=qi.Stopped))}onControllerEnd(){_(this.viewAnimation)&&!this.viewAnimation.done&&(this.state===qi.Finished?this.viewAnimation.finish():this.state===qi.Stopped&&this.viewAnimation.stop()),this._asyncResult&&(this.state===qi.Finished?this._asyncResult.resolve():this._asyncResult.reject(br()))}finish(){this.finishController()}};iR=d([$("esri.views.3d.state.controllers.AnimationController")],iR);let ty=class extends iR{constructor(e){super(e),this.view=null,this.mode="interaction",this.hasTarget=!1}get intersectionHelper(){return this.view.sceneIntersectionHelper}initialize(){this.animation=new _ft(this.view.state.viewingMode),this.viewAnimation=this.mode==="interaction"?null:new u9}get isInteractive(){return this.mode==="interaction"}begin(e,t){this.hasTarget=!0;const r=this.animationSettings(t);FP.copyFrom(this.view.state.camera);const i=tf(this.view.state.viewingMode);this.intersectionHelper.intersectRay(FP.ray,i,l0e)&&(FP.center=l0e),this.animation.update(FP,e,r),this.animation.finished&&this.finish()}finish(){this.animation.currentTime=this.animation.time,super.finish()}get steppingFinished(){return this.hasTarget&&this.animation.finished}stepController(e,t){this.hasTarget&&this.animation.step(e,t)}onControllerEnd(e){this.hasTarget&&(this.animation.cameraAt(this.animation.currentTime/this.animation.time,e),this.animation.currentTime=this.animation.time),super.onControllerEnd(e)}animationSettings(e={}){return{apex:{maximumDistance:this.view.state.constraints.clampAltitude(1/0)/6,ascensionFactor:void 0,descensionFactor:void 0},...e,easing:typeof e.easing=="string"?Dht[e.easing]:e.easing}}};d([f({constructOnly:!0})],ty.prototype,"view",void 0),d([f({constructOnly:!0})],ty.prototype,"mode",void 0),ty=d([$("esri.views.3d.state.controllers.PointToPointAnimationController")],ty);const FP=new ni,l0e=M();function qCe(e,t,r){return wft(e,e.screenToRender(t,qe.get()),r)}function wft(e,t,r){const i=Na(qe.get(),t);if(i[2]=0,!e.unprojectFromRenderScreen(i,r.origin))return null;const n=Na(qe.get(),t);n[2]=1;const s=e.unprojectFromRenderScreen(n,qe.get());return R(s)?null:(pe(r.direction,s,r.origin),r)}function w6(e,t,r){return kse(e,e.screenToRender(t,qe.get()),r)}function kse(e,t,r){oe(r.origin,e.eye);const i=ne(qe.get(),t[0],t[1],1),n=e.unprojectFromRenderScreen(i,qe.get());return R(n)?null:(pe(r.direction,n,r.origin),r)}function Vse(e,t,r,i){const n=w6(t,r,xft);return y_(e,n,i)}const xft=Ma();var C9;(function(e){e[e.Ellipsoid=0]="Ellipsoid",e[e.Silhouette=1]="Silhouette"})(C9||(C9={}));const HCe=30,XN=[1,3e8],WCe=70;function gw(e,t,r){return r[0]=t[0]/(e.fullWidth/e.pixelRatio),r[1]=t[1]/(e.fullHeight/e.pixelRatio),r}function HJ(e){for(;e>Math.PI;)e-=2*Math.PI;for(;e<-Math.PI;)e+=2*Math.PI;return e}function a_(e,t,r){const i=Cu(nie.get(),r[3],r);R(i)||(pe(Wr,e.eye,t),ze(Wr,Wr,i),e.eye=he(Wr,Wr,t),pe(Wr,e.center,t),ze(Wr,Wr,i),e.center=he(Wr,Wr,t),e.up=ze(Wr,e.up,i))}function Tft(e,t,r,i){return Cx(e,qCe(t,r,Bse),i)}function WJ(e,t,r,i){return Cx(e,w6(t,r,Bse),i)}function zse(e,t,r,i){const n=qe.get();let s=1-r;pe(n,t,e.eye);const a=Oe(n);let o=a*(1-s);s>=0&&o<i&&(o=i,s=-(o-a)/a),Math.abs(a-o)<1e-6||(le(n,n,s),e.eye=he(Wr,e.eye,n),e.center=As(Wr,e.center,t,s))}function XCe(e,t,r){t.getScreenCenter(c0e),Vse(e,t,c0e,Wr)&&(t.center=Wr);const i=t.distance,n=i*r;if(Math.abs(i-n)<1e-6)return;const s=le(qe.get(),t.viewForward,n);t.eye=pe(Wr,t.center,s)}const c0e=tn();function Bj(e,t){ne(t,0,0,0);for(const r of e)he(t,t,r);le(t,t,1/e.length)}function iD(e,t,r,i){return Math.sin(e/Oe(t))*(r+i.radius)}function d0e(e,t,r,i){return iD(Math.PI/2,t,r,i)+(e-Math.PI/2)}var Pa;(function(e){e[e.Vertical=0]="Vertical",e[e.Horizontal=1]="Horizontal"})(Pa||(Pa={}));const u0e={Elevation:3e4,Angle:kt(6)},u7={Pole:.95,Angle:kt(18),Tilt:45},YCe=kt(80);function ZCe(e,t,r,i,n,s){const a=M(),o=Us();let l=!0,c=!0;return e.intersectScreen(r,a,s)?o[3]=Oe(a):(c=!1,t.aboveGround&&n!==C9.Ellipsoid?o[3]=Math.max(Oe(t.center),.9*i.radius):o[3]=Oe(t.eye)-t.relativeElevation,n===C9.Silhouette?nR(o,t,r,a):l=Vse(o,t,r,a)),{sphere:o,scenePickPoint:l?a:null,hasGeometryIntersection:c}}function Gz(e,t,r,i){return Oe(e.eye)-i.radius>u0e.Elevation?Pa.Horizontal:r?(w6(e,t,v0e),-Math.sign(e.relativeElevation)*(.5*Math.PI+aie(e.eye,v0e.direction))<u0e.Angle?Pa.Vertical:Pa.Horizontal):Pa.Vertical}function QCe(e,t,r){pe(Gj,r,t),e.eye=pe(Wr,e.eye,Gj),e.center=pe(Wr,e.center,Gj)}const Gj=M();function nR(e,t,r,i){const n=w6(t,r,Bse);return!R(n)&&(n6(e,n,NP),y_(e,n,i)?!(Vs(NP,n.origin)<Vs(i,n.origin))||(oe(i,NP),!1):(pe(eT,t.eye,t.center),we(eT,eT),SSe(eT,-Se(we(eT,eT),NP),h0e),Cx(h0e,n,i),!1))}const NP=M(),eT=M(),h0e=Er();function JCe(e,t,r,i,n,s){let a;if(dt(QN,e,t),pe(UP,e,t),Oe(e)<=n||!i.aboveGround){dt(r,UP,i.eye);const o=Se(e,t)/(Oe(e)*Oe(t)),l=Math.cos(Le(Wv.normalize(kt(s)),0,YCe));a=-Rs(o)-Math.max(0,Oe(t)-n)/(l*n)}else pe(f0e,i.eye,i.center),dt(r,UP,f0e),a=-Oe(UP)/n;return we(r,r),le(r,r,Oe(QN)),a}const f0e=M();function p0e(e,t,r,i){let n,s;const a=Math.cos(Le(Wv.normalize(kt(i)),0,YCe));return n=t>r?-(t-r)/(a*r):t<-r?Math.PI-(t+r)/(a*r):Rs(t/r),s=e>r?-(e-r)/(a*r):e<-r?Math.PI-(e+r)/(a*r):Rs(e/r),(s-n)*r}function Sft(e,t,r,i,n,s,a,o,l,c){const u=p0e(e[2],t[2],a[3],l),h=c?p0e(e[0],t[0],a[3],180):t[0]-e[0],p=Math.sin(o)*h-Math.cos(o)*u,m=Math.cos(o)*h+Math.sin(o)*u;we(Wr,n);const g=c?p/Math.sqrt(Math.abs(a[3]**2-Se(r,Wr)**2)):p/a[3],b=m/Math.sqrt(Math.abs(a[3]**2-Se(r,i)**2));vr(s,g,b)}function KCe(e,t,r,i,n,s,a,o,l,c){dt(QN,e,t),hZ(s.up,s.eye,kP,VP,zP),hZ([0,0,1],s.eye,py,Nv,i7e),oe(r,Nv),oe(i,py),we(r,r),le(r,r,Oe(QN)),Lde(e,we(VP,VP),we(zP,zP),we(kP,kP),m0e),Lde(t,VP,zP,kP,g0e),Sft(m0e,g0e,e,py,Nv,n,a,o,l,c)}function Eft(e,t,r,i,n,s,a){Cu(YN,n,i),Cu(ZN,a,s),Zi(T4,YN,ZN),pe(t,e,r),ze(t,t,T4),he(t,t,r)}function e7e(e,t,r,i,n,s){Cu(YN,i,r),Cu(ZN,s,n),Zi(T4,YN,ZN),pe(Wr,e.eye,t),ze(Wr,Wr,T4),e.eye=he(Wr,Wr,t),pe(Wr,e.center,t),ze(Wr,Wr,T4),e.center=he(Wr,Wr,t),pe(Wr,e.up,t),ze(Wr,Wr,T4),e.up=he(Wr,Wr,t)}function Use(e,t,r,i,n,s,a=u7.Pole,o=u7.Angle){const l=Math.abs(i)>Math.PI-o||Math.abs(i)<o,c=Math.abs(e[2])<r*a||Math.abs(t)>r;return!!(l&&c&&s.aboveGround&&n<u7.Tilt)}function t7e(e,t,r,i,n,s){if(s)VA(r,i,y0e),a_(t,e,y0e);else{const a=JCe(r,i,b0e,t,e[3],n);a_(t,e,kA(b0e,a))}}function r7e(e,t,r,i,n,s,a){const o=a?20:1,l=1e-12;let c,u;oe(z_,i),BP.copyFrom(t);for(let h=0;h<o&&Vs(r,z_)>l&&(c=Vs(r,z_),KCe(r,z_,Nv,py,c8,BP,e,n,s,a),e7e(BP,e,py,c8[1],Nv,c8[0]),Eft(z_,z_,e,py,c8[1],Nv,c8[0]),u=Vs(r,z_),u<c||h===0);h++)t.copyFrom(BP)}function Cft(e,t,r,i,n,s,a){Use(r,Se(t.up,r),e[3],-Wv.normalize(kt(n)),s,t,u7.Pole,u7.Angle)?r7e(e,t,r,i,-Wv.normalize(kt(n)),s,a):t7e(e,t,r,i,s,a)}function Aft(e,t,r,i,n,s){const{eye:a}=e;hZ([0,0,1],a,py,Nv,i7e);const o=t.translation[0]*r.pan,l=n.mode==="zoom"?0:t.translation[1]*r.pan,c=Math.max(Math.sqrt(Math.abs(1-Se(e.center,py)**2/Oe(e.center)**2)),.5),u=(Math.sin(s)*l+Math.cos(s)*o)/c,h=-Math.cos(s)*l+Math.sin(s)*o;switch(rd(i.pan.matrix,i.pan.matrix,u,py),i.pan.enabled=!0,n.mode){case"pan":rd(i.pan.matrix,i.pan.matrix,h,Nv),i.pan.enabled=!0;break;case"zoom":i.zoom=-t.translation[1]*r.zoom}}function Rft(e,t,r,i,n){const{eye:s,viewRight:a}=e,o=dt(qe.get(),a,s),l=t.translation[0]*r.pan;switch(l!==0&&(rd(i.pan.matrix,i.pan.matrix,-l,o),i.pan.enabled=!0),n.mode){case"pan":{const c=t.translation[1]*r.pan;c!==0&&(rd(i.pan.matrix,i.pan.matrix,c,a),i.pan.enabled=!0);break}case"zoom":i.zoom=-t.translation[1]*r.zoom}}function Oft(e,t,r,i,n,s,a,o,l){Use(e.center,Se(e.up,e.center),Oe(e.center),-Wv.normalize(kt(s)),a,t)?Aft(t,r,i,o,l,-Wv.normalize(kt(n))):Rft(t,r,i,o,l)}const py=M(),Nv=M(),i7e=M(),kP=M(),VP=M(),zP=M(),m0e=M(),g0e=M(),c8=it(),y0e=b6(),YN=Ae(),ZN=Ae(),T4=Ae(),z_=M(),Wr=M(),UP=M(),BP=new ni,QN=M(),b0e=M(),Bse={origin:M(),direction:M()},v0e={origin:M(),direction:M()},_0e=.6,jj=4,Mft=12,Pft=60,Ift=200;let JN=class extends ty{constructor(){super(...arguments),this.zoomLocation=M(),this.tmpCamera=new ni,this.tmpViewDir=M(),this.tmpRayDir={origin:M(),direction:M()},this.targetOnSphere=M(),this.tmpCenter=M(),this.constraintOptions={selection:Ti.ALL_EXCEPT_COLLISION,interactionType:Ht.ZOOM,interactionFactor:null,interactionStartCamera:new ni,interactionDirection:null,tiltMode:aa.TUMBLE},this.sphere=Us()}initialize(){this.intersector=tf(this.view.state.viewingMode)}zoomStep(e,t){if(!this.active)return;const r=this.view.state,{interactionStartCamera:i}=this.constraintOptions;this.animation.finished?i.copyFrom(r.camera):this.animation.cameraAt(1,i);let n=!1,s=!1;this.intersectionHelper.intersectScreen(t,this.zoomLocation,this.view.map.ground.opacity===0?$ft:{})&&(n=e>0,s=!0),this.tmpCamera.copyFrom(r.camera),n?this.intersectionHelper.intersectRay(this.tmpCamera.ray,this.intersector,this.tmpCenter)&&(this.tmpCamera.center=this.tmpCenter):this.intersectionHelper.intersectRay(this.tmpCamera.ray,this.intersector,this.zoomLocation)?this.tmpCamera.center=this.zoomLocation:oe(this.zoomLocation,this.tmpCamera.center),this._updateCamera(this.tmpCamera,e,this.zoomLocation,t,s),this.begin(this.tmpCamera)}animationSettings(){return{apex:null,duration:600,easing:TO}}_updateCamera(e,t,r,i,n){const s=Ar(this.view.spatialReference),a=Gz(e,i,n,s);let o;this.view.camera.position.hasZ&&(o=Math.abs(this.view.camera.position.z)),we(jP,e.eye),le(jP,jP,-1),w6(e,i,this.tmpRayDir),we(this.tmpRayDir.direction,this.tmpRayDir.direction);const l=Math.max(Math.min(Mft,1/Math.abs(Se(jP,this.tmpRayDir.direction)))*o,Ift);if(a===Pa.Horizontal){let c=_0e**t;this.sphere[3]=Oe(r),pe(this.tmpViewDir,e.center,e.eye);const u=Math.min(Oe(this.tmpViewDir),l);let h=u*c;if(c<=1&&h<jj&&(h=jj,c=h/u),Math.abs(u-h)<1e-6)return;const p=Oe(e.center);if(this.sphere[3]!==p){const m=this.sphere[3]+c*(p-this.sphere[3]);e.center=le(GP,e.center,m/p)}le(this.tmpViewDir,this.tmpViewDir,-c),e.eye=he(GP,e.center,this.tmpViewDir),En(this.view,e,this.constraintOptions),Vs(r,e.center)>1e-12&&Vse(this.sphere,e,i,this.targetOnSphere)&&Cft(this.sphere,e,r,this.targetOnSphere,this.view.camera.heading,this.view.camera.tilt,!0)}else{let c=_0e**Math.abs(t);const u=t>0?1:-1;pe(this.tmpViewDir,r,e.eye);const h=Oe(this.tmpViewDir),p=this.view._stage.renderView.getMinimalDepthForArea(null,i[0],i[1],this.view.state.camera,Pft);let m=p?Math.min(l,p):l;m=n?Math.min(m,h):m,le(this.tmpRayDir.direction,this.tmpRayDir.direction,m),he(r,this.tmpRayDir.origin,this.tmpRayDir.direction);let g=m*c;const b=Math.max(jj,1.01*e.nearFar[0]);if(t>0&&g<b&&(g=b,c=g/m),Math.abs(m-g)<1e-6)return;le(this.tmpRayDir.direction,this.tmpRayDir.direction,u*(1-c)),e.eye=he(GP,e.eye,this.tmpRayDir.direction),e.center=he(GP,e.center,this.tmpRayDir.direction)}_6(this.view,e)}};JN=d([$("esri.views.3d.state.controllers.global.ZoomStepController")],JN);const GP=M(),jP=M(),$ft={exclude:new Set([op])},Lft=.6,Dft=4,Fft=60,Nft=14,kft=200;let KN=class extends ty{constructor(){super(...arguments),this.zoomLocation=M(),this.tmpCamera=new ni,this.tmpRayDir=M(),this.tmpCenter=M(),this.constraintOptions={selection:Ti.ALL,interactionType:Ht.ZOOM,interactionFactor:null,interactionStartCamera:new ni,interactionDirection:null,tiltMode:aa.TUMBLE}}zoomStep(e,t){if(!this.active)return;const r=this.view.state,{interactionStartCamera:i}=this.constraintOptions;this.animation.finished?i.copyFrom(r.camera):this.animation.cameraAt(1,i),this.tmpCamera.copyFrom(r.camera);const n=tf(this.view.state.viewingMode);e>0?(this.view.map.ground.opacity===0?this.intersectionHelper.intersectScreenFreePointFallback(t,this.zoomLocation,zft):this.intersectionHelper.intersectScreenFreePointFallback(t,this.zoomLocation),this.intersectionHelper.intersectRay(this.tmpCamera.ray,n,this.tmpCenter)&&(this.tmpCamera.center=this.tmpCenter)):this.intersectionHelper.intersectRay(this.tmpCamera.ray,n,this.zoomLocation)?this.tmpCamera.center=this.zoomLocation:oe(this.zoomLocation,this.tmpCamera.center);const s=Lft**e;let a=this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm,t[0],t[1],this.view.state.camera,Fft);pe(qP,this.tmpCamera.eye,this.zoomLocation),we(qP,qP);const o=Math.max(Math.min(Nft,1/Math.abs(Se(Vft,qP)))*Math.abs(this.view.camera.position.z),kft);if(a=a?Math.min(a,o):o,a){const l=M();pe(l,this.zoomLocation,this.tmpCamera.eye),a<Oe(l)&&(we(l,l),he(this.zoomLocation,this.tmpCamera.eye,le(l,l,a)))}this._updateCamera(this.tmpCamera,s,this.zoomLocation),this.begin(this.tmpCamera)}animationSettings(){return{apex:null,duration:600,easing:TO}}_updateCamera(e,t,r){pe(this.tmpRayDir,r,e.eye);const i=Oe(this.tmpRayDir);let n=i*t;const s=t<=1,a=Math.max(Dft,1.01*e.nearFar[0]);s&&n<a&&(n=a,t=n/i),Math.abs(i-n)<1e-6||(le(this.tmpRayDir,this.tmpRayDir,t),e.eye=pe(w0e,r,this.tmpRayDir),e.center=As(w0e,e.center,r,1-t),En(this.view,e,this.constraintOptions))}};KN=d([$("esri.views.3d.state.controllers.local.ZoomStepController")],KN);const w0e=M(),Vft=Ve(0,0,1),qP=M(),zft={exclude:new Set([op])};function Uft(e,t){switch(t){case"primary":return e.pointerType==="touch"||e.button===0;case"secondary":return e.pointerType!=="touch"&&e.button===2;case"tertiary":return e.pointerType!=="touch"&&e.button===1}}function Gse(e,t){if(e.pointerType==="touch")return!1;switch(t){case"primary":return e.button===0;case"secondary":return e.button===2;case"tertiary":return e.button===1}}class Bft extends ho{constructor(t,r){super(!0),this.view=t,this.registerIncoming("double-click",r,i=>this._handleDoubleClick(i))}_handleDoubleClick(t){const r=t.data;if(Uft(r,"primary")){const i=this.view.state.isGlobal?new JN({view:this.view,mode:"animation"}):new KN({view:this.view,mode:"animation"});this.view.state.switchCameraController(i),i.zoomStep(Math.log(.5)/Math.log(.6),tn(r.x,r.y)),t.stopPropagation()}}}let o_=class extends W3{constructor(){super(...arguments),this.startCamera=new ni,this.currentCamera=new ni}get isInteractive(){return!0}stepController(e,t){t.copyViewFrom(this.currentCamera),this.currentCamera.copyFrom(t)}onControllerStart(e){this.state=qi.Running,this.startCamera.copyFrom(e),this.currentCamera.copyFrom(e)}onControllerEnd(e){e.copyViewFrom(this.currentCamera)}};o_=d([$("esri.views.3d.state.controllers.InteractiveController")],o_);var Bc;(function(e){e[e.CENTER=0]="CENTER",e[e.EYE=1]="EYE"})(Bc||(Bc={}));const Gft=7,qj=90;let S4=class extends o_{constructor(e){super(e),this.view=null,this.pivot=Bc.CENTER,this.lastPoint=it(),this.tmpWorldUp=M(),this.tmpViewDir=M(),this.tmpRotCurPoint=it(),this.tmpTransf=Ae(),this.tmpAxis=M(),this.tmpPivotPoint=M(),this.pivotPos=M(),this.constraintOptions={selection:Ti.ALL,interactionType:Ht.TUMBLE,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:aa.TUMBLE}}get intersectionHelper(){return this.view.sceneIntersectionHelper}initialize(){this.rotScale=this.pivot===Bc.CENTER?3:1.5}begin(e){if(this.active){switch(this.pivot){case Bc.EYE:oe(this.pivotPos,this.startCamera.eye),this.constraintOptions.interactionType=Ht.LOOK_AROUND,this.constraintOptions.tiltMode=aa.LOOK_AROUND,this.constraintOptions.selection=Ti.NONE;break;case Bc.CENTER:{const t=this.intersectionHelper.intersectRayFreePointFallback(this.startCamera.ray,this.pivotPos);t||oe(this.pivotPos,this.startCamera.center),this._constrainPivotPoint(e,t),this.startCamera.center=this.pivotPos,this.constraintOptions.interactionType=Ht.TUMBLE,this.constraintOptions.tiltMode=aa.TUMBLE,this.constraintOptions.selection=Ti.ALL&~Ti.DISTANCE;break}}this.constraintOptions.interactionStartCamera=this.startCamera,gw(this.startCamera,e,this.lastPoint)}}_constrainPivotPoint(e,t){const r=this.startCamera,i=M();pe(i,this.pivotPos,r.eye);const n=Oe(i);let s=Math.min(n,Gft*Math.abs(this.view.camera.position.z));const a=Ar(this.view.spatialReference),o=tn(r.width/r.pixelRatio*.5,r.height/r.pixelRatio*.5),l=Gz(this.startCamera,o,!0,a);let c=this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm,r.fullWidth/r.pixelRatio*.5,r.fullHeight/r.pixelRatio*.5,r,2.5*qj,qj),u=this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm,e[0],e[1],r,qj);c===void 0&&u===void 0||(c=c===void 0?u:c,u=u===void 0||l===Pa.Horizontal?c:u,s=c>u?u:c,s=t?Math.min(s,n):s),we(i,i),oe(this.pivotPos,he(this.tmpPivotPoint,r.eye,le(this.tmpPivotPoint,i,s)))}update(e){if(this.active){switch(this.pivot){case Bc.EYE:this.currentCamera.center=this._applyRotation(this.currentCamera,e,this.currentCamera.center,this.pivotPos);break;case Bc.CENTER:this.currentCamera.center=this.pivotPos,this.currentCamera.eye=this._applyRotation(this.currentCamera,e,this.currentCamera.eye,this.pivotPos)}En(this.view,this.currentCamera,this.constraintOptions)}}end(){this.active&&this.finishController()}_applyRotation(e,t,r,i){this.view.renderCoordsHelper.worldUpAtPosition(i,this.tmpWorldUp),gw(e,t,this.tmpRotCurPoint);let n=(this.lastPoint[1]-this.tmpRotCurPoint[1])*this.rotScale,s=(this.tmpRotCurPoint[0]-this.lastPoint[0])*this.rotScale;pe(this.tmpViewDir,r,i);const a=Oe(this.tmpViewDir),o=Rs(Se(this.tmpViewDir,this.tmpWorldUp)/a);if(this.pivot===Bc.EYE){n*=-.5;const l=.5*Math.PI-o,c=.5*Math.PI*.99;n=l-Math.max(-c,Math.min(c,l+n))}return n=Le(n+o,Ka.min,Ka.max)-o,dt(this.tmpAxis,e.up,this.tmpViewDir),this.pivot===Bc.CENTER&&(s=-s),Cu(this.tmpTransf,s,this.tmpWorldUp),rd(this.tmpTransf,this.tmpTransf,n,this.tmpAxis),ze(this.tmpViewDir,this.tmpViewDir,this.tmpTransf),e.up=ze(Hj,e.up,this.tmpTransf),he(Hj,i,this.tmpViewDir),Na(this.lastPoint,this.tmpRotCurPoint),Hj}};d([f({constructOnly:!0})],S4.prototype,"view",void 0),d([f()],S4.prototype,"pivot",void 0),S4=d([$("esri.views.3d.state.controllers.RotateController")],S4);const Hj=M();class Wj extends ho{constructor(t,r,i,n){super(!0),this.view=t,this.pointerAction=r,this.pivot=i,this.registerIncoming("drag",n,s=>this._handleDrag(s))}_handleDrag(t){const r=t.data;if(r.pointers.size>1||!Gse(t.data,this.pointerAction))return;const i=tn(r.center.x,r.center.y);switch(r.action){case"start":this.cameraController&&(this.cameraController.end(),this.cameraController=null),this.cameraController=new S4({view:this.view,pivot:this.pivot}),this.view.state.switchCameraController(this.cameraController),this.cameraController.begin(i);break;case"update":this.cameraController&&this.cameraController.update(i);break;case"end":this.cameraController&&(this.cameraController.end(),this.cameraController=null)}t.stopPropagation()}}let nD=class extends o_{constructor(e){super(e),this.view=null,this.pickPoint=M(),this.tmpP0=it(),this.panAxisAngle=b6(),this.tmpRayDir=M(),this.tmpRayDirPick=M(),this.targetOnSphere=M(),this.tmpRay={origin:M(),direction:M()},this.dragBeginPoint=tn(),this.normalizedAnchorPoint=it(),this.constraintOptions={selection:Ti.ALL_EXCEPT_COLLISION,interactionType:Ht.ZOOM,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:aa.TUMBLE},this.sphere=Us(),this.hasPickPoint=!1}get intersectionHelper(){return this.view.sceneIntersectionHelper}begin(e){if(!this.active)return;Na(this.dragBeginPoint,e),gw(this.startCamera,e,this.normalizedAnchorPoint);const t=Ar(this.view.spatialReference),r=ZCe(this.intersectionHelper,this.startCamera,e,t,C9.Ellipsoid,this.view.map.ground.opacity===0?jft:{});if(this.navMode=Gz(this.startCamera,e,r.hasGeometryIntersection,t),this.navMode===Pa.Horizontal)this.hasPickPoint=!!r.scenePickPoint,this.pickPoint=r.scenePickPoint,this.sphere=r.sphere;else{let i,n;w6(this.startCamera,e,this.tmpRay),we(this.tmpRay.direction,this.tmpRay.direction),r.scenePickPoint&&(pe(this.tmpRayDirPick,this.startCamera.eye,r.scenePickPoint),n=Oe(this.tmpRayDirPick)),this.view.camera.position.hasZ&&(i=Math.abs(this.view.camera.position.z));let s=Le(HCe*i,XN[0],XN[1]);const a=this.view._stage.renderView.getMinimalDepthForArea(null,e[0],e[1],this.view.state.camera,WCe);s=a?Math.min(s,a):s,s=r.scenePickPoint?Math.min(s,n):s,this.hasPickPoint=!0,le(this.tmpRay.direction,this.tmpRay.direction,s),he(this.pickPoint,this.tmpRay.origin,this.tmpRay.direction)}this.constraintOptions.interactionStartCamera=this.startCamera}update(e){if(this.active){if(this.currentCamera.eye=this.startCamera.eye,this.currentCamera.center=this.startCamera.center,this.currentCamera.up=this.startCamera.up,this.navMode===Pa.Horizontal){pe(this.tmpRayDir,this.currentCamera.center,this.currentCamera.eye);const t=Oe(this.tmpRayDir);gw(this.currentCamera,e,this.tmpP0);const r=12*(this.normalizedAnchorPoint[1]-this.tmpP0[1]);let i=t*2**r;const n=this.view.state.constraints.minimumPoiDistance;if(r<0&&i<n&&(i=n),Math.abs(t-i)<1e-6)return;if(this.hasPickPoint&&i<t){const s=1-(1-i/t)*(1-this.sphere[3]/Oe(this.currentCamera.center));this.currentCamera.center=le(HP,this.currentCamera.center,s)}le(this.tmpRayDir,this.tmpRayDir,-i/t),this.currentCamera.eye=he(HP,this.currentCamera.center,this.tmpRayDir),this.constraintOptions.interactionFactor=np(this.dragBeginPoint,e),En(this.view,this.currentCamera,this.constraintOptions),this.hasPickPoint&&(nR(this.sphere,this.currentCamera,this.dragBeginPoint,this.targetOnSphere),VA(this.pickPoint,this.targetOnSphere,this.panAxisAngle),a_(this.currentCamera,this.sphere,this.panAxisAngle))}else{const t=Oe(this.tmpRay.direction);gw(this.currentCamera,e,this.tmpP0);const r=12*(this.normalizedAnchorPoint[1]-this.tmpP0[1]);let i=t*2**r;const n=this.view.state.constraints.minimumPoiDistance;if(r<0&&i<n&&(i=n),Math.abs(t-i)<1e-6)return;le(this.tmpRayDir,this.tmpRay.direction,1-i/t),this.currentCamera.eye=he(HP,this.currentCamera.eye,this.tmpRayDir),this.currentCamera.center=he(HP,this.currentCamera.center,this.tmpRayDir)}_6(this.view,this.currentCamera)}}end(){this.active&&this.finishController()}};d([f({constructOnly:!0})],nD.prototype,"view",void 0),nD=d([$("esri.views.3d.state.controllers.global.ZoomController")],nD);const HP=M(),jft={exclude:new Set([op])};let sD=class extends o_{constructor(e){super(e),this.view=null,this.tmpP=M(),this.tmpDir=M(),this.tmpN=M(),this.tmpP0=it(),this.tmpPoi=M(),this.tmpRayDir=M(),this.dragBeginPoint=tn(),this.normalizedAnchorPoint=it(),this.constraintOptions={selection:Ti.ALL,interactionType:Ht.ZOOM,interactionFactor:0,interactionStartCamera:null,interactionDirection:M(),tiltMode:aa.TUMBLE},this.plane=Er()}get intersectionHelper(){return this.view.sceneIntersectionHelper}begin(e){if(!this.active)return;Na(this.dragBeginPoint,e),gw(this.startCamera,e,this.normalizedAnchorPoint);const t=this.intersectionHelper.intersectScreenFreePointFallback(e,this.tmpP,this.view.map.ground.opacity===0?qft:{});pe(this.tmpDir,this.tmpP,this.startCamera.eye);const r=Oe(this.tmpDir);let i;we(this.tmpDir,this.tmpDir),this.view.camera.position.hasZ&&(i=Math.abs(this.view.camera.position.z));let n=Le(HCe*i,XN[0],XN[1]);const s=this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm,e[0],e[1],this.view.state.camera,WCe);n=s?Math.min(n,s):n,n=t?Math.min(n,r):n,le(this.tmpDir,this.tmpDir,n),he(this.tmpP,this.startCamera.eye,this.tmpDir),pe(this.tmpN,this.startCamera.eye,this.startCamera.center),we(this.tmpN,this.tmpN),this.tmpN[1]<0&&Io(this.tmpN,this.tmpN),r9(this.tmpP,this.tmpN,this.plane),this.constraintOptions.interactionStartCamera=this.startCamera}update(e){if(!this.active)return;Tft(this.plane,this.currentCamera,this.dragBeginPoint,this.tmpPoi)||oe(this.tmpPoi,this.currentCamera.center),gw(this.currentCamera,e,this.tmpP0);let t=4*(this.tmpP0[1]-this.normalizedAnchorPoint[1]);Na(this.normalizedAnchorPoint,this.tmpP0),pe(this.tmpRayDir,this.tmpPoi,this.currentCamera.eye);const r=Oe(this.tmpRayDir);let i=r*(1-t);oe(this.constraintOptions.interactionDirection,this.tmpRayDir),le(this.constraintOptions.interactionDirection,this.constraintOptions.interactionDirection,Math.sign(t)/r);const n=this.view.state.constraints.minimumPoiDistance;t>=0&&i<n&&(i=n,t=-(i-r)/r),Math.abs(r-i)<1e-6||(le(this.tmpRayDir,this.tmpRayDir,t),this.currentCamera.eye=he(U_,this.currentCamera.eye,this.tmpRayDir),As(U_,this.currentCamera.center,this.tmpPoi,t),this.tmpPoi[2]>this.startCamera.center[2]?U_[2]=Math.max(this.startCamera.center[2],U_[2]):U_[2]=Math.min(this.startCamera.center[2],U_[2]),this.currentCamera.center=U_,this.constraintOptions.interactionFactor=np(this.dragBeginPoint,e),En(this.view,this.currentCamera,this.constraintOptions))}end(){this.active&&this.finishController()}};d([f({constructOnly:!0})],sD.prototype,"view",void 0),sD=d([$("esri.views.3d.state.controllers.local.ZoomController")],sD);const U_=M(),qft={exclude:new Set([op])};class Hft extends ho{constructor(t,r,i){super(!0),this.view=t,this.pointerAction=r,this.registerIncoming("drag",i,n=>this._handleDrag(n))}_handleDrag(t){const r=t.data;if(r.pointers.size>1||!Gse(t.data,this.pointerAction))return;const i=tn(r.center.x,r.center.y);switch(r.action){case"start":this.cameraController&&(this.cameraController.end(),this.cameraController=null),this.view.state.isGlobal?this.cameraController=new nD({view:this.view}):this.cameraController=new sD({view:this.view}),this.view.state.switchCameraController(this.cameraController),this.cameraController.begin(i);break;case"update":this.cameraController&&this.cameraController.update(i);break;case"end":this.cameraController&&(this.cameraController.end(),this.cameraController=null)}t.stopPropagation()}}const Wft=M(),WP=M();function jse(){return{direction:M(),up:M()}}function n7e(e,t,r,i,n){let s=we(Wft,e),a=Se(s,i);const o=a>0;a=Math.abs(a),a>.99&&(a=Math.abs(Se(t,i)),a<.99?(oe(s,t),o&&le(s,s,-1)):s=null);let l=0;if(s){le(WP,i,Se(i,s)),pe(s,s,WP);const u=Se(s,n)/(Oe(s)*Oe(n));dt(WP,s,n),l=(Se(WP,i)>0?1:-1)*md(Rs(u))}const c=md(Rs(-Se(i,e)/Oe(e)));return r?(r.heading=l,r.tilt=c,r):{heading:l,tilt:c}}const s7e=Ve(0,1,0),a7e=Ve(0,0,1),d8=Ae(),Gm=M(),jm=M();function o7e(e,t,r,i=jse()){const{direction:n,up:s}=i;return xTe(d8,-kt(t)),Q5(d8,d8,kt(r)),ze(n,a7e,d8),le(n,n,-1),ze(s,s7e,d8),i}function Xft(e,t,r,i){return n7e(t,r,i,a7e,s7e)}function Yft(e,t,r,i){const n=o7e(e,r,i),s=M();return le(s,n.direction,-t),he(s,s,e),{up:n.up,eye:s,heading:r,tilt:i}}function Zft(e){return md(e)}function Qft(e){return kt(e)}function l7e(e,t,r,i,n){const s=e.renderSpatialReference,a=e.map&&e.spatialReference||t.spatialReference;return oa(t,Gm,s),oa(t,jm,s),Gm[0]-=r/2,jm[0]+=r/2,Gm[1]-=i/2,jm[1]+=i/2,Ss(Gm,s,Gm,a),Ss(jm,s,jm,a),n?(n.xmin=Gm[0],n.ymin=Gm[1],n.xmax=jm[0],n.ymax=jm[1],n.spatialReference=a):n=new Zt(Gm[0],Gm[1],jm[0],jm[1],a),n}const Jft=Object.freeze(Object.defineProperty({__proto__:null,headingTiltToDirectionUp:o7e,directionToHeadingTilt:Xft,eyeForCenterWithHeadingTilt:Yft,lookAtTiltToEyeTilt:Zft,eyeTiltToLookAtTilt:Qft,toExtent:l7e},Symbol.toStringTag,{value:"Module"})),c7e=Ve(0,0,1),d7e=we(M(),Ve(1,1,1)),Kft=new Hv(-180,180),u8=Ae(),k1=M(),tT=M();function u7e(e,t,r,i=jse()){dt(k1,e,c7e),Se(k1,k1)===0&&dt(k1,e,d7e),Cu(u8,-kt(t),e),rd(u8,u8,-kt(r),k1);const{up:n,direction:s}=i;return dt(n,k1,e),we(n,n),ze(n,n,u8),we(s,e),Io(s,s),ze(s,s,u8),i}function ept(e,t,r,i){const n=k1,s=tT;return we(n,e),dt(tT,n,c7e),Se(tT,tT)===0&&dt(tT,n,d7e),dt(s,tT,n),n7e(t,r,i,n,s)}function tpt(e,t,r,i){const n={eye:M(),up:null,tilt:i,heading:r},s=k1;s[0]=e[0],s[1]=e[2],s[2]=-e[1];const a=t,o=kt(r),l=kt(i),c=Math.sin(o),u=Math.cos(o),h=Math.sin(l),p=Math.cos(l),m=Oe(s);let g;if(Math.abs(l)<1e-8)g=a+m;else{const se=m/h,D=Pp(a/se),F=Math.PI-l-D;g=se*Math.sin(F)}const b=p*a,w=a*a*(h*h),v=u*u*w,x=g-b,T=x*x,E=v*(v+T-s[1]*s[1]);if(E<0)return le(n.eye,s,g/m),n.tilt=0,n;const C=Math.sqrt(E),A=s[1]*x,P=v+T;let I;if(I=u>0?-C+A:C+A,Math.abs(P)<1e-8)return m<1e-8?(n.eye[0]=0,n.eye[1]=0,n.eye[2]=a):le(n.eye,s,g/m),n.tilt=0,Xj(n.eye),Yj(n,e);n.eye[1]=I/P;const L=c*c*w,V=h*a,G=u*V*n.eye[1],B=n.eye[1]*n.eye[1],X=1-B,Y=Math.sqrt(X),ce=v*B+L-2*G*Y*x+X*T;return Math.abs(ce)<1e-8?(le(n.eye,s,g/m),n.tilt=0,Xj(n.eye),Yj(n,e)):(n.eye[0]=(X*(g*s[0]-b*s[0])-V*Y*(s[0]*n.eye[1]*u+s[2]*c))/ce,n.eye[2]=(X*(g*s[2]-b*s[2])-V*Y*(s[2]*n.eye[1]*u-s[0]*c))/ce,le(n.eye,n.eye,g),Xj(n.eye),Yj(n,e))}function Xj(e){const t=e[1];e[1]=-e[2],e[2]=t}function Yj(e,t){const r=u7e(t,e.heading,e.tilt);return e.up=r.up,e}function rpt(e,t,r){const i=Oe(t),n=Math.sqrt(r*r+i*i-2*r*i*Math.cos(Math.PI-e)),s=Pp(r/(n/Math.sin(e)));return md(e-s)}function ipt(e,t,r){const i=kt(e),n=Oe(t);return Pp(r/(n/Math.sin(i)))+i}function h7e(e,t,r,i,n){let s,a,o,l;const c=t.latitude,u=Ar(e.spatialReference).radius,h=t.longitude,p=iut(c,r,u)/2;s=h-p,a=h+p;const m=kt(c),g=(1+Math.sin(m))/(1-Math.sin(m)),b=(g+1)*Math.tan(i/u/2),w=b*b;function v(T){const E=Math.PI/2;return(T=uUe.normalize(T,-E))>E&&(T=Math.PI-T),T}if(o=1.5*Math.PI-2*Math.atan(.5*(b+Math.sqrt(4*g+w))),l=o+i/u,o=v(o),l=v(l),l<o){const T=l;l=o,o=T}if(o=Math.max(md(o),-90),l=Math.min(md(l),90),a=Kft.monotonic(s,a),a-s>180){const T=(a-s-180)/2;s+=T,a-=T}const x=e.spatialReference&&e.spatialReference.isGeographic?e.spatialReference:Ye.WGS84;return n?(n.xmin=s,n.ymin=o,n.xmax=a,n.ymax=l,n.spatialReference=x):n=new Zt(s,o,a,l,x),e.spatialReference&&e.spatialReference.isWebMercator&&ly(n,!1,n),n}const npt=Object.freeze(Object.defineProperty({__proto__:null,headingTiltToDirectionUp:u7e,directionToHeadingTilt:ept,eyeForCenterWithHeadingTilt:tpt,lookAtTiltToEyeTilt:rpt,eyeTiltToLookAtTilt:ipt,toExtent:h7e},Symbol.toStringTag,{value:"Module"}));function ek(e){return e.type==="point"}class f7e{constructor(t,r=null,i=0){this.array=t,this.spatialReference=r,this.offset=i}}function p7e(e){return"array"in e}function Q0(e,t,r="ground"){if(ek(t))return e.getElevation(t.x,t.y,t.z||0,t.spatialReference,r);if(p7e(t)){let i=t.offset;return e.getElevation(t.array[i++],t.array[i++],t.array[i]||0,vt(t.spatialReference,e.spatialReference),r)}return e.getElevation(t[0],t[1],t[2]||0,e.spatialReference,r)}function sR(e,t){return e!=null&&(t==null||(t===Be.Local?!e.isGeographic||e.isWGS84||e.wkid===Ph.CGCS2000:e.isWebMercator||e.isWGS84||e.wkid===Ph.CGCS2000||e.wkid===Ph.GCSMARS2000||e.wkid===Ph.GCSMARS2000_SPHERE||e.wkid===Ph.GCSMOON2000))}const m7e=fe.getLogger("esri.views.3d.support.cameraUtils"),g7e=39.37,y7e=96,XJ=1,spt=8,apt=5,b7e=1,x0e=M(),XP=M(),opt={heading:0,tilt:0},Gg=new ot,lpt=new Hv(-20037508342788905e-9,20037508342788905e-9),cpt=new Hv(-180,180);var so;function SO(e){return e.spatialReference||Ye.WGS84}function x6(e){return e.viewingMode==="global"?npt:Jft}function dpt(e,t,r,i,n){return x6(e).headingTiltToDirectionUp(t,r,i,n)}function Fg(e,t){if(R(t))return null;const r=e.renderSpatialReference,i=x6(e).headingTiltToDirectionUp,n=M();if(!oa(t.position,n,r))return null;const s=i(n,t.heading,t.tilt);le(s.direction,s.direction,e.state.camera.distance),he(s.direction,s.direction,n);const a=$x(e,n,s.direction,s.up);return a.fov=kt(t.fov),a}(function(e){e[e.LOCKED=0]="LOCKED",e[e.ADJUST=1]="ADJUST"})(so||(so={}));const rT=M();function A9(e,t,r){const i=e.renderSpatialReference,n=jz(e,t.eye,t.viewForward,t.up,opt);let s=SO(e);return Ss(t.eye,i,rT,s)||(s=Ye.WGS84,Ss(t.eye,i,rT,s)),R(r)?new gd(new ot(rT,s),n.heading,n.tilt,md(t.fov)):(r.position.x=rT[0],r.position.y=rT[1],r.position.z=rT[2],r.position.spatialReference=s,r.heading=n.heading,r.tilt=n.tilt,r.fov=md(t.fov),r)}function qse(e,t,r){const i=e.state.camera,n=i.width/2/i.pixelRatio;return e.renderCoordsHelper.viewingMode===Be.Global&&r!=null&&(t*=Math.cos(kt(r))),t/=e.renderCoordsHelper.unitInMeters,n/(y7e*g7e/t)/Math.tan(i.fovX/2)}function ix(e,t,r){const i=e.state.camera,n=t*Math.tan(i.fovX/2),s=i.width/2/i.pixelRatio;let a=y7e*g7e/(s/n);return e.renderCoordsHelper.viewingMode===Be.Global&&(a/=Math.cos(kt(r))),a*=e.renderCoordsHelper.unitInMeters,a}function v7e(e,t,r,i,n,s){return _7e(e,t,qse(e,r,t.latitude),i,n,s)}function _7e(e,t,r,i,n,s){if(yw(s)){const o=new T6(s.signal);return aR(e,i.heading,i.tilt,t,r,n,o),void o.resolver.promise.then(l=>{const c=rk(e,l,i.fov);if(!R(c))return s.resolver.resolve(c);s.resolver.reject()},l=>s.resolver.reject(l))}const a=aR(e,i.heading,i.tilt,t,r,n);return rk(e,a,i.fov,s)}function jz(e,t,r,i,n){return x6(e).directionToHeadingTilt(t,r,i,n)}function upt(e,t){return!!(e.basemapTerrain&&e.renderCoordsHelper.fromRenderCoords(t,Gg,e.spatialReference)&&vt(Q0(e.elevationProvider,Gg),0)>Gg.z-b7e)}async function hpt(e,t,r){if(!e.renderCoordsHelper.fromRenderCoords(t,Gg,e.spatialReference))return!1;const i=await e.elevationProvider.queryElevation(Gg.x,Gg.y,Gg.z,Gg.spatialReference,"ground",r);return vt(i,0)>Gg.z-b7e}async function fpt(e,t,r){const i=M();if(t)if(t instanceof ot){if(oa(t,i,e.renderSpatialReference),t.z==null&&e.basemapTerrain!=null){const n=await e.elevationProvider.queryElevation(t.x,t.y,t.z,t.spatialReference,"ground",r);return _(n)&&e.renderCoordsHelper.setAltitude(i,n),i}}else oe(i,t);else oe(i,e.state.camera.center);return i}function ppt(e,t){const r=M();if(t&&t instanceof ot){if(oa(t,r,e.renderSpatialReference),t.z==null&&e.basemapTerrain!=null){const i=Q0(e.elevationProvider,t);_(i)&&e.renderCoordsHelper.setAltitude(r,i)}}else oe(r,t||e.state.camera.center);return r}function aR(e,t,r,i,n,s,a){const o=i&&i instanceof ot?i:null;if(yw(a))return fpt(e,i,a.signal).then(c=>{YJ(e,t,r,o,c,n,s,a)},c=>a.resolver.reject(c)),null;const l=ppt(e,i);return YJ(e,t,r,o,l,n,s,a)}function YJ(e,t,r,i,n,s,a,o){if(R(i)){const h=e.renderSpatialReference;if(i=Yv(n,h,SO(e)),R(i))return null}s=Math.max(s,e.state.constraints.minimumPoiDistance);const l=ypt(e,t,r,n,s,a),c=(0,x6(e).eyeForCenterWithHeadingTilt)(n,s,l.heading,l.tilt);if(a===so.ADJUST&&e.viewingMode==="global"&&r>0){const h=()=>{const m=w7e(e,n,s,vpt(e,s,r,n));return a=r-m<1?so.LOCKED:so.ADJUST,YJ(e,t,m,i,n,s,a,o)},p=e.map.ground.navigationConstraint;if(!p||p.type==="stay-above"){if(upt(e,c.eye))return h();if(yw(o))return hpt(e,c.eye,o.signal).then(m=>m?h():(o.resolver.resolve({eye:c.eye,up:c.up,center:Kn(n),heading:c.heading,tilt:c.tilt}),null)),null}}const u=!o||yw(o)?{center:M(),eye:M(),up:M(),tilt:0,heading:0}:o;return u.eye=c.eye,u.up=c.up,u.center=Kn(n),u.heading=c.heading,u.tilt=c.tilt,yw(o)&&o.resolver.resolve(u),u}function h7(e,t,r,i,n,s=null){const a=t.zmax!=null&&t.zmin!=null;let o,l,c;if(e.state.isGlobal){if(!sR(t.spatialReference,Be.Global))return yw(s)&&s.resolver.reject(),null;const v=new ot(t.xmin,t.ymin,t.spatialReference),x=new ot(t.xmax,t.ymax,t.spatialReference),T=t.spatialReference.isGeographic?cpt:lpt;o=new ot({x:T.center(v.x,x.x),y:(x.y+v.y)/2,z:a?(t.zmax+t.zmin)/2:null,spatialReference:t.spatialReference});const E=Ar(t.spatialReference),C=rut(o,v,x);l=C.lon,c=C.lat,T.diff(v.x,x.x)>T.range/2&&(l+=E.halfCircumference),l=Math.min(l,E.halfCircumference),c=Math.min(c,E.halfCircumference)}else{const v=vt(e.renderSpatialReference,t.spatialReference);v.equals(t.spatialReference)||(t=eO(t,v)),l=t.xmax-t.xmin,c=t.ymax-t.ymin;const x=a?(t.zmax+t.zmin)/2:null;o=new ot({x:t.xmin+.5*l,y:t.ymin+.5*c,z:x,spatialReference:v})}const u=a?t.zmax-t.zmin:0,h=e.state.camera,p=1/Math.tan(h.fovX/2),m=1/Math.tan(h.fovY/2),g=1/Math.tan(h.fov/2),b=Math.max(.5*l*p,.5*c*m,.5*u*g)/XJ;if(yw(s)){const v=new T6(s.signal);return aR(e,r,i,o,b,n,v),void v.resolver.promise.then(x=>{const T=rk(e,x,e.camera.fov);if(!R(T))return s.resolver.resolve(T);s.resolver.reject()},x=>s.resolver.reject(x))}const w=aR(e,r,i,o,b,n);return rk(e,w,e.camera.fov,s)}function mpt(e,t,r){const i=e.renderSpatialReference,n=Yv(r,i,SO(e));if(R(n))return null;const s=Math.tan(t.fovX/2),a=Math.tan(t.fovY/2),o=sre(t.eye,r),l=2*o*s*XJ,c=2*o*a*XJ;return e.viewingMode==="global"?h7e(e,n,l,c):l7e(e,n,l,c)}function gpt(e,t,r){const i=e.pointsOfInterest.centerOnSurfaceFrequent.distance;if(Math.log(r/i)/Math.LN2>spt)return!0;const n=e.renderSpatialReference,s=SO(e),a=Yv(t,n,s),o=Yv(e.pointsOfInterest.centerOnSurfaceFrequent.renderLocation,n,s);if(R(a)||R(o))return!1;const l=Math.tan(.5*e.state.camera.fov)*i;return o.distance(a)/l>apt}function ypt(e,t,r,i,n,s){let a=0;return s===so.ADJUST&&gpt(e,i,n)?(t=0,a=bpt(e,n,r,i)):a=Hse(e,i,n,r),a=e.state.constraints.clampTilt(n,a),{heading:t,tilt:r=w7e(e,i,n,a)}}const tk=.7;function bpt(e,t,r,i){const n=e.state.constraints.tilt(t);n.max=Math.min(n.max,.5*Math.PI);const s=n.min*(1-tk)+n.max*tk,a=Hse(e,i,t,r);return Math.min(a,s)}function vpt(e,t,r,i){const n=e.state.constraints.tilt(t);let s=Hse(e,i,t,r);return s=Math.min(s,.5*Math.PI),n.min*(1-tk)+s*tk}function w7e(e,t,r,i){return x6(e).lookAtTiltToEyeTilt(i,t,r)}function Hse(e,t,r,i){return x6(e).eyeTiltToLookAtTilt(i,t,r)}function rk(e,t,r,i){if(R(t))return null;const n=e.renderSpatialReference,s=Yv(t.eye,n,SO(e));return R(s)?null:_(i)?(i.position=s,i.heading=t.heading,i.tilt=t.tilt,i.fov=r,i):new gd(s,t.heading,t.tilt,r)}function x7e(e,t){var i;const r=(i=e.basemapTerrain)==null?void 0:i.tilingScheme;if(r)return r.levelAtScale(t);m7e.error("#scaleToZoom()","Cannot compute zoom from scale without a tiling scheme")}function T7e(e,t){var i;const r=(i=e.basemapTerrain)==null?void 0:i.tilingScheme;if(r)return r.scaleAtLevel(t);m7e.error("#zoomToScale()","Cannot compute scale from zoom without a tiling scheme")}function _pt(e,t){return e.spatialReference?BSe(t,e.spatialReference):void 0}function S7e(e,t,r){const i=e.renderSpatialReference;let n,s;t||(t=e.state.camera);const a=Ye.WGS84;return t instanceof gd?(n=t.position.latitude,oa(t.position,x0e,i),oa(r,XP,i),s=fi(x0e,XP)):(Ss(t.center,i,XP,a),n=XP[1],s=t.distance),ix(e,s,n)}class T6{constructor(t){this.signal=t,this.resolver=Op()}}function yw(e){return e&&"resolver"in e}function gf(e){let t=e*e;return e<0&&(t*=-1),t}function T0e(e,t,r){const i=r,n=e.state,s=e.device,a=t.tiltDirection==="forward-down"?1:-1,o=1;return s.deviceType==="standard"?(i.translation[0]=gf(n.axes[0]),i.translation[1]=gf(n.axes[1]),i.translation[2]=gf(n.buttons[7])-gf(n.buttons[6]),i.heading=gf(n.axes[2]),i.tilt=gf(n.axes[3])):s.deviceType==="spacemouse"&&(i.translation[0]=1.2*gf(n.axes[0]),i.translation[1]=1.2*gf(n.axes[1]),i.translation[2]=2*-gf(n.axes[2]),i.heading=1.2*gf(n.axes[5]),i.tilt=1.2*gf(n.axes[3])),i.tilt*=a,le(i.translation,i.translation,o),i}function S0e(e,t){const r=t;return r.translation[0]=e[1]-e[0],r.translation[1]=e[3]-e[2],r.translation[2]=e[4]-e[5],r.heading=e[7]-e[6],r.tilt=e[8]-e[9],r.zoom=e[10]-e[11],r}function Zj(e){return e.translation[0]===0&&e.translation[1]===0&&e.translation[2]===0&&e.heading===0&&e.tilt===0&&e.zoom===0}let X1=class extends o_{constructor(e){super(e),this.transformation={translation:[0,0,0],heading:0,tilt:0,zoom:0},this.keysButtonState=[0,0,0,0,0,0,0,0,0,0,0,0],this.tmpCamera=new ni,this.constraintOptions={selection:Ti.ALL,interactionType:Ht.NONE,interactionStartCamera:new ni,interactionFactor:0,interactionDirection:null,tiltMode:aa.LOOK_AROUND}}handleEventGamepad(e){const t=T0e(e,this.view.navigation.gamepad,this.transformation);(e.action==="end"||Zj(t))&&this.finishController()}activateDirection(e){this.keysButtonState[e]=1,S0e(this.keysButtonState,this.transformation)}deactivateDirection(e){this.keysButtonState[e]=0;const t=S0e(this.keysButtonState,this.transformation);Zj(t)&&this.finishController()}onControllerStart(e){this.filteredSurfaceElevation=this.view.pointsOfInterest.cameraOnSurface.location.z,this.headingStart=this.view.camera.heading,super.onControllerStart(e)}_updateFilteredSurfaceElevation(e){const t=this.view.pointsOfInterest.cameraOnSurface.location.z,r=1;this.filteredSurfaceElevation+=r*(t-this.filteredSurfaceElevation)*e}stepController(e,t){this._updateStartHeading(),this._updateFilteredSurfaceElevation(e),this.currentCamera.copyViewFrom(t),this._updateCameraCenter(),this.constraintOptions.interactionStartCamera.copyFrom(this.currentCamera),this._calculateControlTransformation(e,this.currentCamera,B_),this._applyDisabledMovementTypes(B_),this._applyPan(B_.pan),this._applyRotate(B_.rotate),this._applyZoom(B_.zoom),this._applyAscend(B_.ascend),this.constraintOptions.interactionType=Ht.NONE,this.constraintOptions.selection=Ti.COLLISION,En(this.view,this.currentCamera,this.constraintOptions),super.stepController(e,t)}_updateStartHeading(){this.transformation.heading!==0&&(this.headingStart=this.view.camera.heading)}_applyRotate(e){if(!e.enabled)return;const t=this.currentCamera;pe(Al,t.center,t.eye),ze(Al,Al,e.matrix),t.center=he(Al,Al,t.eye),t.up=ze(Al,t.up,e.matrix),this.constraintOptions.interactionType=Ht.LOOK_AROUND,this.constraintOptions.selection=Ti.ALL_EXCEPT_COLLISION,En(this.view,t,this.constraintOptions)}_applyPan(e,t=this.currentCamera){!e.enabled||(t.eye=ze(Al,t.eye,e.matrix),t.center=ze(Al,t.center,e.matrix),this.view.state.isGlobal&&(t.up=ze(Al,t.up,e.matrix)),this.constraintOptions.interactionType=Ht.PAN,this.constraintOptions.selection=Ti.ALL,En(this.view,t,this.constraintOptions))}_applyZoom(e){if(!e)return;const t=this.currentCamera.viewForward;this.currentCamera.eye=he(Al,this.currentCamera.eye,le(qe.get(),t,e)),oe(h8,t),Io(h8,h8),this.constraintOptions.interactionDirection=h8,this.constraintOptions.interactionType=Ht.ZOOM,this.constraintOptions.selection=Ti.ALL_EXCEPT_COLLISION,En(this.view,this.currentCamera,this.constraintOptions),this.constraintOptions.interactionDirection=null}_applyAscend(e){if(!e)return;const t=this.view.renderCoordsHelper.worldUpAtPosition(this.currentCamera.eye,qe.get());if(this.constraintOptions.interactionDirection=oe(h8,t),this.view.state.isGlobal){const r=Oe(this.currentCamera.eye),i=(r+e)/r;this.currentCamera.eye=le(Al,this.currentCamera.eye,i),this.currentCamera.center=le(Al,this.currentCamera.center,i)}else{const r=le(qe.get(),t,e);this.currentCamera.eye=he(Al,this.currentCamera.eye,r),this.currentCamera.center=he(Al,this.currentCamera.center,r)}this._updateCameraCenter(),this.constraintOptions.interactionType=Ht.ASCEND,this.constraintOptions.selection=Ti.COLLISION,En(this.view,this.currentCamera,this.constraintOptions)&&this._updateCameraCenter(),this.constraintOptions.selection=Ti.ALL_EXCEPT_COLLISION,En(this.view,this.currentCamera,this.constraintOptions),this.constraintOptions.interactionDirection=null}_calculateControlTransformation(e,t,r){Apt(r);const i=this._computeVelocities(e);this.view.state.isLocal?this._calculateControlTransformationLocal(i,t,r):this._calculateControlTransformationGlobal(i,t,r)}_updateCameraCenter(){const e=this.view.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,t=this.view.renderCoordsHelper,r=this.currentCamera.ray;this.currentCamera.center=t.intersectManifoldClosestSilhouette(r,e,Al)}_calculateControlTransformationLocal(e,t,r){const{viewRight:i,viewForward:n}=t,s=this.transformation,a=this.view.navigation.gamepad,o=ne(qe.get(),n[0],n[1],0);we(o,o);const l=s.translation[0]*e.pan;if(l!==0){const g=le(qe.get(),i,l);wl(r.pan.matrix,r.pan.matrix,g),r.pan.enabled=!0}switch(a.mode){case"pan":{const g=-s.translation[1]*e.pan;if(g!==0){const b=le(qe.get(),o,g);wl(r.pan.matrix,r.pan.matrix,b),r.pan.enabled=!0}r.zoom=s.zoom*e.zoom;break}case"zoom":r.zoom=(-s.translation[1]+s.zoom)*e.zoom;break;default:a.mode}const c=s.translation[2]*e.ascend;r.ascend=c;const u=-s.heading*e.rotate;u!==0&&(rd(r.rotate.matrix,r.rotate.matrix,u,this.view.renderCoordsHelper.worldUpAtPosition(t.eye,qe.get())),r.rotate.enabled=!0);const h=s.tilt*e.rotate,p=s_(this.view.renderCoordsHelper,t.center,t.eye),m=Le(p+h,Ka.min,Ka.max)-p;m&&(rd(r.rotate.matrix,r.rotate.matrix,m,i),r.rotate.enabled=!0)}_calculateControlTransformationGlobal(e,t,r){const{eye:i,viewRight:n}=t,s=this.transformation,a=this.view.navigation.gamepad,o=dt(qe.get(),n,i);we(o,o),Io(o,o),Oft(this.startCamera,t,s,e,this.view.camera.heading,this.headingStart,this.view.camera.tilt,r,a),this.tmpCamera.copyFrom(this.currentCamera),this._applyPan(B_.pan,this.tmpCamera);const l=this.view.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,c=s.translation[2]*e.ascend;r.ascend=c;const u=-s.heading*e.rotate;u!==0&&(rd(r.rotate.matrix,r.rotate.matrix,u,this.tmpCamera.eye),r.rotate.enabled=!0);const h=s.tilt*e.rotate,p=this._clampTiltDeltaGlobalToValidRange(h,t.ray,l);p!==0&&(rd(r.rotate.matrix,r.rotate.matrix,p,this.tmpCamera.viewRight),r.rotate.enabled=!0),r.zoom+=s.zoom*e.zoom}_clampTiltDeltaGlobalToValidRange(e,t,r){const i=Ar(this.view.spatialReference),n=iD(Ka.min,t.origin,r,i);let s=0,a=0;const o=qe.get();if(this.view.renderCoordsHelper.intersectManifold(t,r,o)){const l=s_(this.view.renderCoordsHelper,o,t.origin);s=iD(l,t.origin,r,i),a=iD(Ka.max,t.origin,r,i)}else{n6(GV(jV,r+i.radius),t,o);const l=Rs(-Se(t.direction,we(o,o)));s=d0e(l,t.origin,r,i),a=d0e(Ka.max,t.origin,r,i)}return Le(s+e,n,a)-s}_getPointAbsoluteSurfaceElevation(e,t,r){const{renderCoordsHelper:i}=this.view,n=i.getAltitude(e),s=t+Math.abs(n-t);return i.setAltitude(r,s,e),s}_clampedDistanceToSurface(e,t){const{renderCoordsHelper:r}=this.view,{camera:i}=this.view.state,{direction:n}=dpt(this.view,t,0,E7e,Cpt),s=r.intersectManifoldClosestSilhouette(Ru(t,n),e,qe.get()),a=fi(t,s),o=r.intersectManifoldClosestSilhouette(Ru(t,By(qe.get(),t,i.center)),e,qe.get()),l=fi(t,o);return Math.min(a,l)}_computeHeadingRotateRadius(e){const{renderCoordsHelper:t,state:r}=this.view,{camera:i,isGlobal:n}=r,s=t.intersectManifoldClosestSilhouette(i.ray,this.filteredSurfaceElevation,qe.get());if(n){const a=pe(qe.get(),e,s),o=Oe(a);le(a,a,1/o);const l=we(qe.get(),e),c=Rs(Se(l,a));return o*Math.sin(Math.min(xpt,c))}{const a=oe(qe.get(),e);return t.setAltitude(a,this.filteredSurfaceElevation),fi(s,a)}}_minimumAscendVelocity(){return this.view.state.constraints.collision.enabled?0:Tpt}_computeVelocities(e){const t=this.filteredSurfaceElevation,r=t+Ar(this.view.spatialReference).radius,{camera:i,isGlobal:n}=this.view.state,s=qe.get(),a=this._getPointAbsoluteSurfaceElevation(i.eye,t,s),o=this._clampedDistanceToSurface(t,s),l=i.width/2,c=E0e*i.width,u=E0e*i.width,h=o*Math.tan(.5*i.fovX)/l,p=h/r,m=h/this._computeHeadingRotateRadius(s),g=a-t;return{pan:(n?p:h)*c*e,ascend:Math.max(this._minimumAscendVelocity()*e,2**(c*e/l)*g-g),zoom:2**(c*e/l)*o-o,rotate:Le(m*u,Spt,Ept)*e}}_applyDisabledMovementTypes(e){!_(this.disableMovements)||this.disableMovements.mode!==void 0&&this.view.state.viewingMode!==this.disableMovements.mode||(e.zoom=this.disableMovements.zoom?0:e.zoom,e.ascend=this.disableMovements.ascend?0:e.ascend,e.pan.enabled=!this.disableMovements.pan,this.disableMovements.pan&&pm(e.pan.matrix),e.rotate.enabled=!this.disableMovements.rotate,this.disableMovements.rotate&&pm(e.rotate.matrix))}static activatesFor(e,t){const r=T0e(t,e.navigation.gamepad,wpt);return!(t.action==="end"||Zj(r))}};d([f({constructOnly:!0})],X1.prototype,"view",void 0),d([f({constructOnly:!0})],X1.prototype,"gamepadDevice",void 0),d([f({constructOnly:!0})],X1.prototype,"disableMovements",void 0),X1=d([$("esri.views.3d.state.controllers.GamepadKeyboardController")],X1);const wpt={translation:[0,0,0],heading:0,tilt:0,zoom:0},E7e=80,xpt=kt(E7e),E0e=.75,Tpt=5,Spt=kt(30),Ept=kt(80),B_={zoom:0,ascend:0,pan:{enabled:!1,matrix:Ae()},rotate:{enabled:!1,matrix:Ae()}},Al=M(),h8=M(),Cpt=jse();function Apt(e){e.zoom=0,e.ascend=0,e.pan.enabled=!1,pm(e.pan.matrix),e.rotate.enabled=!1,pm(e.rotate.matrix)}class Rpt extends ho{constructor(t){super(!0),this.view=t,this.watchHandles=new Ft,this.handle=this.registerIncoming("gamepad",r=>this._handleEventGamepad(r)),this.handle.pause()}onInstall(t){super.onInstall(t),this.watchHandles.add([re(()=>this.view.navigation.gamepad.enabled,r=>{r?this.handle.resume():(this.handle.pause(),this.cameraControllerGamepad&&(this.cameraControllerGamepad.finishController(),this.cameraControllerGamepad=null))},Ot),re(()=>this.view.navigation.gamepad.device,r=>{this.cameraControllerGamepad&&r&&this.cameraControllerGamepad.gamepadDevice!==r&&(this.cameraControllerGamepad.finishController(),this.cameraControllerGamepad=null)})])}onUninstall(){this.watchHandles.removeAll(),super.onUninstall()}_handleEventGamepad(t){const r=this.view.navigation.gamepad.device;if(r&&t.data.device!==r)return;const i=this.cameraControllerGamepad&&this.cameraControllerGamepad.active;if(i||X1.activatesFor(this.view,t.data)){if(!i){const n=new X1({view:this.view,gamepadDevice:t.data.device});this.view.state.switchCameraController(n)&&(this.cameraControllerGamepad=n)}this.cameraControllerGamepad&&this.cameraControllerGamepad.active&&this.cameraControllerGamepad.gamepadDevice===t.data.device&&this.cameraControllerGamepad.handleEventGamepad(t.data)}}}var Fc;(function(e){e[e.LEFT=0]="LEFT",e[e.RIGHT=1]="RIGHT",e[e.FORWARD=2]="FORWARD",e[e.BACKWARD=3]="BACKWARD",e[e.UP=4]="UP",e[e.DOWN=5]="DOWN",e[e.HEADINGLEFT=6]="HEADINGLEFT",e[e.HEADINGRIGHT=7]="HEADINGRIGHT",e[e.TILTUP=8]="TILTUP",e[e.TILTDOWN=9]="TILTDOWN",e[e.ZOOMIN=10]="ZOOMIN",e[e.ZOOMOUT=11]="ZOOMOUT"})(Fc||(Fc={}));class Opt extends ho{constructor(t,r){super(!0),this.view=t,this.disableMovements={pan:!0,zoom:!1,ascend:!0,rotate:!1,mode:Be.Local},this.keyToNumber={[r.left]:Fc.LEFT,[r.right]:Fc.RIGHT,[r.forward]:Fc.FORWARD,[r.backward]:Fc.BACKWARD,[r.up]:Fc.UP,[r.down]:Fc.DOWN,[r.headingLeft]:Fc.HEADINGLEFT,[r.headingRight]:Fc.HEADINGRIGHT,[r.tiltUp]:Fc.TILTUP,[r.tiltDown]:Fc.TILTDOWN,[r.zoomIn]:Fc.ZOOMIN,[r.zoomOut]:Fc.ZOOMOUT},this.registerIncoming("key-down",null,i=>this._handleKeyDown(i)),this.registerIncoming("key-up",null,i=>this._handleKeyUp(i)),this.registerIncoming("blur",null,()=>this._handleBlur())}_handleKeyDown(t){if(t.data.native.ctrlKey||t.data.native.metaKey)return;const r=this.keyToNumber[t.data.key];r!=null&&(this.cameraControllerKeyboard&&this.cameraControllerKeyboard.active||(this.cameraControllerKeyboard=new X1({view:this.view,disableMovements:this.disableMovements}),this.view.state.switchCameraController(this.cameraControllerKeyboard)),this.cameraControllerKeyboard.active&&(this.cameraControllerKeyboard.activateDirection(r),t.stopPropagation()))}_handleBlur(){this.cameraControllerKeyboard&&this.cameraControllerKeyboard.active&&(this.cameraControllerKeyboard.finishController(),this.cameraControllerKeyboard=null)}_handleKeyUp(t){if(t.data.native.ctrlKey||t.data.native.metaKey)return;const r=this.keyToNumber[t.data.key];r!=null&&this.cameraControllerKeyboard&&this.cameraControllerKeyboard.active&&(this.cameraControllerKeyboard.deactivateDirection(r),t.stopPropagation())}}class Mpt extends ho{constructor(t,r){super(!0),this.view=t,this.registerIncoming("mouse-wheel",r,i=>this._handleMouseWheel(i))}_handleMouseWheel(t){if(!this.view.navigation.mouseWheelZoomEnabled)return;const r=t.data;this.cameraController&&this.cameraController.active||(this.cameraController=this.view.state.isGlobal?new JN({view:this.view,mode:"interaction"}):new KN({view:this.view,mode:"interaction"}),this.view.state.switchCameraController(this.cameraController)),this.cameraController.zoomStep(-1/60*r.deltaY,tn(r.x,r.y)),t.preventDefault(),t.stopPropagation()}}class ik{constructor(t){this._gain=t}reset(t){this._value=t}set gain(t){this._gain=t}get value(){return this._value===void 0?0:this._value}update(t){this._value===void 0?this._value=t:this._value=this._gain*t+(1-this._gain)*this._value}}let kv=class extends iR{constructor(e){super(e),this.view=null,this.beginCamera=new ni,this.elapsedTimeSec=0,this.constraintOptions={selection:Ti.ALL,interactionType:Ht.PAN,interactionFactor:0,interactionStartCamera:new ni,interactionDirection:null,tiltMode:aa.TUMBLE}}initialize(){this.constraintOptions.interactionType=this.interactionType,this.viewAnimation=new u9}get steppingFinished(){return this.momentum.isFinished(this.elapsedTimeSec)}onControllerStart(e){this.beginCamera.copyFrom(e),this.constraintOptions.interactionStartCamera=this.beginCamera,super.onControllerStart(e)}stepController(e,t){t.copyViewFrom(this.beginCamera),this.elapsedTimeSec+=e,this.momentumStep(this.elapsedTimeSec,t),En(this.view,t,this.constraintOptions)}};d([f({constructOnly:!0})],kv.prototype,"view",void 0),kv=d([$("esri.views.3d.state.controllers.momentum.MomentumController")],kv);let f7=class extends kv{constructor(e){super(e),this.interactionType=Ht.PAN,this.tmpPan=M()}momentumStep(e,t){const r=this.momentum.value(e);le(this.tmpPan,this.momentum.direction,r),t.eye=pe(C0e,t.eye,this.tmpPan),t.center=pe(C0e,t.center,this.tmpPan),this.constraintOptions.interactionDirection=this.tmpPan}};d([f({constructOnly:!0})],f7.prototype,"momentum",void 0),f7=d([$("esri.views.3d.state.controllers.momentum.PanPlanarMomentumController")],f7);const C0e=M(),Ppt=M(),YP=M();let aD=class extends kv{constructor(e){super(e),this.interactionType=Ht.PAN}momentumStep(e,t){const r=this.momentum.value1(e),i=this.momentum.value2(e);oe(YP,t.eye),we(YP,YP),dt(this.momentum.axis2,YP,this.momentum.axis1),e7e(t,Ppt,this.momentum.axis1,r,this.momentum.axis2,i)}};d([f({constructOnly:!0})],aD.prototype,"momentum",void 0),aD=d([$("esri.views.3d.state.controllers.momentum.PanSphericalMomentumController")],aD);let R3=class extends kv{constructor(e){super(e),this.interactionType=Ht.TUMBLE}set center(e){this._set("center",Kn(e))}set axis(e){this._set("axis",Kn(e))}momentumStep(e,t){const r=this.momentum.value(e);a_(t,this.center,kA(this.axis,r))}};d([f({constructOnly:!0})],R3.prototype,"momentum",void 0),d([f({constructOnly:!0})],R3.prototype,"center",null),d([f({constructOnly:!0})],R3.prototype,"axis",null),R3=d([$("esri.views.3d.state.controllers.momentum.MomentumController")],R3);let E4=class extends kv{constructor(e){super(e),this.interactionType=Ht.ZOOM,this.constraintOptions.interactionDirection=M()}set zoomCenter(e){this._set("zoomCenter",Kn(e))}momentumStep(e,t){oe(this.constraintOptions.interactionDirection,t.eye);const r=this.momentum.valueDelta(0,e);zse(t,this.zoomCenter,r,this.view.state.constraints.minimumPoiDistance),this.constraintOptions.interactionDirection=By(this.constraintOptions.interactionDirection,t.eye,this.constraintOptions.interactionDirection)}};d([f({constructOnly:!0})],E4.prototype,"momentum",void 0),d([f({constructOnly:!0})],E4.prototype,"zoomCenter",null),E4=d([$("esri.views.3d.state.controllers.momentum.ZoomPlanarMomentumController")],E4);let Q2=class extends kv{constructor(e){super(e),this.interactionType=Ht.ZOOM,this.radius=0,this.tmpSceneCenter=M(),this.tmpZoomAxisAngle=b6(),this.sphere=Us()}set screenCenter(e){this._set("screenCenter",tn(e[0],e[1]))}set sceneCenter(e){this._set("sceneCenter",Kn(e))}initialize(){this.sphere[3]=this.radius}momentumStep(e,t){const r=this.momentum.valueDelta(0,e);XCe(this.sphere,t,r),this.constraintOptions.interactionType=Ht.ZOOM,En(this.view,t,this.constraintOptions),nR(this.sphere,t,this.screenCenter,this.tmpSceneCenter),VA(this.sceneCenter,this.tmpSceneCenter,this.tmpZoomAxisAngle),a_(t,this.sphere,this.tmpZoomAxisAngle),this.constraintOptions.interactionType=Ht.PAN}};d([f({constructOnly:!0})],Q2.prototype,"momentum",void 0),d([f({constructOnly:!0})],Q2.prototype,"screenCenter",null),d([f({constructOnly:!0})],Q2.prototype,"sceneCenter",null),d([f({constructOnly:!0})],Q2.prototype,"radius",void 0),Q2=d([$("esri.views.3d.state.controllers.momentum.ZoomSphericalMomentumController")],Q2);class sp{constructor(t){this.gain=t}update(t){if(this.hasLastValue){const r=this.computeDelta(t);this._updateDelta(r)}this.lastValue=t}reset(){this.lastValue=void 0,this.filteredDelta=void 0}get hasLastValue(){return this.lastValue!==void 0}get hasFilteredDelta(){return this.filteredDelta!==void 0}computeDelta(t){return t-this.lastValue}_updateDelta(t){this.hasFilteredDelta?this.filteredDelta=(1-this.gain)*this.filteredDelta+this.gain*t:this.filteredDelta=t}}class qz{constructor(t,r,i){this._initialVelocity=t,this._stopVelocity=r,this._friction=i,this._duration=Math.abs(Math.log(Math.abs(this._initialVelocity)/this._stopVelocity)/Math.log(1-this._friction))}get duration(){return this._duration}isFinished(t){return t>this.duration}get friction(){return this._friction}value(t){return this.valueFromInitialVelocity(this._initialVelocity,t)}valueDelta(t,r){const i=this.value(t);return this.value(t+r)-i}valueFromInitialVelocity(t,r){r=Math.min(r,this.duration);const i=1-this.friction;return t*(i**r-1)/Math.log(i)}}class Ipt extends qz{constructor(t,r,i,n,s){super(t,r,i),this.sceneVelocity=n,this.direction=s}value(t){return super.valueFromInitialVelocity(this.sceneVelocity,t)}}class C7e{constructor(t=300,r=12,i=.84){this.minimumInitialVelocity=t,this.stopVelocity=r,this.friction=i,this.enabled=!0,this.time=new sp(.6),this.screen=[new sp(.4),new sp(.4)],this.scene=[new sp(.6),new sp(.6),new sp(.6)],this.tmpDirection=M()}add(t,r,i){if(this.enabled){if(this.time.hasLastValue&&this.time.computeDelta(i)<.015)return;this.screen[0].update(t[0]),this.screen[1].update(t[1]),this.scene[0].update(r[0]),this.scene[1].update(r[1]),this.scene[2].update(r[2]),this.time.update(i)}}reset(){this.screen[0].reset(),this.screen[1].reset(),this.scene[0].reset(),this.scene[1].reset(),this.scene[2].reset(),this.time.reset()}evaluateMomentum(){if(!this.enabled||!this.screen[0].hasFilteredDelta)return null;const t=this.screen[0].filteredDelta,r=this.screen[1].filteredDelta,i=Math.sqrt(t*t+r*r)/this.time.filteredDelta;return Math.abs(i)<this.minimumInitialVelocity?null:this.createMomentum(i,this.stopVelocity,this.friction)}createMomentum(t,r,i){ne(this.tmpDirection,this.scene[0].filteredDelta,this.scene[1].filteredDelta,this.scene[2].filteredDelta);const n=Oe(this.tmpDirection);n>0&&le(this.tmpDirection,this.tmpDirection,1/n);const s=n/this.time.filteredDelta;return new Ipt(t,r,i,s,this.tmpDirection)}}class A0e{constructor(t){this.gain=t}update(t){this.hasFilteredValue?this.filteredValue=(1-this.gain)*this.filteredValue+this.gain*t:this.filteredValue=t}reset(){this.filteredValue=void 0}get hasFilteredValue(){return this.filteredValue!==void 0}}const R0e=1e-5;class $pt extends qz{constructor(t,r,i,n,s,a=0,o){super(t,r,i),this.angularVelocity1=n,this.axis1=s,this.angularVelocity2=a,this.axis2=o}value1(t){return super.valueFromInitialVelocity(this.angularVelocity1,t)}value2(t){return super.valueFromInitialVelocity(this.angularVelocity2,t)}}class Lpt{constructor(t=300,r=12,i=.84){this.minimumInitialVelocity=t,this.stopVelocity=r,this.friction=i,this.enabled=!0,this.tmpAxis1=M(),this.tmpAxis2=M(),this.tmpAngles=it(),this.time=new sp(.3),this.screen=[new sp(.4),new sp(.4)],this.angle1=new A0e(.6),this.angle2=new A0e(.6),this.axis1=M(),this.axis2=M(),this.lastScene=M()}addMomentumDirectRotation(t,r,i,n,s,a){if(this.enabled){if(this.time.hasLastValue){if(this.time.computeDelta(i)<.01)return;let o=JCe(this.lastScene,r,this.tmpAxis2,n,s,a);this.angle2.update(0),fl(this.tmpAxis2)<R0e?o=0:we(this.axis1,this.tmpAxis2),this.angle1.update(o),oe(this.lastScene,r)}this.screen[0].update(t[0]),this.screen[1].update(t[1]),this.time.update(i)}}addMomentumPreserveHeading(t,r,i,n,s,a,o){if(this.enabled){if(this.time.hasLastValue){if(this.time.computeDelta(i)<.01)return;KCe(this.lastScene,r,this.tmpAxis2,this.tmpAxis1,this.tmpAngles,n,s,a,o,!1),fl(this.tmpAxis2)<R0e?(this.angle1.update(0),this.angle2.update(0)):(this.angle1.update(this.tmpAngles[1]),this.angle2.update(this.tmpAngles[0]),we(this.axis1,this.tmpAxis1),we(this.axis2,this.tmpAxis2)),oe(this.lastScene,r)}this.screen[0].update(t[0]),this.screen[1].update(t[1]),this.time.update(i)}}reset(){this.screen[0].reset(),this.screen[1].reset(),this.angle1.reset(),this.angle2.reset(),this.time.reset()}evaluateMomentum(){if(!this.enabled||!this.screen[0].hasFilteredDelta)return null;const t=this.screen[0].filteredDelta,r=this.screen[1].filteredDelta,i=Math.sqrt(t*t+r*r)/this.time.filteredDelta;return Math.abs(i)<this.minimumInitialVelocity?null:this.createMomentum(i,this.stopVelocity,this.friction)}createMomentum(t,r,i){const n=this.angle1.filteredValue/this.time.filteredDelta,s=this.angle2.filteredValue/this.time.filteredDelta;return new $pt(t,r,i,n,this.axis1,s,this.axis2)}}class A7e{constructor(t=2.5,r=.01,i=.95,n=12){this.minimumInitialVelocity=t,this.stopVelocity=r,this.friction=i,this.maxVelocity=n,this.enabled=!0,this.value=new sp(.8),this.time=new sp(.3)}add(t,r){if(this.enabled){if(this.time.hasLastValue){if(this.time.computeDelta(r)<.01)return;if(this.value.hasFilteredDelta){const i=this.value.computeDelta(t);this.value.filteredDelta*i<0&&this.value.reset()}}this.time.update(r),this.value.update(t)}}reset(){this.value.reset(),this.time.reset()}evaluateMomentum(){if(!this.enabled||!this.value.hasFilteredDelta)return null;let t=this.value.filteredDelta/this.time.filteredDelta;return t=Le(t,-this.maxVelocity,this.maxVelocity),Math.abs(t)<this.minimumInitialVelocity?null:this.createMomentum(t,this.stopVelocity,this.friction)}createMomentum(t,r,i){return new qz(t,r,i)}}class R7e extends A7e{constructor(t=3,r=.01,i=.95,n=12){super(t,r,i,n)}add(t,r){if(this.value.hasLastValue){const i=this.value.lastValue;let n=t-i;for(;n>Math.PI;)n-=2*Math.PI;for(;n<-Math.PI;)n+=2*Math.PI;t=i+n}super.add(t,r)}}class Dpt extends qz{constructor(t,r,i){super(t,r,i)}value(t){const r=super.value(t);return Math.exp(r)}valueDelta(t,r){const i=super.value(t),n=super.value(t+r)-i;return Math.exp(n)}}class O7e extends A7e{constructor(t=2.5,r=.01,i=.95,n=12){super(t,r,i,n)}add(t,r){super.add(Math.log(t),r)}createMomentum(t,r,i){return new Dpt(t,r,i)}}let oD=class extends o_{constructor(e){super(e),this.view=null,this.smoothRotation=new ik(.05),this.rotationAxis=M(),this.panningPlane=Er(),this.smoothScaling=new ik(.05),this.zoomCenterScreen=tn(),this.zoomMomentumEstimator=new O7e,this.rotationMomentumEstimator=new R7e,this.panSphericalMomentumEstimator=new Lpt,this.panPlanarMomentumEstimator=new C7e,this.adjustedSphere=Us(),this.tmp3d=M(),this.tmpScreenPointArray=tn(),this.beginScreenPoint=tn(),this.beginScenePoint=M(),this.screenPickPoint=tn(),this.navMode=Pa.Horizontal,this.tmpInteractionDirection=M(),this.constraintOptions={selection:Ti.ALL,interactionType:Ht.NONE,interactionFactor:0,interactionStartCamera:new ni,interactionDirection:null,tiltMode:aa.TUMBLE}}get intersectionHelper(){return this.view.sceneIntersectionHelper}begin(e){if(!this.active)return;const t=this.view.navigation.momentumEnabled;this.zoomMomentumEstimator.enabled=t,this.rotationMomentumEstimator.enabled=t,this.panPlanarMomentumEstimator.enabled=t,this.panSphericalMomentumEstimator.enabled=t,this.beginHeading=-Wv.normalize(kt(this.view.camera.heading)),this.beginRadius=e.radius,this.pointerCount=e.pointers.size,this.beginAngle=e.angle,this.smoothRotation.reset(),qg(e.center,this.screenPickPoint),Na(this.beginScreenPoint,this.screenPickPoint);const r=Ar(this.view.spatialReference),i=ZCe(this.intersectionHelper,this.startCamera,this.screenPickPoint,r,C9.Silhouette);this.scenePickPoint=i.scenePickPoint,this.sphere=i.sphere,oe(this.beginScenePoint,this.scenePickPoint),this.navMode=Gz(this.startCamera,this.screenPickPoint,i.hasGeometryIntersection,r),this.navMode===Pa.Vertical&&this._preparePlanarPanMode(e),this.constraintOptions.interactionStartCamera.copyFrom(this.startCamera)}_preparePlanarPanMode(e){const t=Io(this.tmp3d,this.startCamera.viewForward);r9(this.scenePickPoint,t,this.panningPlane);const r=tn(this.screenPickPoint[0],0),i=M(),n=Oe(this.startCamera.eye);this.adjustedSphere[3]=n<this.sphere[3]?n-100:this.sphere[3],nR(this.adjustedSphere,this.startCamera,r,i);const s=ro();this.startCamera.projectToRenderScreen(i,s);const a=.9*s[1];this.screenPickPoint[1]=Math.min(this.screenPickPoint[1],a);const o=this.intersectionHelper.intersectScreen(this.screenPickPoint,this.scenePickPoint);o&&r9(this.scenePickPoint,this.panningPlane,this.panningPlane);const l=M(),c=M(),u=M(),h=80,p=5,m=50;pe(l,this.scenePickPoint,this.currentCamera.eye);const g=Oe(l);we(l,l);const b=p*Math.max(Math.abs(this.view.camera.position.z),m),w=this.view._stage.renderView.getMinimalDepthForArea(null,this.screenPickPoint[0],this.screenPickPoint[1],this.view.state.camera,h);let v=w?Math.min(w,b):b;v=o?Math.min(v,g):v,oe(u,he(c,this.currentCamera.eye,le(c,l,v))),this.panningPlane[3]=-Se(this.panningPlane,u),this.startCamera.center=he(c,this.startCamera.eye,le(c,this.startCamera.viewForward,v));const x=qg(e.center,this.tmpScreenPointArray);WJ(this.panningPlane,this.startCamera,x,this.beginScenePoint)}update(e){if(!this.active)return;this.currentCamera.copyFrom(this.startCamera);const t=e.pointers.size>1;this.navMode===Pa.Horizontal?(t&&this._zoomSpherical(e),this._panningSpherical(e),t&&this._rotateSpherical(e)):(t&&this._zoomPlanar(e),this._panningPlanar(e),t&&this._rotatePlanar(e))}end(e){e.pointers.size===this.pointerCount&&this.update(e),this.finishController();const t=this.zoomMomentumEstimator.evaluateMomentum();if(t)return this.navMode===Pa.Horizontal?new Q2({view:this.view,momentum:t,screenCenter:this.zoomCenterScreen,sceneCenter:this.beginScenePoint,radius:this.sphere[3]}):new E4({view:this.view,momentum:t,zoomCenter:this.beginScenePoint});const r=this.rotationMomentumEstimator.evaluateMomentum();if(r)return new R3({view:this.view,momentum:r,center:this.sphere,axis:this.rotationAxis});if(this.navMode===Pa.Horizontal){const i=this.panSphericalMomentumEstimator.evaluateMomentum();if(i)return new aD({view:this.view,momentum:i})}else{const i=this.panPlanarMomentumEstimator.evaluateMomentum();if(i)return new f7({view:this.view,momentum:i})}return null}_zoomSpherical(e){const t=this.beginRadius/e.radius,r=.001875*Math.min(Math.max(e.radius,40),120);this.smoothScaling.gain=r,this.smoothScaling.update(t),XCe(this.sphere,this.currentCamera,this.smoothScaling.value),qg(e.center,this.zoomCenterScreen),this.zoomMomentumEstimator.add(this.smoothScaling.value,.001*e.timestamp),this.constraintOptions.interactionType=Ht.ZOOM,this.constraintOptions.interactionFactor=np(e.radius-this.beginRadius),En(this.view,this.currentCamera,this.constraintOptions)}_panningSpherical(e){const t=qg(e.center,this.tmpScreenPointArray);nR(this.sphere,this.currentCamera,t,this.tmp3d),Use(this.beginScenePoint,Se(this.currentCamera.up,this.beginScenePoint),this.sphere[3],this.beginHeading,this.view.camera.tilt,this.startCamera)?(r7e(this.sphere,this.currentCamera,this.beginScenePoint,this.tmp3d,this.beginHeading,this.view.camera.tilt,!1),this.panSphericalMomentumEstimator.addMomentumPreserveHeading(t,this.tmp3d,.001*e.timestamp,this.startCamera,this.sphere,this.beginHeading,this.view.camera.tilt)):(t7e(this.sphere,this.currentCamera,this.beginScenePoint,this.tmp3d,this.view.camera.tilt,!1),this.panSphericalMomentumEstimator.addMomentumDirectRotation(t,this.tmp3d,.001*e.timestamp,this.startCamera,this.sphere[3],this.view.camera.tilt)),this.constraintOptions.interactionType=Ht.PAN,this.constraintOptions.interactionFactor=np(this.screenPickPoint,t),En(this.view,this.currentCamera,this.constraintOptions)}_rotateSpherical(e){we(this.rotationAxis,this.scenePickPoint),this.currentCamera.aboveGround||Io(this.rotationAxis,this.rotationAxis);const t=this.smoothRotation.value,r=t+HJ(e.angle-t),i=.00125*Math.min(Math.max(e.radius,40),120);this.smoothRotation.gain=i,this.smoothRotation.update(r);const n=this.smoothRotation.value-this.beginAngle;this.rotationMomentumEstimator.add(n,.001*e.timestamp),a_(this.currentCamera,this.sphere,kA(this.rotationAxis,n)),this.constraintOptions.interactionType=Ht.TUMBLE,this.constraintOptions.interactionFactor=np(e.radius*r),En(this.view,this.currentCamera,this.constraintOptions)}_panningPlanar(e){const t=qg(e.center,this.tmpScreenPointArray);WJ(this.panningPlane,this.currentCamera,t,this.tmp3d)&&(QCe(this.currentCamera,this.beginScenePoint,this.tmp3d),this.panPlanarMomentumEstimator.add(t,this.tmp3d,.001*e.timestamp),this.constraintOptions.interactionType=Ht.PAN,this.constraintOptions.interactionFactor=np(this.beginScreenPoint,t),this.constraintOptions.interactionDirection=this.view.renderCoordsHelper.worldUpAtPosition(this.currentCamera.eye,this.tmpInteractionDirection),En(this.view,this.currentCamera,this.constraintOptions),this.constraintOptions.interactionDirection=null)}_zoomPlanar(e){const t=this.beginRadius/e.radius,r=.001875*Math.min(Math.max(e.radius,40),120);this.smoothScaling.gain=r,this.smoothScaling.update(t),this.zoomMomentumEstimator.add(this.smoothScaling.value,.001*e.timestamp),zse(this.currentCamera,this.beginScenePoint,this.smoothScaling.value,this.view.state.constraints.minimumPoiDistance),this.constraintOptions.interactionType=Ht.ZOOM,this.constraintOptions.interactionFactor=np(e.radius-this.beginRadius),En(this.view,this.currentCamera,this.constraintOptions)}_rotatePlanar(e){oe(this.rotationAxis,this.beginScenePoint),this.currentCamera.aboveGround||Io(this.rotationAxis,this.rotationAxis);const t=this.smoothRotation.value;let r=e.angle-t;r=HJ(r);const i=t+r,n=.00125*Math.min(Math.max(e.radius,40),120);this.smoothRotation.gain=n,this.smoothRotation.update(i);const s=this.smoothRotation.value-this.beginAngle;this.rotationMomentumEstimator.add(s,.001*e.timestamp),a_(this.currentCamera,this.sphere,kA(this.rotationAxis,s)),this.constraintOptions.interactionType=Ht.TUMBLE,this.constraintOptions.interactionFactor=np(e.radius*s),En(this.view,this.currentCamera,this.constraintOptions)}};d([f({constructOnly:!0})],oD.prototype,"view",void 0),oD=d([$("esri.views.3d.state.controllers.global.PinchAndPanController")],oD);const O0e=Ve(0,0,1),Fpt={ELEVATION_THRESHOLD:3e4,ANGLE_THRESHOLD:16/180*Math.PI},Npt=80;let lD=class extends o_{constructor(e){super(e),this.view=null,this.rotationValueSmooth=new ik(.05),this.scalingValueSmooth=new ik(.05),this.planeHorizontal=Er(),this.planeVertical=Er(),this.rotationMomentumEstimator=new R7e,this.panMomentumEstimator=new C7e(300,12,.9),this.zoomMomentumEstimator=new O7e,this.beginCenter=M(),this.tmpPoints=[],this.beginCenterScreen=tn(),this.tmpCentroid3d=M(),this.tmpCentroid2d=tn(),this.tmp2d=tn(),this.constraintOptions={selection:Ti.ALL,interactionType:Ht.NONE,interactionFactor:0,interactionStartCamera:new ni,interactionDirection:null,tiltMode:aa.TUMBLE}}get intersectionHelper(){return this.view.sceneIntersectionHelper}begin(e){if(!this.active)return;const t=this.view.navigation.momentumEnabled;this.zoomMomentumEstimator.enabled=t,this.rotationMomentumEstimator.enabled=t,this.panMomentumEstimator.enabled=t,this.beginRadius=e.radius,this.pointerCount=e.pointers.size,this.beginAngle=e.angle,this.rotationValueSmooth.reset(),this.scalingValueSmooth.reset(),qg(e.center,this.beginCenterScreen),SSe(O0e,0,this.planeHorizontal);const r=M(),i=this.intersectionHelper.intersectScreenFreePointFallback(this.beginCenterScreen,r),n=M();Io(n,this.startCamera.viewForward);const s=M();oe(s,O0e);const a=Se(n,s),o=Pp(a<0?-a:a);if(this.panMode=o>=Fpt.ANGLE_THRESHOLD?Pa.Horizontal:Pa.Vertical,cZ(this.planeHorizontal,this.planeHorizontal,r),this.startCamera.aboveGround||dZ(this.planeHorizontal,this.planeHorizontal),this.panMode===Pa.Vertical){le(s,s,a),pe(this.planeVertical,n,s),we(this.planeVertical,this.planeVertical),cZ(this.planeVertical,this.planeVertical,r);const l=M(),c=M(),u=M();pe(l,r,this.currentCamera.eye);const h=Oe(l);we(l,l);const p=5*Math.max(Math.abs(this.view.camera.position.z),50),m=this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm,this.beginCenterScreen[0],this.beginCenterScreen[1],this.view.state.camera,Npt);let g=m?Math.min(m,p):p;g=i?Math.min(g,h):g,oe(u,he(c,this.currentCamera.eye,le(c,l,g))),this.planeVertical[3]=-Se(this.planeVertical,u),this.computePlanePoints(e.pointers,this.planeVertical,this.startCamera,this.tmpPoints),Bj(this.tmpPoints,this.beginCenter)}else this.computePlanePoints(e.pointers,this.planeHorizontal,this.startCamera,this.tmpPoints),Bj(this.tmpPoints,this.beginCenter);this.constraintOptions.interactionStartCamera.copyFrom(this.startCamera)}update(e){if(!this.active)return;this.currentCamera.copyFrom(this.startCamera);const t=e.pointers.size>1,r=this.panMode===Pa.Horizontal?this.planeHorizontal:this.planeVertical,i=this.beginCenter;if(t){const n=this.beginRadius/e.radius,s=.001875*Math.min(Math.max(e.radius,40),120);this.scalingValueSmooth.gain=s,this.scalingValueSmooth.update(n),zse(this.currentCamera,i,this.scalingValueSmooth.value,this.view.state.constraints.minimumPoiDistance),this.zoomMomentumEstimator.add(this.scalingValueSmooth.value,.001*e.timestamp),this.constraintOptions.interactionType=Ht.ZOOM,this.constraintOptions.interactionFactor=np(Math.abs(e.radius-this.beginRadius)),En(this.view,this.currentCamera,this.constraintOptions)}if(this.computePlanePoints(e.pointers,r,this.currentCamera,this.tmpPoints),Bj(this.tmpPoints,this.tmpCentroid3d),qg(e.center,this.tmpCentroid2d),QCe(this.currentCamera,i,this.tmpCentroid3d),this.panMomentumEstimator.add(this.tmpCentroid2d,this.tmpCentroid3d,.001*e.timestamp),this.constraintOptions.interactionType=Ht.PAN,this.constraintOptions.interactionFactor=np(this.beginCenterScreen,this.tmpCentroid2d),En(this.view,this.currentCamera,this.constraintOptions),t){const n=this.planeHorizontal,s=i,a=this.rotationValueSmooth.value,o=a+HJ(e.angle-a),l=.00125*Math.min(Math.max(e.radius,40),120);this.rotationValueSmooth.gain=l,this.rotationValueSmooth.update(o);const c=this.rotationValueSmooth.value-this.beginAngle;this.rotationMomentumEstimator.add(c,.001*e.timestamp),a_(this.currentCamera,s,kA(n,c)),this.constraintOptions.interactionType=Ht.TUMBLE,this.constraintOptions.interactionFactor=np(Math.abs(e.radius*c)),En(this.view,this.currentCamera,this.constraintOptions)}}end(e){e.pointers.size===this.pointerCount&&this.update(e),this.finishController();const t=this.zoomMomentumEstimator.evaluateMomentum();if(t)return new E4({view:this.view,momentum:t,zoomCenter:this.beginCenter});const r=this.rotationMomentumEstimator.evaluateMomentum();if(r)return new R3({view:this.view,momentum:r,center:this.beginCenter,axis:this.planeHorizontal});const i=this.panMomentumEstimator.evaluateMomentum();return i?new f7({view:this.view,momentum:i}):null}computePlanePoints(e,t,r,i){i.length=e.size;const n=this.tmp2d;let s=0;return e.forEach(a=>{n[0]=a.x,n[1]=a.y,i[s]===void 0&&(i[s]=M()),WJ(t,r,n,i[s]),s+=1}),i}};d([f({constructOnly:!0})],lD.prototype,"view",void 0),lD=d([$("esri.views.3d.state.controllers.local.PinchAndPanController")],lD);class M0e extends ho{constructor(t,r,i){super(!0),this.view=t,this.pointerAction=r,this.lastEndTimestamp=0,this.lastTimestamp=0,this.registerIncoming("drag",i,n=>this._handleDrag(n))}_handleDrag(t){if(t.data.pointerType==="mouse"&&!Gse(t.data,this.pointerAction))return;const r=t.timestamp-this.lastEndTimestamp,i=40,n=this.momentum&&this.momentum.active&&r<i;switch(t.data.action){case"start":case"update":if(n)break;this.controller&&this.controller.active?t.data.timestamp-this.lastTimestamp>2&&(this.controller.update(t.data),this.lastTimestamp=t.timestamp):this._startController(t);break;case"end":case"removed":this._endController(t,!0);break;case"added":this._endController(t,!1),this._startController(t)}t.stopPropagation()}_endController(t,r){if(this.controller&&this.controller.active){this.lastEndTimestamp=t.timestamp;const i=this.controller.end(t.data);r&&i&&(this.momentum=i,this.view.state.switchCameraController(this.momentum))}this.controller=null}_startController(t){this.controller=this._createController(),this.view.state.switchCameraController(this.controller),this.controller.begin(t.data),this.lastTimestamp=t.timestamp}_createController(){return this.view.state.isGlobal?new oD({view:this.view}):new lD({view:this.view})}}class kpt extends ho{constructor(t,r){super(!0),this.view=t,this.registerIncoming("pointer-down",r,()=>this.view.state.stopActiveCameraController())}}class M7e extends ho{constructor(t,r){super(!0),this.key=t,this.registerIncoming("key-down",r,i=>this._handleKeyDown(i))}_handleKeyDown(t){t.data.key===this.key&&(this.activate(),t.stopPropagation())}}class Vpt extends M7e{constructor(t,r,i){super(r,i),this.view=t}activate(){this.view.goTo({heading:0}).catch(()=>{})}}class zpt extends M7e{constructor(t,r,i){super(r,i),this.view=t}activate(){this.view.goTo({tilt:0}).catch(()=>{})}}class Upt extends ho{constructor(t,r=!1){super(!0),this.view=t,this.invert=r,this.registerIncoming("vertical-two-finger-drag",i=>this._handleTwoFinger(i))}_handleTwoFinger(t){var n,s,a;const r=this.invert?-1:1,i=tn(0,t.data.delta*r);switch(t.data.action){case"begin":(n=this.cameraController)==null||n.end(),this.cameraController=new S4({view:this.view,pivot:Bc.CENTER}),this.view.state.switchCameraController(this.cameraController),this.cameraController.begin(i);break;case"update":(s=this.cameraController)==null||s.update(i);break;case"end":(a=this.cameraController)==null||a.end(),this.cameraController=null}}}function P0e(e){const t=e.native;return t?{buttons:t.buttons.map(r=>r.pressed?r.value?r.value:1:0),axes:t.axes.map(r=>jpt(r,e.axisThreshold))}:{buttons:[],axes:[]}}function Bpt(e,t){if(e.axes.length!==t.axes.length||e.buttons.length!==t.buttons.length)return!1;for(let r=0;r<e.axes.length;r++)if(e.axes[r]!==t.axes[r])return!1;for(let r=0;r<e.buttons.length;r++)if(e.buttons[r]!==t.buttons[r])return!1;return!0}function Gpt(e){for(let t=0;t<e.axes.length;t++)if(e.axes[t]!==0)return!1;for(let t=0;t<e.buttons.length;t++)if(e.buttons[t]!==0)return!1;return!0}function jpt(e,t){const r=Math.abs(e);return r<t?0:Math.sign(e)*(r-t)/(1-t)}class qpt{constructor(t,r){this.element=t,this.input=r,this._hasEventListeners=!1,this._onConnectGamepad=s=>{this._connectGamepad(s.gamepad)},this._onDisconnectGamepad=s=>{const a=s.gamepad,o=a.index,l=this.inputDevices[o];l&&(this._emitGamepadEvent(a,P0e(l),!1),this.inputDevices.splice(o,1),this.latestUpdate.splice(o,1),this.input.gamepad.devices.remove(l),this.ensurePollingState())},this.frameTask=null,this.latestUpdate=new Array,this.inputDevices=new Array,this.callback=null;const i="getGamepads"in window.navigator,n=window.isSecureContext;this.supported=i&&n,this.supported&&(this._forEachGamepad(s=>this._connectGamepad(s)),window.addEventListener("gamepadconnected",this._onConnectGamepad),window.addEventListener("gamepaddisconnected",this._onDisconnectGamepad),this.ensurePollingState())}destroy(){this.hasEventListeners=!1,this.supported&&(window.removeEventListener("gamepadconnected",this._onConnectGamepad),window.removeEventListener("gamepaddisconnected",this._onDisconnectGamepad))}set hasEventListeners(t){this._hasEventListeners!==t&&(this._hasEventListeners=t,this.ensurePollingState())}get eventsEnabled(){return this.supported&&this.inputDevices.length>0&&this._hasEventListeners}set onEvent(t){this.callback=t}_connectGamepad(t){const r=new Wne(t);r.deviceType!=="unknown"&&(this.inputDevices[t.index]=r,this.input.gamepad.devices.add(r)),this.ensurePollingState()}ensurePollingState(){this.eventsEnabled?this._startPolling():this._stopPolling()}_startPolling(){this.frameTask==null&&(this.frameTask=Aw({update:()=>this._readGamepadState()}))}_stopPolling(){this.frameTask!=null&&(this.frameTask.remove(),this.frameTask=null,this.latestUpdate=new Array)}_readGamepadState(){const t=document.hasFocus(),r=this.element.contains(document.activeElement),i=this.input.gamepad.enabledFocusMode==="document"&&!t||this.input.gamepad.enabledFocusMode==="view"&&!r;this._forEachGamepad(n=>{const s=this.inputDevices[n.index];if(!s)return;const a=this.latestUpdate[n.index],o=P0e(s),l=i||Gpt(o);a&&(a.timestamp===n.timestamp||!a.active&&l||Bpt(a.state,o))||this._emitGamepadEvent(n,o,!l)})}_forEachGamepad(t){const r=window.navigator.getGamepads();for(let i=0;i<r.length;i++){const n=r[i];this._validate(n)&&t(n)}}_emitGamepadEvent(t,r,i){const n=this.latestUpdate[t.index],s=n&&n.active;if(!s&&!i)return;const a=!s&&i?"start":s&&i?"update":"end";this.latestUpdate[t.index]={timestamp:t.timestamp,state:r,active:i},this.callback&&this.callback({device:this.inputDevices[t.index],state:r,action:a})}_validate(t){if(!t||!t.connected)return!1;for(let r=0;r<t.axes.length;r++)if(isNaN(t.axes[r]))return!1;return!0}}const I0e=ue("trident"),$0e=ue("edge"),Hpt=ue("chrome"),Wpt=ue("ff"),Xpt=ue("safari"),iT={touchNone:"esri-view-surface--touch-none",touchPan:"esri-view-surface--touch-pan"};class Hz{constructor(t,r){this.input=r,this._active={},this._activePointerCaptures=new Set,this._keyDownState=new Set,this._eventId=1,this._browserTouchPanningEnabled=!1,this._element=t,t.getAttribute("tabindex")||t.setAttribute("tabindex","0"),this._eventHandlers={"key-down":this._handleKey,"key-up":this._handleKey,"pointer-down":this._handlePointer,"pointer-move":this._handlePointerPreventDefault,"pointer-up":this._handlePointerPreventDefault,"pointer-enter":this._handlePointer,"pointer-leave":this._handlePointer,"pointer-cancel":this._handlePointer,"mouse-wheel":this._handleMouseWheel,"pointer-capture-lost":this._handlePointerCaptureLost},this._updateTouchAction(),this._element.addEventListener("keydown",this._preventAltKeyDefault),this._gamepadSource=new qpt(t,this.input),this._gamepadSource.onEvent=i=>this._callback("gamepad",i)}destroy(){this._callback=null,this.activeEvents=null,this._activePointerCaptures.forEach(t=>{this._releasePointerCaptureSafe(t)}),this._gamepadSource&&(this._gamepadSource.destroy(),this._gamepadSource=null),this._activePointerCaptures=null,this._removeTouchAction(),this._element.removeEventListener("keydown",this._preventAltKeyDefault)}get browserTouchPanningEnabled(){return this._browserTouchPanningEnabled}set browserTouchPanningEnabled(t){this._browserTouchPanningEnabled=t,this._updateTouchAction(),this._updateTouchEventHandling()}set onEventReceived(t){this._callback=t}set activeEvents(t){for(const r in this._active)if(!t||!t.has(r)){const i=this._active[r];this._element.removeEventListener(Qj[r],i),delete this._active[r]}t&&t.forEach(r=>{if(!this._active[r]&&Qj[r]){const i=(this._eventHandlers[r]||this._handleDefault).bind(this,r);this._element.addEventListener(Qj[r],i),this._active[r]=i}}),this._gamepadSource.hasEventListeners=t&&t.has("gamepad")}setPointerCapture(t,r){r?(this._element.setPointerCapture(t.pointerId),this._activePointerCaptures.add(t.pointerId)):(this._releasePointerCaptureSafe(t.pointerId),this._activePointerCaptures.delete(t.pointerId))}_updateTouchAction(){this._element.classList.remove(this._browserTouchPanningEnabled?iT.touchNone:iT.touchPan),this._element.classList.add(this._browserTouchPanningEnabled?iT.touchPan:iT.touchNone)}_updateTouchEventHandling(){this._browserTouchPanningEnabled?this._element.addEventListener("touchmove",this._preventMultiTouchPanning):this._element.removeEventListener("touchmove",this._preventMultiTouchPanning)}_removeTouchAction(){this._element.classList.remove(iT.touchNone),this._element.classList.remove(iT.touchPan),this._element.removeEventListener("touchmove",this._preventMultiTouchPanning)}_releasePointerCaptureSafe(t){try{if(this._element.hasPointerCapture&&!this._element.hasPointerCapture(t))return;this._element.releasePointerCapture(t)}catch{}}_updateNormalizedPointerLikeEvent(t,r){const i=aEe(this._element,t);return Hz.test.disableSubpixelCoordinates&&(i.x=Math.round(i.x),i.y=Math.round(i.y)),r.x=i.x,r.y=i.y,r}_handleKey(t,r){const i=Dst(r);i&&t==="key-up"&&this._keyDownState.delete(i);const n={native:r,key:i,repeat:i&&this._keyDownState.has(i)};i&&t==="key-down"&&this._keyDownState.add(n.key),this._callback(t,n)}_handlePointer(t,r){const i=this._updateNormalizedPointerLikeEvent(r,{native:r,x:0,y:0,pointerType:r.pointerType,button:r.button,buttons:r.buttons,eventId:this._eventId++});this._callback(t,i)}_handlePointerPreventDefault(t,r){const i=this._updateNormalizedPointerLikeEvent(r,{native:r,x:0,y:0,pointerType:r.pointerType,button:r.button,buttons:r.buttons,eventId:this._eventId++});r.preventDefault(),this._callback(t,i)}_handleMouseWheel(t,r){let i=r.deltaY;switch(r.deltaMode){case 0:(I0e||$0e)&&(i=i/document.documentElement.clientHeight*600);break;case 1:i*=30;break;case 2:i*=900}I0e||$0e?i*=.7:Hpt||Xpt?i*=.6:Wpt&&(i*=1.375);const n=100,s=Math.abs(i);s>n&&(i=i/s*200/(1+Math.exp(-.02*(s-n))));const a=this._updateNormalizedPointerLikeEvent(r,{native:r,x:0,y:0,deltaY:i});this._callback(t,a)}_handlePointerCaptureLost(t,r){this._activePointerCaptures.delete(r.pointerId),this._handleDefault(t,r)}_handleDefault(t,r){const i={native:r};r.preventDefault(),this._callback(t,i)}_preventAltKeyDefault(t){t.key==="Alt"&&t.preventDefault()}_preventMultiTouchPanning(t){t.touches.length>1&&t.preventDefault()}}Hz.test={disableSubpixelCoordinates:!1};const Qj={"key-down":"keydown","key-up":"keyup","pointer-down":"pointerdown","pointer-up":"pointerup","pointer-move":"pointermove","mouse-wheel":"wheel","pointer-capture-got":"gotpointercapture","pointer-capture-lost":"lostpointercapture","context-menu":"contextmenu","pointer-enter":"pointerenter","pointer-leave":"pointerleave","pointer-cancel":"pointercancel",focus:"focus",blur:"blur"};class Ypt extends ho{constructor(){super(!0),this.registerIncoming("context-menu",t=>{t.data.native.preventDefault()})}}function P7e(e,t){return Math.abs(t.x-e.x)+Math.abs(t.y-e.y)}function Zpt(e,t){const r=t.x-e.x,i=t.y-e.y;return Math.sqrt(r*r+i*i)}function Qpt(e,t){if(t?(t.radius=0,t.center.x=0,t.center.y=0):t={radius:0,center:Su()},e.length===0)return t;if(e.length===1)return t.center.x=e[0].x,t.center.y=e[0].y,t;if(e.length===2){const[T,E]=e,[C,A]=[E.x-T.x,E.y-T.y];return t.radius=Math.sqrt(C*C+A*A)/2,t.center.x=(T.x+E.x)/2,t.center.y=(T.y+E.y)/2,t}let r=0,i=0;for(let T=0;T<e.length;T++)r+=e[T].x,i+=e[T].y;r/=e.length,i/=e.length;const n=e.map(T=>T.x-r),s=e.map(T=>T.y-i);let a=0,o=0,l=0,c=0,u=0,h=0,p=0;for(let T=0;T<n.length;T++){const E=n[T],C=s[T],A=E*E,P=C*C;a+=A,o+=P,l+=E*C,c+=A*E,u+=P*C,h+=E*P,p+=C*A}const m=.5*(c+h),g=.5*(u+p),b=a*o-l*l,w=(m*o-g*l)/b,v=(a*g-l*m)/b,x=Su(w+r,v+i);return{radius:Math.sqrt(w*w+v*v+(a+o)/e.length),center:x}}class Jpt extends ho{constructor(t){super(!1),this.navigationTouch=t,this.startStateModifiers=new Set,this.activePointerMap=new Map,this.isDragging=!1,this.isCurrentDragSuppressed=!1,this.drag=this.registerOutgoing("drag"),this.registerIncoming("pointer-drag",this._handlePointerDrag.bind(this)),this.registerIncoming("pointer-up",this._handlePointerUpAndPointerLost.bind(this)),this.registerIncoming("pointer-capture-lost",this._handlePointerUpAndPointerLost.bind(this)),this.registerIncoming("pointer-cancel",this._handlePointerUpAndPointerLost.bind(this))}_createPayload(t,r,i,n){return{action:t,pointerType:this.pointerType,button:this.mouseButton,buttons:r.buttons,timestamp:n,pointers:Kpt(this.activePointerMap),pointer:r,angle:i.angle,radius:i.radius,center:i.center}}_addPointer(t){const r=t.native.pointerId,i=ZP(this.activePointerMap).angle,n={event:t,initialAngle:0,lastAngle:0};this.activePointerMap.set(r,n);const s=cD(n,I7e(this.activePointerMap));n.initialAngle=s,n.lastAngle=s,this._updatePointerAngles(i)}_updatePointer(t){if(t&&t.x==null&&t.y==null)return;const r=t.native.pointerId,i=this.activePointerMap.get(r);i?i.event=t:this._addPointer(t)}_removePointer(t){const r=ZP(this.activePointerMap).angle;this.activePointerMap.delete(t),this._updatePointerAngles(r)}_updatePointerAngles(t){const r=ZP(this.activePointerMap);this.activePointerMap.forEach(i=>{i.initialAngle=cD(i,r)-t,i.lastAngle=cD(i,r)-t})}_emitEvent(t,r,i){const n=ZP(this.activePointerMap);this.drag.emit(this._createPayload(t,r,n,i),void 0,this.startStateModifiers)}_handlePointerUpAndPointerLost(t){const r=t.data.native.pointerId,i=t.timestamp;this.activePointerMap.get(r)&&(this.activePointerMap.size===1?(this._updatePointer(t.data),!this.isCurrentDragSuppressed&&this._emitEvent("end",t.data,i),this.isDragging=!1,this.isCurrentDragSuppressed=!1,this._removePointer(r)):(this._removePointer(r),this._emitEvent("removed",t.data,t.timestamp)))}_handlePointerDrag(t){const r=t.data,i=r.currentEvent,n=t.timestamp;switch(r.action){case"start":case"update":this.isDragging?this.activePointerMap.has(i.native.pointerId)?(this._updatePointer(i),!this.isCurrentDragSuppressed&&this._emitEvent("update",i,n)):(this._addPointer(i),this._emitEvent("added",i,n),this.isCurrentDragSuppressed=this.isSuppressed):(this._updatePointer(i),this.pointerType=t.data.startEvent.pointerType,this.mouseButton=t.data.startEvent.button,this.startStateModifiers=t.modifiers,this.isDragging=!0,this.isCurrentDragSuppressed=this.isSuppressed,!this.isCurrentDragSuppressed&&this._emitEvent("start",i,n))}}get isSuppressed(){return this.navigationTouch&&!this.navigationTouch.browserTouchPanEnabled&&this.pointerType==="touch"&&this.activePointerMap.size===1}}function I7e(e){const t=[];return e.forEach(r=>{t.push(Su(r.event.x,r.event.y))}),Qpt(t)}function ZP(e){const t=I7e(e);let r=0;return e.forEach(i=>{let n=cD(i,t),s=n-i.lastAngle;for(;s>Math.PI;)s-=2*Math.PI;for(;s<-Math.PI;)s+=2*Math.PI;n=i.lastAngle+s,i.lastAngle=n,r+=n-i.initialAngle}),r/=e.size||1,{angle:r,radius:t.radius,center:t.center}}function Kpt(e){const t=new Map;return e.forEach((r,i)=>t.set(i,r.event)),t}function cD(e,t){const r=e.event,i=r.x-t.center.x,n=r.y-t.center.y;return Math.atan2(n,i)}var L0e;(function(e){e[e.Left=0]="Left",e[e.Middle=1]="Middle",e[e.Right=2]="Right",e[e.Back=3]="Back",e[e.Forward=4]="Forward",e[e.Undefined=-1]="Undefined"})(L0e||(L0e={}));const pv={maximumDoubleClickDelay:250,maximumDoubleClickDistance:10,maximumDoubleTouchDelay:350,maximumDoubleTouchDistance:35};class e0t extends ho{constructor(t=pv.maximumDoubleClickDelay,r=pv.maximumDoubleClickDistance,i=pv.maximumDoubleTouchDelay,n=pv.maximumDoubleTouchDistance,s=sV){super(!1),this.maximumDoubleClickDelay=t,this.maximumDoubleClickDistance=r,this.maximumDoubleTouchDelay=i,this.maximumDoubleTouchDistance=n,this._clock=s,this._pointerState=new Map,this._click=this.registerOutgoing("click"),this._doubleClick=this.registerOutgoing("double-click"),this.registerIncoming("immediate-click",this._handleImmediateClick.bind(this)),this.registerIncoming("pointer-drag",this._handlePointerDrag.bind(this)),this.registerIncoming("drag",this._handleDrag.bind(this))}onUninstall(){this._pointerState.forEach(t=>t.doubleClickTimeout=Ts(t.doubleClickTimeout))}get hasPendingInputs(){return vs(this._pointerState,t=>t.doubleClickTimeout!=null)}_pointerId(t){const r=t.native;return r.pointerType==="mouse"?`${r.pointerId}:${r.button}`:`${r.pointerType}`}_handleImmediateClick(t){const r=t.data,i=this._pointerId(r),n=this._pointerState.get(i);if(n){const s=r.native.pointerType==="touch"?this.maximumDoubleTouchDistance:this.maximumDoubleClickDistance;P7e(n.event.data,r)>s?(this._clearDoubleClickTimeout(i,!0),this._startClick(t)):(this._clearDoubleClickTimeout(i,!1),this._doubleClick.emit(n.event.data,void 0,n.event.modifiers))}else this._startClick(t)}_startClick(t){const r=this._pointerId(t.data),i=t.data.native.pointerType==="touch"?this.maximumDoubleTouchDelay:this.maximumDoubleClickDelay;this._pointerState.set(r,{event:t,doubleClickTimeout:this._clock.setTimeout(()=>this._doubleClickTimeoutExceeded(r),i)}),this.refreshHasPendingInputs()}_handlePointerDrag(t){const r=this._pointerId(t.data.currentEvent);this._clearDoubleClickTimeout(r,!0)}_handleDrag(t){const r=this._pointerId(t.data.pointer);this._clearDoubleClickTimeout(r,!0)}_clearDoubleClickTimeout(t,r){const i=this._pointerState.get(t);i&&(i.doubleClickTimeout.remove(),i.doubleClickTimeout=null,r&&this._doubleClickTimeoutExceeded(t),this._pointerState.delete(t),this.refreshHasPendingInputs())}_doubleClickTimeoutExceeded(t){const r=this._pointerState.get(t);this._click.emit(r.event.data,void 0,r.event.modifiers),r.doubleClickTimeout=null,this._pointerState.delete(t),this.refreshHasPendingInputs()}}class t0t extends ho{constructor(t=pv.maximumDoubleClickDelay,r=pv.maximumDoubleClickDistance,i=pv.maximumDoubleTouchDelay,n=pv.maximumDoubleTouchDistance,s=sV){super(!1),this.maximumDoubleClickDelay=t,this.maximumDoubleClickDistance=r,this.maximumDoubleTouchDelay=i,this.maximumDoubleTouchDistance=n,this._clock=s,this._pointerState=new Map,this._immediateDoubleClick=this.registerOutgoing("immediate-double-click"),this.registerIncoming("pointer-down",this._handlePointerDown.bind(this)),this.registerIncoming("pointer-up",a=>{this._handlePointerLoss(a,"pointer-up")}),this.registerIncoming("pointer-capture-lost",a=>{this._handlePointerLoss(a,"pointer-capture-lost")}),this.registerIncoming("pointer-cancel",a=>{this._handlePointerLoss(a,"pointer-cancel")})}onUninstall(){this._pointerState.forEach(t=>{t.immediateDoubleClick&&t.immediateDoubleClick.timeoutHandle.remove()}),super.onUninstall()}_handlePointerDown(t){const r=t.data,i=this._pointerId(r);if(!this._pointerState.has(i)){const n={downButton:r.native.button,immediateDoubleClick:null};this._pointerState.set(i,n),this.startCapturingPointer(r.native)}}_handlePointerLoss(t,r){const i=t.data,n=this._pointerId(i),s=this._pointerState.get(n);if(s&&r==="pointer-up"&&s.downButton===i.native.button){const a=s.immediateDoubleClick;if(a){a.timeoutHandle.remove();const o=t.data.native.pointerType==="touch"?this.maximumDoubleTouchDistance:this.maximumDoubleClickDistance;P7e(a,t.data)>o?this._startImmediateDoubleClick(t,s):(this._immediateDoubleClick.emit(t.data,void 0,a.modifiers),this._removeState(i))}else this._startImmediateDoubleClick(t,s)}}_startImmediateDoubleClick(t,r){const i=t.data.native.pointerType==="touch"?this.maximumDoubleTouchDelay:this.maximumDoubleClickDelay;r.immediateDoubleClick={x:t.data.x,y:t.data.y,modifiers:t.modifiers,timeoutHandle:this._clock.setTimeout(()=>this._removeState(t.data),i)}}_pointerId(t){const r=t.native;return r.pointerType==="mouse"?`${r.pointerId}:${r.button}`:`${r.pointerType}`}_removeState(t){const r=this._pointerId(t);this._pointerState.delete(r),this.stopCapturingPointer(t.native),this.refreshHasPendingInputs()}}const f8={maximumClickDelay:300,movementUntilMouseDrag:1.5,movementUntilPenDrag:6,movementUntilTouchDrag:6,holdDelay:500};class r0t extends ho{constructor(t=f8.maximumClickDelay,r=f8.movementUntilMouseDrag,i=f8.movementUntilPenDrag,n=f8.movementUntilTouchDrag,s=f8.holdDelay,a=sV){super(!1),this.maximumClickDelay=t,this.movementUntilMouseDrag=r,this.movementUntilPenDrag=i,this.movementUntilTouchDrag=n,this.holdDelay=s,this._clock=a,this._pointerState=new Map,this._pointerDrag=this.registerOutgoing("pointer-drag"),this._immediateClick=this.registerOutgoing("immediate-click"),this._pointerHold=this.registerOutgoing("hold"),this.registerIncoming("pointer-down",this._handlePointerDown.bind(this)),this.registerIncoming("pointer-up",o=>{this._handlePointerLoss(o,"pointer-up")}),this.registerIncoming("pointer-capture-lost",o=>{this._handlePointerLoss(o,"pointer-capture-lost")}),this.registerIncoming("pointer-cancel",o=>{this._handlePointerLoss(o,"pointer-cancel")}),this._moveHandle=this.registerIncoming("pointer-move",this._handlePointerMove.bind(this)),this._moveHandle.pause()}onUninstall(){this._pointerState.forEach(t=>{t.holdTimeout!=null&&(t.holdTimeout.remove(),t.holdTimeout=null)}),super.onUninstall()}_handlePointerDown(t){const r=t.data,i=r.native.pointerId;let n=null;this._pointerState.size===0&&(n=this._clock.setTimeout(()=>{const a=this._pointerState.get(i);if(a){if(!a.isDragging){const o=a.previousEvent;this._pointerHold.emit(o,void 0,t.modifiers),a.holdEmitted=!0}a.holdTimeout=null}},this.holdDelay));const s={startEvent:r,previousEvent:r,startTimestamp:t.timestamp,isDragging:!1,downButton:r.native.button,holdTimeout:n,modifiers:new Set};this._pointerState.set(i,s),this.startCapturingPointer(r.native),this._moveHandle.resume(),this._pointerState.size>1&&this._startDragging(t)}_createPointerDragData(t,r,i){return{action:t,startEvent:r.startEvent,previousEvent:r.previousEvent,currentEvent:i}}_handlePointerMove(t){const r=t.data,i=r.native.pointerId,n=this._pointerState.get(i);n&&(n.isDragging?this._pointerDrag.emit(this._createPointerDragData("update",n,r),void 0,n.modifiers):Zpt(r,n.startEvent)>this._getDragThreshold(r.native.pointerType)&&this._startDragging(t),n.previousEvent=r)}_getDragThreshold(t){switch(t){case"touch":return this.movementUntilTouchDrag;case"pen":return this.movementUntilPenDrag;default:return this.movementUntilMouseDrag}}_startDragging(t){const r=t.data,i=r.native.pointerId;this._pointerState.forEach(n=>{n.holdTimeout!=null&&(n.holdTimeout.remove(),n.holdTimeout=null),n.isDragging||(n.modifiers=t.modifiers,n.isDragging=!0,i===n.startEvent.native.pointerId?this._pointerDrag.emit(this._createPointerDragData("start",n,r)):this._pointerDrag.emit(this._createPointerDragData("start",n,n.previousEvent),t.timestamp))})}_handlePointerLoss(t,r){const i=t.data,n=i.native.pointerId,s=this._pointerState.get(n);s&&(s.holdTimeout!=null&&(s.holdTimeout.remove(),s.holdTimeout=null),s.isDragging?this._pointerDrag.emit(this._createPointerDragData("end",s,r==="pointer-up"?i:s.previousEvent),void 0,s.modifiers):r==="pointer-up"&&s.downButton===i.native.button&&t.timestamp-s.startTimestamp<=this.maximumClickDelay&&!s.holdEmitted&&this._immediateClick.emit(i),this._pointerState.delete(n),this.stopCapturingPointer(i.native),this._pointerState.size===0&&this._moveHandle.pause())}}class i0t{constructor(t){this.callbacks=t,this.currentCount=0,this.callbacks.condition||(this.callbacks.condition=()=>!0)}handle(t){const r=t.data,i=r.pointers.size;switch(r.action){case"start":this.currentCount=i,this._emitStart(t);break;case"added":this._emitEnd(this.previousEvent),this.currentCount=i,this._emitStart(t);break;case"update":this._emitUpdate(t);break;case"removed":this.startEvent&&this._emitEnd(this.previousEvent),this.currentCount=i,this._emitStart(t);break;case"end":this._emitEnd(t),this.currentCount=0}this.previousEvent=t}_emitStart(t){this.startEvent=t,this.callbacks.condition(this.currentCount,t)&&this.callbacks.start(this.currentCount,t,this.startEvent)}_emitUpdate(t){this.callbacks.condition(this.currentCount,t)&&this.callbacks.update(this.currentCount,t,this.startEvent)}_emitEnd(t){this.callbacks.condition(this.currentCount,t)&&this.callbacks.end(this.currentCount,t,this.startEvent),this.startEvent=null}}class n0t extends ho{constructor(t=20,r=40){super(!1),this._threshold=t,this._maxDelta=r,this.state="ready",this.emittedArtificalEnd2=!1,this._vertical=this.registerOutgoing("vertical-two-finger-drag"),this._artificalDrag=this.registerOutgoing("drag"),this.dragEventSeparator=new i0t({start:(i,n)=>this._observeStart(i,n),update:(i,n,s)=>this._observeUpdate(i,n,s),end:(i,n)=>this._observeEnd(n)}),this.registerIncoming("drag",i=>this.dragEventSeparator.handle(i))}get failed(){return this.state==="failed"}_observeStart(t,r){t===1&&this.emittedArtificalEnd2&&(this.emittedArtificalEnd2=!1,this._artificalDrag.emit({action:"start",button:r.data.button,buttons:r.data.buttons,pointerType:r.data.pointerType,timestamp:r.data.timestamp,pointers:r.data.pointers,pointer:r.data.pointer,angle:r.data.angle,radius:r.data.radius,center:r.data.center}),r.stopPropagation()),this.state=t===2?"ready":"failed"}_observeUpdate(t,r,i){if(this.state!=="failed"&&t===2)return this.state==="active"?(this._vertical.emit({delta:r.data.center.y-this._thresholdReachedCenter.y,action:"update"}),void r.stopPropagation()):void(this._checkMovementWithinLimits(r.data,i.data)?this._checkVerticalThresholdReached(r.data,i.data)&&(this.state="active",this.emittedArtificalEnd2=!0,this._thresholdReachedCenter=r.data.center,this._artificalDrag.emit({action:"end",button:r.data.button,buttons:r.data.buttons,pointerType:r.data.pointerType,timestamp:r.data.timestamp,pointers:r.data.pointers,pointer:r.data.pointer,angle:r.data.angle,radius:r.data.radius,center:r.data.center}),this._vertical.emit({delta:r.data.center.y-this._thresholdReachedCenter.y,action:"begin"}),r.stopPropagation()):this.state="failed")}_observeEnd(t){this.state==="active"&&(this._vertical.emit({delta:t.data.center.y-this._thresholdReachedCenter.y,action:"end"}),this.state="ready",t.stopPropagation())}_checkMovementWithinLimits(t,r){let i=-1/0,n=1/0,s=-1/0,a=1/0;r.pointers.forEach(b=>{i=Math.max(i,b.x),n=Math.min(n,b.x),s=Math.max(s,b.y),a=Math.min(a,b.y)});let o=-1/0,l=1/0,c=-1/0,u=1/0;t.pointers.forEach(b=>{o=Math.max(o,b.x),l=Math.min(l,b.x),c=Math.max(c,b.y),u=Math.min(u,b.y)});const h=i-n,p=s-a,m=o-l,g=c-u;return Math.abs(t.center.x-r.center.x)<this._threshold&&Math.abs(m-h)<=this._maxDelta&&Math.abs(g-p)<=this._maxDelta}_checkVerticalThresholdReached(t,r){let i=Math.abs(t.center.y-r.center.y);return t.pointers.forEach((n,s)=>{const a=r.pointers.get(s);i=Math.min(i,Math.abs(n.y-a.y))}),i>=this._threshold}}let x0=class extends xe{constructor(){super(...arguments),this._handles=new Ft}destroy(){this._handles&&(this._handles.removeAll(),this._handles=null),this.disconnect()}get primaryDragAction(){return this._get("primaryDragAction")}set primaryDragAction(e){e!=="pan"&&e!=="rotate"||e===this._get("primaryDragAction")||(this._set("primaryDragAction",e),this._updateMode())}get mode(){return this._get("mode")}set mode(e){e!=="default"&&e!=="pro"||e===this._get("mode")||(this._set("mode",e),this._updateMode())}get hasPendingInputs(){var e;return(e=this._inputManager)==null?void 0:e.hasPendingInputs}get latestPointerType(){var e;return(e=this._inputManager)==null?void 0:e.latestPointerType}get latestPointerLocation(){var e;return(e=this._inputManager)==null?void 0:e.latestPointerLocation}disconnect(){this.view.viewEvents.disconnect(),this._inputManager&&(this._inputManager.destroy(),this._inputManager=null),this._source&&(this._source.destroy(),this._source=null)}connect(){const e=this.view;this._source=new Hz(this.view.surface,e.input);const t=[new t0t,new r0t,new e0t,new Jpt(this.view.navigation),new n0t],r=new l1({eventSource:this._source,recognizers:t});this._inputManager=r,r.installHandlers("prevent-context-menu",[new Ypt],Lv.INTERNAL),this._modeDragPan=new M0e(e,"primary"),this._modeDragRotate=new Wj(e,"secondary",Bc.CENTER),this._modeDragZoom=new Hft(e,"tertiary");const i={lookAround:"b",pan:{left:"ArrowLeft",right:"ArrowRight",forward:"ArrowUp",backward:"ArrowDown",up:"u",down:"j",headingLeft:"a",headingRight:"d",tiltUp:"w",tiltDown:"s",zoomIn:"+",zoomOut:"-"},resetHeading:"n",resetTilt:"p"};r.installHandlers("navigation",[new kpt(e),new Bft(e),new Rpt(e),new Opt(e,i.pan),new Mpt(e),new zpt(e,i.resetTilt),new Vpt(e,i.resetHeading),new Wj(e,"primary",Bc.EYE,[i.lookAround]),new Wj(e,"secondary",Bc.CENTER,[i.lookAround]),new M0e(e,"tertiary",[i.lookAround]),this._modeDragRotate,this._modeDragZoom,this._modeDragPan,new Upt(e)],Lv.INTERNAL),this.view.viewEvents.connect(r),this._updateMode(),this._handles.add(re(()=>{var n;return(n=this.view.navigation)==null?void 0:n.browserTouchPanEnabled},n=>{this._source.browserTouchPanningEnabled=!n},Ot))}_updateMode(){const e=this.mode,t=this.primaryDragAction,r=ZJ.get(e).get(t);this._modeDragPan&&(this._modeDragPan.pointerAction=r.pan),this._modeDragRotate&&(this._modeDragRotate.pointerAction=r.rotate),this._modeDragZoom&&(this._modeDragZoom.pointerAction=r.zoom)}get test(){return{inputManager:this._inputManager,modeDragPan:this._modeDragPan,modeDragRotate:this._modeDragRotate,modeDragZoom:this._modeDragZoom}}};d([f()],x0.prototype,"view",void 0),d([f({value:"pan"})],x0.prototype,"primaryDragAction",null),d([f({value:"default"})],x0.prototype,"mode",null),d([f({readOnly:!0})],x0.prototype,"hasPendingInputs",null),d([f()],x0.prototype,"latestPointerType",null),d([f()],x0.prototype,"latestPointerLocation",null),d([f()],x0.prototype,"_inputManager",void 0),x0=d([$("esri.views.3d.input.SceneInputManager")],x0);const ZJ=new Map,Jj=new Map,Kj=new Map;Jj.set("pan",{pan:"primary",rotate:"secondary",zoom:"tertiary"}),Jj.set("rotate",{pan:"secondary",rotate:"primary",zoom:"tertiary"}),Kj.set("pan",{pan:"primary",rotate:"tertiary",zoom:"secondary"}),Kj.set("rotate",{pan:"tertiary",rotate:"primary",zoom:"secondary"}),ZJ.set("default",Jj),ZJ.set("pro",Kj);const s0t=x0;let _n=class extends xe{constructor(){super(...arguments),this.SCENEVIEW_HITTEST_RETURN_INTERSECTOR=!1,this.DECONFLICTOR_SHOW_VISIBLE=!1,this.DECONFLICTOR_SHOW_INVISIBLE=!1,this.DECONFLICTOR_SHOW_GRID=!1,this.LABELS_SHOW_BORDER=!1,this.TEXT_SHOW_BASELINE=!1,this.TEXT_SHOW_BORDER=!1,this.OVERLAY_DRAW_DEBUG_TEXTURE=!1,this.OVERLAY_SHOW_CENTER=!1,this.SHOW_POI=!1,this.TESTS_DISABLE_OPTIMIZATIONS=!1,this.TESTS_DISABLE_FAST_UPDATES=!1,this.DRAW_MESH_GEOMETRY_NORMALS=!1,this.FEATURE_TILE_FETCH_SHOW_TILES=!1,this.FEATURE_TILE_TREE_SHOW_TILES=!1,this.TERRAIN_TILE_TREE_SHOW_TILES=!1,this.I3S_TREE_SHOW_TILES=!1,this.I3S_SHOW_MODIFICATIONS=!1,this.LOD_INSTANCE_RENDERER_DISABLE_UPDATES=!1,this.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL=!1,this.EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES=!1,this.LINE_WIREFRAMES=!1}};d([f()],_n.prototype,"SCENEVIEW_HITTEST_RETURN_INTERSECTOR",void 0),d([f()],_n.prototype,"DECONFLICTOR_SHOW_VISIBLE",void 0),d([f()],_n.prototype,"DECONFLICTOR_SHOW_INVISIBLE",void 0),d([f()],_n.prototype,"DECONFLICTOR_SHOW_GRID",void 0),d([f()],_n.prototype,"LABELS_SHOW_BORDER",void 0),d([f()],_n.prototype,"TEXT_SHOW_BASELINE",void 0),d([f()],_n.prototype,"TEXT_SHOW_BORDER",void 0),d([f()],_n.prototype,"OVERLAY_DRAW_DEBUG_TEXTURE",void 0),d([f()],_n.prototype,"OVERLAY_SHOW_CENTER",void 0),d([f()],_n.prototype,"SHOW_POI",void 0),d([f()],_n.prototype,"TESTS_DISABLE_OPTIMIZATIONS",void 0),d([f()],_n.prototype,"TESTS_DISABLE_FAST_UPDATES",void 0),d([f()],_n.prototype,"DRAW_MESH_GEOMETRY_NORMALS",void 0),d([f()],_n.prototype,"FEATURE_TILE_FETCH_SHOW_TILES",void 0),d([f()],_n.prototype,"FEATURE_TILE_TREE_SHOW_TILES",void 0),d([f()],_n.prototype,"TERRAIN_TILE_TREE_SHOW_TILES",void 0),d([f()],_n.prototype,"I3S_TREE_SHOW_TILES",void 0),d([f()],_n.prototype,"I3S_SHOW_MODIFICATIONS",void 0),d([f()],_n.prototype,"LOD_INSTANCE_RENDERER_DISABLE_UPDATES",void 0),d([f()],_n.prototype,"LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL",void 0),d([f()],_n.prototype,"EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES",void 0),d([f()],_n.prototype,"LINE_WIREFRAMES",void 0),_n=d([$("esri.views.3d.support.DebugFlags")],_n);const Yr=new _n;let Yd,i5,QJ=!1,JJ=!1,KJ=!1,eK=!1,p7=null;function a0t(e,t){if(!JJ||!i5)return;$7e();const r=i5;let i=0;for(let n=0;n<e.accBinsNumX;n++)for(let s=0;s<e.accBinsNumY;s++){const a=e.accBins[n][e.accBinsNumY-1-s];i+=a.length;const o=n*e.accBinsSizeX,l=(n+1)*e.accBinsSizeX,c=s*e.accBinsSizeY,u=(s+1)*e.accBinsSizeY;r.fillText(a.length.toFixed(),o+5,c+15),L7e(o,l,c,u,"blue")}r.fillText("total totalShownLabels: "+i,70,40),r.fillText("total visible labels: "+t.size,70,50),r.fillText("total numTests: "+e.accNumTests,70,30)}function o0t(e){KJ=Yr.DECONFLICTOR_SHOW_VISIBLE,eK=Yr.DECONFLICTOR_SHOW_INVISIBLE,QJ=KJ||eK,JJ=Yr.DECONFLICTOR_SHOW_GRID,p7=null,QJ||JJ?p7=()=>l0t(e):Yd&&(Yd.parentElement.removeChild(Yd),Yd=null)}function $7e(){p7&&(p7(),p7=null)}function l0t(e){Yd==null&&(Yd=document.createElement("canvas"),Yd.setAttribute("id","canvas2d"),e.surface.parentElement.style.position="relative",e.surface.parentElement.appendChild(Yd));const{state:t}=e,{camera:r,pixelRatio:i}=t,{width:n,height:s}=r,a=n*i,o=s*i;Yd.setAttribute("width",`${a}px`),Yd.setAttribute("height",`${o}px`),Yd.setAttribute("style",`position:absolute;left:0px;top:0px;display:block;pointer-events:none;width:${n}px;height:${s}px`),i5=Yd.getContext("2d"),i5.clearRect(0,0,n,s),i5.font="12px Arial"}function L7e(e,t,r,i,n){$7e();const s=Yd.height,a=i5;a.beginPath(),a.lineWidth=1,a.strokeStyle=n,a.moveTo(e,s-r),a.lineTo(t,s-r),a.stroke(),a.lineTo(t,s-i),a.stroke(),a.lineTo(t,s-r),a.stroke(),a.lineTo(e,s-r),a.stroke(),a.lineTo(e,s-r),a.stroke(),a.closePath()}function c0t(e,t){QJ&&(t&&KJ||!t&&eK)&&L7e(e.aabr[0],e.aabr[2],e.aabr[1],e.aabr[3],t?"green":"red")}var Ra,ou;(function(e){e[e.GRAPHIC=0]="GRAPHIC",e[e.LABEL=1]="LABEL",e[e._COUNT=2]="_COUNT"})(Ra||(Ra={})),function(e){e[e.USER_SETTING=0]="USER_SETTING",e[e.SCALE_RANGE=1]="SCALE_RANGE",e[e.FILTER=2]="FILTER",e[e.DECONFLICTION=3]="DECONFLICTION",e[e._COUNT=4]="_COUNT"}(ou||(ou={}));function D7e(e,t){return new Wz(e,V7e,t)}function d0t(e,t){const{curvatureDependent:r,scaleStart:i,scaleFallOffRange:n}=V7e;return new Wz(e,{curvatureDependent:{min:{curvature:r.min.curvature,tiltAngle:r.min.tiltAngle,scaleFallOffFactor:eq.curvatureDependent.min.scaleFallOffFactor},max:{curvature:r.max.curvature,tiltAngle:r.max.tiltAngle,scaleFallOffFactor:eq.curvatureDependent.max.scaleFallOffFactor}},scaleStart:i,scaleFallOffRange:n,minPixelSize:eq.minPixelSize},t)}function u0t(e){return Math.abs(e*e*e)}function F7e(e,t,r){const i=r.parameters,n=r.paddingPixelsOverride;return p8.scale=Math.min(i.divisor/(t-i.offset),1),p8.factor=u0t(e),p8.minPixelSize=i.minPixelSize,p8.paddingPixels=n,p8}function N7e(e,t){return e===0?t.minPixelSize:t.minPixelSize*(1+2*t.paddingPixels/e)}function Wse(e,t){return Math.max(Kt(e*t.scale,e,t.factor),N7e(e,t))}function h0t(e,t,r){const i=F7e(e,t,r);return i.minPixelSize=0,i.paddingPixels=0,Wse(1,i)}function D0e(e,t,r,i){i.scale=h0t(e,t,r),i.factor=0,i.minPixelSize=r.parameters.minPixelSize,i.paddingPixels=r.paddingPixelsOverride}function k7e(e,t,r=[0,0]){const i=Math.min(Math.max(t.scale,N7e(e[1],t)/Math.max(1e-5,e[1])),1);return r[0]=e[0]*i,r[1]=e[1]*i,r}function f0t(e,t,r,i){return Wse(e,F7e(t,r,i))}class Wz{constructor(t,r,i,n=p0t(),s){this.viewingMode=t,this.description=r,this.ellipsoidRadius=i,this.parameters=n,this._paddingPixelsOverride=s,this.viewingMode===Be.Local?(this.coverageCompensation=this._surfaceCoverageCompensationLocal,this.calculateCurvatureDependentParameters=this._calculateCurvatureDependentParametersLocal):(this.coverageCompensation=this._surfaceCoverageCompensationGlobal,this.calculateCurvatureDependentParameters=this._calculateCurvatureDependentParametersGlobal)}get paddingPixelsOverride(){return this._paddingPixelsOverride||this.parameters.paddingPixels}update(t){return(!this.parameters||this.parameters.camera.fovY!==t.fovY||this.parameters.camera.distance!==t.distance)&&(this._calculateParameters(t,this.ellipsoidRadius,this.parameters),!0)}overridePadding(t){return t!==this.paddingPixelsOverride?new Wz(this.viewingMode,this.description,this.ellipsoidRadius,this.parameters,t):this}_calculateParameters(t,r,i){const{scaleStart:n,scaleFallOffRange:s,minPixelSize:a}=this.description,{fovY:o,distance:l}=t,c=this.calculateCurvatureDependentParameters(t,r),u=this.coverageCompensation(t,r,c),{tiltAngle:h,scaleFallOffFactor:p}=c,m=Math.sin(h)*l,g=.5*Math.PI-h-o*(.5-n*u),b=m/Math.cos(g),w=g+o*s*u,v=(b-p*(m/Math.cos(w)))/(1-p);return i.camera.fovY=t.fovY,i.camera.distance=t.distance,i.offset=v,i.divisor=b-v,i.minPixelSize=a,i}_calculateCurvatureDependentParametersLocal(t,r,i=F0e){return i.tiltAngle=this.description.curvatureDependent.min.tiltAngle,i.scaleFallOffFactor=this.description.curvatureDependent.min.scaleFallOffFactor,i}_calculateCurvatureDependentParametersGlobal(t,r,i=F0e){const n=this.description.curvatureDependent,s=1+t.distance/r,a=Math.sqrt(s*s-1),[o,l]=[n.min.curvature,n.max.curvature],c=Le((a-o)/(l-o),0,1),[u,h]=[n.min,n.max];return i.tiltAngle=Kt(u.tiltAngle,h.tiltAngle,c),i.scaleFallOffFactor=Kt(u.scaleFallOffFactor,h.scaleFallOffFactor,c),i}_surfaceCoverageCompensationLocal(t,r,i){return(t.fovY-i.tiltAngle)/t.fovY}_surfaceCoverageCompensationGlobal(t,r,i){const n=r*r,s=i.tiltAngle+.5*Math.PI,{fovY:a,distance:o}=t,l=o*o+n-2*Math.cos(s)*o*r,c=Math.sqrt(l),u=Math.sqrt(l-n);return(Math.acos(u/c)-Math.asin(r/(c/Math.sin(s)))+.5*a)/a}}const V7e={curvatureDependent:{min:{curvature:kt(10),tiltAngle:kt(12),scaleFallOffFactor:.5},max:{curvature:kt(70),tiltAngle:kt(40),scaleFallOffFactor:.8}},scaleStart:.3,scaleFallOffRange:.65,minPixelSize:0},eq={curvatureDependent:{min:{scaleFallOffFactor:.7},max:{scaleFallOffFactor:.95}},minPixelSize:14};function p0t(){return{camera:{distance:0,fovY:0},divisor:0,offset:0,minPixelSize:0,paddingPixels:0}}const p8={scale:0,factor:0,minPixelSize:0,paddingPixels:0},F0e={tiltAngle:0,scaleFallOffFactor:0};function m0t(e){return e instanceof Float32Array&&e.length>=16}function g0t(e){return Array.isArray(e)&&e.length>=16}function y0t(e){return m0t(e)||g0t(e)}var K;(function(e){e[e.Color=0]="Color",e[e.Depth=1]="Depth",e[e.Normal=2]="Normal",e[e.Shadow=3]="Shadow",e[e.Highlight=4]="Highlight",e[e.Draped=5]="Draped",e[e.Occlusion=6]="Occlusion",e[e.Alpha=7]="Alpha",e[e.COUNT=8]="COUNT"})(K||(K={}));function Xse(e){e.vertex.code.add(S`float screenSizePerspectiveMinSize(float size, vec4 factor) {
float nonZeroSize = 1.0 - step(size, 0.0);
return (
factor.z * (
1.0 +
nonZeroSize *
2.0 * factor.w / (
size + (1.0 - nonZeroSize)
)
)
);
}`),e.vertex.code.add(S`float screenSizePerspectiveViewAngleDependentFactor(float absCosAngle) {
return absCosAngle * absCosAngle * absCosAngle;
}`),e.vertex.code.add(S`vec4 screenSizePerspectiveScaleFactor(float absCosAngle, float distanceToCamera, vec4 params) {
return vec4(
min(params.x / (distanceToCamera - params.y), 1.0),
screenSizePerspectiveViewAngleDependentFactor(absCosAngle),
params.z,
params.w
);
}`),e.vertex.code.add(S`float applyScreenSizePerspectiveScaleFactorFloat(float size, vec4 factor) {
return max(mix(size * factor.x, size, factor.y), screenSizePerspectiveMinSize(size, factor));
}`),e.vertex.code.add(S`float screenSizePerspectiveScaleFloat(float size, float absCosAngle, float distanceToCamera, vec4 params) {
return applyScreenSizePerspectiveScaleFactorFloat(
size,
screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params)
);
}`),e.vertex.code.add(S`vec2 applyScreenSizePerspectiveScaleFactorVec2(vec2 size, vec4 factor) {
return mix(size * clamp(factor.x, screenSizePerspectiveMinSize(size.y, factor) / max(1e-5, size.y), 1.0), size, factor.y);
}`),e.vertex.code.add(S`vec2 screenSizePerspectiveScaleVec2(vec2 size, float absCosAngle, float distanceToCamera, vec4 params) {
return applyScreenSizePerspectiveScaleFactorVec2(size, screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params));
}`)}function b0t(e){e.uniforms.add(new cr("screenSizePerspective",t=>z7e(t.screenSizePerspective)))}function Xz(e){e.uniforms.add(new cr("screenSizePerspectiveAlignment",t=>z7e(t.screenSizePerspectiveAlignment||t.screenSizePerspective)))}function z7e(e){return ei(v0t,e.parameters.divisor,e.parameters.offset,e.parameters.minPixelSize,e.paddingPixelsOverride)}const v0t=Jt();class tK extends sn{constructor(t,r){super(t,"mat4",zr.Draw,(i,n,s)=>i.setUniformMatrix4fv(t,r(n,s)))}}function _m(e,t){t.instancedDoublePrecision?e.constants.add("cameraPosition","vec3",gl):e.uniforms.add(new yl("cameraPosition",(r,i)=>ne(U7e,i.camera.viewInverseTransposeMatrix[3]-r.origin[0],i.camera.viewInverseTransposeMatrix[7]-r.origin[1],i.camera.viewInverseTransposeMatrix[11]-r.origin[2])))}function _u(e,t){if(e.vertex.uniforms.add(new Ei("proj",(i,n)=>n.camera.projectionMatrix)),t.instancedDoublePrecision){const i=(s,a)=>ne(U7e,a.camera.viewInverseTransposeMatrix[3],a.camera.viewInverseTransposeMatrix[7],a.camera.viewInverseTransposeMatrix[11]);e.vertex.uniforms.add(new Ei("view",(s,a)=>wl(N0e,a.camera.viewMatrix,i(s,a))));const n=new St("localOrigin",i);return e.vertex.uniforms.add(n),n}e.vertex.uniforms.add(new tK("view",(i,n)=>wl(N0e,n.camera.viewMatrix,i.origin)));const r=new yl("localOrigin",i=>i.origin);return e.vertex.uniforms.add(r),r}const N0e=iO(),U7e=M();function B7e(e,t){const r=e.vertex;t.hasVerticalOffset?(G7e(r),t.hasScreenSizePerspective&&(e.include(Xse),Xz(r),_m(e.vertex,t)),r.code.add(S`
      vec3 calculateVerticalOffset(vec3 worldPos, vec3 localOrigin) {
        float viewDistance = length((view * vec4(worldPos, 1.0)).xyz);
        ${t.spherical?S`vec3 worldNormal = normalize(worldPos + localOrigin);`:S`vec3 worldNormal = vec3(0.0, 0.0, 1.0);`}
        ${t.hasScreenSizePerspective?S`
            float cosAngle = dot(worldNormal, normalize(worldPos - cameraPosition));
            float verticalOffsetScreenHeight = screenSizePerspectiveScaleFloat(verticalOffset.x, abs(cosAngle), viewDistance, screenSizePerspectiveAlignment);`:S`
            float verticalOffsetScreenHeight = verticalOffset.x;`}
        // Screen sized offset in world space, used for example for line callouts
        float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * viewDistance, verticalOffset.z, verticalOffset.w);
        return worldNormal * worldOffset;
      }

      vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) {
        return worldPos + calculateVerticalOffset(worldPos, localOrigin);
      }
    `)):r.code.add(S`vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) { return worldPos; }`)}const _0t=Jt();function G7e(e){e.uniforms.add(new cr("verticalOffset",(t,r)=>{const{minWorldLength:i,maxWorldLength:n,screenLength:s}=t.verticalOffset,a=Math.tan(.5*r.camera.fovY)/(.5*r.camera.fullViewport[3]),o=r.camera.pixelRatio||1;return ei(_0t,s*o,a,i,n)}))}var bh;(function(e){e[e.Occluded=0]="Occluded",e[e.NotOccluded=1]="NotOccluded",e[e.Both=2]="Both",e[e.COUNT=3]="COUNT"})(bh||(bh={}));var Jl;function j7e(e,t){e.include(Xse),e.attributes.add(O.POSITION,"vec3"),e.attributes.add(O.NORMAL,"vec3"),e.attributes.add(O.AUXPOS1,"vec4");const r=e.vertex;_u(e,t),_m(r,t),r.uniforms.add([new cr("viewport",(i,n)=>n.camera.fullViewport),new He("polygonOffset",i=>i.shaderPolygonOffset),new He("cameraGroundRelative",(i,n)=>n.camera.aboveGround?1:-1),new He("renderTransparentlyOccludedHUD",(i,n)=>n.renderTransparentlyOccludedHUD===bh.Occluded?1:n.renderTransparentlyOccludedHUD===bh.NotOccluded?0:.75),new Wt("hudVisibilityTexture",(i,n)=>n.hudVisibilityTexture)]),t.hasVerticalOffset&&G7e(r),r.constants.add("smallOffsetAngle","float",.984807753012208),r.code.add(S`struct ProjectHUDAux {
vec3 posModel;
vec3 posView;
vec3 vnormal;
float distanceToCamera;
float absCosAngle;
};`),r.code.add(S`float applyHUDViewDependentPolygonOffset(float pointGroundDistance, float absCosAngle, inout vec3 posView) {
float pointGroundSign = sign(pointGroundDistance);
if (pointGroundSign == 0.0) {
pointGroundSign = cameraGroundRelative;
}
float groundRelative = cameraGroundRelative * pointGroundSign;
if (polygonOffset > .0) {
float cosAlpha = clamp(absCosAngle, 0.01, 1.0);
float tanAlpha = sqrt(1.0 - cosAlpha * cosAlpha) / cosAlpha;
float factor = (1.0 - tanAlpha / viewport[2]);
if (groundRelative > 0.0) {
posView *= factor;
}
else {
posView /= factor;
}
}
return groundRelative;
}`),t.isDraped&&!t.hasVerticalOffset||r.uniforms.add(new Ei("viewNormal",(i,n)=>n.camera.viewInverseTransposeMatrix)),t.isDraped||(r.uniforms.add(new He("perDistancePixelRatio",(i,n)=>Math.tan(n.camera.fovY/2)/(n.camera.fullViewport[2]/2))),r.code.add(S`void applyHUDVerticalGroundOffset(vec3 normalModel, inout vec3 posModel, inout vec3 posView) {
float distanceToCamera = length(posView);
float pixelOffset = distanceToCamera * perDistancePixelRatio * 0.5;
vec3 modelOffset = normalModel * cameraGroundRelative * pixelOffset;
vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;
posModel += modelOffset;
posView += viewOffset;
}`)),t.screenCenterOffsetUnitsEnabled===Jl.Screen&&r.uniforms.add(new He("pixelRatio",(i,n)=>n.camera.pixelRatio)),t.hasScreenSizePerspective&&Xz(r),r.code.add(S`
    vec4 projectPositionHUD(out ProjectHUDAux aux) {
      // centerOffset is in view space and is used to implement world size offsetting
      // of labels with respect to objects. It also pulls the label towards the viewer
      // so that the label is visible in front of the object.
      vec3 centerOffset = auxpos1.xyz;

      // The pointGroundDistance is the distance of the geometry to the ground and is
      // negative if the point is below the ground, or positive if the point is above
      // ground.
      float pointGroundDistance = auxpos1.w;

      aux.posModel = position;
      aux.posView = (view * vec4(aux.posModel, 1.0)).xyz;
      aux.vnormal = normal;
      ${t.isDraped?"":"applyHUDVerticalGroundOffset(aux.vnormal, aux.posModel, aux.posView);"}

      // Screen sized offset in world space, used for example for line callouts
      // Note: keep this implementation in sync with the CPU implementation, see
      //   - MaterialUtil.verticalOffsetAtDistance
      //   - HUDMaterial.applyVerticalOffsetTransformation

      aux.distanceToCamera = length(aux.posView);

      vec3 viewDirObjSpace = normalize(cameraPosition - aux.posModel);
      float cosAngle = dot(aux.vnormal, viewDirObjSpace);

      aux.absCosAngle = abs(cosAngle);

      ${t.hasScreenSizePerspective&&(t.hasVerticalOffset||t.screenCenterOffsetUnitsEnabled===Jl.Screen)?"vec4 perspectiveFactor = screenSizePerspectiveScaleFactor(aux.absCosAngle, aux.distanceToCamera, screenSizePerspectiveAlignment);":""}

      ${t.hasVerticalOffset?t.hasScreenSizePerspective?"float verticalOffsetScreenHeight = applyScreenSizePerspectiveScaleFactorFloat(verticalOffset.x, perspectiveFactor);":"float verticalOffsetScreenHeight = verticalOffset.x;":""}

      ${t.hasVerticalOffset?S`
            float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * aux.distanceToCamera, verticalOffset.z, verticalOffset.w);
            vec3 modelOffset = aux.vnormal * worldOffset;
            aux.posModel += modelOffset;
            vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;
            aux.posView += viewOffset;
            // Since we elevate the object, we need to take that into account
            // in the distance to ground
            pointGroundDistance += worldOffset;`:""}

      float groundRelative = applyHUDViewDependentPolygonOffset(pointGroundDistance, aux.absCosAngle, aux.posView);

      ${t.screenCenterOffsetUnitsEnabled!==Jl.Screen?S`
            // Apply x/y in view space, but z in screen space (i.e. along posView direction)
            aux.posView += vec3(centerOffset.x, centerOffset.y, 0.0);

            // Same material all have same z != 0.0 condition so should not lead to
            // branch fragmentation and will save a normalization if it's not needed
            if (centerOffset.z != 0.0) {
              aux.posView -= normalize(aux.posView) * centerOffset.z;
            }
          `:""}

      vec4 posProj = proj * vec4(aux.posView, 1.0);

      ${t.screenCenterOffsetUnitsEnabled===Jl.Screen?t.hasScreenSizePerspective?"float centerOffsetY = applyScreenSizePerspectiveScaleFactorFloat(centerOffset.y, perspectiveFactor);":"float centerOffsetY = centerOffset.y;":""}

      ${t.screenCenterOffsetUnitsEnabled===Jl.Screen?"posProj.xy += vec2(centerOffset.x, centerOffsetY) * pixelRatio * 2.0 / viewport.zw * posProj.w;":""}

      // constant part of polygon offset emulation
      posProj.z -= groundRelative * polygonOffset * posProj.w;
      return posProj;
    }
  `),r.code.add(S`bool testVisibilityHUD(vec4 posProj) {
vec4 posProjCenter = alignToPixelCenter(posProj, viewport.zw);
vec4 occlusionPixel = texture2D(hudVisibilityTexture, .5 + .5 * posProjCenter.xy / posProjCenter.w);
if (renderTransparentlyOccludedHUD > 0.5) {
return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g * renderTransparentlyOccludedHUD < 1.0;
}
return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g == 1.0;
}`)}(function(e){e[e.World=0]="World",e[e.Screen=1]="Screen",e[e.COUNT=2]="COUNT"})(Jl||(Jl={}));const QP=is();function Yz(e,t,r,i,n,s,a){if(!xO(t))if(e.boundingInfo){pt(e.primitiveType===lc.Triangle);const o=r.tolerance;q7e(e.boundingInfo,i,n,o,s,a)}else{const o=e.indices.get(O.POSITION),l=e.vertexAttributes.get(O.POSITION);EO(i,n,0,o.length/3,o,l,void 0,s,a)}}const w0t=M();function q7e(e,t,r,i,n,s){if(R(e))return;const a=W7e(t,r,w0t);if(Pxe(QP,e.getBBMin()),Ixe(QP,e.getBBMax()),_(n)&&n.applyToAabb(QP),Zse(QP,t,a,i)){const{primitiveIndices:o,indices:l,position:c}=e,u=o?o.length:l.length/3;if(u>C0t){const h=e.getChildren();if(h!==void 0){for(let p=0;p<8;++p)h[p]!==void 0&&q7e(h[p],t,r,i,n,s);return}}EO(t,r,0,u,l,c,o,n,s)}}const H7e=M();function EO(e,t,r,i,n,s,a,o,l){if(a)return x0t(e,t,r,i,n,s,a,o,l);const c=s.data,u=s.stride||s.size,h=e[0],p=e[1],m=e[2],g=t[0]-h,b=t[1]-p,w=t[2]-m;for(let v=r,x=3*r;v<i;++v){let T=u*n[x++],E=c[T++],C=c[T++],A=c[T];T=u*n[x++];let P=c[T++],I=c[T++],L=c[T];T=u*n[x++];let V=c[T++],G=c[T++],B=c[T];_(o)&&([E,C,A]=o.applyToVertex(E,C,A,v),[P,I,L]=o.applyToVertex(P,I,L,v),[V,G,B]=o.applyToVertex(V,G,B,v));const X=P-E,Y=I-C,ce=L-A,se=V-E,D=G-C,F=B-A,U=b*F-D*w,j=w*se-F*g,W=g*D-se*b,Z=X*U+Y*j+ce*W;if(Math.abs(Z)<=Number.EPSILON)continue;const q=h-E,ee=p-C,me=m-A,_e=q*U+ee*j+me*W;if(Z>0){if(_e<0||_e>Z)continue}else if(_e>0||_e<Z)continue;const De=ee*ce-Y*me,be=me*X-ce*q,ye=q*Y-X*ee,Ce=g*De+b*be+w*ye;if(Z>0){if(Ce<0||_e+Ce>Z)continue}else if(Ce>0||_e+Ce<Z)continue;const Ne=(se*De+D*be+F*ye)/Z;Ne>=0&&l(Ne,Yse(X,Y,ce,se,D,F,H7e),v,!1)}}function x0t(e,t,r,i,n,s,a,o,l){const c=s.data,u=s.stride||s.size,h=e[0],p=e[1],m=e[2],g=t[0]-h,b=t[1]-p,w=t[2]-m;for(let v=r;v<i;++v){const x=a[v];let T=3*x,E=u*n[T++],C=c[E++],A=c[E++],P=c[E];E=u*n[T++];let I=c[E++],L=c[E++],V=c[E];E=u*n[T];let G=c[E++],B=c[E++],X=c[E];_(o)&&([C,A,P]=o.applyToVertex(C,A,P,v),[I,L,V]=o.applyToVertex(I,L,V,v),[G,B,X]=o.applyToVertex(G,B,X,v));const Y=I-C,ce=L-A,se=V-P,D=G-C,F=B-A,U=X-P,j=b*U-F*w,W=w*D-U*g,Z=g*F-D*b,q=Y*j+ce*W+se*Z;if(Math.abs(q)<=Number.EPSILON)continue;const ee=h-C,me=p-A,_e=m-P,De=ee*j+me*W+_e*Z;if(q>0){if(De<0||De>q)continue}else if(De>0||De<q)continue;const be=me*se-ce*_e,ye=_e*Y-se*ee,Ce=ee*ce-Y*me,Ne=g*be+b*ye+w*Ce;if(q>0){if(Ne<0||De+Ne>q)continue}else if(Ne>0||De+Ne<q)continue;const Fr=(D*be+F*ye+U*Ce)/q;Fr>=0&&l(Fr,Yse(Y,ce,se,D,F,U,H7e),x,!1)}}const k0e=M(),V0e=M();function Yse(e,t,r,i,n,s,a){return ne(k0e,e,t,r),ne(V0e,i,n,s),dt(a,k0e,V0e),we(a,a),a}function W7e(e,t,r){return ne(r,1/(t[0]-e[0]),1/(t[1]-e[1]),1/(t[2]-e[2]))}function Zse(e,t,r,i){return Qse(e,t,r,i,1/0)}function Qse(e,t,r,i,n){const s=(e[0]-i-t[0])*r[0],a=(e[3]+i-t[0])*r[0];let o=Math.min(s,a),l=Math.max(s,a);const c=(e[1]-i-t[1])*r[1],u=(e[4]+i-t[1])*r[1];if(l=Math.min(l,Math.max(c,u)),l<0||(o=Math.max(o,Math.min(c,u)),o>l))return!1;const h=(e[2]-i-t[2])*r[2],p=(e[5]+i-t[2])*r[2];return l=Math.min(l,Math.max(h,p)),!(l<0)&&(o=Math.max(o,Math.min(h,p)),!(o>l)&&o<n)}function X7e(e,t,r,i,n){let s=(r.screenLength||0)*e.pixelRatio;_(n)&&(s=f0t(s,i,t,n));const a=s*Math.tan(.5*e.fovY)/(.5*e.fullHeight);return Le(a*t,r.minWorldLength||0,r.maxWorldLength!=null?r.maxWorldLength:1/0)}function Y7e(e,t){const r=t?Y7e(t):{};for(const i in e){let n=e[i];n&&n.forEach&&(n=E0t(n)),n==null&&i in r||(r[i]=n)}return r}function T0t(e,t){let r=!1;for(const i in t){const n=t[i];n!==void 0&&(Array.isArray(n)?e[i]===null?(e[i]=n.slice(),r=!0):vte(e[i],n)&&(r=!0):e[i]!==n&&(r=!0,e[i]=n))}return r}function S0t(e,t,r,i,n,s){if(!t.options.selectionMode)return;const a=e.vertexAttributes.get(O.POSITION).data,o=e.vertexAttributes.get(O.SIZE),l=o&&o.data[0],c=i[0],u=i[1],h=((l+n)/2+4)*e.screenToWorldRatio;let p=Number.MAX_VALUE,m=0;for(let g=0;g<a.length-5;g+=3){const b=a[g],w=a[g+1],v=c-b,x=u-w,T=a[g+3]-b,E=a[g+4]-w,C=Le((T*v+E*x)/(T*T+E*E),0,1),A=T*C-v,P=E*C-x,I=A*A+P*P;I<p&&(p=I,m=g/3)}p<h*h&&s(r.dist,r.normal,m,!1)}function E0t(e){const t=[];return e.forEach(r=>t.push(r)),t}const Z7e={multiply:1,ignore:2,replace:3,tint:4},C0t=1e3;class Dm extends wO{constructor(t,r){super(),this.type=Np.Material,this.supportsEdges=!1,this._visible=!0,this._renderPriority=0,this._insertOrder=0,this._vertexAttributeLocations=Ur,this._parameters=Y7e(t,r),this.validateParameters(this._parameters)}dispose(){}get parameters(){return this._parameters}update(t){return!1}setParameters(t,r=!0){T0t(this._parameters,t)&&(this.validateParameters(this._parameters),r&&this.parametersChanged())}validateParameters(t){}get visible(){return this._visible}set visible(t){t!==this._visible&&(this._visible=t,this.parametersChanged())}shouldRender(t){return this.isVisible()&&this.isVisibleInPass(t.pass)&&(this.renderOccluded&t.renderOccludedMask)!=0}isVisibleInPass(t){return!0}get renderOccluded(){return this.parameters.renderOccluded}get renderPriority(){return this._renderPriority}set renderPriority(t){t!==this._renderPriority&&(this._renderPriority=t,this.parametersChanged())}get insertOrder(){return this._insertOrder}set insertOrder(t){t!==this._insertOrder&&(this._insertOrder=t,this.parametersChanged())}get vertexAttributeLocations(){return this._vertexAttributeLocations}isVisible(){return this._visible}parametersChanged(){_(this.repository)&&this.repository.materialChanged(this)}}var ki;(function(e){e[e.Occlude=1]="Occlude",e[e.Transparent=2]="Transparent",e[e.OccludeAndTransparent=4]="OccludeAndTransparent",e[e.OccludeAndTransparentStencil=8]="OccludeAndTransparentStencil",e[e.Opaque=16]="Opaque"})(ki||(ki={}));class S6 extends as{constructor(){super(...arguments),this.renderOccluded=ki.Occlude}}function TLt(e,t,r,i,n=1){const s=r.typedBuffer,a=r.typedBufferStride,o=e.length;if(i*=a,n===1)for(let l=0;l<o;++l)s[i]=t[e[l]],i+=a;else for(let l=0;l<o;++l){const c=t[e[l]];for(let u=0;u<n;u++)s[i]=c,i+=a}}function A0t(e,t,r,i){const n=r.typedBuffer,s=r.typedBufferStride,a=e.length;i*=s;for(let o=0;o<a;++o){const l=2*e[o];n[i]=t[l],n[i+1]=t[l+1],i+=s}}function Q7e(e,t,r,i,n){const s=r.typedBuffer,a=r.typedBufferStride,o=e.length;if(i*=a,n==null||n===1)for(let l=0;l<o;++l){const c=3*e[l];s[i]=t[c],s[i+1]=t[c+1],s[i+2]=t[c+2],i+=a}else for(let l=0;l<o;++l){const c=3*e[l];for(let u=0;u<n;++u)s[i]=t[c],s[i+1]=t[c+1],s[i+2]=t[c+2],i+=a}}function R9(e,t,r,i,n=1){const s=r.typedBuffer,a=r.typedBufferStride,o=e.length;if(i*=a,n===1)for(let l=0;l<o;++l){const c=4*e[l];s[i]=t[c],s[i+1]=t[c+1],s[i+2]=t[c+2],s[i+3]=t[c+3],i+=a}else for(let l=0;l<o;++l){const c=4*e[l];for(let u=0;u<n;++u)s[i]=t[c],s[i+1]=t[c+1],s[i+2]=t[c+2],s[i+3]=t[c+3],i+=a}}function Zz(e,t,r,i,n,s=1){if(!r)return void Q7e(e,t,i,n,s);const a=i.typedBuffer,o=i.typedBufferStride,l=e.length,c=r[0],u=r[1],h=r[2],p=r[4],m=r[5],g=r[6],b=r[8],w=r[9],v=r[10],x=r[12],T=r[13],E=r[14];if(n*=o,s===1)for(let C=0;C<l;++C){const A=3*e[C],P=t[A],I=t[A+1],L=t[A+2];a[n]=c*P+p*I+b*L+x,a[n+1]=u*P+m*I+w*L+T,a[n+2]=h*P+g*I+v*L+E,n+=o}else for(let C=0;C<l;++C){const A=3*e[C],P=t[A],I=t[A+1],L=t[A+2],V=c*P+p*I+b*L+x,G=u*P+m*I+w*L+T,B=h*P+g*I+v*L+E;for(let X=0;X<s;++X)a[n]=V,a[n+1]=G,a[n+2]=B,n+=o}}function Jse(e,t,r,i,n,s=1){if(!r)return void Q7e(e,t,i,n,s);const a=r,o=i.typedBuffer,l=i.typedBufferStride,c=e.length,u=a[0],h=a[1],p=a[2],m=a[4],g=a[5],b=a[6],w=a[8],v=a[9],x=a[10],T=!Hre(a),E=1e-6,C=1-E;if(n*=l,s===1)for(let A=0;A<c;++A){const P=3*e[A],I=t[P],L=t[P+1],V=t[P+2];let G=u*I+m*L+w*V,B=h*I+g*L+v*V,X=p*I+b*L+x*V;if(T){const Y=G*G+B*B+X*X;if(Y<C&&Y>E){const ce=1/Math.sqrt(Y);G*=ce,B*=ce,X*=ce}}o[n+0]=G,o[n+1]=B,o[n+2]=X,n+=l}else for(let A=0;A<c;++A){const P=3*e[A],I=t[P],L=t[P+1],V=t[P+2];let G=u*I+m*L+w*V,B=h*I+g*L+v*V,X=p*I+b*L+x*V;if(T){const Y=G*G+B*B+X*X;if(Y<C&&Y>E){const ce=1/Math.sqrt(Y);G*=ce,B*=ce,X*=ce}}for(let Y=0;Y<s;++Y)o[n+0]=G,o[n+1]=B,o[n+2]=X,n+=l}}function R0t(e,t,r,i,n,s=1){if(!r)return void R9(e,t,i,n,s);const a=r,o=i.typedBuffer,l=i.typedBufferStride,c=e.length,u=a[0],h=a[1],p=a[2],m=a[4],g=a[5],b=a[6],w=a[8],v=a[9],x=a[10],T=!Hre(a),E=1e-6,C=1-E;if(n*=l,s===1)for(let A=0;A<c;++A){const P=4*e[A],I=t[P],L=t[P+1],V=t[P+2],G=t[P+3];let B=u*I+m*L+w*V,X=h*I+g*L+v*V,Y=p*I+b*L+x*V;if(T){const ce=B*B+X*X+Y*Y;if(ce<C&&ce>E){const se=1/Math.sqrt(ce);B*=se,X*=se,Y*=se}}o[n+0]=B,o[n+1]=X,o[n+2]=Y,o[n+3]=G,n+=l}else for(let A=0;A<c;++A){const P=4*e[A],I=t[P],L=t[P+1],V=t[P+2],G=t[P+3];let B=u*I+m*L+w*V,X=h*I+g*L+v*V,Y=p*I+b*L+x*V;if(T){const ce=B*B+X*X+Y*Y;if(ce<C&&ce>E){const se=1/Math.sqrt(ce);B*=se,X*=se,Y*=se}}for(let ce=0;ce<s;++ce)o[n+0]=B,o[n+1]=X,o[n+2]=Y,o[n+3]=G,n+=l}}function nk(e,t,r,i,n,s=1){const a=i.typedBuffer,o=i.typedBufferStride,l=e.length;if(n*=o,s===1){if(r===4)for(let c=0;c<l;++c){const u=4*e[c];a[n]=t[u],a[n+1]=t[u+1],a[n+2]=t[u+2],a[n+3]=t[u+3],n+=o}else if(r===3)for(let c=0;c<l;++c){const u=3*e[c];a[n]=t[u],a[n+1]=t[u+1],a[n+2]=t[u+2],a[n+3]=255,n+=o}}else if(r===4)for(let c=0;c<l;++c){const u=4*e[c];for(let h=0;h<s;++h)a[n]=t[u],a[n+1]=t[u+1],a[n+2]=t[u+2],a[n+3]=t[u+3],n+=o}else if(r===3)for(let c=0;c<l;++c){const u=3*e[c];for(let h=0;h<s;++h)a[n]=t[u],a[n+1]=t[u+1],a[n+2]=t[u+2],a[n+3]=255,n+=o}}function Qz(e,t,r,i,n,s){for(const a of t.fieldNames){const o=e.vertexAttributes.get(a),l=e.indices.get(a);if(o&&l)switch(a){case O.POSITION:{pt(o.size===3);const c=n.getField(a,Zr);c&&Zz(l,o.data,r,c,s);break}case O.NORMAL:{pt(o.size===3);const c=n.getField(a,Zr);c&&Jse(l,o.data,i,c,s);break}case O.UV0:{pt(o.size===2);const c=n.getField(a,ef);c&&A0t(l,o.data,c,s);break}case O.COLOR:{pt(o.size===3||o.size===4);const c=n.getField(a,pc);c&&nk(l,o.data,o.size,c,s);break}case O.SYMBOLCOLOR:{pt(o.size===3||o.size===4);const c=n.getField(a,pc);c&&nk(l,o.data,o.size,c,s);break}case O.TANGENT:{pt(o.size===4);const c=n.getField(a,ca);c&&R0t(l,o.data,i,c,s);break}}}}function oR(e,t,r=0){const i=Le(e,0,P0t);for(let n=0;n<4;n++)t[r+n]=Math.floor(256*I0t(i*O0t[n]))}function Kse(e,t=0){let r=0;for(let i=0;i<4;i++)r+=e[t+i]*M0t[i];return r}const O0t=[1,256,65536,16777216],M0t=[1/256,1/65536,1/16777216,1/4294967296],P0t=Kse(new Uint8ClampedArray([255,255,255,255]));function I0t(e){return e-Math.floor(e)}function $0t(){if(R(tq)){const e=t=>xr(`esri/libs/basisu/${t}`);tq=ie(()=>import("./basis_transcoder.13a5b8c6.js"),["basis_transcoder.13a5b8c6.js","_commonjsHelpers.ce2b5698.js"],import.meta.url).then(t=>t.b).then(({default:t})=>t({locateFile:e}).then(r=>(r.initializeBasis(),delete r.then,r)))}return tq}let tq;var O3;(function(e){e[e.ETC1_RGB=0]="ETC1_RGB",e[e.ETC2_RGBA=1]="ETC2_RGBA",e[e.BC1_RGB=2]="BC1_RGB",e[e.BC3_RGBA=3]="BC3_RGBA",e[e.BC4_R=4]="BC4_R",e[e.BC5_RG=5]="BC5_RG",e[e.BC7_M6_RGB=6]="BC7_M6_RGB",e[e.BC7_M5_RGBA=7]="BC7_M5_RGBA",e[e.PVRTC1_4_RGB=8]="PVRTC1_4_RGB",e[e.PVRTC1_4_RGBA=9]="PVRTC1_4_RGBA",e[e.ASTC_4x4_RGBA=10]="ASTC_4x4_RGBA",e[e.ATC_RGB=11]="ATC_RGB",e[e.ATC_RGBA=12]="ATC_RGBA",e[e.FXT1_RGB=17]="FXT1_RGB",e[e.PVRTC2_4_RGB=18]="PVRTC2_4_RGB",e[e.PVRTC2_4_RGBA=19]="PVRTC2_4_RGBA",e[e.ETC2_EAC_R11=20]="ETC2_EAC_R11",e[e.ETC2_EAC_RG11=21]="ETC2_EAC_RG11",e[e.RGBA32=13]="RGBA32",e[e.RGB565=14]="RGB565",e[e.BGR565=15]="BGR565",e[e.RGBA4444=16]="RGBA4444"})(O3||(O3={}));let Ep=null,JP=null;async function J7e(){return R(JP)&&(JP=$0t(),Ep=await JP),JP}function L0t(e,t){if(R(Ep))return e.byteLength;const r=new Ep.BasisFile(new Uint8Array(e)),i=eAe(r)?K7e(r.getNumLevels(0),r.getHasAlpha(),r.getImageWidth(0,0),r.getImageHeight(0,0),t):0;return r.close(),r.delete(),i}function D0t(e,t){if(R(Ep))return e.byteLength;const r=new Ep.KTX2File(new Uint8Array(e)),i=tAe(r)?K7e(r.getLevels(),r.getHasAlpha(),r.getWidth(),r.getHeight(),t):0;return r.close(),r.delete(),i}function K7e(e,t,r,i,n){const s=kEe(t?cn.COMPRESSED_RGBA8_ETC2_EAC:cn.COMPRESSED_RGB8_ETC2),a=n&&e>1?(4**e-1)/(3*4**(e-1)):1;return Math.ceil(r*i*s*a)}function eAe(e){return e.getNumImages()>=1&&!e.isUASTC()}function tAe(e){return e.getFaces()>=1&&e.isETC1S()}async function F0t(e,t,r){R(Ep)&&(Ep=await J7e());const i=new Ep.BasisFile(new Uint8Array(r));if(!eAe(i))return null;i.startTranscoding();const n=rAe(e,t,i.getNumLevels(0),i.getHasAlpha(),i.getImageWidth(0,0),i.getImageHeight(0,0),(s,a)=>i.getImageTranscodedSizeInBytes(0,s,a),(s,a,o)=>i.transcodeImage(o,0,s,a,0,0));return i.close(),i.delete(),n}async function N0t(e,t,r){R(Ep)&&(Ep=await J7e());const i=new Ep.KTX2File(new Uint8Array(r));if(!tAe(i))return null;i.startTranscoding();const n=rAe(e,t,i.getLevels(),i.getHasAlpha(),i.getWidth(),i.getHeight(),(s,a)=>i.getImageTranscodedSizeInBytes(s,0,0,a),(s,a,o)=>i.transcodeImage(o,s,0,0,a,0,-1,-1));return i.close(),i.delete(),n}function rAe(e,t,r,i,n,s,a,o){const{compressedTextureETC:l,compressedTextureS3TC:c}=e.capabilities,[u,h]=l?i?[O3.ETC2_RGBA,cn.COMPRESSED_RGBA8_ETC2_EAC]:[O3.ETC1_RGB,cn.COMPRESSED_RGB8_ETC2]:c?i?[O3.BC3_RGBA,cn.COMPRESSED_RGBA_S3TC_DXT5_EXT]:[O3.BC1_RGB,cn.COMPRESSED_RGB_S3TC_DXT1_EXT]:[O3.RGBA32,Ue.RGBA],p=t.hasMipmap?r:Math.min(1,r),m=[];for(let v=0;v<p;v++)m.push(new Uint8Array(a(v,u))),o(v,u,m[v]);const g=m.length>1,b=g?tt.LINEAR_MIPMAP_LINEAR:tt.LINEAR,w={...t,samplingMode:b,hasMipmap:g,internalFormat:h,width:n,height:s};return new at(e,w,{type:"compressed",levels:m})}const m8=fe.getLogger("esri.views.3d.webgl-engine.lib.DDSUtil"),k0t=542327876,V0t=131072,z0t=4;function eae(e){return e.charCodeAt(0)+(e.charCodeAt(1)<<8)+(e.charCodeAt(2)<<16)+(e.charCodeAt(3)<<24)}function U0t(e){return String.fromCharCode(255&e,e>>8&255,e>>16&255,e>>24&255)}const B0t=eae("DXT1"),G0t=eae("DXT3"),j0t=eae("DXT5"),q0t=31,H0t=0,W0t=1,X0t=2,Y0t=3,Z0t=4,Q0t=7,J0t=20,K0t=21;function emt(e,t,r){const{textureData:i,internalFormat:n,width:s,height:a}=tmt(r,t.hasMipmap);return t.samplingMode=i.levels.length>1?tt.LINEAR_MIPMAP_LINEAR:tt.LINEAR,t.hasMipmap=i.levels.length>1,t.internalFormat=n,t.width=s,t.height=a,new at(e,t,i)}function tmt(e,t){const r=new Int32Array(e,0,q0t);if(r[H0t]!==k0t)return m8.error("Invalid magic number in DDS header"),null;if(!(r[J0t]&z0t))return m8.error("Unsupported format, must contain a FourCC code"),null;const i=r[K0t];let n,s;switch(i){case B0t:n=8,s=cn.COMPRESSED_RGB_S3TC_DXT1_EXT;break;case G0t:n=16,s=cn.COMPRESSED_RGBA_S3TC_DXT3_EXT;break;case j0t:n=16,s=cn.COMPRESSED_RGBA_S3TC_DXT5_EXT;break;default:return m8.error("Unsupported FourCC code:",U0t(i)),null}let a=1,o=r[Z0t],l=r[Y0t];(3&o)==0&&(3&l)==0||(m8.warn("Rounding up compressed texture size to nearest multiple of 4."),o=o+3&-4,l=l+3&-4);const c=o,u=l;let h,p;r[X0t]&V0t&&t!==!1&&(a=Math.max(1,r[Q0t])),a===1||L5(o)&&L5(l)||(m8.warn("Ignoring mipmaps of non power of two sized compressed texture."),a=1);let m=r[W0t]+4;const g=[];for(let b=0;b<a;++b)p=(o+3>>2)*(l+3>>2)*n,h=new Uint8Array(e,m,p),g.push(h),m+=p,o=Math.max(1,o>>1),l=Math.max(1,l>>1);return{textureData:{type:"compressed",levels:g},internalFormat:s,width:c,height:u}}class Hn extends wO{constructor(t,r){super(),this.data=t,this.type=Np.Texture,this._glTexture=null,this._powerOfTwoStretchInfo=null,this._loadingPromise=null,this._loadingController=null,this.events=new mn,this.params=r||{},this.params.mipmap=this.params.mipmap!==!1,this.params.noUnpackFlip=this.params.noUnpackFlip||!1,this.params.preMultiplyAlpha=this.params.preMultiplyAlpha||!1,this.params.wrap=this.params.wrap||{s:xt.REPEAT,t:xt.REPEAT},this.params.powerOfTwoResizeMode=this.params.powerOfTwoResizeMode||Dv.STRETCH,this.estimatedTexMemRequired=Hn._estimateTexMemRequired(this.data,this.params),this._startPreload()}_startPreload(){const t=this.data;R(t)||(t instanceof HTMLVideoElement?this._startPreloadVideoElement(t):t instanceof HTMLImageElement&&this._startPreloadImageElement(t))}_startPreloadVideoElement(t){if(!(qv(t.src)||t.preload==="auto"&&t.crossOrigin)){t.preload="auto",t.crossOrigin="anonymous";const r=!t.paused;if(t.src=t.src,r&&t.autoplay){const i=()=>{t.removeEventListener("canplay",i),t.play()};t.addEventListener("canplay",i)}}}_startPreloadImageElement(t){Tm(t.src)||qv(t.src)||t.crossOrigin||(t.crossOrigin="anonymous",t.src=t.src)}static _getDataDimensions(t){return t instanceof HTMLVideoElement?{width:t.videoWidth,height:t.videoHeight}:t}static _estimateTexMemRequired(t,r){if(R(t))return 0;if(D6(t)||f3(t))return r.encoding===Hn.KTX2_ENCODING?D0t(t,r.mipmap):r.encoding===Hn.BASIS_ENCODING?L0t(t,r.mipmap):t.byteLength;const{width:i,height:n}=t instanceof Image||t instanceof ImageData||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement?Hn._getDataDimensions(t):r;return(r.mipmap?4/3:1)*i*n*(r.components||4)||0}dispose(){this.data=void 0}get width(){return this.params.width}get height(){return this.params.height}_createDescriptor(t){var r;return{target:mt.TEXTURE_2D,pixelFormat:Ue.RGBA,dataType:At.UNSIGNED_BYTE,wrapMode:this.params.wrap,flipped:!this.params.noUnpackFlip,samplingMode:this.params.mipmap?tt.LINEAR_MIPMAP_LINEAR:tt.LINEAR,hasMipmap:this.params.mipmap,preMultiplyAlpha:this.params.preMultiplyAlpha,maxAnisotropy:(r=this.params.maxAnisotropy)!=null?r:this.params.mipmap?t.parameters.maxMaxAnisotropy:1}}get glTexture(){return this._glTexture}load(t,r){if(_(this._glTexture))return this._glTexture;if(_(this._loadingPromise))return this._loadingPromise;const i=this.data;return R(i)?(this._glTexture=new at(t,this._createDescriptor(t),null),this._glTexture):typeof i=="string"?this._loadFromURL(t,r,i):i instanceof Image?this._loadFromImageElement(t,r,i):i instanceof HTMLVideoElement?this._loadFromVideoElement(t,r,i):i instanceof ImageData||i instanceof HTMLCanvasElement?this._loadFromImage(t,i,r):(D6(i)||f3(i))&&this.params.encoding===Hn.DDS_ENCODING?(this.data=void 0,this._loadFromDDSData(t,i)):(D6(i)||f3(i))&&this.params.encoding===Hn.KTX2_ENCODING?(this.data=void 0,this._loadFromKTX2(t,i)):(D6(i)||f3(i))&&this.params.encoding===Hn.BASIS_ENCODING?(this.data=void 0,this._loadFromBasis(t,i)):f3(i)?this._loadFromPixelData(t,i):D6(i)?this._loadFromPixelData(t,new Uint8Array(i)):null}get requiresFrameUpdates(){return this.data instanceof HTMLVideoElement}frameUpdate(t,r,i){if(!(this.data instanceof HTMLVideoElement)||R(this._glTexture)||this.data.readyState<m7.HAVE_CURRENT_DATA||i===this.data.currentTime)return i;if(_(this._powerOfTwoStretchInfo)){const{framebuffer:n,vao:s,sourceTexture:a}=this._powerOfTwoStretchInfo;a.setData(this.data),this._drawStretchedTexture(t,r,n,s,a,this._glTexture)}else{const{videoWidth:n,videoHeight:s}=this.data,{width:a,height:o}=this._glTexture.descriptor;n!==a||s!==o?this._glTexture.updateData(0,0,0,Math.min(n,a),Math.min(s,o),this.data):this._glTexture.setData(this.data)}return this._glTexture.descriptor.hasMipmap&&this._glTexture.generateMipmap(),this.params.updateCallback&&this.params.updateCallback(),this.data.currentTime}_loadFromDDSData(t,r){return this._glTexture=emt(t,this._createDescriptor(t),r),this._glTexture}_loadFromKTX2(t,r){return this._loadAsync(()=>N0t(t,this._createDescriptor(t),r).then(i=>(this._glTexture=i,i)))}_loadFromBasis(t,r){return this._loadAsync(()=>F0t(t,this._createDescriptor(t),r).then(i=>(this._glTexture=i,i)))}_loadFromPixelData(t,r){pt(this.params.width>0&&this.params.height>0);const i=this._createDescriptor(t);return i.pixelFormat=this.params.components===1?Ue.LUMINANCE:this.params.components===3?Ue.RGB:Ue.RGBA,i.width=this.params.width,i.height=this.params.height,this._glTexture=new at(t,i,r),this._glTexture}_loadFromURL(t,r,i){return this._loadAsync(async n=>{const s=await Dp(i,{signal:n});return Et(n),this._loadFromImage(t,s,r)})}_loadFromImageElement(t,r,i){return i.complete?this._loadFromImage(t,i,r):this._loadAsync(async n=>{const s=await W3e(i,i.src,!1,n);return Et(n),this._loadFromImage(t,s,r)})}_loadFromVideoElement(t,r,i){return i.readyState>=m7.HAVE_CURRENT_DATA?this._loadFromImage(t,i,r):this._loadFromVideoElementAsync(t,r,i)}_loadFromVideoElementAsync(t,r,i){return this._loadAsync(n=>new Promise((s,a)=>{const o=()=>{i.removeEventListener("loadeddata",l),i.removeEventListener("error",c),Ts(u)},l=()=>{i.readyState>=m7.HAVE_CURRENT_DATA&&(o(),s(this._loadFromImage(t,i,r)))},c=h=>{o(),a(h||new k("Failed to load video"))};i.addEventListener("loadeddata",l),i.addEventListener("error",c);const u=Fo(n,()=>c(br()))}))}_loadFromImage(t,r,i){const n=Hn._getDataDimensions(r);this.params.width=n.width,this.params.height=n.height;const s=this._createDescriptor(t);return s.pixelFormat=this.params.components===3?Ue.RGB:Ue.RGBA,!this._requiresPowerOfTwo(t,s)||L5(n.width)&&L5(n.height)?(s.width=n.width,s.height=n.height,this._glTexture=new at(t,s,r),this._glTexture):(this._glTexture=this._makePowerOfTwoTexture(t,r,n,s,i),this._glTexture)}_loadAsync(t){const r=new AbortController;this._loadingController=r;const i=t(r.signal);this._loadingPromise=i;const n=()=>{this._loadingController===r&&(this._loadingController=null),this._loadingPromise===i&&(this._loadingPromise=null)};return i.then(n,n),i}_requiresPowerOfTwo(t,r){const i=xt.CLAMP_TO_EDGE,n=typeof r.wrapMode=="number"?r.wrapMode===i:r.wrapMode.s===i&&r.wrapMode.t===i;return!ia(t.gl)&&(r.hasMipmap||!n)}_makePowerOfTwoTexture(t,r,i,n,s){const{width:a,height:o}=i,l=$5(a),c=$5(o);let u;switch(n.width=l,n.height=c,this.params.powerOfTwoResizeMode){case Dv.PAD:n.textureCoordinateScaleFactor=[a/l,o/c],u=new at(t,n),u.updateData(0,0,0,a,o,r);break;case Dv.STRETCH:case null:case void 0:u=this._stretchToPowerOfTwo(t,r,n,s());break;default:this.params.powerOfTwoResizeMode}return n.hasMipmap&&u.generateMipmap(),u}_stretchToPowerOfTwo(t,r,i,n){const s=new at(t,i),a=new Pi(t,{colorTarget:hn.TEXTURE,depthStencilTarget:Pr.NONE},s),o=new at(t,{target:mt.TEXTURE_2D,pixelFormat:i.pixelFormat,dataType:At.UNSIGNED_BYTE,wrapMode:xt.CLAMP_TO_EDGE,samplingMode:tt.LINEAR,flipped:!!i.flipped,maxAnisotropy:8,preMultiplyAlpha:i.preMultiplyAlpha},r),l=Tl(t),c=t.getBoundFramebufferObject();return this._drawStretchedTexture(t,n,a,l,o,s),this.requiresFrameUpdates?this._powerOfTwoStretchInfo={vao:l,sourceTexture:o,framebuffer:a}:(l.dispose(!0),o.dispose(),a.detachColorTexture(),a.dispose()),t.bindFramebuffer(c),s}_drawStretchedTexture(t,r,i,n,s,a){t.bindFramebuffer(i);const o=t.getViewport();t.setViewport(0,0,a.descriptor.width,a.descriptor.height);const l=t.bindTechnique(r);l.setUniform4f("uColor",1,1,1,1),l.bindTexture("tex",s),t.bindVAO(n),t.drawArrays(Dt.TRIANGLE_STRIP,0,io(n,"geometry")),t.bindFramebuffer(null),t.setViewport(o.x,o.y,o.width,o.height)}unload(){if(_(this._powerOfTwoStretchInfo)){const{framebuffer:t,vao:r,sourceTexture:i}=this._powerOfTwoStretchInfo;r.dispose(!0),i.dispose(),t.dispose(),this._glTexture=null,this._powerOfTwoStretchInfo=null}if(_(this._glTexture)&&(this._glTexture.dispose(),this._glTexture=null),_(this._loadingController)){const t=this._loadingController;this._loadingController=null,this._loadingPromise=null,t.abort()}this.events.emit("unloaded")}}var m7;Hn.DDS_ENCODING="image/vnd-ms.dds",Hn.KTX2_ENCODING="image/ktx2",Hn.BASIS_ENCODING="image/x.basis",function(e){e[e.HAVE_NOTHING=0]="HAVE_NOTHING",e[e.HAVE_METADATA=1]="HAVE_METADATA",e[e.HAVE_CURRENT_DATA=2]="HAVE_CURRENT_DATA",e[e.HAVE_FUTURE_DATA=3]="HAVE_FUTURE_DATA",e[e.HAVE_ENOUGH_DATA=4]="HAVE_ENOUGH_DATA"}(m7||(m7={}));const lR=128,tae=.5;function iAe(e,t=lR,r=t*tae,i=0){const n=rmt(e,t,r,i);return new Hn(n,{mipmap:!1,wrap:{s:xt.CLAMP_TO_EDGE,t:xt.CLAMP_TO_EDGE},width:t,height:t,components:4,noUnpackFlip:!0})}function rmt(e,t=lR,r=t*tae,i=0){switch(e){case"circle":default:return imt(t,r);case"square":return nmt(t,r);case"cross":return amt(t,r,i);case"x":return omt(t,r,i);case"kite":return smt(t,r);case"triangle":return lmt(t,r);case"arrow":return cmt(t,r)}}function imt(e,t){const r=e/2-.5;return CO(e,aAe(r,r,t/2))}function nmt(e,t){return nAe(e,t,!1)}function smt(e,t){return nAe(e,t,!0)}function amt(e,t,r=0){return sAe(e,t,!1,r)}function omt(e,t,r=0){return sAe(e,t,!0,r)}function lmt(e,t){return CO(e,oAe(e/2,t,t/2))}function cmt(e,t){const r=t,i=t/2,n=e/2,s=.8*r,a=aAe(n,(e-t)/2-s,Math.sqrt(s*s+i*i)),o=oAe(n,r,i);return CO(e,(l,c)=>Math.max(o(l,c),-a(l,c)))}function nAe(e,t,r){return r&&(t/=Math.SQRT2),CO(e,(i,n)=>{let s=i-.5*e+.25,a=.5*e-n-.75;if(r){const o=(s+a)/Math.SQRT2;a=(a-s)/Math.SQRT2,s=o}return Math.max(Math.abs(s),Math.abs(a))-.5*t})}function sAe(e,t,r,i=0){t-=i,r&&(t*=Math.SQRT2);const n=.5*t;return CO(e,(s,a)=>{let o,l=s-.5*e,c=.5*e-a-1;if(r){const u=(l+c)/Math.SQRT2;c=(c-l)/Math.SQRT2,l=u}return l=Math.abs(l),c=Math.abs(c),o=l>c?l>n?Math.sqrt((l-n)*(l-n)+c*c):c:c>n?Math.sqrt(l*l+(c-n)*(c-n)):l,o-=i/2,o})}function aAe(e,t,r){return(i,n)=>{const s=i-e,a=n-t;return Math.sqrt(s*s+a*a)-r}}function oAe(e,t,r){const i=Math.sqrt(t*t+r*r);return(n,s)=>{const a=Math.abs(n-e)-r,o=s-e+t/2+.75,l=(t*a+r*o)/i,c=-o;return Math.max(l,c)}}function CO(e,t){const r=new Uint8Array(4*e*e);for(let i=0;i<e;i++)for(let n=0;n<e;n++){const s=n+e*i;let a=t(n,i);a=a/e+.5,oR(a,r,4*s)}return r}class SLt extends as{constructor(t){super(),this.slicePlaneLocalOrigin=t}}function dmt(e,t){lAe(e,t,[new St("slicePlaneOrigin",(r,i)=>hAe(t,r,i)),new St("slicePlaneBasis1",(r,i)=>{var n;return sk(t,r,i,(n=i.slicePlane)==null?void 0:n.basis1)}),new St("slicePlaneBasis2",(r,i)=>{var n;return sk(t,r,i,(n=i.slicePlane)==null?void 0:n.basis2)})])}function Cn(e,t){lAe(e,t,[new yl("slicePlaneOrigin",(r,i)=>hAe(t,r,i)),new yl("slicePlaneBasis1",(r,i)=>{var n;return sk(t,r,i,(n=i.slicePlane)==null?void 0:n.basis1)}),new yl("slicePlaneBasis2",(r,i)=>{var n;return sk(t,r,i,(n=i.slicePlane)==null?void 0:n.basis2)})])}function lAe(e,t,r){if(!t.hasSlicePlane){const a=S`#define rejectBySlice(_pos_) false
#define discardBySlice(_pos_) {}
#define highlightSlice(_color_, _pos_) (_color_)`;return t.hasSliceInVertexProgram&&e.vertex.code.add(a),void e.fragment.code.add(a)}e.extensions.add("GL_OES_standard_derivatives"),t.hasSliceInVertexProgram&&e.vertex.uniforms.add(r),e.fragment.uniforms.add(r);const i=S`struct SliceFactors {
float front;
float side0;
float side1;
float side2;
float side3;
};
SliceFactors calculateSliceFactors(vec3 pos) {
vec3 rel = pos - slicePlaneOrigin;
vec3 slicePlaneNormal = -cross(slicePlaneBasis1, slicePlaneBasis2);
float slicePlaneW = -dot(slicePlaneNormal, slicePlaneOrigin);
float basis1Len2 = dot(slicePlaneBasis1, slicePlaneBasis1);
float basis2Len2 = dot(slicePlaneBasis2, slicePlaneBasis2);
float basis1Dot = dot(slicePlaneBasis1, rel);
float basis2Dot = dot(slicePlaneBasis2, rel);
return SliceFactors(
dot(slicePlaneNormal, pos) + slicePlaneW,
-basis1Dot - basis1Len2,
basis1Dot - basis1Len2,
-basis2Dot - basis2Len2,
basis2Dot - basis2Len2
);
}
bool sliceByFactors(SliceFactors factors) {
return factors.front < 0.0
&& factors.side0 < 0.0
&& factors.side1 < 0.0
&& factors.side2 < 0.0
&& factors.side3 < 0.0;
}
bool sliceEnabled() {
return dot(slicePlaneBasis1, slicePlaneBasis1) != 0.0;
}
bool sliceByPlane(vec3 pos) {
return sliceEnabled() && sliceByFactors(calculateSliceFactors(pos));
}
#define rejectBySlice(_pos_) sliceByPlane(_pos_)
#define discardBySlice(_pos_) { if (sliceByPlane(_pos_)) discard; }`,n=S`vec4 applySliceHighlight(vec4 color, vec3 pos) {
SliceFactors factors = calculateSliceFactors(pos);
const float HIGHLIGHT_WIDTH = 1.0;
const vec4 HIGHLIGHT_COLOR = vec4(0.0, 0.0, 0.0, 0.3);
factors.front /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.front);
factors.side0 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side0);
factors.side1 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side1);
factors.side2 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side2);
factors.side3 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side3);
if (sliceByFactors(factors)) {
return color;
}
float highlightFactor = (1.0 - step(0.5, factors.front))
* (1.0 - step(0.5, factors.side0))
* (1.0 - step(0.5, factors.side1))
* (1.0 - step(0.5, factors.side2))
* (1.0 - step(0.5, factors.side3));
return mix(color, vec4(HIGHLIGHT_COLOR.rgb, color.a), highlightFactor * HIGHLIGHT_COLOR.a);
}`,s=t.hasSliceHighlight?S`
        ${n}
        #define highlightSlice(_color_, _pos_) (sliceEnabled() ? applySliceHighlight(_color_, _pos_) : (_color_))
      `:S`#define highlightSlice(_color_, _pos_) (_color_)`;t.hasSliceInVertexProgram&&e.vertex.code.add(i),e.fragment.code.add(i),e.fragment.code.add(s)}function cAe(e,t,r){return e.instancedDoublePrecision?ne(umt,r.camera.viewInverseTransposeMatrix[3],r.camera.viewInverseTransposeMatrix[7],r.camera.viewInverseTransposeMatrix[11]):t.slicePlaneLocalOrigin}function dAe(e,t){return _(e)?pe(ak,t.origin,e):t.origin}function uAe(e,t,r){return e.hasSliceTranslatedView?_(t)?wl(hmt,r.camera.viewMatrix,t):r.camera.viewMatrix:null}function hAe(e,t,r){if(R(r.slicePlane))return gl;const i=cAe(e,t,r),n=dAe(i,r.slicePlane),s=uAe(e,i,r);return _(s)?ze(ak,n,s):n}function sk(e,t,r,i){if(R(i)||R(r.slicePlane))return gl;const n=cAe(e,t,r),s=dAe(n,r.slicePlane),a=uAe(e,n,r);return _(a)?(he(g8,i,s),ze(ak,s,a),ze(g8,g8,a),pe(g8,g8,ak)):i}const umt=M(),ak=M(),g8=M(),hmt=Ae();function fmt(e,t){const{vertex:r,fragment:i}=e;t.hasMultipassGeometry&&r.include(uCe),t.hasMultipassTerrain&&e.varyings.add("depth","float"),r.code.add(S`
  void main(void) {
    vec4 posProjCenter;
    if (dot(position, position) > 0.0) {
      // Render single point to center of the pixel to avoid subpixel
      // filtering to affect the marker color
      ProjectHUDAux projectAux;
      vec4 posProj = projectPositionHUD(projectAux);
      posProjCenter = alignToPixelCenter(posProj, viewport.zw);

      ${t.hasMultipassGeometry?S`
        // Don't draw vertices behind geometry
        if(geometryDepthTest(.5 + .5 * posProjCenter.xy / posProjCenter.w, projectAux.posView.z)){
          posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
        }`:""}

      ${t.hasMultipassTerrain?"depth = projectAux.posView.z;":""}
      vec3 vpos = projectAux.posModel;
      if (rejectBySlice(vpos)) {
        // Project out of clip space
        posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
      }

    } else {
      // Project out of clip space
      posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
    }

    gl_Position = posProjCenter;
    gl_PointSize = 1.0;
  }
  `),t.hasMultipassTerrain&&i.include(Ou),t.hasMultipassTerrain&&i.uniforms.add([new Wt("terrainDepthTexture",(n,s)=>s.multipassTerrain.linearDepthTexture),new _r("nearFar",(n,s)=>s.camera.nearFar),new _r("inverseViewport",(n,s)=>s.inverseViewport)]),i.include(bd),i.code.add(S`
  void main() {
    gl_FragColor = vec4(1, 1, 1, 1);
    ${t.hasMultipassTerrain?S`
          vec2 uv = gl_FragCoord.xy * inverseViewport;

          //Read the rgba data from the texture linear depth
          vec4 terrainDepthData = texture2D(terrainDepthTexture, uv);

          float terrainDepth = linearDepthFromFloat(rgba2float(terrainDepthData), nearFar);

          //If HUD vertex is behind terrain and the terrain depth is not the initialize value (e.g. we are not looking at the sky)
          //Mark the HUD vertex as occluded by transparent terrain
          if(depth < terrainDepth && terrainDepthData != vec4(0,0,0,1)){
            gl_FragColor.g = 0.5;
          }`:""}
  }
  `)}const pmt=Tr(1,1,0,1),fAe=Tr(1,0,1,1);function Ky(e){e.fragment.uniforms.add(new Wt("depthTex",(t,r)=>r.highlightDepthTexture)),e.fragment.uniforms.add(new _r("highlightViewportPixelSz",(t,r)=>r.inverseViewport)),e.fragment.constants.add("occludedHighlightFlag","vec4",pmt).add("unoccludedHighlightFlag","vec4",fAe),e.fragment.code.add(S`void outputHighlight() {
vec4 fragCoord = gl_FragCoord;
float sceneDepth = texture2D(depthTex, fragCoord.xy * highlightViewportPixelSz.xy).r;
if (fragCoord.z > sceneDepth + 5e-7) {
gl_FragColor = occludedHighlightFlag;
}
else {
gl_FragColor = unoccludedHighlightFlag;
}
}`)}class Jz extends sn{constructor(t,r,i){super(t,"vec4",zr.Pass,(n,s,a)=>n.setUniform4fv(t,r(s,a)),i)}}class Oo extends sn{constructor(t,r,i){super(t,"float",zr.Pass,(n,s,a)=>n.setUniform1fv(t,r(s,a)),i)}}class AO extends sn{constructor(t,r){super(t,"mat3",zr.Pass,(i,n,s)=>i.setUniformMatrix3fv(t,r(n,s)))}}class rae extends S6{constructor(){super(...arguments),this.vvSizeEnabled=!1,this.vvSizeMinSize=Ve(1,1,1),this.vvSizeMaxSize=Ve(100,100,100),this.vvSizeOffset=Ve(0,0,0),this.vvSizeFactor=Ve(1,1,1),this.vvSizeValue=Ve(1,1,1),this.vvColorEnabled=!1,this.vvColorValues=[0,0,0,0,0,0,0,0],this.vvColorColors=[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],this.vvOpacityEnabled=!1,this.vvOpacityValues=[0,0,0,0,0,0,0,0],this.vvOpacityOpacities=[1,1,1,1,1,1,1,1],this.vvSymbolAnchor=[0,0,0],this.vvSymbolRotationMatrix=Li()}}const Cp=8;function n5(e,t){t.hasVvInstancing&&(t.vvSize||t.vvColor)&&e.attributes.add(O.INSTANCEFEATUREATTRIBUTE,"vec4");const r=e.vertex;t.vvSize?(r.uniforms.add(new St("vvSizeMinSize",i=>i.vvSizeMinSize)),r.uniforms.add(new St("vvSizeMaxSize",i=>i.vvSizeMaxSize)),r.uniforms.add(new St("vvSizeOffset",i=>i.vvSizeOffset)),r.uniforms.add(new St("vvSizeFactor",i=>i.vvSizeFactor)),r.uniforms.add(new AO("vvSymbolRotationMatrix",i=>i.vvSymbolRotationMatrix)),r.uniforms.add(new St("vvSymbolAnchor",i=>i.vvSymbolAnchor)),r.code.add(S`vec3 vvScale(vec4 _featureAttribute) {
return clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize);
}
vec4 vvTransformPosition(vec3 position, vec4 _featureAttribute) {
return vec4(vvSymbolRotationMatrix * ( vvScale(_featureAttribute) * (position + vvSymbolAnchor)), 1.0);
}`),r.code.add(S`
      const float eps = 1.192092896e-07;
      vec4 vvTransformNormal(vec3 _normal, vec4 _featureAttribute) {
        vec3 vvScale = clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize + eps, vvSizeMaxSize);
        return vec4(vvSymbolRotationMatrix * _normal / vvScale, 1.0);
      }

      ${t.hasVvInstancing?S`
      vec4 vvLocalNormal(vec3 _normal) {
        return vvTransformNormal(_normal, instanceFeatureAttribute);
      }

      vec4 localPosition() {
        return vvTransformPosition(position, instanceFeatureAttribute);
      }`:""}
    `)):r.code.add(S`vec4 localPosition() { return vec4(position, 1.0); }
vec4 vvLocalNormal(vec3 _normal) { return vec4(_normal, 1.0); }`),t.vvColor?(r.constants.add("vvColorNumber","int",Cp),t.hasVvInstancing&&r.uniforms.add([new Oo("vvColorValues",i=>i.vvColorValues,Cp),new Jz("vvColorColors",i=>i.vvColorColors,Cp)]),r.code.add(S`
      vec4 vvGetColor(vec4 featureAttribute, float values[vvColorNumber], vec4 colors[vvColorNumber]) {
        float value = featureAttribute.y;
        if (value <= values[0]) {
          return colors[0];
        }

        for (int i = 1; i < vvColorNumber; ++i) {
          if (values[i] >= value) {
            float f = (value - values[i-1]) / (values[i] - values[i-1]);
            return mix(colors[i-1], colors[i], f);
          }
        }
        return colors[vvColorNumber - 1];
      }

      ${t.hasVvInstancing?S`
      vec4 vvColor() {
        return vvGetColor(instanceFeatureAttribute, vvColorValues, vvColorColors);
      }`:""}
    `)):r.code.add(S`vec4 vvColor() { return vec4(1.0); }`)}const ok=.1,ao=.001;function mmt(e){const t=new Qr,r=e.signedDistanceFieldEnabled;if(t.include(Tse),t.include(j7e,e),t.include(Cn,e),e.output===K.Occlusion)return t.include(fmt,e),t;const{vertex:i,fragment:n}=t;t.include(Xse),n.include(bd),n.include($m),t.include(n5,e),t.varyings.add("vcolor","vec4"),t.varyings.add("vtc","vec2"),t.varyings.add("vsize","vec2"),e.binaryHighlightOcclusionEnabled&&t.varyings.add("voccluded","float"),i.uniforms.add([new cr("viewport",(c,u)=>u.camera.fullViewport),new _r("screenOffset",(c,u)=>vr(pAe,2*c.screenOffset[0]*u.camera.pixelRatio,2*c.screenOffset[1]*u.camera.pixelRatio)),new _r("anchorPosition",c=>lk(c)),new cr("materialColor",c=>c.color),new He("pixelRatio",(c,u)=>u.camera.pixelRatio)]),r&&(i.uniforms.add(new cr("outlineColor",c=>c.outlineColor)),n.uniforms.add([new cr("outlineColor",c=>z0e(c)?c.outlineColor:rm),new He("outlineSize",c=>z0e(c)?c.outlineSize:0)])),e.hasScreenSizePerspective&&(b0t(i),Xz(i)),(e.debugDrawLabelBorder||e.binaryHighlightOcclusionEnabled)&&t.varyings.add("debugBorderCoords","vec4"),t.attributes.add(O.UV0,"vec2"),t.attributes.add(O.COLOR,"vec4"),t.attributes.add(O.SIZE,"vec2"),t.attributes.add(O.AUXPOS2,"vec4"),i.code.add(S`
    void main(void) {
      ProjectHUDAux projectAux;
      vec4 posProj = projectPositionHUD(projectAux);

      if (rejectBySlice(projectAux.posModel)) {
        // Project outside of clip plane
        gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
        return;
      }
      vec2 inputSize;
      ${e.hasScreenSizePerspective?S`
      inputSize = screenSizePerspectiveScaleVec2(size, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspective);
      vec2 screenOffsetScaled = screenSizePerspectiveScaleVec2(screenOffset, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);
         `:S`
      inputSize = size;
      vec2 screenOffsetScaled = screenOffset;`}

      ${e.vvSize?"inputSize *= vvScale(auxpos2).xx;":""}

      vec2 combinedSize = inputSize * pixelRatio;
      vec4 quadOffset = vec4(0.0);

      ${e.occlusionTestEnabled||e.binaryHighlightOcclusionEnabled?"bool visible = testVisibilityHUD(posProj);":""}

      ${e.binaryHighlightOcclusionEnabled?"voccluded = visible ? 0.0 : 1.0;":""}
    `);const s=S`vec2 uv01 = floor(uv0);
vec2 uv = uv0 - uv01;
quadOffset.xy = ((uv01 - anchorPosition) * 2.0 * combinedSize + screenOffsetScaled) / viewport.zw * posProj.w;`,a=e.pixelSnappingEnabled?r?S`posProj = alignToPixelOrigin(posProj, viewport.zw) + quadOffset;`:S`posProj += quadOffset;
if (inputSize.x == size.x) {
posProj = alignToPixelOrigin(posProj, viewport.zw);
}`:S`posProj += quadOffset;`;e.vvColor&&i.uniforms.add([new Jz("vvColorColors",c=>c.vvColorColors,Cp),new Oo("vvColorValues",c=>c.vvColorValues,Cp)]),i.uniforms.add(new _r("textureCoordinateScaleFactor",c=>_(c.texture)&&_(c.texture.descriptor.textureCoordinateScaleFactor)?c.texture.descriptor.textureCoordinateScaleFactor:sSe)),i.code.add(S`
    ${e.occlusionTestEnabled?"if (visible) {":""}
    ${s}
    ${e.vvColor?"vcolor = vvGetColor(auxpos2, vvColorValues, vvColorColors) * materialColor;":"vcolor = color / 255.0 * materialColor;"}

    bool alphaDiscard = vcolor.a < ${S.float(ao)};
    ${r?`alphaDiscard = alphaDiscard && outlineColor.a < ${S.float(ao)};`:""}
    if (alphaDiscard) {
      // "early discard" if both symbol color (= fill) and outline color (if applicable) are transparent
      gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
      return;
    } else {
      ${a}
      gl_Position = posProj;
    }

    vtc = uv * textureCoordinateScaleFactor;

    ${e.debugDrawLabelBorder?"debugBorderCoords = vec4(uv01, 1.5 / combinedSize);":""}
    vsize = inputSize;
    ${e.occlusionTestEnabled?S`} else { vtc = vec2(0.0);
      ${e.debugDrawLabelBorder?"debugBorderCoords = vec4(0.5, 0.5, 1.5 / combinedSize);}":"}"}`:""}
  }
  `),n.uniforms.add(new Wt("tex",c=>c.texture));const o=e.debugDrawLabelBorder?S`(isBorder > 0.0 ? 0.0 : ${S.float(ok)})`:S.float(ok),l=S`
    ${e.debugDrawLabelBorder?S`
      float isBorder = float(any(lessThan(debugBorderCoords.xy, debugBorderCoords.zw)) || any(greaterThan(debugBorderCoords.xy, 1.0 - debugBorderCoords.zw)));`:""}

    ${r?S`
      vec4 fillPixelColor = vcolor;

      // Attempt to sample texel centers to avoid that thin cross outlines
      // disappear with large symbol sizes.
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/7058#issuecomment-603041
      const float txSize = ${S.float(lR)};
      const float texelSize = 1.0 / txSize;
      // Calculate how much we have to add/subtract to/from each texel to reach the size of an onscreen pixel
      vec2 scaleFactor = (vsize - txSize) * texelSize;
      vec2 samplePos = vtc + (vec2(1.0, -1.0) * texelSize) * scaleFactor;

      // Get distance and map it into [-0.5, 0.5]
      float d = rgba2float(texture2D(tex, samplePos)) - 0.5;

      // Distance in output units (i.e. pixels)
      float dist = d * vsize.x;

      // Create smooth transition from the icon into its outline
      float fillAlphaFactor = clamp(0.5 - dist, 0.0, 1.0);
      fillPixelColor.a *= fillAlphaFactor;

      if (outlineSize > 0.25) {
        vec4 outlinePixelColor = outlineColor;
        float clampedOutlineSize = min(outlineSize, 0.5*vsize.x);

        // Create smooth transition around outline
        float outlineAlphaFactor = clamp(0.5 - (abs(dist) - 0.5*clampedOutlineSize), 0.0, 1.0);
        outlinePixelColor.a *= outlineAlphaFactor;

        if (
          outlineAlphaFactor + fillAlphaFactor < ${o} ||
          fillPixelColor.a + outlinePixelColor.a < ${S.float(ao)}
        ) {
          discard;
        }

        // perform un-premultiplied over operator (see https://en.wikipedia.org/wiki/Alpha_compositing#Description)
        float compositeAlpha = outlinePixelColor.a + fillPixelColor.a * (1.0 - outlinePixelColor.a);
        vec3 compositeColor = vec3(outlinePixelColor) * outlinePixelColor.a +
          vec3(fillPixelColor) * fillPixelColor.a * (1.0 - outlinePixelColor.a);

        gl_FragColor = vec4(compositeColor, compositeAlpha);
      } else {
        if (fillAlphaFactor < ${o}) {
          discard;
        }

        gl_FragColor = premultiplyAlpha(fillPixelColor);
      }

      // visualize SDF:
      // gl_FragColor = vec4(clamp(-dist/vsize.x*2.0, 0.0, 1.0), clamp(dist/vsize.x*2.0, 0.0, 1.0), 0.0, 1.0);
      `:S`
          vec4 texColor = texture2D(tex, vtc, -0.5);
          if (texColor.a < ${o}) {
            discard;
          }
          gl_FragColor = texColor * premultiplyAlpha(vcolor);
          `}

    // Draw debug border with transparency, so that original texels along border are still partially visible
    ${e.debugDrawLabelBorder?S`gl_FragColor = mix(gl_FragColor, vec4(1.0, 0.0, 1.0, 1.0), isBorder * 0.5);`:""}
  `;return e.output===K.Alpha&&n.code.add(S`
      void main() {
        ${l}
        gl_FragColor = vec4(gl_FragColor.a);
      }
      `),e.output===K.Color&&n.code.add(S`
    void main() {
      ${l}
      ${e.transparencyPassType===yt.FrontFace?"gl_FragColor.rgb /= gl_FragColor.a;":""}
    }
    `),e.output===K.Highlight&&(t.include(Ky),n.code.add(S`
    void main() {
      ${l}
      ${e.binaryHighlightOcclusionEnabled?S`
          if (voccluded == 1.0) {
            gl_FragColor = vec4(1.0, 1.0, 0.0, 1.0);
          } else {
            gl_FragColor = vec4(1.0, 0.0, 1.0, 1.0);
          }`:"outputHighlight();"}
    }
    `)),t}function z0e(e){return e.outlineColor[3]>0&&e.outlineSize>0}function lk(e,t=pAe){return e.textureIsSignedDistanceField?gmt(e.anchorPosition,e.distanceFieldBoundingBox,t):Na(t,e.anchorPosition),t}function gmt(e,t,r){_(t)?vr(r,e[0]*(t[2]-t[0])+t[0],e[1]*(t[3]-t[1])+t[1]):vr(r,0,0)}const pAe=it(),ymt=Object.freeze(Object.defineProperty({__proto__:null,build:mmt,calculateAnchorPosForRendering:lk},Symbol.toStringTag,{value:"Module"})),wu=ka(Re.SRC_ALPHA,Re.ONE,Re.ONE_MINUS_SRC_ALPHA,Re.ONE_MINUS_SRC_ALPHA),bmt=Im(Re.ONE,Re.ONE),mAe=Im(Re.ZERO,Re.ONE_MINUS_SRC_ALPHA);function eb(e){return e===yt.FrontFace?null:e===yt.Alpha?mAe:bmt}function Kz(e){return e===yt.FrontFace?fc:null}const eU=5e5,tU={factor:-1,units:-2};function rU(e){return e?tU:null}function w_(e,t=vi.LESS){return e===yt.NONE||e===yt.FrontFace?t:vi.LEQUAL}class RO extends gi{initializeConfiguration(t,r){r.spherical=t.viewingMode===Be.Global}initializeProgram(t){const r=RO.shader.get().build(this.configuration);return new ai(t.rctx,r,Ur)}_setPipelineState(t){const r=this.configuration,i=t===yt.NONE,n=t===yt.FrontFace,s=this.configuration.hasPolygonOffset&&vmt,a=(i||n)&&r.output!==K.Highlight?(r.depthEnabled||r.output===K.Occlusion)&&fc:null;return jt({blending:r.output===K.Color||r.output===K.Alpha||r.output===K.Highlight?i?_mt:eb(t):null,depthTest:{func:vi.LEQUAL},depthWrite:a,colorWrite:or,polygonOffset:s})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}get primitiveType(){return this.configuration.output===K.Occlusion?Dt.POINTS:Dt.TRIANGLES}}RO.shader=new si(ymt,()=>ie(()=>import("./HUDMaterial.glsl.75d59761.js"),[],import.meta.url));const vmt={factor:0,units:-4},_mt=Im(Re.ONE,Re.ONE_MINUS_SRC_ALPHA);class Mo extends xl{}d([H({constValue:!0})],Mo.prototype,"hasSliceHighlight",void 0),d([H({constValue:!1})],Mo.prototype,"hasSliceInVertexProgram",void 0),d([H({constValue:!1})],Mo.prototype,"instancedDoublePrecision",void 0),d([H({constValue:!1})],Mo.prototype,"isGround",void 0),d([H({constValue:zr.Pass})],Mo.prototype,"pbrTextureBindType",void 0);class Un extends Mo{constructor(){super(...arguments),this.output=K.Color,this.screenCenterOffsetUnitsEnabled=Jl.World,this.transparencyPassType=yt.NONE,this.spherical=!1,this.occlusionTestEnabled=!0,this.signedDistanceFieldEnabled=!1,this.vvSize=!1,this.vvColor=!1,this.hasVerticalOffset=!1,this.hasScreenSizePerspective=!1,this.debugDrawLabelBorder=!1,this.binaryHighlightOcclusionEnabled=!0,this.hasSlicePlane=!1,this.hasPolygonOffset=!1,this.depthEnabled=!0,this.pixelSnappingEnabled=!0,this.isDraped=!1,this.hasMultipassGeometry=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1}}d([H({count:K.COUNT})],Un.prototype,"output",void 0),d([H({count:Jl.COUNT})],Un.prototype,"screenCenterOffsetUnitsEnabled",void 0),d([H({count:yt.COUNT})],Un.prototype,"transparencyPassType",void 0),d([H()],Un.prototype,"spherical",void 0),d([H()],Un.prototype,"occlusionTestEnabled",void 0),d([H()],Un.prototype,"signedDistanceFieldEnabled",void 0),d([H()],Un.prototype,"vvSize",void 0),d([H()],Un.prototype,"vvColor",void 0),d([H()],Un.prototype,"hasVerticalOffset",void 0),d([H()],Un.prototype,"hasScreenSizePerspective",void 0),d([H()],Un.prototype,"debugDrawLabelBorder",void 0),d([H()],Un.prototype,"binaryHighlightOcclusionEnabled",void 0),d([H()],Un.prototype,"hasSlicePlane",void 0),d([H()],Un.prototype,"hasPolygonOffset",void 0),d([H()],Un.prototype,"depthEnabled",void 0),d([H()],Un.prototype,"pixelSnappingEnabled",void 0),d([H()],Un.prototype,"isDraped",void 0),d([H()],Un.prototype,"hasMultipassGeometry",void 0),d([H()],Un.prototype,"hasMultipassTerrain",void 0),d([H()],Un.prototype,"cullAboveGround",void 0),d([H({constValue:!0})],Un.prototype,"hasSliceInVertexProgram",void 0),d([H({constValue:!1})],Un.prototype,"hasVvInstancing",void 0);class O9 extends Dm{constructor(t){super(t,new Mmt),this.techniqueConfig=new Un}getConfiguration(t,r){return this.techniqueConfig.output=t,this.techniqueConfig.hasSlicePlane=this.parameters.hasSlicePlane,this.techniqueConfig.hasVerticalOffset=!!this.parameters.verticalOffset,this.techniqueConfig.hasScreenSizePerspective=!!this.parameters.screenSizePerspective,this.techniqueConfig.screenCenterOffsetUnitsEnabled=this.parameters.centerOffsetUnits==="screen"?Jl.Screen:Jl.World,this.techniqueConfig.hasPolygonOffset=this.parameters.polygonOffset,this.techniqueConfig.isDraped=this.parameters.isDraped,this.techniqueConfig.occlusionTestEnabled=this.parameters.occlusionTest,this.techniqueConfig.pixelSnappingEnabled=this.parameters.pixelSnappingEnabled,this.techniqueConfig.signedDistanceFieldEnabled=this.parameters.textureIsSignedDistanceField,this.techniqueConfig.vvSize=!!this.parameters.vvSizeEnabled,this.techniqueConfig.vvColor=!!this.parameters.vvColorEnabled,t===K.Color&&(this.techniqueConfig.debugDrawLabelBorder=!!this.parameters.debugDrawLabelBorder),t===K.Highlight&&(this.techniqueConfig.binaryHighlightOcclusionEnabled=this.parameters.binaryHighlightOcclusion),this.techniqueConfig.depthEnabled=this.parameters.depthEnabled,this.techniqueConfig.transparencyPassType=r.transparencyPassType,this.techniqueConfig.hasMultipassGeometry=r.multipassGeometry.enabled,this.techniqueConfig.hasMultipassTerrain=r.multipassTerrain.enabled,this.techniqueConfig.cullAboveGround=r.multipassTerrain.cullAboveGround,this.techniqueConfig}intersect(t,r,i,n,s,a,o,l,c){_(c)?this._intersectDrapedHudGeometry(t,a,o,l,c):this._intersectHudGeometry(t,r,i,n,o,l)}_intersectDrapedHudGeometry(t,r,i,n,s){const a=t.vertexAttributes.get(O.POSITION),o=t.vertexAttributes.get(O.SIZE),l=this.parameters,c=lk(l);let u=1,h=1;if(_(n)){const m=n(G0e);u=m[0],h=m[5]}u*=t.screenToWorldRatio,h*=t.screenToWorldRatio;const p=Rmt*t.screenToWorldRatio;for(let m=0;m<a.data.length/a.size;m++){const g=m*a.size,b=a.data[g],w=a.data[g+1],v=m*o.size;let x;bb[0]=o.data[v]*u,bb[1]=o.data[v+1]*h,l.textureIsSignedDistanceField&&(x=l.outlineSize*t.screenToWorldRatio/2),U0e(r,b,w,bb,p,x,l,c)&&i(s.dist,s.normal,-1,!1)}}_intersectHudGeometry(t,r,i,n,s,a){if(!n.options.selectionMode||!n.options.hud||xO(r))return;const o=this.parameters;let l=1,c=1;if(Jh(iq,i),_(a)){const x=a(G0e);l=x[0],c=x[5],Tmt(iq)}const u=t.vertexAttributes.get(O.POSITION),h=t.vertexAttributes.get(O.SIZE),p=t.vertexAttributes.get(O.NORMAL),m=t.vertexAttributes.get(O.AUXPOS1);pt(u.size>=3);const g=n.point,b=n.camera,w=lk(o);l*=b.pixelRatio,c*=b.pixelRatio;const v=this.parameters.centerOffsetUnits==="screen";for(let x=0;x<u.data.length/u.size;x++){const T=x*u.size;ne(bo,u.data[T],u.data[T+1],u.data[T+2]),ze(bo,bo,i);const E=x*h.size;bb[0]=h.data[E]*l,bb[1]=h.data[E+1]*c,ze(bo,bo,b.viewMatrix);const C=x*m.size;if(ne(Sd,m.data[C+0],m.data[C+1],m.data[C+2]),!v&&(bo[0]+=Sd[0],bo[1]+=Sd[1],Sd[2]!==0)){const P=Sd[2];we(Sd,bo),pe(bo,bo,le(Sd,Sd,P))}const A=x*p.size;if(ne(y8,p.data[A],p.data[A+1],p.data[A+2]),this._normalAndViewAngle(y8,iq,b,nq),this._applyVerticalOffsetTransformationView(bo,nq,b,rq),b.applyProjection(bo,jo),jo[0]>-1){jo[0]=Math.floor(jo[0]),jo[1]=Math.floor(jo[1]),v&&(Sd[0]||Sd[1])&&(jo[0]+=Sd[0],Sd[1]!==0&&(jo[1]+=Wse(Sd[1],rq.factorAlignment)),b.unapplyProjection(jo,bo)),jo[0]+=this.parameters.screenOffset[0],jo[1]+=this.parameters.screenOffset[1],k7e(bb,rq.factor,bb);const P=Amt*b.pixelRatio;let I;if(o.textureIsSignedDistanceField&&(I=o.outlineSize*b.pixelRatio/2),U0e(g,jo[0],jo[1],bb,P,I,o,w)){const L=n.ray;if(ze(B0e,bo,Rn(Cmt,b.viewMatrix)),jo[0]=g[0],jo[1]=g[1],b.unprojectFromRenderScreen(jo,bo)){const V=M();oe(V,L.direction);const G=1/Oe(V);le(V,V,G),s(fi(L.origin,bo)*G,V,-1,!0,1,B0e)}}}}}computeAttachmentOrigin(t,r){const i=t.vertexAttributes;if(!i)return!1;const n=i.get(O.POSITION),s=t.indices.get(O.POSITION);return xCe(n,s,r)}createBufferWriter(){return new Imt(this)}_normalAndViewAngle(t,r,i,n){return y0t(r)&&(r=Jh(Emt,r)),ed(n.normal,t,r),ze(n.normal,n.normal,i.viewInverseTransposeMatrix),n.cosAngle=Se(yAe,Omt),n}_updateScaleInfo(t,r,i){const n=this.parameters;_(n.screenSizePerspective)?D0e(i,r,n.screenSizePerspective,t.factor):(t.factor.scale=1,t.factor.factor=0,t.factor.minPixelSize=0,t.factor.paddingPixels=0),_(n.screenSizePerspectiveAlignment)?D0e(i,r,n.screenSizePerspectiveAlignment,t.factorAlignment):(t.factorAlignment.factor=t.factor.factor,t.factorAlignment.scale=t.factor.scale,t.factorAlignment.minPixelSize=t.factor.minPixelSize,t.factorAlignment.paddingPixels=t.factor.paddingPixels)}applyShaderOffsetsView(t,r,i,n,s,a,o){const l=this._normalAndViewAngle(r,i,s,nq);return this._applyVerticalGroundOffsetView(t,l,s,o),this._applyVerticalOffsetTransformationView(o,l,s,a),this._applyPolygonOffsetView(o,l,n[3],s,o),this._applyCenterOffsetView(o,n,o),o}applyShaderOffsetsNDC(t,r,i,n,s){return this._applyCenterOffsetNDC(t,r,i,n),_(s)&&oe(s,n),this._applyPolygonOffsetNDC(n,r,i,n),n}_applyPolygonOffsetView(t,r,i,n,s){const a=n.aboveGround?1:-1;let o=Math.sign(i);o===0&&(o=a);const l=a*o;if(this.parameters.shaderPolygonOffset<=0)return oe(s,t);const c=Le(Math.abs(r.cosAngle),.01,1),u=1-Math.sqrt(1-c*c)/c/n.viewport[2];return le(s,t,l>0?u:1/u),s}_applyVerticalGroundOffsetView(t,r,i,n){const s=Oe(t),a=i.aboveGround?1:-1,o=.5*i.computeRenderPixelSizeAtDist(s),l=le(bo,r.normal,a*o);return he(n,t,l),n}_applyVerticalOffsetTransformationView(t,r,i,n){const s=this.parameters;if(!s.verticalOffset||!s.verticalOffset.screenLength){if(s.screenSizePerspective||s.screenSizePerspectiveAlignment){const c=Oe(t);this._updateScaleInfo(n,c,r.cosAngle)}else n.factor.scale=1,n.factorAlignment.scale=1;return t}const a=Oe(t),o=vt(s.screenSizePerspectiveAlignment,s.screenSizePerspective),l=X7e(i,a,s.verticalOffset,r.cosAngle,o);return this._updateScaleInfo(n,a,r.cosAngle),le(r.normal,r.normal,l),he(t,t,r.normal)}_applyCenterOffsetView(t,r,i){const n=this.parameters.centerOffsetUnits!=="screen";return i!==t&&oe(i,t),n&&(i[0]+=r[0],i[1]+=r[1],r[2]&&(we(y8,i),he(i,i,le(y8,y8,r[2])))),i}_applyCenterOffsetNDC(t,r,i,n){const s=this.parameters.centerOffsetUnits!=="screen";return n!==t&&oe(n,t),s||(n[0]+=r[0]/i.fullWidth*2,n[1]+=r[1]/i.fullHeight*2),n}_applyPolygonOffsetNDC(t,r,i,n){const s=this.parameters.shaderPolygonOffset;if(t!==n&&oe(n,t),s){const a=i.aboveGround?1:-1,o=a*Math.sign(r[3]);n[2]-=(o||a)*s}return n}requiresSlot(t){if(t===Ee.DRAPED_MATERIAL)return!0;const{drawInSecondSlot:r,occlusionTest:i}=this.parameters;return t===(r?Ee.LABEL_MATERIAL:Ee.HUD_MATERIAL)||i&&t===Ee.OCCLUSION_PIXELS}createGLMaterial(t){return t.output===K.Color||t.output===K.Alpha?new wmt(t):t.output===K.Highlight?new gAe(t):null}calculateRelativeScreenBounds(t,r,i=zt()){return xmt(this.parameters,t,r,i),i[2]=i[0]+t[0],i[3]=i[1]+t[1],i}}class gAe extends ose{constructor(t){super({...t,...t.material.parameters})}selectProgram(t){return this.ensureTechnique(RO,t)}beginSlot(t){return this.updateTexture(this._material.parameters.textureId),this._material.setParameters(this.textureBindParameters),this.selectProgram(t)}}class wmt extends gAe{_isOcclusionSlot(t){return t.slot===Ee.OCCLUSION_PIXELS&&this._material.parameters.occlusionTest&&(this._output===K.Color||this._output===K.Alpha)}selectProgram(t){return this.ensureTechnique(RO,t,this._isOcclusionSlot(t)?K.Occlusion:this._output)}}function xmt(e,t,r,i=Smt){return Na(i,e.anchorPosition),i[0]*=-t[0],i[1]*=-t[1],i[0]+=e.screenOffset[0]*r,i[1]+=e.screenOffset[1]*r,i}function Tmt(e){const t=e[0],r=e[1],i=e[2],n=e[3],s=e[4],a=e[5],o=e[6],l=e[7],c=e[8],u=1/Math.sqrt(t*t+r*r+i*i),h=1/Math.sqrt(n*n+s*s+a*a),p=1/Math.sqrt(o*o+l*l+c*c);return e[0]=t*u,e[1]=r*u,e[2]=i*u,e[3]=n*h,e[4]=s*h,e[5]=a*h,e[6]=o*p,e[7]=l*p,e[8]=c*p,e}function U0e(e,t,r,i,n,s,a,o){let l=t-n-(o[0]>0?i[0]*o[0]:0),c=l+i[0]+2*n,u=r-n-(o[1]>0?i[1]*o[1]:0),h=u+i[1]+2*n;const p=a.distanceFieldBoundingBox;return a.textureIsSignedDistanceField&&_(p)&&(l+=i[0]*p[0],u+=i[1]*p[1],c-=i[0]*(1-p[2]),h-=i[1]*(1-p[3]),l-=s,c+=s,u-=s,h+=s),e[0]>l&&e[0]<c&&e[1]>u&&e[1]<h}const rq={factor:{scale:0,factor:0,minPixelSize:0,paddingPixels:0},factorAlignment:{scale:0,factor:0,minPixelSize:0,paddingPixels:0}},Smt=it(),bo=M(),y8=M(),jo=Jt(),yAe=M(),B0e=M(),iq=Li(),Emt=Li(),Cmt=Ae(),Sd=M(),nq={normal:yAe,cosAngle:0},G0e=Ae(),Amt=1,Rmt=2,bb=[0,0],Omt=Ve(0,0,1);class Mmt extends KEe{constructor(){super(...arguments),this.renderOccluded=ki.Occlude,this.color=[1,1,1,1],this.texCoordScale=[1,1],this.polygonOffset=!1,this.anchorPosition=Nr(.5,.5),this.screenOffset=[0,0],this.shaderPolygonOffset=1e-5,this.textureIsSignedDistanceField=!1,this.outlineColor=[1,1,1,1],this.outlineSize=0,this.vvSizeEnabled=!1,this.vvSizeMinSize=[1,1,1],this.vvSizeMaxSize=[100,100,100],this.vvSizeOffset=[0,0,0],this.vvSizeFactor=[1,1,1],this.vvColorEnabled=!1,this.vvColorValues=[0,0,0,0,0,0,0,0],this.vvColorColors=[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],this.hasSlicePlane=!1,this.pixelSnappingEnabled=!0,this.occlusionTest=!0,this.binaryHighlightOcclusion=!0,this.debugDrawLabelBorder=!1,this.centerOffsetUnits="world",this.drawInSecondSlot=!1,this.depthEnabled=!0,this.isDraped=!1}}const Pmt=gn().vec3f(O.POSITION).vec3f(O.NORMAL).vec2f(O.UV0).vec4u8(O.COLOR).vec2f(O.SIZE).vec4f(O.AUXPOS1).vec4f(O.AUXPOS2);class Imt{constructor(t){this.material=t,this.vertexBufferLayout=Pmt}allocate(t){return this.vertexBufferLayout.createBuffer(t)}elementCount(t){return 6*t.indices.get(O.POSITION).length}write(t,r,i,n){Zz(r.indices.get(O.POSITION),r.vertexAttributes.get(O.POSITION).data,t.transformation,i.position,n,6),Jse(r.indices.get(O.NORMAL),r.vertexAttributes.get(O.NORMAL).data,t.invTranspTransformation,i.normal,n,6);{const s=r.vertexAttributes.get(O.UV0).data;let a,o,l,c;if(s==null||s.length<4){const m=this.material.parameters;a=0,o=0,l=m.texCoordScale[0],c=m.texCoordScale[1]}else a=s[0],o=s[1],l=s[2],c=s[3];l=Math.min(1.99999,l+1),c=Math.min(1.99999,c+1);const u=r.indices.get(O.POSITION).length,h=i.uv0;let p=n;for(let m=0;m<u;++m)h.set(p,0,a),h.set(p,1,o),p+=1,h.set(p,0,l),h.set(p,1,o),p+=1,h.set(p,0,l),h.set(p,1,c),p+=1,h.set(p,0,l),h.set(p,1,c),p+=1,h.set(p,0,a),h.set(p,1,c),p+=1,h.set(p,0,a),h.set(p,1,o),p+=1}nk(r.indices.get(O.COLOR),r.vertexAttributes.get(O.COLOR).data,4,i.color,n,6);{const s=r.indices.get(O.SIZE),a=r.vertexAttributes.get(O.SIZE).data,o=s.length,l=i.size;let c=n;for(let u=0;u<o;++u){const h=a[2*s[u]],p=a[2*s[u]+1];for(let m=0;m<6;++m)l.set(c,0,h),l.set(c,1,p),c+=1}}r.indices.get(O.AUXPOS1)&&r.vertexAttributes.get(O.AUXPOS1)&&R9(r.indices.get(O.AUXPOS1),r.vertexAttributes.get(O.AUXPOS1).data,i.auxpos1,n,6),r.indices.get(O.AUXPOS2)&&r.vertexAttributes.get(O.AUXPOS2)&&R9(r.indices.get(O.AUXPOS2),r.vertexAttributes.get(O.AUXPOS2).data,i.auxpos2,n,6)}}const Hp=M(),nT=Jt(),b8=Jt(),sq=M(),$mt=Ae(),Lmt=Us(),aq=Ma(),Dmt=M(),Fmt=zt();class Nmt{constructor(){this.aabr=zt(),this.distance=0,this.culled=!1,this.visible=!1}}class kmt{constructor(t,r,i={}){this.graphics3DGraphic=t,this.slicePlaneEnabled=r,this.info=i}}class Vmt{constructor(){this.active=new Map,this.visible=new Map}clear(){this.active.clear(),this.visible.clear()}}class zmt{}class Umt{constructor(){this.sortArray=new Qt({allocator:t=>t||new zmt})}}var kc;(function(e){e[e.Idle=0]="Idle",e[e.Process=1]="Process",e[e.Sort=2]="Sort",e[e.Deconflict=3]="Deconflict",e[e.NumStates=4]="NumStates"})(kc||(kc={}));class bAe{constructor(){this.camera=new ni,this.slicePlane=b_(),this.slicePlaneEnabled=!1}copyFrom(t){this.camera.copyFrom(t.camera),Ax(t.slicePlane,this.slicePlane),this.slicePlaneEnabled=t.slicePlaneEnabled}}let C4=class extends xe{constructor(){super(...arguments),this._dirty=!1,this._runningViewState=new bAe,this._state=kc.Idle,this.graphics=new Vmt,this.iterators=new Umt,this.accBinsNumX=15,this.accBinsNumY=20,this.accBinsSizeX=0,this.accBinsSizeY=0,this.accBins=null,this.accNumTests=0}get dirty(){return this._dirty}get state(){return this._state}destroy(){this.graphics.clear(),this.iterators=null}setDirty(){!this._dirty&&this.graphics.active.size>0&&(this._dirty=!0,this.notifyChange("updating"))}get updating(){return this._state!==kc.Idle||this._dirty}get updatingProgress(){if(!this.updating)return 1;const e=this._state/kc.NumStates;return this._dirty?.5*e:e}get running(){return this.view.ready&&this.view.state!=null&&this.updating}runTask(e){switch(this._state){case kc.Idle:this._startUpdate(),e.madeProgress();case kc.Process:if(this._state=kc.Process,!this._processActiveGraphics(e))return;case kc.Sort:if(this._state=kc.Sort,!this._sortVisibleGraphics(e))return;case kc.Deconflict:if(this._state=kc.Deconflict,!this._deconflictVisibleGraphics(e))return;default:a0t(this,this.graphics.visible),this._state=kc.Idle,this.notifyChange("updating")}}modifyGraphics(e,t){t?e.forEach(r=>this.addToActiveGraphics(r)):e.forEach(r=>this.removeFromActiveGraphics(r)),this.setDirty()}layerSupportsDeconfliction(e){if(R(e)||e.type!=="object3d")return!1;const t=e.stageObject;return(t?t.geometryRecords.length:0)!==1?!1:t.geometryRecords[0].material instanceof O9}_startUpdate(){o0t(this.view),this._dirty=!1,this._runningViewState.copyFrom(this.viewState);const{fullWidth:e,fullHeight:t}=this._runningViewState.camera;this._initBins(e,t),this._resetIterators()}addToActiveGraphics(e){e.info[this.visibilityGroup]=new Nmt,this.graphics.active.set(e.graphics3DGraphic.graphic.uid,e),this.setDirty()}removeFromActiveGraphics(e){this._removeFromVisibleGraphics(e),Bmt(e,this.visibilityGroup),delete e.info[this.visibilityGroup],this.graphics.active.delete(e.graphics3DGraphic.graphic.uid),this.setDirty()}_addToVisibleGraphics(e){this.graphics.visible.set(e.graphics3DGraphic.graphic.uid,e)}_removeFromVisibleGraphics(e){this.graphics.visible.delete(e.graphics3DGraphic.graphic.uid)}_processActiveGraphics(e){const t=this._ensureActiveGraphicsIterator(),r=Rn($mt,this._runningViewState.camera.projectionMatrix),i=this.view.viewingMode==="global"&&this.view.map.ground.opacity===1&&this._runningViewState.camera.relativeElevation>0?Lmt:null;let n=0;for(_(i)&&(ze(i,gl,this._runningViewState.camera.viewMatrix),i[3]=Ar(this.view.spatialReference).radius,n=_Se(i,gl));!e.done;){e.madeProgress();const s=t.next();if(s.done===!0)return this._resetActiveGraphicsIterator(),!0;const a=s.value,o=a&&a.info[this.visibilityGroup];o&&(this._collectGraphics3DGraphics(a,r,i,n),o.culled?this._removeFromVisibleGraphics(a):this._addToVisibleGraphics(a))}return!1}_sortVisibleGraphics(e){const t=this._ensureSortGraphicsIterator();for(;!e.done;){const r=t.next();if(e.madeProgress(),r.done===!0)return this._resetSortGraphicsIterator(),!0}return!1}_deconflictVisibleGraphics(e){const t=this._ensureVisibleGraphicsIterator(),r=this.visibilityGroup===Ra.LABEL;for(;!e.done;){e.madeProgress();const i=t.next();if(i.done===!0)return this._resetVisibleGraphicsIterator(),!0;const n=i.value,s=n.info[this.visibilityGroup];if(!s||s.culled)continue;const a=n.graphics3DGraphic,o=(!r||a.isVisible())&&!this._isConflicted(n);o&&this._addToBins(n),s.visible=o,this._setGraphicVisibility(n,o),c0t(s,o)}return!1}_resetIterators(){this.iterators.active=null,this.iterators.visible=null,this.iterators.sort=null}_ensureActiveGraphicsIterator(){return this.iterators.active||(this.iterators.active=j0e(this.graphics.active)),this.iterators.active}_resetActiveGraphicsIterator(){this.iterators.active=null}_ensureVisibleGraphicsIterator(){return this.iterators.visible||(this.iterators.visible=j0e(this.graphics.visible)),this.iterators.visible}_resetVisibleGraphicsIterator(){this.iterators.visible=null}_ensureSortGraphicsIterator(){return this.iterators.sort||(this.iterators.sort=Gmt(this.graphics.visible,this.iterators.sortArray,this.visibilityGroup)),this.iterators.sort}_resetSortGraphicsIterator(){this.iterators.sort=null}_collectGraphics3DGraphics(e,t,r,i){const n=e.graphics3DGraphic;if(n.destroyed)return;const s=e.info[this.visibilityGroup];if(!n.isVisible(Ra.GRAPHIC,ou.DECONFLICTION))return void(s.culled=!0);const a=this.getGraphicsLayers(n);Eu(s.aabr);let o=null;for(const l of a){if(!this.layerSupportsDeconfliction(l))continue;const c=l.stageObject.geometryRecords[0].material;if(R(o)){if(o=this._getProjectionInfo(l,t,Hmt),o.isOutsideScreen||this._isCulledBySlice(e,Hp)||_(r)&&this._isCulledByHorizon(o,r,i))return void(s.culled=!0);!Yr.TESTS_DISABLE_OPTIMIZATIONS&&s.visible&&(o.distance*=.7)}this._expandBoundingRect(s,l,c,o)}R(o)?s.culled=!0:(s.distance=o.distance,s.culled=!1)}_getProjectionInfo(e,t,r){const i=this._runningViewState.camera,n=e.stageObject,s=n.geometryRecords[0],a=s.material,o=n.boundingVolumeWorldSpace.bounds;ze(Hp,o,i.viewMatrix);const l=s.geometry.vertexAttributes,c=l.get(O.NORMAL).data,u=l.get(O.AUXPOS1).data;return a.applyShaderOffsetsView(Hp,c,n.transformation,u,i,r.scaleInfo,Hp),ei(nT,Hp[0],Hp[1],Hp[2],1),du(b8,nT,i.projectionMatrix),le(r.positionNDC,b8,1/b8[3]),a.applyShaderOffsetsNDC(r.positionNDC,u,i,r.positionNDC,sq),r.distanceWithoutPolygonOffset=i.depthNDCToWorld(sq[2]),r.distance=sq[2]===r.positionNDC[2]?r.distanceWithoutPolygonOffset:i.depthNDCToWorld(r.positionNDC[2]),ei(b8,r.positionNDC[0],r.positionNDC[1],r.positionNDC[2],1),du(nT,b8,t),YR(nT,nT,1/nT[3]),ne(r.positionView,Hp[0],Hp[1],Hp[2]),r}_isCulledByHorizon(e,t,r){return oe(aq.direction,e.positionView),ne(aq.origin,0,0,0),!!y_(t,aq,Dmt)&&e.distanceWithoutPolygonOffset>r}_isCulledBySlice(e,t){return e.slicePlaneEnabled&&this._runningViewState.slicePlaneEnabled&&uie(this._runningViewState.slicePlane,t)}_expandBoundingRect(e,t,r,{positionNDC:i,scaleInfo:n}){const s=this._runningViewState.camera,a=t.getScreenSize(jmt);k7e(a,n.factor,a),a[0]*=s.pixelRatio,a[1]*=s.pixelRatio;const o=UF(r.calculateRelativeScreenBounds(a,n.factorAlignment.scale,Fmt),Kt(0,s.fullWidth,.5+.5*i[0]),Kt(0,s.fullHeight,.5+.5*i[1])),l=this.iconMarginFactor;if(l!==0){const c=l*Math.min(su(o),$p(o));o[0]-=c,o[1]-=c,o[2]+=c,o[3]+=c}nw(e.aabr,o,e.aabr)}_isConflicted(e){const t=e.graphics3DGraphic.graphic.uid,r=e.info[this.visibilityGroup];for(let i=Math.floor(r.aabr[0]/this.accBinsSizeX);i<=Math.floor(r.aabr[2]/this.accBinsSizeX);i++)if(!(i<0||i>=this.accBinsNumX))for(let n=Math.floor(r.aabr[1]/this.accBinsSizeY);n<=Math.floor(r.aabr[3]/this.accBinsSizeY);n++){if(n<0||n>=this.accBinsNumY)continue;const s=this.accBins[i][n];for(let a=0;a<s.length;a++){const o=s.data[a],l=o.info[this.visibilityGroup];if(l&&l.visible&&o.graphics3DGraphic.graphic.uid!==t&&(this.accNumTests++,KR(l.aabr,r.aabr)))return!0}}return!1}_initBins(e,t){if(this.accBins==null){this.accBins=[];for(let r=0;r<this.accBinsNumX;r++){this.accBins.push([]);const i=this.accBins[this.accBins.length-1];for(let n=0;n<this.accBinsNumY;n++)i.push(new Qt)}}else for(let r=0;r<this.accBinsNumX;r++)for(let i=0;i<this.accBinsNumY;i++)this.accBins[r][i].clear();this.accBinsSizeX=e/this.accBinsNumX,this.accBinsSizeY=t/this.accBinsNumY,this.accNumTests=0}_addToBins(e){const t=e.info[this.visibilityGroup],r=Math.floor(t.aabr[0]/this.accBinsSizeX),i=Math.floor(t.aabr[2]/this.accBinsSizeX),n=Math.floor(t.aabr[1]/this.accBinsSizeY),s=Math.floor(t.aabr[3]/this.accBinsSizeY);for(let a=r;a<=i;a++)if(!(a<0||a>=this.accBinsNumX))for(let o=n;o<=s;o++)o<0||o>=this.accBinsNumY||this.accBins[a][o].push(e)}_setGraphicVisibility(e,t){const r=e.graphics3DGraphic;r.destroyed||(r.setVisibilityFlag(ou.DECONFLICTION,t,this.visibilityGroup),this.visibilityGroup===Ra.LABEL&&this.view.labeler.setLabelGraphicVisibility(r,t))}};function Bmt(e,t){const r=e.graphics3DGraphic;r.destroyed||r.clearVisibilityFlag(ou.DECONFLICTION,t)}function*j0e(e){if(Map.prototype.entries){const t=e.entries();for(let r=t.next();!r.done;r=t.next())yield r.value[1]}else yield*e.values()}function*Gmt(e,t,r){t.clear(),e.forEach((n,s)=>{const a=t.pushNew();a.id=s,a.prio=n.info?-n.info[r].distance:Number.MAX_VALUE}),yield;const i=t.iterableSort((n,s)=>s.prio-n.prio);for(let n=i.next();!n.done;n=i.next())yield;t.forAll(n=>{const s=e.get(n.id);s&&(e.delete(n.id),e.set(n.id,s))}),t.clear()}d([f({constructOnly:!0})],C4.prototype,"view",void 0),d([f({type:Boolean,readOnly:!0})],C4.prototype,"updating",null),C4=d([$("esri.views.3d.layers.graphics.Deconflictor")],C4);const jmt=it();class qmt{constructor(){this.positionView=M(),this.positionNDC=M(),this.distance=0,this.distanceWithoutPolygonOffset=0,this.scaleInfo={factor:{scale:0,factor:0,minPixelSize:0,paddingPixels:0},factorAlignment:{scale:0,factor:0,minPixelSize:0,paddingPixels:0}}}get isOutsideScreen(){const t=this.positionNDC;return t[0]<-1||t[1]<-1||t[2]<-1||t[0]>=1||t[1]>=1}}const Hmt=new qmt,Wmt=2e3;let dD=class extends C4{constructor(){super(...arguments),this.visibilityGroup=Ra.LABEL,this.iconMarginFactor=0,this._lastDeconfliction=0}get viewState(){return this.parent.viewState}runTask(e){if(this.parent.running)return;const t=performance.now();(e.state===Ks.IDLE||t-this._lastDeconfliction>Wmt)&&(super.runTask(e),this.state===kc.Idle&&(this._lastDeconfliction=t))}enabledChanged(e,t){this.modifyGraphics(t,e.labelsEnabled)}getGraphicsLayers(e){return e.labelGraphics}};d([f({constructOnly:!0})],dD.prototype,"parent",void 0),dD=d([$("esri.views.3d.layers.graphics.LabelDeconflictor")],dD);let rK=class extends C4{constructor(){super(...arguments),this._handles=new Ft,this._contexts=new Map,this._viewState=new bAe,this.visibilityGroup=Ra.GRAPHIC,this._iconMarginFactor=-.1}get labels(){return this._labels}get viewState(){return this._viewState}initialize(){this._handles.add([re(()=>{var e,t;return(t=(e=this.view)==null?void 0:e.state)==null?void 0:t.camera},()=>{this._updateViewState(),this.setDirty()}),re(()=>{var e,t,r;return(r=(t=(e=this.view)==null?void 0:e.map)==null?void 0:t.ground)==null?void 0:r.opacity},(e,t)=>{e!==1&&t!==1||this.setDirty()}),re(()=>{var e;return(e=this.view)==null?void 0:e.slicePlane},()=>{this._updateSlicePlane(),this._slicePlaneChanged()},Ot)]),this._frameTask=this.view.resourceController.scheduler.registerTask(bt.GRAPHICS_DECONFLICTOR,this),this._labels=new dD({view:this.view,parent:this})}destroy(){this._labels.destroy(),this._labels=null,this._handles.destroy(),this._handles=null,this._frameTask&&(this._frameTask.remove(),this._frameTask=null)}get iconMarginFactor(){return this._iconMarginFactor}set iconMarginFactor(e){this._iconMarginFactor=e,this.setDirty()}setDirty(){this._contexts.size>0&&(super.setDirty(),this._labels.setDirty())}runTask(e){super.runTask(e),this.running||this._labels.setDirty()}setInitialIconVisibilityFlag(e,t){const r=!(this._graphicSupportsDeconfliction(t)&&oq(e));t.setVisibilityFlag(ou.DECONFLICTION,r,Ra.GRAPHIC)}_updateViewState(){this.view&&this.view.state&&(this._viewState.camera.copyFrom(this.view.state.camera),this._updateSlicePlane())}_updateSlicePlane(){const e=this.view?this.view.slicePlane:null;_(e)&&DSe(e,this._viewState.camera.viewMatrix,this._viewState.slicePlane),this._viewState.slicePlaneEnabled=_(e)}_slicePlaneChanged(){vs(this._contexts,(e,t)=>t.symbolCreationContext.slicePlaneEnabled)&&this.setDirty()}addGraphicsOwner(e){let t=this._contexts.get(e);return t==null&&(t=new Map,this._contexts.set(e,t),this.setDirty()),{addGraphic:r=>this._addGraphic(e,t,r),removeGraphic:r=>this._removeGraphic(t,r),labelingInfoChange:()=>this._labels.enabledChanged(e,t),featureReductionChange:()=>this.enabledChanged(e,t),slicePlaneEnabledChange:()=>this._slicePlaneEnabledChanged(e,t),clear:()=>t.forEach(r=>this._removeGraphic(t,r.graphics3DGraphic))}}removeGraphicsOwner(e){const t=this._contexts.get(e);t&&(t.forEach(r=>this._removeGraphic(t,r.graphics3DGraphic)),this._contexts.delete(e),this.setDirty())}_addGraphic(e,t,r){const i=r.graphic.uid,n=new kmt(r,e.symbolCreationContext.slicePlaneEnabled);t.set(i,n),oq(e)&&this.addToActiveGraphics(n),e.labelsEnabled&&this._labels.addToActiveGraphics(n)}_removeGraphic(e,t){const r=t.graphic.uid,i=e.get(r);i&&(this.removeFromActiveGraphics(i),this._labels.removeFromActiveGraphics(i),e.delete(r),this.setDirty())}enabledChanged(e,t){const r=oq(e);r||Xmt(e),this.modifyGraphics(t,r)}_slicePlaneEnabledChanged(e,t){const r=e.symbolCreationContext.slicePlaneEnabled;t.forEach(i=>i.slicePlaneEnabled=r),this.setDirty()}getGraphicsLayers(e){return e.graphics}_graphicSupportsDeconfliction(e){if(e.isDraped)return!1;const t=e.graphics;if(!t||!t.length)return!1;for(const r of t)if(this.layerSupportsDeconfliction(r))return!0;return!1}};function oq(e){const t=e.layer;return!(!t||!t.featureReduction||t.featureReduction.type!=="selection")}function Xmt(e){const t=e.graphics3DGraphics;t&&t.forEach(r=>r.clearVisibilityFlag(ou.DECONFLICTION))}rK=d([$("esri.views.3d.layers.graphics.GraphicsDeconflictor")],rK);const iae=(e,t,r)=>[t,r],M9=(e,t,r)=>[t,r,e[2]],nae=(e,t,r)=>[t,r,e[2],e[3]];function Ymt(e){return e?{originPosition:e.originPosition==="upper-left"?"upperLeft":e.originPosition==="lower-left"?"lowerLeft":e.originPosition,scale:e.tolerance?[e.tolerance,e.tolerance]:[1,1],translate:_(e.extent)?[e.extent.xmin,e.extent.ymax]:[0,0]}:null}function Zmt({scale:e,translate:t},r){return Math.round((r-t[0])/e[0])}function Qmt({scale:e,translate:t},r){return Math.round((t[1]-r)/e[1])}function vAe({scale:e,translate:t},r){return r*e[0]+t[0]}function _Ae({scale:e,translate:t},r){return t[1]-r*e[1]}function wAe(e,t,r){const i=new Array(r.length);if(!r.length)return i;const[n,s]=e.scale;let a=vAe(e,r[0][0]),o=_Ae(e,r[0][1]);i[0]=t(r[0],a,o);for(let l=1;l<r.length;l++){const c=r[l];a+=c[0]*n,o-=c[1]*s,i[l]=t(c,a,o)}return i}function xAe(e,t,r){const i=new Array(r.length);for(let n=0;n<r.length;n++)i[n]=wAe(e,t,r[n]);return i}function Jmt(e,t,r,i){return wAe(e,r?i?nae:M9:i?M9:iae,t)}function Kmt(e,t,r,i){return xAe(e,r?i?nae:M9:i?M9:iae,t)}function egt(e,t,r,i){return xAe(e,r?i?nae:M9:i?M9:iae,t)}function tgt(e,t,r,i,n){return t.x=Zmt(e,r.x),t.y=Qmt(e,r.y),t!==r&&(i&&(t.z=r.z),n&&(t.m=r.m)),t}function TAe(e,t,r,i,n){return _(r)&&(t.points=Jmt(e,r.points,i,n)),t}function SAe(e,t,r,i,n){return R(r)||(t.x=vAe(e,r.x),t.y=_Ae(e,r.y),t!==r&&(i&&(t.z=r.z),n&&(t.m=r.m))),t}function EAe(e,t,r,i,n){return _(r)&&(t.rings=egt(e,r.rings,i,n)),t}function CAe(e,t,r,i,n){return _(r)&&(t.paths=Kmt(e,r.paths,i,n)),t}class ELt{constructor(t,r,i){this.uid=t,this.geometry=r,this.attributes=i,this.visible=!0,this.objectId=null,this.centroid=null}}function CLt(e){return _(e.geometry)}class ALt{constructor(){this.exceededTransferLimit=!1,this.features=[],this.fields=[],this.hasM=!1,this.hasZ=!1,this.geometryType=null,this.objectIdFieldName=null,this.globalIdFieldName=null,this.geometryProperties=null,this.geohashFieldName=null,this.spatialReference=null,this.transform=null}}function RLt(e){const t=bV.fromJSON(e.geometryType),r=Ye.fromJSON(e.spatialReference),i=e.transform,n=e.features.map(s=>{const a=rgt(s,t,r,e.objectIdFieldName),o=a.geometry;if(_(o)&&i)switch(o.type){case"point":a.geometry=SAe(i,o,o,o.hasZ,o.hasM);break;case"multipoint":a.geometry=TAe(i,o,o,o.hasZ,o.hasM);break;case"polygon":a.geometry=EAe(i,o,o,o.hasZ,o.hasM);break;case"polyline":a.geometry=CAe(i,o,o,o.hasZ,o.hasM);break;case"extent":case"mesh":a.geometry=o}return a});return{geometryType:t,features:n,spatialReference:r,fields:e.fields?e.fields.map(s=>l6.fromJSON(s)):null,objectIdFieldName:e.objectIdFieldName,globalIdFieldName:e.globalIdFieldName,geohashFieldName:e.geohashFieldName,geometryProperties:e.geometryProperties,hasZ:e.hasZ,hasM:e.hasM,exceededTransferLimit:e.exceededTransferLimit,transform:null}}function rgt(e,t,r,i){return{uid:ic(),objectId:i&&e.attributes?e.attributes[i]:null,attributes:e.attributes,geometry:igt(e.geometry,t,r),visible:!0}}function igt(e,t,r){if(R(e))return null;switch(t){case"point":{const i=e;return{x:i.x,y:i.y,z:i.z,m:i.m,hasZ:i.z!=null,hasM:i.m!=null,type:"point",spatialReference:r}}case"polyline":{const i=e;return{paths:i.paths,hasZ:!!i.hasZ,hasM:!!i.hasM,type:"polyline",spatialReference:r}}case"polygon":{const i=e;return{rings:i.rings,hasZ:!!i.hasZ,hasM:!!i.hasM,type:"polygon",spatialReference:r}}case"multipoint":{const i=e;return{points:i.points,hasZ:!!i.hasZ,hasM:!!i.hasM,type:"multipoint",spatialReference:r}}}}function tb(e,t,r,i){return{x:e,y:t,z:r,hasZ:r!=null,hasM:!1,spatialReference:i,type:"point"}}function ngt(e){if(R(e))return 0;let t=32;switch(e.type){case"point":t+=42;break;case"polyline":case"polygon":{let r=0;const i=2+(e.hasZ?1:0)+(e.hasM?1:0),n=e.type==="polyline"?e.paths:e.rings;for(const s of n)r+=s.length;t+=8*r*i+64,t+=128*r,t+=34,t+=32*(n.length+1);break}case"multipoint":{const r=2+(e.hasZ?1:0)+(e.hasM?1:0),i=e.points.length;t+=8*i*r+64,t+=128*i,t+=34,t+=32;break}case"extent":t+=98,e.hasM&&(t+=32),e.hasZ&&(t+=32);break;case"mesh":t+=_M(e.vertexAttributes.position),t+=_M(e.vertexAttributes.normal),t+=_M(e.vertexAttributes.uv),t+=_M(e.vertexAttributes.tangent)}return t}function OLt(e){let t=32;return t+=ZTe(e.attributes),t+=3,t+=8+ngt(e.geometry),t}function sgt(e){if(R(e))return 0;switch(e.type){case"point":return 1;case"polyline":{let t=0;for(const r of e.paths)t+=r.length;return t}case"polygon":{let t=0;for(const r of e.rings)t+=r.length;return t}case"multipoint":return e.points.length;case"extent":return 2;case"mesh":{const t=e.vertexAttributes&&e.vertexAttributes.position;return t?t.length/3:0}default:return}}function MLt(e){if(R(e))return!1;switch(e.type){case"extent":case"point":return!0;case"polyline":for(const t of e.paths)if(t.length>0)return!0;return!1;case"polygon":for(const t of e.rings)if(t.length>0)return!0;return!1;case"multipoint":return e.points.length>0;case"mesh":return!e.loaded||e.vertexAttributes.position.length>0}}function PLt(e,t){switch(bi(t),e.type==="mesh"&&(e=e.extent),e.type){case"point":t[0]=t[3]=e.x,t[1]=t[4]=e.y,e.hasZ&&(t[2]=t[5]=e.z);break;case"polyline":for(let r=0;r<e.paths.length;r++)lG(t,e.paths[r],e.hasZ);break;case"polygon":for(let r=0;r<e.rings.length;r++)lG(t,e.rings[r],e.hasZ);break;case"multipoint":lG(t,e.points,e.hasZ);break;case"extent":t[0]=e.xmin,t[1]=e.ymin,t[3]=e.xmax,t[4]=e.ymax,e.zmin!=null&&(t[2]=e.zmin),e.zmax!=null&&(t[5]=e.zmax)}}function agt(e,t){switch(Eu(t),e.type==="mesh"&&(e=e.extent),e.type){case"point":t[0]=t[2]=e.x,t[1]=t[3]=e.y;break;case"polyline":for(let r=0;r<e.paths.length;r++)oG(t,e.paths[r]);break;case"polygon":for(let r=0;r<e.rings.length;r++)oG(t,e.rings[r]);break;case"multipoint":oG(t,e.points);break;case"extent":t[0]=e.xmin,t[1]=e.ymin,t[2]=e.xmax,t[3]=e.ymax}}function ILt(e,t){return e.objectId!=null?e.objectId:e.attributes&&t?e.attributes[t]:null}is();zt();function AAe(e){return"declaredClass"in e}function q0e(e){return"declaredClass"in e}function ogt(e){return"declaredClass"in e}function lgt(e,t){if(!e)return null;if(ogt(e))return e;const r=new co({layer:t,sourceLayer:t});return r.visible=e.visible,r.symbol=te(e.symbol),r.attributes=te(e.attributes),r.geometry=RAe(e.geometry),r}function RAe(e){return R(e)?null:AAe(e)?e:Ry(cgt(e))}function cgt(e){const t=e.spatialReference.toJSON();switch(e.type){case"point":{const{x:r,y:i,z:n,m:s}=e;return{x:r,y:i,z:n,m:s,spatialReference:t}}case"polygon":{const{rings:r,hasZ:i,hasM:n}=e;return{rings:H0e(r),hasZ:i,hasM:n,spatialReference:t}}case"polyline":{const{paths:r,hasZ:i,hasM:n}=e;return{paths:H0e(r),hasZ:i,hasM:n,spatialReference:t}}case"extent":{const{xmin:r,xmax:i,ymin:n,ymax:s,zmin:a,zmax:o,mmin:l,mmax:c,hasZ:u,hasM:h}=e;return{xmin:r,xmax:i,ymin:n,ymax:s,zmin:a,zmax:o,mmin:l,mmax:c,hasZ:u,hasM:h,spatialReference:t}}case"multipoint":{const{points:r,hasZ:i,hasM:n}=e;return{points:MAe(r)?OAe(r):r,hasZ:i,hasM:n,spatialReference:t}}default:return}}function H0e(e){return dgt(e)?e.map(t=>OAe(t)):e}function OAe(e){return e.map(t=>KDe(t))}function dgt(e){for(const t of e)if(t.length!==0)return MAe(t);return!1}function MAe(e){return e.length&&(x2e(e[0])||T2e(e[0]))}function ugt(e,t){if(!e)return null;let r;if(q0e(e)){if(t==null)return e.clone();if(q0e(t))return t.copy(e)}return t!=null?(r=t,r.x=e.x,r.y=e.y,r.spatialReference=e.spatialReference,e.hasZ?(r.z=e.z,r.hasZ=e.hasZ):(r.z=null,r.hasZ=!1),e.hasM?(r.m=e.m,r.hasM=!0):(r.m=null,r.hasM=!1)):(r=tb(e.x,e.y,e.z,e.spatialReference),e.hasM&&(r.m=e.m,r.hasM=!0)),r}const lq=fe.getLogger("esri.layers.support.labelFormatUtils"),W0e={type:"simple",evaluate:()=>null},hgt={getAttribute:(e,t)=>e.field(t)};async function PAe(e,t,r){if(!e||!e.symbol)return W0e;const i=e.where,n=wz(e),s=i?await ie(()=>import("./WhereClause.ecb0bafc.js"),[],import.meta.url):null;let a;if(n.type==="arcade"){const o=await fUe(n.expression,r,t);a={type:"arcade",evaluate(l){try{const c=o.evaluate({$feature:"attributes"in l?o.repurposeFeature(l):l});if(c!=null)return c.toString()}catch{lq.error(new k("arcade-expression-error","Encountered an error when evaluating label expression for feature",{feature:l,expression:n}))}return null},needsHydrationToEvaluate:()=>Pne(n.expression)==null}}else a={type:"simple",evaluate:o=>n.expression.replace(/{[^}]*}/g,l=>{const c=l.slice(1,-1),u=t.get(c);if(!u)return l;let h=null;return"attributes"in o?o&&o.attributes&&(h=o.attributes[u.name]):h=o.field(u.name),h==null?"":IAe(h,u)})};if(i){let o;try{o=s.WhereClause.create(i,t)}catch(c){return lq.error(new k("bad-where-clause","Encountered an error when evaluating where clause, ignoring",{where:i,error:c})),W0e}const l=a.evaluate;a.evaluate=c=>{const u="attributes"in c?void 0:hgt;try{if(o.testFeature(c,u))return l(c)}catch(h){lq.error(new k("bad-where-clause","Encountered an error when evaluating where clause for feature",{where:i,feature:c,error:h}))}return null}}return a}function IAe(e,t){if(e==null)return"";const r=t.domain;if(r){if(r.type==="codedValue"||r.type==="coded-value"){const n=e;for(const s of r.codedValues)if(s.code===n)return s.name}else if(r.type==="range"){const n=+e,s="range"in r?r.range[0]:r.minValue,a="range"in r?r.range[1]:r.maxValue;if(s<=n&&n<=a)return r.name}}let i=e;return t.type==="date"||t.type==="esriFieldTypeDate"?i=Ip(i,QR("short-date")):J9(t)&&(i=Xh(+i)),i||""}const $Lt=Object.freeze(Object.defineProperty({__proto__:null,createLabelFunction:PAe,formatField:IAe},Symbol.toStringTag,{value:"Module"}));function sae(e,t){if(e.type==="point")return vb(e,t,!1);if(AAe(e))switch(e.type){case"extent":return vb(e.center,t,!1);case"polygon":return vb(e.centroid,t,!1);case"polyline":return vb(X0e(e),t,!0);case"mesh":return vb(e.origin,t,!1)}else switch(e.type){case"extent":return vb(fgt(e),t,!0);case"polygon":return vb(pgt(e),t,!0);case"polyline":return vb(X0e(e),t,!0)}}function X0e(e){const t=e.paths[0];if(!t||t.length===0)return null;const r=Owe(t,hre(t)/2);return tb(r[0],r[1],r[2],e.spatialReference)}function fgt(e){const t=isFinite(e.zmin);return tb(.5*(e.xmax+e.xmin),.5*(e.ymax+e.ymin),t?.5*(e.zmax+e.zmin):void 0,e.spatialReference)}function pgt(e){const t=e.rings[0];if(!t||t.length===0)return null;const r=Mwe(e.rings,e.hasZ);return tb(r[0],r[1],r[2],e.spatialReference)}function vb(e,t,r){const i=r?e:ugt(e);return t&&e?Oje(e,i,t)?i:null:i}function LLt(e,t,r,i=0){if(e){t||(t=zt());const n=e;let s=.5*n.width*(r-1),a=.5*n.height*(r-1);return n.width<1e-7*n.height?s+=a/20:n.height<1e-7*n.width&&(a+=s/20),ei(t,n.xmin-s-i,n.ymin-a-i,n.xmax+s+i,n.ymax+a+i),t}return null}function $Ae(e,t){for(let r=0;r<e.geometries.length;++r){const i=e.geometries[r].getMutableAttribute(O.AUXPOS1);i&&i.data[3]!==t&&(i.data[3]=t,e.geometryVertexAttrsUpdated(e.geometryRecords[r]))}}function g7(e,t){const r=BV(Ih);return _(e)&&(r[0]=e[0],r[1]=e[1],r[2]=e[2]),_(t)?r[3]=t:_(e)&&e.length>3&&(r[3]=e[3]),r}function DLt(e,t,r,i,n,s=[0,0,0,0]){for(let a=0;a<3;++a)_(e)&&e[a]!=null?s[a]=e[a]:_(r)&&r[a]!=null?s[a]=r[a]:s[a]=n[a];return _(t)?s[3]=t:_(i)?s[3]=i:s[3]=n[3],s}function Y0e(e=X0,t,r,i=1){const n=new Array(3);if(R(t)||R(r))n[0]=1,n[1]=1,n[2]=1;else{let s,a=0;for(let o=2;o>=0;o--){const l=e[o];let c;const u=l!=null,h=o===0&&!s&&!u,p=r[o];l==="symbol-value"||h?c=p!==0?t[o]/p:1:u&&l!=="proportional"&&isFinite(l)&&(c=p!==0?l/p:1),c!=null&&(n[o]=c,s=c,a=Math.max(a,Math.abs(c)))}for(let o=2;o>=0;o--)n[o]==null?n[o]=s:n[o]===0&&(n[o]=.001*a)}for(let s=2;s>=0;s--)n[s]/=i;return Wl(n)}function mgt(e){return e.isPrimitive!=null}function iU(e){return mgt(e)&&(e=[e.width,e.depth,e.height]),ck(e)?null:"Symbol sizes may not be negative values"}function ck(e){if(Array.isArray(e)){for(const t of e)if(!ck(t))return!1;return!0}return e==null||e>=0}function ggt(e,t,r,i=Ae()){const n=e||0,s=t||0,a=r||0;return n!==0&&J5(i,i,-n/180*Math.PI),s!==0&&Q5(i,i,s/180*Math.PI),a!==0&&FV(i,i,a/180*Math.PI),i}function aae(e,t){return t.minDemResolution!=null?t.minDemResolution:SV(e)?t.minDemResolutionForPoints:.01*vBe(e)}function LAe(e,t,r,i,n,s,a,o,l,c,u){const h=Sgt[u.mode];let p,m,g=0;if(mi(e,t,r,i,l.spatialReference,n,o))return h.requiresAlignment(u)?(g=h.applyElevationAlignmentBuffer(i,n,s,a,o,l,c,u),p=s,m=a):(p=i,m=n),mi(p,l.spatialReference,m,s,c.spatialReference,a,o)?g:void 0}function zy(e,t,r,i,n){const s=(ek(e)?e.z:p7e(e)?e.array[e.offset+2]:e[2])||0;switch(r.mode){case"on-the-ground":{const a=vt(Q0(t,e,"ground"),0);return n.verticalDistanceToGround=0,n.sampledElevation=a,void(n.z=a)}case"relative-to-ground":{const a=vt(Q0(t,e,"ground"),0),o=r.geometryZWithOffset(s,i);return n.verticalDistanceToGround=o,n.sampledElevation=a,void(n.z=o+a)}case"relative-to-scene":{const a=vt(Q0(t,e,"scene"),0),o=r.geometryZWithOffset(s,i);return n.verticalDistanceToGround=o,n.sampledElevation=a,void(n.z=o+a)}case"absolute-height":{const a=r.geometryZWithOffset(s,i),o=vt(Q0(t,e,"ground"),0);return n.verticalDistanceToGround=a-o,n.sampledElevation=o,void(n.z=a)}default:return r.mode,void(n.z=0)}}function ygt(e,t,r,i){return zy(e,t,r,i,A4),A4.z}function OO(e,t,r){return t==null||r==null?e.definedChanged:t==="on-the-ground"&&r==="on-the-ground"?e.staysOnTheGround:t===r||t!=="on-the-ground"&&r!=="on-the-ground"?nn.UPDATE:e.onTheGroundChanged}function rf(e){return e==="relative-to-ground"||e==="relative-to-scene"}function l_(e){return e!=="absolute-height"}function bgt(e,t,r,i,n){zy(t,r,n,i,A4),$Ae(e,A4.verticalDistanceToGround);const s=A4.sampledElevation,a=Ln(Egt,e.transformation);return KP[0]=t.x,KP[1]=t.y,KP[2]=A4.z,Au(t.spatialReference,KP,a,i.spatialReference)?e.transformation=a:console.warn("Could not locate symbol object properly, it might be misplaced"),s}function vgt(e,t,r,i,n,s){let a=0;const o=s.spatialReference;t*=3,i*=3;for(let l=0;l<n;++l){const c=e[t+0],u=e[t+1],h=e[t+2],p=vt(s.getElevation(c,u,h,o,"ground"),0);a+=p,r[i+0]=c,r[i+1]=u,r[i+2]=p,t+=3,i+=3}return a/n}function _gt(e,t,r,i,n,s,a,o){let l=0;const c=o.calculateOffsetRenderUnits(a),u=o.featureExpressionInfoContext,h=s.spatialReference;t*=3,i*=3;for(let p=0;p<n;++p){const m=e[t+0],g=e[t+1],b=e[t+2],w=vt(s.getElevation(m,g,b,h,"ground"),0);l+=w,r[i+0]=m,r[i+1]=g,r[i+2]=u==null?b+w+c:w+c,t+=3,i+=3}return l/n}function wgt(e,t,r,i,n,s,a,o){let l=0;const c=o.calculateOffsetRenderUnits(a),u=o.featureExpressionInfoContext,h=s.spatialReference;t*=3,i*=3;for(let p=0;p<n;++p){const m=e[t+0],g=e[t+1],b=e[t+2],w=vt(s.getElevation(m,g,b,h,"scene"),0);l+=w,r[i+0]=m,r[i+1]=g,r[i+2]=u==null?b+w+c:w+c,t+=3,i+=3}return l/n}function xgt(e){const t=e.meterUnitOffset,r=e.featureExpressionInfoContext;return t!==0||r!=null}function Tgt(e,t,r,i,n,s,a,o){const l=o.calculateOffsetRenderUnits(a),c=o.featureExpressionInfoContext;t*=3,i*=3;for(let u=0;u<n;++u){const h=e[t+0],p=e[t+1],m=e[t+2];r[i+0]=h,r[i+1]=p,r[i+2]=c==null?m+l:l,t+=3,i+=3}return 0}class MO{constructor(){this.verticalDistanceToGround=0,this.sampledElevation=0,this.z=0}}var nn;(function(e){e[e.NONE=0]="NONE",e[e.UPDATE=1]="UPDATE",e[e.RECREATE=2]="RECREATE"})(nn||(nn={}));const Sgt={"absolute-height":{applyElevationAlignmentBuffer:Tgt,requiresAlignment:xgt},"on-the-ground":{applyElevationAlignmentBuffer:vgt,requiresAlignment:()=>!0},"relative-to-ground":{applyElevationAlignmentBuffer:_gt,requiresAlignment:()=>!0},"relative-to-scene":{applyElevationAlignmentBuffer:wgt,requiresAlignment:()=>!0}},Egt=Ae(),A4=new MO,KP=M();function DAe(e,t,r,i){const n=e.stageObject,s=n.geometryRecords;let a=0;for(const o of s){const{update:l,averageGeometrySampledElevation:c}=NAe(o,t,r,i);a+=c,l&&n.geometryVertexAttrsUpdated(o)}return a/s.length}function cR(e,t,r,i){const n=e.stageObject,s=t.centerPointInElevationSR;let a=0;n.metadata.usesVerticalDistanceToGround?(zy(s,r,t,i,Ql),$Ae(n,Ql.verticalDistanceToGround),a=Ql.sampledElevation):(zy(s,r,t,i,Ql),t.mode!=="absolute-height"&&(a=Ql.sampledElevation));const o=Ln(Cgt,n.transformation),l=ne(FAe,o[12],o[13],o[14]);Yr.TESTS_DISABLE_OPTIMIZATIONS?(Zl[0]=s.x,Zl[1]=s.y,Zl[2]=Ql.z,Au(s.spatialReference,Zl,o,i.spatialReference)&&(n.transformation=o)):i.setAltitudeOfTransformation(Ql.z,o);const c=oae/i.unitInMeters;return(Math.abs(o[12]-l[0])>=c||Math.abs(o[13]-l[1])>=c||Math.abs(o[14]-l[2])>=c)&&(n.transformation=o),a}const Cgt=Ae();function Agt(e,t,r,i){const n=e.graphics3DSymbolLayer.lodRenderer;if(R(n))return 0;const s=t.centerPointInElevationSR;zy(s,r,t,i,Ql);const a=t.mode!=="absolute-height"?Ql.sampledElevation:0,o=n.instanceData,l=e.instanceIndex,c=Ogt;o.getGlobalTransform(l,c);const u=ne(FAe,c[12],c[13],c[14]);Yr.TESTS_DISABLE_OPTIMIZATIONS?(Zl[0]=s.x,Zl[1]=s.y,Zl[2]=Ql.z,Au(s.spatialReference,Zl,c,i.spatialReference)&&o.setGlobalTransform(l,c)):i.setAltitudeOfTransformation(Ql.z,c);const h=oae/i.unitInMeters;return(Yr.TESTS_DISABLE_OPTIMIZATIONS||Math.abs(c[12]-u[0])>=h||Math.abs(c[13]-u[1])>=h||Math.abs(c[14]-u[2])>=h)&&o.setGlobalTransform(l,c),a}function Rgt(e,t,r,i){const n=e.stageObject,s=n.geometryRecords;if(s.length===0)return 0;let a=0,o=null,l=0,c=!1;for(const u of s){const h=u.geometry.vertexAttributes.get(O.POSITION);if(h!==o){const{update:p,averageGeometrySampledElevation:m}=NAe(u,t,r,i);l=m,o=h,c=p}c&&n.geometryVertexAttrsUpdated(u),a+=l}return a/s.length}const oae=.01,Zl=M(),Uu=M(),sT=M(),Ogt=Ae(),FAe=M(),Ql=new MO;function NAe(e,t,r,i){let n=!1;const s=r.spatialReference,a=e.geometry,o=e.getShaderTransformation(),l=t.requiresSampledElevationInfo;Uu[0]=o[12],Uu[1]=o[13],Uu[2]=o[14],a.invalidateBoundingInfo();const c=a.getMutableAttribute(O.POSITION),u=c.data,h=a.vertexAttributes.get(O.MAPPOS).data,p=c.size,m=u.length/p,g=new f7e(h,s);let b=0,w=0;for(let v=0;v<m;v++){if(sT[0]=u[b],sT[1]=u[b+1],sT[2]=u[b+2],zy(g,r,t,i,Ql),l&&(w+=Ql.sampledElevation),Yr.TESTS_DISABLE_OPTIMIZATIONS)u[b]=g.array[g.offset],u[b+1]=g.array[g.offset+1],u[b+2]=Ql.z,mi(u,s,b,u,i.spatialReference,b,1),u[b]-=Uu[0],u[b+1]-=Uu[1],u[b+2]-=Uu[2],n=!0;else{Zl[0]=u[b]+Uu[0],Zl[1]=u[b+1]+Uu[1],Zl[2]=u[b+2]+Uu[2],i.setAltitude(Zl,Ql.z),u[b]=Zl[0]-Uu[0],u[b+1]=Zl[1]-Uu[1],u[b+2]=Zl[2]-Uu[2];const x=oae/i.unitInMeters;(Math.abs(sT[0]-u[b])>=x||Math.abs(sT[1]-u[b+1])>=x||Math.abs(sT[2]-u[b+2])>=x)&&(n=!0)}b+=p,g.offset+=3}return w/=m,{update:n,averageGeometrySampledElevation:w}}const Mgt=fe.getLogger("esri.views.3d.layers.graphics.featureExpressionInfoUtils");function Pgt(e){return{cachedResult:e.cachedResult,arcade:e.arcade?{func:e.arcade.func,context:e.arcade.modules.arcadeUtils.createExecContext(null,{sr:e.arcade.context.spatialReference}),modules:e.arcade.modules}:null}}function FLt(e){const t=e&&e.expression;if(typeof t=="string"){const r=zAe(t);if(r!=null)return{cachedResult:r}}return null}async function NLt(e,t,r){const i=e&&e.expression;if(typeof i!="string")return null;const n=zAe(i);if(n!=null)return{cachedResult:n};const s=await Wh(),a=s.arcadeUtils,o=a.createSyntaxTree(i);return a.dependsOnView(o)?(r!=null&&r.error("Expressions containing '$view' are not supported on ElevationInfo"),{cachedResult:0}):{arcade:{func:a.createFunction(o),context:a.createExecContext(null,{sr:t}),modules:s}}}function kAe(e,t,r){return e.arcadeUtils.createFeature(t.attributes,t.geometry,r)}function lae(e,t){if(e!=null&&!VAe(e)){if(!t||!e.arcade)return void Mgt.errorOncePerTick("Arcade support required but not provided");const r=t;r._geometry&&(r._geometry=RAe(r._geometry)),e.arcade.modules.arcadeUtils.updateExecContext(e.arcade.context,t)}}function Igt(e){if(e!=null){if(VAe(e))return e.cachedResult;const t=e.arcade;let r=e.arcade.modules.arcadeUtils.executeFunction(t.func,t.context);return typeof r!="number"&&(e.cachedResult=0,r=0),r}return 0}function kLt(e,t=!1){let r=e&&e.featureExpressionInfo;const i=r&&r.expression;return t||i==="0"||(r=null),r}const $gt={cachedResult:0};function VAe(e){return e.cachedResult!=null}function zAe(e){return e==="0"?0:null}class Du{constructor(){this._meterUnitOffset=0,this._renderUnitOffset=0,this._unit="meters",this._metersPerElevationInfoUnit=1,this._featureExpressionInfoContext=null,this.centerPointInElevationSR=null,this.mode=null}get featureExpressionInfoContext(){return this._featureExpressionInfoContext}get meterUnitOffset(){return this._meterUnitOffset}get unit(){return this._unit}set unit(t){this._unit=t,this._metersPerElevationInfoUnit=nit(t)}get requiresSampledElevationInfo(){return this.mode!=="absolute-height"}reset(){this.mode=null,this._meterUnitOffset=0,this._renderUnitOffset=0,this._featureExpressionInfoContext=null,this.unit="meters"}set offsetMeters(t){this._meterUnitOffset=t,this._renderUnitOffset=0}set offsetElevationInfoUnits(t){this._meterUnitOffset=t*this._metersPerElevationInfoUnit,this._renderUnitOffset=0}addOffsetRenderUnits(t){this._renderUnitOffset+=t}geometryZWithOffset(t,r){const i=this.calculateOffsetRenderUnits(r);return this.featureExpressionInfoContext!=null?i:t+i}calculateOffsetRenderUnits(t){let r=this._meterUnitOffset;const i=this.featureExpressionInfoContext;return i!=null&&(r+=Igt(i)*this._metersPerElevationInfoUnit),r/t.unitInMeters+this._renderUnitOffset}setFromElevationInfo(t){this.mode=t.mode,this.unit=iit(t.unit)?t.unit:"meters",this.offsetElevationInfoUnits=vt(t.offset,0)}updateFeatureExpressionInfoContext(t,r,i){if(R(t))return void(this._featureExpressionInfoContext=null);const n=t&&t.arcade;n&&_(r)&&_(i)?(this._featureExpressionInfoContext=Pgt(t),lae(this._featureExpressionInfoContext,kAe(n.modules,r,i))):this._featureExpressionInfoContext=t}static fromElevationInfo(t){const r=new Du;return _(t)&&r.setFromElevationInfo(t),r}}var Nt;(function(e){e[e.INVISIBLE=0]="INVISIBLE",e[e.TRANSPARENT=1]="TRANSPARENT",e[e.OPAQUE=2]="OPAQUE"})(Nt||(Nt={}));class Fm{constructor(t,r,i,n,s,a,o,l=null){this.graphics3DSymbolLayer=t,this.stageObject=r,this._uniqueGeometries=i,this._uniqueMaterials=n,this._sharedResource=s,this.elevationAligner=a,this.elevationContext=o,this._edgeState=l,this.type="object3d",this._stageLayer=null,this._stage=null,this._visible=!1,this._addedToStage=!1,this.alignedSampledElevation=0,this.needsElevationUpdates=!1,this.useObjectOriginAsAttachmentOrigin=!1,this.graphics3DSymbolLayer=t,this.stageObject=r}get isElevationSource(){return!(!this.stageObject.metadata||!this.stageObject.metadata.isElevationSource)}initialize(t,r){this._stageLayer=r,this._stage=t,t.addMany(this._uniqueMaterials),t.addMany(this._uniqueGeometries),t.add(this.stageObject)}destroy(){const t=this._stage;this._stageLayer&&(t.removeMany(this._uniqueMaterials),t.removeMany(this._uniqueGeometries)),t.remove(this.stageObject),this._addedToStage&&(this._stageLayer.remove(this.stageObject),this._addedToStage=!1);const r=this._stage.renderView.ensureEdgeView();r.hasObject(this.stageObject)&&r.removeObject(this.stageObject),this.stageObject.dispose(),_(this._sharedResource)&&this._sharedResource.release(),this._visible=!1,this._stageLayer=null,this._stage=null}layerOpacityChanged(t,r){if(R(this._edgeState))return;const i=Z0e(this._edgeState.baseMaterial);let n=!1;for(const s of this._edgeState.edgeMaterials)s.objectTransparency!==i&&(s.objectTransparency=i,n=!0);n&&this._resetEdgeObject(r),this._stage.renderView.ensureEdgeView().updateAllComponentOpacities(this.stageObject,[t])}slicePlaneEnabledChanged(t,r){R(this._edgeState)||(this._stage.renderView.ensureEdgeView().updateAllComponentMaterials(this.stageObject,this._edgeState.edgeMaterials,{hasSlicePlane:t},!r),this._edgeState.properties.hasSlicePlane=t)}setVisibility(t){if(this._stage!=null&&this._visible!==t&&(this._visible=t,this._visible?this._addedToStage?this.stageObject.setVisible(!0):(this._stageLayer.add(this.stageObject),this._addedToStage=!0):this.stageObject.setVisible(!1),_(this._edgeState))){const r=this._stage.renderView.ensureEdgeView();r.hasObject(this.stageObject)?r.updateObjectVisibility(this.stageObject,t):t&&this._addOrUpdateEdgeObject(r,!1)}}get visible(){return this._visible}alignWithElevation(t,r,i,n){this.elevationAligner!=null&&(_(i)&&lae(this.elevationContext.featureExpressionInfoContext,i),this.alignedSampledElevation=this.elevationAligner(this,this.elevationContext,t,r),this._resetEdgeObject(n))}getCenterObjectSpace(t=M()){return oe(t,this.stageObject.boundingVolumeObjectSpace.bounds)}getBoundingBoxObjectSpace(t=is()){const r=this.stageObject.boundingVolumeObjectSpace;return Pxe(t,r.min),Ixe(t,r.max),t}computeAttachmentOrigin(t){if(this.useObjectOriginAsAttachmentOrigin){const r=this.stageObject.transformation;t.render.origin[0]+=r[12],t.render.origin[1]+=r[13],t.render.origin[2]+=r[14],t.render.num++}else for(const r of this.stageObject.geometryRecords)r.computeAttachmentOrigin(qm)&&(ze(qm,qm,this.stageObject.transformation),he(t.render.origin,t.render.origin,qm),t.render.num++)}async getProjectedBoundingBox(t,r,i,n,s){const a=this.getBoundingBoxObjectSpace(s),o=Lgt,l=SV(a)?1:o.length;for(let u=0;u<l;u++){const h=o[u];_b[0]=a[h[0]],_b[1]=a[h[1]],_b[2]=a[h[2]],ze(_b,_b,this.stageObject.transformation),G_[3*u+0]=_b[0],G_[3*u+1]=_b[1],G_[3*u+2]=_b[2]}if(!t(G_,0,l))return null;bi(a);let c=null;this.calculateRelativeScreenBounds&&(c=this.calculateRelativeScreenBounds());for(let u=0;u<3*l;u+=3){for(let h=0;h<3;h++)a[h]=Math.min(a[h],G_[u+h]),a[h+3]=Math.max(a[h+3],G_[u+h]);c&&i.push({location:G_.slice(u,u+3),screenSpaceBoundingRect:c})}if(r&&r.service&&this.elevationContext.mode!=="absolute-height"){fp(a,qm);const u=this.elevationContext.mode==="relative-to-scene"?"scene":"ground";let h=0;if(r.useViewElevation)h=vt(r.service.getElevation(qm[0],qm[1],u),0);else try{const p=aae(a,r);h=vt(await r.service.queryElevation(qm[0],qm[1],n,p,u),0)}catch{}Mxe(a,0,0,-this.alignedSampledElevation+h)}return a}addObjectState(t,r){t===Fy.Highlight&&r.addObject(this.stageObject,this.stageObject.highlight()),t===Fy.MaskOccludee&&r.addObject(this.stageObject,this.stageObject.maskOccludee())}removeObjectState(t){t.removeObject(this.stageObject)}_resetEdgeObject(t){if(R(this._edgeState))return;const r=this._stage.renderView.ensureEdgeView();this._visible?this._addOrUpdateEdgeObject(r,t):r.removeObject(this.stageObject)}_addOrUpdateEdgeObject(t,r){const i=this._edgeState;if(R(i))return;const n=Z0e(i.baseMaterial);for(const s of i.edgeMaterials)s.objectTransparency=n;t.addOrUpdateObject3D(this.stageObject,i.edgeMaterials,i.properties,!r).then(()=>{var s;return(s=this._stageLayer)==null?void 0:s.sync()})}}function Z0e(e){return e.isVisible?e.parameters.transparent?Nt.TRANSPARENT:Nt.OPAQUE:Nt.INVISIBLE}const G_=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],_b=M(),qm=M(),Lgt=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]];var xs;(function(e){e[e.Recreate_Symbol=0]="Recreate_Symbol",e[e.Recreate_Graphics=1]="Recreate_Graphics",e[e.Fast_Update=2]="Fast_Update"})(xs||(xs={}));class cae{constructor(t){this.schedule=t,this._loadStatus=eu.LOADING,this.logger=null}destroy(){this.abortLoad()}get loadStatus(){return this._loadStatus}load(t,r){return this._loadStatus===eu.LOADED?(t&&t(),this._loader):this._loadStatus===eu.FAILED?(r&&r(this._loadError),this._loader):(R(this._loader)&&(this._abortController=new AbortController,this._loader=this.doLoad(this._abortController.signal).then(()=>{this._abortController=null,this._loadStatus=eu.LOADED},i=>{throw this._loadError=i,this._abortController=null,this._loadStatus=eu.FAILED,!Ui(i)&&this.logger&&i.message&&this.logger.warn(i.message),i})),this._loader.then(t,r).catch(()=>{}),this._loader)}abortLoad(){_(this._abortController)?this._abortController=qh(this._abortController):this._loadStatus===eu.LOADING&&(this._loadStatus=eu.FAILED),this._loader=null}}var eu;(function(e){e[e.LOADING=0]="LOADING",e[e.LOADED=1]="LOADED",e[e.FAILED=2]="FAILED"})(eu||(eu={}));function Dgt(e){switch(e){case"sphere":case"cube":case"diamond":case"cylinder":case"cone":case"inverted-cone":case"tetrahedron":return!0}return!1}function UAe(e,t){const r=(i,n,s=!1)=>({levels:i.map(a=>{const o=n(a.tesselation);return s&&Uc.cgToGIS(o),{components:[{geometry:o,material:t}],faceCount:o.indexCount/3,minScreenSpaceRadius:a.minScreenSpaceRadius}})});switch(e){case"sphere":return r([{tesselation:0,minScreenSpaceRadius:0},{tesselation:1,minScreenSpaceRadius:8},{tesselation:2,minScreenSpaceRadius:16},{tesselation:3,minScreenSpaceRadius:50},{tesselation:4,minScreenSpaceRadius:250}],i=>Uc.createPolySphereGeometry(.5,i,!0));case"cube":return r([{tesselation:0,minScreenSpaceRadius:0}],()=>Uc.createBoxGeometry(1));case"cone":return r(cq,i=>Uc.createConeGeometry(1,.5,i,!1),!0);case"inverted-cone":return r(cq,i=>Uc.createConeGeometry(1,.5,i,!0),!0);case"cylinder":return r(cq,i=>Uc.createCylinderGeometry(1,.5,i,[0,0,1],[0,0,.5]));case"tetrahedron":return r([{tesselation:0,minScreenSpaceRadius:0}],()=>Uc.createTetrahedronGeometry(1),!0);case"diamond":return r([{tesselation:0,minScreenSpaceRadius:0}],()=>Uc.createDiamondGeometry(1),!0);default:return}}const cq=[{tesselation:6,minScreenSpaceRadius:0},{tesselation:18,minScreenSpaceRadius:7},{tesselation:64,minScreenSpaceRadius:65}];function Fgt(e){return e.type==="fill"}function Ngt(e){return e.type==="extrude"}function kgt(e){return e&&e.enabled&&(Ngt(e)||Fgt(e))&&_(e.edges)}function Vgt(e){return e&&e.enabled&&e.edges||null}function BAe(e,t){return GAe(Vgt(e),t)}function GAe(e,t){if(R(e))return null;const r=_(e.color)?rie(Te.toUnitRGBA(e.color)):Tr(0,0,0,0),i=ur(e.size),n=ur(e.extensionLength);switch(e.type){case"solid":return jAe({color:r,size:i,extensionLength:n,...t});case"sketch":return zgt({color:r,size:i,extensionLength:n,...t});default:return}}function jAe(e){return{...Ugt,...e,type:"solid"}}function zgt(e){return{...Bgt,...e,type:"sketch"}}const Ugt={color:Tr(0,0,0,.2),size:1,extensionLength:0,opacity:1,objectTransparency:Nt.OPAQUE,hasSlicePlane:!1},Bgt={color:Tr(0,0,0,.2),size:1,extensionLength:0,opacity:1,objectTransparency:Nt.OPAQUE,hasSlicePlane:!1};function eI(e){const t=[];return e.levels.forEach(r=>{r.components.forEach(i=>{t.push(i.material)})}),zR(t)}function Ggt(e){const t=new Array;return e.levels.forEach(r=>{r.components.forEach(i=>{i.textures&&t.push(...i.textures)})}),zR(t)}function dae(e){const t=[];return e.components.forEach(r=>{t.push(r.geometry)}),zR(t)}function jgt(e){const t=[];return e.levels.forEach(r=>{r.components.forEach(i=>{t.push(i.geometry)})}),zR(t)}function qgt(e){return dae(e).reduce((t,r)=>t+r.indexCount/3,0)}const uae={primitivesPerFeature:0,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!0,memory:{bytesPerFeature:0,bytesPerCoordinate:0,bytesPerFeatureLabel:0,draped:{bytesPerFeature:0,bytesPerFeatureLabel:0,bytesPerCoordinate:0}}};function VLt(e){return e.type==="web-style"?uae:hae(e.symbolLayers.toArray().map(t=>qAe(e,t)))}function hae(e){let t=0,r=0,i=0,n=!1,s=0;const a={bytesPerFeature:0,bytesPerFeatureLabel:0,bytesPerCoordinate:0,draped:{bytesPerFeature:0,bytesPerFeatureLabel:0,bytesPerCoordinate:0}};for(const o of e)R(o)||(t+=o.primitivesPerFeature,r+=o.primitivesPerCoordinate,i+=o.drawCallsPerFeature,a.bytesPerFeature+=o.memory.bytesPerFeature,a.bytesPerFeatureLabel+=o.memory.bytesPerFeatureLabel,a.bytesPerCoordinate+=o.memory.bytesPerCoordinate,a.draped.bytesPerFeature+=o.memory.bytesPerFeature,a.draped.bytesPerFeatureLabel+=o.memory.bytesPerFeatureLabel,a.draped.bytesPerCoordinate+=o.memory.bytesPerCoordinate,n=n||o.estimated,++s);return{primitivesPerFeature:t,primitivesPerCoordinate:r,drawCallsPerFeature:i,estimated:n,memory:a,numComplexities:s}}function zLt(e){const t=hae(e);return t.numComplexities>0&&(t.primitivesPerFeature/=t.numComplexities,t.primitivesPerCoordinate/=t.numComplexities,t.drawCallsPerFeature/=t.numComplexities,t.memory.bytesPerFeature/=t.numComplexities,t.memory.bytesPerFeatureLabel/=t.numComplexities,t.memory.bytesPerCoordinate/=t.numComplexities,t.memory.draped.bytesPerFeature/=t.numComplexities,t.memory.draped.bytesPerFeatureLabel/=t.numComplexities,t.memory.draped.bytesPerCoordinate/=t.numComplexities),t}const Q0e={};function qAe(e,t){const r=HAe(e,t),i=kgt(t)?2:0;switch(t.type){case"extrude":return{primitivesPerFeature:-4,primitivesPerCoordinate:4,drawCallsPerFeature:i,estimated:!1,memory:r};case"fill":return e.type==="mesh-3d"?{primitivesPerFeature:0,primitivesPerCoordinate:0,drawCallsPerFeature:i,estimated:!1,memory:r}:_(t.outline)&&t.outline.size>0?{primitivesPerFeature:-4,primitivesPerCoordinate:3,drawCallsPerFeature:0,estimated:!1,memory:r}:{primitivesPerFeature:-2,primitivesPerCoordinate:1,drawCallsPerFeature:0,estimated:!1,memory:r};case"water":return{primitivesPerFeature:-2,primitivesPerCoordinate:1,drawCallsPerFeature:0,estimated:!1,memory:r};case"line":return{primitivesPerFeature:-2,primitivesPerCoordinate:2,drawCallsPerFeature:0,estimated:!1,memory:r};case"object":return t.resource&&t.resource.href?{primitivesPerFeature:16,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!0,memory:r}:{...Hgt(t.resource&&t.resource.primitive||Nre),memory:r};case"path":{let o=0,l=0;switch(t.profile){case"circle":o=10;break;case"quad":o=4;break;default:return void(t.profile,void 0)}switch(t.join){case"round":l=3;break;case"miter":case"bevel":l=1;break;default:return void(t.join,void 0)}const c=2*o,u=o*l*2;let h=-2*u-c;switch(t.cap){case"none":break;case"butt":case"square":h+=2*(o-1);break;case"round":h+=2*(o*(3-1)*2+o);break;default:return}return{primitivesPerFeature:h,primitivesPerCoordinate:u+c,drawCallsPerFeature:0,estimated:!1,memory:r}}case"text":case"icon":return{primitivesPerFeature:2,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1,memory:r};default:return}}function HAe(e,t){const r=e.type==="point-3d";switch(t.type){case"extrude":return t.edges&&t.edges.size>0?Rl.EXTRUDE_EDGES:Rl.EXTRUDE;case"fill":return _(t.outline)&&t.outline.size>0?Rl.FILL_OUTLINE:Rl.FILL;case"water":return Rl.FILL;case"line":return t.join==="round"?Rl.LINE_ROUND:Rl.LINE_MITER;case"path":switch(t.join){case"round":switch(t.profile){case"circle":return Rl.PATH_ROUND_CIRCLE;case"quad":return Rl.PATH_ROUND_QUAD;default:return void(t.profile,void 0)}case"miter":case"bevel":switch(t.profile){case"circle":return Rl.PATH_MITER_CIRCLE;case"quad":return Rl.PATH_MITER_QUAD;default:return void(t.profile,void 0)}default:return void(t.join,void 0)}case"object":return r?Rl.OBJECT_POINT:Rl.OBJECT_POLYGON;case"icon":case"text":return r?Rl.ICON_POINT:Rl.ICON_POLYGON;default:return}}function Hgt(e){let t=Q0e[e];if(t)return t;const r=UAe(e,null);return t={primitivesPerFeature:dae(r.levels[0]).reduce((i,n)=>i+n.indices.get(O.POSITION).length/3,0),primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1},Q0e[e]=t,t}const Rl={ICON_POINT:{bytesPerFeature:7127.413186968842,bytesPerFeatureLabel:4826.302896296296,bytesPerCoordinate:0,draped:{bytesPerFeature:3929.4396628895197,bytesPerFeatureLabel:3550.1332222222227,bytesPerCoordinate:0}},ICON_POLYGON:{bytesPerFeature:9329.452613976147,bytesPerFeatureLabel:3675.3372604938268,bytesPerCoordinate:60.177252982212096,draped:{bytesPerFeature:6190.247450139383,bytesPerFeatureLabel:3744.074358024691,bytesPerCoordinate:59.488211068026104}},OBJECT_POINT:{bytesPerFeature:2350.5884192634558,bytesPerFeatureLabel:4446.651003703703,bytesPerCoordinate:0,draped:{bytesPerFeature:2350.5884192634558,bytesPerFeatureLabel:4446.651003703703,bytesPerCoordinate:0}},OBJECT_POLYGON:{bytesPerFeature:4583.807620302299,bytesPerFeatureLabel:3665.342685185186,bytesPerCoordinate:60.11621818101506,draped:{bytesPerFeature:4583.807620302299,bytesPerFeatureLabel:3665.342685185186,bytesPerCoordinate:60.11621818101506}},LINE_MITER:{bytesPerFeature:7321.028181375921,bytesPerFeatureLabel:4048.0226716049388,bytesPerCoordinate:186.55621386363578,draped:{bytesPerFeature:4246.856619435009,bytesPerFeatureLabel:3852.3737679012347,bytesPerCoordinate:163.47884002621583}},LINE_ROUND:{bytesPerFeature:7482.205842738954,bytesPerFeatureLabel:4045.886987654321,bytesPerCoordinate:191.5452524171851,draped:{bytesPerFeature:4473.481387957992,bytesPerFeatureLabel:3842.1112395061728,bytesPerCoordinate:167.27703460226945}},PATH_MITER_CIRCLE:{bytesPerFeature:9010.489006415351,bytesPerFeatureLabel:4230.9109,bytesPerCoordinate:4618.2594178027275,draped:{bytesPerFeature:9010.489006415351,bytesPerFeatureLabel:4230.9109,bytesPerCoordinate:4618.2594178027275}},PATH_ROUND_CIRCLE:{bytesPerFeature:4104.727250200398,bytesPerFeatureLabel:4251.8525,bytesPerCoordinate:8019.043777064957,draped:{bytesPerFeature:4104.727250200398,bytesPerFeatureLabel:4251.8525,bytesPerCoordinate:8019.043777064957}},PATH_MITER_QUAD:{bytesPerFeature:9416.372942261387,bytesPerFeatureLabel:4241.2757,bytesPerCoordinate:3176.7222742582203,draped:{bytesPerFeature:9416.372942261387,bytesPerFeatureLabel:4241.2757,bytesPerCoordinate:3176.7222742582203}},PATH_ROUND_QUAD:{bytesPerFeature:6614.431545308682,bytesPerFeatureLabel:4206.7461,bytesPerCoordinate:5141.817789093826,draped:{bytesPerFeature:6614.431545308682,bytesPerFeatureLabel:4206.7461,bytesPerCoordinate:5141.817789093826}},FILL:{bytesPerFeature:9478.244183633637,bytesPerFeatureLabel:3713.816824691358,bytesPerCoordinate:95.9343604185578,draped:{bytesPerFeature:6287.911108168086,bytesPerFeatureLabel:3790.785032098766,bytesPerCoordinate:83.08783220478168}},FILL_OUTLINE:{bytesPerFeature:13085.871870349445,bytesPerFeatureLabel:3392.613241975309,bytesPerCoordinate:118.63968023169875,draped:{bytesPerFeature:8437.199992480122,bytesPerFeatureLabel:3973.5431172839503,bytesPerCoordinate:106.33556817014312}},EXTRUDE:{bytesPerFeature:19459.53727140414,bytesPerFeatureLabel:3743.7045209876546,bytesPerCoordinate:372.6819978900477,draped:{bytesPerFeature:19459.53727140414,bytesPerFeatureLabel:3743.7045209876546,bytesPerCoordinate:372.6819978900477}},EXTRUDE_EDGES:{bytesPerFeature:22266.888534913724,bytesPerFeatureLabel:3064.3193358024696,bytesPerCoordinate:374.3725221561312,draped:{bytesPerFeature:22266.888534913724,bytesPerFeatureLabel:3064.3193358024696,bytesPerCoordinate:374.3725221561312}}},tI=fe.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayer");class Nm extends cae{constructor(t,r,i,n){super(i.schedule),this._context=i,this._elevationInfoOverride=null,this._ignoreDrivers=!1,this._drivenProperties={color:!1,opacity:!1,opacityAlwaysOpaque:!0,size:!1},this.complexity=null,this.logger=tI,this._elevationOptions={supportsOffsetAdjustment:!1,supportsOnTheGround:!0},this.symbol=t,this.symbolLayer=r,this._renderPriority=n.renderPriority,this._renderPriorityStep=n.renderPriorityStep,this._elevationContext=new Du,this.complexity=this.computeComplexity(),this._ignoreDrivers=n.ignoreDrivers,this._ignoreDrivers||(this._drivenProperties=J0e(this._context.renderer)),this._updateElevationContext()}getCachedSize(){return null}get extentPadding(){return 0}_drivenPropertiesChanged(t){if(this._ignoreDrivers)return!1;const r=this._drivenProperties,i=J0e(t);return i.color!==r.color||i.opacity!==r.opacity||i.opacityAlwaysOpaque!==r.opacityAlwaysOpaque||i.size!==r.size}get needsDrivenTransparentPass(){return this._drivenProperties.opacity&&!this._drivenProperties.opacityAlwaysOpaque}_logGeometryCreationWarnings(t,r,i,n){const s=t.projectionSuccess,a="polygons"in t?t.polygons:null,o=`${n} geometry failed to be created`;let l=null;s?!r.length||r.length===1&&!r[0].length?l=`${o} (no ${i} were defined)`:Array.isArray(r)&&Array.isArray(r[0])?a&&a.length===0&&i==="rings"&&r.length>0&&r[0].length>2&&(l=`${o} (filled rings should use clockwise winding - try reversing the order of vertices)`):l=`${o} (${i} should be defined as a 2D array)`:l=`${o} (failed to project geometry to view spatial reference)`,l&&tI.warnOncePerTick(l)}_validateGeometry(t,r=null,i=null){if(_(r)&&!r.includes(t.type))return this.logger.warn("unsupported geometry type for "+i+` symbol: ${t.type}`),!1;if(t.type==="point"){const n=t;if(!isFinite(n.x)||!isFinite(n.y))return tI.warn("point coordinate is not a valid number, graphic skipped"),!1}return!0}_defaultElevationInfoNoZ(){return Wgt}_defaultElevationInfoZ(){return Xgt}_updateElevationContext(){_(this._elevationInfoOverride)?(this._elevationContext.setFromElevationInfo(this._elevationInfoOverride),this._elevationContext.updateFeatureExpressionInfoContext(null)):this._context.layer.elevationInfo?(this._elevationContext.setFromElevationInfo(this._context.layer.elevationInfo),this._elevationContext.updateFeatureExpressionInfoContext(this._context.featureExpressionInfoContext)):this._elevationContext.reset()}getDefaultElevationInfo(t){return t.hasZ?this._defaultElevationInfoZ():this._defaultElevationInfoNoZ()}getGeometryElevationMode(t,r=this.getDefaultElevationInfo(t)){return this._elevationContext.mode||r.mode}setElevationInfoOverride(t){this._elevationInfoOverride=t,this._updateElevationContext()}setGraphicElevationContext(t,r){const i=t.geometry,n=this.getDefaultElevationInfo(i);r.unit=this._elevationContext.unit!=null?this._elevationContext.unit:n.unit,r.mode=this.getGeometryElevationMode(i,n),r.offsetMeters=vt(this._elevationContext.meterUnitOffset,vt(n.offset,0));const s=!this._elevationOptions.supportsOnTheGround&&r.mode==="on-the-ground";s&&(r.mode="relative-to-ground",r.offsetMeters=0);const a=s?$gt:this._elevationContext.featureExpressionInfoContext;return r.updateFeatureExpressionInfoContext(a,t,this._context.layer),r}prepareSymbolLayerPatch(t){}updateGeometry(t,r){return!1}onRemoveGraphic(t){}_getLayerOpacity(){if(this._context.graphicsCoreOwner&&"fullOpacity"in this._context.graphicsCoreOwner)return this._context.graphicsCoreOwner.fullOpacity;const t=this._context.layer.opacity;return t==null?1:t}_getCombinedOpacity(t,r=K0e){let i=1;return this.draped||(i*=this._getLayerOpacity()),this._drivenProperties.opacity||(_(t)?i*=t.a:r.hasIntrinsicColor||(i=0)),i}_getCombinedOpacityAndColor(t,r=K0e){const i=this._getCombinedOpacity(t,r);if(this._drivenProperties.color)return g7(null,i);const n=_(t)?Te.toUnitRGB(t):X0;return g7(n,i)}_getVertexOpacityAndColor(t,r=null){const i=this._drivenProperties.color?t.color:null,n=this._drivenProperties.opacity?t.opacity:null,s=g7(i,n);return _(r)&&(s[0]*=r,s[1]*=r,s[2]*=r,s[3]*=r),s}isFastUpdatesEnabled(){return this._fastUpdates&&this._fastUpdates.enabled}computeComplexity(){return qAe(this.symbol,this.symbolLayer)}globalPropertyChanged(t,r,i){switch(t){case"opacity":return this.layerOpacityChanged(r,i);case"elevationInfo":{const n=this._elevationContext.mode;return this._updateElevationContext(),this.layerElevationInfoChanged(r,i,n)!==nn.RECREATE}case"slicePlaneEnabled":return this.slicePlaneEnabledChanged(r,i);case"physicalBasedRenderingEnabled":return this.physicalBasedRenderingChanged();case"pixelRatio":return this.pixelRatioChanged();default:return!1}}updateGraphics3DGraphicElevationInfo(t,r,i){let n=nn.UPDATE;return t.forEach(s=>{const a=r(s);if(_(a)){const o=s.graphic;this.setGraphicElevationContext(o,a.elevationContext),a.needsElevationUpdates=i(a.elevationContext.mode)}else n=nn.RECREATE}),n}applyRendererDiff(t,r){return xs.Recreate_Symbol}getFastUpdateAttrValues(t){if(!this._fastUpdates.enabled)return null;const r=this._fastUpdates.visualVariables,i=r.size?my(r.size.field,t):0,n=r.color?my(r.color.field,t):0,s=r.opacity?my(r.opacity.field,t):0;return Tr(i,n,s,0)}get draped(){return this._draped}ensureDrapedStatus(t){return this._draped==null?(this._draped=t,!0):(t!==this.draped&&tI.warnOnce("A symbol can only produce either draped or non-draped visualizations. Use two separate symbol instances for draped and non-draped graphics if necessary."),!1)}test(){const t=()=>{var r,i,n,s,a,o,l,c,u,h,p,m,g,b,w,v;return{size:(s=(n=(i=(r=this._fastUpdates)==null?void 0:r.visualVariables)==null?void 0:i.size)==null?void 0:n.field)!=null?s:null,color:(c=(l=(o=(a=this._fastUpdates)==null?void 0:a.visualVariables)==null?void 0:o.color)==null?void 0:l.field)!=null?c:null,opacity:(m=(p=(h=(u=this._fastUpdates)==null?void 0:u.visualVariables)==null?void 0:h.opacity)==null?void 0:p.field)!=null?m:null,rotation:(v=(w=(b=(g=this._fastUpdates)==null?void 0:g.visualVariables)==null?void 0:b.rotation)==null?void 0:w.field)!=null?v:null}};return{drivenProperties:this._drivenProperties,getVisVarFields:t}}}function my(e,t){const r=e!=null?t.attributes[e]:0;return r!=null&&isFinite(r)?r:0}function J0e(e){const t={color:!1,opacity:!1,opacityAlwaysOpaque:!0,size:!1};return e&&"visualVariables"in e&&e.visualVariables&&e.visualVariables.forEach(r=>{switch(r.type){case"color":if(t.color=!0,r.stops)for(let i=0;i<r.stops.length;i++){const n=r.stops[i].color;n&&(t.opacity=!0,n.a<1&&(t.opacityAlwaysOpaque=!1))}break;case"opacity":t.opacity=!0,t.opacityAlwaysOpaque=!1;break;case"size":t.size=!0}}),t}const Wgt={mode:"on-the-ground",offset:0,unit:"meters"},Xgt={mode:"absolute-height",offset:0,unit:"meters"},K0e={hasIntrinsicColor:!1};class nx{constructor(){this._disposed=!1}get disposed(){return this._disposed}get shaderTransformation(){return this._shaderTransformation}acquire(t,r,i,n,s,a){this.id=ic(),this.geometry=t,this.material=r,this.transformation=i,this.instanceParameters=n,this.origin=s,this._shaderTransformation=a,this._disposed=!1}release(){this._disposed=!1}dispose(){this._disposed=!0}getStaticTransformation(){return this.transformation}getShaderTransformation(){return _(this._shaderTransformation)?this._shaderTransformation(this.transformation):this.transformation}computeAttachmentOrigin(t){return!!(this.material.computeAttachmentOrigin?this.material.computeAttachmentOrigin(this.geometry,t):this.geometry.computeAttachmentOrigin(t))&&(ze(t,t,this.getStaticTransformation()),!0)}}nx.pool=new Fn(nx);class dk{constructor(t){this.channel=t,this.id=ic()}}class rb extends wO{constructor(t={}){super(),this.type=Np.Object,this._geometryRecords=new Array,this._geometries=new Array,this._objectTransformation=Ae(),this._bvObjectSpace=new eme,this._bvWorldSpace=new eme,this._bvDirty=!0,this._hasVolatileTransformation=!1,this._visible=!0,this.castShadow=t.castShadow==null||t.castShadow,this.metadata=t.metadata,this.metadata&&this.metadata.isElevationSource&&(this.metadata.lastValidElevationBB=new WAe),this.transformation=Ae();const{geometries:r,materials:i,transformations:n,origins:s}=t;if(Array.isArray(r)){pt(i.length===r.length,"Object3D: materials don't match geometries"),pt(n.length===r.length,"Object3D: transformations don't match geometries"),this._geometryRecords.length=r.length,this._geometries.length=r.length;for(let a=0;a<r.length;a++)this._geometries[a]=r[a],this._geometryRecords[a]=nx.pool.acquire(r[a],i[a],dw(n[a]),{highlights:null,occludees:null,visible:this._visible},s&&s[a])}}get geometryRecords(){return this._geometryRecords}get geometries(){return this._geometries}get transformation(){return this._objectTransformation}set transformation(t){Ln(this._objectTransformation,t),this._invalidateBoundingVolume(),this._emit("objectTransformation",this)}dispose(){this._geometryRecords.length=0,this._geometries.length=0}get parentLayer(){return this._parentLayer}set parentLayer(t){pt(this._parentLayer==null||t==null,"Object3D can only be added to a single Layer"),this._parentLayer=t}addGeometry(t,r,i,n,s){i=i||Es,this._geometries.push(t);const a=nx.pool.acquire(t,r,i,{highlights:null,occludees:null,visible:this._visible},n,s);return this._geometryRecords.push(a),this._hasVolatileTransformation=this._hasVolatileTransformation||_(a.shaderTransformation),this._emit("objectGeometryAdded",{object:this,record:a}),this._invalidateBoundingVolume(),a}removeGeometry(t){const r=this._geometryRecords.splice(t,1)[0];return this._hasVolatileTransformation=_(r.shaderTransformation)?this._geometryRecords.some(i=>_(i.shaderTransformation)):this._hasVolatileTransformation,r.dispose(),this._geometries.splice(t,1),this._emit("objectGeometryRemoved",{object:this,record:r}),this._invalidateBoundingVolume(),r}removeAllGeometries(){for(;this.geometryRecords.length>0;)this.removeGeometry(0)}geometryVertexAttrsUpdated(t){this._emit("vertexAttrsUpdated",{object:this,record:t}),this._invalidateBoundingVolume()}get isVisible(){return this._visible}setVisible(t){if(this._visible!==t){this._visible=t;for(const r of this._geometryRecords)r.instanceParameters.visible=this._visible;this._emit("visibilityChanged",this)}}maskOccludee(){const t=new dk(Fy.MaskOccludee);for(const r of this._geometryRecords)r.instanceParameters.occludees=UJ(r.instanceParameters.occludees,t);return this._emit("occlusionChanged",this),t}removeOcclude(t){for(const r of this._geometryRecords)r.instanceParameters.occludees=BJ(r.instanceParameters.occludees,t);this._emit("occlusionChanged",this)}highlight(){const t=new dk(Fy.Highlight);for(const r of this._geometryRecords)r.instanceParameters.highlights=UJ(r.instanceParameters.highlights,t);return this._emit("highlightChanged",this),t}removeHighlight(t){for(const r of this._geometryRecords)r.instanceParameters.highlights=BJ(r.instanceParameters.highlights,t);this._emit("highlightChanged",this)}getCombinedStaticTransformation(t,r){return Zi(vt(r,Ae()),this.transformation,t.getStaticTransformation())}_getCombinedShaderTransformation(t,r){return r=r||Ae(),Zi(r,this.transformation,t.getShaderTransformation()),r}hasVolativeTransformation(){return this._hasVolatileTransformation}get boundingVolumeWorldSpace(){return this._validateBoundingVolume(),this._bvWorldSpace}get boundingVolumeObjectSpace(){return this._validateBoundingVolume(),this._bvObjectSpace}_validateBoundingVolume(){if(!this._bvDirty&&!this._hasVolatileTransformation)return;this._bvObjectSpace.init(),this._bvWorldSpace.init();for(let n=0;n<this._geometryRecords.length;++n){const s=this._geometries[n],a=this._geometryRecords[n],o=s.boundingInfo;_(o)&&(this._calculateTransformedBoundingVolume(o,this._bvObjectSpace,a.getShaderTransformation()),this._calculateTransformedBoundingVolume(o,this._bvWorldSpace,this._getCombinedShaderTransformation(a)))}As(this._bvObjectSpace.bounds,this._bvObjectSpace.min,this._bvObjectSpace.max,.5),As(this._bvWorldSpace.bounds,this._bvWorldSpace.min,this._bvWorldSpace.max,.5);const t=M(),r=M(),i=Vw(this.transformation);for(let n=0;n<this._geometryRecords.length;++n){const s=this._geometries[n].boundingInfo;if(R(s))continue;const a=this._geometryRecords[n].getShaderTransformation(),o=Vw(a);ze(t,s.getCenter(),a);const l=fi(t,this._bvObjectSpace.bounds),c=s.getBSRadius()*o;this._bvObjectSpace.bounds[3]=Math.max(this._bvObjectSpace.bounds[3],l+c),ze(r,t,this.transformation);const u=fi(r,this._bvWorldSpace.bounds),h=c*i;this._bvWorldSpace.bounds[3]=Math.max(this._bvWorldSpace.bounds[3],u+h)}this._bvDirty=!1}_calculateTransformedBoundingVolume(t,r,i){const n=t.getBBMin(),s=t.getBBMax(),a=Kn(n),o=Kn(s);ze(a,a,i),ze(o,o,i);for(let l=0;l<3;++l)r.min[l]=Math.min(r.min[l],a[l],o[l]),r.max[l]=Math.max(r.max[l],a[l],o[l]);for(let l=0;l<3;++l){oe(a,n),oe(o,s),a[l]=s[l],o[l]=n[l],ze(a,a,i),ze(o,o,i);for(let c=0;c<3;++c)r.min[c]=Math.min(r.min[c],a[c],o[c]),r.max[c]=Math.max(r.max[c],a[c],o[c])}}_invalidateBoundingVolume(){this._bvDirty=!0,_(this._parentLayer)&&this._parentLayer.notifyObjectBBChanged(this,this._bvWorldSpace.bounds)}_emit(t,r){_(this._parentLayer)&&this._parentLayer.events.emit(t,r)}get test(){const t=this;return{hasGeometry:r=>t._geometries.includes(r),getGeometryIndex:r=>t._geometries.indexOf(r)}}}class WAe{constructor(){this.min=Ve(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this.max=Ve(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE)}isEmpty(){return this.max[0]<this.min[0]&&this.max[1]<this.min[1]&&this.max[2]<this.min[2]}}class eme extends WAe{constructor(){super(...arguments),this.bounds=Us()}init(){ne(this.min,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),ne(this.max,-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),ySe(this.bounds)}}const mv=M();function fae(e,t,r,i,n,s,a,o){const l=r?r.length:0,c=e.clippingExtent;if(oa(t,mv,e.elevationProvider.spatialReference),_(c)&&!Lre(c,mv))return null;oa(t,mv,e.renderCoordsHelper.spatialReference);const u=e.localOriginFactory.getOrigin(mv),h=new rb({castShadow:!1,metadata:{layerUid:s,graphicUid:a,usesVerticalDistanceToGround:!0}});for(let p=0;p<l;p++){const m=Es;h.addGeometry(r[p],i[p],m,u,o)}return{object:h,sampledElevation:bgt(h,t,e.elevationProvider,e.renderCoordsHelper,n)}}function dR(e,t,r){const i=e.elevationContext,n=r.spatialReference;oa(t,mv,n),i.centerPointInElevationSR=tb(mv[0],mv[1],t.hasZ?mv[2]:0,n)}function uR(e){switch(e.type){case"point":return e;case"polygon":case"extent":return sae(e);case"polyline":{const t=e.paths[0];if(!t||t.length===0)return null;const r=Owe(t,hre(t)/2);return tb(r[0],r[1],r[2],e.spatialReference)}case"mesh":return e.origin}return null}function Ygt(e){const t=new Qr;t.include(Tse),t.include(j7e,e),t.include(Cn,e),t.attributes.add(O.UV0,"vec2");const{vertex:r,fragment:i}=t;return r.uniforms.add([new cr("viewport",(n,s)=>s.camera.fullViewport),new He("lineSize",(n,s)=>Math.ceil(n.size)*s.camera.pixelRatio),new _r("pixelToNDC",(n,s)=>vr(rme,2/s.camera.fullViewport[2],2/s.camera.fullViewport[3])),new He("borderSize",(n,s)=>_(n.borderColor)?s.camera.pixelRatio:0),new _r("screenOffset",(n,s)=>vr(rme,n.screenOffset[0]*s.camera.pixelRatio,n.screenOffset[1]*s.camera.pixelRatio))]),t.varyings.add("coverageSampling","vec4"),t.varyings.add("lineSizes","vec2"),e.hasMultipassGeometry&&t.varyings.add("depth","float"),e.hasScreenSizePerspective&&Xz(r),r.code.add(S`
    void main(void) {
      ProjectHUDAux projectAux;
      vec4 endPoint = projectPositionHUD(projectAux);

      vec3 vpos = projectAux.posModel;
      if (rejectBySlice(vpos)) {
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }
    ${e.occlusionTestEnabled?S`
      if (!testVisibilityHUD(endPoint)) {
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }`:""}

    ${e.hasScreenSizePerspective?S`
      vec4 perspectiveFactor = screenSizePerspectiveScaleFactor(projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);
      vec2 screenOffsetScaled = applyScreenSizePerspectiveScaleFactorVec2(screenOffset, perspectiveFactor);
        `:S`
      vec2 screenOffsetScaled = screenOffset;
        `}
      // Add view dependent polygon offset to get exact same original starting point. This is mostly
      // used to get the correct depth value
      vec3 posView = (view * vec4(position, 1.0)).xyz;
      ${e.hasMultipassGeometry?"depth = posView.z;":""}

      applyHUDViewDependentPolygonOffset(auxpos1.w, projectAux.absCosAngle, posView);
      vec4 startPoint = proj * vec4(posView, 1.0);
      // Apply screen offset to both start and end point
      vec2 screenOffsetNorm = screenOffsetScaled * 2.0 / viewport.zw;
      startPoint.xy += screenOffsetNorm * startPoint.w;
      endPoint.xy += screenOffsetNorm * endPoint.w;
      // Align start and end to pixel origin
      vec4 startAligned = alignToPixelOrigin(startPoint, viewport.zw);
      vec4 endAligned = alignToPixelOrigin(endPoint, viewport.zw);
    ${e.depthHudEnabled?e.depthHudAlignStartEnabled?S`endAligned = vec4(endAligned.xy / endAligned.w * startAligned.w, startAligned.zw);`:S`startAligned = vec4(startAligned.xy / startAligned.w * endAligned.w, endAligned.zw);`:""}
      vec4 projectedPosition = mix(startAligned, endAligned, uv0.y);
      // The direction of the line in screen space
      vec2 screenSpaceDirection = normalize(endAligned.xy / endAligned.w - startAligned.xy / startAligned.w);
      vec2 perpendicularScreenSpaceDirection = vec2(screenSpaceDirection.y, -screenSpaceDirection.x);
    ${e.hasScreenSizePerspective?S`
      float lineSizeScaled = applyScreenSizePerspectiveScaleFactorFloat(lineSize, perspectiveFactor);
      float borderSizeScaled = applyScreenSizePerspectiveScaleFactorFloat(borderSize, perspectiveFactor);
        `:S`
      float lineSizeScaled = lineSize;
      float borderSizeScaled = borderSize;
        `}
      float halfPixelSize = lineSizeScaled * 0.5;
      // Calculate a pixel offset from the edge of the pixel, s.t. we keep the line aligned
      // to pixels if it has a full pixel size. Since pixel aligned biases to the bottom-left,
      // we bias the size to the right (for odd sizes) to balance out the bias. Grow sub-pixel
      // sizes towards the left or right s.t. there is a smooth transition (e.g. from 2 to 3 px).
      float halfWholePixelSize = floor(lineSizeScaled) * 0.5;
      float halfPixelSizeInt = floor(halfWholePixelSize);

      // Sub-pixel offset if we need to grow sub-pixels to the left
      float subpixelOffset = -fract(lineSizeScaled) * float(halfWholePixelSize > 0.0);

      // Pixel offset aligning to whole pixels and adding subpixel offset if needed
      float pixelOffset = -halfPixelSizeInt + subpixelOffset;

      // Compute full ndc offset, adding 1px padding for doing anti-aliasing and the border size
      float padding = 1.0 + borderSizeScaled;
      vec2 ndcOffset = (pixelOffset - padding + uv0.x * (lineSizeScaled + padding + padding)) * pixelToNDC;

      // Offset x/y from the center of the line in screen space
      projectedPosition.xy += perpendicularScreenSpaceDirection * ndcOffset * projectedPosition.w;

      // Compute a coverage varying which we can use in the fragment shader to determine
      // how much a pixel is actually covered by the line (i.e. to anti alias the line).
      // This works by computing two coordinates that can be linearly interpolated and then
      // subtracted to find out how far away from the line edge we are.
      float edgeDirection = (uv0.x * 2.0 - 1.0);

      float halfBorderSize = 0.5 * borderSizeScaled;
      float halfPixelSizeAndBorder = halfPixelSize + halfBorderSize;
      float outerEdgeCoverageSampler = edgeDirection * (halfPixelSizeAndBorder + halfBorderSize + 1.0);

      float isOneSided = float(lineSizeScaled < 2.0 && borderSize < 2.0);

      coverageSampling = vec4(
        // Edge coordinate
        outerEdgeCoverageSampler,

        // Border edge coordinate
        outerEdgeCoverageSampler - halfPixelSizeAndBorder * isOneSided,

        // Line offset
        halfPixelSize - 0.5,

        // Border offset
        halfBorderSize - 0.5 + halfPixelSizeAndBorder * (1.0 - isOneSided)
      );

      lineSizes = vec2(lineSizeScaled, borderSizeScaled);

      gl_Position = projectedPosition;
    }
  `),i.uniforms.add([new cr("uColor",n=>tme(n.color)),new cr("borderColor",n=>tme(n.borderColor))]),e.hasMultipassGeometry&&(i.include(uCe,e),i.uniforms.add(new _r("inverseViewport",(n,s)=>s.inverseViewport))),i.code.add(S`
    void main() {
      ${e.hasMultipassGeometry?"if( geometryDepthTest(gl_FragCoord.xy * inverseViewport, depth) ){ discard; }":""}

      // Mix between line and border coverage offsets depending on whether we need
      // a border (based on the sidedness).
      vec2 coverage = min(1.0 - clamp(abs(coverageSampling.xy) - coverageSampling.zw, 0.0, 1.0), lineSizes);

      // Mix between border and line color based on the line coverage (conceptually the line
      // blends on top of the border background).
      //
      // Anti-alias by blending final result using the full (including optional border) coverage
      // and the color alpha
      float borderAlpha = uColor.a * borderColor.a * coverage.y;
      float colorAlpha = uColor.a * coverage.x;

      float finalAlpha = mix(borderAlpha, 1.0, colorAlpha);

    ${e.depthHudEnabled?S`
      if (finalAlpha < 0.01) {
        discard;
      }
      `:S`
      vec3 finalRgb = mix(borderColor.rgb * borderAlpha, uColor.rgb, colorAlpha);
      gl_FragColor = vec4(finalRgb, finalAlpha);
      `}
  }
  `),t}function tme(e){return _(e)?e:rm}const rme=it(),Zgt=Object.freeze(Object.defineProperty({__proto__:null,build:Ygt},Symbol.toStringTag,{value:"Module"}));class nU extends gi{initializeConfiguration(t,r){r.spherical=t.viewingMode===Be.Global}initializeProgram(t){const r=nU.shader.get().build(this.configuration);return new ai(t.rctx,r,Ur)}setPipelineState(t){const r=t?vi.ALWAYS:vi.LESS;return this.configuration.depthHudEnabled?jt({depthTest:{func:r},depthWrite:fc}):jt({blending:ka(Re.ONE,Re.SRC_ALPHA,Re.ONE_MINUS_SRC_ALPHA,Re.ONE_MINUS_SRC_ALPHA),depthTest:{func:r},colorWrite:or})}initializePipeline(){return this.setPipelineState(this.configuration.hasMultipassGeometry)}}nU.shader=new si(Zgt,()=>ie(()=>import("./LineCallout.glsl.93f82e62.js"),[],import.meta.url));class oh extends Mo{constructor(){super(...arguments),this.screenCenterOffsetUnitsEnabled=Jl.World,this.spherical=!1,this.occlusionTestEnabled=!0,this.hasVerticalOffset=!1,this.hasScreenSizePerspective=!1,this.depthHudEnabled=!1,this.depthHudAlignStartEnabled=!1,this.hasSlicePlane=!1,this.hasMultipassGeometry=!1}}d([H({count:Jl.COUNT})],oh.prototype,"screenCenterOffsetUnitsEnabled",void 0),d([H()],oh.prototype,"spherical",void 0),d([H()],oh.prototype,"occlusionTestEnabled",void 0),d([H()],oh.prototype,"hasVerticalOffset",void 0),d([H()],oh.prototype,"hasScreenSizePerspective",void 0),d([H()],oh.prototype,"depthHudEnabled",void 0),d([H()],oh.prototype,"depthHudAlignStartEnabled",void 0),d([H()],oh.prototype,"hasSlicePlane",void 0),d([H()],oh.prototype,"hasMultipassGeometry",void 0),d([H({constValue:!0})],oh.prototype,"hasSliceInVertexProgram",void 0),d([H({constValue:!1})],oh.prototype,"isDraped",void 0);class X3 extends Dm{constructor(t){super(t,new Jgt),this.techniqueConfig=new oh,this._uniqueMaterialIdentifier=X3.uniqueMaterialIdentifier(this.parameters)}get uniqueMaterialIdentifier(){return this._uniqueMaterialIdentifier}getPassParameters(){return this.parameters}getConfiguration(t,r){const i=(r==null?void 0:r.slot)!==Ee.LINE_CALLOUTS;return this.techniqueConfig.occlusionTestEnabled=this.parameters.occlusionTest,this.techniqueConfig.hasVerticalOffset=_(this.parameters.verticalOffset),this.techniqueConfig.hasScreenSizePerspective=_(this.parameters.screenSizePerspective),this.techniqueConfig.depthHudEnabled=i,this.techniqueConfig.depthHudAlignStartEnabled=!!this.parameters.depthHUDAlignStart,this.techniqueConfig.screenCenterOffsetUnitsEnabled=this.parameters.centerOffsetUnits==="screen"?Jl.Screen:Jl.World,this.techniqueConfig.hasSlicePlane=this.parameters.hasSlicePlane,this.techniqueConfig.hasMultipassGeometry=!!r&&r.multipassGeometry.enabled,this.techniqueConfig}intersect(){}requiresSlot(t){switch(t){case Ee.LINE_CALLOUTS:case Ee.LINE_CALLOUTS_HUD_DEPTH:return!0}return!1}createGLMaterial(t){return t.output===K.Color?new Qgt(t):null}createBufferWriter(){return new eyt}validateParameters(t){const r=X3.uniqueMaterialIdentifier(t);r!==this._uniqueMaterialIdentifier&&(this._uniqueMaterialIdentifier=r)}static uniqueMaterialIdentifier(t){return JSON.stringify({screenOffset:t.screenOffset||[0,0],centerOffsetUnits:t.centerOffsetUnits||"world"})}}class Qgt extends v_{beginSlot(t){return this.ensureTechnique(nU,t)}}class Jgt extends S6{constructor(){super(...arguments),this.screenOffset=Zh,this.color=[0,0,0,1],this.size=1,this.occlusionTest=!1,this.shaderPolygonOffset=1e-5,this.depthHUDAlignStart=!1,this.centerOffsetUnits="world",this.hasSlicePlane=!1}}const Kgt=gn().vec3f(O.POSITION).vec3f(O.NORMAL).vec2f(O.UV0).vec4f(O.AUXPOS1),ime=[ul(0,0),ul(1,0),ul(0,1),ul(1,0),ul(1,1),ul(0,1)];class eyt{constructor(){this.vertexBufferLayout=Kgt}allocate(t){return this.vertexBufferLayout.createBuffer(t)}elementCount(t){return 6*t.indices.get(O.POSITION).length}write(t,r,i,n){Zz(r.indices.get(O.POSITION),r.vertexAttributes.get(O.POSITION).data,t.transformation,i.position,n,6),Jse(r.indices.get(O.NORMAL),r.vertexAttributes.get(O.NORMAL).data,t.invTranspTransformation,i.normal,n,6),R9(r.indices.get(O.AUXPOS1),r.vertexAttributes.get(O.AUXPOS1).data,i.auxpos1,n,6);for(let s=0;s<ime.length;++s)i.uv0.setVec(n+s,ime[s])}}class sU extends Nm{constructor(t,r){super(t,null,r,iyt),this._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1},this.ensureDrapedStatus(!1)}async doLoad(){this._material=new X3(this.materialParameters),this._context.stage.add(this._material)}destroy(){super.destroy(),this._context.stage.remove(this._material),this._material=null}_perInstanceMaterialParameters(t){const r=this.materialParameters;return r.screenOffset=t.screenOffset||Zh,r.centerOffsetUnits=t.centerOffsetUnits||"world",r}get materialParameters(){const t=this.symbol,r=t.callout,i=_(r.color)?Te.toUnitRGBA(r.color):[0,0,0,0];i[3]*=this._getLayerOpacity();const n=ur(r.size||0);let s=null;if(t.verticalOffset){const{screenLength:h,minWorldLength:p,maxWorldLength:m}=t.verticalOffset;s={screenLength:ur(h),minWorldLength:p||0,maxWorldLength:m!=null?m:1/0}}const a=_(r.border)&&_(r.border.color)?Te.toUnitRGBA(r.border.color):null,o=t.symbolLayers.getItemAt(0).type==="object",l=!o,c=o?0:void 0,u=t.type==="label-3d";return{color:i,size:n,verticalOffset:s,screenSizePerspective:this._context.screenSizePerspectiveEnabled?this._context.sharedResources.screenSizePerspectiveSettings:null,screenOffset:[0,0],centerOffsetUnits:"world",borderColor:a,occlusionTest:l,shaderPolygonOffset:c,depthHUDAlignStart:u,hasSlicePlane:this._context.slicePlaneEnabled,renderOccluded:ki.Occlude,__tagStrict:"NoParameters"}}_defaultElevationInfoNoZ(){return ryt}createGraphics3DGraphic(t){const r=t.renderingInfo,i=t.graphic,n=this.setGraphicElevationContext(i,new Du,r.elevationOffset||0),s=r.symbol,a=this._elevationContext.mode==="on-the-ground"&&(s.type==="cim"||!s.symbolLayers.some(l=>l.type==="object"||l.type==="text"));if(s.type!=="label-3d"&&a||s.type==="point-3d"&&s.symbolLayers.every(l=>l.type==="text"&&!Hxe(l)))return null;const o=sae(i.geometry);return R(o)?null:this._createAs3DShape(o,n,r,i.uid)}layerOpacityChanged(){return R(this._material)||this._material.setParameters(this.materialParameters),!0}layerElevationInfoChanged(t,r,i){const n=this._elevationContext.mode,s=OO(sU.elevationModeChangeTypes,i,n);return s!==nn.UPDATE||t.forEach(a=>{const o=r(a);_(o)&&this.updateGraphicElevationContext(a.graphic,o)}),s}slicePlaneEnabledChanged(){return R(this._material)||this._material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),!0}physicalBasedRenderingChanged(){return!0}pixelRatioChanged(){return!0}setGraphicElevationContext(t,r,i=0){const n=super.setGraphicElevationContext(t,r);return n.addOffsetRenderUnits(i),n}updateGraphicElevationContext(t,r){this.setGraphicElevationContext(t,r.elevationContext,r.metadata.elevationOffset),r.needsElevationUpdates=rf(r.elevationContext.mode)}computeComplexity(){return{primitivesPerFeature:2,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1,memory:uae.memory}}_createVertexData(t){const{translation:r,centerOffset:i}=t,n=r?{size:3,data:[r[0],r[1],r[2]],exclusive:!0}:{size:3,data:[0,0,0],exclusive:!0},s=i?{size:4,data:[i[0],i[1],i[2],i[3]],exclusive:!0}:{size:4,data:[0,0,0,1],exclusive:!0};return[[O.POSITION,n],[O.NORMAL,{size:3,data:[0,0,1],exclusive:!0}],[O.AUXPOS1,s]]}_getOrCreateMaterial(t){const r=this._perInstanceMaterialParameters(t),i=X3.uniqueMaterialIdentifier(r);if(_(this._material)&&i===this._material.uniqueMaterialIdentifier)return{material:this._material,isUnique:!1};if(t.materialCollection){let n=t.materialCollection.get(i);return R(n)&&(n=new X3(r),t.materialCollection.add(i,n)),{material:n,isUnique:!1}}return{material:new X3(r),isUnique:!0}}_createAs3DShape(t,r,i,n){const s=[new Gi(this._createVertexData(i),tyt,lc.Point)],a=this._getOrCreateMaterial(i),o=fae(this._context,t,s,[a.material],r,this._context.layer.uid,n);if(o===null)return null;const l=new Fm(this,o.object,s,a.isUnique?[a.material]:null,null,cR,r);return l.metadata={elevationOffset:i.elevationOffset||0},l.alignedSampledElevation=o.sampledElevation,l.needsElevationUpdates=rf(r.mode),dR(l,t,this._context.elevationProvider),l}}sU.elevationModeChangeTypes={definedChanged:nn.UPDATE,staysOnTheGround:nn.UPDATE,onTheGroundChanged:nn.RECREATE};const dq=new Uint16Array([0]),tyt=[[O.POSITION,dq],[O.NORMAL,dq],[O.AUXPOS1,dq]],ryt={mode:"relative-to-ground",offset:0},iyt={ignoreDrivers:!0,renderPriority:0,renderPriorityStep:1},nme=fe.getLogger("esri.views.3d.layers.graphics.Graphics3DCalloutSymbolLayerFactory");function nyt(e,t){if(!Vre(e))return nme.error("Graphics3DCalloutSymbolLayerFactory#make",`symbol of type '${e.type}' does not support callouts`),null;if(!e.callout)return null;const r=syt[e.callout.type];return r?new r(e,t):(nme.error("Graphics3DCalloutSymbolLayerFactory#make",`unknown or unsupported callout type ${e.callout.type}`),null)}const syt={line:sU};class ayt{constructor(t,r,i){this.graphic=t,this.renderingInfo=r,this.layer=i}}const sme=new Fn(Array,e=>TV(e,$xe),null,10,5),oyt=zt();class lyt{constructor(t,r,i,n,s){this.graphic=t,this.graphics3DSymbol=r,this.graphics=i,this._labelGraphics=new Array,this._auxiliaryGraphics=new Array,this._visibilityFlags=cyt(Ra._COUNT,ou._COUNT),this._featureExpressionFeature=null,this._optimizedGeometry={geometry:null,hasZ:!1,hasM:!1},this._extent=null,this.isElevationSource=!1,++r.referenced,this._featureExpressionFeature=s?kAe(s,t,n):null;for(const a of i)_(a)&&(this.isElevationSource=this.isElevationSource||a.isElevationSource)}get labelGraphics(){return this._labelGraphics}get extent(){return this._extent}initialize(t,r){this._layer=r,this._stage=t,this._forEachSymbolLayerGraphic(i=>{i.initialize(t,r),i.setVisibility(this.isVisible())})}destroy(){this._forEachSymbolLayerGraphic(t=>t.destroy()),this.graphics=null,this._auxiliaryGraphics=null,--this.graphics3DSymbol.referenced,this.graphics3DSymbol=null}get destroyed(){return this.graphics==null}clearLabelGraphics(){this._forEachLabelGraphic(t=>t.destroy()),this._labelGraphics.length=0}addLabelGraphic(t,r,i){this._labelGraphics.push(t),t.initialize(r,i),t.setVisibility(this.isVisible(Ra.LABEL))}addAuxiliaryGraphic(t){this._auxiliaryGraphics.push(t),this._layer&&(t.initialize(this._stage,this._layer),t.setVisibility(this.isVisible()))}get isDraped(){let t=!1;return this._forEachSymbolLayerGraphic(r=>{r.type==="draped"&&(t=!0)}),t}isVisible(t=Ra.GRAPHIC,r){for(let i=0;i<=t;i++){const n=this._visibilityFlags[i];for(let s=0;s<n.length;++s)if(n[s]===!1&&s!==r)return!1}return!0}hasVisibilityFlag(t,r){return this._visibilityFlags[r][t]!=null}setVisibilityFlag(t,r,i){const n=this.isVisible(i);this._visibilityFlags[i][t]=r;const s=this.isVisible(i);if(n===s)return!1;if(i===Ra.LABEL)this._forEachLabelGraphic(a=>a.setVisibility(s));else{this._forEachSymbolLayerGraphic(o=>o.setVisibility(s));const a=this.isVisible(Ra.LABEL);this._forEachLabelGraphic(o=>o.setVisibility(a))}return!0}clearVisibilityFlag(t,r=Ra.GRAPHIC){return this.setVisibilityFlag(t,void 0,r)}computeExtent(t){if(!this._extent){const r=this.graphic.geometry;if(R(r))return!1;this._extent=zt(),agt(r,this._extent);const i=r.spatialReference;if(!i.equals(t)&&!zV(this._extent,i,this._extent,t))return this._extent=null,!1}return!0}getAsOptimizedGeometry(t,r){return _(this._optimizedGeometry.geometry)&&this._optimizedGeometry.hasZ===t&&this._optimizedGeometry.hasM===r||(this._optimizedGeometry.geometry=this._convertGraphicToOptimizedGeometry(this.graphic,t,r),this._optimizedGeometry.hasZ=t,this._optimizedGeometry.hasM=r),this._optimizedGeometry.geometry}_convertGraphicToOptimizedGeometry(t,r,i){let n=t.geometry;return n.type!=="mesh"&&n.type!=="extent"||(n=$o.fromExtent(n.type==="mesh"?n.extent:n)),yJe(n,r,i)}get usedMemory(){let t=ZTe(this.graphic.attributes);return this._forEachSymbolLayerGraphic(r=>{const i=r.graphics3DSymbolLayer.complexity;if(R(i))return;const n=r.type==="draped"?i.memory.draped:i.memory;t+=n.bytesPerFeature,n.bytesPerCoordinate&&(t+=sgt(this.graphic.geometry)*n.bytesPerCoordinate)}),t}computeAttachmentOrigin(){const t={render:{origin:M(),num:0},draped:{origin:it(),num:0}};for(const r of this.graphics)R(r)||r.computeAttachmentOrigin(t);return t.render.num&&le(t.render.origin,t.render.origin,1/t.render.num),t.draped.num&&Qc(t.draped.origin,t.draped.origin,1/t.draped.num),t}async getProjectedBoundingBox(t,r,i,n,s){return s||(s={boundingBox:null,requiresDrapedElevation:!1,screenSpaceObjects:[]}),s.boundingBox?bi(s.boundingBox):s.boundingBox=bi(),s.requiresDrapedElevation=!1,await dV(this.graphics,async a=>{if(R(a))return;const o=a.type==="draped"?r:t,l=sme.acquire(),c=await a.getProjectedBoundingBox(o,i,s.screenSpaceObjects,n,l);isFinite(c[2])&&isFinite(c[5])||(s.requiresDrapedElevation=!0),c&&H5(s.boundingBox,l),sme.release(l)}),bBe(s.boundingBox)||mY(Dre(s.boundingBox,oyt))?s:null}needsElevationUpdates(){for(const t of this.graphics)if(_(t)&&(t.type==="object3d"||t.type==="lod-instance")&&t.needsElevationUpdates)return!0;for(const t of this._labelGraphics)if(t&&t.needsElevationUpdates)return!0;return!1}alignWithElevation(t,r,i){this._forEachRenderedGraphic(n=>{n.type!=="object3d"&&n.type!=="lod-instance"||n.alignWithElevation(t,r,this._featureExpressionFeature,i)})}addObjectStateSet(t,r){this._forEachSymbolLayerGraphic(i=>i.addObjectState(t,r))}removeObjectState(t){this._forEachSymbolLayerGraphic(r=>r.removeObjectState(t))}_forEachGraphicList(t,r){t.forEach(i=>i&&r(i))}_forEachSymbolLayerGraphic(t){this._forEachGraphicList(this.graphics,t),this._forEachGraphicList(this._auxiliaryGraphics,t)}_forEachLabelGraphic(t){this._forEachGraphicList(this._labelGraphics,t)}_forEachRenderedGraphic(t){this._forEachSymbolLayerGraphic(t),this._forEachLabelGraphic(t)}}function cyt(e,t){const r=new Array(e);for(let i=0;i<r.length;i++)r[i]=new Array(t);return r}var ame,ome,lme,XAe={exports:{}};ame=XAe,ome=function(){function e(D,F,U){U=U||2;var j,W,Z,q,ee,me,_e,De=F&&F.length,be=De?F[0]*U:D.length,ye=t(D,0,be,U,!0),Ce=[];if(!ye||ye.next===ye.prev)return Ce;if(De&&(ye=l(D,F,ye,U)),D.length>80*U){j=Z=D[0],W=q=D[1];for(var Ne=U;Ne<be;Ne+=U)(ee=D[Ne])<j&&(j=ee),(me=D[Ne+1])<W&&(W=me),ee>Z&&(Z=ee),me>q&&(q=me);_e=(_e=Math.max(Z-j,q-W))!==0?1/_e:0}return i(ye,Ce,U,j,W,_e),Ce}function t(D,F,U,j,W){var Z,q;if(W===se(D,F,U,j)>0)for(Z=F;Z<U;Z+=j)q=X(Z,D[Z],D[Z+1],q);else for(Z=U-j;Z>=F;Z-=j)q=X(Z,D[Z],D[Z+1],q);if(q&&C(q,q.next)){var ee=q.next;Y(q),q=ee}return q}function r(D,F){if(!D)return D;F||(F=D);var U,j=D;do if(U=!1,j.steiner||!C(j,j.next)&&E(j.prev,j,j.next)!==0)j=j.next;else{var W=j.prev;if(Y(j),(j=F=W)===j.next)break;U=!0}while(U||j!==F);return F}function i(D,F,U,j,W,Z,q){if(D){!q&&Z&&g(D,j,W,Z);for(var ee,me,_e=D;D.prev!==D.next;)if(ee=D.prev,me=D.next,Z?s(D,j,W,Z):n(D))F.push(ee.i/U),F.push(D.i/U),F.push(me.i/U),Y(D),D=me.next,_e=me.next;else if((D=me)===_e){q?q===1?i(D=a(r(D),F,U),F,U,j,W,Z,2):q===2&&o(D,F,U,j,W,Z):i(r(D),F,U,j,W,Z,1);break}}}function n(D){var F=D.prev,U=D,j=D.next;if(E(F,U,j)>=0)return!1;for(var W=D.next.next;W!==D.prev;){if(x(F.x,F.y,U.x,U.y,j.x,j.y,W.x,W.y)&&E(W.prev,W,W.next)>=0)return!1;W=W.next}return!0}function s(D,F,U,j){var W=D.prev,Z=D,q=D.next;if(E(W,Z,q)>=0)return!1;for(var ee=W.x<Z.x?W.x<q.x?W.x:q.x:Z.x<q.x?Z.x:q.x,me=W.y<Z.y?W.y<q.y?W.y:q.y:Z.y<q.y?Z.y:q.y,_e=W.x>Z.x?W.x>q.x?W.x:q.x:Z.x>q.x?Z.x:q.x,De=W.y>Z.y?W.y>q.y?W.y:q.y:Z.y>q.y?Z.y:q.y,be=w(ee,me,F,U,j),ye=w(_e,De,F,U,j),Ce=D.prevZ,Ne=D.nextZ;Ce&&Ce.z>=be&&Ne&&Ne.z<=ye;){if(Ce!==D.prev&&Ce!==D.next&&x(W.x,W.y,Z.x,Z.y,q.x,q.y,Ce.x,Ce.y)&&E(Ce.prev,Ce,Ce.next)>=0||(Ce=Ce.prevZ,Ne!==D.prev&&Ne!==D.next&&x(W.x,W.y,Z.x,Z.y,q.x,q.y,Ne.x,Ne.y)&&E(Ne.prev,Ne,Ne.next)>=0))return!1;Ne=Ne.nextZ}for(;Ce&&Ce.z>=be;){if(Ce!==D.prev&&Ce!==D.next&&x(W.x,W.y,Z.x,Z.y,q.x,q.y,Ce.x,Ce.y)&&E(Ce.prev,Ce,Ce.next)>=0)return!1;Ce=Ce.prevZ}for(;Ne&&Ne.z<=ye;){if(Ne!==D.prev&&Ne!==D.next&&x(W.x,W.y,Z.x,Z.y,q.x,q.y,Ne.x,Ne.y)&&E(Ne.prev,Ne,Ne.next)>=0)return!1;Ne=Ne.nextZ}return!0}function a(D,F,U){var j=D;do{var W=j.prev,Z=j.next.next;!C(W,Z)&&A(W,j,j.next,Z)&&V(W,Z)&&V(Z,W)&&(F.push(W.i/U),F.push(j.i/U),F.push(Z.i/U),Y(j),Y(j.next),j=D=Z),j=j.next}while(j!==D);return r(j)}function o(D,F,U,j,W,Z){var q=D;do{for(var ee=q.next.next;ee!==q.prev;){if(q.i!==ee.i&&T(q,ee)){var me=B(q,ee);return q=r(q,q.next),me=r(me,me.next),i(q,F,U,j,W,Z),void i(me,F,U,j,W,Z)}ee=ee.next}q=q.next}while(q!==D)}function l(D,F,U,j){var W,Z,q,ee=[];for(W=0,Z=F.length;W<Z;W++)(q=t(D,F[W]*j,W<Z-1?F[W+1]*j:D.length,j,!1))===q.next&&(q.steiner=!0),ee.push(v(q));for(ee.sort(c),W=0;W<ee.length;W++)U=r(U=h(ee[W],U),U.next);return U}function c(D,F){return D.x-F.x}function u(D){if(D.next.prev===D)return D;let F=D;for(;;){const U=F.next;if(U.prev===F||U===F||U===D)break;F=U}return F}function h(D,F){var U=p(D,F);if(!U)return F;var j=B(U,D),W=r(U,U.next);let Z=u(j);return r(Z,Z.next),W=u(W),u(F===U?W:F)}function p(D,F){var U,j=F,W=D.x,Z=D.y,q=-1/0;do{if(Z<=j.y&&Z>=j.next.y&&j.next.y!==j.y){var ee=j.x+(Z-j.y)*(j.next.x-j.x)/(j.next.y-j.y);if(ee<=W&&ee>q){if(q=ee,ee===W){if(Z===j.y)return j;if(Z===j.next.y)return j.next}U=j.x<j.next.x?j:j.next}}j=j.next}while(j!==F);if(!U)return null;if(W===q)return U;var me,_e=U,De=U.x,be=U.y,ye=1/0;j=U;do W>=j.x&&j.x>=De&&W!==j.x&&x(Z<be?W:q,Z,De,be,Z<be?q:W,Z,j.x,j.y)&&(me=Math.abs(Z-j.y)/(W-j.x),V(j,D)&&(me<ye||me===ye&&(j.x>U.x||j.x===U.x&&m(U,j)))&&(U=j,ye=me)),j=j.next;while(j!==_e);return U}function m(D,F){return E(D.prev,D,F.prev)<0&&E(F.next,D,D.next)<0}function g(D,F,U,j){var W=D;do W.z===null&&(W.z=w(W.x,W.y,F,U,j)),W.prevZ=W.prev,W.nextZ=W.next,W=W.next;while(W!==D);W.prevZ.nextZ=null,W.prevZ=null,b(W)}function b(D){var F,U,j,W,Z,q,ee,me,_e=1;do{for(U=D,D=null,Z=null,q=0;U;){for(q++,j=U,ee=0,F=0;F<_e&&(ee++,j=j.nextZ);F++);for(me=_e;ee>0||me>0&&j;)ee!==0&&(me===0||!j||U.z<=j.z)?(W=U,U=U.nextZ,ee--):(W=j,j=j.nextZ,me--),Z?Z.nextZ=W:D=W,W.prevZ=Z,Z=W;U=j}Z.nextZ=null,_e*=2}while(q>1);return D}function w(D,F,U,j,W){return(D=1431655765&((D=858993459&((D=252645135&((D=16711935&((D=32767*(D-U)*W)|D<<8))|D<<4))|D<<2))|D<<1))|(F=1431655765&((F=858993459&((F=252645135&((F=16711935&((F=32767*(F-j)*W)|F<<8))|F<<4))|F<<2))|F<<1))<<1}function v(D){var F=D,U=D;do(F.x<U.x||F.x===U.x&&F.y<U.y)&&(U=F),F=F.next;while(F!==D);return U}function x(D,F,U,j,W,Z,q,ee){return(W-q)*(F-ee)-(D-q)*(Z-ee)>=0&&(D-q)*(j-ee)-(U-q)*(F-ee)>=0&&(U-q)*(Z-ee)-(W-q)*(j-ee)>=0}function T(D,F){return D.next.i!==F.i&&D.prev.i!==F.i&&!L(D,F)&&(V(D,F)&&V(F,D)&&G(D,F)&&(E(D.prev,D,F.prev)||E(D,F.prev,F))||C(D,F)&&E(D.prev,D,D.next)>0&&E(F.prev,F,F.next)>0)}function E(D,F,U){return(F.y-D.y)*(U.x-F.x)-(F.x-D.x)*(U.y-F.y)}function C(D,F){return D.x===F.x&&D.y===F.y}function A(D,F,U,j){var W=I(E(D,F,U)),Z=I(E(D,F,j)),q=I(E(U,j,D)),ee=I(E(U,j,F));return W!==Z&&q!==ee||!(W!==0||!P(D,U,F))||!(Z!==0||!P(D,j,F))||!(q!==0||!P(U,D,j))||!(ee!==0||!P(U,F,j))}function P(D,F,U){return F.x<=Math.max(D.x,U.x)&&F.x>=Math.min(D.x,U.x)&&F.y<=Math.max(D.y,U.y)&&F.y>=Math.min(D.y,U.y)}function I(D){return D>0?1:D<0?-1:0}function L(D,F){var U=D;do{if(U.i!==D.i&&U.next.i!==D.i&&U.i!==F.i&&U.next.i!==F.i&&A(U,U.next,D,F))return!0;U=U.next}while(U!==D);return!1}function V(D,F){return E(D.prev,D,D.next)<0?E(D,F,D.next)>=0&&E(D,D.prev,F)>=0:E(D,F,D.prev)<0||E(D,D.next,F)<0}function G(D,F){var U=D,j=!1,W=(D.x+F.x)/2,Z=(D.y+F.y)/2;do U.y>Z!=U.next.y>Z&&U.next.y!==U.y&&W<(U.next.x-U.x)*(Z-U.y)/(U.next.y-U.y)+U.x&&(j=!j),U=U.next;while(U!==D);return j}function B(D,F){var U=new ce(D.i,D.x,D.y),j=new ce(F.i,F.x,F.y),W=D.next,Z=F.prev;return D.next=F,F.prev=D,U.next=W,W.prev=U,j.next=U,U.prev=j,Z.next=j,j.prev=Z,j}function X(D,F,U,j){var W=new ce(D,F,U);return j?(W.next=j.next,W.prev=j,j.next.prev=W,j.next=W):(W.prev=W,W.next=W),W}function Y(D){D.next.prev=D.prev,D.prev.next=D.next,D.prevZ&&(D.prevZ.nextZ=D.nextZ),D.nextZ&&(D.nextZ.prevZ=D.prevZ)}function ce(D,F,U){this.i=D,this.x=F,this.y=U,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function se(D,F,U,j){for(var W=0,Z=F,q=U-j;Z<U;Z+=j)W+=(D[q]-D[Z])*(D[Z+1]+D[q+1]),q=Z;return W}return e.deviation=function(D,F,U,j){var W=F&&F.length,Z=W?F[0]*U:D.length,q=Math.abs(se(D,0,Z,U));if(W)for(var ee=0,me=F.length;ee<me;ee++){var _e=F[ee]*U,De=ee<me-1?F[ee+1]*U:D.length;q-=Math.abs(se(D,_e,De,U))}var be=0;for(ee=0;ee<j.length;ee+=3){var ye=j[ee]*U,Ce=j[ee+1]*U,Ne=j[ee+2]*U;be+=Math.abs((D[ye]-D[Ne])*(D[Ce+1]-D[ye+1])-(D[ye]-D[Ce])*(D[Ne+1]-D[ye+1]))}return q===0&&be===0?0:Math.abs((be-q)/q)},e.flatten=function(D){for(var F=D[0][0].length,U={vertices:[],holes:[],dimensions:F},j=0,W=0;W<D.length;W++){for(var Z=0;Z<D[W].length;Z++)for(var q=0;q<F;q++)U.vertices.push(D[W][Z][q]);W>0&&(j+=D[W-1].length,U.holes.push(j))}return U},e},(lme=ome())!==void 0&&(ame.exports=lme);const P9=XAe.exports,aU=fe.getLogger("esri.views.3d.support.buffer.math");function PO(e,t,r){if(e.count!==t.count)return void aU.error("source and destination buffers need to have the same number of elements");const i=e.count,n=r[0],s=r[1],a=r[2],o=r[4],l=r[5],c=r[6],u=r[8],h=r[9],p=r[10],m=r[12],g=r[13],b=r[14],w=e.typedBuffer,v=e.typedBufferStride,x=t.typedBuffer,T=t.typedBufferStride;for(let E=0;E<i;E++){const C=E*v,A=E*T,P=x[A],I=x[A+1],L=x[A+2];w[C]=n*P+o*I+u*L+m,w[C+1]=s*P+l*I+h*L+g,w[C+2]=a*P+c*I+p*L+b}}function c_(e,t,r){if(e.count!==t.count)return void aU.error("source and destination buffers need to have the same number of elements");const i=e.count,n=r[0],s=r[1],a=r[2],o=r[3],l=r[4],c=r[5],u=r[6],h=r[7],p=r[8],m=e.typedBuffer,g=e.typedBufferStride,b=t.typedBuffer,w=t.typedBufferStride;for(let v=0;v<i;v++){const x=v*g,T=v*w,E=b[T],C=b[T+1],A=b[T+2];m[x]=n*E+o*C+u*A,m[x+1]=s*E+l*C+h*A,m[x+2]=a*E+c*C+p*A}}function iK(e,t,r){const i=Math.min(e.count,t.count),n=e.typedBuffer,s=e.typedBufferStride,a=t.typedBuffer,o=t.typedBufferStride;for(let l=0;l<i;l++){const c=l*s,u=l*o;n[c]=r*a[u],n[c+1]=r*a[u+1],n[c+2]=r*a[u+2]}}function pae(e,t){const r=Math.min(e.count,t.count),i=e.typedBuffer,n=e.typedBufferStride,s=t.typedBuffer,a=t.typedBufferStride;for(let o=0;o<r;o++){const l=o*n,c=o*a,u=s[c],h=s[c+1],p=s[c+2],m=u*u+h*h+p*p;if(m>0){const g=1/Math.sqrt(m);i[l]=g*u,i[l+1]=g*h,i[l+2]=g*p}}}function dyt(e,t,r){const i=Math.min(e.count,t.count),n=e.typedBuffer,s=e.typedBufferStride,a=t.typedBuffer,o=t.typedBufferStride;for(let l=0;l<i;l++){const c=l*s,u=l*o;n[c]=a[u]>>r,n[c+1]=a[u+1]>>r,n[c+2]=a[u+2]>>r}}Object.freeze(Object.defineProperty({__proto__:null,transformMat4:PO,transformMat3:c_,scale:iK,normalize:pae,shiftRight:dyt},Symbol.toStringTag,{value:"Module"}));function oU(e,t){if(!e||e.symbol)return null;const r=t&&t.renderer;return e&&_(r)&&r.getObservationRenderer?r.getObservationRenderer(e):r}function uyt(e,t){if(_(e.symbol))return e.symbol;const r=oU(e,t);return _(r)&&r.type!=="dot-density"?r.getSymbol(e,t):null}function ULt(e,t){const r=oU(e,t),i=uyt(e,t);if(R(i))return null;const n={renderer:r,symbol:i};if(R(r)||!("visualVariables"in r)||!r.visualVariables)return n;const s=hne(r,e,t),a=["proportional","proportional","proportional"];for(const{variable:o,value:l}of s)switch(o.type){case"color":n.color=l.toRgba();break;case"size":if(o.target==="outline")n.outlineSize=l;else{const c=o.axis,u=o.useSymbolValue?"symbol-value":l;switch(c){case"width":a[0]=u;break;case"depth":a[1]=u;break;case"height":a[2]=u;break;case"width-and-depth":a[0]=a[1]=u;break;default:a[0]=a[1]=a[2]=u}}break;case"opacity":n.opacity=l;break;case"rotation":switch(o.axis){case"tilt":n.tilt=l;break;case"roll":n.roll=l;break;default:n.heading=l}}return a[0]==="proportional"&&a[1]==="proportional"&&a[2]==="proportional"||(n.size=a),n}async function hyt(e,t){if(_(e.symbol))return e.symbol;const r=oU(e,t);return _(r)&&r.getSymbolAsync(e,t)}async function BLt(e,t){const r=oU(e,t),i=await hyt(e,t);if(!i)return null;const n={renderer:r,symbol:i};if(!r||!("visualVariables"in r)||!r.visualVariables)return n;const s=hne(r,e,t),a=["proportional","proportional","proportional"];for(const{variable:o,value:l}of s)if(o.type==="color")n.color=Te.toUnitRGBA(l);else if(o.type==="size")if(o.target==="outline")n.outlineSize=l;else{const c=o.axis,u=o.useSymbolValue?"symbol-value":l;c==="width"?a[0]=u:c==="depth"?a[1]=u:c==="height"?a[2]=u:a[0]=a[1]=c==="width-and-depth"?u:a[2]=u}else o.type==="opacity"?n.opacity=l:o.type==="rotation"&&o.axis==="tilt"?n.tilt=l:o.type==="rotation"&&o.axis==="roll"?n.roll=l:o.type==="rotation"&&(n.heading=l);return(isFinite(a[0])||isFinite(a[1])||isFinite(a[2]))&&(n.size=a),n}function fyt(e,t=0){const r=e[t];return typeof r=="number"&&isFinite(r)?r:null}function pyt(e){for(let t=0;t<3;t++){const r=e[t];if(typeof r=="number")return isFinite(r)?r:0}return 0}function YAe(e,t,r){var C;const i=e.byteLength/(4*t),n=new Uint32Array(e,0,i*t);let s=new Uint32Array(i);const a=(C=r==null?void 0:r.minReduction)!=null?C:0,o=(r==null?void 0:r.originalIndices)||null,l=o?o.length:0,c=(r==null?void 0:r.componentOffsets)||null;let u=0;if(c)for(let A=0;A<c.length-1;A++){const P=c[A+1]-c[A];P>u&&(u=P)}else u=i;const h=Math.floor(1.1*u)+1;(Wp==null||Wp.length<2*h)&&(Wp=new Uint32Array($5(2*h)));for(let A=0;A<2*h;A++)Wp[A]=0;let p=0;const m=!!c&&!!o,g=m?l:i,b=m?new Uint32Array(l):null,w=1.96;let v=a!==0?Math.ceil(4*w*w/(a*a)*a*(1-a)):g,x=1,T=c?c[1]:g;for(let A=0;A<g;A++){if(A===v){const B=1-p/A;if(B+w*Math.sqrt(B*(1-B)/A)<a)return null;v*=2}if(A===T){for(let B=0;B<2*h;B++)Wp[B]=0;if(o)for(let B=c[x-1];B<c[x];B++)b[B]=s[o[B]];T=c[++x]}const P=m?o[A]:A,I=P*t,L=yyt(n,I,t);let V=L%h,G=p;for(;Wp[2*V+1]!==0;){if(Wp[2*V]===L){const B=Wp[2*V+1]-1;if(myt(n,I,B*t,t)){G=s[B];break}}V++,V>=h&&(V-=h)}G===p&&(Wp[2*V]=L,Wp[2*V+1]=P+1,p++),s[P]=G}if(a!==0&&1-p/i<a)return null;if(m){for(let A=c[x-1];A<b.length;A++)b[A]=s[o[A]];s=b}const E=new Uint32Array(t*p);p=0;for(let A=0;A<g;A++)s[A]===p&&(gyt(n,(m?o[A]:A)*t,E,p*t,t),p++);if(o&&!m){const A=new Uint32Array(l);for(let P=0;P<A.length;P++)A[P]=s[o[P]];s=A}return{buffer:E.buffer,indices:s,uniqueCount:p}}function myt(e,t,r,i){for(let n=0;n<i;n++)if(e[t+n]!==e[r+n])return!1;return!0}function gyt(e,t,r,i,n){for(let s=0;s<n;s++)r[i+s]=e[t+s]}function yyt(e,t,r){let i=0;for(let n=0;n<r;n++)i=e[t+n]+i|0,i=i+(i<<11)+(i>>>2)|0;return i>>>0}let Wp=null;function GLt(e){const t=IO(e.rings,e.hasZ,wm.CCW_IS_HOLE),r=[];let i=0,n=0;for(const o of t.polygons){const l=o.count,c=o.index,u=new Float64Array(t.position.buffer,3*c*t.position.BYTES_PER_ELEMENT,3*l),h=o.holeIndices.map(m=>m-c),p=new Uint32Array(P9(u,h,3));r.push({position:u,faces:p}),i+=u.length,n+=p.length}const s=byt(r,i,n),a=YAe(s.position.buffer,6,{originalIndices:s.faces});return s.position=new Float64Array(a.buffer),s.faces=a.indices,s}function byt(e,t,r){if(e.length===1)return e[0];const i=new Float64Array(t),n=new Uint32Array(r);let s=0,a=0,o=0;for(const l of e){for(let c=0;c<l.position.length;c++)i[s++]=l.position[c];for(let c=0;c<l.faces.length;c++)n[a++]=l.faces[c]+o;o=s/3}return{position:i,faces:n}}function IO(e,t,r){const i=e.length,n=new Array(i),s=new Array(i),a=new Array(i);let o=0,l=0,c=0,u=0;for(let m=0;m<i;++m)u+=e[m].length;const h=new Float64Array(3*u);let p=0;for(let m=i-1;m>=0;m--){const g=e[m],b=r===wm.CCW_IS_HOLE&&vyt(g);if(b&&i!==1)n[o++]=g;else{let w=g.length;for(let x=0;x<o;++x)w+=n[x].length;const v={index:p,pathLengths:new Array(o+1),count:w,holeIndices:new Array(o)};v.pathLengths[0]=g.length,g.length>0&&(a[c++]={index:p,count:g.length}),p=b?rI(g,g.length-1,-1,h,p,g.length,t):rI(g,0,1,h,p,g.length,t);for(let x=0;x<o;++x){const T=n[x];v.holeIndices[x]=p,v.pathLengths[x+1]=T.length,T.length>0&&(a[c++]={index:p,count:T.length}),p=rI(T,0,1,h,p,T.length,t)}o=0,v.count>0&&(s[l++]=v)}}for(let m=0;m<o;++m){const g=n[m];g.length>0&&(a[c++]={index:p,count:g.length}),p=rI(g,0,1,h,p,g.length,t)}return l<i&&(s.length=l),c<i&&(a.length=c),{position:h,polygons:s,outlines:a}}function rI(e,t,r,i,n,s,a){n*=3;for(let o=0;o<s;++o){const l=e[t];i[n++]=l[0],i[n++]=l[1],i[n++]=a?l[2]:0,t+=r}return n/3}function vyt(e){return!fre(e,!1,!1)}var wm;(function(e){e[e.NONE=0]="NONE",e[e.CCW_IS_HOLE=1]="CCW_IS_HOLE"})(wm||(wm={}));var y7,nK;(function(e){e[e.RasterImage=0]="RasterImage",e[e.Features=1]="Features"})(y7||(y7={})),function(e){e[e.WithRasterImage=0]="WithRasterImage",e[e.WithoutRasterImage=1]="WithoutRasterImage"}(nK||(nK={}));var ji,Ah,Bt,I9,In,sa;(function(e){e[e.INNER=0]="INNER",e[e.OUTER=1]="OUTER"})(ji||(ji={})),function(e){e[e.REGULAR=0]="REGULAR",e[e.HAS_NORTH_POLE=1]="HAS_NORTH_POLE",e[e.HAS_SOUTH_POLE=2]="HAS_SOUTH_POLE",e[e.HAS_BOTH_POLES=3]="HAS_BOTH_POLES"}(Ah||(Ah={})),function(e){e[e.NORTH=0]="NORTH",e[e.NORTH_EAST=1]="NORTH_EAST",e[e.EAST=2]="EAST",e[e.SOUTH_EAST=3]="SOUTH_EAST",e[e.SOUTH=4]="SOUTH",e[e.SOUTH_WEST=5]="SOUTH_WEST",e[e.WEST=6]="WEST",e[e.NORTH_WEST=7]="NORTH_WEST"}(Bt||(Bt={})),function(e){e[e.OFF=0]="OFF",e[e.ON=1]="ON"}(I9||(I9={})),function(e){e[e.Color=0]="Color",e[e.ColorNoRasterImage=1]="ColorNoRasterImage",e[e.Highlight=2]="Highlight",e[e.Water=3]="Water",e[e.Occluded=4]="Occluded"}(In||(In={})),function(e){e[e.FADING=0]="FADING",e[e.IMMEDIATE=1]="IMMEDIATE",e[e.UNFADED=2]="UNFADED"}(sa||(sa={}));class _yt{constructor(t,r){this.vec3=t,this.id=r}}function b7(e,t,r,i){return new _yt(Ve(e,t,r),i)}var al;(function(e){e[e.None=0]="None",e[e.ColorAndWater=1]="ColorAndWater",e[e.Highlight=2]="Highlight",e[e.Occluded=3]="Occluded"})(al||(al={}));class cme{constructor(t,r){this.index=t,this.renderTargets=r,this._extent=zt(),this.resolution=0,this.renderLocalOrigin=b7(0,0,0,"O"),this.pixelRatio=1,this.mapUnitsPerPixel=1,this.canvasGeometries=new xyt,this.validTargets=null,this.hasDrapedFeatureSource=!1,this.hasDrapedRasterSource=!1,this.hasTargetWithoutRasterImage=!1,this.index=t,this.validTargets=new Array(r.renderTargets.length).fill(!1)}get extent(){return this._extent}getValidTexture(t){return this.validTargets[t]?this.renderTargets.getTarget(t).getTexture():null}get _needsColorWithoutRasterImage(){return this.hasDrapedRasterSource&&this.hasDrapedFeatureSource&&this.hasTargetWithoutRasterImage}getColorTexture(t){const r=t===al.ColorAndWater?this.renderTargets.getTarget(In.Color):t===al.Highlight?this.renderTargets.getTarget(In.Highlight):this.renderTargets.getTarget(In.Occluded);return r?r.getTexture():null}getColorTextureNoRasterImage(){return this._needsColorWithoutRasterImage?this.getValidTexture(In.ColorNoRasterImage):this.hasDrapedFeatureSource?this.getValidTexture(In.Color):null}getNormalTexture(t){const r=t===al.ColorAndWater?this.renderTargets.getTarget(In.Water):null;return r?r.getTexture():null}draw(t,r){const i=this.computeRenderTargetValidityBitfield();for(const n of this.renderTargets.renderTargets)n.type!==In.ColorNoRasterImage||this._needsColorWithoutRasterImage?this.validTargets[n.type]=t.drawTarget(this,n,r):this.validTargets[n.type]=!1;return i^this.computeRenderTargetValidityBitfield()?m9.CHANGED:m9.UNCHANGED}computeRenderTargetValidityBitfield(){const t=this.validTargets;return+t[In.Color]|+t[In.ColorNoRasterImage]<<1|+t[In.Highlight]<<2|+t[In.Water]<<3|+t[In.Occluded]<<4}setupGeometryViewsCyclical(t){this.setupGeometryViewsDirect();const r=.001*t.range;if(this._extent[0]-r<=t.min){const i=this.canvasGeometries.extents[this.canvasGeometries.numViews++];UF(this._extent,t.range,0,i)}if(this._extent[2]+r>=t.max){const i=this.canvasGeometries.extents[this.canvasGeometries.numViews++];UF(this._extent,-t.range,0,i)}}setupGeometryViewsDirect(){this.canvasGeometries.numViews=1,Oy(this.canvasGeometries.extents[0],this._extent)}hasSomeSizedView(){for(let t=0;t<this.canvasGeometries.numViews;t++){const r=this.canvasGeometries.extents[t];if(r[0]!==r[2]&&r[1]!==r[3])return!0}return!1}applyViewport(t){t.setViewport(this.index===ji.INNER?0:this.resolution,0,this.resolution,this.resolution)}}function wyt(e,t,r){return Math.min($5(Math.max(e,t)+256),r)}class xyt{constructor(){this.extents=[zt(),zt(),zt()],this.numViews=0}}class ZAe{constructor(t,r){this.size=gse(),this._fbo=null,this._fbo=new Pi(t,{colorTarget:hn.TEXTURE,depthStencilTarget:Pr.NONE},{target:mt.TEXTURE_2D,pixelFormat:Ue.RGBA,dataType:At.UNSIGNED_BYTE,wrapMode:xt.CLAMP_TO_EDGE,samplingMode:tt.LINEAR_MIPMAP_LINEAR,hasMipmap:r,maxAnisotropy:8,width:0,height:0})}dispose(){this._fbo=Qe(this._fbo)}getTexture(){return this._fbo?this._fbo.colorTexture:null}isValid(){return this._fbo!==null}resize(t,r){this.size[0]=t,this.size[1]=r,this._fbo.resize(this.size[0],this.size[1])}bind(t){t.bindFramebuffer(this._fbo)}generateMipMap(){this._fbo.colorTexture.descriptor.hasMipmap&&this._fbo.colorTexture.generateMipmap()}disposeRenderTargetMemory(){var t;(t=this._fbo)==null||t.resize(0,0)}get gpuMemoryUsage(){var t,r;return(r=(t=this._fbo)==null?void 0:t.gpuMemoryUsage)!=null?r:0}}class Tyt{constructor(t){const r=(i,n,s=!0)=>({type:n,fbo:new ZAe(t,s),renderPass:i,valid:!1,lastUsed:1/0});this.renderTargets=[r(je.MATERIAL,In.Color),r(je.MATERIAL,In.ColorNoRasterImage),r(je.MATERIAL_HIGHLIGHT,In.Highlight,!1),r(je.MATERIAL_NORMAL,In.Water),r(je.MATERIAL,In.Occluded)]}getTarget(t){return this.renderTargets[t].fbo}dispose(){for(const t of this.renderTargets)t.fbo.dispose()}disposeRenderTargetMemory(){for(const t of this.renderTargets)t.fbo.disposeRenderTargetMemory()}validateUsageForTarget(t,r,i){if(t)r.lastUsed=i;else if(i-r.lastUsed>Syt)r.fbo.disposeRenderTargetMemory(),r.lastUsed=1/0;else if(r.lastUsed<1/0)return!0;return!1}get gpuMemoryUsage(){return this.renderTargets.reduce((t,r)=>t+r.fbo.gpuMemoryUsage,0)}}const Syt=1e3;class mae{constructor(){this._outer=new Map}clear(){this._outer.clear()}get empty(){return this._outer.size===0}get(t,r){var i;return(i=this._outer.get(t))==null?void 0:i.get(r)}set(t,r,i){const n=this._outer.get(t);n?n.set(r,i):this._outer.set(t,new Map([[r,i]]))}delete(t,r){const i=this._outer.get(t);i&&(i.delete(r),i.size===0&&this._outer.delete(t))}forEach(t){this._outer.forEach((r,i)=>t(r,i))}}class QAe{constructor(t){this._context=t,this._perConstructorInstances=new mae,this._frameCounter=0,this._keepAliveFrameCount=dme}get viewingMode(){return this._context.viewingMode}get constructionContext(){return this._context}dispose(){this._perConstructorInstances.forEach(t=>t.forEach(r=>r.technique.destroy())),this._perConstructorInstances.clear()}acquire(t,r){const i=r.key;let n=this._perConstructorInstances.get(t,i);if(R(n)){const s=new t(this._context,r,()=>this.release(s));n=new Eyt(s),this._perConstructorInstances.set(t,i,n)}return++n.refCount,n.technique}releaseAndAcquire(t,r,i){if(_(i)){if(r.key===i.key)return i;this.release(i)}return this.acquire(t,r)}release(t){if(R(t)||this._perConstructorInstances.empty)return;const r=this._perConstructorInstances.get(t.constructor,t.key);R(r)||(--r.refCount,r.refCount===0&&(r.refZeroFrame=this._frameCounter))}frameUpdate(){this._frameCounter++,this._keepAliveFrameCount!==dme&&this._perConstructorInstances.forEach((t,r)=>{t.forEach((i,n)=>{i.refCount===0&&i.refZeroFrame+this._keepAliveFrameCount<this._frameCounter&&(i.technique.destroy(),this._perConstructorInstances.delete(r,n))})})}async reloadAll(){const t=new Array;this._perConstructorInstances.forEach((r,i)=>{const n=async(s,a)=>{const o=a.shader;o&&(await o.reload(),s.forEach(l=>{l.technique.reload(this._context)}))};t.push(n(r,i))}),await Promise.all(t)}}class Eyt{constructor(t){this.technique=t,this.refCount=0,this.refZeroFrame=0}}const dme=-1,lU=e=>{class t extends e{constructor(){super(...arguments),this._isDisposed=!1}dispose(){var i;for(const n of(i=this._managedDisposables)!=null?i:[]){const s=this[n];this[n]=null,s&&typeof s.dispose=="function"&&s.dispose()}this._isDisposed=!0}get isDisposed(){return this._isDisposed}}return t};class cU extends lU(class{}){}function Za(){return(e,t)=>{var r,i;e.hasOwnProperty("_managedDisposables")||(e._managedDisposables=(i=(r=e._managedDisposables)==null?void 0:r.slice())!=null?i:[]),e._managedDisposables.unshift(t)}}const Cyt=fe.getLogger("esri.views.3d.webgl-engine.lib.GLMaterialRepository");class JAe{constructor(t,r,i,n){this._textureRepository=t,this._techniqueRepository=r,this.materialChanged=i,this.requestRender=n,this._id2glMaterialRef=new mae}dispose(){this._textureRepository.dispose()}acquire(t,r){this._ownMaterial(t);let i=this._id2glMaterialRef.get(r,t.id);if(R(i)){const n=t.createGLMaterial({material:t,techniqueRep:this._techniqueRepository,textureRep:this._textureRepository,output:r});i=new Ayt(n),this._id2glMaterialRef.set(r,t.id,i)}return i.ref(),i.glMaterial}release(t,r){const i=this._id2glMaterialRef.get(r,t.id);_(i)&&(i.unref(),i.referenced||(Qe(i.glMaterial),this._id2glMaterialRef.delete(r,t.id)))}_ownMaterial(t){_(t.repository)&&t.repository!==this&&Cyt.error("Material is already owned by a different material repository"),t.repository=this}}class Ayt{constructor(t){this.glMaterial=t,this.refCnt=0}ref(){++this.refCnt}unref(){--this.refCnt,pt(this.refCnt>=0)}get referenced(){return this.refCnt>0}}const Ryt={orderedRepackingEnabled:!1},Oyt={rootOrigin:null},Myt=["layerObjectAdded","layerObjectRemoved","layerObjectsAdded","layerObjectsRemoved","shaderTransformationChanged","objectTransformation","visibilityChanged","occlusionChanged","highlightChanged","objectGeometryAdded","objectGeometryRemoved","vertexAttrsUpdated"];class $9{constructor(t,r){this._objectToBoundingSphere=t,this._maximumObjectsPerNode=10,this._maximumDepth=20,this._degenerateObjects=new Set,this._root=new ln,this._objectCount=0,r&&(r.maximumObjectsPerNode!==void 0&&(this._maximumObjectsPerNode=r.maximumObjectsPerNode),r.maximumDepth!==void 0&&(this._maximumDepth=r.maximumDepth))}get bounds(){return this._root.bounds}get halfSize(){return this._root.halfSize}get root(){return this._root.node}get maximumObjectsPerNode(){return this._maximumObjectsPerNode}get maximumDepth(){return this._maximumDepth}get objectCount(){return this._objectCount}destroy(){this._degenerateObjects.clear(),ln.clearPool(),sK[0]=null,j_.prune(),J2.prune()}add(t,r=t.length){this._objectCount+=r,this._grow(t,r);const i=ln.acquire();for(let n=0;n<r;n++){const s=t[n];this._isDegenerate(s)?this._degenerateObjects.add(s):(i.init(this._root),this._add(s,i))}ln.release(i)}remove(t,r=null){this._objectCount-=t.length;const i=ln.acquire();for(const n of t){const s=_(r)?r:t9(this._objectToBoundingSphere(n),Dyt);aC(s[3])?(i.init(this._root),this._remove(n,s,i)):this._degenerateObjects.delete(n)}ln.release(i),this._shrink()}update(t,r){if(!aC(r[3])&&this._isDegenerate(t))return;const i=Lyt(t);this.remove(i,r),this.add(i)}forEachAlongRay(t,r,i){const n=Ru(t,r);this._forEachNode(this._root,s=>{if(!this._intersectsNode(n,s))return!1;const a=s.node;return a.terminals.forAll(o=>{this._intersectsObject(n,o)&&i(o)}),a.residents!==null&&a.residents.forAll(o=>{this._intersectsObject(n,o)&&i(o)}),!0})}forEachAlongRayWithVerticalOffset(t,r,i,n){const s=Ru(t,r);this._forEachNode(this._root,a=>{if(!this._intersectsNodeWithOffset(s,a,n))return!1;const o=a.node;return o.terminals.forAll(l=>{this._intersectsObjectWithOffset(s,l,n)&&i(l)}),o.residents!==null&&o.residents.forAll(l=>{this._intersectsObjectWithOffset(s,l,n)&&i(l)}),!0})}forEach(t){this._forEachNode(this._root,r=>{const i=r.node;return i.terminals.forAll(t),i.residents!==null&&i.residents.forAll(t),!0}),this._degenerateObjects.forEach(t)}forEachDegenerateObject(t){this._degenerateObjects.forEach(t)}findClosest(t,r,i,n=()=>!0,s=1/0){let a=1/0,o=1/0,l=null;const c=uq(t,r),u=h=>{if(--s,!n(h))return;const p=this._objectToBoundingSphere(h);if(!fv(i,p))return;const m=V1(t,r,p),g=m-p[3],b=m+p[3];g<a&&(a=g,o=b,l=h)};return this._forEachNodeDepthOrdered(this._root,h=>{if(s<=0||!fv(i,h.bounds)||(le(Bu,c,h.halfSize),he(Bu,Bu,h.bounds),V1(t,r,Bu)>o))return!1;const p=h.node;return p.terminals.forAll(m=>u(m)),p.residents!==null&&p.residents.forAll(m=>u(m)),!0},t,r),l}forEachInDepthRange(t,r,i,n,s,a,o){let l=-1/0,c=1/0;const u={setRange:b=>{i===$9.DepthOrder.FRONT_TO_BACK?(l=Math.max(l,b.near),c=Math.min(c,b.far)):(l=Math.max(l,-b.far),c=Math.min(c,-b.near))}};u.setRange(n);const h=V1(r,i,t),p=uq(r,i),m=uq(r,-i),g=b=>{if(!o(b))return;const w=this._objectToBoundingSphere(b),v=w,x=V1(r,i,v)-h,T=x-w[3],E=x+w[3];T>c||E<l||!fv(a,w)||s(b,u)};this._forEachNodeDepthOrdered(this._root,b=>{if(!fv(a,b.bounds)||(le(Bu,p,b.halfSize),he(Bu,Bu,b.bounds),V1(r,i,Bu)-h>c)||(le(Bu,m,b.halfSize),he(Bu,Bu,b.bounds),V1(r,i,Bu)-h<l))return!1;const w=b.node;return w.terminals.forAll(v=>g(v)),w.residents!==null&&w.residents.forAll(v=>g(v)),!0},r,i)}forEachNode(t){this._forEachNode(this._root,r=>t(r.node,r.bounds,r.halfSize))}forEachNeighbor(t,r){const i=cy(r),n=r,s=a=>{const o=this._objectToBoundingSphere(a),l=cy(o),c=i+l;Vs(o,n)-c*c<=0&&t(a)};this._forEachNode(this._root,a=>{const o=cy(a.bounds),l=i+o;if(Vs(a.bounds,n)-l*l>0)return!1;const c=a.node;return c.terminals.forAll(u=>s(u)),c.residents!==null&&c.residents.forAll(u=>s(u)),!0}),this.forEachDegenerateObject(s)}_intersectsNode(t,r){return iI(r.bounds,2*-r.halfSize,Zd),iI(r.bounds,2*r.halfSize,Qd),Ape(t.origin,t.direction,Zd,Qd)}_intersectsNodeWithOffset(t,r,i){return iI(r.bounds,2*-r.halfSize,Zd),iI(r.bounds,2*r.halfSize,Qd),i.applyToMinMax(Zd,Qd),Ape(t.origin,t.direction,Zd,Qd)}_intersectsObject(t,r){const i=this._objectToBoundingSphere(r);return!(i[3]>0)||oZ(i,t)}_intersectsObjectWithOffset(t,r,i){const n=this._objectToBoundingSphere(r);return!(n[3]>0)||oZ(i.applyToBoundingSphere(n),t)}_forEachNode(t,r){let i=ln.acquire().init(t);const n=[i];for(;n.length!==0;){if(i=n.pop(),r(i)&&!i.isLeaf())for(let s=0;s<i.node.children.length;s++)i.node.children[s]&&n.push(ln.acquire().init(i).advance(s));ln.release(i)}}_forEachNodeDepthOrdered(t,r,i,n=$9.DepthOrder.FRONT_TO_BACK){let s=ln.acquire().init(t);const a=[s];for($yt(i,n,fme);a.length!==0;){if(s=a.pop(),r(s)&&!s.isLeaf())for(let o=7;o>=0;--o){const l=fme[o];s.node.children[l]&&a.push(ln.acquire().init(s).advance(l))}ln.release(s)}}_remove(t,r,i){j_.clear();const n=i.advanceTo(r,(s,a)=>{j_.push(s.node),j_.push(a)})?i.node.terminals:i.node.residents;if(n.removeUnordered(t),n.length===0)for(let s=j_.length-2;s>=0;s-=2){const a=j_.data[s],o=j_.data[s+1];if(!this._purge(a,o))break}}_nodeIsEmpty(t){if(t.terminals.length!==0)return!1;if(t.residents!==null)return t.residents.length===0;for(let r=0;r<t.children.length;r++)if(t.children[r])return!1;return!0}_purge(t,r){return r>=0&&(t.children[r]=null),!!this._nodeIsEmpty(t)&&(t.residents===null&&(t.residents=new Qt({shrink:!0})),!0)}_add(t,r){r.advanceTo(this._objectToBoundingSphere(t))?r.node.terminals.push(t):(r.node.residents.push(t),r.node.residents.length>this._maximumObjectsPerNode&&r.depth<this._maximumDepth&&this._split(r))}_split(t){const r=t.node.residents;t.node.residents=null;for(let i=0;i<r.length;i++){const n=ln.acquire().init(t);this._add(r.getItemAt(i),n),ln.release(n)}}_grow(t,r){if(r!==0&&(ume(t,r,i=>this._objectToBoundingSphere(i),Xp),aC(Xp[3])&&!this._fitsInsideTree(Xp)))if(this._nodeIsEmpty(this._root.node))t9(Xp,this._root.bounds),this._root.halfSize=1.25*Xp[3];else{const i=this._rootBoundsForRootAsSubNode(Xp);this._placingRootViolatesMaxDepth(i)?this._rebuildTree(Xp,i):this._growRootAsSubNode(i),ln.release(i)}}_rebuildTree(t,r){oe(fq,r.bounds),fq[3]=r.halfSize,ume([t,fq],2,n=>n,pq);const i=ln.acquire().init(this._root);this._root.initFrom(null,pq,1.25*pq[3]),this._forEachNode(i,n=>(this.add(n.node.terminals.data,n.node.terminals.length),n.node.residents!==null&&this.add(n.node.residents.data,n.node.residents.length),!0)),ln.release(i)}_placingRootViolatesMaxDepth(t){const r=Math.log(t.halfSize/this._root.halfSize)*Math.LOG2E;let i=0;return this._forEachNode(this._root,n=>(i=Math.max(i,n.depth),i+r<=this._maximumDepth)),i+r>this._maximumDepth}_rootBoundsForRootAsSubNode(t){const r=t[3],i=t;let n=-1/0;const s=this._root.bounds,a=this._root.halfSize;for(let o=0;o<3;o++){const l=s[o]-a-(i[o]-r),c=i[o]+r-(s[o]+a),u=Math.max(0,Math.ceil(l/(2*a))),h=Math.max(0,Math.ceil(c/(2*a)))+1,p=2**Math.ceil(Math.log(u+h)*Math.LOG2E);n=Math.max(n,p),nI[o].min=u,nI[o].max=h}for(let o=0;o<3;o++){let l=nI[o].min,c=nI[o].max;const u=(n-(l+c))/2;l+=Math.ceil(u),c+=Math.floor(u);const h=s[o]-a-l*a*2;hq[o]=h+(c+l)*a}return hq[3]=n*a*eRe,ln.acquire().initFrom(null,hq,n*a,0)}_growRootAsSubNode(t){const r=this._root.node;oe(Xp,this._root.bounds),Xp[3]=this._root.halfSize,this._root.init(t),t.advanceTo(Xp,null,!0),t.node.children=r.children,t.node.residents=r.residents,t.node.terminals=r.terminals}_shrink(){for(;;){const t=this._findShrinkIndex();if(t===-1)break;this._root.advance(t),this._root.depth=0}}_findShrinkIndex(){if(this._root.node.terminals.length!==0||this._root.isLeaf())return-1;let t=null;const r=this._root.node.children;let i=0,n=0;for(;n<r.length&&t==null;)i=n++,t=r[i];for(;n<r.length;)if(r[n++])return-1;return i}_isDegenerate(t){return!aC(this._objectToBoundingSphere(t)[3])}_fitsInsideTree(t){const r=this._root.bounds,i=this._root.halfSize;return t[3]<=i&&t[0]>=r[0]-i&&t[0]<=r[0]+i&&t[1]>=r[1]-i&&t[1]<=r[1]+i&&t[2]>=r[2]-i&&t[2]<=r[2]+i}}class ln{constructor(){this.bounds=Us(),this.halfSize=0,this.initFrom(null,null,0,0)}init(t){return this.initFrom(t.node,t.bounds,t.halfSize,t.depth)}initFrom(t,r,i,n=this.depth){return this.node=_(t)?t:ln.createEmptyNode(),_(r)&&t9(r,this.bounds),this.halfSize=i,this.depth=n,this}advance(t){let r=this.node.children[t];r||(r=ln.createEmptyNode(),this.node.children[t]=r),this.node=r,this.halfSize/=2,this.depth++;const i=KAe[t];return this.bounds[0]+=i[0]*this.halfSize,this.bounds[1]+=i[1]*this.halfSize,this.bounds[2]+=i[2]*this.halfSize,this.bounds[3]=this.halfSize*eRe,this}advanceTo(t,r,i=!1){for(;;){if(this.isTerminalFor(t))return r&&r(this,-1),!0;if(this.isLeaf()){if(!i)return r&&r(this,-1),!1;this.node.residents=null}const n=this._childIndex(t);r&&r(this,n),this.advance(n)}}isLeaf(){return this.node.residents!=null}isTerminalFor(t){return t[3]>this.halfSize/2}_childIndex(t){const r=this.bounds;return(r[0]<t[0]?1:0)+(r[1]<t[1]?2:0)+(r[2]<t[2]?4:0)}static createEmptyNode(){return{children:[null,null,null,null,null,null,null,null],terminals:new Qt({shrink:!0}),residents:new Qt({shrink:!0})}}static acquire(){return ln._pool.acquire()}static release(t){ln._pool.release(t)}static clearPool(){ln._pool.prune()}}function Pyt(e,t){e[0]=Math.min(e[0],t[0]-t[3]),e[1]=Math.min(e[1],t[1]-t[3]),e[2]=Math.min(e[2],t[2]-t[3])}function Iyt(e,t){e[0]=Math.max(e[0],t[0]+t[3]),e[1]=Math.max(e[1],t[1]+t[3]),e[2]=Math.max(e[2],t[2]+t[3])}function iI(e,t,r){r[0]=e[0]+t,r[1]=e[1]+t,r[2]=e[2]+t}function ume(e,t,r,i){if(t===1){const n=r(e[0]);t9(n,i)}else{Zd[0]=1/0,Zd[1]=1/0,Zd[2]=1/0,Qd[0]=-1/0,Qd[1]=-1/0,Qd[2]=-1/0;for(let n=0;n<t;n++){const s=r(e[n]);aC(s[3])&&(Pyt(Zd,s),Iyt(Qd,s))}As(i,Zd,Qd,.5),i[3]=Math.max(Qd[0]-Zd[0],Qd[1]-Zd[1],Qd[2]-Zd[2])/2}}function $yt(e,t,r){if(!J2.length)for(let i=0;i<8;++i)J2.push({index:0,distance:0});for(let i=0;i<8;++i){const n=KAe[i];J2.data[i].index=i,J2.data[i].distance=V1(e,t,n)}J2.sort((i,n)=>i.distance-n.distance);for(let i=0;i<8;++i)r[i]=J2.data[i].index}function uq(e,t){let r=1/0,i=null;for(let n=0;n<8;++n){const s=V1(e,t,hme[n]);s<r&&(r=s,i=hme[n])}return i}function V1(e,t,r){return t*(e[0]*r[0]+e[1]*r[1]+e[2]*r[2])}function aC(e){return!isNaN(e)&&e!==-1/0&&e!==1/0&&e>0}ln._pool=new Fn(ln),function(e){var t;(t=e.DepthOrder||(e.DepthOrder={}))[t.FRONT_TO_BACK=1]="FRONT_TO_BACK",t[t.BACK_TO_FRONT=-1]="BACK_TO_FRONT"}($9||($9={}));const KAe=[Ve(-1,-1,-1),Ve(1,-1,-1),Ve(-1,1,-1),Ve(1,1,-1),Ve(-1,-1,1),Ve(1,-1,1),Ve(-1,1,1),Ve(1,1,1)],hme=[Ve(-1,-1,-1),Ve(-1,-1,1),Ve(-1,1,-1),Ve(-1,1,1),Ve(1,-1,-1),Ve(1,-1,1),Ve(1,1,-1),Ve(1,1,1)],eRe=Math.sqrt(3),sK=[null];function Lyt(e){return sK[0]=e,sK}const hq=Us(),Bu=M(),Zd=M(),Qd=M(),j_=new Qt,Dyt=Us(),Xp=Us(),fq=Us(),pq=Us(),nI=[{min:0,max:0},{min:0,max:0},{min:0,max:0}],J2=new Qt,fme=[0,0,0,0,0,0,0,0],vp=$9;class tRe extends wO{constructor(t,r=""){var i,n,s;super(),this.apiLayerUid=r,this.type=Np.Layer,this.events=new mn,this.isSliceable=!1,this._objects=new Qt,this._stageHandles=new Ft,this.apiLayerUid=r,this.isVisible=(i=t==null?void 0:t.isVisible)!=null?i:!0,this.isPickable=(n=t==null?void 0:t.isPickable)!=null?n:!0,this.updatePolicy=(s=t==null?void 0:t.updatePolicy)!=null?s:p9.ASYNC}get objects(){return this._objects}destroy(){this.detachStage(),this._stage=null}attachStage(t){this.detachStage(),this._stage=t;for(const r of Myt)this._stageHandles.add(this.events.on(r,i=>t.handleEvent(r,i)))}detachStage(){this._stageHandles.removeAll(),this.invalidateSpatialQueryAccelerator()}add(t){this._objects.push(t),t.parentLayer=this,this.events.emit("layerObjectAdded",{layer:this,object:t}),_(this._octree)&&this._octree.add([t])}remove(t){this._objects.removeUnordered(t)&&(t.parentLayer=null,this.events.emit("layerObjectRemoved",{layer:this,object:t}),_(this._octree)&&this._octree.remove([t]))}addMany(t){this._objects.pushArray(t);for(const r of t)r.parentLayer=this;this.events.emit("layerObjectsAdded",{layer:this,objects:t}),_(this._octree)&&this._octree.add(t)}removeMany(t){const r=new Array;if(this._objects.removeUnorderedMany(t,t.length,r),r.length!==0){for(const i of r)i.parentLayer=null;this.events.emit("layerObjectsRemoved",{layer:this,objects:r}),_(this._octree)&&this._octree.remove(r)}}sync(){_(this._stage)&&this.updatePolicy!==p9.SYNC&&this._stage.syncLayer(this.id)}notifyObjectBBChanged(t,r){_(this._octree)&&this._octree.update(t,r)}getSpatialQueryAccelerator(){return R(this._octree)&&this._objects.length>50&&this._createOctree(),this._octree}shaderTransformationChanged(){this.invalidateSpatialQueryAccelerator(),this.events.emit("shaderTransformationChanged",this)}invalidateSpatialQueryAccelerator(){this._octree=ct(this._octree)}_createOctree(){this._octree=new vp(t=>t.boundingVolumeWorldSpace.bounds),this._octree.add(this._objects.data,this._objects.length)}}function uk(e){return _(e)&&e.type===Np.Layer}class rRe{constructor(t,r){this._material=t,this._repository=r,this._map=new Map}destroy(){this._map.forEach((t,r)=>{_(t)&&this._repository.release(this._material,sx(r))})}load(t,r){this._map.has(r)||this._map.set(r,this._repository.acquire(this._material,sx(r)));const i=this._map.get(r);if(_(i)){if(i.ensureResources(t)===qc.LOADED)return i;this._repository.requestRender()}return null}}function sx(e){switch(e){case je.MATERIAL:return K.Color;case je.MATERIAL_ALPHA:return K.Alpha;case je.MATERIAL_DEPTH:return K.Depth;case je.MATERIAL_NORMAL:return K.Normal;case je.MATERIAL_DEPTH_SHADOWMAP_ALL:return K.Shadow;case je.MATERIAL_HIGHLIGHT:return K.Highlight;case je.MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT:case je.MATERIAL_DEPTH_SHADOWMAP_DEFAULT:return K.Shadow}}const pme=8;function iRe(e,t){const r=e.vertex;r.uniforms.add(new He("intrinsicWidth",i=>i.width)),t.vvSize?(e.attributes.add(O.SIZEFEATUREATTRIBUTE,"float"),r.uniforms.add(new St("vvSizeMinSize",i=>i.vvSizeMinSize)),r.uniforms.add(new St("vvSizeMaxSize",i=>i.vvSizeMaxSize)),r.uniforms.add(new St("vvSizeOffset",i=>i.vvSizeOffset)),r.uniforms.add(new St("vvSizeFactor",i=>i.vvSizeFactor)),r.code.add(S`float getSize() {
return intrinsicWidth * clamp(vvSizeOffset + sizeFeatureAttribute * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).x;
}`)):(e.attributes.add(O.SIZE,"float"),r.code.add(S`float getSize(){
return intrinsicWidth * size;
}`)),t.vvOpacity?(e.attributes.add(O.OPACITYFEATUREATTRIBUTE,"float"),r.constants.add("vvOpacityNumber","int",8),r.uniforms.add([new Oo("vvOpacityValues",i=>i.vvOpacityValues,pme),new Oo("vvOpacityOpacities",i=>i.vvOpacityOpacities,pme)]),r.code.add(S`float interpolateOpacity( float value ){
if (value <= vvOpacityValues[0]) {
return vvOpacityOpacities[0];
}
for (int i = 1; i < vvOpacityNumber; ++i) {
if (vvOpacityValues[i] >= value) {
float f = (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);
return mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f);
}
}
return vvOpacityOpacities[vvOpacityNumber - 1];
}
vec4 applyOpacity( vec4 color ){
return vec4(color.xyz, interpolateOpacity(opacityFeatureAttribute));
}`)):r.code.add(S`vec4 applyOpacity( vec4 color ){
return color;
}`),t.vvColor?(e.attributes.add(O.COLORFEATUREATTRIBUTE,"float"),r.constants.add("vvColorNumber","int",Cp),r.uniforms.add(new Oo("vvColorValues",i=>i.vvColorValues,Cp)),r.uniforms.add(new Jz("vvColorColors",i=>i.vvColorColors,Cp)),r.code.add(S`vec4 interpolateColor( float value ) {
if (value <= vvColorValues[0]) {
return vvColorColors[0];
}
for (int i = 1; i < vvColorNumber; ++i) {
if (vvColorValues[i] >= value) {
float f = (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);
return mix(vvColorColors[i-1], vvColorColors[i], f);
}
}
return vvColorColors[vvColorNumber - 1];
}
vec4 getColor(){
return applyOpacity(interpolateColor(colorFeatureAttribute));
}`)):(e.attributes.add(O.COLOR,"vec4"),r.code.add(S`vec4 getColor(){
return applyOpacity(color);
}`))}function x_(e,t){e.fragment.include(bd),t.output===K.Shadow?(e.extensions.add("GL_OES_standard_derivatives"),e.fragment.code.add(S`float _calculateFragDepth(const in float depth) {
const float SLOPE_SCALE = 2.0;
const float BIAS = 2.0 * .000015259;
float m = max(abs(dFdx(depth)), abs(dFdy(depth)));
float result = depth + SLOPE_SCALE * m + BIAS;
return clamp(result, .0, .999999);
}
void outputDepth(float _linearDepth) {
gl_FragColor = float2rgba(_calculateFragDepth(_linearDepth));
}`)):t.output===K.Depth&&e.fragment.code.add(S`void outputDepth(float _linearDepth) {
gl_FragColor = float2rgba(_linearDepth);
}`)}function Fyt(e){return R(e)?rm:e.length===4?e:ei(Nyt,e[0],e[1],e[2],1)}const Nyt=Jt();function nRe(e,t){e.constants.add("stippleAlphaColorDiscard","float",.001),e.constants.add("stippleAlphaHighlightDiscard","float",.5),t.stippleEnabled?kyt(e,t):Vyt(e)}function kyt(e,t){const r=!(t.draped&&t.stipplePreferContinuous),{vertex:i,fragment:n}=e;n.include(bd),i.uniforms.add(new kr("stipplePatternPixelSize")),t.draped||(_m(i,t),i.uniforms.add(new He("worldToScreenPerDistanceRatio",(s,a)=>1/a.camera.perScreenPixelRatio)),i.code.add(S`float computeWorldToScreenRatio(vec3 segmentCenter) {
float segmentDistanceToCamera = length(segmentCenter - cameraPosition);
return worldToScreenPerDistanceRatio / segmentDistanceToCamera;
}`)),e.varyings.add("vStippleDistance","float"),t.stippleRequiresClamp&&e.varyings.add("vStippleDistanceLimits","vec2"),t.stippleRequiresStretchMeasure&&e.varyings.add("vStipplePatternStretch","float"),i.code.add(S`
    float discretizeWorldToScreenRatio(float worldToScreenRatio) {
      float step = ${zyt};

      float discreteWorldToScreenRatio = log(worldToScreenRatio);
      discreteWorldToScreenRatio = ceil(discreteWorldToScreenRatio / step) * step;
      discreteWorldToScreenRatio = exp(discreteWorldToScreenRatio);
      return discreteWorldToScreenRatio;
    }
  `),i.code.add(S`vec2 computeStippleDistanceLimits(float startPseudoScreen, float segmentLengthPseudoScreen, float segmentLengthScreen, float patternLength) {`),i.code.add(S`
    if (segmentLengthPseudoScreen >= ${r?"patternLength":"1e4"}) {
  `),i.uniforms.add(new He("pixelRatio",(s,a)=>a.camera.pixelRatio)),i.code.add(S`
        // Round the screen length to get an integer number of pattern repetitions (minimum 1).
        float repetitions = segmentLengthScreen / (patternLength * pixelRatio);
        float flooredRepetitions = max(1.0, floor(repetitions + 0.5));
        float segmentLengthScreenRounded = flooredRepetitions * patternLength;

        ${t.stippleRequiresStretchMeasure?S`
              float stretch = repetitions / flooredRepetitions;

              // We need to impose a lower bound on the stretch factor to prevent the dots from merging together when there is only 1 repetition.
              // 0.75 is the lowest possible stretch value for flooredRepetitions > 1, so it makes sense as lower bound.
              vStipplePatternStretch = max(0.75, stretch);`:""}

        return vec2(0.0, segmentLengthScreenRounded);
      }
      return vec2(startPseudoScreen, startPseudoScreen + segmentLengthPseudoScreen);
    }
  `),n.uniforms.add(new Hi("stipplePatternTexture")),n.uniforms.add(new kr("stipplePatternSDFNormalizer")),n.uniforms.add(new kr("stipplePatternTextureSize")),n.uniforms.add(new kr("stipplePatternPixelSizeInv")),n.code.add(S`float padTexture(float u) {
return (u * stipplePatternTextureSize + 1.0)/(stipplePatternTextureSize + 2.0);
}`),n.code.add(S`
    float getStippleSDF(out bool isClamped) {
      ${t.stippleRequiresClamp?S`
          float stippleDistanceClamped = clamp(vStippleDistance, vStippleDistanceLimits.x, vStippleDistanceLimits.y);
          vec2 aaCorrectedLimits = vStippleDistanceLimits + vec2(1.0, -1.0) / gl_FragCoord.w;
          isClamped = vStippleDistance < aaCorrectedLimits.x || vStippleDistance > aaCorrectedLimits.y;`:S`
          float stippleDistanceClamped = vStippleDistance;
          isClamped = false;`}

      float u = stippleDistanceClamped * gl_FragCoord.w * stipplePatternPixelSizeInv;
      ${t.stippleScaleWithLineWidth?S`u *= vLineSizeInv;`:""}
      u = padTexture(fract(u));

      float encodedSDF = rgba2float(texture2D(stipplePatternTexture, vec2(u, 0.5)));
      float sdf = (encodedSDF * 2.0 - 1.0) * stipplePatternSDFNormalizer;

      ${t.stippleRequiresStretchMeasure?S`return (sdf - 0.5) * vStipplePatternStretch + 0.5;`:S`return sdf;`}
    }

    float getStippleSDF() {
      bool ignored;
      return getStippleSDF(ignored);
    }

    float getStippleAlpha() {
      bool isClamped;
      float stippleSDF = getStippleSDF(isClamped);

      float antiAliasedResult = ${t.stippleScaleWithLineWidth?S`clamp(stippleSDF * vLineWidth + 0.5, 0.0, 1.0);`:S`clamp(stippleSDF + 0.5, 0.0, 1.0);`}

      return isClamped ? floor(antiAliasedResult + 0.5) : antiAliasedResult;
    }
  `),t.stippleOffColorEnabled?(n.uniforms.add(new cr("stippleOffColor",s=>Fyt(s.stippleOffColor))),n.code.add(S`#define discardByStippleAlpha(stippleAlpha, threshold) {}
#define blendStipple(color, stippleAlpha) mix(color, stippleOffColor, stippleAlpha)`)):n.code.add(S`#define discardByStippleAlpha(stippleAlpha, threshold) if (stippleAlpha < threshold) { discard; }
#define blendStipple(color, stippleAlpha) vec4(color.rgb, color.a * stippleAlpha)`)}function Vyt(e){e.fragment.code.add(S`float getStippleAlpha() { return 1.0; }
#define discardByStippleAlpha(_stippleAlpha_, _threshold_) {}
#define blendStipple(color, _stippleAlpha_) color`)}const zyt=S.float(.4);var Bh;(function(e){e[e.BUTT=0]="BUTT",e[e.SQUARE=1]="SQUARE",e[e.ROUND=2]="ROUND",e[e.COUNT=3]="COUNT"})(Bh||(Bh={}));class Ji extends Mo{constructor(){super(...arguments),this.output=K.Color,this.capType=Bh.BUTT,this.transparencyPassType=yt.NONE,this.occluder=!1,this.hasSlicePlane=!1,this.hasPolygonOffset=!1,this.writeDepth=!1,this.draped=!1,this.stippleEnabled=!1,this.stippleOffColorEnabled=!1,this.stippleScaleWithLineWidth=!1,this.stipplePreferContinuous=!0,this.roundJoins=!1,this.vvSize=!1,this.vvColor=!1,this.vvOpacity=!1,this.falloffEnabled=!1,this.innerColorEnabled=!1,this.hasOccludees=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1,this.wireframe=!1}}d([H({count:K.COUNT})],Ji.prototype,"output",void 0),d([H({count:Bh.COUNT})],Ji.prototype,"capType",void 0),d([H({count:yt.COUNT})],Ji.prototype,"transparencyPassType",void 0),d([H()],Ji.prototype,"occluder",void 0),d([H()],Ji.prototype,"hasSlicePlane",void 0),d([H()],Ji.prototype,"hasPolygonOffset",void 0),d([H()],Ji.prototype,"writeDepth",void 0),d([H()],Ji.prototype,"draped",void 0),d([H()],Ji.prototype,"stippleEnabled",void 0),d([H()],Ji.prototype,"stippleOffColorEnabled",void 0),d([H()],Ji.prototype,"stippleScaleWithLineWidth",void 0),d([H()],Ji.prototype,"stipplePreferContinuous",void 0),d([H()],Ji.prototype,"roundJoins",void 0),d([H()],Ji.prototype,"vvSize",void 0),d([H()],Ji.prototype,"vvColor",void 0),d([H()],Ji.prototype,"vvOpacity",void 0),d([H()],Ji.prototype,"falloffEnabled",void 0),d([H()],Ji.prototype,"innerColorEnabled",void 0),d([H()],Ji.prototype,"hasOccludees",void 0),d([H()],Ji.prototype,"hasMultipassTerrain",void 0),d([H()],Ji.prototype,"cullAboveGround",void 0),d([H()],Ji.prototype,"wireframe",void 0),d([H({constValue:!0})],Ji.prototype,"stippleRequiresClamp",void 0),d([H({constValue:!0})],Ji.prototype,"stippleRequiresStretchMeasure",void 0),d([H({constValue:!0})],Ji.prototype,"hasVvInstancing",void 0),d([H({constValue:!0})],Ji.prototype,"hasSliceTranslatedView",void 0);const hk=1;function Uyt(e){const t=new Qr,r=e.hasMultipassTerrain&&(e.output===K.Color||e.output===K.Alpha);t.include(Pz),t.include(iRe,e),t.include(nRe,e),e.output===K.Depth&&t.include(x_,e),_u(t,e);const{vertex:i,fragment:n}=t;i.uniforms.add([new Ei("inverseProjectionMatrix",(p,m)=>m.camera.inverseProjectionMatrix),new _r("nearFar",(p,m)=>m.camera.nearFar),new He("miterLimit",p=>p.join!=="miter"?0:p.miterLimit),new cr("viewport",(p,m)=>m.camera.fullViewport)]),i.constants.add("LARGE_HALF_FLOAT","float",65500),t.attributes.add(O.POSITION,"vec3"),t.attributes.add(O.SUBDIVISIONFACTOR,"float"),t.attributes.add(O.UV0,"vec2"),t.attributes.add(O.AUXPOS1,"vec3"),t.attributes.add(O.AUXPOS2,"vec3"),t.varyings.add("vColor","vec4"),t.varyings.add("vpos","vec3"),t.varyings.add("linearDepth","float"),r&&t.varyings.add("depth","float");const s=e.capType===Bh.ROUND,a=e.stippleEnabled&&e.stippleScaleWithLineWidth||s;a&&t.varyings.add("vLineWidth","float");const o=e.stippleEnabled&&e.stippleScaleWithLineWidth;o&&t.varyings.add("vLineSizeInv","float");const l=e.innerColorEnabled||s;l&&t.varyings.add("vLineDistance","float");const c=e.stippleEnabled&&s,u=e.falloffEnabled||c;u&&t.varyings.add("vLineDistanceNorm","float"),s&&(t.varyings.add("vSegmentSDF","float"),t.varyings.add("vReverseSegmentSDF","float")),i.code.add(S`#define PERPENDICULAR(v) vec2(v.y, -v.x);
float interp(float ncp, vec4 a, vec4 b) {
return (-ncp - a.z) / (b.z - a.z);
}
vec2 rotate(vec2 v, float a) {
float s = sin(a);
float c = cos(a);
mat2 m = mat2(c, -s, s, c);
return m * v;
}`),i.code.add(S`vec4 projectAndScale(vec4 pos) {
vec4 posNdc = proj * pos;
posNdc.xy *= viewport.zw / posNdc.w;
return posNdc;
}`),i.code.add(S`
    void clipAndTransform(inout vec4 pos, inout vec4 prev, inout vec4 next, in bool isStartVertex) {
      float vnp = nearFar[0] * 0.99;

      if(pos.z > -nearFar[0]) {
        //current pos behind ncp --> we need to clip
        if (!isStartVertex) {
          if(prev.z < -nearFar[0]) {
            //previous in front of ncp
            pos = mix(prev, pos, interp(vnp, prev, pos));
            next = pos;
          } else {
            pos = vec4(0.0, 0.0, 0.0, 1.0);
          }
        } else {
          if(next.z < -nearFar[0]) {
            //next in front of ncp
            pos = mix(pos, next, interp(vnp, pos, next));
            prev = pos;
          } else {
            pos = vec4(0.0, 0.0, 0.0, 1.0);
          }
        }
      } else {
        //current position visible
        if (prev.z > -nearFar[0]) {
          //previous behind ncp
          prev = mix(pos, prev, interp(vnp, pos, prev));
        }
        if (next.z > -nearFar[0]) {
          //next behind ncp
          next = mix(next, pos, interp(vnp, next, pos));
        }
      }

      ${r?"depth = pos.z;":""}
      linearDepth = (-pos.z - nearFar[0]) / (nearFar[1] - nearFar[0]);

      pos = projectAndScale(pos);
      next = projectAndScale(next);
      prev = projectAndScale(prev);
    }
  `),i.uniforms.add(new He("pixelRatio",(p,m)=>m.camera.pixelRatio)),i.code.add(S`
  void main(void) {
    // unpack values from uv0.y
    bool isStartVertex = abs(abs(uv0.y)-3.0) == 1.0;

    float coverage = 1.0;

    // Check for special value of uv0.y which is used by the Renderer when graphics
    // are removed before the VBO is recompacted. If this is the case, then we just
    // project outside of clip space.
    if (uv0.y == 0.0) {
      // Project out of clip space
      gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
    }
    else {
      bool isJoin = abs(uv0.y) < 3.0;

      float lineSize = getSize();
      float lineWidth = lineSize * pixelRatio;

      ${a?S`vLineWidth = lineWidth;`:""}
      ${o?S`vLineSizeInv = 1.0 / lineSize;`:""}

      // convert sub-pixel coverage to alpha
      if (lineWidth < 1.0) {
        coverage = lineWidth;
        lineWidth = 1.0;
      }else{
        // Ribbon lines cannot properly render non-integer sizes. Round width to integer size if
        // larger than one for better quality. Note that we do render < 1 pixels more or less correctly
        // so we only really care to round anything larger than 1.
        lineWidth = floor(lineWidth + 0.5);
      }

      vec4 pos  = view * vec4(position.xyz, 1.0);
      vec4 prev = view * vec4(auxpos1.xyz, 1.0);
      vec4 next = view * vec4(auxpos2.xyz, 1.0);

      clipAndTransform(pos, prev, next, isStartVertex);

      vec2 left = (pos.xy - prev.xy);
      vec2 right = (next.xy - pos.xy);

      float leftLen = length(left);
      float rightLen = length(right);
  `),(e.stippleEnabled||s)&&i.code.add(S`
      float isEndVertex = float(!isStartVertex);
      vec2 segmentOrigin = mix(pos.xy, prev.xy, isEndVertex);
      vec2 segment = mix(right, left, isEndVertex);
      ${s?S`vec2 segmentEnd = mix(next.xy, pos.xy, isEndVertex);`:""}
    `),i.code.add(S`left = (leftLen > 0.001) ? left/leftLen : vec2(0.0, 0.0);
right = (rightLen > 0.001) ? right/rightLen : vec2(0.0, 0.0);
vec2 capDisplacementDir = vec2(0, 0);
vec2 joinDisplacementDir = vec2(0, 0);
float displacementLen = lineWidth;
if (isJoin) {
bool isOutside = (left.x * right.y - left.y * right.x) * uv0.y > 0.0;
joinDisplacementDir = normalize(left + right);
joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);
if (leftLen > 0.001 && rightLen > 0.001) {
float nDotSeg = dot(joinDisplacementDir, left);
displacementLen /= length(nDotSeg * left - joinDisplacementDir);
if (!isOutside) {
displacementLen = min(displacementLen, min(leftLen, rightLen)/abs(nDotSeg));
}
}
if (isOutside && (displacementLen > miterLimit * lineWidth)) {`),e.roundJoins?i.code.add(S`
        vec2 startDir = leftLen < 0.001 ? right : left;
        startDir = PERPENDICULAR(startDir);

        vec2 endDir = rightLen < 0.001 ? left : right;
        endDir = PERPENDICULAR(endDir);

        float factor = ${e.stippleEnabled?S`min(1.0, subdivisionFactor * ${S.float((hk+2)/(hk+1))})`:S`subdivisionFactor`};

        float rotationAngle = acos(clamp(dot(startDir, endDir), -1.0, 1.0));
        joinDisplacementDir = rotate(startDir, -sign(uv0.y) * factor * rotationAngle);
      `):i.code.add(S`if (leftLen < 0.001) {
joinDisplacementDir = right;
}
else if (rightLen < 0.001) {
joinDisplacementDir = left;
}
else {
joinDisplacementDir = (isStartVertex || subdivisionFactor > 0.0) ? right : left;
}
joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);`);const h=e.capType!==Bh.BUTT;return i.code.add(S`
        displacementLen = lineWidth;
      }
    } else {
      // CAP handling ---------------------------------------------------
      joinDisplacementDir = isStartVertex ? right : left;
      joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);

      ${h?S`capDisplacementDir = isStartVertex ? -right : left;`:""}
    }
  `),i.code.add(S`
    // Displacement (in pixels) caused by join/or cap
    vec2 dpos = joinDisplacementDir * sign(uv0.y) * displacementLen + capDisplacementDir * displacementLen;

    ${u||l?S`float lineDistNorm = sign(uv0.y) * pos.w;`:""}

    ${l?S`vLineDistance = lineWidth * lineDistNorm;`:""}
    ${u?S`vLineDistanceNorm = lineDistNorm;`:""}

    pos.xy += dpos;
  `),s&&i.code.add(S`vec2 segmentDir = normalize(segment);
vSegmentSDF = (isJoin && isStartVertex) ? LARGE_HALF_FLOAT : (dot(pos.xy - segmentOrigin, segmentDir) * pos.w) ;
vReverseSegmentSDF = (isJoin && !isStartVertex) ? LARGE_HALF_FLOAT : (dot(pos.xy - segmentEnd, -segmentDir) * pos.w);`),e.stippleEnabled&&(e.draped?i.uniforms.add(new He("worldToScreenRatio",(p,m)=>1/m.screenToPCSRatio)):i.code.add(S`vec3 segmentCenter = mix((auxpos2 + position) * 0.5, (position + auxpos1) * 0.5, isEndVertex);
float worldToScreenRatio = computeWorldToScreenRatio(segmentCenter);`),i.code.add(S`float segmentLengthScreenDouble = length(segment);
float segmentLengthScreen = segmentLengthScreenDouble * 0.5;
float discreteWorldToScreenRatio = discretizeWorldToScreenRatio(worldToScreenRatio);
float segmentLengthRender = length(mix(auxpos2 - position, position - auxpos1, isEndVertex));
vStipplePatternStretch = worldToScreenRatio / discreteWorldToScreenRatio;`),e.draped?i.code.add(S`float segmentLengthPseudoScreen = segmentLengthScreen / pixelRatio * discreteWorldToScreenRatio / worldToScreenRatio;
float startPseudoScreen = uv0.x * discreteWorldToScreenRatio - mix(0.0, segmentLengthPseudoScreen, isEndVertex);`):i.code.add(S`float startPseudoScreen = mix(uv0.x, uv0.x - segmentLengthRender, isEndVertex) * discreteWorldToScreenRatio;
float segmentLengthPseudoScreen = segmentLengthRender * discreteWorldToScreenRatio;`),i.code.add(S`
      float patternLength = ${e.stippleScaleWithLineWidth?"lineSize * ":""} stipplePatternPixelSize;

      // Compute the coordinates at both start and end of the line segment, because we need both to clamp to in the fragment shader
      vStippleDistanceLimits = computeStippleDistanceLimits(startPseudoScreen, segmentLengthPseudoScreen, segmentLengthScreen, patternLength);

      vStippleDistance = mix(vStippleDistanceLimits.x, vStippleDistanceLimits.y, isEndVertex);

      // Adjust the coordinate to the displaced position (the pattern is shortened/overextended on the in/outside of joins)
      if (segmentLengthScreenDouble >= 0.001) {
        // Project the actual vertex position onto the line segment. Note that the resulting factor is within [0..1] at the
        // original vertex positions, and slightly outside of that range at the displaced positions
        vec2 stippleDisplacement = pos.xy - segmentOrigin;
        float stippleDisplacementFactor = dot(segment, stippleDisplacement) / (segmentLengthScreenDouble * segmentLengthScreenDouble);

        // Apply this offset to the actual vertex coordinate (can be screen or pseudo-screen space)
        vStippleDistance += (stippleDisplacementFactor - isEndVertex) * (vStippleDistanceLimits.y - vStippleDistanceLimits.x);
      }

      // Cancel out perspective correct interpolation because we want this length the really represent the screen distance
      vStippleDistanceLimits *= pos.w;
      vStippleDistance *= pos.w;

      // Disable stipple distance limits on caps
      vStippleDistanceLimits = isJoin ?
                                 vStippleDistanceLimits :
                                 isStartVertex ?
                                  vec2(-1e038, vStippleDistanceLimits.y) :
                                  vec2(vStippleDistanceLimits.x, 1e038);
    `)),i.code.add(S`
      // Convert back into NDC
      pos.xy = (pos.xy / viewport.zw) * pos.w;

      vColor = getColor();
      vColor.a *= coverage;

      ${e.wireframe&&!e.draped?"pos.z -= 0.001 * pos.w;":""}

      // transform final position to camera space for slicing
      vpos = (inverseProjectionMatrix * pos).xyz;
      gl_Position = pos;
    }
  }
  `),r&&t.include(Mu,e),t.include(Cn,e),n.include($m),n.code.add(S`
  void main() {
    discardBySlice(vpos);
    ${r?"terrainDepthTest(gl_FragCoord, depth);":""}
  `),e.wireframe?n.code.add(S`vec4 finalColor = vec4(1.0, 0.0, 1.0, 1.0);`):(s&&n.code.add(S`
      float sdf = min(vSegmentSDF, vReverseSegmentSDF);
      vec2 fragmentPosition = vec2(
        min(sdf, 0.0),
        vLineDistance
      ) * gl_FragCoord.w;

      float fragmentRadius = length(fragmentPosition);
      float fragmentCapSDF = (fragmentRadius - vLineWidth) * 0.5; // Divide by 2 to transform from double pixel scale
      float capCoverage = clamp(0.5 - fragmentCapSDF, 0.0, 1.0);

      if (capCoverage < ${S.float(ao)}) {
        discard;
      }
    `),c?n.code.add(S`
      vec2 stipplePosition = vec2(
        min(getStippleSDF() * 2.0 - 1.0, 0.0),
        vLineDistanceNorm * gl_FragCoord.w
      );
      float stippleRadius = length(stipplePosition * vLineWidth);
      float stippleCapSDF = (stippleRadius - vLineWidth) * 0.5; // Divide by 2 to transform from double pixel scale
      float stippleCoverage = clamp(0.5 - stippleCapSDF, 0.0, 1.0);
      float stippleAlpha = step(${S.float(ao)}, stippleCoverage);
      `):n.code.add(S`float stippleAlpha = getStippleAlpha();`),n.uniforms.add(new cr("intrinsicColor",p=>p.color)),n.code.add(S`discardByStippleAlpha(stippleAlpha, stippleAlphaColorDiscard);
vec4 color = intrinsicColor * vColor;`),e.innerColorEnabled&&(n.uniforms.add(new cr("innerColor",p=>vt(p.innerColor,p.color))),n.uniforms.add(new He("innerWidth",(p,m)=>p.innerWidth*m.camera.pixelRatio)),n.code.add(S`float distToInner = abs(vLineDistance * gl_FragCoord.w) - innerWidth;
float innerAA = clamp(0.5 - distToInner, 0.0, 1.0);
float innerAlpha = innerColor.a + color.a * (1.0 - innerColor.a);
color = mix(color, vec4(innerColor.rgb, innerAlpha), innerAA);`)),n.code.add(S`vec4 finalColor = blendStipple(color, stippleAlpha);`),e.falloffEnabled&&(n.uniforms.add(new He("falloff",p=>p.falloff)),n.code.add(S`finalColor.a *= pow(max(0.0, 1.0 - abs(vLineDistanceNorm * gl_FragCoord.w)), falloff);`))),n.code.add(S`
    if (finalColor.a < ${S.float(ao)}) {
      discard;
    }

    ${e.output===K.Alpha?S`gl_FragColor = vec4(finalColor.a);`:""}
    ${e.output===K.Color?S`gl_FragColor = highlightSlice(finalColor, vpos);`:""}
    ${e.output===K.Color&&e.transparencyPassType===yt.Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}
    ${e.output===K.Highlight?S`gl_FragColor = vec4(1.0);`:""}
    ${e.output===K.Depth?S`outputDepth(linearDepth);`:""}
  }
  `),t}const Byt=Object.freeze(Object.defineProperty({__proto__:null,NUM_ROUND_JOIN_SUBDIVISIONS:hk,build:Uyt},Symbol.toStringTag,{value:"Module"})),gae={func:vi.LESS},fk={func:vi.ALWAYS},xm={mask:255},sRe={mask:0},Gyt=e=>({function:{func:vi.NOTEQUAL,ref:e,mask:e},operation:{fail:fn.KEEP,zFail:fn.KEEP,zPass:fn.KEEP}}),jyt=e=>({function:{func:vi.ALWAYS,ref:e,mask:e},operation:{fail:fn.KEEP,zFail:fn.KEEP,zPass:fn.REPLACE}}),T_={function:{func:vi.ALWAYS,ref:oc.OutlineVisualElementMask,mask:oc.OutlineVisualElementMask},operation:{fail:fn.KEEP,zFail:fn.KEEP,zPass:fn.ZERO}},d_={function:{func:vi.ALWAYS,ref:oc.OutlineVisualElementMask,mask:oc.OutlineVisualElementMask},operation:{fail:fn.KEEP,zFail:fn.KEEP,zPass:fn.REPLACE}},aRe={function:{func:vi.EQUAL,ref:oc.OutlineVisualElementMask,mask:oc.OutlineVisualElementMask},operation:{fail:fn.KEEP,zFail:fn.KEEP,zPass:fn.KEEP}},oRe={function:{func:vi.NOTEQUAL,ref:oc.OutlineVisualElementMask,mask:oc.OutlineVisualElementMask},operation:{fail:fn.KEEP,zFail:fn.KEEP,zPass:fn.KEEP}},lRe=new Map([[O.POSITION,0],[O.SUBDIVISIONFACTOR,1],[O.UV0,2],[O.AUXPOS1,3],[O.AUXPOS2,4],[O.COLOR,5],[O.COLORFEATUREATTRIBUTE,5],[O.SIZE,6],[O.SIZEFEATUREATTRIBUTE,6],[O.OPACITYFEATUREATTRIBUTE,7]]);class dU extends gi{constructor(t,r,i){super(t,r,i),this.stippleTextureRepository=t.stippleTextureRepository}initializeProgram(t){const r=dU.shader.get().build(this.configuration);return new ai(t.rctx,r,lRe)}destroy(){super.destroy(),this.stippleTextureRepository.release(this.stipplePattern),this.stipplePattern=null,this.stippleTextureBind=null}bindPass(t,r){if(this.program.bindPass(t,r),this.stipplePattern!==t.stipplePattern){const i=t.stipplePattern;this.stippleTextureBind=this.stippleTextureRepository.swap(this.stipplePattern,i),this.stipplePattern=i}if(this.configuration.stippleEnabled){const{pixelSize:i,sdfNormalizer:n,pixels:s}=_(this.stippleTextureBind)?this.stippleTextureBind(this.program):{pixelSize:1,sdfNormalizer:1,pixels:1};this.program.setUniform1f("stipplePatternSDFNormalizer",n),this.program.setUniform1f("stipplePatternTextureSize",s),this.program.setUniform1f("stipplePatternPixelSize",i),this.program.setUniform1f("stipplePatternPixelSizeInv",1/i)}}_makePipelineState(t,r){const i=this.configuration,n=t===yt.NONE,s=t===yt.FrontFace;return jt({blending:i.output===K.Color||i.output===K.Alpha?n?wu:eb(t):null,depthTest:{func:w_(t)},depthWrite:n?i.writeDepth&&fc:Kz(t),colorWrite:or,stencilWrite:i.hasOccludees?xm:null,stencilTest:i.hasOccludees?r?d_:T_:null,polygonOffset:n||s?i.hasPolygonOffset&&mme:tU})}initializePipeline(){const t=this.configuration;if(t.occluder){const r=t.hasPolygonOffset&&mme;this._occluderPipelineTransparent=jt({blending:wu,polygonOffset:r,depthTest:fk,depthWrite:null,colorWrite:or,stencilWrite:null,stencilTest:oRe}),this._occluderPipelineOpaque=jt({blending:wu,polygonOffset:r,depthTest:fk,depthWrite:null,colorWrite:or,stencilWrite:sRe,stencilTest:aRe}),this._occluderPipelineMaskWrite=jt({blending:null,polygonOffset:r,depthTest:gae,depthWrite:null,colorWrite:null,stencilWrite:xm,stencilTest:d_})}return this._occludeePipelineState=this._makePipelineState(this.configuration.transparencyPassType,!0),this._makePipelineState(this.configuration.transparencyPassType,!1)}get primitiveType(){return this.configuration.wireframe?Dt.LINES:Dt.TRIANGLE_STRIP}getPipelineState(t,r){return r?this._occludeePipelineState:this.configuration.occluder?t===Ee.TRANSPARENT_OCCLUDER_MATERIAL?this._occluderPipelineTransparent:t===Ee.OCCLUDER_MATERIAL?this._occluderPipelineOpaque:this._occluderPipelineMaskWrite:super.getPipelineState(t,r)}}dU.shader=new si(Byt,()=>ie(()=>import("./RibbonLine.glsl.71b9dcfd.js"),[],import.meta.url));const mme={factor:0,units:-4},qyt=fe.getLogger("esri.views.3d.webgl-engine.materials.RibbonLineMaterial");var Nc;(function(e){e[e.LEFT_JOIN_START=-2]="LEFT_JOIN_START",e[e.LEFT_JOIN_END=-1]="LEFT_JOIN_END",e[e.LEFT_CAP_START=-4]="LEFT_CAP_START",e[e.LEFT_CAP_END=-5]="LEFT_CAP_END",e[e.RIGHT_JOIN_START=2]="RIGHT_JOIN_START",e[e.RIGHT_JOIN_END=1]="RIGHT_JOIN_END",e[e.RIGHT_CAP_START=4]="RIGHT_CAP_START",e[e.RIGHT_CAP_END=5]="RIGHT_CAP_END"})(Nc||(Nc={}));class R4 extends Dm{constructor(t){super(t,new Wyt),this._vertexAttributeLocations=lRe,this.techniqueConfig=new Ji,this.layout=this.createLayout()}isClosed(t,r){return cRe(this.parameters,t,r)}getConfiguration(t,r){this.techniqueConfig.output=t,this.techniqueConfig.draped=r.slot===Ee.DRAPED_MATERIAL;const i=_(this.parameters.stipplePattern)&&t!==K.Highlight;return this.techniqueConfig.stippleEnabled=i,this.techniqueConfig.stippleOffColorEnabled=i&&_(this.parameters.stippleOffColor),this.techniqueConfig.stippleScaleWithLineWidth=i&&this.parameters.stippleScaleWithLineWidth,this.techniqueConfig.stipplePreferContinuous=i&&this.parameters.stipplePreferContinuous,this.techniqueConfig.hasSlicePlane=this.parameters.hasSlicePlane,this.techniqueConfig.hasOccludees=this.parameters.hasOccludees,this.techniqueConfig.roundJoins=this.parameters.join==="round",this.techniqueConfig.capType=this.parameters.cap,this.techniqueConfig.hasPolygonOffset=this.parameters.hasPolygonOffset,this.techniqueConfig.writeDepth=this.parameters.writeDepth,this.techniqueConfig.vvColor=this.parameters.vvColorEnabled,this.techniqueConfig.vvOpacity=this.parameters.vvOpacityEnabled,this.techniqueConfig.vvSize=this.parameters.vvSizeEnabled,this.techniqueConfig.innerColorEnabled=this.parameters.innerWidth>0&&_(this.parameters.innerColor),this.techniqueConfig.falloffEnabled=this.parameters.falloff>0,this.techniqueConfig.occluder=this.parameters.renderOccluded===ki.OccludeAndTransparentStencil,this.techniqueConfig.transparencyPassType=r.transparencyPassType,this.techniqueConfig.hasMultipassTerrain=r.multipassTerrain.enabled,this.techniqueConfig.cullAboveGround=r.multipassTerrain.cullAboveGround,this.techniqueConfig.wireframe=this.parameters.wireframe,this.techniqueConfig}intersect(t,r,i,n,s,a,o,l,c){_(c)?this._intersectDrapedLineGeometry(t,n,c,a,o):this._intersectLineGeometry(t,r,i,n,o)}_intersectDrapedLineGeometry(t,r,i,n,s){if(!r.options.selectionMode)return;const a=t.vertexAttributes.get(O.POSITION).data,o=t.vertexAttributes.get(O.SIZE);let l=this.parameters.width;if(this.parameters.vvSizeEnabled){const g=t.vertexAttributes.get(O.SIZEFEATUREATTRIBUTE).data[0];l*=Le(this.parameters.vvSizeOffset[0]+g*this.parameters.vvSizeFactor[0],this.parameters.vvSizeMinSize[0],this.parameters.vvSizeMaxSize[0])}else o&&(l*=o.data[0]);const c=n[0],u=n[1],h=(l/2+4)*t.screenToWorldRatio;let p=Number.MAX_VALUE,m=0;for(let g=0;g<a.length-5;g+=3){const b=a[g],w=a[g+1],v=c-b,x=u-w,T=a[g+3]-b,E=a[g+4]-w,C=Le((T*v+E*x)/(T*T+E*E),0,1),A=T*C-v,P=E*C-x,I=A*A+P*P;I<p&&(p=I,m=g/3)}p<h*h&&s(i.dist,i.normal,m,!1)}_intersectLineGeometry(t,r,i,n,s){if(!n.options.selectionMode||xO(r))return;if(!vCe(i))return void qyt.error("intersection assumes a translation-only matrix");const a=t.vertexAttributes,o=a.get(O.POSITION).data;let l=this.parameters.width;if(this.parameters.vvSizeEnabled){const v=a.get(O.SIZEFEATUREATTRIBUTE).data[0];l*=Le(this.parameters.vvSizeOffset[0]+v*this.parameters.vvSizeFactor[0],this.parameters.vvSizeMinSize[0],this.parameters.vvSizeMaxSize[0])}else a.has(O.SIZE)&&(l*=a.get(O.SIZE).data[0]);const c=n.camera,u=Yyt;Na(u,n.point);const h=l*c.pixelRatio/2+4*c.pixelRatio;ne(v8[0],u[0]-h,u[1]+h,0),ne(v8[1],u[0]+h,u[1]+h,0),ne(v8[2],u[0]+h,u[1]-h,0),ne(v8[3],u[0]-h,u[1]-h,0);for(let v=0;v<4;v++)if(!c.unprojectFromRenderScreen(v8[v],Hm[v]))return;Ao(c.eye,Hm[0],Hm[1],gq),Ao(c.eye,Hm[1],Hm[2],yq),Ao(c.eye,Hm[2],Hm[3],bq),Ao(c.eye,Hm[3],Hm[0],vq);let p=Number.MAX_VALUE,m=0;const g=aK(this.parameters,a,t.indices)?o.length-2:o.length-5;for(let v=0;v<g;v+=3){Ol[0]=o[v]+i[12],Ol[1]=o[v+1]+i[13],Ol[2]=o[v+2]+i[14];const x=(v+3)%o.length;if(Ml[0]=o[x]+i[12],Ml[1]=o[x+1]+i[13],Ml[2]=o[x+2]+i[14],di(gq,Ol)<0&&di(gq,Ml)<0||di(yq,Ol)<0&&di(yq,Ml)<0||di(bq,Ol)<0&&di(bq,Ml)<0||di(vq,Ol)<0&&di(vq,Ml)<0)continue;if(c.projectToRenderScreen(Ol,H_),c.projectToRenderScreen(Ml,W_),H_[2]<0&&W_[2]>0){pe(Yp,Ol,Ml);const E=c.frustum,C=-di(E[ci.NEAR],Ol)/Se(Yp,E[ci.NEAR]);le(Yp,Yp,C),he(Ol,Ol,Yp),c.projectToRenderScreen(Ol,H_)}else if(H_[2]>0&&W_[2]<0){pe(Yp,Ml,Ol);const E=c.frustum,C=-di(E[ci.NEAR],Ml)/Se(Yp,E[ci.NEAR]);le(Yp,Yp,C),he(Ml,Ml,Yp),c.projectToRenderScreen(Ml,W_)}else if(H_[2]<0&&W_[2]<0)continue;H_[2]=0,W_[2]=0;const T=sie(uw(H_,W_,bme),u);T<p&&(p=T,oe(gme,Ol),oe(yme,Ml),m=v/3)}const b=n.rayBegin,w=n.rayEnd;if(p<h*h){let v=Number.MAX_VALUE;if(fSe(uw(gme,yme,bme),uw(b,w,Zyt),q_)){pe(q_,q_,b);const x=Oe(q_);le(q_,q_,1/x),v=x/fi(b,w)}s(v,q_,m,!1)}}computeAttachmentOrigin(t,r){const i=t.vertexAttributes;if(!i)return null;const n=t.indices,s=i.get(O.POSITION);return xse(s,n?n.get(O.POSITION):null,n&&aK(this.parameters,i,n),r)}createLayout(){const t=gn().vec3f(O.POSITION).f32(O.SUBDIVISIONFACTOR).vec2f(O.UV0).vec3f(O.AUXPOS1).vec3f(O.AUXPOS2);return this.parameters.vvSizeEnabled?t.f32(O.SIZEFEATUREATTRIBUTE):t.f32(O.SIZE),this.parameters.vvColorEnabled?t.f32(O.COLORFEATUREATTRIBUTE):t.vec4f(O.COLOR),this.parameters.vvOpacityEnabled&&t.f32(O.OPACITYFEATUREATTRIBUTE),t}createBufferWriter(){return new Xyt(this.layout,this.parameters)}requiresSlot(t,r){if(t===Ee.DRAPED_MATERIAL)return!0;if(this.parameters.renderOccluded===ki.OccludeAndTransparentStencil)return t===Ee.OPAQUE_MATERIAL||t===Ee.OCCLUDER_MATERIAL||t===Ee.TRANSPARENT_OCCLUDER_MATERIAL;const i=sx(r);return i===K.Color||i===K.Alpha?t===(this.parameters.writeDepth?Ee.TRANSPARENT_MATERIAL:Ee.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL):t===Ee.OPAQUE_MATERIAL}createGLMaterial(t){return t.output===K.Color||t.output===K.Alpha||t.output===K.Highlight||t.output===K.Depth?new Hyt(t):null}validateParameters(t){t.join!=="miter"&&(t.miterLimit=0)}}class Hyt extends v_{_updateOccludeeState(t){t.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:t.hasOccludees})}beginSlot(t){return this._output!==K.Color&&this._output!==K.Alpha||this._updateOccludeeState(t),this.ensureTechnique(dU,t)}}class Wyt extends rae{constructor(){super(...arguments),this.width=0,this.color=Ih,this.join="miter",this.cap=Bh.BUTT,this.miterLimit=5,this.writeDepth=!0,this.hasPolygonOffset=!1,this.stippleScaleWithLineWidth=!1,this.stipplePreferContinuous=!0,this.hasSlicePlane=!1,this.vvFastUpdate=!1,this.isClosed=!1,this.falloff=0,this.innerWidth=0,this.hasOccludees=!1,this.wireframe=!1}}class Xyt{constructor(t,r){this.parameters=r,this.numJoinSubdivisions=0,this.vertexBufferLayout=t;const i=r.stipplePattern?1:0;switch(this.parameters.join){case"miter":case"bevel":this.numJoinSubdivisions=i;break;case"round":this.numJoinSubdivisions=hk+i}}_isClosed(t){return aK(this.parameters,t.vertexAttributes,t.indices)}allocate(t){return this.vertexBufferLayout.createBuffer(t)}elementCount(t){const i=t.indices.get(O.POSITION).length/2+1,n=this._isClosed(t);let s=n?2:2*2;return s+=((n?i:i-1)-(n?0:1))*(2*this.numJoinSubdivisions+4),s+=2,this.parameters.wireframe&&(s=2+4*(s-2)),s}write(t,r,i,n){var B;const s=Qyt,a=Jyt,o=Kyt,l=r.vertexAttributes.get(O.POSITION).data,c=r.indices&&r.indices.get(O.POSITION),u=(B=r.vertexAttributes.get(O.DISTANCETOSTART))==null?void 0:B.data;c&&c.length!==2*(l.length/3-1)&&console.warn("RibbonLineMaterial does not support indices");let h=1,p=0;this.parameters.vvSizeEnabled?p=r.vertexAttributes.get(O.SIZEFEATUREATTRIBUTE).data[0]:r.vertexAttributes.has(O.SIZE)&&(h=r.vertexAttributes.get(O.SIZE).data[0]);let m=[1,1,1,1],g=0;this.parameters.vvColorEnabled?g=r.vertexAttributes.get(O.COLORFEATUREATTRIBUTE).data[0]:r.vertexAttributes.has(O.COLOR)&&(m=r.vertexAttributes.get(O.COLOR).data);let b=0;this.parameters.vvOpacityEnabled&&(b=r.vertexAttributes.get(O.OPACITYFEATUREATTRIBUTE).data[0]);const w=l.length/3,v=t.transformation,x=new Float32Array(i.buffer),T=this.vertexBufferLayout.stride/4;let E=n*T;const C=E;let A=0;const P=u?(X,Y,ce)=>A=u[ce]:(X,Y,ce)=>A+=fi(X,Y),I=(X,Y,ce,se,D,F,U)=>{if(x[E++]=Y[0],x[E++]=Y[1],x[E++]=Y[2],x[E++]=se,x[E++]=U,x[E++]=D,x[E++]=X[0],x[E++]=X[1],x[E++]=X[2],x[E++]=ce[0],x[E++]=ce[1],x[E++]=ce[2],this.parameters.vvSizeEnabled?x[E++]=p:x[E++]=h,this.parameters.vvColorEnabled)x[E++]=g;else{const j=Math.min(4*F,m.length-4);x[E++]=m[j+0],x[E++]=m[j+1],x[E++]=m[j+2],x[E++]=m[j+3]}this.parameters.vvOpacityEnabled&&(x[E++]=b)};E+=T,ne(a,l[0],l[1],l[2]),v&&ze(a,a,v);const L=this._isClosed(r);if(L){const X=l.length-3;ne(s,l[X],l[X+1],l[X+2]),v&&ze(s,s,v)}else ne(o,l[3],l[4],l[5]),v&&ze(o,o,v),I(a,a,o,1,Nc.LEFT_CAP_START,0,0),I(a,a,o,1,Nc.RIGHT_CAP_START,0,0),oe(s,a),oe(a,o);const V=L?0:1,G=L?w:w-1;for(let X=V;X<G;X++){const Y=(X+1)%w*3;ne(o,l[Y+0],l[Y+1],l[Y+2]),v&&ze(o,o,v),P(s,a,X),I(s,a,o,0,Nc.LEFT_JOIN_END,X,A),I(s,a,o,0,Nc.RIGHT_JOIN_END,X,A);const ce=this.numJoinSubdivisions;for(let se=0;se<ce;++se){const D=(se+1)/(ce+1);I(s,a,o,D,Nc.LEFT_JOIN_END,X,A),I(s,a,o,D,Nc.RIGHT_JOIN_END,X,A)}I(s,a,o,1,Nc.LEFT_JOIN_START,X,A),I(s,a,o,1,Nc.RIGHT_JOIN_START,X,A),oe(s,a),oe(a,o)}L?(ne(o,l[3],l[4],l[5]),v&&ze(o,o,v),A=P(s,a,G),I(s,a,o,0,Nc.LEFT_JOIN_END,V,A),I(s,a,o,0,Nc.RIGHT_JOIN_END,V,A)):(A=P(s,a,G),I(s,a,a,0,Nc.LEFT_CAP_END,G,A),I(s,a,a,0,Nc.RIGHT_CAP_END,G,A)),mq(x,C+T,x,C,T),E=mq(x,E-T,x,E,T),this.parameters.wireframe&&this._addWireframeVertices(i,C,E,T)}_addWireframeVertices(t,r,i,n){const s=new Float32Array(t.buffer,i*Float32Array.BYTES_PER_ELEMENT),a=new Float32Array(t.buffer,r*Float32Array.BYTES_PER_ELEMENT,i-r);let o=0;const l=c=>o=mq(a,c,s,o,n);for(let c=0;c<a.length-1;c+=2*n)l(c),l(c+2*n),l(c+1*n),l(c+2*n),l(c+1*n),l(c+3*n)}}function mq(e,t,r,i,n){for(let s=0;s<n;s++)r[i++]=e[t++];return i}function aK(e,t,r){return cRe(e,t.get(O.POSITION).data,r?r.get(O.POSITION):null)}function cRe(e,t,r){return!!e.isClosed&&(r?r.length>2:t.length>6)}const Ol=M(),Ml=M(),Yp=M(),q_=M(),Yyt=M(),H_=ro(),W_=ro(),gme=M(),yme=M(),bme=Om(),Zyt=Om(),Qyt=M(),Jyt=M(),Kyt=M(),v8=[ro(),ro(),ro(),ro()],Hm=[M(),M(),M(),M()],gq=Er(),yq=Er(),bq=Er(),vq=Er();class yae{constructor(t,r=125e4){this._originSR=t,this._gridSize=r,this._origins=new Map,this._objects=new Map,this._rootOriginId="root/"+ic()}getOrigin(t){const r=this._origins.get(this._rootOriginId);if(r==null){const u=Oyt.rootOrigin;if(_(u))return this._origins.set(this._rootOriginId,b7(u[0],u[1],u[2],this._rootOriginId)),this.getOrigin(t);const h=b7(t[0]+Math.random()-.5,t[1]+Math.random()-.5,t[2]+Math.random()-.5,this._rootOriginId);return this._origins.set(this._rootOriginId,h),h}const i=this._gridSize,n=Math.round(t[0]/i),s=Math.round(t[1]/i),a=Math.round(t[2]/i),o=`${n}/${s}/${a}`;let l=this._origins.get(o);const c=.5*i;if(pe(ua,t,r.vec3),ua[0]=Math.abs(ua[0]),ua[1]=Math.abs(ua[1]),ua[2]=Math.abs(ua[2]),ua[0]<c&&ua[1]<c&&ua[2]<c){if(l){const u=Math.max(...ua);if(pe(ua,t,l.vec3),ua[0]=Math.abs(ua[0]),ua[1]=Math.abs(ua[1]),ua[2]=Math.abs(ua[2]),Math.max(...ua)<u)return l}return r}return l||(l=b7(n*i,s*i,a*i,o),this._origins.set(o,l)),l}_drawOriginBox(t,r=Tr(1,1,0,1)){const i=window.view,n=i._stage,s=r.toString();if(!this._objects.has(s)){this._material=new R4({width:2,color:r}),n.add(this._material);const m=new tRe({isPickable:!1}),g=new rb({castShadow:!1});n.add(g),m.add(g),n.add(m),this._objects.set(s,g)}const a=this._objects.get(s),o=[0,1,5,4,0,2,1,7,6,2,0,1,3,7,5,4,6,2,0],l=o.length,c=new Array(3*l),u=new Uint16Array(2*(l-1)),h=.5*this._gridSize;for(let m=0;m<l;m++)c[3*m+0]=t[0]+(1&o[m]?h:-h),c[3*m+1]=t[1]+(2&o[m]?h:-h),c[3*m+2]=t[2]+(4&o[m]?h:-h),m>0&&(u[2*m+0]=m-1,u[2*m+1]=m);mi(c,this._originSR,0,c,i.renderSpatialReference,0,l);const p=new Gi([[O.POSITION,{size:3,data:c,exclusive:!0}]],[[O.POSITION,u]],lc.Line);n.add(p),a.addGeometry(p,this._material,Es)}}const ua=M();class dRe{constructor(t,r,i,n=null){this.rctx=t,this.sliceHelper=n,this.lastFrameCamera=new ni,this.pass=je.MATERIAL,this.renderOccludedMask=vme,this.bindParameters=new Fz(r,i,_(n)?n.plane:null)}resetRenderOccludedMask(){this.renderOccludedMask=vme}get isHighlightPass(){return this.pass===je.MATERIAL_HIGHLIGHT}}class ebt extends dRe{constructor(t,r,i,n,s){super(t,i,n,s),this.offscreenRenderingHelper=r,this.sliceHelper=s}}const vme=ki.Occlude|ki.OccludeAndTransparent|ki.OccludeAndTransparentStencil;var L9;(function(e){e[e.Highlight=0]="Highlight",e[e.Default=1]="Default"})(L9||(L9={}));class sI{constructor(){this.camera=new ni,this.lightMat=Ae()}}class bae{constructor(t,r,i=0){this.rctx=t,this.viewingMode=r,this._enabled=!1,this._snapshots=new Array,this._textureSize=0,this.maxTextureSize=0,this.numCascades=1,this.maxNumCascades=4,this.splitSchemeLambda=0,this.warp=!0,this._cascadeDistances=[0,0,0,0,0],this._usedCascadeDistances=Jt(),this._cascades=[new sI,new sI,new sI,new sI],this.maxTextureSize=this.rctx.parameters.maxTextureSize,this.snapshotCount=i}get depthTexture(){return this._depthTexture}get textureSize(){return this._textureSize}get cascadeDistances(){return ei(this._usedCascadeDistances,this._cascadeDistances[0],this.numCascades>1?this._cascadeDistances[1]:1/0,this.numCascades>2?this._cascadeDistances[2]:1/0,this.numCascades>3?this._cascadeDistances[3]:1/0)}dispose(){this._discardDepthTexture(),this._discardAllSnapshots()}set maxCascades(t){this.maxNumCascades=Le(Math.floor(t),1,4)}get maxCascades(){return this.maxNumCascades}set enabled(t){this._enabled=t,t||(this._discardDepthTexture(),this._discardAllSnapshots())}get enabled(){return this._enabled}get ready(){return this._enabled&&_(this._depthTexture)}get snapshotCount(){return this._snapshots.length}set snapshotCount(t){const r=this._snapshots.length;if(t>r){const i=t-r;this._snapshots.length=t;for(let n=0;n<i;++n)this._snapshots[r+n]=null}else if(t<this.snapshotCount){const i=r-t;for(let n=0;n<i;++n)this._discardSnapshot(t+n);this._snapshots.length=t}}getSnapshot(t){return this.enabled?this._snapshots[t]:null}getCascades(){for(let t=0;t<this.numCascades;++t)wq[t]=this._cascades[t];return wq.length=this.numCascades,wq}start(t,r,i){pt(this.enabled),this._textureSize=this._computeTextureSize(t.fullWidth,t.fullHeight),this._ensureDepthTexture();const{near:n,far:s}=this._clampNearFar(i);this._computeCascadeDistances(s,n),this._setupMatrices(t,r);const a=t.viewMatrix,o=t.projectionMatrix;for(let l=0;l<this.numCascades;++l)this._constructCascade(l,o,a,r);this.lastOrigin=null,this.clear()}finish(t){pt(this.enabled),this.rctx.bindFramebuffer(t)}getShadowMapMatrices(t){if(!this.lastOrigin||!Kl(t,this.lastOrigin)){this.lastOrigin=this.lastOrigin||M(),oe(this.lastOrigin,t);for(let r=0;r<this.numCascades;++r){wl(Ome,this._cascades[r].lightMat,t);for(let i=0;i<16;++i)Mme[16*r+i]=Ome[i]}}return Mme}takeCascadeSnapshotTo(t,r){pt(this.enabled);const i=this._ensureSnapshot(r);this._bindFbo();const n=this.rctx,s=n.bindTexture(i,at.TEXTURE_UNIT_FOR_UPDATES);n.gl.copyTexSubImage2D(mt.TEXTURE_2D,0,t.camera.viewport[0],t.camera.viewport[1],t.camera.viewport[0],t.camera.viewport[1],t.camera.viewport[2],t.camera.viewport[3]),n.bindTexture(s,at.TEXTURE_UNIT_FOR_UPDATES)}clear(){const t=this.rctx;this._bindFbo(),t.setClearColor(1,1,1,1),t.clearSafe(ii.COLOR_BUFFER_BIT|ii.DEPTH_BUFFER_BIT)}_computeTextureSize(t,r){const i=.5*Math.log(t*t+r*r)*Math.LOG2E,n=.35,s=2**Math.round(i+n);return Math.min(this.maxTextureSize,2*s)}_ensureDepthTexture(){if(_(this._depthTexture)&&this._depthTexture.descriptor.width===this._textureSize)return;this._discardDepthTexture();const t={target:mt.TEXTURE_2D,pixelFormat:Ue.RGBA,dataType:At.UNSIGNED_BYTE,wrapMode:xt.CLAMP_TO_EDGE,samplingMode:tt.NEAREST,flipped:!0,width:this._textureSize,height:this._textureSize};this._depthTexture=new at(this.rctx,t),this._fbo=new Pi(this.rctx,{colorTarget:hn.TEXTURE,depthStencilTarget:Pr.DEPTH_RENDER_BUFFER,width:this._textureSize,height:this._textureSize},this._depthTexture)}_ensureSnapshot(t){let r=this._snapshots[t];if(_(r)&&r.descriptor.width===this._textureSize)return r;this._discardSnapshot(t);const i={target:mt.TEXTURE_2D,pixelFormat:Ue.RGBA,dataType:At.UNSIGNED_BYTE,wrapMode:xt.CLAMP_TO_EDGE,samplingMode:tt.NEAREST,flipped:!0,width:this._textureSize,height:this._textureSize};return r=new at(this.rctx,i),this._snapshots[t]=r,r}_discardDepthTexture(){this._fbo=Qe(this._fbo),this._depthTexture=Qe(this._depthTexture)}_discardSnapshot(t){this._snapshots[t]=Qe(this._snapshots[t])}_discardAllSnapshots(){for(let t=0;t<this.snapshotCount;++t)this._discardSnapshot(t)}_bindFbo(){const t=this.rctx;t.unbindTexture(this._depthTexture),t.bindFramebuffer(this._fbo)}_constructCascade(t,r,i,n){const s=this._cascades[t],a=-this._cascadeDistances[t],o=-this._cascadeDistances[t+1],l=(r[10]*a+r[14])/Math.abs(r[11]*a+r[15]),c=(r[10]*o+r[14])/Math.abs(r[11]*o+r[15]);pt(l<c);for(let h=0;h<8;++h){ei(Tme,h%4==0||h%4==3?-1:1,h%4==0||h%4==1?-1:1,h<4?l:c,1),du(Lc[h],Tme,xme);for(let p=0;p<3;++p)Lc[h][p]/=Lc[h][3]}Io(_q,Lc[0]),wl(_me,Rme,_q),s.camera.viewMatrix=_me;for(let h=0;h<8;++h)ze(Lc[h],Lc[h],s.camera.viewMatrix);oe(Zp,Lc[0]),oe(Qp,Lc[0]);for(let h=1;h<8;++h)for(let p=0;p<3;++p)Zp[p]=Math.min(Zp[p],Lc[h][p]),Qp[p]=Math.max(Qp[p],Lc[h][p]);Zp[2]-=200,Qp[2]+=200,s.camera.near=-Qp[2],s.camera.far=-Zp[2],this.warp?this._constructTrapezoidalProjection(i,n,s):this._constructOrthogonalProjection(s),Zi(s.lightMat,s.camera.projectionMatrix,s.camera.viewMatrix);const u=this._textureSize/2;s.camera.viewport[0]=t%2==0?0:u,s.camera.viewport[1]=Math.floor(t/2)===0?0:u,s.camera.viewport[2]=u,s.camera.viewport[3]=u}_constructOrthogonalProjection(t){qre(t.camera.projectionMatrix,Zp[0],Qp[0],Zp[1],Qp[1],t.camera.near,t.camera.far)}_constructTrapezoidalProjection(t,r,i){const n=1/Lc[0][3],s=1/Lc[4][3];pt(n<s);let a=n+Math.sqrt(n*s);const o=Math.sin(Rs(t[2]*r[0]+t[6]*r[1]+t[10]*r[2]));a/=o,rbt(Lc,a,o,Sme,Eme,tbt,Cme,Ame),ibt(Sme,Eme,Cme,Ame,i.camera.projectionMatrix),i.camera.projectionMatrix[10]=2/(Zp[2]-Qp[2]),i.camera.projectionMatrix[14]=-(Zp[2]+Qp[2])/(Zp[2]-Qp[2])}_setupMatrices(t,r){Zi(wme,t.projectionMatrix,t.viewMatrix),Rn(xme,wme);const i=this.viewingMode===Be.Global?t.eye:ne(_q,0,0,1);kV(Rme,[0,0,0],[-r[0],-r[1],-r[2]],i)}_clampNearFar(t){let{near:r,far:i}=t;return r<2&&(r=2),i<2&&(i=2),r>=i&&(r=2,i=4),{near:r,far:i}}_computeCascadeDistances(t,r){this.numCascades=Math.min(1+Math.floor(Edt(t/r,4)),this.maxNumCascades);const i=(t-r)/this.numCascades,n=(t/r)**(1/this.numCascades);let s=r,a=r;for(let o=0;o<this.numCascades+1;++o)this._cascadeDistances[o]=Kt(s,a,this.splitSchemeLambda),s*=n,a+=i}get gpuMemoryUsage(){var t,r;return this._snapshots.reduce((i,n)=>i+Ww(n),(r=(t=this._fbo)==null?void 0:t.gpuMemoryUsage)!=null?r:0)}get test(){const t=this;return{maxNumCascades:this.maxNumCascades,cascades:this._cascades,textureSize:this._textureSize,set splitSchemeLambda(r){t.splitSchemeLambda=r},get splitSchemeLambda(){return t.splitSchemeLambda},set warp(r){t.warp=r},get warp(){return t.warp}}}}const _me=Ae(),wme=Ae(),xme=Ae(),Tme=Jt(),Lc=[];for(let e=0;e<8;++e)Lc.push(Jt());const Zp=M(),Qp=M(),Sme=it(),Eme=it(),tbt=it(),Cme=it(),Ame=it(),Rme=Ae(),_q=M(),wq=[],Ome=Ae(),Mme=new Float32Array(64),Ed=it(),aT=it(),X_=[it(),it(),it(),it()],Os=it(),xq=it(),wb=it(),_8=it(),oT=it(),lT=it(),aI=it();function rbt(e,t,r,i,n,s,a,o){vr(Ed,0,0);for(let C=0;C<4;++C)Kf(Ed,Ed,e[C]);Qc(Ed,Ed,.25),vr(aT,0,0);for(let C=4;C<8;++C)Kf(aT,aT,e[C]);Qc(aT,aT,.25),OS(X_[0],e[4],e[5],.5),OS(X_[1],e[5],e[6],.5),OS(X_[2],e[6],e[7],.5),OS(X_[3],e[7],e[4],.5);let l=0,c=FN(X_[0],Ed);for(let C=1;C<4;++C){const A=FN(X_[C],Ed);A<c&&(c=A,l=C)}q0(Os,X_[l],e[l+4]);const u=Os[0];let h,p;Os[0]=-Os[1],Os[1]=u,q0(xq,aT,Ed),us(xq,Os)<0&&Zne(Os,Os),OS(Os,Os,xq,r),DA(Os,Os),h=p=us(q0(wb,e[0],Ed),Os);for(let C=1;C<8;++C){const A=us(q0(wb,e[C],Ed),Os);A<h?h=A:A>p&&(p=A)}Na(i,Ed),Qc(wb,Os,h-t),Kf(i,i,wb);let m=-1,g=1,b=0,w=0;for(let C=0;C<8;++C){q0(_8,e[C],i),DA(_8,_8);const A=Os[0]*_8[1]-Os[1]*_8[0];A>0?A>m&&(m=A,b=C):A<g&&(g=A,w=C)}Yx(m>0,"leftArea"),Yx(g<0,"rightArea"),Qc(oT,Os,h),Kf(oT,oT,Ed),Qc(lT,Os,p),Kf(lT,lT,Ed),aI[0]=-Os[1],aI[1]=Os[0];const v=SP(i,e[w],lT,Kf(wb,lT,aI),1,n),x=SP(i,e[b],lT,wb,1,s),T=SP(i,e[b],oT,Kf(wb,oT,aI),1,a),E=SP(i,e[w],oT,wb,1,o);Yx(v,"rayRay"),Yx(x,"rayRay"),Yx(T,"rayRay"),Yx(E,"rayRay")}function gr(e,t){return 3*t+e}const Pme=it();function xc(e,t){return vr(Pme,e[t],e[t+3]),Pme}const Pl=it(),Ke=Li();function ibt(e,t,r,i,n){q0(Pl,r,i),Qc(Pl,Pl,.5),Ke[0]=Pl[0],Ke[1]=Pl[1],Ke[2]=0,Ke[3]=Pl[1],Ke[4]=-Pl[0],Ke[5]=0,Ke[6]=Pl[0]*Pl[0]+Pl[1]*Pl[1],Ke[7]=Pl[0]*Pl[1]-Pl[1]*Pl[0],Ke[8]=1,Ke[gr(0,2)]=-us(xc(Ke,0),e),Ke[gr(1,2)]=-us(xc(Ke,1),e);let s=us(xc(Ke,0),r)+Ke[gr(0,2)],a=us(xc(Ke,1),r)+Ke[gr(1,2)],o=us(xc(Ke,0),i)+Ke[gr(0,2)],l=us(xc(Ke,1),i)+Ke[gr(1,2)];s=-(s+o)/(a+l),Ke[gr(0,0)]+=Ke[gr(1,0)]*s,Ke[gr(0,1)]+=Ke[gr(1,1)]*s,Ke[gr(0,2)]+=Ke[gr(1,2)]*s,s=1/(us(xc(Ke,0),r)+Ke[gr(0,2)]),a=1/(us(xc(Ke,1),r)+Ke[gr(1,2)]),Ke[gr(0,0)]*=s,Ke[gr(0,1)]*=s,Ke[gr(0,2)]*=s,Ke[gr(1,0)]*=a,Ke[gr(1,1)]*=a,Ke[gr(1,2)]*=a,Ke[gr(2,0)]=Ke[gr(1,0)],Ke[gr(2,1)]=Ke[gr(1,1)],Ke[gr(2,2)]=Ke[gr(1,2)],Ke[gr(1,2)]+=1,s=us(xc(Ke,1),t)+Ke[gr(1,2)],a=us(xc(Ke,2),t)+Ke[gr(2,2)],o=us(xc(Ke,1),r)+Ke[gr(1,2)],l=us(xc(Ke,2),r)+Ke[gr(2,2)],s=-.5*(s/a+o/l),Ke[gr(1,0)]+=Ke[gr(2,0)]*s,Ke[gr(1,1)]+=Ke[gr(2,1)]*s,Ke[gr(1,2)]+=Ke[gr(2,2)]*s,s=us(xc(Ke,1),t)+Ke[gr(1,2)],a=us(xc(Ke,2),t)+Ke[gr(2,2)],o=-a/s,Ke[gr(1,0)]*=o,Ke[gr(1,1)]*=o,Ke[gr(1,2)]*=o,n[0]=Ke[0],n[1]=Ke[1],n[2]=0,n[3]=Ke[2],n[4]=Ke[3],n[5]=Ke[4],n[6]=0,n[7]=Ke[5],n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=Ke[6],n[13]=Ke[7],n[14]=0,n[15]=Ke[8]}class uRe{constructor(){this.adds=new Qt,this.removes=new Qt,this.updates=new Qt({allocator:t=>t||new nbt,deallocator:t=>(t.renderGeometry=null,t)})}clear(){this.adds.clear(),this.removes.clear(),this.updates.clear()}prune(){this.adds.prune(),this.removes.prune(),this.updates.prune()}}class nbt{}class sbt{constructor(){this.adds=new Array,this.removes=new Array,this.updates=new Array}}var sr;(function(e){var t,r;(t=e.Geometry||(e.Geometry={}))[t.ADD=1]="ADD",t[t.UPDATE=2]="UPDATE",t[t.REMOVE=4]="REMOVE",(r=e.State||(e.State={}))[r.VISIBILITIES=1]="VISIBILITIES",r[r.VERTEXATTRS=2]="VERTEXATTRS",r[r.TRANSFORMATION=4]="TRANSFORMATION",r[r.HIGHLIGHTS=8]="HIGHLIGHTS",r[r.OCCLUDEES=16]="OCCLUDEES"})(sr||(sr={}));function hRe(e){const t=new Map,r=i=>{let n=t.get(i);return n||(n=new sbt,t.set(i,n)),n};return e.removes.forAll(i=>{Tq(i)&&r(i.material).removes.push(i)}),e.adds.forAll(i=>{Tq(i)&&r(i.material).adds.push(i)}),e.updates.forAll(i=>{Tq(i.renderGeometry)&&r(i.renderGeometry.material).updates.push(i)}),t}function Tq(e){return e.data.indexCount>=1}function abt(e){const t=S`vec3 decodeNormal(vec2 f) {
float z = 1.0 - abs(f.x) - abs(f.y);
return vec3(f + sign(f) * min(z, 0.0), z);
}`;e.fragment.code.add(t),e.vertex.code.add(t)}function uU(e,t){t.normalType===Ii.Attribute&&(e.attributes.add(O.NORMAL,"vec3"),e.vertex.code.add(S`vec3 normalModel() {
return normal;
}`)),t.normalType===Ii.CompressedAttribute&&(e.include(abt),e.attributes.add(O.NORMALCOMPRESSED,"vec2"),e.vertex.code.add(S`vec3 normalModel() {
return decodeNormal(normalCompressed);
}`)),t.normalType===Ii.ScreenDerivative&&(e.extensions.add("GL_OES_standard_derivatives"),e.fragment.code.add(S`vec3 screenDerivativeNormal(vec3 positionView) {
return normalize(cross(dFdx(positionView), dFdy(positionView)));
}`))}var Ii;(function(e){e[e.Attribute=0]="Attribute",e[e.CompressedAttribute=1]="CompressedAttribute",e[e.Ground=2]="Ground",e[e.ScreenDerivative=3]="ScreenDerivative",e[e.COUNT=4]="COUNT"})(Ii||(Ii={}));function hU(e){e.attributes.add(O.POSITION,"vec3"),e.vertex.code.add(S`vec3 positionModel() { return position; }`)}function pk({code:e},t){t.doublePrecisionRequiresObfuscation?e.add(S`vec3 dpPlusFrc(vec3 a, vec3 b) {
return mix(a, a + b, vec3(notEqual(b, vec3(0))));
}
vec3 dpMinusFrc(vec3 a, vec3 b) {
return mix(vec3(0), a - b, vec3(notEqual(a, b)));
}
vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
vec3 t1 = dpPlusFrc(hiA, hiB);
vec3 e = dpMinusFrc(t1, hiA);
vec3 t2 = dpMinusFrc(hiB, e) + dpMinusFrc(hiA, dpMinusFrc(t1, e)) + loA + loB;
return t1 + t2;
}`):e.add(S`vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
vec3 t1 = hiA + hiB;
vec3 e = t1 - hiA;
vec3 t2 = ((hiB - e) + (hiA - (t1 - e))) + loA + loB;
return t1 + t2;
}`)}function $O(e){return!!ue("force-double-precision-obfuscation")||e.driverTest.doublePrecisionRequiresObfuscation}function s5(e,t){e.include(hU);const r=e.vertex;r.include(pk,t),e.varyings.add("vPositionWorldCameraRelative","vec3"),e.varyings.add("vPosition_view","vec3"),r.uniforms.add([new St("transformWorldFromViewTH",i=>i.transformWorldFromViewTH),new St("transformWorldFromViewTL",i=>i.transformWorldFromViewTL),new AO("transformViewFromCameraRelativeRS",i=>i.transformViewFromCameraRelativeRS),new Ei("transformProjFromView",i=>i.transformProjFromView),new zA("transformWorldFromModelRS",i=>i.transformWorldFromModelRS),new yl("transformWorldFromModelTH",i=>i.transformWorldFromModelTH),new yl("transformWorldFromModelTL",i=>i.transformWorldFromModelTL)]),r.code.add(S`vec3 positionWorldCameraRelative() {
vec3 rotatedModelPosition = transformWorldFromModelRS * positionModel();
vec3 transform_CameraRelativeFromModel = dpAdd(
transformWorldFromModelTL,
transformWorldFromModelTH,
-transformWorldFromViewTL,
-transformWorldFromViewTH
);
return transform_CameraRelativeFromModel + rotatedModelPosition;
}`),r.code.add(S`
    void forwardPosition(float fOffset) {
      vPositionWorldCameraRelative = positionWorldCameraRelative();
      if (fOffset != 0.0) {
        vPositionWorldCameraRelative += fOffset * ${t.spherical?S`normalize(transformWorldFromViewTL + vPositionWorldCameraRelative)`:S`vec3(0.0, 0.0, 1.0)`};
      }

      vPosition_view = transformViewFromCameraRelativeRS * vPositionWorldCameraRelative;
      gl_Position = transformProjFromView * vec4(vPosition_view, 1.0);
    }
  `),e.fragment.uniforms.add(new St("transformWorldFromViewTL",i=>i.transformWorldFromViewTL)),r.code.add(S`vec3 positionWorld() {
return transformWorldFromViewTL + vPositionWorldCameraRelative;
}`),e.fragment.code.add(S`vec3 positionWorld() {
return transformWorldFromViewTL + vPositionWorldCameraRelative;
}`)}class fRe extends as{constructor(){super(...arguments),this.transformWorldFromViewTH=M(),this.transformWorldFromViewTL=M(),this.transformViewFromCameraRelativeRS=Li(),this.transformProjFromView=Ae()}}class pRe extends as{constructor(){super(...arguments),this.transformWorldFromModelRS=Li(),this.transformWorldFromModelTH=Mr(),this.transformWorldFromModelTL=Mr()}}function fU(e,t){t.normalType===Ii.Attribute||t.normalType===Ii.CompressedAttribute?(e.include(uU,t),e.varyings.add("vNormalWorld","vec3"),e.varyings.add("vNormalView","vec3"),e.vertex.uniforms.add([new zA("transformNormalGlobalFromModel",r=>r.transformNormalGlobalFromModel),new AO("transformNormalViewFromGlobal",r=>r.transformNormalViewFromGlobal)]),e.vertex.code.add(S`void forwardNormal() {
vNormalWorld = transformNormalGlobalFromModel * normalModel();
vNormalView = transformNormalViewFromGlobal * vNormalWorld;
}`)):t.normalType===Ii.Ground?(e.include(s5,t),e.varyings.add("vNormalWorld","vec3"),e.vertex.code.add(S`
    void forwardNormal() {
      vNormalWorld = ${t.spherical?S`normalize(vPositionWorldCameraRelative);`:S`vec3(0.0, 0.0, 1.0);`}
    }
    `)):e.vertex.code.add(S`void forwardNormal() {}`)}class mRe extends fRe{constructor(){super(...arguments),this.transformNormalViewFromGlobal=Li()}}class gRe extends pRe{constructor(){super(...arguments),this.transformNormalGlobalFromModel=Li(),this.toMapSpace=Jt()}}class oK extends gRe{constructor(t=M()){super(),this.origin=t,this.slicePlaneLocalOrigin=this.origin}}function LO(e,t){t.output===K.Color&&t.receiveShadows?(e.varyings.add("linearDepth","float"),e.vertex.code.add(S`void forwardLinearDepth() { linearDepth = gl_Position.w; }`)):t.output===K.Depth||t.output===K.Shadow?(e.include(s5,t),e.varyings.add("linearDepth","float"),e.vertex.uniforms.add(new _r("nearFar",(r,i)=>i.camera.nearFar)),e.vertex.code.add(S`void forwardLinearDepth() {
linearDepth = (-vPosition_view.z - nearFar[0]) / (nearFar[1] - nearFar[0]);
}`)):e.vertex.code.add(S`void forwardLinearDepth() {}`)}function gv(e,t){t.spherical?e.vertex.code.add(S`vec3 getLocalUp(in vec3 pos, in vec3 origin) {
return normalize(pos + origin);
}`):e.vertex.code.add(S`vec3 getLocalUp(in vec3 pos, in vec3 origin) {
return vec3(0.0, 0.0, 1.0);
}`),t.spherical?e.vertex.code.add(S`mat3 getTBNMatrix(in vec3 n) {
vec3 t = normalize(cross(vec3(0.0, 0.0, 1.0), n));
vec3 b = normalize(cross(n, t));
return mat3(t, b, n);
}`):e.vertex.code.add(S`mat3 getTBNMatrix(in vec3 n) {
vec3 t = vec3(1.0, 0.0, 0.0);
vec3 b = normalize(cross(n, t));
return mat3(t, b, n);
}`)}class DO extends sn{constructor(t,r){super(t,"int",zr.Pass,(i,n,s)=>i.setUniform1i(t,r(n,s)))}}class yRe extends sn{constructor(t,r,i,n){switch(r){case zr.Pass:return void super(t,"mat4",r,(s,a,o)=>s.setUniformMatrix4fv(t,i(a,o)),n);case zr.Draw:return void super(t,"mat4",r,(s,a,o)=>s.setUniformMatrix4fv(t,i(a,o)),n)}}}class bRe extends as{constructor(){super(...arguments),this.origin=M()}}function pU(e,t){t.receiveShadows&&(e.fragment.uniforms.add(new yRe("shadowMapMatrix",zr.Pass,(r,i)=>i.shadowMap.getShadowMapMatrices(r.origin),4)),vRe(e))}function ax(e,t){t.receiveShadows&&(e.fragment.uniforms.add(new yRe("shadowMapMatrix",zr.Draw,(r,i)=>i.shadowMap.getShadowMapMatrices(r.origin),4)),vRe(e))}function vRe(e){const t=e.fragment;t.include(bd),t.uniforms.add([new Wt("shadowMapTex",(r,i)=>i.shadowMap.depthTexture),new DO("numCascades",(r,i)=>i.shadowMap.numCascades),new cr("cascadeDistances",(r,i)=>i.shadowMap.cascadeDistances),new He("depthHalfPixelSz",(r,i)=>.5/i.shadowMap.textureSize)]),t.code.add(S`int chooseCascade(float depth, out mat4 mat) {
vec4 distance = cascadeDistances;
int i = depth < distance[1] ? 0 : depth < distance[2] ? 1 : depth < distance[3] ? 2 : 3;
mat = i == 0 ? shadowMapMatrix[0] : i == 1 ? shadowMapMatrix[1] : i == 2 ? shadowMapMatrix[2] : shadowMapMatrix[3];
return i;
}
vec3 lightSpacePosition(vec3 _vpos, mat4 mat) {
vec4 lv = mat * vec4(_vpos, 1.0);
lv.xy /= lv.w;
return 0.5 * lv.xyz + vec3(0.5);
}
vec2 cascadeCoordinates(int i, vec3 lvpos) {
return vec2(float(i - 2 * (i / 2)) * 0.5, float(i / 2) * 0.5) + 0.5 * lvpos.xy;
}
float readShadowMapDepth(vec2 uv, sampler2D _depthTex) {
return rgba2float(texture2D(_depthTex, uv));
}
float posIsInShadow(vec2 uv, vec3 lvpos, sampler2D _depthTex) {
return readShadowMapDepth(uv, _depthTex) < lvpos.z ? 1.0 : 0.0;
}
float filterShadow(vec2 uv, vec3 lvpos, float halfPixelSize, sampler2D _depthTex) {
float texSize = 0.5 / halfPixelSize;
vec2 st = fract((vec2(halfPixelSize) + uv) * texSize);
float s00 = posIsInShadow(uv + vec2(-halfPixelSize, -halfPixelSize), lvpos, _depthTex);
float s10 = posIsInShadow(uv + vec2(halfPixelSize, -halfPixelSize), lvpos, _depthTex);
float s11 = posIsInShadow(uv + vec2(halfPixelSize, halfPixelSize), lvpos, _depthTex);
float s01 = posIsInShadow(uv + vec2(-halfPixelSize, halfPixelSize), lvpos, _depthTex);
return mix(mix(s00, s10, st.x), mix(s01, s11, st.x), st.y);
}
float readShadowMap(const in vec3 _vpos, float _linearDepth) {
mat4 mat;
int i = chooseCascade(_linearDepth, mat);
if (i >= numCascades) { return 0.0; }
vec3 lvpos = lightSpacePosition(_vpos, mat);
if (lvpos.z >= 1.0) { return 0.0; }
if (lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) { return 0.0; }
vec2 uv = cascadeCoordinates(i, lvpos);
return filterShadow(uv, lvpos, depthHalfPixelSz, shadowMapTex);
}`)}function obt(e){e.fragment.code.add(S`float normals2FoamIntensity(vec3 n, float waveStrength){
float normalizationFactor =  max(0.015, waveStrength);
return max((n.x + n.y)*0.3303545/normalizationFactor + 0.3303545, 0.0);
}`)}function lbt(e){e.fragment.code.add(S`vec3 foamIntensity2FoamColor(float foamIntensityExternal, float foamPixelIntensity, vec3 skyZenitColor, float dayMod){
return foamIntensityExternal * (0.075 * skyZenitColor * pow(foamPixelIntensity, 4.) +  50.* pow(foamPixelIntensity, 23.0)) * dayMod;
}`)}function cbt(e){const t=e.fragment.code;t.add(S`vec3 evaluateDiffuseIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float NdotNG)
{
return ((1.0 - NdotNG) * ambientGround + (1.0 + NdotNG) * ambientSky) * 0.5;
}`),t.add(S`float integratedRadiance(float cosTheta2, float roughness)
{
return (cosTheta2 - 1.0) / (cosTheta2 * (1.0 - roughness * roughness) - 1.0);
}`),t.add(S`vec3 evaluateSpecularIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float RdotNG, float roughness)
{
float cosTheta2 = 1.0 - RdotNG * RdotNG;
float intRadTheta = integratedRadiance(cosTheta2, roughness);
float ground = RdotNG < 0.0 ? 1.0 - intRadTheta : 1.0 + intRadTheta;
float sky = 2.0 - ground;
return (ground * ambientGround + sky * ambientSky) * 0.5;
}`)}function mU(e,t){const r=e.fragment.code;e.include(Pz),t.pbrMode===It.Water||t.pbrMode===It.WaterOnIntegratedMesh?(r.add(S`
    struct PBRShadingWater
    {
        float NdotL;   // cos angle between normal and light direction
        float NdotV;   // cos angle between normal and view direction
        float NdotH;   // cos angle between normal and half vector
        float VdotH;   // cos angle between view direction and half vector
        float LdotH;   // cos angle between light direction and half vector
        float VdotN;   // cos angle between view direction and normal vector
    };

    float dtrExponent = ${t.useCustomDTRExponentForWater?"2.2":"2.0"};
    `),r.add(S`vec3 fresnelReflection(float angle, vec3 f0, float f90) {
return f0 + (f90 - f0) * pow(1.0 - angle, 5.0);
}`),r.add(S`float normalDistributionWater(float NdotH, float roughness)
{
float r2 = roughness * roughness;
float NdotH2 = NdotH * NdotH;
float denom = pow((NdotH2 * (r2 - 1.0) + 1.0), dtrExponent) * PI;
return r2 / denom;
}`),r.add(S`float geometricOcclusionKelemen(float LoH)
{
return 0.25 / (LoH * LoH);
}`),r.add(S`vec3 brdfSpecularWater(in PBRShadingWater props, float roughness, vec3 F0, float F0Max)
{
vec3  F = fresnelReflection(props.VdotH, F0, F0Max);
float dSun = normalDistributionWater(props.NdotH, roughness);
float V = geometricOcclusionKelemen(props.LdotH);
float diffusionSunHaze = mix(roughness + 0.045, roughness + 0.385, 1.0 - props.VdotH);
float strengthSunHaze  = 1.2;
float dSunHaze = normalDistributionWater(props.NdotH, diffusionSunHaze)*strengthSunHaze;
return ((dSun + dSunHaze) * V) * F;
}
vec3 tonemapACES(const vec3 x) {
return (x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14);
}`)):t.pbrMode!==It.Normal&&t.pbrMode!==It.Schematic||(e.include(cbt),r.add(S`struct PBRShadingInfo
{
float NdotL;
float NdotV;
float NdotH;
float VdotH;
float LdotH;
float NdotNG;
float RdotNG;
float NdotAmbDir;
float NdotH_Horizon;
vec3 skyRadianceToSurface;
vec3 groundRadianceToSurface;
vec3 skyIrradianceToSurface;
vec3 groundIrradianceToSurface;
float averageAmbientRadiance;
float ssao;
vec3 albedoLinear;
vec3 f0;
vec3 f90;
vec3 diffuseColor;
float metalness;
float roughness;
};`),r.add(S`float normalDistribution(float NdotH, float roughness)
{
float a = NdotH * roughness;
float b = roughness / (1.0 - NdotH * NdotH + a * a);
return b * b * INV_PI;
}`),r.add(S`const vec4 c0 = vec4(-1.0, -0.0275, -0.572,  0.022);
const vec4 c1 = vec4( 1.0,  0.0425,  1.040, -0.040);
const vec2 c2 = vec2(-1.04, 1.04);
vec2 prefilteredDFGAnalytical(float roughness, float NdotV) {
vec4 r = roughness * c0 + c1;
float a004 = min(r.x * r.x, exp2(-9.28 * NdotV)) * r.x + r.y;
return c2 * a004 + r.zw;
}`),r.add(S`vec3 evaluateEnvironmentIllumination(PBRShadingInfo inputs) {
vec3 indirectDiffuse = evaluateDiffuseIlluminationHemisphere(inputs.groundIrradianceToSurface, inputs.skyIrradianceToSurface, inputs.NdotNG);
vec3 indirectSpecular = evaluateSpecularIlluminationHemisphere(inputs.groundRadianceToSurface, inputs.skyRadianceToSurface, inputs.RdotNG, inputs.roughness);
vec3 diffuseComponent = inputs.diffuseColor * indirectDiffuse * INV_PI;
vec2 dfg = prefilteredDFGAnalytical(inputs.roughness, inputs.NdotV);
vec3 specularColor = inputs.f0 * dfg.x + inputs.f90 * dfg.y;
vec3 specularComponent = specularColor * indirectSpecular;
return (diffuseComponent + specularComponent);
}`),r.add(S`float gamutMapChanel(float x, vec2 p){
return (x < p.x) ? mix(0.0, p.y, x/p.x) : mix(p.y, 1.0, (x - p.x) / (1.0 - p.x) );
}`),r.add(S`vec3 blackLevelSoftCompression(vec3 inColor, PBRShadingInfo inputs){
vec3 outColor;
vec2 p = vec2(0.02 * (inputs.averageAmbientRadiance), 0.0075 * (inputs.averageAmbientRadiance));
outColor.x = gamutMapChanel(inColor.x, p) ;
outColor.y = gamutMapChanel(inColor.y, p) ;
outColor.z = gamutMapChanel(inColor.z, p) ;
return outColor;
}`))}function _Re(e,t){e.include(mU,t),e.include(Oz),e.include(lbt),t.hasCloudsReflections&&e.include(eCe,t),t.hasScreenSpaceReflections&&e.include(Jct,t);const r=e.fragment;r.constants.add("fresnelSky","vec3",[.02,1,15]).add("fresnelMaterial","vec2",[.02,.1]).add("roughness","float",.015).add("foamIntensityExternal","float",1.7).add("ssrIntensity","float",.65).add("ssrHeightFadeStart","float",3e5).add("ssrHeightFadeEnd","float",5e5).add("waterDiffusion","float",.92).add("waterSeaColorMod","float",.8).add("correctionViewingPowerFactor","float",.4).add("skyZenitColor","vec3",[.52,.68,.9]).add("skyColor","vec3",[.67,.79,.9]).add("cloudFresnelModifier","vec2",[1.2,.01]),r.code.add(S`PBRShadingWater shadingInfo;
vec3 getSkyGradientColor(in float cosTheta, in vec3 horizon, in vec3 zenit) {
float exponent = pow((1.0 - cosTheta), fresnelSky[2]);
return mix(zenit, horizon, exponent);
}`),r.uniforms.add([new He("lightingSpecularStrength",(i,n)=>n.lighting.mainLight.specularStrength),new He("lightingEnvironmentStrength",(i,n)=>n.lighting.mainLight.environmentStrength)]),r.code.add(S`vec3 getSeaColor(in vec3 n, in vec3 v, in vec3 l, vec3 color, in vec3 lightIntensity, in vec3 localUp, in float shadow, float foamIntensity, vec3 viewPosition, vec3 position) {
float reflectionHit = 0.0;
float reflectionHitDiffused = 0.0;
vec3 seaWaterColor = linearizeGamma(color);
vec3 h = normalize(l + v);
shadingInfo.NdotL = clamp(dot(n, l), 0.0, 1.0);
shadingInfo.NdotV = clamp(dot(n, v), 0.001, 1.0);
shadingInfo.VdotN = clamp(dot(v, n), 0.001, 1.0);
shadingInfo.NdotH = clamp(dot(n, h), 0.0, 1.0);
shadingInfo.VdotH = clamp(dot(v, h), 0.0, 1.0);
shadingInfo.LdotH = clamp(dot(l, h), 0.0, 1.0);
float upDotV = max(dot(localUp,v), 0.0);
vec3 skyHorizon = linearizeGamma(skyColor);
vec3 skyZenit = linearizeGamma(skyZenitColor);
vec3 skyColor = getSkyGradientColor(upDotV, skyHorizon, skyZenit );
float upDotL = max(dot(localUp,l),0.0);
float daytimeMod = 0.1 + upDotL * 0.9;
skyColor *= daytimeMod;
float shadowModifier = clamp(shadow, 0.8, 1.0);
vec3 fresnelModifier = fresnelReflection(shadingInfo.VdotN, vec3(fresnelSky[0]), fresnelSky[1]);
vec3 reflSky = lightingEnvironmentStrength * fresnelModifier * skyColor * shadowModifier;
vec3 reflSea = seaWaterColor * mix(skyColor, upDotL * lightIntensity * LIGHT_NORMALIZATION, 2.0 / 3.0) * shadowModifier;
vec3 specular = vec3(0.0);
if(upDotV > 0.0 && upDotL > 0.0) {
vec3 specularSun = brdfSpecularWater(shadingInfo, roughness, vec3(fresnelMaterial[0]), fresnelMaterial[1]);
vec3 incidentLight = lightIntensity * LIGHT_NORMALIZATION * shadow;
specular = lightingSpecularStrength * shadingInfo.NdotL * incidentLight * specularSun;
}
vec3 foam = vec3(0.0);
if(upDotV > 0.0) {
foam = foamIntensity2FoamColor(foamIntensityExternal, foamIntensity, skyZenitColor, daytimeMod);
}
float correctionViewingFactor = pow(max(dot(v, localUp), 0.0), correctionViewingPowerFactor);
vec3 normalCorrectedClouds = mix(localUp, n, correctionViewingFactor);
vec3 reflectedWorld = normalize(reflect(-v, normalCorrectedClouds));`),t.hasCloudsReflections&&r.code.add(S`vec4 cloudsColor = renderClouds(reflectedWorld, position);
cloudsColor.a = 1.0 - cloudsColor.a;
cloudsColor = pow(cloudsColor, vec4(GAMMA));
cloudsColor *= clamp(fresnelModifier.y*cloudFresnelModifier[0] - cloudFresnelModifier[1], 0.0, 1.0) * clamp((1.0 - totalFadeInOut), 0.0, 1.0);`),t.hasScreenSpaceReflections?r.code.add(S`vec3 viewDir = normalize(viewPosition);
vec4 viewNormalVectorCoordinate = view *vec4(n, 0.0);
vec3 viewNormal = normalize(viewNormalVectorCoordinate.xyz);
vec4 viewUp = view *vec4(localUp, 0.0);
vec3 viewNormalCorrectedSSR = mix(viewUp.xyz, viewNormal, correctionViewingFactor);
vec3 reflected = normalize(reflect(viewDir, viewNormalCorrectedSSR));
vec3 hitCoordinate = screenSpaceIntersection(reflected, viewPosition, viewDir, viewUp.xyz);
vec3 reflectedColor = vec3(0.0);
if (hitCoordinate.z > 0.0)
{
vec2 reprojectedCoordinate = reprojectionCoordinate(hitCoordinate);
vec2 dCoords = smoothstep(0.3, 0.6, abs(vec2(0.5, 0.5) - hitCoordinate.xy));
float heightMod = smoothstep(ssrHeightFadeEnd, ssrHeightFadeStart, -viewPosition.z);
reflectionHit = clamp(1.0 - (1.3*dCoords.y), 0.0, 1.0) * heightMod;
reflectionHitDiffused = waterDiffusion * reflectionHit;
reflectedColor = linearizeGamma(texture2D(lastFrameColorMap, reprojectedCoordinate).xyz)* reflectionHitDiffused * fresnelModifier.y * ssrIntensity;
}
float seaColorMod =  mix(waterSeaColorMod, waterSeaColorMod*0.5, reflectionHitDiffused);
vec3 waterRenderedColor = tonemapACES((1.0 - reflectionHitDiffused) * reflSky + reflectedColor + reflSea * seaColorMod + specular  + foam);`):r.code.add(S`vec3 waterRenderedColor = tonemapACES(reflSky + reflSea * waterSeaColorMod + specular + foam);`),t.hasCloudsReflections?t.hasScreenSpaceReflections?r.code.add(S`return waterRenderedColor * (1.0 - (1.0 - reflectionHit) * cloudsColor.a) + (1.0 - reflectionHit) * cloudsColor.xyz;
}`):r.code.add(S`return waterRenderedColor * (1.0 - cloudsColor.a) + cloudsColor.xyz;
}`):r.code.add(S`return waterRenderedColor;
}`)}function Ime(e){e.fragment.uniforms.add(new Hi("texWaveNormal")),e.fragment.uniforms.add(new Hi("texWavePerturbation")),e.fragment.uniforms.add([new cr("waveParams",t=>ei(dbt,t.waveStrength,t.waveTextureRepeat,t.flowStrength,t.flowOffset)),new _r("waveDirection",t=>vr(ubt,t.waveDirection[0]*t.waveVelocity,t.waveDirection[1]*t.waveVelocity))]),e.include(obt),e.fragment.code.add(S`const vec2  FLOW_JUMP = vec2(6.0/25.0, 5.0/24.0);
vec2 textureDenormalized2D(sampler2D _tex, vec2 _uv) {
return 2.0 * texture2D(_tex, _uv).rg - 1.0;
}
float sampleNoiseTexture(vec2 _uv) {
return texture2D(texWavePerturbation, _uv).b;
}
vec3 textureDenormalized3D(sampler2D _tex, vec2 _uv) {
return 2.0 * texture2D(_tex, _uv).rgb - 1.0;
}
float computeProgress(vec2 uv, float time) {
return fract(time);
}
float computeWeight(vec2 uv, float time) {
float progress = computeProgress(uv, time);
return 1.0 - abs(1.0 - 2.0 * progress);
}
vec3 computeUVPerturbedWeigth(sampler2D texFlow, vec2 uv, float time, float phaseOffset) {
float flowStrength = waveParams[2];
float flowOffset = waveParams[3];
vec2 flowVector = textureDenormalized2D(texFlow, uv) * flowStrength;
float progress = computeProgress(uv, time + phaseOffset);
float weight = computeWeight(uv, time + phaseOffset);
vec2 result = uv;
result -= flowVector * (progress + flowOffset);
result += phaseOffset;
result += (time - progress) * FLOW_JUMP;
return vec3(result, weight);
}
const float TIME_NOISE_TEXTURE_REPEAT = 0.3737;
const float TIME_NOISE_STRENGTH = 7.77;
vec3 getWaveLayer(sampler2D _texNormal, sampler2D _dudv, vec2 _uv, vec2 _waveDir, float time) {
float waveStrength = waveParams[0];
vec2 waveMovement = time * -_waveDir;
float timeNoise = sampleNoiseTexture(_uv * TIME_NOISE_TEXTURE_REPEAT) * TIME_NOISE_STRENGTH;
vec3 uv_A = computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.0);
vec3 uv_B = computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.5);
vec3 normal_A = textureDenormalized3D(_texNormal, uv_A.xy) * uv_A.z;
vec3 normal_B = textureDenormalized3D(_texNormal, uv_B.xy) * uv_B.z;
vec3 mixNormal = normalize(normal_A + normal_B);
mixNormal.xy *= waveStrength;
mixNormal.z = sqrt(1.0 - dot(mixNormal.xy, mixNormal.xy));
return mixNormal;
}
vec4 getSurfaceNormalAndFoam(vec2 _uv, float _time) {
float waveTextureRepeat = waveParams[1];
vec3 normal = getWaveLayer(texWaveNormal, texWavePerturbation, _uv * waveTextureRepeat, waveDirection, _time);
float foam  = normals2FoamIntensity(normal, waveParams[0]);
return vec4(normal, foam);
}`)}const dbt=Jt(),ubt=it();function hbt(e){const t=new Qr,{vertex:r,fragment:i}=t,n=_u(t,e);return t.include(no),t.attributes.add(O.POSITION,"vec3"),t.attributes.add(O.UV0,"vec2"),r.uniforms.add(new cr("waterColor",s=>s.color)),e.output!==K.Color&&e.output!==K.Alpha||(t.include(gv,e),t.include(LO,e),t.varyings.add("vuv","vec2"),t.varyings.add("vpos","vec3"),t.varyings.add("vnormal","vec3"),t.varyings.add("vtbnMatrix","mat3"),i.uniforms.add(n),e.hasMultipassTerrain&&t.varyings.add("depth","float"),r.code.add(S`
      void main(void) {
        if (waterColor.a < ${S.float(ao)}) {
          // Discard this vertex
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          return;
        }

        vuv = uv0;
        vpos = position;

        vnormal = getLocalUp(vpos, localOrigin);
        vtbnMatrix = getTBNMatrix(vnormal);

        ${e.hasMultipassTerrain?"depth = (view * vec4(vpos, 1.0)).z;":""}

        gl_Position = transformPosition(proj, view, vpos);
        ${e.output===K.Color?"forwardLinearDepth();":""}
      }
    `)),t.include(Mu,e),e.output===K.Alpha&&(t.include(Cn,e),i.uniforms.add(new pl("waterColor")),i.code.add(S`
        void main() {
          discardBySlice(vpos);
          ${e.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}

          gl_FragColor = vec4(waterColor.a);
        }
      `)),e.output===K.Color&&(t.include(dse,{isGround:!1}),t.include(cse,{pbrMode:It.Disabled,lightingSphericalHarmonicsOrder:2}),t.include(Ime),t.include(Cn,e),t.include(ax,e),t.include(_Re,e),i.uniforms.add([new pl("waterColor"),new St("lightingMainDirection",(s,a)=>a.lighting.lightingMainDirection),new St("lightingMainIntensity",(s,a)=>a.lighting.mainLight.intensity),new He("timeElapsed",s=>s.timeElapsed),new Jv("view")]),_m(i,e),i.include($m),i.code.add(S`
      void main() {
        discardBySlice(vpos);
        ${e.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}
        vec3 localUp = vnormal;
        // the created normal is in tangent space
        vec4 tangentNormalFoam = getSurfaceNormalAndFoam(vuv, timeElapsed);

        // we rotate the normal according to the tangent-bitangent-normal-Matrix
        vec3 n = normalize(vtbnMatrix * tangentNormalFoam.xyz);
        vec3 v = -normalize(vpos - cameraPosition);
        float shadow = ${e.receiveShadows?S`1.0 - readShadowMap(vpos, linearDepth)`:"1.0"};
        vec4 vPosView = view*vec4(vpos, 1.0);
        vec4 final = vec4(getSeaColor(n, v, lightingMainDirection, waterColor.rgb, lightingMainIntensity, localUp, shadow, tangentNormalFoam.w, vPosView.xyz, vpos + localOrigin), waterColor.w);

        // gamma correction
        gl_FragColor = delinearizeGamma(final);
        gl_FragColor = highlightSlice(gl_FragColor, vpos);
        ${e.transparencyPassType===yt.Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}
      }
    `)),e.output===K.Normal&&(t.include(gv,e),t.include(Ime,e),t.include(Cn,e),t.varyings.add("vpos","vec3"),t.varyings.add("vuv","vec2"),r.code.add(S`
        void main(void) {
          if (waterColor.a < ${S.float(ao)}) {
            // Discard this vertex
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
            return;
          }

          vuv = uv0;
          vpos = position;

          gl_Position = transformPosition(proj, view, vpos);
        }
    `),i.uniforms.add(new He("timeElapsed",s=>s.timeElapsed)),i.code.add(S`void main() {
discardBySlice(vpos);
vec4 tangentNormalFoam = getSurfaceNormalAndFoam(vuv, timeElapsed);
tangentNormalFoam.xyz = normalize(tangentNormalFoam.xyz);
gl_FragColor = vec4((tangentNormalFoam.xyz + vec3(1.0)) * 0.5, tangentNormalFoam.w);
}`)),e.output===K.Draped&&(t.varyings.add("vpos","vec3"),r.code.add(S`
        void main(void) {
          if (waterColor.a < ${S.float(ao)}) {
            // Discard this vertex
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
            return;
          }

          vpos = position;
          gl_Position = transformPosition(proj, view, vpos);
        }
    `),i.uniforms.add(new pl("waterColor")),i.code.add(S`void main() {
gl_FragColor = waterColor;
}`)),e.output===K.Highlight&&(t.include(Ky),t.varyings.add("vpos","vec3"),r.code.add(S`
      void main(void) {
        if (waterColor.a < ${S.float(ao)}) {
          // Discard this vertex
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          return;
        }

        vpos = position;
        gl_Position = transformPosition(proj, view, vpos);
      }
    `),t.include(Cn,e),i.code.add(S`void main() {
discardBySlice(vpos);
outputHighlight();
}`)),t}const fbt=Object.freeze(Object.defineProperty({__proto__:null,build:hbt},Symbol.toStringTag,{value:"Module"}));class gU extends gi{constructor(t,r,i){super(t,r,i),this._textureRepository=t.waterTextureRepository}initializeConfiguration(t,r){r.spherical=t.viewingMode===Be.Global,r.doublePrecisionRequiresObfuscation=$O(t.rctx)}initializeProgram(t){const r=gU.shader.get().build(this.configuration);return new ai(t.rctx,r,Ur)}bindPass(t,r){this.program.bindPass(t,r),this.configuration.output!==K.Color&&this.configuration.output!==K.Normal||this._textureRepository.bind(this.program)}_setPipelineState(t){const r=this.configuration,i=t===yt.NONE,n=t===yt.FrontFace;return jt({blending:r.output!==K.Normal&&r.output!==K.Highlight&&r.transparent?i?wu:eb(t):null,depthTest:{func:w_(t)},depthWrite:i?r.writeDepth&&fc:Kz(t),colorWrite:or,polygonOffset:i||n?null:rU(r.enableOffset)})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}}gU.shader=new si(fbt,()=>ie(()=>import("./WaterSurface.glsl.49313a94.js"),[],import.meta.url));class va extends Mo{constructor(){super(...arguments),this.output=K.Color,this.transparencyPassType=yt.NONE,this.spherical=!1,this.receiveShadows=!1,this.hasSlicePlane=!1,this.transparent=!1,this.enableOffset=!0,this.writeDepth=!1,this.hasScreenSpaceReflections=!1,this.doublePrecisionRequiresObfuscation=!1,this.hasCloudsReflections=!1,this.isDraped=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1}}d([H({count:K.COUNT})],va.prototype,"output",void 0),d([H({count:yt.COUNT})],va.prototype,"transparencyPassType",void 0),d([H()],va.prototype,"spherical",void 0),d([H()],va.prototype,"receiveShadows",void 0),d([H()],va.prototype,"hasSlicePlane",void 0),d([H()],va.prototype,"transparent",void 0),d([H()],va.prototype,"enableOffset",void 0),d([H()],va.prototype,"writeDepth",void 0),d([H()],va.prototype,"hasScreenSpaceReflections",void 0),d([H()],va.prototype,"doublePrecisionRequiresObfuscation",void 0),d([H()],va.prototype,"hasCloudsReflections",void 0),d([H()],va.prototype,"isDraped",void 0),d([H()],va.prototype,"hasMultipassTerrain",void 0),d([H()],va.prototype,"cullAboveGround",void 0),d([H({constValue:It.Water})],va.prototype,"pbrMode",void 0),d([H({constValue:!0})],va.prototype,"useCustomDTRExponentForWater",void 0),d([H({constValue:!0})],va.prototype,"highStepCount",void 0),d([H({constValue:!1})],va.prototype,"useFillLights",void 0);class $me extends v_{_updateShadowState(t){t.shadowMap.enabled!==this._material.parameters.receiveShadows&&this._material.setParameters({receiveShadows:t.shadowMap.enabled})}_updateSSRState(t){t.ssr.enabled!==this._material.parameters.hasScreenSpaceReflections&&this._material.setParameters({hasScreenSpaceReflections:t.ssr.enabled})}_updateCloudsReflectionState(t){const r=_(t.clouds.data);r!==this._material.parameters.hasCloudsReflections&&this._material.setParameters({hasCloudsReflections:r})}ensureResources(t){const r=this._techniqueRepository.constructionContext.waterTextureRepository;return r.resourceState===qc.NOT_LOADED&&r.loadTextures(t),r.resourceState}beginSlot(t){return this._output===K.Color&&(this._updateShadowState(t),this._updateSSRState(t),this._updateCloudsReflectionState(t)),this.ensureTechnique(gU,t)}}const pbt=gn().vec3f(O.POSITION),mbt=gn().vec3f(O.POSITION).vec2f(O.UV0),wRe=gn().vec3f(O.POSITION).vec4u8(O.COLOR);class yU{constructor(t){this.vertexBufferLayout=t}allocate(t){return this.vertexBufferLayout.createBuffer(t)}elementCount(t){return t.indices.get(O.POSITION).length}write(t,r,i,n){Qz(r,this.vertexBufferLayout,t.transformation,t.invTranspTransformation,i,n)}}class xRe extends Dm{constructor(t){super(t,new TRe),this._techniqueConfig=new va,this.animation=new TCe}getConfiguration(t,r){return this._techniqueConfig.output=t,this._techniqueConfig.writeDepth=this.parameters.writeDepth,this._techniqueConfig.receiveShadows=this.parameters.receiveShadows,this._techniqueConfig.hasSlicePlane=this.parameters.hasSlicePlane,this._techniqueConfig.transparent=this.parameters.transparent,this._techniqueConfig.hasScreenSpaceReflections=this.parameters.hasScreenSpaceReflections,this._techniqueConfig.hasCloudsReflections=this.parameters.hasCloudsReflections,this._techniqueConfig.isDraped=this.parameters.isDraped,this._techniqueConfig.transparencyPassType=r.transparencyPassType,this._techniqueConfig.enableOffset=r.camera.relativeElevation<eU,this._techniqueConfig.hasMultipassTerrain=r.multipassTerrain.enabled,this._techniqueConfig.cullAboveGround=r.multipassTerrain.cullAboveGround,this._techniqueConfig}update(t){const r=Math.min(t.camera.relativeElevation,t.camera.distance);this.animation.enabled=Math.sqrt(this.parameters.waveTextureRepeat/this.parameters.waveStrength)*r<gbt;const i=this.animation.advance(t);return this.setParameters({timeElapsed:Rte(this.animation.time)*this.parameters.animationSpeed},!1),this.animation.enabled&&i}intersect(t,r,i,n,s,a,o){Yz(t,r,n,s,a,void 0,o)}requiresSlot(t,r){switch(sx(r)){case K.Normal:return t===Ee.DRAPED_WATER;case K.Color:if(this.parameters.isDraped)return t===Ee.DRAPED_MATERIAL;break;case K.Highlight:return t===Ee.OPAQUE_MATERIAL||t===Ee.DRAPED_MATERIAL}let i=Ee.OPAQUE_MATERIAL;return this.parameters.transparent&&(i=this.parameters.writeDepth?Ee.TRANSPARENT_MATERIAL:Ee.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL),t===i}createGLMaterial(t){if(t.output===K.Color&&this.parameters.isDraped)return t.output=K.Draped,new $me(t);switch(t.output){case K.Color:case K.Normal:case K.Highlight:case K.Alpha:return new $me(t)}return null}createBufferWriter(){return new yU(mbt)}}class TRe extends S6{constructor(){super(...arguments),this.waveStrength=.06,this.waveTextureRepeat=32,this.waveDirection=Nr(1,0),this.waveVelocity=.05,this.flowStrength=.015,this.flowOffset=-.5,this.animationSpeed=.35,this.timeElapsed=0,this.color=Tr(0,0,0,0),this.transparent=!0,this.writeDepth=!0,this.hasSlicePlane=!1,this.isDraped=!1,this.receiveShadows=!0,this.hasScreenSpaceReflections=!1,this.hasCloudsReflections=!1}}const gbt=35e3;class Lme{constructor(t){this.first=t.from,this.count=t.to-t.from}}class PS{constructor(t=0,r=0){this.from=t,this.to=r}}class ybt extends PS{constructor(t,r,i,n,s,a){super(r,i),this.id=t,this.isVisible=n,this.hasHighlights=s,this.hasOccludees=a}}function Dme(e){return Array.from(e.values()).sort(bbt)}function bbt(e,t){return e.from===t.from?e.to-t.to:e.from-t.from}function oI(e,t){if(e.length===0)return void e.push(new Lme(t));const r=e[e.length-1];if(vbt(r,t)){const i=t.from-r.first+t.to-t.from;r.count=i}else e.push(new Lme(t))}function vbt(e,t){return e.first+e.count>=t.from}class _bt{constructor(t,r){this._pool=t,this._size=0,this._buffer=t.newBuffer(lK(r))}dispose(){this._buffer=this._pool.deleteBuffer(this._buffer),this._size=0}release(){this.erase(0,this._size),this.dispose()}get vao(){return this._buffer.vao}get array(){return this._buffer.array}get size(){return this._size}grow(t){this._resize(this._size+t,!0).dispose()}alloc(t){return this._resize(t,!1)}_resize(t,r){let i;const n=wbt(this._buffer.length,this._size,t);if(this._buffer.length!==n){const a=this._pool.newBuffer(n);r&&(a.array.set(this._buffer.array.subarray(0,Math.min(this._size,n))),a.vao.vertexBuffers.geometry.setSubData(a.array,0,0,a.array.byteLength)),i=this._buffer,this._buffer=a}const s=this._size;return this._size=t,i?{dispose:()=>{i.array.fill(0,0,s),this._pool.deleteBuffer(i)},copy:(a,o,l)=>this._buffer.array.set(i.array.subarray(o,l),a),hasNewBuffer:!0}:{dispose:()=>{},copy:(a,o,l)=>{a!==o&&this._buffer.array.copyWithin(a,o,l)},hasNewBuffer:!1}}erase(t,r){this._buffer.array.fill(0,t,r)}}const Fme=65536;function lK(e){return Math.ceil(e/Fme)*Fme}function wbt(e,t,r){return t<=r?e>=r?e:lK(Math.max(2*e,r)):e<=2*r?e:lK(r)}class xbt{constructor(t,r,i,n){this.vao=new ns(t,r,{geometry:i},{geometry:dr.createVertex(t,Cr.STATIC_DRAW)}),this.array=new Float32Array(n),this.vao.vertexBuffers.geometry.setSize(this.array.byteLength)}dispose(){this.vao.dispose(!0)}get length(){return this.array.length}}const Tbt=wL+1;class Sbt{constructor(t,r,i){this._rctx=t,this._locations=r,this._layout=i,this._cache=t.newCache(`MergedRenderer pool ${ic()}`,Ebt)}dispose(){this._cache.destroy()}newBuffer(t){const r=t.toString(),i=this._cache.pop(r);if(_(i)){const n=i.pop();return i.length>0&&this._cache.put(r,i,n.array.byteLength*i.length,Tbt),n}return new xbt(this._rctx,this._locations,this._layout,t)}deleteBuffer(t){const r=t.array.byteLength,i=t.array.length.toString(),n=this._cache.pop(i);return _(n)?(n.push(t),this._cache.put(i,n,r*n.length,-1)):this._cache.put(i,[t],r,-1),null}}function Ebt(e,t){if(t===Bg.ALL)return void e.forEach(n=>n.dispose());const r=e.pop(),i=e.length*r.array.byteLength;return r.dispose(),i}class SRe{constructor(t,r,i){this._rctx=t,this._materialRepository=r,this._material=i,this.type="MergedRenderer",this._dataByOrigin=new Map,this._renderCommandData=new Qt,this._hasHighlights=!1,this._hasOccludees=!1,this._glMaterials=new rRe(this._material,this._materialRepository),this._bufferWriter=i.createBufferWriter(),this._bufferPool=new Sbt(t,i.vertexAttributeLocations,vd(this._bufferWriter.vertexBufferLayout))}dispose(){this._glMaterials.destroy(),this._dataByOrigin.forEach(t=>t.buffer.dispose()),this._dataByOrigin.clear(),this._bufferPool.dispose()}get isEmpty(){return this._dataByOrigin.size===0}get hasHighlights(){return this._hasHighlights}get hasOccludees(){return this._hasOccludees}get hasWater(){return!this.isEmpty&&this._material instanceof xRe}get rendersOccluded(){return!this.isEmpty&&this._material.renderOccluded!==ki.Occlude}modify(t){this._updateGeometries(t.updates),this._addAndRemoveGeometries(t.adds,t.removes),this._updateRenderCommands()}_addAndRemoveGeometries(t,r){const i=this._bufferWriter,n=i.vertexBufferLayout.stride/4,s=this._dataByOrigin,a=Abt(t,r);a.forEach((o,l)=>{a.delete(l);const c=o.toAdd.reduce((v,x)=>v+i.elementCount(x.data),0);let u=s.get(l);if(u==null)pt(o.toRemove.length===0),u=new Obt(o.origin,new _bt(this._bufferPool,c*n)),s.set(l,u);else if(o.toAdd.length===0&&u.instances.size===o.toRemove.length)return u.buffer.dispose(),void s.delete(l);let h=0;u.instances.forEach(v=>h+=v.to-v.from);const p=o.toRemove.reduce((v,x)=>v+i.elementCount(x.data),0),m=u.buffer.size,g=(h+c-p)*n,b=Pbt;if(g<m/2?this._removeAndRebuild(u,o.toRemove,n,g,b):o.toRemove.length>0&&this._remove(u,o.toRemove,n,b),o.toAdd.length>0){const v=Ibt;bCe(v,-o.origin[0],-o.origin[1],-o.origin[2]),this._add(u,o.toAdd,n,v,b)}const w=u.buffer.vao.vertexBuffers.geometry;Vme(b),b.forAll(({from:v,to:x})=>{if(v<x){const T=u.buffer.array,E=4,C=v*E,A=x*E;w.setSubData(T,C,C,A)}}),b.clear(),u.drawCommandsDirty=!0})}_updateGeometries(t){const r=this._bufferWriter,i=r.vertexBufferLayout.stride/4;for(const n of t){const s=n.renderGeometry,a=this._dataByOrigin.get(s.origin.id),o=a&&a.instances.get(s.id);if(!o)return;const l=n.updateType;if(l&sr.State.VISIBILITIES&&(o.isVisible=s.instanceParameters.visible),l&(sr.State.HIGHLIGHTS|sr.State.VISIBILITIES)){const c=s.instanceParameters.visible;o.hasHighlights=!!s.instanceParameters.highlights&&c}if(l&sr.State.OCCLUDEES&&(o.hasOccludees=!!s.instanceParameters.occludees),l&(sr.State.VERTEXATTRS|sr.State.TRANSFORMATION)){const{array:c,vao:u}=a.buffer;Jut(s,Sq,w8),r.write({transformation:Sq,invTranspTransformation:w8},s.data,r.vertexBufferLayout.createView(c.buffer),o.from),pt(o.from+r.elementCount(s.data)===o.to,"material VBO layout has changed"),u.vertexBuffers.geometry.setSubData(c,o.from*i*4,o.from*i*4,o.to*i*4)}a.drawCommandsDirty=!0}}_updateRenderCommands(){this._hasHighlights=!1,this._hasOccludees=!1,this._dataByOrigin.forEach(r=>{r.hasHiddenInstances=!1,r.hasHighlights=!1,r.hasOccludees=!1,vs(r.instances,i=>(i.isVisible?(i.hasHighlights&&(this._hasHighlights=!0,r.hasHighlights=!0),i.hasOccludees&&(this._hasOccludees=!0,r.hasOccludees=!0)):r.hasHiddenInstances=!0,r.hasHiddenInstances&&r.hasHighlights&&r.hasOccludees))});const t=r=>{if(r.drawCommandsDefault=null,r.drawCommandsHighlight=null,r.drawCommandsOccludees=null,r.drawCommandsShadowHighlightRest=null,r.instances.size===0)return;if(!kme(r)){const n=this._bufferWriter.vertexBufferLayout.stride,s=4*r.buffer.size/n;return void(r.drawCommandsDefault=[{first:0,count:s}])}const i=Dme(r.instances);r.drawCommandsDefault=[],r.drawCommandsHighlight=[],r.drawCommandsOccludees=[],r.drawCommandsShadowHighlightRest=[];for(const n of i)n.isVisible&&(n.hasOccludees?oI(r.drawCommandsOccludees,n):oI(r.drawCommandsDefault,n),n.hasHighlights?oI(r.drawCommandsHighlight,n):oI(r.drawCommandsShadowHighlightRest,n))};this._dataByOrigin.forEach(r=>{r.drawCommandsDirty&&(t(r),r.drawCommandsDirty=!1)})}updateAnimation(t){return this._material.update(t)}requiresSlot(t,r){return t==null||this._material.requiresSlot(t,r)}render(t,r){if(!this.requiresSlot(r.slot,t))return!1;const i=t===je.MATERIAL_HIGHLIGHT||t===je.MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT;if(i&&!this._hasHighlights)return!1;const n=t===je.MATERIAL_DEPTH_SHADOWMAP_DEFAULT,s=!(i||n);if(this._dataByOrigin.forEach(c=>{if(i&&!c.hasHighlights)return;const u=(i?c.drawCommandsHighlight:n&&kme(c)?c.drawCommandsShadowHighlightRest:c.drawCommandsDefault)||null,h=s&&c.drawCommandsOccludees||null;(_(u)||_(h))&&this._renderCommandData.push(new Mbt(c.origin,c.buffer,u,h))}),this._renderCommandData.length===0)return!1;const a=this._rctx,o=this._glMaterials.load(a,t);if(R(o))return this._renderCommandData.clear(),!1;const l=o.beginSlot(r);return a.bindTechnique(l,this._material.parameters,r,!1),this._renderCommandData.forAll(c=>{l.bindDraw(c,r);const{buffer:u,renderCommands:h,occludeeCommands:p}=c;l.ensureAttributeLocations(u.vao),a.bindVAO(u.vao);const m=l.primitiveType;_(h)&&this._renderCommands(a,m,h),_(p)&&(l.bindPipelineState(a,r.slot,!0),this._renderCommands(a,m,p),l.bindPipelineState(a,r.slot,!1))}),this._renderCommandData.clear(),!0}_renderCommands(t,r,i){for(let n=0;n<i.length;n++)t.drawArrays(r,i[n].first,i[n].count)}_removeAndRebuild(t,r,i,n,s){for(const u of r)t.instances.delete(u.id);const a=Dme(t.instances);t.instances.clear();const o=t.buffer.size,l=t.buffer.alloc(n);let c=0;for(const u of a){const h=u.from*i,p=u.to*i;l.copy(c,h,p),u.from=c/i,c+=p-h,u.to=c/i,t.instances.set(u.id,u)}s.push(new PS(0,l.hasNewBuffer?t.buffer.array.length:o)),l.dispose(),t.buffer.erase(c,s.back().to),t.holes.clear()}_remove(t,r,i,n){for(const s of r){const a=s.id,o=t.instances.get(a),l=o.from*i,c=o.to*i;t.buffer.erase(l,c),t.holes.push(new PS(o.from,o.to)),t.instances.delete(a),n.push(new PS(l,c))}Vme(t.holes)}_add(t,r,i,n,s){if(r.length===0)return;const a=this._bufferWriter;let o=a.vertexBufferLayout.createView(t.buffer.array.buffer);const l=t.holes.length>0;let c=Number.MAX_SAFE_INTEGER,u=Number.MIN_SAFE_INTEGER;for(const h of r){const p=_(h.transformation)?Zi(Sq,n,h.transformation):n;Rn(w8,p);const m=hc(w8,w8),g=a.elementCount(h.data),b=g*i;let w=Rbt(t.holes,g);R(w)&&(w=t.buffer.size/i,t.buffer.grow(b),o=a.vertexBufferLayout.createView(t.buffer.array.buffer)),a.write({transformation:p,invTranspTransformation:m},h.data,o,w);const v=h.instanceParameters.visible,x=!!h.instanceParameters.highlights&&v,T=!!h.instanceParameters.occludees,E=new ybt(h.id,w,w+g,v,x,T);pt(t.instances.get(h.id)==null),t.instances.set(h.id,E),l?s.push(new PS(E.from*i,E.to*i)):(c=Math.min(E.from,c),u=Math.max(E.to,u))}l||s.push(new PS(c*i,u*i))}get test(){return{material:this._material,glMaterials:this._glMaterials,dataByOrigin:this._dataByOrigin}}}class Cbt{constructor(t){this.origin=t,this.toAdd=new Array,this.toRemove=new Array}}function Abt(e,t){const r=new Map;for(const i of e)Nme(r,i,!0);for(const i of t)Nme(r,i,!1);return r}function Nme(e,t,r){const i=t.origin;if(R(i))return;let n=e.get(i.id);n==null&&(n=new Cbt(i.vec3),e.set(i.id,n)),r?n.toAdd.push(t):n.toRemove.push(t)}function kme(e){return e.hasOccludees||e.hasHighlights||e.hasHiddenInstances}function Rbt(e,t){let r;if(!e.some(n=>!(n.to-n.from<t)&&(r=n,!0)))return null;const i=r.from;return r.from+=t,r.from>=r.to&&e.removeUnordered(r),i}function Vme(e){const t=new Map;e.forAll(i=>t.set(i.from,i));let r=!0;for(;r;)r=!1,e.forEach(i=>{const n=t.get(i.to);n&&(i.to=n.to,t.delete(n.from),e.removeUnordered(n),r=!0)})}class Obt{constructor(t,r){this.origin=t,this.buffer=r,this.instances=new Map,this.holes=new Qt({deallocator:null}),this.hasHiddenInstances=!1,this.hasHighlights=!1,this.hasOccludees=!1,this.drawCommandsDirty=!1}}class Mbt extends oK{constructor(t,r,i,n){super(t),this.buffer=r,this.renderCommands=i,this.occludeeCommands=n}}const Pbt=new Qt({deallocator:null}),Ibt=Ae(),Sq=Ae(),w8=Ae();let L0=class extends xe{constructor(e){super(e),this._pending=new $bt,this._changes=new uRe,this._materialRenderers=new Map,this._sortedMaterialRenderers=new Qt,this._geometries=new Map,this._hasHighlights=!1,this._hasWater=!1}destroy(){this._changes.prune(),this._materialRenderers.forEach(e=>e.dispose()),this._materialRenderers.clear(),this._sortedMaterialRenderers.clear(),this._geometries.clear()}get updating(){return!this._pending.empty||this._changes.updates.length>0}get rctx(){return this.rendererContext.rctx}get _materialRepository(){return this.rendererContext.materialRepository}get _localOriginFactory(){return this.rendererContext.localOriginFactory}get hasHighlights(){return this._hasHighlights}get hasWater(){return this._hasWater}get rendersOccluded(){return vs(this._materialRenderers,e=>e.rendersOccluded)}get isEmpty(){return!this.updating&&this._materialRenderers.size===0&&this._geometries.size===0}commitChanges(){if(!this.updating)return!1;this._processAddsRemoves();const e=hRe(this._changes);let t=!1,r=!1,i=!1;return e.forEach((n,s)=>{let a=this._materialRenderers.get(s);if(!a&&n.adds.length>0&&(a=new SRe(this.rctx,this._materialRepository,s),this._materialRenderers.set(s,a),t=!0,r=!0,i=!0),!a)return;const o=r||a.hasHighlights,l=i||a.hasWater;a.modify(n),r=r||o!==a.hasHighlights,i=i||l!==a.hasWater,a.isEmpty&&(this._materialRenderers.delete(s),a.dispose(),t=!0)}),this._changes.clear(),t&&this._updateSortedMaterialRenderers(),r&&(this._hasHighlights=vs(this._materialRenderers,n=>n.hasHighlights)),i&&(this._hasWater=vs(this._materialRenderers,n=>n.hasWater)),this.notifyChange("updating"),!0}addGeometries(e,t){if(e.length===0)return;const r=this._validateRenderGeometries(e);for(const n of r)this._geometries.set(n.id,n);const i=this._pending.empty;for(const n of r)this._pending.adds.add(n);i&&this.notifyChange("updating"),t===sr.Geometry.UPDATE&&this._notifyGraphicGeometryChanged(e)}removeGeometries(e,t){const r=this._pending.empty,i=this._pending.adds;for(const n of e)i.has(n)?(this._pending.removed.add(n),i.delete(n)):this._pending.removed.has(n)||this._pending.removes.add(n),this._geometries.delete(n.id);r&&!this._pending.empty&&this.notifyChange("updating"),t===sr.Geometry.UPDATE&&this._notifyGraphicGeometryChanged(e)}modifyGeometries(e,t){const r=this._changes.updates.length===0;for(const i of e){const n=this._changes.updates.pushNew();n.renderGeometry=this._validateRenderGeometry(i),n.updateType=t}switch(r&&this._changes.updates.length>0&&this.notifyChange("updating"),t){case sr.State.TRANSFORMATION:case sr.State.VERTEXATTRS:return this._notifyGraphicGeometryChanged(e);case sr.State.VISIBILITIES:return this._notifyGraphicVisibilityChanged(e)}}updateAnimation(e){let t=!1;return this._sortedMaterialRenderers.forAll(({materialRenderer:r})=>t=r.updateAnimation(e)||t),t}render(e,t){for(let r=0;r<this._sortedMaterialRenderers.length;r++){const i=this._sortedMaterialRenderers.data[r];i.material.shouldRender(e)&&i.materialRenderer.render(e.pass,t)}}intersect(e,t,r,i,n){return this._geometries.forEach(s=>{if(i&&!i(s))return;this._intersectRenderGeometry(s,r,t,0,e,n);const a=this.rendererContext.longitudeCyclical;a&&(s.boundingSphere[0]-s.boundingSphere[3]<a.min&&this._intersectRenderGeometry(s,r,t,a.range,e,n),s.boundingSphere[0]+s.boundingSphere[3]>a.max&&this._intersectRenderGeometry(s,r,t,-a.range,e,n)),n++}),n}_updateSortedMaterialRenderers(){this._sortedMaterialRenderers.clear();let e=0;this._materialRenderers.forEach((t,r)=>{r.insertOrder=e++,this._sortedMaterialRenderers.push({material:r,materialRenderer:t})}),this._sortedMaterialRenderers.sort((t,r)=>{const i=r.material.renderPriority-t.material.renderPriority;return i!==0?i:t.material.insertOrder-r.material.insertOrder})}_processAddsRemoves(){this._changes.adds.clear(),this._changes.removes.clear(),this._changes.adds.pushArray(Array.from(this._pending.adds)),this._changes.removes.pushArray(Array.from(this._pending.removes));for(let e=0;e<this._changes.updates.length;){const t=this._changes.updates.data[e];this._pending.has(t.renderGeometry)?this._changes.updates.removeUnorderedIndex(e):e++}this._pending.clear()}_intersectRenderGeometry(e,t,r,i,n,s){if(!e.instanceParameters.visible)return;let a=0;_(e.transformation)&&(i+=e.transformation[12],a=e.transformation[13]),lI[0]=r[0]-i,lI[1]=r[1]-a,lI[2]=1,cI[0]=r[0]-i,cI[1]=r[1]-a,cI[2]=0,e.screenToWorldRatio=this.rendererContext.screenToWorldRatio,e.material.intersect(e,null,e.getShaderTransformation(),n,lI,cI,(o,l,c)=>{Lbt(t,c,e.material.renderPriority,s,n,e.layerUid,e.graphicUid)},e.calculateShaderTransformation,t)}_notifyGraphicGeometryChanged(e){if(R(this.drapeSource.notifyGraphicGeometryChanged))return;let t;for(const r of e){const i=r.graphicUid;_(i)&&i!==t&&(this.drapeSource.notifyGraphicGeometryChanged(i),t=i)}}_notifyGraphicVisibilityChanged(e){if(R(this.drapeSource.notifyGraphicVisibilityChanged))return;let t;for(const r of e){const i=r.graphicUid;_(i)&&i!==t&&(this.drapeSource.notifyGraphicVisibilityChanged(i),t=i)}}_validateRenderGeometries(e){for(const t of e)this._validateRenderGeometry(t);return e}_validateRenderGeometry(e){return R(e.origin)&&(e.origin=this._localOriginFactory.getOrigin(e.boundingSphere)),e}get test(){return{sortedMaterialRenderers:this._sortedMaterialRenderers}}};d([f()],L0.prototype,"drapeSource",void 0),d([f()],L0.prototype,"updating",null),d([f()],L0.prototype,"rctx",null),d([f()],L0.prototype,"rendererContext",void 0),d([f()],L0.prototype,"_materialRepository",null),d([f()],L0.prototype,"_localOriginFactory",null),L0=d([$("esri.views.3d.webgl-engine.lib.SortedRenderGeometryRenderer")],L0);class $bt{constructor(){this.adds=new Set,this.removes=new Set,this.removed=new Set}get empty(){return this.adds.size===0&&this.removes.size===0&&this.removed.size===0}has(t){return this.adds.has(t)||this.removes.has(t)||this.removed.has(t)}clear(){this.adds.clear(),this.removes.clear(),this.removed.clear()}}function Lbt(e,t,r,i,n,s,a){const o={layerUid:s,graphicUid:a,triangleNr:t},l=c=>{c.set(Wi.OVERLAY,o,e.dist,e.normal,e.transformation,r,i)};if((n.results.min.drapedLayerOrder==null||r>=n.results.min.drapedLayerOrder)&&(n.results.min.dist==null||n.results.ground.dist<=n.results.min.dist)&&l(n.results.min),n.options.store!==Da.MIN&&(n.results.max.drapedLayerOrder==null||r<n.results.max.drapedLayerOrder)&&(n.results.max.dist==null||n.results.ground.dist>n.results.max.dist)&&l(n.results.max),n.options.store===Da.ALL){const c=Ase(n.ray);l(c),n.results.all.push(c)}}const lI=M(),cI=M();function bU(e){e.fragment.uniforms.add(new cr("projInfo",(t,r)=>Dbt(r))),e.fragment.uniforms.add(new _r("zScale",(t,r)=>ERe(r))),e.fragment.code.add(S`vec3 reconstructPosition(vec2 fragCoord, float depth) {
return vec3((fragCoord * projInfo.xy + projInfo.zw) * (zScale.x * depth + zScale.y), depth);
}`)}function Dbt(e){const t=e.camera.projectionMatrix;return t[11]===0?ei(zme,2/(e.camera.fullWidth*t[0]),2/(e.camera.fullHeight*t[5]),(1+t[12])/t[0],(1+t[13])/t[5]):ei(zme,-2/(e.camera.fullWidth*t[0]),-2/(e.camera.fullHeight*t[5]),(1-t[8])/t[0],(1-t[9])/t[5])}const zme=Jt();function ERe(e){return e.camera.projectionMatrix[11]===0?vr(Ume,0,1):vr(Ume,1,0)}const Ume=it();var u_;(function(e){e[e.SSAO=0]="SSAO",e[e.Blur=1]="Blur",e[e.COUNT=2]="COUNT"})(u_||(u_={}));class CRe extends xl{constructor(){super(...arguments),this.output=u_.SSAO}}d([H({count:u_.COUNT})],CRe.prototype,"output",void 0);const x8={samples:16,filterRadius:4};function Fbt(e){const t=new Qr,r=t.fragment;if(t.include(__),e.output===u_.Blur){const i=(x8.filterRadius+1)/2,n=1/(2*i*i);r.include(Ou),r.uniforms.add([new Hi("normalMap"),new Hi("depthMap"),new Hi("tex"),new fy("blurSize"),new kr("projScale"),new _r("nearFar",(s,a)=>a.camera.nearFar)]),r.code.add(S`
      void blurFunction(vec2 uv, float r, float center_d, float sharpness, inout float wTotal, inout float bTotal) {
        float c = texture2D(tex, uv).r;
        float d = linearDepthFromTexture(depthMap, uv, nearFar);

        float ddiff = d - center_d;

        float w = exp(-r * r * ${S.float(n)} - ddiff * ddiff * sharpness);
        wTotal += w;
        bTotal += w * c;
      }
    `),r.code.add(S`
      void main(void) {
        float b = 0.0;
        float w_total = 0.0;

        float center_d = linearDepthFromTexture(depthMap, uv, nearFar);

        float sharpness = -0.05 * projScale/center_d;
        for (int r = -${S.int(x8.filterRadius)}; r <= ${S.int(x8.filterRadius)}; ++r) {
          float rf = float(r);
          vec2 uvOffset = uv + rf * blurSize;
          blurFunction(uvOffset, rf, center_d, sharpness, w_total, b);
        }

        gl_FragColor = vec4(b / w_total);
      }
    `)}return e.output===u_.SSAO&&(r.include(Ou),t.include(bU),r.uniforms.add(new Hi("normalMap")),r.uniforms.add(new Hi("depthMap")),r.uniforms.add(new Hi("rnm")),r.uniforms.add(new kr("intensity")),r.uniforms.add(new kr("projScale")),r.uniforms.add(new kr("radius")),r.uniforms.add(new _r("nearFar",(i,n)=>n.camera.nearFar)),r.uniforms.add(new fy("screenSize")),r.uniforms.add(new fy("rnmScale")),r.code.add(S`vec3 sphere[16];
void fillSphere() {
sphere[0] = vec3(0.186937, 0.0, 0.0);
sphere[1] = vec3(0.700542, 0.0, 0.0);
sphere[2] = vec3(-0.864858, -0.481795, -0.111713);
sphere[3] = vec3(-0.624773, 0.102853, -0.730153);
sphere[4] = vec3(-0.387172, 0.260319, 0.007229);
sphere[5] = vec3(-0.222367, -0.642631, -0.707697);
sphere[6] = vec3(-0.01336, -0.014956, 0.169662);
sphere[7] = vec3(0.122575, 0.1544, -0.456944);
sphere[8] = vec3(-0.177141, 0.85997, -0.42346);
sphere[9] = vec3(-0.131631, 0.814545, 0.524355);
sphere[10] = vec3(-0.779469, 0.007991, 0.624833);
sphere[11] = vec3(0.308092, 0.209288,0.35969);
sphere[12] = vec3(0.359331, -0.184533, -0.377458);
sphere[13] = vec3(0.192633, -0.482999, -0.065284);
sphere[14] = vec3(0.233538, 0.293706, -0.055139);
sphere[15] = vec3(0.417709, -0.386701, 0.442449);
}
float fallOffFunction(float vv, float vn, float bias) {
float f = max(radius * radius - vv, 0.0);
return f * f * f * max(vn-bias, 0.0);
}`),r.code.add(S`float aoValueFromPositionsAndNormal(vec3 C, vec3 n_C, vec3 Q) {
vec3 v = Q - C;
float vv = dot(v, v);
float vn = dot(normalize(v), n_C);
return fallOffFunction(vv, vn, 0.1);
}`),t.fragment.uniforms.add(new _r("zScale",(i,n)=>ERe(n))),r.code.add(S`
      void main(void) {
        fillSphere();
        vec3 fres = normalize((texture2D(rnm, uv * rnmScale).xyz * 2.0) - vec3(1.0));
        float currentPixelDepth = linearDepthFromTexture(depthMap, uv, nearFar);

        if (-currentPixelDepth>nearFar.y || -currentPixelDepth<nearFar.x) {
          gl_FragColor = vec4(0.0);
          return;
        }

        vec3 currentPixelPos = reconstructPosition(gl_FragCoord.xy,currentPixelDepth);

        // get the normal of current fragment
        vec4 norm4 = texture2D(normalMap, uv);
        vec3 norm = vec3(-1.0) + 2.0 * norm4.xyz;
        bool isTerrain = norm4.w<0.5;

        float sum = .0;
        vec3 tapPixelPos;

        // note: the factor 2.0 should not be necessary, but makes ssao much nicer.
        // bug or deviation from CE somewhere else?
        float ps = projScale/(2.0 * currentPixelPos.z * zScale.x + zScale.y);

        for(int i = 0; i < ${S.int(x8.samples)}; ++i) {
          vec2 unitOffset = reflect(sphere[i], fres).xy;
          vec2 offset = vec2(-unitOffset * radius * ps);

          //don't use current or very nearby samples
          if ( abs(offset.x)<2.0 || abs(offset.y)<2.0) continue;

          vec2 tc = vec2(gl_FragCoord.xy + offset);
          if (tc.x < 0.0 || tc.y < 0.0 || tc.x > screenSize.x || tc.y > screenSize.y) continue;
          vec2 tcTap = tc / screenSize;
          float occluderFragmentDepth = linearDepthFromTexture(depthMap, tcTap, nearFar);

          if (isTerrain) {
            bool isTerrainTap = texture2D(normalMap, tcTap).w<0.5;
            if (isTerrainTap) {
              continue;
            }
          }

          tapPixelPos = reconstructPosition(tc, occluderFragmentDepth);

          sum+= aoValueFromPositionsAndNormal(currentPixelPos, norm, tapPixelPos);
        }

        // output the result
        float A = max(1.0-sum*intensity/float(${S.int(x8.samples)}),0.0);

        // Anti-tone map to reduce contrast and drag dark region farther: (x^0.2 + 1.2 * x^4)/2.2
        A = (pow(A, 0.2) + 1.2 * A*A*A*A) / 2.2;
        gl_FragColor = vec4(A);
      }
    `)),t}const Nbt=Object.freeze(Object.defineProperty({__proto__:null,build:Fbt},Symbol.toStringTag,{value:"Module"}));class hR extends gi{initializeProgram(t){const r=hR.shader.get().build(this.configuration);return new ai(t.rctx,r,Ur)}initializePipeline(){return jt({colorWrite:or})}}hR.shader=new si(Nbt,()=>ie(()=>import("./SSAO.glsl.00793048.js"),[],import.meta.url));class ARe{constructor(t,r,i){this._techniqueRep=t,this._rctx=r,this._requestRender=i,this._enabled=!1,this._ssaoTechniqueConfig=new CRe,this.quadVAO=null,this._blurSizePx=2,this._attenuation=.5}dispose(){this.quadVAO=Qe(this.quadVAO)}disposeOffscreenBuffers(){ys(this._ssaoFBO,t=>t.resize(0,0)),ys(this._blur0FBO,t=>t.resize(0,0)),ys(this._blur1FBO,t=>t.resize(0,0))}set enabled(t){t?this._enable():this._disable()}get enabled(){return this._enabled}get ready(){return this.enabled&&_(this._noiseTexture)&&_(this._ssaoFBO)&&_(this._blur0FBO)&&_(this._blur1FBO)}get colorTexture(){return _(this._blur1FBO)?this._blur1FBO.colorTexture:null}get width(){return _(this._ssaoFBO)?this._ssaoFBO.width:-1}get height(){return _(this._ssaoFBO)?this._ssaoFBO.height:-1}computeSSAO(t,r,i){if(!this.enabled||R(r)||R(i)||R(this._noiseTexture)||R(this._ssaoFBO)||R(this._blur0FBO)||R(this._blur1FBO))return;const n=this._rctx,s=t.camera,a=s.fullViewport,o=a[2],l=a[3],c=o/this._blurSizePx,u=l/this._blurSizePx;this._ssaoFBO.resize(o,l),this._blur0FBO.resize(c,u),this._blur1FBO.resize(c,u);const h=1,p=1,m=o*h,g=l*p;n.bindFramebuffer(this._ssaoFBO),n.setViewport(0,0,o,l);const b=n.bindTechnique(this._ssaoTechnique,Bme,t);b.setUniform2f("rnmScale",o/this._noiseTexture.descriptor.width,l/this._noiseTexture.descriptor.height);let w=1/s.computeRenderPixelSizeAtDist(1);b.setUniform1f("projScale",w*h),b.setUniform2f("screenSize",m,g);const v=fi(s.eye,s.center);let x=20*s.computeRenderPixelSizeAtDist(v);x=Math.max(.1,x),b.setUniform1f("radius",x),b.setUniform1f("intensity",4*this._attenuation/x**6),b.bindTexture("rnm",this._noiseTexture),b.bindTexture("normalMap",i),b.bindTexture("depthMap",r),R(this.quadVAO)&&(this.quadVAO=Tl(this._rctx)),n.bindVAO(this.quadVAO),n.drawArrays(Dt.TRIANGLE_STRIP,0,io(this.quadVAO,"geometry"));const T=n.bindTechnique(this._blurTechnique,Bme,t);T.bindTexture("tex",this._ssaoFBO.colorTexture),T.bindTexture("normalMap",i),T.bindTexture("depthMap",r),n.setViewport(0,0,m/this._blurSizePx,g/this._blurSizePx),n.bindFramebuffer(this._blur0FBO),T.setUniform2f("screenSize",m,g),T.setUniform2f("blurSize",0,this._blurSizePx*h/g),v>5e4&&(w=Math.max(0,w-(v-5e4))),T.setUniform1f("projScale",w),n.drawArrays(Dt.TRIANGLE_STRIP,0,io(this.quadVAO,"geometry")),T.setUniform2f("blurSize",this._blurSizePx*p/m,0),n.bindFramebuffer(this._blur1FBO),T.bindTexture("tex",this._blur0FBO.colorTexture),n.drawArrays(Dt.TRIANGLE_STRIP,0,io(this.quadVAO,"geometry")),n.setViewport(a[0],a[1],a[2],a[3])}_selectPrograms(){this._ssaoTechniqueConfig.output=u_.SSAO,this._ssaoTechnique=this._techniqueRep.releaseAndAcquire(hR,this._ssaoTechniqueConfig,this._ssaoTechnique),this._ssaoTechniqueConfig.output=u_.Blur,this._blurTechnique=this._techniqueRep.releaseAndAcquire(hR,this._ssaoTechniqueConfig,this._blurTechnique)}_enable(){this.enabled||(this._enabled=!0,this._loadResources(()=>{this._enabled&&this._initialize()}))}_loadResources(t){this._data?t():ie(()=>import("./SSAOHelperData.1dcefdba.js"),[],import.meta.url).then(r=>{this._data=r,t()})}_initialize(){const t={target:mt.TEXTURE_2D,pixelFormat:Ue.RGBA,dataType:At.UNSIGNED_BYTE,samplingMode:tt.LINEAR,wrapMode:xt.CLAMP_TO_EDGE,width:0,height:0},r={colorTarget:hn.TEXTURE,depthStencilTarget:Pr.NONE};Dp(this._data.noiseTexture).then(i=>{this._enabled&&(this._ssaoFBO=new Pi(this._rctx,r,t),this._blur0FBO=new Pi(this._rctx,r,t),this._blur1FBO=new Pi(this._rctx,r,t),this._noiseTexture=new at(this._rctx,{target:mt.TEXTURE_2D,pixelFormat:Ue.RGBA,dataType:At.UNSIGNED_BYTE,hasMipmap:!0,width:i.width,height:i.height},i),this._requestRender())}),this._selectPrograms()}_disable(){this._enabled=!1,this._noiseTexture=Qe(this._noiseTexture),this._blur1FBO=Qe(this._blur1FBO),this._blur0FBO=Qe(this._blur0FBO),this._ssaoFBO=Qe(this._ssaoFBO)}get gpuMemoryUsage(){return(_(this._blur0FBO)?this._blur0FBO.gpuMemoryUsage:0)+(_(this._blur1FBO)?this._blur1FBO.gpuMemoryUsage:0)+(_(this._ssaoFBO)?this._ssaoFBO.gpuMemoryUsage:0)}get test(){return{ssao:this._ssaoFBO,blur:this._blur1FBO}}}const Bme=new as;function kbt(){const e=new Qr;return e.include(__),e.fragment.uniforms.add([new Hi("tex"),new pl("uColor")]),e.fragment.code.add(S`void main() {
vec4 texColor = texture2D(tex, uv);
gl_FragColor = texColor * uColor;
}`),e}const Vbt=Object.freeze(Object.defineProperty({__proto__:null,build:kbt},Symbol.toStringTag,{value:"Module"}));class FO extends gi{initializeProgram(t){const r=FO.shader.get().build();return new ai(t.rctx,r,Ur)}initializePipeline(){return this.configuration.hasAlpha?jt({blending:ka(Re.SRC_ALPHA,Re.ONE,Re.ONE_MINUS_SRC_ALPHA,Re.ONE_MINUS_SRC_ALPHA),colorWrite:or}):jt({colorWrite:or})}}FO.shader=new si(Vbt,()=>ie(()=>import("./TextureOnly.glsl.81fedd10.js"),[],import.meta.url));class vae extends xl{constructor(){super(...arguments),this.hasAlpha=!1}}d([H()],vae.prototype,"hasAlpha",void 0);class RRe{constructor(t){this._rctx=t,this.cache=new Map}dispose(){this.cache.forEach(t=>t.texture=Qe(t.texture)),this.cache.clear()}_acquire(t){if(R(t))return null;const r=this._patternId(t),i=this.cache.get(r);if(i)return i.refCount++,i.bind;const n=t.pixelRatio,{encodedData:s,sdfNormalizer:a,pixels:o,paddedPixels:l}=zbt(t.pattern,n),c=o/n,u={refCount:1,texture:null,bind:h=>(R(u.texture)&&(u.texture=new at(this._rctx,{width:l,height:1,internalFormat:Ue.RGBA,pixelFormat:Ue.RGBA,dataType:At.UNSIGNED_BYTE,wrapMode:xt.CLAMP_TO_EDGE},s)),h.bindTexture("stipplePatternTexture",u.texture),{pixelSize:c,sdfNormalizer:a,pixels:o})};return this.cache.set(r,u),u.bind}release(t){if(R(t))return;const r=this._patternId(t),i=this.cache.get(r);i&&(i.refCount--,i.refCount===0&&(_(i.texture)&&i.texture.dispose(),this.cache.delete(r)))}swap(t,r){const i=this._acquire(r);return this.release(t),i}_patternId(t){return`${t.pattern.join(",")}-r${t.pixelRatio}`}}function zbt(e,t){const r=e.map(g=>Math.round(g*t)),i=1/t,n=Math.floor(r.reduce((g,b)=>g+b)),s=r.reduce((g,b)=>Math.max(g,b)),a=(Math.floor(.5*(s-1))+.5)*i,o=[];let l=1;for(const g of r){for(let b=0;b<g;b++){const w=l*(Math.min(b,g-1-b)+.5)*i/a*.5+.5;o.push(w)}l=-l}const c=Math.round(r[0]/2),u=[...o.slice(c),...o.slice(0,c)],h=n+2,p=new Uint8Array(4*h);let m=4;for(const g of u)oR(g,p,m),m+=4;return p.copyWithin(0,m-4,m),p.copyWithin(m,4,8),{encodedData:p,sdfNormalizer:a,paddedPixels:h,pixels:n}}var Jc,to;(function(e){e[e.Standard=0]="Standard",e[e.TransparentToHUDVisibility=1]="TransparentToHUDVisibility",e[e.Transparency=2]="Transparency",e[e.OverlayWithTransparency=3]="OverlayWithTransparency",e[e.COUNT=4]="COUNT"})(Jc||(Jc={})),function(e){e[e.None=0]="None",e[e.Alpha=1]="Alpha",e[e.PremultipliedAlpha=2]="PremultipliedAlpha",e[e.COUNT=3]="COUNT"}(to||(to={}));class uD extends xl{constructor(){super(...arguments),this.function=Jc.Standard,this.alphaMode=to.None,this.hasOpacityFactor=!1}}d([H({count:Jc.COUNT})],uD.prototype,"function",void 0),d([H({count:to.COUNT})],uD.prototype,"alphaMode",void 0),d([H()],uD.prototype,"hasOpacityFactor",void 0);let kf=class extends lU(xe){constructor(e){super(e),this._overlays=null,this._overlayRenderTarget=null,this._hasHighlights=!1,this._rendersOccluded=!1,this._hasWater=!1,this._handles=new Ft,this._frameTask=d9,this._drapeSourceRenderers=new Map,this._sortedDrapeSourceRenderersDirty=!1,this._sortedDrapeSourceRenderers=new Qt,this._rctx=null,this._materialRepository=null,this._screenToWorldRatio=1,this._localOriginFactory=null,this.worldToPCSRatio=1,this.events=new mn,this.longitudeCyclical=null}get _bindParameters(){return this._renderContext.bindParameters}get rctx(){return this._rctx}get materialRepository(){return this._materialRepository}get screenToWorldRatio(){return this._screenToWorldRatio}get localOriginFactory(){return this._localOriginFactory}initialize(){const e=this.view._stage.renderView;this._rctx=e.renderingContext;const t=e.waterTextureRepository;this._stippleTextureRepository=new RRe(e.renderingContext),this._shaderTechniqueRepository=new QAe({rctx:this._rctx,viewingMode:Be.Local,stippleTextureRepository:this._stippleTextureRepository,waterTextureRepository:t}),this._renderContext=new dRe(this._rctx,new bae(this._rctx,this.view.state.viewingMode),new ARe(this._shaderTechniqueRepository,this._rctx,()=>{})),this._handles.add([re(()=>t.updating,()=>this.events.emit("content-changed"),Yn),re(()=>this.spatialReference,r=>this._localOriginFactory=new yae(r),Yn),rn(()=>this.view.allLayerViews,"after-changes",()=>this._sortedDrapeSourceRenderersDirty=!0)]),this._materialRepository=new JAe(e.textureRepository,this._shaderTechniqueRepository,r=>{(r.renderOccluded&mk)>0!==this._rendersOccluded&&this._updateRendersOccluded(),this.events.emit("content-changed"),this.notifyChange("updating")},()=>this.events.emit("content-changed")),this._bindParameters.slot=Ee.DRAPED_MATERIAL,this._bindParameters.highlightDepthTexture=UEe(this._rctx),this._bindParameters.camera=Y3,this._bindParameters.transparencyPassType=yt.NONE,this._bindParameters.lighting.groundLightingFactor=1,this._bindParameters.lighting.globalFactor=0,this._bindParameters.lighting.set([new yse(Ve(1,1,1))]),this._frameTask=this.view.resourceController.scheduler.registerTask(bt.STAGE,this),this._handles.add(this._frameTask)}dispose(){this._handles.destroy(),this._drapeSourceRenderers.forEach(e=>e.destroy()),this._drapeSourceRenderers.clear(),this._debugTextureTechnique=ri(this._debugTextureTechnique),this._debugPatternTexture=Qe(this._debugPatternTexture),this._bindParameters.highlightDepthTexture=Qe(this._bindParameters.highlightDepthTexture),this._shaderTechniqueRepository=Qe(this._shaderTechniqueRepository),this._temporaryFBO=Qe(this._temporaryFBO),this._quadVAO=Qe(this._quadVAO),this.disposeOverlays()}get updating(){return this._sortedDrapeSourceRenderersDirty||this._frameTask.updating||vs(this._drapeSourceRenderers,e=>e.updating)}get hasOverlays(){return _(this._overlays)&&_(this._overlayRenderTarget)}get gpuMemoryUsage(){return _(this._overlayRenderTarget)?this._overlayRenderTarget.gpuMemoryUsage:0}createGeometryDrapeSourceRenderer(e){return this.createDrapeSourceRenderer(e,L0)}createDrapeSourceRenderer(e,t,r){const i=this._drapeSourceRenderers.get(e);_(i)&&i.destroy();const n=new t({...r,rendererContext:this,drapeSource:e});return this._drapeSourceRenderers.set(e,n),this._sortedDrapeSourceRenderersDirty=!0,"fullOpacity"in e&&this._handles.add(re(()=>e.fullOpacity,()=>this.events.emit("content-changed")),e),n}removeDrapeSourceRenderer(e){if(R(e))return;const t=this._drapeSourceRenderers.get(e);R(t)||(this._sortedDrapeSourceRenderersDirty=!0,this._drapeSourceRenderers.delete(e),this._handles.remove(e),t.destroy())}collectUnusedRenderTargetMemory(e){let t=!1;if(_(this._overlayRenderTarget))for(const r of this._overlayRenderTarget.renderTargets){const i=this.overlays[0].validTargets[r.type]||!this.overlays[1].validTargets[r.type];t=this._overlayRenderTarget.validateUsageForTarget(i,r,e)||t}return t}get overlays(){return vt(this._overlays,[])}ensureDrapeTargets(e){_(this._overlays)&&this._overlays.forEach(t=>{t.hasTargetWithoutRasterImage=z$(e,r=>r.drapeTargetType===nK.WithoutRasterImage)})}ensureDrapeSources(e){_(this._overlays)&&this._overlays.forEach(t=>{t.hasDrapedFeatureSource=z$(e,r=>r.drapeSourceType===y7.Features),t.hasDrapedRasterSource=z$(e,r=>r.drapeSourceType===y7.RasterImage)})}ensureOverlays(e,t){R(this._overlays)&&(this._overlayRenderTarget=new Tyt(this._rctx),this._overlays=[new cme(ji.INNER,this._overlayRenderTarget),new cme(ji.OUTER,this._overlayRenderTarget)]),this.ensureDrapeTargets(e),this.ensureDrapeSources(t)}disposeOverlays(){this._overlays=null,this._overlayRenderTarget=Qe(this._overlayRenderTarget),this.events.emit("textures-disposed")}get running(){return this.updating}runTask(e,t=()=>!0){this._frameTask.processQueue(e),e.done||this._processDrapeSources(e,t)}_processDrapeSources(e,t){let r=!1;for(const[i,n]of this._drapeSourceRenderers){if(e.done)break;(i.destroyed||t(i))&&n.commitChanges()&&(r=!0,e.madeProgress())}this._updateSortedDrapeSourceRenderers(),r&&(_(this._overlays)&&this._drapeSourceRenderers.size===0&&this.disposeOverlays(),this.notifyChange("updating"),this.events.emit("content-changed"),this._updateHasHighlights(),this._updateRendersOccluded(),this._updateHasWater())}processSyncDrapeSources(){this._processDrapeSources(y6,e=>e.updatePolicy===p9.SYNC)}isEmpty(){if(Yr.OVERLAY_DRAW_DEBUG_TEXTURE)return!1;for(const e of this._drapeSourceRenderers.values())if(!e.isEmpty)return!1;return!0}get hasHighlights(){return this._hasHighlights}get hasWater(){return this._hasWater}get rendersOccluded(){return this._rendersOccluded}updateAnimation(e){let t=!1;return this._drapeSourceRenderers.forEach(r=>t=r.updateAnimation(e)||t),t}updateDrapeSourceOrder(){this._sortedDrapeSourceRenderersDirty=!0}drawTarget(e,t,r){const i=e.canvasGeometries;if(i.numViews===0)return!1;this._screenToWorldRatio=r*e.mapUnitsPerPixel;const n=t.renderPass;if(this.isEmpty()||n===je.MATERIAL_HIGHLIGHT&&!this.hasHighlights||n===je.MATERIAL_NORMAL&&!this.hasWater||!e.hasSomeSizedView())return!1;const s=t.fbo;if(!s.isValid())return!1;const a=2*e.resolution,o=e.resolution;s.resize(a,o);const l=this._rctx;Y3.pixelRatio=e.pixelRatio*r,this._renderContext.pass=n,this._bindParameters.screenToWorldRatio=this._screenToWorldRatio,this._bindParameters.screenToPCSRatio=this._screenToWorldRatio*this.worldToPCSRatio,this._bindParameters.slot=n===je.MATERIAL_NORMAL?Ee.DRAPED_WATER:Ee.DRAPED_MATERIAL,e.applyViewport(this._rctx),s.bind(l),e.index===ji.INNER&&(l.setClearColor(0,0,0,0),l.clearSafe(ii.COLOR_BUFFER_BIT));const c=t.type===In.ColorNoRasterImage?z1.ExcludeRasterImage:t.type===In.Occluded?z1.OccludedOnly:z1.Normal;if(c===z1.OccludedOnly&&(this._renderContext.renderOccludedMask=mk),Yr.OVERLAY_DRAW_DEBUG_TEXTURE&&c!==z1.OccludedOnly)for(let u=0;u<i.numViews;u++)this._setViewParameters(i.extents[u],e,Y3),this._drawDebugTexture(e.resolution,Bbt[e.index]);return this._drapeSourceRenderers.size>0&&this._sortedDrapeSourceRenderers.forAll(({drapeSource:u,renderer:h})=>{if(c===z1.ExcludeRasterImage&&u.drapeSourceType===y7.RasterImage)return;const{fullOpacity:p}=u,m=_(p)&&p<1&&n===je.MATERIAL;m&&(this.bindTemporaryFramebuffer(this._rctx,a,o),l.clearSafe(ii.COLOR_BUFFER_BIT));for(let g=0;g<i.numViews;g++)this._setViewParameters(i.extents[g],e,Y3),h.render(this._renderContext,this._bindParameters);m&&_(this._temporaryFBO)&&(s.bind(l),this.view._stage.renderView.compositingHelper.composite(this._renderContext.bindParameters,this._temporaryFBO.getTexture(),to.PremultipliedAlpha,p,Jc.OverlayWithTransparency,e.index))}),l.bindFramebuffer(null),s.generateMipMap(),this._renderContext.resetRenderOccludedMask(),!0}bindTemporaryFramebuffer(e,t,r){R(this._temporaryFBO)&&(this._temporaryFBO=new ZAe(e,!1)),this._temporaryFBO.resize(t,r),this._temporaryFBO.bind(e)}async reloadShaders(){await this._shaderTechniqueRepository.reloadAll()}notifyContentChanged(){this.events.emit("content-changed")}intersect(e,t,r,i){var s,a;let n=0;for(const o of this._drapeSourceRenderers.values())n=(a=(s=o.intersect)==null?void 0:s.call(o,e,t,r,i,n))!=null?a:n}_updateSortedDrapeSourceRenderers(){if(!this._sortedDrapeSourceRenderersDirty||(this._sortedDrapeSourceRenderersDirty=!1,this._sortedDrapeSourceRenderers.clear(),this._drapeSourceRenderers.size===0))return;const e=this.view.map.allLayers;this._drapeSourceRenderers.forEach((t,r)=>{const i=e.indexOf(r.layer);this._sortedDrapeSourceRenderers.push(new Ubt(r,t,i<0?1/0:i))}),this._sortedDrapeSourceRenderers.sort((t,r)=>t.index-r.index)}_setViewParameters(e,t,r){r.viewport[0]=r.viewport[1]=0,r.viewport[2]=r.viewport[3]=t.resolution,qre(r.projectionMatrix,0,e[2]-e[0],0,e[3]-e[1],r.near,r.far),NV(r.viewMatrix,[-e[0],-e[1],0]),this._bindParameters.camera=r}_updateHasWater(){const e=vs(this._drapeSourceRenderers,t=>t.hasWater);e!==this._hasWater&&(this._hasWater=e,this.events.emit("has-water",e))}_updateHasHighlights(){const e=vs(this._drapeSourceRenderers,t=>t.hasHighlights);e!==this._hasHighlights&&(this._hasHighlights=e,this.events.emit("has-highlights",e))}_updateRendersOccluded(){const e=vs(this._drapeSourceRenderers,t=>t.rendersOccluded);e!==this._rendersOccluded&&(this._rendersOccluded=e,this.events.emit("renders-occluded",e))}_drawDebugTexture(e,t){this._ensureDebugPatternResources(e,e);const r=this._rctx,i=r.bindTechnique(this._debugTextureTechnique);i.setUniform4f("uColor",t[0],t[1],t[2],1),i.bindTexture("tex",this._debugPatternTexture),r.bindVAO(this._quadVAO),r.drawArrays(Dt.TRIANGLE_STRIP,0,io(this._quadVAO,"geometry"))}_ensureDebugPatternResources(e,t){if(this._debugPatternTexture)return;const r=new Uint8Array(e*t*4);let i=0;for(let s=0;s<t;s++)for(let a=0;a<e;a++){const o=Math.floor(a/10),l=Math.floor(s/10);o<2||l<2||10*o>e-20||10*l>t-20?(r[i++]=255,r[i++]=255,r[i++]=255,r[i++]=255):(r[i++]=255,r[i++]=255,r[i++]=255,r[i++]=1&o&&1&l?1&a^1&s?0:255:1&o^1&l?0:128)}this._debugPatternTexture=new at(this._rctx,{target:mt.TEXTURE_2D,pixelFormat:Ue.RGBA,dataType:At.UNSIGNED_BYTE,samplingMode:tt.NEAREST,width:e,height:t},r);const n=new vae;n.hasAlpha=!0,this._debugTextureTechnique=this._shaderTechniqueRepository.acquire(FO,n),this._quadVAO=Tl(this._rctx)}get test(){return{drapeSourceRenderers:this._drapeSourceRenderers,getDrapeSourceRenderer:e=>this._drapeSourceRenderers.get(e)}}};var z1;d([f()],kf.prototype,"_frameTask",void 0),d([f()],kf.prototype,"_sortedDrapeSourceRenderersDirty",void 0),d([Za()],kf.prototype,"_shaderTechniqueRepository",void 0),d([Za()],kf.prototype,"_stippleTextureRepository",void 0),d([f({constructOnly:!0})],kf.prototype,"view",void 0),d([f()],kf.prototype,"worldToPCSRatio",void 0),d([f()],kf.prototype,"spatialReference",void 0),d([f({type:Boolean,readOnly:!0})],kf.prototype,"updating",null),kf=d([$("esri.views.3d.terrain.OverlayRenderer")],kf),function(e){e[e.Normal=0]="Normal",e[e.OccludedOnly=1]="OccludedOnly",e[e.ExcludeRasterImage=2]="ExcludeRasterImage"}(z1||(z1={}));class Ubt{constructor(t,r,i){this.drapeSource=t,this.renderer=r,this.index=i}}const Bbt=[[1,.5,.5],[.5,.5,1]],Y3=new ni;Y3.near=1,Y3.far=1e4,Y3.relativeElevation=null;const _ae=-2,mk=ki.OccludeAndTransparent;function Gme(e){const t=[[O.POSITION,e.indices]],r=[[O.POSITION,{size:3,data:e.attributeData.position,exclusive:!0}]];return _(e.attributeData.color)&&(r.push([O.COLOR,{size:4,data:e.attributeData.color,exclusive:!0}]),t.push([O.COLOR,new Uint32Array(e.indices.length)])),_(e.attributeData.uvMapSpace)&&(r.push([O.UVMAPSPACE,{size:4,data:e.attributeData.uvMapSpace,exclusive:!0}]),t.push([O.UVMAPSPACE,e.indices])),_(e.attributeData.boundingRect)&&(r.push([O.BOUNDINGRECT,{size:9,data:e.attributeData.boundingRect,exclusive:!0}]),t.push([O.BOUNDINGRECT,e.indices])),_(e.attributeData.mapPosition)&&(r.push([O.MAPPOS,{size:3,data:e.attributeData.mapPosition,exclusive:!0}]),t.push([O.MAPPOS,e.indices])),new Gi(r,t)}function jme(e){const t=[[O.POSITION,e.indices],[O.UV0,e.indices]],r=[[O.POSITION,{size:3,data:e.attributeData.position,exclusive:!0}],[O.UV0,{size:2,data:e.attributeData.uv0,exclusive:!0}]];return _(e.attributeData.mapPosition)&&(r.push([O.MAPPOS,{size:3,data:e.attributeData.mapPosition,exclusive:!0}]),t.push([O.MAPPOS,e.indices])),new Gi(r,t)}function fR(e){switch(e.type){case"extent":if(e instanceof Zt)return $o.fromExtent(e);break;case"polygon":return e}return null}function wae(e,t,r,i){const n=IO(e.rings,e.hasZ,wm.CCW_IS_HOLE),s=new Float64Array(n.position.length),a=LAe(n.position,e.spatialReference,0,s,0,n.position,0,n.position.length/3,t,r,i),o=a!=null;return{position:n.position,mapPosition:s,polygons:PRe(n.polygons,n.position,s),outlines:MRe(n.outlines,n.position,s),projectionSuccess:o,sampledElevation:a}}function ORe(e,t){const r=IO(e.rings,!1,wm.CCW_IS_HOLE),i=mi(r.position,e.spatialReference,0,r.position,t,0,r.position.length/3);for(let n=2;n<r.position.length;n+=3)r.position[n]=_ae;return{position:r.position,polygons:PRe(r.polygons,r.position),outlines:MRe(r.outlines,r.position),projectionSuccess:i}}function MRe(e,t,r){const i=new Array;for(const{index:n,count:s}of e){if(s<=1)continue;const a=3*n,o=a+3*s;i.push({index:n,count:s,position:t.subarray(a,o),mapPosition:r?r.subarray(a,o):void 0})}return i}function PRe(e,t,r){const i=new Array;for(const{index:n,count:s,holeIndices:a,pathLengths:o}of e){if(s<=1)continue;const l=3*n,c=l+3*s,u=a.map(h=>h-n);i.push({index:n,count:s,holeIndices:u,pathLengths:o,position:t.subarray(l,c),mapPosition:r?r.subarray(l,c):void 0})}return i}function IRe(e,t){const r=e.fragment;switch(r.code.add(S`struct ShadingNormalParameters {
vec3 normalView;
vec3 viewDirection;
} shadingParams;`),t.doubleSidedMode){case Yi.None:r.code.add(S`vec3 shadingNormal(ShadingNormalParameters params) {
return normalize(params.normalView);
}`);break;case Yi.View:r.code.add(S`vec3 shadingNormal(ShadingNormalParameters params) {
return dot(params.normalView, params.viewDirection) > 0.0 ? normalize(-params.normalView) : normalize(params.normalView);
}`);break;case Yi.WindingOrder:r.code.add(S`vec3 shadingNormal(ShadingNormalParameters params) {
return gl_FrontFacing ? normalize(params.normalView) : normalize(-params.normalView);
}`);break;default:t.doubleSidedMode;case Yi.COUNT:}}var Yi;(function(e){e[e.None=0]="None",e[e.View=1]="View",e[e.WindingOrder=2]="WindingOrder",e[e.COUNT=3]="COUNT"})(Yi||(Yi={}));function $Re(e){e.vertex.code.add(S`vec4 offsetBackfacingClipPosition(vec4 posClip, vec3 posWorld, vec3 normalWorld, vec3 camPosWorld) {
vec3 camToVert = posWorld - camPosWorld;
bool isBackface = dot(camToVert, normalWorld) > 0.0;
if (isBackface) {
posClip.z += 0.0000003 * posClip.w;
}
return posClip;
}`)}function LRe(e,t){t.instanced&&t.instancedDoublePrecision&&(e.attributes.add(O.MODELORIGINHI,"vec3"),e.attributes.add(O.MODELORIGINLO,"vec3"),e.attributes.add(O.MODEL,"mat3"),e.attributes.add(O.MODELNORMAL,"mat3"));const r=e.vertex;t.instancedDoublePrecision&&(r.include(pk,t),r.uniforms.add(new yl("viewOriginHi",(i,n)=>Zut(ne(dI,n.camera.viewInverseTransposeMatrix[3],n.camera.viewInverseTransposeMatrix[7],n.camera.viewInverseTransposeMatrix[11]),dI))),r.uniforms.add(new yl("viewOriginLo",(i,n)=>Qut(ne(dI,n.camera.viewInverseTransposeMatrix[3],n.camera.viewInverseTransposeMatrix[7],n.camera.viewInverseTransposeMatrix[11]),dI)))),r.code.add(S`
    vec3 calculateVPos() {
      ${t.instancedDoublePrecision?"return model * localPosition().xyz;":"return localPosition().xyz;"}
    }
    `),r.code.add(S`
    vec3 subtractOrigin(vec3 _pos) {
      ${t.instancedDoublePrecision?S`
          vec3 originDelta = dpAdd(viewOriginHi, viewOriginLo, -modelOriginHi, -modelOriginLo);
          return _pos - originDelta;`:"return vpos;"}
    }
    `),r.code.add(S`
    vec3 dpNormal(vec4 _normal) {
      ${t.instancedDoublePrecision?"return normalize(modelNormal * _normal.xyz);":"return normalize(_normal.xyz);"}
    }
    `),t.output===K.Normal&&(r.uniforms.add(new Ei("viewNormal",(i,n)=>n.camera.viewInverseTransposeMatrix)),r.code.add(S`
    vec3 dpNormalView(vec4 _normal) {
      ${t.instancedDoublePrecision?"return normalize((viewNormal * vec4(modelNormal * _normal.xyz, 1.0)).xyz);":"return normalize((viewNormal * _normal).xyz);"}
    }
    `)),t.hasVertexTangents&&r.code.add(S`
    vec4 dpTransformVertexTangent(vec4 _tangent) {
      ${t.instancedDoublePrecision?"return vec4(modelNormal * _tangent.xyz, _tangent.w);":"return _tangent;"}

    }
    `)}const dI=M();var Dn;function DRe(e){switch(e){case"multiply":default:return Dn.Multiply;case"ignore":return Dn.Ignore;case"replace":return Dn.Replace;case"tint":return Dn.Tint}}function FRe(e,t,r){if(R(e)||t===Dn.Ignore)return r[0]=255,r[1]=255,r[2]=255,void(r[3]=255);const i=Le(Math.round(e[3]*gk),0,gk),n=i===0||t===Dn.Tint?0:t===Dn.Replace?Gbt:jbt;r[0]=Le(Math.round(e[0]*cT),0,cT),r[1]=Le(Math.round(e[1]*cT),0,cT),r[2]=Le(Math.round(e[2]*cT),0,cT),r[3]=i+n}(function(e){e[e.Multiply=1]="Multiply",e[e.Ignore=2]="Ignore",e[e.Replace=3]="Replace",e[e.Tint=4]="Tint"})(Dn||(Dn={}));const cT=255,gk=85,Gbt=gk,jbt=2*gk;function NRe(e){e.vertex.code.add(S`
    vec4 decodeSymbolColor(vec4 symbolColor, out int colorMixMode) {
      float symbolAlpha = 0.0;

      const float maxTint = 85.0;
      const float maxReplace = 170.0;
      const float scaleAlpha = 3.0;

      if (symbolColor.a > maxReplace) {
        colorMixMode = ${S.int(Dn.Multiply)};
        symbolAlpha = scaleAlpha * (symbolColor.a - maxReplace);
      } else if (symbolColor.a > maxTint) {
        colorMixMode = ${S.int(Dn.Replace)};
        symbolAlpha = scaleAlpha * (symbolColor.a - maxTint);
      } else if (symbolColor.a > 0.0) {
        colorMixMode = ${S.int(Dn.Tint)};
        symbolAlpha = scaleAlpha * symbolColor.a;
      } else {
        colorMixMode = ${S.int(Dn.Multiply)};
        symbolAlpha = 0.0;
      }

      return vec4(symbolColor.r, symbolColor.g, symbolColor.b, symbolAlpha);
    }
  `)}function kRe(e,t){t.hasSymbolColors?(e.include(NRe),e.attributes.add(O.SYMBOLCOLOR,"vec4"),e.varyings.add("colorMixMode","mediump float"),e.vertex.code.add(S`int symbolColorMixMode;
vec4 getSymbolColor() {
return decodeSymbolColor(symbolColor, symbolColorMixMode) * 0.003921568627451;
}
void forwardColorMixMode() {
colorMixMode = float(symbolColorMixMode) + 0.5;
}`)):(e.fragment.uniforms.add(new DO("colorMixMode",r=>Z7e[r.colorMixMode])),e.vertex.code.add(S`vec4 getSymbolColor() { return vec4(1.0); }
void forwardColorMixMode() {}`))}function Lx(e,t){t.hasVertexColors?(e.attributes.add(O.COLOR,"vec4"),e.varyings.add("vColor","vec4"),e.vertex.code.add(S`void forwardVertexColor() { vColor = color; }`),e.vertex.code.add(S`void forwardNormalizedVertexColor() { vColor = color * 0.003921568627451; }`)):e.vertex.code.add(S`void forwardVertexColor() {}
void forwardNormalizedVertexColor() {}`)}function qbt(e){e.fragment.code.add(S`
    #define discardOrAdjustAlpha(color) { if (color.a < ${S.float(ao)}) { discard; } }
  `)}class VRe extends sn{constructor(t,r){super(t,"float",zr.Draw,(i,n,s)=>i.setUniform1f(t,r(n,s)))}}function bw(e,t){zRe(e,t,new He("textureAlphaCutoff",r=>r.textureAlphaCutoff))}function Hbt(e,t){zRe(e,t,new VRe("textureAlphaCutoff",r=>r.textureAlphaCutoff))}function zRe(e,t,r){const i=e.fragment;switch(t.alphaDiscardMode!==ui.Mask&&t.alphaDiscardMode!==ui.MaskBlend||i.uniforms.add(r),t.alphaDiscardMode){case ui.Blend:return e.include(qbt);case ui.Opaque:i.code.add(S`void discardOrAdjustAlpha(inout vec4 color) {
color.a = 1.0;
}`);break;case ui.Mask:i.code.add(S`#define discardOrAdjustAlpha(color) { if (color.a < textureAlphaCutoff) { discard; } else { color.a = 1.0; } }`);break;case ui.MaskBlend:e.fragment.code.add(S`#define discardOrAdjustAlpha(color) { if (color.a < textureAlphaCutoff) { discard; } }`)}}function URe(e,t){const r=e.vertex.code,i=e.fragment.code,n=t.hasModelTransformation;t.output!==K.Depth&&t.output!==K.Shadow||(_u(e,t),e.include(no,{linearDepth:!0,hasModelTransformation:n}),e.include(hy,t),e.include(n5,t),e.include(x_,t),e.include(Cn,t),e.vertex.uniforms.add(new _r("nearFar",(s,a)=>a.camera.nearFar)),e.varyings.add("depth","float"),t.hasColorTexture&&e.fragment.uniforms.add(new Wt("tex",s=>s.texture)),r.add(S`
      void main(void) {
        vpos = calculateVPos();
        vpos = subtractOrigin(vpos);
        vpos = addVerticalOffset(vpos, localOrigin);
        gl_Position = transformPositionWithDepth(proj, view, ${n?"model,":""} vpos, nearFar, depth);
        forwardTextureCoordinates();
      }
    `),e.include(bw,t),i.add(S`
      void main(void) {
        discardBySlice(vpos);
        ${t.hasColorTexture?S`
        vec4 texColor = texture2D(tex, vuv0);
        discardOrAdjustAlpha(texColor);`:""}
        outputDepth(depth);
      }
    `)),t.output===K.Normal&&(_u(e,t),e.include(no,{linearDepth:!1,hasModelTransformation:n}),e.include(uU,t),e.include(fU,t),e.include(hy,t),e.include(n5,t),t.hasColorTexture&&e.fragment.uniforms.add(new Wt("tex",s=>s.texture)),e.varyings.add("vPositionView","vec3"),r.add(S`
      void main(void) {
        vpos = calculateVPos();
        vpos = subtractOrigin(vpos);
        ${t.normalType===Ii.Attribute?S`
        vNormalWorld = dpNormalView(vvLocalNormal(normalModel()));`:""}
        vpos = addVerticalOffset(vpos, localOrigin);
        gl_Position = transformPosition(proj, view, ${n?"model,":""} vpos);
        forwardTextureCoordinates();
      }
    `),e.include(Cn,t),e.include(bw,t),i.add(S`
      void main() {
        discardBySlice(vpos);
        ${t.hasColorTexture?S`
        vec4 texColor = texture2D(tex, vuv0);
        discardOrAdjustAlpha(texColor);`:""}

        ${t.normalType===Ii.ScreenDerivative?S`
            vec3 normal = screenDerivativeNormal(vPositionView);`:S`
            vec3 normal = normalize(vNormalWorld);
            if (gl_FrontFacing == false) normal = -normal;`}
        gl_FragColor = vec4(vec3(0.5) + 0.5 * normal, 1.0);
      }
    `)),t.output===K.Highlight&&(_u(e,t),e.include(no,{linearDepth:!1,hasModelTransformation:n}),e.include(hy,t),e.include(n5,t),t.hasColorTexture&&e.fragment.uniforms.add(new Wt("tex",s=>s.texture)),r.add(S`
      void main(void) {
        vpos = calculateVPos();
        vpos = subtractOrigin(vpos);
        vpos = addVerticalOffset(vpos, localOrigin);
        gl_Position = transformPosition(proj, view, ${n?"model,":""} vpos);
        forwardTextureCoordinates();
      }
    `),e.include(Cn,t),e.include(bw,t),e.include(Ky),i.add(S`
      void main() {
        discardBySlice(vpos);
        ${t.hasColorTexture?S`
        vec4 texColor = texture2D(tex, vuv0);
        discardOrAdjustAlpha(texColor);`:""}
        outputHighlight();
      }
    `))}function BRe(e,t){const r=e.fragment;if(t.hasVertexTangents?(e.attributes.add(O.TANGENT,"vec4"),e.varyings.add("vTangent","vec4"),t.doubleSidedMode===Yi.WindingOrder?r.code.add(S`mat3 computeTangentSpace(vec3 normal) {
float tangentHeadedness = gl_FrontFacing ? vTangent.w : -vTangent.w;
vec3 tangent = normalize(gl_FrontFacing ? vTangent.xyz : -vTangent.xyz);
vec3 bitangent = cross(normal, tangent) * tangentHeadedness;
return mat3(tangent, bitangent, normal);
}`):r.code.add(S`mat3 computeTangentSpace(vec3 normal) {
float tangentHeadedness = vTangent.w;
vec3 tangent = normalize(vTangent.xyz);
vec3 bitangent = cross(normal, tangent) * tangentHeadedness;
return mat3(tangent, bitangent, normal);
}`)):(e.extensions.add("GL_OES_standard_derivatives"),r.code.add(S`mat3 computeTangentSpace(vec3 normal, vec3 pos, vec2 st) {
vec3 Q1 = dFdx(pos);
vec3 Q2 = dFdy(pos);
vec2 stx = dFdx(st);
vec2 sty = dFdy(st);
float det = stx.t * sty.s - sty.t * stx.s;
vec3 T = stx.t * Q2 - sty.t * Q1;
T = T - normal * dot(normal, T);
T *= inversesqrt(max(dot(T,T), 1.e-10));
vec3 B = sign(det) * cross(normal, T);
return mat3(T, B, normal);
}`)),t.textureCoordinateType!==ws.None){e.include(nse,t);const i=t.supportsTextureAtlas;r.uniforms.add(t.pbrTextureBindType===zr.Pass?tD("normalTexture",n=>n.textureNormal,i):d7("normalTexture",n=>n.textureNormal,i)),r.code.add(S`
    vec3 computeTextureNormal(mat3 tangentSpace, vec2 uv) {
      vtc.uv = uv;
      ${t.supportsTextureAtlas?"vtc.size = normalTextureSize;":""}
      vec3 rawNormal = textureLookup(normalTexture, vtc).rgb * 2.0 - 1.0;
      return tangentSpace * rawNormal;
    }
  `)}}function NO(e,t){const r=e.fragment;t.receiveAmbientOcclusion?(r.uniforms.add([new Wt("ssaoTex",(i,n)=>n.ssaoHelper.colorTexture),new cr("viewportPixelSz",(i,n)=>ei(Wbt,n.camera.fullViewport[0],n.camera.fullViewport[1],1/n.ssaoHelper.width,1/n.ssaoHelper.height))]),r.code.add(S`float evaluateAmbientOcclusion() {
return 1.0 - texture2D(ssaoTex, (gl_FragCoord.xy - viewportPixelSz.xy) * viewportPixelSz.zw).a;
}
float evaluateAmbientOcclusionInverse() {
return texture2D(ssaoTex, (gl_FragCoord.xy - viewportPixelSz.xy) * viewportPixelSz.zw).a;
}`)):r.code.add(S`float evaluateAmbientOcclusion() { return 0.0; }
float evaluateAmbientOcclusionInverse() { return 1.0; }`)}const Wbt=Jt();function ox(e,t){const r=e.fragment;e.include(NO,t),t.pbrMode!==It.Disabled&&e.include(mU,t),e.include(cse,t),r.constants.add("ambientBoostFactor","float",v6),e.include(Pz),r.code.add(S`
    const float GAMMA_SRGB = 2.1;
    const float INV_GAMMA_SRGB = 0.4761904;
    ${t.pbrMode===It.Disabled?"":"const vec3 GROUND_REFLECTANCE = vec3(0.2);"}
  `),r.uniforms.add(new St("lightingMainDirection",(i,n)=>n.lighting.lightingMainDirection)),r.code.add(S`
    float additionalDirectedAmbientLight(vec3 vPosWorld) {
      float vndl = dot(${t.spherical?S`normalize(vPosWorld)`:S`vec3(0.0, 0.0, 1.0)`}, lightingMainDirection);
      return smoothstep(0.0, 1.0, clamp(vndl * 2.5, 0.0, 1.0));
    }
  `),r.uniforms.add([new He("lightingGlobalFactor",(i,n)=>n.lighting.globalFactor),new St("lightingMainIntensity",(i,n)=>n.lighting.mainLight.intensity)]),r.code.add(S`vec3 evaluateAdditionalLighting(float ambientOcclusion, vec3 vPosWorld) {
float additionalAmbientScale = additionalDirectedAmbientLight(vPosWorld);
return (1.0 - ambientOcclusion) * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor * lightingMainIntensity;
}`),t.pbrMode===It.Disabled||t.pbrMode===It.WaterOnIntegratedMesh?(e.include(dse,t),r.code.add(S`vec3 evaluateSceneLighting(vec3 normalWorld, vec3 albedo, float shadow, float ssao, vec3 additionalLight)
{
vec3 mainLighting = evaluateMainLighting(normalWorld, shadow);
vec3 ambientLighting = calculateAmbientIrradiance(normalWorld, ssao);
vec3 albedoLinear = pow(albedo, vec3(GAMMA_SRGB));
vec3 totalLight = mainLighting + ambientLighting + additionalLight;
totalLight = min(totalLight, vec3(PI));
vec3 outColor = vec3((albedoLinear / PI) * totalLight);
return pow(outColor, vec3(INV_GAMMA_SRGB));
}`)):t.pbrMode!==It.Normal&&t.pbrMode!==It.Schematic||(r.code.add(S`const float fillLightIntensity = 0.25;
const float horizonLightDiffusion = 0.4;
const float additionalAmbientIrradianceFactor = 0.02;
vec3 evaluateSceneLightingPBR(vec3 normal, vec3 albedo, float shadow, float ssao, vec3 additionalLight, vec3 viewDir, vec3 normalGround, vec3 mrr, vec3 _emission, float additionalAmbientIrradiance)
{
vec3 viewDirection = -viewDir;
vec3 mainLightDirection = lightingMainDirection;
vec3 h = normalize(viewDirection + mainLightDirection);
PBRShadingInfo inputs;
inputs.NdotL = clamp(dot(normal, mainLightDirection), 0.001, 1.0);
inputs.NdotV = clamp(abs(dot(normal, viewDirection)), 0.001, 1.0);
inputs.NdotH = clamp(dot(normal, h), 0.0, 1.0);
inputs.VdotH = clamp(dot(viewDirection, h), 0.0, 1.0);
inputs.NdotNG = clamp(dot(normal, normalGround), -1.0, 1.0);
vec3 reflectedView = normalize(reflect(viewDirection, normal));
inputs.RdotNG = clamp(dot(reflectedView, normalGround), -1.0, 1.0);
inputs.albedoLinear = pow(albedo, vec3(GAMMA_SRGB));
inputs.ssao = ssao;
inputs.metalness = mrr[0];
inputs.roughness = clamp(mrr[1] * mrr[1], 0.001, 0.99);`),r.code.add(S`inputs.f0 = (0.16 * mrr[2] * mrr[2]) * (1.0 - inputs.metalness) + inputs.albedoLinear * inputs.metalness;
inputs.f90 = vec3(clamp(dot(inputs.f0, vec3(50.0 * 0.33)), 0.0, 1.0));
inputs.diffuseColor = inputs.albedoLinear * (vec3(1.0) - inputs.f0) * (1.0 - inputs.metalness);`),t.useFillLights?r.uniforms.add(new Xw("hasFillLights",(i,n)=>n.enableFillLights)):r.constants.add("hasFillLights","bool",!1),r.code.add(S`vec3 ambientDir = vec3(5.0 * normalGround[1] - normalGround[0] * normalGround[2], - 5.0 * normalGround[0] - normalGround[2] * normalGround[1], normalGround[1] * normalGround[1] + normalGround[0] * normalGround[0]);
ambientDir = ambientDir != vec3(0.0)? normalize(ambientDir) : normalize(vec3(5.0, -1.0, 0.0));
inputs.NdotAmbDir = hasFillLights ? abs(dot(normal, ambientDir)) : 1.0;
vec3 mainLightIrradianceComponent = inputs.NdotL * (1.0 - shadow) * lightingMainIntensity;
vec3 fillLightsIrradianceComponent = inputs.NdotAmbDir * lightingMainIntensity * fillLightIntensity;
vec3 ambientLightIrradianceComponent = calculateAmbientIrradiance(normal, ssao) + additionalLight;
inputs.skyIrradianceToSurface = ambientLightIrradianceComponent + mainLightIrradianceComponent + fillLightsIrradianceComponent ;
inputs.groundIrradianceToSurface = GROUND_REFLECTANCE * ambientLightIrradianceComponent + mainLightIrradianceComponent + fillLightsIrradianceComponent ;`),r.uniforms.add([new He("lightingSpecularStrength",(i,n)=>n.lighting.mainLight.specularStrength),new He("lightingEnvironmentStrength",(i,n)=>n.lighting.mainLight.environmentStrength)]),r.code.add(S`vec3 horizonRingDir = inputs.RdotNG * normalGround - reflectedView;
vec3 horizonRingH = normalize(viewDirection + horizonRingDir);
inputs.NdotH_Horizon = dot(normal, horizonRingH);
vec3 mainLightRadianceComponent = lightingSpecularStrength * normalDistribution(inputs.NdotH, inputs.roughness) * lightingMainIntensity * (1.0 - shadow);
vec3 horizonLightRadianceComponent = lightingEnvironmentStrength * normalDistribution(inputs.NdotH_Horizon, min(inputs.roughness + horizonLightDiffusion, 1.0)) * lightingMainIntensity * fillLightIntensity;
vec3 ambientLightRadianceComponent = lightingEnvironmentStrength * calculateAmbientRadiance(ssao) + additionalLight;
inputs.skyRadianceToSurface = ambientLightRadianceComponent + mainLightRadianceComponent + horizonLightRadianceComponent;
inputs.groundRadianceToSurface = GROUND_REFLECTANCE * (ambientLightRadianceComponent + horizonLightRadianceComponent) + mainLightRadianceComponent;
inputs.averageAmbientRadiance = ambientLightIrradianceComponent[1] * (1.0 + GROUND_REFLECTANCE[1]);`),r.code.add(S`
        vec3 reflectedColorComponent = evaluateEnvironmentIllumination(inputs);
        vec3 additionalMaterialReflectanceComponent = inputs.albedoLinear * additionalAmbientIrradiance;
        vec3 emissionComponent = pow(_emission, vec3(GAMMA_SRGB));
        vec3 outColorLinear = reflectedColorComponent + additionalMaterialReflectanceComponent + emissionComponent;
        ${t.pbrMode===It.Schematic?S`vec3 outColor = pow(max(vec3(0.0), outColorLinear - 0.005 * inputs.averageAmbientRadiance), vec3(INV_GAMMA_SRGB));`:S`vec3 outColor = pow(blackLevelSoftCompression(outColorLinear, inputs), vec3(INV_GAMMA_SRGB));`}
        return outColor;
      }
    `))}function GRe(e,t){const r=S`
  /*
  *  ${t.name}
  *  ${t.output===K.Color?"RenderOutput: Color":t.output===K.Depth?"RenderOutput: Depth":t.output===K.Shadow?"RenderOutput: Shadow":t.output===K.Normal?"RenderOutput: Normal":t.output===K.Highlight?"RenderOutput: Highlight":""}
  */
  `;FA()&&(e.fragment.code.add(r),e.vertex.code.add(r))}function pR(e){e.include($m),e.code.add(S`
    vec3 mixExternalColor(vec3 internalColor, vec3 textureColor, vec3 externalColor, int mode) {
      // workaround for artifacts in OSX using Intel Iris Pro
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475
      vec3 internalMixed = internalColor * textureColor;
      vec3 allMixed = internalMixed * externalColor;

      if (mode == ${S.int(Dn.Multiply)}) {
        return allMixed;
      }
      if (mode == ${S.int(Dn.Ignore)}) {
        return internalMixed;
      }
      if (mode == ${S.int(Dn.Replace)}) {
        return externalColor;
      }

      // tint (or something invalid)
      float vIn = rgb2v(internalMixed);
      vec3 hsvTint = rgb2hsv(externalColor);
      vec3 hsvOut = vec3(hsvTint.x, hsvTint.y, vIn * hsvTint.z);
      return hsv2rgb(hsvOut);
    }

    float mixExternalOpacity(float internalOpacity, float textureOpacity, float externalOpacity, int mode) {
      // workaround for artifacts in OSX using Intel Iris Pro
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475
      float internalMixed = internalOpacity * textureOpacity;
      float allMixed = internalMixed * externalOpacity;

      if (mode == ${S.int(Dn.Ignore)}) {
        return internalMixed;
      }
      if (mode == ${S.int(Dn.Replace)}) {
        return externalOpacity;
      }

      // multiply or tint (or something invalid)
      return allMixed;
    }
  `)}function Xbt(e){const t=new Qr,r=t.vertex.code,i=t.fragment.code;t.include(GRe,{name:"Default Material Shader",output:e.output});const n=_u(t,e);return t.include(hU),t.varyings.add("vpos","vec3"),t.include(n5,e),t.include(LRe,e),t.include(B7e,e),e.output!==K.Color&&e.output!==K.Alpha||(_m(t.vertex,e),t.include(uU,e),t.include(no,{linearDepth:!1,hasModelTransformation:e.hasModelTransformation}),e.normalType===Ii.Attribute&&e.offsetBackfaces&&t.include($Re),t.include(BRe,e),t.include(fU,e),e.instancedColor&&t.attributes.add(O.INSTANCECOLOR,"vec4"),t.varyings.add("localvpos","vec3"),t.include(hy,e),t.include(LO,e),t.include(kRe,e),t.include(Lx,e),t.vertex.uniforms.add(new cr("externalColor",s=>s.externalColor)),t.varyings.add("vcolorExt","vec4"),e.hasMultipassTerrain&&t.varyings.add("depth","float"),e.hasModelTransformation&&t.vertex.uniforms.add(new Ei("model",s=>_(s.modelTransformation)?s.modelTransformation:Es)),r.add(S`
      void main(void) {
        forwardNormalizedVertexColor();
        vcolorExt = externalColor;
        ${e.instancedColor?"vcolorExt *= instanceColor;":""}
        vcolorExt *= vvColor();
        vcolorExt *= getSymbolColor();
        forwardColorMixMode();

        if (vcolorExt.a < ${S.float(ao)}) {
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        } else {
          vpos = calculateVPos();
          localvpos = vpos - view[3].xyz;
          vpos = subtractOrigin(vpos);
          ${e.normalType===Ii.Attribute?S`vNormalWorld = dpNormal(vvLocalNormal(normalModel()));`:""}
          vpos = addVerticalOffset(vpos, localOrigin);
          ${e.hasVertexTangents?"vTangent = dpTransformVertexTangent(tangent);":""}
          gl_Position = transformPosition(proj, view, ${e.hasModelTransformation?"model,":""} vpos);
          ${e.normalType===Ii.Attribute&&e.offsetBackfaces?"gl_Position = offsetBackfacingClipPosition(gl_Position, vpos, vNormalWorld, cameraPosition);":""}
        }

        ${e.hasMultipassTerrain?"depth = (view * vec4(vpos, 1.0)).z;":""}
        forwardLinearDepth();
        forwardTextureCoordinates();
      }
    `)),e.output===K.Alpha&&(t.include(Cn,e),t.include(bw,e),t.include(Mu,e),t.fragment.uniforms.add([new He("opacity",s=>s.opacity),new He("layerOpacity",s=>s.layerOpacity)]),e.hasColorTexture&&t.fragment.uniforms.add(new Wt("tex",s=>s.texture)),t.fragment.include(pR),i.add(S`
      void main() {
        discardBySlice(vpos);
        ${e.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}
        ${e.hasColorTexture?S`
                vec4 texColor = texture2D(tex, vuv0);
                ${e.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:S`vec4 texColor = vec4(1.0);`}
        ${e.hasVertexColors?S`float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:S`float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}
        gl_FragColor = vec4(opacity_);
      }
    `)),e.output===K.Color&&(t.include(Cn,e),t.include(ox,e),t.include(NO,e),t.include(bw,e),t.include(e.instancedDoublePrecision?pU:ax,e),t.include(Mu,e),_m(t.fragment,e),t.fragment.uniforms.add([n,new St("ambient",s=>s.ambient),new St("diffuse",s=>s.diffuse),new He("opacity",s=>s.opacity),new He("layerOpacity",s=>s.layerOpacity),new He("lightingGlobalFactor",(s,a)=>a.lighting.globalFactor),new St("lightingMainIntensity",(s,a)=>a.lighting.mainLight.intensity)]),t.fragment.constants.add("ambientBoostFactor","float",v6),e.hasColorTexture&&t.fragment.uniforms.add(new Wt("tex",s=>s.texture)),t.include(lse,e),t.include(mU,e),t.fragment.include(pR),t.include(IRe,e),i.add(S`
      void main() {
        discardBySlice(vpos);
        ${e.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}
        ${e.hasColorTexture?S`
                vec4 texColor = texture2D(tex, vuv0);
                ${e.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:S`vec4 texColor = vec4(1.0);`}
        shadingParams.viewDirection = normalize(vpos - cameraPosition);
        ${e.normalType===Ii.ScreenDerivative?S`
                vec3 normal = screenDerivativeNormal(localvpos);`:S`
                shadingParams.normalView = vNormalWorld;
                vec3 normal = shadingNormal(shadingParams);`}
        ${e.pbrMode===It.Normal?"applyPBRFactors();":""}
        float ssao = evaluateAmbientOcclusionInverse();
        ssao *= getBakedOcclusion();

        float additionalAmbientScale = additionalDirectedAmbientLight(vpos + localOrigin);
        ${e.receiveShadows?"float shadow = readShadowMap(vpos, linearDepth);":e.spherical?"float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);":"float shadow = 0.0;"}
        vec3 matColor = max(ambient, diffuse);
        ${e.hasVertexColors?S`
                vec3 albedo = mixExternalColor(vColor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:S`
                vec3 albedo = mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}
        ${e.hasNormalTexture?S`
                mat3 tangentSpace = ${e.hasVertexTangents?"computeTangentSpace(normal);":"computeTangentSpace(normal, vpos, vuv0);"}
                vec3 shadingNormal = computeTextureNormal(tangentSpace, vuv0);`:S`vec3 shadingNormal = normal;`}
        vec3 normalGround = ${e.spherical?S`normalize(vpos + localOrigin);`:S`vec3(0.0, 0.0, 1.0);`}

        ${e.snowCover?S`
                float snow = smoothstep(0.5, 0.55, dot(normal, normalGround));
                albedo = mix(albedo, vec3(1), snow);
                shadingNormal = mix(shadingNormal, normal, snow);
                ssao = mix(ssao, 1.0, snow);`:""}

        vec3 additionalLight = ssao * lightingMainIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;

        ${e.pbrMode===It.Normal||e.pbrMode===It.Schematic?S`
                float additionalAmbientIrradiance = additionalAmbientIrradianceFactor * lightingMainIntensity[2];
                ${e.snowCover?S`
                        mrr = mix(mrr, vec3(0.0, 1.0, 0.04), snow);
                        emission = mix(emission, vec3(0.0), snow);`:""}

                vec3 shadedColor = evaluateSceneLightingPBR(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight, shadingParams.viewDirection, normalGround, mrr, emission, additionalAmbientIrradiance);`:S`vec3 shadedColor = evaluateSceneLighting(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight);`}
        gl_FragColor = highlightSlice(vec4(shadedColor, opacity_), vpos);
        ${e.transparencyPassType===yt.Color?S`gl_FragColor = premultiplyAlpha(gl_FragColor);`:""}
      }
    `)),t.include(URe,e),t}const Ybt=Object.freeze(Object.defineProperty({__proto__:null,build:Xbt},Symbol.toStringTag,{value:"Module"}));class Zbt extends mRe{constructor(){super(...arguments),this.isSchematic=!1,this.usePBR=!1,this.mrrFactors=Ve(0,1,.5),this.hasVertexColors=!1,this.hasSymbolColors=!1,this.doubleSided=!1,this.doubleSidedType="normal",this.cullFace=pi.Back,this.emissiveFactor=Ve(0,0,0),this.instancedDoublePrecision=!1,this.normals="default",this.receiveSSAO=!0,this.receiveShadows=!0,this.castShadows=!0,this.shadowMappingEnabled=!1,this.ambient=Ve(.2,.2,.2),this.diffuse=Ve(.8,.8,.8),this.externalColor=Tr(1,1,1,1),this.colorMixMode="multiply",this.opacity=1,this.layerOpacity=1,this.origin=M(),this.hasSlicePlane=!1,this.hasSliceHighlight=!0,this.offsetTransparentBackfaces=!1,this.vvSizeEnabled=!1,this.vvSizeMinSize=[1,1,1],this.vvSizeMaxSize=[100,100,100],this.vvSizeOffset=[0,0,0],this.vvSizeFactor=[1,1,1],this.vvSizeValue=[1,1,1],this.vvColorEnabled=!1,this.vvColorValues=[0,0,0,0,0,0,0,0],this.vvColorColors=[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],this.vvSymbolAnchor=[0,0,0],this.vvSymbolRotationMatrix=Li(),this.vvOpacityEnabled=!1,this.vvOpacityValues=[],this.vvOpacityOpacities=[],this.transparent=!1,this.writeDepth=!0,this.customDepthTest=qw.Less,this.textureAlphaMode=ui.Blend,this.textureAlphaCutoff=ok,this.textureAlphaPremultiplied=!1,this.hasOccludees=!1,this.renderOccluded=ki.Occlude}}class Qbt extends gRe{constructor(){super(...arguments),this.origin=M(),this.slicePlaneLocalOrigin=this.origin}}class kO extends gi{initializeConfiguration(t,r){r.spherical=t.viewingMode===Be.Global,r.doublePrecisionRequiresObfuscation=$O(t.rctx),r.textureCoordinateType=r.hasColorTexture||r.hasMetalnessAndRoughnessTexture||r.hasEmissionTexture||r.hasOcclusionTexture||r.hasNormalTexture?ws.Default:ws.None}initializeProgram(t){return this._initializeProgram(t,kO.shader)}_initializeProgram(t,r){const i=r.get().build(this.configuration);return new ai(t.rctx,i,Ur)}_convertDepthTestFunction(t){return t===qw.Lequal?vi.LEQUAL:vi.LESS}_setPipeline(t,r){const i=this.configuration,n=t===yt.NONE,s=t===yt.FrontFace;return jt({blending:i.output!==K.Color&&i.output!==K.Alpha||!i.transparent?null:n?wu:eb(t),culling:Jbt(i)&&Mz(i.cullFace),depthTest:{func:w_(t,this._convertDepthTestFunction(i.customDepthTest))},depthWrite:n||s?i.writeDepth&&fc:null,colorWrite:or,stencilWrite:i.hasOccludees?xm:null,stencilTest:i.hasOccludees?r?d_:T_:null,polygonOffset:n||s?null:rU(i.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this._setPipeline(this.configuration.transparencyPassType,!0),this._setPipeline(this.configuration.transparencyPassType,!1)}getPipelineState(t,r){return r?this._occludeePipelineState:super.getPipelineState(t,r)}}function Jbt(e){return e.cullFace!==pi.None||!e.hasSlicePlane&&!e.transparent&&!e.doubleSidedMode}kO.shader=new si(Ybt,()=>ie(()=>import("./DefaultMaterial.glsl.80c8d44d.js"),[],import.meta.url));class ir extends Mo{constructor(){super(...arguments),this.output=K.Color,this.alphaDiscardMode=ui.Opaque,this.doubleSidedMode=Yi.None,this.pbrMode=It.Disabled,this.cullFace=pi.None,this.transparencyPassType=yt.NONE,this.normalType=Ii.Attribute,this.textureCoordinateType=ws.None,this.customDepthTest=qw.Less,this.spherical=!1,this.hasVertexColors=!1,this.hasSymbolColors=!1,this.hasVerticalOffset=!1,this.hasSlicePlane=!1,this.hasSliceHighlight=!0,this.hasColorTexture=!1,this.hasMetalnessAndRoughnessTexture=!1,this.hasEmissionTexture=!1,this.hasOcclusionTexture=!1,this.hasNormalTexture=!1,this.hasScreenSizePerspective=!1,this.hasVertexTangents=!1,this.hasOccludees=!1,this.hasMultipassTerrain=!1,this.hasModelTransformation=!1,this.offsetBackfaces=!1,this.vvSize=!1,this.vvColor=!1,this.receiveShadows=!1,this.receiveAmbientOcclusion=!1,this.textureAlphaPremultiplied=!1,this.instanced=!1,this.instancedColor=!1,this.instancedDoublePrecision=!1,this.doublePrecisionRequiresObfuscation=!1,this.writeDepth=!0,this.transparent=!1,this.enableOffset=!0,this.cullAboveGround=!1,this.snowCover=!1}}d([H({count:K.COUNT})],ir.prototype,"output",void 0),d([H({count:ui.COUNT})],ir.prototype,"alphaDiscardMode",void 0),d([H({count:Yi.COUNT})],ir.prototype,"doubleSidedMode",void 0),d([H({count:It.COUNT})],ir.prototype,"pbrMode",void 0),d([H({count:pi.COUNT})],ir.prototype,"cullFace",void 0),d([H({count:yt.COUNT})],ir.prototype,"transparencyPassType",void 0),d([H({count:Ii.COUNT})],ir.prototype,"normalType",void 0),d([H({count:ws.COUNT})],ir.prototype,"textureCoordinateType",void 0),d([H({count:qw.COUNT})],ir.prototype,"customDepthTest",void 0),d([H()],ir.prototype,"spherical",void 0),d([H()],ir.prototype,"hasVertexColors",void 0),d([H()],ir.prototype,"hasSymbolColors",void 0),d([H()],ir.prototype,"hasVerticalOffset",void 0),d([H()],ir.prototype,"hasSlicePlane",void 0),d([H()],ir.prototype,"hasSliceHighlight",void 0),d([H()],ir.prototype,"hasColorTexture",void 0),d([H()],ir.prototype,"hasMetalnessAndRoughnessTexture",void 0),d([H()],ir.prototype,"hasEmissionTexture",void 0),d([H()],ir.prototype,"hasOcclusionTexture",void 0),d([H()],ir.prototype,"hasNormalTexture",void 0),d([H()],ir.prototype,"hasScreenSizePerspective",void 0),d([H()],ir.prototype,"hasVertexTangents",void 0),d([H()],ir.prototype,"hasOccludees",void 0),d([H()],ir.prototype,"hasMultipassTerrain",void 0),d([H()],ir.prototype,"hasModelTransformation",void 0),d([H()],ir.prototype,"offsetBackfaces",void 0),d([H()],ir.prototype,"vvSize",void 0),d([H()],ir.prototype,"vvColor",void 0),d([H()],ir.prototype,"receiveShadows",void 0),d([H()],ir.prototype,"receiveAmbientOcclusion",void 0),d([H()],ir.prototype,"textureAlphaPremultiplied",void 0),d([H()],ir.prototype,"instanced",void 0),d([H()],ir.prototype,"instancedColor",void 0),d([H()],ir.prototype,"instancedDoublePrecision",void 0),d([H()],ir.prototype,"doublePrecisionRequiresObfuscation",void 0),d([H()],ir.prototype,"writeDepth",void 0),d([H()],ir.prototype,"transparent",void 0),d([H()],ir.prototype,"enableOffset",void 0),d([H()],ir.prototype,"cullAboveGround",void 0),d([H()],ir.prototype,"snowCover",void 0),d([H({constValue:!0})],ir.prototype,"hasVvInstancing",void 0),d([H({constValue:!1})],ir.prototype,"useCustomDTRExponentForWater",void 0),d([H({constValue:!1})],ir.prototype,"supportsTextureAtlas",void 0),d([H({constValue:!0})],ir.prototype,"useFillLights",void 0);function Kbt(e){const t=new Qr,r=t.vertex.code,i=t.fragment.code,n=_u(t,e);return t.include(hU),t.varyings.add("vpos","vec3"),t.include(n5,e),t.include(LRe,e),t.include(B7e,e),e.output!==K.Color&&e.output!==K.Alpha||(_m(t.vertex,e),t.include(uU,e),t.include(no),e.offsetBackfaces&&t.include($Re),e.instancedColor&&t.attributes.add(O.INSTANCECOLOR,"vec4"),t.varyings.add("vNormalWorld","vec3"),t.varyings.add("localvpos","vec3"),e.hasMultipassTerrain&&t.varyings.add("depth","float"),t.include(hy,e),t.include(LO,e),t.include(kRe,e),t.include(Lx,e),t.vertex.uniforms.add(new cr("externalColor",s=>s.externalColor)),t.varyings.add("vcolorExt","vec4"),r.add(S`
        void main(void) {
          forwardNormalizedVertexColor();
          vcolorExt = externalColor;
          ${e.instancedColor?"vcolorExt *= instanceColor;":""}
          vcolorExt *= vvColor();
          vcolorExt *= getSymbolColor();
          forwardColorMixMode();

          if (vcolorExt.a < ${S.float(ao)}) {
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          } else {
            vpos = calculateVPos();
            localvpos = vpos - view[3].xyz;
            vpos = subtractOrigin(vpos);
            vNormalWorld = dpNormal(vvLocalNormal(normalModel()));
            vpos = addVerticalOffset(vpos, localOrigin);
            gl_Position = transformPosition(proj, view, vpos);
            ${e.offsetBackfaces?"gl_Position = offsetBackfacingClipPosition(gl_Position, vpos, vNormalWorld, cameraPosition);":""}
          }
          ${e.hasMultipassTerrain?S`depth = (view * vec4(vpos, 1.0)).z;`:""}
          forwardLinearDepth();
          forwardTextureCoordinates();
        }
      `)),e.output===K.Alpha&&(t.include(Cn,e),t.include(bw,e),t.include(Mu,e),t.fragment.uniforms.add([new He("opacity",s=>s.opacity),new He("layerOpacity",s=>s.layerOpacity),new Jv("view")]),e.hasColorTexture&&t.fragment.uniforms.add(new Wt("tex",s=>s.texture)),t.fragment.include(pR),i.add(S`
      void main() {
        discardBySlice(vpos);
        ${e.hasMultipassTerrain?S`terrainDepthTest(gl_FragCoord, depth);`:""}
        ${e.hasColorTexture?S`
                vec4 texColor = texture2D(tex, vuv0);
                ${e.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:S`vec4 texColor = vec4(1.0);`}
        ${e.hasVertexColors?S`float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:S`float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}

        gl_FragColor = vec4(opacity_);
      }
    `)),e.output===K.Color&&(t.include(Cn,e),t.include(ox,e),t.include(NO,e),t.include(bw,e),t.include(e.instancedDoublePrecision?pU:ax,e),t.include(Mu,e),_m(t.fragment,e),t.fragment.uniforms.add([n,new St("ambient",s=>s.ambient),new St("diffuse",s=>s.diffuse),new He("opacity",s=>s.opacity),new He("layerOpacity",s=>s.layerOpacity),new Jv("view"),new He("lightingGlobalFactor",(s,a)=>a.lighting.globalFactor),new St("lightingMainIntensity",(s,a)=>a.lighting.mainLight.intensity)]),t.fragment.constants.add("ambientBoostFactor","float",v6),e.hasColorTexture&&t.fragment.uniforms.add(new Wt("tex",s=>s.texture)),t.include(lse,e),t.include(mU,e),t.fragment.include(pR),t.extensions.add("GL_OES_standard_derivatives"),i.add(S`
      void main() {
        discardBySlice(vpos);
        ${e.hasMultipassTerrain?S`terrainDepthTest(gl_FragCoord, depth);`:""}
        ${e.hasColorTexture?S`
                vec4 texColor = texture2D(tex, vuv0);
                ${e.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:S`vec4 texColor = vec4(1.0);`}
        vec3 viewDirection = normalize(vpos - cameraPosition);
        ${e.pbrMode===It.Normal?"applyPBRFactors();":""}
        float ssao = evaluateAmbientOcclusionInverse();
        ssao *= getBakedOcclusion();

        float additionalAmbientScale = additionalDirectedAmbientLight(vpos + localOrigin);
        vec3 additionalLight = ssao * lightingMainIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;
        ${e.receiveShadows?"float shadow = readShadowMap(vpos, linearDepth);":e.spherical?"float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);":"float shadow = 0.0;"}
        vec3 matColor = max(ambient, diffuse);
        ${e.hasVertexColors?S`
                vec3 albedo = mixExternalColor(vColor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:S`
                vec3 albedo = mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}
        ${e.snowCover?S`albedo = mix(albedo, vec3(1), 0.9);`:S``}
        ${S`
            vec3 shadingNormal = normalize(vNormalWorld);
            albedo *= 1.2;
            vec3 viewForward = vec3(view[0][2], view[1][2], view[2][2]);
            float alignmentLightView = clamp(dot(viewForward, -lightingMainDirection), 0.0, 1.0);
            float transmittance = 1.0 - clamp(dot(viewForward, shadingNormal), 0.0, 1.0);
            float treeRadialFalloff = vColor.r;
            float backLightFactor = 0.5 * treeRadialFalloff * alignmentLightView * transmittance * (1.0 - shadow);
            additionalLight += backLightFactor * lightingMainIntensity;`}
        ${e.pbrMode===It.Normal||e.pbrMode===It.Schematic?e.spherical?S`vec3 normalGround = normalize(vpos + localOrigin);`:S`vec3 normalGround = vec3(0.0, 0.0, 1.0);`:S``}
        ${e.pbrMode===It.Normal||e.pbrMode===It.Schematic?S`
                float additionalAmbientIrradiance = additionalAmbientIrradianceFactor * lightingMainIntensity[2];
                ${e.snowCover?S`
                        mrr = vec3(0.0, 1.0, 0.04);
                        emission = vec3(0.0);`:""}

                vec3 shadedColor = evaluateSceneLightingPBR(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight, viewDirection, normalGround, mrr, emission, additionalAmbientIrradiance);`:S`vec3 shadedColor = evaluateSceneLighting(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight);`}
        gl_FragColor = highlightSlice(vec4(shadedColor, opacity_), vpos);
        ${e.transparencyPassType===yt.Color?S`gl_FragColor = premultiplyAlpha(gl_FragColor);`:S``}
      }
    `)),t.include(URe,e),t}const e1t=Object.freeze(Object.defineProperty({__proto__:null,build:Kbt},Symbol.toStringTag,{value:"Module"}));class vU extends kO{initializeConfiguration(t,r){super.initializeConfiguration(t,r),r.hasMetalnessAndRoughnessTexture=!1,r.hasEmissionTexture=!1,r.hasOcclusionTexture=!1,r.hasNormalTexture=!1,r.hasModelTransformation=!1,r.normalType=Ii.Attribute,r.doubleSidedMode=Yi.WindingOrder,r.hasVertexTangents=!1}initializeProgram(t){return this._initializeProgram(t,vU.shader)}}vU.shader=new si(e1t,()=>ie(()=>import("./RealisticTree.glsl.36b53a3b.js"),[],import.meta.url));class lx extends Dm{constructor(t){super(t,i1t),this.supportsEdges=!0,this.techniqueConfig=new ir,this.vertexBufferLayout=s1t(this.parameters),this.instanceBufferLayout=t.instanced?jRe(this.parameters):null}isVisibleInPass(t){return t!==je.MATERIAL_DEPTH_SHADOWMAP_ALL&&t!==je.MATERIAL_DEPTH_SHADOWMAP_DEFAULT&&t!==je.MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT||this.parameters.castShadows}isVisible(){const t=this.parameters;if(!super.isVisible()||t.layerOpacity===0)return!1;const{instanced:r,hasVertexColors:i,hasSymbolColors:n,vvColorEnabled:s}=t,a=_(r)&&r.includes("color"),o=t.colorMixMode==="replace",l=t.opacity>0,c=t.externalColor&&t.externalColor[3]>0;return i&&(a||s||n)?!!o||l:i?o?c:l:a||s||n?!!o||l:o?c:l}getConfiguration(t,r){return this.techniqueConfig.output=t,this.techniqueConfig.hasNormalTexture=!!this.parameters.normalTextureId,this.techniqueConfig.hasColorTexture=!!this.parameters.textureId,this.techniqueConfig.hasVertexTangents=this.parameters.hasVertexTangents,this.techniqueConfig.instanced=!!this.parameters.instanced,this.techniqueConfig.instancedDoublePrecision=this.parameters.instancedDoublePrecision,this.techniqueConfig.vvSize=this.parameters.vvSizeEnabled,this.techniqueConfig.hasVerticalOffset=_(this.parameters.verticalOffset),this.techniqueConfig.hasScreenSizePerspective=_(this.parameters.screenSizePerspective),this.techniqueConfig.hasSlicePlane=this.parameters.hasSlicePlane,this.techniqueConfig.hasSliceHighlight=this.parameters.hasSliceHighlight,this.techniqueConfig.alphaDiscardMode=this.parameters.textureAlphaMode,this.techniqueConfig.normalType=this.parameters.normals==="screenDerivative"?Ii.ScreenDerivative:Ii.Attribute,this.techniqueConfig.transparent=this.parameters.transparent,this.techniqueConfig.writeDepth=this.parameters.writeDepth,_(this.parameters.customDepthTest)&&(this.techniqueConfig.customDepthTest=this.parameters.customDepthTest),this.techniqueConfig.hasOccludees=this.parameters.hasOccludees,this.techniqueConfig.cullFace=this.parameters.hasSlicePlane?pi.None:this.parameters.cullFace,this.techniqueConfig.hasMultipassTerrain=r.multipassTerrain.enabled,this.techniqueConfig.cullAboveGround=r.multipassTerrain.cullAboveGround,this.techniqueConfig.hasModelTransformation=_(this.parameters.modelTransformation),t!==K.Color&&t!==K.Alpha||(this.techniqueConfig.hasVertexColors=this.parameters.hasVertexColors,this.techniqueConfig.hasSymbolColors=this.parameters.hasSymbolColors,this.parameters.treeRendering?this.techniqueConfig.doubleSidedMode=Yi.WindingOrder:this.techniqueConfig.doubleSidedMode=this.parameters.doubleSided&&this.parameters.doubleSidedType==="normal"?Yi.View:this.parameters.doubleSided&&this.parameters.doubleSidedType==="winding-order"?Yi.WindingOrder:Yi.None,this.techniqueConfig.instancedColor=_(this.parameters.instanced)&&this.parameters.instanced.includes("color"),this.techniqueConfig.receiveShadows=this.parameters.receiveShadows&&this.parameters.shadowMappingEnabled,this.techniqueConfig.receiveAmbientOcclusion=!!r.ssaoHelper.ready&&this.parameters.receiveSSAO,this.techniqueConfig.vvColor=this.parameters.vvColorEnabled,this.techniqueConfig.textureAlphaPremultiplied=!!this.parameters.textureAlphaPremultiplied,this.techniqueConfig.pbrMode=this.parameters.usePBR?this.parameters.isSchematic?It.Schematic:It.Normal:It.Disabled,this.techniqueConfig.hasMetalnessAndRoughnessTexture=!!this.parameters.metallicRoughnessTextureId,this.techniqueConfig.hasEmissionTexture=!!this.parameters.emissiveTextureId,this.techniqueConfig.hasOcclusionTexture=!!this.parameters.occlusionTextureId,this.techniqueConfig.offsetBackfaces=!(!this.parameters.transparent||!this.parameters.offsetTransparentBackfaces),this.techniqueConfig.transparencyPassType=r.transparencyPassType,this.techniqueConfig.enableOffset=r.camera.relativeElevation<eU,this.techniqueConfig.snowCover=this.hasSnowCover(r)),this.techniqueConfig}hasSnowCover(t){return _(t.weather)&&t.weatherVisible&&t.weather.type==="snowy"&&t.weather.snowCover==="enabled"}intersect(t,r,i,n,s,a,o){if(_(this.parameters.verticalOffset)){const l=n.camera;ne(Cq,i[12],i[13],i[14]);let c=null;switch(n.viewingMode){case Be.Global:c=we(qme,Cq);break;case Be.Local:c=oe(qme,l1t)}let u=0;const h=pe(c1t,Cq,l.eye),p=Oe(h),m=le(h,h,1/p);let g=null;this.parameters.screenSizePerspective&&(g=Se(c,m)),u+=X7e(l,p,this.parameters.verticalOffset,g,this.parameters.screenSizePerspective),le(c,c,u),ed(Eq,c,n.transform.inverseRotation),s=pe(a1t,s,Eq),a=pe(o1t,a,Eq)}Yz(t,r,n,s,a,VJ(n.verticalOffset),o)}requiresSlot(t){return t===(this.parameters.transparent?this.parameters.writeDepth?Ee.TRANSPARENT_MATERIAL:Ee.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL:Ee.OPAQUE_MATERIAL)||t===Ee.DRAPED_MATERIAL}createGLMaterial(t){return t.output===K.Color||t.output===K.Alpha||t.output===K.Depth||t.output===K.Normal||t.output===K.Shadow||t.output===K.Highlight?new t1t(t):null}createBufferWriter(){return new n1t(this.vertexBufferLayout,this.instanceBufferLayout)}}class t1t extends ose{constructor(t){super({...t,...t.material.parameters})}_updateParameters(t){const r=this._material.parameters;this.updateTexture(r.textureId);const i=t.camera.viewInverseTransposeMatrix;return ne(r.origin,i[3],i[7],i[11]),this._material.setParameters(this.textureBindParameters),this.ensureTechnique(r.treeRendering?vU:kO,t)}_updateShadowState(t){t.shadowMap.enabled!==this._material.parameters.shadowMappingEnabled&&this._material.setParameters({shadowMappingEnabled:t.shadowMap.enabled})}_updateOccludeeState(t){t.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:t.hasOccludees})}beginSlot(t){return this._output!==K.Color&&this._output!==K.Alpha||(this._updateShadowState(t),this._updateOccludeeState(t)),this._updateParameters(t)}}class r1t extends Zbt{constructor(){super(...arguments),this.initTextureTransparent=!1,this.treeRendering=!1,this.hasVertexTangents=!1}}const i1t=new r1t;class n1t{constructor(t,r){this.vertexBufferLayout=t,this.instanceBufferLayout=r}allocate(t){return this.vertexBufferLayout.createBuffer(t)}elementCount(t){return t.indices.get(O.POSITION).length}write(t,r,i,n){Qz(r,this.vertexBufferLayout,t.transformation,t.invTranspTransformation,i,n)}}function s1t(e){const t=e.textureId||e.normalTextureId||e.metallicRoughnessTextureId||e.emissiveTextureId||e.occlusionTextureId,r=gn().vec3f(O.POSITION).vec3f(O.NORMAL);return e.hasVertexTangents&&r.vec4f(O.TANGENT),t&&r.vec2f(O.UV0),e.hasVertexColors&&r.vec4u8(O.COLOR),e.hasSymbolColors&&r.vec4u8(O.SYMBOLCOLOR),r}function jRe(e){let t=gn();return t=e.instancedDoublePrecision?t.vec3f(O.MODELORIGINHI).vec3f(O.MODELORIGINLO).mat3f(O.MODEL).mat3f(O.MODELNORMAL):t.mat4f(O.MODEL).mat4f(O.MODELNORMAL),_(e.instanced)&&e.instanced.includes("color")&&(t=t.vec4f(O.INSTANCECOLOR)),_(e.instanced)&&e.instanced.includes("featureAttribute")&&(t=t.vec4f(O.INSTANCEFEATUREATTRIBUTE)),t}const a1t=M(),o1t=M(),l1t=Ve(0,0,1),qme=M(),Eq=M(),Cq=M(),c1t=M(),d1t=["polygon","extent"];class u1t extends Nm{constructor(t,r,i,n){super(t,r,i,n),this.ensureDrapedStatus(!1)}async doLoad(){if(!this._drivenProperties.size){const o=iU(this._getSymbolSize());if(o)throw new k("graphics3dextrudesymbollayer:invalid-size",o)}const t=Vi(this.symbolLayer,"material","color"),r=this._getCombinedOpacityAndColor(t),i=Wl(r),n=r[3],s=n<1||this.needsDrivenTransparentPass,a={usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0,diffuse:i,ambient:i,opacity:n,transparent:s,cullFace:s?pi.None:pi.Back,hasVertexColors:!0,hasSlicePlane:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows,offsetTransparentBackfaces:!0};this._material=new lx(a),this._bottomMaterial=new lx({...a,cullFace:pi.Back}),this._context.stage.add(this._material),this._context.stage.add(this._bottomMaterial)}destroy(){super.destroy(),this._material&&(this._context.stage.remove(this._material),this._context.stage.remove(this._bottomMaterial))}createGraphics3DGraphic(t){const r=t.graphic;if(!this._validateGeometry(r.geometry,d1t,this.symbolLayer.type))return null;const i=this._getVertexOpacityAndColor(t.renderingInfo,255),n=this.setGraphicElevationContext(r,new Du);return this._createAs3DShape(r,t.renderingInfo,i,n,r.uid)}layerOpacityChanged(t,r){const i=Vi(this.symbolLayer,"material","color"),n=this._getCombinedOpacity(i),s=n<1||this.needsDrivenTransparentPass;this._material.setParameters({opacity:n,transparent:s}),this._bottomMaterial.setParameters({opacity:n,transparent:s});const a=this._getLayerOpacity();return t.forEach(o=>{const l=r(o);_(l)&&l.layerOpacityChanged(a,this._context.isAsync)}),!0}layerElevationInfoChanged(t,r){return this.updateGraphics3DGraphicElevationInfo(t,r,l_)}slicePlaneEnabledChanged(t,r){return this._material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),this._bottomMaterial.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),t.forEach(i=>{const n=r(i);_(n)&&n.slicePlaneEnabledChanged(this._context.slicePlaneEnabled,this._context.isAsync)}),!0}physicalBasedRenderingChanged(){return this._material.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}),this._bottomMaterial.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}),!0}pixelRatioChanged(){return!0}_getExtrusionSize(t){var i;let r;return r=t.size&&this._drivenProperties.size?(i=fyt(t.size,2))!=null?i:0:this._getSymbolSize(),r/=this._context.renderCoordsHelper.unitInMeters,r}applyRendererDiff(t,r){return this._drivenPropertiesChanged(r)?xs.Recreate_Symbol:xs.Recreate_Graphics}_getSymbolSize(){var t;return(t=this.symbolLayer.size)!=null?t:1}_createAs3DShape(t,r,i,n,s){const a=fR(t.geometry);if(R(a))return null;const o=wae(a,this._context.elevationProvider,this._context.renderCoordsHelper,n);if(this._logGeometryCreationWarnings(o,a.rings,"rings","ExtrudeSymbol3DLayer"),a.rings.length===0||!a.rings.some(ce=>ce.length>0))return null;const l=sae(a);if(R(l))return null;const c=new Array,u=new Array,h=new Array,p=is(),m=Ae(),g=M(),b=this._context.renderCoordsHelper.viewingMode===Be.Global;b||this._context.renderCoordsHelper.worldUpAtPosition(null,g),Au(a.spatialReference,[l.x,l.y,0],m,this._context.renderCoordsHelper.spatialReference);const w=Ae();Rn(w,m);const v=Li();g9(v,w);const{polygons:x,mapPosition:T,position:E}=o,C=E.length/3,A=new Float64Array(3*C*6),P=new Float64Array(3*C*6),I=new Float64Array(3*C*6),L=new Float64Array(1*C*6);let V=0;for(let ce=0;ce<x.length;++ce){const se=x[ce],D=se.count;if(this._context.clippingExtent&&(bi(p),hu(p,se.mapPosition),!pp(p,this._context.clippingExtent)))continue;const F=P9(se.mapPosition,se.holeIndices,3);if(F.length===0)continue;const U=3*D*2+F.length,j=new Uint32Array(U),W=new Uint32Array(F.length),Z=6*D,q=3*A.BYTES_PER_ELEMENT,ee=new Nn(A.buffer,V*q,q,(V+Z)*q),me=3*P.BYTES_PER_ELEMENT,_e=new Nn(P.buffer,V*me,me,(V+Z)*me),De=new Float64Array(I.buffer,3*V*I.BYTES_PER_ELEMENT,3*Z),be=new Float64Array(L.buffer,1*V*L.BYTES_PER_ELEMENT,1*Z),ye=this._getExtrusionSize(r);h1t(E,T,F,se,ee.typedBuffer,De,_e.typedBuffer,be,0,j,W,ye,g,b),PO(ee,ee,w),c_(_e,_e,v),V+=6*D;const Ce=Hme(j,j.length-W.length,{positions:ee.typedBuffer,elevation:De,normals:_e.typedBuffer,heights:be},i);c.push(Ce),u.push(this._material),h.push(Es);const Ne=Hme(W,0,{positions:ee.typedBuffer,elevation:De,normals:_e.typedBuffer,heights:be},i);c.push(Ne),u.push(this._bottomMaterial),h.push(Es)}if(c.length===0)return null;const G=new rb({geometries:c,materials:u,transformations:h,metadata:{layerUid:this._context.layer.uid,graphicUid:s,isElevationSource:!0}});G.transformation=m;const B=BAe(this.symbolLayer,{opacity:this._getLayerOpacity()}),X=_(B)?{baseMaterial:this._material,edgeMaterials:[B],properties:{mergeGeometries:!0,hasSlicePlane:this._context.slicePlaneEnabled}}:null,Y=new Fm(this,G,c,null,null,m1t,n,X);return Y.alignedSampledElevation=o.sampledElevation,Y.needsElevationUpdates=l_(n.mode),Y}}function Hme(e,t,r,i){const n=new Uint32Array(e.length),s=[[O.POSITION,{size:3,data:r.positions,exclusive:!0}],[O.NORMAL,{size:3,data:r.normals,exclusive:!0}],[O.COLOR,{size:4,data:i,exclusive:!0}],[O.SIZE,{size:1,data:r.heights,exclusive:!0}]],a=[[O.POSITION,e],[O.NORMAL,e],[O.COLOR,n]];return r.elevation&&(s.push([O.MAPPOS,{size:3,data:r.elevation}]),a.push([O.MAPPOS,e])),new Gi(s,a,lc.Triangle,t)}function h1t(e,t,r,i,n,s,a,o,l,c,u,h,p,m){const g=r.length/3;let b=0,w=2*i.count;f1t(e,t,i.index,i.count,r,0,g,n,s,a,o,l,c,u,w,h,p,m),l+=2*i.count,w=0,Wme(n,s,o,a,b,i.pathLengths[0],i.count,l,c,w,h),l+=4*i.pathLengths[0],w+=2*i.pathLengths[0],b+=i.pathLengths[0];for(let v=1;v<i.pathLengths.length;++v)Wme(n,s,o,a,b,i.pathLengths[v],i.count,l,c,w,h),l+=4*i.pathLengths[v],w+=2*i.pathLengths[v],b+=i.pathLengths[v]}function f1t(e,t,r,i,n,s,a,o,l,c,u,h,p,m,g,b,w,v){oe(Il,w);const x=b>0?1:-1;let T=3*r,E=h,C=3*E,A=h+i,P=3*A;for(let V=0;V<i;++V)v&&(Il[0]=e[T+0],Il[1]=e[T+1],Il[2]=e[T+2],we(Il,Il)),o[C+0]=e[T+0],o[C+1]=e[T+1],o[C+2]=e[T+2],l[C+0]=t[T+0],l[C+1]=t[T+1],l[C+2]=t[T+2],c[C+0]=-x*Il[0],c[C+1]=-x*Il[1],c[C+2]=-x*Il[2],u[E]=0,o[P+0]=e[T+0]+b*Il[0],o[P+1]=e[T+1]+b*Il[1],o[P+2]=e[T+2]+b*Il[2],l[P+0]=t[T+0],l[P+1]=t[T+1],l[P+2]=t[T+2],c[P+0]=x*Il[0],c[P+1]=x*Il[1],c[P+2]=x*Il[2],u[A]=b,C+=3,P+=3,T+=3,E+=1,A+=1;T=3*s,C=0,P=3*g;const I=b<0?Kme:Jme,L=b<0?Jme:Kme;for(let V=0;V<a;++V)m[C+0]=n[T+I[0]],m[C+1]=n[T+I[1]],m[C+2]=n[T+I[2]],p[P+0]=n[T+L[0]]+i,p[P+1]=n[T+L[1]]+i,p[P+2]=n[T+L[2]]+i,C+=3,P+=3,T+=3}function uI(e,t,r,i,n,s,a){i[s]=i[a],a*=3,e[(s*=3)+0]=e[a+0],e[s+1]=e[a+1],e[s+2]=e[a+2],t[s+0]=t[a+0],t[s+1]=t[a+1],t[s+2]=t[a+2],r[s+0]=n[0],r[s+1]=n[1],r[s+2]=n[2]}const T8=M();function Wme(e,t,r,i,n,s,a,o,l,c,u){let h=n,p=n+1,m=n+a,g=n+a+1,b=o,w=o+1,v=o+2*s,x=o+2*s+1;u<0&&(h=n+a+1,g=n),c*=3;for(let T=0;T<s;++T)T===s-1&&(u>0?(p=n,g=n+a):(p=n,h=n+a)),p1t(e,h,p,m,T8),uI(e,t,i,r,T8,b,h),uI(e,t,i,r,T8,w,p),uI(e,t,i,r,T8,v,m),uI(e,t,i,r,T8,x,g),l[c++]=b,l[c++]=v,l[c++]=x,l[c++]=b,l[c++]=x,l[c++]=w,h++,p++,m++,g++,b+=2,w+=2,v+=2,x+=2}const Aq=M(),Xme=M(),Yme=M(),Zme=M(),Qme=M();function p1t(e,t,r,i,n){t*=3,r*=3,i*=3,ne(Aq,e[t++],e[t++],e[t++]),ne(Xme,e[r++],e[r++],e[r++]),ne(Yme,e[i++],e[i++],e[i++]),pe(Zme,Xme,Aq),pe(Qme,Yme,Aq),dt(n,Qme,Zme),we(n,n)}const dT=M();function m1t(e,t,r,i){const n=e.stageObject,s=n.geometryRecords,a=s.length,o=t.mode!=="absolute-height";let l=0;const c=n.transformation,u=Rn(Ae(),c);for(let h=0;h<a;h+=2){const p=s[h].geometry,m=p.getMutableAttribute(O.POSITION).data,g=p.vertexAttributes.get(O.SIZE).data,b=p.vertexAttributes.get(O.MAPPOS).data,w=new f7e(b),v=m.length/3;let x=0,T=!1,E=0;const C=r.spatialReference;for(let A=0;A<v;A++){dT[0]=m[x],dT[1]=m[x+1],dT[2]=m[x+2],zy(w,r,t,i,hI),o&&(E+=hI.sampledElevation),Yr.TESTS_DISABLE_OPTIMIZATIONS?(ne(Tc,w.array[w.offset+0],w.array[w.offset+1],hI.z+g[x/3]),i.toRenderCoords(Tc,C,Tc),ze(Tc,Tc,u)):(ne(Tc,m[x+0],m[x+1],m[x+2]),ze(Tc,Tc,c),i.setAltitude(Tc,hI.z+g[x/3]),ze(Tc,Tc,u)),m[x]=Tc[0],m[x+1]=Tc[1],m[x+2]=Tc[2];const P=g1t/i.unitInMeters;(Math.abs(dT[0]-m[x])>=P||Math.abs(dT[1]-m[x+1])>=P||Math.abs(dT[2]-m[x+2])>=P)&&(T=!0),w.offset+=3,x+=3}T&&(p.invalidateBoundingInfo(),n.geometryVertexAttrsUpdated(s[h]),s[h+1].geometry.invalidateBoundingInfo(),n.geometryVertexAttrsUpdated(s[h+1])),l+=E/v}return l/a}const Tc=M(),Il=M(),hI=new MO,Jme=[0,2,1],Kme=[0,1,2],g1t=.01;function y1t(e,t,r,i,n){const s=e.referencesGeometry()&&n?b1t(t,i,n):t,a=e.repurposeFeature(s);try{return e.evaluate({...r,$feature:a})}catch(o){return fe.getLogger("esri.views.2d.support.arcadeOnDemand").warn("Feature arcade evaluation failed:",o),null}}const Rq=new Map;function b1t(e,t,r){const{transform:i,hasZ:n,hasM:s}=r;Rq.has(t)||Rq.set(t,v1t(t));const a=Rq.get(t)(e.geometry,i,n,s);return{...e,geometry:a}}function v1t(e){const t={};switch(e){case"esriGeometryPoint":return(r,i,n,s)=>SAe(i,t,r,n,s);case"esriGeometryPolygon":return(r,i,n,s)=>EAe(i,t,r,n,s);case"esriGeometryPolyline":return(r,i,n,s)=>CAe(i,t,r,n,s);case"esriGeometryMultipoint":return(r,i,n,s)=>TAe(i,t,r,n,s);default:return fe.getLogger("esri.views.2d.support.arcadeOnDemand").error(new k("mapview-arcade",`Unable to handle geometryType: ${e}`)),r=>r}}const jLt=1.2,_1t=rm,w1t=Ih;class _U{constructor(t,r,i,n){this.graphics3DSymbolLayer=t,this.renderGeometries=r,this.boundingBox=i,this._drapeSourceRenderer=n,this.type="draped",this.stage=null,this._visible=!1,this._addedToStage=!1,this.isElevationSource=!1}initialize(t){this.stage=t}setVisibility(t){if(this.stage!=null&&this._visible!==t){if(this._visible=t,t&&!this._addedToStage)return this._addedToStage=!0,void this._drapeSourceRenderer.addGeometries(this.renderGeometries,sr.Geometry.ADD);if(t||this._addedToStage){for(const r of this.renderGeometries)r.instanceParameters.visible=this._visible;this._drapeSourceRenderer.modifyGeometries(this.renderGeometries,sr.State.VISIBILITIES)}}}destroy(){this.stage&&this._addedToStage&&this._drapeSourceRenderer.removeGeometries(this.renderGeometries,sr.Geometry.REMOVE),this._addedToStage=!1,this._visible=!1,this.stage=null}getCenterObjectSpace(t=M()){return ne(t,0,0,0)}getBoundingBoxObjectSpace(t=is()){return bi(t)}addObjectState(t,r){t===Fy.Highlight&&(this.renderGeometries.forEach(i=>{const n=i.addHighlight();r.addRenderGeometry(i,n,this)}),this._addedToStage&&this._drapeSourceRenderer.modifyGeometries(this.renderGeometries,sr.State.HIGHLIGHTS))}removeObjectState(t){this.renderGeometries.forEach(r=>{t.removeRenderGeometry(r)})}removeRenderGeometryObjectState(t,r){t.removeHighlight(r),this._addedToStage&&this._drapeSourceRenderer.modifyGeometries(this.renderGeometries,sr.State.HIGHLIGHTS)}computeAttachmentOrigin(t){for(const r of this.renderGeometries)r.computeAttachmentOrigin(uT)&&(t.draped.origin[0]+=uT[0],t.draped.origin[1]+=uT[1],t.draped.num++)}async getProjectedBoundingBox(t,r,i,n,s){bi(s);for(let a=0;a<this.renderGeometries.length;a++){const o=this.renderGeometries[a];this._getRenderGeometryProjectedBoundingRect(o,t,ege,i),yBe(s,ege)}if(r){let a;fp(s,uT);const o=aae(s,r);try{a=await r.service.queryElevation(uT[0],uT[1],n,o,"ground")}catch{}_(a)&&(s[2]=Math.min(s[2],a),s[5]=Math.max(s[5],a))}return s}_getRenderGeometryProjectedBoundingRect(t,r,i,n){if(this.boundingBox)TV(Jp,this.boundingBox);else{const s=t.boundingSphere,a=s[3];Jp[0]=s[0]-a,Jp[1]=s[1]-a,Jp[2]=s[2]-a,Jp[3]=s[0]+a,Jp[4]=s[1]+a,Jp[5]=s[2]+a}return r(Jp,0,2),this.calculateRelativeScreenBounds&&n.push({location:fp(Jp),screenSpaceBoundingRect:this.calculateRelativeScreenBounds()}),Dre(Jp,i)}}const ege=zt(),Jp=is(),uT=M();class qRe{constructor(t,r,i,n=2048){this.text=t,this._alignment=r,this._parameters=i,this.maxSize=n,this._textWidths=[],this._lineWidths=[],this._renderPixelRatio=null,this._displayWidth=null,this._heightMetrics=null,this.key=`TextRenderer-${this._parameters.key}-${this._alignment}--${t}`,this._lines=t.split(/\r?\n/)}get displayWidth(){return Math.ceil(this._ensureTextWidth()+2*this.backgroundHorizontalPadding)}get displayHeight(){const t=this.lineSpacing*(this._lines.length-1),r=this.lineHeight;return Math.ceil(t+r+2*this.haloSize+this.backgroundTopPadding+this.backgroundBottomPadding)}get renderedWidth(){return Math.ceil(this._toRenderUnit(this.displayWidth))}get renderedHeight(){return Math.ceil(this._toRenderUnit(this.displayHeight))}get firstRenderedBaselinePosition(){return this._toRenderUnit(this.firstLineYOffset+this.baselinePosition)}get firstLineYOffset(){return this.backgroundTopPadding+this.haloSize}get heightMetrics(){return this._ensureHeightMetrics()}get lineSpacing(){return(this.lineHeight+this.linePadding)*this._parameters.definition.lineSpacingFactor}get lineHeight(){return this.heightMetrics.lineHeight}get linePadding(){return this.lineHeight*x1t}get baselinePosition(){return this.heightMetrics.baselinePosition}get renderedFontSize(){return this._toRenderUnit(this.fontSize)}get fontSize(){return this._parameters.definition.size}get renderedHaloSize(){return this._toRenderUnit(this.haloSize)}get haloSize(){return this._parameters.haloSize}get backgroundHorizontalPadding(){return this.hasBackground?this._parameters.definition.background.padding[0]:0}get backgroundVerticalPadding(){return this.hasBackground?this._parameters.definition.background.padding[1]:0}get backgroundTopPadding(){return Math.max(0,this.backgroundVerticalPadding-this.heightMetrics.paddingTop)}get backgroundBottomPadding(){return Math.max(0,this.backgroundVerticalPadding-this.heightMetrics.paddingBottom)}get hasBackground(){return!!this._parameters.backgroundStyle}get renderPixelRatio(){if(R(this._renderPixelRatio)){const t=this._parameters.definition.pixelRatio;this.maxSize>0?this._renderPixelRatio=Math.min(t,Math.min(this.maxSize/this.displayWidth,this.maxSize/this.displayHeight)):this._renderPixelRatio=t}return this._renderPixelRatio}_getLineXOffset(t){switch(this._alignment){case Vv.Left:return this.backgroundHorizontalPadding;case Vv.Center:return(this.displayWidth-this._lineWidths[t])/2;case Vv.Right:return this.displayWidth-this.backgroundHorizontalPadding-this._lineWidths[t]}}render(t,r=0,i=0){t.save();const n=r/=this.renderPixelRatio,s=i/=this.renderPixelRatio,a=this.haloSize,o=this.firstLineYOffset;r+=a,i+=o+this.baselinePosition;const l=this.haloSize>0;l&&this._renderHalo(t,n,s,a,o),this._setFontProperties(t,this.renderedFontSize);for(let c=0;c<this._lines.length;++c){const u=this._lines[c],h=this._getLineXOffset(c);l&&(t.globalCompositeOperation="destination-out",t.fillStyle="rgb(0, 0, 0)",this._fillText(t,u,r+h,i),this._renderLineDecoration(t,r+h,i,this._textWidths[c])),t.globalCompositeOperation="source-over",t.fillStyle=this._parameters.textStyle,this._fillText(t,u,r+this._getLineXOffset(c),i),this._renderLineDecoration(t,r+h,i,this._textWidths[c]),i+=this.lineSpacing}if(Yr.TEXT_SHOW_BASELINE){t.strokeStyle=tge,t.setLineDash([2,2]),t.lineWidth=1;let c=s+o;for(let u=0;u<this._lines.length;++u){const h=c+this.baselinePosition;this._drawLine(t,[n,h],[n+this.displayWidth,h]),c+=this.lineSpacing}}if(Yr.TEXT_SHOW_BORDER&&(t.strokeStyle=tge,t.setLineDash([]),t.lineWidth=1,this._drawBox(t,[n,s],[this.displayWidth,this.displayHeight])),this.hasBackground){const c=this._parameters.definition.background.borderRadius*this.renderPixelRatio;this._roundedRect(t,n,s,c),t.globalCompositeOperation="destination-over",t.fillStyle=this._parameters.backgroundStyle,t.fill()}t.restore()}_renderLineDecoration(t,r,i,n,s=!1){if(this._parameters.definition.font.decoration==="none"||n===0)return;const a=1,o=Math.max(this._parameters.definition.size/16,a);switch(this._parameters.definition.font.decoration){case"underline":i+=2*o;break;case"line-through":i-=.33*this.baselinePosition}const l=s?this.haloSize:0;t.strokeStyle=s?this._parameters.haloStyle:this._parameters.textStyle,t.lineWidth=this._toRenderUnit(o+2*l),t.beginPath(),t.moveTo(this._toRenderUnit(r-l),this._toRenderUnit(i)),t.lineTo(this._toRenderUnit(r+n+l),this._toRenderUnit(i)),t.stroke()}_roundedRect(t,r,i,n){r=this._toRenderUnit(r),i=this._toRenderUnit(i);const s=this.renderedWidth,a=this.renderedHeight;n!==0?(n=Le(n,0,Math.floor(a/2)),t.beginPath(),t.moveTo(r,i+n),t.arcTo(r,i,r+n,i,n),t.lineTo(r+s-n,i),t.arcTo(r+s,i,r+s,i+n,n),t.lineTo(r+s,i+a-n),t.arcTo(r+s,i+a,r+s-n,i+a,n),t.lineTo(r+n,i+a),t.arcTo(r,i+a,r,i+a-n,n),t.closePath()):t.rect(r,i,s,a)}_renderHalo(t,r,i,n,s){const a=this.renderedWidth,o=this.renderedHeight,l=hD(Oq,Math.max(a,hT),Math.max(o,hT)),c=l.getContext("2d");c.clearRect(0,0,a,o),this._setFontProperties(c,this.renderedFontSize),c.fillStyle=this._parameters.haloStyle,c.strokeStyle=this._parameters.haloStyle;const u=this.renderedHaloSize<3;c.lineJoin=u?"miter":"round",u?this._renderHaloEmulated(c,n,s):this._renderHaloNative(c,n,s);let h=s+this.baselinePosition;for(let p=0;p<this._lines.length;++p){const m=this._getLineXOffset(p);this._renderLineDecoration(c,n+m,h,this._textWidths[p],!0),h+=this.lineSpacing}t.globalAlpha=this._parameters.definition.halo.color[3],t.drawImage(l,0,0,a,o,this._toRenderUnit(r),this._toRenderUnit(i),a,o),t.globalAlpha=1}_renderHaloEmulated(t,r,i){i+=this.baselinePosition;for(let n=0;n<this._lines.length;++n){const s=this._lines[n],a=this._getLineXOffset(n);for(const[o,l]of HRe)this._fillText(t,s,r+a+this.haloSize*o,i+this.haloSize*l);i+=this.lineSpacing}}_renderHaloNative(t,r,i){const n=2*this.haloSize;i+=this.baselinePosition;for(let s=0;s<this._lines.length;++s){const a=this._lines[s],o=this._getLineXOffset(s),l=5,c=.1;for(let u=0;u<l;u++){const h=1-(l-1)*c+u*c;t.lineWidth=this._toRenderUnit(h*n),this._strokeText(t,a,r+o,i)}i+=this.lineSpacing}}_setFontProperties(t,r){t.font=this._parameters.fontString(r),t.textAlign="left",t.textBaseline="alphabetic"}_ensureTextWidth(){if(_(this._displayWidth))return this._displayWidth;const t=hD(Oq,hT,hT).getContext("2d");this._setFontProperties(t,this.fontSize);let r=2*this.haloSize;const i=this._parameters.definition.font;i.style!=="italic"&&i.style!=="oblique"&&i.weight!=="bold"&&i.weight!=="bolder"||(r+=.3*t.measureText("A").width),this._textWidths.length=0,this._lineWidths.length=0;let n=0;for(const s of this._lines){const a=t.measureText(s).width,o=a+r;this._textWidths.push(a),this._lineWidths.push(o),n=Math.max(n,o)}return this._displayWidth=n,this._displayWidth}_ensureHeightMetrics(){if(R(this._heightMetrics)){const t=hD(Oq,hT,hT).getContext("2d");this._setFontProperties(t,this.fontSize);const r=t.measureText(this.text+T1t),i=this.hasBackground?t.measureText(this._lines[0]):r,n=this._lines.length===1?i:this.hasBackground?t.measureText(this._lines[this._lines.length-1]):r,s=r.actualBoundingBoxAscent+r.actualBoundingBoxDescent;this._heightMetrics={paddingTop:r.actualBoundingBoxAscent-i.actualBoundingBoxAscent,paddingBottom:r.actualBoundingBoxDescent-n.actualBoundingBoxDescent,lineHeight:s,baselinePosition:r.actualBoundingBoxAscent}}return this._heightMetrics}_toRenderUnit(t){return t*this.renderPixelRatio}_toRoundedRenderUnit(t){return Math.round(t*this.renderPixelRatio)}_fillText(t,r,i,n){t.fillText(r,this._toRenderUnit(i),this._toRenderUnit(n))}_strokeText(t,r,i,n){t.strokeText(r,this._toRenderUnit(i),this._toRenderUnit(n))}_drawLine(t,r,i){t.beginPath(),t.moveTo(this._toRoundedRenderUnit(r[0])+.5,this._toRoundedRenderUnit(r[1])+.5),t.lineTo(this._toRoundedRenderUnit(i[0])+.5,this._toRoundedRenderUnit(i[1])+.5),t.stroke()}_drawBox(t,r,i){const n=this._toRenderUnit(r[0]),s=this._toRenderUnit(r[1]),a=this._toRenderUnit(i[0]),o=this._toRenderUnit(i[1]),l=Math.floor(n)+.5,c=Math.ceil(n+a)-.5,u=Math.floor(s)+.5,h=Math.ceil(s+o)-.5;t.beginPath(),t.moveTo(l,u),t.lineTo(c,u),t.lineTo(c,h),t.lineTo(l,h),t.lineTo(l,u),t.stroke()}}const HRe=[];for(let t=0;t<360;t+=360/16)HRe.push([Math.cos(Math.PI*t/180),Math.sin(Math.PI*t/180)]);var Vv;function hD(e,t,r){return e.canvas||(e.canvas=document.createElement("canvas")),e.canvas.width=t,e.canvas.height=r,e.canvas}(function(e){e[e.Left=0]="Left",e[e.Center=1]="Center",e[e.Right=2]="Right"})(Vv||(Vv={}));const Oq={canvas:null},x1t=.2,hT=512,tge="rgb(255, 0, 255, 0.5)",T1t=(()=>{let e="";for(let t=32;t<127;t++)e+=String.fromCharCode(t);return e})(),S1t={left:0,center:.5,right:1},fD={"bottom-left":Nr(0,0),bottom:Nr(.5,0),"bottom-right":Nr(1,0),left:Nr(0,.5),center:Nr(.5,.5),right:Nr(1,.5),"top-left":Nr(0,1),top:Nr(.5,1),"top-right":Nr(1,1)};function WRe(e){switch(e){case"left":return Vv.Left;case"right":return Vv.Right;default:return Vv.Center}}function rge(e){switch(e){case"bottom-left":case"left":case"top-left":return"left";case"bottom":case"center":case"top":return"center";case"bottom-right":case"right":case"top-right":return"right"}}function E1t(e){switch(e){case"bottom-left":case"bottom":case"bottom-right":return"bottom";case"left":case"center":case"right":return"center";case"top-left":case"top":case"top-right":return"top"}}function C1t(e,t){switch(t){case"bottom":return e==="left"?"bottom-left":e==="right"?"bottom-right":"bottom";case"center":return e;case"top":return e==="left"?"top-left":e==="right"?"top-right":"top"}}function A1t(e){return e==="middle"?"center":e}var Ro,ige,yk;function S8(e){return e!=null}function fT(e){return typeof e=="number"}function wU(e){return typeof e=="string"}function R1t(e){return e==null||wU(e)}function _s(e,t){e&&e.push(t)}function O1t(e,t,r,i=Ae()){const n=e||0,s=t||0,a=r||0;return n!==0&&J5(i,i,-n/180*Math.PI),s!==0&&Q5(i,i,s/180*Math.PI),a!==0&&FV(i,i,a/180*Math.PI),i}function xb(e,t,r,i,n){const s=e.minSize,a=e.maxSize;if(e.expression)return _s(n,"Could not convert size info: expression not supported"),!1;if(e.useSymbolValue){const o=i.symbolSize[r];return t.minSize[r]=o,t.maxSize[r]=o,t.offset[r]=t.minSize[r],t.factor[r]=0,t.type[r]=Ro.DefinedSize,!0}if(S8(e.field))return S8(e.stops)?e.stops.length===2&&fT(e.stops[0].size)&&fT(e.stops[1].size)?(nge(e.stops[0].size,e.stops[1].size,e.stops[0].value,e.stops[1].value,t,r),t.type[r]=Ro.DefinedSize,!0):(_s(n,"Could not convert size info: stops only supported with 2 elements"),!1):fT(s)&&fT(a)&&S8(e.minDataValue)&&S8(e.maxDataValue)?(nge(s,a,e.minDataValue,e.maxDataValue,t,r),t.type[r]=Ro.DefinedSize,!0):o9[e.valueUnit]!=null?(t.minSize[r]=-1/0,t.maxSize[r]=1/0,t.offset[r]=0,t.factor[r]=1/o9[e.valueUnit],t.type[r]=Ro.DefinedSize,!0):e.valueUnit==="unknown"?(_s(n,"Could not convert size info: proportional size not supported"),!1):(_s(n,"Could not convert size info: scale-dependent size not supported"),!1);if(!S8(e.field)){if(e.stops&&e.stops[0]&&fT(e.stops[0].size))return t.minSize[r]=e.stops[0].size,t.maxSize[r]=e.stops[0].size,t.offset[r]=t.minSize[r],t.factor[r]=0,t.type[r]=Ro.DefinedSize,!0;if(fT(s))return t.minSize[r]=s,t.maxSize[r]=s,t.offset[r]=s,t.factor[r]=0,t.type[r]=Ro.DefinedSize,!0}return _s(n,"Could not convert size info: unsupported variant of sizeInfo"),!1}function nge(e,t,r,i,n,s){const a=Math.abs(i-r)>0?(t-e)/(i-r):0;n.minSize[s]=a>0?e:t,n.maxSize[s]=a>0?t:e,n.offset[s]=e-r*a,n.factor[s]=a}function M1t(e,t,r,i){if(e.normalizationField||e.valueRepresentation)return _s(i,"Could not convert size info: unsupported property"),null;if(!R1t(e.field))return _s(i,"Could not convert size info: field is not a string"),null;if(t.size){if(e.field)if(t.size.field){if(e.field!==t.size.field)return _s(i,"Could not convert size info: multiple fields in use"),null}else t.size.field=e.field}else t.size={field:e.field,minSize:[0,0,0],maxSize:[0,0,0],offset:[0,0,0],factor:[0,0,0],type:[Ro.Undefined,Ro.Undefined,Ro.Undefined]};let n;switch(e.axis){case"width":return n=xb(e,t.size,0,r,i),n?t:null;case"height":return n=xb(e,t.size,2,r,i),n?t:null;case"depth":return n=xb(e,t.size,1,r,i),n?t:null;case"width-and-depth":return n=xb(e,t.size,0,r,i),n&&xb(e,t.size,1,r,i),n?t:null;case null:case void 0:case"all":return n=xb(e,t.size,0,r,i),n=n&&xb(e,t.size,1,r,i),n=n&&xb(e,t.size,2,r,i),n?t:null;default:return _s(i,`Could not convert size info: unknown axis "${e.axis}""`),null}}function P1t(e,t,r){for(let n=0;n<3;++n){let s=t.unitInMeters;e.type[n]===Ro.DefinedSize&&(s*=t.modelSize[n],e.type[n]=Ro.DefinedScale),e.minSize[n]=e.minSize[n]/s,e.maxSize[n]=e.maxSize[n]/s,e.offset[n]=e.offset[n]/s,e.factor[n]=e.factor[n]/s}let i;if(e.type[0]!==Ro.Undefined)i=0;else if(e.type[1]!==Ro.Undefined)i=1;else{if(e.type[2]===Ro.Undefined)return _s(r,"No size axis contains a valid size or scale"),!1;i=2}for(let n=0;n<3;++n)e.type[n]===Ro.Undefined&&(e.minSize[n]=e.minSize[i],e.maxSize[n]=e.maxSize[i],e.offset[n]=e.offset[i],e.factor[n]=e.factor[i],e.type[n]=e.type[i]);return!0}function sge(e,t,r){e[4*t+0]=r.r/255,e[4*t+1]=r.g/255,e[4*t+2]=r.b/255,e[4*t+3]=r.a}function I1t(e,t,r){if(e.normalizationField)return _s(r,"Could not convert color info: unsupported property"),null;if(wU(e.field)){if(!e.stops)return _s(r,"Could not convert color info: missing stops or colors"),null;{if(e.stops.length>8)return _s(r,"Could not convert color info: too many color stops"),null;t.color={field:e.field,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};const i=e.stops;for(let n=0;n<8;++n){const s=i[Math.min(n,i.length-1)];t.color.values[n]=s.value,sge(t.color.colors,n,s.color)}}}else{if(!(e.stops&&e.stops.length>=0))return _s(r,"Could not convert color info: no field and no colors/stops"),null;{const i=e.stops&&e.stops.length>=0&&e.stops[0].color;t.color={field:null,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};for(let n=0;n<8;n++)t.color.values[n]=1/0,sge(t.color.colors,n,i)}}return t}function $1t(e,t,r){if(e.normalizationField)return _s(r,"Could not convert opacity info: unsupported property"),null;if(wU(e.field)){if(!e.stops)return _s(r,"Could not convert opacity info: missing stops or opacities"),null;{if(e.stops.length>8)return _s(r,"Could not convert opacity info: too many opacity stops"),null;t.opacity={field:e.field,values:[0,0,0,0,0,0,0,0],opacityValues:[0,0,0,0,0,0,0,0]};const i=e.stops;for(let n=0;n<8;++n){const s=i[Math.min(n,i.length-1)];t.opacity.values[n]=s.value,t.opacity.opacityValues[n]=s.opacity}}}else{if(!(e.stops&&e.stops.length>=0))return _s(r,"Could not convert opacity info: no field and no opacities/stops"),null;{const i=e.stops&&e.stops.length>=0&&e.stops[0].opacity;t.opacity={field:null,values:[0,0,0,0,0,0,0,0],opacityValues:[0,0,0,0,0,0,0,0]};for(let n=0;n<8;n++)t.opacity.values[n]=1/0,t.opacity.opacityValues[n]=i}}return t}function Mq(e,t,r){const i=r===2&&e.rotationType==="arithmetic";t.offset[r]=i?90:0,t.factor[r]=i?-1:1,t.type[r]=1}function L1t(e,t,r){if(!wU(e.field))return _s(r,"Could not convert rotation info: field is not a string"),null;if(t.rotation){if(e.field)if(t.rotation.field){if(e.field!==t.rotation.field)return _s(r,"Could not convert rotation info: multiple fields in use"),null}else t.rotation.field=e.field}else t.rotation={field:e.field,offset:[0,0,0],factor:[1,1,1],type:[0,0,0]};switch(e.axis){case"tilt":return Mq(e,t.rotation,0),t;case"roll":return Mq(e,t.rotation,1),t;case null:case void 0:case"heading":return Mq(e,t.rotation,2),t;default:return _s(r,`Could not convert rotation info: unknown axis "${e.axis}""`),null}}function XRe(e,t,r){if(!e)return null;const i=!t.supportedTypes||!!t.supportedTypes.size,n=!t.supportedTypes||!!t.supportedTypes.color,s=!t.supportedTypes||!!t.supportedTypes.rotation,a=!!t.supportedTypes&&!!t.supportedTypes.opacity,o=e.reduce((l,c)=>{if(!l)return l;if(c.valueExpression)return _s(r,"Could not convert visual variables: arcade expressions not supported"),null;switch(c.type){case"size":return i?M1t(c,l,t,r):l;case"color":return n?I1t(c,l,r):l;case"opacity":return a?$1t(c,l,r):null;case"rotation":return s?L1t(c,l,r):l;default:return null}},{size:null,color:null,opacity:null,rotation:null});return!(e.length>0&&o)||o.size||o.color||o.opacity||o.rotation?o&&o.size&&!P1t(o.size,t,r)?null:o:null}function xae(e){return e&&e.size!=null}function mR(e,t){if(!e)return{enabled:!1};if(Yr.TESTS_DISABLE_FAST_UPDATES)return{enabled:!1};const r=XRe(e.visualVariables,t);return r?{enabled:!0,visualVariables:r,materialParameters:YRe(r,t),requiresShaderTransformation:xae(r)}:{enabled:!1}}function gR(e,t,r){if(!t||!e.enabled)return!1;const i=e.visualVariables,n=XRe(t.visualVariables,r);return!!n&&!!(fI(i.size,n.size,"size")&&fI(i.color,n.color,"color")&&fI(i.rotation,n.rotation,"rotation")&&fI(i.opacity,n.opacity,"opacity"))&&(e.visualVariables=n,e.materialParameters=YRe(n,r),e.requiresShaderTransformation=xae(n),!0)}function fI(e,t,r){if(!!e!=!!t||e&&e.field!==t.field)return!1;if(e&&r==="rotation"){const i=e,n=t;for(let s=0;s<3;s++)if(i.type[s]!==n.type[s]||i.offset[s]!==n.offset[s]||i.factor[s]!==n.factor[s])return!1}return!0}function YRe(e,t){const r={vvSizeEnabled:!1,vvSizeMinSize:null,vvSizeMaxSize:null,vvSizeOffset:null,vvSizeFactor:null,vvSizeValue:null,vvColorEnabled:!1,vvColorValues:null,vvColorColors:null,vvOpacityEnabled:!1,vvOpacityValues:null,vvOpacityOpacities:null,vvSymbolAnchor:null,vvSymbolRotationMatrix:null},i=xae(e);return e&&e.size?(r.vvSizeEnabled=!0,r.vvSizeMinSize=e.size.minSize,r.vvSizeMaxSize=e.size.maxSize,r.vvSizeOffset=e.size.offset,r.vvSizeFactor=e.size.factor):e&&i&&(r.vvSizeValue=t.transformation.scale),e&&i&&(r.vvSymbolAnchor=t.transformation.anchor,r.vvSymbolRotationMatrix=Li(),pm(v7),O1t(t.transformation.rotation[2],t.transformation.rotation[0],t.transformation.rotation[1],v7),Jh(r.vvSymbolRotationMatrix,v7)),e&&e.color&&(r.vvColorEnabled=!0,r.vvColorValues=e.color.values,r.vvColorColors=e.color.colors),e&&e.opacity&&(r.vvOpacityEnabled=!0,r.vvOpacityValues=e.opacity.values,r.vvOpacityOpacities=e.opacity.opacityValues),r}(function(e){e[e.Undefined=0]="Undefined",e[e.DefinedSize=1]="DefinedSize",e[e.DefinedScale=2]="DefinedScale"})(Ro||(Ro={})),function(e){e[e.Undefined=0]="Undefined",e[e.DefinedAngle=1]="DefinedAngle"}(ige||(ige={})),function(e){const t=Ae(),r=M();function i(s,a,o){if(!s.vvSizeEnabled)return o;Ln(t,o);const l=s.vvSymbolRotationMatrix;Rm(v7,l[0],l[1],l[2],0,l[3],l[4],l[5],0,l[6],l[7],l[8],0,0,0,0,1),Zi(t,t,v7);for(let c=0;c<3;++c){const u=s.vvSizeOffset[c]+a[0]*s.vvSizeFactor[c];r[c]=Le(u,s.vvSizeMinSize[c],s.vvSizeMaxSize[c])}return DV(t,t,r),wl(t,t,s.vvSymbolAnchor),t}function n(s,a,o){if(!a.vvSizeEnabled)return ne(s,1,1,1);for(let l=0;l<3;++l){const c=a.vvSizeOffset[l]+o[0]*a.vvSizeFactor[l];s[l]=Le(c,a.vvSizeMinSize[l],a.vvSizeMaxSize[l])}return s}e.evaluateModelTransform=i,e.evaluateModelTransformScale=n}(yk||(yk={}));const v7=Ae(),cK=yk.evaluateModelTransform,D1t=yk.evaluateModelTransformScale;class F1t{constructor(){this.visible=!0}}class D9{constructor(t,r,i={}){this.data=t,this.material=r,this.boundingSphere=Jt(),this.instanceParameters=new F1t,this._transformation=Ae(),this._shaderTransformationDirty=!0,this.layerUid=vt(i.layerUid,null),this.graphicUid=vt(i.graphicUid,null),this.id=i.id?i.id:ic(),this.boundingInfo=vt(i.boundingInfo,null),this.calculateShaderTransformation=vt(i.calculateShaderTransformation,null),this.castShadow=!!i.castShadow&&i.castShadow}get transformation(){return this._transformation}updateTransformation(t){t(this._transformation),this._shaderTransformationDirty=!0,this.computeBoundingSphere(this._transformation,this.boundingSphere)}shaderTransformationChanged(){this._shaderTransformationDirty=!0}computeBoundingSphere(t,r,i=Vw(t)){R(this.boundingInfo)||(ze(r,this.boundingInfo.getCenter(),t),r[3]=this.boundingInfo.getBSRadius()*i)}get hasShaderTransformation(){return _(this.calculateShaderTransformation)}get primitiveType(){return this.data.primitiveType}getShaderTransformation(){return R(this.calculateShaderTransformation)?vt(this.transformation,Es):(this._shaderTransformationDirty&&(this._shaderTransformation||(this._shaderTransformation=Ae()),Ln(this._shaderTransformation,this.calculateShaderTransformation(vt(this.transformation,Es))),this._shaderTransformationDirty=!1),this._shaderTransformation)}computeAttachmentOrigin(t){if(this.material.computeAttachmentOrigin)return!!this.material.computeAttachmentOrigin(this,t)&&(_(this._transformation)&&ze(t,t,this._transformation),!0);const r=this.indices.get(O.POSITION),i=this.vertexAttributes.get(O.POSITION);return!!wCe(i,r,t)&&(_(this._transformation)&&ze(t,t,this._transformation),!0)}get indices(){return this.data.indices}get vertexAttributes(){return this.data.vertexAttributes}addHighlight(){const t=new dk(Fy.Highlight),r=this.instanceParameters;return r.highlights=UJ(r.highlights,t),t}removeHighlight(t){const r=this.instanceParameters;r.highlights=BJ(r.highlights,t)}}const N1t=Ae(),age=Ve(0,0,1),k1t=16,V1t=1.5,Z3=tae,z1t=[Z3/2,Z3/2,1-Z3/2,1-Z3/2],U1t=[lR*Z3,lR*Z3];class yR extends Nm{constructor(t,r,i,n){super(t,r,i,n),this._cimLayers=null,this._cimSymbolMaterials=new Map,this._cimSymbolTextures=new Map,this._cimMaterialParametersInfo=null,this._cimRequiredFields=null,this._cimScaleFactorOrFunction=null,this._size=null,this._symbolTextureRatio=1,this._outlineSize=0,this._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!0}}getCachedSize(){return{size:this._getIconSize()}}async doLoad(t){this._validateOrThrow();const r=this._prepareMaterialParameters(),i=this._getPrimitive();if(_(i))this._prepareResourcesPrimitive(r,i);else{const n=h5e(this.symbol,this.symbolLayer),s=hV(n);s&&s.mediaType==="application/json"?await this._prepareResourcesCIM(r,JSON.parse(s.data),t):await this._prepareResourcesHref(r,n,t)}}_validateOrThrow(){if(this._drivenProperties.size)return;const t=iU(this._getIconSize());if(t)throw new k("graphics3diconsymbollayer:invalid-size",t)}_getIconSize(){const t=this.symbolLayer,r=Math.round(t.size!=null?ur(t.size):k1t);return this._drivenProperties.size?Math.max(r,64):r}_generateTextureCIM(t){const r=this._getGraphicHash(t);let i=r===""?null:this._cimSymbolTextures.get(r);if(!i){const n={scaleFactor:this._cimScaleFactorOrFunction},s=this._context.sharedResources.cimSymbolRasterizer.rasterizeCIMSymbol(this._cimLayers,t,"esriGeometryPoint",n,null,null);this._cimMaterialParametersInfo.anchorPosition=this._getAnchorPos("relative",s.anchorPosition);const a={width:s.imageData.width,height:s.imageData.height,powerOfTwoResizeMode:Dv.PAD};i=new Hn(s.imageData,a),this._cimSymbolTextures.set(r,i),this._context.stage.add(i)}return i}_computeSize(t,r){const i=t.width/t.height;return i>1?[r,Math.round(r/i)]:[Math.round(r*i),r]}_prepareMaterialParameters(){const t={anchorPosition:this._getAnchorPos(this.symbolLayer.anchor,this.symbolLayer.anchorPosition)},r=this.symbol;if(B1t(r)){const{screenLength:i,minWorldLength:n,maxWorldLength:s}=r.verticalOffset;t.verticalOffset={screenLength:ur(i),minWorldLength:n||0,maxWorldLength:s!=null?s:1/0}}return this._context.screenSizePerspectiveEnabled&&(t.screenSizePerspective=this._context.sharedResources.screenSizePerspectiveSettings),t.occlusionTest=!0,t.hasSlicePlane=this._context.slicePlaneEnabled,t}_prepareResourcesPrimitive(t,r){const i=this._getOutlineSize();if(Pq(r)&&i===0)throw new Error("Nothing to render");this._outlineSize=i,t.color=this._getFillColor(),t.outlineColor=this._getOutlineColor(),t.outlineSize=this._outlineSize;const n=this._context.sharedResources.textures.fromData(r,()=>iAe(r));this._texture=n.texture,this._releaseTexture=n,t.textureIsSignedDistanceField=!0,t.distanceFieldBoundingBox=z1t,t.textureId=this._texture.id;const s=this._getIconSize();this._size=[s,s],this._symbolTextureRatio=1/Z3,this._createMaterialAndAddToStage(t,this._context.stage)}async _prepareResourcesHref(t,r,i){if(!ue("esri-canvas-svg-support")&&qte(r))throw new k("graphics3diconsymbollayer:unsupported-image-format","IconSymbol3DLayer failed to load (SVG symbols are not supported in IE11)");this._outlineSize=this._getOutlineSize(),t.color=this._getFillColor(),t.outlineColor=this._getOutlineColor(),t.outlineSize=this._outlineSize,t.textureIsSignedDistanceField=!1;const n=this._getIconSize(),s=n*this._context.graphicsCoreOwner.view.state.pixelRatio,a=await Tu(this._context.sharedResources.textures.fromUrl(r,s,{signal:i}));if(a.ok===!1)throw pu(a.error),new k("graphics3diconsymbollayer:request-failed",`Failed to load (Request for icon resource failed: ${r})`);this._releaseTexture=a.value;const o=a.value.texture,l=o.params;this._size=this._computeSize(l,n),t.textureId=o.id,this._createMaterialAndAddToStage(t,this._context.stage)}async _prepareResourcesCIM(t,r,i){const n=new e6({data:r});if(!this._context.sharedResources.cimSymbolRasterizer){const u=(await ie(()=>import("./CIMSymbolRasterizer.f963c8a7.js"),["CIMSymbolRasterizer.f963c8a7.js","cimAnalyzer.370e7d9c.js","CIMSymbolHelper.7933df34.js","BidiEngine.210f7ff8.js","enums.4de5fe56.js","number.6e30c64a.js"],import.meta.url)).CIMSymbolRasterizer;Et(i),this._context.sharedResources.cimSymbolRasterizer||(this._context.sharedResources.cimSymbolRasterizer=new u(this._context.renderCoordsHelper.spatialReference,!0))}const s=this._context.layer.fields?this._context.layer.fields.map(u=>u.toJSON()):null;let a,o;if(this._cimLayers=await this._context.sharedResources.cimSymbolRasterizer.analyzeCIMSymbol(n,s,this._context.renderer&&this._context.renderer.type==="dictionary"?this._context.renderer.fieldMap:null,"esriGeometryPoint",{signal:i}),this._context.renderer&&this._context.renderer.type==="dictionary"&&this._context.renderer.scaleExpression){const u=this._context.renderer;if(isNaN(u.scaleExpression)){const h=u.scaleExpression,p=await pUe(h,this._context.layer.spatialReference,s);o=(m,g,b)=>{const w=y1t(p,m,{$view:b},"esriGeometryPoint",g);return w!==null?w:1}}else a=Number(u.scaleExpression)}this._cimScaleFactorOrFunction=a||o||1;const l=this._context.renderer?await this._context.renderer.getRequiredFields(this._context.layer.fieldsIndex):[];Et(i);const c=this._context.layer.fieldsIndex;this._cimRequiredFields=l.map(u=>c.get(u).name),this._cimMaterialParametersInfo=t,this._cimMaterialParametersInfo.color=this._getFillColor(),this._cimMaterialParametersInfo.outlineColor=[0,0,0,0],this._cimMaterialParametersInfo.outlineSize=0,this._cimMaterialParametersInfo.textureIsSignedDistanceField=!1}_getPrimitive(){return this.symbolLayer.resource&&this.symbolLayer.resource.href?null:this.symbolLayer.resource&&this.symbolLayer.resource.primitive||zxe}_getOutlineSize(){let t=0;const r=this.symbolLayer;return _(r.outline)&&r.outline.size!=null?Math.max(ur(r.outline.size),0):(t=Pq(this._getPrimitive())?V1t:0,Math.max(t,0))}_getOutlineColor(){const t=this._getLayerOpacity(),r=this.symbolLayer,i=Vi(r,"outline","color");if(_(i)){const n=Te.toUnitRGB(i),s=i.a*t;return[n[0],n[1],n[2],s]}return[0,0,0,0]}_getFillColor(){if(Pq(this._getPrimitive()))return _1t;const t=R(this._getPrimitive()),r=Vi(this.symbolLayer,"material","color");return this._getCombinedOpacityAndColor(r,{hasIntrinsicColor:t})}_getAnchorPos(t,r){return t==="relative"?Nr((r.x||0)+.5,.5-(r.y||0)):t in fD?fD[t]:fD.center}_createMaterialAndAddToStage(t,r){if(this._cimLayers?this._fastUpdates={enabled:!1}:this._fastUpdates=mR(this._context.renderer,this._fastVisualVariableConvertOptions()),this._fastUpdates.enabled&&Object.assign(t,this._fastUpdates.materialParameters),this._cimLayers){let i=_(t.textureId)?this._cimSymbolMaterials.get(t.textureId):null;return i||(i=new O9(t),this._cimSymbolMaterials.set(vt(t.textureId,0),i),r.add(i)),i}return this._material=new O9(t),r.add(this._material),this._material}_setDrapingDependentMaterialParameters(){this.draped&&(this._forEachMaterial(t=>{t.setParameters({verticalOffset:null,screenSizePerspective:null,occlusionTest:!1,hasSlicePlane:!1,shaderPolygonOffset:0,isDraped:this.draped})}),this.layerOpacityChanged())}destroy(){super.destroy(),this._forEachMaterial(t=>this._context.stage.remove(t)),this._material=null,this._cimSymbolMaterials.clear(),this._cimSymbolTextures.forEach(t=>this._context.stage.remove(t)),this._cimSymbolTextures.clear(),this._releaseTexture=ri(this._releaseTexture)}_getScaleFactor(t,r){if(this._drivenProperties.size&&t.size){for(let i=0;i<3;i++){const n=t.size[i];n&&n!=="symbol-value"&&n!=="proportional"&&(t.size[i]=ur(n))}if(t.size[0]==="symbol-value")return 1;if(isFinite(+t.size[0]))return+t.size[0]/r;if(isFinite(+t.size[2]))return+t.size[2]/r}return 1}createGraphics3DGraphic(t){const r=t.graphic;if(!this._validateGeometry(r.geometry))return null;let i,n;if(this._cimLayers){if(!this._cimLayers.length)return null;const h=this._generateTextureCIM(r),p={textureId:h.id,...this._cimMaterialParametersInfo};n=this._createMaterialAndAddToStage(p,this._context.stage),i=[h.params.width,h.params.height]}else i=this._size,n=this._material;const s=uR(r.geometry);if(R(s))return this.logger.warn(`unsupported geometry type for icon symbol: ${r.geometry.type}`),null;const a=t.renderingInfo,o=this._getVertexOpacityAndColor(a);let l=1;if(!this._fastUpdates.enabled||!this._fastUpdates.visualVariables.size){const h=i[0]>i[1]?i[0]:i[1];l=this._getScaleFactor(a,h)}l*=this._symbolTextureRatio;const c=[i[0]*l,i[1]*l],u=this.setGraphicElevationContext(r,new Du);return this.ensureDrapedStatus(u.mode==="on-the-ground")&&this._setDrapingDependentMaterialParameters(),this.draped?this._createAsOverlay(r,s,n,o,c,t.layer.uid):this._createAs3DShape(r,s,n,o,c,u,r.uid)}layerOpacityChanged(){const t=this._getFillColor(),r=this._getOutlineColor();return this._forEachMaterial(i=>{i.setParameters({color:t}),i.setParameters({outlineColor:r})}),!0}layerElevationInfoChanged(t,r,i){const n=this._elevationContext.mode,s=OO(yR.elevationModeChangeTypes,i,n);if(s!==nn.UPDATE)return s;const a=rf(n)||n==="absolute-height";return this.updateGraphics3DGraphicElevationInfo(t,r,()=>a)}slicePlaneEnabledChanged(){return this.draped||this._forEachMaterial(t=>{t.setParameters({hasSlicePlane:this._context.slicePlaneEnabled})}),!0}physicalBasedRenderingChanged(){return!0}pixelRatioChanged(){return!!this._getPrimitive()}applyRendererDiff(t,r){for(const i in t.diff){if(i!=="visualVariables"||!gR(this._fastUpdates,r,this._fastVisualVariableConvertOptions()))return xs.Recreate_Symbol;_(this._material)&&this._material.setParameters(this._fastUpdates.materialParameters)}return xs.Fast_Update}_defaultElevationInfoNoZ(){return G1t}_createAs3DShape(t,r,i,n,s,a,o){const l=this.getFastUpdateAttrValues(t),c=l?m=>cK(this._fastUpdates.materialParameters,l,m):null,u=[Uc.createPointGeometry(age,null,n,s,j1t,null,l)],h=fae(this._context,r,u,[i],a,this._context.layer.uid,o,c);if(h===null)return null;const p=new Fm(this,h.object,u,null,null,cR,a);return p.alignedSampledElevation=h.sampledElevation,p.needsElevationUpdates=rf(a.mode)||a.mode==="absolute-height",p.getScreenSize=this._createScreenSizeGetter(s,c),p.calculateRelativeScreenBounds=m=>i.calculateRelativeScreenBounds(p.getScreenSize(),1,m),dR(p,r,this._context.elevationProvider),p}_createAsOverlay(t,r,i,n,s,a){i.renderPriority=this._renderPriority;const o=Jt();oa(r,o,this._context.overlaySR),o[2]=_ae;const l=this._context.clippingExtent;if(_(l)&&!Lre(l,o))return null;const c=this.getFastUpdateAttrValues(t),u=c?g=>cK(this._fastUpdates.materialParameters,c,g):null,h=Uc.createPointGeometry(age,o,n,s,null,null,c),p=new D9(h,i,{layerUid:a,graphicUid:t.uid,calculateShaderTransformation:u});o[3]=0,hp(p.boundingSphere,o);const m=new _U(this,[p],null,this._context.drapeSourceRenderer);return m.getScreenSize=this._createScreenSizeGetter(s,u),m.calculateRelativeScreenBounds=g=>i.calculateRelativeScreenBounds(m.getScreenSize(),1,g),m}_createScreenSizeGetter(t,r){const i=this._outlineSize+2;if(this._fastUpdates.enabled){const n=t[0]/this._symbolTextureRatio,s=t[1]/this._symbolTextureRatio;return(a=it())=>{const o=r(N1t);return a[0]=o[0]*n+i,a[1]=o[5]*s+i,a}}{const n=t[0]/this._symbolTextureRatio+i,s=t[1]/this._symbolTextureRatio+i;return(a=it())=>(a[0]=n,a[1]=s,a)}}_fastVisualVariableConvertOptions(){const t=this._size[0]>this._size[1]?this._size[0]:this._size[1],r=Ve(t,t,t),i=zs(1),n=t*i;return{modelSize:r,symbolSize:Ve(n,n,n),unitInMeters:i,transformation:{anchor:gl,scale:X0,rotation:gl}}}_getGraphicHash(t){let r="";for(const i of this._cimRequiredFields)r+=i+t.attributes[i];return r}_forEachMaterial(t){_(this._material)&&t(this._material),this._cimSymbolMaterials.forEach(t)}test(){return{...super.test(),material:this._material}}}function B1t(e){return e&&e.type==="point-3d"&&e.hasVisibleVerticalOffset()}function Pq(e){return!R(e)&&(e==="cross"||e==="x")}yR.PRIMITIVE_SIZE=U1t,yR.elevationModeChangeTypes={definedChanged:nn.UPDATE,staysOnTheGround:nn.NONE,onTheGroundChanged:nn.RECREATE};const G1t={mode:"relative-to-ground",offset:0},j1t=Tr(0,0,0,1);function dK(e){const t=[],r=[];W1t(e,r,t);const i=r[0][1].data,n=t[0][1].length,s=new Uint16Array(n);return X1t(e,r,t),Y1t(e,r,t,s),Q1t(e,r,t,s),Z1t(e,r,t,s),J1t(e,r,t,s),K1t(e,r,t,s),evt(e,r,t,i),new Gi(r,t,lc.Line)}function q1t(e,t,r,i){const n=e.type==="polygon"?wm.CCW_IS_HOLE:wm.NONE,s=e.type==="polygon"?e.rings:e.paths,{position:a,outlines:o}=IO(s,e.hasZ,n),l=new Float64Array(a.length),c=LAe(a,e.spatialReference,0,l,0,a,0,a.length/3,t,r,i),u=c!=null;return{lines:u?ZRe(o,a,l):[],projectionSuccess:u,sampledElevation:c}}function ZRe(e,t,r){const i=new Array;for(const{index:n,count:s}of e){if(s<=1)continue;const a=3*n,o=a+3*s;i.push({position:t.subarray(a,o),mapPosition:r?r.subarray(a,o):void 0})}return i}function H1t(e,t){const r=e.type==="polygon"?wm.CCW_IS_HOLE:wm.NONE,i=e.type==="polygon"?e.rings:e.paths,{position:n,outlines:s}=IO(i,!1,r),a=mi(n,e.spatialReference,0,n,t,0,n.length/3);for(let o=2;o<n.length;o+=3)n[o]=_ae;return{lines:a?ZRe(s,n):[],projectionSuccess:a}}function W1t(e,t,r){const{attributeData:{position:i},removeDuplicateStartEnd:n}=e,s=tvt(i)&&n===cx.REMOVE,a=i.length/3-(s?1:0),o=new Uint32Array(2*(a-1)),l=s?wte(i,0,i.length-3):i;let c=0;for(let u=0;u<a-1;u++)o[c++]=u,o[c++]=u+1;t.push([O.POSITION,{size:3,data:l,exclusive:s}]),r.push([O.POSITION,o])}function X1t(e,t,r){const i=e.attributeData.mapPosition;R(i)||(r.push([O.MAPPOS,r[0][1]]),t.push([O.MAPPOS,{size:3,data:i}]))}function Y1t(e,t,r,i){if(_(e.attributeData.colorFeature))return;const n=e.attributeData.color;t.push([O.COLOR,{size:4,data:vt(n,w1t)}]),r.push([O.COLOR,i])}function Z1t(e,t,r,i){const n=e.attributeData.colorFeature;R(n)||(t.push([O.COLORFEATUREATTRIBUTE,{size:1,data:new Float32Array([n])}]),r.push([O.COLOR,i]))}function Q1t(e,t,r,i){if(_(e.attributeData.sizeFeature))return;const n=e.attributeData.size;t.push([O.SIZE,{size:1,data:[vt(n,1)]}]),r.push([O.SIZE,i])}function J1t(e,t,r,i){const n=e.attributeData.sizeFeature;R(n)||(t.push([O.SIZEFEATUREATTRIBUTE,{size:1,data:new Float32Array([n])}]),r.push([O.SIZEFEATUREATTRIBUTE,i]))}function K1t(e,t,r,i){const n=e.attributeData.opacityFeature;R(n)||(t.push([O.OPACITYFEATUREATTRIBUTE,{size:1,data:new Float32Array([n])}]),r.push([O.OPACITYFEATUREATTRIBUTE,i]))}function evt(e,t,r,i){if(R(e.overlayInfo)||e.overlayInfo.renderCoordsHelper.viewingMode!==Be.Global||!e.overlayInfo.spatialReference.isGeographic)return;const n=new Float64Array(i.length),s=Ar(e.overlayInfo.spatialReference);for(let p=0;p<n.length;p+=3)Yre(i,p,n,p,s);const a=i.length/3,o=new Float32Array(a+1);let l=rvt,c=ivt,u=0,h=0;ne(l,n[h++],n[h++],n[h++]),o[0]=0;for(let p=1;p<a+1;++p)p===a&&(h=0),ne(c,n[h++],n[h++],n[h++]),u+=TEe(l,c),o[p]=u,[l,c]=[c,l];t.push([O.DISTANCETOSTART,{size:1,data:o}]),r.push([O.DISTANCETOSTART,r[0][1]])}function tvt(e){const t=e.length;return e[0]===e[t-3]&&e[1]===e[t-2]&&e[2]===e[t-1]}var cx;(function(e){e[e.KEEP=0]="KEEP",e[e.REMOVE=1]="REMOVE"})(cx||(cx={}));const rvt=M(),ivt=M();function uK(e){switch(e){case"butt":return Bh.BUTT;case"square":return Bh.SQUARE;case"round":return Bh.ROUND;default:return null}}const bk=64,QRe=bk/2,JRe=QRe/5;function nvt(e,t){return _(t)?svt(e,avt(t.style)):null}function svt(e,t){return e.fromData(t,()=>iAe(t,bk,QRe,JRe))}function avt(e){return e==="diamond"?"kite":e}function ovt(e){const t=new Qr,r=e.hasMultipassTerrain&&(e.output===K.Color||e.output===K.Alpha);t.include(iRe,e),e.output===K.Depth&&t.include(x_,e);const{vertex:i,fragment:n}=t;return n.include(bd),_u(t,e),t.attributes.add(O.POSITION,"vec3"),t.attributes.add(O.UV0,"vec2"),t.attributes.add(O.AUXPOS1,"vec3"),t.varyings.add("vColor","vec4"),t.varyings.add("vpos","vec3"),t.varyings.add("vUV","vec2"),t.varyings.add("vSize","float"),t.varyings.add("linearDepth","float"),r&&t.varyings.add("depth","float"),i.code.add(S`#define PERPENDICULAR(v) vec2(v.y, -v.x)
float interp(float ncp, vec4 a, vec4 b) {
return (-ncp - a.z) / (b.z - a.z);
}`),i.uniforms.add([new _r("nearFar",(s,a)=>a.camera.nearFar),new cr("viewport",(s,a)=>a.camera.fullViewport)]),i.code.add(S`vec4 projectAndScale(vec4 pos) {
vec4 posNdc = proj * pos;
posNdc.xy *= viewport.zw / posNdc.w;
return posNdc;
}`),i.code.add(S`void clip(vec4 pos, inout vec4 prev) {
float vnp = nearFar[0] * 0.99;
if (prev.z > -nearFar[0]) {
prev = mix(pos, prev, interp(vnp, pos, prev));
}
}`),e.draped||(i.uniforms.add(new Ei("inverseProjectionMatrix",(s,a)=>a.camera.inverseProjectionMatrix)),i.code.add(S`vec3 inverseProject(vec4 posScreen) {
posScreen.xy = (posScreen.xy / viewport.zw) * posScreen.w;
return (inverseProjectionMatrix * posScreen).xyz;
}`),i.code.add(S`bool rayIntersectPlane(vec3 rayDir, vec3 planeOrigin, vec3 planeNormal, out vec3 intersection) {
float cos = dot(rayDir, planeNormal);
float t = dot(planeOrigin, planeNormal) / cos;
intersection = t * rayDir;
return abs(cos) > 0.001 && t > 0.0;
}`),i.uniforms.add(new He("perScreenPixelRatio",(s,a)=>a.camera.perScreenPixelRatio)),i.code.add(S`
      vec4 toFront(vec4 displacedPosScreen, vec3 posLeft, vec3 posRight, vec3 prev, float lineWidth) {
        // Project displaced position back to camera space
        vec3 displacedPos = inverseProject(displacedPosScreen);

        // Calculate the plane that we want the marker to lie in. Note that this will always be an approximation since ribbon lines are generally
        // not planar and we do not know the actual position of the displaced prev vertices (they are offset in screen space, too).
        vec3 planeNormal = normalize(cross(posLeft - posRight, posLeft - prev));
        vec3 planeOrigin = posLeft;

        ${e.hasCap?`
                if(prev.z > posLeft.z) {
                  vec2 diff = posLeft.xy - posRight.xy;
                  planeOrigin.xy += PERPENDICULAR(diff) / 2.0;
                }
              `:""};

        // Move the plane towards the camera by a margin dependent on the line width (approximated in world space). This tolerance corrects for the
        // non-planarity in most cases, but sharp joins can place the prev vertices at arbitrary positions so markers can still clip.
        float offset = lineWidth * perScreenPixelRatio;
        planeOrigin *= (1.0 - offset);

        // Intersect camera ray with the plane and make sure it is within clip space
        vec3 rayDir = normalize(displacedPos);
        vec3 intersection;
        if (rayIntersectPlane(rayDir, planeOrigin, planeNormal, intersection) && intersection.z < -nearFar[0] && intersection.z > -nearFar[1]) {
          return vec4(intersection.xyz, 1.0);
        }

        // Fallback: use depth of pos or prev, whichever is closer to the camera
        float minDepth = planeOrigin.z > prev.z ? length(planeOrigin) : length(prev);
        displacedPos *= minDepth / length(displacedPos);
        return vec4(displacedPos.xyz, 1.0);
      }
  `)),i.uniforms.add(new He("pixelRatio",(s,a)=>a.camera.pixelRatio)),i.code.add(S`
    void main(void) {
      float coverage = 1.0;

      // Check for special value of uv0.y which is used by the Renderer when graphics
      // are removed before the VBO is recompacted. If this is the case, then we just
      // project outside of clip space.
      if (uv0.y == 0.0) {
        // Project out of clip space
        gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
      }
      else {
        float lineSize = getSize();
        float lineWidth = max(lineSize, 1.0) * pixelRatio;

        vec4 pos  = view * vec4(position.xyz, 1.0);
        vec4 prev = view * vec4(auxpos1.xyz, 1.0);
        clip(pos, prev);

        vec4 posScreen = projectAndScale(pos);
        vec4 prevScreen = projectAndScale(prev);

        vec2 segment = posScreen.xy - prevScreen.xy;

        // normalize vector along line segment
        float segmentLen = length(segment);
        segment = (segmentLen > 0.001) ? segment / segmentLen : vec2(0.0, 0.0);

        // displace according to position in the texture
        vec2 displacementDirU = PERPENDICULAR(segment);
        vec2 displacementDirV = segment;

        float displacementLen = ${S.float(bk/JRe)} * lineWidth;

        vec4 displacedPosScreen = posScreen;
        displacedPosScreen.xy += uv0.x * displacementDirU * displacementLen + uv0.y * displacementDirV * displacementLen;
  `),e.draped||i.code.add(S`vec3 posRight = inverseProject(posScreen + vec4(displacementDirU.xy, 0.0, 0.0) * lineWidth);
vec3 posLeft = pos.xyz + (pos.xyz - posRight);
pos = toFront(displacedPosScreen, posLeft, posRight, prev.xyz, lineWidth);
displacedPosScreen = projectAndScale(pos);`),i.code.add(S`
        ${r?"depth = pos.z;":""}
        linearDepth = (-pos.z - nearFar[0]) / (nearFar[1] - nearFar[0]);

        // Convert back into NDC
        displacedPosScreen.xy = (displacedPosScreen.xy / viewport.zw) * displacedPosScreen.w;

        // Convert texture coordinate into [0,1] and cancel out perspective correct interpolation
        vUV = (uv0 + 1.0) / 2.0;
        vUV *= displacedPosScreen.w;

        vSize = displacementLen;

        vColor = getColor();
        vColor.a *= coverage;

        // Use camera space for slicing
        vpos = pos.xyz;

        gl_Position = displacedPosScreen;
      }
    }
  `),r&&t.include(Mu,e),t.include(Cn,e),n.uniforms.add([new cr("intrinsicColor",s=>s.color),new Wt("tex",s=>s.texture)]),n.include($m),n.code.add(S`
  void main() {
    discardBySlice(vpos);
    ${r?"terrainDepthTest(gl_FragCoord, depth);":""}

    vec4 finalColor = intrinsicColor * vColor;

    // Offset texture coordinate s.t. we sample texel centers
    float texelSize = ${S.float(1/bk)};
    vec2 samplePos = vUV * gl_FragCoord.w + vec2(0.5, -0.5) * texelSize;

    // Evaluate sdf
    float sdf = rgba2float(texture2D(tex, samplePos)) - 0.5;
    float distance = sdf * vSize;

    // Grow by a halfpixel to make sure the line is fully covered by the cross marker
    // (otherwise there will be a halo if they are different colours)
    distance -= 0.5;

    finalColor.a *= clamp(0.5 - distance, 0.0, 1.0);

    if (finalColor.a < ${S.float(ao)}) {
      discard;
    }

    ${e.output===K.Alpha?S`gl_FragColor = vec4(finalColor.a);`:""}
    ${e.output===K.Color?S`gl_FragColor = highlightSlice(finalColor, vpos);`:""}
    ${e.output===K.Color&&e.transparencyPassType===yt.Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}
    ${e.output===K.Highlight?S`gl_FragColor = vec4(1.0);`:""}
    ${e.output===K.Depth?S`outputDepth(linearDepth);`:""}
  }
  `),t}const lvt=Object.freeze(Object.defineProperty({__proto__:null,build:ovt},Symbol.toStringTag,{value:"Module"})),KRe=new Map([[O.POSITION,0],[O.UV0,2],[O.AUXPOS1,3],[O.SIZE,6],[O.SIZEFEATUREATTRIBUTE,6],[O.COLOR,5],[O.COLORFEATUREATTRIBUTE,5],[O.OPACITYFEATUREATTRIBUTE,7]]);class xU extends gi{initializeProgram(t){const r=xU.shader.get().build(this.configuration);return new ai(t.rctx,r,KRe)}_makePipelineState(t,r){const i=this.configuration,n=t===yt.NONE;return jt({blending:i.output===K.Color||i.output===K.Alpha?n?wu:eb(t):null,depthTest:{func:w_(t)},depthWrite:n?i.writeDepth&&fc:Kz(t),colorWrite:or,stencilWrite:i.hasOccludees?xm:null,stencilTest:i.hasOccludees?r?d_:T_:null,polygonOffset:{factor:0,units:-10}})}initializePipeline(){return this.configuration.occluder&&(this._occluderPipelineTransparent=jt({blending:wu,depthTest:fk,depthWrite:null,colorWrite:or,stencilWrite:null,stencilTest:oRe}),this._occluderPipelineOpaque=jt({blending:wu,depthTest:fk,depthWrite:null,colorWrite:or,stencilWrite:sRe,stencilTest:aRe}),this._occluderPipelineMaskWrite=jt({blending:null,depthTest:gae,depthWrite:null,colorWrite:null,stencilWrite:xm,stencilTest:d_})),this._occludeePipelineState=this._makePipelineState(this.configuration.transparencyPassType,!0),this._makePipelineState(this.configuration.transparencyPassType,!1)}getPipelineState(t,r){return r?this._occludeePipelineState:this.configuration.occluder?t===Ee.TRANSPARENT_OCCLUDER_MATERIAL?this._occluderPipelineTransparent:t===Ee.OCCLUDER_MATERIAL?this._occluderPipelineOpaque:this._occluderPipelineMaskWrite:super.getPipelineState(t,r)}}xU.shader=new si(lvt,()=>ie(()=>import("./LineMarker.glsl.555ce51a.js"),[],import.meta.url));class Ko extends Mo{constructor(){super(...arguments),this.output=K.Color,this.transparencyPassType=yt.NONE,this.occluder=!1,this.hasSlicePlane=!1,this.writeDepth=!1,this.draped=!1,this.hasCap=!1,this.vvSize=!1,this.vvColor=!1,this.vvOpacity=!1,this.hasOccludees=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1}}d([H({count:K.COUNT})],Ko.prototype,"output",void 0),d([H({count:yt.COUNT})],Ko.prototype,"transparencyPassType",void 0),d([H()],Ko.prototype,"occluder",void 0),d([H()],Ko.prototype,"hasSlicePlane",void 0),d([H()],Ko.prototype,"writeDepth",void 0),d([H()],Ko.prototype,"draped",void 0),d([H()],Ko.prototype,"hasCap",void 0),d([H()],Ko.prototype,"vvSize",void 0),d([H()],Ko.prototype,"vvColor",void 0),d([H()],Ko.prototype,"vvOpacity",void 0),d([H()],Ko.prototype,"hasOccludees",void 0),d([H()],Ko.prototype,"hasMultipassTerrain",void 0),d([H()],Ko.prototype,"cullAboveGround",void 0),d([H({constValue:!0})],Ko.prototype,"hasVvInstancing",void 0),d([H({constValue:!0})],Ko.prototype,"hasSliceTranslatedView",void 0);class cvt extends Dm{constructor(t){super(t,new uvt),this._vertexAttributeLocations=KRe,this.techniqueConfig=new Ko,this.layout=this.createLayout()}dispose(){}getConfiguration(t,r){return this.techniqueConfig.output=t,this.techniqueConfig.draped=r.slot===Ee.DRAPED_MATERIAL,this.techniqueConfig.hasCap=this.parameters.cap!==Bh.BUTT,this.techniqueConfig.hasSlicePlane=this.parameters.hasSlicePlane,this.techniqueConfig.hasOccludees=this.parameters.hasOccludees,this.techniqueConfig.writeDepth=this.parameters.writeDepth,this.techniqueConfig.vvColor=this.parameters.vvColorEnabled,this.techniqueConfig.vvOpacity=this.parameters.vvOpacityEnabled,this.techniqueConfig.vvSize=this.parameters.vvSizeEnabled,this.techniqueConfig.occluder=this.parameters.renderOccluded===ki.OccludeAndTransparentStencil,this.techniqueConfig.transparencyPassType=r.transparencyPassType,this.techniqueConfig.hasMultipassTerrain=r.multipassTerrain.enabled,this.techniqueConfig.cullAboveGround=r.multipassTerrain.cullAboveGround,this.techniqueConfig}intersect(){}createLayout(){const t=gn().vec3f(O.POSITION).vec2f(O.UV0).vec3f(O.AUXPOS1);return this.parameters.vvSizeEnabled?t.f32(O.SIZEFEATUREATTRIBUTE):t.f32(O.SIZE),this.parameters.vvColorEnabled?t.f32(O.COLORFEATUREATTRIBUTE):t.vec4f(O.COLOR),this.parameters.vvOpacityEnabled&&t.f32(O.OPACITYFEATUREATTRIBUTE),t}createBufferWriter(){return new hvt(this.layout,this.parameters)}requiresSlot(t,r){if(t===Ee.DRAPED_MATERIAL)return!0;if(this.parameters.renderOccluded===ki.OccludeAndTransparentStencil)return t===Ee.OPAQUE_MATERIAL||t===Ee.OCCLUDER_MATERIAL||t===Ee.TRANSPARENT_OCCLUDER_MATERIAL;const i=sx(r);return i===K.Color||i===K.Alpha?t===(this.parameters.writeDepth?Ee.TRANSPARENT_MATERIAL:Ee.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL):t===Ee.OPAQUE_MATERIAL}createGLMaterial(t){return t.output===K.Color||t.output===K.Alpha||t.output===K.Highlight||t.output===K.Depth?new dvt(t):null}}class dvt extends ose{_updateParameters(t){return this.updateTexture(this._material.parameters.textureId),this._material.setParameters(this.textureBindParameters),this.ensureTechnique(xU,t)}_updateOccludeeState(t){t.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:t.hasOccludees})}beginSlot(t){return this._output!==K.Color&&this._output!==K.Alpha||this._updateOccludeeState(t),this._updateParameters(t)}}class uvt extends rae{constructor(){super(...arguments),this.width=0,this.color=[1,1,1,1],this.placement="end",this.cap=Bh.BUTT,this.writeDepth=!0,this.hasSlicePlane=!1,this.vvFastUpdate=!1,this.hasOccludees=!1}}class hvt{constructor(t,r){this.vertexBufferLayout=t,this.parameters=r}allocate(t){return this.vertexBufferLayout.createBuffer(t)}elementCount(){return this.parameters.placement==="begin-end"?12:6}write(t,r,i,n){const s=r.vertexAttributes.get(O.POSITION).data,a=s.length/3;let o=1,l=0;this.parameters.vvSizeEnabled?l=r.vertexAttributes.get(O.SIZEFEATUREATTRIBUTE).data[0]:r.vertexAttributes.has(O.SIZE)&&(o=r.vertexAttributes.get(O.SIZE).data[0]);let c=[1,1,1,1],u=0;this.parameters.vvColorEnabled?u=r.vertexAttributes.get(O.COLORFEATUREATTRIBUTE).data[0]:r.vertexAttributes.has(O.COLOR)&&(c=r.vertexAttributes.get(O.COLOR).data);let h=0;this.parameters.vvOpacityEnabled&&(h=r.vertexAttributes.get(O.OPACITYFEATUREATTRIBUTE).data[0]);const p=t.transformation,m=new Float32Array(i.buffer);let g=n*(this.vertexBufferLayout.stride/4);const b=(T,E,C,A)=>{if(m[g++]=T[0],m[g++]=T[1],m[g++]=T[2],m[g++]=C[0],m[g++]=C[1],m[g++]=E[0],m[g++]=E[1],m[g++]=E[2],this.parameters.vvSizeEnabled?m[g++]=l:m[g++]=o,this.parameters.vvColorEnabled)m[g++]=u;else{const P=Math.min(4*A,c.length-4);m[g++]=c[P+0],m[g++]=c[P+1],m[g++]=c[P+2],m[g++]=c[P+3]}this.parameters.vvOpacityEnabled&&(m[g++]=h)};let w;(function(T){T[T.ASCENDING=1]="ASCENDING",T[T.DESCENDING=-1]="DESCENDING"})(w||(w={}));const v=(T,E)=>{const C=ne(fvt,s[3*T],s[3*T+1],s[3*T+2]),A=pvt;let P=T+E;do ne(A,s[3*P],s[3*P+1],s[3*P+2]),P+=E;while(Lw(C,A)&&P>=0&&P<a);p&&(ze(C,C,p),ze(A,A,p)),b(C,A,[-1,-1],T),b(C,A,[1,-1],T),b(C,A,[1,1],T),b(C,A,[-1,-1],T),b(C,A,[1,1],T),b(C,A,[-1,1],T)},x=this.parameters.placement;x!=="begin"&&x!=="begin-end"||v(0,w.ASCENDING),x!=="end"&&x!=="begin-end"||v(a-1,w.DESCENDING)}}const fvt=M(),pvt=M(),vo={dash:[4,3],dot:[1,3],"long-dash":[8,3],"short-dash":[4,1],"short-dot":[1,1]},mvt={dash:vo.dash,"dash-dot":[...vo.dash,...vo.dot],dot:vo.dot,"long-dash":vo["long-dash"],"long-dash-dot":[...vo["long-dash"],...vo.dot],"long-dash-dot-dot":[...vo["long-dash"],...vo.dot,...vo.dot],none:null,"short-dash":vo["short-dash"],"short-dash-dot":[...vo["short-dash"],...vo["short-dot"]],"short-dash-dot-dot":[...vo["short-dash"],...vo["short-dot"],...vo["short-dot"]],"short-dot":vo["short-dot"],solid:null},gvt=8;function yvt(e,t=2){return R(e)?e:{pattern:e.slice(),pixelRatio:t}}function qLt(e,t=2){return{pattern:[e,e],pixelRatio:t}}function eOe(e){return _(e)&&e.type==="style"?bvt(e.style):null}function bvt(e){return _(e)?yvt(mvt[e],gvt):null}const vvt=["polyline","polygon","extent"];class TU extends Nm{constructor(t,r,i,n){super(t,r,i,n),this._uniformSize=1}async doLoad(){if(this._vvConvertOptions={modelSize:[1,1,1],symbolSize:[1,1,1],unitInMeters:1,transformation:{anchor:[0,0,0],scale:[1,1,1],rotation:[0,0,0]},supportedTypes:{size:!0,color:!0,opacity:!0,rotation:!1}},this._context.renderer&&this._context.renderer.visualVariables&&this._context.renderer.visualVariables.length>0?this._fastUpdates=mR(this._context.renderer,this._vvConvertOptions):this._fastUpdates={enabled:!1},!this._drivenProperties.size){const t=this.symbolLayer.size!=null?this.symbolLayer.size:zs(1);if(t<0)throw new k("graphics3dlinesymbollayer:invalid-size","Symbol sizes may not be negative values");this._uniformSize=t}this._markerTexture=nvt(this._context.sharedResources.textures,this.symbolLayer.marker)}_getMaterialParameters(t,r=!1){var s;const i=this._getCombinedOpacityAndColor(r&&this._markerColor||this._materialColor);this._patternHidesLine&&!r&&(i[3]=0);const n={width:this._computeMaterialWidth((s=this.symbolLayer)==null?void 0:s.size),color:i,hasPolygonOffset:!0,join:this.symbolLayer.join||"miter",cap:uK(this.symbolLayer.cap||"butt"),hasSlicePlane:this._context.slicePlaneEnabled,isClosed:t,stipplePattern:eOe(this.symbolLayer.pattern),stippleScaleWithLineWidth:!0};return this._fastUpdates&&this._fastUpdates.visualVariables?{...n,...this._fastUpdates.materialParameters}:n}get _materialColor(){return ys(this.symbolLayer.material,t=>t.color)}get _markerColor(){return ys(this.symbolLayer.marker,t=>t.color)}get lineMaterial(){return R(this._lineMaterial)&&(this._lineMaterial=new R4(this._getMaterialParameters(!1)),this._context.stage.add(this._lineMaterial)),this._lineMaterial}get ringMaterial(){return R(this._ringMaterial)&&(this._ringMaterial=new R4(this._getMaterialParameters(!0)),this._context.stage.add(this._ringMaterial)),this._ringMaterial}get wireframeLineMaterial(){return R(this._wireframeLineMaterial)&&(this._wireframeLineMaterial=new R4({...this._getMaterialParameters(!1),wireframe:!0}),this._context.stage.add(this._wireframeLineMaterial)),this._wireframeLineMaterial}get wireframeRingMaterial(){return R(this._wireframeRingMaterial)&&(this._wireframeRingMaterial=new R4({...this._getMaterialParameters(!0),wireframe:!0}),this._context.stage.add(this._wireframeRingMaterial)),this._wireframeRingMaterial}get markerMaterial(){return R(this._markerMaterial)&&_(this.symbolLayer.marker)&&_(this._markerTexture)&&(this._markerMaterial=new cvt({...this._getMaterialParameters(!1,!0),placement:this.symbolLayer.marker.placement,textureId:this._markerTexture.texture.id}),this._context.stage.add(this._markerMaterial)),this._markerMaterial}destroy(){super.destroy(),this._forEachMaterial(t=>this._context.stage.remove(t)),this._lineMaterial=null,this._ringMaterial=null,this._wireframeLineMaterial=null,this._wireframeRingMaterial=null,this._markerMaterial=null,this._markerTexture=ri(this._markerTexture)}_getDrivenSize(t){return this._drivenProperties.size&&t.size?ur(pyt(t.size)):1}_getSizeFeatureAttributeData(t){return this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size?my(this._fastUpdates.visualVariables.size.field,t):null}_getDrivenColor(t){const r=Tr(1,1,1,1);return this._drivenProperties.color&&t.color&&(r[0]=t.color[0],r[1]=t.color[1],r[2]=t.color[2],t.color.length>0&&(r[3]=t.color[3])),this._drivenProperties.opacity&&t.opacity&&(r[3]=t.opacity),r}_getColorFeatureAttributeData(t){return this._fastUpdates.enabled&&this._fastUpdates.visualVariables.color?my(this._fastUpdates.visualVariables.color.field,t):null}_getOpacityFeatureAttributeData(t){return this._fastUpdates.enabled&&this._fastUpdates.visualVariables.opacity?my(this._fastUpdates.visualVariables.opacity.field,t):null}createGraphics3DGraphic(t){const r=t.graphic;if(!this._validateGeometry(r.geometry,vvt,this.symbolLayer.type))return null;const i=this.setGraphicElevationContext(r,new Du);return this.ensureDrapedStatus(i.mode==="on-the-ground"),this.draped?this._createAsOverlay(t,this._context.layer.uid):this._createAs3DShape(t,i,r.uid)}applyRendererDiff(t,r){for(const i in t.diff){if(i!=="visualVariables"||!gR(this._fastUpdates,r,this._vvConvertOptions))return xs.Recreate_Symbol;this._forEachMaterial(n=>n.setParameters(this._fastUpdates.materialParameters))}return xs.Fast_Update}prepareSymbolLayerPatch(t){var s,a;if(t.diff.type!=="partial")return;const r=t.diff.diff,i={};((s=r.size)==null?void 0:s.type)==="complete"&&(i.width=this._computeMaterialWidth(r.size.newValue),delete r.size),((a=r.cap)==null?void 0:a.type)==="complete"&&(i.cap=uK(vt(r.cap.newValue,"butt")),delete r.cap);const n=this._prepareMarkerPatch(t,r);this._prepareMaterialPatch(t,r,n),t.symbolLayerStatePatches.push(()=>this._forEachMaterial(o=>o.setParameters(i)))}layerOpacityChanged(){return this._forEachMaterial((t,r)=>this._updateMaterialLayerOpacity(t,r)),!0}_forEachMaterial(t){_(this._lineMaterial)&&t(this._lineMaterial),_(this._ringMaterial)&&t(this._ringMaterial),_(this._wireframeLineMaterial)&&t(this._wireframeLineMaterial),_(this._wireframeRingMaterial)&&t(this._wireframeRingMaterial),_(this._markerMaterial)&&t(this._markerMaterial,!0)}_updateMaterialLayerOpacity(t,r=!1){const i=t.parameters.color,n=Vi(this.symbolLayer,"material","color"),s=this._patternHidesLine&&!r?0:this._getCombinedOpacity(n),a=Tr(i[0],i[1],i[2],s);t.setParameters({color:a})}layerElevationInfoChanged(t,r,i){const n=this._elevationContext.mode,s=OO(TU.elevationModeChangeTypes,i,n);if(s!==nn.UPDATE)return s;const a=rf(n);return this.updateGraphics3DGraphicElevationInfo(t,r,()=>a)}slicePlaneEnabledChanged(){const t={hasSlicePlane:this._context.slicePlaneEnabled};return this._forEachMaterial(r=>r.setParameters(t)),!0}physicalBasedRenderingChanged(){return!0}pixelRatioChanged(){return!0}_getGeometryAsPolygonOrPolyline(t){switch(t.type){case"extent":if(t instanceof Zt)return $o.fromExtent(t);break;case"polygon":case"polyline":return t}return null}_createAs3DShape(t,r,i){const n=t.graphic,s=this._getGeometryAsPolygonOrPolyline(n.geometry),a=s.type==="polygon"?s.rings:s.paths,o=new Array,l=new Array,c=new Array,u=is(),h=q1t(s,this._context.elevationProvider,this._context.renderCoordsHelper,r),p=s.type==="polygon"?"rings":"paths";this._logGeometryCreationWarnings(h,a,p,"LineSymbol3DLayer");for(let b=0;b<h.lines.length;b++){const{position:w,mapPosition:v}=h.lines[b];if(_(this._context.clippingExtent)&&(bi(u),hu(u,v),!pp(u,this._context.clippingExtent)))continue;const x=this._createGeometry(t,w,v,s.type,_7.ELEVATED);o.push(x),l.push(s.type==="polygon"?this.ringMaterial:this.lineMaterial),c.push(Es),Yr.LINE_WIREFRAMES&&(o.push(x.cloneShallow()),l.push(s.type==="polygon"?this.wireframeRingMaterial:this.wireframeLineMaterial),c.push(Es));const T=this.markerMaterial;_(T)&&(o.push(x.cloneShallow()),l.push(T),c.push(Es))}if(o.length===0)return null;const m=new rb({geometries:o,materials:l,transformations:c,castShadow:!1,metadata:{layerUid:this._context.layer.uid,graphicUid:i}}),g=new Fm(this,m,o,null,null,Rgt,r);return g.alignedSampledElevation=h.sampledElevation,g.needsElevationUpdates=rf(r.mode),g}_createGeometry(t,r,i,n,s){const a=n==="polygon"?cx.REMOVE:cx.KEEP,o=this._fastUpdates.enabled&&this._fastUpdates.visualVariables.color,l=this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size;return dK({overlayInfo:s===_7.DRAPED?{spatialReference:this._context.overlaySR,renderCoordsHelper:this._context.renderCoordsHelper}:null,removeDuplicateStartEnd:a,uniformSize:this._uniformSize,attributeData:{position:r,mapPosition:i,size:l?null:this._getDrivenSize(t.renderingInfo),color:o?null:this._getDrivenColor(t.renderingInfo),sizeFeature:this._getSizeFeatureAttributeData(t.graphic),colorFeature:this._getColorFeatureAttributeData(t.graphic),opacityFeature:this._getOpacityFeatureAttributeData(t.graphic)}})}_createAsOverlay(t,r){const i=t.graphic,n=this._getGeometryAsPolygonOrPolyline(i.geometry),s=n.type==="polygon"?n.rings:n.paths,a=n.type==="polygon"?this.ringMaterial:this.lineMaterial;a.renderPriority=this._renderPriority;const o=Yr.LINE_WIREFRAMES?n.type==="polygon"?this.wireframeRingMaterial:this.wireframeLineMaterial:null,l=this.markerMaterial;_(o)&&(o.renderPriority=this._renderPriority-.001),_(l)&&(l.renderPriority=this._renderPriority-.002);const c=new Array,u=is(),h=bi(),p=H1t(n,this._context.overlaySR),m=n.type==="polygon"?"rings":"paths";this._logGeometryCreationWarnings(p,s,m,"LineSymbol3DLayer");for(const g of p.lines){if(bi(u),hu(u,g.position),!pp(u,this._context.clippingExtent))continue;H5(h,u);const b=this._createGeometry(t,g.position,null,n.type,_7.DRAPED),w=x=>{const T=new D9(b,x,{layerUid:r,graphicUid:i.uid});return c.push(T),T};if(_(l)){const x=w(l),T=this.symbolLayer.marker.placement;T!=="begin"&&T!=="begin-end"||hu(u,g.position,0,1),T!=="end"&&T!=="begin-end"||hu(u,g.position,g.position.length-3,1),this._updateBoundingSphere(x,u)}const v=w(a);if(this._updateBoundingSphere(v,u),Yr.LINE_WIREFRAMES){const x=w(o);this._updateBoundingSphere(x,u)}}return new _U(this,c,h,this._context.drapeSourceRenderer)}_updateBoundingSphere(t,r){ei(t.boundingSphere,.5*(r[0]+r[3]),.5*(r[1]+r[4]),0,.5*Math.sqrt((r[3]-r[0])*(r[3]-r[0])+(r[4]-r[1])*(r[4]-r[1])))}get _patternHidesLine(){const t=this.symbolLayer.pattern;return _(t)&&t.type==="style"&&t.style==="none"}_computeMaterialWidth(t){return t=vt(t,zs(1)),this._drivenProperties.size?this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size?ur(1):1:ur(t)}_prepareMaterialPatch(t,r,i){const n=r.material;if(R(n))return void(i.changed&&i.useMaterialColor&&this._patchMaterialColor(this._getCombinedOpacityAndColor(this._materialColor),this._markerMaterial,t));if(n.type==="collection")return;const s=n.type==="complete"?ys(n.newValue,o=>o.color):n.diff.color.type==="complete"?n.diff.color.newValue:null,a=this._getCombinedOpacityAndColor(s);i.useMaterialColor&&this._patchMaterialColor(BV(a),this._markerMaterial,t),this._patternHidesLine&&(a[3]=0),this._patchMaterialColor(a,this._lineMaterial,t),delete r.material}_prepareMarkerPatch(t,r){const i=r.marker;if(R(i)||i.type!=="partial"||_(i.diff.style)||_(i.diff.placement)||_(i.diff.color)&&i.diff.color.type!=="complete")return{changed:!1,useMaterialColor:R(this._markerColor)};const n=i.diff.color;if(R(n))return delete r.marker,{changed:!1,useMaterialColor:R(this._markerColor)};const s=n.newValue;return R(s)?(delete r.marker,{changed:!0,useMaterialColor:!0}):(this._patchMaterialColor(this._getCombinedOpacityAndColor(s),this._markerMaterial,t),delete r.marker,{changed:!0,useMaterialColor:!1})}_patchMaterialColor(t,r,i){R(r)||i.symbolLayerStatePatches.push(()=>r.setParameters({color:t}))}}var _7;TU.elevationModeChangeTypes={definedChanged:nn.RECREATE,staysOnTheGround:nn.NONE,onTheGroundChanged:nn.RECREATE},function(e){e[e.DRAPED=0]="DRAPED",e[e.ELEVATED=1]="ELEVATED"}(_7||(_7={}));const oge=2048,_vt=1.5,wvt=8;function xvt(e,t){const{format:r,quality:i,rotation:n,disableDecorations:s}=e||{},a=Tae(e,t.padding),o=$vt(e,{width:t.width-a.left-a.right,height:t.height-a.top-a.bottom}),{width:l,height:c}=Ivt(e,o),u=Fvt(r),h=Uvt[u];return{format:u,quality:Le(i!=null?i:h,0,100),area:o,width:l,height:c,rotation:n,disableDecorations:!!s,ignoreBackground:!(!e||!e.ignoreBackground),ignorePadding:!(!e||!e.ignorePadding)}}function Tvt(e,t){const r=xvt(e,t),i=r.area,n=r.width/i.width,s=Tae(r,t.padding),a=s.left+s.right,o=s.top+s.bottom,l=t.width-a,c=t.height-o,u=Math.floor(l*n+a),h=Math.floor(c*n+o),p=e&&e.layers?e.layers:[],m=r.ignoreBackground,g=r.ignorePadding;return{framebufferWidth:u,framebufferHeight:h,region:{x:Math.floor(i.x*n)+s.left,y:Math.floor(i.y*n)+s.top,width:r.width,height:r.height},format:r.format,quality:r.quality,rotation:r.rotation,pixelRatio:n,layers:p,disableDecorations:r.disableDecorations,ignoreBackground:m,ignorePadding:g}}function Svt(e,t,r){const{ctx:i,canvas:n}=tOe(e,r),s=i.getImageData(0,0,e.width,e.height),a=Avt(n,t);return rOe(n),{dataUrl:a,data:s}}function Evt(e,t){const{ctx:r,canvas:i}=tOe(e,t),n=r.getImageData(0,0,e.width,e.height);return rOe(i),n}function tOe(e,t){const r=Cvt();t.premultipliedAlpha&&kvt(e),r.width=e.width,r.height=e.height;const i=r.getContext("2d");return i.putImageData(e,0,0),t.flipY&&Nvt(i),{ctx:i,canvas:r}}function rOe(e){e.width=0,e.height=0}function Cvt(){return R(Iq)&&(Iq=document.createElement("canvas")),Iq}let Iq=null;function Avt(e,t){const r=Vvt[t.format],i=t.quality/100;return e.toDataURL(r,i)}function $q(e,t,r){if(!e||!t)throw new Error("Cannot construct image data without dimensions");if(vk)try{return new ImageData(e,t)}catch{vk=!1}return iOe(e,t,r)}function Rvt(e,t,r,i){if(!t||!r)throw new Error("Cannot construct image data without dimensions");if(vk)try{return new ImageData(e,t,r)}catch{vk=!1}const n=iOe(t,r,i);return n.data.set(e,0),n}function Ovt(e,t,r,i=0,n=0,s=e.width-i,a=e.height-n,o=!1){const{data:l}=e,{width:c,height:u,data:h}=t,p=s/c,m=a/u,g=Math.ceil(p/2),b=Math.ceil(m/2),w=e.width;for(let v=0;v<u;v++)for(let x=0;x<c;x++){const T=4*(x+(o?u-v-1:v)*c);let E=0,C=0,A=0,P=0,I=0,L=0;const V=(v+.5)*m;for(let G=Math.floor(v*m);G<(v+1)*m;G++){const B=Math.abs(V-(G+.5))/b,X=(x+.5)*p,Y=B*B;for(let ce=Math.floor(x*p);ce<(x+1)*p;ce++){const se=Math.abs(X-(ce+.5))/g,D=Math.sqrt(Y+se*se);if(D>=1)continue;let F=2*D*D*D-3*D*D+1;const U=4*(i+ce+(n+G)*w);L+=F*l[U+3],C+=F,!r&&l[U+3]<255&&(F=F*l[U+3]/255),A+=F*l[U],P+=F*l[U+1],I+=F*l[U+2],E+=F}}h[T]=A/E,h[T+1]=P/E,h[T+2]=I/E,h[T+3]=L/C}return t}function Mvt(e,t,r){if(!t)return e;const{framebufferWidth:i,framebufferHeight:n,pixelRatio:s,region:a}=e,o=Tae(e,r),l=o.left+o.right,c=o.top+o.bottom,u=i-l,h=n-c,p=Math.min(wvt,Math.min((oge-l)/u,(oge-c)/h));return p<_vt?e:{...e,framebufferWidth:Math.round(u*p)+l,framebufferHeight:Math.round(h*p)+c,pixelRatio:s*p,resample:{region:{x:Math.round((a.x-o.left)*p)+o.left,y:Math.round((a.y-o.top)*p)+o.top,width:Math.round(a.width*p),height:Math.round(a.height*p)},width:i,height:n}}}function iOe(e,t,r){return r||(r=Pvt()),r.getContext("2d").createImageData(e,t)}let E8=null,vk=!0;function Pvt(){return E8||(E8=document.createElement("canvas"),E8.width=1,E8.height=1),E8}function Ivt(e,t){if(!e)return t;const r=e.width,i=e.height;if(r!=null&&i!=null)return{width:Math.floor(r),height:Math.floor(i)};if(r==null&&i==null)return t;const n=t.width/t.height;return i==null?{width:Math.floor(r),height:Math.floor(r/n)}:{width:Math.floor(i*n),height:Math.floor(i)}}function $vt(e,t){const r={x:0,y:0,width:t.width,height:t.height};if(e&&e.area){e.area.x!=null&&(r.x=Math.floor(e.area.x)),e.area.y!=null&&(r.y=Math.floor(e.area.y));const i=e.area.width!=null?Math.floor(e.area.width):null,n=e.area.height!=null?Math.floor(e.area.height):null;if(r.width=t.width-r.x,r.height=t.height-r.y,i!=null&&n!=null)r.width=Math.min(r.width,i),r.height=Math.min(r.height,n);else if(i==null&&n!=null){const s=Math.min(r.width,i);r.height=s/r.width*r.height,r.width=s}else if(i!=null&&n==null){const s=Math.min(r.height,n);r.width=s/r.height*r.width,r.height=s}}return Lvt(Dvt(r,e),t)}function Lvt(e,t){const r=Math.floor(Math.max(e.x,0)),i=Math.floor(Math.max(e.y,0)),n={x:r,y:i,width:Math.floor(Math.min(e.width,t.width-r)),height:Math.floor(Math.min(e.height,t.height-i))},s=n.width/n.height,a=e.width/e.height;if(a===s)return n;if(a>s){const c=Math.floor(n.width/a),u=n.height-c;return{x:n.x,y:Math.floor(n.y+u/2),width:n.width,height:c}}const o=Math.floor(n.height*a),l=n.width-o;return{x:Math.floor(n.x+l/2),y:n.y,width:o,height:n.height}}function Dvt(e,t){if(!t||t.width==null||t.height==null)return e;const r=t.width/t.height,i=e.width/e.height;if(i===r)return e;if(i<r){const s=Math.floor(e.height*r);return e.x-=(s-e.width)/2,e.width=s,e}const n=Math.floor(e.width/r);return e.y-=(n-e.height)/2,e.height=n,e}function Tae(e,t){return!t||e&&e.ignorePadding?Bvt:t}function Fvt(e){switch(e){case"png":case"jpg":case"jpeg":return e;default:return zvt}}function Nvt(e){e.save(),e.globalCompositeOperation="copy",e.scale(1,-1),e.translate(0,-e.canvas.height),e.drawImage(e.canvas,0,0),e.restore()}function kvt(e){const t=e.data,r=t.length;for(let i=0;i<r;i+=4){const n=t[i+3];if(n!==255&&n>0){const s=255/n;t[i+0]=t[i+0]*s,t[i+1]=t[i+1]*s,t[i+2]=t[i+2]*s}}}const Vvt={png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg"},lge=98,zvt="png",Uvt={png:100,jpg:lge,jpeg:lge},Bvt={top:0,right:0,bottom:0,left:0};var IS;const Lq=new WeakMap;let Gvt=0,T0=IS=class extends ge{constructor(e){super(e),this.wrap="repeat"}get url(){return this._get("url")||null}set url(e){this._set("url",e),e&&this._set("data",null)}get data(){return this._get("data")||null}set data(e){this._set("data",e),e&&this._set("url",null)}writeData(e,t,r,i){if(e instanceof HTMLImageElement){const n={type:"image-element",src:Py(e.src,i),crossOrigin:e.crossOrigin};t[r]=n}else if(e instanceof HTMLCanvasElement){const n=e.getContext("2d").getImageData(0,0,e.width,e.height),s={type:"canvas-element",imageData:this._encodeImageData(n)};t[r]=s}else if(e instanceof HTMLVideoElement){const n={type:"video-element",src:Py(e.src,i),autoplay:e.autoplay,loop:e.loop,muted:e.muted,crossOrigin:e.crossOrigin,preload:e.preload};t[r]=n}else{const n={type:"image-data",imageData:this._encodeImageData(e)};t[r]=n}}readData(e){switch(e.type){case"image-element":{const t=new Image;return t.src=e.src,t.crossOrigin=e.crossOrigin,t}case"canvas-element":{const t=this._decodeImageData(e.imageData),r=document.createElement("canvas");return r.width=t.width,r.height=t.height,r.getContext("2d").putImageData(t,0,0),r}case"image-data":return this._decodeImageData(e.imageData);case"video-element":{const t=document.createElement("video");return t.src=e.src,t.crossOrigin=e.crossOrigin,t.autoplay=e.autoplay,t.loop=e.loop,t.muted=e.muted,t.preload=e.preload,t}default:return}}get transparent(){const e=this.data,t=this.url;if(e instanceof HTMLCanvasElement)return this._imageDataContainsTransparent(e.getContext("2d").getImageData(0,0,e.width,e.height));if(e instanceof ImageData)return this._imageDataContainsTransparent(e);if(t){const r=t.substr(t.length-4,4).toLowerCase(),i=t.substr(0,15).toLocaleLowerCase();if(r===".png"||i==="data:image/png;")return!0}return!1}set transparent(e){e!=null?this._override("transparent",e):this._clearOverride("transparent")}get contentHash(){const e=typeof this.wrap=="string"?this.wrap:typeof this.wrap=="object"?`${this.wrap.horizontal}/${this.wrap.vertical}`:"",t=(r="")=>`d:${r},t:${this.transparent},w:${e}`;return this.url!=null?t(this.url):this.data!=null?this.data instanceof HTMLImageElement||this.data instanceof HTMLVideoElement?t(this.data.src):(Lq.has(this.data)||Lq.set(this.data,++Gvt),t(Lq.get(this.data))):t()}clone(){const e={url:this.url,data:this.data,wrap:this._cloneWrap()};return new IS(e)}cloneWithDeduplication(e){const t=e.get(this);if(t)return t;const r=this.clone();return e.set(this,r),r}_cloneWrap(){return typeof this.wrap=="string"?this.wrap:{horizontal:this.wrap.horizontal,vertical:this.wrap.vertical}}_encodeImageData(e){let t="";for(let r=0;r<e.data.length;r++)t+=String.fromCharCode(e.data[r]);return{data:btoa(t),width:e.width,height:e.height}}_decodeImageData(e){const t=atob(e.data),r=new Uint8ClampedArray(t.length);for(let i=0;i<t.length;i++)r[i]=t.charCodeAt(i);return Rvt(r,e.width,e.height)}_imageDataContainsTransparent(e){for(let t=3;t<e.data.length;t+=4)if(e.data[t]!==255)return!0;return!1}static from(e){return typeof e=="string"?new IS({url:e}):e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof ImageData||e instanceof HTMLVideoElement?new IS({data:e}):M5(IS,e)}};d([f({type:String,json:{write:Xv}})],T0.prototype,"url",null),d([f({json:{write:{overridePolicy(){return{enabled:!this.url}}}}}),f()],T0.prototype,"data",null),d([Xe("data")],T0.prototype,"writeData",null),d([$e("data")],T0.prototype,"readData",null),d([f({type:Boolean,json:{write:{overridePolicy(){return{enabled:this._isOverridden("transparent")}}}}})],T0.prototype,"transparent",null),d([f({json:{write:!0}})],T0.prototype,"wrap",void 0),d([f({readOnly:!0})],T0.prototype,"contentHash",null),T0=IS=d([$("esri.geometry.support.MeshTexture")],T0);const w7=T0;var hK;let bg=hK=class extends ge{constructor(e){super(e),this.color=null,this.colorTexture=null,this.normalTexture=null,this.alphaMode="auto",this.alphaCutoff=.5,this.doubleSided=!0}clone(){return this.cloneWithDeduplication(null,new Map)}cloneWithDeduplication(e,t){const r=_(e)?e.get(this):null;if(r)return r;const i=new hK(this.clonePropertiesWithDeduplication(t));return _(e)&&e.set(this,i),i}clonePropertiesWithDeduplication(e){return{color:_(this.color)?this.color.clone():null,colorTexture:_(this.colorTexture)?this.colorTexture.cloneWithDeduplication(e):null,normalTexture:_(this.normalTexture)?this.normalTexture.cloneWithDeduplication(e):null,alphaMode:this.alphaMode,alphaCutoff:this.alphaCutoff,doubleSided:this.doubleSided}}};d([f({type:Te,json:{write:!0}})],bg.prototype,"color",void 0),d([f({type:w7,json:{write:!0}})],bg.prototype,"colorTexture",void 0),d([f({type:w7,json:{write:!0}})],bg.prototype,"normalTexture",void 0),d([f({nonNullable:!0,json:{write:!0}})],bg.prototype,"alphaMode",void 0),d([f({nonNullable:!0,json:{write:!0}})],bg.prototype,"alphaCutoff",void 0),d([f({nonNullable:!0,json:{write:!0}})],bg.prototype,"doubleSided",void 0),bg=hK=d([$("esri.geometry.support.MeshMaterial")],bg);const Sae=bg;var fK;let vg=fK=class extends Sae{constructor(e){super(e),this.emissiveColor=null,this.emissiveTexture=null,this.occlusionTexture=null,this.metallic=1,this.roughness=1,this.metallicRoughnessTexture=null}clone(){return this.cloneWithDeduplication(null,new Map)}cloneWithDeduplication(e,t){const r=_(e)?e.get(this):null;if(r)return r;const i=new fK(this.clonePropertiesWithDeduplication(t));return _(e)&&e.set(this,i),i}clonePropertiesWithDeduplication(e){return{...super.clonePropertiesWithDeduplication(e),emissiveColor:_(this.emissiveColor)?this.emissiveColor.clone():null,emissiveTexture:_(this.emissiveTexture)?this.emissiveTexture.cloneWithDeduplication(e):null,occlusionTexture:_(this.occlusionTexture)?this.occlusionTexture.cloneWithDeduplication(e):null,metallic:this.metallic,roughness:this.roughness,metallicRoughnessTexture:_(this.metallicRoughnessTexture)?this.metallicRoughnessTexture.cloneWithDeduplication(e):null}}};d([f({type:Te,json:{write:!0}})],vg.prototype,"emissiveColor",void 0),d([f({type:w7,json:{write:!0}})],vg.prototype,"emissiveTexture",void 0),d([f({type:w7,json:{write:!0}})],vg.prototype,"occlusionTexture",void 0),d([f({type:Number,nonNullable:!0,json:{write:!0},range:{min:0,max:1}})],vg.prototype,"metallic",void 0),d([f({type:Number,nonNullable:!0,json:{write:!0},range:{min:0,max:1}})],vg.prototype,"roughness",void 0),d([f({type:w7,json:{write:!0}})],vg.prototype,"metallicRoughnessTexture",void 0),vg=fK=d([$("esri.geometry.support.MeshMaterialMetallicRoughness")],vg);const nOe=vg;var pD;const pT=fe.getLogger("esri.geometry.support.MeshVertexAttributes");let Gu=pD=class extends ge{constructor(e){super(e),this.color=null,this.position=new Float64Array(0),this.uv=null,this.normal=null,this.tangent=null}castColor(e){return $S(e,Uint8Array,[Uint8ClampedArray],{loggerTag:".color=",stride:4},pT)}castPosition(e){return e&&e instanceof Float32Array&&pT.warn(".position=","Setting position attribute from a Float32Array may cause precision problems. Consider storing data in a Float64Array or a regular number array"),$S(e,Float64Array,[Float32Array],{loggerTag:".position=",stride:3},pT)}castUv(e){return $S(e,Float32Array,[Float64Array],{loggerTag:".uv=",stride:2},pT)}castNormal(e){return $S(e,Float32Array,[Float64Array],{loggerTag:".normal=",stride:3},pT)}castTangent(e){return $S(e,Float32Array,[Float64Array],{loggerTag:".tangent=",stride:4},pT)}clone(){const e={position:te(this.position),uv:te(this.uv),normal:te(this.normal),tangent:te(this.tangent),color:te(this.color)};return new pD(e)}clonePositional(){const e={position:te(this.position),normal:te(this.normal),tangent:te(this.tangent),uv:this.uv,color:this.color};return new pD(e)}};function Dq(e,t,r,i){const{loggerTag:n,stride:s}=t;return e.length%s!=0?(i.error(n,`Invalid array length, expected a multiple of ${s}`),new r([])):e}function $S(e,t,r,i,n){if(!e)return e;if(e instanceof t)return Dq(e,i,t,n);for(const s of r)if(e instanceof s)return Dq(new t(e),i,t,n);if(Array.isArray(e))return Dq(new t(e),i,t,n);{const s=r.map(a=>`'${a.name}'`);return n.error(`Failed to set property, expected one of ${s}, but got ${e.constructor.name}`),new t([])}}function C8(e,t,r){t[r]=jvt(e)}function jvt(e){const t=new Array(e.length);for(let r=0;r<e.length;r++)t[r]=e[r];return t}d([f({json:{write:C8}})],Gu.prototype,"color",void 0),d([Xt("color")],Gu.prototype,"castColor",null),d([f({nonNullable:!0,json:{write:C8}})],Gu.prototype,"position",void 0),d([Xt("position")],Gu.prototype,"castPosition",null),d([f({json:{write:C8}})],Gu.prototype,"uv",void 0),d([Xt("uv")],Gu.prototype,"castUv",null),d([f({json:{write:C8}})],Gu.prototype,"normal",void 0),d([Xt("normal")],Gu.prototype,"castNormal",null),d([f({json:{write:C8}})],Gu.prototype,"tangent",void 0),d([Xt("tangent")],Gu.prototype,"castTangent",null),Gu=pD=d([$("esri.geometry.support.MeshVertexAttributes")],Gu);var oC;const qvt=fe.getLogger("esri.geometry.support.MeshComponent");let _g=oC=class extends ge{constructor(e){super(e),this.faces=null,this.material=null,this.shading="source",this.trustSourceNormals=!1}static from(e){return M5(oC,e)}castFaces(e){return $S(e,Uint32Array,[Uint16Array],{loggerTag:".faces=",stride:3},qvt)}castMaterial(e){return M5(e&&typeof e=="object"&&("metallic"in e||"roughness"in e||"metallicRoughnessTexture"in e)?nOe:Sae,e)}clone(){return new oC({faces:te(this.faces),shading:this.shading,material:te(this.material),trustSourceNormals:this.trustSourceNormals})}cloneWithDeduplication(e,t){const r={faces:te(this.faces),shading:this.shading,material:this.material?this.material.cloneWithDeduplication(e,t):null,trustSourceNormals:this.trustSourceNormals};return new oC(r)}};d([f({json:{write:!0}})],_g.prototype,"faces",void 0),d([Xt("faces")],_g.prototype,"castFaces",null),d([f({type:Sae,json:{write:!0}})],_g.prototype,"material",void 0),d([Xt("material")],_g.prototype,"castMaterial",null),d([f({type:String,json:{write:!0}})],_g.prototype,"shading",void 0),d([f({type:Boolean})],_g.prototype,"trustSourceNormals",void 0),_g=oC=d([$("esri.geometry.support.MeshComponent")],_g);const Hvt=_g,SU=fe.getLogger("esri.geometry.support.meshUtils.normalProjection");function Wvt(e,t,r,i,n){return CU(i)?(EU(gy.TO_PCPF,Zr.fromTypedArray(e),Nn.fromTypedArray(t),Nn.fromTypedArray(r),i,Zr.fromTypedArray(n)),n):(SU.error("Cannot convert spatial reference to PCPF"),n)}function HLt(e,t,r,i,n){return CU(i)?(EU(gy.FROM_PCPF,Zr.fromTypedArray(e),Nn.fromTypedArray(t),Nn.fromTypedArray(r),i,Zr.fromTypedArray(n)),n):(SU.error("Cannot convert to spatial reference from PCPF"),n)}function WLt(e,t,r){return mi(e,t,0,r,fm(t),0,e.length/3),r}function XLt(e,t,r){return mi(e,fm(r),0,t,r,0,e.length/3),t}function Xvt(e,t,r){if(R(e))return t;const i=Nn.fromTypedArray(e),n=Nn.fromTypedArray(t);return PO(n,i,r),t}function Yvt(e,t,r){if(R(e))return t;g9(Qs,r);const i=Zr.fromTypedArray(e),n=Zr.fromTypedArray(t);return c_(n,i,Qs),mse(Qs)||pae(n,n),t}function Zvt(e,t,r){if(R(e))return t;g9(Qs,r);const i=Zr.fromTypedArray(e,4*Float32Array.BYTES_PER_ELEMENT),n=Zr.fromTypedArray(t,4*Float32Array.BYTES_PER_ELEMENT);if(c_(n,i,Qs),mse(Qs)||pae(n,n),e!==t)for(let s=3;s<e.length;s+=4)t[s]=e[s];return t}function Qvt(e,t,r,i,n){if(!CU(i))return SU.error("Cannot convert spatial reference to PCPF"),n;EU(gy.TO_PCPF,Zr.fromTypedArray(e,4*Float32Array.BYTES_PER_ELEMENT),Nn.fromTypedArray(t),Nn.fromTypedArray(r),i,Zr.fromTypedArray(n,4*Float32Array.BYTES_PER_ELEMENT));for(let s=3;s<e.length;s+=4)n[s]=e[s];return n}function YLt(e,t,r,i,n){if(!CU(i))return SU.error("Cannot convert to spatial reference from PCPF"),n;EU(gy.FROM_PCPF,Zr.fromTypedArray(e,16),Nn.fromTypedArray(t),Nn.fromTypedArray(r),i,Zr.fromTypedArray(n,16));for(let s=3;s<e.length;s+=4)n[s]=e[s];return n}function EU(e,t,r,i,n,s){if(!t)return;const a=r.count,o=fm(n);if(sOe(n))for(let l=0;l<a;l++)i.getVec(l,pI),t.getVec(l,Kp),Au(o,pI,mI,o),Jh(Qs,mI),e===gy.FROM_PCPF&&Kh(Qs,Qs),ed(Kp,Kp,Qs),s.setVec(l,Kp);else for(let l=0;l<a;l++){i.getVec(l,pI),t.getVec(l,Kp),Au(o,pI,mI,o),Jh(Qs,mI);const c=$F(r.get(l,1));let u=Math.cos(c);e===gy.TO_PCPF&&(u=1/u),Qs[0]*=u,Qs[1]*=u,Qs[2]*=u,Qs[3]*=u,Qs[4]*=u,Qs[5]*=u,e===gy.FROM_PCPF&&Kh(Qs,Qs),ed(Kp,Kp,Qs),we(Kp,Kp),s.setVec(l,Kp)}return s}function CU(e){return sOe(e)||Jvt(e)}function sOe(e){return e.isWGS84||z3e(e)||Sm(e)||Em(e)}function Jvt(e){return e.isWebMercator}var gy;(function(e){e[e.TO_PCPF=0]="TO_PCPF",e[e.FROM_PCPF=1]="FROM_PCPF"})(gy||(gy={}));const pI=M(),Kp=M(),mI=Ae(),Qs=Li();function Kvt(e){const t=new Qr;t.include(no),t.include(Lx,e),t.include(nRe,e),_u(t,e);const{vertex:r,fragment:i}=t;return e.stippleEnabled&&(t.attributes.add(O.UV0,"vec2"),t.attributes.add(O.AUXPOS1,"vec3"),r.uniforms.add(new cr("viewport",(n,s)=>s.camera.fullViewport))),t.attributes.add(O.POSITION,"vec3"),t.varyings.add("vpos","vec3"),r.code.add(S`void main(void) {
vpos = position;
forwardNormalizedVertexColor();
gl_Position = transformPosition(proj, view, vpos);`),e.stippleEnabled&&(r.code.add(S`vec4 vpos2 = transformPosition(proj, view, auxpos1);
vec2 ndcToPixel = viewport.zw * 0.5;
float lineSegmentPixelSize = length((vpos2.xy / vpos2.w - gl_Position.xy / gl_Position.w) * ndcToPixel);`),e.draped?r.uniforms.add(new He("worldToScreenRatio",(n,s)=>1/s.screenToPCSRatio)):r.code.add(S`vec3 segmentCenter = (position + auxpos1) * 0.5;
float worldToScreenRatio = computeWorldToScreenRatio(segmentCenter);`),r.code.add(S`float discreteWorldToScreenRatio = discretizeWorldToScreenRatio(worldToScreenRatio);`),e.draped?r.code.add(S`float startPseudoScreen = uv0.y * discreteWorldToScreenRatio - mix(0.0, lineSegmentPixelSize, uv0.x);
float segmentLengthPseudoScreen = lineSegmentPixelSize;`):r.code.add(S`float segmentLengthRender = length(position - auxpos1);
float startPseudoScreen = mix(uv0.y, uv0.y - segmentLengthRender, uv0.x) * discreteWorldToScreenRatio;
float segmentLengthPseudoScreen = segmentLengthRender * discreteWorldToScreenRatio;`),r.code.add(S`vec2 stippleDistanceLimits = computeStippleDistanceLimits(startPseudoScreen, segmentLengthPseudoScreen, lineSegmentPixelSize, stipplePatternPixelSize);
vStippleDistance = mix(stippleDistanceLimits.x, stippleDistanceLimits.y, uv0.x);
vStippleDistance *= gl_Position.w;`)),r.code.add(S`}`),e.output===K.Highlight&&t.include(Ky),t.include(Cn,e),i.uniforms.add(new He("alphaCoverage",(n,s)=>Math.min(1,n.width*s.camera.pixelRatio))),e.hasVertexColors||i.uniforms.add(new cr("constantColor",n=>n.color)),i.code.add(S`
  void main() {
    discardBySlice(vpos);

    vec4 color = ${e.hasVertexColors?"vColor":"constantColor"};

    float stippleAlpha = getStippleAlpha();
    discardByStippleAlpha(stippleAlpha, stippleAlphaColorDiscard);

    vec4 finalColor = blendStipple(vec4(color.rgb, color.a * alphaCoverage), stippleAlpha);

    if (finalColor.a < ${S.float(ao)}) {
      discard;
    }

    ${e.output===K.Color?S`gl_FragColor = highlightSlice(finalColor, vpos);`:""}
    ${e.output===K.Highlight?S`outputHighlight();`:""}
  }
  `),t}const e_t=Object.freeze(Object.defineProperty({__proto__:null,build:Kvt},Symbol.toStringTag,{value:"Module"}));class AU extends gi{constructor(t,r,i){super(t,r,i),this.stipplePattern=null,this.stippleTextureBind=null,this.stippleTextureRepository=t.stippleTextureRepository}get stippleEnabled(){return this.configuration.stippleEnabled&&this.configuration.output!==K.Highlight}initializeProgram(t){const r=AU.shader.get().build(this.configuration);return new ai(t.rctx,r,Ur)}destroy(){super.destroy(),this.stippleTextureRepository.release(this.stipplePattern),this.stipplePattern=null,this.stippleTextureBind=null}bindPass(t,r){if(this.program.bindPass(t,r),this.stipplePattern!==t.stipplePattern){const i=t.stipplePattern;this.stippleTextureBind=this.stippleTextureRepository.swap(this.stipplePattern,i),this.stipplePattern=i}if(this.stippleEnabled){const{pixelSize:i,sdfNormalizer:n,pixels:s}=_(this.stippleTextureBind)?this.stippleTextureBind(this.program):{pixelSize:1,sdfNormalizer:1,pixels:1};this.program.setUniform1f("stipplePatternSDFNormalizer",n),this.program.setUniform1f("stipplePatternTextureSize",s),this.program.setUniform1f("stipplePatternPixelSize",i),this.program.setUniform1f("stipplePatternPixelSizeInv",1/i)}}initializePipeline(){const t=this.configuration,r=ka(Re.SRC_ALPHA,Re.ONE,Re.ONE_MINUS_SRC_ALPHA,Re.ONE_MINUS_SRC_ALPHA),i=(n,s=null,a=null)=>jt({blending:s,depthTest:gae,depthWrite:a,colorWrite:or,stencilWrite:t.hasOccludees?xm:null,stencilTest:t.hasOccludees?n?d_:T_:null});return t.output===K.Color?(this._occludeePipelineState=i(!0,t.transparent||this.stippleEnabled?r:null,fc),i(!1,t.transparent||this.stippleEnabled?r:null,fc)):i(!1)}get primitiveType(){return Dt.LINES}getPipelineState(t,r){return r?this._occludeePipelineState:super.getPipelineState(t,r)}}AU.shader=new si(e_t,()=>ie(()=>import("./NativeLine.glsl.9b970db7.js"),[],import.meta.url));class Nd extends Mo{constructor(){super(...arguments),this.output=K.Color,this.hasSlicePlane=!1,this.hasVertexColors=!1,this.transparent=!1,this.draped=!1,this.stippleEnabled=!1,this.stippleOffColorEnabled=!1,this.stipplePreferContinuous=!0,this.hasOccludees=!1}}d([H({count:K.COUNT})],Nd.prototype,"output",void 0),d([H()],Nd.prototype,"hasSlicePlane",void 0),d([H()],Nd.prototype,"hasVertexColors",void 0),d([H()],Nd.prototype,"transparent",void 0),d([H()],Nd.prototype,"draped",void 0),d([H()],Nd.prototype,"stippleEnabled",void 0),d([H()],Nd.prototype,"stippleOffColorEnabled",void 0),d([H()],Nd.prototype,"stipplePreferContinuous",void 0),d([H()],Nd.prototype,"hasOccludees",void 0),d([H({constValue:!1})],Nd.prototype,"stippleRequiresClamp",void 0),d([H({constValue:!1})],Nd.prototype,"stippleScaleWithLineWidth",void 0),d([H({constValue:!1})],Nd.prototype,"stippleRequiresStretchMeasure",void 0);const t_t=fe.getLogger("esri.views.3d.webgl-engine.materials.NativeLineMaterial");var _k;(function(e){e[e.START=0]="START",e[e.END=1]="END"})(_k||(_k={}));class cge extends Dm{constructor(t){super(t,new n_t),this._techniqueConfig=new Nd}getConfiguration(t,r){this._techniqueConfig.output=t,this._techniqueConfig.hasSlicePlane=this.parameters.hasSlicePlane,this._techniqueConfig.hasVertexColors=this.parameters.hasVertexColors,this._techniqueConfig.transparent=this.parameters.color[3]<1||this.parameters.width<1,this._techniqueConfig.draped=r.slot===Ee.DRAPED_MATERIAL;const i=_(this.parameters.stipplePattern);return this._techniqueConfig.stippleEnabled=i,this._techniqueConfig.stippleOffColorEnabled=i&&_(this.parameters.stippleOffColor),this._techniqueConfig.hasOccludees=this.parameters.hasOccludees,this._techniqueConfig.stipplePreferContinuous=this.parameters.stipplePreferContinuous,this._techniqueConfig}intersect(t,r,i,n,s,a,o,l,c){_(c)?S0t(t,n,c,a,1,o):this._intersectLineGeometry(t,r,i,n,o)}_intersectLineGeometry(t,r,i,n,s){if(!n.options.selectionMode||xO(r))return;if(!vCe(i))return void t_t.error("intersection assumes a translation-only matrix");const a=t.vertexAttributes.get(O.POSITION).data,o=n.camera,l=a_t;Na(l,n.point);const c=2;ne(A8[0],l[0]-c,l[1]+c,0),ne(A8[1],l[0]+c,l[1]+c,0),ne(A8[2],l[0]+c,l[1]-c,0),ne(A8[3],l[0]-c,l[1]-c,0);for(let g=0;g<4;g++)if(!o.unprojectFromRenderScreen(A8[g],Wm[g]))return;Ao(o.eye,Wm[0],Wm[1],Fq),Ao(o.eye,Wm[1],Wm[2],Nq),Ao(o.eye,Wm[2],Wm[3],kq),Ao(o.eye,Wm[3],Wm[0],Vq);let u=Number.MAX_VALUE,h=0;for(let g=0;g<a.length-5;g+=3){if(el[0]=a[g]+i[12],el[1]=a[g+1]+i[13],el[2]=a[g+2]+i[14],tl[0]=a[g+3]+i[12],tl[1]=a[g+4]+i[13],tl[2]=a[g+5]+i[14],di(Fq,el)<0&&di(Fq,tl)<0||di(Nq,el)<0&&di(Nq,tl)<0||di(kq,el)<0&&di(kq,tl)<0||di(Vq,el)<0&&di(Vq,tl)<0)continue;if(o.projectToRenderScreen(el,Z_),o.projectToRenderScreen(tl,Q_),Z_[2]<0&&Q_[2]>0){pe(e0,el,tl);const w=o.frustum,v=-di(w[ci.NEAR],el)/Se(e0,w[ci.NEAR]);le(e0,e0,v),he(el,el,e0),o.projectToRenderScreen(el,Z_)}else if(Z_[2]>0&&Q_[2]<0){pe(e0,tl,el);const w=o.frustum,v=-di(w[ci.NEAR],tl)/Se(e0,w[ci.NEAR]);le(e0,e0,v),he(tl,tl,e0),o.projectToRenderScreen(tl,Q_)}else if(Z_[2]<0&&Q_[2]<0)continue;Z_[2]=0,Q_[2]=0;const b=sie(uw(Z_,Q_,hge),l);b<u&&(u=b,oe(dge,el),oe(uge,tl),h=g/3)}const p=n.rayBegin,m=n.rayEnd;if(u<c*c){let g=Number.MAX_VALUE;if(fSe(uw(dge,uge,hge),uw(p,m,s_t),Y_)){pe(Y_,Y_,p);const b=Oe(Y_);le(Y_,Y_,1/b),g=b/fi(p,m)}s(g,Y_,h,!1)}}computeAttachmentOrigin(t,r){const i=t.vertexAttributes;if(!i)return!1;const n=i.get(O.POSITION);return xse(n,null,!1,r)}requiresSlot(t){return t===Ee.OPAQUE_MATERIAL||t===Ee.DRAPED_MATERIAL}createGLMaterial(t){return t.output===K.Color||t.output===K.Highlight?new r_t(t):null}createBufferWriter(){const t=this.parameters.hasVertexColors?wRe:pbt;return R(this.parameters.stipplePattern)?new yU(t):new i_t(t.clone().vec3f(O.AUXPOS1).vec2f(O.UV0))}}class r_t extends v_{_updateOccludeeState(t){t.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:t.hasOccludees})}beginSlot(t){return this._output===K.Color&&this._updateOccludeeState(t),this.ensureTechnique(AU,t)}}class i_t{constructor(t){this.vertexBufferLayout=t}allocate(t){return this.vertexBufferLayout.createBuffer(t)}elementCount(t){return t.indices.get(O.POSITION).length}write(t,r,i,n){Qz(r,this.vertexBufferLayout,t.transformation,t.invTranspTransformation,i,n),this._writeAuxpos1(t,r,i,n),this._writeUV0(t,r,i,n)}_writeAuxpos1(t,r,i,n){const s=i.getField(O.AUXPOS1,Zr),a=r.indices.get(O.POSITION),o=r.vertexAttributes.get(O.POSITION).data,l=t.transformation,c=s.typedBufferStride,u=s.typedBuffer;n*=c;for(let h=0;h<a.length-1;h+=2)for(const p of[1,0]){const m=3*a[h+p],g=o[m],b=o[m+1],w=o[m+2],v=l[0]*g+l[4]*b+l[8]*w+l[12],x=l[1]*g+l[5]*b+l[9]*w+l[13],T=l[2]*g+l[6]*b+l[10]*w+l[14];u[n]=v,u[n+1]=x,u[n+2]=T,n+=c}}_writeUV0(t,r,i,n){var E;const s=i.getField(O.UV0,ef),a=r.indices.get(O.POSITION),o=r.vertexAttributes.get(O.POSITION).data,l=(E=r.vertexAttributes.get(O.DISTANCETOSTART))==null?void 0:E.data,c=t.transformation,u=s.typedBufferStride,h=s.typedBuffer;let p=0;h[n*=u]=_k.START,h[n+1]=p,n+=u;const m=3*a[0],g=ne(el,o[m],o[m+1],o[m+2]);c&&ze(g,g,c);const b=tl,w=a.length-1;let v=1;const x=l?(C,A,P)=>p=l[P]:(C,A,P)=>p+=fi(C,A);for(let C=1;C<w;C+=2){const A=3*a[C];ne(b,o[A],o[A+1],o[A+2]),c&&ze(b,b,c),x(g,b,v++);for(let P=0;P<2;++P)h[n]=1-P,h[n+1]=p,n+=u;oe(g,b)}const T=3*a[w];ne(b,o[T],o[T+1],o[T+2]),c&&ze(b,b,c),x(g,b,v),h[n]=_k.END,h[n+1]=p}}class n_t extends S6{constructor(){super(...arguments),this.color=Ih,this.hasVertexColors=!1,this.hasSlicePlane=!1,this.width=1,this.stipplePreferContinuous=!0,this.hasOccludees=!1}}const el=M(),tl=M(),e0=M(),Y_=M(),Z_=ro(),Q_=ro(),dge=M(),uge=M(),hge=Om(),s_t=Om(),a_t=M(),A8=[ro(),ro(),ro(),ro()],Wm=[M(),M(),M(),M()],Fq=Er(),Nq=Er(),kq=Er(),Vq=Er(),o_t=["mesh"];class l_t extends Nm{constructor(t,r,i,n){super(t,r,i,n),this._materials=new Map,this._textures=new Map,this.ensureDrapedStatus(!1)}async doLoad(){Yr.DRAW_MESH_GEOMETRY_NORMALS&&(this._debugVertexNormalMaterial=new cge({color:[1,0,1,1]}),this._debugFaceNormalMaterial=new cge({color:[0,1,1,1]}))}destroy(){super.destroy(),this._context.stage.removeMany(Array.from(this._materials.values(),t=>t.material)),this._context.stage.removeMany(Array.from(this._textures.values())),this._materials.clear(),this._textures.clear()}createGraphics3DGraphic(t){const r=t.graphic;if(!this._validateGeometry(r.geometry,o_t,"fill on mesh-3d"))return null;const i=this.setGraphicElevationContext(r,new Du),n=t.renderingInfo;return this._createAs3DShape(r,n,i,r.uid)}layerOpacityChanged(t,r){const i=this._getLayerOpacity();return this._materials.forEach(n=>{n.material.setParameters({layerOpacity:i});const s=n.material.parameters;this._setMaterialTransparentParameter(s,n),n.material.setParameters({transparent:s.transparent})}),t.forEach(n=>{const s=r(n);_(s)&&s.layerOpacityChanged(i,this._context.isAsync)}),!0}layerElevationInfoChanged(t,r){return this.updateGraphics3DGraphicElevationInfo(t,r,l_)}slicePlaneEnabledChanged(t,r){return this._materials.forEach(i=>{i.material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled})}),t.forEach(i=>{const n=r(i);_(n)&&n.slicePlaneEnabledChanged(this._context.slicePlaneEnabled,this._context.isAsync)}),!0}physicalBasedRenderingChanged(){const t=this._usePBR();return this._materials.forEach(r=>r.material.setParameters({usePBR:t})),!0}pixelRatioChanged(){return!0}_requiresSymbolVertexColors(){return this._drivenProperties.color||this._drivenProperties.opacity}_colorOrTextureUid(t){return R(t)?"-":t instanceof Te?t.toHex():t.contentHash}_materialPropertiesDefault(t,r){const i=this._requiresSymbolVertexColors(),n=!!t.vertexAttributes.color,s=!!t.vertexAttributes.tangent;return{hasSymbolVertexColors:i,hasVertexColors:n,hasVertexTangents:s,uid:`vc:${n},vt:${s},vct${r},svc:${i}`}}_materialProperties(t,r,i){const n=this._materialPropertiesDefault(t,i);if(!r.material)return n;const{color:s,colorTexture:a,normalTexture:o,doubleSided:l,alphaCutoff:c,alphaMode:u}=r.material,h=this._colorOrTextureUid(s),p=this._colorOrTextureUid(a),m=this._colorOrTextureUid(o);if(n.color=s,n.colorTexture=a,n.normalTexture=o,n.uid=`${n.uid},cmuid:${h},ctmuid:${p},ntmuid:${m},ds:${l},ac:${c},am:${u}`,r.material instanceof nOe){const{metallic:g,roughness:b,metallicRoughnessTexture:w,emissiveColor:v,emissiveTexture:x,occlusionTexture:T}=r.material,E=this._colorOrTextureUid(w),C=this._colorOrTextureUid(v),A=this._colorOrTextureUid(x),P=this._colorOrTextureUid(T);n.metallic=g,n.roughness=b,n.metallicRoughnessTexture=w,n.emissiveColor=v,n.emissiveTexture=x,n.occlusionTexture=T,n.uid=`${n.uid},mrm:${g},mrr:${b},mrt:${E},emuid:${C},etmuid:${A},otmuid:${P}`}return n}_setInternalColorValueParameters(t,r){r.diffuse=Te.toUnitRGB(t),r.opacity=t.a}_getLoadableTextureResource(t){return t.data?t.data:t.url}_getInternalTextureId(t){const r=this._getInternalTexture(t,ui.Opaque);return _(r)?r.id:null}_getInternalTexture(t,r){const i=this._getLoadableTextureResource(t);if(!i)return null;const n=`${t.contentHash}/${r}`;let s=this._textures.get(n);return s||(s=new Hn(i,{mipmap:!0,wrap:this._castTextureWrap(t.wrap),noUnpackFlip:!0,preMultiplyAlpha:r!==ui.Opaque}),this._textures.set(n,s),this._context.stage.add(s),this._context.stage.loadImmediate(s)),s}_castTextureWrap(t="repeat"){if(typeof t=="string"){const r=this._castTextureWrapIndividual(t);return{s:r,t:r}}return{s:this._castTextureWrapIndividual(t.horizontal),t:this._castTextureWrapIndividual(t.vertical)}}_castTextureWrapIndividual(t){switch(t){case"clamp":return xt.CLAMP_TO_EDGE;case"mirror":return xt.MIRRORED_REPEAT;default:return xt.REPEAT}}_setInternalMaterialParameters(t,r){if(_(t.color)&&this._setInternalColorValueParameters(t.color,r),_(t.colorTexture)){const i=this._getInternalTexture(t.colorTexture,r.textureAlphaMode);_(i)?(r.textureId=i.id,r.textureAlphaPremultiplied=!!i.params.preMultiplyAlpha):r.textureId=void 0}_(t.normalTexture)&&(r.normalTextureId=this._getInternalTextureId(t.normalTexture)),_(t.emissiveColor)&&(r.emissiveFactor=Te.toUnitRGB(t.emissiveColor)),_(t.emissiveTexture)&&(r.emissiveTextureId=this._getInternalTextureId(t.emissiveTexture)),_(t.occlusionTexture)&&(r.occlusionTextureId=this._getInternalTextureId(t.occlusionTexture)),_(t.metallicRoughnessTexture)&&(r.metallicRoughnessTextureId=this._getInternalTextureId(t.metallicRoughnessTexture))}_setExternalMaterialParameters(t){const r=this._drivenProperties.color;let i=_(this.symbolLayer.material)?this.symbolLayer.material.colorMixMode:null;if(r)t.externalColor=Ih;else{const n=_(this.symbolLayer.material)?this.symbolLayer.material.color:null;_(n)?t.externalColor=Te.toUnitRGBA(n):(i=null,t.externalColor=Ih)}i&&(t.colorMixMode=i),t.castShadows=!!this.symbolLayer.castShadows}_hasTransparentVertexColors(t){const r=t.vertexAttributes.color;if(R(r))return!1;for(let i=3;i<r.length;i+=4)if(r[i]!==255)return!0;return!1}_getOrCreateMaterial(t,r){var g,b,w;const i=(g=r.material)==null?void 0:g.color,n=(b=r.material)==null?void 0:b.colorTexture,s=(w=r.material)==null?void 0:w.alphaMode,a=s==="blend",o=s!=="opaque"&&(this._hasTransparentVertexColors(t)||_(i)&&i.a<1||_(n)&&n.transparent||a),l=this._materialProperties(t,r,o),c=this._materials.get(l.uid);if(c)return c.material;const u={material:null,isComponentTransparent:o,alphaMode:r.material?r.material.alphaMode:"opaque"},h=l.metallicRoughnessTexture==null&&l.metallic==null&&l.roughness==null,p={usePBR:this._usePBR(),isSchematic:h,hasVertexColors:l.hasVertexColors,hasSymbolColors:l.hasSymbolVertexColors,hasVertexTangents:l.hasVertexTangents,ambient:gl,diffuse:X0,opacity:1,doubleSided:!0,doubleSidedType:"winding-order",cullFace:pi.None,layerOpacity:this._getLayerOpacity(),hasSlicePlane:this._context.slicePlaneEnabled,initTextureTransparent:!0};h||(p.mrrFactors=[l.metallic!=null?l.metallic:1,l.roughness!=null?l.roughness:1,.5]),r.material&&(p.doubleSided=r.material.doubleSided,p.cullFace=r.material.doubleSided?pi.None:pi.Back,p.textureAlphaCutoff=r.material.alphaCutoff),this._setExternalMaterialParameters(p),this._setMaterialTransparentParameter(p,u),this._setInternalMaterialParameters(l,p);const m=new lx(p);return u.material=m,this._materials.set(l.uid,u),this._context.stage.add(m),m}_usePBR(){return this._context.physicalBasedRenderingEnabled}_setMaterialTransparentParameter(t,r){t.transparent=this.needsDrivenTransparentPass||r.isComponentTransparent||t.layerOpacity<1||t.opacity<1||t.externalColor&&t.externalColor[3]<1,r.alphaMode==="auto"?t.textureAlphaMode=t.transparent?ui.MaskBlend:ui.Opaque:t.textureAlphaMode=r.alphaMode==="opaque"?ui.Opaque:r.alphaMode==="mask"?ui.Mask:ui.Blend}_addDebugNormals(t,r,i,n){const s=r.length,a=t.spatialReference.isGeographic?20015077/180:1,o=.1*Math.max(t.extent.width*a,t.extent.height*a,t.extent.zmax-t.extent.zmin),l=[],c=[],u=[],h=[];for(let g=0;g<s;g++){const b=r[g],w=b.vertexAttributes.get(O.POSITION),v=b.vertexAttributes.get(O.NORMAL),x=b.indices.get(O.POSITION),T=b.indices.get(O.NORMAL),E=w.data,C=v.data;for(let A=0;A<x.length;A++){const P=3*x[A],I=3*T[A];for(let L=0;L<3;L++)l.push(E[P+L]);for(let L=0;L<3;L++)l.push(E[P+L]+C[I+L]*o);if(c.push(c.length),c.push(c.length),A%3==0){this._calculateFaceNormal(E,x,A,yT),this._getFaceVertices(E,x,A,Ga,mT,gT),he(Ga,Ga,mT),he(Ga,Ga,gT),le(Ga,Ga,1/3);for(let L=0;L<3;L++)u.push(Ga[L]);for(let L=0;L<3;L++)u.push(Ga[L]+yT[L]*o);h.push(h.length),h.push(h.length)}}}const p=new Gi([[O.POSITION,{data:l,size:3,exclusive:!0}]],[[O.POSITION,new Uint32Array(c)]],lc.Line);r.push(p),i.push(this._debugVertexNormalMaterial),n.push(dw(n[0]));const m=new Gi([[O.POSITION,{data:u,size:3,exclusive:!0}]],[[O.POSITION,new Uint32Array(h)]],lc.Line);r.push(m),i.push(this._debugFaceNormalMaterial),n.push(dw(n[0]))}_createAs3DShape(t,r,i,n){const s=t.geometry;if(s.type!=="mesh")return null;const a=this._createGeometryInfo(s,r);if(!a)return null;const{geometries:o,materials:l,transformations:c,objectTransformation:u}=a;Yr.DRAW_MESH_GEOMETRY_NORMALS&&this._addDebugNormals(s,o,l,c);const h=new rb({geometries:o,materials:l,transformations:c,metadata:{layerUid:this._context.layer.uid,graphicUid:n}});h.transformation=u;const p=this._createEdgeMaterial(),m=_(p)?{baseMaterial:l[0],edgeMaterials:[p],properties:{mergeGeometries:!0,hasSlicePlane:this._context.slicePlaneEnabled}}:null,g=new Fm(this,h,o,null,null,cR,i,m);return g.needsElevationUpdates=l_(i.mode),g.useObjectOriginAsAttachmentOrigin=!0,g.elevationContext.centerPointInElevationSR=this._getCenterPointInElevationSR(h),g.alignedSampledElevation=cR(g,g.elevationContext,this._context.elevationProvider,this._context.renderCoordsHelper),g}_getCenterPointInElevationSR(t){const r=tb(0,0,0,this._context.elevationProvider.spatialReference);return NTe([t.transformation[12],t.transformation[13],t.transformation[14]],this._context.renderCoordsHelper.spatialReference,r),r}_createComponentNormals(t,r,i,n){switch(i.shading||"flat"){case"source":return this._createComponentNormalsSource(t,r,i,n);case"flat":return this._createComponentNormalsFlat(t,n);case"smooth":return this._createComponentNormalsSmooth(t,n);default:return}}_createComponentNormalsSource(t,r,i,n){if(R(r))return this._createComponentNormalsFlat(t,n);let s=!1;if(!i.trustSourceNormals)for(let a=0;a<n.length;a+=3){this._calculateFaceNormal(t,n,a,yT);for(let o=0;o<3;o++){const l=3*n[a+o];Ga[0]=r[l+0],Ga[1]=r[l+1],Ga[2]=r[l+2],Se(yT,Ga)<0&&(r[l+0]=-r[l+0],r[l+1]=-r[l+1],r[l+2]=-r[l+2],s=!0)}}return{normals:r,indices:n,didFlipNormals:s}}_createComponentNormalsFlat(t,r){const i=new Float32Array(r.length),n=new Uint32Array(3*r.length);for(let s=0;s<r.length;s+=3){const a=this._calculateFaceNormal(t,r,s,yT);for(let o=0;o<3;o++)i[s+o]=a[o],n[s+o]=s/3}return{normals:i,indices:n,didFlipNormals:!1}}_createComponentNormalsSmooth(t,r){const i={};for(let a=0;a<r.length;a+=3){const o=this._calculateFaceNormal(t,r,a,yT);for(let l=0;l<3;l++){const c=r[a+l];let u=i[c];u||(u={normal:M(),count:0},i[c]=u),he(u.normal,u.normal,o),u.count++}}const n=new Float32Array(3*r.length),s=new Uint32Array(3*r.length);for(let a=0;a<r.length;a++){const o=i[r[a]];o.count!==1&&(we(o.normal,o.normal),o.count=1);for(let l=0;l<3;l++)n[3*a+l]=o.normal[l];s[a]=a}return{normals:n,indices:s,didFlipNormals:!1}}_getFaceVertices(t,r,i,n,s,a){const o=3*r[i+0],l=3*r[i+1],c=3*r[i+2];n[0]=t[o+0],n[1]=t[o+1],n[2]=t[o+2],s[0]=t[l+0],s[1]=t[l+1],s[2]=t[l+2],a[0]=t[c+0],a[1]=t[c+1],a[2]=t[c+2]}_calculateFaceNormal(t,r,i,n){return this._getFaceVertices(t,r,i,Ga,mT,gT),pe(mT,mT,Ga),pe(gT,gT,Ga),dt(Ga,mT,gT),we(n,Ga),n}_getOrCreateComponents(t){return vt(t.components,c_t)}_createPositionBuffer(t,r){let i=t.vertexAttributes.position;const n=r.reprojection===Gd.ECEF?r.transformBeforeProject:null;if(_(n)&&(i=Xvt(i,new Float64Array(i.length),n)),r.reprojection===Gd.NONE)return r.needsBufferCopy?new Float64Array(i):i;const s=_(n)?i:new Float64Array(i.length);return mi(i,t.spatialReference,0,s,this._context.renderCoordsHelper.spatialReference,0,i.length/3),s}_createNormalBuffer(t,r,i){let n=t.vertexAttributes.normal;if(R(n))return null;const s=i.reprojection===Gd.ECEF?i.transformBeforeProject:null;if(_(s)&&(n=Yvt(n,new Float32Array(n.length),s)),this._context.graphicsCoreOwner.view.viewingMode==="local"||i.reprojection===Gd.NONE)return i.needsBufferCopy&&t.vertexAttributes.normal===n?new Float32Array(n):n;const a=t.vertexAttributes.position,o=_(s)?n:new Float32Array(n.length);return Wvt(n,a,r,t.spatialReference,o)}_createTangentBuffer(t,r,i){let n=t.vertexAttributes.tangent;if(R(n))return null;const s=i.reprojection===Gd.ECEF?i.transformBeforeProject:null;if(_(s)&&(n=Zvt(n,new Float32Array(n.length),s)),this._context.graphicsCoreOwner.view.viewingMode==="local"||i.reprojection===Gd.NONE)return i.needsBufferCopy&&t.vertexAttributes.normal===n?new Float32Array(n):n;const a=t.vertexAttributes.position,o=_(s)?n:new Float32Array(n.length);return Qvt(n,a,r,t.spatialReference,o)}_createColorBuffer(t){return t.vertexAttributes.color}_createSymbolColorBuffer(t){if(this._requiresSymbolVertexColors()){const r=this._getVertexOpacityAndColor(t),i=DRe(Vi(this.symbolLayer,"material","colorMixMode")),n=new Uint8Array(4);return FRe(r,i,n),n}return null}_createBuffers(t,r){const i=t.vertexAttributes&&t.vertexAttributes.position;if(!i)return this.logger.warn("Mesh geometry must contain position vertex attributes"),null;const n=t.vertexAttributes.normal,s=t.vertexAttributes.uv,a=t.vertexAttributes.tangent;if(_(n)&&n.length!==i.length)return this.logger.warn("Mesh normal vertex buffer must contain the same number of elements as the position buffer"),null;if(_(a)&&a.length/4!=i.length/3)return this.logger.warn("Mesh tangent vertex buffer must contain the same number of elements as the position buffer"),null;if(_(s)&&s.length/2!=i.length/3)return this.logger.warn("Mesh uv vertex buffer must contain the same number of elements as the position buffer"),null;const o=this._computeReprojectionInfo(t),l=this._createPositionBuffer(t,o),c=this._createColorBuffer(t),u=this._createSymbolColorBuffer(r),h=this._createNormalBuffer(t,l,o),p=this._createTangentBuffer(t,l,o);return{positionBuffer:l,normalBuffer:h,tangentBuffer:p,uvBuffer:s,colorBuffer:c,symbolColorBuffer:u,objectTransformation:o.reprojection===Gd.NONE&&_(o.objectTransformation)?o.objectTransformation:this._transformOriginLocal(t,l,h,p),geometryTransformation:o.reprojection===Gd.NONE&&_(o.geometryTransformation)?o.geometryTransformation:Ae()}}_computeReprojectionInfo(t){const r=_(t.transform),i=r&&t.transform.geographic||this._context.renderCoordsHelper.viewingMode===Be.Local?Gd.NONE:Gd.ECEF;if(r){if(i===Gd.NONE){const s=Ae();return Au(t.spatialReference,t.transform.origin,s,this._context.renderCoordsHelper.spatialReference),{reprojection:i,objectTransformation:s,geometryTransformation:dw(t.transform.localMatrix),needsBufferCopy:!1}}const n=NV(Ae(),t.transform.origin);return Zi(n,n,t.transform.localMatrix),{reprojection:i,transformBeforeProject:n,needsBufferCopy:!0}}return{reprojection:i,needsBufferCopy:!0}}_transformOriginLocal(t,r,i,n){const s=this._context.renderCoordsHelper.spatialReference,a=t.anchor;gI[0]=a.x,gI[1]=a.y,gI[2]=a.z;const o=Ae();Au(t.spatialReference,gI,o,s);const l=Nn.fromTypedArray(r);if(Rn(fge,o),PO(l,l,fge),_(i)||_(n)){if(Jh(R8,o),Kh(R8,R8),_(i)){const c=Zr.fromTypedArray(i);c_(c,c,R8)}if(_(n)){const c=Zr.fromTypedArray(n,4*n.BYTES_PER_ELEMENT);c_(c,c,R8)}}return o}_validateFaces(t,r){const i=t.vertexAttributes.position.length/3,n=r.faces;if(n){let s=-1;for(let a=0;a<n.length;a++){const o=n[a];o>s&&(s=o)}if(i<=s)return this.logger.warn(`Vertex index ${s} is out of bounds of the mesh position buffer`),!1}else if(i%3!=0)return this.logger.warn("Mesh position buffer length must be a multiple of 9 if no component faces are defined (3 values per vertex * 3 vertices per triangle)"),!1;return!0}_getOrCreateFaces(t,r){return r.faces?r.faces:S9(t.vertexAttributes.position.length/3)}_isOutsideClippingArea(t){if(!this._context.clippingExtent)return!1;const r=t.vertexAttributes&&t.vertexAttributes.position;if(!r)return!1;const i=this._context.elevationProvider.spatialReference;let n;const s=r.length/3;return t.spatialReference.equals(i)?n=r:(n=new Float64Array(r.length),mi(t.vertexAttributes.position,t.spatialReference,0,n,i,0,s)),bi(zq),hu(zq,n,0,s),!pp(zq,this._context.clippingExtent)}_createGeometryInfo(t,r){if(!mm(t.spatialReference,this._context.graphicsCoreOwner.view.spatialReference))return this.logger.warn("Geometry spatial reference is not compatible with the view"),null;if(this._isOutsideClippingArea(t))return null;const i=this._createBuffers(t,r);if(R(i))return null;const{positionBuffer:n,uvBuffer:s,colorBuffer:a,symbolColorBuffer:o,normalBuffer:l,tangentBuffer:c,objectTransformation:u,geometryTransformation:h}=i,p=this._getOrCreateComponents(t),m=[],g=[],b=[];let w=!1;for(const v of p){if(!this._validateFaces(t,v))return null;const x=this._getOrCreateFaces(t,v);if(x.length===0)continue;const T=this._createComponentNormals(n,l,v,x);T.didFlipNormals&&(w=!0);const E=[[O.POSITION,{size:3,data:n,exclusive:!0}],[O.NORMAL,{size:3,data:T.normals,exclusive:!0}]],C=[[O.POSITION,x],[O.NORMAL,T.indices]];_(a)&&(E.push([O.COLOR,{size:4,data:a,exclusive:!0}]),C.push([O.COLOR,x])),_(o)&&(E.push([O.SYMBOLCOLOR,{size:4,data:o,exclusive:!0}]),C.push([O.SYMBOLCOLOR,new Uint16Array(x.length)])),_(s)&&(E.push([O.UV0,{size:2,data:s,exclusive:!0}]),C.push([O.UV0,x])),_(c)&&(E.push([O.TANGENT,{size:4,data:c,exclusive:!0}]),C.push([O.TANGENT,x]));const A=new Gi(E,C);m.push(A),g.push(h),b.push(this._getOrCreateMaterial(t,v))}return w&&this.logger.warn("Normals have been automatically flipped to be consistent with the counter clock wise face winding order. It is better to generate mesh geometries that have consistent normals."),{geometries:m,transformations:g,materials:b,objectTransformation:u}}_createEdgeMaterial(){const t={opacity:this._getLayerOpacity()};return BAe(this.symbolLayer,t)}}const gI=M(),Ga=M(),mT=M(),gT=M(),yT=M(),fge=Ae(),R8=Li(),zq=is(),c_t=[new Hvt];var Gd;(function(e){e[e.NONE=0]="NONE",e[e.ECEF=1]="ECEF"})(Gd||(Gd={}));class d_t{constructor(t,r,i,n){this.graphics3DSymbolLayer=t,this.instanceIndex=r,this.elevationAligner=i,this.elevationContext=n,this.type="lod-instance",this._highlights=new Set,this.alignedSampledElevation=0,this.isElevationSource=!1,this.needsElevationUpdates=!1}initialize(){}setVisibility(t){const r=this.lodRenderer.instanceData;t!==r.getVisible(this.instanceIndex)&&r.setVisible(this.instanceIndex,t)}destroy(){this.instanceIndex!=null&&(this.lodRenderer.instanceData.removeInstance(this.instanceIndex),this.graphics3DSymbolLayer.notifyDestroyGraphicLayer(this))}alignWithElevation(t,r,i){if(this.elevationAligner){lae(this.elevationContext.featureExpressionInfoContext,i);const n=this.elevationAligner(this,this.elevationContext,t,r);_(n)&&(this.alignedSampledElevation=n)}}getCenterObjectSpace(t=M()){return this.lodRenderer.instanceData.getCombinedLocalTransform(this.instanceIndex,t0),ze(t,this.lodRenderer.baseBoundingSphere.center,t0)}getBoundingBoxObjectSpace(t=is()){this.lodRenderer.instanceData.getCombinedLocalTransform(this.instanceIndex,t0);const r=this.lodRenderer.baseBoundingBox;bi(t);for(let i=0;i<8;++i)ne(ju,(1&i)==0?r[0]:r[3],(2&i)==0?r[1]:r[4],(4&i)==0?r[2]:r[5]),ze(ju,ju,t0),um(t,ju);return t}computeAttachmentOrigin(t){this.lodRenderer.instanceData.getGlobalTransform(this.instanceIndex,t0),t.render.origin[0]+=t0[12],t.render.origin[1]+=t0[13],t.render.origin[2]+=t0[14],t.render.num++}async getProjectedBoundingBox(t,r,i,n,s){const a=this.getBoundingBoxObjectSpace(s),o=u_t,l=SV(a)?1:o.length;this.lodRenderer.instanceData.getGlobalTransform(this.instanceIndex,t0);for(let u=0;u<l;u++){const h=o[u];ju[0]=a[h[0]],ju[1]=a[h[1]],ju[2]=a[h[2]],ze(ju,ju,t0),J_[3*u+0]=ju[0],J_[3*u+1]=ju[1],J_[3*u+2]=ju[2]}if(!t(J_,0,l))return null;bi(a);let c=null;this.calculateRelativeScreenBounds&&(c=this.calculateRelativeScreenBounds());for(let u=0;u<3*l;u+=3){for(let h=0;h<3;h++)a[h]=Math.min(a[h],J_[u+h]),a[h+3]=Math.max(a[h+3],J_[u+h]);c&&i.push({location:J_.slice(u,u+3),screenSpaceBoundingRect:c})}if(r&&(fp(a,Uq),this.elevationContext.mode!=="absolute-height")){let u;const h=aae(a,r);try{u=await r.service.queryElevation(Uq[0],Uq[1],n,h,"ground")}catch{}_(u)&&Mxe(a,0,0,-this.alignedSampledElevation+u)}return a}addObjectState(t,r){if(t===Fy.Highlight){const i=new dk(t);this._addHighlightId(i),r.addExternal(n=>{this._removeHighlightId(n)},i)}}removeObjectState(t){this._highlights.forEach(r=>t.remove(r))}_addHighlightId(t){this._highlights.add(t),this.lodRenderer.instanceData.setHighlight(this.instanceIndex,!0)}_removeHighlightId(t){this._highlights.delete(t),this.lodRenderer.instanceData.setHighlight(this.instanceIndex,this._highlights.size>0)}get lodRenderer(){return this.graphics3DSymbolLayer.lodRenderer}}const J_=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],ju=M(),Uq=M(),u_t=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]],t0=Ae();function h_t(e){const t=[];return e.stageResources.geometries.forEach((r,i)=>{const n=e.stageResources.materials[i],s=e.stageResources.textures;t.push({material:n,geometry:r,textures:s})}),{components:t,minScreenSpaceRadius:e.lodThreshold,pivotOffset:e.pivotOffset}}function f_t(e){return{levels:e.map(t=>h_t(t))}}function p_t(e,t=g_t){const r=qgt(e);return Math.sqrt(r/(t*Math.PI))}function m_t(e){e.levels.forEach(t=>{t.minScreenSpaceRadius||(t.minScreenSpaceRadius=p_t(t))})}const g_t=.05;function y_t(e){return e=e||globalThis.location.hostname,b_t.some(t=>(e==null?void 0:e.match(t))!=null)}function pK(e,t){return e&&(t=t||globalThis.location.hostname)?t.match(aOe)!=null||t.match(lOe)!=null?e.replace("static.arcgis.com","staticdev.arcgis.com"):t.match(oOe)!=null||t.match(cOe)!=null?e.replace("static.arcgis.com","staticqa.arcgis.com"):e:e}const aOe=/^devext.arcgis.com$/,oOe=/^qaext.arcgis.com$/,lOe=/^[\w-]*\.mapsdevext.arcgis.com$/,cOe=/^[\w-]*\.mapsqa.arcgis.com$/,b_t=[/^([\w-]*\.)?[\w-]*\.zrh-dev-local.esri.com$/,aOe,oOe,/^jsapps.esri.com$/,lOe,cOe];function v_t(e,t,r){if(e.count!==t.count)return void aU.error("source and destination buffers need to have the same number of elements");const i=e.count,n=r[0],s=r[1],a=r[2],o=r[3],l=r[4],c=r[5],u=r[6],h=r[7],p=r[8],m=r[9],g=r[10],b=r[11],w=r[12],v=r[13],x=r[14],T=r[15],E=e.typedBuffer,C=e.typedBufferStride,A=t.typedBuffer,P=t.typedBufferStride;for(let I=0;I<i;I++){const L=I*C,V=I*P,G=A[V],B=A[V+1],X=A[V+2],Y=A[V+3];E[L]=n*G+l*B+p*X+w*Y,E[L+1]=s*G+c*B+m*X+v*Y,E[L+2]=a*G+u*B+g*X+x*Y,E[L+3]=o*G+h*B+b*X+T*Y}}function dOe(e,t,r){if(e.count!==t.count)return void aU.error("source and destination buffers need to have the same number of elements");const i=e.count,n=r[0],s=r[1],a=r[2],o=r[3],l=r[4],c=r[5],u=r[6],h=r[7],p=r[8],m=e.typedBuffer,g=e.typedBufferStride,b=t.typedBuffer,w=t.typedBufferStride;for(let v=0;v<i;v++){const x=v*g,T=v*w,E=b[T],C=b[T+1],A=b[T+2],P=b[T+3];m[x]=n*E+o*C+u*A,m[x+1]=s*E+l*C+h*A,m[x+2]=a*E+c*C+p*A,m[x+3]=P}}function __t(e,t){const r=Math.min(e.count,t.count),i=e.typedBuffer,n=e.typedBufferStride,s=t.typedBuffer,a=t.typedBufferStride;for(let o=0;o<r;o++){const l=o*n,c=o*a,u=s[c],h=s[c+1],p=s[c+2],m=u*u+h*h+p*p;if(m>0){const g=1/Math.sqrt(m);i[l]=g*u,i[l+1]=g*h,i[l+2]=g*p}}}function mK(e,t,r){const i=Math.min(e.count,t.count),n=e.typedBuffer,s=e.typedBufferStride,a=t.typedBuffer,o=t.typedBufferStride;for(let l=0;l<i;l++){const c=l*s,u=l*o;n[c]=r*a[u],n[c+1]=r*a[u+1],n[c+2]=r*a[u+2],n[c+3]=r*a[u+3]}}function w_t(e,t,r){const i=Math.min(e.count,t.count),n=e.typedBuffer,s=e.typedBufferStride,a=t.typedBuffer,o=t.typedBufferStride;for(let l=0;l<i;l++){const c=l*s,u=l*o;n[c]=a[u]>>r,n[c+1]=a[u+1]>>r,n[c+2]=a[u+2]>>r,n[c+3]=a[u+3]>>r}}Object.freeze(Object.defineProperty({__proto__:null,transformMat4:v_t,transformMat3:dOe,normalize:__t,scale:mK,shiftRight:w_t},Symbol.toStringTag,{value:"Module"}));function x_t(e,t,r){const i=e.typedBuffer,n=e.typedBufferStride,s=t.typedBuffer,a=t.typedBufferStride,o=r?r.count:t.count;let l=(r&&r.dstIndex?r.dstIndex:0)*n,c=(r&&r.srcIndex?r.srcIndex:0)*a;for(let u=0;u<o;++u){for(let h=0;h<9;++h)i[l+h]=s[c+h];l+=n,c+=a}}Object.freeze(Object.defineProperty({__proto__:null,copy:x_t},Symbol.toStringTag,{value:"Module"}));function T_t(e,t,r){const i=e.typedBuffer,n=e.typedBufferStride,s=t.typedBuffer,a=t.typedBufferStride,o=r?r.count:t.count;let l=(r&&r.dstIndex?r.dstIndex:0)*n,c=(r&&r.srcIndex?r.srcIndex:0)*a;for(let u=0;u<o;++u){for(let h=0;h<16;++h)i[l+h]=s[c+h];l+=n,c+=a}}Object.freeze(Object.defineProperty({__proto__:null,copy:T_t},Symbol.toStringTag,{value:"Module"}));function S_t(e,t,r){const i=e.typedBuffer,n=e.typedBufferStride,s=t.typedBuffer,a=t.typedBufferStride,o=r?r.count:t.count;let l=(r&&r.dstIndex?r.dstIndex:0)*n,c=(r&&r.srcIndex?r.srcIndex:0)*a;for(let u=0;u<o;++u)i[l]=s[c],l+=n,c+=a}function mD(e,t){const r=e.count;t||(t=new e.TypedArrayConstructor(r));for(let i=0;i<r;i++)t[i]=e.get(i);return t}Object.freeze(Object.defineProperty({__proto__:null,copy:S_t,makeDense:mD},Symbol.toStringTag,{value:"Module"}));function uOe(e,t,r){const i=e.typedBuffer,n=e.typedBufferStride,s=t.typedBuffer,a=t.typedBufferStride,o=r?r.count:t.count;let l=(r&&r.dstIndex?r.dstIndex:0)*n,c=(r&&r.srcIndex?r.srcIndex:0)*a;for(let u=0;u<o;++u)i[l]=s[c],i[l+1]=s[c+1],l+=n,c+=a}function hOe(e,t,r){const i=e.typedBuffer,n=e.typedBufferStride,s=t.typedBuffer,a=t.typedBufferStride,o=r?r.count:t.count;let l=(r&&r.dstIndex?r.dstIndex:0)*n,c=(r&&r.srcIndex?r.srcIndex:0)*a;if(xdt(t.elementType)){const u=Tdt(t.elementType);if(wdt(t.elementType))for(let h=0;h<o;++h)i[l]=Math.max(s[c]/u,-1),i[l+1]=Math.max(s[c+1]/u,-1),l+=n,c+=a;else for(let h=0;h<o;++h)i[l]=s[c]/u,i[l+1]=s[c+1]/u,l+=n,c+=a}else uOe(e,t,r);return e}function E_t(e,t,r,i){var l,c;const n=e.typedBuffer,s=e.typedBufferStride,a=(l=i==null?void 0:i.count)!=null?l:e.count;let o=((c=i==null?void 0:i.dstIndex)!=null?c:0)*s;for(let u=0;u<a;++u)n[o]=t,n[o+1]=r,o+=s}Object.freeze(Object.defineProperty({__proto__:null,copy:uOe,normalizeIntegerBuffer:hOe,fill:E_t},Symbol.toStringTag,{value:"Module"}));function RU(e,t,r){const i=e.typedBuffer,n=e.typedBufferStride,s=t.typedBuffer,a=t.typedBufferStride,o=r?r.count:t.count;let l=(r&&r.dstIndex?r.dstIndex:0)*n,c=(r&&r.srcIndex?r.srcIndex:0)*a;for(let u=0;u<o;++u)i[l]=s[c],i[l+1]=s[c+1],i[l+2]=s[c+2],l+=n,c+=a}function C_t(e,t,r,i,n){var c,u;const s=e.typedBuffer,a=e.typedBufferStride,o=(c=n==null?void 0:n.count)!=null?c:e.count;let l=((u=n==null?void 0:n.dstIndex)!=null?u:0)*a;for(let h=0;h<o;++h)s[l]=t,s[l+1]=r,s[l+2]=i,l+=a}Object.freeze(Object.defineProperty({__proto__:null,copy:RU,fill:C_t},Symbol.toStringTag,{value:"Module"}));function fOe(e,t,r){const i=e.typedBuffer,n=e.typedBufferStride,s=t.typedBuffer,a=t.typedBufferStride,o=r?r.count:t.count;let l=(r&&r.dstIndex?r.dstIndex:0)*n,c=(r&&r.srcIndex?r.srcIndex:0)*a;for(let u=0;u<o;++u)i[l]=s[c],i[l+1]=s[c+1],i[l+2]=s[c+2],i[l+3]=s[c+3],l+=n,c+=a}function pOe(e,t,r,i,n,s){var u,h;const a=e.typedBuffer,o=e.typedBufferStride,l=(u=s==null?void 0:s.count)!=null?u:e.count;let c=((h=s==null?void 0:s.dstIndex)!=null?h:0)*o;for(let p=0;p<l;++p)a[c]=t,a[c+1]=r,a[c+2]=i,a[c+3]=n,c+=o}Object.freeze(Object.defineProperty({__proto__:null,copy:fOe,fill:pOe},Symbol.toStringTag,{value:"Module"}));function M3(e,t){return new e(new ArrayBuffer(t*e.ElementCount*yCe(e.ElementType)))}class mOe{constructor(t){this.streamDataRequester=t}async loadJSON(t,r){return this._load("json",t,r)}async loadBinary(t,r){return Tm(t)?(Et(r),$3e(t)):this._load("binary",t,r)}async loadImage(t,r){return this._load("image",t,r)}async _load(t,r,i){if(R(this.streamDataRequester))return(await qt(r,{responseType:A_t[t]})).data;const n=await Tu(this.streamDataRequester.request(r,t,i));if(n.ok===!0)return n.value;throw pu(n.error),new k("",`Request for resource failed: ${n.error}`)}}const A_t={image:"image",binary:"array-buffer",json:"json"},R_t=fe.getLogger("esri.views.3d.glTF");class O_t{error(t){throw new k("gltf-loader-error",t)}errorUnsupported(t){throw new k("gltf-loader-unsupported-feature",t)}errorUnsupportedIf(t,r){t&&this.errorUnsupported(r)}assert(t,r){t||this.error(r)}warn(t){R_t.warn(t)}warnUnsupported(t){this.warn("[Unsupported Feature] "+t)}warnUnsupportedIf(t,r){t&&this.warnUnsupported(r)}}function M_t(e={}){return{color:[1,1,1],opacity:1,alphaMode:"OPAQUE",alphaCutoff:.5,doubleSided:!1,castShadows:!0,receiveShadows:!0,receiveAmbientOcclustion:!0,textureColor:null,textureNormal:null,textureOcclusion:null,textureEmissive:null,textureMetallicRoughness:null,emissiveFactor:[0,0,0],metallicFactor:1,roughnessFactor:1,colorMixMode:"multiply",...e}}function P_t(e,t={}){return{data:e,parameters:{wrap:{s:xt.REPEAT,t:xt.REPEAT,...t.wrap},noUnpackFlip:!0,mipmap:!1,...t}}}class dx{constructor(t,r,i=""){this.major=t,this.minor=r,this._context=i}lessThan(t,r){return this.major<t||t===this.major&&this.minor<r}since(t,r){return!this.lessThan(t,r)}validate(t){if(this.major!==t.major){const r=this._context&&this._context+":",i=this._context&&this._context+" ";throw new k(r+"unsupported-version",`Required major ${i}version is '${this.major}', but got '\${version.major}.\${version.minor}'`,{version:t})}}clone(){return new dx(this.major,this.minor,this._context)}static parse(t,r=""){const[i,n]=t.split("."),s=/^\s*\d+\s*$/;if(!i||!i.match||!i.match(s))throw new k((r&&r+":")+"invalid-version","Expected major version to be a number, but got '${version}'",{version:t});if(!n||!n.match||!n.match(s))throw new k((r&&r+":")+"invalid-version","Expected minor version to be a number, but got '${version}'",{version:t});const a=parseInt(i,10),o=parseInt(n,10);return new dx(a,o,r)}}class pge{constructor(t){this.data=t,this.offset4=0,this.dataUint32=new Uint32Array(this.data,0,Math.floor(this.data.byteLength/4))}readUint32(){const t=this.offset4;return this.offset4+=1,this.dataUint32[t]}readUint8Array(t){const r=4*this.offset4;return this.offset4+=t/4,new Uint8Array(this.data,r,t)}remainingBytes(){return this.data.byteLength-4*this.offset4}}var x7,mge;(function(e){e.SCALAR="SCALAR",e.VEC2="VEC2",e.VEC3="VEC3",e.VEC4="VEC4",e.MAT2="MAT2",e.MAT3="MAT3",e.MAT4="MAT4"})(x7||(x7={})),function(e){e[e.ARRAY_BUFFER=34962]="ARRAY_BUFFER",e[e.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER"}(mge||(mge={}));const gOe={baseColorFactor:[1,1,1,1],metallicFactor:1,roughnessFactor:1},I_t={pbrMetallicRoughness:gOe,emissiveFactor:[0,0,0],alphaMode:"OPAQUE",alphaCutoff:.5,doubleSided:!1},$_t={ESRI_externalColorMixMode:"tint"},gge=(e={})=>{const t={...gOe,...e.pbrMetallicRoughness},r=L_t({...$_t,...e.extras});return{...I_t,...e,pbrMetallicRoughness:t,extras:r}};function L_t(e){switch(e.ESRI_externalColorMixMode){case"multiply":case"tint":case"ignore":case"replace":break;default:e.ESRI_externalColorMixMode,e.ESRI_externalColorMixMode="tint"}return e}const D_t={magFilter:tt.LINEAR,minFilter:tt.LINEAR_MIPMAP_LINEAR,wrapS:xt.REPEAT,wrapT:xt.REPEAT},F_t=e=>({...D_t,...e});function N_t(e){let t,r;return e.replace(/^(.*\/)?([^/]*)$/,(i,n,s)=>(t=n||"",r=s||"","")),{dirPart:t,filePart:r}}const yI={MAGIC:1179937895,CHUNK_TYPE_JSON:1313821514,CHUNK_TYPE_BIN:5130562,MIN_HEADER_LENGTH:20};class Ng{constructor(t,r,i,n,s){this.context=t,this.errorContext=r,this.uri=i,this.json=n,this.glbBuffer=s,this.bufferLoaders=new Map,this.textureLoaders=new Map,this.textureCache=new Map,this.materialCache=new Map,this.nodeParentMap=new Map,this.nodeTransformCache=new Map,this.baseUri=N_t(this.uri).dirPart,this._checkVersionSupported(),this._checkRequiredExtensionsSupported(),r.errorUnsupportedIf(n.scenes==null,"Scenes must be defined."),r.errorUnsupportedIf(n.meshes==null,"Meshes must be defined"),r.errorUnsupportedIf(n.nodes==null,"Nodes must be defined."),this._computeNodeParents()}static async load(t,r,i,n){if(Tm(i)){const o=hV(i);if(o.mediaType!=="model/gltf-binary")try{const c=JSON.parse(o.isBase64?atob(o.data):o.data);return new Ng(t,r,i,c)}catch{}const l=$3e(i);if(Ng._isGLBData(l))return this._fromGLBData(t,r,i,l)}if(i.endsWith(".gltf")){const o=await t.loadJSON(i,n);return new Ng(t,r,i,o)}const s=await t.loadBinary(i,n);if(Ng._isGLBData(s))return this._fromGLBData(t,r,i,s);const a=await t.loadJSON(i,n);return new Ng(t,r,i,a)}static _isGLBData(t){const r=new pge(t);return r.remainingBytes()>=4&&r.readUint32()===yI.MAGIC}static async _fromGLBData(t,r,i,n){const s=await Ng._parseGLBData(r,n);return new Ng(t,r,i,s.json,s.binaryData)}static async _parseGLBData(t,r){const i=new pge(r);t.assert(i.remainingBytes()>=12,"GLB binary data is insufficiently large.");const n=i.readUint32(),s=i.readUint32(),a=i.readUint32();t.assert(n===yI.MAGIC,"Magic first 4 bytes do not fit to expected GLB value."),t.assert(r.byteLength>=a,"GLB binary data is smaller than header specifies."),t.errorUnsupportedIf(s!==2,"An unsupported GLB container version was detected. Only version 2 is supported.");let o,l,c=0;for(;i.remainingBytes()>=8;){const u=i.readUint32(),h=i.readUint32();c===0?(t.assert(h===yI.CHUNK_TYPE_JSON,"First GLB chunk must be JSON."),t.assert(u>=0,"No JSON data found."),o=await G_t(i.readUint8Array(u))):c===1?(t.errorUnsupportedIf(h!==yI.CHUNK_TYPE_BIN,"Second GLB chunk expected to be BIN."),l=i.readUint8Array(u)):t.warnUnsupported("More than 2 GLB chunks detected. Skipping."),c+=1}return o||t.error("No GLB JSON chunk detected."),{json:o,binaryData:l}}async getBuffer(t,r){const i=this.json.buffers[t],n=this.errorContext;if(i.uri==null)return n.assert(this.glbBuffer!=null,"GLB buffer not present"),this.glbBuffer;const s=await this._getBufferLoader(t,r);return n.assert(s.byteLength===i.byteLength,"Buffer byte lengths should match."),s}async _getBufferLoader(t,r){const i=this.bufferLoaders.get(t);if(i)return i;const n=this.json.buffers[t],s=this.context.loadBinary(this._resolveUri(n.uri),r).then(a=>new Uint8Array(a));return this.bufferLoaders.set(t,s),s}async getAccessor(t,r){const i=this.errorContext;i.errorUnsupportedIf(!this.json.accessors,"Accessors missing.");const n=this.json.accessors[t];i.errorUnsupportedIf((n==null?void 0:n.bufferView)==null,"Some accessor does not specify a bufferView."),i.errorUnsupportedIf(n.type in[x7.MAT2,x7.MAT3,x7.MAT4],`AttributeType ${n.type} is not supported`);const s=this.json.bufferViews[n.bufferView],a=await this.getBuffer(s.buffer,r),o=z_t[n.type],l=U_t[n.componentType],c=o*l,u=s.byteStride||c;return{raw:a.buffer,byteStride:u,byteOffset:a.byteOffset+(s.byteOffset||0)+(n.byteOffset||0),entryCount:n.count,isDenselyPacked:u===c,componentCount:o,componentByteSize:l,componentType:n.componentType,min:n.min,max:n.max,normalized:!!n.normalized}}async getIndexData(t,r){if(t.indices==null)return null;const i=await this.getAccessor(t.indices,r);if(i.isDenselyPacked)switch(i.componentType){case ft.UNSIGNED_BYTE:return new Uint8Array(i.raw,i.byteOffset,i.entryCount);case ft.UNSIGNED_SHORT:return new Uint16Array(i.raw,i.byteOffset,i.entryCount);case ft.UNSIGNED_INT:return new Uint32Array(i.raw,i.byteOffset,i.entryCount)}else switch(i.componentType){case ft.UNSIGNED_BYTE:return mD(this._wrapAccessor(ky,i));case ft.UNSIGNED_SHORT:return mD(this._wrapAccessor(Qw,i));case ft.UNSIGNED_INT:return mD(this._wrapAccessor(Kw,i))}}async getPositionData(t,r){const i=this.errorContext;i.errorUnsupportedIf(t.attributes.POSITION==null,"No POSITION vertex data found.");const n=await this.getAccessor(t.attributes.POSITION,r);return i.errorUnsupportedIf(n.componentType!==ft.FLOAT,"Expected type FLOAT for POSITION vertex attribute, but found "+vI[n.componentType]),i.errorUnsupportedIf(n.componentCount!==3,"POSITION vertex attribute must have 3 components, but found "+n.componentCount.toFixed()),this._wrapAccessor(Zr,n)}async getNormalData(t,r){const i=this.errorContext;i.assert(t.attributes.NORMAL!=null,"No NORMAL vertex data found.");const n=await this.getAccessor(t.attributes.NORMAL,r);return i.errorUnsupportedIf(n.componentType!==ft.FLOAT,"Expected type FLOAT for NORMAL vertex attribute, but found "+vI[n.componentType]),i.errorUnsupportedIf(n.componentCount!==3,"NORMAL vertex attribute must have 3 components, but found "+n.componentCount.toFixed()),this._wrapAccessor(Zr,n)}async getTangentData(t,r){const i=this.errorContext;i.assert(t.attributes.TANGENT!=null,"No TANGENT vertex data found.");const n=await this.getAccessor(t.attributes.TANGENT,r);return i.errorUnsupportedIf(n.componentType!==ft.FLOAT,"Expected type FLOAT for TANGENT vertex attribute, but found "+vI[n.componentType]),i.errorUnsupportedIf(n.componentCount!==4,"TANGENT vertex attribute must have 4 components, but found "+n.componentCount.toFixed()),new ca(n.raw,n.byteOffset,n.byteStride,n.byteOffset+n.byteStride*n.entryCount)}async getTextureCoordinates(t,r){const i=this.errorContext;i.assert(t.attributes.TEXCOORD_0!=null,"No TEXCOORD_0 vertex data found.");const n=await this.getAccessor(t.attributes.TEXCOORD_0,r);return i.errorUnsupportedIf(n.componentCount!==2,"TEXCOORD_0 vertex attribute must have 2 components, but found "+n.componentCount.toFixed()),n.componentType===ft.FLOAT?this._wrapAccessor(ef,n):(i.errorUnsupportedIf(!n.normalized,"Integer component types are only supported for a normalized accessor for TEXCOORD_0."),B_t(n))}async getVertexColors(t,r){const i=this.errorContext;i.assert(t.attributes.COLOR_0!=null,"No COLOR_0 vertex data found.");const n=await this.getAccessor(t.attributes.COLOR_0,r);if(i.errorUnsupportedIf(n.componentCount!==4&&n.componentCount!==3,"COLOR_0 attribute must have 3 or 4 components, but found "+n.componentCount.toFixed()),n.componentCount===4){if(n.componentType===ft.FLOAT)return this._wrapAccessor(ca,n);if(n.componentType===ft.UNSIGNED_BYTE)return this._wrapAccessor(pc,n);if(n.componentType===ft.UNSIGNED_SHORT)return this._wrapAccessor(r_,n)}else if(n.componentCount===3){if(n.componentType===ft.FLOAT)return this._wrapAccessor(Zr,n);if(n.componentType===ft.UNSIGNED_BYTE)return this._wrapAccessor(t_,n);if(n.componentType===ft.UNSIGNED_SHORT)return this._wrapAccessor(Jw,n)}i.errorUnsupported("Unsupported component type for COLOR_0 attribute: "+vI[n.componentType])}hasPositions(t){return t.attributes.POSITION!==void 0}hasNormals(t){return t.attributes.NORMAL!==void 0}hasVertexColors(t){return t.attributes.COLOR_0!==void 0}hasTextureCoordinates(t){return t.attributes.TEXCOORD_0!==void 0}hasTangents(t){return t.attributes.TANGENT!==void 0}async getMaterial(t,r,i){let n=this.materialCache.get(t.material);if(!n){const s=t.material!=null?gge(this.json.materials[t.material]):gge(),a=s.pbrMetallicRoughness,o=this.hasVertexColors(t),l=this.getTexture(a.baseColorTexture,r),c=this.getTexture(s.normalTexture,r),u=i?this.getTexture(s.occlusionTexture,r):null,h=i?this.getTexture(s.emissiveTexture,r):null,p=i?this.getTexture(a.metallicRoughnessTexture,r):null,m=t.material!=null?t.material:-1;n={alphaMode:s.alphaMode,alphaCutoff:s.alphaCutoff,color:a.baseColorFactor,doubleSided:!!s.doubleSided,colorTexture:await l,normalTexture:await c,name:s.name,id:m,occlusionTexture:await u,emissiveTexture:await h,emissiveFactor:s.emissiveFactor,metallicFactor:a.metallicFactor,roughnessFactor:a.roughnessFactor,metallicRoughnessTexture:await p,hasVertexColors:o,ESRI_externalColorMixMode:s.extras.ESRI_externalColorMixMode}}return n}async getTexture(t,r){if(!t)return null;this.errorContext.errorUnsupportedIf((t.texCoord||0)!==0,"Only TEXCOORD with index 0 is supported.");const i=t.index,n=this.errorContext,s=this.json.textures[i],a=F_t(s.sampler!=null?this.json.samplers[s.sampler]:{});n.errorUnsupportedIf(s.source==null,"Source is expected to be defined for a texture.");const o=this.json.images[s.source],l=await this._loadTextureImageData(i,s,r);return Ote(this.textureCache,i,()=>{const c=h=>h===33071||h===33648||h===10497,u=h=>(n.error(`Unexpected TextureSampler WrapMode: ${h}. Using default REPEAT(10497).`),10497);return{data:l,wrapS:c(a.wrapS)?a.wrapS:u(a.wrapS),wrapT:c(a.wrapT)?a.wrapT:u(a.wrapT),minFilter:a.minFilter,name:o.name,id:i}})}getNodeTransform(t){if(t===void 0)return V_t;let r=this.nodeTransformCache.get(t);if(!r){const i=this.getNodeTransform(this._getNodeParent(t)),n=this.json.nodes[t];n.matrix?r=Zi(Ae(),i,n.matrix):n.translation||n.rotation||n.scale?(r=dw(i),n.translation&&wl(r,r,n.translation),n.rotation&&(bI[3]=GEe(bI,n.rotation),rd(r,r,bI[3],bI)),n.scale&&DV(r,r,n.scale)):r=i,this.nodeTransformCache.set(t,r)}return r}_wrapAccessor(t,r){return new t(r.raw,r.byteOffset,r.byteStride,r.byteOffset+r.byteStride*(r.entryCount-1)+r.componentByteSize*r.componentCount)}_resolveUri(t){return Fh(t,this.baseUri)}_getNodeParent(t){return this.nodeParentMap.get(t)}_checkVersionSupported(){const t=dx.parse(this.json.asset.version,"glTF");k_t.validate(t)}_checkRequiredExtensionsSupported(){const t=this.json,r=this.errorContext;t.extensionsRequired&&t.extensionsRequired.length!==0&&r.errorUnsupported("gltf loader was not able to load unsupported feature. Required extensions: "+t.extensionsRequired.join(", "))}_computeNodeParents(){this.json.nodes.forEach((t,r)=>{t.children&&t.children.forEach(i=>{this.nodeParentMap.set(i,r)})})}async _loadTextureImageData(t,r,i){const n=this.textureLoaders.get(t);if(n)return n;const s=this._createTextureLoader(r,i);return this.textureLoaders.set(t,s),s}async _createTextureLoader(t,r){const i=this.json.images[t.source];if(i.uri)return this.context.loadImage(this._resolveUri(i.uri),r);const n=this.errorContext;n.errorUnsupportedIf(i.bufferView==null,"Image bufferView must be defined."),n.errorUnsupportedIf(i.mimeType==null,"Image mimeType must be defined.");const s=this.json.bufferViews[i.bufferView],a=await this.getBuffer(s.buffer,r);return n.errorUnsupportedIf(s.byteStride!=null,"byteStride not supported for image buffer"),j_t(new Uint8Array(a.buffer,a.byteOffset+(s.byteOffset||0),s.byteLength),i.mimeType)}}const k_t=new dx(2,0,"glTF"),V_t=wTe(Ae(),Math.PI/2),bI=qy(),z_t={SCALAR:1,VEC2:2,VEC3:3,VEC4:4},U_t={[ft.BYTE]:1,[ft.UNSIGNED_BYTE]:1,[ft.SHORT]:2,[ft.UNSIGNED_SHORT]:2,[ft.FLOAT]:4,[ft.UNSIGNED_INT]:4};function B_t(e){switch(e.componentType){case ft.BYTE:return new ex(e.raw,e.byteOffset,e.byteStride,e.byteOffset+e.byteStride*e.entryCount);case ft.UNSIGNED_BYTE:return new Zw(e.raw,e.byteOffset,e.byteStride,e.byteOffset+e.byteStride*e.entryCount);case ft.SHORT:return new tx(e.raw,e.byteOffset,e.byteStride,e.byteOffset+e.byteStride*e.entryCount);case ft.UNSIGNED_SHORT:return new w9(e.raw,e.byteOffset,e.byteStride,e.byteOffset+e.byteStride*e.entryCount);case ft.UNSIGNED_INT:return new x9(e.raw,e.byteOffset,e.byteStride,e.byteOffset+e.byteStride*e.entryCount);case ft.FLOAT:return new ef(e.raw,e.byteOffset,e.byteStride,e.byteOffset+e.byteStride*e.entryCount);default:return void(e.componentType,void 0)}}async function G_t(e){return new Promise((t,r)=>{const i=new Blob([e]),n=new FileReader;n.onload=()=>{const s=n.result;t(JSON.parse(s))},n.onerror=s=>{r(s)},n.readAsText(i)})}async function j_t(e,t){return new Promise((r,i)=>{const n=new Blob([e],{type:t}),s=URL.createObjectURL(n),a=new Image;a.addEventListener("load",()=>{URL.revokeObjectURL(s),"decode"in a?a.decode().then(()=>r(a),()=>r(a)):r(a)}),a.addEventListener("error",o=>{URL.revokeObjectURL(s),i(o)}),a.src=s})}const vI={5120:"BYTE",5121:"UNSIGNED_BYTE",5122:"SHORT",5123:"UNSIGNED_SHORT",5125:"UNSIGNED_INT",5126:"FLOAT"};let q_t=0;async function yOe(e,t,r={},i=!0){const n=await Ng.load(e,gD,t,r),s="gltf_"+q_t++,a={lods:[],materials:new Map,textures:new Map,meta:H_t(n)},o=!(!n.json.asset.extras||n.json.asset.extras.ESRI_type!=="symbolResource"),l=new Map;await W_t(n,async(c,u,h,p)=>{var L;const m=(L=l.get(h))!=null?L:0;l.set(h,m+1);const g=c.mode!==void 0?c.mode:Dt.TRIANGLES,b=g===Dt.TRIANGLES||g===Dt.TRIANGLE_STRIP||g===Dt.TRIANGLE_FAN?g:null;if(R(b))return void gD.warnUnsupported("Unsupported primitive mode ("+Q_t[g]+"). Skipping primitive.");if(!n.hasPositions(c))return void gD.warn("Skipping primitive without POSITION vertex attribute.");const w=n.getPositionData(c,r),v=n.getMaterial(c,r,i),x=n.hasNormals(c)?n.getNormalData(c,r):null,T=n.hasTangents(c)?n.getTangentData(c,r):null,E=n.hasTextureCoordinates(c)?n.getTextureCoordinates(c,r):null,C=n.hasVertexColors(c)?n.getVertexColors(c,r):null,A=n.getIndexData(c,r),P={transform:dw(u),attributes:{position:await w,normal:x?await x:null,texCoord0:E?await E:null,color:C?await C:null,tangent:T?await T:null},indices:await A,primitiveType:b,material:Y_t(a,await v,s)};let I=null;_(a.meta)&&_(a.meta.ESRI_lod)&&a.meta.ESRI_lod.metric==="screenSpaceRadius"&&(I=a.meta.ESRI_lod.thresholds[h]),a.lods[h]=a.lods[h]||{parts:[],name:p,lodThreshold:I},a.lods[h].parts[m]=P});for(const c of a.lods)c.parts=c.parts.filter(u=>!!u);return{model:a,meta:{isEsriSymbolResource:o,uri:n.uri},customMeta:{}}}function H_t(e){const t=e.json;let r=null;return t.nodes.forEach(i=>{const n=i.extras;_(n)&&(n.ESRI_proxyEllipsoid||n.ESRI_lod)&&(r=n)}),r}async function W_t(e,t){const r=e.json,i=r.scenes[r.scene||0].nodes,n=i.length>1,s=[];for(const o of i){const l=r.nodes[o];s.push(a(o,0)),X_t(l)&&!n&&l.extensions.MSFT_lod.ids.forEach((c,u)=>a(c,u+1))}async function a(o,l){const c=r.nodes[o],u=e.getNodeTransform(o);if(gD.warnUnsupportedIf(c.weights!=null,"Morph targets are not supported."),c.mesh!=null){const h=r.meshes[c.mesh];for(const p of h.primitives)s.push(t(p,u,l,h.name))}for(const h of c.children||[])s.push(a(h,l))}await Promise.all(s)}function X_t(e){return e.extensions&&e.extensions.MSFT_lod&&Array.isArray(e.extensions.MSFT_lod.ids)}function Y_t(e,t,r){const i=s=>{const a=`${r}_tex_${s&&s.id}${s&&s.name?"_"+s.name:""}`;if(s&&!e.textures.has(a)){const o=P_t(s.data,{wrap:{s:s.wrapS,t:s.wrapT},mipmap:Z_t.includes(s.minFilter),noUnpackFlip:!0});e.textures.set(a,o)}return a},n=`${r}_mat_${t.id}_${t.name}`;if(!e.materials.has(n)){const s=M_t({color:[t.color[0],t.color[1],t.color[2]],opacity:t.color[3],alphaMode:t.alphaMode,alphaCutoff:t.alphaCutoff,doubleSided:t.doubleSided,colorMixMode:t.ESRI_externalColorMixMode,textureColor:t.colorTexture?i(t.colorTexture):void 0,textureNormal:t.normalTexture?i(t.normalTexture):void 0,textureOcclusion:t.occlusionTexture?i(t.occlusionTexture):void 0,textureEmissive:t.emissiveTexture?i(t.emissiveTexture):void 0,textureMetallicRoughness:t.metallicRoughnessTexture?i(t.metallicRoughnessTexture):void 0,emissiveFactor:[t.emissiveFactor[0],t.emissiveFactor[1],t.emissiveFactor[2]],metallicFactor:t.metallicFactor,roughnessFactor:t.roughnessFactor});e.materials.set(n,s)}return n}const gD=new O_t,Z_t=[tt.LINEAR_MIPMAP_LINEAR,tt.LINEAR_MIPMAP_NEAREST],Q_t=["POINTS","LINES","LINE_LOOP","LINE_STRIP","TRIANGLES","TRIANGLE_STRIP","TRIANGLE_FAN"];function J_t(e,t=S9){return typeof e=="number"?t(e):pF(e)||f3(e)?new Uint32Array(e):e}function K_t(e){const t=typeof e=="number"?e:e.length;if(t<3)return new Uint16Array(0);const r=t-2,i=r<=65536?new Uint16Array(3*r):new Uint32Array(3*r);if(typeof e=="number"){let n=0;for(let s=0;s<r;s+=1)s%2==0?(i[n++]=s,i[n++]=s+1,i[n++]=s+2):(i[n++]=s+1,i[n++]=s,i[n++]=s+2)}else{let n=0;for(let s=0;s<r;s+=1)if(s%2==0){const a=e[s],o=e[s+1],l=e[s+2];i[n++]=a,i[n++]=o,i[n++]=l}else{const a=e[s+1],o=e[s],l=e[s+2];i[n++]=a,i[n++]=o,i[n++]=l}}return i}function e2t(e){const t=typeof e=="number"?e:e.length;if(t<3)return new Uint16Array(0);const r=t-2,i=r<=65536?new Uint16Array(3*r):new Uint32Array(3*r);if(typeof e=="number"){let n=0;for(let s=0;s<r;++s)i[n++]=0,i[n++]=s+1,i[n++]=s+2;return i}{const n=e[0];let s=e[1],a=0;for(let o=0;o<r;++o){const l=e[o+2];i[a++]=n,i[a++]=s,i[a++]=l,s=l}return i}}const wg=fe.getLogger("esri.views.3d.layers.graphics.objectResourceUtils");async function bOe(e,t){const r=await t2t(e,t);return{resource:r,textures:await a2t(r.textureDefinitions,t)}}async function t2t(e,t){const r=_(t)&&t.streamDataRequester;if(r)return r2t(e,r,t);const i=await Tu(qt(e,t));if(i.ok===!0)return i.value.data;pu(i.error),vOe(i.error)}async function r2t(e,t,r){const i=await Tu(t.request(e,"json",r));if(i.ok===!0)return i.value;pu(i.error),vOe(i.error.details.url)}function vOe(e){throw new k("",`Request for object resource failed: ${e}`)}function i2t(e){const t=e.params,r=t.topology;let i=!0;switch(t.vertexAttributes||(wg.warn("Geometry must specify vertex attributes"),i=!1),t.topology){case"PerAttributeArray":break;case"Indexed":case null:case void 0:{const s=t.faces;if(s){if(t.vertexAttributes)for(const a in t.vertexAttributes){const o=s[a];o&&o.values?(o.valueType!=null&&o.valueType!=="UInt32"&&(wg.warn(`Unsupported indexed geometry indices type '${o.valueType}', only UInt32 is currently supported`),i=!1),o.valuesPerElement!=null&&o.valuesPerElement!==1&&(wg.warn(`Unsupported indexed geometry values per element '${o.valuesPerElement}', only 1 is currently supported`),i=!1)):(wg.warn(`Indexed geometry does not specify face indices for '${a}' attribute`),i=!1)}}else wg.warn("Indexed geometries must specify faces"),i=!1;break}default:wg.warn(`Unsupported topology '${r}'`),i=!1}e.params.material||(wg.warn("Geometry requires material"),i=!1);const n=e.params.vertexAttributes;for(const s in n)n[s].values||(wg.warn("Geometries with externally defined attributes are not yet supported"),i=!1);return i}function n2t(e,t){const r=[],i=[],n=[],s=[],a=e.resource,o=dx.parse(a.version||"1.0","wosr");l2t.validate(o);const l=a.model.name,c=a.model.geometries,u=a.materialDefinitions,h=e.textures;let p=0;const m=new Map;for(let g=0;g<c.length;g++){const b=c[g];if(!i2t(b))continue;const w=o2t(b),v=b.params.vertexAttributes,x=[];for(const L in v){const V=v[L],G=V.values;x.push([L,{data:G,size:V.valuesPerElement,exclusive:!0}])}const T=[];if(b.params.topology!=="PerAttributeArray"){const L=b.params.faces;for(const V in L)T.push([V,new Uint32Array(L[V].values)])}const E=h&&h[w.texture];if(E&&!m.has(w.texture)){const{image:L,params:V}=E,G=new Hn(L,V);s.push(G),m.set(w.texture,G)}const C=m.get(w.texture),A=C?C.id:void 0;let P=n[w.material]?n[w.material][w.texture]:null;if(!P){const L=u[w.material.substring(w.material.lastIndexOf("/")+1)].params;L.transparency===1&&(L.transparency=0);const V=E&&E.alphaChannelUsage,G=L.transparency>0||V==="transparency"||V==="maskAndTransparency",B=E?_Oe(E.alphaChannelUsage):void 0,X={ambient:Wl(L.diffuse),diffuse:Wl(L.diffuse),opacity:1-(L.transparency||0),transparent:G,textureAlphaMode:B,textureAlphaCutoff:.33,textureId:A,initTextureTransparent:!0,doubleSided:!0,cullFace:pi.None,colorMixMode:L.externalColorMixMode||"tint",textureAlphaPremultiplied:!!E&&!!E.params.preMultiplyAlpha};_(t)&&t.materialParamsMixin&&Object.assign(X,t.materialParamsMixin),P=new lx(X),n[w.material]||(n[w.material]={}),n[w.material][w.texture]=P}i.push(P);const I=new Gi(x,T);p+=T.position?T.position.length:0,r.push(I)}return{name:l,stageResources:{textures:s,materials:i,geometries:r},pivotOffset:a.model.pivotOffset,boundingBox:s2t(r),numberOfVertices:p,lodThreshold:null}}function s2t(e){const t=bi();return e.forEach(r=>{const i=r.boundingInfo;_(i)&&(um(t,i.getBBMin()),um(t,i.getBBMax()))}),t}async function a2t(e,t){const r=[];for(const s in e){const a=e[s],o=a.images[0].data;if(!o){wg.warn("Externally referenced texture data is not yet supported");continue}const l=a.encoding+";base64,"+o,c="/textureDefinitions/"+s,u=a.channels==="rgba"?a.alphaChannelUsage||"transparency":"none",h={noUnpackFlip:!0,wrap:{s:xt.REPEAT,t:xt.REPEAT},preMultiplyAlpha:_Oe(u)!==ui.Opaque},p=_(t)&&t.disableTextures?Promise.resolve(null):Dp(l,t);r.push(p.then(m=>({refId:c,image:m,params:h,alphaChannelUsage:u})))}const i=await Promise.all(r),n={};for(const s of i)n[s.refId]=s;return n}function _Oe(e){switch(e){case"mask":return ui.Mask;case"maskAndTransparency":return ui.MaskBlend;case"none":return ui.Opaque;default:return ui.Blend}}function o2t(e){const t=e.params;return{id:1,material:t.material,texture:t.texture,region:t.texture}}const l2t=new dx(1,2,"wosr"),bT=2.1;async function wOe(e,t){const r=xOe(pK(e));if(r.fileType==="wosr"){const l=await(t.cache?t.cache.loadWOSR(r.url,t):bOe(r.url,t)),c=n2t(l,t);return{lods:[c],referenceBoundingBox:c.boundingBox,isEsriSymbolResource:!1,isWosr:!0,remove:l.remove}}const i=await(t.cache?t.cache.loadGLTF(r.url,t,t.usePBR):yOe(new mOe(t.streamDataRequester),r.url,t,t.usePBR)),n=Vi(i.model.meta,"ESRI_proxyEllipsoid");i.meta.isEsriSymbolResource&&_(n)&&i.meta.uri.includes("/RealisticTrees/")&&u2t(i,n);const s=i.meta.isEsriSymbolResource?{usePBR:t.usePBR,isSchematic:!1,treeRendering:!!i.customMeta.esriTreeRendering,mrrFactors:[0,1,.2]}:{usePBR:t.usePBR,isSchematic:!1,treeRendering:!1,mrrFactors:[0,1,.5]},a={...t.materialParamsMixin,treeRendering:!!i.customMeta.esriTreeRendering};if(r.specifiedLodIndex!=null){const l=yD(i,s,a,r.specifiedLodIndex);let c=l[0].boundingBox;return r.specifiedLodIndex!==0&&(c=yD(i,s,a,0)[0].boundingBox),{lods:l,referenceBoundingBox:c,isEsriSymbolResource:i.meta.isEsriSymbolResource,isWosr:!1,remove:i.remove}}const o=yD(i,s,a);return{lods:o,referenceBoundingBox:o[0].boundingBox,isEsriSymbolResource:i.meta.isEsriSymbolResource,isWosr:!1,remove:i.remove}}function xOe(e){const t=e.match(/(.*\.(gltf|glb))(\?lod=([0-9]+))?$/);return t?{fileType:"gltf",url:t[1],specifiedLodIndex:t[4]!=null?Number(t[4]):null}:e.match(/(.*\.(json|json\.gz))$/)?{fileType:"wosr",url:e,specifiedLodIndex:null}:{fileType:"unknown",url:e,specifiedLodIndex:null}}function yD(e,t,r,i){const n=e.model,s=Li(),a=new Array,o=new Map,l=new Map;return n.lods.forEach((c,u)=>{if(i!==void 0&&u!==i)return;const h={name:c.name,stageResources:{textures:new Array,materials:new Array,geometries:new Array},lodThreshold:_(c.lodThreshold)?c.lodThreshold:null,pivotOffset:[0,0,0],numberOfVertices:0,boundingBox:bi()};a.push(h),c.parts.forEach(p=>{const m=p.material+(p.attributes.normal?"_normal":"")+(p.attributes.color?"_color":"")+(p.attributes.texCoord0?"_texCoord0":"")+(p.attributes.tangent?"_tangent":""),g=n.materials.get(p.material),b=_(p.attributes.texCoord0),w=_(p.attributes.normal),v=c2t(g.alphaMode);if(!o.has(m)){if(b){if(_(g.textureColor)&&!l.has(g.textureColor)){const se=n.textures.get(g.textureColor),D={...se.parameters,preMultiplyAlpha:v!==ui.Opaque};l.set(g.textureColor,new Hn(se.data,D))}if(_(g.textureNormal)&&!l.has(g.textureNormal)){const se=n.textures.get(g.textureNormal);l.set(g.textureNormal,new Hn(se.data,se.parameters))}if(_(g.textureOcclusion)&&!l.has(g.textureOcclusion)){const se=n.textures.get(g.textureOcclusion);l.set(g.textureOcclusion,new Hn(se.data,se.parameters))}if(_(g.textureEmissive)&&!l.has(g.textureEmissive)){const se=n.textures.get(g.textureEmissive);l.set(g.textureEmissive,new Hn(se.data,se.parameters))}if(_(g.textureMetallicRoughness)&&!l.has(g.textureMetallicRoughness)){const se=n.textures.get(g.textureMetallicRoughness);l.set(g.textureMetallicRoughness,new Hn(se.data,se.parameters))}}const L=g.color[0]**(1/bT),V=g.color[1]**(1/bT),G=g.color[2]**(1/bT),B=g.emissiveFactor[0]**(1/bT),X=g.emissiveFactor[1]**(1/bT),Y=g.emissiveFactor[2]**(1/bT),ce=_(g.textureColor)&&b?l.get(g.textureColor):null;o.set(m,new lx({...t,transparent:v===ui.Blend,customDepthTest:qw.Lequal,textureAlphaMode:v,textureAlphaCutoff:g.alphaCutoff,diffuse:[L,V,G],ambient:[L,V,G],opacity:g.opacity,doubleSided:g.doubleSided,doubleSidedType:"winding-order",cullFace:g.doubleSided?pi.None:pi.Back,hasVertexColors:!!p.attributes.color,hasVertexTangents:!!p.attributes.tangent,normals:w?"default":"screenDerivative",castShadows:!0,receiveSSAO:!0,textureId:_(ce)?ce.id:void 0,colorMixMode:g.colorMixMode,normalTextureId:_(g.textureNormal)&&b?l.get(g.textureNormal).id:void 0,textureAlphaPremultiplied:_(ce)&&!!ce.params.preMultiplyAlpha,occlusionTextureId:_(g.textureOcclusion)&&b?l.get(g.textureOcclusion).id:void 0,emissiveTextureId:_(g.textureEmissive)&&b?l.get(g.textureEmissive).id:void 0,metallicRoughnessTextureId:_(g.textureMetallicRoughness)&&b?l.get(g.textureMetallicRoughness).id:void 0,emissiveFactor:[B,X,Y],mrrFactors:[g.metallicFactor,g.roughnessFactor,t.mrrFactors[2]],isSchematic:!1,...r}))}const x=d2t(p.indices||p.attributes.position.count,p.primitiveType),T=p.attributes.position.count,E=M3(Zr,T);PO(E,p.attributes.position,p.transform);const C=[[O.POSITION,{data:E.typedBuffer,size:E.elementCount,exclusive:!0}]],A=[[O.POSITION,x]];if(_(p.attributes.normal)){const L=M3(Zr,T);g9(s,p.transform),c_(L,p.attributes.normal,s),C.push([O.NORMAL,{data:L.typedBuffer,size:L.elementCount,exclusive:!0}]),A.push([O.NORMAL,x])}if(_(p.attributes.tangent)){const L=M3(ca,T);g9(s,p.transform),dOe(L,p.attributes.tangent,s),C.push([O.TANGENT,{data:L.typedBuffer,size:L.elementCount,exclusive:!0}]),A.push([O.TANGENT,x])}if(_(p.attributes.texCoord0)){const L=M3(ef,T);hOe(L,p.attributes.texCoord0),C.push([O.UV0,{data:L.typedBuffer,size:L.elementCount,exclusive:!0}]),A.push([O.UV0,x])}if(_(p.attributes.color)){const L=M3(pc,T);if(p.attributes.color.elementCount===4)p.attributes.color instanceof ca?mK(L,p.attributes.color,255):p.attributes.color instanceof pc?fOe(L,p.attributes.color):p.attributes.color instanceof r_&&mK(L,p.attributes.color,1/256);else{pOe(L,255,255,255,255);const V=new t_(L.buffer,0,4);p.attributes.color instanceof Zr?iK(V,p.attributes.color,255):p.attributes.color instanceof t_?RU(V,p.attributes.color):p.attributes.color instanceof Jw&&iK(V,p.attributes.color,1/256)}C.push([O.COLOR,{data:L.typedBuffer,size:L.elementCount,exclusive:!0}]),A.push([O.COLOR,x])}const P=new Gi(C,A);h.stageResources.geometries.push(P),h.stageResources.materials.push(o.get(m)),b&&(_(g.textureColor)&&h.stageResources.textures.push(l.get(g.textureColor)),_(g.textureNormal)&&h.stageResources.textures.push(l.get(g.textureNormal)),_(g.textureOcclusion)&&h.stageResources.textures.push(l.get(g.textureOcclusion)),_(g.textureEmissive)&&h.stageResources.textures.push(l.get(g.textureEmissive)),_(g.textureMetallicRoughness)&&h.stageResources.textures.push(l.get(g.textureMetallicRoughness))),h.numberOfVertices+=T;const I=P.boundingInfo;_(I)&&(um(h.boundingBox,I.getBBMin()),um(h.boundingBox,I.getBBMax()))})}),a}function c2t(e){switch(e){case"BLEND":return ui.Blend;case"MASK":return ui.Mask;case"OPAQUE":case null:case void 0:return ui.Opaque}}function d2t(e,t){switch(t){case Dt.TRIANGLES:return J_t(e);case Dt.TRIANGLE_STRIP:return K_t(e);case Dt.TRIANGLE_FAN:return e2t(e)}}function u2t(e,t){for(let r=0;r<e.model.lods.length;++r){const i=e.model.lods[r];e.customMeta.esriTreeRendering=!0;for(const n of i.parts){const s=n.attributes.normal;if(R(s))return;const a=n.attributes.position,o=a.count,l=M(),c=M(),u=M(),h=M3(pc,o),p=M3(Zr,o),m=Rn(Ae(),n.transform);for(let g=0;g<o;g++){a.getVec(g,c),s.getVec(g,l),ze(c,c,n.transform),pe(u,c,t.center),FF(u,u,t.radius);const b=u[2],w=Oe(u),v=Math.min(.45+.55*w*w,1);FF(u,u,t.radius),ze(u,u,m),we(u,u),r+1!==e.model.lods.length&&e.model.lods.length>1&&As(u,u,l,b>-1?.2:Math.min(-4*b-3.8,1)),p.setVec(g,u),h.set(g,0,255*v),h.set(g,1,255*v),h.set(g,2,255*v),h.set(g,3,255)}n.attributes.normal=p,n.attributes.color=h}}}const ZLt=Object.freeze(Object.defineProperty({__proto__:null,fetch:wOe,gltfToEngineResources:yD,parseUrl:xOe},Symbol.toStringTag,{value:"Module"}));var Oi;function h2t(e){let t=gn().mat4f64(O.LOCALTRANSFORM).mat4f64(O.GLOBALTRANSFORM).vec4f64(O.BOUNDINGSPHERE).vec3f64(O.MODELORIGIN).mat3f(O.MODEL).mat3f(O.MODELNORMAL).vec2f(O.MODELSCALEFACTORS);return e.includes("color")&&(t=t.vec4f(O.COLOR)),e.includes("featureAttribute")&&(t=t.vec4f(O.FEATUREATTRIBUTE)),t=t.u8(O.STATE).u8(O.LODLEVEL).alignTo(8),t}(function(e){e[e.ALLOCATED=1]="ALLOCATED",e[e.DEFAULT_ACTIVE=2]="DEFAULT_ACTIVE",e[e.VISIBLE=4]="VISIBLE",e[e.HIGHLIGHT=8]="HIGHLIGHT",e[e.HIGHLIGHT_ACTIVE=16]="HIGHLIGHT_ACTIVE",e[e.REMOVE=32]="REMOVE",e[e.TRANSFORM_CHANGED=64]="TRANSFORM_CHANGED",e[e.ACTIVE=18]="ACTIVE"})(Oi||(Oi={}));class f2t{constructor(t){this.localTransform=t.getField(O.LOCALTRANSFORM,e_),this.globalTransform=t.getField(O.GLOBALTRANSFORM,e_),this.modelOrigin=t.getField(O.MODELORIGIN,Nn),this.model=t.getField(O.MODEL,Fp),this.modelNormal=t.getField(O.MODELNORMAL,Fp),this.modelScaleFactors=t.getField(O.MODELSCALEFACTORS,ef),this.boundingSphere=t.getField(O.BOUNDINGSPHERE,Yw),this.color=t.getField(O.COLOR,ca),this.featureAttribute=t.getField(O.FEATUREATTRIBUTE,ca),this.state=t.getField(O.STATE,ky),this.lodLevel=t.getField(O.LODLEVEL,ky)}}class p2t extends mn{constructor(t,r){super(),this._capacity=0,this._size=0,this._next=0,this._layout=h2t(t),this._shaderTransformation=r}get capacity(){return this._capacity}get size(){return this._size}get buffer(){return this._buffer.buffer}get view(){return this._view}addInstance(){this._size+1>this._capacity&&this._grow();const t=this._findSlot();return this._view.state.set(t,Oi.ALLOCATED),this._size++,this.emit("instance-added",{index:t}),t}removeInstance(t){const r=this._view.state;pt(t>=0&&t<this._capacity&&r.get(t)&Oi.ALLOCATED,"invalid instance handle"),this._getStateFlag(t,Oi.ACTIVE)?this._setStateFlags(t,Oi.REMOVE):this.freeInstance(t),this.emit("instance-removed",{index:t})}freeInstance(t){const r=this._view.state;pt(t>=0&&t<this._capacity&&r.get(t)&Oi.ALLOCATED,"invalid instance handle"),r.set(t,0),this._size--}setLocalTransform(t,r,i=!0){this._view.localTransform.setMat(t,r),i&&this.updateModelTransform(t)}getLocalTransform(t,r){this._view.localTransform.getMat(t,r)}setGlobalTransform(t,r,i=!0){this._view.globalTransform.setMat(t,r),i&&this.updateModelTransform(t)}getGlobalTransform(t,r){this._view.globalTransform.getMat(t,r)}updateModelTransform(t){const r=this._view,i=Tb,n=yf;r.localTransform.getMat(t,yge),r.globalTransform.getMat(t,Bq);const s=Zi(Bq,Bq,yge);ne(i,s[12],s[13],s[14]),r.modelOrigin.setVec(t,i),Jh(n,s),r.model.setMat(t,n);const a=Eqe(Tb,s);a.sort(),r.modelScaleFactors.set(t,0,a[1]),r.modelScaleFactors.set(t,1,a[2]),Ix(n,n),Kh(n,n),r.modelNormal.setMat(t,n),this._setStateFlags(t,Oi.TRANSFORM_CHANGED),this.emit("instance-transform-changed",{index:t})}getModelTransform(t,r){const i=this._view;i.model.getMat(t,yf),i.modelOrigin.getVec(t,Tb),r[0]=yf[0],r[1]=yf[1],r[2]=yf[2],r[3]=0,r[4]=yf[3],r[5]=yf[4],r[6]=yf[5],r[7]=0,r[8]=yf[6],r[9]=yf[7],r[10]=yf[8],r[11]=0,r[12]=Tb[0],r[13]=Tb[1],r[14]=Tb[2],r[15]=1}applyShaderTransformation(t,r){this._shaderTransformation&&this._shaderTransformation.applyTransform(this,t,r)}getCombinedModelTransform(t,r){return this.getModelTransform(t,r),this._shaderTransformation&&this._shaderTransformation.applyTransform(this,t,r),r}getCombinedLocalTransform(t,r){return this._view.localTransform.getMat(t,r),this._shaderTransformation&&this._shaderTransformation.applyTransform(this,t,r),r}getCombinedMaxScaleFactor(t){let r=this._view.modelScaleFactors.get(t,1);if(this._shaderTransformation){const i=this._shaderTransformation.scaleFactor(Tb,this,t);r*=Math.max(i[0],i[1],i[2])}return r}getCombinedMedianScaleFactor(t){let r=this._view.modelScaleFactors.get(t,0);if(this._shaderTransformation){const i=this._shaderTransformation.scaleFactor(Tb,this,t);i.sort(),r*=i[1]}return r}getModel(t,r){this._view.model.getMat(t,r)}setFeatureAttribute(t,r){this._view.featureAttribute.setVec(t,r)}getFeatureAttribute(t,r){this._view.featureAttribute.getVec(t,r)}setColor(t,r){this._view.color.setVec(t,r)}getColor(t,r){this._view.color.getVec(t,r)}setVisible(t,r){r!==this.getVisible(t)&&(this._setStateFlag(t,Oi.VISIBLE,r),this.emit("instance-visibility-changed",{index:t}))}getVisible(t){return this._getStateFlag(t,Oi.VISIBLE)}setHighlight(t,r){r!==this.getHighlight(t)&&(this._setStateFlag(t,Oi.HIGHLIGHT,r),this.emit("instance-highlight-changed",{index:t}))}getHighlight(t){return this._getStateFlag(t,Oi.HIGHLIGHT)}getState(t){return this._view.state.get(t)}getLodLevel(t){return this._view.lodLevel.get(t)}countFlags(t){let r=0;for(let i=0;i<this._capacity;++i)this.getState(i)&t&&++r;return r}_setStateFlags(t,r){const i=this._view.state;r=i.get(t)|r,i.set(t,r)}_clearStateFlags(t,r){const i=this._view.state;r=i.get(t)&~r,i.set(t,r)}_setStateFlag(t,r,i){i?this._setStateFlags(t,r):this._clearStateFlags(t,r)}_getStateFlag(t,r){return!!(this._view.state.get(t)&r)}_grow(){const t=Math.max(m2t,Math.floor(this._capacity*g2t)),r=this._layout.createBuffer(t);if(this._buffer){const i=new Uint8Array(this._buffer.buffer);new Uint8Array(r.buffer).set(i)}this._capacity=t,this._buffer=r,this._view=new f2t(this._buffer)}_findSlot(){const t=this._view.state;let r=this._next;for(;t.get(r)&Oi.ALLOCATED;)r=(r+1)%this._capacity;return this._next=(r+1)%this._capacity,r}}const m2t=1024,g2t=2,Tb=M(),yf=Li(),yge=Ae(),Bq=Ae();class y2t extends vp{constructor(t,r){super(i=>this._instanceData.view.boundingSphere.getVec(i,this._tmpSphere),{maximumDepth:25}),this._tmpSphere=Us(),this._tmpMat4=Ae(),this._instanceData=t,this._boundingSphere=r}addInstance(t){const r=this._instanceData.view.boundingSphere,i=this._instanceData.getCombinedModelTransform(t,this._tmpMat4);ze(this._tmpSphere,this._boundingSphere.center,i),this._tmpSphere[3]=this._boundingSphere.radius*Vw(i),r.setVec(t,this._tmpSphere),this.add([t])}removeInstance(t){this.remove([t])}}class b2t{constructor(t,r){this.thresholdScale=1,this._camera=new ni,this._worldSpaceRadius=t,this._thresholds=r.map(i=>i)}updateCamera(t){this._camera.copyFrom(t)}selectLevel(t,r){const i=this._camera.computeScreenPixelSizeAt(t),n=this._worldSpaceRadius*r/i,s=this._thresholds;let a=-1;for(let o=0;o<s.length;++o)n>=s[o]*this.thresholdScale&&(a=o);return a}}class v2t{constructor(t,r){const i=t.renderContext.rctx,{geometry:n,material:s}=r;this._materialRepository=t.materialRep,s.setParameters({instancedDoublePrecision:!0});const a=s.createBufferWriter(),o=a.vertexBufferLayout,l=a.elementCount(n),c=a.allocate(l);a.write({},n,c,0),this.geometry=n,this.material=s,this.glMaterials=new rRe(s,this._materialRepository),this.vertexBufferLayout=o,this.vbo=dr.createVertex(i,Cr.STATIC_DRAW,c.buffer),this.vao=new ns(i,Ur,{geometry:vd(o)},{geometry:this.vbo}),this.vertexCount=l}destroy(){this.glMaterials.destroy(),this.vbo.dispose(),this.vao.dispose()}get boundingInfo(){return this.geometry.boundingInfo}get triangleCount(){return this.vertexCount/3}intersect(t,r,i,n,s,a,o,l){const c=this.geometry.id;this.material.intersect(this.geometry,null,t.transform.transform,t,i,n,(u,h,p,m,g)=>{if(u>=0){if(r!=null&&!r(t.rayBegin,t.rayEnd,u))return;const b={layerUid:a.layerUid,graphicUid:a.graphicUid(s),geometryId:c,triangleNr:p,baseBoundingSphere:o,numLodLevels:l};if((t.results.min.drapedLayerOrder==null||g>=t.results.min.drapedLayerOrder)&&(t.results.min.dist==null||u<t.results.min.dist)&&t.results.min.set(Wi.LOD,b,u,h,t.transform.transform,g),t.options.store!==Da.MIN&&(t.results.max.drapedLayerOrder==null||g>=t.results.max.drapedLayerOrder)&&(t.results.max.dist==null||u>t.results.max.dist)&&t.results.max.set(Wi.LOD,b,u,h,t.transform.transform,g),t.options.store===Da.ALL){const w=Ase(t.results.min.ray);w.set(Wi.LOD,b,u,h,t.transform.transform,g),t.results.all.push(w)}}})}}class Eae{constructor(t,r){this.minScreenSpaceRadius=t,this.components=r}static async create(t,r,i){const n=await Promise.allSettled(r.components.map(a=>t.schedule(()=>new v2t(t,a),i))),s=n.map(a=>a.status==="fulfilled"?a.value:null).filter(a=>a);if(bs(i)||s.length!==n.length){s.forEach(a=>a.destroy()),Et(i);for(const a of n)if(a.status==="rejected")throw a.reason}return new Eae(r.minScreenSpaceRadius,s)}destroy(){this.components.forEach(t=>t.destroy())}intersect(t,r,i,n,s,a,o){this.components.forEach(l=>l.intersect(t,r,i,n,s,a,this.boundingSphere,o))}get boundingBox(){if(R(this._boundingBox)){const t=bi();this.components.forEach(r=>{_(r.boundingInfo)&&(um(t,r.boundingInfo.bbMin),um(t,r.boundingInfo.bbMax))}),this._boundingBox=t}return this._boundingBox}get boundingSphere(){if(R(this._boundingSphere)){const t=this.boundingBox,r=M();fp(t,r),this._boundingSphere={center:r,radius:.5*Oxe(t)}}return this._boundingSphere}get triangleCount(){return this.components.reduce((t,r)=>t+r.triangleCount,0)}}class _2t{constructor(t,r,i){this._elementSize=r,this._buffer=dr.createVertex(t,Cr.STATIC_DRAW),this.resize(i)}destroy(){this._buffer.dispose()}get elementSize(){return this._elementSize}get capacity(){return this._capacity}get array(){return this._array}get buffer(){return this._buffer}get memoryUsage(){return{cpu:this._capacity*this._elementSize,gpu:this._capacity*this._elementSize}}copyRange(t,r,i,n=0){const s=new Uint8Array(this.array,t*this.elementSize,(r-t)*this.elementSize);new Uint8Array(i.array,n*this.elementSize).set(s)}transferAll(){this._buffer.setData(this._array)}transferRange(t,r){const i=t*this._elementSize,n=r*this._elementSize;this._buffer.setSubData(this._array,i,i,n)}resize(t){const r=t*this._elementSize,i=new ArrayBuffer(r);this._array&&(t>=this._capacity?new Uint8Array(i).set(new Uint8Array(this._array)):new Uint8Array(i).set(new Uint8Array(this._array).subarray(0,t*this._elementSize))),this._array=i,this._buffer.setSize(r),this._capacity=t}}class w2t{constructor(t){this.modelOriginHi=t.getField(O.MODELORIGINHI,Zr),this.modelOriginLo=t.getField(O.MODELORIGINLO,Zr),this.model=t.getField(O.MODEL,Fp),this.modelNormal=t.getField(O.MODELNORMAL,Fp),this.color=t.getField(O.INSTANCECOLOR,ca),this.featureAttribute=t.getField(O.INSTANCEFEATUREATTRIBUTE,ca)}}class bge{constructor(t,r){this._headIndex=0,this._tailIndex=0,this._captureFirstIndex=!0,this._updating=!1,this._prevHeadIndex=0,this._resized=!1,this._rctx=t,this._instanceBufferLayout=r,this._elementSize=r.stride,this._capacity=1}destroy(){this._buffer&&this._buffer.destroy()}get buffer(){return this._buffer.buffer}get view(){return this._view}get capacity(){return this._capacity}get size(){const t=this._headIndex,r=this._tailIndex;return t>=r?t-r:t+this._capacity-r}get isEmpty(){return this._headIndex===this._tailIndex}get isFull(){return this._tailIndex===(this._headIndex+1)%this._capacity}get headIndex(){return this._headIndex}get tailIndex(){return this._tailIndex}get firstIndex(){return this._firstIndex}get memoryUsage(){return this._buffer?this._buffer.memoryUsage:{cpu:0,gpu:0}}reset(){this._headIndex=0,this._tailIndex=0,this._firstIndex=null}startUpdateCylce(){this._captureFirstIndex=!0}beginUpdate(){pt(!this._updating,"already updating"),this._updating=!0,this._prevHeadIndex=this._headIndex}endUpdate(){pt(this._updating,"not updating"),this.size<T2t*this.capacity&&this._shrink(),this._resized?(this._buffer.transferAll(),this._resized=!1):this._transferRange(this._prevHeadIndex,this._headIndex),this._updating=!1}allocateHead(){pt(this._updating,"not updating"),this.isFull&&this._grow();const t=this.headIndex;return this._captureFirstIndex&&(this._firstIndex=t,this._captureFirstIndex=!1),this._incrementHead(),pt(this._headIndex!==this._tailIndex,"invalid pointers"),t}freeTail(){pt(this._updating,"not updating"),pt(this.size>0,"invalid size");const t=this._tailIndex===this._firstIndex;this._incrementTail(),t&&(this._firstIndex=this._tailIndex)}_grow(){const t=Math.max(vge,Math.floor(this._capacity*x2t));this._resize(t)}_shrink(){const t=Math.max(vge,Math.floor(this._capacity*S2t));this._resize(t)}_resize(t){if(pt(this._updating,"not updating"),t===this._capacity)return;const r=new _2t(this._rctx,this._elementSize,t);if(this._buffer){this._firstIndex&&(this._firstIndex=(this._firstIndex+this._capacity-this._tailIndex)%this._capacity);const i=this.size,n=this._compactInstances(r);pt(n===i,"invalid compaction"),this._buffer.destroy(),this._tailIndex=0,this._headIndex=n,this._prevHeadIndex=0}this._resized=!0,this._capacity=t,this._buffer=r,this._view=new w2t(this._instanceBufferLayout.createView(this._buffer.array))}_compactInstances(t){const r=this._headIndex,i=this._tailIndex;return i<r?(this._buffer.copyRange(i,r,t),r-i):i>r?(this._buffer.copyRange(i,this._capacity,t),r>0&&this._buffer.copyRange(0,r,t,this._capacity-i),r+(this._capacity-i)):0}_incrementHead(t=1){this._headIndex=(this._headIndex+t)%this._capacity}_incrementTail(t=1){this._tailIndex=(this._tailIndex+t)%this._capacity}_transferRange(t,r){t<r?this._buffer.transferRange(t,r):t>r&&(r>0&&this._buffer.transferRange(0,r),this._buffer.transferRange(t,this._capacity))}}const vge=1024,x2t=2,T2t=.3,S2t=.5;let E2t=e=>{const t=e.baseBoundingSphere.radius,r=e.levels.map(i=>i.minScreenSpaceRadius);return new b2t(t,r)};class C2t{constructor(t,r,i,n){this.type=Wi.LOD,this.isGround=!1,this._levels=[],this._defaultRenderInstanceData=[],this._highlightRenderInstanceData=[],this._instanceIndex=0,this._slicePlane=!1,this._enableLevelSelection=!0,this._lastCamera=new ni,this._updateCyclesWithStaticCamera=-1,this._needFullCycle=!1,this.slots=[Ee.OPAQUE_MATERIAL,Ee.TRANSPARENT_MATERIAL],this.canRender=!0,this._symbol=t,this._optionalFields=r,this._metadata=i,this._instanceBufferLayout=jRe({instancedDoublePrecision:!0,instanced:r}),this._glInstanceBufferLayout=vd(this._instanceBufferLayout,1),this._instanceData=new p2t(this._optionalFields,n),this._instanceData.on("instance-added",()=>this._requestUpdateCycle()),this._instanceData.on("instance-removed",()=>this._requestUpdateCycle()),this._instanceData.on("instance-transform-changed",s=>{this._requestUpdateCycle(),this._metadata.notifyGraphicGeometryChanged(s.index)}),this._instanceData.on("instance-visibility-changed",s=>{this._requestUpdateCycle(!0),this._metadata.notifyGraphicVisibilityChanged(s.index)}),this._instanceData.on("instance-highlight-changed",()=>this._requestUpdateCycle(!0)),this._enableLevelSelection=this._symbol.levels.length>1}get levels(){return this._levels}get baseBoundingBox(){return this._levels[this._levels.length-1].boundingBox}get baseBoundingSphere(){return this._levels[this._levels.length-1].boundingSphere}get baseMaterial(){return this._levels[this._levels.length-1].components[0].material}get slicePlaneEnabled(){return this._slicePlane}set slicePlaneEnabled(t){this._slicePlane=t}get layerUid(){return this._metadata.layerUid}get instanceData(){return this._instanceData}get memoryUsage(){const t={cpu:0,gpu:0};return this._defaultRenderInstanceData.forEach(r=>{const i=r.memoryUsage;t.cpu+=i.cpu,t.gpu+=i.gpu}),this._highlightRenderInstanceData.forEach(r=>{const i=r.memoryUsage;t.cpu+=i.cpu,t.gpu+=i.gpu}),t}get renderStats(){const t=this._instanceData.size,r=[];return this._levels.forEach((i,n)=>{const s=this._defaultRenderInstanceData[n],a=this._highlightRenderInstanceData[n],o=s.size+a.size,l=i.triangleCount;r.push({renderedInstances:o,renderedTriangles:o*l,trianglesPerInstance:l})}),{totalInstances:t,renderedInstances:r.reduce((i,n)=>i+n.renderedInstances,0),renderedTriangles:r.reduce((i,n)=>i+n.renderedTriangles,0),levels:r}}async initializeRenderContext(t,r){this._context=t;const i=t.renderContext.rctx,n=await Promise.allSettled(this._symbol.levels.map(a=>(this._defaultRenderInstanceData.push(new bge(i,this._instanceBufferLayout)),this._highlightRenderInstanceData.push(new bge(i,this._instanceBufferLayout)),Eae.create(t,a,r)))),s=n.map(a=>a.status==="fulfilled"?a.value:null).filter(a=>a);if(bs(r)||s.length!==n.length){s.forEach(a=>a.destroy()),Et(r);for(const a of n)if(a.status==="rejected")throw a.reason}this._levels=s,this._levelSelector=E2t(this)}uninitializeRenderContext(){this._invalidateOctree(),this._levels.forEach(t=>t.destroy()),this._defaultRenderInstanceData.forEach(t=>t.destroy()),this._highlightRenderInstanceData.forEach(t=>t.destroy())}get needsTransparentPass(){return this._levels.some(t=>t.components.some(r=>r.material.requiresSlot(Ee.TRANSPARENT_MATERIAL)))}get needsHighlight(){return this._highlightRenderInstanceData.some(t=>t.size>0)}prepareRender(t){if(Yr.LOD_INSTANCE_RENDERER_DISABLE_UPDATES)return;if(this._enableLevelSelection){const i=t.bindParameters.contentCamera.equals(this._lastCamera);this._lastCamera.copyFrom(t.bindParameters.contentCamera),i||this._requestUpdateCycle()}const r=this._needFullCycle?this._instanceData.size:2e3;this._needFullCycle=!1,this._updateInstances(t.bindParameters.contentCamera,r),this.needsUpdates&&this._context.requestRender()}render(t){if(!this.baseMaterial.isVisible()||!this.baseMaterial.isVisibleInPass(t.pass))return;t.rctx.bindVAO();const r=t.pass!==je.MATERIAL_HIGHLIGHT&&t.pass!==je.MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT,i=t.pass!==je.MATERIAL_DEPTH_SHADOWMAP_DEFAULT;r&&this._renderComponents(t,this._defaultRenderInstanceData),i&&this._renderComponents(t,this._highlightRenderInstanceData)}intersect(t,r,i,n){if(!this.baseMaterial.isVisible())return;const s=M();pe(s,n,i);const a=o=>{this._instanceData.getCombinedModelTransform(o,xge),t.transform.set(xge),ze(Tge,i,t.transform.inverse),ze(Sge,n,t.transform.inverse);const l=this._instanceData.getState(o),c=this._instanceData.getLodLevel(o),u=this._levels.length;pt(l&Oi.ACTIVE,"invalid instance state"),pt(c>=0&&c<u,"invaid lod level"),this._levels[c].intersect(t,r,Tge,Sge,o,this._metadata,u)};this.baseMaterial.parameters.verticalOffset?this.octree.forEach(a):this.octree.forEachAlongRay(i,s,a)}queryDepthRange(t){return this._queryDepthRangeOctree(t)}notifyShaderTransformationChanged(){this._invalidateOctree()}_requestUpdateCycle(t=!1){this._updateCyclesWithStaticCamera=-1,t&&(this._needFullCycle=!0),this.needsUpdates&&this._context.requestRender()}get needsUpdates(){return this._instanceData.size>0&&this._updateCyclesWithStaticCamera<1}get octree(){return this._octree||(this._octree=this._buildOctree()),this._octree}_invalidateOctree(){this._octree&&(this._octree.destroy(),this._octree=null)}_buildOctree(){const t=new y2t(this._instanceData,this.baseBoundingSphere),r=this._instanceData,i=r.view?r.view.state:null;for(let n=0;n<this._instanceData.capacity;++n)i.get(n)&Oi.ACTIVE&&t.addInstance(n);return t}_queryDepthRangeOctree(t){const r=t.eye,i=t.viewForward,n=this.octree.findClosest(i,vp.DepthOrder.FRONT_TO_BACK,t.frustum),s=this.octree.findClosest(i,vp.DepthOrder.BACK_TO_FRONT,t.frustum);if(n!=null&&s!=null){this._instanceData.view.boundingSphere.getVec(n,r0),pe(r0,r0,r);const a=Se(r0,i)-r0[3];this._instanceData.view.boundingSphere.getVec(s,r0),pe(r0,r0,r);const o=Se(r0,i)+r0[3];return{near:Math.max(t.near,a),far:Math.min(t.far,o)}}return{near:1/0,far:-1/0}}_startUpdateCycle(){this._updateCyclesWithStaticCamera++,this._defaultRenderInstanceData.forEach(t=>{t.startUpdateCylce()}),this._highlightRenderInstanceData.forEach(t=>{t.startUpdateCylce()}),this.needsUpdates&&this._context.requestRender()}_updateInstances(t,r){const i=this._enableLevelSelection,n=this._levelSelector;n.updateCamera(t),this._defaultRenderInstanceData.forEach(u=>{u.beginUpdate()}),this._highlightRenderInstanceData.forEach(u=>{u.beginUpdate()});const s=this._instanceData,a=this._instanceData.view,o=s.size,l=s.capacity;let c=this._instanceIndex;r=Math.min(o,r);for(let u=0;u<r;++u){c===0&&this._startUpdateCycle();const h=a.state.get(c);let p=0;if(!(h&Oi.ALLOCATED)){c=(c+1)%l,r++;continue}const m=a.lodLevel.get(c);if(h&Oi.DEFAULT_ACTIVE&&this._defaultRenderInstanceData[m].freeTail(),h&Oi.HIGHLIGHT_ACTIVE&&this._highlightRenderInstanceData[m].freeTail(),h&Oi.REMOVE)s.freeInstance(c);else if(h&Oi.VISIBLE){let g=0;i&&(a.modelOrigin.getVec(c,wge),g=n.selectLevel(wge,s.getCombinedMedianScaleFactor(c))),p=h&~(Oi.ACTIVE|Oi.TRANSFORM_CHANGED),g>=0&&(h&Oi.HIGHLIGHT?(_ge(this._highlightRenderInstanceData[g],a,c),p|=Oi.HIGHLIGHT_ACTIVE):(_ge(this._defaultRenderInstanceData[g],a,c),p|=Oi.DEFAULT_ACTIVE)),a.state.set(c,p),a.lodLevel.set(c,g)}else p=h&~(Oi.ACTIVE|Oi.TRANSFORM_CHANGED),a.state.set(c,p);if(this._octree){const g=!!(h&Oi.ACTIVE),b=!!(p&Oi.ACTIVE);!g&&b?this._octree.addInstance(c):g&&!b?this._octree.removeInstance(c):g&&b&&h&Oi.TRANSFORM_CHANGED&&(this._octree.removeInstance(c),this._octree.addInstance(c))}c=(c+1)%l}this._instanceIndex=c,this._defaultRenderInstanceData.forEach(u=>{u.endUpdate()}),this._highlightRenderInstanceData.forEach(u=>{u.endUpdate()})}_renderComponents(t,r){this.levels.forEach((i,n)=>{i.components.forEach(s=>{this._renderComponent(t,r[n],s,n)})})}_renderComponent(t,r,i,n){const s=t.bindParameters;if(r.size===0||!i.material.requiresSlot(s.slot))return;const{rctx:a,pass:o}=t,l=i.glMaterials.load(a,o);if(R(l))return;const c=l.beginSlot(s),u=a.bindTechnique(c,i.material.parameters,s);a.bindVAO(i.vao),c.ensureAttributeLocations(i.vao),c.bindDraw(R2t,s),Yr.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL&&t.pass===je.MATERIAL&&(u.setUniform4fv("externalColor",Ege[Math.min(n,Ege.length-1)]),u.setUniform1i("colorMixMode",Z7e.replace));const h=a.capabilities.instancing,p=r.capacity,m=r.headIndex,g=r.tailIndex,b=r.firstIndex,w=this._glInstanceBufferLayout,v=(x,T)=>{Kne(a,Ur,r.buffer,w,x),h.drawArraysInstanced(c.primitiveType,0,i.vertexCount,T-x),ese(a,Ur,r.buffer,w)};i.material.parameters.transparent&&b!=null?m>g?(pt(b>=g&&b<=m,"invalid firstIndex"),v(b,m),v(g,b)):m<g&&(b<=m?(pt(b>=0&&b<=m,"invalid firstIndex"),v(b,m),v(g,p),v(0,b)):(pt(b>=g&&b<=p,"invalid firstIndex"),v(b,p),v(0,m),v(g,b))):m>g?v(g,m):m<g&&(v(0,m),v(g,p)),a.bindVAO(null)}}function _ge(e,t,r){const i=e.allocateHead();A2t(t,r,e.view,i)}function A2t(e,t,r,i){Kut(e.modelOrigin,t,r.modelOriginHi,r.modelOriginLo,i),r.model.copyFrom(i,e.model,t),r.modelNormal.copyFrom(i,e.modelNormal,t),e.color&&r.color&&r.color.copyFrom(i,e.color,t),e.featureAttribute&&r.featureAttribute&&r.featureAttribute.copyFrom(i,e.featureAttribute,t)}const wge=M(),r0=Jt(),xge=Ae(),Tge=M(),Sge=M(),Ege=[[1,0,1,1],[0,0,1,1],[0,1,0,1],[1,1,0,1],[1,0,0,1]],R2t=new Qbt;class O2t extends Nm{constructor(t,r,i,n){super(t,r,i,n),this._resources=null,this._optionalFields=new Array,this._instanceIndexToGraphicUid=new Map,this.hasLoadedPBRTextures=!1,this._disposeResourceHandles=new Array,this.ensureDrapedStatus(!1),this.hasLoadedPBRTextures=i.physicalBasedRenderingEnabled}getCachedSize(){const[t,r,i]=_(this._resources)?this._resources.symbolSize:[1,1,1];return{width:t,depth:r,height:i}}async doLoad(t){if(!this._drivenProperties.size&&iU(this.symbolLayer))throw new Error;const r=this.symbolLayer;if(this.isPrimitive){const i=r.resource?r.resource.primitive:Nre;this._resources=await this._createResourcesForPrimitive(i,t)}else this._resources=await this._createResourcesForUrl(r.resource.href,t);this.layerOpacityChanged(),this.slicePlaneEnabledChanged(),this.physicalBasedRenderingChanged(),this.complexity=this.computeComplexity()}get extentPadding(){return _(this._resources)?this._resources.extentPadding:0}get isPrimitive(){return!(this.symbolLayer.resource&&this.symbolLayer.resource.href)}get lodRenderer(){return Vi(this._resources,"lodRenderer")}_setMaterialTransparencyParams(t,r=Vi(this.symbolLayer,"material","color")){const i=this._getCombinedOpacity(r),n=i<1||this.needsDrivenTransparentPass;return t.transparent=n,t.opacity=i,t.cullFace=n?pi.None:pi.Back,t}async _createResourcesForPrimitive(t,r){if(!Dgt(t))throw new Error(`Unknown object symbol primitive: ${t}`);const i=this.symbolLayer,n=is(CBe(t)),s=Wl($M(n)),a=Wl(cG(s,i)),o=Oe(a),l=!1,c=!1,u={usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0,ambient:X0,diffuse:X0,hasSlicePlane:this._context.slicePlaneEnabled,hasSliceHighlight:!1,castShadows:this.symbolLayer.castShadows,offsetTransparentBackfaces:!this.symbolLayer.isPrimitive},h=u.usePBR;this._setMaterialTransparencyParams(u);const p=this.symbol;if(p.type==="point-3d"&&p.verticalOffset){const{screenLength:v,minWorldLength:x,maxWorldLength:T}=p.verticalOffset;u.verticalOffset={screenLength:ur(v),minWorldLength:x||0,maxWorldLength:T!=null?T:1/0},u.castShadows=!1}if(this._context.screenSizePerspectiveEnabled&&(u.screenSizePerspective=this._context.sharedResources.screenSizePerspectiveSettings),this._drivenProperties.color)u.externalColor=Ih;else{const v=_(i.material)&&i.material.color,x=_(v)?Te.toUnitRGBA(v):Ih;u.externalColor=x}this._fastUpdates=mR(this._context.renderer,this._fastVisualVariableConvertOptions(n,a,s,m2)),u.instanced=["transformation"],this._fastUpdates.enabled?(Object.assign(u,this._fastUpdates.materialParameters),u.instanced.push("featureAttribute"),this._optionalFields.push("featureAttribute")):this._hasPerInstanceColor()&&(u.instanced.push("color"),this._optionalFields.push("color"));const m=new lx(u),g=UAe(t,m);if(!g)throw new Error(`Unknown object symbol primitive: ${t}`);const b=eI(g).map(v=>({opacity:1,transparent:v.parameters.transparent})),w=await this._createStageResources(g,h);return{lodResources:g,lodRenderer:await this._createLodRenderer(g,r),stageResources:w,symbolSize:a,extentPadding:o,isEsriSymbolResource:l,isWosr:c,originalMaterialParameters:b,physicalBasedRenderingEnabled:h,resourceBoundingBox:n,resourceSize:s,pivotOffset:m2}}async _createResourcesForUrl(t,r){const i=["transformation"],n={materialParamsMixin:{instanced:i,hasSlicePlane:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows},streamDataRequester:this._context.streamDataRequester,cache:this._context.sharedResources.objectResourceCache};this._fastUpdates=mR(this._context.renderer,this._fastVisualVariableConvertOptions(m2,m2,m2,m2)),this._fastUpdates.enabled?(Object.assign(n.materialParamsMixin,this._fastUpdates.materialParameters),i.push("featureAttribute"),this._optionalFields.push("featureAttribute")):this._hasPerInstanceColor()&&(i.push("color"),this._optionalFields.push("color"));const s=this.symbol;if(s.type==="point-3d"&&s.verticalOffset){const{screenLength:L,minWorldLength:V,maxWorldLength:G}=s.verticalOffset;n.materialParamsMixin.verticalOffset={screenLength:ur(L),minWorldLength:V||0,maxWorldLength:G!=null?G:1/0},n.materialParamsMixin.castShadows=!1}n.signal=r,n.usePBR=this._context.physicalBasedRenderingEnabled;const a=n.usePBR,o=await wOe(t,n),l=o.isEsriSymbolResource,c=o.isWosr;this._addDisposeResource(()=>o.remove());const u=f_t(o.lods);m_t(u),u.levels.sort((L,V)=>L.minScreenSpaceRadius-V.minScreenSpaceRadius),u.levels[0].minScreenSpaceRadius=Math.min(2,u.levels[0].minScreenSpaceRadius);const h=this._context,p=this.symbolLayer.material,m=this._getExternalColorParameters(p),g=Vi(this.symbolLayer,"material","color"),b=this._getCombinedOpacity(g,{hasIntrinsicColor:!0}),w=this.needsDrivenTransparentPass,v=eI(u),x=eI(u).map(L=>({opacity:L.parameters.opacity||1,transparent:L.parameters.transparent}));v.forEach(L=>{const V=L.parameters;L.setParameters(m);const G=V.opacity*b,B=G<1||w||V.transparent;L.setParameters({opacity:G,transparent:B}),h.screenSizePerspectiveEnabled&&L.setParameters({screenSizePerspective:h.sharedResources.screenSizePerspectiveSettings})});const T=o.referenceBoundingBox,E=Wl($M(T)),C=Wl(u.levels[0].pivotOffset),A=Wl(cG(E,this.symbolLayer)),P=Oe(A);gR(this._fastUpdates,this._context.renderer,this._fastVisualVariableConvertOptions(T,A,E,C))&&v.forEach(L=>L.setParameters(this._fastUpdates.materialParameters));const I=await this._createStageResources(u,a);return{lodResources:u,lodRenderer:await this._createLodRenderer(u,r),stageResources:I,symbolSize:A,extentPadding:P,isEsriSymbolResource:l,isWosr:c,originalMaterialParameters:x,physicalBasedRenderingEnabled:a,resourceBoundingBox:T,resourceSize:E,pivotOffset:C}}_addDisposeResource(t){this._disposeResourceHandles.push(t)}async _createStageResources(t,r){const i=this._context.stage,n=eI(t);r!==this._context.physicalBasedRenderingEnabled&&this.physicalBasedRenderingChanged(),i.addMany(n),this._addDisposeResource(()=>i.removeMany(n));const s=Ggt(t);i.addMany(s),this._addDisposeResource(()=>i.removeMany(s)),await i.load(s);const a=jgt(t);return i.addMany(a),this._addDisposeResource(()=>i.removeMany(a)),{materials:n,textures:s,geometries:a}}async _createLodRenderer(t,r){const i=this._context.stage,n={layerUid:this._context.layer.uid,graphicUid:o=>this._instanceIndexToGraphicUid.get(o),notifyGraphicGeometryChanged:o=>this._context.notifyGraphicGeometryChanged(this._instanceIndexToGraphicUid.get(o)),notifyGraphicVisibilityChanged:o=>this._context.notifyGraphicVisibilityChanged(this._instanceIndexToGraphicUid.get(o))},s=this._fastUpdates.enabled?{applyTransform:(o,l,c)=>{o.getFeatureAttribute(l,_I),Ln(c,cK(this._fastUpdates.materialParameters,_I,c))},scaleFactor:(o,l,c)=>(l.getFeatureAttribute(c,_I),D1t(o,this._fastUpdates.materialParameters,_I))}:null,a=new C2t(t,this._optionalFields,n,s);return a.slicePlaneEnabled=this._context.slicePlaneEnabled,this._addDisposeResource(()=>{i.removeRenderPlugin(a)}),await i.addRenderPlugin(a.slots,a,r),a}_getExternalColorParameters(t){const r={};return this._drivenProperties.color?r.externalColor=Ih:_(t)&&_(t.color)?r.externalColor=Te.toUnitRGBA(t.color):(r.externalColor=Ih,r.colorMixMode="ignore"),r}destroy(){super.destroy(),this._cleanupResources()}_cleanupResources(){this._disposeResourceHandles.forEach(t=>t()),this._disposeResourceHandles.length=0,this._resources=null}createGraphics3DGraphic(t){const r=t.graphic;if(!this._validateGeometry(r.geometry))return null;const i=uR(r.geometry);if(R(i))return this.logger.warn(`unsupported geometry type for icon symbol: ${r.geometry.type}`),null;const n=this.setGraphicElevationContext(r,new Du),s=t.renderingInfo;return this._createAs3DShape(r,i,s,n,r.uid)}notifyDestroyGraphicLayer(t){this._instanceIndexToGraphicUid.delete(t.instanceIndex)}graphicLayerToGraphicId(){return 0}layerOpacityChanged(){if(R(this._resources))return!0;const t=this._drivenProperties.opacity,r=!this.isPrimitive,i=this._resources.stageResources.materials,n=this._resources.originalMaterialParameters;for(let s=0;s<i.length;s++){const a=i[s],o=Vi(this.symbolLayer,"material","color"),l=n[s],c=this._getCombinedOpacity(o,{hasIntrinsicColor:r})*l.opacity,u=c<1||t||l.transparent;a.setParameters({opacity:c,transparent:u}),this.isPrimitive&&a.setParameters({cullFace:u?pi.None:pi.Back})}return!0}layerElevationInfoChanged(t,r){return this.updateGraphics3DGraphicElevationInfo(t,r,l_)}slicePlaneEnabledChanged(){if(R(this._resources))return!0;this._resources.lodRenderer.slicePlaneEnabled=this._context.slicePlaneEnabled;for(const t of this._resources.stageResources.materials)t.setParameters({hasSlicePlane:this._context.slicePlaneEnabled});return!0}physicalBasedRenderingChanged(){if(R(this._resources))return!0;const{stageResources:t,isWosr:r}=this._resources;for(const i of t.materials)this.isPrimitive?i.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}):r||i.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!1});return this.hasLoadedPBRTextures!==!1||this._context.physicalBasedRenderingEnabled!==!0||(this.hasLoadedPBRTextures=!0,!1)}pixelRatioChanged(){return!0}applyRendererDiff(t,r){if(R(this._resources))return xs.Recreate_Symbol;const{stageResources:{materials:i},lodRenderer:n,resourceBoundingBox:s,symbolSize:a,resourceSize:o,pivotOffset:l}=this._resources;for(const c in t.diff){if(c!=="visualVariables"||!gR(this._fastUpdates,r,this._fastVisualVariableConvertOptions(s,a,o,l)))return xs.Recreate_Symbol;for(const u of i)u.setParameters(this._fastUpdates.materialParameters);n.notifyShaderTransformationChanged()}return xs.Fast_Update}computeComplexity(){return R(this._resources)?super.computeComplexity():{primitivesPerFeature:dae(this._resources.lodResources.levels[0]).reduce((t,r)=>t+r.indices.get(O.POSITION).length,0)/3,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1,memory:HAe(this.symbol,this.symbolLayer)}}_hasLodRenderer(){return _(this._resources)}_createAs3DShape(t,r,i,n,s){if(!this._hasLodRenderer()||R(this._resources))return null;const a=this.getFastUpdateAttrValues(t),o=!this._fastUpdates.enabled&&this._hasPerInstanceColor()?g7(i.color,i.opacity):null,l=this._context.clippingExtent;if(oa(r,vT,this._context.elevationProvider.spatialReference),_(l)&&!Lre(l,vT))return null;const c=this._requiresTerrainElevation(n),u=this._computeGlobalTransform(r,n,Gq,wI),h=this._computeLocalTransform(this._resources,this.symbolLayer,i,Cge),p=this._resources.lodRenderer.instanceData,m=p.addInstance();this._instanceIndexToGraphicUid.set(m,s),p.setLocalTransform(m,h,!1),p.setGlobalTransform(m,u),a&&p.setFeatureAttribute(m,a),o&&p.setColor(m,o);const g=new d_t(this,m,Agt,n);return c&&(g.alignedSampledElevation=wI.sampledElevation),g.needsElevationUpdates=l_(n.mode),dR(g,r,this._context.elevationProvider),g}_computeGlobalTransform(t,r,i,n){return zy(t,this._context.elevationProvider,r,this._context.renderCoordsHelper,n),vT[0]=t.x,vT[1]=t.y,vT[2]=n.z,Au(t.spatialReference,vT,i,this._context.renderCoordsHelper.spatialReference),i}_computeLocalTransform(t,r,i,n){return pm(n),this._applyObjectRotation(i,!1,n),this._applyObjectRotation(r,!0,n),this._applyObjectScale(t,i,n),this._applyAnchor(t,r,n),n}_applyObjectScale(t,r,i){if(this._fastUpdates.enabled&&this._fastUpdates.requiresShaderTransformation)return;const n=this._drivenProperties.size&&r.size?r.size:t.symbolSize,s=Y0e(n,t.symbolSize,t.resourceSize,this._context.renderCoordsHelper.unitInMeters);s[0]===1&&s[1]===1&&s[2]===1||DV(i,i,s)}prepareSymbolLayerPatch(t){if(t.diff.type!=="partial")return;const r=t.diff.diff;this._preparePatchTransform(t,r),this._preparePatchColor(t,r)}updateGeometry(t,r){if(R(this._resources))return!0;const i=r&&uR(r);if(R(i))return!1;const n=this.getGeometryElevationMode(r);return t.elevationContext.mode===n&&(this._computeGlobalTransform(i,t.elevationContext,Gq,wI),this._requiresTerrainElevation(t.elevationContext)&&(t.alignedSampledElevation=wI.sampledElevation),this._resources.lodRenderer.instanceData.setGlobalTransform(t.instanceIndex,Gq,!0),dR(t,i,this._context.elevationProvider),!0)}_preparePatchTransform(t,r){if(!(r.heading||r.tilt||r.roll||r.width||r.height||r.depth||r.anchor||r.anchorPosition)||R(this._resources))return;const i=(g,b,w)=>vt(g!=null&&g.type==="complete"?g.newValue:b,w),n=i(r.heading,this.symbolLayer.heading,0),s=i(r.tilt,this.symbolLayer.tilt,0),a=i(r.roll,this.symbolLayer.roll,0),o=i(r.width,this.symbolLayer.width,void 0),l=i(r.height,this.symbolLayer.height,void 0),c=i(r.depth,this.symbolLayer.depth,void 0),u=i(r.anchor,this.symbolLayer.anchor,void 0),h=i(r.anchorPosition,this.symbolLayer.anchorPosition,void 0);delete r.heading,delete r.tilt,delete r.roll,delete r.width,delete r.height,delete r.depth,delete r.anchor,delete r.anchorPosition;const p={heading:n,tilt:s,roll:a,anchor:u,anchorPosition:h},m=this._resources;this.loadStatus===eu.LOADED&&t.symbolLayerStatePatches.push(()=>{m.symbolSize=Wl(cG(m.resourceSize,{width:o,height:l,depth:c,isPrimitive:this.symbolLayer.isPrimitive}))}),t.graphics3DGraphicPatches.push((g,b)=>{const w=this._computeLocalTransform(m,p,b,Cge),v=g.instanceIndex;m.lodRenderer.instanceData.setLocalTransform(v,w,!0)})}_preparePatchColor(t,r){if(!r.material||r.material.type!=="partial")return;const i=r.material.diff;if(!i.color||i.color.type!=="complete"||i.color.newValue==null||i.color.oldValue==null)return;const n=i.color.newValue,s=_(n)?Te.toUnitRGBA(n):Ih;delete i.color;const a=this._resources;R(a)||t.graphics3DGraphicPatches.push(o=>{let l;this._hasPerInstanceColor()?(a.lodRenderer.instanceData.setColor(o.instanceIndex,s),l=this._setMaterialTransparencyParams({},n)):l=this._setMaterialTransparencyParams({externalColor:s},n);for(const c of a.stageResources.materials)c.setParameters(l)})}_requiresTerrainElevation(t){return t.mode!=="absolute-height"}_applyObjectRotation(t,r,i){if(!(this._fastUpdates.enabled&&this._fastUpdates.requiresShaderTransformation&&r))return ggt(t.heading,t.tilt,t.roll,i)}_computeAnchor(t,r,i){const n=M();switch(i.anchor){case"center":oe(n,fp(t)),Io(n,n);break;case"top":{const s=fp(t);ne(n,-s[0],-s[1],-t[5]);break}case"bottom":{const s=fp(t);ne(n,-s[0],-s[1],-t[2]);break}case"relative":{const s=fp(t),a=$M(t),o=i.anchorPosition,l=o?Ve(o.x,o.y,o.z):gl;pV(n,a,l),he(n,n,s),Io(n,n);break}default:_(r)?Io(n,r):oe(n,gl)}return n}_applyAnchor(t,r,i){if(this._fastUpdates.enabled&&this._fastUpdates.requiresShaderTransformation)return;const n=this._computeAnchor(t.resourceBoundingBox,t.pivotOffset,r);n&&wl(i,i,n)}_hasPerInstanceColor(){return this._drivenProperties.color||this._drivenProperties.opacity}_fastVisualVariableConvertOptions(t,r,i,n){const s=_(t)?Wl($M(t)):X0,a=_(t)?this._computeAnchor(t,n,this.symbolLayer):gl,o=this._context.renderCoordsHelper.unitInMeters,l=Y0e(_(r)?r:void 0,r,i,o),c=Ve(this.symbolLayer.tilt||0,this.symbolLayer.roll||0,this.symbolLayer.heading||0);return{modelSize:s,symbolSize:_(r)?r:X0,unitInMeters:o,transformation:{anchor:a,scale:l,rotation:c}}}}const vT=M(),Cge=Ae(),Gq=Ae(),_I=Jt(),wI=new MO;function M2t(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function P2t(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e}function Cae(e,t,r,i,n){return e[0]=t,e[1]=r,e[2]=i,e[3]=n,e}function I2t(e,t){if(e===t){const r=t[1];e[1]=t[2],e[2]=r}else e[0]=t[0],e[1]=t[2],e[2]=t[1],e[3]=t[3];return e}function $2t(e,t){const r=t[0],i=t[1],n=t[2],s=t[3];let a=r*s-n*i;return a?(a=1/a,e[0]=s*a,e[1]=-i*a,e[2]=-n*a,e[3]=r*a,e):null}function L2t(e,t){const r=t[0];return e[0]=t[3],e[1]=-t[1],e[2]=-t[2],e[3]=r,e}function D2t(e){return e[0]*e[3]-e[2]*e[1]}function TOe(e,t,r){const i=t[0],n=t[1],s=t[2],a=t[3],o=r[0],l=r[1],c=r[2],u=r[3];return e[0]=i*o+s*l,e[1]=n*o+a*l,e[2]=i*c+s*u,e[3]=n*c+a*u,e}function F2t(e,t,r){const i=t[0],n=t[1],s=t[2],a=t[3],o=Math.sin(r),l=Math.cos(r);return e[0]=i*l+s*o,e[1]=n*l+a*o,e[2]=i*-o+s*l,e[3]=n*-o+a*l,e}function N2t(e,t,r){const i=t[0],n=t[1],s=t[2],a=t[3],o=r[0],l=r[1];return e[0]=i*o,e[1]=n*o,e[2]=s*l,e[3]=a*l,e}function k2t(e,t){const r=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=r,e[2]=-r,e[3]=i,e}function V2t(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=t[1],e}function z2t(e){return"mat2("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}function U2t(e){return Math.sqrt(e[0]**2+e[1]**2+e[2]**2+e[3]**2)}function B2t(e,t,r,i){return e[2]=i[2]/i[0],r[0]=i[0],r[1]=i[1],r[3]=i[3]-e[2]*r[1],[e,t,r]}function G2t(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e}function SOe(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e}function j2t(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]}function q2t(e,t){const r=e[0],i=e[1],n=e[2],s=e[3],a=t[0],o=t[1],l=t[2],c=t[3];return Math.abs(r-a)<=Rt*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(i-o)<=Rt*Math.max(1,Math.abs(i),Math.abs(o))&&Math.abs(n-l)<=Rt*Math.max(1,Math.abs(n),Math.abs(l))&&Math.abs(s-c)<=Rt*Math.max(1,Math.abs(s),Math.abs(c))}function H2t(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e}function W2t(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e[2]=t[2]+r[2]*i,e[3]=t[3]+r[3]*i,e}const X2t=TOe,Y2t=SOe;Object.freeze(Object.defineProperty({__proto__:null,copy:M2t,identity:P2t,set:Cae,transpose:I2t,invert:$2t,adjoint:L2t,determinant:D2t,multiply:TOe,rotate:F2t,scale:N2t,fromRotation:k2t,fromScaling:V2t,str:z2t,frob:U2t,LDU:B2t,add:G2t,subtract:SOe,exactEquals:j2t,equals:q2t,multiplyScalar:H2t,multiplyScalarAndAdd:W2t,mul:X2t,sub:Y2t},Symbol.toStringTag,{value:"Module"}));class Z2t extends Gi{constructor(t,r,i,n,s,a){super(t,r),this.path=i,this.geometrySR=n,this.upVectorAlignment=s,this.stencilWidth=a}}function EOe(e){return"upVectorAlignment"in e}function COe(){return[1,0,0,1]}function Q2t(e){return[e[0],e[1],e[2],e[3]]}function J2t(e,t,r,i){return[e,t,r,i]}function K2t(e,t){return new Float64Array(e,t,4)}Object.freeze(Object.defineProperty({__proto__:null,create:COe,clone:Q2t,fromValues:J2t,createView:K2t},Symbol.toStringTag,{value:"Module"}));function gK(){return{up:M(),right:M()}}function e3t(e,t,r){ze(e.up,t.up,r),ze(e.right,t.right,r)}function t3t(e,t,r){vr(e,Se(r,t.right),Se(r,t.up))}class r3t{constructor(){this.pos=M(),this.posES=M(),this.posGS=M(),this.vRight=M(),this.vLeft=M(),this.frame=gK(),this.rotationFrame=gK(),this.rotationRight=it(),this.rotationAngle=0,this.miterStretch=COe()}setFrameFromUpVector(t){oe(this.frame.up,t),he(lh,this.vLeft,this.vRight),we(lh,lh),le(Vf,this.frame.up,Se(lh,this.frame.up)),pe(TI,lh,Vf),we(TI,TI),dt(this.frame.right,TI,this.frame.up)}computeRotationAxisAndAngleFromUpVector(){oe(this.rotationFrame.up,this.frame.up),oe(this.rotationFrame.right,this.frame.right),vr(this.rotationRight,1,0),le(Vf,this.frame.up,Se(this.frame.up,this.vLeft)),pe(Vf,this.vLeft,Vf),Io(Vf,Vf),we(Vf,Vf),le(lh,this.frame.up,Se(this.frame.up,this.vRight)),pe(lh,this.vRight,lh),we(lh,lh),dt(yK,this.rotationFrame.up,this.vLeft);const t=Math.sign(Se(yK,this.vRight));if(this.rotationAngle=t*(Math.PI-Rs(Se(Vf,lh))),Math.abs(this.rotationAngle)>0){const i=EX(Math.cos(.5*this.rotationAngle));Cae(this.miterStretch,i-1+1,0,0,1)}const r=Math.PI-this.rotationAngle;this.maxStretchDistance=Math.abs(Math.min(this.vLeftLength,this.vRightLength)/Math.cos(.5*r))}}class bR{constructor(){this.vertices=[],this.vertexIndices=[],this.vertexNormals=[],this.poles=[],this.poleIndices=[],this.uvs=null,this.uvIndices=null}addVertex(t,r){return this.vertices.push(ME(t)),this.vertexNormals.push(ME(r)),this.vertices.length-1}addUV(t){return this.uvs||(this.uvs=[],this.uvIndices=[]),this.uvs.push(t),this.uvs.length-1}addPole(t,r=null){return this.poles.push({position:ME(t),normal:r?ME(r):null}),this.poles.length-1}addSegment(t,r=null,i=null){this.vertexIndices.push(t.v0),this.vertexIndices.push(t.v1),r&&(this.uvIndices.push(r.v0),this.uvIndices.push(r.v1)),i&&(this.poleIndices.push(i.v0),this.poleIndices.push(i.v1))}get numSegments(){return this.vertexIndices.length/2}hasUV(){return this.uvs!=null}translate(t,r){for(const i of this.vertices)i[0]+=t,i[1]+=r;for(const i of this.poles)i.position[0]+=t,i.position[1]+=r}static circle(t=20){const i=new bR,n={v0:0,v1:0};i.addPole(Nr(0,0));for(let o=0;o<t;++o){const l=2*o*Math.PI/t,c=Math.cos(l),u=Math.sin(l),h=Nr(c*.5,u*.5),p=Nr(c,u);i.addVertex(h,p),i.addUV(o/t)}i.addUV(1);for(let o=0;o<t-1;++o){const l={v0:o,v1:o+1},c=l;i.addSegment(l,c,n)}const s={v0:t-1,v1:0},a={v0:t-1,v1:t};return i.addSegment(s,a,n),i}static rect(){const i=new bR,n=Nr(.5*-1,.5*-1),s=Nr(.5*1,.5*-1),a=Nr(.5*1,.5*1),o=Nr(.5*-1,.5*1),l=Nr(0,-1),c=Nr(1,0),u=Nr(0,1),h=Nr(-1,0);i.addUV(0),i.addUV(1),i.addPole(Nr(0,.5*1),u),i.addPole(Nr(0,.5*1)),i.addPole(Nr(0,.5*-1)),i.addPole(Nr(0,.5*-1),l);const p={v0:0,v1:1};return i.addVertex(n,l),i.addVertex(s,l),i.addSegment({v0:0,v1:1},p,{v0:3,v1:3}),i.addVertex(s,c),i.addVertex(a,c),i.addSegment({v0:2,v1:3},p,{v0:2,v1:1}),i.addVertex(a,u),i.addVertex(o,u),i.addSegment({v0:4,v1:5},p,{v0:0,v1:0}),i.addVertex(o,h),i.addVertex(n,h),i.addSegment({v0:6,v1:7},p,{v0:1,v1:2}),i}}class i3t{constructor(t){this.vertices=[],this.offset=M(),this.xform=Ae(),this.vertices=t;const r=Math.floor((t.length-1)/2);oe(this.offset,this.vertices[r].pos);for(const i of this.vertices)pe(i.pos,i.pos,this.offset);wl(this.xform,this.xform,this.offset),this.updatePathVertexInformation()}updatePathVertexInformation(){const t=this.vertices.length;let r=this.vertices[0];r.index=0,ne(r.vLeft,0,0,0),r.vLeftLength=0,pe(r.vRight,this.vertices[1].pos,r.pos),r.vRightLength=Oe(r.vRight),we(r.vRight,r.vRight);let i=r;for(let n=1;n<t;++n)r=this.vertices[n],r.index=n,oe(r.vLeft,i.vRight),r.vLeftLength=i.vRightLength,n<t-1?(pe(r.vRight,this.vertices[n+1].pos,r.pos),r.vRightLength=Oe(r.vRight),we(r.vRight,r.vRight)):(oe(r.vRight,r.vLeft),r.vRightLength=r.vLeftLength),i=r}}function n3t(e,t){let r=null;const i=e.vertices.length,n=.99619469809,s=M(),a=M(),o=M(),l=M(),c=M(),u=M(),h=Er();let p=e.vertices[0];oe(a,t),ne(s,0,1,0),Uc.makeOrthoBasisDirUpFallback(p.vRight,a,s,s,o,a,n),oe(p.frame.up,a),oe(p.frame.right,o),r=p;for(let m=1;m<i;++m){p=e.vertices[m],he(c,p.vLeft,p.vRight);let g=Oe(c);g>0?(g=1/Math.sqrt(g),c[0]=c[0]*g,c[1]=c[1]*g,c[2]=c[2]*g):(c[0]=p.vRight[0],c[1]=p.vRight[1],c[2]=p.vRight[2]),he(u,r.pos,r.frame.up),r9(p.pos,c,h),Cx(h,Ru(u,p.vLeft),l)?(pe(l,l,p.pos),we(a,l),dt(o,c,a),we(o,o)):Uc.makeOrthoBasisDirUpFallback(c,r.frame.up,r.frame.right,s,o,a,n),oe(p.frame.up,a),oe(p.frame.right,o),r=p}}class s3t{numProfilesPerJoin(){return 1}extrude(t,r,i){for(let n=0;n<r.vertices.length;++n)i(t.index,t.frame,r.vertices[n],r.vertexNormals[n],!1)}}class jq{constructor(t=.8*Math.PI,r=1){this.cutoffAngle=t,this.numBendSubdivisions=r}numProfilesPerJoin(){return this.numBendSubdivisions+1}extrude(t,r,i){const n=h3t;if(Math.abs(t.rotationAngle)>=this.cutoffAngle)for(let s=0;s<this.numBendSubdivisions+1;++s){Cu(Oge,.5*-t.rotationAngle+s*t.rotationAngle/this.numBendSubdivisions,t.rotationFrame.up),e3t(n,t.frame,Oge);for(let a=0;a<r.vertices.length;++a)us(r.vertices[a],t.rotationRight)*t.rotationAngle>=0?i(t.index,n,r.vertices[a],r.vertexNormals[a],!1):(OJ(Q3,r.vertices[a],t.miterStretch),i(t.index,t.frame,Q3,r.vertexNormals[a],!0))}else for(let s=0;s<this.numBendSubdivisions+1;++s)for(let a=0;a<r.vertices.length;++a){const o=us(r.vertices[a],t.rotationRight)*t.rotationAngle>=0;OJ(Q3,r.vertices[a],t.miterStretch),i(t.index,t.frame,Q3,r.vertexNormals[a],!o)}}}const a3t={generateUV:!1};class Aae{rebuildConnectingProfileGeometry(t,r,i){for(let n=0;n<r.vertices.length;++n)i(t.index,t.frame,r.vertices[n],r.vertexNormals[n],0,0)}}class Age extends Aae{constructor(){super()}getNumVertices(){return 0}getNumIndices(){return 0}rebuildCapGeometry(){}buildTopology(){}}class xI extends Aae{constructor(t,r=0,i=!1){super(),this.profile=t,this.profilePlaneOffset=r,this.flip=i}getNumVertices(){return this.profile.vertices.length}getNumIndices(){return 3*this.profile.numSegments}rebuildConnectingProfileGeometry(t,r,i){for(let n=0;n<r.vertices.length;++n)i(t.index,t.frame,r.vertices[n],r.vertexNormals[n],this.profilePlaneOffset,0)}rebuildCapGeometry(t,r){const i=Rae;vr(i,0,0);const n=this.flip?1:-1;for(let s=0;s<this.profile.vertices.length;++s)r(t.index,t.frame,this.profile.vertices[s],i,this.profilePlaneOffset,n)}buildTopology(t,r){const i=this.vertexBufferStart+this.profile.vertexIndices[0];for(let n=1;n<this.profile.numSegments;++n){const s=this.profile.vertexIndices[2*n+0],a=this.profile.vertexIndices[2*n+1],o=this.vertexBufferStart+s,l=this.vertexBufferStart+a;this.flip?r(l,o,i):r(i,o,l)}}}class Rge extends Aae{constructor(t){super(),this.flip=!1,this.sign=0,this.breakNormals=!1,this.numSegments=3,this.profile=t.profile,this.flip=t.flip,this.sign=this.flip?1:-1,this.breakNormals=t.breakNormals,this.numSegments=t.subdivisions}getNumVertices(){let t=0;return t=this.profile.vertices.length*(this.numSegments-1),this.breakNormals&&(t+=this.profile.vertices.length),t+=this.profile.poles.length,t}getNumIndices(){let t=0;t+=2*this.profile.numSegments*(this.numSegments-1);for(let r=0;r<this.profile.numSegments;++r){const i=this.profile.vertexIndices[2*r+0],n=this.profile.vertexIndices[2*r+1];this.profile.poleIndices[i]===this.profile.poleIndices[n]?t+=1:t+=2}return 3*t}rebuildCapGeometry(t,r){const i=t.frame,n=.5*this.sign,s=Q3,a=Rae;vr(a,0,0);for(let o=0;o<this.profile.poles.length;++o){const l=this.profile.poles[o];l.normal?r(t.index,i,l.position,l.normal,n,0):r(t.index,i,l.position,a,n,this.sign)}if(this.breakNormals)for(let o=0;o<this.profile.vertices.length;++o)r(t.index,i,this.profile.vertices[o],this.profile.vertexNormals[o],0,0);for(let o=0;o<this.numSegments-1;++o){const l=(1-(o+1)/this.numSegments)*Math.PI*.5,c=Math.sin(l),u=Math.cos(l);for(let h=0;h<this.profile.vertices.length;++h){const p=this.profile.poles[this.profile.poleIndices[h]];q0(s,this.profile.vertices[h],p.position),Qc(s,s,c),p.normal?(Kf(s,s,p.position),r(t.index,i,s,p.normal,n*u,0)):(DA(a,s),Qc(a,a,c),Kf(s,s,p.position),r(t.index,i,s,a,n*u,this.sign*u))}}}buildTopology(t,r){const i=this.breakNormals?this.vertexBufferStart+this.profile.poles.length:this.firstProfileVertexIndex,n=this.breakNormals?this.vertexBufferStart+this.profile.poles.length+this.profile.vertices.length:this.vertexBufferStart+this.profile.poles.length;for(let s=0;s<this.profile.numSegments;++s){const a=this.profile.vertexIndices[2*s+0],o=this.profile.vertexIndices[2*s+1],l=this.vertexBufferStart+this.profile.poleIndices[a],c=this.vertexBufferStart+this.profile.poleIndices[o];let u=i+a,h=i+o;for(let p=0;p<this.numSegments-1;++p){const m=n+p*this.profile.vertices.length+a,g=n+p*this.profile.vertices.length+o;this.flip?(r(m,h,u),r(h,m,g)):(r(u,h,m),r(g,m,h)),u=m,h=g}this.flip?(r(l,h,u),l!==c&&r(l,c,h)):(r(u,h,l),l!==c&&r(h,c,l))}}}class o3t{constructor(t,r,i,n,s,a=a3t){this.options=a,this._extrusionVertexCount=0,this._triangleCount=0,this.numExtrusionProfiles=0,this.numVerticesTotal=0,this.numNormalsTotal=0,this.numUVTotal=0,this.profile=r,this.path=t,this.extruder=i,this.startCap=n,this.endCap=s;const o=this.path.vertices.length-2;this.numExtrusionProfiles=i.numProfilesPerJoin()*o+2,this.numVerticesTotal=r.vertices.length*this.numExtrusionProfiles,this.numNormalsTotal=this.numVerticesTotal,this.startCap.vertexBufferStart=this.numVerticesTotal;const l=this.startCap.getNumVertices();this.numVerticesTotal+=l,this.numNormalsTotal+=l,this.endCap.vertexBufferStart=this.numVerticesTotal;const c=this.endCap.getNumVertices();this.numVerticesTotal+=c,this.numNormalsTotal+=c,this.pathVertexData=new Float32Array(1*this.numVerticesTotal),this.profileRightAxisData=new Float32Array(4*this.numVerticesTotal),this.profileUpAxisData=new Float32Array(4*this.numVerticesTotal),this.profileVertexAndNormalData=new Float32Array(4*this.numVerticesTotal),this.profile.hasUV()&&this.options.generateUV&&(this.numUVTotal=this.profile.uvs.length,this.uvData=new Float32Array(2*this.numUVTotal)),this.originData=new Float32Array(3*this.path.vertices.length),this._rebuildGeometry(),this.buildTopology()}emitVertex(t,r,i,n,s){if(this.profileRightAxisData[4*this._extrusionVertexCount+0]=r.right[0],this.profileRightAxisData[4*this._extrusionVertexCount+1]=r.right[1],this.profileRightAxisData[4*this._extrusionVertexCount+2]=r.right[2],this.profileUpAxisData[4*this._extrusionVertexCount+0]=r.up[0],this.profileUpAxisData[4*this._extrusionVertexCount+1]=r.up[1],this.profileUpAxisData[4*this._extrusionVertexCount+2]=r.up[2],this.profileVertexAndNormalData[4*this._extrusionVertexCount+0]=i[0],this.profileVertexAndNormalData[4*this._extrusionVertexCount+1]=i[1],this.profileVertexAndNormalData[4*this._extrusionVertexCount+2]=n[0],this.profileVertexAndNormalData[4*this._extrusionVertexCount+3]=n[1],this.pathVertexData[this._extrusionVertexCount]=t,s){const a=this.path.vertices[t];this.profileRightAxisData[4*this._extrusionVertexCount+3]=a.rotationRight[0]*a.maxStretchDistance,this.profileUpAxisData[4*this._extrusionVertexCount+3]=a.rotationRight[1]*a.maxStretchDistance}else this.profileRightAxisData[4*this._extrusionVertexCount+3]=0,this.profileUpAxisData[4*this._extrusionVertexCount+3]=0;++this._extrusionVertexCount}emitCapVertex(t,r,i,n,s,a){this.profileRightAxisData[4*this._extrusionVertexCount+0]=r.right[0],this.profileRightAxisData[4*this._extrusionVertexCount+1]=r.right[1],this.profileRightAxisData[4*this._extrusionVertexCount+2]=r.right[2],this.profileUpAxisData[4*this._extrusionVertexCount+0]=r.up[0],this.profileUpAxisData[4*this._extrusionVertexCount+1]=r.up[1],this.profileUpAxisData[4*this._extrusionVertexCount+2]=r.up[2],this.profileVertexAndNormalData[4*this._extrusionVertexCount+0]=i[0],this.profileVertexAndNormalData[4*this._extrusionVertexCount+1]=i[1],this.profileVertexAndNormalData[4*this._extrusionVertexCount+2]=n[0],this.profileVertexAndNormalData[4*this._extrusionVertexCount+3]=n[1],this.pathVertexData[this._extrusionVertexCount]=t,this.profileRightAxisData[4*this._extrusionVertexCount+3]=s,this.profileUpAxisData[4*this._extrusionVertexCount+3]=a,++this._extrusionVertexCount}emitTriangle(t,r,i){this.vertexIndices[3*this._triangleCount+0]=t,this.vertexIndices[3*this._triangleCount+1]=r,this.vertexIndices[3*this._triangleCount+2]=i,this.pathVertexIndices[3*this._triangleCount+0]=this.pathVertexData[t],this.pathVertexIndices[3*this._triangleCount+1]=this.pathVertexData[r],this.pathVertexIndices[3*this._triangleCount+2]=this.pathVertexData[i],this.normalIndices[3*this._triangleCount+0]=t,this.normalIndices[3*this._triangleCount+1]=r,this.normalIndices[3*this._triangleCount+2]=i,++this._triangleCount}_rebuildGeometry(){const t=(i,n,s,a,o)=>this.emitVertex(i,n,s,a,o),r=(i,n,s,a,o,l)=>this.emitCapVertex(i,n,s,a,o,l);this._extrusionVertexCount=0;for(const i of this.path.vertices)this.originData[3*i.index+0]=i.pos[0],this.originData[3*i.index+1]=i.pos[1],this.originData[3*i.index+2]=i.pos[2];this.startCap.rebuildConnectingProfileGeometry(this.path.vertices[0],this.profile,r);for(let i=1;i<this.path.vertices.length-1;++i)this.extruder.extrude(this.path.vertices[i],this.profile,t);if(this.endCap.rebuildConnectingProfileGeometry(this.path.vertices[this.path.vertices.length-1],this.profile,r),this.startCap.rebuildCapGeometry(this.path.vertices[0],r),this.endCap.rebuildCapGeometry(this.path.vertices[this.path.vertices.length-1],r),this.profile.hasUV()&&this.options.generateUV)for(let i=0;i<this.profile.uvs.length;++i)this.uvData[2*i+0]=this.profile.uvs[i],this.uvData[2*i+1]=0}buildTopology(){const t=(a,o,l)=>this.emitTriangle(a,o,l);this._triangleCount=0;const r=this.profile.vertices.length,i=this.profile.numSegments,n=this.numExtrusionProfiles-1;let s=3*(2*(i*n));this.startCap.indexBufferStart=s,this.startCap.firstProfileVertexIndex=0,s+=this.startCap.getNumIndices(),this.endCap.indexBufferStart=s,this.endCap.firstProfileVertexIndex=r*(this.numExtrusionProfiles-1),s+=this.endCap.getNumIndices(),this.vertexIndices=new Uint32Array(s),this.normalIndices=new Uint32Array(s),this.pathVertexIndices=new Uint32Array(s),this.profile.hasUV()&&this.options.generateUV&&(this.uvIndices=new Uint32Array(s));for(let a=0;a<i;++a){const o=this.profile.vertexIndices[2*a],l=this.profile.vertexIndices[2*a+1];for(let c=0;c<n;++c){const u=c*r+o,h=(c+1)*r+l,p=c*r+l;t(u,(c+1)*r+o,h),t(u,h,p)}}this.startCap.buildTopology(this.path.vertices[0],t),this.endCap.buildTopology(this.path.vertices[this.path.vertices.length-1],t)}onPathChanged(){this._rebuildGeometry()}}class AOe{constructor(t){this.builder=t}get xform(){return this.builder.path.xform}onPathChanged(){this.builder.onPathChanged()}}class ROe extends AOe{constructor(t){super(t),this.vertexAttributePosition=null,this.vertexAttributeNormal=null,this.vertexAttributeColor=null,this.vertexAttributePosition=new Float32Array(3*this.builder.numVerticesTotal),this.vertexAttributeNormal=new Float32Array(3*this.builder.numNormalsTotal),this.vertexAttributeColor=new Uint8Array(4),this.vertexAttributeColor[0]=255,this.vertexAttributeColor[1]=255,this.vertexAttributeColor[2]=255,this.vertexAttributeColor[3]=255}bakeVertexColors(t){this.vertexAttributeColor[0]=255*t[0],this.vertexAttributeColor[1]=255*t[1],this.vertexAttributeColor[2]=255*t[2],this.vertexAttributeColor[3]=255*(t.length>3?t[3]:1)}bake(t){this.size=t;for(let r=0;r<this.builder.numVerticesTotal;++r){let i=this.builder.pathVertexData[r];const n=i===0||i===this.builder.path.vertices.length-1;i*=3;const s=c3t;ne(s,this.builder.originData[i++],this.builder.originData[i++],this.builder.originData[i]);const a=4*r,o=Vf,l=Q3,c=lh,u=yK,h=u3t;let p=0,m=0;if(ne(u,this.builder.profileRightAxisData[a],this.builder.profileRightAxisData[a+1],this.builder.profileRightAxisData[a+2]),ne(h,this.builder.profileUpAxisData[a],this.builder.profileUpAxisData[a+1],this.builder.profileUpAxisData[a+2]),vr(l,this.builder.profileVertexAndNormalData[a]*t[0],this.builder.profileVertexAndNormalData[a+1]*t[1]),n)dt(c,h,u),p=this.builder.profileRightAxisData[a+3]*t[0],m=this.builder.profileUpAxisData[a+3];else{const b=Rae,w=d3t;vr(b,this.builder.profileRightAxisData[a+3],this.builder.profileUpAxisData[a+3]);const v=Yne(b);DA(b,b);const x=us(l,b);if(Math.abs(x)>v){vr(w,-b[1],b[0]);const T=us(l,w);Qc(b,b,v*Math.sign(x)),Qc(w,w,T),Kf(l,b,w)}ne(c,0,0,0)}ne(o,u[0]*l[0]+h[0]*l[1],u[1]*l[0]+h[1]*l[1],u[2]*l[0]+h[2]*l[1]),this.vertexAttributePosition[3*r+0]=s[0]+o[0]+c[0]*p,this.vertexAttributePosition[3*r+1]=s[1]+o[1]+c[1]*p,this.vertexAttributePosition[3*r+2]=s[2]+o[2]+c[2]*p;const g=Q3;vr(g,this.builder.profileVertexAndNormalData[a+2],this.builder.profileVertexAndNormalData[a+3]),this.vertexAttributeNormal[3*r+0]=u[0]*g[0]+h[0]*g[1]+c[0]*m,this.vertexAttributeNormal[3*r+1]=u[1]*g[0]+h[1]*g[1]+c[1]*m,this.vertexAttributeNormal[3*r+2]=u[2]*g[0]+h[2]*g[1]+c[2]*m}}createGeometryData(){const t=[[O.POSITION,this.builder.vertexIndices],[O.NORMAL,this.builder.normalIndices]],r=[[O.POSITION,{size:3,data:this.vertexAttributePosition,exclusive:!0}],[O.NORMAL,{size:3,data:this.vertexAttributeNormal,exclusive:!0}]];if(this.vertexAttributeColor){const i=this.builder.vertexIndices.length;t.push([O.COLOR,new Uint32Array(i)]),r.push([O.COLOR,{size:4,data:this.vertexAttributeColor}])}return{vertexAttributes:r,indices:t}}onPathChanged(){super.onPathChanged(),this.bake(this.size)}intersect(t,r,i){const n=this.builder.vertexIndices,s={size:3,data:this.vertexAttributePosition},a=n.length/3;EO(t,r,0,a,n,s,void 0,void 0,i)}}class l3t extends AOe{constructor(t,r,i,n){super(t),this.sizeAttributeValue=r,this.colorAttributeValue=i,this.opacityAttributeValue=n,this.vvData=null,this.baked=new ROe(t),this.vvData=new Float32Array(4*this.builder.path.vertices.length);for(let s=0;s<this.builder.path.vertices.length;++s){this.vvData[4*s+0]=r,this.vvData[4*s+1]=i,this.vvData[4*s+2]=n;const a=s===0||s===this.builder.path.vertices.length-1;this.vvData[4*s+3]=a?1:0}}createGeometryData(){return{vertexAttributes:[[O.POSITION,{size:3,data:this.builder.originData,exclusive:!0}],[O.PROFILERIGHT,{size:4,data:this.builder.profileRightAxisData,exclusive:!0}],[O.PROFILEUP,{size:4,data:this.builder.profileUpAxisData,exclusive:!0}],[O.PROFILEVERTEXANDNORMAL,{size:4,data:this.builder.profileVertexAndNormalData,exclusive:!0}],[O.FEATUREVALUE,{size:4,data:this.vvData,exclusive:!0}]],indices:[[O.POSITION,this.builder.pathVertexIndices],[O.PROFILERIGHT,this.builder.vertexIndices],[O.PROFILEUP,this.builder.vertexIndices],[O.PROFILEVERTEXANDNORMAL,this.builder.vertexIndices],[O.FEATUREVALUE,this.builder.pathVertexIndices]]}}}const c3t=M(),Q3=it(),Rae=it(),d3t=it(),Vf=M(),lh=M(),yK=M(),u3t=M(),TI=M(),h3t=gK(),Oge=Ae(),qq=8;function f3t(e,t){e.attributes.add(O.FEATUREVALUE,"vec4");const r=e.vertex;r.code.add(S`bool isCapVertex() {
return featureValue.w == 1.0;
}`),r.uniforms.add(new _r("size",i=>i.size)),t.vvSize?(r.uniforms.add(new St("vvSizeMinSize",i=>i.vvSizeMinSize)),r.uniforms.add(new St("vvSizeMaxSize",i=>i.vvSizeMaxSize)),r.uniforms.add(new St("vvSizeOffset",i=>i.vvSizeOffset)),r.uniforms.add(new St("vvSizeFactor",i=>i.vvSizeFactor)),r.code.add(S`vec2 getSize() {
return size * clamp(vvSizeOffset + featureValue.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).xz;
}`)):r.code.add(S`vec2 getSize(){
return size;
}`),t.vvOpacity?(r.constants.add("vvOpacityNumber","int",qq),r.uniforms.add([new Oo("vvOpacityValues",i=>i.vvOpacityValues,qq),new Oo("vvOpacityOpacities",i=>i.vvOpacityOpacities,qq)]),r.code.add(S`vec4 applyOpacity(vec4 color) {
float value = featureValue.z;
if (value <= vvOpacityValues[0]) {
return vec4( color.xyz, vvOpacityOpacities[0]);
}
for (int i = 1; i < vvOpacityNumber; ++i) {
if (vvOpacityValues[i] >= value) {
float f = (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);
return vec4( color.xyz, mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f));
}
}
return vec4( color.xyz, vvOpacityOpacities[vvOpacityNumber - 1]);
}`)):r.code.add(S`vec4 applyOpacity(vec4 color){
return color;
}`),t.vvColor?(r.constants.add("vvColorNumber","int",Cp),r.uniforms.add([new Oo("vvColorValues",i=>i.vvColorValues,Cp),new Jz("vvColorColors",i=>i.vvColorColors,Cp)]),r.code.add(S`vec4 getColor() {
float value = featureValue.y;
if (value <= vvColorValues[0]) {
return applyOpacity(vvColorColors[0]);
}
for (int i = 1; i < vvColorNumber; ++i) {
if (vvColorValues[i] >= value) {
float f = (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);
return applyOpacity(mix(vvColorColors[i-1], vvColorColors[i], f));
}
}
return applyOpacity(vvColorColors[vvColorNumber - 1]);
}`)):r.code.add(S`vec4 getColor(){
return applyOpacity(vec4(1, 1, 1, 1));
}`),e.include(hU),e.attributes.add(O.PROFILERIGHT,"vec4"),e.attributes.add(O.PROFILEUP,"vec4"),e.attributes.add(O.PROFILEVERTEXANDNORMAL,"vec4"),r.code.add(S`vec3 calculateVPos() {
vec2 size = getSize();
vec3 origin = position;
vec3 right = profileRight.xyz;
vec3 up = profileUp.xyz;
vec3 forward = cross(up, right);
vec2 profileVertex = profileVertexAndNormal.xy * size;
vec2 profileNormal = profileVertexAndNormal.zw;
float positionOffsetAlongProfilePlaneNormal = 0.0;
float normalOffsetAlongProfilePlaneNormal = 0.0;`),r.code.add(S`if(!isCapVertex()) {
vec2 rotationRight = vec2(profileRight.w, profileUp.w);
float maxDistance = length(rotationRight);`),r.code.add(S`rotationRight = maxDistance > 0.0 ? normalize(rotationRight) : vec2(0, 0);
float rx = dot(profileVertex, rotationRight);
if (abs(rx) > maxDistance) {
vec2 rotationUp = vec2(-rotationRight.y, rotationRight.x);
float ry = dot(profileVertex, rotationUp);
profileVertex = rotationRight * maxDistance * sign(rx) + rotationUp * ry;
}
}else{
positionOffsetAlongProfilePlaneNormal = profileRight.w * size[0];
normalOffsetAlongProfilePlaneNormal = profileUp.w;
}
vec3 offset = right * profileVertex.x + up * profileVertex.y + forward * positionOffsetAlongProfilePlaneNormal;
return origin + offset;
}`),r.code.add(S`vec3 localNormal() {
vec3 right = profileRight.xyz;
vec3 up = profileUp.xyz;
vec3 forward = cross(up, right);
vec2 profileNormal = profileVertexAndNormal.zw;
vec3 normal = right * profileNormal.x + up * profileNormal.y;
if(isCapVertex()) {
normal += forward * profileUp.w;
}
return normal;
}`)}class p3t extends rae{constructor(){super(...arguments),this.size=Nr(1,1)}}function m3t(e){const t=new Qr,r=_u(t,e),{vertex:i,fragment:n}=t;return t.varyings.add("vpos","vec3"),t.include(f3t,e),e.output!==K.Color&&e.output!==K.Alpha||(t.include(no),t.include(ax,e),t.include(LO,e),t.varyings.add("vnormal","vec3"),t.varyings.add("vcolor","vec4"),e.hasMultipassTerrain&&t.varyings.add("depth","float"),i.code.add(S`
      void main() {
        vpos = calculateVPos();
        vnormal = normalize(localNormal());

        ${e.hasMultipassTerrain?"depth = (view * vec4(vpos, 1.0)).z;":""}
        gl_Position = transformPosition(proj, view, vpos);

        ${e.output===K.Color?"forwardLinearDepth();":""}

        vcolor = getColor();
      }
    `)),t.include(Mu,e),e.output===K.Alpha&&(t.include(Cn,e),n.uniforms.add(new He("opacity",s=>s.opacity)),n.code.add(S`
      void main() {
        discardBySlice(vpos);
        ${e.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}
        float combinedOpacity = vcolor.a * opacity;
        gl_FragColor = vec4(combinedOpacity);
      }
    `)),e.output===K.Color&&(t.include(Cn,e),t.include(ox,e),t.include(NO,e),t.include(ax,e),t.include(IRe,e),_m(n,e),n.uniforms.add([r,new St("ambient",s=>s.ambient),new St("diffuse",s=>s.diffuse),new St("specular",s=>s.specular),new He("opacity",s=>s.opacity),new He("lightingGlobalFactor",(s,a)=>a.lighting.globalFactor),new St("lightingMainIntensity",(s,a)=>a.lighting.mainLight.intensity)]),n.constants.add("ambientBoostFactor","float",v6),n.include($m),n.code.add(S`
      void main() {
        discardBySlice(vpos);
        ${e.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}

        shadingParams.viewDirection = normalize(vpos - cameraPosition);
        shadingParams.normalView = vnormal;
        vec3 normal = shadingNormal(shadingParams);
        float ssao = evaluateAmbientOcclusionInverse();

        float additionalAmbientScale = additionalDirectedAmbientLight(vpos + localOrigin);
        vec3 additionalLight = ssao * lightingMainIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;
        ${e.receiveShadows?"float shadow = readShadowMap(vpos, linearDepth);":e.spherical?"float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);":"float shadow = 0.0;"}
        vec3 albedo = vcolor.rgb * max(ambient, diffuse); // combine the old material parameters into a single one
        float combinedOpacity = vcolor.a * opacity;
        albedo += 0.25 * specular; // don't completely ignore specular for now

        vec3 shadedColor = evaluateSceneLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight);
        gl_FragColor = vec4(shadedColor, combinedOpacity);
        gl_FragColor = highlightSlice(gl_FragColor, vpos);
        ${e.transparencyPassType===yt.Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}
      }
    `)),e.output!==K.Depth&&e.output!==K.Shadow||(t.include(no,{hasModelTransformation:!1,linearDepth:!0}),i.uniforms.add(new _r("nearFar",(s,a)=>a.camera.nearFar)),t.varyings.add("depth","float"),i.code.add(S`void main() {
vpos = calculateVPos();
gl_Position = transformPositionWithDepth(proj, view, vpos, nearFar, depth);
}`),t.include(Cn,e),t.include(x_,e),n.code.add(S`void main() {
discardBySlice(vpos);
outputDepth(depth);
}`)),e.output===K.Normal&&(t.include(no),t.include(gv,e),i.uniforms.add(new Ei("viewNormal",(s,a)=>a.camera.viewInverseTransposeMatrix)),t.varyings.add("vnormal","vec3"),i.code.add(S`void main(void) {
vpos = calculateVPos();
vnormal = normalize((viewNormal * vec4(localNormal(), 1.0)).xyz);
gl_Position = transformPosition(proj, view, vpos);
}`),t.include(Cn,e),n.uniforms.add(new pl("waterColor")),n.code.add(S`void main() {
discardBySlice(vpos);
vec3 normal = normalize(vnormal);
if (gl_FrontFacing == false) normal = -normal;
gl_FragColor = vec4(vec3(0.5) + 0.5 * normal, 1.0);
}`)),e.output===K.Highlight&&(t.include(no),t.include(gv,e),t.varyings.add("vnormal","vec3"),i.code.add(S`void main(void) {
vpos = calculateVPos();
gl_Position = transformPosition(proj, view, vpos);
}`),t.include(Cn,e),t.include(Ky),n.code.add(S`void main() {
discardBySlice(vpos);
outputHighlight();
}`)),t}const g3t=Object.freeze(Object.defineProperty({__proto__:null,build:m3t},Symbol.toStringTag,{value:"Module"})),OOe=new Map([[O.POSITION,0],[O.PROFILERIGHT,1],[O.PROFILEUP,2],[O.PROFILEVERTEXANDNORMAL,3],[O.FEATUREVALUE,4]]);class y3t extends p3t{constructor(){super(...arguments),this.ambient=Ve(.2,.2,.2),this.diffuse=Ve(.8,.8,.8),this.specular=Ve(0,0,0),this.opacity=1}}class OU extends gi{initializeConfiguration(t,r){r.spherical=t.viewingMode===Be.Global,r.doublePrecisionRequiresObfuscation=$O(t.rctx)}initializeProgram(t){const r=OU.shader.get().build(this.configuration);return new ai(t.rctx,r,OOe)}_setPipelineState(t){const r=this.configuration,i=t===yt.NONE,n=t===yt.FrontFace,s=a=>!a.hasSlicePlane&&!(a.transparent||a.doubleSidedMode===Yi.None);return jt({blending:r.output!==K.Color&&r.output!==K.Alpha||!r.transparent?null:i?wu:eb(t),culling:s(r)&&AEe,depthTest:{func:w_(t)},depthWrite:i||n?fc:null,colorWrite:or,stencilWrite:r.hasOccludees?xm:null,stencilTest:r.hasOccludees?T_:null,polygonOffset:i||n?null:tU})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}}OU.shader=new si(g3t,()=>ie(()=>import("./Path.glsl.613e9db5.js"),[],import.meta.url));class Xs extends Mo{constructor(){super(...arguments),this.output=K.Color,this.doubleSidedMode=Yi.None,this.transparencyPassType=yt.NONE,this.spherical=!1,this.receiveShadows=!1,this.receiveAmbientOcclusion=!1,this.vvSize=!1,this.vvColor=!1,this.vvOpacity=!1,this.hasSlicePlane=!1,this.transparent=!1,this.hasOccludees=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1,this.doublePrecisionRequiresObfuscation=!1}}d([H({count:K.COUNT})],Xs.prototype,"output",void 0),d([H({count:Yi.COUNT})],Xs.prototype,"doubleSidedMode",void 0),d([H({count:yt.COUNT})],Xs.prototype,"transparencyPassType",void 0),d([H()],Xs.prototype,"spherical",void 0),d([H()],Xs.prototype,"receiveShadows",void 0),d([H()],Xs.prototype,"receiveAmbientOcclusion",void 0),d([H()],Xs.prototype,"vvSize",void 0),d([H()],Xs.prototype,"vvColor",void 0),d([H()],Xs.prototype,"vvOpacity",void 0),d([H()],Xs.prototype,"hasSlicePlane",void 0),d([H()],Xs.prototype,"transparent",void 0),d([H()],Xs.prototype,"hasOccludees",void 0),d([H()],Xs.prototype,"hasMultipassTerrain",void 0),d([H()],Xs.prototype,"cullAboveGround",void 0),d([H()],Xs.prototype,"doublePrecisionRequiresObfuscation",void 0),d([H({constValue:It.Disabled})],Xs.prototype,"pbrMode",void 0),d([H({constValue:!0})],Xs.prototype,"hasVvInstancing",void 0),d([H({constValue:!1})],Xs.prototype,"useCustomDTRExponentForWater",void 0),d([H({constValue:!1})],Xs.prototype,"useFillLights",void 0);class Oae extends Dm{constructor(t){super(t,new v3t),this.supportsEdges=!0,this._vertexAttributeLocations=OOe,this._configuration=new Xs,this.vertexBufferLayout=Oae.getVertexBufferLayout(this.parameters)}getConfiguration(t,r){return this._configuration.output=t,this._configuration.vvSize=this.parameters.vvSizeEnabled,this._configuration.vvColor=this.parameters.vvColorEnabled,this._configuration.vvOpacity=this.parameters.vvOpacityEnabled,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this.parameters.transparent,this._configuration.hasOccludees=this.parameters.hasOccludees,t!==K.Color&&t!==K.Alpha||(this._configuration.doubleSidedMode=this.parameters.doubleSided&&this.parameters.doubleSidedType==="normal"?Yi.View:this.parameters.doubleSided&&this.parameters.doubleSidedType==="winding-order"?Yi.WindingOrder:Yi.None,this._configuration.receiveShadows=this.parameters.receiveShadows,this._configuration.receiveAmbientOcclusion=!!r.ssaoHelper.ready&&this.parameters.receiveSSAO),this._configuration.transparencyPassType=r.transparencyPassType,this._configuration.hasMultipassTerrain=r.multipassTerrain.enabled,this._configuration.cullAboveGround=r.multipassTerrain.cullAboveGround,this._configuration}isVisibleInPass(t){return t!==je.MATERIAL_DEPTH_SHADOWMAP_ALL&&t!==je.MATERIAL_DEPTH_SHADOWMAP_DEFAULT&&t!==je.MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT||this.parameters.castShadows}isVisible(){const t=this.parameters;return!!super.isVisible()&&t.opacity>0}intersect(t,r,i,n,s,a,o){const l=t;if(!EOe(l))return;const c=l.path,u=[this.parameters.size[0],this.parameters.size[1]];if(this.parameters.vvSizeEnabled){const v=this.parameters.vvSizeOffset,x=this.parameters.vvSizeFactor,T=this.parameters.vvSizeMinSize,E=this.parameters.vvSizeMaxSize,C=c.sizeAttributeValue;u[0]*=Le(v[0]+C*x[0],T[0],E[0]),u[1]*=Le(v[2]+C*x[2],T[2],E[2])}const h=Math.max(u[0],u[1]),p=t.boundingInfo;if(R(p))return void this._intersectTriangles(c,u,s,a,o);const m=Dw(p.bbMin[0]-h,p.bbMin[1]-h,p.bbMin[2]-h,p.bbMax[0]+h,p.bbMax[1]+h,p.bbMax[2]+h),g=[a[0]-s[0],a[1]-s[1],a[2]-s[2]],b=Math.sqrt(g[0]*g[0]+g[1]*g[1]+g[2]*g[2]),w=[b/g[0],b/g[1],b/g[2]];Zse(m,s,w,n.tolerance)&&this._intersectTriangles(c,u,s,a,o)}_intersectTriangles(t,r,i,n,s){t.baked.size&&t.baked.size[0]===r[0]&&t.baked.size[1]===r[1]||t.baked.bake(r),t.baked.intersect(i,n,s)}computeAttachmentOrigin(t,r){const i=t.vertexAttributes;if(!i)return null;const n=i.get(O.POSITION);return xse(n,null,!1,r)}createBufferWriter(){return new _3t(this.vertexBufferLayout)}requiresSlot(t){return t===(this.parameters.transparent?Ee.TRANSPARENT_MATERIAL:Ee.OPAQUE_MATERIAL)||t===Ee.DRAPED_MATERIAL}createGLMaterial(t){return t.output===K.Color||t.output===K.Alpha||t.output===K.Depth||t.output===K.Normal||t.output===K.Highlight||t.output===K.Shadow&&this.parameters.castShadows?new b3t(t):null}static getVertexBufferLayout(t){let r=gn().vec3f(O.POSITION).vec4f(O.PROFILERIGHT).vec4f(O.PROFILEUP).vec4f(O.PROFILEVERTEXANDNORMAL);return(t.vvColorEnabled||t.vvSizeEnabled||t.vvOpacityEnabled)&&(r=r.vec4f(O.FEATUREVALUE)),r}}class b3t extends v_{_updateOccludeeState(t){t.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:t.hasOccludees})}_updateShadowState(t){(R(this.technique)||t.shadowMap.enabled!==this.technique.configuration.receiveShadows)&&this._material.setParameters({receiveShadows:t.shadowMap.enabled})}beginSlot(t){return this._output!==K.Color&&this._output!==K.Alpha||(this._updateShadowState(t),this._updateOccludeeState(t)),this.ensureTechnique(OU,t)}}class v3t extends y3t{constructor(){super(...arguments),this.doubleSided=!1,this.doubleSidedType="normal",this.receiveSSAO=!0,this.receiveShadows=!1,this.castShadows=!0,this.hasSlicePlane=!1,this.transparent=!1,this.hasOccludees=!1}}class _3t{constructor(t){this.vertexBufferLayout=t}allocate(t){return this.vertexBufferLayout.createBuffer(t)}elementCount(t){return t.indices.get(O.POSITION).length}write(t,r,i,n){const s=a=>{if(r.vertexAttributes.has(a)){const o=r.vertexAttributes.get(a),l=r.indices.get(a);pt(o.size===4);const c=i.getField(a,ca);if(!c)throw new Error("unable to acquire view for "+a);R9(l,o.data,c,n)}};s(O.PROFILERIGHT),s(O.PROFILEUP),s(O.PROFILEVERTEXANDNORMAL),this.vertexBufferLayout.hasField(O.FEATUREVALUE)&&s(O.FEATUREVALUE),Qz(r,this.vertexBufferLayout,t.transformation,t.invTranspTransformation,i,n)}}const w3t=["polyline"];class x3t extends Nm{constructor(t,r,i,n){super(t,r,i,n),this._intrinsicSize=Nr(1,1),this.upVectorAlignment="path",this.stencilWidth=.1,this.ensureDrapedStatus(!1)}async doLoad(){const t=_(this.symbolLayer.width)?this.symbolLayer.width:this.symbolLayer.height,r=_(this.symbolLayer.height)?this.symbolLayer.height:t;this._vvConvertOptions={modelSize:[1,1,1],symbolSize:[t,1,r],unitInMeters:this._context.renderCoordsHelper.unitInMeters,transformation:{anchor:[0,0,0],scale:[1,1,1],rotation:[0,0,0]},supportedTypes:{size:!0,color:!0,opacity:!0,rotation:!1}},this._context.renderer&&this._context.renderer.visualVariables&&this._context.renderer.visualVariables.length>0?this._fastUpdates=mR(this._context.renderer,this._vvConvertOptions):this._fastUpdates={enabled:!1};const i=this.symbolLayer.anchor||"center";this.upVectorAlignment="path",this.symbolLayer.profileRotation==="heading"&&(this.upVectorAlignment="world");const n=this.symbolLayer.profile||"circle";switch(n){case"circle":default:this._profile=bR.circle(A3t);break;case"quad":this._profile=bR.rect()}let s=[0,0];switch(i!=="center"&&(s={left:[.5,0],right:[-.5,0],top:[0,-.5],bottom:[0,.5]}[i],this._profile.translate(s[0],s[1])),this.symbolLayer.join||"simple"){case"round":this._extruder=new jq(0,C3t);break;case"bevel":this._extruder=new jq(0,1);break;case"miter":this._extruder=new jq(.8*Math.PI,1);break;default:this._extruder=new s3t}const a=this.symbolLayer.cap||"butt";switch(a){case"none":this._startCap=new Age,this._endCap=new Age;break;case"butt":default:this._startCap=new xI(this._profile,0),this._endCap=new xI(this._profile,0,!0);break;case"square":this._startCap=new xI(this._profile,-.5),this._endCap=new xI(this._profile,.5,!0);break;case"round":{const m=n==="quad";this._startCap=new Rge({profile:this._profile,flip:!1,breakNormals:m,subdivisions:Ige}),this._endCap=new Rge({profile:this._profile,flip:!0,breakNormals:m,subdivisions:Ige});break}}const o=Vi(this.symbolLayer,"material","color"),l=this._getCombinedOpacityAndColor(o),c=Wl(l),u=l[3],h=u<1||this.needsDrivenTransparentPass,p={diffuse:c,ambient:c,opacity:u,transparent:h,hasVertexColors:!1,hasSlicePlane:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows,cullFace:h||a==="none"?pi.None:pi.Back,offsetTransparentBackfaces:!0};if(!this._drivenProperties.size&&(vr(this._intrinsicSize,t,r),!ck(this._intrinsicSize[0])||!ck(this._intrinsicSize[1])))throw new k("graphics3dpathsymbollayer:invalid-size","Symbol sizes may not be negative values");if(this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size||Qc(this._intrinsicSize,this._intrinsicSize,1/this._context.renderCoordsHelper.unitInMeters),this._fastUpdates.enabled){const m={...p,...this._fastUpdates.materialParameters,size:KTe(this._intrinsicSize)};this._material=new Oae(m)}else p.hasVertexColors=this._drivenProperties.color||this._drivenProperties.opacity,this._material=new lx(p);this._material.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}),this._context.stage.add(this._material)}destroy(){super.destroy(),this._context.stage.remove(this._material),this._material=null}createGraphics3DGraphic(t){const r=t.graphic;if(!this._validateGeometry(r.geometry,w3t,this.symbolLayer.type))return null;const i=this.setGraphicElevationContext(r,new Du),n=t.renderingInfo;return this._createAs3DShape(r,n,i,r.uid)}layerOpacityChanged(){const t=Vi(this.symbolLayer,"material","color"),r=this._getCombinedOpacity(t),i=r<1||this.needsDrivenTransparentPass;return this._material.setParameters({opacity:r,transparent:i}),!0}layerElevationInfoChanged(t,r){return this.updateGraphics3DGraphicElevationInfo(t,r,l_)}slicePlaneEnabledChanged(){return this._material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),!0}physicalBasedRenderingChanged(){return this._material.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}),!0}pixelRatioChanged(){return!0}applyRendererDiff(t,r){for(const i in t.diff){if(i!=="visualVariables"||!gR(this._fastUpdates,r,this._vvConvertOptions))return xs.Recreate_Symbol;this._material.setParameters(this._fastUpdates.materialParameters)}return xs.Fast_Update}getVertexData(t){let r=0;const i=t.paths,n=[],s=t.spatialReference,a=this._context.elevationProvider.spatialReference,o=this._context.renderCoordsHelper.spatialReference;for(const m of i)r+=m.length;const l=new Float64Array(3*r),c=new Float64Array(3*r),u=new Float64Array(3*r);let h=0;for(const m of i){n.push({index:h,numVertices:m.length});for(const g of m)l[h++]=g[0],l[h++]=g[1],l[h++]=t.hasZ?g[2]:0}let p=!0;return s.equals(a)?this._copyVertices(l,0,c,0,r):p=mi(l,s,0,c,a,0,r),a.equals(o)?this._copyVertices(c,0,u,0,r):mi(c,a,0,u,o,0,r),{pathVertexDataInfos:n,vertexDataGS:l,vertexDataES:c,vertexDataRS:u,projectionSuccess:p,terrainElevation:0}}_copyVertices(t,r,i,n,s){r*=3,n*=3;for(let a=0;a<s;++a)i[n++]=t[r++],i[n++]=t[r++],i[n++]=t[r++]}_createAs3DShape(t,r,i,n){const s=t.geometry,a=new Array,o=new Array,l=new Array,c=s.spatialReference,u=is(),h=this._context.renderCoordsHelper;POe.spatialReference=c;const p=this.getVertexData(s);if(!p.projectionSuccess)return this.logger.warn("PathSymbol3DLayer geometry failed to be created (failed to project geometry to view spatial reference)"),null;if(p.pathVertexDataInfos.length>0){for(let m=0;m<p.pathVertexDataInfos.length;++m){const g=p.pathVertexDataInfos[m],b=g.index,w=g.numVertices;if(w<2||_(this._context.clippingExtent)&&(bi(u),hu(u,p.vertexDataES,3*b,w),!pp(u,this._context.clippingExtent)))continue;const v=[];for(let I=b;I<b+3*w;){const L=I++,V=I++,G=I++,B=new r3t;ne(B.posGS,p.vertexDataGS[L],p.vertexDataGS[V],p.vertexDataGS[G]),ne(B.posES,p.vertexDataES[L],p.vertexDataES[V],p.vertexDataES[G]);const X=ygt(B.posES,this._context.elevationProvider,i,h);ne($h,p.vertexDataRS[L],p.vertexDataRS[V],p.vertexDataRS[G]),h.setAltitude($h,X),ne(B.pos,$h[0],$h[1],$h[2]),v.push(B)}const x=new i3t(v);MOe(x,this.upVectorAlignment,this._context.renderCoordsHelper);const T=new o3t(x,this._profile,this._extruder,this._startCap,this._endCap);let E=null;if(this._fastUpdates.enabled){const I=this._fastUpdates.visualVariables,L=I.size?my(I.size.field,t):0,V=I.color?my(I.color.field,t):0,G=I.opacity?my(I.opacity.field,t):0;E=new l3t(T,L,V,G)}else{const I=[this._intrinsicSize[0],this._intrinsicSize[1]];this._drivenProperties.size&&(I[0]*=Mge(r.size[0],r.size[2]==="symbol-value"?this.symbolLayer.height||0:r.size[2],this.symbolLayer.width||0),I[1]*=Mge(r.size[2],r.size[0]==="symbol-value"?this.symbolLayer.width||0:r.size[0],this.symbolLayer.height||0));let L=null;this._drivenProperties.color&&(L=r.color),this._drivenProperties.opacity&&r.opacity!=null&&(L=L?[L[0],L[1],L[2],r.opacity]:[1,1,1,r.opacity]);const V=new ROe(T);V.bake(I),L&&V.bakeVertexColors(L),E=V}const{vertexAttributes:C,indices:A}=E.createGeometryData(),P=new Z2t(C,A,E,c,this.upVectorAlignment,this.stencilWidth);a.push(P),o.push(this._material),l.push(E.xform)}if(a.length>0){const m={layerUid:this._context.layer.uid,graphicUid:n},g=new rb({geometries:a,materials:o,transformations:l,metadata:m}),b=new Fm(this,g,a,null,null,S3t,i);return b.alignedSampledElevation=p.terrainElevation,b.needsElevationUpdates=l_(i.mode),b}}else s.paths.length!==0&&s.paths.some(m=>m.length>0)||this.logger.warn("PathSymbol3DLayer geometry failed to be created (no paths were defined)");return null}}function MOe(e,t,r){switch(t){case"world":for(const i of e.vertices)he(i0,i.pos,e.offset),r.worldUpAtPosition(i0,$h),i.setFrameFromUpVector($h),i.computeRotationAxisAndAngleFromUpVector();break;case"path":he(i0,e.vertices[0].pos,e.offset),r.worldUpAtPosition(i0,$h),n3t(e,$h);for(const i of e.vertices){const n=Math.sign(Se(i.frame.right,i.vRight));dt(i.rotationFrame.up,i.vRight,i.vLeft),le(i.rotationFrame.up,i.rotationFrame.up,n),we(i.rotationFrame.up,i.rotationFrame.up);const s=Se(i.rotationFrame.up,i.frame.up),a=Se(i.rotationFrame.up,i.frame.right);if(le(i0,i.frame.up,-a),le(Pge,i.frame.right,s),he(i0,i0,Pge),we(i.rotationFrame.right,i0),t3t(i.rotationRight,i.frame,i.rotationFrame.right),Io(i0,i.vLeft),i.rotationAngle=-n*(Math.PI-Rs(Se(i0,i.vRight))),Math.abs(i.rotationAngle)>0){const l=EX(Math.cos(.5*i.rotationAngle));Cae(i.miterStretch,1+(l-1)*i.rotationRight[0]*i.rotationRight[0],(l-1)*i.rotationRight[0]*i.rotationRight[1],(l-1)*i.rotationRight[0]*i.rotationRight[1],1+(l-1)*i.rotationRight[1]*i.rotationRight[1])}const o=Math.PI-i.rotationAngle;i.maxStretchDistance=Math.abs(Math.min(i.vLeftLength,i.vRightLength)*EX(Math.cos(.5*o)))}}}function Mge(e,t,r){switch(e){case"symbol-value":return r;case"proportional":return t;default:return e}}function T3t(e,t,r,i){let n=0;for(const s of e.vertices)zy(s.posES,r,t,i,Hq),n+=Hq.sampledElevation,he($h,s.pos,e.offset),i.setAltitude($h,Hq.z),pe(s.pos,$h,e.offset);return e.updatePathVertexInformation(),n/e.vertices.length}function S3t(e,t,r,i){const n=e.stageObject,s=n.geometryRecords;let a=0;E3t.spatialReference=i.spatialReference;for(const o of s){const l=o.geometry;if(!EOe(l))continue;const c=l.path,u=c.builder.path,h=l.geometrySR;POe.spatialReference=h,a+=T3t(u,t,r,i),l.upVectorAlignment!=="world"&&MOe(u,l.upVectorAlignment,i),c.onPathChanged(),l.invalidateBoundingInfo(),n.geometryVertexAttrsUpdated(o)}return a/s.length}const E3t=tb(0,0,0,null),POe=tb(0,0,0,null),$h=M(),i0=Mr(),Pge=Mr(),Hq=new MO,C3t=3,Ige=3,A3t=10;function R3t(e,t,r,i,n=1){if(r.isGeographic&&i===Be.Global){const o=new Float64Array(t.typedBuffer.length),l=3*t.count,c=Ar(r);for(let u=0;u<l;u+=3)Yre(t.typedBuffer,u,o,u,c);t=Nn.fromTypedArray(o)}vr(fs,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY);for(let o=0;o<t.count;o++)t.getVec(o,Yc),fs[0]=Math.min(fs[0],Yc[0]),fs[1]=Math.min(fs[1],Yc[1]);const s=fs[0]%n,a=fs[1]%n;Rh[0]=fs[0]-s,Rh[1]=fs[1]-a;for(let o=0;o<t.count;o++)t.getVec(o,Yc),e.setValues(o,(Yc[0]-Rh[0])/n,(Yc[1]-Rh[1])/n,Rh[0]/n,Rh[1]/n)}function IOe(e,t,r,i,n=1){ne(K_,1,0,0),ne(e2,0,1,0),ne(_T,0,0,1),P3t(Wq,t),O3t(t,$ge)&&M3t($ge,K_,e2,_T,r,Wq),vr(fs,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),vr(t2,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(let l=0;l<t.count;l++){t.getVec(l,Yc);const c=Se(K_,Yc),u=Se(e2,Yc);fs[0]=Math.min(fs[0],c),fs[1]=Math.min(fs[1],u),t2[0]=Math.max(t2[0],c),t2[1]=Math.max(t2[1],u)}const s=Se(_T,Wq);Yq(Sb,fs[0],fs[1],s,K_,e2,_T),Yq(r2,t2[0],fs[1],s,K_,e2,_T),Yq(i2,fs[0],t2[1],s,K_,e2,_T),pe(r2,r2,Sb),le(r2,r2,.5),pe(i2,i2,Sb),le(i2,i2,.5),he(Sb,Sb,r2),he(Sb,Sb,i2);const a=fs[0]%n,o=fs[1]%n;Rh[0]=fs[0]-a,Rh[1]=fs[1]-o;for(let l=0;l<t.count;l++){t.getVec(l,Yc),e.setValues(l,(Se(K_,Yc)-Rh[0])/n,(Se(e2,Yc)-Rh[1])/n,Rh[0]/n,Rh[1]/n);for(let c=0;c<3;c++)i.set(l,c,Sb[c]),i.set(l,c+3,r2[c]),i.set(l,c+6,i2[c])}}const Wq=M(),Yc=M(),$ge=Er(),K_=M(),e2=M(),_T=M(),fs=it(),t2=it(),Rh=it(),Sb=M(),r2=M(),i2=M();function O3t(e,t){const r=e.count-1;return ESe(e,t,0,Math.floor(r/3),Math.floor(r*(2/3)))}function M3t(e,t,r,i,n,s){_(n)?(n.basisMatrixAtPosition(s,n0),ne(SI,n0[0],n0[1],n0[2]),ne(EI,n0[4],n0[5],n0[6]),ne(Xq,n0[8],n0[9],n0[10])):(ne(SI,1,0,0),ne(EI,0,1,0),ne(Xq,0,0,1));const a=e;Se(a,Xq)<0&&le(a,a,-1),oe(i,a);const o=Se(a,EI),l=Se(a,SI);Math.abs(o)<Math.abs(l)?(N3(t,SI,a,-l),we(t,t),dt(r,t,a),we(r,r),le(r,r,-1)):(N3(r,EI,a,-o),we(r,r),dt(t,r,a),we(t,t))}const n0=Ae(),SI=M(),EI=M(),Xq=M();function P3t(e,t){ne(CI,0,0,0);for(let r=0;r<t.count-1;r++)t.getVec(r,Yc),he(CI,CI,Yc);le(e,CI,1/(t.count-1))}const CI=M();function Yq(e,t,r,i,n,s,a){ne(e,t*n[0]+r*s[0]+i*a[0],t*n[1]+r*s[1]+i*a[1],t*n[2]+r*s[2]+i*a[2])}function I3t(e){const t=new Qr,r=e.output===K.Depth,i=e.hasMultipassTerrain&&(e.output===K.Color||e.output===K.Alpha);_u(t,e),t.include(no,{hasModelTransformation:!1,linearDepth:r}),t.include(Lx,e),t.attributes.add(O.POSITION,"vec3"),t.varyings.add("vpos","vec3"),i&&t.varyings.add("depth","float");const{vertex:n,fragment:s}=t;return r&&(t.include(x_,e),n.uniforms.add(new _r("nearFar",(a,o)=>o.camera.nearFar)),t.varyings.add("linearDepth","float")),n.code.add(S`
    void main(void) {
      vpos = position;
      forwardNormalizedVertexColor();
      ${i?"depth = (view * vec4(vpos, 1.0)).z;":""}
      gl_Position = ${r?S`transformPositionWithDepth(proj, view, vpos, nearFar, linearDepth);`:S`transformPosition(proj, view, vpos);`}
    }
  `),t.include(Cn,e),i&&t.include(Mu,e),s.include($m),s.uniforms.add(new cr("eColor",a=>a.color)),e.output===K.Highlight&&t.include(Ky),s.code.add(S`
  void main() {
    discardBySlice(vpos);
    ${i?"terrainDepthTest(gl_FragCoord, depth);":""}
    vec4 fColor = ${e.hasVertexColors?"vColor * eColor;":"eColor;"}

    if (fColor.a < ${S.float(ao)}) {
      discard;
    }

    ${e.output===K.Alpha?S`gl_FragColor = vec4(fColor.a);`:""}

    ${e.output===K.Color?S`gl_FragColor = highlightSlice(fColor, vpos); ${e.transparencyPassType===yt.Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}`:""}
    ${e.output===K.Highlight?S`outputHighlight();`:""};
    ${e.output===K.Depth?S`outputDepth(linearDepth);`:""};
  }
  `),t}const $3t=Object.freeze(Object.defineProperty({__proto__:null,build:I3t},Symbol.toStringTag,{value:"Module"}));class MU extends gi{initializeProgram(t){const r=MU.shader.get().build(this.configuration);return new ai(t.rctx,r,Ur)}_createPipeline(t,r){const i=this.configuration,n=t===yt.NONE,s=t===yt.FrontFace;return jt({blending:i.output!==K.Color&&i.output!==K.Alpha||!i.transparent?null:n?wu:eb(t),culling:Mz(i.cullFace),depthTest:{func:w_(t)},depthWrite:n||s?i.writeDepth&&fc:null,colorWrite:or,stencilWrite:i.hasOccludees?xm:null,stencilTest:i.hasOccludees?r?d_:T_:null,polygonOffset:n||s?i.polygonOffset&&L3t:rU(i.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this._createPipeline(this.configuration.transparencyPassType,!0),this._createPipeline(this.configuration.transparencyPassType,!1)}getPipelineState(t,r){return r?this._occludeePipelineState:super.getPipelineState(t,r)}}MU.shader=new si($3t,()=>ie(()=>import("./ColorMaterial.glsl.333b4a45.js"),[],import.meta.url));const L3t={factor:1,units:1};class kd extends Mo{constructor(){super(...arguments),this.output=K.Color,this.cullFace=pi.None,this.hasSlicePlane=!1,this.hasVertexColors=!1,this.transparent=!1,this.polygonOffset=!1,this.enableOffset=!0,this.writeDepth=!0,this.hasOccludees=!1,this.transparencyPassType=yt.NONE,this.hasMultipassTerrain=!1,this.cullAboveGround=!1}}d([H({count:K.COUNT})],kd.prototype,"output",void 0),d([H({count:pi.COUNT})],kd.prototype,"cullFace",void 0),d([H()],kd.prototype,"hasSlicePlane",void 0),d([H()],kd.prototype,"hasVertexColors",void 0),d([H()],kd.prototype,"transparent",void 0),d([H()],kd.prototype,"polygonOffset",void 0),d([H()],kd.prototype,"enableOffset",void 0),d([H()],kd.prototype,"writeDepth",void 0),d([H()],kd.prototype,"hasOccludees",void 0),d([H({count:yt.COUNT})],kd.prototype,"transparencyPassType",void 0),d([H()],kd.prototype,"hasMultipassTerrain",void 0),d([H()],kd.prototype,"cullAboveGround",void 0);class Lge extends Dm{constructor(t){super(t,new F3t),this.supportsEdges=!0,this._configuration=new kd}getConfiguration(t,r){return this._configuration.output=t,this._configuration.cullFace=this.parameters.cullFace,this._configuration.hasVertexColors=this.parameters.hasVertexColors,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this.parameters.transparent,this._configuration.polygonOffset=this.parameters.polygonOffset,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.transparencyPassType=r.transparencyPassType,this._configuration.enableOffset=r.camera.relativeElevation<eU,this._configuration.hasMultipassTerrain=r.multipassTerrain.enabled,this._configuration.cullAboveGround=r.multipassTerrain.cullAboveGround,this._configuration}intersect(t,r,i,n,s,a,o){Yz(t,r,n,s,a,void 0,o)}requiresSlot(t,r){return t===Ee.DRAPED_MATERIAL?!0:sx(r)===K.Highlight?t===Ee.OPAQUE_MATERIAL:t===(this.parameters.transparent?this.parameters.writeDepth?Ee.TRANSPARENT_MATERIAL:Ee.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL:Ee.OPAQUE_MATERIAL)}createGLMaterial(t){return t.output===K.Color||t.output===K.Alpha||t.output===K.Highlight||t.output===K.Depth&&this.parameters.writeLinearDepth?new D3t(t):null}createBufferWriter(){return new yU(wRe)}}class D3t extends v_{_updateOccludeeState(t){t.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:t.hasOccludees})}beginSlot(t){return this._output!==K.Color&&this._output!==K.Alpha||this._updateOccludeeState(t),this.ensureTechnique(MU,t)}}class F3t extends S6{constructor(){super(...arguments),this.color=rm,this.transparent=!1,this.writeDepth=!0,this.writeLinearDepth=!1,this.hasVertexColors=!1,this.polygonOffset=!1,this.hasSlicePlane=!1,this.cullFace=pi.None,this.hasOccludees=!1}}var Oa;(function(e){e[e.Horizontal=0]="Horizontal",e[e.Vertical=1]="Vertical",e[e.Cross=2]="Cross",e[e.ForwardDiagonal=3]="ForwardDiagonal",e[e.BackwardDiagonal=4]="BackwardDiagonal",e[e.DiagonalCross=5]="DiagonalCross",e[e.COUNT=6]="COUNT"})(Oa||(Oa={}));const bK=.70710678118,Dge=bK,N3t=.08715574274;function k3t(e){const t=new Qr,r=e.hasMultipassTerrain&&(e.output===K.Color||e.output===K.Alpha);e.draped||t.extensions.add("GL_OES_standard_derivatives");const i=e.output===K.Depth,{vertex:n,fragment:s}=t;_u(t,e),t.include(no,{hasModelTransformation:!1,linearDepth:i}),t.include(Lx,e),i&&(t.include(x_,e),n.uniforms.add(new _r("nearFar",(o,l)=>l.camera.nearFar)),t.varyings.add("linearDepth","float")),e.draped?n.uniforms.add(new He("worldToScreenRatio",(o,l)=>1/l.screenToPCSRatio)):t.attributes.add(O.BOUNDINGRECT,"mat3"),t.attributes.add(O.POSITION,"vec3"),t.attributes.add(O.UVMAPSPACE,"vec4"),t.varyings.add("vpos","vec3"),t.varyings.add("vuv","vec2"),r&&t.varyings.add("depth","float");const a=e.style===Oa.ForwardDiagonal||e.style===Oa.BackwardDiagonal||e.style===Oa.DiagonalCross;return a&&n.code.add(S`
      const mat2 rotate45 = mat2(${S.float(bK)}, ${S.float(-Dge)},
                                 ${S.float(Dge)}, ${S.float(bK)});
    `),e.draped||(_m(n,e),n.uniforms.add(new He("worldToScreenPerDistanceRatio",(o,l)=>1/l.camera.perScreenPixelRatio)),n.code.add(S`vec3 projectPointToLineSegment(vec3 center, vec3 halfVector, vec3 point) {
float projectedLength = dot(halfVector, point - center) / dot(halfVector, halfVector);
return center + halfVector * clamp(projectedLength, -1.0, 1.0);
}`),n.code.add(S`vec3 intersectRayPlane(vec3 rayDir, vec3 rayOrigin, vec3 planeNormal, vec3 planePoint) {
float d = dot(planeNormal, planePoint);
float t = (d - dot(planeNormal, rayOrigin)) / dot(planeNormal, rayDir);
return rayOrigin + t * rayDir;
}`),n.code.add(S`
      float boundingRectDistanceToCamera() {
        vec3 center = vec3(boundingRect[0][0], boundingRect[0][1], boundingRect[0][2]);
        vec3 halfU = vec3(boundingRect[1][0], boundingRect[1][1], boundingRect[1][2]);
        vec3 halfV = vec3(boundingRect[2][0], boundingRect[2][1], boundingRect[2][2]);
        vec3 n = normalize(cross(halfU, halfV));

        vec3 viewDir = - vec3(view[0][2], view[1][2], view[2][2]);

        float viewAngle = dot(viewDir, n);
        float minViewAngle = ${S.float(N3t)};

        if (abs(viewAngle) < minViewAngle) {
          // view direction is (almost) parallel to plane -> clamp it to min angle
          float normalComponent = sign(viewAngle) * minViewAngle - viewAngle;
          viewDir = normalize(viewDir + normalComponent * n);
        }

        // intersect view direction with infinite plane that contains bounding rect
        vec3 planeProjected = intersectRayPlane(viewDir, cameraPosition, n, center);

        // clip to bounds by projecting to u and v line segments individually
        vec3 uProjected = projectPointToLineSegment(center, halfU, planeProjected);
        vec3 vProjected = projectPointToLineSegment(center, halfV, planeProjected);

        // use to calculate the closest point to camera on bounding rect
        vec3 closestPoint = uProjected + vProjected - center;

        return length(closestPoint - cameraPosition);
      }
    `)),n.code.add(S`
    vec2 scaledUV() {
      vec2 uv = uvMapSpace.xy ${a?" * rotate45":""};
      vec2 uvCellOrigin = uvMapSpace.zw ${a?" * rotate45":""};

      ${e.draped?"":S`
            float distanceToCamera = boundingRectDistanceToCamera();
            float worldToScreenRatio = worldToScreenPerDistanceRatio / distanceToCamera;
          `}

      // Logarithmically discretize ratio to avoid jittering
      float step = 0.1;
      float discreteWorldToScreenRatio = log(worldToScreenRatio);
      discreteWorldToScreenRatio = ceil(discreteWorldToScreenRatio / step) * step;
      discreteWorldToScreenRatio = exp(discreteWorldToScreenRatio);

      vec2 uvOffset = mod(uvCellOrigin * discreteWorldToScreenRatio, ${S.float(e.patternSpacing)});
      return uvOffset + (uv * discreteWorldToScreenRatio);
    }
  `),n.code.add(S`
    void main(void) {
      vuv = scaledUV();
      vpos = position;
      ${r?"depth = (view * vec4(vpos, 1.0)).z;":""}
      forwardNormalizedVertexColor();
      gl_Position = ${i?S`transformPositionWithDepth(proj, view, vpos, nearFar, linearDepth);`:S`transformPosition(proj, view, vpos);`}
    }
  `),t.include(Cn,e),s.include($m),e.draped&&s.uniforms.add(new He("texelSize",(o,l)=>1/l.camera.pixelRatio)),e.output===K.Highlight&&t.include(Ky),r&&t.include(Mu,e),e.output!==K.Highlight&&(s.code.add(S`
      const float lineWidth = ${S.float(e.lineWidth)};
      const float spacing = ${S.float(e.patternSpacing)};
      const float spacingINV = ${S.float(1/e.patternSpacing)};

      float coverage(float p, float txlSize) {
        p = mod(p, spacing);

        float halfTxlSize = txlSize / 2.0;

        float start = p - halfTxlSize;
        float end = p + halfTxlSize;

        float coverage = (ceil(end * spacingINV) - floor(start * spacingINV)) * lineWidth;
        coverage -= min(lineWidth, mod(start, spacing));
        coverage -= max(lineWidth - mod(end, spacing), 0.0);

        return coverage / txlSize;
      }
    `),e.draped||s.code.add(S`const int maxSamples = 5;
float sample(float p) {
vec2 dxdy = abs(vec2(dFdx(p), dFdy(p)));
float fwidth = dxdy.x + dxdy.y;
ivec2 samples = 1 + ivec2(clamp(dxdy, 0.0, float(maxSamples - 1)));
vec2 invSamples = 1.0 / vec2(samples);
float accumulator = 0.0;
for (int j = 0; j < maxSamples; j++) {
if(j >= samples.y) {
break;
}
for (int i = 0; i < maxSamples; i++) {
if(i >= samples.x) {
break;
}
vec2 step = vec2(i,j) * invSamples - 0.5;
accumulator += coverage(p + step.x * dxdy.x + step.y * dxdy.y, fwidth);
}
}
accumulator /= float(samples.x * samples.y);
return accumulator;
}`)),s.uniforms.add(new cr("uColor",o=>o.color)),s.code.add(S`
    void main() {
      discardBySlice(vpos);
      ${r?"terrainDepthTest(gl_FragCoord, depth);":""}
      vec4 color = ${e.hasVertexColors?"vColor * uColor;":"uColor;"}
      color = highlightSlice(color, vpos);

      ${e.output!==K.Highlight?S`color.a *= ${V3t(e)};`:""}

      if (color.a < ${S.float(ao)}) {
        discard;
      }

      ${e.output===K.Alpha?S`gl_FragColor = vec4(color.a);`:""}

      ${e.output===K.Color?S`gl_FragColor = color; ${e.transparencyPassType===yt.Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}`:""}
      ${e.output===K.Highlight?S`outputHighlight();`:""}
      ${e.output===K.Depth?S`outputDepth(linearDepth);`:""};
    }
  `),t}function V3t(e){function t(r){return e.draped?S`coverage(vuv.${r}, texelSize)`:S`sample(vuv.${r})`}switch(e.style){case Oa.ForwardDiagonal:case Oa.Horizontal:return t("y");case Oa.BackwardDiagonal:case Oa.Vertical:return t("x");case Oa.DiagonalCross:case Oa.Cross:return S`
        1.0 - (1.0 - ${t("x")}) * (1.0 - ${t("y")})
      `;default:return"0.0"}}const z3t=Object.freeze(Object.defineProperty({__proto__:null,build:k3t},Symbol.toStringTag,{value:"Module"}));class PU extends gi{initializeProgram(t){const r=PU.shader.get().build(this.configuration);return new ai(t.rctx,r,$Oe)}_setPipelineState(t,r){const i=this.configuration,n=t===yt.NONE,s=t===yt.FrontFace;return jt({blending:i.output===K.Color||i.output===K.Alpha?n?wu:eb(t):null,culling:Mz(i.cullFace),depthTest:{func:w_(t)},depthWrite:n?i.writeDepth&&fc:Kz(t),colorWrite:or,stencilWrite:i.hasOccludees?xm:null,stencilTest:i.hasOccludees?r?d_:T_:null,polygonOffset:n||s?i.polygonOffset&&U3t:rU(i.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this._setPipelineState(this.configuration.transparencyPassType,!0),this._setPipelineState(this.configuration.transparencyPassType,!1)}getPipelineState(t,r){return r?this._occludeePipelineState:super.getPipelineState(t,r)}}PU.shader=new si(z3t,()=>ie(()=>import("./Pattern.glsl.ae3e1db7.js"),[],import.meta.url));const U3t={factor:1,units:1};class rl extends Mo{constructor(){super(...arguments),this.output=K.Color,this.cullFace=pi.None,this.transparencyPassType=yt.NONE,this.hasSlicePlane=!1,this.hasVertexColors=!1,this.polygonOffset=!1,this.writeDepth=!0,this.hasOccludees=!1,this.enableOffset=!0,this.hasMultipassTerrain=!1,this.cullAboveGround=!1}}d([H({count:K.COUNT})],rl.prototype,"output",void 0),d([H({count:pi.COUNT})],rl.prototype,"cullFace",void 0),d([H({count:Oa.COUNT})],rl.prototype,"style",void 0),d([H({count:yt.COUNT})],rl.prototype,"transparencyPassType",void 0),d([H()],rl.prototype,"hasSlicePlane",void 0),d([H()],rl.prototype,"hasVertexColors",void 0),d([H()],rl.prototype,"polygonOffset",void 0),d([H()],rl.prototype,"writeDepth",void 0),d([H()],rl.prototype,"hasOccludees",void 0),d([H()],rl.prototype,"patternSpacing",void 0),d([H()],rl.prototype,"lineWidth",void 0),d([H()],rl.prototype,"enableOffset",void 0),d([H()],rl.prototype,"draped",void 0),d([H()],rl.prototype,"hasMultipassTerrain",void 0),d([H()],rl.prototype,"cullAboveGround",void 0);const $Oe=new Map([[O.POSITION,0],[O.COLOR,3],[O.UVMAPSPACE,4],[O.BOUNDINGRECT,5]]);class Mae extends Dm{constructor(t){super(t,new j3t),this.supportsEdges=!0,this._vertexAttributeLocations=$Oe,this.techniqueConfig=new rl}getConfiguration(t,r){return this.techniqueConfig.output=t,this.techniqueConfig.cullFace=this.parameters.cullFace,this.techniqueConfig.hasVertexColors=this.parameters.hasVertexColors,this.techniqueConfig.hasSlicePlane=this.parameters.hasSlicePlane,this.techniqueConfig.polygonOffset=this.parameters.polygonOffset,this.techniqueConfig.writeDepth=this.parameters.writeDepth,this.techniqueConfig.style=this.parameters.style,this.techniqueConfig.patternSpacing=this.parameters.patternSpacing,this.techniqueConfig.lineWidth=this.parameters.lineWidth,this.techniqueConfig.draped=this.parameters.draped,this.techniqueConfig.transparencyPassType=r.transparencyPassType,this.techniqueConfig.enableOffset=r.camera.relativeElevation<eU,this.techniqueConfig.hasMultipassTerrain=r.multipassTerrain.enabled,this.techniqueConfig.cullAboveGround=r.multipassTerrain.cullAboveGround,this.techniqueConfig}intersect(t,r,i,n,s,a,o){Yz(t,r,n,s,a,void 0,o)}requiresSlot(t,r){return t===Ee.DRAPED_MATERIAL?!0:sx(r)===K.Highlight?t===Ee.OPAQUE_MATERIAL:t===(this.parameters.writeDepth?Ee.TRANSPARENT_MATERIAL:Ee.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL)}createGLMaterial(t){return t.output===K.Color||t.output===K.Alpha||t.output===K.Highlight||t.output===K.Depth&&this.parameters.writeLinearDepth?new B3t(t):null}createBufferWriter(){const t=gn().vec3f(O.POSITION).vec4u8(O.COLOR).vec4f(O.UVMAPSPACE);return this.parameters.draped||t.mat3f(O.BOUNDINGRECT),new G3t(t)}}class B3t extends v_{_updateParameters(t){return this.ensureTechnique(PU,t)}_updateOccludeeState(t){t.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:t.hasOccludees})}beginSlot(t){return this._output!==K.Color&&this._output!==K.Alpha||this._updateOccludeeState(t),this._updateParameters(t)}}class G3t extends yU{write(t,r,i,n){for(const s of this.vertexBufferLayout.fieldNames){const a=r.vertexAttributes.get(s),o=r.indices.get(s);if(a&&o)switch(s){case O.POSITION:{pt(a.size===3);const l=i.getField(s,Zr);l&&Zz(o,a.data,t.transformation,l,n);break}case O.COLOR:{pt(a.size===3||a.size===4);const l=i.getField(s,pc);l&&nk(o,a.data,a.size,l,n);break}case O.UVMAPSPACE:{pt(a.size===4);const l=i.getField(s,ca);l&&R9(o,a.data,l,n);break}case O.BOUNDINGRECT:{pt(a.size===9);const l=i.getField(s,Fp);l&&this.writeBoundingRect(o,a.data,t.transformation,l,n);break}}}}writeBoundingRect(t,r,i,n,s){const a=i,o=n.typedBuffer,l=n.typedBufferStride,c=t.length;s*=l;for(let u=0;u<c;++u){const h=9*t[u],p=r[h],m=r[h+1],g=r[h+2];o[s]=a[0]*p+a[4]*m+a[8]*g+a[12],o[s+1]=a[1]*p+a[5]*m+a[9]*g+a[13],o[s+2]=a[2]*p+a[6]*m+a[10]*g+a[14];for(let b=3;b<9;++b)o[s+b]=r[h+b];s+=l}}}class j3t extends S6{constructor(){super(...arguments),this.color=Tr(1,1,1,1),this.writeDepth=!0,this.writeLinearDepth=!1,this.hasVertexColors=!1,this.polygonOffset=!1,this.hasSlicePlane=!1,this.cullFace=pi.None,this.hasOccludees=!1,this.style=Oa.Cross,this.patternSpacing=10,this.lineWidth=1,this.draped=!0}}function q3t(e,t,r){return W3t(H3t(e),t,r)}function H3t(e){return e&&e.pattern||null}function W3t(e,t,r){return _(e)?e.style==="none"||e.style==="solid"?(e.style==="none"&&(t.color=Tr(0,0,0,0),t.transparent=!0),new Lge(t)):(t.style=X3t(e.style),t.draped=r.isDraped,new Mae(t)):new Lge(t)}function X3t(e){switch(e){case"horizontal":return Oa.Horizontal;case"vertical":return Oa.Vertical;case"cross":return Oa.Cross;case"forward-diagonal":return Oa.ForwardDiagonal;case"backward-diagonal":return Oa.BackwardDiagonal;case"diagonal-cross":return Oa.DiagonalCross;default:return}}function Y3t(e){return e.material instanceof Mae&&!e.material.parameters.draped}function Z3t(e,t){if(Y3t(e)){const r=e.geometry.vertexAttributes,i=r.get(O.POSITION).data,n=r.get(O.UVMAPSPACE).data,s=r.get(O.BOUNDINGRECT).data;IOe(ca.fromTypedArray(n),Nn.fromTypedArray(i),t,Kv.fromTypedArray(s))}}function Q3t(e,t,r,i){const n=DAe(e,t,r,i),s=e.stageObject.geometryRecords;for(let a=0;a<s.length;a++)Z3t(s[a],i);return n}const J3t=["polyline","polygon","extent"];class IU extends Nm{constructor(t,r,i,n){super(t,r,i,n),this._needsUV=!1,this._hasOutline=!1}async doLoad(){}_ensureMaterials(){this._ensureFillMaterial(),this._ensureOutlineMaterial()}_ensureFillMaterial(){if(_(this._material))return;const t=Vi(this.symbolLayer,"material","color"),r=this._getCombinedOpacityAndColor(t);this._material=q3t(this.symbolLayer,{color:r,transparent:r[3]<1||this.needsDrivenTransparentPass,polygonOffset:!1,hasVertexColors:!0,writeLinearDepth:!0,hasSlicePlane:this._context.slicePlaneEnabled},{isDraped:this.draped}),this._needsUV=this._material instanceof Mae,this._context.stage.add(this._material)}_ensureOutlineMaterial(){const t=this.symbolLayer.outline;if(_(this._outlineMaterial)||!this._isValidOutline(t))return;this._hasOutline=!0;const r=i=>{const n=eOe(t.pattern);return new R4({width:i,color:this._getOutlineColor(),hasPolygonOffset:!0,hasSlicePlane:this._context.slicePlaneEnabled,isClosed:!0,stipplePattern:n,stippleScaleWithLineWidth:!0,cap:uK(t.patternCap||"butt")})};this._outlineMaterial=r(ur(t.size)),this._context.stage.add(this._outlineMaterial)}_isValidOutline(t){return _(t)&&t.size&&t.size>0&&_(t.color)&&(R(t.pattern)||t.pattern.type!=="style"||t.pattern.style!=="none")}destroy(){super.destroy(),this._context.stage.remove(this._material),this._material=null,this._context.stage.remove(this._outlineMaterial),this._outlineMaterial=null}createGraphics3DGraphic(t){const r=t.graphic;if(!this._validateGeometry(r.geometry,J3t,this.symbolLayer.type))return null;const i=this._getVertexOpacityAndColor(t.renderingInfo,255),n=this.setGraphicElevationContext(r,new Du);return this.ensureDrapedStatus(n.mode==="on-the-ground"),this._ensureMaterials(),this.draped?this._createAsOverlay(r,i):this._createAs3DShape(r,i,n)}layerOpacityChanged(){if(_(this._material)){const t=this._material.parameters.color,r=Vi(this.symbolLayer,"material","color"),i=this._getCombinedOpacity(r);this._material.setParameters({color:[t[0],t[1],t[2],i],transparent:i<1||this.needsDrivenTransparentPass})}if(_(this._outlineMaterial)){const t=this._outlineMaterial.parameters.color;this._outlineMaterial.setParameters({color:[t[0],t[1],t[2],this._getOutlineOpacity()]})}return!0}layerElevationInfoChanged(t,r,i){const n=this._elevationContext.mode,s=OO(IU.elevationModeChangeTypes,i,n);if(s!==nn.UPDATE)return s;const a=rf(n);return this.updateGraphics3DGraphicElevationInfo(t,r,()=>a)}slicePlaneEnabledChanged(){if(_(this._material)&&this._material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),_(this._outlineMaterial)){const t={hasSlicePlane:this._context.slicePlaneEnabled};this._outlineMaterial.setParameters(t)}return!0}physicalBasedRenderingChanged(){return!0}pixelRatioChanged(){return!0}_createAs3DShape(t,r,i){const n=fR(t.geometry);if(R(n))return null;Ms.renderData=wae(n,this._context.elevationProvider,this._context.renderCoordsHelper,i),Ms.color=r;const s=Ms.renderData.position.length/3;if(this._needsUV&&(Ms.uvMapSpace=new Float32Array(4*s),Ms.boundingRect=new Float64Array(9*s)),Ms.outNum=0,Ms.outGeometries=[],Ms.outTransforms=[],Ms.outMaterials=[],this._createAs3DShapeFill(Ms),this._hasOutline&&this._createAs3DShapeOutline(Ms),this._logGeometryCreationWarnings(Ms.renderData,n.rings,"rings","FillSymbol3DLayer"),Ms.outNum===0)return null;this._needsUV&&IOe(ca.fromTypedArray(Ms.uvMapSpace),Nn.fromTypedArray(Ms.renderData.position),this._context.renderCoordsHelper,Kv.fromTypedArray(Ms.boundingRect));const a=new rb({geometries:Ms.outGeometries,materials:Ms.outMaterials,transformations:Ms.outTransforms,castShadow:!1,metadata:{layerUid:this._context.layer.uid,graphicUid:t.uid}}),o=new Fm(this,a,Ms.outGeometries,null,null,Q3t,i);return o.alignedSampledElevation=Ms.renderData.sampledElevation,o.needsElevationUpdates=rf(i.mode),o}_createAs3DShapeFill(t){const r=t.renderData.polygons;for(const{position:i,mapPosition:n,holeIndices:s,index:a,count:o}of r){if(_(this._context.clippingExtent)&&(bi(qo),hu(qo,n),!pp(qo,this._context.clippingExtent)))continue;const l=P9(n,s,3);if(l.length===0)continue;const c=new Uint32Array(l),u=Gme({indices:c,attributeData:{position:i,color:t.color,mapPosition:n,uvMapSpace:this._needsUV?new Float32Array(t.uvMapSpace.buffer,4*a*t.uvMapSpace.BYTES_PER_ELEMENT,4*o):null,boundingRect:this._needsUV?new Float64Array(t.boundingRect.buffer,9*a*t.boundingRect.BYTES_PER_ELEMENT,9*o):null}});t.outGeometries.push(u),t.outMaterials.push(this._material),t.outTransforms.push(Es),t.outNum++}}_createAs3DShapeOutline(t){if(!this._hasOutline)return;const r=t.renderData.outlines;for(let i=0;i<r.length;++i){const{mapPosition:n,position:s}=r[i];if(_(this._context.clippingExtent)&&(bi(qo),hu(qo,n),!pp(qo,this._context.clippingExtent)))continue;const a=dK({overlayInfo:null,removeDuplicateStartEnd:cx.REMOVE,attributeData:{position:s,mapPosition:n}}),o=a.vertexAttributes.get(O.POSITION);o.data===s&&(o.data=new Float64Array(s)),t.outGeometries.push(a),t.outMaterials.push(this._outlineMaterial),t.outTransforms.push(Es),t.outNum++}}_createAsOverlay(t,r){const i=fR(t.geometry);if(R(i))return null;this._material.renderPriority=this._renderPriority+this._renderPriorityStep/2,_(this._outlineMaterial)&&(this._outlineMaterial.renderPriority=this._renderPriority),ja.renderData=ORe(i,this._context.overlaySR),ja.color=r;const n=ja.renderData.position.length/3;return this._needsUV&&(ja.uvMapSpace=new Float32Array(4*n)),ja.outNum=0,ja.outGeometries=[],ja.outBoundingBox=bi(),ja.layerUid=this._context.layer.uid,ja.graphicsUid=t.uid,this._createAsOverlayFill(ja),this._hasOutline&&this._createAsOverlayOutline(ja),this._logGeometryCreationWarnings(ja.renderData,i.rings,"rings","FillSymbol3DLayer"),ja.outNum===0?null:(this._needsUV&&R3t(ca.fromTypedArray(ja.uvMapSpace),Nn.fromTypedArray(ja.renderData.position),this._context.overlaySR,this._context.graphicsCoreOwner.view.state.viewingMode),ja.outNum>0?new _U(this,ja.outGeometries,ja.outBoundingBox,this._context.drapeSourceRenderer):null)}_createAsOverlayFill(t){const r=t.renderData.polygons;for(const{position:i,holeIndices:n,index:s,count:a}of r){if(bi(qo),hu(qo,i),!pp(qo,this._context.clippingExtent))continue;const o=P9(i,n,3);if(o.length===0)continue;H5(t.outBoundingBox,qo);const l=new Uint32Array(o),c=Gme({indices:l,attributeData:{position:i,color:t.color,uvMapSpace:this._needsUV?new Float32Array(t.uvMapSpace.buffer,4*s*t.uvMapSpace.BYTES_PER_ELEMENT,4*a):null}}),u=new D9(c,this._material,{layerUid:t.layerUid,graphicUid:t.graphicsUid}),h=qo;ei(u.boundingSphere,.5*(h[0]+h[3]),.5*(h[1]+h[4]),0,.5*Math.sqrt((h[3]-h[0])*(h[3]-h[0])+(h[4]-h[1])*(h[4]-h[1]))),t.outGeometries.push(u),t.outNum++}}_createAsOverlayOutline(t){if(!this._hasOutline)return;const r=t.renderData.outlines;for(let i=0;i<r.length;++i){const{position:n}=r[i];if(bi(qo),hu(qo,n),!pp(qo,this._context.clippingExtent))continue;H5(t.outBoundingBox,qo);const s=dK({overlayInfo:{spatialReference:this._context.overlaySR,renderCoordsHelper:this._context.renderCoordsHelper},removeDuplicateStartEnd:cx.REMOVE,attributeData:{position:n}}),a=new D9(s,this._outlineMaterial,{layerUid:t.layerUid,graphicUid:t.graphicsUid}),o=qo;ei(a.boundingSphere,.5*(o[0]+o[3]),.5*(o[1]+o[4]),0,.5*Math.sqrt((o[3]-o[0])*(o[3]-o[0])+(o[4]-o[1])*(o[4]-o[1]))),t.outGeometries.push(a),t.outNum++}}_getOutlineOpacity(){const t=Vi(this.symbolLayer,"outline","color");return(this.draped?1:this._getLayerOpacity())*(_(t)?t.a:0)}_getOutlineColor(){const t=Vi(this.symbolLayer,"outline","color"),r=this._getOutlineOpacity();return g7(_(t)?Te.toUnitRGB(t):null,r)}test(){return{...super.test(),createAsOverlay:(t,r)=>this._createAsOverlay(t,r),createAs3DShape:(t,r,i)=>this._createAs3DShape(t,r,i)}}}IU.elevationModeChangeTypes={definedChanged:nn.RECREATE,staysOnTheGround:nn.NONE,onTheGroundChanged:nn.RECREATE};const qo=is(),Ms={renderData:null,color:null,uvMapSpace:null,boundingRect:null,outNum:0,outBoundingBox:null,outGeometries:null,outMaterials:null,outTransforms:null},ja={renderData:null,color:null,uvMapSpace:null,outNum:0,outBoundingBox:null,outGeometries:null,outMaterials:null,outTransforms:null},K3t=fe.getLogger("esri.views.3d.webgl-engine.lib.TextRenderParameters");class $U{constructor(t){this.definition=t,this.key=JSON.stringify(t),this.haloSize=Math.round(t.halo.size),this.textStyle=this._colorToRGBA(t.color),this.haloStyle=this._colorToRGB(t.halo.color),this.backgroundStyle=t.background.color[3]!==0?this._colorToRGBA(t.background.color):null}fontString(t){const r=this.definition.font;return`${r.style} ${r.weight} ${t}px ${r.family}, sans-serif`}_colorToRGB(t){return`rgb(${t.slice(0,3).map(r=>Math.floor(255*r)).toString()})`}_colorToRGBA(t){return`rgba(${t.slice(0,3).map(r=>Math.floor(255*r)).toString()},${t[3]})`}static async fromSymbol(t,r=1){const i=Vi(t,"material","color"),n=tu(i,rm,Te.toUnitRGBA),s=tu(t.size,12,ur),a=t.lineHeight,o=_(t.background)?Te.toUnitRGBA(t.background.color):rm,l={family:tu(t.font,"sans-serif",m=>m.family),decoration:tu(t.font,"none",m=>m.decoration),weight:tu(t.font,"normal",m=>m.weight),style:tu(t.font,"normal",m=>m.style)},c=t.halo,u=_(c)&&_(c.color)&&c.size>0?{size:ur(c.size),color:Te.toUnitRGBA(c.color)}:{size:0,color:rm},h=new $U({color:n,size:s,background:{color:o,padding:_(t.background)?[.65*s,.5*s]:[0,0],borderRadius:_(t.background)?s*(6/16):0},lineSpacingFactor:a,font:l,halo:u,pixelRatio:r}),p=h.fontString(s);try{await document.fonts.load(p)}catch{K3t.warnOnce(`Failed to preload font '${p}'. Some text symbology may be rendered using the default browser font.`)}return h}}class ewt{constructor(t,r,i){this._renderer=new qRe(t,r,i)}get key(){return this._renderer.key}get baselineAnchorY(){return 1-this._renderer.firstRenderedBaselinePosition/this._renderer.renderedHeight}get displayWidth(){return this._renderer.displayWidth}get displayHeight(){return this._renderer.displayHeight}create(){const t=hD(twt,this._renderer.renderedWidth,this._renderer.renderedHeight),r=t.getContext("2d");return r.save(),this._renderer.render(r,0,0),r.restore(),new Hn(t,{wrap:{s:xt.CLAMP_TO_EDGE,t:xt.CLAMP_TO_EDGE},noUnpackFlip:!1,mipmap:!0,preMultiplyAlpha:!0,powerOfTwoResizeMode:Dv.PAD})}}const twt={canvas:null},rwt=[0,0,1];class iwt extends Nm{constructor(t,r,i,n){super(t,r,i,n),this._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1},this.ensureDrapedStatus(!1)}async doLoad(){if(!this._drivenProperties.size){const t=iU(this.symbolLayer.size);if(t)throw new k("graphics3dtextsymbollayer:invalid-size",t)}await this._createTextRenderParameters()}async _createTextRenderParameters(){const t=this._context.graphicsCoreOwner.view.state.pixelRatio;this._textRenderParameters=await $U.fromSymbol(this.symbolLayer,t)}destroy(){super.destroy()}createGraphics3DGraphic(t){const r=t.graphic,i=uR(r.geometry);if(R(i))return this.logger.warn(`unsupported geometry type for text symbol: ${r.geometry.type}`),null;const n=this.symbolLayer.text;if(R(n)||n==="")return null;const s=Vre(this.symbol)&&this.symbol.hasVisibleVerticalOffset()?this.symbol.verticalOffset:null;if(_(s)&&!Hxe(this.symbolLayer))return this.logger.errorOncePerTick(`Callouts and vertical offset on text symbols are currently only supported with 'center' horizontal alignment (not with '${this.symbolLayer.horizontalAlignment}' alignment)`),null;const a={...awt,verticalOffset:s,horizontalPlacement:this.symbolLayer.horizontalAlignment,verticalPlacement:A1t(this.symbolLayer.verticalAlignment)};return this._createAs3DShape(r,i,n,a)}createLabel(t,r,i,n){const s=t.graphic,a=uR(s.geometry);if(R(a))return this.logger.warn(`unsupported geometry type for label: ${s.geometry.type}`),null;const o=r.text;return!o||/^\s+$/.test(o)?null:this._createAs3DShape(s,a,o,r,i,n)}setGraphicElevationContext(t,r,i=0){const n=super.setGraphicElevationContext(t,r);return n.addOffsetRenderUnits(i),n}layerOpacityChanged(){return this.logger.warn("layer opacity change not yet implemented in Graphics3DTextSymbolLayer"),!1}layerElevationInfoChanged(t,r){return Fge(t,r,(i,n)=>{this.updateGraphicElevationContext(n,i)}),nn.UPDATE}slicePlaneEnabledChanged(t,r){return Fge(t,r,i=>{for(const n of i.stageObject.geometryRecords)n.material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled})}),!0}physicalBasedRenderingChanged(){return!0}pixelRatioChanged(){return!1}updateGraphicElevationContext(t,r){this.setGraphicElevationContext(t,r.elevationContext,r.metadata.elevationOffset),r.needsElevationUpdates=rf(r.elevationContext.mode)||r.elevationContext.mode==="absolute-height"}_defaultElevationInfoNoZ(){return swt}_createAs3DShape(t,r,i,n,s,a){const o=this.setGraphicElevationContext(t,new Du,n.elevationOffset),l=Vi(t.geometry,"type")==="polyline",c=t.uid;let u=null,h=null;if(R(a)){const B=WRe(n.horizontalPlacement);u=new ewt(i,B,this._textRenderParameters);let X=null;h=this._context.sharedResources.textures.fromData(u.key,()=>u.create(),()=>{_(X)&&X.release()});const Y=this._context.stage.renderView.textureRepository.acquire(h.texture.id);if(R(Y)||$u(Y))return h.release(),null;X=Y}const p=nwt(u,n),m={occlusionTest:!0,screenOffset:n.screenOffset,anchorPosition:p,polygonOffset:!0,color:[1,1,1,1],centerOffsetUnits:n.centerOffsetUnits,debugDrawLabelBorder:n.debugDrawLabelBorder,drawInSecondSlot:!0};if(_(h)&&(m.textureId=h.texture.id),_(a)&&(m.textureId=a.id),_(n.verticalOffset)){const{screenLength:B,minWorldLength:X,maxWorldLength:Y}=n.verticalOffset;m.verticalOffset={screenLength:ur(B),minWorldLength:X||0,maxWorldLength:Y!=null?Y:1/0}}if(this._context.screenSizePerspectiveEnabled){const{screenSizePerspectiveSettings:B,screenSizePerspectiveSettingsLabels:X}=this._context.sharedResources;m.screenSizePerspective=X.overridePadding(this._textRenderParameters.haloSize+this._textRenderParameters.definition.background.padding[0]),m.screenSizePerspectiveAlignment=B}let g;if(l&&(m.shaderPolygonOffset=1e-4),m.hasSlicePlane=this._context.slicePlaneEnabled,_(s)){const B=JSON.stringify(m);g=s.get(B),R(g)&&(g=new O9(m),s.add(B,g))}else g=new O9(m);const b=[g],w=n.translation,v=_(u)?[u.displayWidth,u.displayHeight]:[0,0],x=n.centerOffset,T=rwt,E=[0,0],C=[Uc.createPointGeometry(T,w,null,v,x,E,null)],A=this._context.layer.uid,P=fae(this._context,r,C,b,o,A,c);if(P===null)return null;const I=new Fm(this,P.object,C,R(s)?b:null,h,cR,o);I.alignedSampledElevation=P.sampledElevation,I.needsElevationUpdates=rf(o.mode)||o.mode==="absolute-height";const{displayWidth:L,displayHeight:V}=_(u)?u:n;I.getScreenSize=(B=it())=>(B[0]=L,B[1]=V,B);const G={labelText:i,elevationOffset:n.elevationOffset};return I.metadata=G,dR(I,r,this._context.elevationProvider),I}}function Fge(e,t,r){e&&e.forEach(i=>{const n=t(i);_(n)&&r(n,i.graphic)})}function nwt(e,t){if(t.verticalPlacement==="baseline"){const i=S1t[t.horizontalPlacement],n=_(e)?e.baselineAnchorY:0;return Nr(i,n)}const r=C1t(t.horizontalPlacement,t.verticalPlacement);return fD[r]}const swt={mode:"relative-to-ground",offset:0},awt={text:null,translation:[0,0,0],elevationOffset:0,centerOffset:[0,0,0,1],screenOffset:[0,0],horizontalPlacement:"center",verticalPlacement:"center",verticalOffset:null,centerOffsetUnits:null,debugDrawLabelBorder:!1,displayWidth:0,displayHeight:0},owt={"calm-small":{waveStrength:.005,perturbationStrength:.02,textureRepeat:12,waveVelocity:.01},"rippled-small":{waveStrength:.02,perturbationStrength:.09,textureRepeat:32,waveVelocity:.07},"slight-small":{waveStrength:.05,perturbationStrength:.07,textureRepeat:28,waveVelocity:.1},"moderate-small":{waveStrength:.075,perturbationStrength:.07,textureRepeat:24,waveVelocity:.1},"calm-medium":{waveStrength:.003125,perturbationStrength:.01,textureRepeat:8,waveVelocity:.02},"rippled-medium":{waveStrength:.035,perturbationStrength:.015,textureRepeat:12,waveVelocity:.07},"slight-medium":{waveStrength:.06,perturbationStrength:.015,textureRepeat:8,waveVelocity:.12},"moderate-medium":{waveStrength:.09,perturbationStrength:.03,textureRepeat:4,waveVelocity:.12},"calm-large":{waveStrength:.01,perturbationStrength:0,textureRepeat:4,waveVelocity:.05},"rippled-large":{waveStrength:.025,perturbationStrength:.01,textureRepeat:8,waveVelocity:.11},"slight-large":{waveStrength:.06,perturbationStrength:.02,textureRepeat:3,waveVelocity:.13},"moderate-large":{waveStrength:.14,perturbationStrength:.03,textureRepeat:2,waveVelocity:.15}},lwt=["polyline","polygon","extent"];class z0 extends Nm{constructor(t,r,i,n){super(t,r,i,n)}async doLoad(){}destroy(){super.destroy(),this._context.stage.remove(this._material),this._material=null}createGraphics3DGraphic(t){const r=t.graphic;if(!this._validateGeometry(r.geometry,lwt,this.symbolLayer.type))return null;const i=this.setGraphicElevationContext(r,new Du);return this.ensureDrapedStatus(i.mode==="on-the-ground"),this.ensureMaterial(),this.draped?this._createAsOverlay(r):this._createAs3DShape(r,i,r.uid)}ensureMaterial(){if(_(this._material))return;const t=new TRe,r=this.symbolLayer.color;_(r)&&(t.color=Te.toUnitRGBA(r));const i=this._getCombinedOpacity(r,{hasIntrinsicColor:!0});t.color=[t.color[0],t.color[1],t.color[2],i],t.transparent=i<1||this.needsDrivenTransparentPass,t.waveDirection=_(this.symbolLayer.waveDirection)?z0.headingVectorFromAngle(this.symbolLayer.waveDirection):Nr(0,0);const n=this.symbolLayer.waveStrength+"-"+this.symbolLayer.waterbodySize,s=owt[n];t.waveStrength=s.waveStrength,t.waveTextureRepeat=s.textureRepeat,t.waveVelocity=s.waveVelocity,t.flowStrength=s.perturbationStrength,t.hasSlicePlane=this._context.slicePlaneEnabled,t.isDraped=this.draped,this._material=new xRe(t),this._context.stage.add(this._material)}layerOpacityChanged(){if(R(this._material))return!0;const t=this._material.parameters.color,r=this._getCombinedOpacity(this.symbolLayer.color,{hasIntrinsicColor:!0}),i=r<1||this.needsDrivenTransparentPass;return this._material.setParameters({color:[t[0],t[1],t[2],r],transparent:i}),!0}layerElevationInfoChanged(t,r,i){const n=this._elevationContext.mode,s=OO(z0.elevationModeChangeTypes,i,n);if(s!==nn.UPDATE)return s;const a=rf(n);return this.updateGraphics3DGraphicElevationInfo(t,r,()=>a)}slicePlaneEnabledChanged(){return _(this._material)&&this._material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),!0}physicalBasedRenderingChanged(){return!0}pixelRatioChanged(){return!0}_createAs3DShape(t,r,i){const n=fR(t.geometry);if(R(n))return null;_o.renderData=wae(n,this._context.elevationProvider,this._context.renderCoordsHelper,r);const s=_o.renderData.position.length/3;if(_o.uvCoords=new Float64Array(2*s),_o.outNum=0,_o.outGeometries=[],_o.outTransforms=[],_o.outMaterials=[],this._create3DShapeGeometries(_o),this._logGeometryCreationWarnings(_o.renderData,n.rings,"rings","WaterSymbol3DLayer"),_o.outNum===0)return null;this._createUVCoordsFromVertices(_o.uvCoords,_o.renderData.mapPosition,s,this._context.elevationProvider.spatialReference);const a=new rb({geometries:_o.outGeometries,materials:_o.outMaterials,transformations:_o.outTransforms,castShadow:!1,metadata:{layerUid:this._context.layer.uid,graphicUid:i}}),o=new Fm(this,a,_o.outGeometries,null,null,DAe,r);return o.alignedSampledElevation=_o.renderData.sampledElevation,o.needsElevationUpdates=rf(r.mode),o}_createUVCoordsFromVertices(t,r,i,n){const s=vc(n);Eu(Eb);for(let l=0;l<i;l++)vr(Nge,r[3*l+0],r[3*l+1]),Y4(Eb,Nge);YR(Eb,Eb,s);const a=Eb[0]%z0.unitSizeOfTexture,o=Eb[1]%z0.unitSizeOfTexture;AI[0]=Eb[0]-a,AI[1]=Eb[1]-o;for(let l=0;l<i;l++)t[2*l+0]=(r[3*l+0]*s-AI[0])/z0.unitSizeOfTexture,t[2*l+1]=(r[3*l+1]*s-AI[1])/z0.unitSizeOfTexture}_create3DShapeGeometries(t){const r=t.renderData.polygons,i=t.uvCoords;for(const{count:n,index:s,position:a,mapPosition:o,holeIndices:l}of r){if(_(this._context.clippingExtent)&&(bi(Cb),hu(Cb,o),!pp(Cb,this._context.clippingExtent)))continue;const c=P9(o,l,3);if(c.length===0)continue;const u=new Uint32Array(c),h=new Float64Array(i.buffer,2*s*i.BYTES_PER_ELEMENT,2*n),p=jme({indices:u,attributeData:{position:a,uv0:h,mapPosition:o}});t.outGeometries.push(p),t.outMaterials.push(this._material),t.outTransforms.push(Es),t.outNum++}}_createAsOverlay(t){const r=fR(t.geometry);if(R(r))return null;this._material.renderPriority=this._renderPriority,Ho.renderData=ORe(r,this._context.overlaySR);const i=Ho.renderData.position.length/3;return Ho.uvCoords=new Float64Array(2*i),Ho.outNum=0,Ho.outGeometries=[],Ho.outBoundingBox=bi(),Ho.layerUid=this._context.layer.uid,Ho.graphicsUid=t.uid,this._createAsOverlayWater(Ho),this._logGeometryCreationWarnings(Ho.renderData,r.rings,"rings","WaterSymbol3DLayer"),Ho.outNum===0?null:(this._createUVCoordsFromVertices(Ho.uvCoords,Ho.renderData.position,i,this._context.overlaySR),Ho.outNum>0?new _U(this,Ho.outGeometries,Ho.outBoundingBox,this._context.drapeSourceRenderer):null)}_createAsOverlayWater(t){const r=t.uvCoords,i=t.renderData.polygons;for(const{position:n,holeIndices:s,index:a,count:o}of i){if(bi(Cb),hu(Cb,n),!pp(Cb,this._context.clippingExtent))continue;H5(t.outBoundingBox,Cb);const l=P9(n,s,3);if(l.length===0)continue;const c=new Uint32Array(l),u=new Float64Array(r.buffer,2*a*r.BYTES_PER_ELEMENT,2*o),h=jme({indices:c,attributeData:{position:n,uv0:u}}),p=new D9(h,this._material,{layerUid:t.layerUid,graphicUid:t.graphicsUid}),m=Cb;ei(p.boundingSphere,.5*(m[0]+m[3]),.5*(m[1]+m[4]),0,.5*Math.sqrt((m[3]-m[0])*(m[3]-m[0])+(m[4]-m[1])*(m[4]-m[1]))),t.outGeometries.push(p),t.outNum++}}static headingVectorFromAngle(t){const r=it(),i=fV(t);return r[0]=Math.sin(i),r[1]=Math.cos(i),r}test(){return{...super.test(),create3DShape:t=>this._createAs3DShape(t.graphic,t.elevationContext,t.graphicUid),ensureMaterial:()=>this.ensureMaterial()}}}z0.unitSizeOfTexture=100,z0.elevationModeChangeTypes={definedChanged:nn.RECREATE,staysOnTheGround:nn.NONE,onTheGroundChanged:nn.RECREATE};const AI=it(),Eb=zt(),Nge=it(),Cb=is(),_o={renderData:null,uvCoords:null,outNum:0,outBoundingBox:null,outGeometries:null,outMaterials:null,outTransforms:null},Ho={renderData:null,uvCoords:null,outNum:0,outBoundingBox:null,outGeometries:null,outMaterials:null,outTransforms:null},cwt=fe.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayerFactory");function dwt(e,t,r,i){const n=kge[e.type]&&kge[e.type][t.type]||uwt[t.type];return n?new n(e,t,r,i):(cwt.error("GraphicsLayerFactory#make",`unknown symbol type ${t.type}`),null)}const uwt={icon:yR,object:O2t,line:TU,path:x3t,fill:IU,extrude:u1t,text:iwt,water:z0},kge={"mesh-3d":{fill:l_t}};class hwt extends cae{constructor(t,r,i){super(r.schedule),this._symbol=t,this._context=r,this._backgroundLayers=i,this._destroyed=!1,this.symbolLayers=new Array,this.referenced=0,this._extentPadding=0}set symbol(t){this._symbol=t;for(let r=0;r<t.symbolLayers.length;r++){const i=this.symbolLayers[r];R(i)||(i.symbol=t,i.symbolLayer=t.symbolLayers.items[r])}}get symbol(){return this._symbol}async doLoad(t){let r=this._symbol.symbolLayers;this._extentPadding=0,this._backgroundLayers&&(r=this._backgroundLayers.concat(r));const i=r.length;for(;this.symbolLayers.length<r.length;)this.symbolLayers.push(null);this.symbolLayers.length=r.length;const n=[];for(let s=0;s<i;s++){const a=r.getItemAt(s);if(a.enabled===!1)continue;RI.renderPriority=1-(1+s)/i,RI.renderPriorityStep=1/i,RI.ignoreDrivers=a._ignoreDrivers;const o=dwt(this.symbol,a,this._context,RI);n.push(Ate(t,()=>{this.symbolLayers[s]=null,o.destroy()})),this.symbolLayers[s]=o}await dV(this.symbolLayers,async(s,a)=>{if(_(s))try{await s.load(),this._extentPadding+=Math.max(this._extentPadding,s.extentPadding)}catch{this.symbolLayers[a]=null}});for(const s of n)s==null||s.remove();if(n.length=0,Et(t),this.symbolLayers.length&&!this.symbolLayers.some(s=>!!s))throw new Error}getSymbolLayerSize(t){const r=this.symbolLayers[t];return _(r)?r.getCachedSize():null}get extentPadding(){return this._extentPadding}createGraphics3DGraphic(t,r){const i=t.graphic,n=new Array(this.symbolLayers.length);for(let a=0;a<this.symbolLayers.length;a++){const o=this.symbolLayers[a];n[a]=_(o)?o.createGraphics3DGraphic(t):null}const s=this._context.arcade||this._context.featureExpressionInfoContext&&this._context.featureExpressionInfoContext.arcade&&this._context.featureExpressionInfoContext.arcade.modules||null;return new lyt(i,r||this,n,t.layer,s)}get complexity(){return hae(this.symbolLayers.map(t=>Vi(t,"complexity")))}globalPropertyChanged(t,r){const i=this.symbolLayers.length;for(let n=0;n<i;n++){const s=this.symbolLayers[n],a=o=>{const l=o.graphics[n];return l instanceof Fm?l:null};if(_(s)&&!s.globalPropertyChanged(t,r,a))return!1}return!0}applyRendererDiff(t,r){return this.loadStatus!==eu.LOADED?xs.Recreate_Symbol:this.symbolLayers.reduce((i,n)=>i!==xs.Recreate_Symbol&&_(n)?Math.min(i,n.applyRendererDiff(t,r)):i,xs.Fast_Update)}prepareSymbolPatch(t){if(this.loadStatus===eu.FAILED||t.diff.type!=="partial")return;const r=t.diff.diff;if(!r.symbolLayers||r.symbolLayers.type!=="partial")return;const i=r.symbolLayers.diff;this.symbolLayers.forEach((n,s)=>{if(R(n))return;const a=i[s];if(a){const o={diff:a,graphics3DGraphicPatches:[],symbolLayerStatePatches:[]};n.prepareSymbolLayerPatch(o),t.symbolStatePatches.push(...o.symbolLayerStatePatches),o.graphics3DGraphicPatches.length&&t.graphics3DGraphicPatches.push((l,c)=>{const u=l.graphics[s];_(u)&&o.graphics3DGraphicPatches.forEach(h=>h(u,c))})}})}updateGeometry(t,r){for(let i=0;i<this.symbolLayers.length;i++){const n=this.symbolLayers[i];if(R(n))continue;const s=t.graphics[i];if(R(s)||!n.updateGeometry(s,r))return!1}return!0}onRemoveGraphic(t){for(let r=0;r<this.symbolLayers.length;r++){const i=this.symbolLayers[r];if(R(i))continue;const n=t.graphics[r];_(n)&&i.onRemoveGraphic(n)}}getFastUpdateStatus(){let t=0,r=0,i=0;return this.symbolLayers.forEach(n=>{R(n)||(n.loadStatus===eu.LOADING?t++:n.isFastUpdatesEnabled()?i++:r++)}),{loading:t,slow:r,fast:i}}destroy(){if(this.destroyed)console.error("Graphics3DSymbol.destroy called when already destroyed!");else{super.destroy();for(const t of this.symbolLayers)_(t)&&t.destroy();this.symbolLayers.length=0,this._destroyed=!0}}get destroyed(){return this._destroyed}}const RI={renderPriority:0,renderPriorityStep:1,ignoreDrivers:!1};class fwt extends cae{constructor(t,r,i){super(r),this.symbol=t,this.convert=i,this.graphics3DSymbol=null,this.referenced=0}getSymbolLayerSize(t){return _(this.graphics3DSymbol)?this.graphics3DSymbol.getSymbolLayerSize(t):null}get symbolLayers(){return _(this.graphics3DSymbol)?this.graphics3DSymbol.symbolLayers:[]}get extentPadding(){return _(this.graphics3DSymbol)?this.graphics3DSymbol.extentPadding:0}async doLoad(t){const r=await this.symbol.fetchSymbol({signal:t});r.id=this.symbol.id,this.graphics3DSymbol=this.convert(r),_(this.graphics3DSymbol)&&await this.graphics3DSymbol.load()}createGraphics3DGraphic(t){return _(this.graphics3DSymbol)?this.graphics3DSymbol.createGraphics3DGraphic(t,this):null}get complexity(){return _(this.graphics3DSymbol)?this.graphics3DSymbol.complexity:uae}globalPropertyChanged(t,r){return!!_(this.graphics3DSymbol)&&this.graphics3DSymbol.globalPropertyChanged(t,r)}applyRendererDiff(t,r){return _(this.graphics3DSymbol)?this.graphics3DSymbol.applyRendererDiff(t,r):xs.Recreate_Symbol}prepareSymbolPatch(t){_(this.graphics3DSymbol)&&this.graphics3DSymbol.prepareSymbolPatch(t)}updateGeometry(t,r){return!!_(this.graphics3DSymbol)&&this.graphics3DSymbol.updateGeometry(t,r)}onRemoveGraphic(){}getFastUpdateStatus(){return _(this.graphics3DSymbol)?this.graphics3DSymbol.getFastUpdateStatus():{loading:1,fast:0,slow:0}}destroy(){_(this.graphics3DSymbol)&&this.graphics3DSymbol.destroy(),this.graphics3DSymbol=void 0,super.destroy()}get destroyed(){return this.graphics3DSymbol===void 0}}function Pae(e){return e instanceof fwt?e.graphics3DSymbol:e instanceof hwt?e:null}const vR=fe.getLogger("esri.views.3d.layers.graphics.labelPlacement");function pwt(e){const t=Twt(e);if(R(t))return null;const r=mwt(e,t);if(R(r))return null;const i=r.anchor,n=!!t.hasLabelVerticalOffset;return ywt({anchor:i,verticalOffset:t.verticalOffset,screenOffset:it(),centerOffset:Tr(0,0,0,-1),centerOffsetUnits:"world",translation:M(),elevationOffset:0,hasLabelVerticalOffset:n},r,e)}function mwt(e,t){if(t.anchor)return t;const r=e.labelClass.labelPlacement,i=_p[r],n=i||wk(e);return r&&!i&&vR.warnOncePerTick(`the requested label placement '${r}' is currently unsupported in SceneView.`),gwt(n,e)}function Iae(e){const t=e.graphics3DGraphic.graphics3DSymbol,r=Pae(t);return _(r)?r.symbol.symbolLayers.getItemAt(0):null}function gwt(e,t){const r=t.graphics3DGraphic.graphic.geometry;if(R(r))return null;if(_(t.disablePlacement))return t.labelClass.labelPlacement?(vR.warnOncePerTick(Vge(e.placement,t.disablePlacement.logEntityDescription)),wk(t)):e;const i=r.type;switch(i){case"polyline":case"polygon":case"extent":case"multipoint":if(t.labelClass.labelPlacement)return vR.warnOncePerTick(Vge(e.placement,`'${i}' geometries`)),wk(t);break;case"point":case"mesh":return e}return e}function Vge(e,t){return`the requested label placement '${e}' is currently unsupported for ${t} in SceneView.`}function wk(e){const t=e.graphics3DGraphic.graphic.geometry;if(R(t))return null;switch(t.type){case"polyline":case"extent":case"multipoint":return{placement:"center-center",normalizedOffset:null,anchor:"center"};case"polygon":{const r=Iae(e);return _(r)&&r.type==="extrude"?_p["above-center"]:{placement:"center-center",normalizedOffset:null,anchor:"center"}}case"point":case"mesh":return _p["above-center"];default:return}}function ywt(e,t,r){const i=r.graphics3DGraphic.graphic.geometry;if(R(i))return null;switch(i.type){case"point":vwt(e,t,r);break;case"polygon":bwt(e,t,r);break;case"mesh":$ae(e,t,r.graphics3DGraphic.graphics[0])}return e}function bwt(e,t,r){const i=Iae(r);if(!R(i))switch(i.type){case"extrude":{const n=r.graphics3DGraphic.graphics[0];_(n)?(n.getBoundingBoxObjectSpace(T7),fp(T7,e.translation),e.translation[2]=g_(T7)/2):ne(e.translation,0,0,0),$ae(e,t,n);break}}}function vwt(e,t,r){const i=Iae(r);if(R(i))return;const n=r.graphics3DGraphic.graphics[0];switch(_(n)?n.getCenterObjectSpace(e.translation):ne(e.translation,0,0,0),i.type){case"icon":case"text":_wt(e,t,r,n);break;case"object":$ae(e,t,n)}}function _wt(e,t,r,i){const{graphics3DGraphic:n}=r,s=_(i)?i.getScreenSize():null;if(!n.isDraped&&_(s)){const a=wwt(r);O8[0]=s[0]/2*(t.normalizedOffset[0]-a[0]),O8[1]=s[1]/2*(t.normalizedOffset[1]-a[1]),e.screenOffset[0]=O8[0],e.hasLabelVerticalOffset?(e.centerOffset[1]=O8[1],e.centerOffsetUnits="screen"):e.screenOffset[1]=O8[1]}else e.hasLabelVerticalOffset||e.anchor==="center"||(_p[r.labelClass.labelPlacement]&&vR.warnOncePerTick(`the requested placement '${t.placement}' is currently unsupported for draped graphics`),e.anchor="center")}function wwt(e,t=Swt){const{graphics3DGraphic:r}=e,i=r.graphics[0],n=_(i)?i.stageObject.geometryRecords[0].material:null;if(n&&n instanceof O9){const s=n.parameters.anchorPosition;t[0]=2*(s[0]-.5),t[1]=2*(s[1]-.5)}else t[0]=0,t[1]=0;return t}function $ae(e,t,r){const i=_(r)?r.getBoundingBoxObjectSpace(T7):T7,n=Ve(i[3]-i[0],i[4]-i[1],i[5]-i[2]),s=Math.sqrt(n[0]*n[0]+n[1]*n[1]);e.centerOffset[0]=s/2*t.normalizedOffset[0];const a=e.translation[2],o=n[2]/2*t.normalizedOffset[1];e.translation[2]=0,e.elevationOffset=a+o;const l=Oe(n);e.centerOffset[2]=l/2*t.normalizedOffset[2]}function xwt(e){return e==="above-center"}function Twt(e){const t=e.labelClass.labelPlacement,{labelSymbol:r,graphics3DGraphic:i}=e,n=Pae(i.graphics3DSymbol),s=ys(n,o=>o.symbol.type==="point-3d"?o.symbol:null),a=_p[t]||wk(e);return _(s)&&s.supportsCallout()&&s.hasVisibleVerticalOffset()&&!i.isDraped?{placement:null,hasLabelVerticalOffset:!1,verticalOffset:zge(s.verticalOffset),anchor:null,normalizedOffset:null}:r&&r.hasVisibleVerticalOffset()&&(R(s)||!s.supportsCallout()||!s.verticalOffset||i.isDraped)?xwt(a.placement)?{placement:"above-center",verticalOffset:zge(r.verticalOffset),anchor:"bottom",normalizedOffset:[0,a.normalizedOffset[1],0],hasLabelVerticalOffset:!0}:(vR.errorOncePerTick("Callouts and vertical offset on labels are currently only supported with 'above-center' label placement (not with "+t+" placement)"),null):{placement:null,verticalOffset:null,anchor:null,normalizedOffset:null,hasLabelVerticalOffset:!1}}function zge(e){const{screenLength:t,minWorldLength:r,maxWorldLength:i}=e;return{screenLength:t,minWorldLength:r,maxWorldLength:i}}const _p={"above-center":{placement:"above-center",normalizedOffset:[0,1,0],anchor:"bottom"},"above-left":{placement:"above-left",normalizedOffset:[-1,1,0],anchor:"bottom-right"},"above-right":{placement:"above-right",normalizedOffset:[1,1,0],anchor:"bottom-left"},"below-center":{placement:"below-center",normalizedOffset:[0,-1,2],anchor:"top"},"below-left":{placement:"below-left",normalizedOffset:[-1,-1,0],anchor:"top-right"},"below-right":{placement:"below-right",normalizedOffset:[1,-1,0],anchor:"top-left"},"center-center":{placement:"center-center",normalizedOffset:[0,0,1],anchor:"center"},"center-left":{placement:"center-left",normalizedOffset:[-1,0,0],anchor:"right"},"center-right":{placement:"center-right",normalizedOffset:[1,0,0],anchor:"left"}},Uge={"above-center":["default","esriServerPointLabelPlacementAboveCenter"],"above-left":["esriServerPointLabelPlacementAboveLeft"],"above-right":["esriServerPointLabelPlacementAboveRight"],"below-center":["esriServerPointLabelPlacementBelowCenter"],"below-left":["esriServerPointLabelPlacementBelowLeft"],"below-right":["esriServerPointLabelPlacementBelowRight"],"center-center":["esriServerPointLabelPlacementCenterCenter"],"center-left":["esriServerPointLabelPlacementCenterLeft"],"center-right":["esriServerPointLabelPlacementCenterRight"]};for(const e in Uge){const t=Uge[e],r=_p[e];t.forEach(i=>{_p[i]=r})}Object.freeze&&(Object.freeze(_p),Object.keys(_p).forEach(e=>{Object.freeze(_p[e]),Object.freeze(_p[e].normalizedOffset)}));const O8=[0,0],Swt=[0,0],T7=is();class Bge{constructor(t){this._stage=t,this._materials=new Map}get(t){return this._materials.get(t)}add(t,r){this._materials.set(t,r),this._stage.add(r)}dispose(){this._stage.removeMany(Array.from(this._materials.values())),this._materials.clear()}}const Zq=512,Qq=4096,Ewt=.85,Cwt=.95;let lC=class extends xe{constructor(e){super(e),this.type=Np.Texture,this.id=ic(),this.events=new mn,this._glTexture=null,this.needsClear=!1,this.elementsToAddOrUpdate=new Map,this.elementsToRemove=new Map,this.elementsToRender=new Map,this.elements=new Map,this.stageObjects=new Map,this.updating=!1}initialize(){this.stage=this.view._stage,this.canvas=this._create2DCanvas(),this.ctx=this.canvas.getContext("2d"),this.stage.add(this);const e=this._computeAtlasResolution(this.view.width,this.view.height);this._createAtlasRegion(e),this._update2DCanvasSize(),this._resetAtlasCursor()}unload(){this._glTexture=Qe(this._glTexture),this.updating=!1,this.events.emit("unloaded")}get width(){return this.atlas.size.width}get height(){return this.atlas.size.height}get requiresFrameUpdates(){return!1}_createDescriptor(e){return{target:mt.TEXTURE_2D,pixelFormat:Ue.RGBA,dataType:At.UNSIGNED_BYTE,wrapMode:xt.CLAMP_TO_EDGE,flipped:!0,samplingMode:tt.LINEAR_MIPMAP_LINEAR,hasMipmap:!0,preMultiplyAlpha:!0,maxAnisotropy:e.parameters.maxMaxAnisotropy}}get glTexture(){return this._glTexture}load(e){return _(this._glTexture)||(this._glTexture=new at(e,this._createDescriptor(e),this.canvas),this.frameWorker=this.view.resourceController.scheduler.registerTask(bt.TEXT_TEXTURE_ATLAS,this),this.setDirty()),this._glTexture}dispose(){this.elements=null,this.elementsToAddOrUpdate=null,this.elementsToRemove=null,this.elementsToRender=null,this.frameWorker=Ts(this.frameWorker),this._glTexture&&(this.stage.remove(this),this._glTexture=Qe(this._glTexture)),this.canvas.width=0,this.canvas.height=0,this.canvas=null,this.ctx=null}_create2DCanvas(){const e=document.createElement("canvas");return e.setAttribute("id","canvas2d"),e.setAttribute("style","display:none"),e.setAttribute("width",Zq.toString()),e.setAttribute("height",Zq.toString()),e}_update2DCanvasSize(){this.canvas.setAttribute("width",this.atlas.size.width.toString()),this.canvas.setAttribute("height",this.atlas.size.height.toString())}_createAtlasRegion(e=Zq){this.atlas={size:{width:e,height:e},cursor:{x:0,y:0},lineHeight:0}}_computeAtlasResolution(e,t){let r=Math.max(e,t);return r+=256,r=$5(r),r=Math.min(r,Qq),r}_resizeAtlas(e,t){t=t||e;const r=this.atlas;r.size.width=e,r.size.height=t,_(this._glTexture)&&this._glTexture.resize(e,t),this._update2DCanvasSize()}_resetAtlasCursor(){const e=this.atlas;e.cursor.x=M8,e.cursor.y=M8+Gge,e.lineHeight=0,this.needsClear=!0}_getAtlasUsage(){const e=this.atlas;return(e.cursor.x+e.cursor.y*e.size.width)/(e.size.width*e.size.height)}_getExpectedAtlasUsage(){const e=this.elementsToRemove.size,t=this.elementsToAddOrUpdate.size,r=this.elements.size;return this._getAtlasUsage()/r*(r+t-e)}_addAtlasElement(e,t,r,i){const n=this.atlas,{renderedWidth:s,renderedHeight:a,displayWidth:o,displayHeight:l}=e.textRenderer;e.placement.offset.x=n.cursor.x,e.placement.offset.y=n.cursor.y,e.placement.size.width=s,e.placement.size.height=a,e.placement.size.displayWidth=o,e.placement.size.displayHeight=l,e.placement.uvMinMax=[e.placement.offset.x/n.size.width,1-(e.placement.offset.y+a)/n.size.height,(e.placement.offset.x+s)/n.size.width,1-e.placement.offset.y/n.size.height],n.cursor.x+=r,n.lineHeight=Math.max(n.lineHeight,i),this.elements.set(t,e)}_removeAtlasElement(e){if(e&&this.elements.has(e.textId)){const t=e.placement.offset,r=e.placement.size;this.ctx.clearRect(t.x,t.y,r.width,r.height),this.elements.delete(e.textId)}}_ensureStageObjects(e){const t=this.stageObjects.get(e);if(t)return t;const r=new Set;return this.stageObjects.set(e,r),r}_addStageObject(e,t){this._ensureStageObjects(e).add(t)}_removeStageObject(e,t){const r=this.stageObjects.get(e);r&&r.delete(t)&&(t.geometries[0].vertexAttributes.get(O.SIZE).data=[0,0],t.geometryVertexAttrsUpdated(t.geometryRecords[0]))}_processAddition(e,t){const r=this.atlas,i=e.textId,n=e.textRenderer.renderedWidth,s=e.textRenderer.renderedHeight,a=n+M8,o=s+M8+Gge;if(r.cursor.x+a<r.size.width&&r.cursor.y+o<r.size.height)this._addAtlasElement(e,i,a,o),this.elementsToRender.set(i,e),this.elementsToAddOrUpdate.delete(i);else{if(!(r.cursor.y+o+r.lineHeight<r.size.height)){const l=this._getExpectedAtlasUsage(),c=l>Ewt&&r.size.width<Qq;return c&&this._resizeAtlas(2*r.size.width,2*r.size.height),!t||!c&&l>Cwt&&r.size.width===Qq?(this._processRemovals(),O4.OK):(this._repack(),O4.REPACK)}r.cursor.x=M8,r.cursor.y+=r.lineHeight,r.lineHeight=0,this._addAtlasElement(e,i,a,o),this.elementsToRender.set(i,e),this.elementsToAddOrUpdate.delete(i)}return O4.OK}_processRemovals(){this.elementsToRemove.forEach((e,t)=>{const r=this.stageObjects.get(t);r&&r.size!==0||this._removeAtlasElement(e),r&&r.size===0&&this.stageObjects.delete(t)}),this.elementsToRemove.clear()}_repack(){this._processRemovals(),this.elements.forEach((e,t)=>{e.rendered=!1,this.elementsToAddOrUpdate.set(t,e)}),this.elements.clear(),this._resetAtlasCursor(),this.elementsToRender.clear()}_processRenderingRequest(e){this.ctx.clearRect(e.placement.offset.x,e.placement.offset.y,e.placement.size.width,e.placement.size.height),e.textRenderer.render(this.ctx,e.placement.offset.x,e.placement.offset.y);const t=this.stageObjects.get(e.textId);t&&t.forEach(r=>{r.geometries[0].vertexAttributes.get(O.UV0).data=new Float32Array(e.placement.uvMinMax),r.geometries[0].vertexAttributes.get(O.SIZE).data=[e.placement.size.displayWidth,e.placement.size.displayHeight],r.geometryVertexAttrsUpdated(r.geometryRecords[0])}),e.rendered=!0}get running(){return this.updating}runTask(e,t=!0){if(!this._glTexture)return;let r=!1;if(vs(this.elementsToAddOrUpdate,(n,s)=>{const a=this.elements.get(s);if(a&&a.rendered){const o=this.stageObjects.get(s);return o&&o.forEach(l=>{const c=l.geometries[0].vertexAttributes,u=this.elements.get(s);c.get(O.UV0).data=new Float32Array(u.placement.uvMinMax),c.get(O.SIZE).data=new Float32Array([u.placement.size.displayWidth,u.placement.size.displayHeight]),l.geometryVertexAttrsUpdated(l.geometryRecords[0])}),this.elementsToAddOrUpdate.delete(s),!1}return this._processAddition(this.elementsToAddOrUpdate.get(s),t)===O4.REPACK&&(r=!0,!0)}),r)return void this.runTask(y6,!1);let i=!1;this.elementsToRender.size>0&&this.needsClear&&(this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.needsClear=!1),vs(this.elementsToRender,(n,s)=>(this._processRenderingRequest(n),this.elementsToRender.delete(s),i=!0,e.madeProgress(),e.done)),i&&_(this._glTexture)&&this._glTexture.setData(this.canvas),this.updating=this.elementsToRender.size>0,!this.updating&&Ryt.orderedRepackingEnabled&&this.repackOrdered()}addTextTexture(e,t){const r=e.key;this.elementsToAddOrUpdate.has(r)||this.elementsToAddOrUpdate.set(r,{textId:r,placement:{offset:{x:0,y:0},size:{width:0,height:0,displayWidth:0,displayHeight:0},uvMinMax:[]},textRenderer:e,rendered:!1}),this._addStageObject(r,t),this.elementsToRemove.delete(r),this.setDirty()}removeTextTexture(e,t){const r=e.key;this.elementsToRemove.set(r,this.elements.get(r)),this._removeStageObject(r,t)}setDirty(){this._glTexture&&(this.updating=!0)}repackOrdered(){if(this.elements.size===0)return;const e=[];this.elements.forEach((r,i)=>e.push({element:r,key:i}));let t=!0;for(let r=0;r<e.length-1;r++)if(e[r].key.localeCompare(e[r+1].key)>0){t=!1;break}if(!t||this.elementsToRemove.size){e.sort((r,i)=>r.key.localeCompare(i.key)),this.elements.clear();for(const{element:r,key:i}of e)this.elements.set(i,r);this._repack(),this.setDirty()}}get test(){const{elements:e,stageObjects:t,elementsToRemove:r,atlas:i}=this,n=this;return{elements:e,stageObjects:t,elementsToRemove:r,atlas:i,_resizeAtlas:(s,a)=>n._resizeAtlas(s,a),run:(s,a)=>n.runTask(s,a)}}};d([f({constructOnly:!0})],lC.prototype,"view",void 0),d([f({type:Boolean})],lC.prototype,"updating",void 0),lC=d([$("esri.views.3d.webgl-engine.lib.TextTextureAtlas")],lC);const M8=2,Gge=2;var O4;(function(e){e[e.OK=0]="OK",e[e.REPACK=1]="REPACK"})(O4||(O4={}));const jge=fe.getLogger("esri.views.3d.layers.graphics.Labeler");let K2=class extends xe{constructor(){super(...arguments),this._dirty=!1,this._labels=new Map,this._labelsToAdd=new Map,this._labelsToRemove=new Map,this._labelingContexts=new Array}setup(){this.dispose(),this._handles=new Ft,this._handles.add([re(()=>{var e;return(e=this.view.state)==null?void 0:e.camera},()=>this.setDirty()),re(()=>{var e;return(e=this.view.state)==null?void 0:e.pixelRatio},()=>this._resetAllLabels()),this.view.resourceController.scheduler.registerTask(bt.LABELER,this)]),this._textTextureAtlas=new lC({view:this.view}),this._hudMaterialCollection=new Bge(this.view._stage),this._calloutMaterialCollection=new Bge(this.view._stage)}dispose(){this._handles=ct(this._handles),this._textTextureAtlas=Qe(this._textTextureAtlas),this._hudMaterialCollection=Qe(this._hudMaterialCollection),this._calloutMaterialCollection=Qe(this._calloutMaterialCollection),this._labelingContexts.length=0,this._labels.clear(),this._labelsToAdd.clear(),this._labelsToRemove.clear()}_activateLabelingContext(e){e.labels.forEach((t,r)=>{this._labels.set(r,t),t.graphics3DGraphic.setVisibilityFlag(ou.USER_SETTING,!0,Ra.LABEL)}),e.active=!0}_deactivateLabelingContext(e){e.labels.forEach((t,r)=>{t.graphics3DGraphic.setVisibilityFlag(ou.USER_SETTING,!1,Ra.LABEL),this.setLabelGraphicVisibility(t.graphics3DGraphic,!1),this._labels.delete(r)}),e.active=!1}_addLabelTextureToAtlas(e){for(const t of e.graphics3DGraphic.labelGraphics){if(!t._labelClass)continue;const r=e.textTextureResources.textRenderers[t._labelIndex];_(r)&&this._textTextureAtlas.addTextTexture(r,t.stageObject)}e.rendered=!0}_removeLabelTextureFromAtlas(e){for(const t of e.graphics3DGraphic.labelGraphics){if(!t._labelClass)continue;const r=e.textTextureResources.textRenderers[t._labelIndex];_(r)&&this._textTextureAtlas.removeTextTexture(r,t.stageObject)}e.rendered=!1}get running(){var e;return this.view.ready&&(this._dirty||((e=this._textTextureAtlas)==null?void 0:e.updating)||this.deconflictor.running)}runTask(e){this._updateLabels(e),!this._dirty&&this.deconflictor.running&&this.deconflictor.runTask(e)}_updateLabels(e){if(this._dirty){this._dirty=!1;for(const t of this._labelingContexts)if(Awt(t)){if(!qge(t)){if(Rwt(t)){this._deactivateLabelingContext(t);continue}if(this._createLabelClassContext(t),Jq(t)){this._dirty=!0;continue}if(!qge(t))continue}vs(t.labelsToInitialize,(r,i)=>(this._ensureGraphics3DResources(r)&&(this._labels.set(i,r),this.deconflictor.setDirty(),e.madeProgress()),(r.visible&&r.textTextureResources.initialized||!r.visible&&r.hasGraphics3DResources)&&(t.labelsToInitialize.delete(i),e.madeProgress()),e.done))&&(this._dirty=!0)}this._labelsToRemove.forEach(t=>this._removeLabelTextureFromAtlas(t)),this._labelsToAdd.forEach(t=>this._addLabelTextureToAtlas(t)),this._labelsToRemove.clear(),this._labelsToAdd.clear(),this._dirty||this.notifyChange("updating")}}async _createLabelClassContextAsync(e){const t=e.labelClassAbortController.signal;await e.layer.when(),Et(t),e.scaleVisibility&&e.scaleVisibility.updateScaleRangeActive();const r=e.graphics3DCore,i=r.layer,n=i.labelingInfo&&i.labelingInfo.filter(o=>!!o.symbol);if(!n||n.length===0)return;const s=new Array(n.length);let a=!1;await dV(n,async(o,l)=>{const c=o.symbol,u=Pae(r.getOrCreateGraphics3DSymbol(c));if(R(u))return void jge.error("Failed to create Graphics3DSymbol for label");await u.load(),Et(t);let h=null;Vre(c)&&c.hasVisibleCallout()&&(h=nyt(c,r.symbolCreationContext),await h.load(),Et(t));const p=await Tu(PAe(o,e.layer.fieldsIndex,this.view.spatialReference));if(Et(t),p.ok===!0){const m=await this._createTextRenderParameters(u.symbol);Et(t),s[l]={labelClass:o,labelFunction:p.value,graphics3DSymbol:u,graphics3DCalloutSymbolLayer:h,calloutSymbolLayerIndex:0,textRenderParameters:m}}else jge.error(`Label expression failed to evaluate: ${p.error}`),a=!0}),Et(t),a||(e.labelClassContexts=s)}async _createLabelClassContext(e){return e.labelClassPromise||(e.labelClassPromise=this._createLabelClassContextAsync(e).catch(t=>{if(Ui(t))throw t;e.labelClassContexts=null}).then(()=>{e.labelClassAbortController=null,this.notifyChange("updating")}).catch(()=>{}),this.notifyChange("updating")),e.labelClassPromise}async _createTextRenderParameters(e){const t=e.symbolLayers.getItemAt(0);return t&&t.type==="text"?$U.fromSymbol(t,this.view.state.pixelRatio):null}_destroyLabelClassContext(e){for(const r of e.labelClassContexts)--r.graphics3DSymbol.referenced,r.graphics3DSymbol=null;const t=e.labelClassAbortController;e.labelClassAbortController=new AbortController,t&&t.abort(),e.labelClassContexts=[],e.labelClassPromise=null,this.notifyChange("updating")}_createTextSymbolGraphic(e,t,r,i,n){const s={text:e.text,centerOffset:r.centerOffset,translation:r.translation,elevationOffset:r.elevationOffset,screenOffset:r.screenOffset,centerOffsetUnits:r.centerOffsetUnits,horizontalPlacement:rge(r.anchor),verticalPlacement:E1t(r.anchor),verticalOffset:r.verticalOffset,debugDrawLabelBorder:Yr.LABELS_SHOW_BORDER,displayWidth:e.displayWidth,displayHeight:e.displayHeight};return Ab.graphic=t,Ab.renderingInfo=null,Ab.layer=i,n.createLabel(Ab,s,this._hudMaterialCollection,this._textTextureAtlas)}_createLineCalloutGraphic(e,t,r,i,n){const s={symbol:t,translation:i.translation,elevationOffset:i.elevationOffset,screenOffset:i.screenOffset,centerOffset:i.centerOffset,centerOffsetUnits:i.centerOffsetUnits,materialCollection:this._calloutMaterialCollection};return Ab.graphic=e,Ab.renderingInfo=s,Ab.layer=n,r.createGraphics3DGraphic(Ab)}_ensureGraphics3DResources(e){if(e.hasGraphics3DResources)return!1;const t=e.graphics3DGraphic;if(t.destroyed)return!1;this._ensureTextTextureResources(e);const{textTextureResources:r}=e,i=e.labelingContext,n=i.labelClassContexts;if(!n||n.length===0||!i.emptySymbolLabelSupported&&t.graphics.length===0)return!1;let s=!1;const a=t.graphic,o=i.layer,l=xX(i.layer),c=this.view._stage;for(let u=0;u<n.length;u++){const h=r.textRenderers[u],p=r.labelPlacements[u];if(R(h)||R(p))continue;const m=n[u],g=m.graphics3DSymbol,b=g.symbol&&g.symbol.type==="label-3d"?g.symbol:null,w=g.symbolLayers[0];if(!w)continue;w.setElevationInfoOverride(i.elevationInfoOverride);const v=this._createTextSymbolGraphic(h,a,p,o,w);if(!v)return!1;v._labelClass=m.labelClass,v._labelIndex=u,t.addLabelGraphic(v,c,i.stageLayer),t.setVisibilityFlag(ou.USER_SETTING,l,Ra.LABEL),t.clearVisibilityFlag(ou.SCALE_RANGE,Ra.LABEL),t.setVisibilityFlag(ou.DECONFLICTION,!1,Ra.LABEL),s=!0;const x=m.graphics3DCalloutSymbolLayer;if(x&&p.hasLabelVerticalOffset){x.setElevationInfoOverride(i.elevationInfoOverride);const T=this._createLineCalloutGraphic(a,b,x,p,o);_(T)&&(m.calloutSymbolLayerIndex=t.labelGraphics.length,t.addLabelGraphic(T,c,i.stageLayer))}break}return i.scaleVisibility&&s&&i.scaleVisibility.updateGraphicLabelScaleVisibility(t),e.hasGraphics3DResources=!0,!0}_destroyGraphics3DResources(e){const t=e.labelingContext.labelClassContexts;for(const r of e.graphics3DGraphic.labelGraphics){if(r._labelClass==null)continue;const i=t[r._labelIndex].graphics3DSymbol.symbolLayers[0];i!=null&&i.onRemoveGraphic(r)}e.graphics3DGraphic.clearLabelGraphics(),e.hasGraphics3DResources=!1}_ensureTextTextureResources(e){const{textTextureResources:t}=e;if(t.initialized)return;const r=e.labelingContext,i=r.labelClassContexts;if(!i||i.length===0)return;const n=e.graphics3DGraphic.graphic;for(let s=0;s<i.length;s++){const a=i[s];if(t.textRenderers[s]=null,t.labelPlacements[s]=null,!a.textRenderParameters)continue;const o=a.labelFunction;let l;if(o.type==="arcade")try{const v=o.needsHydrationToEvaluate()?lgt(n,r.layer):n;l=o.evaluate(v)}catch{l=null}else l=o.evaluate(n);if(R(l)||l===""||/^\s+$/.test(l))continue;const c=a.graphics3DSymbol,u=c.symbol&&c.symbol.type==="label-3d"?c.symbol:null;if(!c.symbolLayers[0])continue;const h=e.graphics3DGraphic,p=a.labelClass,m=r.disablePlacement,g=pwt({graphics3DGraphic:h,labelSymbol:u,labelClass:p,disablePlacement:m});if(R(g))continue;const b=rge(g.anchor),w=WRe(b);t.textRenderers[s]=new qRe(l,w,a.textRenderParameters),t.labelPlacements[s]=g}t.initialized=!0}_destroyTextTextureResources(e){const{textTextureResources:t}=e;t.initialized=!1,t.textRenderers=[],t.labelPlacements=[]}_addGraphic(e,t){const r={hasGraphics3DResources:!1,visible:!1,rendered:!1,labelingContext:e,graphics3DGraphic:t,textTextureResources:{initialized:!1,textRenderers:[],labelPlacements:[]}},i=t.graphic.uid;e.labels.set(i,r),e.labelsToInitialize.set(i,r),this.setDirty(),this.deconflictor.setDirty()}_removeGraphic(e,t){const r=t.graphic.uid,i=e.labels.get(r);i&&(this._destroyGraphic(i,r),e.labels.delete(r),e.labelsToInitialize.delete(r),this.setDirty(),this.deconflictor.setDirty())}_destroyGraphic(e,t){this._labels.has(t)&&(this._labels.delete(t),this._labelsToAdd.delete(t),this._labelsToRemove.delete(t)),e.textTextureResources.initialized&&(this._removeLabelTextureFromAtlas(e),this._destroyTextTextureResources(e)),e.hasGraphics3DResources&&this._destroyGraphics3DResources(e)}async _labelingInfoChange(e,t){if(!t)return this._visibilityInfoChange(e),this._resetLabels(e),this._createLabelClassContext(e);for(const r of t){const i=e.labels.get(r);i&&(this._removeGraphic(e,i.graphics3DGraphic),this._addGraphic(e,i.graphics3DGraphic))}}_globalPropertyChanged(e,t){for(const r of t.labelClassContexts){const i=new Map;t.labels.forEach(s=>{const a=s.graphics3DGraphic;i.set(a.graphic.uid,a)});const n=s=>s.labelGraphics[0];if(r.graphics3DSymbol.symbolLayers[0].globalPropertyChanged(e,i,n),r.graphics3DCalloutSymbolLayer){const s=a=>a.labelGraphics[r.calloutSymbolLayerIndex];r.graphics3DCalloutSymbolLayer.globalPropertyChanged(e,i,s)}}}_visibilityInfoChange(e){const t=e.layer.labelsVisible;t&&!e.active&&this._activateLabelingContext(e),!t&&e.active&&this._deactivateLabelingContext(e),this.setDirty()}_resetAllLabels(){for(const e of this._labelingContexts)this._resetLabels(e)}_resetLabels(e){e.labels.forEach((t,r)=>{this._destroyGraphic(t,r),t.visible=!1,t.rendered=!1,e.labelsToInitialize.set(r,t)}),this._destroyLabelClassContext(e),this.setDirty(),this.deconflictor.setDirty()}_findLabelingContext(e){for(const t of this._labelingContexts)if(t.graphics3DCore===e)return t;return null}addGraphicsOwner(e,t,r){const i=r&&r.emptySymbolLabelSupported||!1,n=r&&r.elevationInfoOverride||null,s=r&&r.disablePlacement||null;if(this._findLabelingContext(e))return;const a=e.layer,o={graphics3DCore:e,layer:a,scaleVisibility:t,emptySymbolLabelSupported:i,elevationInfoOverride:n,disablePlacement:s,active:a.labelsVisible,labelClassPromise:null,labelClassAbortController:new AbortController,labelClassContexts:[],labels:new Map,labelsToInitialize:new Map,stageLayer:new tRe({isPickable:!0},a.uid)};return this.view._stage.add(o.stageLayer),this._labelingContexts.push(o),this.setDirty(),{addGraphic:l=>this._addGraphic(o,l),removeGraphic:l=>this._removeGraphic(o,l),featureReductionChange:()=>{},layerLabelsEnabled:()=>xX(o.layer),labelingInfoChange:l=>this._labelingInfoChange(o,l),elevationInfoChange:()=>this._globalPropertyChanged("elevationInfo",o),slicePlaneEnabledChange:()=>this._globalPropertyChanged("slicePlaneEnabled",o),visibilityInfoChange:()=>this._visibilityInfoChange(o),reset:()=>this._resetLabels(o),clear:()=>{}}}removeGraphicsOwner(e){const t=this._findLabelingContext(e);if(!t)return;const r=this._labelingContexts.indexOf(t);this._labelingContexts.splice(r,1),t.labels.forEach(i=>this._removeGraphic(t,i.graphics3DGraphic)),this.view._stage.remove(t.stageLayer),t.stageLayer=null,this.setDirty()}setLabelGraphicVisibility(e,t){const r=e.graphic.uid,i=this._labels.get(r);i&&i.visible!==t&&(t&&!i.rendered?(this._labelsToAdd.set(r,i),this._labelsToRemove.delete(r),i.textTextureResources.initialized||i.labelingContext.labelsToInitialize.set(r,i)):!t&&i.rendered&&(this._labelsToRemove.set(r,i),this._labelsToAdd.delete(r)),i.visible=t,this.setDirty())}setDirty(){!this._dirty&&this._labelingContexts.length>0&&(this._dirty=!0,this.notifyChange("updating"))}get updating(){var e;return this._dirty||((e=this._textTextureAtlas)==null?void 0:e.updating)||this.deconflictor.updating||this._labelingContexts.some(t=>Jq(t))}get updatingProgress(){if(!this.updating||!this._textTextureAtlas)return 1;const e=this._labelingContexts.length>0?this._labelingContexts.reduce((t,r)=>t+(Jq(r)?0:1),0)/this._labelingContexts.length:1;return(this._dirty?0:.3)+(this._textTextureAtlas.updating?0:.1)+.1*e+.5*this.deconflictor.updatingProgress}get test(){return{textTextureAtlas:this._textTextureAtlas,resetAllLabels:()=>this._resetAllLabels()}}};function Awt(e){return e.active&&xX(e.layer)}function Jq(e){return e.labelClassPromise&&!!e.labelClassAbortController}function qge(e){return e.labelClassContexts&&e.labelClassContexts.length}function Rwt(e){return e.labelClassContexts===null}d([f({constructOnly:!0})],K2.prototype,"view",void 0),d([f({constructOnly:!0})],K2.prototype,"deconflictor",void 0),d([f()],K2.prototype,"_textTextureAtlas",void 0),d([f({type:Boolean,readOnly:!0})],K2.prototype,"updating",null),K2=d([$("esri.views.3d.layers.graphics.Labeler")],K2);const Ab=new ayt(null,null,null);class Owt{constructor(){this.gltfCache=new Map,this.wosrCache=new Map,this.evictHandles=new Ft}loadGLTF(t,r,i){const n=i?`gltfPBR:${t}`:`gltf:${t}`;return this._fromCache(this.gltfCache,n,s=>yOe(new mOe(s.streamDataRequester),t,s,i),r)}loadWOSR(t,r){const i=`wosr:${t}:${r.disableTextures}`;return this._fromCache(this.wosrCache,i,n=>bOe(t,n),r)}destroy(){this.evictHandles.destroy(),this.gltfCache.clear(),this.wosrCache.clear()}get size(){return this.wosrCache.size+this.gltfCache.size}_fromCache(t,r,i,n){return new Promise((s,a)=>{if(bs(n))return void a(br());const o=Fo(n,()=>{this._remove(t,r),a(br())}),l=t.get(r);if(l)return this.evictHandles.remove(r),l.refCount++,void l.item.then(s,a);const c=new AbortController,u={...n,signal:c.signal},h={refCount:1,abortController:c,item:i(u).then(p=>(h.abortController=null,p.remove=()=>this._remove(t,r),p))};t.set(r,h),h.item.then(p=>{_(o)&&o.remove(),s(p)},p=>{_(o)&&o.remove(),a(p)})})}_remove(t,r){const i=t.get(r);i&&(i.refCount--,i.refCount===0&&this.evictHandles.add(GDe(()=>{t.delete(r),_(i.abortController)&&i.abortController.abort()},Pwt),r))}}const Mwt=1e4;let Pwt=Mwt;class lp{constructor(t,r,i,n=null){this.lij=[0,0,0],this.extent=zt(),this.resolution=0,this.loadPriority=0,this.measures={visibility:Eo.VISIBLE_ON_SURFACE,screenRect:zt(),distance:0,shouldSplit:!1},this.used=!1,n&&this.acquire(t,r,i,n)}acquire(t,r,i,n){this.tilingScheme=n,this.id=lp.id(t,r,i),this.lij[0]=t,this.lij[1]=r,this.lij[2]=i,n.getExtent(t,r,i,this.extent),this.resolution=n.resolutionAtLevel(t)}release(){this.tilingScheme=null}getChildren(t){const r=this.lij[0]+1,i=2*this.lij[1],n=2*this.lij[2];return t?(t[0].acquire(r,i,n,this.tilingScheme),t[1].acquire(r,i+1,n,this.tilingScheme),t[2].acquire(r,i,n+1,this.tilingScheme),t[3].acquire(r,i+1,n+1,this.tilingScheme),t):[new lp(r,i,n,this.tilingScheme),new lp(r,i+1,n,this.tilingScheme),new lp(r,i,n+1,this.tilingScheme),new lp(r,i+1,n+1,this.tilingScheme)]}copyMeasurementsFrom(t){this.measures.visibility=t.measures.visibility,this.measures.shouldSplit=t.measures.shouldSplit,this.measures.distance=t.measures.distance,Oy(t.measures.screenRect,this.measures.screenRect)}static id(t,r,i){return`${t}/${r}/${i}`}}var Eo;(function(e){e[e.INVISIBLE=0]="INVISIBLE",e[e.VISIBLE_WHEN_EXTENDED=1]="VISIBLE_WHEN_EXTENDED",e[e.VISIBLE_ON_SURFACE=2]="VISIBLE_ON_SURFACE"})(Eo||(Eo={}));class Y1{constructor(t){this.renderCoordsHelper=t,this.frustum=rR(),this._points=VCe(),this.lines=new Array(12),this._origin=M(),this._direction=M(),this._altitude=null;for(let r=0;r<12;r++)this.lines[r]={origin:null,direction:M(),endpoint:null}}get planes(){return this.frustum}get points(){return this._points}get mutablePoints(){return this._points}get direction(){return this._direction}update(t){zCe(t.viewMatrix,t.projectionMatrix,this.frustum,this._points),oe(this._origin,t.eye),oe(this._direction,t.viewForward),this._altitude=this.renderCoordsHelper.getAltitude(this._origin),this._updateLines()}updatePoints(t){for(let r=0;r<this._points.length;r++)oe(this._points[r],t[r]);UCe(this.frustum,this._points),this._updateLines()}get altitude(){return this._altitude}intersectsSphere(t){return fv(this.frustum,t)}intersectsRay(t){return jht(this.frustum,t)}intersectsLineSegment(t,r){return qht(this.frustum,t,r)}intersectsPoint(t){return BCe(this.frustum,t)}_updateLines(){const t=this._points;for(let r=0;r<4;r++){const i=r+4;Kq(this.lines[r],t[r],t[i]),Kq(this.lines[r+4],t[r],r===3?t[0]:t[r+1]),Kq(this.lines[r+8],t[i],r===3?t[4]:t[i+1])}}}function Kq(e,t,r){e.origin=t,e.endpoint=r,By(e.direction,t,r)}Y1.planePointIndices=Wht,Y1.nearFarLineIndices=[[et.NEAR_BOTTOM_LEFT,et.FAR_BOTTOM_LEFT],[et.NEAR_BOTTOM_RIGHT,et.FAR_BOTTOM_RIGHT],[et.NEAR_TOP_RIGHT,et.FAR_TOP_RIGHT],[et.NEAR_TOP_LEFT,et.FAR_TOP_LEFT]];const LOe=.5*Math.PI,Iwt=LOe/Math.PI*180;class $wt{constructor(t){this.renderCoordsHelper=t.renderCoordsHelper,this.extent=new Array(4),this.planes=new Array(6),this.maxSpan=0,this.center={origin:M(),direction:M()};for(let r=0;r<4;r++)this.extent[r]={origin:M(),direction:M(),cap:{next:null,direction:M()}},this.planes[r]=Er();this.planes[ci.NEAR]=Er(),this.planes[ci.FAR]=Er(),this.planesWithoutFar=this.planes.slice(0,5)}update(t,r,i,n=!0){const s=this.extent;this._toRenderBoundingExtent(t,r,i),he(this.center.origin,s[0].origin,s[2].origin),le(this.center.origin,this.center.origin,.5),this.renderCoordsHelper.worldUpAtPosition(this.center.origin,this.center.direction),n||le(this.center.direction,this.center.direction,-1);for(let a=0;a<4;a++){const o=s[a];this.renderCoordsHelper.worldUpAtPosition(o.origin,o.direction);const l=s[a===3?0:a+1];o.cap.next=l.origin,By(o.cap.direction,o.origin,l.origin),bA(o.direction,o.cap.direction,o.origin,this.planes[a]),n||le(o.direction,o.direction,-1)}bA(s[0].cap.direction,s[1].cap.direction,s[0].origin,this.planes[ci.NEAR]),n?dZ(this.planes[ci.NEAR],this.planes[ci.FAR]):(qV(this.planes[ci.FAR],this.planes[ci.NEAR]),dZ(this.planes[ci.NEAR],this.planes[ci.NEAR])),this.maxSpan=Math.max(Math.abs(t[0]-t[2]),Math.abs(t[1]-t[3])),this.maxSpanSpatialReference=r,this.minGlobalAltitude=.9*Ar(this.maxSpanSpatialReference).radius}isVisibleInFrustum(t,r,i=!1){if(t==null)return!1;if(this.renderCoordsHelper.viewingMode===Be.Global){const s=this.maxSpanSpatialReference.isGeographic?Iwt:LOe*r;if(this.maxSpan>s)return!0;if(t.altitude>=this.minGlobalAltitude)return this._isVisibleInFrustumGlobal(t)}if(this.maxSpan===0){const s=this.extent[0];return!(i||!t.intersectsRay(Ru(s.origin,s.direction)))}for(let s=0;s<this.extent.length;s++){const a=this.extent[s];if(!i&&t.intersectsRay(Ru(a.origin,a.direction))||t.intersectsLineSegment(uw(a.origin,a.cap.next,Dwt),a.cap.direction))return!0}const n=i?this.planes:this.planesWithoutFar;for(let s=0;s<t.lines.length;s++){const a=t.lines[s];if(wut(n,a.origin,a.endpoint,a.direction))return!0}return!1}_toRenderBoundingExtentGlobal(t,r,i){Ire(t,bf),bf[2]=i,Au(r,bf,eH,this.renderCoordsHelper.spatialReference),Rn(Hge,eH),bi(Sc);for(const{x0:s,x1:a,y0:o,y1:l}of Lwt)for(let c=0;c<5;c++){const u=c/4;bf[0]=Kt(t[s],t[a],u),bf[1]=Kt(t[o],t[l],u),bf[2]=i,Ss(bf,r,bf,this.renderCoordsHelper.spatialReference),ze(bf,bf,Hge),um(Sc,bf)}ne(this.extent[0].origin,Sc[0],Sc[1],Sc[2]),ne(this.extent[1].origin,Sc[3],Sc[1],Sc[2]),ne(this.extent[2].origin,Sc[3],Sc[4],Sc[2]),ne(this.extent[3].origin,Sc[0],Sc[4],Sc[2]);for(let s=0;s<4;++s)ze(this.extent[s].origin,this.extent[s].origin,eH)}_toRenderBoundingExtentLocal(t,r,i){zV(t,r,Xm,this.renderCoordsHelper.spatialReference),ne(this.extent[0].origin,Xm[0],Xm[1],i),ne(this.extent[1].origin,Xm[2],Xm[1],i),ne(this.extent[2].origin,Xm[2],Xm[3],i),ne(this.extent[3].origin,Xm[0],Xm[3],i)}_toRenderBoundingExtent(t,r,i){switch(this.renderCoordsHelper.viewingMode){case Be.Global:this._toRenderBoundingExtentGlobal(t,r,i);break;case Be.Local:this._toRenderBoundingExtentLocal(t,r,i);break;default:this.renderCoordsHelper.viewingMode}}_isVisibleInFrustumGlobal(t){if(di(t.planes[ci.NEAR],this.center.origin)<0&&Se(this.center.direction,t.direction)<0)return!0;for(let r=0;r<4;r++){const i=this.extent[r];if(di(t.planes[ci.NEAR],i.origin)<0&&Se(i.direction,t.direction)<0)return!0}return!1}}const Lwt=[{x0:0,y0:1,x1:2,y1:1},{x0:0,y0:3,x1:2,y1:3},{x0:0,y0:1,x1:0,y1:3},{x0:2,y0:1,x1:2,y1:3}],bf=M(),eH=Ae(),Hge=Ae(),Sc=is(),Xm=zt(),Dwt=Om();class Fwt{constructor(t){this.renderCoordsHelper=t,this.surfaceElevation=0,this.cache=new Map,this.frustum=new Y1(t),this.extendedFrustum=new Y1(t),this.intersector=new $wt({renderCoordsHelper:t}),this.renderCoordsHelper=t}begin(t,r){this.surfaceElevation=r,this.aboveGround=this.renderCoordsHelper.getAltitude(t.eye)>r,this.frustum.update(t),this._shortenFrustumFarPlane(this.frustum),this._updateExtendedFrustum(t)}end(){this.cache.clear()}calculate(t){if(this.allTilesInvisible)return Eo.INVISIBLE;const r=this.renderCoordsHelper.viewingMode===Be.Global&&t.lij[0]>=Nwt&&t.lij[0]<kwt,i=this._getOrCalculateSingleTileVisibility(t,!r);return i!==Eo.INVISIBLE&&r?this._calculateAggregatedChildrenVisibility(t):i}_shortenFrustumFarPlane(t){const r=Y1.nearFarLineIndices,i=t.mutablePoints;for(const n of r){const[s,a]=n,o=i[s],l=i[a];pe(Cd,l,o),le(Cd,Cd,zwt),he(i[a],o,Cd)}t.updatePoints(i)}_calculateAggregatedChildrenVisibility(t){let r=Eo.INVISIBLE;const i=this.cache.get(t.id);if(i!=null)return i;const n=Zge.acquire();t.getChildren(n);for(const s of n){const a=this.calculate(s);if(a!==Eo.INVISIBLE&&(r=a,a===Eo.VISIBLE_ON_SURFACE))break}return Zge.release(n),this.cache.set(t.id,r),r}_getOrCalculateSingleTileVisibility(t,r){const i=this.cache.get(t.id);if(i!=null)return i;const n=this._calculateSingleTileVisibility(t);return r&&this.cache.set(t.id,n),n}_calculateSingleTileVisibility(t){return!this.aboveGround&&this.renderCoordsHelper.viewingMode===Be.Global&&t.lij[0]<Vwt?this._calculateSingleTileVisibilitySided(t,!1)===Eo.INVISIBLE?this._calculateSingleTileVisibilitySided(t,!0):void 0:this._calculateSingleTileVisibilitySided(t,this.aboveGround)}_calculateSingleTileVisibilitySided(t,r){this.intersector.update(t.extent,t.tilingScheme.spatialReference,this.surfaceElevation,r);const i=Ar(t.tilingScheme.spatialReference).radius;return this.intersector.isVisibleInFrustum(this.extendedFrustum,i)?this.intersector.isVisibleInFrustum(this.frustum,i,!0)?Eo.VISIBLE_ON_SURFACE:Eo.VISIBLE_WHEN_EXTENDED:Eo.INVISIBLE}_updateExtendedFrustum(t){this.extendedFrustum.update(t),this._shortenFrustumFarPlane(this.extendedFrustum);const r=this.renderCoordsHelper.worldUpAtPosition(t.eye,Cd);this.aboveGround||Io(r,r);const i=Rs(-Se(r,t.viewForward));if(this.allTilesInvisible=i>(Math.PI+t.fovY)/2,this.allTilesInvisible||(this.hasExtendedFrustum=i>t.fovY/2,!this.hasExtendedFrustum))return;const n=this._extendedFrustumParameters(),s=this.extendedFrustum.mutablePoints;for(let a=0;a<4;a++){const o=n.pointIndices[a],l=s[o],c=this.renderCoordsHelper.getAltitude(l);if(n.needsAltitudeAdjustment(c)){switch(this.renderCoordsHelper.worldUpAtPosition(l,Cd),o){case et.FAR_BOTTOM_LEFT:case et.FAR_TOP_LEFT:case et.NEAR_BOTTOM_LEFT:case et.NEAR_TOP_LEFT:uZ(this.extendedFrustum.planes[ci.LEFT],Cd,Cd);break;case et.FAR_BOTTOM_RIGHT:case et.FAR_TOP_RIGHT:case et.NEAR_BOTTOM_RIGHT:case et.NEAR_TOP_RIGHT:uZ(this.extendedFrustum.planes[ci.RIGHT],Cd,Cd)}le(Cd,Cd,n.direction),this.renderCoordsHelper.intersectInfiniteManifold(Ru(l,Cd),n.zWithMargin,l)}}if(this.extendedFrustum.updatePoints(s),Ao(s[et.NEAR_BOTTOM_LEFT],s[et.NEAR_BOTTOM_RIGHT],s[et.NEAR_TOP_RIGHT],Xge),Ao(s[et.NEAR_BOTTOM_RIGHT],s[et.NEAR_TOP_RIGHT],s[et.NEAR_TOP_LEFT],Yge),Se(Xge,Yge)<0){const a=this.extendedFrustum.mutablePoints;this.aboveGround?[a[et.NEAR_BOTTOM_LEFT],a[et.NEAR_BOTTOM_RIGHT]]=[a[et.NEAR_BOTTOM_RIGHT],a[et.NEAR_BOTTOM_LEFT]]:[a[et.NEAR_TOP_LEFT],a[et.NEAR_TOP_RIGHT]]=[a[et.NEAR_TOP_RIGHT],a[et.NEAR_TOP_LEFT]],this.extendedFrustum.updatePoints(a)}}_extendedFrustumParameters(){return this.aboveGround?this._extendedFrustumParametersAboveSurface():this._extendedFrustumParametersBelowSurface()}_extendedFrustumParametersAboveSurface(){const t=this.surfaceElevation-Wge;return{zWithMargin:t,pointIndices:Y1.planePointIndices.bottom,direction:-1,needsAltitudeAdjustment:r=>r>t}}_extendedFrustumParametersBelowSurface(){const t=this.surfaceElevation+Wge;return{zWithMargin:t,pointIndices:Y1.planePointIndices.top,direction:1,needsAltitudeAdjustment:r=>r<t}}}const Nwt=2,kwt=6,Vwt=12,zwt=.95,Wge=1,Cd=M(),Xge=Er(),Yge=Er(),Zge=new Fn(Array,e=>{e.length!==4&&(e[0]=new lp,e[1]=new lp,e[2]=new lp,e[3]=new lp)},e=>{e[0].release(),e[1].release(),e[2].release(),e[3].release()});class Uwt{constructor(t){this.camera=new ni,this.focusOnMap=[0,0],this.screenRect=zt(),this.tileSize=t.tileSize,this.renderCoordsHelper=t.renderCoordsHelper,this.tilingScheme=t.tilingScheme,this.visibility=new Fwt(t.renderCoordsHelper)}begin(t,r,i){this.camera.copyFrom(t),this.surfaceElevation=i,this.focusOnMap[0]=r.x,this.focusOnMap[1]=r.y,Pre(0,0,t.fullWidth,t.fullHeight,this.screenRect),this.visibility.begin(this.camera,i)}end(){this.visibility.end()}updateTile(t){t.measures.visibility=this.visibility.calculate(t),t.measures.distance=pBe(t.extent,this.focusOnMap),t.measures.visibility!==Eo.INVISIBLE&&this._updateScreenMeasure(t)}_updateScreenMeasure(t){const r=Bwt,i=1<<r,n=t.measures.screenRect;Eu(n);let s=0;const a=t.lij[0]+r,o=t.lij[1]<<r,l=t.lij[2]<<r,c=this._tileSizeWithBias(t),u=c*c;for(let h=0;h<i;h++)for(let p=0;p<i;p++)if(s+=this._computeScreenArea(t,a,o+h,l+p,n),s>u)return void(t.measures.shouldSplit=!0);t.measures.shouldSplit=!1}_tileSizeWithBias(t){return t.measures.visibility===Eo.VISIBLE_WHEN_EXTENDED?this.tileSize*Gwt:this.tileSize}_computeScreenArea(t,r,i,n,s){const a=t.measures.visibility===Eo.VISIBLE_WHEN_EXTENDED;this._projectToScreen(r,i,n,a,Rb),Eu(tH);for(let o=0;o<4;o++)Y4(tH,Rb[o]);return nw(s,tH,s),Ope(Rb[0],Rb[1],Rb[2])+Ope(Rb[0],Rb[2],Rb[3])}_projectToScreen(t,r,i,n,s){this.tilingScheme.ensureMaxLod(t),this.tilingScheme.getExtent(t,r,i,P8),this._toRenderCoords(P8,0,3,Ob[0]),this._toRenderCoords(P8,2,3,Ob[1]),this._toRenderCoords(P8,2,1,Ob[2]),this._toRenderCoords(P8,0,1,Ob[3]),n&&(this._projectToPlane(Ob,this.camera.frustum[ci.NEAR]),this._projectToPlane(Ob,this.camera.frustum[ci.TOP]),this._projectToPlane(Ob,this.camera.frustum[ci.BOTTOM]));for(let a=0;a<4;a++)this.camera.projectToRenderScreen(Ob[a],Qge),this.camera.renderToScreen(Qge,s[a])}_projectToPlane(t,r){for(let n=0;n<4;n++)$8[n]=di(r,t[n]);const i=Math.max($8[0],$8[1],$8[2],$8[3]);if(i>0){const n=le(I8,r,-i);for(let s=0;s<4;s++)he(t[s],t[s],n)}}_toRenderCoords(t,r,i,n){return I8[0]=t[r],I8[1]=t[i],I8[2]=this.surfaceElevation,this.renderCoordsHelper.toRenderCoords(I8,this.tilingScheme.spatialReference,n),n}}const tH=zt(),Bwt=2,Gwt=5,Rb=[tn(),tn(),tn(),tn()],P8=zt(),I8=M(),Ob=[M(),M(),M(),M()],$8=[0,0,0,0],Qge=ro();function QLt(e,t,r){if(R(e)||R(r))return!1;let i=!0;return hs[0]=e.xmin!=null?e.xmin:0,hs[1]=e.ymin!=null?e.ymin:0,hs[2]=e.zmin!=null?e.zmin:0,i=i&&mi(hs,e.spatialReference,0,t,r,0,1),hs[0]=e.xmax!=null?e.xmax:0,hs[1]=e.ymax!=null?e.ymax:0,hs[2]=e.zmax!=null?e.zmax:0,i=i&&mi(hs,e.spatialReference,0,t,r,3,1),e.xmin==null&&(t[0]=-1/0),e.ymin==null&&(t[1]=-1/0),e.zmin==null&&(t[2]=-1/0),e.xmax==null&&(t[3]=1/0),e.ymax==null&&(t[4]=1/0),e.zmax==null&&(t[5]=1/0),i}function DOe(e,t,r){if(R(e)||R(r))return!1;let i=!0;return hs[0]=e.xmin!=null?e.xmin:0,hs[1]=e.ymin!=null?e.ymin:0,hs[2]=e.zmin!=null?e.zmin:0,i=i&&mi(hs,e.spatialReference,0,hs,r,0,1),t[0]=hs[0],t[1]=hs[1],hs[0]=e.xmax!=null?e.xmax:0,hs[1]=e.ymax!=null?e.ymax:0,hs[2]=e.zmax!=null?e.zmax:0,i=i&&mi(hs,e.spatialReference,0,hs,r,0,1),t[2]=hs[0],t[3]=hs[1],e.xmin==null&&(t[0]=-1/0),e.ymin==null&&(t[1]=-1/0),e.xmax==null&&(t[2]=1/0),e.ymax==null&&(t[3]=1/0),i}const hs=M(),jwt=fe.getLogger("esri.views.3d.layers.support.FeatureTileTree3D");let wa=class extends xe{constructor(e){super(e),this.tiles=new lt,this.tileSize=512,this._idToTile=new Map,this._handles=new Ft,this._clients=new Set,this._dirty=!1,this._newTiles=new Qt}get tilingScheme(){const e=this.tilingSchemeOwner.tilingScheme;return e?e.clone():null}set filterExtent(e){if(_(e)&&!e.spatialReference.equals(this.viewState.spatialReference))return void jwt.error("#extent","extent spatial reference needs to be in the same spatial reference as the view");const t=this._get("filterExtent");if(t===e||_(t)&&e&&t.equals(e))return;const r=_(e)?e.clone():null;this._set("filterExtent",r),this._setDirty()}get filterExtentRect(){if(R(this.filterExtent)||!this.tilingScheme)return null;const e=zt();return DOe(this.filterExtent,e,this.tilingScheme.spatialReference),e}get rootTileIds(){return this.filterExtentRect?this.tilingScheme.rootTilesInExtent(this.filterExtentRect):[[0,0,0]]}set suspended(e){e!==this._get("suspended")&&(this._set("suspended",e),this._setDirty())}get updating(){return this._dirty||!!this._pendingTiles}initialize(){this._handles.add([re(()=>[this.tilingScheme,this.tileSize],()=>this._reset(),ti),re(()=>{var e,t,r;return[this.tileSize,(e=this.cameraOnSurface)==null?void 0:e.location,this.tilingScheme,(t=this.viewState)==null?void 0:t.contentCamera,(r=this.focus)==null?void 0:r.location]},()=>this._setDirty(),Yn)]),this.scheduler&&(this._frameWorker=this.scheduler.registerTask(bt.FEATURE_TILE_TREE,this))}destroy(){this._frameWorker=Ts(this._frameWorker),this._handles=ct(this._handles)}addClient(){const e=Hwt();return this._clients.add(e),this._clients.size===1&&this._setDirty(),{remove:()=>this._removeClient(e)}}_removeClient(e){this._clients.delete(e),this._hasClients||this._clear()}get _hasClients(){return this._clients.size>0}_setDirty(){!this._hasClients||this.suspended||this._dirty||(this._frameWorker?(this._dirty=!0,this.notifyChange("updating")):this.runTask(y6))}_clear(){this.tiles.removeAll(),this._idToTile.clear(),this._reset(),this._dirty=!1,this.notifyChange("updating")}get running(){return this.updating}runTask(e){this._dirty=!1,this._pendingTiles||(this._startUpdate(),_(this._frameWorker)&&(this._frameWorker.priority=bt.FEATURE_TILE_TREE_ACTIVE)),this._subdivideTilesForView(e),!this._pendingTiles&&_(this._frameWorker)&&(this._frameWorker.priority=bt.FEATURE_TILE_TREE),this.notifyChange("updating")}_startUpdate(){if(this.suspended)return;if(!this.tilingScheme)return void this._clear();this._tileMeasurements||(this._tileMeasurements=new Uwt({renderCoordsHelper:this.renderCoordsHelper,tilingScheme:this.tilingScheme,tileSize:this.tileSize}));const e=this.viewState.contentCamera;this._tileMeasurements.begin(e,this.focus.location,this.cameraOnSurface.location.z),this._pendingTiles=this._getRootTiles()}_reset(){this._newTiles.clear(),this._tileMeasurements=null,this._pendingTiles=null,this._setDirty()}_getRootTiles(){return this.rootTileIds.map(e=>new lp(e[0],e[1],e[2],this.tilingScheme))}_purgeHorizonTiles(e){e.sort((t,r)=>{const i=t.measures.screenRect,n=r.measures.screenRect;return i[1]+i[3]-(n[1]+n[3])}),Eu(OI);for(let t=0;t<e.length;t++)if(nw(OI,e.data[t].measures.screenRect,OI),$p(OI)>Wwt)return e.data.slice(t,e.length);return[]}_subdivideTilesForView(e){if(this._pendingTiles){for(;this._pendingTiles.length>0&&!e.done;){const t=this._pendingTiles.pop();e.madeProgress(),this.filterExtentRect&&!KR(this.filterExtentRect,t.extent)||(this._tileMeasurements.updateTile(t),t.measures.visibility!==Eo.INVISIBLE&&(t.measures.shouldSplit?(this.tilingScheme.ensureMaxLod(t.lij[0]+1),this._pendingTiles.push(...t.getChildren())):this._newTiles.push(t)))}this._pendingTiles.length===0&&(this._updateTiles(this._purgeHorizonTiles(this._newTiles)),this._newTiles.clear(),this._tileMeasurements.end(),this._pendingTiles=null)}}_updateTiles(e){for(const i of this.tiles.items)i.used=!1;const t=e.filter(i=>{const n=this._idToTile.get(i.id);return n?(n.copyMeasurementsFrom(i),n.used=!0):this._idToTile.set(i.id,i),!n}),r=this.tiles.items.filter(i=>!i.used&&(this._idToTile.delete(i.id),!0));this.tiles.removeMany(r),this.tiles.addMany(t),this._sortTiles()}_sortTiles(){this.viewState.fixedContentCamera||this.tiles.sort((e,t)=>e.measures.visibility!==t.measures.visibility?e.measures.visibility===Eo.VISIBLE_ON_SURFACE?-1:1:e.measures.distance-t.measures.distance),this.tiles.forEach((e,t)=>e.loadPriority=t)}};d([f({constructOnly:!0})],wa.prototype,"scheduler",void 0),d([f({constructOnly:!0})],wa.prototype,"renderCoordsHelper",void 0),d([f({constructOnly:!0})],wa.prototype,"tilingSchemeOwner",void 0),d([f({constructOnly:!0})],wa.prototype,"cameraOnSurface",void 0),d([f({constructOnly:!0})],wa.prototype,"focus",void 0),d([f({constructOnly:!0})],wa.prototype,"viewState",void 0),d([f({constructOnly:!0})],wa.prototype,"terrain",void 0),d([f()],wa.prototype,"tiles",void 0),d([f()],wa.prototype,"tileSize",void 0),d([f({readOnly:!0})],wa.prototype,"tilingScheme",null),d([f()],wa.prototype,"filterExtent",null),d([f({readOnly:!0})],wa.prototype,"filterExtentRect",null),d([f({readOnly:!0})],wa.prototype,"rootTileIds",null),d([f({value:!1})],wa.prototype,"suspended",null),d([f({readOnly:!0})],wa.prototype,"updating",null),wa=d([$("esri.views.3d.layers.support.FeatureTileTree3D")],wa);let qwt=0;function Hwt(){return qwt++}const OI=zt(),Wwt=10;let _a=class extends xe{constructor(){super(...arguments),this._propertiesPool=new Ly({camera:ni},this),this._lastSeenCameraProjectionValues=new ni,this.events=new mn,this.viewingMode=Be.Global,this._cameraChanged=!1,this.updateQueue=new Array,this.processingUpdates=!1}init(e,t){this._set("viewingMode",e),this._set("spatialReference",t),this._set("constraints",new gg({mode:this.viewingMode}))}exit(){this.cameraController=null,this._propertiesPool.destroy(),this._propertiesPool=new Ly({camera:ni},this)}createInitialCamera(){if(this.viewingMode===Be.Global){const e=Ar(this.spatialReference).radius;this.camera=new ni(Ve(4*e,0,0),Ve(e,0,0),Ve(0,0,1))}else this.camera=new ni(Ve(0,0,100),Ve(0,0,0),Ve(0,1,0))}get animation(){return this.cameraController instanceof iR&&_(this.cameraController.viewAnimation)?this.cameraController.viewAnimation:null}get camera(){return this._get("camera")}set camera(e){e!==qu&&qu.copyFrom(e),qu.computeUp(this.viewingMode),Jge.camera=qu,this.events.emit("before-camera-change",Jge);const t=this._get("camera");if(this._cameraProjectionChanged(this._lastSeenCameraProjectionValues,qu)&&(this._lastSeenCameraProjectionValues.copyFrom(qu),Kge.camera=this._lastSeenCameraProjectionValues,this.events.emit("camera-projection-changed",Kge)),(!t||!t.equals(qu))&&(this._set("camera",this._propertiesPool.get("camera").copyFrom(qu)),this._cameraChanged=!t||!t.almostEquals(qu),this._cameraChanged)){const r=r3e(()=>{this._cameraChanged=!1,r.remove()})}}get pixelRatio(){return this.camera.pixelRatio}get contentCamera(){return _(this._contentCamera)?this._contentCamera:this.camera}set contentCamera(e){this._contentCamera=_(e)?e.clone():null}get fixedContentCamera(){return _(this._contentCamera)}get isGlobal(){return this.viewingMode===Be.Global}get isLocal(){return this.viewingMode===Be.Local}get navigating(){return!(!this.cameraController||!this.cameraController.isInteractive)}get stationary(){return!this._cameraChanged&&!this.navigating}get cameraController(){return this._get("cameraController")}set cameraController(e){this.stopActiveCameraController()?(e&&(this.own(re(()=>e.state,t=>{t!==qi.Finished&&t!==qi.Stopped||(this._set("cameraController",null),this.updateCamera(r=>e.onControllerEnd(r)))},ti)),e.onControllerStart(this.camera)),this._set("cameraController",e)):e&&(e.state=qi.Rejected)}switchCameraController(e){return this.cameraController=e,e.state!==qi.Rejected}stopActiveCameraController(){return!(this.cameraController&&!this.cameraController.stopController())}updateCamera(e){this.updateQueue.push(e),this._processUpdateQueue()}_processUpdateQueue(){if(this.updateQueue.length===0||this.processingUpdates)return;this.processingUpdates=!0;const e=this.updateQueue.shift();qu.copyFrom(this._get("camera")),e(qu),this.camera=qu,this.processingUpdates=!1,this._processUpdateQueue()}_cameraProjectionChanged(e,t){return e.fov!==t.fov||e.fullViewport[0]!==t.fullViewport[0]||e.fullViewport[1]!==t.fullViewport[1]||e.fullViewport[2]!==t.fullViewport[2]||e.fullViewport[3]!==t.fullViewport[3]||e.padding[Mt.TOP]!==t.padding[Mt.TOP]||e.padding[Mt.RIGHT]!==t.padding[Mt.RIGHT]||e.padding[Mt.BOTTOM]!==t.padding[Mt.BOTTOM]||e.padding[Mt.LEFT]!==t.padding[Mt.LEFT]}};d([f({readOnly:!0,type:u9})],_a.prototype,"animation",null),d([f({type:ni})],_a.prototype,"camera",null),d([f()],_a.prototype,"pixelRatio",null),d([f({})],_a.prototype,"_contentCamera",void 0),d([f({type:ni})],_a.prototype,"contentCamera",null),d([f({readOnly:!0})],_a.prototype,"fixedContentCamera",null),d([f({readOnly:!0})],_a.prototype,"constraints",void 0),d([f({readOnly:!0})],_a.prototype,"events",void 0),d([f({readOnly:!0})],_a.prototype,"isGlobal",null),d([f({readOnly:!0})],_a.prototype,"isLocal",null),d([f({readOnly:!0})],_a.prototype,"viewingMode",void 0),d([f({readOnly:!0})],_a.prototype,"spatialReference",void 0),d([f({readOnly:!0})],_a.prototype,"navigating",null),d([f({readOnly:!0})],_a.prototype,"stationary",null),d([f()],_a.prototype,"_cameraChanged",void 0),d([f()],_a.prototype,"cameraController",null),_a=d([$("esri.views.3d.state.ViewState")],_a);const Xwt=_a,qu=new ni,Jge={camera:null},Kge={camera:null};function Ywt(e,t,r){return e===Be.Global?new Qwt(r):new Zwt(t,r)}class Zwt{constructor(t,r){this.elevationProvider=t,this._referenceEllipsoid=Ar(r),this.unitInMeters=vc(r,this._referenceEllipsoid.metersPerDegree)}compute(t,r,i,n,s){s||(s={near:0,far:0});let a=t[2]*this.unitInMeters;const o=a,l=a-n,c=this.elevationProvider?this.elevationProvider.elevationBounds:null;c&&(a=l>=0?o-this.unitInMeters*c.min:this.unitInMeters*c.max-o);const u={x:(i=_(i)?i:new Zt({xmin:0,ymin:0,zmin:0,xmax:0,ymax:0,zmax:0})).xmax-i.xmin,y:i.ymax-i.ymin,z:4*Math.max(i.xmax-i.xmin,i.ymax-i.ymin)},h=Math.max(u.x,u.y,u.z);pe(n2,r,t),wT[0]=n2[0]>0?i.xmax:i.xmin,wT[1]=n2[1]>0?i.ymax:i.ymin,wT[2]=n2[2]>0?h/2:-h/2,pe(wT,wT,t),we(n2,n2);const p=1.1*Se(wT,n2)*this.unitInMeters,m=Math.sqrt(a*(a+2*this._referenceEllipsoid.radius)),g=Math.max(i.xmax-i.xmin,i.ymax-i.ymin),b=g*ext*this.unitInMeters,w=g*txt*this.unitInMeters;let v=Le((a-w)/(b-w),0,1);v*=v*v;let x=Kt(m,p,v);return x*=Math.max(Math.log(Math.abs(l)),1),x=Math.min(x,Math.max(34064e4,h)),x/=this.unitInMeters,FOe(x,Jwt,this.unitInMeters,s)}}class Qwt{constructor(t){this._referenceEllipsoid=Ar(t)}compute(t,r,i,n,s){s||(s={near:0,far:0});const a=Oe(t)-this._referenceEllipsoid.radius,o=this._referenceEllipsoid.radius+Math.min(0,n),l=Math.abs(a-n),c=Math.max(l,Math.abs(a));return FOe(1.2*Math.sqrt(c*(c+2*o)),Le(2e4-(Math.log(c)-7.983)/9.011*19e3,1e3,2e4),1,s)}}function FOe(e,t,r,i){const n=Kwt/r;return e/t>n?(i.far=e,i.near=i.far/t):(i.near=n,i.far=i.near*t),i}const Jwt=2e4,Kwt=2,ext=.001,txt=1e-4,wT=M(),n2=M();let bD=class extends xe{constructor(e){super(e),this.handles=new Ft}initialize(){this.handles.add(this.view.basemapTerrain.on("elevation-change",e=>this._handleElevationChangeEvent(e)))}destroy(){this.handles&&(this.handles.destroy(),this.handles=null)}_handleElevationChangeEvent(e){if(this.view.state.cameraController)return;const t=this.view.state.camera;RCe(this.view,t,e.extent,e.spatialReference)&&this._applyToCurrentCamera()}_applyToCurrentCamera(){this.view.state.updateCamera(e=>{_6(this.view,e,kh.EYE_AND_CENTER)})}};d([f({constructOnly:!0})],bD.prototype,"view",void 0),bD=d([$("esri.views.3d.state.ElevationCollisionConstraint")],bD);let cC=class extends xe{constructor(e){super(e),this._handles=new Ft,this.nearFarHeuristic=Ywt(e.view.state.viewingMode,e.view.basemapTerrain,e.view.renderCoordsHelper.spatialReference)}initialize(){this._handles.add([re(()=>{var e,t,r,i;return[(t=(e=this.view.constraints)==null?void 0:e.clipDistance)==null?void 0:t.near,(i=(r=this.view.constraints)==null?void 0:r.clipDistance)==null?void 0:i.far]},()=>this._clipDistanceNearFarChanged()),re(()=>{var e,t;return(t=(e=this.view.constraints)==null?void 0:e.clipDistance)==null?void 0:t.mode},()=>this._updateNearFar()),this.view.state.events.on("before-camera-change",e=>this._updateCameraNearFar(e.camera)),re(()=>this.view.renderDataExtent,()=>this._updateNearFar(),ti),re(()=>{var e,t,r,i;return[(t=(e=this.view.constraints)==null?void 0:e.altitude)==null?void 0:t.min,(i=(r=this.view.constraints)==null?void 0:r.altitude)==null?void 0:i.max]},()=>this._updateAltitude(),ti),re(()=>{var e,t;return(t=(e=this.view.constraints)==null?void 0:e.tilt)==null?void 0:t.max},()=>this._updateTiltMax(),ti),re(()=>{var e,t;return(t=(e=this.view.constraints)==null?void 0:e.tilt)==null?void 0:t.mode},()=>this._updateTilt(),ti),re(()=>{var e;return(e=this.view.state)==null?void 0:e.camera},()=>this._updateTiltAutoMax(),ti),re(()=>{var e,t,r,i,n,s;return[(r=(t=(e=this.view.map)==null?void 0:e.ground)==null?void 0:t.navigationConstraint)==null?void 0:r.type,(s=(n=(i=this.view.state)==null?void 0:i.constraints)==null?void 0:n.collision)==null?void 0:s.enabled]},()=>this._updateCollision(),ti)]),this.view.state.isLocal&&this._handles.add(re(()=>this.view.renderDataExtent,e=>this._updateLocalSurfaceDistance(e),Ot)),this._updateNearFar(),this.view.state.viewingMode!==Be.Local&&this._updateAltitude(),this._updateTilt(),this._updateCollision(),this._set("surfaceCollisionConstraint",new bD({view:this.view}))}destroy(){this._handles=ct(this._handles),this.surfaceCollisionConstraint&&(this.surfaceCollisionConstraint.destroy(),this._set("surfaceCollisionConstraint",null))}_clipDistanceNearFarChanged(){var t;const e=(t=this.view.constraints)==null?void 0:t.clipDistance;e&&e.mode!=="auto"&&this.view.state.updateCamera(r=>(this._updateCameraNearFarManual(r,e),!0))}_updateNearFar(){this.view.state.updateCamera(e=>(this._updateCameraNearFar(e),!0))}_updateCameraNearFar(e){const t=this.view.constraints&&this.view.constraints.clipDistance;(t?t.mode:"auto")==="manual"?this._updateCameraNearFarManual(e,t):this._updateCameraNearFarAuto(e,t)}_updateCameraNearFarAuto(e,t){this.nearFarHeuristic.compute(e.eye,e.center,this.view.renderDataExtent,Uz(this.view,e.eye),e),t&&t.autoUpdate(e.near,e.far)}_updateCameraNearFarManual(e,t){t&&(e.near=t.near,e.far=t.far)}_updateCollision(){var i,n,s;const e=(s=(n=(i=this.view.map)==null?void 0:i.ground)==null?void 0:n.navigationConstraint)==null?void 0:s.type,t=!e||e==="stay-above",r=this.view.state.constraints.collision;if(t!==r.enabled){r.enabled=t,t&&this._reapplyConstraints(Ti.COLLISION);const a=this.view.constraints&&this.view.constraints.tilt;a&&a.mode!=="auto"||this._updateTiltAuto()}}_updateAltitude(){const e=this.view.constraints&&this.view.constraints.altitude;e&&this.view.state.viewingMode!==Be.Local?this.view.state.constraints.altitude={min:e.min,max:e.max}:this.view.state.constraints.altitude=null,this._reapplyConstraints()}_updateTiltMax(){const e=this.view.constraints&&this.view.constraints.tilt;e&&e.mode!=="auto"&&(this._updateTiltManual(e),this._reapplyConstraints())}_updateTilt(){const e=this.view.constraints&&this.view.constraints.tilt;(e?e.mode:"auto")==="manual"?this._updateTiltManual(e):this._updateTiltAuto(),this._reapplyConstraints()}_updateTiltManual(e){const t=this.view.state.constraints;t.tilt=t.createConstantMaxTilt(kt(e.max))}_updateTiltAuto(){const e=this.view.state.constraints;e.tilt=e.createDefaultTilt(),this._updateTiltAutoMax()}_updateTiltAutoMax(){const e=this.view.constraints&&this.view.constraints.tilt;if(!e||e.mode!=="auto")return;const t=this.view.state.constraints;if(t.tilt){const r=t.tilt(this.view.state.camera.distance).max;e.autoUpdate(md(r))}}_updateLocalSurfaceDistance(e){if(R(e))return;let t=Math.max(e.width,e.height);if(t<=0)return;e.hasZ&&(t=Math.max(t,e.zmax-e.zmin));const r=this.view.state,i=3*t/Math.atan(r.camera.fov/2);i!==r.constraints.distance&&(r.constraints.distance=i)}_reapplyConstraints(e=Ti.ALL){this.view.state.updateCamera(t=>En(this.view,t,{selection:e,interactionType:Ht.NONE,interactionFactor:null,interactionStartCamera:null,interactionDirection:null,tiltMode:aa.TUMBLE}))}};d([f({constructOnly:!0})],cC.prototype,"view",void 0),d([f({readOnly:!0})],cC.prototype,"surfaceCollisionConstraint",void 0),cC=d([$("esri.views.3d.state.ConstraintsManager")],cC);let M4=class extends W3{constructor(e){super(e),this.handles=new Ft}set desiredCamera(e){this._set("desiredCamera",e.clone())}get canStop(){return!0}get constraintEnabled(){return this.view.state.constraints.collision.enabled}onControllerStart(){this.state=qi.Running,this.handles.add(this.view.basemapTerrain.on("elevation-change",e=>this._handleElevationChangeEvent(e))),this._applyCorrection()}onControllerEnd(){this.handles.removeAll()}stepController(){}_handleElevationChangeEvent(e){RCe(this.view,this.desiredCamera,e.extent,e.spatialReference)&&this._applyCorrection()}_applyCorrection(){this.view.state.updateCamera(e=>{e.copyViewFrom(this.desiredCamera),_6(this.view,e,kh.EYE_AND_CENTER)||this.constraintEnabled||(this.state=qi.Stopped)})}};d([f({constructOnly:!0})],M4.prototype,"view",void 0),d([f({constructOnly:!0})],M4.prototype,"desiredCamera",null),M4=d([$("esri.views.3d.state.controllers.SurfaceCollisionCorrectionController")],M4);const rxt=.66;function NOe(e){return 360-xre.normalize(e)}function LU(e){return xre.normalize(360-e)}function MI(e){return _(e)&&e.resolver&&e.resolver.reject(),null}function ixt(e,t){return _(e)&&e.resolver&&e.resolver.resolve(t),t}function kOe(e,t,r,i=null){if(!t)return MI(i);const n=e.spatialReference||Ye.WGS84;if(_(t.camera)){const c=mx(t.camera.position,n);if(R(c))return MI(i);const u=t.camera.clone();return u.position=c,ixt(i,u)}if(R(t.targetGeometry))return MI(i);const s=t.get("targetGeometry.spatialReference");if(s&&!Ov(s,n))return MI(i);const a=A9(e,e.state.camera);let o=so.ADJUST;if(t.rotation!=null&&(a.heading=NOe(t.rotation),o=so.LOCKED),r!=null&&(a.tilt=r),t.targetGeometry.type==="point"){const c=t.targetGeometry;let u;const h=t.targetGeometry.clone();return u=t.scale!=null?qse(e,t.scale,c.latitude):e.state.camera.distance,_7e(e,h,u,a,o,i)}const l=t.targetGeometry.extent;return h7(e,l,a.heading,a.tilt,o,i)}function nxt(e,t,r=null){return R(r)&&(r=new Yh),Fae(e,null,t.clone(),r)}async function sxt(e,t,r){const i=mxt(e,t);if(!i)throw new k("viewpointutils-create:no-target","Missing target for creating viewpoint");const n=new gd({fov:e.camera.fov}),s=new Yh({camera:n});if(i.target instanceof Yh)return s2(await lxt(e,i.target,i,r,s));if(i.target instanceof gd)return s2(zOe(e,i.target,s));const a=i.scale!=null||i.zoom!=null;if(i.target instanceof Zt){const c=i.target.xmin===i.target.xmax||i.target.ymin===i.target.ymax;return s2(a||c?await vK(e,i,i.target.center,n,r,s):await hxt(e,i,i.target,n,r,s))}const o={boundingBox:bi(),hasZ:!1,screenSpaceObjects:[]},l=a?axt(e,i):void 0;if(await VOe(e,i.target,l,o),isFinite(o.boundingBox[0])){let c;if(fp(o.boundingBox,Sn),Jd.x=Sn[0],Jd.y=Sn[1],Jd.z=Sn[2],Jd.spatialReference=e.spatialReference,isFinite(Jd.z)&&o.hasZ?c=SV(o.boundingBox):(Jd.z=void 0,c=mBe(Dre(o.boundingBox,yxt))),a||c)return s2(await vK(e,i,Jd,n,r,s));const u=gxt(e,o.screenSpaceObjects);return s2(await pxt(e,i,Jd,o.boundingBox,u,n,r,s))}return i.position?s2(dxt(e,i,n,s)):s2(await uxt(e,i,n,r,s))}function Lae(e,t){return t.scale==null&&t.zoom!=null?T7e(e,t.zoom):t.scale}function axt(e,t){return _pt(e,Lae(e,t))}function Dae(e,t){let r=!1;return t.heading!=null?(e.heading=t.heading,r=!0):t.rotation!=null&&(e.heading=NOe(t.rotation),r=!0),t.tilt!=null&&(e.tilt=t.tilt,r=!0),t.fov!=null&&(e.fov=t.fov),r}function Fae(e,t,r,i){const n=e.spatialReference||Ye.WGS84;return t=_(t)?t:Fg(e,r),R(t)||(i.targetGeometry=Yv(t.center,e.renderSpatialReference,n),i.scale=S7e(e,t),i.rotation=LU(r.heading),i.camera=r),i}function xk(e,t,r){if(!t)return;if(!Ov(t.spatialReference,e.spatialReference))throw new k("viewpointutils:incompatible-spatialreference",`Spatial reference (${t.spatialReference?t.spatialReference.wkid:"unknown"}) is incompatible with the view (${e.spatialReference.wkid})`,{geometry:t});const i=[];if(!t.hasZ&&e.basemapTerrain){let a;switch(t.type){case"point":a=t;break;case"multipoint":case"polyline":a=t.extent.center;break;case"mesh":a=t.origin;break;case"extent":a=t.center;break;case"polygon":a=t.centroid}a&&Ov(a,e.basemapTerrain.spatialReference)?Sn[2]=vt(Q0(e.elevationProvider,a),0):Sn[2]=0}(0,bxt[t.type])(t,a=>{i.push(a[0],a[1],a[2])},Sn);const n=i.length/3;if(n===0)return;const s=new Array(i.length);if(mi(i,t.spatialReference,0,s,e.spatialReference,0,n)){t.hasZ&&(r.hasZ=!0);for(let a=0;a<s.length;a+=3)t.hasZ?(Sn[0]=s[a+0],Sn[1]=s[a+1],Sn[2]=s[a+2]):(Sn[0]=s[a+0],Sn[1]=s[a+1]),um(r.boundingBox,Sn)}}async function oxt(e,t,r,i){const n=await Tu(e.whenViewForGraphic(t));if(n.ok===!1||R(n.value)||!("whenGraphicBounds"in n.value))return void xk(e,t.geometry,i);const s=n.value,a=await Tu(s.whenGraphicBounds(t,{minDemResolution:r}));if(a.ok===!1)return void xk(e,t.geometry,i);const{screenSpaceObjects:o,boundingBox:l}=a.value;H5(i.boundingBox,l),o&&o.forEach(c=>{i.screenSpaceObjects.push(c)}),isFinite(l[2])&&(i.hasZ=!0)}async function VOe(e,t,r,i){if(Array.isArray(t)&&t.length===2){const n=t[0],s=t[1];if(typeof n=="number"&&typeof s=="number")return Jd.x=n,Jd.y=s,Jd.z=void 0,Jd.spatialReference=e.spatialReference.isGeographic?e.spatialReference:Ye.WGS84,void xk(e,Jd,i)}t&&typeof t.map=="function"?await dn(t.map(n=>VOe(e,n,r,i))):t instanceof fd?xk(e,t,i):t instanceof co&&await oxt(e,t,r,i)}async function lxt(e,t,r,i,n){if(_(t.camera))return zOe(e,t.camera,n);n.scale=t.scale,n.rotation=t.rotation,n.targetGeometry=_(t.targetGeometry)?t.targetGeometry.clone():null,n.camera=null,r.heading!=null?n.rotation=LU(r.heading):r.rotation!=null&&(n.rotation=r.rotation);const s=Lae(e,r);s!=null&&(n.scale=s);const a=new T6(i);return kOe(e,n,r.tilt,a),n.camera=await a.resolver.promise,n}function zOe(e,t,r){const i=e.spatialReference,n=mx(t.position,i);return R(n)?null:((t=t.clone()).fov=e.camera.fov,t.position=n,Fae(e,null,t,r))}function cxt(e,t,r,i,n,s){const a=e.renderSpatialReference;return oa(r.position,II,a),oa(t,rH,a),s.targetGeometry=new ot(t),n.position=new ot(r.position),pe(Tk,rH,II),jz(e,II,Tk,i.up,n),s.scale=ix(e,fi(II,rH),s.targetGeometry.latitude),s.rotation=LU(n.heading),s.camera=n,s}async function vK(e,t,r,i,n,s){if(R(r))throw new k("createfromcenter","invalid point");s.targetGeometry=r.clone();const a=$x(e);if(t.position)return cxt(e,s.targetGeometry,t,a,i,s);if(t.zoomFactor){const l=a.distance/t.zoomFactor,c=le(Sn,a.viewForward,-l);a.eye=he(Sn,a.center,c),s.scale=ix(e,l,r.latitude)}A9(e,a,i);const o=Dae(i,t)?so.LOCKED:so.ADJUST;if(!t.zoomFactor){s.scale=Lae(e,t),s.scale==null&&(oa(r,Sn,e.renderSpatialReference),BCe(a.frustum,Sn)?s.scale=ix(e,fi(a.eye,Sn),r.latitude):s.scale=S7e(e,a));const l=new T6(n);v7e(e,s.targetGeometry,s.scale,i,o,l),s.camera=await l.resolver.promise}return s}function dxt(e,t,r,i){const n=$x(e);return oe(Tk,n.viewForward),jz(e,n.eye,Tk,n.up,iH),r.position=new ot(t.position),r.heading=t.heading!=null?t.heading:iH.heading,r.tilt=t.tilt!=null?t.tilt:iH.tilt,Fae(e,null,r,i)}async function uxt(e,t,r,i,n){const s=$x(e);return vK(e,t,Yv(s.center,e.renderSpatialReference,e.spatialReference),r,i,n)}async function hxt(e,t,r,i,n,s){s.targetGeometry=r.clone();const a=$x(e);A9(e,a,i);const o=Dae(i,t)?so.LOCKED:so.ADJUST,l=new T6(n);return h7(e,r,i.heading,i.tilt,o,l),s.camera=await l.resolver.promise,s}function fxt(e,t,r,i,n){let s=0;r.hasZ?s=r.z:e.basemapTerrain&&(s=Q0(e.elevationProvider,r)),ne(Sn,r.x,r.y,s),Au(e.spatialReference,Sn,eye,e.renderSpatialReference),Jh(PI,eye),Kh(PI,PI),bi(L8);const a=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]];for(let g=0;g<a.length;g++){const b=a[g];let w=i[b[2]];isFinite(w)||(w=s),ne(Sn,i[b[0]],i[b[1]],w),Ss(Sn,e.spatialReference,Sn,e.renderSpatialReference),um(L8,ed(Sn,Sn,PI))}const o=wx(L8),l=g_(L8),c=xx(L8),u=1/Math.tan(t.fovX/2),h=1/Math.tan(t.fovY/2),p=.5*Math.sqrt(o*o+c*c)*Math.max(h,u)+.5*l,m=.5*l*h+.5*Math.max(o,c);return Math.max(p,m)/n}async function pxt(e,t,r,i,n,s,a,o){o.targetGeometry=r.clone();const l=$x(e),c=fxt(e,l,r,i,n);A9(e,l,s);const u=Dae(s,t)?so.LOCKED:so.ADJUST;o.scale=ix(e,c,o.targetGeometry.latitude);const h=new T6(a);return v7e(e,o.targetGeometry,o.scale,s,u,h),o.camera=await h.resolver.promise,o}function mxt(e,t){if(!t||!e.spatialReference)return null;const r={target:null};if("declaredClass"in t||Array.isArray(t))r.target=t;else{for(const i in t)r[i]=t[i];t.center&&!r.target&&(r.target=t.center)}return r}function s2(e){return e&&_(e.camera)&&(e.rotation=LU(e.camera.heading)),e}function gxt(e,t){const r=rxt;if(!t.length)return r;let i=Number.NEGATIVE_INFINITY;for(let n=0;n<t.length;n++){const s=t[n].screenSpaceBoundingRect;i=Math.max(i,Math.abs(s[0]),Math.abs(s[1]),Math.abs(s[2]),Math.abs(s[3]))}return r-i/Math.min(e.width,e.height)*2}const Sn=M(),eye=Ae(),PI=Li(),L8=is(),yxt=zt(),Tk=M(),II=M(),rH=M(),iH={heading:0,tilt:0},Jd=new ot,bxt={point(e,t,r){r[0]=e.x,r[1]=e.y,e.hasZ&&(r[2]=e.z),t(r)},polygon(e,t,r){const i=e.hasZ;for(let n=0;n<e.rings.length;n++){const s=e.rings[n];for(let a=0;a<s.length;a++)r[0]=s[a][0],r[1]=s[a][1],i&&(r[2]=s[a][2]),t(r)}},polyline(e,t,r){const i=e.hasZ;for(let n=0;n<e.paths.length;n++){const s=e.paths[n];for(let a=0;a<s.length;a++)r[0]=s[a][0],r[1]=s[a][1],i&&(r[2]=s[a][2]),t(r)}},multipoint(e,t,r){const i=e.points,n=e.hasZ;for(let s=0;s<i.length;s++)r[0]=i[s][0],r[1]=i[s][1],n&&(r[2]=i[s][2]),t(r)},extent(e,t,r){e.hasZ?(t(ne(r,e.xmin,e.ymin,e.zmin)),t(ne(r,e.xmax,e.ymin,e.zmin)),t(ne(r,e.xmin,e.ymax,e.zmin)),t(ne(r,e.xmax,e.ymax,e.zmin)),t(ne(r,e.xmin,e.ymin,e.zmax)),t(ne(r,e.xmax,e.ymin,e.zmax)),t(ne(r,e.xmin,e.ymax,e.zmax)),t(ne(r,e.xmax,e.ymax,e.zmax))):(t(ne(r,e.xmin,e.ymin,r[2])),t(ne(r,e.xmax,e.ymin,r[2])),t(ne(r,e.xmin,e.ymax,r[2])),t(ne(r,e.xmax,e.ymax,r[2])))},mesh(e,t,r){const i=e.vertexAttributes&&e.vertexAttributes.position;if(i)for(let n=0;n<i.length;n+=3)t(ne(r,i[n+0],i[n+1],i[n+2]))}};class vxt{constructor(t,r,i){this.target=t,this.options=r,this.view=i,this.state="pending",this.abortController=null,this.animationController=null,this.promise=new Promise((n,s)=>{this.resolveCallback=n,this.rejectCallback=s;const a=new AbortController;_(this.options.signal)&&Fo(this.options.signal,()=>{this.abort()}),this.abortController=a,this.waitForReady()})}then(t,r){return this.promise.then(t,r)}catch(t){return this.promise.catch(t)}resolve(t){return this.state="finished",this.resolveCallback(t)}reject(t){return this.state="finished",this.rejectCallback(t)}abort(t=!1){switch(this.state){case"pending":case"wait-for-ready":case"wait-for-viewpoint":this.reject(br());break;case"wait-for-animation-finish":!t&&_(this.animationController)&&this.view.state.cameraController===this.animationController&&this.animationController.active&&this.animationController.stopController(),this.reject(br())}}async waitForReady(){if(this.state="wait-for-ready",!this.view.ready)try{await td(()=>this.view.ready,this.abortController.signal)}catch(t){return this.reject(t)}this.createViewPoint()}createViewPoint(){this.state!=="finished"&&(this.state="wait-for-viewpoint",this.animationController=this.options.animate?this._getAnimationController():null,sxt(this.view,this.target,this.abortController.signal).then(t=>{if(this.state==="finished")return;const r=this._getCameraFromViewpoint(t);if(!R(r))if(this.options.animate){if(R(this.animationController))return;this.startAnimation(r,this.animationController)}else this.view.stateManager.setStateCamera(r.camera,{applyConstraints:!r.isFullySpecified,positionAndOrientationOnly:!0,doNotCancelGoToOperation:!0}),this.resolve()},t=>{this.reject(t)}))}_getCameraFromViewpoint(t){const r=!!(this.target instanceof Yh&&this.target.camera||this.target instanceof gd),i=t.camera;if(R(i))return null;if(!this.view.stateManager.isCompatible(i)){const s=i.position,a=s&&s.spatialReference,o=a?a.wkid:"none",l=this.view.spatialReference.wkid;return this.reject(new k("GotoAnimation:incompatible-spatialreference",`Resulting camera has an incompatible spatial reference (camera: ${o}, view: ${l})`,{camera:i})),null}const n=Fg(this.view,i);return R(n)?(this.reject(new k("GotoAnimation:invalid-camera","Resulting camera is invalid")),null):{viewpoint:t,camera:n,isFullySpecified:r}}startAnimation(t,r){this.state="wait-for-animation-finish";const i=r.viewAnimation;if(R(i))return void this.reject(new k("GotoAnimation:missing-animation","Unreachable code in view.stateManager"));if(i.update(t.viewpoint,"running"),!r.active||R(r.viewAnimation)||r.viewAnimation.target!==t.viewpoint||this.view.state.cameraController!==r)return this.abort();let n;t.isFullySpecified?(n=new M4({view:this.view,desiredCamera:t.camera}),_6(this.view,t.camera,kh.EYE_AND_CENTER)):En(this.view,t.camera),r.begin(t.camera,this.options);const s=()=>{const o=this.view.state.cameraController;n&&(o&&o.active?o instanceof ty&&_(o.viewAnimation)&&o.viewAnimation.target===t.viewpoint&&(this.view.state.cameraController=n):_(r.viewAnimation)&&r.viewAnimation.target===t.viewpoint&&r.state==="finished"&&(this.view.state.cameraController=n))},a=o=>{if(!R(this.view.state))switch(r.state){case qi.Finished:switch(this.state){case"pending":case"wait-for-ready":case"wait-for-viewpoint":case"wait-for-animation-finish":this.resolve()}break;case qi.Ready:case qi.Rejected:case qi.Running:case qi.Stopped:switch(this.state){case"pending":case"wait-for-ready":case"wait-for-viewpoint":case"wait-for-animation-finish":this.reject(o)}}};i.when(s,o=>a(o)),r.asyncResult={resolve:()=>a(),reject:o=>a(o)}}_getAnimationController(){let t,r=null;const i=this.view.state.cameraController;return i instanceof ty&&(i.updateStateFromViewAnimation(),i.active&&(t=i,r=t.viewAnimation)),t!=null||(t=new ty({view:this.view,mode:"animation"}),r=t.viewAnimation,this.view.state.switchCameraController(t))?t:(_(r)&&r.stop(),this.reject(new k("GotoAnimation:goto-cannot-interrupt","Cannot start an animation while interacting")),null)}}const Hu=fe.getLogger("esri.views.3d.state.ViewStateManager");let Is=class extends xe{constructor(e){super(e),this.propertiesPool=new Ly({frustum:Y1},this),this.handles=new Ft,this.cameraSetByUser=!1,this.gotoOperation=null,this.ready=!1,this._windowDevicePixelRatio=1,this._devicePixelRatioOverride=null,this._maximumPixelRatioOverride=null,this.test={contentCameraResetState:new Map,setDevicePixelRatio:t=>this._devicePixelRatioOverride=t,setMaximumPixelRatio:t=>this._maximumPixelRatioOverride=t}}get camera(){const e=this._get("camera");if(!this.ready)return e;const t=A9(this.view,this.view.state.camera);return t&&e&&t.equals(e)?e:t}set camera(e){this._updatePropertyBeforeReady("camera",e)||(this.view.elevationProvider.enableElevationCache(!0),this.setStateCamera(Fg(this.view,e),{applyConstraints:!1})||Hu.error("#camera=","Invalid camera",e),this.view.elevationProvider.enableElevationCache(!1))}get contentCamera(){const e=this._get("contentCamera");if(!this.ready)return e;const t=A9(this.view,this.view.state.contentCamera);return t&&e&&t.equals(e)?e:t}set contentCamera(e){if(this._updatePropertyBeforeReady("contentCamera",e))return;const t=Fg(this.view,e);R(t)?this.view.state.contentCamera=null:(this._updateElevation(t),this.view.state.contentCamera=t)}installContentCameraReset(e){if(this.handles.remove("contentCameraReset"),this.test.contentCameraResetState.clear(),!this.view.state.fixedContentCamera)return!1;const t=this.zoom,r=this.view.state.camera.distance**2,i=Wl(this.view.state.camera.center),n=e.sticky?this.contentCamera.clone():null;return this.handles.add([re(()=>this.contentCamera,()=>{e.sticky||(this.handles.remove("contentCameraReset"),this.test.contentCameraResetState.clear())}),re(()=>this.zoom,s=>{this.test.contentCameraResetState.set("view.zoom",Math.abs(s-t)/2),Math.abs(s-t)>2?this.contentCamera=null:this.view.state.fixedContentCamera||(this.contentCamera=n)}),re(()=>this.view.state.camera,s=>{const a=Vs(i,s.center);this.test.contentCameraResetState.set("camera.center",a/r),a>r?this.contentCamera=null:this.view.state.fixedContentCamera||(this.contentCamera=n)})],"contentCameraReset"),!0}get center(){return this.ready?this.view.pointsOfInterest.centerOnContent.location:this._get("center")}set center(e){this._updatePropertyBeforeReady("center",e)||(e?this.isCompatible(e)?this.setStateCamera(this._centerToCamera(e),{applyConstraints:!0})?this.view.pointsOfInterest.centerOnContent.runTask():Hu.error("#center=","Invalid center",e):Hu.error("#center=","Center has an incompatible spatial reference (center: "+(e.spatialReference?e.spatialReference.wkid:"none")+", view: "+this.view.spatialReference.wkid+")",e):Hu.error("#center=","Center may not be null or undefined"))}get extent(){if(!this.ready)return this._get("extent");const e=this.view,t=mpt(e,e.state.camera,e.pointsOfInterest.centerOnContent.renderLocation);return _(t)?t:this._get("extent")}set extent(e){this._updatePropertyBeforeReady("extent",e)||(e?this.isCompatible(e)?this.setStateCamera(this._extentToCamera(e),{applyConstraints:!0})||Hu.error("#extent=","Invalid extent",e):Hu.error("#extent=","Extent has an incompatible spatial reference (extent: "+(e.spatialReference?e.spatialReference.wkid:"none")+", view: "+this.view.spatialReference.wkid+")",e):Hu.error("#extent=","Extent may not be null or undefined"))}get frustum(){const e=this.propertiesPool.get("frustum");return e.renderCoordsHelper=this.view.renderCoordsHelper,e.update(this.view.state.camera),e}get hasInitialView(){return!!this.view.get("map.initialViewProperties.viewpoint")}get scale(){if(this.ready){const e=this.view.pointsOfInterest.centerOnContent;return ix(this.view,e.distance,e.location.latitude)}return this._get("scale")}set scale(e){this._updatePropertyBeforeReady("scale",e)||this.setStateCamera(this._scaleToCamera(e),{applyConstraints:!0})||Hu.error("#scale=","Invalid scale",e)}get padding(){if(!this.ready)return this._get("padding");const e=this.view.state.camera,t=e.padding,r=e.pixelRatio,i=this._get("padding"),n=Math.round(t[Mt.TOP]/r),s=Math.round(t[Mt.RIGHT]/r),a=Math.round(t[Mt.BOTTOM]/r),o=Math.round(t[Mt.LEFT]/r);return i!=null&&i.top===n&&i.right===s&&i.bottom===a&&i.left===o?i:{top:n,right:s,bottom:a,left:o}}set padding(e){this._updatePropertyBeforeReady("padding",e)||(this._paddingToArray(e,this.view.state.camera.pixelRatio,$I),this.view.state.updateCamera(t=>t.padding=$I))}_paddingToArray(e,t,r){e?ei(r,e.top||0,e.right||0,e.bottom||0,e.left||0):ei(r,0,0,0,0);for(let i=0;i<4;i++)r[i]=Math.round(r[i]*t)}get screenCenter(){const e=this.padding;return Su((this.view.width-(e.left+e.right))/2+e.left,(this.view.height-(e.top+e.bottom))/2+e.top)}get viewpoint(){return this.ready?nxt(this.view,this.camera):this._get("viewpoint")}set viewpoint(e){if(!this._updatePropertyBeforeReady("viewpoint",e))if(e)if(this.isCompatible(e))this.setStateCamera(this._viewpointToCamera(e),{applyConstraints:!e.camera})||Hu.error("#viewpoint=","Invalid viewpoint",e);else{const t=_(e.camera)?e.camera.position:e.targetGeometry,r=_(t)&&t.spatialReference;Hu.error("#viewpoint=","Viewpoint has an incompatible spatial reference (viewpoint: "+(r?r.wkid:"none")+", view: "+this.view.spatialReference.wkid+")",e)}else Hu.error("#viewpoint=","Viewpoint may not be null or undefined")}get zoom(){return this.ready?x7e(this.view,this.scale):this._get("zoom")}set zoom(e){this._updatePropertyBeforeReady("zoom",e)||this.setStateCamera(this._zoomToCamera(e),{applyConstraints:!0})||Hu.error("#zoom=","Invalid zoom",e)}get maximumPixelRatio(){if(_(this._maximumPixelRatioOverride))return this._maximumPixelRatioOverride;let e=1/0;const{maximumPixelRatio:t,maximumRenderResolution:r}=this.view.qualitySettings;if(t!=null&&(e=Math.min(e,t)),r!=null){const i=r/Math.max(this.view.width,this.view.height);e=Math.min(e,i)}return e}get _devicePixelRatio(){return R(this._devicePixelRatioOverride)?Math.min(this._windowDevicePixelRatio,this.maximumPixelRatio):this._devicePixelRatioOverride}initialize(){this.handles.add([rn(()=>this.view.state.events,"before-camera-change",e=>this._updateElevation(e.camera))]),re(()=>this.view.state.camera,e=>this._updateElevation(e),{once:!0,sync:!0}),this.handles.add(Aw({prepare:()=>this._prepareFrame()})),this.handles.add(re(()=>this.view.state.cameraController,()=>{this.cameraSetByUser=!0,this.handles.remove(LI)})),this.handles.add(rn(()=>this.view.state.events,"camera-projection-changed",()=>this.notifyChange("scale")))}destroy(){this.deinit(),this.handles&&(this.handles.destroy(),this.handles=null),this.propertiesPool&&(this.propertiesPool.destroy(),this.propertiesPool=null)}init(){this.constraintsManager=new cC({view:this.view}),this._prepareFrame();const e=this._getInitialProperties();this.cameraSetByUser=!1,this._set("ready",!0);for(const t of e)this.set(t.name,t.value);if(!this.cameraSetByUser){const t=this.view.get("map.initialViewProperties.viewpoint")||this.view.initialExtent;t&&this.isCompatible(t)?this._setInitialView(t):this.view.state.viewingMode===Be.Local&&this.handles.add(Fa(()=>this.view.basemapTerrain.ready,()=>{this.handles.remove(LI),this._setInitialView(this.view.dataExtent)},{once:!0,initial:!0}),LI)}}deinit(){this._cancelGoToOperation(),this.ready&&(this._override("padding",this.padding),this._set("ready",!1),this._clearOverride("hasInitialView"),this.cameraSetByUser=!1,this.handles.remove(LI),this.constraintsManager&&(this.constraintsManager.destroy(),this.constraintsManager=null))}async goTo(e,t){const r={animate:!0,...t};return _(this.gotoOperation)&&this.gotoOperation.abort(r.animate),this.gotoOperation=new vxt(e,r,this.view),this.view.resourceController.scheduler.stopFrame(),this.gotoOperation}debugSetCameraOnContent(){this.setStateCamera($x(this.view),{applyConstraints:!1})}step(e){const t=this.view.state,r=t&&this.view.state.cameraController;r&&(t.updateCamera(i=>{r.stepController(e,i)}),r.steppingFinished&&r.finishController())}_cancelGoToOperation(){_(this.gotoOperation)&&(this.gotoOperation.abort(),this.gotoOperation=null)}_getInitialProperties(){const e=new Set,t=[];for(const{propertyName:r,overrides:i}of xxt){const n=e.has(r),s=this._isOverridden(r);!n&&s&&t.push({name:r,value:this._get(r)}),this._clearOverride(r),(n||s)&&i.forEach(a=>e.add(a))}return t}_setInitialView(e){if(R(e)||this.cameraSetByUser)return;if(e instanceof gd)return void this.setStateCamera(Fg(this.view,e),{applyConstraints:!1});if(e instanceof Yh){if(e.targetGeometry instanceof Zt){const n=h7(this.view,e.targetGeometry,0,.5,so.LOCKED);return void(_(n)&&this.setStateCamera(Fg(this.view,n),{applyConstraints:!0}))}const r={applyConstraints:!e.camera},i=this._viewpointToCamera(e);return void this.setStateCamera(i,r)}const t=h7(this.view,e,0,.5,so.LOCKED);_(t)&&this.setStateCamera(Fg(this.view,t),{applyConstraints:!0})}_updatePropertyBeforeReady(e,t){return!this.ready&&(this._override(e,t),t&&wxt.includes(e)&&this._override("hasInitialView",!0),!0)}isCompatible(e){return!R(e)&&(e instanceof Yh?e.camera?this.isCompatible(e.camera):this.isCompatible(e.targetGeometry):e instanceof gd?this.isCompatible(e.position):e.spatialReference&&Ov(e.spatialReference,this.view.spatialReference))}_getPreservingHeadingTilt(e=Txt){return this.cameraSetByUser?(e.heading=this.camera.heading,e.tilt=this.camera.tilt):(e.heading=0,e.tilt=.5),e}_centerPointAtDistanceToCamera(e,t,r=Mb){const{heading:i,tilt:n}=this._getPreservingHeadingTilt(),s=aR(this.view,i,n,e,t,so.ADJUST);return R(s)?null:(r.copyFrom(this.view.state.camera),r.eye=s.eye,r.center=s.center,r.up=s.up,r)}_centerToCamera(e){const t=this.view.pointsOfInterest.centerOnContent;t.runTask();const r=t.distance;return this._centerPointAtDistanceToCamera(e,r)}_extentToCamera(e){const{heading:t,tilt:r}=this._getPreservingHeadingTilt(),i=h7(this.view,e,t,r,so.ADJUST,Sxt);return _(i)?Fg(this.view,i):null}_scaleToCamera(e){if(e==null)return null;const t=this.view.pointsOfInterest.centerOnContent;t.runTask();const r=t.renderLocation,i=t.location.latitude,n=qse(this.view,e,i);return this._centerPointAtDistanceToCamera(r,n)}_zoomToCamera(e){return this._scaleToCamera(T7e(this.view,e))}_viewpointToCamera(e){return Fg(this.view,kOe(this.view,e))}setStateCamera(e,t){return!(R(e)||!this.view.state.stopActiveCameraController())&&(this.cameraSetByUser=!0,t.doNotCancelGoToOperation||this._cancelGoToOperation(),this.view.state.updateCamera(r=>{t.positionAndOrientationOnly?(r.eye=e.eye,r.center=e.center,r.up=e.up):r.copyFrom(e),t.applyConstraints&&En(this.view,r)}),t.applyConstraints||(this.view.state.cameraController=new M4({view:this.view,desiredCamera:e})),!0)}_prepareFrame(){const{surface:e,canvas:t}=this.view;if(!e||!t)return;this._windowDevicePixelRatio=window.devicePixelRatio;const r=this._devicePixelRatio,i=Math.round(e.clientWidth*r),n=Math.round(e.clientHeight*r);if(i!==0&&n!==0&&(t.width===i&&t.height===n||(t.width=i,t.height=n),this.view.state)){const s=this.view.state.camera;s.fullWidth===i&&s.fullHeight===n&&s.pixelRatio===r||(Mb.copyFrom(s),Mb.pixelRatio!==r&&(this._paddingToArray(this.padding,r,$I),Mb.padding=$I),Mb.fullWidth=i,Mb.fullHeight=n,Mb.pixelRatio=r,this.view.state.camera=Mb)}}_updateElevation(e){const t=this.view.basemapTerrain&&this.view.basemapTerrain.spatialReference,r=this.view.renderCoordsHelper.getAltitude(e.eye),i=t?Uz(this.view,e.eye):0;e.relativeElevation=r-i}};d([f({type:gd,dependsOn:["view.state.camera","ready"]})],Is.prototype,"camera",null),d([f({type:gd,dependsOn:["view.state.contentCamera","ready"]})],Is.prototype,"contentCamera",null),d([f({type:ot})],Is.prototype,"center",null),d([f({type:Zt})],Is.prototype,"extent",null),d([f({readOnly:!0})],Is.prototype,"frustum",null),d([f({readOnly:!0})],Is.prototype,"hasInitialView",null),d([f({readOnly:!0,type:Boolean})],Is.prototype,"ready",void 0),d([f({type:Number})],Is.prototype,"scale",null),d([f()],Is.prototype,"padding",null),d([f({readOnly:!0})],Is.prototype,"screenCenter",null),d([f({constructOnly:!0})],Is.prototype,"view",void 0),d([f({type:Yh})],Is.prototype,"viewpoint",null),d([f({type:Number})],Is.prototype,"zoom",null),d([f()],Is.prototype,"maximumPixelRatio",null),d([f()],Is.prototype,"_devicePixelRatio",null),d([f()],Is.prototype,"_windowDevicePixelRatio",void 0),d([f()],Is.prototype,"_devicePixelRatioOverride",void 0),d([f()],Is.prototype,"_maximumPixelRatioOverride",void 0),Is=d([$("esri.views.3d.state.ViewStateManager")],Is);const _xt=Is,wxt=["camera","viewpoint","extent","scale","center","zoom"],xxt=[{propertyName:"camera",overrides:["viewpoint"]},{propertyName:"viewpoint",overrides:["extent"]},{propertyName:"extent",overrides:["center","scale"]},{propertyName:"center",overrides:[]},{propertyName:"scale",overrides:["zoom"]},{propertyName:"zoom",overrides:[]},{propertyName:"padding",overrides:[]}],Txt={heading:0,tilt:0},Sxt=new gd,Mb=new ni,$I=Jt(),LI="pending-initial-view";class Ext{constructor(t,r,i){this.viewingMode=t,this._forEachLayer=r,this.view=i,this.externalIntersectionHandlers=new Qt,this.tolerance=E9,this.tmpRay=Ma(),this.tmpRegion=zt(),this.validateHUDIntersector=tf(this.viewingMode),this.validateHUDIntersector.options.hud=!1}intersectScreen(t,r,i){return this.intersectRay(this._getPickRay(t,this.tmpRay),tye(this.viewingMode),r,i)}intersectScreenFreePointFallback(t,r,i){return this.intersectRayFreePointFallback(this._getPickRay(t,this.tmpRay),r,i)}intersectRayFreePointFallback(t,r,i){return this.intersectRay(t,tye(this.viewingMode),r,i)||this._intersectRayFreePointLocal(t,r)}intersectRay(t,r,i,n){return r.options.selectionMode=!1,r.options.store=Da.MIN,this.computeIntersection(t,r,n),!!r.results.min&&r.results.min.getIntersectionPoint(i)}getCenterRayWithSubpixelOffset(t,r,i=.5,n=.5){return t.getRenderCenter(NI,i,n),NI[0]+=.0466,NI[1]-=.0123,kse(t,NI,r)}intersectIntersectorScreen(t,r,i){this.computeIntersection(this._getPickRay(t,this.tmpRay),r,i)}intersectToolIntersectorScreen(t,r,i){const n=this._getPickRay(t,this.tmpRay);this.intersectToolIntersectorRay(n,r,i)}intersectToolIntersectorRay(t,r,i){r.options.selectionMode=!0,this.computeIntersection(t,r,i);const n=r.results.min;!!this.view.basemapTerrain&&this.view.basemapTerrain.opaque||Lm(n)&&n.intersector!==Wi.TERRAIN||(r.options.selectionMode=!1,this.computeIntersection(t,r,i))}setTolerance(t=E9){this.tolerance=t}addIntersectionHandler(t){this.externalIntersectionHandlers.push(t),this.externalIntersectionHandlers.sort((r,i)=>r.type===Wi.TERRAIN?1:i.type===Wi.TERRAIN?-1:0)}removeIntersectionHandler(t){this.externalIntersectionHandlers.removeUnordered(t)!=null&&this.externalIntersectionHandlers.sort((r,i)=>r.type===Wi.TERRAIN?1:i.type===Wi.TERRAIN?-1:0)}_getPickRay(t,r){const i=this.view.state.camera;return qCe(i,t,r)}_intersectRayFreePointLocal(t,r){if(this.viewingMode!==Be.Local||R(t))return!1;const i=this.view.renderDataExtent;if(R(i))return he(r,t.origin,we(qe.get(),t.direction)),!0;const n={x:i.xmax-i.xmin,y:i.ymax-i.ymin,z:8*Math.max(i.xmax-i.xmin,i.ymax-i.ymin)},s=Math.max(n.x,n.y,n.z);if(s===0)return he(r,t.origin,we(qe.get(),t.direction)),!0;const a=this.view.state.camera,o=Math.max(0,i.xmin-a.eye[0],a.eye[0]-i.xmax),l=Math.max(0,i.ymin-a.eye[1],a.eye[1]-i.ymax),c=Math.sqrt(o*o+l*l),u=Math.abs(a.relativeElevation)+Number.MIN_VALUE,h=Math.max(0,Math.log(s/u))**2;let p=s/Math.max(1,h);p=Math.max(p,Math.min(c,s));const m=le(qe.get(),t.direction,p/Oe(t.direction));return he(r,t.origin,m),!0}intersectElevationFromScreen(t,r,i=0,n=null){return this._intersectElevation(this._getPickRay(t,this.tmpRay),r,i,n)}_intersectElevation(t,r,i=0,n=null){if(R(t))return null;const s=_(r)?r.mode:"absolute-height",a=_(r)?vt(r.offset,0):0,o=s!=="on-the-ground"?a+i:0,l=o/this.view.renderCoordsHelper.unitInMeters;if(s==="absolute-height"){if(this.view.renderCoordsHelper.intersectInfiniteManifold(t,o,FI)){const x=this.view.computeMapPointFromVec3d(FI);return x.z-=a,x}return null}const c=this.view.state.camera,u=qe.get();c.projectToRenderScreen(t.origin,u);const h=new rye(null,this._forEachLayer),p=this.view.slicePlane,m=_(p)?Zpe(p):null,g=tf(this.viewingMode);g.options.store=Da.MIN,g.options.verticalOffset=l;const b=t.origin,w=he(qe.get(),b,t.direction);g.reset(b,w,c),g.point=u;const v=_(n)?"type"in n&&n.type==="graphics"?x=>x.metadata.layerUid!==n.uid:x=>x.metadata.graphicUid!==n.uid:null;switch(s){case"relative-to-scene":{const x=T=>(R(v)||v(T))&&T.metadata&&T.metadata.isElevationSource;g.intersect(h.layers,u,this.tolerance,null,x),this.externalIntersectionHandlers.forAll(T=>{if(T.type===Wi.I3S||T.type===Wi.TERRAIN){const E=T.slicePlaneEnabled?m:null;T.intersect(g,E,g.rayBegin,g.rayEnd,u)}})}break;case"on-the-ground":case"relative-to-ground":this.externalIntersectionHandlers.forAll(x=>{if(x.isGround){const T=x.slicePlaneEnabled?m:null;x.intersect(g,T,g.rayBegin,g.rayEnd,u)}})}if(g.results.min.getIntersectionPoint(FI)){const x=this.view.computeMapPointFromVec3d(FI);return x.z=i,x}return null}computeIntersection(t,r,i){if(R(t))return;const n=this.view.state.camera,s=qe.get();n.projectToRenderScreen(t.origin,s);const a=new rye(i,this._forEachLayer);r.options.selectOpaqueTerrainOnly=!i||!("include"in i||"exclude"in i);const o=t.origin,l=he(qe.get(),t.origin,t.direction);r.reset(o,l,n),r.intersect(a.layers,s,this.tolerance);const c=this.view.slicePlane,u=_(c)?Zpe(c):null;r.intersect(a.sliceableLayers,s,this.tolerance,u);const h=i&&(i.requiresGroundFeedback||i.enableDraped);this.externalIntersectionHandlers.forAll(m=>{if(r.options.isFiltered=!a.filterLayerUid(m.layerUid),m.isGround&&h||!r.options.isFiltered){const g=m.slicePlaneEnabled?u:null;m.intersect(r,g,o,l,s)}});const p=qe.get();if(i&&i.enableDraped&&r.results.ground.getIntersectionPoint(p)){const m=this.view.basemapTerrain,g=m.overlayManager.renderer,b=this.view.renderCoordsHelper.spatialReference,w=qe.get();this.view.renderCoordsHelper.fromRenderCoords(p,w,m.spatialReference),w[2]=vt(this.view.elevationProvider.getElevation(p[0],p[1],p[2],b,"ground"),0),g.intersect(r,w,r.results.ground,v=>a.filterRenderGeometry(v))}r.sortResults(),this._processHUDResults(r)}_processHUDResults(t){const r=t.results.hud;Oy(this.tmpRegion,yY);const i=this.view.state.camera,n=[],s=this.tmpRegion,a=v=>{const x=new Axt(v);i.projectToRenderScreen(v.target.center,x.screenPoint),x.screenPoint[0]=Math.floor(x.screenPoint[0]),x.screenPoint[1]=Math.floor(x.screenPoint[1]),n.push(x),Y4(s,x.screenPoint)};t.sortResults(r.all),_(r.min.dist)&&a(r.min);for(const v of r.all)r.min.target.object!==v.target.object&&r.max.target.object!==v.target.object&&a(v);if(_(r.max.dist)&&r.max.target.object!==r.min.target.object&&a(r.max),!n.length)return;s[0]===s[2]&&(s[2]+=1),s[1]===s[3]&&(s[3]+=1);const o=i.fullWidth,l=i.fullHeight,c=Math.max(0,s[0]-dC),u=Math.max(0,s[1]-dC),h=Math.min(su(s)+2*dC,o-c),p=Math.min($p(s)+2*dC,l-u),m=new Uint8Array(h*p*4);this.view._stage.renderView.readHUDVisibility(c,u,h,p,m);let g=!0;const b=R(t.results.max.dist);let w=0;for(const v of n)for(const x of Cxt)if(m[4*(Math.min(v.screenPoint[0]+x[0],o)-s[0]+(Math.min(v.screenPoint[1]+x[1],l)-s[1])*h)]){g&&(t.results.min.copy(v.result),g=!1),b&&t.results.max.copy(v.result),t.options.store===Da.ALL&&t.results.all.splice(w++,0,v.result);break}}}const dC=1,Cxt=(()=>{const e=[],t=dC;for(let r=-t;r<=t;r++)for(let i=-t;i<=t;i++)e.push([i+t,r+t]);return e})();class Axt{constructor(t){this.result=t,this.screenPoint=ro()}}let DI;function tye(e){return DI&&DI.viewingMode===e||(DI=tf(e)),DI}class rye{constructor(t,r){this.layers=new Array,this.sliceableLayers=new Array,this.include=t==null?void 0:t.include,this.exclude=t==null?void 0:t.exclude,r(i=>{i.isPickable&&this.filterLayerUid(i.apiLayerUid)&&(i.isSliceable?this.sliceableLayers:this.layers).push(i)})}filterLayerUid(t){const{include:r,exclude:i}=this;return R(t)?r==null&&i==null:(r==null||r.has(t))&&(i==null||!i.has(t))}filterRenderGeometry(t){return this.filterLayerUid(t.layerUid)}}function iye(e){return typeof e=="object"&&"intersect"in e}const FI=M(),NI=ro();class JLt{constructor(t,r){this.spatialReference=t,this.view=r}getElevation(t,r,i){return this.view.elevationProvider.getElevation(t,r,0,this.spatialReference,i)}async queryElevation(t,r,i,n,s){return this.view.elevationProvider.queryElevation(t,r,0,this.spatialReference,s,i,n)}}class Rxt{constructor(t,r,i,n){this.spatialReference=r,this._getElevationQueryProvider=i,this._queries=new Array,this._queryOptions={...n,ignoreInvisibleLayers:!0},this._frameTask=t.registerTask(bt.ELEVATION_QUERY,this)}destroy(){this._frameTask.remove()}queryElevation(t,r,i,n=0){return new Promise((s,a)=>{const o={x:t,y:r,minDemResolution:n,result:{resolve:s,reject:a},signal:i};this._queries.push(o),Fo(i,()=>{_te(this._queries,o),a(br())})})}get running(){return this._queries.length>0}runTask(){const t=this._queries;this._queries=[];const r=this._getElevationQueryProvider();if(!r)return void t.forEach(c=>c.result.reject());const i=t.map(c=>[c.x,c.y]),n=t.reduce((c,u)=>Math.min(c,u.minDemResolution),1/0),s=new gx({points:i,spatialReference:this.spatialReference}),a=t.length>1&&t.some(c=>!!c.signal)?new AbortController:null,o=_(a)?a.signal:t[0].signal;if(_(a)){let c=0;t.forEach(u=>Fo(u.signal,()=>{c++,u.result.reject(br()),c===t.length&&a.abort()}))}const l={...this._queryOptions,minDemResolution:n,signal:o};r.queryElevation(s,l).then(c=>{t.forEach((u,h)=>{_(u.signal)&&u.signal.aborted?u.result.reject(br()):u.result.resolve(c.geometry.points[h][2])})}).catch(c=>{t.forEach(u=>u.result.reject(c))})}get test(){const t=this;return{update:()=>t._queries.length>0&&t.runTask()}}}let uC=class extends mn.EventedMixin(xe){constructor(e){super(e),this.im=new Array,this.ground=new Array,this.scene=new Array,this.handles=new Map,this.lastElevationQuery=null,this.elevationCacheEnabled=!1}destroy(){this._elevationQuery=ct(this._elevationQuery)}get elevationQuery(){return R(this._elevationQuery)&&(this._elevationQuery=new Rxt(this.view.resourceController.scheduler,this.view.spatialReference,()=>this.view.map&&this.view.map.ground,{maximumAutoTileRequests:4})),this._elevationQuery}enableElevationCache(e){e||(this.lastElevationQuery=null),this.elevationCacheEnabled=e}getElevation(e,t,r,i,n){if(this.elevationCacheEnabled&&this.lastElevationQuery!=null){const a=this.lastElevationQuery;if(e===a.x&&t===a.y&&r===a.z&&i.equals(a.spatialReference)&&n===a.queryContext)return a.result}let s=null;return s=kI(s,this.im,e,t,r,i,n),R(s)&&(s=kI(s,this.ground,e,t,r,i,n)),n==="scene"&&(s=kI(s,this.scene,e,t,r,i,n)),this.elevationCacheEnabled&&(this.lastElevationQuery={x:e,y:t,z:r,spatialReference:i,queryContext:n,result:s}),s}queryElevation(e,t,r,i,n,s=null,a=0){const o=Op();return this.elevationQuery.queryElevation(e,t,s,a).then(l=>{n==="scene"&&(l=kI(l,this.scene,e,t,r,i,n)),o.resolve(l)}).catch(l=>{Ui(l)?o.reject(l):o.resolve(this.getElevation(e,t,r,i,n))}),o.promise}register(e,t){this.handles.set(t,t.on("elevation-change",r=>this.emit("elevation-change",r))),this[e].push(t)}unregister(e){this.handles.has(e)&&(this.handles.get(e).remove(),this.handles.delete(e));for(const t of[this.im,this.ground,this.scene]){const r=t.indexOf(e);r>-1&&t.splice(r,1)}}};function kI(e,t,r,i,n,s,a){for(const o of t){const l=o.getElevation(r,i,n,s,a);_(l)&&(e=_(e)?Math.max(l,e):l)}return e}d([f({constructOnly:!0})],uC.prototype,"view",void 0),d([f({readOnly:!0,aliasOf:"view.basemapTerrain.spatialReference"})],uC.prototype,"spatialReference",void 0),uC=d([$("esri.views.3d.support.CombinedElevationProvider")],uC);class yv{static isValidProfile(t){return t in yv.profiles}static getDefaultProfile(){return ue("trident")||ue("esri-iPhone")?"low":"medium"}static apply(t,r){const i=yv.profiles[t];r.graphics3D.maxTotalNumberOfFeatures=i.graphics3D.maxTotalNumberOfFeatures,r.graphics3D.maxTotalNumberOfPrimitives=i.graphics3D.maxTotalNumberOfPrimitives,r.graphics3D.polygonLodFactor=i.graphics3D.polygonLodFactor,r.graphics3D.polylineLodFactor=i.graphics3D.polylineLodFactor,r.graphics3D.snapshotAvailable=i.graphics3D.snapshotAvailable;{const n=r.sceneService["3dObject"],s=i.sceneService["3dObject"];n.lodFactor=s.lodFactor,n.lodCrossfadeinDuration=s.lodCrossfadeinDuration,n.lodCrossfadeoutDuration=s.lodCrossfadeoutDuration,n.lodCrossfadeUncoveredDuration=s.lodCrossfadeUncoveredDuration}r.sceneService.point.lodFactor=i.sceneService.point.lodFactor,r.sceneService.integratedMesh.lodFactor=i.sceneService.integratedMesh.lodFactor,r.sceneService.pointCloud.lodFactor=i.sceneService.pointCloud.lodFactor,r.sceneService.uncompressedTextureDownsamplingEnabled=i.sceneService.uncompressedTextureDownsamplingEnabled,r.tiledSurface.lodBias=i.tiledSurface.lodBias,r.tiledSurface.angledSplitBias=i.tiledSurface.angledSplitBias,r.tiledSurface.reduceTileLevelDifferences=i.tiledSurface.reduceTileLevelDifferences,r.tiledSurface.textureFadeDuration=i.tiledSurface.textureFadeDuration,r.heatmap.pixelRatio=i.heatmap.pixelRatio,r.heatmap.maxTotalNumberOfFeatures=i.heatmap.maxTotalNumberOfFeatures,r.antialiasingEnabled=i.antialiasingEnabled,r.physicallyBasedRenderingEnabled=i.physicalBasedRenderingEnabled,r.highQualityTransparency=i.highQualityTransparency,r.memoryLimit=i.memoryLimit,r.additionalCacheMemory=i.additionalCacheMemory,r.frameRate=i.frameRate,r.maximumRenderResolution=i.maximumRenderResolution,r.maximumPixelRatio=i.maximumPixelRatio}}function nye(){const e=!!ue("esri-mobile"),t=!!ue("ios");return{low:{graphics3D:{maxTotalNumberOfFeatures:25e3,maxTotalNumberOfPrimitives:85e4,polygonLodFactor:.5,polylineLodFactor:1,snapshotAvailable:!1},heatmap:{pixelRatio:.125,maxTotalNumberOfFeatures:25e3},sceneService:{"3dObject":{lodFactor:.2,lodCrossfadeinDuration:0,lodCrossfadeoutDuration:0,lodCrossfadeUncoveredDuration:0},point:{lodFactor:1},integratedMesh:{lodFactor:.6},pointCloud:{lodFactor:.5},uncompressedTextureDownsamplingEnabled:!0},tiledSurface:{lodBias:-1,angledSplitBias:.5,reduceTileLevelDifferences:!1,textureFadeDuration:0},antialiasingEnabled:!1,physicalBasedRenderingEnabled:!1,highQualityTransparency:!1,memoryLimit:200,additionalCacheMemory:0,frameRate:0,maximumRenderResolution:null,maximumPixelRatio:1},medium:{graphics3D:{maxTotalNumberOfFeatures:5e4,maxTotalNumberOfPrimitives:17e5,polygonLodFactor:e?.8:1,polylineLodFactor:e?1.2:1.5,snapshotAvailable:!t},heatmap:{pixelRatio:.25,maxTotalNumberOfFeatures:5e4},sceneService:{"3dObject":{lodFactor:1,lodCrossfadeinDuration:0,lodCrossfadeoutDuration:0,lodCrossfadeUncoveredDuration:400},point:{lodFactor:1},integratedMesh:{lodFactor:1},pointCloud:{lodFactor:1},uncompressedTextureDownsamplingEnabled:e},tiledSurface:{lodBias:0,angledSplitBias:1,reduceTileLevelDifferences:!ue("disable-feature:reduce-map-tile-levels"),textureFadeDuration:400},antialiasingEnabled:!0,physicalBasedRenderingEnabled:!0,highQualityTransparency:!0,memoryLimit:e?600:750,additionalCacheMemory:e?0:150,frameRate:0,maximumRenderResolution:null,maximumPixelRatio:1},high:{graphics3D:{maxTotalNumberOfFeatures:5e4,maxTotalNumberOfPrimitives:17e5,polygonLodFactor:e?1.2:2,polylineLodFactor:e?1.2:2,snapshotAvailable:!t},heatmap:{pixelRatio:.5,maxTotalNumberOfFeatures:5e4},sceneService:{"3dObject":{lodFactor:1,lodCrossfadeinDuration:0,lodCrossfadeoutDuration:0,lodCrossfadeUncoveredDuration:400},point:{lodFactor:1},integratedMesh:{lodFactor:1},pointCloud:{lodFactor:1},uncompressedTextureDownsamplingEnabled:!1},tiledSurface:{lodBias:0,angledSplitBias:1,reduceTileLevelDifferences:!ue("disable-feature:reduce-map-tile-levels"),textureFadeDuration:400},antialiasingEnabled:!0,physicalBasedRenderingEnabled:!0,highQualityTransparency:!0,memoryLimit:e?900:1500,additionalCacheMemory:0,frameRate:0,maximumRenderResolution:e?null:4096,maximumPixelRatio:e?1:null}}}yv.debug={reset(){const e=nye();for(const t in e)yv.profiles[t]=e[t]}},function(e){e.profiles=nye()}(yv||(yv={}));const vD=yv;function Nae(){return new Float32Array(4)}function Oxt(e){const t=new Float32Array(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function nf(e,t,r,i){const n=new Float32Array(4);return n[0]=e,n[1]=t,n[2]=r,n[3]=i,n}function Mxt(e,t){return new Float32Array(e,t,4)}function UOe(){return Nae()}function BOe(){return nf(1,1,1,1)}function GOe(){return nf(1,0,0,0)}function jOe(){return nf(0,1,0,0)}function qOe(){return nf(0,0,1,0)}function HOe(){return nf(0,0,0,1)}const Pxt=UOe(),Ixt=BOe(),$xt=GOe(),Lxt=jOe(),Dxt=qOe(),Fxt=HOe();Object.freeze(Object.defineProperty({__proto__:null,create:Nae,clone:Oxt,fromValues:nf,createView:Mxt,zeros:UOe,ones:BOe,unitX:GOe,unitY:jOe,unitZ:qOe,unitW:HOe,ZEROS:Pxt,ONES:Ixt,UNIT_X:$xt,UNIT_Y:Lxt,UNIT_Z:Dxt,UNIT_W:Fxt},Symbol.toStringTag,{value:"Module"}));let S0=class extends xe{constructor(){super(...arguments),this.color=new Te([0,255,255]),this.haloColor=null,this.haloOpacity=1,this.fillOpacity=.25,this.shadowOpacity=.4,this.shadowColor=new Te([0,0,0]),this.shadowDifference=.2}static toEngineOptions(e){const t=Te.toUnitRGBA(e.color),r=_(e.haloColor)?Te.toUnitRGBA(e.haloColor):t,i=Te.toUnitRGBA(e.shadowColor);return{color:nf(t[0],t[1],t[2],t[3]),haloColor:nf(r[0],r[1],r[2],r[3]),haloOpacity:e.haloOpacity,haloOpacityOccluded:.25*e.haloOpacity,fillOpacity:e.fillOpacity,fillOpacityOccluded:.25*e.fillOpacity,shadowOpacity:e.shadowOpacity,shadowColor:Tr(i[0],i[1],i[2],i[3]),occludedShadowOpacity:e.shadowOpacity*(1-e.shadowDifference)}}};d([f({type:Te})],S0.prototype,"color",void 0),d([f({type:Te})],S0.prototype,"haloColor",void 0),d([f()],S0.prototype,"haloOpacity",void 0),d([f()],S0.prototype,"fillOpacity",void 0),d([f()],S0.prototype,"shadowOpacity",void 0),d([f({type:Te})],S0.prototype,"shadowColor",void 0),d([f()],S0.prototype,"shadowDifference",void 0),S0=d([$("esri.views.3d.support.HighlightOptions")],S0);const _K=S0;function Nxt(e,t,r){const i=qwe(t);return e.map(n=>{const s=i.fromJSON(n);return s.spatialReference=r,s})}let e3=class extends ge{constructor(e){super(e),this.geometries=null,this.outSpatialReference=null,this.transformation=null,this.transformForward=null}toJSON(){const e=this.geometries.map(i=>i.toJSON()),t=this.geometries[0],r={};return r.outSR=this.outSpatialReference.wkid||JSON.stringify(this.outSpatialReference.toJSON()),r.inSR=t.spatialReference.wkid||JSON.stringify(t.spatialReference.toJSON()),r.geometries=JSON.stringify({geometryType:yx(t),geometries:e}),this.transformation&&(r.transformation=this.transformation.wkid||JSON.stringify(this.transformation)),this.transformForward!=null&&(r.transformForward=this.transformForward),r}};d([f()],e3.prototype,"geometries",void 0),d([f({json:{read:{source:"outSR"}}})],e3.prototype,"outSpatialReference",void 0),d([f()],e3.prototype,"transformation",void 0),d([f()],e3.prototype,"transformForward",void 0),e3=d([$("esri.rest.support.ProjectParameters")],e3);const kae=e3,kxt=rs(kae);async function WOe(e,t,r){t=kxt(t);const i=Lu(e),n={...i.query,f:"json",...t.toJSON()},s=t.outSpatialReference,a=yx(t.geometries[0]),o=wQe(n,r);return qt(i.path+"/project",o).then(({data:{geometries:l}})=>Nxt(l,a,s))}async function Vae(e=null,t){var n,s;if(Vr.geometryServiceUrl)return Vr.geometryServiceUrl;if(!e)throw new k("internal:geometry-service-url-not-configured");let r;r="portal"in e?e.portal||Cs.getDefault():e,await r.load({signal:t});const i=(s=(n=r.helperServices)==null?void 0:n.geometry)==null?void 0:s.url;if(!i)throw new k("internal:geometry-service-url-not-configured");return i}async function Vxt(e,t,r=null,i){const n=await Vae(r,i),s=new kae;s.geometries=[e],s.outSpatialReference=t;const a=await WOe(n,s,{signal:i});if(a&&Array.isArray(a)&&a.length===1)return a[0];throw new k("internal:geometry-service-projection-failed")}const zxt=Object.freeze(Object.defineProperty({__proto__:null,getGeometryServiceURL:Vae,projectGeometry:Vxt},Symbol.toStringTag,{value:"Module"}));class Uxt{constructor(t,r){this.spatialReference=r,this.unitInMeters=vc(this.spatialReference,Ar(this.spatialReference).metersPerDegree),this._geometryServiceURLPromise=Vae(t&&t.get("portalItem")).catch(()=>{throw new k("mapcoordshelper:missing-geometry-service","Must specify geometryService in esri/config")})}async toGeographic(t){const r=await this._geometryServiceURLPromise;let i,n=!0;Array.isArray(t[0])&&typeof t[0]!="number"?i=t:(i=[t],n=!1);const s=i.map(l=>l instanceof ot?l:new ot(l,this.spatialReference)),a=new kae({geometries:s,outSpatialReference:Ye.WGS84}),o=(await WOe(r,a)).map(l=>l.type==="point"?[l.x,l.y]:void 0);return n?o:o[0]}}let D0=class extends xe{constructor(){super(...arguments),this.minTotalNumberOfFeatures=2e3,this.maxTotalNumberOfFeatures=5e4,this.maxTotalNumberOfPrimitives=17e5,this.snapshotAvailable=!0,this.polygonLodFactor=1,this.polylineLodFactor=1}};d([f()],D0.prototype,"minTotalNumberOfFeatures",void 0),d([f()],D0.prototype,"maxTotalNumberOfFeatures",void 0),d([f()],D0.prototype,"maxTotalNumberOfPrimitives",void 0),d([f()],D0.prototype,"snapshotAvailable",void 0),d([f()],D0.prototype,"polygonLodFactor",void 0),d([f()],D0.prototype,"polylineLodFactor",void 0),D0=d([$("esri.views.3d.support.QualitySettings.Graphics3DSettings")],D0);let sm=class extends xe{constructor(){super(...arguments),this.lodFactor=1}};d([f()],sm.prototype,"lodFactor",void 0),sm=d([$("esri.views.3d.support.QualitySettings.LoDFactorSettings")],sm);let Sk=class extends sm{constructor(){super(...arguments),this.lodCrossfadeinDuration=0,this.lodCrossfadeoutDuration=0,this.lodCrossfadeUncoveredDuration=0}};Sk=d([$("esri.views.3d.support.QualitySettings.LoDFactor3DObjectSettings")],Sk);let kg=class extends xe{constructor(){super(...arguments),this["3dObject"]=new Sk,this.point=new sm,this.integratedMesh=new sm,this.pointCloud=new sm,this.uncompressedTextureDownsamplingEnabled=!1}};d([f({type:Sk})],kg.prototype,"3dObject",void 0),d([f({type:sm})],kg.prototype,"point",void 0),d([f({type:sm})],kg.prototype,"integratedMesh",void 0),d([f({type:sm})],kg.prototype,"pointCloud",void 0),d([f()],kg.prototype,"uncompressedTextureDownsamplingEnabled",void 0),kg=d([$("esri.views.3d.support.QualitySettings.SceneServiceSettings")],kg);let U1=class extends xe{constructor(){super(...arguments),this.lodBias=0,this.angledSplitBias=1,this.reduceTileLevelDifferences=!0,this.textureFadeDuration=500}};d([f()],U1.prototype,"lodBias",void 0),d([f()],U1.prototype,"angledSplitBias",void 0),d([f()],U1.prototype,"reduceTileLevelDifferences",void 0),d([f()],U1.prototype,"textureFadeDuration",void 0),U1=d([$("esri.views.3d.support.QualitySettings.TiledSurfaceSettings")],U1);let P4=class extends xe{constructor(){super(...arguments),this.pixelRatio=1,this.maxTotalNumberOfFeatures=5e4}};d([f()],P4.prototype,"pixelRatio",void 0),d([f()],P4.prototype,"maxTotalNumberOfFeatures",void 0),P4=d([$("esri.views.3d.support.QualitySettings.HeatmapSettings")],P4);let Nl=class extends xe{constructor(){super(...arguments),this.graphics3D=new D0,this.sceneService=new kg,this.tiledSurface=new U1,this.heatmap=new P4,this.antialiasingEnabled=!0,this.physicallyBasedRenderingEnabled=!1,this.highQualityTransparency=!0}};d([f({type:D0})],Nl.prototype,"graphics3D",void 0),d([f({type:kg})],Nl.prototype,"sceneService",void 0),d([f({type:U1})],Nl.prototype,"tiledSurface",void 0),d([f({type:P4})],Nl.prototype,"heatmap",void 0),d([f()],Nl.prototype,"antialiasingEnabled",void 0),d([f()],Nl.prototype,"physicallyBasedRenderingEnabled",void 0),d([f()],Nl.prototype,"highQualityTransparency",void 0),d([f()],Nl.prototype,"memoryLimit",void 0),d([f()],Nl.prototype,"additionalCacheMemory",void 0),d([f()],Nl.prototype,"frameRate",void 0),d([f()],Nl.prototype,"maximumRenderResolution",void 0),d([f()],Nl.prototype,"maximumPixelRatio",void 0),Nl=d([$("esri.views.3d.support.QualitySettings.QualitySettings")],Nl);const sye=Nl;class Ek{constructor(t,r,i,n){this.viewingMode=t,this.spatialReference=r,this.unitInMeters=i,this.coordinateSystem=n,this._coordinateSystem=Jqe(n)}set extent(t){t&&Kqe(this.coordinateSystem,t,this.coordinateSystem)}getAltitude(t){return oHe(this.coordinateSystem,t)}setAltitude(t,r,i=t){return zSe(this.coordinateSystem,i,r,t)}setAltitudeOfTransformation(t,r){lHe(this.coordinateSystem,r,t,r)}worldUpAtPosition(t,r){return iHe(this.coordinateSystem,t,r)}worldBasisAtPosition(t,r,i){return nHe(this.coordinateSystem,t,r,i)}basisMatrixAtPosition(t,r){const i=this.worldBasisAtPosition(t,bu.X,qe.get()),n=this.worldBasisAtPosition(t,bu.Y,qe.get()),s=this.worldBasisAtPosition(t,bu.Z,qe.get());return Rm(r,i[0],i[1],i[2],0,n[0],n[1],n[2],0,s[0],s[1],s[2],0,0,0,0,1),r}intersectManifoldClosestSilhouette(t,r,i){return _G(this.coordinateSystem,r,this._coordinateSystem),aHe(this._coordinateSystem,t,i),i}intersectManifold(t,r,i){_G(this.coordinateSystem,r,this._coordinateSystem);const n=qe.get();return sHe(this._coordinateSystem,t,n)?oe(i,n):null}intersectInfiniteManifold(t,r,i){if(this.viewingMode===Be.Global)return this.intersectManifold(t,r,i);_G(this.coordinateSystem,r,this._coordinateSystem);const n=this._coordinateSystem.value,s=qe.get();return Cx(n.plane,t,s)?oe(i,s):null}toRenderCoords(t,r,i){return ek(t)?oa(t,r,this.spatialReference):Ss(t,r,i,this.spatialReference)}fromRenderCoords(t,r,i=null){return ek(r)?(_(i)&&(r.spatialReference=i),NTe(t,this.spatialReference,r)):r instanceof Ye?Yv(t,this.spatialReference,r):Ss(t,this.spatialReference,r,i)?r:null}static create(t,r){switch(t){case Be.Local:return new Ek(Be.Local,r,vc(r),rHe());case Be.Global:return new Ek(Be.Global,r,1,tHe(r))}}static renderUnitScaleFactor(t,r){return aye(t)/aye(r)}}function aye(e){if(sR(e,Be.Global))return 1;const t=USe(!1,e);return vc(t)}var H0;(function(e){e[e.ELEVATION=0]="ELEVATION",e[e.BASEMAP=1]="BASEMAP",e[e.I3S_INDEX=2]="I3S_INDEX",e[e.I3S_DATA=3]="I3S_DATA",e[e.SYMBOLOGY=4]="SYMBOLOGY"})(H0||(H0={}));const Bxt=(()=>{const e=new Array;return e[H0.ELEVATION]=10,e[H0.BASEMAP]=10,e[H0.I3S_INDEX]=10,e[H0.I3S_DATA]=10,e[H0.SYMBOLOGY]=5,e})(),Gxt=30;function XOe(e){return typeof e.getUsedMemory=="function"}const jxt=fe.getLogger("esri.views.3d.support.MemoryController");function qxt(e){return new kl({view:e})}const VI=1,nH=1,Hxt=.75,Wxt=.6,oye=1.3;let kl=class extends xe{constructor(e){super(e),this._quality=1,this._memoryUsed=0,this._updating=!1,this.minQuality=.1,this._stableQuality=0,this._downscaleMemoryUsed=0,this._canFastRecover=!1,this._memoryPredicted=0,this._cacheStorage=new kie,this._numQualityChanges=0,this._maxMemory=500,this._additionalCacheMemory=100}destroy(){this._cacheStorage.destroy()}set maxMemory(e){e==null||e<=0||(this._stableQuality=0,this._canFastRecover=!1,this._maxMemory<e&&this._updateQuality(VI),this._maxMemory=e)}get maxMemory(){return this._maxMemory}set additionalCacheMemory(e){e!=null&&e>=0&&(this._additionalCacheMemory=e)}get additionalCacheMemory(){return this._additionalCacheMemory}get memoryFactor(){return this._quality}get updating(){return this._updating}get usedMemory(){return this._memoryUsed}newCache(e,t){return new AZe(e,this._cacheStorage,t)}resetStableQuality(){this._stableQuality=0}disableMemCache(){this.additionalCacheMemory=-4096}update(){if(this._updateMemory(),this._memoryPredicted<=0&&!this._updating)return;let e=this._layersUpdating();if(this._memoryPredicted<Wxt&&this._canFastRecover)this._downscaleMemoryUsed=0,this._stableQuality=0,this._canFastRecover=!1,this._updateQuality(VI);else if(e)(this._memoryPredicted>1.1*nH||this._memoryUsed>nH)&&(this._stableQuality>0?(this._downscaleMemoryUsed=0,this._updateQuality(this._stableQuality)):this._quality>this.minQuality&&this._downscaleMemoryUsed<this._memoryUsed&&(this._updateQuality(this._quality/oye),this._downscaleMemoryUsed=this._memoryUsed,this._canFastRecover=!1));else if(this._downscaleMemoryUsed=0,this._memoryUsed>nH)this._stableQuality=0,this._canFastRecover=!1,e=this._updateQuality(this._quality/oye),this._downscaleMemoryUsed=this._memoryPredicted;else if(this._stableQuality!==this._quality)if(this._memoryUsed<Hxt&&this._quality<VI){this._stableQuality=this._quality;const t=.05;e=this._updateQuality(this._quality+t)}else this._quality<1&&(this._canFastRecover=!0);this._updating=e}_updateQuality(e){return(e=Math.min(Math.max(e,this.minQuality),VI))!==this._quality&&(this._quality=e,++this._numQualityChanges,!0)}_layersUpdating(){return this.view.allLayerViews.some(e=>!!e.updating)}_updateMemory(){let e=0,t=0;this.view.basemapTerrain&&this.view.basemapTerrain.getUsedMemory&&(e+=this.view.basemapTerrain.getUsedMemory());const r=this.view._stage&&this.view._stage.renderView&&this.view._stage.renderView.edgeView;_(r)&&(e+=r.usedMemory),this.view.allLayerViews&&this.view.allLayerViews.forEach(a=>{if(XOe(a)){const o=a.ignoresMemoryFactor()?this._quality:1;e+=a.getUsedMemory()*o,t+=a.getUnloadedMemory()*o}});const i=this._warnMemoryUsage==null||Math.round(10*e)!==Math.round(10*this._warnMemoryUsage),n=1048576*this.maxMemory;if(e>n&&i){this._warnMemoryUsage=e;const a=l=>(l/1048576).toLocaleString(void 0,{maximumFractionDigits:1})+" MB",o=Math.round(100*this._quality);jxt.warn(`Memory Limit exceeded! Limit: ${a(n)} Current: ${a(e)} Projected: ${a(e+t)} Quality: ${o}%`)}this._memoryUsed=e/n,this._memoryPredicted=(e+t)/n;const s=n-e;this._cacheStorage.maxSize=Math.max(0,s+1048576*this.additionalCacheMemory)}get test(){const e=this;return{cacheStorage:this._cacheStorage,resetQualityChanges:()=>{const t=e._numQualityChanges;return e._numQualityChanges=0,t}}}};d([f({constructOnly:!0})],kl.prototype,"view",void 0),d([f()],kl.prototype,"maxMemory",null),d([f()],kl.prototype,"additionalCacheMemory",null),d([f()],kl.prototype,"memoryFactor",null),d([f()],kl.prototype,"updating",null),d([f()],kl.prototype,"usedMemory",null),d([f()],kl.prototype,"_quality",void 0),d([f()],kl.prototype,"_memoryUsed",void 0),d([f()],kl.prototype,"_updating",void 0),d([f()],kl.prototype,"_stableQuality",void 0),d([f()],kl.prototype,"_maxMemory",void 0),d([f()],kl.prototype,"_additionalCacheMemory",void 0),kl=d([$("esri.views.3d.support.MemoryController")],kl);class Xxt{constructor(t){this.client=t,this._cancelled=!1,this.size=0,this.duration=0}}class Yxt{constructor(t){this.typeWorkerQuota=t,this.tasks=new Array,this.numWorkers=0,this.statistics=new Zxt}}class Zxt{constructor(){this.requests=0,this.size=0,this.duration=0,this.speed=0}}class Qxt{constructor(t,r,i,n){this._workerFunc=t,this._callbackFunc=r,this._maxTotalNumWorkers=i,this._totalNumWorkers=0,this._clients=n.map(s=>new Yxt(s))}hasQuota(t){const r=this._clients[t];return!!r&&(this._totalNumWorkers<this._maxTotalNumWorkers||r.numWorkers+r.tasks.length<r.typeWorkerQuota)}push(t){const r=this._clients[t.client];r&&(this._totalNumWorkers<this._maxTotalNumWorkers?(r.numWorkers++,this._totalNumWorkers++,this._workerFunc(t,(i,n)=>this._taskCallback(i,n))):r.tasks.push(t))}cancel(t){this._taskFinished(t),t._cancelled=!0}destroy(){this._clients.length=0}_taskFinished(t){const r=this._clients[t.client];this._totalNumWorkers--,r.numWorkers--,r.statistics.requests++,r.statistics.size+=t.size||0,r.statistics.duration+=t.duration||0,r.statistics.speed=r.statistics.duration>0?r.statistics.size/r.statistics.duration:0,pt(r.numWorkers>=0),this._next()}_next(){for(const t of this._clients)if(t&&t.numWorkers<t.typeWorkerQuota&&this._processQueue(t))return;for(const t of this._clients)if(t&&this._processQueue(t))return}_processQueue(t){for(;t.tasks.length>0;)if(this._workerFunc(t.tasks.shift(),(r,i)=>this._taskCallback(r,i)))return t.numWorkers++,this._totalNumWorkers++,!0;return!1}_taskCallback(t,r){t._cancelled||(this._callbackFunc(t,r),this._taskFinished(t))}getStatsForType(t){const r=this._clients[t];return r?{quota:r.typeWorkerQuota,workers:r.numWorkers,queueSize:r.tasks.length,requestStats:r.statistics}:null}get test(){const t=this;return{set workerFunc(r){t._workerFunc=r}}}}let _D=class extends xe{constructor(){super(...arguments),this._tasks=new Map,this._onLoadQueue=new Array,this._doneQueue=new Array,this.updating=!1}setup(e,t,r){this._loadQueue=new Qxt((i,n)=>this._startLoading(i,n),(i,n)=>this._doneLoadingCB(i,n),e,t),r&&(this._frameTask=r.registerTask(bt.STREAM_DATA_LOADER,this))}destroy(){this._frameTask=Ts(this._frameTask),this._tasks.forEach(e=>qh(e.abortController)),this._loadQueue=ct(this._loadQueue),this._onLoadQueue=null,this._doneQueue=null,this._tasks=null}hasDownloadSlots(e){return this._loadQueue.hasQuota(e)}request(e,t,r,i={}){const n=Op();n.__signal=_(i)?i.signal:null;const s=this._createOrUpdateTask(e,t,r,i,n);return Fo(i,()=>this._cancelRequest(s,n)),n.promise}_createTask(e,t,r,i,n,s){const a=new eTt(e,t,r,i,n);return this._updateTask(a,s),this._tasks.set(n,a),this._tasks.size===1&&this._set("updating",!0),this._loadQueue.push(a),a}_cancelRequest(e,t){iV(e.resolvers,t),t.reject(br()),e.resolvers.length===0&&(e.status===hh.DOWNLOADING&&(e.status=hh.CANCELLED,this._loadQueue.cancel(e),e.abortController.abort(),e.request=null,e.abortController=null),e.status=hh.CANCELLED,this._tasks.delete(e.key),this._tasks.size===0&&this._set("updating",!1))}_updateTask(e,t){e.resolvers.push(t)}_createOrUpdateTask(e,t,r,i,n){const s=tTt(_(i)&&i.uid||e,t,r),a=this._tasks.get(s);return a?(this._updateTask(a,n),a):this._createTask(e,i,t,r,s,n)}_doneLoadingCB(e,t){this._loadQueue&&(pt(e.status===hh.DOWNLOADING),e.status=hh.DOWNLOADED,this._frameTask?this._doneQueue.push({task:e,err:t}):this._doneLoading(e,t))}get running(){return this._doneQueue.length>0||this._onLoadQueue.length>0}runTask(e){for(;!e.done&&this._onLoadQueue.length>0;){const t=this._onLoadQueue.shift();Et(t.task.abortController),t.task.abortController=null,t.callback(t.task),e.madeProgress()}for(;!e.done&&this._doneQueue.length>0;){const t=this._doneQueue.shift();t.task.status!==hh.DOWNLOADED&&(t.err=t.err||br()),this._doneLoading(t.task,t.err),e.madeProgress()}}_doneLoading(e,t){if(t&&!Ui(t)&&e.numRetries>0)return--e.numRetries,void this._loadQueue.push(e);let r=e.result instanceof HTMLImageElement?0:e.resolvers.length;for(const i of e.resolvers)if(t)Ui(t)?i.reject(t):i.reject(new k("stream-data-loader:request-error",`Failed to request resource at '${e.url}'. ${t}`,{url:e.url,error:t}));else{--r;const n=r<=0?e.result:te(e.result);i.resolve(n)}this._tasks.delete(e.key),this._tasks.size===0&&this._set("updating",!1)}_startLoading(e,t){if(e.status===hh.CANCELLED)return!1;let r,i;switch(e.startTime=performance.now(),e.status=hh.DOWNLOADING,e.docType){case"binary":i="array-buffer",r=0;break;case"image":i="image";break;case"image+type":i="array-buffer";break;default:i="json"}e.abortController=new AbortController;const n=e.abortController.signal;e.request=qt(e.url,{...e.options,responseType:i,timeout:r,signal:n});let s=()=>{};const a=l=>{e.duration=performance.now()-e.startTime,e.size=l instanceof ArrayBuffer?l.byteLength:e.size||0,e.result=l,this._frameTask?this._onLoadQueue.push({callback:t,task:e}):(e.abortController=null,t(e))},o=l=>{e.status===hh.DOWNLOADING&&t(e,l),s()};return e.docType!=="image+type"?(e.request.then(l=>a(l.data),o),!0):(e.request.then(l=>{const c=l.data,u=Kxt(c);if(i="image",e.size=c.byteLength,u==="unknown")return e.request=qt(e.url,{responseType:i,timeout:r,signal:n}),void e.request.then(m=>a(m.data),o);const h=new Blob([c],{type:u}),p=window.URL.createObjectURL(h);s=()=>window.URL.revokeObjectURL(p),e.request=qt(p,{responseType:i,timeout:r,signal:n}),e.request.then(m=>a(new DU(m.data,u,s)),o)},o),!0)}get test(){return{loadQueue:this._loadQueue}}};d([f({readOnly:!0})],_D.prototype,"updating",void 0),_D=d([$("esri.views.3d.support.StreamDataLoader")],_D);const Jxt={numRetries:0};function Kxt(e){if(e.byteLength<2)return"unknown";const t=new Uint8Array(e,0,e.byteLength);return t[0]===137&&t[1]===80?"image/png":t[0]===71&&t[1]===73?"image/gif":t[0]===66&&t[1]===77?"image/bmp":t[0]===255&&t[1]===216?"image/jpeg":"unknown"}class DU{constructor(t,r,i){this.image=t,this.type=r,this.release=i}get isOpaque(){return this.type==="image/jpeg"}}class eTt extends Xxt{constructor(t,r,i,n,s){super(n),this.url=t,this.options=r,this.docType=i,this.key=s,this.result=null,this.status=hh.QUEUED,this.request=null,this.abortController=null,this.resolvers=new Array,this.startTime=0,this.numRetries=Jxt.numRetries}}function tTt(e,t,r){return`${e}:${t}:${r}`}var hh;(function(e){e[e.QUEUED=1]="QUEUED",e[e.DOWNLOADING=2]="DOWNLOADING",e[e.DOWNLOADED=3]="DOWNLOADED",e[e.CANCELLED=4]="CANCELLED"})(hh||(hh={}));let zI=class extends xe{constructor(){super(...arguments),this.updating=!1}};function rTt(e){return new wK.ResourceController({view:e})}var wK;d([f({readOnly:!0})],zI.prototype,"updating",void 0),zI=d([$("esri.views.3d.support.ResourceController")],zI),function(e){let t=class extends zI{constructor(){super(...arguments),this._scheduler=null,this._memoryController=null,this._streamDataLoader=null,this._scheduleTask=d9,this._cameraChangeTime=0,this._handles=new Ft,this._frameTask=null,this._state=Ks.IDLE}initialize(){this._cameraChangeTime=performance.now(),this._scheduler=Cat(),this._memoryController=qxt(this.view),this._streamDataLoader=new _D,this._streamDataLoader.setup(Gxt,Bxt,this._scheduler),this._handles.add([re(()=>{var i;return(i=this.view.state)==null?void 0:i.camera},(i,n)=>this._cameraChangedHandler(i,n),ti),re(()=>this.view.stationary,()=>this._stationaryChangedHandler())]),this._frameTask=Aw({update:i=>this._frame(i)}),this._scheduleTask=this._scheduler.registerTask(bt.RESOURCE_CONTROLLER)}destroy(){this._handles=ct(this._handles),this._scheduleTask.remove(),this._frameTask=Ts(this._frameTask),this._streamDataLoader=ct(this._streamDataLoader),this._memoryController=ct(this._memoryController),this._scheduler=ct(this._scheduler)}get updating(){var i,n,s;return!!(((i=this._memoryController)==null?void 0:i.updating)||((n=this._streamDataLoader)==null?void 0:n.updating)||((s=this._scheduleTask)==null?void 0:s.updating))}get scheduler(){return this._scheduler}get memoryController(){return this._memoryController}schedule(i,n,s){return this._scheduleTask.schedule(i,n,s)}createStreamDataRequester(i){const n=this._streamDataLoader;return{request:(s,a,o)=>n.request(s,a,i,o),get busy(){return!n.hasDownloadSlots(i)}}}_frame(i){this.view.suspended||this.view.stateManager&&(this.view.stateManager.step(Rte(i.deltaTime)),!this._scheduler)||(this._updateState(),this._scheduler.state=this._state,this._scheduler.updateBudget(i)?(this._memoryController.update(),this._scheduler.frame()):this._memoryController.updating&&this._memoryController.update())}_cameraChangedHandler(i,n){i&&n&&i.almostEquals(n)||(this._cameraChangeTime=performance.now(),this._updateState(),this._scheduler.state=this._state)}_stationaryChangedHandler(){this.memoryController.resetStableQuality()}_updateState(){this.view.animation?this._state=Ks.ANIMATING:this.view.interacting?this._state=Ks.INTERACTING:(this._state===Ks.ANIMATING&&(this._cameraChangeTime=0),performance.now()-this._cameraChangeTime<=r?this._state=Ks.INTERACTING:this._state=Ks.IDLE)}get test(){return{getQueueStats:i=>this._streamDataLoader.test.loadQueue.getStatsForType(i),state:this._state}}};d([f({constructOnly:!0})],t.prototype,"view",void 0),d([f()],t.prototype,"_scheduler",void 0),d([f()],t.prototype,"_memoryController",void 0),d([f()],t.prototype,"_streamDataLoader",void 0),d([f()],t.prototype,"_scheduleTask",void 0),d([f({readOnly:!0})],t.prototype,"updating",null),t=d([$("esri.views.3d.support.ResourceController")],t),e.ResourceController=t;const r=300}(wK||(wK={}));function iTt(e){return"performanceInfo"in e}const xT=M(),nTt=M(),Ym=M(),Zm=M();function sTt(e,t,r=0){const i=e.extent;if(R(i))return!1;if(r===0)return Rxe(i,t);const n=Math.min(i[2]-i[0],i[3]-i[1]);return fBe(i,t,r*n)}function UI(e,t,r,i){oe(xT,r),xT[i]=t[i];const n=pe(xT,xT,t),s=pe(nTt,e,t),a=Se(s,n),o=Se(n,n);let l;l=a<=0?t:o<=a?r:he(xT,t,le(n,n,a/o));const c=pe(xT,e,l);return Math.PI/2-Math.atan(c[2]/Math.sqrt(c[0]*c[0]+c[1]*c[1]))}function aTt(e,t,r){const i=e.extent;if(R(i))return 0;Ym[0]=i[0],Ym[1]=i[1],Ym[2]=r,Zm[0]=i[2],Zm[1]=i[3],Zm[2]=r;let n=1/0,s=1/0;return t[0]<Ym[0]?n=UI(t,Ym,Zm,0):t[0]>Zm[0]&&(n=UI(t,Zm,Ym,0)),t[1]<Ym[1]?s=UI(t,Ym,Zm,1):t[1]>Zm[1]&&(s=UI(t,Zm,Ym,1)),Math.min(n,s)}function oTt(e,t,r){if(R(e))return Hne();if(e.spatialReference.isGeographic&&!kw(e.spatialReference))return new k("tilingscheme:local-unsupported-spatial-reference","The tiling scheme spatial reference is not supported in local scenes");const i=Mi.checkUnsupported(e);if(_(i))return i;if(R(r))return new k("tilingscheme:extent-not-exist","The layer does not provide a layer extent.");const n=lTt(e,r);if(n)return n;const s=e.spatialReference;return _(t)&&!(s.equals(t)||t.isWGS84&&s.isWebMercator)?new k("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the local scene"):null}function lTt(e,t){const r=e.lods,i=r[0].resolution*2**r[0].level,n=[i*e.size[0],i*e.size[1]],s=[e.origin.x,e.origin.y],a=Cxe(t),o=zt();Mi.computeRowColExtent(a,n,s,o);const l=(o[2]-o[0])*(o[3]-o[1]);if(l>b4){const c=r[0].scale*2**r[0].level;let u=Math.max((a[3]-a[1])/e.size[1],(a[2]-a[0])/e.size[0])*c/i;const h=Math.floor(Math.log(u)/Math.log(10));return u=Math.ceil(u/10**h)*10**h,new k("tilingscheme:too-many-root-tiles","Scale of level 0 of the tiling scheme (1:"+Math.floor(c).toLocaleString()+") is too large for the layer's extent. Suggested scale: 1:"+u.toLocaleString()+".",{level0Scale:c,suggestedLevel0Scale:u,requiredNumRootTiles:l,allowedNumRootTiles:b4})}return null}const cTt=Object.freeze(Object.defineProperty({__proto__:null,isInsideExtent:sTt,tiltToExtentEdge:aTt,checkIfTileInfoSupportedForViewSR:oTt},Symbol.toStringTag,{value:"Module"}));function dTt(){return!0}function uTt(){return 0}function hTt(e,t){if(R(e))return Hne();const r=e.lods.length-1,i=e.spatialReference,n=kw(i)||Sm(i)||Em(i);if(i.isWebMercator){if(!Mi.makeWebMercatorAuxiliarySphere(r).compatibleWith(e))return new k("tilingscheme:incompatible-global-web-mercator","The tiling scheme is not compatible with the ArcGIS Online Web Mercator tiling scheme")}else{if(!n)return new k("tilingscheme:global-unsupported-spatial-reference","The tiling scheme spatial reference is not supported in global scenes");if(!Mi.makeGCSWithTileSize(e.spatialReference,e.size[0],r).compatibleWith(e))return e.spatialReference.isWGS84?new k("tilingscheme:incompatible-global-wgs84","The tiling scheme is not compatible with the ArcGIS Online WGS84 tiling scheme"):new k("tilingscheme:incompatible-global","The tiling scheme is not compatible with the ArcGIS Online tiling scheme")}return _(t)&&!e.spatialReference.equals(t)?new k("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the global scene"):void 0}const fTt=Object.freeze(Object.defineProperty({__proto__:null,isInsideExtent:dTt,tiltToExtentEdge:uTt,checkIfTileInfoSupportedForViewSR:hTt},Symbol.toStringTag,{value:"Module"})),pTt={[Be.Global]:fTt,[Be.Local]:cTt};function V0(e,t){e||console.warn("Terrain: "+t)}function xK(e){return FU(e)?{fullExtent:e.fullExtent,minScale:e.layer.minScale,maxScale:e.layer.maxScale,tilemapCache:null}:e.layer}function Ck(e){return(e==null?void 0:e.type)==="imagery-tile"||(e==null?void 0:e.type)==="wcs"}function FU(e){return(e==null?void 0:e.type)==="imagery-tile-3d"}function zae(e){return(e==null?void 0:e.type)==="tile-3d"}function _R(e){return(e==null?void 0:e.type)==="vector-tile-3d"}function YOe(e){return(e==null?void 0:e.type)==="wmts-3d"}function TK(e){return(e==null?void 0:e.type)==="elevation-3d"}function ZOe(e){return(e==null?void 0:e.type)==="group"}function Ak(e){return e&&(zae(e)||YOe(e)||FU(e)||_R(e))}function SK(e){return e&&(zae(e)||FU(e)||_R(e)||YOe(e))}function wR(e){return SK(e)||TK(e)}function KLt(e){switch(e.type){case"building-scene":case"csv":case"feature":case"geo-rss":case"geojson":case"graphics":case"group":case"integrated-mesh":case"kml":case"line-of-sight":case"map-notes":case"ogc-feature":case"point-cloud":case"route":case"scene":case"stream":case"voxel":case"subtype-group":case"unknown":case"unsupported":case"wfs":case null:return!1;case"base-dynamic":case"base-elevation":case"base-tile":case"bing-maps":case"elevation":case"imagery":case"imagery-tile":case"map-image":case"media":case"open-street-map":case"tile":case"vector-tile":case"wcs":case"web-tile":case"wms":case"wmts":return!0;default:return e.type,!1}}function mTt(e){var r;const t=(r=e==null?void 0:e.sourceLayerInfo)==null?void 0:r.data;return _(t)&&"type"in t&&t.type==="raster-tile"}function gTt(e){var r;const t=(r=e==null?void 0:e.sourceLayerInfo)==null?void 0:r.data;return _(t)&&"type"in t&&t.type==="vector-tile"}function yTt(e){var r;const t=(r=e==null?void 0:e.sourceLayerInfo)==null?void 0:r.data;return _(t)&&"type"in t&&t.type==="tile-texture"}function bTt(e){var r;const t=(r=e==null?void 0:e.sourceLayerInfo)==null?void 0:r.data;return t instanceof HTMLImageElement||t instanceof DU||t instanceof HTMLCanvasElement||t instanceof ImageData}function a5(e){return _(e)&&"release"in e&&e.release(),null}function lye(e){return e.fetchTile&&e.hasOverriddenFetchTile!==!1}function xR(e,t,r,i){return pTt[i].checkIfTileInfoSupportedForViewSR(e,r,t)}function NU(e,t,r){let i=null,n=null;if((e==null?void 0:e.type)==="wmts"){const s=QOe(e,t,r);i=s.tileInfo,n=s.fullExtent}else{n=Ck(e)?e.getCompatibleFullExtent(t):e.fullExtent;const s=r===Be.Local;if(Ck(e))i=e.getCompatibleTileInfo(t,n,s);else if((e==null?void 0:e.type)==="vector-tile"){const a=s&&!vTt(t)||_Tt.force512VTL,o=e.tileInfo.spatialReference.isGeographic;i=a?e.tileInfo:e.tileInfo.getOrCreateCompatible(256,o?1:2)}else i=e.tileInfo}return _(i)&&_(n)&&xR(i,n,t,r)==null?{tileInfo:i,fullExtent:n}:null}function QOe(e,t,r){const i=OVe(e);if(_(i)){if(!lt.isCollection(i))return{tileInfo:i.tileInfo,fullExtent:i.fullExtent};{const n=i.find(s=>xR(s.tileInfo,s.fullExtent,t,r)==null);if(n)return{tileInfo:n.tileInfo,fullExtent:n.fullExtent}}}return{tileInfo:null,fullExtent:null}}function vTt(e){return e.isWGS84||e.isWebMercator||z3e(e)||!nA(e)}const _Tt={force512VTL:!1};function Rk(e){return e===Bt.NORTH_EAST?Bt.SOUTH_WEST:e===Bt.NORTH_WEST?Bt.SOUTH_EAST:e===Bt.SOUTH_WEST?Bt.NORTH_EAST:Bt.NORTH_WEST}function wD(e){return e===Bt.NORTH?Bt.SOUTH:e===Bt.EAST?Bt.WEST:e===Bt.SOUTH?Bt.NORTH:Bt.EAST}function wTt(e){return e===Bt.NORTH_WEST||e===Bt.SOUTH_WEST}function xTt(e){return e===Bt.NORTH_WEST||e===Bt.NORTH_EAST}function cye(e){return e===Bt.NORTH_WEST||e===Bt.WEST||e===Bt.SOUTH_WEST}function dye(e){return e===Bt.NORTH_EAST||e===Bt.EAST||e===Bt.SOUTH_EAST}function uye(e){return e===Bt.SOUTH_EAST||e===Bt.SOUTH||e===Bt.SOUTH_WEST}function hye(e){return e===Bt.NORTH_EAST||e===Bt.NORTH||e===Bt.NORTH_WEST}const Z1=[Bt.NORTH,Bt.EAST,Bt.SOUTH,Bt.WEST],Ok=[Bt.NORTH_EAST,Bt.SOUTH_EAST,Bt.SOUTH_WEST,Bt.NORTH_WEST];class TTt{constructor(t,r){if(this.layer=null,this.memory=0,this.displayedNumberOfFeatures=0,this.maximumNumberOfFeatures=null,this.totalNumberOfFeatures=null,this.layer=t.layer,this.memory=wR(t)?r.basemapTerrain.getUsedMemoryForLayerView(t):t.getUsedMemory(),iTt(t)){const i=t.performanceInfo;this.displayedNumberOfFeatures=i.displayedNumberOfFeatures,this.maximumNumberOfFeatures=i.maximumNumberOfFeatures,this.totalNumberOfFeatures=i.totalNumberOfFeatures}}}class STt{constructor(t){this.totalMemory=0,this.usedMemory=0,this.quality=1,this.load=0,this.terrainMemory=0,this.edgesMemory=0,this.layerPerformanceInfos=new Array;const r=t.resourceController.memoryController;this.totalMemory=r.maxMemory*e9.MEGABYTES,this.usedMemory=Math.round(r.usedMemory*this.totalMemory),this.quality=r.memoryFactor,this.load=t.resourceController.scheduler.load,this.terrainMemory=t.basemapTerrain?t.basemapTerrain.getUsedMemory():0;const i=t._stage&&t._stage.renderView&&t._stage.renderView.edgeView;this.edgesMemory=_(i)?i.usedMemory:0,t.allLayerViews.items.forEach(n=>{(XOe(n)||wR(n))&&this.layerPerformanceInfos.push(new TTt(n,t))}),this.layerPerformanceInfos.sort((n,s)=>s.memory-n.memory)}}class ETt extends v4{constructor(t,r,i,n){super(r,n),this._streamDataRequester=t,this._parameters=i}async fromUrl(t,r,i){Et(i);const n=_(i)&&i.signal,s=this.makeUid(t,r);let a=this._textureRequests.get(s);if(!a){const o=new AbortController,l=this._streamDataRequester.request(t,"image",{uid:s,signal:o.signal});a={referenceCount:0,texture:null,textureAsync:null,abortController:o},this._textureRequests.set(s,a),a.textureAsync=l.then(async c=>{const u=this._createTexture(t,c,r);return a.texture=u,a.abortController=null,this._stage.add(u),await this._stage.load(u),{uid:s,texture:u,release:()=>this._release(s)}},c=>{throw a.abortController=null,c})}return a.referenceCount++,new Promise((o,l)=>{Fo(n,()=>{l(br())}),a.textureAsync.then(o,l)}).catch(o=>{throw this._release(s),o})}_createTexture(t,r,i){const n={...this._parameters,powerOfTwoResizeMode:Dv.PAD};if(qte(t)){if(i||r.width===0&&r.height===0){const s=r.width?r.height/r.width:1;i=i||64,s>1?(r.width=Math.round(i/s),r.height=i):(r.width=i,r.height=Math.round(i*s))}this._stage.renderView&&this._stage.renderView.renderingContext.driverTest.svgAlwaysPremultipliesAlpha&&(n.preMultiplyAlpha=!1)}return n.width=r.width,n.height=r.height,new Hn(r,n)}}class CTt{constructor(t){this.textures=null,this.streamDataRequester=null,this.graphicsOwners=[],this.screenSizePerspectiveHandles=null,this.cimSymbolRasterizer=null,this.viewState=t.viewState,this.view=t.view,this.pointsOfInterest=t.pointsOfInterest,this.objectResourceCache=t.objectResourceCache,this.streamDataRequester=t.resourceController.createStreamDataRequester(H0.SYMBOLOGY),this.textures=new ETt(this.streamDataRequester,t.view._stage,{preMultiplyAlpha:!0,wrap:{s:xt.CLAMP_TO_EDGE,t:xt.CLAMP_TO_EDGE}},t.resourceController.scheduler);const r=Ar(this.view.spatialReference).radius;this.screenSizePerspectiveSettings=D7e(t.viewingMode,r),this.screenSizePerspectiveSettingsLabels=d0t(t.viewingMode,r)}destroy(){this.textures.destroy(),this.textures=null,this.streamDataRequester=null}addGraphicsOwner(t){if(!t)return Hh();this.graphicsOwners.push(t);const r=re(()=>{var i;return(i=t.layer)==null?void 0:i.screenSizePerspectiveEnabled},()=>this._updateScreenSizePerspectiveEnabled());return this._updateScreenSizePerspectiveEnabled(),Hh(()=>{r.remove(),iV(this.graphicsOwners,t),this._updateScreenSizePerspectiveEnabled()})}_updateScreenSizePerspectiveEnabled(){const t=this.graphicsOwners.some(r=>{var i;return((i=r.layer)==null?void 0:i.screenSizePerspectiveEnabled)===!0});if(t&&!this.screenSizePerspectiveHandles){this.screenSizePerspectiveHandles=new Ft;const r=()=>this._updateScreenSizePerspectiveSettings();this.screenSizePerspectiveHandles.add([re(()=>this.pointsOfInterest.centerOnSurfaceInfrequent.distance,r,ti),this.viewState.events.on("camera-projection-changed",r)]),this._updateScreenSizePerspectiveSettings()}else!t&&this.screenSizePerspectiveHandles&&(this.screenSizePerspectiveHandles.destroy(),this.screenSizePerspectiveHandles=null)}_updateScreenSizePerspectiveSettings(){const t=this.pointsOfInterest;BI.distance=t.centerOnSurfaceInfrequent.distance,BI.fovY=this.viewState.camera.fovY,this.screenSizePerspectiveSettings.update(BI),this.screenSizePerspectiveSettingsLabels.update(BI),this.view._stage.renderView.requestRender()}get test(){return{screenSizePerspectiveHandles:this.screenSizePerspectiveHandles}}}const BI={distance:0,fovY:0};class b1{constructor(t,r,i=""){this.graphics=t,this._symbol=new Y0({symbolLayers:[new Qg({material:{color:r},outline:{color:[255,255,255],size:1},resource:{primitive:"circle"}}),new Tx({text:i,halo:{color:"white",size:1/.75},material:{color:r},size:12})]})}show(t,r){if(R(r))return;this.hide();const i=new ot({x:t[0],y:t[1],z:t[2],spatialReference:r});this._graphic=new co({geometry:i,symbol:this._symbol}),this.graphics.add(this._graphic)}hide(){_(this._graphic)&&(this.graphics.remove(this._graphic),this._graphic=null)}}let Q1=class extends xe{constructor(e){super(e),this.handles=new Ft}destroy(){this.handles.destroy()}};d([f({constructOnly:!0})],Q1.prototype,"renderCoordsHelper",void 0),d([f({constructOnly:!0})],Q1.prototype,"surface",void 0),d([f({constructOnly:!0})],Q1.prototype,"state",void 0),Q1=d([$("esri.views.3d.support.PointOfInterest")],Q1);const ATt=Array;let jd=class extends Q1{constructor(e){super(e),this._dirty=!1,this._propertiesPool=new Ly({location:ot,renderLocation:ATt},this),this._estimatedSurfaceAltitude=0,this._pendingElevationQueryController=null,this.cameraName="camera",this.renderLocation=M(),this.tmpPoint=new ot}initialize(){if(this.scheduler&&this.handles.add(this.scheduler.registerTask(this.task,this)),this.runTask(),this.map){const e=()=>this._setDirty();this.handles.add(rn(()=>{var t,r;return(r=(t=this.map)==null?void 0:t.ground)==null?void 0:r.layers},"change",e,{onListenerAdd:e,onListenerRemove:e}))}this._updateRenderLocation()}destroy(){this._cancelPendingRequest(),this._propertiesPool.destroy(),this._propertiesPool=null}get _camera(){return this.state[this.cameraName]}get location(){const e=this._propertiesPool.get("location");return this.renderCoordsHelper.fromRenderCoords(this.renderLocation,e,this.state.spatialReference),e}get scale(){const e=this._camera,t=fi(e.eye,this.renderLocation),r={renderCoordsHelper:this.renderCoordsHelper,state:{camera:e}};return ix(r,t,0)}get updating(){return this._dirty||this._pendingElevationQueryController!=null}updateRenderLocation(){this._setDirty(),this._updateRenderLocation()}_setDirty(){this._dirty||(this._dirty=!0,this.notifyChange("updating"))}_cancelPendingRequest(){const e=this._pendingElevationQueryController;e&&(this._pendingElevationQueryController=null,e.abort(),this.notifyChange("updating"))}get running(){return!this._pendingElevationQueryController&&this._dirty}runTask(){if(this._cancelPendingRequest(),this._dirty=!1,this.notifyChange("updating"),!this.map||!this.map.ground)return void this._updateSurfaceAltitude(0);this.renderCoordsHelper.fromRenderCoords(this._camera.eye,this.tmpPoint,this.state.spatialReference);let e=new AbortController;this.map.ground.queryElevation(this.tmpPoint,{signal:e.signal,cache:this.cache}).then(t=>this._updateSurfaceAltitude(t.geometry.z)).catch(t=>{Ui(t)||this._updateSurfaceAltitude(0)}).catch(()=>{}).then(()=>{this._pendingElevationQueryController===e&&(this._pendingElevationQueryController=null,this.notifyChange("updating")),e=null}),this._pendingElevationQueryController=e}_updateSurfaceAltitude(e){this._estimatedSurfaceAltitude!==e&&(this._estimatedSurfaceAltitude=e,this._updateRenderLocation())}_updateRenderLocation(){this.renderCoordsHelper.setAltitude(sH,this._estimatedSurfaceAltitude,this._camera.eye),Kl(this._get("renderLocation"),sH)||this._set("renderLocation",oe(this._propertiesPool.get("renderLocation"),sH))}};d([f({constructOnly:!0})],jd.prototype,"scheduler",void 0),d([f({constructOnly:!0})],jd.prototype,"cache",void 0),d([f({constructOnly:!0})],jd.prototype,"task",void 0),d([f({constructOnly:!0})],jd.prototype,"cameraName",void 0),d([f({readOnly:!0})],jd.prototype,"location",null),d([f({constructOnly:!0})],jd.prototype,"map",void 0),d([f({readOnly:!0})],jd.prototype,"renderLocation",void 0),d([f({readOnly:!0})],jd.prototype,"scale",null),d([f({readOnly:!0})],jd.prototype,"updating",null),jd=d([$("esri.views.3d.support.CameraOnSurface")],jd);const sH=M(),RTt=Array;let Vc=class extends Q1{constructor(e){super(e),this._propertiesPool=new Ly({location:ot,renderLocation:RTt},this),this._currentSurfaceAltitude=0,this._latestSurfaceAltitude=0,this.cameraName="camera",this.distance=0,this.renderLocation=M(),this.updating=!1}initialize(){this._frameWorker=this.scheduler.registerTask(this.task,this),this.runTask()}destroy(){this._frameWorker=Ts(this._frameWorker),this._propertiesPool=ct(this._propertiesPool)}get _camera(){return this.state[this.cameraName]}get location(){const e=this._propertiesPool.get("location");return this.renderCoordsHelper.fromRenderCoords(this.renderLocation,e,this.state.spatialReference),e}updateRenderLocation(){this.updating=!0,this._updateRenderLocation()}get estimatedSurfaceAltitude(){return this._latestSurfaceAltitude}get running(){return this.updating}runTask(){this._latestSurfaceAltitude=this.estimateSurfaceAltitudeAtCenter(),this._updateRenderLocation(),this.updating=!1}_updateRenderLocation(){const e=MTt;let t=this._calculateSurfaceIntersection(this._currentSurfaceAltitude,e);const r=this._currentSurfaceAltitude!==this._latestSurfaceAltitude;!t&&r&&(t=this._calculateSurfaceIntersection(this._latestSurfaceAltitude,e),t&&(this._currentSurfaceAltitude=this._latestSurfaceAltitude));const i=PTt;t&&this._latestSurfaceAltitudeChangesDistanceSignificantly(e,i)&&(oe(e,i),this._currentSurfaceAltitude=this._latestSurfaceAltitude),t?this.distance=fi(this._camera.eye,e):(le(e,this._camera.viewForward,this._get("distance")),he(e,e,this._camera.eye)),Kl(this._get("renderLocation"),e)||this._set("renderLocation",oe(this._propertiesPool.get("renderLocation"),e))}_calculateSurfaceIntersection(e,t){const r=this._camera;if(!this.renderCoordsHelper.intersectManifold(r.ray,e,t))return!1;if(this.state.isGlobal){const i=Ar(this.renderCoordsHelper.spatialReference).radius,n=i+e,s=fl(r.eye),a=s<n*n,o=fi(r.eye,t);if(a&&o>i/4){const l=n-Math.sqrt(s);return le(t,r.viewForward,l),he(t,t,r.eye),!0}}else{const i=this.surface.ready?this.surface.extent:null;_(i)&&zV(i,this.surface.spatialReference,D8,this.renderCoordsHelper.spatialReference)&&(t[0]=Le(t[0],D8[0],D8[2]),t[1]=Le(t[1],D8[1],D8[3]))}return!0}_latestSurfaceAltitudeChangesDistanceSignificantly(e,t){if(this._latestSurfaceAltitude===this._currentSurfaceAltitude||e==null)return!1;if(this._calculateSurfaceIntersection(this._latestSurfaceAltitude,t)){if(Yr.TESTS_DISABLE_OPTIMIZATIONS)return!0;const r=this._camera.eye,i=fi(r,e),n=fi(r,t);if(Math.abs(n-i)/i>OTt)return!0}return!1}};d([f({constructOnly:!0})],Vc.prototype,"scheduler",void 0),d([f({constructOnly:!0})],Vc.prototype,"task",void 0),d([f({constructOnly:!0})],Vc.prototype,"cameraName",void 0),d([f()],Vc.prototype,"distance",void 0),d([f({constructOnly:!0})],Vc.prototype,"estimateSurfaceAltitudeAtCenter",void 0),d([f({readOnly:!0})],Vc.prototype,"location",null),d([f({readOnly:!0})],Vc.prototype,"renderLocation",void 0),d([f()],Vc.prototype,"updating",void 0),Vc=d([$("esri.views.3d.support.CenterOnSurface")],Vc);const OTt=.05,MTt=M(),PTt=M(),D8=zt();class ITt{constructor(t){this.handles=new Ft,this.events=new mn,this.contentLayerViews=t.contentLayerViews,this.handles.add(this.contentLayerViews.on("change",r=>this._layerViewsChanged(r))),this._layerViewsChanged({added:this.contentLayerViews.toArray(),removed:[],moved:[],target:this.contentLayerViews})}destroy(){this.handles&&(this.handles.destroy(),this.handles=null)}_layerViewsChanged(t){t.added.forEach(r=>{r.declaredClass==="esri.views.3d.layers.SceneLayerView3D"&&this.handles.add(r.on("visible-geometry-changed",()=>this._contentChanged()),r.uid)}),t.removed.forEach(r=>this.handles.remove(r.uid))}_contentChanged(){this.events.emit("request-update",$Tt)}}const $Tt={},LTt=Array;let E0=class extends Q1{constructor(e){super(e),this._propertiesPool=new Ly({location:ot,renderLocation:LTt},this),this._dirty=!0,this.renderLocation=this._propertiesPool.get("renderLocation")}initialize(){this.handles.add([re(()=>this.centerOnSurface.renderLocation,()=>this.updateRenderLocation()),re(()=>this.state.contentCamera,()=>this.updateRenderLocation())]),this.scheduler&&this.handles.add(this.scheduler.registerTask(bt.POINT_OF_INTEREST_FREQUENT,this))}destroy(){this._propertiesPool.destroy(),this._propertiesPool=null}get updating(){return this._dirty||this.centerOnSurface.updating}get location(){const e=this._propertiesPool.get("location");return this.renderCoordsHelper.fromRenderCoords(this.renderLocation,e,this.state.spatialReference),e}get running(){return this._dirty}runTask(){const e=this._get("renderLocation"),t=this.centerOnSurface.renderLocation,r=this.renderCoordsHelper,i=this.state.contentCamera;this._dirty=!1,r.worldUpAtPosition(t,fye);const n=Math.max(0,(Math.acos(Se(fye,i.viewForward))-.5*Math.PI)*(i.aboveGround?1:-1));if(Number.isNaN(n)){if(!e||!Lw(e,t)){const l=this._propertiesPool.get("renderLocation");oe(l,t),this._set("renderLocation",l)}return}const s=1-Le(n/(.5*Math.PI),0,1),a=s*s*s;this._calculateScreenHorizontalEdgeOnSurface(pye);const o=this._propertiesPool.get("renderLocation");As(o,t,pye,a),e&&Lw(e,o)||this._set("renderLocation",o)}_calculateScreenHorizontalEdgeOnSurface(e){const t=this.state.contentCamera,r=t.getRenderCenter(ro());if(r[1]=t.aboveGround?t.padding[Mt.BOTTOM]:t.fullHeight-t.padding[Mt.TOP],this.estimateSurfaceIntersectionAtRenderPoint(r,e))return e;const i=this.renderCoordsHelper.getAltitude(this.centerOnSurface.renderLocation);if(t.unprojectFromRenderScreen(r,F8)){pe(F8,F8,t.eye);const n=we(F8,F8);if(this.renderCoordsHelper.intersectManifold(Ru(t.eye,n),i,e))return e}return this.renderCoordsHelper.setAltitude(e,i,t.eye)}updateRenderLocation(){this._dirty=!0}};d([f()],E0.prototype,"_dirty",void 0),d([f({constructOnly:!0})],E0.prototype,"scheduler",void 0),d([f({constructOnly:!0})],E0.prototype,"centerOnSurface",void 0),d([f({constructOnly:!0})],E0.prototype,"estimateSurfaceIntersectionAtRenderPoint",void 0),d([f({readOnly:!0})],E0.prototype,"updating",null),d([f({readOnly:!0})],E0.prototype,"location",null),d([f({readOnly:!0})],E0.prototype,"renderLocation",void 0),E0=d([$("esri.views.3d.support.CenterOnSurface")],E0);const fye=M(),F8=M(),pye=M();let xg=class extends xe{constructor(e){super(e),this.location=null,this._updateController=null,this._handles=new Ft}get renderLocation(){if(!this.location)return null;const e=M();return this.view.renderCoordsHelper.toRenderCoords(this.location,e),e}initialize(){this.view.state.isLocal&&(this._handles.add([re(()=>{var e,t;return[(e=this.surfaceView)==null?void 0:e.spatialReference,(t=this.surfaceView)==null?void 0:t.extent]},()=>this._update()),rn(()=>{var e;return(e=this.surface)==null?void 0:e.layers},"change",()=>this._update())]),this._update())}destroy(){this._handles.destroy()}_update(){if(this._updateController&&(this._updateController.abort(),this._updateController=null),!this.surfaceView||R(this.surfaceView.extent)||!this.surfaceView.spatialReference)return void this._set("location",null);const e=Ire(this.surfaceView.extent),t=new ot({x:e[0],y:e[1],z:0,spatialReference:this.surfaceView.spatialReference});this.surface&&this.surface.layers.length>0?(this._set("location",null),this._updateController=new AbortController,this.surface.queryElevation(t,{noDataValue:0,signal:this._updateController.signal,cache:this.cache}).then(r=>{this._updateController=null,this._set("location",r.geometry)}).catch(r=>{Ui(r)||r&&r.name==="elevation-query:invalid-layer"||console.error("StableSurfaceCenter failed to update: ",r)})):this._set("location",t)}};d([f({constructOnly:!0})],xg.prototype,"view",void 0),d([f({constructOnly:!0})],xg.prototype,"cache",void 0),d([f({readOnly:!0,aliasOf:"view.map.ground"})],xg.prototype,"surface",void 0),d([f({readOnly:!0,aliasOf:"view.basemapTerrain"})],xg.prototype,"surfaceView",void 0),d([f({readOnly:!0})],xg.prototype,"location",void 0),d([f({readOnly:!0})],xg.prototype,"renderLocation",null),xg=d([$("esri.views.3d.terrain.StableSurfaceCenter")],xg);let Tg=class extends xe{constructor(){super(...arguments),this.handles=new Ft,this._tileGeometryUpdateExtent=Eu(),this._tileGeometryUpdateSpatialReference=null,this.events=new mn,this.updating=!1}initialize(){this.handles.add([this.surface.on("elevation-change",e=>this._tileGeometryChanged(e)),this.scheduler.registerTask(bt.SURFACE_GEOMETRY_UPDATES,this)])}destroy(){this.handles=ct(this.handles)}get running(){return this.updating}runTask(){this.updating&&(this._centerIntersectsExtent(this._tileGeometryUpdateExtent,this._tileGeometryUpdateSpatialReference)&&this.events.emit("request-update",DTt),Eu(this._tileGeometryUpdateExtent),this._set("updating",!1))}_tileGeometryChanged(e){this._tileGeometryUpdateSpatialReference=e.spatialReference,nw(this._tileGeometryUpdateExtent,e.tile.extent,this._tileGeometryUpdateExtent),this._set("updating",!0)}_furthestCenterOnSurface(){let e=this.centerOnSurfaces[0];for(let t=1;t<this.centerOnSurfaces.length;t++){const r=this.centerOnSurfaces[t];r.distance>e.distance&&(e=r)}return e}_centerIntersectsExtent(e,t){const r=this.state.camera.eye,i=FTt,n=this._furthestCenterOnSurface();return this.renderCoordsHelper.fromRenderCoords(r,a2,t),this.renderCoordsHelper.fromRenderCoords(n.renderLocation,o2,t),a2[0]<o2[0]?(i[0]=a2[0],i[2]=o2[0]):(i[0]=o2[0],i[2]=a2[0]),a2[1]<o2[1]?(i[1]=a2[1],i[3]=o2[1]):(i[1]=o2[1],i[3]=a2[1]),KR(i,e)}};d([f({constructOnly:!0})],Tg.prototype,"state",void 0),d([f({constructOnly:!0})],Tg.prototype,"centerOnSurfaces",void 0),d([f({constructOnly:!0})],Tg.prototype,"renderCoordsHelper",void 0),d([f({constructOnly:!0})],Tg.prototype,"scheduler",void 0),d([f({constructOnly:!0})],Tg.prototype,"surface",void 0),d([f({readOnly:!0})],Tg.prototype,"updating",void 0),Tg=d([$("esri.views.3d.support.SurfaceGeometryUpdates")],Tg);const DTt={},a2=M(),o2=M(),FTt=Eu();let To=class extends xe{constructor(e){super(e),this._handles=new Ft,this._tmpRay=Ma(),this._centerRayDirty=!0,this._surfaceAltitudeAtCenter=0,this._surfaceAltitudeAtCenterDirty=!0,this._contentAltitudeAtCenter=0,this._contentAltitudeAtCenterDirty=!0,this._propertiesPool=new Ly({renderPointOfView:NTt},this),this.renderPointOfView=M(),this._pois=new Array,this._debugCenters=new Map}initialize(){var c;const{state:e,basemapTerrain:t,renderCoordsHelper:r,map:i}=this.view;this._surfaceIntersector=tf(e.viewingMode),e.isGlobal?this._surfaceIntersector.options.backfacesTerrain=!1:this._surfaceIntersector.options.backfacesTerrain=!0,this._surfaceIntersector.options.invisibleTerrain=!1,this._surfaceIntersector.options.store=Da.MIN,this._contentIntersector=tf(e.viewingMode);const n=()=>this._estimateSurfaceAltitudeAtCenter(),s=this.view.resourceController.scheduler,a=(c=this.view.basemapTerrain)==null?void 0:c.elevationQueryCache,o={state:e,scheduler:s,surface:t,renderCoordsHelper:r};this._set("centerOnSurfaceInfrequent",new Vc({...o,task:bt.POINT_OF_INTEREST_INFREQUENT,estimateSurfaceAltitudeAtCenter:n})),this._set("centerOnSurfaceFrequent",new Vc({...o,task:bt.POINT_OF_INTEREST_FREQUENT,estimateSurfaceAltitudeAtCenter:n})),this._set("contentCenterOnSurface",new Vc({...o,task:bt.POINT_OF_INTEREST_INFREQUENT,estimateSurfaceAltitudeAtCenter:n,cameraName:"contentCamera"})),this._set("centerOnContent",new Vc({...o,task:bt.POINT_OF_INTEREST_FREQUENT,estimateSurfaceAltitudeAtCenter:()=>this._estimateContentAltitudeAtCenter()})),this._set("cameraOnSurface",new jd({...o,cache:a,task:bt.POINT_OF_INTEREST_INFREQUENT,map:i})),this._set("contentCameraOnSurface",new jd({...o,cache:a,task:bt.POINT_OF_INTEREST_INFREQUENT,map:i,cameraName:"contentCamera"})),this._set("surfaceGeometryUpdates",new Tg({...o,centerOnSurfaces:[this.centerOnSurfaceFrequent,this.centerOnContent,this.centerOnSurfaceInfrequent]})),this._set("contentGeometryUpdates",new ITt({contentLayerViews:this.view.allLayerViews,renderCoordsHelper:r})),this._set("surfaceOrigin",new xg({cache:a,view:this.view})),this._set("focus",new E0({state:e,scheduler:s,surface:t,renderCoordsHelper:r,centerOnSurface:this.contentCenterOnSurface,estimateSurfaceIntersectionAtRenderPoint:(u,h)=>this._estimateSurfaceIntersectionAtRenderPoint(u,this.view.state.contentCamera,h)})),this._pois.push(this.centerOnContent,this.centerOnSurfaceFrequent,this.centerOnSurfaceInfrequent,this.contentCenterOnSurface,this.cameraOnSurface,this.contentCameraOnSurface,this.focus);const l=this.view.graphics;this._debugCenters.set(this.centerOnContent,new b1(l,"red","CenterOnContent")),this._debugCenters.set(this.centerOnSurfaceFrequent,new b1(l,"red","CenterOnSurface")),this._debugCenters.set(this.centerOnSurfaceInfrequent,new b1(l,"red","CenterOnSurface")),this._debugCenters.set(this.contentCenterOnSurface,new b1(l,"red","ContentCenterOnSurface")),this._debugCenters.set(this.cameraOnSurface,new b1(l,"blue","CameraOnSurface")),this._debugCenters.set(this.contentCameraOnSurface,new b1(l,"blue","ContentCameraOnSurface")),this._debugCenters.set(this.focus,new b1(l,"green","Focus")),this._handles.add([re(()=>e.camera,u=>this._cameraChanged(u),ti),re(()=>t.extent,()=>this._updateCenterPointsOfInterest()),Fa(()=>!t.updating,()=>this._updateCenterPointsOfInterest(),ti),rn(()=>this.surfaceGeometryUpdates.events,"request-update",()=>this._updateCenterPointsOfInterest()),rn(()=>this.contentGeometryUpdates.events,"request-update",()=>this._updateCenterOnContent()),Fa(()=>Yr.SHOW_POI,u=>this._setDebug(u),Ot)]),this._cameraChanged(this.view.state.camera);for(const u of this._pois)u.runTask()}destroy(){this._setDebug(!1),this._handles.destroy(),this._propertiesPool.destroy();for(const e of this._pois)e.destroy();this.surfaceOrigin.destroy()}get updating(){var e;return!(!((e=this.surfaceGeometryUpdates)!=null&&e.updating)&&!this._pois.some(t=>t.updating))}get centerRay(){return this._centerRayDirty&&(this._centerRay=this.view.sceneIntersectionHelper.getCenterRayWithSubpixelOffset(this.view.state.camera,this._tmpRay),this._centerRayDirty=!1),this._centerRay}_estimateContentAltitudeAtCenter(){if(!this._contentAltitudeAtCenterDirty)return this._contentAltitudeAtCenter;this._contentAltitudeAtCenterDirty=!1;const e=this.centerRay;return R(e)||(this.view.sceneIntersectionHelper.intersectRay(e,this._contentIntersector,TT,VTt)?this._contentAltitudeAtCenter=this.view.renderCoordsHelper.getAltitude(TT):this._contentAltitudeAtCenter=this._estimateSurfaceAltitudeAtCenter()),this._contentAltitudeAtCenter}_estimateSurfaceAltitudeAtCenter(){if(!this.view.basemapTerrain)return 0;if(!this._surfaceAltitudeAtCenterDirty)return this._surfaceAltitudeAtCenter;this._surfaceAltitudeAtCenterDirty=!1;const e=this.centerRay;if(R(e))return this._surfaceAltitudeAtCenter;const t=e.origin,r=he(TT,e.origin,e.direction);return this._surfaceIntersector.resetWithRay(e,this.view.state.camera),this.view.basemapTerrain.intersect(this._surfaceIntersector,null,t,r),this._surfaceIntersector.results.min.getIntersectionPoint(TT)&&(this._surfaceAltitudeAtCenter=this.view.renderCoordsHelper.getAltitude(TT)),this._surfaceAltitudeAtCenter}_estimateSurfaceIntersectionAtRenderPoint(e,t,r){const i=kse(t,e,kTt);if(R(i))return null;const n=i.origin,s=he(TT,i.origin,i.direction);return this._surfaceIntersector.resetWithRay(i,t),this.view.basemapTerrain.intersect(this._surfaceIntersector,null,n,s),this._surfaceIntersector.results.min.getIntersectionPoint(r)?r:null}_cameraChanged(e){this._updateCenterPointsOfInterest();const t=e.eye;Kl(this.renderPointOfView,t)||this._set("renderPointOfView",oe(this._propertiesPool.get("renderPointOfView"),t))}_updateCenterPointsOfInterest(){this._centerRayDirty=!0,this._surfaceAltitudeAtCenterDirty=!0,this._contentAltitudeAtCenterDirty=!0;for(const e of this._pois)e.updateRenderLocation()}_updateCenterOnContent(){this._contentAltitudeAtCenterDirty=!0,this.centerOnContent.updateRenderLocation()}_setDebug(e){if(!e)return this._debugCenters.forEach(t=>t.hide()),void this._handles.remove("debug");for(const t of this._pois)this._handles.add(re(()=>t.renderLocation,r=>this._debugCenters.get(t).show(r,t.renderCoordsHelper.spatialReference),Ot),"debug")}get test(){return{update:()=>{this.surfaceGeometryUpdates.runTask();for(const e of this._pois)e.runTask()},surfaceGeometryUpdates:this.surfaceGeometryUpdates}}};d([f({readOnly:!0})],To.prototype,"centerOnContent",void 0),d([f({readOnly:!0})],To.prototype,"centerOnSurfaceFrequent",void 0),d([f({readOnly:!0})],To.prototype,"centerOnSurfaceInfrequent",void 0),d([f({readOnly:!0})],To.prototype,"contentCenterOnSurface",void 0),d([f({readOnly:!0})],To.prototype,"cameraOnSurface",void 0),d([f({readOnly:!0})],To.prototype,"contentCameraOnSurface",void 0),d([f({readOnly:!0})],To.prototype,"focus",void 0),d([f({readOnly:!0})],To.prototype,"renderPointOfView",void 0),d([f({readOnly:!0})],To.prototype,"surfaceOrigin",void 0),d([f({readOnly:!0})],To.prototype,"contentGeometryUpdates",void 0),d([f({readOnly:!0})],To.prototype,"surfaceGeometryUpdates",void 0),d([f({constructOnly:!0})],To.prototype,"view",void 0),d([f({readOnly:!0})],To.prototype,"updating",null),To=d([$("esri.views.3d.support.PointsOfInterest")],To);const NTt=Array,TT=M(),kTt=Ma(),VTt={exclude:new Set([op])};class zTt{constructor(t){this.store=t}destroy(){this.store.destroy()}get(t){return this.store.get(t)}put(t,r){this.store.put(t,r,r.values.byteLength+256)}}const UTt=fe.getLogger("esri.core.workers.WorkerHandle");class JOe{constructor(t,r,i,n,s={}){this._mainMethod=r,this._transferLists=i,this._listeners=[],this._promise=LV(t,{...s,schedule:n}).then(a=>{if(this._thread===void 0){this._thread=a,this._promise=null,s.hasInitialize&&this.broadcast({},"initialize");for(const o of this._listeners)this._connectListener(o)}else a.close()}),this._promise.catch(a=>UTt.error(`Failed to initialize ${t} worker: ${a}`))}on(t,r){const i={removed:!1,eventName:t,callback:r,threadHandle:null};return this._listeners.push(i),this._connectListener(i),Hh(()=>{i.removed=!0,_te(this._listeners,i),this._thread&&_(i.threadHandle)&&i.threadHandle.remove()})}destroy(){this._thread&&(this._thread.close(),this._thread=null),this._promise=null}invoke(t,r){return this.invokeMethod(this._mainMethod,t,r)}invokeMethod(t,r,i){if(this._thread){const n=this._transferLists[t],s=n?n(r):[];return this._thread.invoke(t,r,{transferList:s,signal:i})}return this._promise?this._promise.then(()=>(Et(i),this.invokeMethod(t,r,i))):Promise.reject(null)}broadcast(t,r){return this._thread?Promise.all(this._thread.broadcast(r,t)).then(()=>{}):this._promise?this._promise.then(()=>this.broadcast(t,r)):Promise.reject()}get promise(){return this._promise}_connectListener(t){this._thread&&this._thread.on(t.eventName,t.callback).then(r=>{t.removed||(t.threadHandle=r)})}}class mye extends JOe{constructor(t=null){super("LercWorker","_decode",{_decode:r=>[r.buffer]},t,{strategy:"dedicated"}),this.schedule=t,this.ref=0}decode(t,r,i){return t&&t.byteLength!==0?this.invoke({buffer:t,options:r},i):Promise.resolve(null)}release(){--this.ref<=0&&(S7.forEach((t,r)=>{t===this&&S7.delete(r)}),this.destroy())}}const S7=new Map;function BTt(e=null){let t=S7.get(e);return t||(_(e)?(t=new mye(r=>e.schedule(r)),S7.set(e,t)):(t=new mye,S7.set(null,t))),++t.ref,t}function yy(){const e=new Float32Array(9);return e[0]=1,e[4]=1,e[8]=1,e}function KOe(e){const t=new Float32Array(9);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function GTt(e,t,r,i,n,s,a,o,l){const c=new Float32Array(9);return c[0]=e,c[1]=t,c[2]=r,c[3]=i,c[4]=n,c[5]=s,c[6]=a,c[7]=o,c[8]=l,c}function jTt(e,t){return new Float32Array(e,t,9)}Object.freeze(Object.defineProperty({__proto__:null,create:yy,clone:KOe,fromValues:GTt,createView:jTt},Symbol.toStringTag,{value:"Module"}));var gye,Hc,yye,bye,vye;(function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.FILL_VERTEX=1]="FILL_VERTEX",e[e.FILL_DD_VERTEX=2]="FILL_DD_VERTEX",e[e.FILL_INDEX=3]="FILL_INDEX",e[e.OUTLINE_VERTEX=4]="OUTLINE_VERTEX",e[e.OUTLINE_DD_VERTEX=5]="OUTLINE_DD_VERTEX",e[e.OUTLINE_INDEX=6]="OUTLINE_INDEX",e[e.LINE_VERTEX=7]="LINE_VERTEX",e[e.LINE_DD_VERTEX=8]="LINE_DD_VERTEX",e[e.LINE_INDEX=9]="LINE_INDEX",e[e.ICON_VERTEX=10]="ICON_VERTEX",e[e.ICON_DD_VERTEX=11]="ICON_DD_VERTEX",e[e.ICON_INDEX=12]="ICON_INDEX",e[e.TEXT_VERTEX=13]="TEXT_VERTEX",e[e.TEXT_DD_VERTEX=14]="TEXT_DD_VERTEX",e[e.TEXT_INDEX=15]="TEXT_INDEX",e[e.CIRCLE_VERTEX=16]="CIRCLE_VERTEX",e[e.CIRCLE_INDEX=17]="CIRCLE_INDEX"})(gye||(gye={})),function(e){e[e.FILL=1]="FILL",e[e.LINE=2]="LINE",e[e.SYMBOL=3]="SYMBOL",e[e.CIRCLE=4]="CIRCLE"}(Hc||(Hc={})),function(e){e[e.BACKGROUND=0]="BACKGROUND",e[e.OPAQUE=1]="OPAQUE",e[e.TRANSLUCENT=2]="TRANSLUCENT",e[e.SYMBOLS=3]="SYMBOLS",e[e.HITTEST=4]="HITTEST"}(yye||(yye={})),function(e){e[e.BACKGROUND=0]="BACKGROUND",e[e.FILL=1]="FILL",e[e.OUTLINE=2]="OUTLINE",e[e.LINE=3]="LINE",e[e.ICON=4]="ICON",e[e.CIRCLE=5]="CIRCLE",e[e.TEXT=6]="TEXT",e[e.TILEINFO=7]="TILEINFO"}(bye||(bye={})),function(e){e[e.PAINTER_CHANGED=0]="PAINTER_CHANGED",e[e.LAYOUT_CHANGED=1]="LAYOUT_CHANGED",e[e.LAYER_CHANGED=2]="LAYER_CHANGED",e[e.LAYER_REMOVED=3]="LAYER_REMOVED",e[e.SPRITES_CHANGED=4]="SPRITES_CHANGED"}(vye||(vye={}));class qTt{constructor(t){this.xTile=0,this.yTile=0,this.hash=0,this.priority=1,this.colliders=[],this.textVertexRanges=[],this.iconVertexRanges=[],this.tile=t}}class eDt{constructor(){this.tileSymbols=[],this.parts=[{startTime:0,startOpacity:0,targetOpacity:0,show:!1},{startTime:0,startOpacity:0,targetOpacity:0,show:!1}],this.show=!1}}function tDt(e,t,r,i,n,s){const a=r-n;if(a>=0)return(t>>a)+(i-(s<<a))*(e>>a);const o=-a;return t-(s-(i<<o))*(e>>o)<<o}class rDt{constructor(t,r,i){this._rows=Math.ceil(r/i),this._columns=Math.ceil(t/i),this._cellSize=i,this.cells=new Array(this._rows);for(let n=0;n<this._rows;n++){this.cells[n]=new Array(this._columns);for(let s=0;s<this._columns;s++)this.cells[n][s]=[]}}getCell(t,r){const i=Math.min(Math.max(Math.floor(r/this._cellSize),0),this._rows-1),n=Math.min(Math.max(Math.floor(t/this._cellSize),0),this._columns-1);return this.cells[i]&&this.cells[i][n]||null}getCellSpan(t,r,i,n){return[Math.min(Math.max(Math.floor(t/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(r/this._cellSize),0),this.rows-1),Math.min(Math.max(Math.floor(i/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(n/this._cellSize),0),this.rows-1)]}get cellSize(){return this._cellSize}get columns(){return this._columns}get rows(){return this._rows}}function HTt(e,t,r,i,n,s){const a=t[i++];for(let o=0;o<a;o++){const l=new qTt(s);l.xTile=t[i++],l.yTile=t[i++],l.hash=t[i++],l.priority=t[i++];const c=t[i++];for(let p=0;p<c;p++){const m=t[i++],g=t[i++],b=t[i++],w=t[i++],v=!!t[i++],x=t[i++],T=r[i++],E=r[i++],C=t[i++],A=t[i++];l.colliders.push({xTile:m,yTile:g,dxPixels:b,dyPixels:w,hard:v,partIndex:x,width:C,height:A,minLod:T,maxLod:E})}const u=e[i++];for(let p=0;p<u;p++)l.textVertexRanges.push([e[i++],e[i++]]);const h=e[i++];for(let p=0;p<h;p++)l.iconVertexRanges.push([e[i++],e[i++]]);n.push(l)}return i}function iDt(e,t,r){for(const[i,n]of e.symbols)WTt(e,t,r,n,i)}function WTt(e,t,r,i,n){const s=e.layerData.get(n);if(s.type===Hc.SYMBOL){for(const a of i){const o=a.unique;let l;if(a.selectedForRendering){const c=o.parts[0],u=c.startOpacity,h=c.targetOpacity;e.allSymbolsFadingOut=e.allSymbolsFadingOut&&h===0;const p=r?Math.floor(127*u)|h<<7:h?255:0;l=p<<24|p<<16|p<<8|p}else l=0;for(const[c,u]of a.iconVertexRanges)for(let h=c;h<c+u;h+=4)s.iconOpacity[h/4]=l;if(a.selectedForRendering){const c=o.parts[1],u=c.startOpacity,h=c.targetOpacity;e.allSymbolsFadingOut=e.allSymbolsFadingOut&&h===0;const p=r?Math.floor(127*u)|h<<7:h?255:0;l=p<<24|p<<16|p<<8|p}else l=0;for(const[c,u]of a.textVertexRanges)for(let h=c;h<c+u;h+=4)s.textOpacity[h/4]=l}s.lastOpacityUpdate=t,s.opacityChanged=!0}}class kU{constructor(t,r){this.layerUIDs=[],this.isDestroyed=!1,this.data=t,this.memoryUsed=t.byteLength;let i=1;const n=new Uint32Array(t);this.layerUIDs=[];const s=n[i++];for(let a=0;a<s;a++)this.layerUIDs[a]=n[i++];this.bufferDataOffset=i,r&&(this.layer=r.getStyleLayerByUID(this.layerUIDs[0]))}get isPreparedForRendering(){return R(this.data)}get offset(){return this.bufferDataOffset}destroy(){this.isDestroyed||(this.doDestroy(),this.isDestroyed=!0)}prepareForRendering(t){R(this.data)||(this.doPrepareForRendering(t,this.data,this.bufferDataOffset),this.data=null)}}class XTt extends kU{constructor(t,r){super(t,r),this.type=Hc.LINE,this.lineIndexStart=0,this.lineIndexCount=0;const i=new Uint32Array(t);let n=this.bufferDataOffset;this.lineIndexStart=i[n++],this.lineIndexCount=i[n++];const s=i[n++];if(s>0){const a=new Map;for(let o=0;o<s;o++){const l=i[n++],c=i[n++],u=i[n++];a.set(l,[c,u])}this.patternMap=a}this.bufferDataOffset=n}hasData(){return this.lineIndexCount>0}triangleCount(){return this.lineIndexCount/3}doDestroy(){_(this.lineVertexArrayObject)&&this.lineVertexArrayObject.dispose(),_(this.lineVertexBuffer)&&this.lineVertexBuffer.dispose(),_(this.lineIndexBuffer)&&this.lineIndexBuffer.dispose(),this.lineVertexArrayObject=null,this.lineVertexBuffer=null,this.lineIndexBuffer=null,this.memoryUsed=0}doPrepareForRendering(t,r,i){const n=new Uint32Array(r),s=new Int32Array(n.buffer),a=n[i++];this.lineVertexBuffer=dr.createVertex(t,Cr.STATIC_DRAW,new Int32Array(s.buffer,4*i,a)),i+=a;const o=n[i++];this.lineIndexBuffer=dr.createIndex(t,Cr.STATIC_DRAW,new Uint32Array(n.buffer,4*i,o)),i+=o;const l=this.layer.lineMaterial;this.lineVertexArrayObject=new ns(t,l.getAttributeLocations(),l.getLayoutInfo(),{geometry:this.lineVertexBuffer},this.lineIndexBuffer)}}class YTt extends kU{constructor(t,r){super(t,r),this.type=Hc.FILL,this.fillIndexStart=0,this.fillIndexCount=0,this.outlineIndexStart=0,this.outlineIndexCount=0;const i=new Uint32Array(t);let n=this.bufferDataOffset;this.fillIndexStart=i[n++],this.fillIndexCount=i[n++],this.outlineIndexStart=i[n++],this.outlineIndexCount=i[n++];const s=i[n++];if(s>0){const a=new Map;for(let o=0;o<s;o++){const l=i[n++],c=i[n++],u=i[n++];a.set(l,[c,u])}this.patternMap=a}this.bufferDataOffset=n}hasData(){return this.fillIndexCount>0||this.outlineIndexCount>0}triangleCount(){return(this.fillIndexCount+this.outlineIndexCount)/3}doDestroy(){_(this.fillVertexArrayObject)&&this.fillVertexArrayObject.dispose(),_(this.fillVertexBuffer)&&this.fillVertexBuffer.dispose(),_(this.fillIndexBuffer)&&this.fillIndexBuffer.dispose(),this.fillVertexArrayObject=null,this.fillVertexBuffer=null,this.fillIndexBuffer=null,_(this.outlineVertexArrayObject)&&this.outlineVertexArrayObject.dispose(),_(this.outlineVertexBuffer)&&this.outlineVertexBuffer.dispose(),_(this.outlineIndexBuffer)&&this.outlineIndexBuffer.dispose(),this.outlineVertexArrayObject=null,this.outlineVertexBuffer=null,this.outlineIndexBuffer=null,this.memoryUsed=0}doPrepareForRendering(t,r,i){const n=new Uint32Array(r),s=new Int32Array(n.buffer),a=n[i++];this.fillVertexBuffer=dr.createVertex(t,Cr.STATIC_DRAW,new Int32Array(s.buffer,4*i,a)),i+=a;const o=n[i++];this.fillIndexBuffer=dr.createIndex(t,Cr.STATIC_DRAW,new Uint32Array(n.buffer,4*i,o)),i+=o;const l=n[i++];this.outlineVertexBuffer=dr.createVertex(t,Cr.STATIC_DRAW,new Int32Array(s.buffer,4*i,l)),i+=l;const c=n[i++];this.outlineIndexBuffer=dr.createIndex(t,Cr.STATIC_DRAW,new Uint32Array(n.buffer,4*i,c)),i+=c;const u=this.layer,h=u.fillMaterial,p=u.outlineMaterial;this.fillVertexArrayObject=new ns(t,h.getAttributeLocations(),h.getLayoutInfo(),{geometry:this.fillVertexBuffer},this.fillIndexBuffer),this.outlineVertexArrayObject=new ns(t,p.getAttributeLocations(),p.getLayoutInfo(),{geometry:this.outlineVertexBuffer},this.outlineIndexBuffer)}}class ZTt extends kU{constructor(t,r,i){super(t,r),this.type=Hc.SYMBOL,this.iconPerPageElementsMap=new Map,this.glyphPerPageElementsMap=new Map,this.symbolInstances=[],this.isIconSDF=!1,this.opacityChanged=!1,this.lastOpacityUpdate=0,this.symbols=[];const n=new Uint32Array(t),s=new Int32Array(t),a=new Float32Array(t);let o=this.bufferDataOffset;this.isIconSDF=!!n[o++];const l=n[o++];for(let p=0;p<l;p++){const m=n[o++],g=n[o++],b=n[o++];this.iconPerPageElementsMap.set(m,[g,b])}const c=n[o++];for(let p=0;p<c;p++){const m=n[o++],g=n[o++],b=n[o++];this.glyphPerPageElementsMap.set(m,[g,b])}const u=n[o++],h=n[o++];this.iconOpacity=new Int32Array(u),this.textOpacity=new Int32Array(h),o=HTt(n,s,a,o,this.symbols,i),this.bufferDataOffset=o}hasData(){return this.iconPerPageElementsMap.size>0||this.glyphPerPageElementsMap.size>0}triangleCount(){let t=0;for(const[r,i]of this.iconPerPageElementsMap)t+=i[1];for(const[r,i]of this.glyphPerPageElementsMap)t+=i[1];return t/3}doDestroy(){_(this.iconVertexArrayObject)&&this.iconVertexArrayObject.dispose(),_(this.iconVertexBuffer)&&this.iconVertexBuffer.dispose(),_(this.iconOpacityBuffer)&&this.iconOpacityBuffer.dispose(),_(this.iconIndexBuffer)&&this.iconIndexBuffer.dispose(),this.iconVertexArrayObject=null,this.iconVertexBuffer=null,this.iconOpacityBuffer=null,this.iconIndexBuffer=null,_(this.textVertexArrayObject)&&this.textVertexArrayObject.dispose(),_(this.textVertexBuffer)&&this.textVertexBuffer.dispose(),_(this.textOpacityBuffer)&&this.textOpacityBuffer.dispose(),_(this.textIndexBuffer)&&this.textIndexBuffer.dispose(),this.textVertexArrayObject=null,this.textVertexBuffer=null,this.textOpacityBuffer=null,this.textIndexBuffer=null,this.memoryUsed=0}updateOpacityInfo(){if(!this.opacityChanged)return;this.opacityChanged=!1;const t=this.iconOpacity,r=this.iconOpacityBuffer;t.length>0&&t.byteLength===r.size&&r.setSubData(t);const i=this.textOpacity,n=this.textOpacityBuffer;i.length>0&&i.byteLength===n.size&&n.setSubData(i)}doPrepareForRendering(t,r,i){const n=new Uint32Array(r),s=new Int32Array(n.buffer),a=n[i++];this.iconVertexBuffer=dr.createVertex(t,Cr.STATIC_DRAW,new Int32Array(s.buffer,4*i,a)),i+=a;const o=n[i++];this.iconIndexBuffer=dr.createIndex(t,Cr.STATIC_DRAW,new Uint32Array(n.buffer,4*i,o)),i+=o;const l=n[i++];this.textVertexBuffer=dr.createVertex(t,Cr.STATIC_DRAW,new Int32Array(s.buffer,4*i,l)),i+=l;const c=n[i++];this.textIndexBuffer=dr.createIndex(t,Cr.STATIC_DRAW,new Uint32Array(n.buffer,4*i,c)),i+=c,this.iconOpacityBuffer=dr.createVertex(t,Cr.STATIC_DRAW,this.iconOpacity.buffer),this.textOpacityBuffer=dr.createVertex(t,Cr.STATIC_DRAW,this.textOpacity.buffer);const u=this.layer,h=u.iconMaterial,p=u.textMaterial;this.iconVertexArrayObject=new ns(t,h.getAttributeLocations(),h.getLayoutInfo(),{geometry:this.iconVertexBuffer,opacity:this.iconOpacityBuffer},this.iconIndexBuffer),this.textVertexArrayObject=new ns(t,p.getAttributeLocations(),p.getLayoutInfo(),{geometry:this.textVertexBuffer,opacity:this.textOpacityBuffer},this.textIndexBuffer)}}class QTt extends kU{constructor(t,r){super(t,r),this.type=Hc.CIRCLE,this.circleIndexStart=0,this.circleIndexCount=0;const i=new Uint32Array(t);let n=this.bufferDataOffset;this.circleIndexStart=i[n++],this.circleIndexCount=i[n++],this.bufferDataOffset=n}hasData(){return this.circleIndexCount>0}triangleCount(){return this.circleIndexCount/3}doDestroy(){_(this.circleVertexArrayObject)&&this.circleVertexArrayObject.dispose(),_(this.circleVertexBuffer)&&this.circleVertexBuffer.dispose(),_(this.circleIndexBuffer)&&this.circleIndexBuffer.dispose(),this.circleVertexArrayObject=null,this.circleVertexBuffer=null,this.circleIndexBuffer=null,this.memoryUsed=0}doPrepareForRendering(t,r,i){const n=new Uint32Array(r),s=new Int32Array(n.buffer),a=n[i++];this.circleVertexBuffer=dr.createVertex(t,Cr.STATIC_DRAW,new Int32Array(s.buffer,4*i,a)),i+=a;const o=n[i++];this.circleIndexBuffer=dr.createIndex(t,Cr.STATIC_DRAW,new Uint32Array(n.buffer,4*i,o)),i+=o;const l=this.layer.circleMaterial;this.circleVertexArrayObject=new ns(t,l.getAttributeLocations(),l.getLayoutInfo(),{geometry:this.circleVertexBuffer},this.circleIndexBuffer)}}const nDt=!0,sDt=32,_ye=200,JTt=1/ue("mapview-transitions-duration");class KTt extends mn{constructor(){super(...arguments),this._fadeOutResolver=null,this._fadeInResolver=null,this._clips=null,this.computedVisible=!0,this.computedOpacity=1,this.fadeTransitionEnabled=!1,this.inFadeTransition=!1,this._isReady=!1,this._opacity=1,this._stage=null,this._visible=!0}get clips(){return this._clips}set clips(t){this._clips=t,this.requestRender()}get isReady(){return this._isReady}get opacity(){return this._opacity}set opacity(t){this._opacity!==t&&(this._opacity=Math.min(1,Math.max(t,0)),this.requestRender())}get stage(){return this._stage}set stage(t){if(this._stage===t)return;const r=this._stage;this._stage=t,t?this._stage.untrashDisplayObject(this)||(this.onAttach(),this.emit("attach")):r.trashDisplayObject(this)}get transforms(){return this._getTransforms()}_getTransforms(){return R(this._transforms)&&(this._transforms=this._createTransforms()),this._transforms}get visible(){return this._visible}set visible(t){this._visible!==t&&(this._visible=t,this.requestRender())}fadeIn(){return this._fadeInResolver||(this._fadeOutResolver&&(this._fadeOutResolver(),this._fadeOutResolver=null),this.computedOpacity=0,this.fadeTransitionEnabled=!0,this._fadeInResolver=Op(),this.requestRender()),this._fadeInResolver.promise}fadeOut(){return this._fadeOutResolver||(this._fadeInResolver&&(this._fadeInResolver(),this._fadeInResolver=null),this.fadeTransitionEnabled=!0,this._fadeOutResolver=Op(),this.requestRender()),this._fadeOutResolver.promise}beforeRender(t){this.updateTransitionProperties(t.deltaTime,t.state.scale)}afterRender(t){this._fadeInResolver&&this.computedOpacity===this.opacity?(this._fadeInResolver(),this._fadeInResolver=null):this._fadeOutResolver&&this.computedOpacity===0&&(this._fadeOutResolver(),this._fadeOutResolver=null)}remove(){var t;(t=this.parent)==null||t.removeChild(this)}setTransform(t){}processRender(t){this.stage&&this.computedVisible&&this.doRender(t)}requestRender(){this.stage&&this.stage.requestRender()}processDetach(){this._fadeInResolver&&(this._fadeInResolver(),this._fadeInResolver=null),this._fadeOutResolver&&(this._fadeOutResolver(),this._fadeOutResolver=null),this.onDetach(),this.emit("detach")}updateTransitionProperties(t,r){if(this.fadeTransitionEnabled){const i=this._fadeOutResolver||!this.visible?0:this.opacity,n=this.computedOpacity;if(n===i)this.computedVisible=this.visible;else{const s=t*JTt;this.computedOpacity=n>i?Math.max(i,n-s):Math.min(i,n+s),this.computedVisible=this.computedOpacity>0;const a=i===this.computedOpacity;this.inFadeTransition=!a,a||this.requestRender()}}else this.computedOpacity=this.opacity,this.computedVisible=this.visible}onAttach(){}onDetach(){}doRender(t){}ready(){this._isReady||(this._isReady=!0,this.emit("isReady"),this.requestRender())}}class U0{constructor(t,r,i,n){this.set(t,r,i,n)}static getId(t,r,i,n){return typeof t=="object"?`${t.level}/${t.row}/${t.col}/${t.world}`:`${t}/${r}/${i}/${n}`}get key(){return this}get id(){return this.toString()}set id(t){this.set(t)}get hash(){const t=4095&this.row,r=4095&this.col,i=63&this.level;return(3&this.world)<<30|r<<22|t<<8|i}acquire(t,r,i,n){this.set(t,r,i,n)}contains(t){const r=t.level-this.level;return this.row===t.row>>r&&this.col===t.col>>r&&this.world===t.world}equals(t){return this.level===t.level&&this.row===t.row&&this.col===t.col&&this.world===t.world}clone(){return new U0(this)}release(){this.level=0,this.row=0,this.col=0,this.world=0}set(t,r,i,n){if(t==null)this.level=0,this.row=0,this.col=0,this.world=0;else if(typeof t=="object")this.level=t.level||0,this.row=t.row||0,this.col=t.col||0,this.world=t.world||0;else if(typeof t=="string"){const[s,a,o,l]=t.split("/");this.level=parseFloat(s),this.row=parseFloat(a),this.col=parseFloat(o),this.world=parseFloat(l)}else this.level=+t,this.row=+r,this.col=+i,this.world=+n||0;return this}toString(){return`${this.level}/${this.row}/${this.col}/${this.world}`}getParentKey(){return this.level<=0?null:new U0(this.level-1,this.row>>1,this.col>>1,this.world)}getChildKeys(){const t=this.level+1,r=this.row<<1,i=this.col<<1,n=this.world;return[new U0(t,r,i,n),new U0(t,r,i+1,n),new U0(t,r+1,i,n),new U0(t,r+1,i+1,n)]}compareRowMajor(t){return this.row<t.row?-1:this.row>t.row?1:this.col<t.col?-1:this.col>t.col?1:0}}U0.pool=new Fn(U0,null,null,25,50);class eSt extends KTt{constructor(t,r,i,n,s,a=n,o=s){super(),this.triangleCountReportedInDebug=0,this.triangleCount=0,this.texture=null,this.key=new U0(t),this.x=r,this.y=i,this.width=n,this.height=s,this.rangeX=a,this.rangeY=o}destroy(){this.texture&&(this.texture.dispose(),this.texture=null)}setTransform(t,r){const i=r/(t.resolution*t.pixelRatio),n=this.transforms.tileMat3,[s,a]=t.toScreenNoRotation([0,0],[this.x,this.y]),o=this.width/this.rangeX*i,l=this.height/this.rangeY*i;use(n,o,0,0,0,l,0,s,a,1),$z(this.transforms.dvs,t.displayViewMat3,n)}}class E7 extends eSt{constructor(t,r,i,n,s,a,o=null){super(t,r,i,n,s,4096,4096),this._memCache=o,this.type="vector-tile",this._referenced=0,this._hasSymbolBuckets=!1,this._memoryUsedByLayerData=0,this.layerData=new Map,this.layerCount=0,this.status="loading",this.allSymbolsFadingOut=!1,this.lastOpacityUpdate=0,this.symbols=new Map,this.isCoverage=!1,this.neededForCoverage=!1,this.decluttered=!1,this.invalidating=!1,this.parentTile=null,this.childrenTiles=new Set,this._processed=!1,this._referenced=1,this.styleRepository=a,this.id=t.id}get hasSymbolBuckets(){return this._hasSymbolBuckets}get isFading(){return this._hasSymbolBuckets&&performance.now()-this.lastOpacityUpdate<_ye}get isHoldingForFade(){return this._hasSymbolBuckets&&(!this.allSymbolsFadingOut||performance.now()-this.lastOpacityUpdate<_ye)}get wasRequested(){return this.status==="errored"||this.status==="loaded"||this.status==="reloading"}setData(t){this.changeDataImpl(t),this.requestRender(),this.ready(),this.invalidating=!1,this._processed=!0}deleteLayerData(t){let r=!1;for(const i of t)if(this.layerData.has(i)){const n=this.layerData.get(i);this._memoryUsedByLayerData-=n.memoryUsed,n.type===Hc.SYMBOL&&this.symbols.has(i)&&(this.symbols.delete(i),r=!0),n.destroy(),this.layerData.delete(i),this.layerCount--}_(this._memCache)&&this._memCache.updateSize(this.key.id,this,this._memoryUsedByLayerData),r&&this.emit("symbols-changed"),this.requestRender()}processed(){return this._processed}hasData(){return this.layerCount>0}dispose(){this.status!=="unloaded"&&(eMe.delete(this),E7._destroyRenderBuckets(this.layerData),this.layerData=null,this.layerCount=0,this._memoryUsedByLayerData=0,this.destroy(),this.status="unloaded")}release(){return--this._referenced==0&&(this.dispose(),this.stage=null,!0)}retain(){++this._referenced}get referenced(){return this._referenced}get memoryUsage(){return(this._memoryUsedByLayerData+256)/(this._referenced||1)}changeDataImpl(t){let r=!1;if(t){const{bucketsWithData:i,emptyBuckets:n}=t,s=this._createRenderBuckets(i);if(n&&n.byteLength>0){const a=new Uint32Array(n);for(const o of a)this._deleteLayerData(o)}for(const[a,o]of s)this._deleteLayerData(a),o.type===Hc.SYMBOL&&(this.symbols.set(a,o.symbols),r=!0),this._memoryUsedByLayerData+=o.memoryUsed,this.layerData.set(a,o),this.layerCount++;_(this._memCache)&&this._memCache.updateSize(this.key.id,this,this._memoryUsedByLayerData)}this._hasSymbolBuckets=!1;for(const[i,n]of this.layerData)n.type===Hc.SYMBOL&&(this._hasSymbolBuckets=!0);r&&this.emit("symbols-changed")}attachWithContext(t){this.stage={context:t,trashDisplayObject(r){r.processDetach()},untrashDisplayObject:()=>!1}}setTransform(t,r){super.setTransform(t,r);const i=r/(t.resolution*t.pixelRatio),n=this.width/this.rangeX*i,s=this.height/this.rangeY*i,a=[0,0];t.toScreen(a,[this.x,this.y]);const o=this.transforms.tileUnitsToPixels;hse(o),zN(o,o,a),fse(o,o,Math.PI*t.rotation/180),pse(o,o,[n,s,1])}_createTransforms(){return{dvs:yy(),tileMat3:yy(),tileUnitsToPixels:yy()}}static _destroyRenderBuckets(t){if(!t)return;const r=new Set;t.forEach(i=>{r.has(i)||(i.destroy(),r.add(i))}),t.clear()}_createRenderBuckets(t){const r=new Map,i=new Map;for(const n of t){const s=this._deserializeBucket(n,i);for(const a of s.layerUIDs)r.set(a,s)}return r}_deserializeBucket(t,r){let i=r.get(t);if(i)return i;switch(new Uint32Array(t)[0]){case Hc.FILL:i=new YTt(t,this.styleRepository);break;case Hc.LINE:i=new XTt(t,this.styleRepository);break;case Hc.SYMBOL:i=new ZTt(t,this.styleRepository,this);break;case Hc.CIRCLE:i=new QTt(t,this.styleRepository)}return r.set(t,i),i}_deleteLayerData(t){if(!this.layerData.has(t))return;const r=this.layerData.get(t);this._memoryUsedByLayerData-=r.memoryUsed,r.destroy(),this.layerData.delete(t),this.layerCount--}}const eMe=new Map;function tSt(){eMe.forEach((e,t)=>{console.log(`
${t.key}:`),e[0].forEach(r=>console.log(r)),console.log("========"),e[1].forEach(r=>console.log(r))})}const aDt={value:.5,readOnly:!0},rSt={readOnly:!0,value:.5,get(){return this.updating?this.updatingProgressValue:1}};class Uae{constructor(t=0,r=0){this.min=t,this.max=r,this.level=0,this.hasNoDataValues=!1}copyFrom(t){this.min=t.min,this.max=t.max,this.level=t.level,this.hasNoDataValues=t.hasNoDataValues}}class iSt{constructor(t,r,i){this.type="elevation",this.samplerData=null,this.level=t[0],this.i=t[1],this.j=t[2],this.extent=r;const n=i.noDataValue,s=i.values;let a=1/0,o=-1/0,l=!0,c=!1;for(let u=0;u<s.length;u++){const h=s[u];h!==n?(a=h<a?h:a,o=h>o?h:o,l=!1):c=!0}l&&(a=0,o=0),o=o>-3e38?o:0,this.samplerData={pixelData:i.values,width:i.width,height:i.height,noDataValue:n,safeWidth:.99999999*(i.width-1),dx:(i.width-1)/(r[2]-r[0]),dy:(i.width-1)/(r[3]-r[1]),x0:r[0],y1:r[3]},this.bounds=[a,o],this.hasNoDataValues=c}release(){this.samplerData=null,this.bounds=null}computeMinMaxValue(t,r,i,n){n.min=1/0,n.max=-1/0,n.hasNoDataValues=!1;const s=t-this.level;if(s<=0)return n;const a=2**s;if(!(Math.floor(r/a)===this.i&&Math.floor(i/a)===this.j))return n;let o=1/0,l=-1/0;const c=this.samplerData.width,u=this.samplerData.pixelData,h=.5*IA;let p=(c-1)/a,m=(i-this.j*a)*p,g=(r-this.i*a)*p;if(p<1){const b=Math.floor(m),w=Math.floor(g),v=b+w*c,x=u[v],T=u[v+1],E=u[v+c],C=u[v+c+1];if(x+T+E+C<h){const A=m-b,P=g-w,I=BM(x,T,E,C,A,P),L=BM(x,T,E,C,A+p,P),V=BM(x,T,E,C,A,P+p),G=BM(x,T,E,C,A+p,P+p);return n.min=Math.min(I,L,V,G),n.max=Math.max(I,L,V,G),n}m=b,g=w,p=1}else m=Math.floor(m),g=Math.floor(g),p=Math.ceil(p);for(let b=m;b<=m+p;b++)for(let w=g;w<=g+p;w++){const v=u[b+w*c];v<h?(o=Math.min(o,v),l=Math.max(l,v)):n.hasNoDataValues=!0}return n.min=o,n.max=l,n}}function tMe(e,t,r){if(R(r))return null;for(const i of r){if(!i)continue;const n=i.safeWidth;let s=Le(i.dy*(i.y1-t),0,n),a=Le(i.dx*(e-i.x0),0,n);const o=Math.floor(s),l=Math.floor(a),c=i.width,u=o*c+l,h=i.pixelData,p=h[u],m=h[u+1],g=u+c,b=h[g],w=h[g+1];if(p+b+m+w<.5*IA){s-=o,a-=l;const v=p+(m-p)*a;return v+(b+(w-b)*a-v)*s}}return null}function Si(e,t,r){const i=tMe(e,t,r);return _(i)?i:0}let uh=class extends xe{constructor(e){super(e),this._handles=new Ft}initialize(){this._handles.add([this.layerViews.on("change",()=>this.notifyChange("stencilEnabledExtents"))])}destroy(){this._handles.destroy(),this._handles=null}get layerViewsExtent(){return this._computeLayerViewsExtent()}get tiledLayersExtent(){return this._computeTiledLayersExtent()}get stencilEnabledExtents(){return this._computeStencilEnabledExtents()}_computeStencilEnabledExtents(){const e=[];return this.layerViews.forEach(t=>{const r=t.layer;if(r.operationalLayerType==="IntegratedMeshLayer"&&this.viewSpatialReference!=null){const i=rMe(r.fullExtent,this.viewSpatialReference);_(i)&&e.push(Cxe(i))}}),e}};function nSt(e,t){return e===Be.Global?new EK(t):new CK(t)}d([f({readOnly:!0})],uh.prototype,"layerViewsExtent",null),d([f({readOnly:!0})],uh.prototype,"tiledLayersExtent",null),d([f({readOnly:!0})],uh.prototype,"stencilEnabledExtents",null),d([f()],uh.prototype,"viewSpatialReference",void 0),d([f()],uh.prototype,"tilingScheme",void 0),d([f()],uh.prototype,"defaultTiledLayersExtent",void 0),d([f({constructOnly:!0})],uh.prototype,"layers",void 0),d([f({constructOnly:!0})],uh.prototype,"layerViews",void 0),uh=d([$("esri.views.3d.terrain.ExtentHelper")],uh);let EK=class extends uh{_computeLayerViewsExtent(){return this._globalExtent}_computeTiledLayersExtent(){return this._globalExtent}get _globalExtent(){return this.viewSpatialReference.isWebMercator?tEe:pat}};EK=d([$("esri.views.3d.terrain.ExtentHelperGlobal")],EK);let CK=class extends uh{_computeLayerViewsExtent(){const e=Eu(),t=this.viewSpatialReference;this.layerViews.forEach(n=>{const s=n.layer;if(n.isResolved()&&(s.type!=="graphics"||!s.internal)){const a=rMe("fullExtentInLocalViewSpatialReference"in n&&n.fullExtentInLocalViewSpatialReference||n.layer.fullExtent,t);nw(e,a,e)}});const r=mY(e)?e:null,i=this._get("layerViewsExtent");return sw(r,i)?i:r}_computeTiledLayersExtent(){const e=this.tilingScheme;if(!e)return null;const t=this.viewSpatialReference,r=Eu();this.layers.forEach(s=>{if(s.loaded&&H4(s)){const a=NU(s,t,Be.Local);if(R(a))return;const{tileInfo:o,fullExtent:l}=a;_(o)&&_(l)&&(Ck(s)||e.compatibleWith(o)&&l.spatialReference.equals(e.spatialReference))&&nw(r,l,r)}}),nw(r,this.defaultTiledLayersExtent,r);const i=mY(r)?r:null,n=this._get("tiledLayersExtent");return sw(i,n)?n:i}};function rMe(e,t){return _(e)&&!e.spatialReference.equals(t)?LTe(e,e.spatialReference,t):e}CK=d([$("esri.views.3d.terrain.ExtentHelperLocal")],CK);var er;(function(e){e[e.ELEVATION=0]="ELEVATION",e[e.MAP=1]="MAP"})(er||(er={}));const t3=[er.ELEVATION,er.MAP];function iMe(){var t;const e=(t=globalThis.require)==null?void 0:t.modules;if(e){const r=Object.keys(e);for(const i of r)i.search(".glsl")!==-1&&delete e[i]}}const sSt=[[-.1,-2,3.9,2],[-.1,-3.9,3.9,.1],[-2,-3.9,2,.1],[-3.9,-3.9,.1,.1],[-3.9,-2,.1,2],[-3.9,-.1,.1,3.9],[-2,-.1,2,3.9],[-.1,-.1,3.9,3.9]];let Pb,Vl=class extends xe{constructor(e){super(e),this._handles=new Ft,this._spatialReference=null,this._renderSR=null,this._overlaySREqualsRenderSR=!0,this._drapeSources=new Set,this._drapeTargets=new Set,this._placementDirty=!1,this._contentUpdated=!1,this._drawTexturesDirty=!1,this._drawTexturesAnimateDirty=!1,this._hasUnusedRenderTargets=!1,this._longitudeCyclical=null,this._latestOriginId=0,this._maxResolution=ue("esri-mobile")?2048:4096,this._animationTimeLast=0}get running(){return this._placementDirty&&(this._drapeSources.size>0||this.view.graphics.length>0||Yr.OVERLAY_DRAW_DEBUG_TEXTURE)&&!!this._spatialReference&&!this.suspended&&this.surface.ready}get _isSpherical(){return this.view.state.isGlobal}get _worldToPCSRatio(){return _(this._spatialReference)&&this._spatialReference.isGeographic&&!this.view.state.isLocal?Ar(this._spatialReference).metersPerDegree:1}get view(){return this.surface.view}get updating(){return this.running||this.renderer.updating||this._contentUpdated}get hasHighlights(){return this.renderer.hasHighlights}get rendersOccluded(){return this.renderer.rendersOccluded}initialize(){const e=this.view;this.renderer=new kf({view:e,worldToPCSRatio:this._worldToPCSRatio,spatialReference:this._spatialReference}),this._groundIntersector=tf(this.view.state.viewingMode),this._groundIntersector.options.backfacesTerrain=!0,this._groundIntersector.options.invisibleTerrain=!0,this._groundIntersector.options.hud=!1,this._handles.add([this.renderer.events.on("has-highlights",()=>{this.setDrawTexturesDirty(),this.notifyChange("hasHighlights")}),this.renderer.events.on("has-water",t=>{var r;return(r=e._stage)==null?void 0:r.renderView.setRenderParameters({hasOverlayWater:t})}),this.renderer.events.on("renders-occluded",()=>{this.setDrawTexturesDirty(),this.notifyChange("rendersOccluded")}),this.renderer.events.on("content-changed",()=>this.setDrawTexturesDirty()),this.renderer.events.on("textures-disposed",()=>this.updateOverlayResult()),re(()=>{var t,r,i;return[(t=e.pointsOfInterest)==null?void 0:t.renderPointOfView,(i=(r=e.pointsOfInterest)==null?void 0:r.centerOnSurfaceFrequent)==null?void 0:i.location]},()=>this.setPlacementDirty()),re(()=>{var t;return(t=e.state)==null?void 0:t.pixelRatio},()=>this.setPlacementDirty(),ti),this.surface.on("elevation-change",()=>this.setPlacementDirty()),e.on("resize",()=>this.setPlacementDirty()),Aw({preRender:t=>{this._contentUpdated=!1,this.renderer.processSyncDrapeSources(),this.renderer.hasOverlays&&(this._dispatchAnimationUpdate(t),this._drawOverlayTextures(this.renderer.overlays,Xn.UPDATE)),this._hasUnusedRenderTargets&&this._collectUnusedRenderTargetMemory()}}),e.resourceController.scheduler.registerTask(bt.OVERLAY,this),e._stage.renderView.events.on("force-camera-for-screenshot",t=>{this._updateOverlays(t,Xn.BACKGROUND),this.renderer.hasOverlays&&this._drawOverlayTextures(this.renderer.overlays,Xn.BACKGROUND,t)})])}destroy(){this.renderer.dispose(),this._handles&&(this._handles.destroy(),this._handles=null),_(Pb)&&(Pb.hide(),Pb=null)}get hasOverlays(){return this.renderer.hasOverlays}setSpatialReference(e){this._spatialReference=e,this.renderer.spatialReference=e,this._longitudeCyclical=null;const t=this.view.renderSpatialReference;_(e)&&_(t)?(this._renderSR=t,this._overlaySREqualsRenderSR=e.equals(this._renderSR),this._isSpherical&&(this._longitudeCyclical=e.isWebMercator?new Hv(-20037508342787e-6,20037508342787e-6):new Hv(-180,180),this.renderer.longitudeCyclical=this._longitudeCyclical),this.renderer&&(this.renderer.worldToPCSRatio=this._worldToPCSRatio)):this.renderer.disposeOverlays()}get gpuMemoryUsage(){return this.renderer.gpuMemoryUsage}registerDrapeSource(e,t,r){this._drapeSources.add(e),this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources);const i=this.renderer.createDrapeSourceRenderer(e,t,r);return this._updateDrapeSourceExtent(e),this._setContentDirty(),this.notifyChange("running"),i}registerGeometryDrapeSource(e){return this.registerDrapeSource(e,L0)}_updateDrapeSourceExtent(e){this.renderer.overlays.length===2&&_(e.setDrapingExtent)&&_(this._spatialReference)&&e.setDrapingExtent(this.renderer.overlays,this._spatialReference)}unregisterDrapeSource(e){this._drapeSources.has(e)&&(this._drapeSources.delete(e),this.renderer.removeDrapeSourceRenderer(e),this.renderer.ensureDrapeSources(this._drapeSources),this._setContentDirty(),this.notifyChange("running"))}registerDrapeTarget(e){this._drapeTargets.add(e),this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources)}updateOverlayResult(){var e;(e=this.view._stage)==null||e.renderView.setRenderParameters({overlays:this.renderer.overlays})}unregisterDrapeTarget(e){this._drapeTargets.delete(e),this.renderer.ensureDrapeTargets(this._drapeTargets)}_setContentDirty(){this.setPlacementDirty(),this.setDrawTexturesDirty()}setPlacementDirty(){this._placementDirty=!0}runTask(){this._updateOverlays(this.view.state.camera,Xn.UPDATE)}_updateOverlays(e,t){if(!this._spatialReference)return;const r=wyt(e.fullWidth,e.fullHeight,this._maxResolution);this._computeOverlayExtents(e,r,Qm);const i=su(Qm.inner)/su(Qm.outer);this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources);const n=this._updateOverlay(ji.INNER,Qm.inner,r,1*Qm.pixelRatioAdjustment,Qm.mapUnitsPerPixel),s=this._updateOverlay(ji.OUTER,Qm.outer,r,i*Qm.pixelRatioAdjustment,Qm.mapUnitsPerPixel);n!==F0.EXTENT&&s!==F0.EXTENT||(this._drapeSources.forEach(a=>this._updateDrapeSourceExtent(a)),this.surface.updateTileOverlayParams(t)),n===F0.NONE&&s===F0.NONE||this.setDrawTexturesDirty(),this._placementDirty=!1}_updateOverlay(e,t,r,i,n){if(this.renderer.overlays.length===0)return F0.NONE;const s=this.renderer.overlays[e],a=s.mapUnitsPerPixel;if(s.mapUnitsPerPixel=n,s.pixelRatio=i,aSt(t,s.extent)&&r===s.resolution)return a===n?F0.NONE:F0.RERENDER_ONLY;Oy(s.extent,t),s.resolution=r;const o=Ire(s.extent);return s.renderLocalOrigin=b7(o[0],o[1],0,"OV_"+this._latestOriginId++),F0.EXTENT}setTileParameters(e){const t=e.renderData.overlay;if(this.renderer.overlays.length>0){const r=this.renderer.overlays[ji.INNER],i=this.renderer.overlays[ji.OUTER],n=aL(e.extent,this.surface.extent,wye);this._rectInsideRect(r.extent,n)||this._rectanglesOverlap(n,r.extent)||this._rectanglesOverlap(n,i.extent)?(this._setTileOverlayData(n,ji.INNER,t),this._setTileOverlayData(n,ji.OUTER,t)):(this._clearTileOverlayData(ji.INNER,t),this._clearTileOverlayData(ji.OUTER,t))}else this._clearTileOverlayData(ji.INNER,t),this._clearTileOverlayData(ji.OUTER,t)}overlayPixelSizeInMapUnits(e){if(this.renderer.overlays.length===0)return 0;const t=this.renderer.overlays[ji.INNER],r=this.renderer.overlays[ji.OUTER],i=this._pointIsInExtent(e,t.extent)?t:r;return(i.extent[2]-i.extent[0])/i.resolution}_setTileOverlayData(e,t,r){if(this.renderer.overlays.length===0)return;const i=this.renderer.overlays[t].extent,n=su(i),s=$p(i);let a=e[0];if(this._longitudeCyclical){a=this._longitudeCyclical.minimalMonotonic(i[0],a);const o=this._longitudeCyclical.minimalMonotonic(i[0],e[2]);a>o&&(a=o-(e[2]-e[0]))}r.setScale(t,su(e)/n,$p(e)/s),r.setOffset(t,(a-i[0])/n,(e[1]-i[1])/s)}_clearTileOverlayData(e,t){t.setScale(e,-1,-1),t.setOffset(e,-1,-1)}async reloadShaders(){iMe(),await this.renderer.reloadShaders(),this.setDrawTexturesDirty(),this.runTask()}_dispatchAnimationUpdate(e){const t=e.time-this._animationTimeLast;(t>=this.surface.view._stage.renderView.animationTimestep||_(this.forcedAnimationTime)||this._drawTexturesDirty||this._drawTexturesAnimateDirty)&&(this.renderer.updateAnimation({dt:t,forcedTime:this.forcedAnimationTime,camera:this.view.state.camera})&&(this._drawTexturesAnimateDirty=!0),this._animationTimeLast=e.time)}setDrawTexturesDirty(){this.renderer.hasOverlays?(this._contentUpdated=!0,this._drawTexturesDirty=!0):this.setPlacementDirty()}_intersectGroundFromView(e,t,r,i){const n=this.view.sceneIntersectionHelper.getCenterRayWithSubpixelOffset(e,lSt,t,r);if(R(n))return!1;const s=n.origin,a=he(GI,n.origin,n.direction);return this._groundIntersector.reset(s,a,e),this._groundIntersector.intersect([],null),this.view.basemapTerrain.intersect(this._groundIntersector,null,s,a),this._groundIntersector.results.min.getIntersectionPoint(i)}_findHorizonBasedPointOfInterest(e,t){let r=.5;const i=.55,n=this.view.renderCoordsHelper.getAltitude(e.eye),s=this.view.pointsOfInterest.centerOnSurfaceFrequent,a=1e-5,o=Le(s.estimatedSurfaceAltitude,e.aboveGround?-1/0:n+a,e.aboveGround?n-a:1/0),l=e.aboveGround;if(this.view.viewingMode==="global"){const c=GI;n6(GV(jV,Ar(this.view.spatialReference).radius+o),Ru(e.eye,e.viewForward),c),pe(c,c,e.eye);const u=Wv.normalize(fqe(e.viewForward,c,e.viewRight))/e.fovY+.5,h=u<=0||u>=1?.5:i;r=l?h*u:u+h*(1-u)}else{const c=.5*Math.PI-Math.acos(-e.viewForward[2]),u=Math.tan(c),h=Tr(0,u,1,0),p=du(h,h,e.projectionMatrix)[1],m=Le(.5+.5*p,0,1);r=m===1||m===0?.5:l?m*i:1-(1-m)*i}return!!this._intersectGroundFromView(e,.5,r,t)&&are(t,e.eye)<s.distance*s.distance}_computeOverlayExtents(e,t,r){const i=this.view.pointsOfInterest.centerOnSurfaceFrequent.renderLocation,n=M();this._findHorizonBasedPointOfInterest(e,n)||oe(n,i);const s=Math.max(.1,fi(e.eye,n)),a=s_(this.view.renderCoordsHelper,i,e.eye),o=Math.PI/2-Math.abs(a-Math.PI/2);Yr.OVERLAY_SHOW_CENTER?(R(Pb)&&(Pb=new b1(this.view.graphics,"red")),Pb.show(n,this._renderSR)):_(Pb)&&Pb.hide(),this._overlaySREqualsRenderSR||Ss(n,this._renderSR,n,this._spatialReference);const l=this.surface.extent,c=!this._isSpherical&&_(this._spatialReference)&&this._spatialReference.isGeographic,u=c&&_(this._spatialReference)?1/Ar(this._spatialReference).metersPerDegree:1,h=e.perRenderPixelRatio*s*u;r.mapUnitsPerPixel=h/this._worldToPCSRatio;let p=t*h/2,m=!1,g=c?90:1/0;this._isSpherical&&_(l)&&_(this._spatialReference)&&(this._spatialReference.isWebMercator?(p/=Math.cos($F(n[1])),g=l[3]):(m=!0,p/=Ar(this._spatialReference).metersPerDegree,g=90),p>=g&&(p=g,n[1]=0,this._spatialReference.isWebMercator&&(n[0]=0)));let b=1;m&&(b=1/Math.max(.2,Math.cos(Math.abs(kt(n[1])))),p*b>180&&(b=180/p),r.mapUnitsPerPixel*=b);const w=Math.log(2)/12;p=Math.exp(Math.round(Math.log(p)/w)*w);const v=p*b,x=32,T=.5*t/(x*v),E=.5*t/(x*p);n[0]=Math.round(n[0]*T)/T,n[1]=Math.round(n[1]*E)/E;const C=r.inner;C[0]=n[0]-v,C[1]=n[1]-p,C[2]=n[0]+v,C[3]=n[1]+p,this._isSpherical&&this._shiftExtentToFitBounds(C,1/0,g);const A=r.outer;if(6*v>su(l))Oy(A,l);else if(o<=.25*Math.PI)A[0]=C[0]-v,A[1]=C[1]-p,A[2]=C[2]+v,A[3]=C[3]+p;else{Ss(e.eye,this._renderSR,GI,this._spatialReference),q0(l2,n,GI);let I=-Math.atan2(l2[1],l2[0])+.125*Math.PI;I<0&&(I+=2*Math.PI);const L=Math.floor(I/(.25*Math.PI));YR(l2,sSt[L],2*p),l2[0]*=b,l2[2]*=b,lre(A,C,l2)}if(this._isSpherical)A[0]=this._longitudeCyclical.clamp(A[0]),A[2]=this._longitudeCyclical.clamp(A[2]),A[1]=Math.max(A[1],-g),A[3]=Math.min(A[3],g);else{const I=aL(C,l,wye),L=aL(A,l,oSt);tde(I,L)&&(A[2]=A[0],A[3]=A[1])}const P=Math.abs(C[2]-C[0])/t;r.mapUnitsPerPixel=Math.max(r.mapUnitsPerPixel,P),r.pixelRatioAdjustment=r.mapUnitsPerPixel/P}_drawOverlayTextures(e,t,r=this.view.state.camera){if(e.length===0||!this._drawTexturesDirty&&!this._drawTexturesAnimateDirty)return;const i=this._drawTexturesDirty;this._drawTexturesDirty=!1,this._drawTexturesAnimateDirty=!1;const n=this._drawOverlay(e[ji.INNER],r),s=this._drawOverlay(e[ji.OUTER],r);n!==m9.CHANGED&&s!==m9.CHANGED||this.surface.updateTileOverlayParams(Xn.UPDATE),this._collectUnusedRenderTargetMemory(),this.updateOverlayResult(),i?(this.surface.requestRender(t),t===Xn.UPDATE&&this.surface.requestUpdate()):this.surface.requestRender(Xn.BACKGROUND)}_drawOverlay(e,t){return this._longitudeCyclical?e.setupGeometryViewsCyclical(this._longitudeCyclical):e.setupGeometryViewsDirect(),e.draw(this.renderer,t.pixelRatio)}_collectUnusedRenderTargetMemory(){if(this._hasUnusedRenderTargets=!1,this.renderer.hasOverlays){const e=performance.now();this._hasUnusedRenderTargets=this.renderer.collectUnusedRenderTargetMemory(e)}}_rectanglesOverlap(e,t){return!R(e)&&(this._longitudeCyclical?(this._longitudeCyclical.contains(t[0],t[2],e[0])||this._longitudeCyclical.contains(t[0],t[2],e[2])||this._longitudeCyclical.contains(e[0],e[2],t[0]))&&!(e[1]>t[3]||e[3]<t[1]):KR(e,t))}_rectInsideRect(e,t){return!R(t)&&(this._longitudeCyclical?this._longitudeCyclical.contains(e[0],e[2],t[0])&&this._longitudeCyclical.contains(e[0],e[2],t[2])&&t[1]>e[1]&&t[3]<e[3]:tde(e,t))}_pointIsInExtent(e,t){if(this._longitudeCyclical)return this._longitudeCyclical.contains(t[0],t[2],e.x)&&e.y>=t[1]&&e.y<=t[3];const r=e.x,i=e.y;return r>t[0]&&r<t[2]&&i>t[1]&&i<t[3]}_shiftExtentToFitBounds(e,t,r){let i=0,n=0;e[0]<-t?i=e[0]+t:e[2]>t&&(i=t-e[2]),e[1]<-r?n=e[1]+r:e[3]>r&&(n=r-e[3]),UF(e,i,n)}get test(){return{renderer:this.renderer,update:()=>this.runTask()}}};function aSt(e,t){const i=Yr.TESTS_DISABLE_OPTIMIZATIONS?0:1e-5*Math.max(e[2]-e[0],e[3]-e[1],t[2]-t[0],t[3]-t[1]);return Math.abs(t[0]-e[0])<=i&&Math.abs(t[1]-e[1])<=i&&Math.abs(t[2]-e[2])<=i&&Math.abs(t[3]-e[3])<=i}d([f()],Vl.prototype,"_spatialReference",void 0),d([f({readOnly:!0})],Vl.prototype,"running",null),d([f()],Vl.prototype,"_placementDirty",void 0),d([f()],Vl.prototype,"_contentUpdated",void 0),d([f()],Vl.prototype,"_isSpherical",null),d([f()],Vl.prototype,"_worldToPCSRatio",null),d([f()],Vl.prototype,"renderer",void 0),d([f({constructOnly:!0})],Vl.prototype,"surface",void 0),d([f({readOnly:!0,aliasOf:"surface.suspended"})],Vl.prototype,"suspended",void 0),d([f({readOnly:!0})],Vl.prototype,"updating",null),d([f({type:Boolean})],Vl.prototype,"hasHighlights",null),d([f({type:Boolean})],Vl.prototype,"rendersOccluded",null),Vl=d([$("esri.views.3d.terrain.OverlayManager")],Vl);const l2=Jt(),GI=M(),Qm={inner:zt(),outer:zt(),mapUnitsPerPixel:0,pixelRatioAdjustment:1},wye=zt(),oSt=zt(),lSt=Ma();var F0;(function(e){e[e.NONE=0]="NONE",e[e.EXTENT=1]="EXTENT",e[e.RERENDER_ONLY=2]="RERENDER_ONLY"})(F0||(F0={}));class TR{constructor(t,r){this._factoryCallback=t,this._lengthCallback=r,this._pool=new Map}acquire(t){if(!TR.test.disabled){const r=this._pool.get(t);if(r&&r.length!==0)return r.pop()}try{return this._factoryCallback(t)}catch(r){const i=window.performance&&window.performance.memory;let n="";throw i&&(n=`
  totalJSHeapSize: ${i.totalJSHeapSize}, usedJSHeapSize: ${i.usedJSHeapSize}, jsHeapSizeLimit: ${i.jsHeapSizeLimit}`),console.log("Array allocation of size "+t+" failed: "+r+n),r}}release(t){if(TR.test.disabled)return;const r=this._lengthCallback(t);let i=this._pool.get(r);i||(i=new Qt({shrink:!0}),this._pool.set(r,i)),i.push(t)}clear(){this._pool.clear()}get test(){return{size:this._pool.size}}}TR.test={disabled:!1};class cSt{constructor(){this.indices=null,this.vertexAttributes=null,this.boundingBox=bi(),this.indexCount=0,this.numVerticesPerSide=0,this.uvOffsetAndScale=Jt(),this.outerEdges=[null,null,null,null],this.innerEdges=[null,null,null,null]}}class xye{constructor(t,r,i,n,s){this._buf=t,this._localOrigin=r,this.offset0=i,this.stride=n,this.count=s}getVertexOffset(t){return 0<=t&&t<this.count,this.offset0+this.stride*t}getVertex(t,r){const i=this.getVertexOffset(r)*ph;t[0]=this._buf[i+0]+this._localOrigin[0],t[1]=this._buf[i+1]+this._localOrigin[1],t[2]=this._buf[i+2]+this._localOrigin[2]}getVertexZ(t){const r=this.getVertexOffset(t)*ph;return this._buf[r+2]+this._localOrigin[2]}setVertex(t,r,i,n){const s=this.getVertexOffset(t)*ph;this._buf[s+0]=r[0]-this._localOrigin[0],this._buf[s+1]=r[1]-this._localOrigin[1],this._buf[s+2]=r[2]-this._localOrigin[2],this._buf[s+3]=i,this._buf[s+4]=n}getNormal(t,r){const i=this.getVertexOffset(r)*ph;t[0]=this._buf[i+5],t[1]=this._buf[i+6],t[2]=this._buf[i+7]}setVertexRawXYZUV(t,r,i,n,s,a){const o=this.getVertexOffset(t)*ph;this._buf[o+0]=r,this._buf[o+1]=i,this._buf[o+2]=n,this._buf[o+3]=s,this._buf[o+4]=a}setVertexRawXYZUVN(t,r,i,n,s,a,o,l,c){const u=this.getVertexOffset(t)*ph;this._buf[u+0]=r,this._buf[u+1]=i,this._buf[u+2]=n,this._buf[u+3]=s,this._buf[u+4]=a,this._buf[u+5]=o,this._buf[u+6]=l,this._buf[u+7]=c}setVertexRawNormal(t,r,i,n){const s=this.getVertexOffset(t)*ph;this._buf[s+5]=r,this._buf[s+6]=i,this._buf[s+7]=n}getVertexRawNormal(t,r){const i=this.getVertexOffset(r)*ph;t[0]=this._buf[i+5],t[1]=this._buf[i+6],t[2]=this._buf[i+7]}}const dSt=gn().vec3f(O.POSITION).vec2f(O.UV0).vec3f(O.NORMAL),Bae=new TR(e=>dSt.createBuffer(e),e=>e.count);function uSt(){Bae.clear()}function nMe(e){return Bae.acquire(e)}function hSt(e){Bae.release(e.vertexAttributes),e.vertexAttributes=null,e.indices=null}class fSt{constructor(){this.sinLonLUT=new Array(mJ+1),this.cosLonLUT=new Array(mJ+1)}update(t,r){const i=r[0],n=r[2];for(let s=0;s<=t;s++){const a=s/t,o=i*(1-a)+n*a;this.sinLonLUT[s]=Math.sin(o),this.cosLonLUT[s]=Math.cos(o)}}}class jI{constructor(){this.elevation=0,this.normal=[0,0,1],this.cornerTiles=[null,null,null,null]}}class pSt{constructor(){this.edgeNeighbours=[null,null,null,null],this.cornerNeighborData=[new jI,new jI,new jI,new jI],this.edgeResolutions=[1,1,1,1],this.modifiedEdgeResolutions=[!1,!1,!1,!1]}}class mSt{constructor(){this.numVerticesPerSide=0,this.samplerData=null,this.clippingArea=null,this.wireframe=!1,this.samplerDataVersion=0,this.neighborData=new pSt}}class o5{constructor(t){this._getFadeDuration=t,this._fadeStart=0,this._delayedTime=0}clear(){this._current=ct(this._current),this._next=ct(this._next),this._waiting=ct(this._waiting),this._delayed=ct(this._delayed)}get current(){if(R(this._current))return null;if(!this._isFadingEnabled){const r=this._delayed||this._waiting||this._next||this._current;r!==this._current&&(this._current=null,this.clear(),this._current=r)}let t=o5.test.fadeMoment;if(_(this._delayed)&&(t=t||performance.now(),t>=this._delayedTime&&(this._push(this._delayed,by.Immediate),this._delayed=null)),_(this._next)){t=t||performance.now();const r=this._fadeDuration,i=_(this._current)&&this._next.texture===this._current.texture,n=this._next.type!==sa.FADING,s=t-this._fadeStart>=r;(i||n||s)&&(ct(this._current),this._current=this._next,this._next=this._waiting,this._waiting=null,this._fadeStart=this._alignFadeStart(t))}return this._current}get next(){return this._next}get fadeFactor(){if(R(this._next))return 1;const t=o5.test.fadeMoment||performance.now(),r=Math.max(0,t-this._fadeStart),i=this._fadeDuration;return r>i?0:1-r/i}get isFading(){return _(this._next)||_(this._delayed)}push(t,r=by.Immediate){this._delayed=ct(this._delayed),this._push(t,r)}_push(t,r){if(this._isFadingEnabled||this.clear(),R(this._current))return void(this._current=t);const i=o5.test.fadeMoment||performance.now();return r!==by.Immediate?(this._delayed=t,void(this._delayedTime=i+r)):R(this._next)?(this._next=t,void(this._fadeStart=this._alignFadeStart(i))):void(R(t)||(ct(this._waiting),this._waiting=t))}get _fadeDuration(){return R(this._waiting)?this._getFadeDuration():.5*this._getFadeDuration()}_alignFadeStart(t){const r=this._getFadeDuration();return t+r-t%r}get _isFadingEnabled(){return this._getFadeDuration()>0}}var by;o5.test={fadeMoment:0},function(e){e[e.Immediate=0]="Immediate",e[e.Delayed=5e3]="Delayed"}(by||(by={}));class sMe{constructor(){this._queue=new Qt,this._last=null,this.remove=()=>{}}get done(){return this._queue.length===0&&(!this._last||this._last.isLeaf)}resetOne(t){this._queue.clear(),this._queue.push(t),this._last=null}reset(t=null){this._queue.clear(),_(t)&&this._queue.pushArray(t),this._last=null}skipSubtree(){this._last=null}next(){return this._last&&!this._last.isLeaf&&this._queue.pushArray(this._last.children),this._last=this._queue.pop(),this._last}}class gSt{constructor(){this.q=new Qt}get done(){return this.q.length===0}reset(t){if(this.q.clear(),!R(t)){this.q.pushArray(t);for(let r=0;r<this.q.length;++r){const i=this.q.data[r];i.isLeaf||this.q.pushArray(i.children)}}}next(){return this.q.pop()}}function C7(e,t,r){if(R(t)||R(t.fullExtent))return!1;const i=t.fullExtent,n=e.extent;if(r){if(n[0]<i.xmin||n[1]<i.ymin||n[2]>i.xmax||n[3]>i.ymax)return!1}else if(i.xmin>n[2]||i.ymin>n[3]||i.xmax<n[0]||i.ymax<n[1])return!1;const s=e.surface.tilingScheme.levels[e.level].scale;return!(t.minScale>0&&s>1.00000001*t.minScale)&&!(t.maxScale>0&&s<.99999999*t.maxScale)}function aMe(e,t){return e.lij[0]-t.lij[0]||e.lij[1]-t.lij[1]||e.lij[2]-t.lij[2]}function oMe(e,t){t.sort((r,i)=>lMe(r,i,e))}function lMe(e,t,r){const i=e.screenDepth,n=t.screenDepth;return i<n?-r:i>n?r:aMe(e,t)}function ySt(e,t){const r=new Map;e.forAll(i=>r.set(i.lij,i.distanceToSquared(t))),e.sort((i,n)=>r.get(i.lij)-r.get(n.lij)||aMe(i,n))}function bSt(e,t,r){let i=1,n=0,s=0;for(;e!==t;)if(i*=.5,n*=.5,s*=.5,1&e.lij[2]&&(n+=.5),(1&e.lij[1])==0&&(s+=.5),(e=e.parent)==null)throw new Error("tile was not a descendant of upsampleTile");r.init(t,n,s,i)}function vSt(e){for(let t=0;t<e.length;t++){const r=e[t],i=r.parent;if(i)for(let n=0;n<4;n++){const s=i.children[n];if(s&&s!==r&&s.loadable)return!0}}return!1}function oDt(e,t){if(!e||!t||e[0]===t[0])return!1;const r=e[0]<t[0],i=r?e:t,n=r?t:e,s=1<<n[0]-i[0];return Math.floor(n[1]/s)===i[1]&&Math.floor(n[2]/s)===i[2]}class Gae{get updating(){return!!this._tileRequested}init(t,r,i,n){this.tile=t,this._layerIdx=r,this._layerClass=i,this._suspended=n,this._tileLayerInfo=t.getLayerInfo(r,i),this._tileRequested=null;const s=this._findAncestorWithData();this._setUpsampleTile(s)}startLoading(){return this._requestNext()}dispose(){this._tileRequested&&(this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null),this.tile=null,this._tileLayerInfo=null}setSuspension(t){t!==this._suspended&&(this._suspended=t,t?this._tileRequested&&(this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null):this._tileLayerInfo.data||this.update())}update(){const t=this._findAncestorWithData();return this._setUpsampleTile(t),this._requestNext()}dataArrived(t){this._setUpsampleTile(t),this._tileRequested=null,t===this.tile?this.tile.updateRenderData(this._layerClass,sa.FADING):this._requestNext()}dataMissing(){this._tileRequested=null,this._tileLayerInfo.data=null,this._requestNext()}_agentDone(){this.tile.agentDone(this._layerIdx,this._layerClass),this.dispose()}_requestNext(){if(this._suspended)return!0;const t=this._findNextDownload();if(this._tileRequested){if(t===this._tileRequested)return!0;this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null}return _(t)?t.requestLayerData(this._layerIdx,this._layerClass,this)&&(this._tileRequested=t):this._agentDone(),!!this._tileRequested}_findNextDownload(){const t=this._layerIdx,r=this._layerClass,i=this.tile.surface.layerViewByIndex(t,r),n=xK(i),{minLevel:s,maxLevel:a}=i.dataLevelRange,o=this._desiredMinLevelDelta,l=this._progressiveLevelModulo+o,c=this._scaleRangeEnabled?C7:()=>!0;let u=this.tile;const h=u.level;let p;const m=this._tileLayerInfo.upsampleInfo,g=_(m)?m.tile.level:-1,b=!!_(m)&&g-h>=o,w=Vi(n,"tilemapCache");for(;u&&c(u,n,!1)&&u.level>=s;){const v=u.level,x=h-v,T=u.layerInfo[r][t];if(T.data&&x>=o){(!b||v>g)&&this._setUpsampleTile(u),T.dataInvalidated&&(p=u);break}if((R(w)||w.getAvailability(u.lij[0],u.lij[1],u.lij[2])!=="unavailable")&&v<=a&&!T.data&&!T.dataMissing&&((R(p)||u.level===s||v%eEe==0||h-p.level<o)&&(p=u),x>=l))break;u=u.parent}return _(p)&&h-p.level<o&&this._tileLayerInfo.upsampleInfo&&(p=null),p}_findAncestorWithData(){const t=this.tile.vlevel,r=this._desiredMinLevelDelta;let i;for(let n=this.tile;n;n=n.parent)if(n.hasLayerData(this._layerIdx,this._layerClass)){if(t-n.level>=r)return n;i=n}return i}_setUpsampleTile(t){this._tileLayerInfo.setUpsampleInfo(this.tile,t),this.tile.updateRenderData(this._layerClass,sa.FADING)}get test(){return{findNextDownload:()=>this._findNextDownload(),tileLayerInfo:this._tileLayerInfo}}}class _St extends Gae{get _desiredMinLevelDelta(){throw Tye}get _progressiveLevelModulo(){throw Tye}dispose(){}}const Tye=new Error("Abstract method called on TileAgent"),Ec=new _St;class cMe extends Gae{constructor(){super(...arguments),this._scaleRangeEnabled=!1}get _desiredMinLevelDelta(){return HL(this.tile.level)-(this.tile.vlevel-this.tile.level)}get _progressiveLevelModulo(){return 0}}class dMe extends Gae{constructor(){super(),this._scaleRangeEnabled=!0}get _desiredMinLevelDelta(){return 0}get _progressiveLevelModulo(){return eEe}}var vw,ux;(function(e){e[e.Stretch=0]="Stretch",e[e.Lut=1]="Lut",e[e.Hillshade=2]="Hillshade",e[e.COUNT=3]="COUNT"})(vw||(vw={})),function(e){e[e.Noop=0]="Noop",e[e.PerBand=1]="PerBand",e[e.COUNT=2]="COUNT"}(ux||(ux={}));var Sye,Fe;(function(e){e[e.OneMinusSourceAlpha=0]="OneMinusSourceAlpha",e[e.SourceAlpha=1]="SourceAlpha",e[e.COUNT=2]="COUNT"})(Sye||(Sye={})),function(e){e[e.Normal=0]="Normal",e[e.Average=1]="Average",e[e.Lighten=2]="Lighten",e[e.Lighter=3]="Lighter",e[e.Plus=4]="Plus",e[e.Screen=5]="Screen",e[e.ColorDodge=6]="ColorDodge",e[e.Darken=7]="Darken",e[e.Multiply=8]="Multiply",e[e.ColorBurn=9]="ColorBurn",e[e.Overlay=10]="Overlay",e[e.SoftLight=11]="SoftLight",e[e.HardLight=12]="HardLight",e[e.VividLight=13]="VividLight",e[e.Hue=14]="Hue",e[e.Saturation=15]="Saturation",e[e.Luminosity=16]="Luminosity",e[e.Color=17]="Color",e[e.DestinationOver=18]="DestinationOver",e[e.DestinationAtop=19]="DestinationAtop",e[e.DestinationIn=20]="DestinationIn",e[e.DestinationOut=21]="DestinationOut",e[e.SourceAtop=22]="SourceAtop",e[e.SourceIn=23]="SourceIn",e[e.SourceOut=24]="SourceOut",e[e.Xor=25]="Xor",e[e.Difference=26]="Difference",e[e.Exclusion=27]="Exclusion",e[e.Minus=28]="Minus",e[e.Invert=29]="Invert",e[e.Reflect=30]="Reflect",e[e.COUNT=31]="COUNT"}(Fe||(Fe={}));const xD={normal:Fe.Normal,average:Fe.Average,lighten:Fe.Lighten,lighter:Fe.Lighter,screen:Fe.Screen,plus:Fe.Plus,"color-dodge":Fe.ColorDodge,darken:Fe.Darken,multiply:Fe.Multiply,"color-burn":Fe.ColorBurn,overlay:Fe.Overlay,"soft-light":Fe.SoftLight,"hard-light":Fe.HardLight,"vivid-light":Fe.VividLight,hue:Fe.Hue,saturation:Fe.Saturation,luminosity:Fe.Luminosity,color:Fe.Color,difference:Fe.Difference,exclusion:Fe.Exclusion,minus:Fe.Minus,invert:Fe.Invert,reflect:Fe.Reflect,"destination-over":Fe.DestinationOver,"destination-atop":Fe.DestinationAtop,"destination-in":Fe.DestinationIn,"destination-out":Fe.DestinationOut,"source-atop":Fe.SourceAtop,"source-in":Fe.SourceIn,"source-out":Fe.SourceOut,xor:Fe.Xor};function wSt(e){return e===Fe.DestinationOver||e===Fe.DestinationAtop||e===Fe.DestinationIn||e===Fe.DestinationOut||e===Fe.SourceAtop||e===Fe.SourceIn||e===Fe.SourceOut||e===Fe.Xor}function xSt(e){e.fragment.uniforms.add([new Wt("u_colormap",t=>t.u_colormap),new He("u_colormapOffset",t=>t.colormap.u_colormapOffset),new He("u_colormapMaxIndex",t=>t.colormap.u_colormapMaxIndex),new He("u_opacity",t=>t.common.u_opacity)]),e.fragment.code.add(S`vec4 colormap(vec4 currentPixel, bool isFloat) {
float clrIndex = isFloat ? currentPixel.r - u_colormapOffset : currentPixel.r * 255.0 - u_colormapOffset;
vec4 result;
if (currentPixel.a == 0.0 || clrIndex > u_colormapMaxIndex) {
result = vec4(0.0, 0.0, 0.0, 0.0);
} else {
vec2 clrPosition = vec2((clrIndex + 0.5) / (u_colormapMaxIndex + 1.0), 0.0);
result = texture2D(u_colormap, clrPosition);
}
return result;
}`)}function TSt(e){e.fragment.uniforms.add(new Wt("u_transformGrid",t=>t.u_transformGrid)),e.fragment.uniforms.add(new _r("u_transformSpacing",t=>t.common.u_transformSpacing)),e.fragment.uniforms.add(new _r("u_transformGridSize",t=>t.common.u_transformGridSize)),e.fragment.uniforms.add(new _r("u_targetImageSize",t=>t.common.u_targetImageSize)),e.fragment.code.add(S`vec2 projectPixelLocation(vec2 coords) {
vec2 index_image = floor(coords * u_targetImageSize);
vec2 oneTransformPixel = vec2(0.25 / u_transformGridSize.s, 1.0 / u_transformGridSize.t);
vec2 index_transform = floor(index_image / u_transformSpacing) / u_transformGridSize;
vec2 pos = fract((index_image + vec2(0.5, 0.5)) / u_transformSpacing);
vec2 srcLocation;
vec2 transform_location = index_transform + oneTransformPixel * 0.5;
if (pos.s <= pos.t) {
vec4 ll_abc = texture2D(u_transformGrid, vec2(transform_location.s, transform_location.t));
vec4 ll_def = texture2D(u_transformGrid, vec2(transform_location.s + oneTransformPixel.s, transform_location.t));
srcLocation.s = dot(ll_abc.rgb, vec3(pos, 1.0));
srcLocation.t = dot(ll_def.rgb, vec3(pos, 1.0));
} else {
vec4 ur_abc = texture2D(u_transformGrid, vec2(transform_location.s + 2.0 * oneTransformPixel.s, transform_location.t));
vec4 ur_def = texture2D(u_transformGrid, vec2(transform_location.s + 3.0 * oneTransformPixel.s, transform_location.t));
srcLocation.s = dot(ur_abc.rgb, vec3(pos, 1.0));
srcLocation.t = dot(ur_def.rgb, vec3(pos, 1.0));
}
return srcLocation;;
}`)}class uMe extends as{constructor(){super(...arguments),this.scale=1,this.offset=Zh}}function hMe(e){e.attributes.add(O.POSITION,"vec2"),e.attributes.add(O.UV0,"vec2"),e.vertex.uniforms.add(new He("scale",t=>t.scale)),e.vertex.uniforms.add(new _r("offset",t=>t.offset)),e.varyings.add("uv","vec2"),e.varyings.add("vuv","vec2"),e.vertex.code.add(S`void main(void) {
gl_Position = vec4(position, 0.0, 1.0);
uv = uv0 * scale + offset;
vuv = uv0;
}`)}class SSt extends uMe{constructor(t,r,i){super(),this.common=t,this.u_image=r,this.u_transformGrid=i}}function ESt(e){e.include(TSt),e.fragment.uniforms.add([new Wt("u_image",t=>t.u_image),new Xw("u_flipY",t=>t.common.u_flipY),new Xw("u_applyTransform",t=>t.common.u_applyTransform)]),e.fragment.code.add(S`vec2 getPixelLocation(vec2 coords) {
vec2 targetLocation = u_flipY ? vec2(coords.s, 1.0 - coords.t) : coords;
if (!u_applyTransform) {
return targetLocation;
}
return projectPixelLocation(targetLocation);
}
bool isOutside(vec2 coords){
if (coords.t>1.00001 ||coords.t<-0.00001 || coords.s>1.00001 ||coords.s<-0.00001) {
return true;
} else {
return false;
}
}
vec4 getPixel(vec2 pixelLocation) {
return texture2D(u_image, pixelLocation);
}`)}function jae(e){e.code.add(S`
    float lineFactorAtPosition(float value) {
      float pos = value * ${S.float(257)};
      if(pos < 0.5 || pos > ${S.float(257-.5)}) {
        return 1.0;
      }

      pos = pos + 0.5;
      float modulo = mod(pos, 16.0);
      return modulo <= 2.0 ?  1.0 - abs(modulo - 1.0) : 0.0;
    }

    float lineFactorAtUV(vec2 uv) {
      return max(lineFactorAtPosition(uv.x), lineFactorAtPosition(uv.y));
    }

    float lineFactor(vec2 uv) {
      vec2 offset = fwidth(uv) * 0.25;
      return (lineFactorAtUV(vec2(uv.x + offset.x, uv.y + offset.y)) +
              lineFactorAtUV(vec2(uv.x - offset.x, uv.y + offset.y)) +
              lineFactorAtUV(vec2(uv.x + offset.x, uv.y - offset.y)) +
              lineFactorAtUV(vec2(uv.x - offset.x, uv.y - offset.y))) / 4.0;
    }

    vec4 gridColor(vec2 uv) {
      float line = lineFactor(uv) * 0.1 + 0.9;
      return vec4(vec3(1.0, 0.972, 0.918) * line, 1.0);
    }`)}var oo;(function(e){e[e.LayerOnly=0]="LayerOnly",e[e.ColorComposite=1]="ColorComposite",e[e.GridComposite=2]="GridComposite",e[e.COUNT=3]="COUNT"})(oo||(oo={}));function fMe(e,t){const r=t.blendMode;r!==Fe.Normal&&(r===Fe.Reflect&&e.code.add(S`float reflectBlend(in float cb, in float cl) {
return (cl == 1.0) ? cl : min(cb * cb / (1.0 - cl), 1.0);
}`),r!==Fe.ColorDodge&&r!==Fe.VividLight||e.code.add(S`float colorDodge(in float cb, in float cl) {
return (cb == 0.0) ? 0.0 : (cl == 1.0) ? 1.0 : min(1.0, cb / (1.0 - cl));
}`),r!==Fe.ColorBurn&&r!==Fe.VividLight||e.code.add(S`float colorBurn(in float cb, in float cl) {
return (cb == 1.0) ? 1.0 : (cl == 0.0) ? 0.0 : 1.0 - min(1.0, (1.0 - cb) / cl);
}`),r===Fe.Overlay&&e.code.add(S`float overlay(in float cb, in float cl) {
return (1.0 - step(0.5, cl)) * (1.0 - 2.0 * (1.0 - cl ) * (1.0 - cb)) + step(0.5, cl) * (2.0 * cl * cb);
}`),r===Fe.HardLight&&e.code.add(S`float hardLight(in float cb, in float cl) {
return (1.0 - step(0.5, cl)) * (2.0 * cl * cb) + step(0.5, cl) * (1.0 - 2.0 * (1.0 - cl) * (1.0 - cb));
}`),r===Fe.SoftLight&&e.code.add(S`float softLight(in float cb, in float cl) {
if (cl <= 0.5) {
return cb - (1.0 - 2.0 * cl) * cb * (1.0 - cb);
}
if (cb <= 0.25) {
return cb + (2.0 * cl - 1.0) * cb * ((16.0 * cb - 12.0) * cb + 3.0);
}
return cb + (2.0 * cl - 1.0) * (sqrt(cb) - cb);
}`),r===Fe.VividLight&&e.code.add(S`float vividLight(in float cb, in float cl) {
return (1.0 - step(0.5, cl)) * colorBurn(cb, 2.0 * cl) + step(0.5, cl) * colorDodge(cb, (2.0 * (cl - 0.5)));
}`),r!==Fe.Hue&&r!==Fe.Saturation&&r!==Fe.Color&&r!==Fe.Luminosity||(e.code.add(S`float minv3(in vec3 c) {
return min(min(c.r, c.g), c.b);
}
float maxv3(in vec3 c) {
return max(max(c.r, c.g), c.b);
}
float lumv3(in vec3 c) {
return dot(c, vec3(0.3, 0.59, 0.11));
}
vec3 clipColor(vec3 color) {
float lum = lumv3(color);
float mincol = minv3(color);
float maxcol = maxv3(color);
if (mincol < 0.0) {
color = lum + ((color - lum) * lum) / (lum - mincol);
}
if (maxcol > 1.0) {
color = lum + ((color - lum) * (1.0 - lum)) / (maxcol - lum);
}
return color;
}
vec3 setLum(vec3 cbase, vec3 clum) {
return clipColor(cbase + vec3(lumv3(clum) - lumv3(cbase)));
}`),r!==Fe.Hue&&r!==Fe.Saturation||e.code.add(S`float satv3(vec3 c) {
return maxv3(c) - minv3(c);
}
vec3 setLumSat(vec3 cbase, vec3 csat, vec3 clum)
{
float minbase = minv3(cbase);
float sbase = satv3(cbase);
float ssat = satv3(csat);
return setLum(sbase > 0.0 ? (cbase - minbase) * ssat / sbase : vec3(0.0), clum);
}`)),e.code.add(S`
    vec4 applyBlendMode(vec3 cl, float ol, vec3 cb, float ob) {
      ${r===Fe.Multiply?S`return vec4(cl * ol * cb * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Fe.Average?S`return vec4((cb + cl) * 0.5 * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Fe.Lighten?S`return vec4(max(cb, cl) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Fe.Darken?S`return vec4(min(cl, cb) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Fe.Lighter?S`return vec4(cl * ol + cb * ob, ol + ob);`:r===Fe.Plus?S`return clamp(vec4(cl.rgb + cb.rgb, ol + ob), 0.0, 1.0);`:r===Fe.Minus?S`return vec4(clamp(vec3(cb.rgb - cl.rgb), 0.0, 1.0), ob * ol);`:r===Fe.Screen?S`return vec4((cl + cb - cl * cb) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Fe.Difference?S`return vec4(abs(cb - cl) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Fe.Invert?S`return vec4((1.0 - cb) * ol * ob + cb * ob * (1.0 - ol), ob);`:r===Fe.DestinationOver?S`return vec4(cl * ol * (1.0 - ob) + cb * ob, ol + ob - ol * ob);`:r===Fe.DestinationAtop?S`return vec4(cl * ol * (1.0 - ob) + cb * ob * ol, ol);`:r===Fe.DestinationOut?S`return vec4(cb * ob * (1.0 - ol), ob * (1.0 - ol));`:r===Fe.SourceAtop?S`return vec4(cl * ol * ob + cb * ob * (1.0 - ol), ob);`:r===Fe.SourceOut?S`return vec4(cl * ol * (1.0 - ob), ol * (1.0 - ob));`:r===Fe.Xor?S`return vec4(cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), ol * (1.0 - ob) + ob * (1.0 - ol));`:r===Fe.DestinationIn?S`return vec4(cb * ob * ol, ol * ob);`:r===Fe.SourceIn?S`return vec4(cl * ol * ob, ol * ob);`:r===Fe.Hue?S`
          vec3 f = setLumSat(cl, cb, cb);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Fe.Saturation?S`
          vec3 f = setLumSat(cb, cl, cb);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Fe.Color?S`
          vec3 f = setLum(cl, cb);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Fe.Luminosity?S`
          vec3 f = setLum(cb, cl);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Fe.Exclusion?S`
          vec3 f = cl + cb - 2.0 * cl * cb;
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Fe.Reflect?S`
          vec3 f = vec3(reflectBlend(cb.r, cl.r), reflectBlend(cb.g, cl.g), reflectBlend(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Fe.ColorDodge?S`
          vec3 f = vec3(colorDodge(cb.r, cl.r), colorDodge(cb.g, cl.g), colorDodge(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Fe.ColorBurn?S`
          vec3 f = vec3(colorBurn(cb.r, cl.r), colorBurn(cb.g, cl.g), colorBurn(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Fe.Overlay?S`
          vec3 f = vec3(overlay(cb.r, cl.r), overlay(cb.g, cl.g), overlay(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Fe.SoftLight?S`
          vec3 f = vec3(softLight(cb.r, cl.r), softLight(cb.g, cl.g), softLight(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Fe.HardLight?S`
          vec3 f = vec3(hardLight(cb.r, cl.r), hardLight(cb.g, cl.g), hardLight(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===Fe.VividLight?S`
          vec3 f = vec3(vividLight(cb.r, cl.r), vividLight(cb.g, cl.g), vividLight(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:S``}
    }
  `))}var Ia,Ns;function CSt(e){const t=new Qr,r=e.output===Ia.GridOnly,i=e.output===Ia.GridComposite,n=i||r,s=e.output===Ia.ColorOnly,a=e.output===Ia.ColorComposite,o=a||s,l=i||a;if(t.include(hMe),o&&t.fragment.uniforms.add(new St("backgroundColor",m=>m.backgroundColor)),e.baseOpacityMode!==Ns.One&&t.fragment.uniforms.add(new He("baseOpacity",m=>m.baseOpacity)),n&&(t.extensions.add("GL_OES_standard_derivatives"),t.fragment.include(jae)),r||s)return t.fragment.code.add(S`
    void main() {
      gl_FragColor = ${s?S`vec4(backgroundColor, 1.0)`:S`gridColor(uv)`};
    }
  `),t;const c=e.blendMode!==Fe.Normal,u=e.baseOpacityMode===Ns.OnBaseLayer,h=e.baseOpacityMode===Ns.OnBackground||e.baseOpacityMode===Ns.OnBaseLayer,p=e.premultipliedSource;return t.fragment.uniforms.add(new Wt("tex",m=>m.texture)),t.fragment.uniforms.add(new He("opacity",m=>m.opacity)),(c||u||p)&&(t.fragment.uniforms.add(new Wt("fboColor",m=>m.fboTexture)),t.fragment.uniforms.add(new He("tileSize",m=>_(m.fboTexture)?m.fboTexture.descriptor.width:1))),t.fragment.include(fMe,e),t.fragment.code.add(S`
    void main() {
      ${l||u||p?S`
      vec4 bgColor = ${a?S`vec4(backgroundColor, 1.0)`:i?S`gridColor(uv)`:S`texture2D(fboColor, gl_FragCoord.xy / tileSize)`};
      ${h?S`bgColor *= baseOpacity;`:""}`:""}
      vec4 colorLayer = texture2D(tex, uv);
      ${c?S`
          vec4 fboTex = ${l?S`bgColor;`:S`texture2D(fboColor, gl_FragCoord.xy / tileSize) ${u?" * baseOpacity":""};`}
          vec3 Cb = fboTex.a == 0.0 ? fboTex.rgb : vec3(fboTex.rgb * fboTex.a);
          gl_FragColor = applyBlendMode(colorLayer.rgb, colorLayer.a * opacity, Cb, fboTex.a);`:S`
          vec4 pmColorLayer = vec4(colorLayer.xyz, 1.0);
          float composeAlpha = colorLayer.a * opacity;
          gl_FragColor = ${p?S`bgColor * (1.0 - composeAlpha) + colorLayer * opacity;`:l||u?S`mix(bgColor, pmColorLayer, composeAlpha);`:S`pmColorLayer * composeAlpha;`}`}
    }
  `),t}(function(e){e[e.Composite=0]="Composite",e[e.ColorOnly=1]="ColorOnly",e[e.GridOnly=2]="GridOnly",e[e.ColorComposite=3]="ColorComposite",e[e.GridComposite=4]="GridComposite",e[e.COUNT=5]="COUNT"})(Ia||(Ia={})),function(e){e[e.One=0]="One",e[e.OnBackground=1]="OnBackground",e[e.OnBaseLayer=2]="OnBaseLayer",e[e.COUNT=3]="COUNT"}(Ns||(Ns={}));const ASt=Object.freeze(Object.defineProperty({__proto__:null,get BlendLayersOutput(){return Ia},get BaseOpacityMode(){return Ns},build:CSt},Symbol.toStringTag,{value:"Module"}));class VU extends SSt{constructor(t,r,i,n,s,a){super(t,n,s),this.colormap=r,this.symbolizer=i,this.u_colormap=a,this.backgroundColor=gl,this.fboTexture=null,this.baseOpacity=1}}class RSt extends VU{}class OSt extends VU{}function MSt(e){const t=new Qr;t.include(hMe),t.include(ESt),t.include(xSt),e.tileBlendInput===oo.GridComposite&&(t.extensions.add("GL_OES_standard_derivatives"),t.fragment.include(jae));const r=e.tileBlendInput===oo.ColorComposite;r&&t.fragment.uniforms.add(new St("backgroundColor",o=>o.backgroundColor)),e.baseOpacityMode!==Ns.One&&t.fragment.uniforms.add(new He("baseOpacity",o=>o.baseOpacity));const i=e.baseOpacityMode===Ns.OnBaseLayer,n=e.baseOpacityMode===Ns.OnBackground||e.baseOpacityMode===Ns.OnBaseLayer,s=e.blendMode!==Fe.Normal;t.fragment.include(fMe,e);const a=e.tileBlendInput!==oo.LayerOnly;return(s&&!a||i)&&(t.fragment.uniforms.add(new Wt("fboColor",o=>o.fboTexture)),t.fragment.uniforms.add(new He("tileSize",o=>_(o.fboTexture)?o.fboTexture.descriptor.width:1))),t.fragment.code.add(S`
    vec4 applyBackgroundBlend(vec4 layerColor) {
      ${a||i?S`
          vec4 bgColor = ${i?S`texture2D(fboColor, gl_FragCoord.xy / tileSize)`:r?S`vec4(backgroundColor, 1.0)`:S`gridColor(vuv)`};
          ${n?S`bgColor *= baseOpacity;`:""}`:""}
      ${s?S`
            vec3 pmColorLayer = layerColor.rgb * layerColor.a;
            vec4 fboTex = ${a?S`bgColor;`:S`texture2D(fboColor, gl_FragCoord.xy / tileSize) ${i?" * baseOpacity":""};`}
            vec3 Cb = fboTex.a == 0.0 ? fboTex.rgb : vec3(fboTex.rgb * fboTex.a);
            return applyBlendMode(pmColorLayer.rgb, layerColor.a * u_opacity, Cb, fboTex.a);`:a||i?S`
            float composeAlpha = layerColor.a * u_opacity;
            vec4 pmColorLayer = vec4(layerColor.rgb, 1.0);
            return mix(bgColor, pmColorLayer, composeAlpha);`:S`
            return layerColor * layerColor.a * u_opacity;`}
    }
  `),e.colorizerType===vw.Stretch?ISt(t,e):e.colorizerType===vw.Lut?PSt(t):e.colorizerType===vw.Hillshade&&$St(t,e),t}function PSt(e){e.fragment.code.add(S`void main() {
vec2 pixelLocation = getPixelLocation(uv);
if (isOutside(pixelLocation)) {
gl_FragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
return;
}
vec4 currentPixel = getPixel(pixelLocation);
gl_FragColor = applyBackgroundBlend(colormap(currentPixel, true));
}`)}function ISt(e,t){e.fragment.uniforms.add([new DO("u_bandCount",i=>i.symbolizer.u_bandCount),new Oo("u_minCutOff",i=>i.symbolizer.u_minCutOff,3),new Oo("u_maxCutOff",i=>i.symbolizer.u_maxCutOff,3),new Oo("u_factor",i=>i.symbolizer.u_factor,3),new He("u_minOutput",i=>i.symbolizer.u_minOutput),new He("u_maxOutput",i=>i.symbolizer.u_maxOutput),new Xw("u_useGamma",i=>i.symbolizer.u_useGamma),new Oo("u_gamma",i=>i.symbolizer.u_gamma,3),new Oo("u_gammaCorrection",i=>i.symbolizer.u_gammaCorrection,3),new He("u_opacity",i=>i.common.u_opacity)]),e.fragment.code.add(S`float stretchOneValue(float val, float minCutOff, float maxCutOff, float minOutput, float maxOutput, float factor, bool useGamma, float gamma, float gammaCorrection) {
if (val >= maxCutOff) {
return maxOutput;
} else if (val <= minCutOff) {
return minOutput;
}
float stretchedVal;
if (useGamma) {
float tempf = 1.0;
float outRange = maxOutput - minOutput;
float relativeVal = (val - minCutOff) / (maxCutOff - minCutOff);
if (gamma > 1.0) {
tempf -= pow(1.0 / outRange, relativeVal * gammaCorrection);
}
stretchedVal = (tempf * outRange * pow(relativeVal, 1.0 / gamma) + minOutput) / 255.0;
} else {
stretchedVal = minOutput + (val - minCutOff) * factor;
}
return stretchedVal;
}`);const r=t.applyColormap?S`gl_FragColor = applyBackgroundBlend(colormap(vec4(grayVal, grayVal, grayVal, currentPixel.a), !u_useGamma));`:S`gl_FragColor = applyBackgroundBlend(vec4(grayVal, grayVal, grayVal, currentPixel.a));`;e.fragment.code.add(S`
      void main() {
        vec2 pixelLocation = getPixelLocation(uv);
        if (isOutside(pixelLocation)) {
          gl_FragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
          return;
        }

        vec4 currentPixel = getPixel(pixelLocation);
        ${t.stretchType===ux.Noop?S`
        gl_FragColor = applyBackgroundBlend(currentPixel);`:S`
        if (currentPixel.a == 0.0) {
          gl_FragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
          return;
        }
        if (u_bandCount == 1) {
          float grayVal = stretchOneValue(currentPixel.r, u_minCutOff[0], u_maxCutOff[0], u_minOutput, u_maxOutput, u_factor[0], u_useGamma, u_gamma[0], u_gammaCorrection[0]);
          ${r}
        } else {
          float redVal = stretchOneValue(currentPixel.r, u_minCutOff[0], u_maxCutOff[0], u_minOutput, u_maxOutput, u_factor[0], u_useGamma, u_gamma[0], u_gammaCorrection[0]);
          float greenVal = stretchOneValue(currentPixel.g, u_minCutOff[1], u_maxCutOff[1], u_minOutput, u_maxOutput, u_factor[1], u_useGamma, u_gamma[1], u_gammaCorrection[1]);
          float blueVal = stretchOneValue(currentPixel.b, u_minCutOff[2], u_maxCutOff[2], u_minOutput, u_maxOutput, u_factor[2], u_useGamma, u_gamma[2], u_gammaCorrection[2]);
          gl_FragColor = applyBackgroundBlend(vec4(redVal, greenVal, blueVal, currentPixel.a));
        }`}
      }`)}function $St(e,t){const r=e.fragment;r.uniforms.add([new Wt("u_image",n=>n.u_image),new DO("u_hillshadeType",n=>n.symbolizer.u_hillshadeType),new Oo("u_sinZcosAs",n=>n.symbolizer.u_sinZcosAs,6),new Oo("u_sinZsinAs",n=>n.symbolizer.u_sinZsinAs,6),new Oo("u_cosZs",n=>n.symbolizer.u_cosZs,6),new Oo("u_weights",n=>n.symbolizer.u_weights,6),new _r("u_factor",n=>n.symbolizer.u_factor),new He("u_minValue",n=>n.symbolizer.u_minValue),new He("u_maxValue",n=>n.symbolizer.u_maxValue),new _r("u_srcImageSize",n=>n.common.u_srcImageSize)]),r.include($m),r.code.add(S`vec4 overlay(float val, float minValue, float maxValue, float hillshade, float alpha) {
val = clamp((val - minValue) / (maxValue - minValue), 0.0, 1.0);
vec3 hsv = rgb2hsv(colormap(vec4(val, val, val, 1.0), false).rgb);
hsv.z = hillshade;
return vec4(hsv2rgb(hsv) * alpha, alpha);
}`),r.code.add(S`float getNeighborHoodAlpha(float a, float b, float c, float d, float e, float f, float g, float h, float i){
if (a == 0.0 || a == 0.0 || a==0.0 || a == 0.0 || a == 0.0 || a==0.0 || a == 0.0 || a == 0.0 || a==0.0) {
return 0.0;
}  else {
return e;
}
}`);const i=t.applyColormap?S`gl_FragColor = applyBackgroundBlend(overlay(ve.r, u_minValue, u_maxValue, hillshade, alpha));`:S`hillshade *= alpha;
gl_FragColor = applyBackgroundBlend(vec4(hillshade, hillshade, hillshade, alpha));`;r.code.add(S`
    void main() {
      vec2 pixelLocation = getPixelLocation(uv);
      if (isOutside(pixelLocation)) {
        gl_FragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
        return;
      }

      vec4 currentPixel = getPixel(pixelLocation);
      if (currentPixel.a == 0.0) {
        gl_FragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
        return;
      }

      //mirror edge pixels
      vec2 axy = vec2(-1.0, -1.0);
      vec2 bxy = vec2(0.0, -1.0);
      vec2 cxy = vec2(1.0, -1.0);
      vec2 dxy = vec2(-1.0, 0.0);
      vec2 fxy = vec2(1.0, 0.0);
      vec2 gxy = vec2(-1.0, 1.0);
      vec2 hxy = vec2(0.0, 1.0);
      vec2 ixy = vec2(1.0, 1.0);
      vec2 onePixel = 1.0 / u_srcImageSize;
      if (pixelLocation.s < onePixel.s) {
        axy[0] = 1.0;
        dxy[0] = 1.0;
        gxy[0] = 1.0;
      }
      if (pixelLocation.t < onePixel.t) {
        axy[1] = 1.0;
        bxy[1] = 1.0;
        cxy[1] = 1.0;
      }
      if (pixelLocation.s > 1.0 - onePixel.s) {
        cxy[0] = -1.0;
        fxy[0] = -1.0;
        ixy[0] = -1.0;
      }
      if (pixelLocation.t > 1.0 - onePixel.t) {
        gxy[1] = -1.0;
        hxy[1] = -1.0;
        ixy[1] = -1.0;
      }

      // calculate hillshade
      vec4 va = texture2D(u_image, pixelLocation + onePixel * axy);
      vec4 vb = texture2D(u_image, pixelLocation + onePixel * bxy);
      vec4 vc = texture2D(u_image, pixelLocation + onePixel * cxy);
      vec4 vd = texture2D(u_image, pixelLocation + onePixel * dxy);
      vec4 ve = texture2D(u_image, pixelLocation);
      vec4 vf = texture2D(u_image, pixelLocation + onePixel * fxy);
      vec4 vg = texture2D(u_image, pixelLocation + onePixel * gxy);
      vec4 vh = texture2D(u_image, pixelLocation + onePixel * hxy);
      vec4 vi = texture2D(u_image, pixelLocation + onePixel * ixy);

      // calculate the rate of z change along the x, y, and diagonal direction
      float dzx = (vc + 2.0 * vf + vi - va - 2.0 * vd - vg).r * u_factor.s;
      float dzy = (vg + 2.0 * vh + vi - va - 2.0 * vb - vc).r * u_factor.t;
      float dzd = sqrt(1.0 + dzx * dzx + dzy * dzy);
      float hillshade = 0.0;

      // traditional single light source
      if (u_hillshadeType == 0){
        float cosDelta = u_sinZsinAs[0] * dzy - u_sinZcosAs[0] * dzx;
        float z = (u_cosZs[0] + cosDelta) / dzd;
        if (z < 0.0)  z = 0.0;
        hillshade = z;
      } else {
        // multi-directional with 6 light sources
        for (int k = 0; k < 6; k++) {
        float cosDelta = u_sinZsinAs[k] * dzy - u_sinZcosAs[k] * dzx;
        float z = (u_cosZs[k] + cosDelta) / dzd;
        if (z < 0.0) z = 0.0;
        hillshade = hillshade + z * u_weights[k];
        if (k == 5) break;
        }
      }

      // set color
      float alpha = getNeighborHoodAlpha(va.a, vb.a, vc.a, vd.a, ve.a, vf.a, vg.a, vh.a, vi.a);
      alpha *= u_opacity;
      ${i}
    }
  `)}const LSt=Object.freeze(Object.defineProperty({__proto__:null,ColorizerUniforms:VU,ColorizerStretchUniforms:RSt,ColorizerHillshadeUniforms:OSt,build:MSt},Symbol.toStringTag,{value:"Module"}));function DSt(e,t,r="nearest",i=!1){var c;const n=!(i&&t.pixelType==="u8"),s=n?At.FLOAT:At.UNSIGNED_BYTE,a=t.pixels==null||t.pixels.length===0?null:n?t.getAsRGBAFloat():t.getAsRGBA(),o=(c=e.capabilities.textureFloat)==null?void 0:c.textureFloatLinear,l={width:t.width,height:t.height,target:mt.TEXTURE_2D,pixelFormat:Ue.RGBA,internalFormat:e.type===yr.WEBGL2&&n?gt.RGBA32F:Ue.RGBA,samplingMode:!o||r!=="bilinear"&&r!=="cubic"?tt.NEAREST:tt.LINEAR,dataType:s,wrapMode:xt.CLAMP_TO_EDGE,flipped:!1};return new at(e,l,a)}function FSt(e,t){const{spacing:r,offsets:i,coefficients:n,size:[s,a]}=t,o=r[0]>1,l={width:o?4*s:s,height:a,target:mt.TEXTURE_2D,pixelFormat:Ue.RGBA,internalFormat:e.type===yr.WEBGL2?gt.RGBA32F:Ue.RGBA,dataType:At.FLOAT,samplingMode:tt.NEAREST,wrapMode:xt.CLAMP_TO_EDGE,flipped:!1},c=new Float32Array(o?s*a*16:2*i.length);if(o)for(let u=0,h=0;u<n.length;u++)c[h++]=n[u],u%3==2&&(c[h++]=1);else for(let u=0;u<a;u++)for(let h=0;h<s;h++){const p=4*(u*s+h),m=2*(h*a+u);c[p]=i[m],c[p+1]=i[m+1],c[p+3]=i[m]===-1?0:1}return new at(e,l,c)}function Eye(e,t){const r={width:t.length/4,height:1,target:mt.TEXTURE_2D,pixelFormat:Ue.RGBA,internalFormat:Ue.RGBA,dataType:At.UNSIGNED_BYTE,samplingMode:tt.NEAREST,wrapMode:xt.CLAMP_TO_EDGE,flipped:!1};return new at(e,r,t)}function NSt(e,t,r,i=1,n=!0){return{u_flipY:n,u_applyTransform:!!e,u_opacity:i,u_transformSpacing:e?e.spacing:Zh,u_transformGridSize:e?e.size:Zh,u_targetImageSize:t,u_srcImageSize:r}}function kSt(e,t){return{u_colormapOffset:t||0,u_colormapMaxIndex:e?e.length/4-1:0}}function VSt(e){return{u_bandCount:e.bandCount,u_minOutput:e.outMin,u_maxOutput:e.outMax,u_minCutOff:e.minCutOff,u_maxCutOff:e.maxCutOff,u_factor:e.factor,u_useGamma:e.useGamma,u_gamma:e.gamma,u_gammaCorrection:e.gammaCorrection}}function zSt(e){return{u_hillshadeType:e.hillshadeType,u_sinZcosAs:e.sinZcosAs,u_sinZsinAs:e.sinZsinAs,u_cosZs:e.cosZs,u_weights:e.weights,u_factor:e.factor,u_minValue:e.minValue,u_maxValue:e.maxValue}}const Cye={bandCount:3,outMin:0,outMax:1,minCutOff:[0,0,0],maxCutOff:[255,255,255],factor:[1/255,1/255,1/255],useGamma:!1,gamma:[1,1,1],gammaCorrection:[1,1,1],colormap:null,colormapOffset:null,stretchType:"none",type:"stretch"};class USt{constructor(t,r,i=null,n=null){this.type="raster-tile",this._memoryUsed=null,this._source=null,this._symbolizerParameters=null,this._bandIds=null,this._interpolation=null,this._dirty=!1,this._transformGrid=null,this.isRendereredSource=!1,this.symbolizerRenderer=null,this.rawPixelData=null,this.lij=null,this.opacity=1,this.lij=t,this.source=r,this.width=i||r.width,this.height=n||r.height}get source(){return this._source}set source(t){this._source=t,this._rasterTexture=Qe(this._rasterTexture),this._memoryUsed=null}get symbolizerParameters(){return this.isRendereredSource?{...Cye,maxCutOff:[1,1,1],factor:[1,1,1]}:this._symbolizerParameters||Cye}set symbolizerParameters(t){this._symbolizerParameters=t}get bandIds(){return this._bandIds}set bandIds(t){_(t)&&t.length>0?this._bandIds&&t.every((r,i)=>!!this._bandIds[i]&&r===this._bandIds[i])||(this._bandIds=t,this._dirty=!0):this._bandIds=null}get interpolation(){return this._interpolation||"nearest"}set interpolation(t){if(this._interpolation=t,_(this._rasterTexture)){const r=this._getRasterTextureInterpolation(t);this._rasterTexture.setSamplingMode(r==="bilinear"?tt.LINEAR:tt.NEAREST)}}get transformGrid(){return this._transformGrid}set transformGrid(t){this._transformGrid=t,this._transformGridTexture=Qe(this._transformGridTexture),this._memoryUsed=null}bind(t){return!!(this.source&&this.source.pixels&&this.source.pixels.length>0)&&((R(this._rasterTexture)||this._dirty)&&this._updateRasterTexture(t,this.bandIds),_(this._rasterTexture)&&(this._updateColormapTexture(t),this.transformGrid&&R(this._transformGridTexture)&&(this._transformGridTexture=FSt(t,this.transformGrid))),!0)}getUniforms(){const{symbolizerParameters:t,transformGrid:r,width:i,height:n,opacity:s}=this,a=NSt(r,[i,n],[this.source.width,this.source.height],s),o=kSt(t.colormap,t.colormapOffset),l=this.symbolizerParameters.type==="stretch"?VSt(this.symbolizerParameters):null,c=this.symbolizerParameters.type==="hillshade"?zSt(this.symbolizerParameters):null;return new VU(a,o,l||c,this._rasterTexture,this._transformGridTexture,this._colormapTexture)}get memoryUsage(){if(R(this._memoryUsed)){const t=[this._rasterTexture,this._transformGridTexture,this._colormapTexture];this._memoryUsed=t.map(r=>_(r)?r.descriptor.width*r.descriptor.height*4:0).reduce((r,i)=>r+i,0)}return this._memoryUsed}release(){return this._rasterTexture=Qe(this._rasterTexture),this._transformGridTexture=Qe(this._transformGridTexture),this._colormapTexture=Qe(this._colormapTexture),this.source=null,this.transformGrid=null,this.rawPixelData=null,!0}_updateRasterTexture(t,r){const i=this.source?this.source.extractBands(r):null;if(!(i&&i.pixels&&i.pixels.length>0))return void(this._rasterTexture=Qe(this._rasterTexture));const n=R(r)&&R(this.bandIds)||_(r)&&_(this.bandIds)&&r.join("")===this.bandIds.join("");if(_(this._rasterTexture)&&n)return;this._rasterTexture=Qe(this._rasterTexture);const s=this._getRasterTextureInterpolation(this.interpolation);this._rasterTexture=DSt(t,i,s,this.isRendereredSource||this.hasStretchTypeNone())}hasStretchTypeNone(){return"stretchType"in this.symbolizerParameters&&this.symbolizerParameters.stretchType==="none"&&!this.symbolizerParameters.useGamma&&this.source.pixelType==="u8"}_getRasterTextureInterpolation(t){return this.symbolizerParameters.type==="lut"||t==="nearest"||t==="majority"?"nearest":"bilinear"}_updateColormapTexture(t){const r=this._colormap,i=this.symbolizerParameters.colormap;return i?r?i.length!==r.length||i.some((n,s)=>n!==r[s])?(this._colormapTexture=Qe(this._colormapTexture),this._colormapTexture=Eye(t,i),void(this._colormap=i)):void 0:(this._colormapTexture=Eye(t,i),void(this._colormap=i)):(this._colormapTexture=Qe(this._colormapTexture),void(this._colormap=null))}}class TD{constructor(){this.waitingAgents=new Qt,this._upsampleInfo=null,this.loadingAgent=null,this.requestPromise=null,this.requestAbort=null,this.pendingUpdates=0}static acquire(t){const r=aH.acquire();return r._init(t),r}release(){this.dispose(),SD.delete(this),aH.release(this)}dispose(){this.loadingAgent=Qe(this.loadingAgent),this.abortRequest(),this._unsetUpsampleInfo(),this.pendingUpdates=0,this._data=a5(this._data)}static prune(){aH.prune(0)}_init(t){this.waitingAgents.clear(),this._data=a5(this._data),this.dataMissing=!1,this.dataInvalidated=!1,this._unsetUpsampleInfo(),this.abortRequest(),this.loadingAgent=null,this.pendingUpdates=0,this._pool=t,this.elevationBounds=null}invalidateSourceData(){this.dataInvalidated=!0,this.dataMissing=!1,this._unsetUpsampleInfo()}abortRequest(){this.requestAbort=qh(this.requestAbort),this.requestPromise=null}get upsampleInfo(){return this._upsampleInfo}_unsetUpsampleInfo(){_(this._upsampleInfo)&&(this._upsampleInfo.tile.unrefMapData(),this._pool.release(this._upsampleInfo),this._upsampleInfo=null)}setUpsampleInfo(t,r){if(t===r||R(r))this._unsetUpsampleInfo();else{if(R(this._upsampleInfo))this._upsampleInfo=this._pool.acquire();else{if(this._upsampleInfo.tile===r)return;this._upsampleInfo.tile.unrefMapData()}r.refMapData(),bSt(t,r,this._upsampleInfo)}}get data(){return this._data}set data(t){a5(this._data),this._data=t}}const aH=new Fn(TD,null,()=>{}),SD=new Map;function BSt(){SD.size>0&&(console.log(`${SD.size} live TilePerLayerInfo allocations:`),SD.forEach(e=>console.log(e,`
`)))}class LS{constructor(t){this._texture=t,this.type="tile-texture",this._refCount=1}retain(){++this._refCount}release(){--this._refCount,this._refCount===0&&this._texture.dispose()}get texture(){return this._texture}generateMipmap(){this._texture.generateMipmap()}get descriptor(){return this._texture.descriptor}}var wt;(function(e){e[e.NONE=0]="NONE",e[e.NONE_HIT_MAXLOD=1]="NONE_HIT_MAXLOD",e[e.SPLIT=2]="SPLIT",e[e.VSPLITMERGE=4]="VSPLITMERGE",e[e.MERGE=8]="MERGE",e[e.RENDERDATA=16]="RENDERDATA",e[e.GEOMETRY=32]="GEOMETRY",e[e.TEXTURE_NOFADING=64]="TEXTURE_NOFADING",e[e.TEXTURE_FADING=128]="TEXTURE_FADING"})(wt||(wt={}));const oH=M(),ST=M(),ha=M(),GSt=.1;class jSt{constructor(){this.fovX=0,this.fovY=0,this.relativeWidthLimit=0,this.relativeHeightLimit=0,this.maxLod=0,this.angledSplitBias=0,this.aboveGround=!0}}class qae{constructor(){this.lij=[0,0,0],this._children=[null,null,null,null],this._pendingUpdates=0,this._dirty=!0,this._previouslyRendered=!1,this.extent=zt(),this._elevationBounds=it(),this.layerInfo=[[],[]],this.extentInRadians=zt(),this.centerAtSeaLevel=M(),this._center=[M(),Us(),M()],this.up=nre(),this._isWithinClippingArea=!0,this._intersectsClippingArea=!0,this._maxTesselation=0,this._usedMemory=null,this._mapTileMemory=0,this._mapDataRefCount=0,this._screenDepth=0,this.renderOrder=0,this._edgeLen=0,this._edgeLen2=0,this._curvatureHeight=0}static prune(){Hae.prune(0),Wae.prune(0),TD.prune()}get isCached(){return!this.shouldLoad&&this._mapDataRefCount<=0}get maxTesselation(){return this._maxTesselation}get isWithinClippingArea(){return this._isWithinClippingArea}get intersectsClippingArea(){return this._intersectsClippingArea}get clippingArea(){return this._clippingArea}get parent(){return this._parent}get children(){return this._children}get surface(){return this._surface}get elevationBounds(){return this._elevationBounds}get level(){return this.lij[0]}get key(){return`${this.lij[0]}/${this.lij[1]}/${this.lij[2]}`}get edgeLen(){return this._edgeLen}get radius(){return this._center[nl.MIDDLE][3]}get screenDepth(){return this._screenDepth}get visible(){return this._dirty&&this.computeVisibility(),this._visible}computeVisibility(){this._dirty=!1;const t=this._intersectsClippingArea&&this._isVisible(this.surface.frustum);return t!==this._visible&&(this._visible=t,this._surface.emit("tiles-visibility-changed"),this._surface.renderer.setNeedsRender(),this.updateAgentSuspension()),this._visible}get loadable(){return this.visible||this._surface.view.state.fixedContentCamera}get rendered(){const t=!!this.renderData;return t!==this._previouslyRendered&&(this._surface.emit("tiles-visibility-changed"),this._previouslyRendered=t,this._surface.renderer.setNeedsRender()),t}get shouldLoad(){if(!this.loadable)return!1;if(this._surface.lodSnapping===I9.ON){const t=this.level-this._surface.snapLevel;if(t===0)return!0;if(t===1)return!1}return this.isLeaf}init(t,r,i){this.lij[0]=t[0],this.lij[1]=t[1],this.lij[2]=t[2],this.ellipsoid=Ar(i.tilingScheme.spatialReference),i.tilingScheme.getExtent(t[0],t[1],t[2],this.extent),i.tilingScheme.convertExtentToRadians(this.extent,this.extentInRadians),this._isWithinClippingArea=!0,this._intersectsClippingArea=!0,this._clippingArea=null,this._mapDataRefCount=0,i.upsampleMapCache.pop(this.key),this._edgeLen=0,this._edgeLen2=0,this._center[nl.MIDDLE][3]=0,this.vlevel=t?t[0]:0,r&&r.elevationBounds?Na(this._elevationBounds,r.elevationBounds):vr(this._elevationBounds,0,0),this._pendingUpdates=0,this.renderData=null,this._screenDepth=0,this._visible=!1,this._previouslyRendered=!1,this._parent=r,this.unsetChildren(),this._surface=i,this.updateVisibility();for(const n of t3){const s=i.numLayers(n),a=this.layerInfo[n];for(const o of a)o.release();a.length=s;for(let o=0;o<s;o++)a[o]=TD.acquire(this._surface.upsampleInfoPool),n===er.ELEVATION&&this.findElevationBoundsForLayer(o,-1)}this.computeElevationBounds(),this._maxTesselation=Math.min(i.tilingScheme.pixelSize,mJ)}release(){V0(!this.renderData,"tile.renderData was not unloaded"),this._surface.upsampleMapCache.pop(this.key);for(const t of t3){for(const r of this.layerInfo[t])r.release();this.layerInfo[t].length=0}this._parent=null,this._surface=null,this.setMemoryDirty()}refMapData(){++this._mapDataRefCount,this.isCached||this._surface.upsampleMapCache.pop(this.key)}unrefMapData(){if(--this._mapDataRefCount,this.isCached){this.setMemoryDirty();const t=this.cachedMemory;t>0&&this._surface.upsampleMapCache.put(this.key,this,t)}}setMemoryDirty(){this._usedMemory=null}get usedMemory(){return this._ensureUsedMemory()+(this.isCached?0:this._mapTileMemory)}get cachedMemory(){return this.isCached?this.mapTileMemory:0}get mapTileMemory(){return this._ensureUsedMemory(),this.layerInfo[er.MAP].reduce((t,r)=>t+(r instanceof E7?r.memoryUsage:0),this._mapTileMemory)}get cpuImageMemorySize(){const r=this._surface.tilingScheme.pixelSize;return r*r*4}_ensureUsedMemory(){if(_(this._usedMemory))return this._usedMemory;this._usedMemory=0,this._mapTileMemory=0;let t=0;for(const{data:i}of this.layerInfo[er.MAP])i instanceof E7?t+=this._getTerrainDataMemory(i):this._mapTileMemory+=this._getTerrainDataMemory(i);const r=this.cpuImageMemorySize;for(const i of this.layerInfo[er.ELEVATION])this._usedMemory+=i.data?r:0;return this.renderData&&(this._usedMemory+=this.renderData.estimatedGeometryMemoryUsage,this._mapTileMemory+=Ww(this.renderData.textureDescriptor)),this.isCached&&this._surface.upsampleMapCache.updateSize(this.key,this,this._mapTileMemory+t),this._usedMemory}getUsedMemoryForLayer(t,r){const i=this.layerInfo[t][r];return i!=null&&i.data?t===er.MAP?this.isCached?0:this._getTerrainDataMemory(i.data):t===er.ELEVATION?this.cpuImageMemorySize:0:0}_getTerrainDataMemory(t){return t instanceof LS?Ww(t.texture):t instanceof HTMLImageElement||t instanceof DU?this.cpuImageMemorySize:t instanceof E7||t instanceof USt?t.memoryUsage:0}updateScreenDepth(t){const r=this._center[nl.MIDDLE],i=t,n=r[0],s=r[1],a=r[2],o=i[2]*n+i[6]*s+i[10]*a+i[14];this._screenDepth=o<0?0:o/(i[3]*n+i[7]*s+i[11]*a+i[15])}shouldSplit(t,r,i){if(_(t.frustum)&&(!this._intersectsClippingArea||!this._isVisible(t.frustum)))return wt.NONE;const n=this.level;pe(oH,this._center[nl.MIDDLE],r);let s=fl(oH),a=nl.MIDDLE;pe(ST,this._center[nl.TOP],r);const o=fl(ST);o<s&&(s=o,a=nl.TOP),pe(ST,this._center[nl.BOTTOM],r);const l=fl(ST);if(l<s&&(s=l,a=nl.BOTTOM),this._edgeLen2>s&&n<t.maxLod)return wt.SPLIT;const c=Math.sqrt(s),u=t.fovX*c*2,h=this._edgeLen/u,p=()=>{const w=n+Math.ceil(-Math.log2(t.relativeWidthLimit/h));return w!==this.vlevel?(this.vlevel=w,wt.VSPLITMERGE):wt.NONE_HIT_MAXLOD};if(i===I9.ON&&this._surface.snapLevel-n===1)return n>=t.maxLod?p():wt.SPLIT;const m=Se(this.up,oH),g=this._elevationBounds[1]-this._elevationBounds[0],b=g/this.edgeLen;if(t.aboveGround&&m>0&&b<.001&&m/c-Math.sin(this._curvatureHeight/(this.edgeLen*Math.SQRT1_2)*Math.PI)-b>0)return wt.NONE;if(h<t.relativeWidthLimit)return this.vlevel!==this.level?(this.vlevel=this.level,wt.VSPLITMERGE):wt.NONE;if(n>=t.maxLod)return p();if(n>6){pe(ST,this._center[a],r),le(ha,this.up,m),pe(ha,ha,ST);const w=fl(ha);if(w>this.radius*this.radius){le(ha,ha,this.radius/Math.sqrt(w)),he(ha,ha,this._center[a]),pe(ha,r,ha);const v=Math.min(1,(Math.abs(Se(ha,this.up))+.5*g+this._curvatureHeight)/Oe(ha)),x=GSt/t.angledSplitBias,T=t.fovY*c*2;if(v*(this._edgeLen/T)<x*t.relativeHeightLimit)return wt.NONE}}return wt.SPLIT}setChildren(t,r,i,n){V0(!!(t&&r&&i&&n),"Null child passed"),this._children[0]=t,this._children[1]=r,this._children[2]=i,this._children[3]=n}unsetChildren(){this._children[0]=null,this._children[1]=null,this._children[2]=null,this._children[3]=null}get isLoaded(){var t,r;return(r=(t=this.renderData)==null?void 0:t.hasGeometry)!=null?r:!1}prepareToLoad(t){this.refMapData();for(const r of t3)this._createOrUpdateAgents(0,r);t.updateTileGeometryState(this)}load(t){this.prepareToLoad(t),this.loadPrepared(t)}loadPrepared(t){t.loadTile(this)}unload(t){t.unloadTile(this);for(const r of t3){const i=this.layerInfo[r];for(const n of i)n.loadingAgent&&n.loadingAgent!==Ec&&(qI(n.loadingAgent),n.loadingAgent=null),n.pendingUpdates=0}this.resetPendingUpdate(wt.GEOMETRY),this.resetPendingUpdate(wt.TEXTURE_NOFADING),this.resetPendingUpdate(wt.TEXTURE_FADING),this.unrefMapData()}unloadMapData(){const t=this.layerInfo[er.MAP];for(const r of t)r.loadingAgent&&r.loadingAgent!==Ec&&(qI(r.loadingAgent),r.loadingAgent=null),r.pendingUpdates=0;this.renderData&&this.renderData.releaseTexture(),this.setMemoryDirty()}updateClippingStatus(t){if(sw(t,this._clippingArea))return!1;const r=this._intersectsClippingArea,i=this._isWithinClippingArea;_(t)?(this._intersectsClippingArea=this.intersectsExtent(t),this._isWithinClippingArea=this._isWithinExtent(t)):(this._intersectsClippingArea=!0,this._isWithinClippingArea=!0),this._clippingArea=t,this.updateVisibility();const n=i&&this._isWithinClippingArea,s=!(i||r||this._isWithinClippingArea||this._intersectsClippingArea);return!this.renderData||n||s||this.setPendingUpdate(wt.GEOMETRY),!0}updateVisibility(){this._dirty=!0,this._surface.setTileTreeDirty()}getLayerInfo(t,r){return this.layerInfo[r][t]}hasLayerData(t,r){const i=this.layerInfo[r][t];return!(!i||!i.data||i.dataInvalidated)}get updating(){if(this.hasPendingUpdates)return!0;for(const t of t3){const r=this.layerInfo[t];for(const i of r)if(i.loadingAgent&&i.loadingAgent!==Ec&&i.loadingAgent.updating)return!0}return!1}_isSuspended(t){return!!this.hasPendingUpdate(wt.SPLIT)||t!==er.ELEVATION&&!this.loadable}get hasPendingUpdates(){return this._pendingUpdates!==0}hasPendingUpdate(t){return(this._pendingUpdates&t)===t}setPendingUpdate(t){this._pendingUpdates|=t,t===wt.SPLIT||t===wt.MERGE?this._surface.setTileTreeDirty():this._surface.requestUpdate()}resetPendingUpdate(t){return!!this.hasPendingUpdate(t)&&(this._pendingUpdates&=~t,!0)}requestLayerData(t,r,i){const n=this.layerInfo[r][t];if(n.waitingAgents.has(i))return console.warn("agent already requested this piece of map data (tile %s, agent tile %s, layer: %d/%d)",this.lij.toString(),i.tile.lij.toString(),r,t),!0;if(n.waitingAgents.push(i),n.data&&!n.dataInvalidated)return console.warn("agent requested existing data (tile %s, agent tile %s, layer: %d/%d)",this.lij.toString(),i.tile.lij.toString(),r,t),i.dataArrived(this),!0;if(n.requestPromise)return!0;qh(n.requestAbort),n.requestAbort=new AbortController;const s=this._surface.requestTileData(this,t,r,n.requestAbort);if(!s)return n.requestAbort=null,!1;const a=()=>{n.requestPromise===s&&(n.requestPromise=null,n.requestAbort=null)};return n.requestPromise=s,s.then(a,a),!0}get isLeaf(){return this._children[0]==null}hasLij(t){return this.lij[0]===t[0]&&this.lij[1]===t[1]&&this.lij[2]===t[2]}findByLij(t){return this.hasLij(t)?this:this.isLeaf?null:this._children[0].findByLij(t)||this._children[1].findByLij(t)||this._children[2].findByLij(t)||this._children[3].findByLij(t)||null}distanceToSquared(t){return fl(pe(ha,this._center[nl.MIDDLE],t))}containsPoint(t){const r=this.extent;return t[0]>=r[0]&&t[1]>=r[1]&&t[0]<=r[2]&&t[1]<=r[3]}unrequestLayerData(t,r,i){const n=this.layerInfo[r][t],s=n.waitingAgents,a=s.removeUnordered(i)!=null;V0(a,"agent has not requested this piece of map data"),s.length<1&&(n.abortRequest(),this.setMemoryDirty())}dataArrived(t,r,i){const n=this.layerInfo[r][t];n.data=i,n.dataInvalidated=!1,n.waitingAgents.forAll(s=>s.dataArrived(this)),n.waitingAgents.clear(),this.setMemoryDirty()}dataMissing(t,r,i){i.notInTilemap||console.error(`Tile ${this.lij.toString()} layer ${r}/${t} error ${i}`);const n=this.layerInfo[r][t];n.dataMissing=!0,n.waitingAgents.forAll(s=>s.dataMissing()),n.waitingAgents.clear(),this.setMemoryDirty()}updateRenderData(t,r){switch(t){case er.MAP:return this._updateTexture(r);case er.ELEVATION:return this._updateGeometry()}}_updateTexture(t){this.renderData&&(this.resetPendingUpdate(t===sa.FADING?wt.TEXTURE_NOFADING:wt.TEXTURE_FADING),this.setPendingUpdate(t===sa.FADING?wt.TEXTURE_FADING:wt.TEXTURE_NOFADING))}_updateGeometry(){this.setPendingUpdate(wt.GEOMETRY);for(const t of this.layerInfo[er.ELEVATION])t.pendingUpdates|=wt.GEOMETRY}invalidateLayerData(t,r){this.layerInfo[r][t].invalidateSourceData(),this.restartAgents(r)}computeElevationBounds(){const t=this._elevationBounds;vr(t,Number.MAX_VALUE,-Number.MAX_VALUE);const r=this.layerInfo[er.ELEVATION];let i=!0;for(const n of r)_(n.elevationBounds)&&(t[0]=Math.min(t[0],n.elevationBounds.min),t[1]=Math.max(t[1],n.elevationBounds.max),n.elevationBounds.hasNoDataValues||(i=!1));i&&(t[0]=Math.min(t[0],0),t[1]=Math.max(t[1],0)),this.updateRadiusAndCenter(),this._surface.setTileTreeDirty()}_updateCenter(){const t=this._elevationBounds,r=.5*(t[0]+t[1]);le(ha,this.up,r),he(this._center[nl.MIDDLE],this.centerAtSeaLevel,ha),le(ha,this.up,t[0]),he(this._center[nl.TOP],this.centerAtSeaLevel,ha),le(ha,this.up,t[1]),he(this._center[nl.BOTTOM],this.centerAtSeaLevel,ha)}findElevationBoundsForLayer(t,r){const i=this.layerInfo[er.ELEVATION][t];if(_(i.elevationBounds)&&i.elevationBounds.level>=r)return;const n=this._surface.layerViewByIndex(t,er.ELEVATION),s=xK(n);if(!C7(this,s,!1))return;const a=HSt;let o=!1;if(i.data){const l=i.data;a.min=l.bounds[0],a.max=l.bounds[1],a.hasNoDataValues=l.hasNoDataValues,a.level=this.level,o=!0}else{let l,c,u=0;for(let h=this._parent;h&&(!c||u<HL(this.level))&&(u=this.vlevel-h.level,l=c||l,c=h.layerInfo[er.ELEVATION][t].data,!(!c&&l&&u>=HL(this.level)));h=h.parent);c=c||l,c&&(c.computeMinMaxValue(this.lij[0],this.lij[1],this.lij[2],a),a.min!==1/0&&(a.level=c.level,o=!0))}o&&(R(i.elevationBounds)&&(i.elevationBounds=new Uae),i.elevationBounds.copyFrom(a))}modifyLayers(t,r,i){const n=this.layerInfo[i];for(const o of n)o.loadingAgent&&o.loadingAgent!==Ec&&(qI(o.loadingAgent),o.loadingAgent=null),o.waitingAgents.clear();for(let o=0;o<n.length;++o)t[o]===void 0&&n[o].release();const s=new Array(...n),a=r.length;n.length=a;for(let o=0;o<a;o++){const l=r[o];n[o]=l>-1?s[l]:TD.acquire(this._surface.upsampleInfoPool)}this.setMemoryDirty()}restartAgents(t){this.renderData&&(this._createOrUpdateAgents(0,t),this.updateRenderData(t,sa.FADING))}updateAgents(t){if(this.renderData){const r=this.layerInfo[t];for(const i of r)i.loadingAgent===Ec&&(i.loadingAgent=null);this._createOrUpdateAgents(0,t)}}updateAgentSuspension(){for(const t of t3){const r=this._isSuspended(t);for(const i of this.layerInfo[t])i.loadingAgent&&i.loadingAgent!==Ec&&(i.loadingAgent.setSuspension(r),i.loadingAgent===Ec&&this.updateRenderData(t,sa.FADING))}}removeLayerAgent(t,r){const i=this.layerInfo[r][t];i.loadingAgent&&i.loadingAgent!==Ec&&i.loadingAgent.dispose(),i.loadingAgent=null}agentDone(t,r){const i=this.layerInfo[r][t];i.loadingAgent=Ec,!i.data&&R(i.upsampleInfo)&&this._createOrUpdateAgents(t+1,r)}_createOrUpdateAgents(t,r){const i=this.layerInfo[r];if(i.length===0)return;const n=(()=>{for(let a=t;a<i.length;++a){const o=this._surface.layerViewByIndex(a,r);if(Ak(o)&&o.layer.blendMode!=="normal")return!0}return!1})(),s=this._isSuspended(r);for(let a=t;a<i.length;++a){const o=i[a];let l=!1;const c=this._surface.layerViewByIndex(a,r),u=xK(c);if(o.loadingAgent?C7(this,u,!1)?(o.loadingAgent!==Ec&&o.loadingAgent.setSuspension(s),o.loadingAgent!==Ec&&(l=o.loadingAgent.update())):o.dispose():C7(this,u,!1)&&(o.loadingAgent=qSt(this,a,r,s),l=o.loadingAgent.startLoading(),l?o.loadingAgent===Ec&&this.setPendingUpdate(wt.GEOMETRY):(qI(o.loadingAgent),o.loadingAgent=Ec)),o.loadingAgent===Ec&&this.updateRenderData(r,sa.FADING),!n&&l&&c.isOpaque)return}}_isWithinExtent(t){const r=this.extent;return r[0]>=t[0]&&t[2]>=r[2]&&r[1]>=t[1]&&t[3]>=r[3]}intersectsExtent(t){const r=this.extent;return r[2]>=t[0]&&t[2]>=r[0]&&r[3]>=t[1]&&t[3]>=r[1]}getElevationBasedVerticesPerSide(t){const r=this.vlevel-this.level,i=Math.max(this.level-t,HL(this.level)-r);return Le(1+(this.maxTesselation>>i),2,this.maxTesselation+1)}get test(){return{cachedMemory:this.cachedMemory}}_findLIJ(t,r){if(!t)return null;const i=this.surface.rootTiles;if(_(i)){for(const n of i)if(WSt(n,t)){let s=n,a=t[0]-s.level-1;for(;a>=0&&!s.isLeaf&&!r(s);){const o=t[1]>>a&1,l=t[2]>>a&1;s=s.children[2*o+l],a--}return r(s)?s:null}}return null}findNeighborTile(t,r){const i=this.lij,n=this.getNeighborLIJ(i,t);return n?XSt(i,n)?r(this)?this:null:this._findLIJ(n,r):null}findCorner(t,r){const i=t===Bt.NORTH_EAST?1:t===Bt.NORTH_WEST?0:t===Bt.SOUTH_WEST?2:3;let n=this;for(;!(n.isLeaf||r&&r(n));)n=n.children[i];return n}findNeighborCornerTileExact(t,r){var i;return(i=this.findNeighborTile(t,n=>r(n)||n.level===this.level))==null?void 0:i.findCorner(Rk(t),r)}forAllSubtreeOnSide(t,r){const i=t===Bt.NORTH?[0,1]:t===Bt.NORTH_EAST?[1]:t===Bt.EAST?[1,3]:t===Bt.SOUTH_EAST?[3]:t===Bt.SOUTH?[2,3]:t===Bt.SOUTH_WEST?[2]:t===Bt.WEST?[0,2]:[0],n=s=>{r(s)||s.isLeaf||i.forEach(a=>n(s.children[a]))};n(this)}forallNeighbors(t){Ok.forEach(r=>this.findNeighborCornerTileExact(r,t)),Z1.forEach(r=>{var i;return(i=this.findNeighborTile(r,n=>n.level===this.level||t(n)))==null?void 0:i.forAllSubtreeOnSide(wD(r),t)})}getNeighborEdgeStartVertexIndex(t,r){const i=r!=null?r:this.findNeighborTile(Z1[t],u=>u.isLoaded);if(!i||!this.isLoaded||!i.isLoaded)return 0;const n=this.level-i.level;if(n===0)return 0;const s=2**n,a=(1&t)==1,o=a?0:1,l=i.lij[o+1]*s,c=this.lij[o+1]-l;return a?s-1-c:c}_updateNeighborsWithChangedEdgeResolution(){for(let t=0;t<4;++t)if(this.renderData.geometryState.neighborData.modifiedEdgeResolutions[t]){const r=Z1[t],i=this.findNeighborTile(r,n=>n.isLoaded||n.level===this.level);if(!i)continue;if(!i.isLoaded){i.isLeaf;const n=(t+2)%4,s=wD(r);i.forAllSubtreeOnSide(s,a=>a.isLoaded?(a.updateEdgeAfterResolutionChange(n),!0):(a.isLeaf,!1))}this.renderData.geometryState.neighborData.modifiedEdgeResolutions[t]=!1}}updateNeighborDataAndGeometryIfNeeded(){this.isLoaded&&this.renderData.updateNeighborDataAndGeometryIfNeeded()}updateNeighborsAfterGeometryChange(t=this.level){this.forEachLoadedNeighbor(r=>this._updateNeighbor(r)),Z1.forEach(r=>{var i;(i=this.findNeighborTile(r,n=>n.isLoaded&&n.level<t))==null||i.updateNeighborsWithChangedEdgeResolution()})}updateNeighborsWithChangedEdgeResolution(){this.isLoaded&&this._updateNeighborsWithChangedEdgeResolution()}updateEdgeAfterResolutionChange(t){this.renderData.updateEdgeAfterResolutionChange(t)}forEachLoadedNeighbor(t){const r=this.level,i=n=>n.level===r||n.isLoaded;Z1.forEach((n,s)=>{var l,c;const a=this.findNeighborTile(n,i);a!=null&&a!==this&&a.forAllSubtreeOnSide(wD(n),u=>!!u.isLoaded&&(t(u),!0));const o=(c=(l=this.renderData)==null?void 0:l.geometryState)==null?void 0:c.neighborData;o&&(o.modifiedEdgeResolutions[s]=!1)}),Ok.forEach(n=>{var a;const s=(a=this.findNeighborTile(n,i))==null?void 0:a.findCorner(Rk(n),o=>o.isLoaded);!s||YSt(this,s,n),s!=null&&s.isLoaded&&t(s)})}_updateNeighbor(t){t!=null&&t.isLoaded&&t.updateNeighborDataAndGeometryIfNeeded()}getNeighborLIJ(t,r){const i=hye(r)?-1:uye(r)?1:0,n=cye(r)?-1:dye(r)?1:0,s=[t[0],t[1]+i,t[2]+n];return s[1]<0?null:this.surface.isGlobal?this.wrapLIJ(s):s[2]<0?null:s}wrapLIJ(t){return!t||t[1]<0||t[1]>=2**t[0]?null:this.surface.wrapEastWest(t)}get westNeighborWestExtent(){return this.extent[0]*(this.isWestEnd?-1:1)}get eastNeighborEastExtent(){return this.extent[2]*(this.isEastEnd?-1:1)}get isEastEnd(){return this.lij[2]===this.surface.lijEastEnd(this.level)-1}get isWestEnd(){return this.lij[2]===0}get isNorthEnd(){return this.lij[1]===0}get isSouthEnd(){return this.extent[1]+Rt>=this.surface.extent[1]}compareLIJs(t){const r=this.lij,i=r[0],n=t[0];if(i===n)return[r,t];const s=i-n;if(s<0){const a=2**-s;return[[n,r[1]*a,r[2]*a],t]}{const a=2**s;return[r,[i,t[1]*a,t[2]*a]]}}checkGeometryWaterproofness(){}shouldHaveNeighbor(t){const r=this.extent,i=this.surface.rootTilesExtent,n=.25*(r[2]-r[0]);if(hye(t)&&r[3]+n>=i[3]||uye(t)&&r[1]-n<=i[1])return!1;const s=this.surface.isGlobal;return!(!s&&cye(t)&&r[0]-n<=i[0])&&!(!s&&dye(t)&&r[2]+n>=i[2])}}function qSt(e,t,r,i){const n=r===er.ELEVATION?Wae.acquire():Hae.acquire();return n.init(e,t,r,i),n}function qI(e){e.dispose(),e instanceof cMe?Wae.release(e):e instanceof dMe&&Hae.release(e)}const Hae=new Fn(dMe),Wae=new Fn(cMe),HSt=new Uae;var nl;function WSt(e,t){const r=e.level,i=t[0];if(r>i)return!1;const n=i-r,s=Math.floor(t[1]/2**n),a=Math.floor(t[2]/2**n);return s===e.lij[1]&&a===e.lij[2]}function XSt(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]}function lH(e,t,r){return Math.abs(e-t)<=r}function YSt(e,t,r){return!R(e)&&!R(t)&&t!==e&&(e.level>=t.level?Aye(e,t,r):Aye(t,e,Rk(r)))}function Aye(e,t,r){e.level>=t.level;const i=wTt(r),n=xTt(r),s=e.extent,a=t.extent,o=[i?s[0]:s[2],n?s[3]:s[1]],l=[i?a[2]:a[0],n?a[1]:a[3]],c=1e-5*(s[2]-s[0]),u=lH(o[0],l[0],c)||e.surface.isGlobal&&lH(o[0],-l[0],c),h=lH(o[1],l[1],c);return u&&h?!0:e.level===t.level||!u&&!h?!1:u?Rye(a[1],a[3],s[1],s[3],c):Rye(a[0],a[2],s[0],s[2],c)}function Rye(e,t,r,i,n=Rt){return e-n<=r&&r<=i&&i<=t+n}(function(e){e[e.TOP=0]="TOP",e[e.MIDDLE=1]="MIDDLE",e[e.BOTTOM=2]="BOTTOM"})(nl||(nl={}));class ZSt{constructor(){this._scales=[-1,-1,-1,-1],this._offsets=[-1,-1,-1,-1]}clear(){this._scales[0]=this._scales[1]=this._scales[2]=this._scales[3]=-1,this._offsets[0]=this._offsets[1]=this._offsets[2]=this._offsets[3]=-1}setScale(t,r,i){this._scales[2*t]=r,this._scales[2*t+1]=i}setOffset(t,r,i){this._offsets[2*t]=r,this._offsets[2*t+1]=i}get scales(){return this._scales}get offsets(){return this._offsets}}class ry{constructor(){this.geometryInfo=new cSt,this.intersectionData=null,this.geometryState=null,this._textureRef=new o5(()=>this.tile.surface.textureFadeDuration),this.overlay=new ZSt,this._geometryStateChangedSinceLastUpdate=!0,this._hasGeometry=!1,this._numVerticesPerSideChanged=!1,this._samplerDataChanged=!1,this._edgeResolutionChanged=!1,this._edgeNeighborChanged=!1,this._cornerElevationChanged=!1,this._clippingAreaChanged=!1,this._wireframeChanged=!1}get tile(){return this._tile}init(t){this._tile=t,this.clear();const r=this.geometryInfo;r.indices=null,r.vertexAttributes=null,bi(r.boundingBox),r.indexCount=0,r.numVerticesPerSide=0,this.intersectionData=null,this.geometryState=new mSt,this.localOrigin=null,this.overlay.clear()}clear(){this._releaseGeometry(),this.releaseTexture(),this._textureRef.clear()}updateGeometryIfChanged(t,r){const i=this.updateGeometryStateAndPrepareForGeometryGeneration(r);return this._hasGeometry=!0,this.updateNeighborDataAndGeometryIfNeeded(i,t)}updateNeighborDataAndGeometryIfNeeded(t=!1,r=this.vao.context){const i=this._updateNeighborData(),n=t||this._geometryStateChangedSinceLastUpdate||i;return n&&(this._updateGeometry(r),this._geometryStateChangedSinceLastUpdate=!1),n}_calculateEdgeResolution(t,r){var c;const i=this.tile,n=this.geometryState.numVerticesPerSide-1;if(!i.surface.isGlobal){const u=i.surface.extent;if(_(u)&&(t===0&&i.extent[3]>u[3]||t===1&&i.extent[2]>u[2]||t===2&&i.extent[1]<u[1]||t===3&&i.extent[0]<u[0]))return n}const s=i.level,a=Z1[t],o=r||i.findNeighborTile(a,u=>u.isLoaded||u.level===s);if(!o||o.isLeaf&&!o.isLoaded)return R((c=i.surface)==null?void 0:c.rootTiles)||i.surface.updatingRootTiles||i.shouldHaveNeighbor(a),n;if(o.isLoaded){const u=o,h=u.renderData.geometryState,p=s-u.level;if(p===0){const b=h.numVerticesPerSide-1;return Math.max(b,n)}const m=2**p,g=h.neighborData.edgeResolutions[(t+2)%4]/m;return Math.max(1,g)}o.isLeaf;let l=n;return o.forAllSubtreeOnSide(wD(a),u=>u===i||(u.isLoaded?(l=Math.max(l,2**(u.level-s)),!0):(u.isLeaf,!1))),l}_updateNeighborData(){const t=this.tile,r=c=>c.isLoaded||c.level===t.level,i=c=>c.isLoaded,n=[null,null,null,null],s=[null,null,null,null];(()=>{for(let c=0;c<4;++c){const u=t.findNeighborTile(Z1[c],r);n[c]=u,s[c]=u!=null&&u.isLoaded?u:null}})();const a=[null,null,null,null];(()=>{for(let c=0;c<4;++c)a[c]=t.findNeighborTile(Ok[c],i)})();const o=this.geometryState.neighborData;let l=!1;return(()=>{for(let c=0;c<4;++c){const u=o.edgeResolutions[c],h=n[c],p=this._calculateEdgeResolution(c,h);o.edgeResolutions[c]=p,u!==p&&(l=!0,this._edgeResolutionChanged=!0,h&&h!==t&&!h.isLoaded&&h.level===t.level&&(o.modifiedEdgeResolutions[c]=!0))}})(),(()=>{const c=(p,m)=>{var v,x;const g=p.reduce((T,E)=>{var C;return Math.min(T,(C=E==null?void 0:E.level)!=null?C:1/0)},1/0);for(let T=0;T<4;++T){const E=p[(T+3)%4],C=p[T];if(E&&E.level<t.level&&E===C){const A=E,P=(1&T)==1,I=(t.getNeighborEdgeStartVertexIndex(T,A)+(m===0||m===1&&!P||m===3&&P?1:0))/2**(t.level-A.level),L=P?m===0||m===1?A.extent[0]:A.extent[2]:Kt(A.extent[0],A.extent[2],I),V=P?Kt(A.extent[1],A.extent[3],I):m===0||m===3?A.extent[1]:A.extent[3];return Si(L,V,A.renderData.geometryState.samplerData)}}let b=0,w=0;for(let T=0;T<4;++T){const E=p[T];if(E&&E.level===g){const C=T===0||T===1,A=T===0||T===3,P=E.extent;w+=Si(P[C?0:2],P[A?1:3],(x=(v=E.renderData)==null?void 0:v.geometryState)==null?void 0:x.samplerData),b++}}return b?w/b:0},u=o.cornerNeighborData,h=(p,m)=>{var v;const g=u[p],b=g.cornerTiles;for(let x=0;x<4;++x){const T=Ok[x],E=(v=m[x])==null?void 0:v.findCorner(Rk(T),C=>(C==null?void 0:C.isLoaded)||C===t);b[x]=E}const w=c(b,p);return g.elevation!==w&&(g.elevation=w,!0)};for(let p=0;p<4;++p){const m=a[p],g=s[p],b=[m,s[(p+1)%4],t,g],w=b.map((v,x)=>b[(x+4-p)%4]);h(p,w)&&(this._cornerElevationChanged=!0,l=!0)}})(),(()=>{var h;const c=(p,m)=>{if(!(p!=null&&p.isLoaded)||p.lij[0]>t.lij[0])return null;const g=p.renderData.geometryState;return{neighborSamplerData:g.samplerData,neighborEdgeOverlapResolution:g.neighborData.edgeResolutions[m+2],version:g.samplerDataVersion,neighborVerticesPerSide:g.numVerticesPerSide,neighborTile:p}},u=o.edgeNeighbours;for(let p=0;p<4;++p){const m=s[p];m&&(m==null||m.isLoaded,(m==null?void 0:m.lij[0])<=t.lij[0],void 0);const g=u[p],b=g==null?void 0:g.version,w=c(m,p),v=(h=w==null?void 0:w.version)!=null?h:null,x=g!=null!=(w!=null),T=g&&w&&b!==v,E=g&&w&&(g==null?void 0:g.neighborTile)!==(w==null?void 0:w.neighborTile),C=x||T||E;this._edgeNeighborChanged||(this._edgeNeighborChanged=C),l||(l=C),!C&&b||(u[p]=w)}})(),l}updateEdgeAfterResolutionChange(t){var s,a;const r=this._calculateEdgeResolution(t),i=this.geometryState.neighborData.edgeResolutions,n=i[t];((a=(s=this.geometryState.neighborData.edgeNeighbours[t])==null?void 0:s.neighborTile.level)!=null?a:0)<=this.tile.level,r!==n&&(i[t]=r,this._edgeResolutionChanged=!0,ry.deferTileNeighborUpdate?ry.neighborTilesToUpdate.add(this.tile):this._updateGeometry(this.vao.context))}_updateGeometry(t){this.intersectionData=null;const r=this.tile,i=r.lij,n=ry.updatedGeometryTiles.get(i)||0;ry.updatedGeometryTiles.set(i,n+1);const s=this._vao,a=this.geometryInfo.vertexAttributes,o=!s||!a||this._wireframeChanged||this._numVerticesPerSideChanged||this._samplerDataChanged||this._clippingAreaChanged||this._edgeResolutionChanged,l=!o&&this._edgeNeighborChanged,c=!l&&this._cornerElevationChanged;this._numVerticesPerSideChanged=!1,this._samplerDataChanged=!1,this._edgeResolutionChanged=!1,this._edgeNeighborChanged=!1,this._cornerElevationChanged=!1,this._clippingAreaChanged=!1,this._wireframeChanged=!1,o?(this._releaseGeometry(),this._createGeometry(t)):l?r.updateEdgeElevations():c?r.updateCornerElevations():console.warn("Update for no reason?")}releaseGeometry(){return this._releaseGeometry()}get hasGeometry(){return this._hasGeometry}ensureTexture(t,r){return _(this._texture)&&this._texture.descriptor.width!==t&&this.releaseTexture(),R(this._texture)&&(this._texture=r(),this.tile.setMemoryDirty()),this._texture}releaseTexture(){_(this._texture)&&(this._texture.release(),this._texture=null,this.tile.setMemoryDirty())}updateGeometryStateAndPrepareForGeometryGeneration(t){const r=this._getElevationInfo(),i=r.samplerData?this.tile.getElevationBasedVerticesPerSide(r.maxTileLevel):this.tile.getDefaultVerticesPerRowOnLevel(),n=Math.max(i,5);let s=this.tile.clippingArea;this.tile.intersectsClippingArea&&!this.tile.isWithinClippingArea||(s=null);const a=this.geometryState;let o=!1;return a.numVerticesPerSide!==n&&(this._numVerticesPerSideChanged=!0,a.numVerticesPerSide=n,a.samplerDataVersion++,o=!0),r.changed&&(this._samplerDataChanged=!0,a.samplerData=r.samplerData,a.samplerDataVersion++,o=!0),Gv(a.clippingArea,s)||(this._clippingAreaChanged=!0,a.clippingArea=s,o=!0),a.wireframe!==t&&(this._wireframeChanged=!0,a.wireframe=t,o=!0),this._geometryStateChangedSinceLastUpdate||(this._geometryStateChangedSinceLastUpdate=o),this._hasGeometry=!0,o}_createGeometry(t){this.tile.createGeometry();const r=this.geometryInfo.vertexAttributes,i=this.geometryInfo.indices,n=t.gl;this._vao=new ns(t,Ur,{geometry:vd(r.layout)},{geometry:dr.createVertex(t,n.STATIC_DRAW,r.buffer)},dr.createIndex(t,n.STATIC_DRAW,i)),this._hasGeometry=!0}_releaseGeometry(){return this._hasGeometry=!1,!!this._vao&&(this._vao.dispose(),this._vao=null,hSt(this.geometryInfo),!0)}get vao(){return this._vao}setTextureReference(t,r=by.Immediate){_(t)&&t.texture!==this._texture&&this.releaseTexture(),this._textureRef.push(t,r)}get textureReference(){return this._textureRef.current}get nextTextureReference(){return this._textureRef.next}get textureFadeFactor(){return this._textureRef.fadeFactor}get textureIsFading(){return this._textureRef.isFading}_getElevationInfo(){const t=this.geometryState.samplerData,r=this.tile.layerInfo[er.ELEVATION],i=r.length;let n=new Array(i),s=0,a=0,o=!1;for(let l=0;l<i;l++){const c=r[l];if(_(c.upsampleInfo)){const u=c.upsampleInfo.tile,h=u.layerInfo[er.ELEVATION][l].data,p=h&&h.samplerData;t&&t[s]===p||(o=!0),n[s++]=p,a=Math.max(a,u.lij[0])}else if(c.data){const u=this.tile.surface.layerViewByIndex(l,er.ELEVATION);if(C7(this.tile,u.layer,!1)){const h=c.data;t&&t[s]===h.samplerData||(o=!0),n[s++]=h.samplerData,a=this.tile.level}}}return _(t)&&t.length!==s&&(o=!0),s>0?n.length=s:n=null,{changed:o,samplerData:n,maxTileLevel:a}}get estimatedGeometryMemoryUsage(){const t=tu(this.intersectionData,0,r=>r.estimatedMemoryUsage);return this.geometryInfo.indices.byteLength+this.geometryInfo.vertexAttributes.byteLength+t}get textureDescriptor(){return _(this._texture)?this._texture.descriptor:null}get test(){return{hasTexture:this._texture!=null}}checkGeometryWaterproofness(){}}ry.updatedGeometryTiles=new Map,ry.deferTileNeighborUpdate=!1,ry.neighborTilesToUpdate=new Set;const QSt=65536;function JSt(e,t){const r=e.tile,{extent:i,extentInRadians:n,surface:s}=r,a=e.localOrigin,o=e.geometryState,l=s.isWebMercator,c=s.shadingEnabled,u=o.numVerticesPerSide,h=u-1,p=(u-2)**2,m=l&&(t===Ah.HAS_SOUTH_POLE||t===Ah.HAS_BOTH_POLES),g=l&&(t===Ah.HAS_NORTH_POLE||t===Ah.HAS_BOTH_POLES),b=6,w=((m?1:0)+(g?1:0))*b*(h+1),v=o.neighborData,x=v.edgeResolutions.reduce((Z,q)=>Z+q+1,0),T=nMe(p+w+x),E=e.geometryInfo;E.numVerticesPerSide=o.numVerticesPerSide,E.vertexAttributes=T,ei(E.uvOffsetAndScale,0,0,1,1);const C=T.position.typedBuffer,A=T.uv0.typedBuffer,P=T.normal.typedBuffer,I=E.boundingBox;bi(I);const L=a[0],V=a[1],G=a[2];c2.update(h,n);let B=0;const X=o.samplerData,Y=r.ellipsoid.radius,ce=Yae(e),se=u-2,D=i[0],F=i[2],U=i[1],j=i[3];(()=>{for(let Z=1;Z<=se;Z++){const q=Z/h,ee=U*(1-q)+j*q,me=ce(q),_e=Math.cos(me),De=Math.sin(me);for(let be=1;be<=se;be++){const ye=be/h,Ce=D*(1-ye)+F*ye,Ne=c2.sinLonLUT[be],Fr=c2.cosLonLUT[be],Br=Y+Si(Ce,ee,X),hr=Fr*_e*Br-L,Gr=Ne*_e*Br-V,mr=De*Br-G;vy(hr,Gr,mr,I);const jr=ph*B;C[jr+0]=hr,C[jr+1]=Gr,C[jr+2]=mr,A[jr+0]=ye,A[jr+1]=q,++B}}})(),c&&(()=>{const Z=be=>(pe(_y,be,cH),dt(F9,_y,zv),dt(N9,F9,_y),N9),q=T.position,ee=T.normal;B=0;const me=be=>{q.getVec(be,nd),he(Tn,Tn,Z(nd))},_e=(be,ye)=>{{const Ce=be/h,Ne=D*(1-Ce)+F*Ce,Fr=c2.sinLonLUT[be],Br=c2.cosLonLUT[be],hr=ye/h,Gr=U*(1-hr)+j*hr,mr=ce(hr),jr=Math.cos(mr),Qi=Math.sin(mr),yn=Y+Si(Ne,Gr,X);ne(nd,Br*jr*yn-L,Fr*jr*yn-V,Qi*yn-G)}he(Tn,Tn,Z(nd))},De=(be,ye,Ce)=>{be>1&&ye>1&&be<se&&ye<se?me(B+Ce):_e(be,ye)};for(let be=1;be<=se;be++)for(let ye=1;ye<=se;ye++)q.getVec(B,cH),he(W0,cH,e.localOrigin),we(zv,W0),ne(Tn,0,0,0),De(ye-1,be,-1),De(ye+1,be,1),De(ye,be-1,-se),De(ye,be+1,+se),we(Tn,Tn),ee.setVec(B,Tn),++B})(),B=p,mMe(e,p),wMe(e),B=p+x;const W=[];(()=>{const Z=(q,ee)=>{const me=ee*u;vy(-L,-V,q*Y-G,I),W.push({connectedRowOffset:me,connectedOuterEdgeOffset:q===1?0:2,rowOffset:B,latitudeResolution:b});const _e=TMe(q===-1?U:j,Y),De=q*Math.PI/2-_e,be=.99*(q===1?1:-1),ye=Y+0;for(let Ce=1;Ce<=b;++Ce){const Ne=_e+De*(Ce/b),Fr=Math.cos(Ne),Br=Math.sin(Ne);for(let hr=0;hr<=h;hr++){const Gr=hr/h,mr=c2.sinLonLUT[hr],jr=c2.cosLonLUT[hr]*Fr*ye-L,Qi=mr*Fr*ye-V,yn=Br*ye-G;vy(jr,Qi,yn,I);const st=ph*B;if(C[st+0]=jr,C[st+1]=Qi,C[st+2]=yn,A[st+0]=Gr,A[st+1]=be,c){const Di=1/Math.sqrt(jr*jr+Qi*Qi+yn*yn);P[st+0]=Di*jr,P[st+1]=Di*Qi,P[st+2]=Di*yn}++B}}};m&&Z(-1,0),g&&Z(1,h)})(),pMe(E,o.numVerticesPerSide,W,[0,u-1],[0,u-1],o.wireframe),e.intersectionData=null;for(let Z=0;Z<4;++Z)E.outerEdges[Z].count,v.edgeResolutions[Z]+1}function KSt(e,t){const r=e.tile,i=r.extent,n=e.localOrigin,s=e.geometryState,a=r.surface,o=a.isWebMercatorOnPlateeCarree,l=a.shadingEnabled,c=i[0],u=i[1],h=i[2]-c,p=i[3]-u,m=s.clippingArea,g=_(m)?Math.max(0,(m[0]-i[0])/h):0,b=_(m)?Math.max(0,(m[1]-i[1])/p):0,w=_(m)?Math.min(1,(m[2]-i[0])/h):1,v=_(m)?Math.min(1,(m[3]-i[1])/p):1,x=w-g,T=v-b,E=x>0?1/x:1,C=T>0?1/T:1,A=-g*E,P=-b*C,I=s.numVerticesPerSide,L=I-1,V=(I-2)**2+s.neighborData.edgeResolutions.reduce((_e,De)=>_e+De+1,0),G=nMe(V),B=G.position.typedBuffer,X=G.uv0.typedBuffer,Y=G.normal.typedBuffer,ce=e.geometryInfo,se=ce.boundingBox;bi(se);let D=0;const F=r.ellipsoid.radius,U=s.samplerData,j=_(m)?m:AMe,W=Pre(Math.max(i[0],j[0]),Math.max(i[1],j[1]),Math.min(i[2],j[2]),Math.min(i[3],j[3])),Z=n[0],q=n[1],ee=n[2],me=VO(o,F,t);(()=>{for(let _e=1;_e<=L-1;_e++){const De=_e/L,be=P+De*C,ye=Le(u+De*p,W[1],W[3]),Ce=Le(be,0,1),Ne=me(ye)-q,Fr=h/L;for(let Br=1;Br<=L-1;Br++){const hr=Br/L,Gr=A+hr*E,mr=Le(c+hr*h,W[0],W[2]),jr=Le(Gr,0,1),Qi=Si(mr,ye,U),yn=mr*t-Z,st=Qi-ee;vy(yn,Ne,st,se);const Di=ph*D;if(B[Di+0]=yn,B[Di+1]=Ne,B[Di+2]=st,X[Di+0]=jr,X[Di+1]=Ce,l){const da=Si(mr+Fr,ye,U),Sl=Si(mr-Fr,ye,U),Vo=Si(mr,ye+Fr,U),of=.25*(Sl-da),lf=.25*(Si(mr,ye-Fr,U)-Vo),zo=Fr,S_=Math.sqrt(of*of+lf*lf+zo*zo);Y[Di+0]=of/S_,Y[Di+1]=lf/S_,Y[Di+2]=zo/S_}++D}}})(),ce.numVerticesPerSide=s.numVerticesPerSide,ce.vertexAttributes=G,ei(e.geometryInfo.uvOffsetAndScale,g,b,w-g,v-b),mMe(e,D),gMe(e,t),D=V,pMe(ce,s.numVerticesPerSide,[],[0,I-1],[0,I-1],s.wireframe),e.intersectionData=null}function pMe(e,t,r,i,n,s){const a=t-1,o=e.vertexAttributes.count,l=2*(Math.min(t-2,i[1])-Math.max(1,i[0]))*(Math.min(t-2,n[1])-Math.max(1,n[0])),c=Z1.map((v,x)=>x===0&&n[1]<t-2||x===1&&i[1]<t-2||x===2&&n[0]>1||x===3&&i[0]>1),u=3*(l+e.outerEdges.reduce((v,x,T)=>v+(c[T]?0:a-2+x.count-1),0)+r.reduce((v,x)=>v+a*(2*(x.latitudeResolution-1)+1),0))*(s?2:1),h=new(o>QSt?Uint32Array:Uint16Array)(u);let p=0;const m=s?(v,x,T)=>{h[p++]=v,h[p++]=x,h[p++]=x,h[p++]=T,h[p++]=T,h[p++]=v}:(v,x,T)=>{h[p++]=v,h[p++]=x,h[p++]=T},g=t-2,b=a-2;(()=>{for(let v=Math.max(n[0],1)-1;v<Math.min(n[1],t-2)-1;++v)for(let x=Math.max(i[0],1)-1;x<Math.min(i[1],t-2)-1;++x){const T=v*g+x,E=T+1,C=E+g,A=C-1;m(T,E,C),m(C,A,T)}})(),(()=>{for(let v=0;v<4;++v){if(c[v])continue;const x=e.outerEdges[v],T=e.innerEdges[v];let E=0,C=0;const A=x.count,P=T.count;x.count;const I=v===1||v===2?(L,V,G)=>m(L,V,G):(L,V,G)=>m(L,G,V);for(;E<A-1||C<P-1;){const L=T.getVertexOffset(C),V=x.getVertexOffset(E),G=E<A-1,B=C<P-1,X=G?0+a*(E+.5)/(A-1):0,Y=B?1+b*(C+.5)/(P-1):0;G&&(!B||X<=Y)?(++E,I(L,V,x.getVertexOffset(E))):(++C,I(L,V,T.getVertexOffset(C)))}}})();const w=v=>{let x=e.outerEdges[v.connectedOuterEdgeOffset].offset0;for(let T=0;T<v.latitudeResolution;++T){const E=T===0?v.rowOffset:x+t;for(let C=0;C<a;C++)m(x,x+1,E+C),T<v.latitudeResolution-1&&m(x+1,E+C+1,E+C),++x;x=E}};r.forEach(w),e.indices=h,e.indexCount=u}function mMe(e,t){const r=e.localOrigin,i=e.geometryInfo,n=e.geometryState.neighborData.edgeResolutions,s=i.numVerticesPerSide-2,a=i.vertexAttributes.position.typedBuffer;let o=t;for(let l=0;l<4;++l){{const c=l===0||l===2,u=(l===0?s-1:0)*s+(l===1?s-1:0),h=(c?0:1)*s+(c?1:0);i.innerEdges[l]=new xye(a,r,u,h,s)}{const c=o,u=n[l]+1;i.outerEdges[l]=new xye(a,r,c,1,u),o+=u}}}function e4t(e){var i,n;bMe(e),SMe(e);const t=e.vao,r=e.geometryInfo.vertexAttributes;(n=(i=t==null?void 0:t.vertexBuffers)==null?void 0:i.geometry)==null||n.setSubData(r.position.typedBuffer)}function t4t(e){wMe(e),Xae(e)}function r4t(e,t){vMe(e,t),EMe(e,t),Xae(e)}function i4t(e,t){gMe(e,t),Xae(e)}function gMe(e,t){vMe(e,t),d4t(e,t),EMe(e,t)}function yMe(e,t,r,i,n){const s=Math.cos(r),a=Math.sin(r),o=Math.sin(t),l=Math.cos(t),c=n+i;e[0]=l*s*c,e[1]=o*s*c,e[2]=a*c}function n4t(e,t,r,i,n,s){const a=n[r===0?1:3];yMe(e,n[t===0?0:2],a,i,s)}function s4t(e,t){return(Math.PI/2-2*Math.atan(Math.exp(-e/t)))*t}function a4t(e,t){return e*t}function VO(e,t,r){return e?i=>s4t(i,t):i=>a4t(i,r)}function o4t(e,t,r,i,n,s,a){const o=t===0?n[0]:n[2],l=r===0?n[1]:n[3],c=i;e[0]=o*s,e[1]=a(l),e[2]=c}function l4t(e,t){const r=e.geometryState,i=e.tile,n=i.extent,s=vt(r.clippingArea,n),a=e.geometryInfo,o=a.boundingBox,l=a.outerEdges,c=r.neighborData.cornerNeighborData,u=a.uvOffsetAndScale[0],h=a.uvOffsetAndScale[1],p=a.uvOffsetAndScale[2],m=a.uvOffsetAndScale[3],g=p>0?1/p:1,b=m>0?1/m:1,w=-u*g,v=-h*b,x=i.surface.isWebMercatorOnPlateeCarree,T=VO(x,x?i.ellipsoid.radius:0,t),E=r.samplerData,C=r.neighborData.edgeNeighbours,A=e.localOrigin,P=(I,L,V,G,B)=>{const X=n[0]*(1-G)+n[2]*G,Y=n[1]*(1-B)+n[3]*B,ce=Le(X,s[0],s[2]),se=Le(Y,s[1],s[3]),D=[se===n[3],ce===n[2],se===n[1],ce===n[0]],F=!D[3]&&!D[1]||!D[0]&&!D[2],U=F?D[0]&&_(C[0])?C[0]:D[1]&&_(C[1])?C[1]:D[2]&&_(C[2])?C[2]:D[3]&&_(C[3])?C[3]:null:null,j=F?U?U.neighborTile.level===i.level?.5*(Si(ce,se,E)+Si(ce,se,U.neighborSamplerData)):Si(ce,se,U.neighborSamplerData):Si(ce,se,E):c[V].elevation,W=ce*t-A[0],Z=T(se)-A[1],q=j-A[2];vy(W,Z,q,o);const ee=Le(w+G*g,0,1),me=Le(v+B*b,0,1);I.setVertexRawXYZUV(L,W,Z,q,ee,me)};for(let I=0;I<4;++I){const L=l[I];P(L,0,I===0?3:I===1?1:2,I===1?1:0,I===0?1:0);const V=I===2?1:I===3?3:0,G=I===3?0:1,B=I===2?0:1;P(L,L.count-1,V,G,B)}}function bMe(e){_Me(e,(t,r,i,n)=>n4t(t,r,i,n,e.tile.extentInRadians,e.tile.ellipsoid.radius))}function vMe(e,t){const r=e.tile;_(r.renderData.geometryState.clippingArea)?l4t(e,t):_Me(e,(i,n,s,a)=>o4t(i,n,s,a,e.tile.extent,t,VO(r.surface.isWebMercatorOnPlateeCarree,r.ellipsoid.radius,t)))}function _Me(e,t){const r=e.geometryInfo,i=r.outerEdges,n=e.geometryState.neighborData.cornerNeighborData,s=r.boundingBox,a=e.localOrigin,o=(l,c,u,h,p)=>{t(Ib,u,h,n[c].elevation);for(let m=0;m<3;++m)Ib[m]-=a[m];vy(Ib[0],Ib[1],Ib[2],s),l.setVertexRawXYZUV(p,Ib[0],Ib[1],Ib[2],u,h)};for(let l=0;l<4;++l){const c=i[l];o(c,l===0?3:l===1?1:2,l===1?1:0,l===0?1:0,0),o(c,l===2?1:l===3?3:0,l===3?0:1,l===2?0:1,c.count-1)}}function Xae(e){var i,n;const t=e.vao,r=e.geometryInfo.vertexAttributes;(n=(i=t==null?void 0:t.vertexBuffers)==null?void 0:i.geometry)==null||n.setSubData(r.position.typedBuffer)}function wMe(e){bMe(e);for(let t=0;t<4;++t)c4t(e,t);SMe(e)}function c4t(e,t){var WO,XO,YO;const r=e.geometryState,i=r.neighborData,n=e.tile;n.level;const s=n.extent,a=s[2]-s[0],o=s[3]-s[1],l=n.extentInRadians,c=l[0];l[1];const u=l[2];l[3];const h=n.ellipsoid.radius,p=Yae(e),m=Lr=>{if(!Lr)return 0;const fo=b,Va=w?0:1,_c=Lr.lij[Va+1]*L,E_=n.lij[Va+1]-_c;return(w?L-1-E_:E_)*fo},g=i.edgeNeighbours[t],b=i.edgeResolutions[t],w=t===1||t===3,v=t===1?1:0,x=t===0?1:0,T=s[0]+v*a,E=s[1]+x*o,C=c*(1-v)+u*v,A=p(x),P=g==null?void 0:g.neighborTile,I=n.level-((WO=P==null?void 0:P.level)!=null?WO:n.level),L=2**I,V=b*L,G=m(P),B=P==null?void 0:P.extent,X=(t+2)%4,Y=r.samplerData,ce=(YO=(XO=P==null?void 0:P.renderData)==null?void 0:XO.geometryState)==null?void 0:YO.samplerData,se=P&&I===0,D=(Lr,fo,Va,_c)=>.5*(Si(Lr,fo,ce)+Si(Va,_c,Y)),F=(Lr,fo)=>Si(Lr,fo,ce),U=se?D:F;let j=B?X===1?B[2]:B[0]:T,W=B?X===0?B[3]:B[1]:E;const Z=(Lr,fo,Va)=>{const _c=(G+Lr)/V;return W=B[1]*(1-_c)+B[3]*_c,U(j,W,fo,Va)},q=(Lr,fo,Va)=>{const _c=(G+Lr)/V;return j=B[0]*(1-_c)+B[2]*_c,U(j,W,fo,Va)},ee=P?w?Z:q:(Lr,fo,Va)=>Si(fo,Va,Y),me=(Lr,fo,Va)=>ee(Lr,fo,Va);let _e=v,De=T,be=C,ye=x,Ce=E,Ne=A,Fr=Math.sin(be),Br=Math.cos(be),hr=Math.cos(Ne),Gr=Math.sin(Ne);const mr=w?()=>p(ye):()=>A,jr=w?Lr=>{ye=Lr,Ce=s[1]*(1-Lr)+s[3]*Lr,Ne=mr(),hr=Math.cos(Ne),Gr=Math.sin(Ne)}:Lr=>{_e=Lr,De=s[0]*(1-Lr)+s[2]*Lr,be=c*(1-_e)+u*_e,Fr=Math.sin(be),Br=Math.cos(be)},Qi=e.geometryInfo,yn=Qi.boundingBox,st=Qi.vertexAttributes,Di=st.position.typedBuffer,da=st.uv0.typedBuffer,Sl=st.normal.typedBuffer,Vo=Qi.outerEdges[t];let of=Vo.getVertexOffset(1);const lf=b+1,zo=e.localOrigin,S_=zo[0],lB=zo[1],cB=zo[2],GO=n.surface.shadingEnabled,jO=t===1?-1:t===3?1:0,qO=t===0?-1:t===2?1:0,HO=a/b,dB=jO*HO,uB=qO*HO,hB=jO*(1/b),fB=qO*(1/b),E6=Lr=>{pd(_y,Lr,W0),dt(F9,_y,zv),dt(N9,F9,_y),he(Tn,Tn,N9)};for(let Lr=1;Lr<lf-1;++Lr){jr(Lr/b);const fo=me(Lr,De,Ce),Va=h+fo,_c=Br*hr*Va,E_=Fr*hr*Va,ZO=Gr*Va,QO=_c-S_,JO=E_-lB,KO=ZO-cB;vy(QO,JO,KO,yn);const Vp=ph*of;if(Di[Vp+0]=QO,Di[Vp+1]=JO,Di[Vp+2]=KO,da[Vp+0]=_e,da[Vp+1]=ye,GO){ne(Tn,0,0,0),ne(W0,_c,E_,ZO),we(zv,W0);const de=(Fi,Dx)=>{const Fu=Si(De+Fi*dB,Ce+Fi*uB,Dx),C_=h+Fu,ht=_e+Fi*hB,A_=c*(1-ht)+u*ht,Gs=Math.sin(A_),R_=Math.cos(A_),eM=p(ye+Fi*fB),cf=Math.sin(eM),C6=Math.cos(eM),tM=Ve(R_*C6*C_,Gs*C6*C_,cf*C_);E6(tM)};P&&de(-1,ce),P&&!se||de(1,Y),Sl[Vp+0]=Tn[0],Sl[Vp+1]=Tn[1],Sl[Vp+2]=Tn[2]}++of}if(GO)for(let Lr=1;Lr<lf-1;++Lr)Vo.getVertexRawNormal(Tn,Lr),Vo.getVertex(W0,Lr),we(zv,W0),Vo.getVertex(nd,Lr-1),E6(nd),Vo.getVertex(nd,Lr+1),E6(nd),we(Tn,Tn),Vo.setVertexRawNormal(Lr,Tn[0],Tn[1],Tn[2])}function d4t(e,t){const r=e.geometryState.clippingArea,i=e.tile.extent,n=_(r)&&(i[0]<r[0]||i[2]>r[2]||i[1]<r[1]||i[3]>r[3])?h4t:u4t;for(let s=0;s<4;++s)n(e,s,t)}function xMe(e,t,r,i,n,s,a){return a===n?!e||t?(o,l)=>Si(o,l,r):null:a===s&&e?(o,l)=>Si(o,l,i):null}function Mk(e,t,r,i){if(t!==e)return()=>0;const n=t?3:2,s=t?1:0,a=i(n,s),o=i(s,n),l=(a!=null?1:0)+(o!=null?1:0),c=t?r:0,u=t?0:r;return(h,p,m)=>((a!=null?-(a(h+c,p+u)-m):0)+(o!=null?+(o(h-c,p-u)-m):0))/l}function u4t(e,t,r){const i=e.geometryState.neighborData,n=i.edgeNeighbours,s=e.tile,a=s.level,o=s.surface,l=o.shadingEnabled,c=n[t],u=i.edgeResolutions[t],h=u,p=s.extent,m=e.geometryState,g=h+1,b=c,w=e.localOrigin,v=m.samplerData,x=(q,ee)=>Si(q,ee,v),T=(q,ee)=>.5*(Si(q,ee,b.neighborSamplerData)+Si(q,ee,v)),E=(q,ee)=>Si(q,ee,b.neighborSamplerData),C=(b==null?void 0:b.neighborTile.level)===a,A=C?T:E,P=_(b)?A:x,I=e.geometryInfo,L=I.outerEdges[t],V=VO(o.isWebMercatorOnPlateeCarree,s.ellipsoid.radius,r),G=I.boundingBox,B=t===1||t===3,X=t===1?p[2]:p[0],Y=t===0?p[3]:p[1],ce=t===1?1:0,se=t===0?1:0,D=(p[2]-p[0])/u,F=b==null?void 0:b.neighborSamplerData,U=_(b),j=(q,ee)=>xMe(U,C,v,F,q,ee,t),W=Mk(B,!0,D,j),Z=Mk(B,!1,D,j);for(let q=1;q<g-1;++q){const ee=q/h,me=B?X:p[0]*(1-ee)+p[2]*ee,_e=B?p[1]*(1-ee)+p[3]*ee:Y,De=B?ce:ee,be=B?ee:se,ye=P(me,_e),Ce=me*r-w[0],Ne=V(_e)-w[1],Fr=ye-w[2];if(vy(Ce,Ne,Fr,G),l){const Br=W(me,_e,ye),hr=Z(me,_e,ye),Gr=D;L.setVertexRawXYZUVN(q,Ce,Ne,Fr,De,be,Br,hr,Gr)}else L.setVertexRawXYZUV(q,Ce,Ne,Fr,De,be)}if(l){const q=B?0:1,ee=B?1:0;for(let me=1;me<g-1;++me){L.getNormal(l5,me);const _e=L.getVertexZ(me-1)-L.getVertexZ(me+1),De=l5[0]+.5*q*_e,be=l5[1]+.5*ee*_e,ye=2*D,Ce=1/Math.sqrt(De*De+be*be+ye*ye);L.setVertexRawNormal(me,Ce*De,Ce*be,Ce*ye)}}}function h4t(e,t,r){const i=e.geometryState.neighborData,n=i.edgeNeighbours,s=e.tile,a=s.level,o=s.surface,l=o.shadingEnabled,c=n[t],u=i.edgeResolutions[t],h=u,p=s.extent,m=e.geometryState,g=vt(m.clippingArea,AMe),b=e.geometryInfo,w=b.uvOffsetAndScale[0],v=b.uvOffsetAndScale[1],x=w+b.uvOffsetAndScale[2],T=v+b.uvOffsetAndScale[3],E=x>w?1/(x-w):1,C=T>v?1/(T-v):1,A=-w*E,P=-v*C,I=h+1,L=[p[3]>g[3],p[2]>g[2],p[1]<g[1],p[0]<g[0]],V=c,G=m.samplerData,B=(hr,Gr)=>Si(hr,Gr,G),X=(V==null?void 0:V.neighborTile.level)===a,Y=(hr,Gr)=>{const mr=Si(hr,Gr,V.neighborSamplerData);return X?.5*(mr+Si(hr,Gr,G)):mr},ce=B,se=_(V)?Y:B,D=L[t]?ce:se,F=b.outerEdges[t],U=b.boundingBox,j=t===1||t===3,W=Le(t===1?p[2]:p[0],g[0],g[2]),Z=Le(t===0?p[3]:p[1],g[1],g[3]),q=t===1?1:0,ee=t===0?1:0,me=e.localOrigin,_e=VO(o.isWebMercatorOnPlateeCarree,s.ellipsoid.radius,r),De=(p[2]-p[0])/u,be=V==null?void 0:V.neighborSamplerData,ye=_(V),Ce=(V==null?void 0:V.neighborTile.level)===a,Ne=(hr,Gr)=>xMe(ye,Ce,G,be,hr,Gr,t),Fr=Mk(j,!0,De,Ne),Br=Mk(j,!1,De,Ne);for(let hr=1;hr<I-1;++hr){const Gr=hr/h,mr=j?W:Le(p[0]*(1-Gr)+p[2]*Gr,g[0],g[2]),jr=j?Le(p[1]*(1-Gr)+p[3]*Gr,g[1],g[3]):Z,Qi=j?q:Le(A+Gr*E,0,1),yn=j?Le(P+Gr*C,0,1):ee,st=D(mr,jr),Di=mr*r-me[0],da=_e(jr)-me[1],Sl=st-me[2];if(vy(Di,da,Sl,U),l){const Vo=Fr(mr,jr,st),of=Br(mr,jr,st),lf=De;F.setVertexRawXYZUVN(hr,Di,da,Sl,Qi,yn,Vo,of,lf)}else F.setVertexRawXYZUV(hr,Di,da,Sl,Qi,yn)}if(l){const hr=j?0:1,Gr=j?1:0;for(let mr=1;mr<I-1;++mr){F.getNormal(l5,mr);const jr=F.getVertexZ(mr-1)-F.getVertexZ(mr+1),Qi=l5[0]+.5*hr*jr,yn=l5[1]+.5*Gr*jr,st=2*De,Di=1/Math.sqrt(Qi*Qi+yn*yn+st*st);F.setVertexRawNormal(mr,Di*Qi,Di*yn,Di*st)}}}function TMe(e,t){return Math.PI/2-2*Math.atan(Math.exp(-e/t))}function f4t(e,t,r,i){return TMe(e+i*(t-e),r)}function p4t(e,t,r){return e*(1-r)+t*r}function Yae(e){const t=e.tile;if(t.surface.isWebMercator){const i=t.extent,n=t.ellipsoid.radius;return s=>f4t(i[1],i[3],n,s)}const r=t.extentInRadians;return i=>p4t(r[1],r[3],i)}function SMe(e){e.tile.surface.shadingEnabled&&CMe(e,(t,r,i,n,s,a,o)=>m4t(r,t,i,n,s,a,o))}function EMe(e,t){e.tile.surface.shadingEnabled&&CMe(e,(r,i,n,s,a,o,l)=>g4t(b4t(e,t),r,n,a,o,l))}function m4t(e,t,r,i,n,s,a){y4t(e,nd,n,s,a),pd(_y,nd,r),dt(F9,_y,i),dt(t,F9,_y)}function g4t(e,t,r,i,n,s){e(nd,i,n,s);const a=nd[0]-r[0],o=nd[1]-r[1],l=nd[2]-r[2];t[0]=-a*l,t[1]=-o*l,t[2]=a*a+o*o}function y4t(e,t,r,i,n){const s=Yae(e),a=e.tile,o=a.extent;wE(o,r,i,1);const l=(r-o[0])/(o[2]-o[0]),c=(i-o[1])/(o[3]-o[1]),u=a.extentInRadians;yMe(t,u[0]*(1-l)+u[2]*l,s(c),n,a.ellipsoid.radius)}function b4t(e,t){return e.tile.surface.isWebMercatorOnPlateeCarree?(r,i,n,s)=>_4t(t,e.tile.ellipsoid.radius,r,i,n,s):(r,i,n,s)=>v4t(t,r,i,n,s)}function v4t(e,t,r,i,n){t[0]=r*e,t[1]=i*e,t[2]=n}function _4t(e,t,r,i,n,s){r[0]=i*e,r[1]=(Math.PI/2-2*Math.atan(Math.exp(-n/t)))*t,r[2]=s}function CMe(e,t){var a;if(!e.tile.surface.shadingEnabled)return;const r=e.geometryState.neighborData.cornerNeighborData,i=e.tile,n=i.extent,s=((a=e.tile.surface.view)==null?void 0:a.viewingMode)==="local";s&&ne(zv,0,0,1);{const o=(b,w,v,x)=>{t(N9,b.renderData,W0,zv,w,v,x),he(Tn,Tn,N9)},c=(b,w,v,x,T,E)=>{const C=E===1?T.extent[0]:E===3?T.extent[2]:b,A=E===0?T.extent[1]:E===2?T.extent[3]:w,P=C+ET[v][0]*x,I=A+ET[v][1]*x;wE(T.extent,P,I,1);const L=Si(P,I,T.renderData.geometryState.samplerData);o(T,P,I,L)},u=(b,w,v)=>b.extent[w===0||w===1?2:0]+v,h=(b,w,v)=>b.extent[w===0||w===3?3:1]+v,p=(b,w,v,x)=>{const T=u(v,x,ET[b][0]*w),E=h(v,x,ET[b][1]*w);wE(v.extent,T,E,1);const C=Si(T,E,v.renderData.geometryState.samplerData);o(v,T,E,C)},m=(b,w,v,x,T,E)=>{const C=ET[b][0]*w,A=ET[b][1]*w,P=u(v,x,C),I=h(v,x,A),L=u(T,E,C),V=h(T,E,A);wE(v.extent,P,I,1),wE(T.extent,L,V,1);const G=Si(P,I,v.renderData.geometryState.samplerData),B=Si(L,V,T.renderData.geometryState.samplerData);o(v,P,I,.5*(G+B))},g=b=>{const w=b===0||b===1?n[2]:n[0],v=b===0||b===3?n[3]:n[1],x=r[b].cornerTiles,T=x.reduce((E,C)=>{var A;return Math.min(E,(A=C==null?void 0:C.level)!=null?A:1/0)},1/0);for(let E=0;E<4;++E){const C=x[E];$b[E]=(C==null?void 0:C.level)===T?C:null}for(let E=0;E<4;++E){const C=$b[(E+3)%4],A=$b[E];if(C!=null&&C!==i&&C===A){const P=C,I=(E+2)%4,L=P.renderData.geometryState.neighborData.edgeResolutions[I],V=Math.max(L,2**(i.level-P.level)),G=(P.extent[2]-P.extent[0])/V,B=(E+0)%4,X=(E+1)%4;return c(w,v,(E+3)%4,G,P,E),c(w,v,B,G,P,E),c(w,v,X,G,P,E),Tn}}{$b.some(C=>(C==null?void 0:C.isLoaded)||C===i);const E=$b.reduce((C,A)=>A?A.extent[2]-A.extent[0]:C,0)/$b.reduce((C,A)=>{var P;return Math.max(C,(P=A==null?void 0:A.renderData.geometryState.numVerticesPerSide)!=null?P:1)},1);for(let C=0;C<4;++C){const A=$b[(C+3)%4],P=$b[(C+0)%4];if(!A&&!P)continue;const I=C===0?1:C===1?2:C===2?3:0,L=C===0?2:C===1?3:C===2?0:1;A&&P?m(C,E,A,I,P,L):p(C,E,A!=null?A:P,A?I:L)}}return Tn};for(let b=0;b<4;++b){const w=e.geometryInfo.outerEdges[b],v=b===1||b===2?0:w.count-1;w.getVertex(W0,v),s||we(zv,W0),ne(Tn,0,0,0);const x=g(b);we(dH[b],x)}}{const o=(c,u,h,p,m)=>{c.setVertexRawNormal(m,u,h,p)},l=e.geometryInfo.outerEdges;for(let c=0;c<4;++c){const u=l[c];{const h=dH[c===0?3:c===1?1:2];o(u,h[0],h[1],h[2],0)}{const h=dH[c===2?1:c===3?3:0];o(u,h[0],h[1],h[2],u.count-1)}}}}function vy(e,t,r,i){e<i[0]?i[0]=e:e>i[3]&&(i[3]=e),t<i[1]?i[1]=t:t>i[4]&&(i[4]=t),r<i[2]?i[2]=r:r>i[5]&&(i[5]=r)}const ET=[[0,1],[1,0],[0,-1],[-1,0]],c2=new fSt,AMe=Pre(-1/0,-1/0,1/0,1/0),Ib=M(),nd=M(),_y=M(),F9=M(),N9=M(),W0=M(),cH=M(),zv=M(),Tn=M(),l5=M(),dH=[M(),M(),M(),M()],$b=[null,null,null,null];class w4t extends qae{constructor(t,r,i){super(),this.horizontalScaleFactor=1,this.extentInRenderSR=zt(),t!==void 0&&this.init(t,r,i)}init(t,r,i){super.init(t,r,i);const n=i.view.renderSpatialReference,s=i.spatialReference,a=_(n)&&aA(n)&&s.isGeographic?this.ellipsoid.radius*Math.PI/180:1;this.horizontalScaleFactor=a;const o=this.surface.isWebMercatorOnPlateeCarree,l=this.extentInRenderSR,c=this.extent;if(o){const u=Ve(c[0],c[1],0);Ss(u,Ye.WebMercator,u,Ye.PlateCarree);const h=Ve(c[2],c[3],0);Ss(h,Ye.WebMercator,h,Ye.PlateCarree),l[0]=u[0],l[1]=u[1],l[2]=h[0],l[3]=h[1]}else for(let u=0;u<4;++u)l[u]=c[u]*a;this.centerAtSeaLevel[0]=.5*(l[0]+l[2]),this.centerAtSeaLevel[1]=.5*(l[1]+l[3]),this.centerAtSeaLevel[2]=0,this._edgeLen=Math.max(l[2]-l[0],l[3]-l[1]),this._edgeLen2=this._edgeLen*this._edgeLen,this.updateRadiusAndCenter()}updateRadiusAndCenter(){this._updateCenter();const t=this.extentInRenderSR,r=.5*(t[2]-t[0]),i=.5*(t[3]-t[1]),n=Math.sqrt(r*r+i*i),s=.5*(this.elevationBounds[0]-this.elevationBounds[1]),a=Math.max(n,s);this._center[nl.MIDDLE][3]=a}_isVisible(t){return Hht(t,this._aabb())}_aabb(){const t=this.extentInRenderSR;return wBe(t[0],t[1],this.elevationBounds[0],t[2],t[3],this.elevationBounds[1])}intersectsRay(t,r,i,n){return HI[0]=1/r[0],HI[1]=1/r[1],HI[2]=1/r[2],Qse(this._aabb(),t,HI,i,n)}createGeometry(){KSt(this.renderData,this.horizontalScaleFactor),this.setMemoryDirty()}getDefaultVerticesPerRowOnLevel(){return this.level<9?3:2}updateCornerElevations(){r4t(this.renderData,this.horizontalScaleFactor)}updateEdgeElevations(){i4t(this.renderData,this.horizontalScaleFactor)}}const HI=M();var SR;(function(e){e[e.BACK_TO_FRONT=-1]="BACK_TO_FRONT",e[e.NONE=0]="NONE",e[e.FRONT_TO_BACK=1]="FRONT_TO_BACK"})(SR||(SR={}));class x4t extends qae{constructor(t,r,i){super(),this.obb=new Array(8);for(let n=0;n<8;n++)this.obb[n]=M();t!==void 0&&this.init(t,r,i)}init(t,r,i){super.init(t,r,i);const n=this.ellipsoid.radius,s=this.extentInRadians[0],a=this.extentInRadians[1],o=this.extentInRadians[2],l=this.extentInRadians[3],c=t[0],u=Kt(a,l,.5),h=Kt(s,o,.5),p=c===0?0:Math.min(Math.abs(a),Math.abs(l));this._edgeLen=(o-s)*Math.cos(p)*n,this._edgeLen2=this._edgeLen*this._edgeLen,this._curvatureHeight=n-Math.sqrt(n*n-this._edgeLen2/4),j6(this.centerAtSeaLevel,h,u,this.ellipsoid.radius);const m=Wl(this.centerAtSeaLevel);we(m,m),this.up=m,this._updateOBB(),this.updateRadiusAndCenter()}updateRadiusAndCenter(){if(this.lij[0]===0)ne(this._center[Hf.MIDDLE],0,0,0),ne(this._center[Hf.TOP],0,0,0),ne(this._center[Hf.BOTTOM],0,0,0),this.ellipsoid||(this.ellipsoid=Ar(this.surface.spatialReference)),this._center[Hf.MIDDLE][3]=this.ellipsoid.radius+this.elevationBounds[1];else{this._updateCenter();const t=Math.max(Vs(this._center[Hf.MIDDLE],this.obb[0]),Vs(this._center[Hf.MIDDLE],this.obb[1]));this._center[Hf.MIDDLE][3]=Math.sqrt(t)}}_isVisible(t){if(!fv(t,this._center[Hf.MIDDLE]))return!1;if(this.lij[0]<10)return!0;const r=this.obb;for(let i=0;i<Vy.NUM;i++){const n=i===ci.NEAR,s=t[i];n&&(N8[0]=s[0],N8[1]=s[1],N8[2]=s[2],N8[3]=s[3]-this.surface.view.state.camera.near);const a=n?N8:s;let o;for(o=0;o<8;o++){const l=r[o];if(a[0]*l[0]+a[1]*l[1]+a[2]*l[2]+a[3]<0)break}if(o===8)return!1}return!0}computeElevationBounds(){super.computeElevationBounds(),this._updateOBB()}createGeometry(){const t=this._getPatchType(this.lij[1],this.lij[0]);JSt(this.renderData,t),this.setMemoryDirty()}_updateOBB(){const t=this.extentInRadians,r=this.obb;for(let i=0;i<2;i++){const n=this.elevationBounds[i];let s=4*i;j6(r[s++],t[0],t[1],this.ellipsoid.radius+n),j6(r[s++],t[0],t[3],this.ellipsoid.radius+n),j6(r[s++],t[2],t[3],this.ellipsoid.radius+n),j6(r[s++],t[2],t[1],this.ellipsoid.radius+n)}if(this.surface.isWebMercator)switch(this._getPatchType(this.lij[1],this.lij[0])){case Ah.HAS_NORTH_POLE:ne(r[1],0,0,this.ellipsoid.radius),ne(r[2],0,0,this.ellipsoid.radius),ne(r[5],0,0,this.ellipsoid.radius),ne(r[6],0,0,this.ellipsoid.radius);break;case Ah.HAS_SOUTH_POLE:ne(r[0],0,0,-this.ellipsoid.radius),ne(r[3],0,0,-this.ellipsoid.radius),ne(r[4],0,0,-this.ellipsoid.radius),ne(r[7],0,0,-this.ellipsoid.radius)}}_getPatchType(t,r){return t===(1<<r)-1?t===0?Ah.HAS_BOTH_POLES:Ah.HAS_SOUTH_POLE:t===0?Ah.HAS_NORTH_POLE:Ah.REGULAR}intersectsRay(t,r,i,n){const s=this._center[Hf.MIDDLE],a=s[3]+i,o=r[0]*r[0]+r[1]*r[1]+r[2]*r[2],l=s[0]-t[0],c=s[1]-t[1],u=s[2]-t[2],h=(l*r[0]+c*r[1]+u*r[2])/o,p=r[0]*h-l,m=r[1]*h-c,g=r[2]*h-u;return p*p+m*m+g*g<a*a}getDefaultVerticesPerRowOnLevel(){return this.level<Oye.length?Oye[this.level]+1:2}updateCornerElevations(){e4t(this.renderData)}updateEdgeElevations(){t4t(this.renderData)}}const Oye=[128,64,32,16,16,8,8,4],N8=Er();var Hf;(function(e){e[e.TOP=0]="TOP",e[e.MIDDLE=1]="MIDDLE",e[e.BOTTOM=2]="BOTTOM"})(Hf||(Hf={}));class T4t{constructor(){this.extent=Jt(),this.minLevel=0,this.maxLevel=0,this.callback=null}}class S4t{constructor(){this._queries=new Qt({initialSize:10}),this._queriesInvPtr=0,this._queryQueue=new Qt({initialSize:30}),this._queryPool=new Fn(T4t)}queryVisibleLevelRange(t,r,i,n){const s=this._queryPool.acquire();hp(s.extent,t),s.minLevel=r||-Number.MAX_VALUE,s.maxLevel=i!=null?i:Number.MAX_VALUE,s.callback=n,this._queryQueue.push(s)}hasPendingQueries(){return this._queryQueue.length!==0}prepareQueries(){for(;this._queries.length<this._queries.data.length&&this._queryQueue.length>0;){const t=this._queryQueue.pop();this._queries.push(t)}this._queriesInvPtr=this._queries.length}processQueries(){for(let t=0;t<this._queries.length;t++){const r=this._queries.data[t];this._queryPool.release(r),r.callback(t>=this._queriesInvPtr),r.callback=null}this._queries.clear()}scaleQueriesForTile(t){const r=t.level;let i=0;for(;i<this._queriesInvPtr;){const n=this._queries.data[i],s=n.extent;r>=n.minLevel&&r<=n.maxLevel&&s[0]<=t.extent[2]&&s[2]>=t.extent[0]&&s[1]<=t.extent[3]&&s[3]>=t.extent[1]?(this._queries.swapElements(i,this._queriesInvPtr-1),this._queriesInvPtr--):i++}}}class Zae extends xl{constructor(){super(...arguments),this.blendMode=Fe.Normal}}d([H({count:Fe.COUNT})],Zae.prototype,"blendMode",void 0);class E4t extends uMe{constructor(){super(...arguments),this.opacity=1,this.baseOpacity=1,this.texture=null,this.fboTexture=null,this.blendMode=Fe.Normal,this.backgroundColor=gl}}class zU extends gi{initializeProgram(t){const r=zU.shader.get().build(this.configuration);return new ai(t.rctx,r,Ur)}initializePipeline(){return jt({blending:Im(Re.ONE,Re.ONE_MINUS_SRC_ALPHA),colorWrite:or})}}zU.shader=new si(ASt,()=>ie(()=>import("./BlendLayers.glsl.76743fb7.js"),[],import.meta.url));class ED extends Zae{constructor(){super(...arguments),this.output=Ia.Composite,this.baseOpacityMode=Ns.One,this.premultipliedSource=!1}}d([H({count:Ia.COUNT})],ED.prototype,"output",void 0),d([H({count:Ns.COUNT})],ED.prototype,"baseOpacityMode",void 0),d([H()],ED.prototype,"premultipliedSource",void 0);class uH{constructor(t,r,i,n,s,a){this.texture=t,this.type=r,t.retain(),this.offsetAndScale=Tr(i.offset[0],i.offset[1],i.scale,i.scale),this.opacities=Ve(n,a,s)}destroy(){this.texture.release()}}function CD(){return[1,0,0,1,0,0]}function C4t(e){return[e[0],e[1],e[2],e[3],e[4],e[5]]}function A4t(e,t,r,i,n,s){return[e,t,r,i,n,s]}function R4t(e,t){return new Float64Array(e,t,6)}Object.freeze(Object.defineProperty({__proto__:null,create:CD,clone:C4t,fromValues:A4t,createView:R4t},Symbol.toStringTag,{value:"Module"}));function O4t(e){return e instanceof Float32Array&&e.length>=2}function M4t(e){return Array.isArray(e)&&e.length>=2}function hH(e){return O4t(e)||M4t(e)}const P4t=96,I4t=39.37;function Qae(e,t){return t.type?vr(e,t.x,t.y):Na(e,t)}function $4t(e){return vc(e)}function L4t(e,t){const r=e.targetGeometry,i=t.targetGeometry;return r.x=i.x,r.y=i.y,r.spatialReference=i.spatialReference,e.scale=t.scale,e.rotation=t.rotation,e}const D4t=function(){const e=it();return function(t,r,i){const n=r.targetGeometry;Qae(e,n);const s=.5*UU(r);return t.xmin=e[0]-s*i[0],t.ymin=e[1]-s*i[1],t.xmax=e[0]+s*i[0],t.ymax=e[1]+s*i[1],t.spatialReference=n.spatialReference,t}}();function UU(e){return e.scale*F4t(e.targetGeometry)}function F4t(e){return _(e)&&dc(e.spatialReference)?1/($4t(e.spatialReference)*I4t*P4t):1}function N4t(e){return fV(e.rotation)||0}const Jae=function(){const e=it(),t=it(),r=it();return function(i,n,s,a,o,l){return Zne(e,n),Qc(t,s,.5*l),vr(r,1/a*l,-1/a*l),zne(i,t),o&&Sz(i,i,o),Vne(i,i,r),Ez(i,i,e),i}}(),k4t=function(){const e=it();return function(t,r,i,n){const s=UU(r),a=N4t(r);return Qae(e,r.targetGeometry),Jae(t,e,i,s,a,n)}}(),V4t=function(){const e=it();return function(t,r,i,n){const s=UU(r);return Qae(e,r.targetGeometry),Jae(t,e,i,s,0,n)}}();function z4t(e){const t=oy(e);return t?t.valid[1]-t.valid[0]:0}function U4t(e,t){return Math.round(z4t(e)/t)}var AK;const Jm=[0,0];let v1=AK=class extends ge{constructor(e){super(e),this._viewpoint2D={center:it(),rotation:0,scale:0,spatialReference:null},this.center=[0,0],this.extent=new Zt,this.id=0,this.inverseTransform=CD(),this.resolution=0,this.rotation=0,this.scale=0,this.transform=CD(),this.transformNoRotation=CD(),this.displayMat3=yy(),this.displayViewMat3=yy(),this.viewMat3=yy(),this.viewMat2d=IN(),this.worldScreenWidth=0,this.size=[0,0]}set pixelRatio(e){this._set("pixelRatio",e),this._update()}set size(e){this._set("size",e),this._update()}set viewpoint(e){if(e){const t=this._viewpoint2D,r=e.targetGeometry;t.center[0]=r.x,t.center[1]=r.y,t.rotation=e.rotation,t.scale=e.scale,t.spatialReference=r.spatialReference}this._update()}copy(e){const t=this.size,r=this.viewpoint;return r&&t?(this.viewpoint=L4t(r,e.viewpoint),this._set("size",Na(t,e.size))):(this.viewpoint=e.viewpoint.clone(),this._set("size",[e.size[0],e.size[1]])),this._set("pixelRatio",e.pixelRatio),this}clone(){return new AK({size:this.size,viewpoint:this.viewpoint.clone(),pixelRatio:this.pixelRatio})}toMap(e,t,r){return hH(t)?X2(e,t,this.inverseTransform):(Jm[0]=t,Jm[1]=r,X2(e,Jm,this.inverseTransform))}toScreen(e,t,r){return hH(t)?X2(e,t,this.transform):(Jm[0]=t,Jm[1]=r,X2(e,Jm,this.transform))}toScreenNoRotation(e,t,r){return hH(t)?X2(e,t,this.transformNoRotation):(Jm[0]=t,Jm[1]=r,X2(e,Jm,this.transformNoRotation))}getScreenTransform(e,t){const{center:r}=this._viewpoint2D,i=this._get("pixelRatio")||1,n=this._get("size");return Jae(e,r,n,t,0,i),e}_update(){const{center:e,spatialReference:t,scale:r,rotation:i}=this._viewpoint2D,n=this._get("pixelRatio")||1,s=this._get("size"),a=new Yh({targetGeometry:new ot(e[0],e[1],t),scale:r,rotation:i});if(this._set("viewpoint",a),!s||!t||!r)return;this.resolution=UU(a),this.rotation=i,this.scale=r,this.spatialReference=t,Na(this.center,e);const o=s[0]!==0?2/s[0]:0,l=s[1]!==0?-2/s[1]:0;use(this.displayMat3,o,0,0,0,l,0,-1,1,1);const c=hse(this.viewMat3),u=ul(s[0]/2,s[1]/2),h=ul(-s[0]/2,-s[1]/2),p=fV(i);zN(c,c,u),fse(c,c,p),zN(c,c,h),$z(this.displayViewMat3,this.displayMat3,c);const m=zne(this.viewMat2d,u);return Sz(m,m,p),Ez(m,m,h),D4t(this.extent,a,s),k4t(this.transform,a,s,n),F8e(this.inverseTransform,this.transform),V4t(this.transformNoRotation,a,s,n),this.worldScreenWidth=U4t(this.spatialReference,this.resolution),this._set("id",this.id+1),this}};d([f({readOnly:!0})],v1.prototype,"id",void 0),d([f({value:1,json:{write:!0}})],v1.prototype,"pixelRatio",null),d([f({json:{write:!0}})],v1.prototype,"size",null),d([f()],v1.prototype,"spatialReference",void 0),d([f({type:Yh,json:{write:!0}})],v1.prototype,"viewpoint",null),v1=AK=d([$("esri.views.2d.ViewState")],v1);const B4t=v1,G4t=.125;class j4t{constructor(){this._renderParams={context:null,drawPhase:1,state:new B4t({viewpoint:new Yh({targetGeometry:new ot(0,0),scale:1,rotation:0}),size:[256,256]}),stationary:!0,pixelRatio:1,displayLevel:-1,requiredLevel:-1,globalOpacity:1,renderPass:"background",styleLayer:null,styleLayerUID:-1,painter:null,glyphMosaic:null,spriteMosaic:null,profiler:null,renderingOptions:null,requestRender:null,deltaTime:-1,timeline:null,time:0,hasClipping:!1,blendMode:null,dataUploadCounter:0,effects:null,inFadeTransition:!1,requireFBO:!1}}dispose(){this._renderParams=null}render(t,r,i,n,s,a,o,l,c,u){const h=a.adjustLevel(r[0]),p=this._renderParams;p.context=t,p.painter=n,p.glyphMosaic=n.glyphMosaic,p.spriteMosaic=n.spriteMosaic,p.pixelRatio=u,p.displayLevel=h,p.requiredLevel=h;const m=a.getScale(r[0]),[g,b]=a.getShift(r,o*m),w=G4t*o*m/c,v=i.transforms.dvs;v[0]=w,v[4]=-w,v[6]=-1-g-l[0]*o*2,v[7]=1+b+(1-l[1])*o*2-2,p.state.size[0]=c,p.state.size[1]=c,i.stage||i.attachWithContext(t),i.triangleCount=0,n.drawTile(p,i,s)}}class BU extends gi{initializeProgram(t){const r=BU.shader.get().build(this.configuration);return new ai(t.rctx,r,Ur)}initializePipeline(){return jt({blending:Im(Re.ONE,Re.ONE_MINUS_SRC_ALPHA),colorWrite:or})}}BU.shader=new si(LSt,()=>ie(()=>import("./RasterColorizer.glsl.36f1b91a.js"),[],import.meta.url));class DS extends Zae{constructor(){super(...arguments),this.colorizerType=vw.Stretch,this.stretchType=ux.Noop,this.tileBlendInput=oo.LayerOnly,this.baseOpacityMode=Ns.One,this.applyColormap=!0}}d([H({count:vw.COUNT})],DS.prototype,"colorizerType",void 0),d([H({count:ux.COUNT})],DS.prototype,"stretchType",void 0),d([H({count:oo.COUNT})],DS.prototype,"tileBlendInput",void 0),d([H({count:Ns.COUNT})],DS.prototype,"baseOpacityMode",void 0),d([H()],DS.prototype,"applyColormap",void 0);class Mye{constructor(t){this._rctx=t,this._pools=new Map}acquire(t){return this._getPool(t).acquire()}clear(){this._pools.forEach(t=>t.destroy()),this._pools.clear()}_getPool(t){let r=this._pools.get(t);if(!r){const i=Pye.bind(Pye,this._rctx,{colorTarget:hn.TEXTURE,depthStencilTarget:Pr.DEPTH_RENDER_BUFFER,width:t,height:t},n=>this._getPool(n.width).release(n));r=new Fn(i,null,()=>{}),this._pools.set(t,r)}return r}}class Pye extends Pi{constructor(t,r,i){super(t,r),this.release=()=>i(this)}}const q4t=fe.getLogger("esri.views.3d.terrain");class H4t{constructor(t,r){this._rctx=t,this._techniqueRepository=r,this._fboPools=[],this._doubleBufferFbo=[],this._vectorTileHelper=new j4t,this._bindParameters=new Fz(null,null,null),this._blendLayersTechniqueConfig=new ED,this._poolToWrite=0,this._vaoQuad=Tl(this._rctx,bO),this._fboPools.push(new Mye(this._rctx)),this._fboPools.push(new Mye(this._rctx))}dispose(){this._fboPools.forEach(t=>{t.clear(),t=null}),this._fboPools=null,this._doubleBufferFbo.forEach(t=>Qe(t)),this._vaoQuad=Qe(this._vaoQuad),this._vectorTileHelper=Qe(this._vectorTileHelper),this._backgroundTechnique=ri(this._backgroundTechnique),this._applyOpacityTechnique=ri(this._applyOpacityTechnique),this._blendLayersTechnique=ri(this._blendLayersTechnique)}_getBlendLayersTechnique(t,r,i,n=!1){return this._blendLayersTechniqueConfig.output=r,this._blendLayersTechniqueConfig.blendMode=t,this._blendLayersTechniqueConfig.baseOpacityMode=i?r===Ia.Composite?Ns.OnBaseLayer:Ns.OnBackground:Ns.One,this._blendLayersTechniqueConfig.premultipliedSource=n,this._blendLayersTechnique=this._techniqueRepository.releaseAndAcquire(zU,this._blendLayersTechniqueConfig,this._blendLayersTechnique),this._blendLayersTechnique}drawBackground(t,r){const i=this._getBlendLayersTechnique(Fe.Normal,r,!1),n=this._rctx.bindTechnique(i,t,this._bindParameters);this._render(n)}_render(t){this._rctx.bindVAO(this._vaoQuad),t.assertCompatibleVertexAttributeLocations(this._vaoQuad),this._rctx.drawArrays(Dt.TRIANGLE_STRIP,0,io(this._vaoQuad,"geometry"))}drawRasterData(t,r,i=!1){if(R(r.texture))return;const n=r.baseOpacity<1;r.blendMode!==Fe.Normal||n||i?(r.fboTexture=this._currentFBO.colorTexture,this._switchPool(this._currentFBO.width)):r.fboTexture=null;const s=this._getBlendLayersTechnique(r.blendMode,t,n,i),a=this._rctx.bindTechnique(s,r,this._bindParameters);this._render(a)}drawImageryTileData(t,r,i){const n=t.sourceLayerInfo.data;if(!n.source)return;t.tile.surface.layerViewByIndex(t.layerIndex,er.MAP).ensureSymbolizerParameters(n);const s=i.baseOpacity<1;i.blendMode!==Fe.Normal||s?(i.fboTexture=this._currentFBO.colorTexture,this._switchPool(this._currentFBO.width)):i.fboTexture=null;const a=this._getRasterColorizerTechnique(n,r,i.blendMode,s),o=this._rctx.bindTechnique(a);if(!n.bind(this._rctx))return;n.opacity=i.opacity;const l=n.getUniforms();l.scale=t.scale,l.offset=t.offset,l.backgroundColor=i.backgroundColor,l.fboTexture=i.fboTexture,l.baseOpacity=i.baseOpacity,a.bindPass(l,null),this._render(o)}_getRasterColorizerTechnique(t,r,i,n){const s=t.symbolizerParameters,a=["stretch","lut","hillshade"].indexOf(s.type);return R(this._rasterColorizerConfig)&&(this._rasterColorizerConfig=new DS,this._rctx.gl.getExtension("WEBGL_color_buffer_float"),this._rctx.gl.getExtension("OES_texture_float")),this._rasterColorizerConfig.tileBlendInput=r===Ia.ColorComposite?oo.ColorComposite:r===Ia.GridComposite?oo.GridComposite:oo.LayerOnly,this._rasterColorizerConfig.blendMode=i,this._rasterColorizerConfig.baseOpacityMode=n?r===Ia.Composite?Ns.OnBaseLayer:Ns.OnBackground:Ns.One,this._rasterColorizerConfig.colorizerType=a,this._rasterColorizerConfig.applyColormap=!!s.colormap,this._rasterColorizerConfig.stretchType=t.hasStretchTypeNone()?ux.Noop:ux.PerBand,this._rasterColorizerTechnique=this._techniqueRepository.releaseAndAcquire(BU,this._rasterColorizerConfig,this._rasterColorizerTechnique),this._rasterColorizerTechnique}drawVectorData(t,r,i,n,s,a,o){const l=this._rctx,c=r.sourceLayerInfo.data,u=r.tile.surface.layerViewByIndex(r.layerIndex,er.MAP),h=t.baseOpacity<1||t.opacity<1||t.blendMode!==Fe.Normal||o!==Ia.Composite;let p;this._getBlendLayersTechnique(t.blendMode,o,t.baseOpacity<1,h).bindPipelineState(l),h?(p=this._acquire(s),l.bindFramebuffer(p),l.setClearColor(0,0,0,0),l.clearSafe(ii.COLOR_BUFFER_BIT|ii.DEPTH_BUFFER_BIT)):a&&l.clearSafe(ii.DEPTH_BUFFER_BIT);try{this._vectorTileHelper.render(l,r.sourceLod,c,u.painter,u.layer.styleRepository,u.schemaHelper,Math.round(1/r.scale),r.offset,n,i)}catch(m){q4t.warnOnce("A render call containing vector tiles did not resolve correctly.",m)}return!_(p)||(l.bindFramebuffer(this._currentFBO),t.texture=p.colorTexture,t.offset=Zh,t.scale=1,this.drawRasterData(o,t,h),p.release(),a)}copyFBOToTexture(t){const r=this._rctx,i=r.bindTexture(t.texture,at.TEXTURE_UNIT_FOR_UPDATES),n=t.descriptor;r.gl.copyTexImage2D(mt.TEXTURE_2D,0,n.pixelFormat,0,0,n.width,n.height,0),t.generateMipmap(),r.bindTexture(i,at.TEXTURE_UNIT_FOR_UPDATES)}_initFBO(t,r){this._rctx.bindFramebuffer(t),this._rctx.setViewport(0,0,r,r),this._rctx.setClearColor(0,0,0,0),this._rctx.setClearDepth(1),this._rctx.clearSafe(ii.COLOR_BUFFER_BIT|ii.DEPTH_BUFFER_BIT)}_acquire(t){return this._fboPools[this._poolToWrite].acquire(t)}bindPool(t,r){this._poolToWrite=t,this._doubleBufferFbo[t]==null&&(this._doubleBufferFbo[t]=this._acquire(r),this._initFBO(this._doubleBufferFbo[t],r))}_switchPool(t){this._releaseCurrentFBO(),this._doubleBufferFbo[this._poolToWrite]=null,this._poolToWrite=this._poolToWrite===0?1:0,this.bindPool(this._poolToWrite,t)}get _currentFBO(){return this._doubleBufferFbo[this._poolToWrite]}_releaseCurrentFBO(){this._doubleBufferFbo[this._poolToWrite].release(),this._doubleBufferFbo[this._poolToWrite]=null}releasePool(){this._rctx.bindFramebuffer(null),this._releaseCurrentFBO()}cleanupFBOPool(t,r){t===this._lastPixelRatio&&r===this._lastNumLayers||(this._fboPools.forEach(i=>i.clear()),this._lastPixelRatio=t,this._lastNumLayers=r)}}class W4t{constructor(t,r,i){this._rctx=t,this.tileSize=r,this._techniqueRepository=i,this._passParameters=new E4t,this._backgroundTexture=null,this._backgroundColor=null,this._backgroundDirty=!1,this._blackTex=null,this._numTexturedLayer=0,this._maxAnisotropy=this._rctx.parameters.maxMaxAnisotropy,this._composition=new H4t(this._rctx,this._techniqueRepository),this._blackTex=new LS(xlt(this._rctx,[0,0,0,1])),this._ensureBackgroundTexture(this.tileSize)}dispose(){this._composition=Qe(this._composition),this._backgroundTexture=ri(this._backgroundTexture),this._blackTex=ri(this._blackTex)}get backgroundIsGrid(){return R(this._backgroundColor)}get backgroundColor(){return this._backgroundColor}updateTileTexture(t,r){if(!t.renderData)return;const i=t.surface,n=i.baseOpacity;this._numTexturedLayer=0;let s=0,a=this.tileSize,o=!1;const l=i.view.state.pixelRatio;let c=!1;const u=t.layerInfo[er.MAP];let h=u.length,p=0;for(;p<u.length;p++){const b=i.layerViewByIndex(p,er.MAP),w=b.fullOpacity;if(pH[p]=w,nwe(b.layer)&&h>=u.length&&(h=p),w===0){u[p].pendingUpdates&=~(wt.TEXTURE_NOFADING&wt.TEXTURE_FADING);continue}++s;const v=fH(t,p);if(v){if(u[p].pendingUpdates&=~(wt.TEXTURE_NOFADING&wt.TEXTURE_FADING),Ak(b)){const x=ZOe(b.layer.parent)?"normal":b.layer.blendMode;Iye[p]=x;const T=x!=="normal";T&&(c=T,o=!1)}_R(b)?a=Math.max(a,this.tileSize*l):n===1&&w===1&&(b.isOpaque||this._dataToTexture(v)&&v.sourceLayerInfo.data.descriptor.isOpaque)&&(o=!0),++this._numTexturedLayer}}this._composition.cleanupFBOPool(l,u.length),a=X4t(a);const m=a/this.tileSize,g=p-1;this._ensureBackgroundTexture(this.tileSize),this._numTexturedLayer!==0?this._numTexturedLayer===1&&!c&&this._useLayerTexture(t,g,h,pH[g])||this._composeMapLayers(t,r,g,h,pH,Iye,a,m,!o||c):this._useBackgroundTexture(t,s)}_ensureBackgroundTexture(t){R(this._backgroundTexture)&&(this._backgroundTexture=this._buildTexture(t),this._backgroundDirty=!0),this._backgroundDirty&&(this._composition.bindPool(0,t),this._passParameters.offset=Zh,this._passParameters.scale=1,this._passParameters.opacity=1,this._passParameters.blendMode=Fe.Normal,_(this.backgroundColor)&&(this._passParameters.backgroundColor=this.backgroundColor),this._composition.drawBackground(this._passParameters,_(this.backgroundColor)?Ia.ColorOnly:Ia.GridOnly),this._composition.copyFBOToTexture(this._backgroundTexture),this._composition.releasePool(),this._backgroundDirty=!1)}_useBackgroundTexture(t,r){let i=by.Immediate;(t.surface.view.layerViewManager.updating||r>0)&&(i=by.Delayed),this._backgroundTexture&&R(t.renderData.textureReference)&&(i=by.Immediate),t.renderData.setTextureReference(_(this._backgroundTexture)?new uH(this._backgroundTexture,sa.FADING,$ye,t.surface.baseOpacity,1,0):null,i)}_useLayerTexture(t,r,i,n){const s=r<i,a=s?1:t.surface.baseOpacity,o=s?t.surface.baseOpacity:1,l=fH(t,r);return!!this._dataToTexture(l)&&(t.renderData.setTextureReference(new uH(l.sourceLayerInfo.data,sa.FADING,l,a,n,o)),!0)}_composeMapLayers(t,r,i,n,s,a,o,l,c){this._composition.bindPool(0,o);const u=t.surface.baseOpacity;let h=!1,p=tt.LINEAR_MIPMAP_LINEAR,m=!1,g=0;for(let w=i;w>=0;w--){const v=fH(t,w);if(!v||s[w]===0)continue;const x=w<n&&u<1&&!h;this._passParameters.baseOpacity=x?u:1,x&&(h=!0);const T=g===0,E=c&&T?this.backgroundIsGrid?Ia.GridComposite:Ia.ColorComposite:Ia.Composite;gTt(v)?(this._passParameters.opacity=s[w],this._passParameters.blendMode=xD[a[w]],m=this._composition.drawVectorData(this._passParameters,v,l,this.tileSize,o,m,E)):mTt(v)?(this._passParameters.opacity=s[w],this._passParameters.blendMode=xD[a[w]],this._composition.drawImageryTileData(v,E,this._passParameters),this._hasNearestInterpolation(v)&&(p=tt.NEAREST)):this._dataToTexture(v)&&(this._passParameters.texture=v.sourceLayerInfo.data.texture,this._passParameters.offset=v.offset,this._passParameters.scale=v.scale,this._passParameters.opacity=s[w],this._passParameters.blendMode=xD[a[w]],this._composition.drawRasterData(E,this._passParameters)),g++}const b=t.renderData.ensureTexture(o,()=>this._buildTexture(o,p));this._composition.copyFBOToTexture(b),this._composition.releasePool(),t.renderData.setTextureReference(new uH(b,r,$ye,h?1:u,1,0))}_hasNearestInterpolation(t){const r=t.sourceLayerInfo.data;return!!r.source&&r.interpolation==="nearest"}_dataToTexture(t){return bTt(t)&&this._rasterDataToTexture(t),yTt(t)}_rasterDataToTexture(t){const r=t.sourceLayerInfo;r.data=this._buildTexture(r.data),t.tile.setMemoryDirty()}setBackground(t){this._backgroundColor!==t&&(this._backgroundColor=t,this._backgroundDirty=!0)}_buildTexture(t,r=tt.LINEAR_MIPMAP_LINEAR){if(R(t))return null;const i={target:mt.TEXTURE_2D,pixelFormat:Ue.RGBA,dataType:At.UNSIGNED_BYTE,wrapMode:xt.CLAMP_TO_EDGE,samplingMode:r,maxAnisotropy:this._maxAnisotropy,flipped:!0,hasMipmap:!0},n=this._rctx;let s;if(typeof t=="number")i.width=i.height=t,s=new LS(new at(n,i));else if(t instanceof DU)i.isOpaque=t.isOpaque,s=new LS(new at(n,i,t.image)),t.release();else try{s=new LS(new at(n,i,t))}catch{s=new LS(zEe(n)),console.warn("TileRenderer: failed to execute 'texImage2D', cross-origin image may not be loaded.")}const a=n.bindTexture(s.texture,at.TEXTURE_UNIT_FOR_UPDATES);return s.generateMipmap(),n.bindTexture(a,at.TEXTURE_UNIT_FOR_UPDATES),s}get test(){return{backgroundTexture:this._backgroundTexture}}}function X4t(e){const t=$5(e),r=t*t,i=e*e;if(r===i)return e;const n=t/2;return r-i<i-n*n?t:n}function fH(e,t){Ad.layerIndex=t;const r=e.layerInfo[er.MAP][t];if(_(r.data))return vr(Ad.offset,0,0),Ad.tile=e,Ad.scale=1,Ad.sourceLod=e.lij,Ad.sourceLayerInfo=r,Ad;const i=r.upsampleInfo;if(_(i)){const n=i.tile.layerInfo[er.MAP][t];return Ad.tile=i.tile,Na(Ad.offset,i.offset),Ad.scale=i.scale,Ad.sourceLod=i.tile.lij,Ad.sourceLayerInfo=n,Ad}return null}const pH=new Array,Iye=new Array,Ad={tile:null,sourceLayerInfo:null,sourceLod:null,offset:[0,0],scale:1,layerIndex:0},$ye={offset:[0,0],scale:1},RMe=200,mH=40,Y4t=.8,Z4t=10,hC=1e-6;function Q4t(e,t,r){const i=t,n=r;let s=0,a=1/0;for(let o=0;o<3;++o){{const l=e[o];if(i[o]<l){if(n[o]<=hC)return!1;const c=(l-i[o])/n[o];s=Math.max(s,c)}else if(n[o]<=-hC){const c=(l-i[o])/n[o];a=Math.min(a,c)}if(s>a)return!1}{const l=e[o+3];if(i[o]>l){if(n[o]>=-hC)return!1;const c=(l-i[o])/n[o];s=Math.max(s,c)}else if(n[o]>=hC){const c=(l-i[o])/n[o];a=Math.min(a,c)}if(s>a)return!1}}return!0}class Lye{constructor(t,r,i,n,s){this.aabb=t,this.axis=r,this.d=i,this.midStartIndex=n,this.rightStartIndex=s}}class k9{constructor(t,r,i,n){this.globalTriangleVertexIndices=t,this.firstTriangleIndex=r,this.positionAttribute=n,this.rayDirection=M(),this.bspNodeTree=new Array,this.vertexPositionBuffer=n.data,this.vertexPositionStride=n.stride;const s=i-r,a=s<=OMe?new Uint16Array(s):new Uint32Array(s);this.indices=a;for(let o=0;o<s;++o)a[o]=o;{const o=r5t(t,r,i,n.data,n.stride),l=Le(Math.log2(s/mH),2,Z4t),c=(u,h,p)=>{const m=e5t(a,o,u,h),g=h-u;if(g<=mH){const E=new Lye(m,void 0,0,u,h);return this.bspNodeTree.push(E),E}const{axis:b,midValue:w}=t5t(m),v=K4t(a,o,u,h,b,w),x=(E,C)=>{if(p>l)return;const A=C-E;return A<mH||A>=Y4t*g?void 0:c(E,C,p+1)},T=new Lye(m,b,w,v.next,v.mid);return this.bspNodeTree.push(T),T.leftNode=x(u,v.next),T.rightNode=x(v.mid,h),T};c(0,s,0),this.triangleVertexIndices=i5t(a,t,r,i)}}intersectRayTriangleRange(t,r){{if(t>=r)return;const i=this.triangleVertexIndices,n=this.positionAttribute.data,s=this.positionAttribute.stride,a=this.rayOrigin,o=a[0],l=a[1],c=a[2],u=this.rayDirection,h=u[0],p=u[1],m=u[2];for(let g=t,b=3*t;g<r;++g){const w=i[b]*s,v=n[w],x=n[w+1],T=n[w+2],E=i[b+1]*s,C=n[E],A=n[E+1],P=n[E+2],I=i[b+2]*s,L=n[I],V=n[I+1],G=n[I+2];b+=3;const B=C-v,X=A-x,Y=P-T,ce=L-v,se=V-x,D=G-T,F=p*D-se*m,U=m*ce-D*h,j=h*se-ce*p,W=B*F+X*U+Y*j;if(Math.abs(W)<=Number.EPSILON)continue;const Z=o-v,q=l-x,ee=c-T,me=Z*F+q*U+ee*j;if(W>0){if(me<0||me>W)continue}else if(me>0||me<W)continue;const _e=q*Y-X*ee,De=ee*B-Y*Z,be=Z*X-B*q,ye=h*_e+p*De+m*be;if(W>0){if(ye<0||me+ye>W)continue}else if(ye>0||me+ye<W)continue;const Ce=(ce*_e+se*De+D*be)/W;if(Ce>=0){const Ne=this.indices[g]+this.firstTriangleIndex,Fr=Yse(B,X,Y,ce,se,D,J4t);this.callback(Ce,Fr,Ne,!1)}}}k9.numFacesTested+=r-t}intersectRay(t,r){k9.numFacesTested=0;const i=Ve(t.r0[0],t.r0[1],t.r0[2]),n=Ve(t.r1[0],t.r1[1],t.r1[2]),s=n[0]-i[0],a=n[1]-i[1],o=n[2]-i[2];if(s*s+a*a+o*o<hC)return;this.rayOrigin=i;const l=this.rayDirection;l[0]=s,l[1]=a,l[2]=o;const c=this.triangleVertexIndices.length/3;this.callback=r;const u=this.bspNodeTree[0];this.intersectRayBSP(u,0,c)}intersectRayBSP(t,r,i){const n=this.rayOrigin,s=this.rayDirection;if(!Q4t(t.aabb,n,s))return;const a=t.axis,o=t.d;if(n[a]<o||s[a]<0){const l=r,c=t.midStartIndex;if(l<c){const u=t.leftNode;u!==void 0?this.intersectRayBSP(u,l,c):this.intersectRayTriangleRange(l,c)}}if(this.intersectRayTriangleRange(t.midStartIndex,t.rightStartIndex),n[a]>o||s[a]>0){const l=t.rightStartIndex,c=i;if(l<c){const u=t.rightNode;u!==void 0?this.intersectRayBSP(u,l,c):this.intersectRayTriangleRange(l,c)}}}get estimatedMemoryUsage(){return this.triangleVertexIndices.byteLength+this.indices.byteLength}}k9.numFacesTested=0;const J4t=M(),CT=[1/0,1/0,1/0],AT=[-1/0,-1/0,-1/0];function K4t(e,t,r,i,n,s){let a=r,o=i;for(;a<o;){const c=e[a];t[6*c+n+3]<=s?++a:(--o,e[a]=e[o],e[o]=c)}let l=a;for(o=i;l<o;){const c=e[o-1];t[6*c+n]>=s?--o:(e[o-1]=e[l],e[l]=c,++l)}return{next:a,mid:l}}function e5t(e,t,r,i){if(i<=r)return Dw(NaN,NaN,NaN,NaN,NaN,NaN);{const n=6*e[r];for(let s=0;s<3;++s)CT[s]=t[n+0+s],AT[s]=t[n+3+s]}for(let n=r+1;n<i;++n){const s=6*e[n];for(let a=0;a<3;++a)CT[a]=Math.min(CT[a],t[s+0+a]),AT[a]=Math.max(AT[a],t[s+3+a])}return Dw(CT[0],CT[1],CT[2],AT[0],AT[1],AT[2])}function t5t(e){const t=e[3]-e[0],r=e[4]-e[1],i=e[5]-e[2],n=t>r?t>i?0:r>i?1:2:r>i?1:i>t?2:0;return{axis:n,midValue:(e[n]+e[n+3])/2}}function r5t(e,t,r,i,n){const s=r-t,a=new Float32Array(6*s);for(let o=0;o<s;++o){const l=3*(o+t),c=e[l+0]*n,u=e[l+1]*n,h=e[l+2]*n;for(let p=0;p<3;++p){const m=i[c+p],g=i[u+p],b=i[h+p];a[6*o+p]=Math.min(m,g,b),a[6*o+3+p]=Math.max(m,g,b)}}return a}function i5t(e,t,r,i){const n=i-r;let s=0;for(let o=r;o<i;++o)for(let l=0;l<3;++l)s=Math.max(t[3*o+l],s);const a=s<=OMe?new Uint16Array(3*n):new Uint32Array(3*n);for(let o=0;o<n;++o){const l=3*(e[o]+r);for(let c=0;c<3;++c){const u=t[l+c];a[3*o+c]=u}}return a}const OMe=65535;class Kae extends mRe{constructor(){super(...arguments),this.slicePlaneLocalOrigin=M(),this.origin=this.slicePlaneLocalOrigin}}var lu,Ea;(function(e){e[e.Material=0]="Material",e[e.ShadowMap=1]="ShadowMap",e[e.Highlight=2]="Highlight"})(lu||(lu={})),function(e){e[e.Color=0]="Color",e[e.Alpha=1]="Alpha",e[e.Depth=2]="Depth",e[e.Normal=3]="Normal"}(Ea||(Ea={}));class n5t extends Kae{constructor(){super(...arguments),this.identifier=lu.Material,this.transparent=!1,this.integratedMesh=!1}}class s5t extends Kae{constructor(){super(...arguments),this.identifier=lu.ShadowMap}}class a5t extends Kae{constructor(){super(...arguments),this.identifier=lu.Highlight}}class Pk extends sn{constructor(t,r){super(t,"vec4",zr.Draw,(i,n,s)=>i.setUniform4fv(t,r(n,s)))}}var wy;(function(e){e[e.Disabled=0]="Disabled",e[e.Enabled=1]="Enabled",e[e.EnabledWithWater=2]="EnabledWithWater",e[e.COUNT=3]="COUNT"})(wy||(wy={}));class o5t extends as{constructor(){super(...arguments),this.overlayOpacity=1}}function Dye(e,t){e.vertex.uniforms.add([new pl("overlayTexOffset"),new pl("overlayTexScale")]),e.fragment.uniforms.add([new He("overlayOpacity",r=>r.overlayOpacity),new Wt("ovColorTex",(r,i)=>i.overlays.length===0?null:i.overlays[ji.INNER].getColorTexture(r.overlaySource))]),MMe(e,t)}function l5t(e,t){const{vertex:r,fragment:i}=e;r.uniforms.add([new Pk("overlayTexOffset",(n,s)=>c5t(n,s)),new Pk("overlayTexScale",(n,s)=>d5t(n,s))]),i.constants.add("overlayOpacity","float",1),i.uniforms.add(new Wt("ovColorTex",(n,s)=>RK(n,s))),MMe(e,t)}function MMe(e,t){e.extensions.add("GL_OES_standard_derivatives"),t.pbrMode!==It.Water&&t.pbrMode!==It.WaterOnIntegratedMesh||e.include(_Re,t);const{vertex:r,fragment:i}=e;e.varyings.add("vtcOverlay","vec4"),r.code.add(S`void setOverlayVTC(in vec2 uv) {
vtcOverlay = vec4(uv, uv) * overlayTexScale + overlayTexOffset;
}`),i.code.add(S`bool isValid(vec2 uv, vec2 dxdy) {
return (uv.x >= 0.0 + dxdy.x) && (uv.x <= 1.0 - dxdy.x) && (uv.y >= 0.0 + dxdy.y) && (uv.y <= 1.0 - dxdy.y);
}
vec4 getOverlayColor(sampler2D ov0Tex, vec4 texCoords) {
vec4 color0 = texture2D(ov0Tex, vec2(texCoords.x * 0.5, texCoords.y));
vec4 color1 = texture2D(ov0Tex, vec2(texCoords.z * 0.5 + 0.5, texCoords.w));
bool isValid0 = isValid(texCoords.xy, fwidth(texCoords.xy));
bool isValid1 = isValid(texCoords.zw, vec2(0.0, 0.0));
return mix(color1 * float(isValid1), color0, float(isValid0));
}`),i.code.add(S`vec4 getCombinedOverlayColor() {
return overlayOpacity * getOverlayColor(ovColorTex, vtcOverlay);
}`),t.pbrMode!==It.Water&&t.pbrMode!==It.WaterOnIntegratedMesh||(i.uniforms.add([new St("lightingMainDirection",(n,s)=>s.lighting.lightingMainDirection),new St("lightingMainIntensity",(n,s)=>s.lighting.mainLight.intensity)]),i.code.add(S`vec4 getOverlayWaterColor(vec4 maskInput, vec4 colorInput, vec3 vposEyeDir,
float shadow, vec3 localUp, mat3 tbn, vec3 position, vec3 positionWorld) {
vec3 n = normalize(tbn *  (2.0 * maskInput.rgb - vec3(1.0)));
vec3 v = vposEyeDir;
vec3 final = getSeaColor(n, v, lightingMainDirection, colorInput.rgb, lightingMainIntensity, localUp, 1.0 - shadow, maskInput.w, position, positionWorld);
return vec4(final, colorInput.w);
}`))}function RK(e,t){return t.overlays.length===0?null:e.identifier===lu.Material&&e.subPass===Ea.Color?t.overlays[ji.INNER].getColorTextureNoRasterImage():e.identifier===lu.Highlight?t.overlays[ji.INNER].getValidTexture(In.Highlight):null}function c5t(e,t){for(const r of t.overlays){const{index:i,extent:n}=r;Axe(n)>0&&(c5[2*i]=e.toMapSpace[0]/su(n)-n[0]/su(n),c5[2*i+1]=e.toMapSpace[1]/$p(n)-n[1]/$p(n))}return c5}function d5t(e,t){for(const r of t.overlays){const{index:i,extent:n}=r;Axe(n)>0&&(c5[2*i]=e.toMapSpace[2]/su(n),c5[2*i+1]=e.toMapSpace[3]/$p(n))}return c5}const c5=Jt();function u5t(e,t){e.varyings.add("tbnTangent","vec3"),e.varyings.add("tbnBiTangent","vec3"),t.spherical?e.vertex.code.add(S`void forwardVertexTangent(vec3 n) {
tbnTangent = normalize(cross(vec3(0.0, 0.0, 1.0), n));
tbnBiTangent = normalize(cross(n, tbnTangent));
}`):e.vertex.code.add(S`void forwardVertexTangent(vec3 n) {
tbnTangent = vec3(1.0, 0.0, 0.0);
tbnBiTangent = normalize(cross(n, tbnTangent));
}`),e.fragment.code.add(S`mat3 getTBNMatrix(vec3 n) {
return mat3(tbnTangent, tbnBiTangent, n);
}`)}function h5t(e,t){e.varyings.add("vtc","vec2"),e.vertex.uniforms.add(new pl("texOffsetAndScale")),e.fragment.uniforms.add(new Hi("tex")),e.fragment.uniforms.add(new tc("textureOpacities"));const r=t.textureFadingEnabled&&!t.renderOccluded;r&&(e.vertex.uniforms.add(new pl("nextTexOffsetAndScale")),e.varyings.add("nvtc","vec2"),e.fragment.uniforms.add(new Hi("texNext")),e.fragment.uniforms.add(new tc("nextTexOpacities")),e.fragment.uniforms.add(new kr("fadeFactor")));const i=t.tileBlendInput===oo.ColorComposite,n=t.tileBlendInput===oo.GridComposite;n&&e.fragment.include(jae),i&&e.fragment.uniforms.add(new tc("backgroundColor")),e.vertex.code.add(S`
  void forwardTextureCoordinates(in vec2 uv) {
    vtc = uv * texOffsetAndScale.zw + texOffsetAndScale.xy;
    ${r?S`nvtc = uv * nextTexOffsetAndScale.zw + nextTexOffsetAndScale.xy;`:S``}
  }`),e.fragment.code.add(S`
    vec4 applyBaseOpacity(vec4 _color, vec3 _opacities) {
      return _opacities.z <= 0.0 ? _color : _color * _opacities.x;
    }

    vec4 getColor(vec4 color, vec2 uv, vec3 opacities) {
      ${n||i?S`
              if (opacities.y <= 0.0) {
                return color * opacities.z * opacities.x;
              }
              vec4 bg = ${i?S`vec4(backgroundColor, 1.0)`:S`gridColor(uv)`} * opacities.y;
              float alpha = opacities.z * color.a;
              return mix(bg, color, alpha) * opacities.x;`:S`return color;`}
    }`),r?e.fragment.code.add(S`vec4 getTileColor() {
vec4 color = getColor(texture2D(tex, vtc), vtc, textureOpacities);
if (fadeFactor >= 1.0) {
return color;
}
vec4 nextColor = getColor(texture2D(texNext, nvtc), nvtc, nextTexOpacities);
return mix(nextColor, color, fadeFactor);
}`):e.fragment.code.add(S`vec4 getTileColor() {
return getColor(texture2D(tex, vtc), vtc, textureOpacities);
}`)}class PMe extends o5t{}function f5t(e){const t=new Qr;t.include(GRe,{name:"Terrain Shader",output:e.output}),t.attributes.add(O.POSITION,"vec3"),t.attributes.add(O.UV0,"vec2"),t.attributes.add(O.NORMAL,"vec3");const{vertex:r,fragment:i}=t;if(r.uniforms.add([new Ei("proj",(n,s)=>s.camera.projectionMatrix),new tK("view",(n,s)=>wl(Fye,s.camera.viewMatrix,n.origin)),new yl("origin",n=>n.origin)]),i.uniforms.add(new yl("origin",n=>n.origin)),e.output===K.Color){t.include(no),t.include(gv,e),t.include(h5t,e),t.include(ox,e);const n=e.overlayMode!==wy.Disabled,s=e.overlayMode===wy.EnabledWithWater;n&&t.include(Dye,{...e,pbrMode:It.Water}),s&&t.include(u5t,e),t.varyings.add("vnormal","vec3"),t.varyings.add("vpos","vec3"),(e.atmosphere||e.screenSizePerspective)&&r.uniforms.add(new Ei("viewNormal",(o,l)=>l.camera.viewInverseTransposeMatrix));const a=e.receiveShadows&&!e.renderOccluded;a&&t.varyings.add("linearDepth","float"),e.tileBorders&&t.varyings.add("vuv","vec2"),e.atmosphere&&(r.uniforms.add(new St("lightingMainDirection",(o,l)=>l.lighting.lightingMainDirection)),t.varyings.add("wnormal","vec3"),t.varyings.add("wlight","vec3")),e.screenSizePerspective&&(t.varyings.add("screenSizeDistanceToCamera","float"),t.varyings.add("screenSizeCosAngle","float")),r.code.add(S`
      void main(void) {
        vpos = position;
        vnormal = ${e.shading?S`normal`:S`getLocalUp(vpos, origin)`};
        vec2 uv = uv0;
        ${e.atmosphere?S`
        wnormal = normalize((viewNormal * vec4(normalize(vpos + origin), 1.0)).xyz);
        wlight = normalize((view  * vec4(lightingMainDirection, 1.0)).xyz);`:""}
        ${e.tileBorders?S`vuv = uv;`:""}
        ${e.screenSizePerspective?S`
        vec3 viewPos = (view * vec4(vpos, 1.0)).xyz;
        screenSizeDistanceToCamera = length(viewPos);
        vec3 viewSpaceNormal = (viewNormal * vec4(normalize(vpos + origin), 1.0)).xyz;
        screenSizeCosAngle = abs(viewSpaceNormal.z);`:""}
        gl_Position = transformPosition(proj, view, vpos);
        ${a?S`linearDepth = gl_Position.w;`:""}
        forwardTextureCoordinates(uv);
        ${n?S`setOverlayVTC(uv);`:""}
        ${s?S`forwardVertexTangent(vnormal);`:S``}
      }
    `),t.extensions.add("GL_OES_standard_derivatives"),t.extensions.add("GL_EXT_shader_texture_lod"),t.include(Cn,e),t.include(ox,e),t.include(NO,e),t.include(ax,e),i.uniforms.add([new yl("cameraPosition",(o,l)=>pe(gH,l.camera.eye,o.origin)),new St("viewDirection",(o,l)=>we(gH,ne(gH,l.camera.viewMatrix[12],l.camera.viewMatrix[13],l.camera.viewMatrix[14]))),new He("lightingGlobalFactor",(o,l)=>l.lighting.globalFactor),new St("lightingMainDirection",(o,l)=>l.lighting.lightingMainDirection),new St("lightingMainIntensity",(o,l)=>l.lighting.mainLight.intensity)]),i.constants.add("ambientBoostFactor","float",v6),s&&i.uniforms.add([new Wt("ovWaterTex",(o,l)=>l.overlays.length===0?null:l.overlays[ji.INNER].getNormalTexture(o.overlaySource)),new tK("view",(o,l)=>wl(Fye,l.camera.viewMatrix,o.origin))]),i.code.add(S`const float sliceOpacity = 0.2;
float lum(vec3 c) {
return (min(min(c.r, c.g), c.b) + max(max(c.r, c.g), c.b)) * 0.5;
}`),i.code.add(S`
      void main() {
        ${a?S`float shadow = readShadowMap(vpos, linearDepth);`:S`float shadow = 0.0;`}
        vec3 normal = normalize(vnormal);
        float vndl = dot(normal, lightingMainDirection);
        float ssao = evaluateAmbientOcclusionInverse();
        vec4 tileColor = getTileColor();
        ${n?S`
            vec4 overlayColorOpaque = getOverlayColor(ovColorTex, vtcOverlay);
            vec4 overlayColor = overlayOpacity * overlayColorOpaque;
            vec4 groundColor = tileColor;
            tileColor = tileColor * (1.0 - overlayColor.a) + overlayColor;`:""}
        if (rejectBySlice(vpos)) {
          tileColor *= sliceOpacity;
        }
        ${e.atmosphere?S`
            float ndotl = clamp(vndl, 0.0, 1.0);
            vec3 atm = vec3(clamp(1.0 - dot(-viewDirection, wnormal), 0.0, 1.0));
            atm *= clamp(1.0 - lum(tileColor.rgb) * 1.5, 0.0, 1.0); //avoid atmosphere on bright base maps
            atm *= clamp(ndotl * 2.0, 0.0, 1.0); // avoid atmosphere on dark side of the globe
            atm *= tileColor.a; // premultiply with tile alpha`:""}

        vec3 albedo = ${e.atmosphere?S`atm + tileColor.rgb;`:S`tileColor.rgb;`}

        // heuristic shading function used in the old terrain, now used to add ambient lighting
        float additionalAmbientScale = smoothstep(0.0, 1.0, clamp(vndl${e.shading?"":S`*2.5`}, 0.0, 1.0));

        vec3 additionalLight = ssao * lightingMainIntensity * additionalAmbientScale * ambientBoostFactor ${e.shading?"":S`* lightingGlobalFactor`};

        gl_FragColor = vec4(evaluateSceneLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight), tileColor.a);
        ${s?S`
            vec4 overlayWaterMask = getOverlayColor(ovWaterTex, vtcOverlay);
            float waterNormalLength = length(overlayWaterMask);
            if (waterNormalLength > 0.95) {
              mat3 tbnMatrix = mat3(tbnTangent, tbnBiTangent, vnormal);
              vec4 waterOverlayColor = vec4(overlayColor.w > 0.0 ? overlayColorOpaque.xyz/overlayColor.w : vec3(1.0), overlayColor.w);
              vec4 viewPosition = view*vec4(vpos, 1.0);
              vec4 waterColorLinear = getOverlayWaterColor(overlayWaterMask, waterOverlayColor, -normalize(vpos - cameraPosition), shadow, vnormal, tbnMatrix, viewPosition.xyz,  vpos + origin);
              vec4 waterColorNonLinear = delinearizeGamma(vec4(waterColorLinear.xyz, 1.0));
              // un-gamma the ground color to mix in linear space
              gl_FragColor = mix(groundColor, waterColorNonLinear, waterColorLinear.w);
            }`:""}
        ${e.screenSizePerspective?S`
          float perspectiveScale = screenSizePerspectiveScaleFloat(1.0, screenSizeCosAngle, screenSizeDistanceToCamera, vec4(0.0, 0.0, 0.0, 0.0));
          if (perspectiveScale <= 0.25) {
            gl_FragColor = mix(gl_FragColor, vec4(1.0, 0.0, 0.0, 1.0), perspectiveScale * 4.0);
          }
          else if (perspectiveScale <= 0.5) {
            gl_FragColor = mix(gl_FragColor, vec4(0.0, 0.0, 1.0, 1.0), (perspectiveScale - 0.25) * 4.0);
          }
          else if (perspectiveScale >= 0.99) {
            gl_FragColor = mix(gl_FragColor, vec4(0.0, 1.0, 0.0, 1.0), 0.2);
          }
          else {
            gl_FragColor = mix(gl_FragColor, vec4(1.0, 0.0, 1.0, 1.0), (perspectiveScale - 0.5) * 2.0);
          }`:""}
        ${e.tileBorders?S`
            vec2 dVuv = fwidth(vuv);
            vec2 edgeFactors = smoothstep(vec2(0.0), 1.5 * dVuv, min(vuv, 1.0 - vuv));
            float edgeFactor = 1.0 - min(edgeFactors.x, edgeFactors.y);
            gl_FragColor = mix(gl_FragColor, vec4(1.0, 0.0, 0.0, 1.0), edgeFactor);`:""}
        gl_FragColor = highlightSlice(gl_FragColor, vpos);
      }
    `)}return e.output!==K.Depth&&e.output!==K.Shadow||(t.include(no,{hasModelTransformation:!1,linearDepth:!0}),t.include(x_,{output:e.output}),t.include(gv,e),t.varyings.add("linearDepth","float"),r.uniforms.add(new _r("nearFar",(n,s)=>s.camera.nearFar)),r.code.add(S`void main(void) {
gl_Position = transformPositionWithDepth(proj, view, position, nearFar, linearDepth);
}`),i.code.add(S`void main() {
outputDepth(linearDepth);
}`)),e.output===K.Normal&&(t.include(no),t.include(gv,e),t.varyings.add("vnormal","vec3"),t.varyings.add("vpos","vec3"),r.uniforms.add(new Ei("viewNormal",(n,s)=>s.camera.viewInverseTransposeMatrix)),r.code.add(S`
        void main(void) {
          vec3 normal = ${e.shading?S`normal`:S`getLocalUp(position, origin)`};
          vpos = position;

          gl_Position = transformPosition(proj, view, vpos);
          vnormal = normalize((viewNormal * vec4(normal, 1.0)).xyz);
        }
    `),i.code.add(S`void main() {
vec3 normal = normalize(vnormal);
if (gl_FrontFacing == false) {
normal = -normal;
}
gl_FragColor = vec4(vec3(0.5) + 0.5 * normal, 0.0);
}`)),e.output===K.Highlight&&(t.include(no),t.include(gv,e),t.include(Dye,e),r.code.add(S`void main() {
setOverlayVTC(uv0);
gl_Position = transformPosition(proj, view, position);
}`),t.include(Ky),i.code.add(S`void main() {
vec4 overlayColor = getCombinedOverlayColor();
if (overlayColor.a == 0.0) {
gl_FragColor = vec4(0.0);
return;
}
outputHighlight();
}`)),t}const Fye=Ae(),gH=M(),p5t=Object.freeze(Object.defineProperty({__proto__:null,TerrainPassParameters:PMe,build:f5t},Symbol.toStringTag,{value:"Module"}));class GU extends gi{constructor(){super(...arguments),this.useStencil=!1}initializeConfiguration(t,r){r.spherical=t.viewingMode===Be.Global}initializeProgram(t){const r=GU.shader.get().build(this.configuration);return new ai(t.rctx,r,Ur)}initializePipeline(){return this._stencilPipelineState=this._createPipeline(!0),this._createPipeline(!1)}_createPipeline(t){const r=this.configuration,i=r.backfaceCullingEnabled&&!r.renderOccluded;return jt({blending:r.renderOccluded?Im(Re.ONE,Re.ONE_MINUS_SRC_ALPHA):null,culling:i&&Qne,depthTest:!r.renderOccluded&&{func:vi.LESS},depthWrite:!r.renderOccluded&&fc,colorWrite:or,stencilTest:t?Gyt(oc.IntegratedMeshMaskExcluded):null})}getPipelineState(t,r){return this.useStencil?this._stencilPipelineState:super.getPipelineState(t,r)}}GU.shader=new si(p5t,()=>ie(()=>import("./Terrain.glsl.e05e1716.js"),[],import.meta.url));class Bn extends Mo{constructor(){super(...arguments),this.output=K.Color,this.overlayMode=wy.Disabled,this.tileBlendInput=oo.LayerOnly,this.spherical=!1,this.atmosphere=!1,this.receiveShadows=!1,this.hasSlicePlane=!1,this.backfaceCullingEnabled=!1,this.stencilEnabled=!1,this.textureFadingEnabled=!1,this.renderOccluded=!1,this.hasScreenSpaceReflections=!1,this.hasCloudsReflections=!1,this.tileBorders=!1,this.screenSizePerspective=!1,this.receiveAmbientOcclusion=!1,this.shading=ue("enable-feature:terrain-shading")}}d([H({count:K.COUNT})],Bn.prototype,"output",void 0),d([H({count:wy.COUNT})],Bn.prototype,"overlayMode",void 0),d([H({count:oo.COUNT})],Bn.prototype,"tileBlendInput",void 0),d([H()],Bn.prototype,"spherical",void 0),d([H()],Bn.prototype,"atmosphere",void 0),d([H()],Bn.prototype,"receiveShadows",void 0),d([H()],Bn.prototype,"hasSlicePlane",void 0),d([H()],Bn.prototype,"backfaceCullingEnabled",void 0),d([H()],Bn.prototype,"stencilEnabled",void 0),d([H()],Bn.prototype,"textureFadingEnabled",void 0),d([H()],Bn.prototype,"renderOccluded",void 0),d([H()],Bn.prototype,"hasScreenSpaceReflections",void 0),d([H()],Bn.prototype,"hasCloudsReflections",void 0),d([H()],Bn.prototype,"tileBorders",void 0),d([H()],Bn.prototype,"screenSizePerspective",void 0),d([H()],Bn.prototype,"receiveAmbientOcclusion",void 0),d([H()],Bn.prototype,"shading",void 0),d([H({constValue:!0})],Bn.prototype,"isGround",void 0),d([H({constValue:It.Disabled})],Bn.prototype,"pbrMode",void 0),d([H({constValue:!1})],Bn.prototype,"highStepCount",void 0),d([H({constValue:!1})],Bn.prototype,"useCustomDTRExponentForWater",void 0),d([H({constValue:!1})],Bn.prototype,"useFillLights",void 0);const yH=7,m5t=10,bH=is(),WI=Jt();let Vd=class extends xe{constructor(e){super(e),this.type=Wi.TERRAIN,this.isGround=!0,this.tileSize=256,this._techniqueConfiguration=new Bn,this._passParameters=new PMe,this.rctx=null,this._isTransparent=!1,this._scaleRangeQueries=new S4t,this.renderDataPool=new Fn(ry),this._patchGroups=new Map,this.patchGroupsDirty=!0,this.tileIterator=new sMe,this.highestVisibleLODTile=null,this.visible=!0,this._opaque=!0,this._velvetOverground=!0,this._castShadows=!0,this.emptyTex=null,this.tileRenderer=null,this.stencilEnabledLayerExtents=[],this.numTilesRendered=0,this.numTilesCulled=0,this.numOriginsRendered=0,this.needsHighlight=!1,this.renderOccludedFlags=ki.Occlude}get isGlobal(){return this.stage.viewingMode===Be.Global}get shadingEnabled(){var e;return(e=this._techniqueConfiguration)==null?void 0:e.shading}initialize(){const e=[Ee.OPAQUE_TERRAIN,Ee.TRANSPARENT_TERRAIN,Ee.OCCLUDED_TERRAIN];this.stage.addRenderPlugin(e,this)}destroy(){this.stage.removeRenderPlugin(this),uSt()}get canRender(){return this.visible&&!!this._rootTiles&&!this.renderingDisabled}set renderingDisabled(e){this._set("renderingDisabled",!!e),this.setNeedsRender()}set opaque(e){this._opaque!==e&&(this._opaque=e,this.setNeedsRender())}get opaque(){return this._opaque&&!this._techniqueConfiguration.hasSlicePlane}get needsLinearDepth(){return this.overlayRenderer.hasWater}set isTransparent(e){this._isTransparent!==e&&(this._isTransparent=e,this.setNeedsRender())}get isTransparent(){return this._isTransparent}get renderPatchBorders(){return!!this._techniqueConfiguration.tileBorders}set renderPatchBorders(e){this._techniqueConfiguration.tileBorders!==e&&(this._techniqueConfiguration.tileBorders=e,this.setNeedsRender(),this.notifyChange("renderPatchBorders"))}get cullBackFaces(){return this._techniqueConfiguration.backfaceCullingEnabled}set cullBackFaces(e){this._techniqueConfiguration.backfaceCullingEnabled!==e&&(this._techniqueConfiguration.backfaceCullingEnabled=e,this.notifyChange("cullBackFaces"),this.setNeedsRender())}set renderOrder(e){this._set("renderOrder",e),this.setNeedsRender()}set velvetOverground(e){this._velvetOverground!==e&&(this._velvetOverground=e,this.setNeedsRender())}get layerUid(){return op}get slicePlaneEnabled(){return this._techniqueConfiguration.hasSlicePlane}set slicePlaneEnabled(e){this._techniqueConfiguration.hasSlicePlane!==e&&(this._techniqueConfiguration.hasSlicePlane=e,this.setNeedsRender())}set textureFadingEnabled(e){this._techniqueConfiguration.textureFadingEnabled!==e&&(this._techniqueConfiguration.textureFadingEnabled=e,this.setNeedsRender())}setDebugScreenSizePerspective(e){this._techniqueConfiguration.screenSizePerspective!==e&&(this._techniqueConfiguration.screenSizePerspective=e,this.setNeedsRender())}toggleShading(){this._techniqueConfiguration.shading=!this._techniqueConfiguration.shading,this.setNeedsRender()}setRootTiles(e){this._rootTiles=e,this.setNeedsRender()}setNeedsHighlight(e){this.needsHighlight=e,this.setNeedsRender()}setRenderOccludedOverlay(e){this.renderOccludedFlags=e?mk:ki.Occlude,this.setNeedsRender()}setStencilEnabledLayerExtents(e){this.stencilEnabledLayerExtents=e,this.setNeedsRender()}setTileSize(e){this.tileSize=e,_(this.tileRenderer)&&(this.tileRenderer.tileSize=e),this.setNeedsRender()}_prepareTileForLoading(e){e.renderData||(e.renderData=this.renderDataPool.acquire(),e.renderData.init(e),e.renderData.localOrigin=this._getLocalOriginOfTile(e))}loadTile(e){this._prepareTileForLoading(e),this.updateTileGeometry(e),this.updateTileTexture(e,wt.TEXTURE_FADING)}queryVisibleLevelRange(e,t,r,i){this._scaleRangeQueries.queryVisibleLevelRange(e,t,r,i),this.setNeedsRender()}updateTileTexture(e,t){_(this.tileRenderer)&&(this.tileRenderer.updateTileTexture(e,t===wt.TEXTURE_FADING?sa.FADING:sa.UNFADED),this.setNeedsRender(),e.resetPendingUpdate(t))}updateTileGeometryState(e){this._prepareTileForLoading(e),e.renderData.updateGeometryStateAndPrepareForGeometryGeneration(this.wireframe)}updateTileGeometry(e){for(const t of e.layerInfo[er.ELEVATION])t.pendingUpdates&=~wt.GEOMETRY;e.resetPendingUpdate(wt.GEOMETRY),e.renderData.updateGeometryIfChanged(this.rctx,this.wireframe)&&this.setNeedsRender()}unloadTile(e){const t=e.renderData;t&&(t.releaseGeometry(),this.renderDataPool.release(t),t.clear(),e.renderData=null,e.setMemoryDirty(),this.setNeedsRender())}_getLocalOriginOfTile(e){const t=m5t-yH,r=Math.max(0,Math.floor((e.level-t)/yH)*yH);if(this.isGlobal&&r===0)return gl;for(;e.parent&&e.level>r;)e=e.parent;return e.centerAtSeaLevel}setVisibility(e){this.visible=e,this.setNeedsRender()}getStats(){return{numTilesRendered:this.numTilesRendered,numTilesCulled:this.numTilesCulled,numOriginsRendered:this.numOriginsRendered}}set wireframe(e){this._get("wireframe")!==e&&(this._set("wireframe",e),this.allTiles.forAll(t=>{t.isLoaded&&(this.updateTileGeometry(t),t.updateNeighborsAfterGeometryChange())}),this.setNeedsRender())}setNeedsRender(e=Xn.UPDATE){this.patchGroupsDirty=!0,this._context.requestRender(e)}initializeRenderContext(e){this._context=e,this.rctx=e.renderContext.rctx,this._techniqueRepository=e.shaderTechniqueRepository,this.tileRenderer=new W4t(this.rctx,this.tileSize,this._techniqueRepository),this.updateTileBackground(),this.emptyTex=zEe(this.rctx)}uninitializeRenderContext(){this.emptyTex=Qe(this.emptyTex),this.tileRenderer=Qe(this.tileRenderer)}intersect(e,t,r,i){if(!this._rootTiles||e.options.selectOpaqueTerrainOnly&&e.options.selectionMode&&!this._opaque)return;const n=y5t,s=b5t;pe(n,i,r),ne(s,1/n[0],1/n[1],1/n[2]);const a=e.results.min,o=e.results.max,l=e.results.ground,c=e.options.store===Da.MIN,u=!!e.results.ground.target,h=Yut(e.verticalOffset),p=e.tolerance;let m,g=c&&_(a.dist)?a.dist:1/0;const b=v=>{const x=v.renderData;if(!(x!=null&&x.vao))return;const T=x.geometryInfo;TV(bH,T.boundingBox);const E=x.localOrigin;_(h)&&(h.localOrigin=E,h.applyToAabb(bH));const C=bH;if(RT[0]=r[0]-E[0],RT[1]=r[1]-E[1],RT[2]=r[2]-E[2],!Qse(C,RT,s,p,g))return;const A=(X,Y,ce)=>{X.set(this.type,v,Y,ce,Es),g=c&&_(a.dist)?a.dist:1/0},P=(X,Y)=>{if(_(Y)&&X>=0&&(e.options.backfacesTerrain||Se(Y,n)<0)&&(e.options.invisibleTerrain||!e.options.selectionMode||t==null||t(r,i,X))){if((l.dist==null||X<l.dist)&&A(l,X,Y),e.options.isFiltered)return;e.options.store===Da.ALL&&(R(m)?(m=Ase(e.ray),A(m,X,Y),e.results.all.push(m)):X<m.dist&&A(m,X,Y)),(a.dist==null||X<a.dist)&&A(a,X,Y),e.options.store!==Da.MIN&&(o.dist==null||X>o.dist)&&A(o,X,Y)}},I=v5t;pe(I,i,E);const L=T.indices,V=T.vertexAttributes,G={data:V.getField(O.POSITION,Zr).typedBuffer,size:3,stride:V.stride/4},B=T.indexCount/3;if(R(h)&&B>RMe){const X=v.renderData;R(X.intersectionData)&&(X.intersectionData=new k9(L,0,B,G)),X.intersectionData.intersectRay({r0:RT,r1:I},P)}else EO(RT,I,0,B,L,G,null,h,P)},w=this._rootTiles;_(w)&&(()=>{const v=this.tileIterator;v.reset(w);const x=e.options.invisibleTerrain;for(;!v.done;){const T=v.next();!(T.visible||x&&T.intersectsClippingArea)||!_(h)&&!T.intersectsRay(r,n,p,g)||u&&this._useStencilForTile(T)?v.skipSubtree():b(T)}})()}prepareTechnique(e){if(e.bindParameters.slot===Ee.OCCLUDED_TERRAIN){if((e.renderOccludedMask&mk)==0)return null}else{const t=this.opaque?Ee.OPAQUE_TERRAIN:Ee.TRANSPARENT_TERRAIN;if(e.bindParameters.slot!==t)return null}switch(e.pass){case je.MATERIAL:{this._techniqueConfiguration.hasScreenSpaceReflections=e.bindParameters.ssr.enabled,this._techniqueConfiguration.hasCloudsReflections=_(e.bindParameters.clouds.data),this._techniqueConfiguration.receiveShadows=e.bindParameters.shadowMap.ready,this._techniqueConfiguration.receiveAmbientOcclusion=e.bindParameters.ssaoHelper.ready,this._techniqueConfiguration.overlayMode=this.overlayRenderer.isEmpty()?wy.Disabled:this.overlayRenderer.hasWater?wy.EnabledWithWater:wy.Enabled;const t=e.bindParameters.slot===Ee.OCCLUDED_TERRAIN?al.Occluded:al.ColorAndWater;return this._updateTechnique(K.Color,t===al.Occluded)}case je.MATERIAL_DEPTH_SHADOWMAP_ALL:case je.MATERIAL_DEPTH_SHADOWMAP_DEFAULT:return this._castShadows&&e.bindParameters.lighting.globalFactor===1?(this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(K.Shadow,!1)):null;case je.MATERIAL_DEPTH:return this.isTransparent&&this.overlayRenderer.isEmpty()?null:(this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(K.Depth,!1));case je.MATERIAL_NORMAL:return this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(K.Normal,!1);case je.MATERIAL_HIGHLIGHT:return this.needsHighlight?(this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(K.Highlight,!1)):null}return null}render(e,t){const r=e.pass,i=e.bindParameters.lighting.globalFactor===1;switch(this._updatePatchGroups(),t.useStencil=!1,r){case je.MATERIAL:{const n=e.bindParameters.slot===Ee.OCCLUDED_TERRAIN?al.Occluded:al.ColorAndWater;this._renderMaterialPass(e,t,n);break}case je.MATERIAL_DEPTH_SHADOWMAP_ALL:case je.MATERIAL_DEPTH_SHADOWMAP_DEFAULT:this._castShadows&&i&&this._renderAuxiliaryPass(e,t,al.None);break;case je.MATERIAL_DEPTH:this.isTransparent&&this.overlayRenderer.isEmpty()||this._renderAuxiliaryPass(e,t,al.None);break;case je.MATERIAL_NORMAL:this._renderAuxiliaryPass(e,t,al.None);break;case je.MATERIAL_HIGHLIGHT:this.needsHighlight&&(this._renderAuxiliaryPass(e,t,al.Highlight),e.rctx.clearSafe(ii.DEPTH_BUFFER_BIT))}this._scaleRangeQueries.hasPendingQueries()&&this.setNeedsRender()}_renderMaterialPass(e,t,r){const{rctx:i}=e;this._passParameters.overlaySource=r,i.bindTechnique(t,this._passParameters,e.bindParameters),this.numTilesRendered=0,this.numTilesCulled=0,this.numOriginsRendered=0,this._scaleRangeQueries.prepareQueries(),this.opaque?this._renderPatchGroups(e,t,r):e.offscreenRenderingHelper.renderToTargets(()=>this._renderPatchGroups(e,t,r),e.offscreenRenderingHelper.tmpColor,e.offscreenRenderingHelper.mainDepth,[0,0,0,0]),this._scaleRangeQueries.processQueries()}_renderAuxiliaryPass(e,t,r){const i=e.rctx;this._passParameters.overlaySource=r,i.bindTechnique(t,this._passParameters,e.bindParameters),this._renderPatchGroupsAuxiliary(e,t,r)}updateTileBackground(e=null){if(R(this.tileRenderer))return;const t=this.tileRenderer;let r=null;if(_(e)){const i=Te.toUnitRGBA(e);r=Ve(i[0]||0,i[1]||0,i[2]||0)}t.setBackground(r),this.allTiles.forAll(i=>t.updateTileTexture(i,sa.FADING)),this._techniqueConfiguration.tileBlendInput=t.backgroundIsGrid?oo.GridComposite:_(t.backgroundColor)?oo.ColorComposite:oo.LayerOnly,this.setNeedsRender()}_updatePatchGroups(){if(this.patchGroupsDirty){if(this.highestVisibleLODTile=null,this._rebuildPatchGroups(),this.renderOrder!==SR.NONE){const e=Array.from(this._patchGroups.values());e.forEach(t=>oMe(this.renderOrder,t)),e.sort((t,r)=>lMe(t[0],r[0],this.renderOrder)),this._patchGroups=new Map(e.map(t=>[t[0].renderData.localOrigin,t]))}this.patchGroupsDirty=!1}}_rebuildPatchGroups(){var t;const e=this._rootTiles;if(!R(e)){(t=e[0])==null||t.surface.checkAllTileWaterproofness(),this._patchGroups.clear();for(const r of e)this._rebuildPatchGroupsForRootTile(r)}}_rebuildPatchGroupsForRootTile(e){const t=this.tileIterator;for(t.resetOne(e);!t.done;){const r=t.next(),i=r.renderData;if(!i||r.visible)if(r.rendered){if(i){const n=this._patchGroups.get(i.localOrigin)||new Array;this._patchGroups.set(i.localOrigin,n),n.push(r),(!this.highestVisibleLODTile||r.vlevel>this.highestVisibleLODTile.vlevel)&&(this.highestVisibleLODTile=r),t.skipSubtree()}}else this.numTilesCulled++;else this.numTilesCulled++,t.skipSubtree()}}_useStencilForTile(e){for(const t of this.stencilEnabledLayerExtents)if(e.intersectsExtent(t))return!0;return!1}_renderPatchGroupsAuxiliary(e,t,r){const i=this.stencilEnabledLayerExtents.length>0;this._patchGroups.forEach(n=>{const s=n[0].renderData.localOrigin;t.program.bindDraw(new oK(s),e.bindParameters);for(let a=0;a<n.length;a++)this._renderPatch(e,t,n[a],Dt.TRIANGLES,i,r)}),e.rctx.bindVAO(null)}_renderPatchGroups(e,t,r){const i=e.rctx,n=e.bindParameters.camera,s=t.program;if(this._techniqueConfiguration.screenSizePerspective&&this.pointsOfInterest){const u=D7e(this.stage.viewingMode,this.ellipsoidRadius),h=this.pointsOfInterest.centerOnSurfaceFrequent.distance;u.update({distance:h,fovY:n.fovY})}const a=this.stencilEnabledLayerExtents.length>0,o=r===al.Occluded;o&&(s.bindTexture("tex",this.emptyTex),s.setUniform1f("blend",1),s.setUniform4fv("texOffsetAndScale",rm));const l=_(this.tileRenderer)&&_(this.tileRenderer.backgroundColor)?this.tileRenderer.backgroundColor:gl;this._techniqueConfiguration.tileBlendInput===oo.ColorComposite&&s.setUniform3fv("backgroundColor",l);const c=this.wireframe?Dt.LINES:Dt.TRIANGLES;this._techniqueConfiguration.textureFadingEnabled&&s.bindTexture("texNext",this.emptyTex),this._patchGroups.forEach(u=>{const h=u[0].renderData.localOrigin;t.program.bindDraw(new oK(h),e.bindParameters),this.numOriginsRendered++;for(let p=0;p<u.length;p++){const m=u[p],g=m.renderData.textureReference;if(!R(g)){if(!o){this._scaleRangeQueries.scaleQueriesForTile(m),Nye(m.renderData.geometryInfo.uvOffsetAndScale,g.offsetAndScale,WI),s.setUniform4fv("texOffsetAndScale",WI),s.bindTexture("tex",g.texture.texture);const b=m.renderData.textureFadeFactor,w=b<1?m.renderData.nextTextureReference:null;this._techniqueConfiguration.textureFadingEnabled&&_(w)&&b<1?(Nye(m.renderData.geometryInfo.uvOffsetAndScale,w.offsetAndScale,WI),s.setUniform1f("fadeFactor",b),s.setUniform4fv("nextTexOffsetAndScale",WI),s.setUniform3fv("nextTexOpacities",w.opacities),s.bindTexture("texNext",w.texture.texture)):s.setUniform1f("fadeFactor",1),m.renderData.textureIsFading&&this.setNeedsRender(),s.setUniform3fv("textureOpacities",g.opacities)}this._renderPatch(e,t,m,c,a,r),m.renderOrder=this.numTilesRendered,this.numTilesRendered++}}}),i.bindVAO(null)}_renderPatch(e,t,r,i,n,s){const a=r.renderData,o=a.vao,l=o.indexBuffer;if(R(l))return;const c=t.program;s!==al.None&&this._bindOverlayPatchData(c,a.overlay),n&&(t.useStencil=this._useStencilForTile(r),t.bindPipelineState(e.rctx,e.bindParameters.slot));const u=a.geometryInfo.indexCount;e.rctx.bindVAO(o),c.assertCompatibleVertexAttributeLocations(o),e.rctx.drawElements(i,u,l.indexType,0)}_bindOverlayPatchData(e,t){e.setUniform4fv("overlayTexOffset",t.offsets),e.setUniform4fv("overlayTexScale",t.scales)}_updateTechnique(e,t){return this._techniqueConfiguration.output=e,e===K.Color&&(this._techniqueConfiguration.atmosphere=this.isGlobal&&this._velvetOverground),this._techniqueConfiguration.renderOccluded=t,this._techniqueConfiguration.stencilEnabled=!1,this._shaderTechnique=this._techniqueRepository.releaseAndAcquire(GU,this._techniqueConfiguration,this._shaderTechnique),this._shaderTechnique}get test(){return{tileRenderer:this.tileRenderer}}};d([f({constructOnly:!0})],Vd.prototype,"overlayRenderer",void 0),d([f({constructOnly:!0})],Vd.prototype,"stage",void 0),d([f({readOnly:!0})],Vd.prototype,"isGlobal",null),d([f({constructOnly:!0})],Vd.prototype,"allTiles",void 0),d([f({constructOnly:!0})],Vd.prototype,"ellipsoidRadius",void 0),d([f({value:!1})],Vd.prototype,"renderingDisabled",null),d([f()],Vd.prototype,"renderPatchBorders",null),d([f()],Vd.prototype,"cullBackFaces",null),d([f({value:SR.FRONT_TO_BACK})],Vd.prototype,"renderOrder",null),d([f()],Vd.prototype,"wireframe",null),Vd=d([$("esri.views.3d.terrain.TerrainRenderer")],Vd);const g5t=Vd;function Nye(e,t,r){r[0]=e[0]*t[2]+t[0],r[1]=e[1]*t[3]+t[1],r[2]=e[2]*t[2],r[3]=e[3]*t[3]}const y5t=M(),b5t=M(),RT=M(),v5t=M();class _5t{constructor(){this.numNodes=0,this.numLeaves=0,this.numVisible=0,this.numRendered=0,this.numSplit=0,this.numMerged=0,this.numRenderedPerLevel=new Array,this.numLoadedPerLevel=new Array}}let C0=class extends xe{constructor(e){super(e),this._handles=new Ft}initialize(){this._handles.add(this.layers.on("change",()=>this._update())),this._handles.add(re(()=>this.extentHelper.layerViewsExtent,()=>this._setAdHocTilingScheme())),this._update(),this.tilingSchemeLocked||this._setAdHocTilingScheme()}destroy(){this._handles=ct(this._handles),this._waitTask=null}_update(){if(this._waitTask=null,this.tilingSchemeLocked)return;let e;if(this.layers.some(t=>!(!H4(t)||t.isRejected())&&!(t.isFulfilled()&&!w5t(t,this.viewSpatialReference,this.viewingMode))&&(e=t,!((t==null?void 0:t.type)==="vector-tile"||Ck(t)))),e)if(e.isResolved()){const t=NU(e,this.viewSpatialReference,this.viewingMode);if(_(t)){const r=new Mi(t.tileInfo);this._lockTilingScheme(r)}}else this._updateWhen(e)}_updateWhen(e){const t=e.when().catch(()=>{}).then(()=>{t!==this._waitTask||this.destroyed||this._update()});this._waitTask=t}_lockTilingScheme(e){if(this.viewingMode===Be.Global){const t=e.levels.length-1;e.spatialReference.isWebMercator?e=Mi.makeWebMercatorAuxiliarySphere(t):kw(e.spatialReference)&&(e=Mi.makeGCSWithTileSize(e.spatialReference,e.pixelSize,t))}this.tilingSchemeLocked=!0,this.tilingScheme=e,this.extentHelper.tilingScheme=this.tilingScheme,this._updateTiledLayerExtent(),this._handles.removeAll(),this._handles.add(re(()=>this.extentHelper.tiledLayersExtent,()=>this._updateTiledLayerExtent()))}_updateTiledLayerExtent(){this._set("extent",this.extentHelper.tiledLayersExtent)}_setAdHocTilingScheme(){if(this.viewingMode===Be.Global){const e=this.extentHelper.viewSpatialReference,t=kw(e)||Sm(e)||Em(e);e.isWebMercator?this.tilingScheme=Mi.WebMercatorAuxiliarySphere:t&&(this.tilingScheme=Mi.makeGCSWithTileSize(e,256)),this._set("extent",this.extentHelper.layerViewsExtent)}else{const e=this.extentHelper.layerViewsExtent;_(e)&&!sw(e,this.extent)&&(this.tilingScheme=Mi.fromExtent(e,this.extentHelper.viewSpatialReference),this._set("extent",e))}}get test(){return{lockTilingScheme:e=>this._lockTilingScheme(e),done:!this._waitTask}}};function w5t(e,t,r){return _(NU(e,t,r))}d([f()],C0.prototype,"tilingScheme",void 0),d([f({readOnly:!0})],C0.prototype,"extent",void 0),d([f({value:!1})],C0.prototype,"tilingSchemeLocked",void 0),d([f({constructOnly:!0})],C0.prototype,"viewSpatialReference",void 0),d([f({constructOnly:!0})],C0.prototype,"layers",void 0),d([f({constructOnly:!0})],C0.prototype,"extentHelper",void 0),d([f({constructOnly:!0})],C0.prototype,"viewingMode",void 0),C0=d([$("esri.views.3d.terrain.TilingSchemeLogic")],C0);class x5t{constructor(){this.offset=it(),this.scale=0,this.tile=null}init(t,r,i,n){this.tile=t,this.offset[0]=r,this.offset[1]=i,this.scale=n}dispose(){this.tile=null,this.offset[0]=0,this.offset[1]=0,this.scale=0}}const vf=fe.getLogger("esri.views.3d.terrain.TerrainSurface"),T5t=.25;let lr=class extends mn.EventedMixin(xe){constructor(e){var t,r;super(e),this._elevationBounds=new Uae,this._iteratorPool=new Fn(sMe,i=>i.remove=()=>this._iteratorPool.release(i)),this._postorderIterator=new gSt,this._hasPendingUpdates=!1,this._pendingUpdates=0,this._asyncWorkItems=0,this._allTilesDirty=!0,this._allTilesSorted=!0,this._visible=!1,this._usedMemory=null,this._performanceInfo=new _5t,this._viewChanged=!1,this._inFrameTask=!1,this._viewChangeUpdateDirty=!1,this._eyePosRenderSR=M(),this._eyePosSurfaceSR=M(),this._splitLimits=new jSt,this._snapLevel=1/0,this._frustum=rR(),this._viewProjectionMatrix=Ae(),this._layerViews=[new Array,new Array],this._layerIndexByUid=[new Map,new Map],this._basemapLayerViewHandles=new Map,this._handles=new Ft,this._watchUpdatingTracking=new tm,this._frameTask=d9,this._allTiles=new Qt,this._upsampleInfoPool=new Fn(x5t),this._rootTilesExtent=zt(),this._maxNumUpdating=1,this.maxTextureScale=1.2,this.backgroundColor=null,this._updatingRootTiles=!1,this.deferTileNeighborUpdate=!1,this.neighborTilesToUpdate=new Set,this.totalGeometryUpdates=0,this.totalTileUpdates=0,this._layerViewsDirty=!1,this._isGlobal=!((r=(t=e.view)==null?void 0:t.state)!=null&&r.isLocal)}initialize(){this._lercDecoder=BTt(this.view.resourceController),this._tilePool=this.view.state.isLocal?new Fn(w4t):new Fn(x4t);const e=this.view.resourceController.memoryController;this._upsampleMapCache=e.newCache("esri.views.3d.terrain.upsample",n=>n.unloadMapData()),this._elevationQueryCache=new zTt(e.newCache("elevation-query")),this._set("overlayManager",new Vl({surface:this})),this._handles.add([re(()=>this.overlayManager.hasHighlights,n=>this._renderer.setNeedsHighlight(n)),re(()=>this.overlayManager.rendersOccluded,n=>this._renderer.setRenderOccludedOverlay(n))],"overlayManager"),this._renderer=new g5t({overlayRenderer:this.overlayManager.renderer,ellipsoidRadius:Ar(this.view.spatialReference).radius,stage:this.view._stage,allTiles:this._allTiles}),this._handles.add([re(()=>this.baseOpacity,n=>{this._handleLayerViewChanges(),this._updateBaseOpacity(n)},Yn),re(()=>this.hasCompositeBlendMode,()=>{this._updateBaseOpacity(this.baseOpacity)},Yn),re(()=>this.renderingDisabled,()=>this._updateTransparentTerrain(),ti),re(()=>this.backgroundColor,n=>{this._handleLayerViewChanges(),this._renderer.updateTileBackground(n)},Yn),re(()=>this.view.pointsOfInterest,n=>{this._renderer.pointsOfInterest=n,this._watchUpdatingTracking.removeAll(),n&&this._watchUpdatingTracking.add(()=>n.focus.renderLocation,()=>()=>this._allTilesSorted=!1)}),re(()=>Yr.TERRAIN_TILE_TREE_SHOW_TILES,n=>{n&&!this._treeDebugger?ie(()=>import("./TerrainTileTree3DDebugger.ba061dbb.js"),["TerrainTileTree3DDebugger.ba061dbb.js","TileTreeDebugger.88189f1e.js"],import.meta.url).then(({TerrainTileTree3DDebugger:s})=>{!this._treeDebugger&&Yr.TERRAIN_TILE_TREE_SHOW_TILES&&(this._treeDebugger=new s({view:this.view}))}):n||(this._treeDebugger=ct(this._treeDebugger))},Ot)]),this._extentHelper=nSt(this.viewingMode,{layers:this.view.map.allLayers,layerViews:this.view.allLayerViews,viewSpatialReference:this.view.spatialReference});const t=this.view.defaultsFromMap?new k5({getCollections:()=>{var n,s,a;return(a=(s=(n=this.view)==null?void 0:n.defaultsFromMap)==null?void 0:s.mapCollections)==null?void 0:a.map(({layers:o})=>o)},getChildrenFunction:n=>n&&"layers"in n?n.layers:null}):this.view.map.allLayers,r=new C0({layers:t,extentHelper:this._extentHelper,viewingMode:this.viewingMode,viewSpatialReference:this.view.spatialReference});this._set("tilingSchemeLogic",r),this._updateTilingScheme(),this._elevationDataRequester=this.view.resourceController.createStreamDataRequester(H0.ELEVATION),this._mapDataRequester=this.view.resourceController.createStreamDataRequester(H0.BASEMAP);const i=this.view.resourceController.scheduler;this._frameTask=i.registerTask(bt.TERRAIN_SURFACE,this),this._handles.add([re(()=>this._extentHelper.stencilEnabledExtents,n=>this._renderer.setStencilEnabledLayerExtents(n),Ot),re(()=>this.tilingSchemeLogic.tilingScheme,()=>this._updateTilingScheme(),ti),re(()=>this.extent,()=>this._updateRootTiles(),Ot),this.view.on("resize",()=>this._viewChangeUpdate()),re(()=>{var a,o;const n=this.view,s=n.state;return[this.lodBias,this.lodSnapping,(o=(a=n.resourceController)==null?void 0:a.memoryController)==null?void 0:o.memoryFactor,s.camera,s.contentCamera,s.fixedContentCamera]},()=>this._viewChangeUpdate(),Yn),re(()=>{var n,s;return(s=(n=this.view.qualitySettings)==null?void 0:n.tiledSurface)==null?void 0:s.textureFadeDuration},n=>this._renderer.textureFadingEnabled=n>0,Ot),re(()=>this._userClippingExtent,()=>this._updateClippingExtent(),ti)]),this._handles.add(this.view.allLayerViews.on("after-changes",()=>this._layerViewsDirty=!0)),this._layerViewsDirty=!0,this._handleLayerViewChanges()}destroy(){this._frameTask.remove(),this._handles.destroy(),this._watchUpdatingTracking.destroy(),this._lercDecoder=ri(this._lercDecoder),this._removeAllTiles(),this._upsampleMapCache=ct(this._upsampleMapCache),this._elevationQueryCache=ct(this._elevationQueryCache),this._set("tilingSchemeLogic",ct(this.tilingSchemeLogic)),this._extentHelper=ct(this._extentHelper),this._basemapLayerViewHandles.forEach((e,t)=>this._unregisterTiledLayerView(t)),this._elevationDataRequester=null,this._mapDataRequester=null,this._set("overlayManager",ct(this.overlayManager)),this._tilePool=ct(this._tilePool),qae.prune(),this._treeDebugger&&(this._treeDebugger.destroy(),this._treeDebugger=null),this._renderer=ct(this._renderer),this._iteratorPool=ct(this._iteratorPool),this._set("view",null),this._upsampleInfoPool=ct(this._upsampleInfoPool),tSt(),BSt()}get renderer(){return this._renderer}get frustum(){return this._frustum}get snapLevel(){var t,r;const e=(r=(t=this.view.pointsOfInterest)==null?void 0:t.contentCameraOnSurface)==null?void 0:r.scale;if(e){const i=this.view.state.contentCamera;let n=jz(this.view,i.eye,i.viewForward,i.up).tilt;n>90&&(n=180-n);const s=2*(n/90)**2,a=x7e(this.view,e)-s;Math.abs(this._snapLevel-a)>T5t&&(Math.round(a)!==Math.round(this._snapLevel)&&(this._viewChanged=!0),this._snapLevel=a)}return Math.round(this._snapLevel)}get lodSnapping(){return this.view.qualitySettings.tiledSurface.reduceTileLevelDifferences?I9.ON:I9.OFF}get upsampleInfoPool(){return this._upsampleInfoPool}get upsampleMapCache(){return this._upsampleMapCache}get elevationQueryCache(){return this._elevationQueryCache}get mapTileRequester(){return this._mapDataRequester}get _userClippingExtent(){const{spatialReference:e}=this,{clippingArea:t}=this.view;if(R(t)||R(e))return null;const r=zt(),i=DOe(t,r,e)?r:null,n=this._get("extent");return sw(i,n)?n:i}get rootTilesExtent(){return this._rootTilesExtent}get extent(){const e=aL(this.groundExtent,this._userClippingExtent,zt()),t=this._get("extent");return sw(e,t)?t:e}get groundExtent(){return _(this._tilingSchemeExtent)?this._tilingSchemeExtent:this._rootTilesExtent}get _tilingSchemeExtent(){var e;return(e=this.tilingSchemeLogic)==null?void 0:e.extent}get updating(){return this._hasPendingUpdates||(this._maxNumUpdating=1),!!((this._watchUpdatingTracking.updating||this._hasPendingUpdates||this._viewChanged||this._allTilesDirty||this._asyncWorkItems>0||!this._allTilesSorted||this._layerViewsDirty)&&this.ready&&!this.suspended||this.overlayManager.updating||this._frameTask.updating)}get updatingProgressValue(){return this._maxNumUpdating=Math.max(this._pendingUpdates,this._maxNumUpdating),1-this._pendingUpdates/this._maxNumUpdating}get viewingMode(){return this.view.state.viewingMode}get ready(){return _(this.rootTiles)}set renderOrder(e){this._renderer.renderOrder=e,this._set("renderOrder",e)}get spatialReference(){var e,t;return(t=(e=this.tilingScheme)==null?void 0:e.spatialReference)!=null?t:null}set slicePlaneEnabled(e){this._renderer.slicePlaneEnabled=e,this._set("slicePlaneEnabled",e),this._updateTransparentTerrain()}_updateTransparentTerrain(){var t,r;const e=!this.renderingDisabled&&!this.opaque;(r=(t=this.view)==null?void 0:t._stage)==null||r.renderView.setRenderParameters({transparentTerrain:e})}set velvetOverground(e){e!==this.velvetOverground&&(this._renderer.velvetOverground=e),this._set("velvetOverground",e)}set visible(e){e!==this._visible&&(this._visible=e,this._renderer.setVisibility(e),this.suspended=!e)}get opaque(){return this._renderer.opaque}set suspended(e){this._set("suspended",e),this._viewChangeUpdate()}intersect(e,t,r,i){this._renderer.intersect(e,t,r,i)}getElevation(e,t,r,i){const n=this.getTileWithElevation(e,t,r,i,qa);return R(n)?null:tMe(qa[0],qa[1],n.renderData.geometryState.samplerData)}getTileWithElevation(e,t,r,i,n=qa){var a;const s=this.rootTiles;if(R(s)||!s.length||s[0].layerInfo[er.ELEVATION].length===0)return null;if(n[0]=e,n[1]=t,n[2]=r,!Ss(n,i,n,(a=this.tilingScheme)==null?void 0:a.spatialReference))return vf.error("TerrainSurface.getElevation(): could not project given point to tiling scheme coordinate system"),null;for(let o of s){if(!o.containsPoint(n))continue;for(;o&&!o.rendered&&!o.isLeaf;){let c=0;n[0]>.5*(o.extent[0]+o.extent[2])&&(c+=1),n[1]<.5*(o.extent[1]+o.extent[3])&&(c+=2),o=o.children[c]}const l=o.renderData;return l&&l.geometryState.samplerData?o:null}return null}get elevationBounds(){return this._elevationBounds}getScale(e){if(this.tilingScheme){if(!oa(e,qa,this.spatialReference))return vf.error("TerrainSurface.getScale(): could not project given point to tiling scheme coordinate system"),null;const t=this.rootTiles;if(_(t)){for(let r of t)if(r!=null&&r.containsPoint(qa)){for(;!r.isLeaf&&!r.rendered;){let i=0;qa[0]>r.children[0].extent[2]&&(i+=1),qa[1]<r.children[0].extent[1]&&(i+=2),r=r.children[i]}return this._getLodBiasCorrectedScale(r.level)}}}return 1e100}getSphereElevationBounds(e,t,r,i,n){var c;if(qa[0]=e,qa[1]=t,qa[2]=r,qa[3]=i,!Ss(qa,n,qa,(c=this.tilingScheme)==null?void 0:c.spatialReference))return vf.error("TerrainSurface.getSphereElevationBounds(): could not project given point to tiling scheme coordinate system"),null;let s=1/0,a=-1/0;const o=u=>{if(u&&ede(u.extent,qa))if(u.isLeaf||u.rendered)s=Math.min(s,u.elevationBounds[0]),a=Math.max(a,u.elevationBounds[1]);else for(const h of u.children)o(h)},l=this.rootTiles;if(_(l))for(const u of l)o(u);return{min:s,max:a}}getSphereScale(e,t){if(!this.tilingScheme)return null;if(!oa(e,qa,this.spatialReference))return vf.error("TerrainSurface.getSphereScale(): could not project given point to tiling scheme coordinate system"),null;qa[3]=t;let r=null;const i=s=>{if(s&&ede(s.extent,qa))if(s.isLeaf||s.rendered){const a=this._getLodBiasCorrectedScale(s.level);r=r==null?a:Math.min(r,a)}else for(const a of s.children)i(a)},n=this.rootTiles;if(_(n))for(const s of n)i(s);return r}queryVisibleScaleRange(e,t,r,i){const n=t?this.tilingScheme.levelAtScale(t):0,s=r?this.tilingScheme.levelAtScale(r):1/0,a=this.lodBias;this._renderer.queryVisibleLevelRange(e,n+a,s+a,i)}_updateBaseOpacity(e){const t=this._renderer.opaque;this._renderer.opaque=e>=1&&!this.hasCompositeBlendMode,this._renderer.isTransparent=this._allSurfaceLayersTransparent();const r=t!==this._renderer.opaque;r&&this._updateTransparentTerrain(),this._updateTileTextures(r?sa.UNFADED:sa.IMMEDIATE)}_updateTilingScheme(){var t,r;const e=this.tilingSchemeLogic.tilingScheme;e!==this.tilingScheme&&(V0(!!e,"tiling scheme cannot be reset to undefined"),this._isGlobal=!((r=(t=this.view)==null?void 0:t.state)!=null&&r.isLocal),this.tilingScheme&&this._removeAllTiles(),this._set("tilingScheme",e),this._updateClippingExtent(),e&&(this._updateTiledLayers(),this._renderer.setTileSize(e.pixelSize),this.overlayManager.setSpatialReference(e.spatialReference),this._updateRootTiles()))}_acquireTile(e,t,r,i){const n=this._tilePool.acquire();return XI[0]=e,XI[1]=t,XI[2]=r,n.init(XI,i,this),n}get updatingRootTiles(){return this._updatingRootTiles}_updateRootTiles(){const{extent:e,tilingScheme:t}=this;if(!t)return;const r=C5t;let i=t.rootTilesInExtent(e,r,5*b4);if(_(this.rootTiles)){if(i.length>b4)return void vf.warn(mat);const n=this.rootTiles.map(a=>a.lij),s=jDe(n,i,kye);if(this._updatingRootTiles=!0,s.removed.length>0||s.added.length>0){const a=this.rootTiles.filter(o=>!(s.removed.findIndex(l=>kye(l,o.lij))>-1)||(this._purgeTile(o,!0),!1));s.added.forEach(o=>a.push(this._newRootTile(o))),this._setRootTiles(a)}}else this._updatingRootTiles=!0,i.length>b4&&(vf.warn(gat),i=t.rootTilesInExtent(e,r,b4)),this._setRootTiles(i.map(n=>this._newRootTile(n)));sw(r,this._rootTilesExtent)||(this._rootTilesExtent=zt(r)),this.visible=!0,this._viewChangeUpdate(),this.overlayManager.setPlacementDirty(),this.notifyChange("ready"),this._allTiles.forEach(n=>{n.isLoaded&&this._prepareToLoadTile(n)}),this._allTiles.forAll(n=>{n.isLoaded&&(this._updateTileGeometry(n),this._updateTileNeighborsAfterGeometryChange(n))}),this._updatingRootTiles=!1,this.checkAllTileWaterproofness()}_newRootTile(e){const t=this._acquireTile(0,e[1],e[2],null);return t.shouldSplit(this._splitLimits,this._eyePosRenderSR,this.lodSnapping)===wt.SPLIT&&t.setPendingUpdate(wt.SPLIT),this._loadTile(t),this.deferTileNeighborUpdate||t.checkGeometryWaterproofness(),t}_setRootTiles(e){if(this._set("rootTiles",e),this._allTiles.clear(),_(e)){const t=this._iteratorPool.acquire();for(t.reset(e);!t.done;)this._allTiles.push(t.next());t.remove()}this._renderer.setRootTiles(this.rootTiles),this._updateTilesVisibility(e)}_runViewChangeUpdateIfDirty(){this._viewChangeUpdateDirty&&(this._viewChangeUpdateDirty=!1,this._viewChangeUpdate())}_viewChangeUpdate(){this.view&&!this.suspended&&this.tilingScheme&&this._visible&&(this._inFrameTask?this._viewChangeUpdateDirty=!0:(this._viewChangeUpdateDirty=!1,this._updateViewDependentParameters(),this._updateTilesVisibility(this.rootTiles)))}_updateClippingStatus(e){e.updateClippingStatus(this.extent)&&e.resetPendingUpdate(wt.GEOMETRY)&&this._updateTileGeometry(e)}_updateTilesVisibility(e){if(R(e))return;const t=vSt(e);let r=t?this._elevationBounds.min:1/0,i=t?this._elevationBounds.max:-1/0;const n=this.view.state.fixedContentCamera,s=this.extent,a=this._viewProjectionMatrix;this.setTileTreeDirty();const o=this._iteratorPool.acquire();for(o.reset(e);!o.done;){const l=o.next();l.updateClippingStatus(s)&&l.resetPendingUpdate(wt.GEOMETRY)&&this._updateTileGeometry(l),l.setPendingUpdate(wt.RENDERDATA);const c=l.computeVisibility();n||c?(l.updateScreenDepth(a),l.renderData&&(r=Math.min(l.elevationBounds[0],r),i=Math.max(l.elevationBounds[1],i))):o.skipSubtree()}o.remove(),this._viewChanged=!0,this._allTilesDirty=!0,isFinite(r)&&isFinite(i)&&(this._elevationBounds.min===r&&this._elevationBounds.max===i||(this._elevationBounds.min=r,this._elevationBounds.max=i,this.emit("elevation-bounds-change",null)))}_updateViewDependentParameters(){const e=this.view.state.camera,t=this.view.state.contentCamera,r=Math.tan(.5*t.fovX),i=Math.tan(.5*t.fovY),n=this.tilingScheme.pixelSize,s=2**-this.lodBias*e.pixelRatio;this._splitLimits.aboveGround=e.aboveGround,this._splitLimits.fovX=r,this._splitLimits.fovY=i,this._splitLimits.relativeWidthLimit=n/e.width*this.maxTextureScale*s,this._splitLimits.relativeHeightLimit=n/e.height*this.maxTextureScale*s,this._splitLimits.maxLod=this.tilingScheme.getMaxLod(),this._splitLimits.angledSplitBias=this.view.qualitySettings.tiledSurface.angledSplitBias,this.view.state.fixedContentCamera?(R(this._splitLimits.frustum)&&(this._splitLimits.frustum=rR()),HN(this._splitLimits.frustum,t.frustum)):this._splitLimits.frustum=null,HN(this._frustum,e.frustum),Zi(this._viewProjectionMatrix,t.projectionMatrix,t.viewMatrix),oe(this._eyePosRenderSR,t.eye),Ss(e.eye,this.view.renderSpatialReference,this._eyePosSurfaceSR,this.spatialReference)}_updateRenderData(e){e.rendered&&!e.shouldLoad&&(IMe(e)?(this._loadChildren(e),this.deferTileNeighborUpdate||(this._checkTileNeighborsWaterproofness(e),e.children.forEach(t=>t.checkGeometryWaterproofness()))):E5t(e)&&this._loadParent(e))}_updateTileGeometry(e){e.updateVisibility(),this._renderer.updateTileGeometry(e),this._updateTileNeighborsAfterGeometryChange(e),this._elevationUpdate(e),this._usedMemory=null,this.deferTileNeighborUpdate&&this.neighborTilesToUpdate.delete(e)}_updateTileNeighborsAfterGeometryChange(e,t){if(this.deferTileNeighborUpdate){const r=this.neighborTilesToUpdate;e.forEachLoadedNeighbor(i=>{r.add(i)})}else e.updateNeighborsAfterGeometryChange(t)}_updateTileTexture(e,t){const r=e.resetPendingUpdate(wt.TEXTURE_FADING)?wt.TEXTURE_FADING:!!e.resetPendingUpdate(wt.TEXTURE_NOFADING)&&wt.TEXTURE_NOFADING;r&&(this._renderer.updateTileTexture(e,r),this._usedMemory=null,t.madeProgress())}_elevationUpdate(e){YI.spatialReference=this.spatialReference,YI.tile=e,YI.extent=e.extent,this.emit("elevation-change",YI)}get running(){return this.updating&&this.ready&&!this.suspended}runTask(e){this._handleLayerViewChanges(e),this._frameTask.processQueue(e),this._inFrameTask=!0,this._pendingUpdates=0,this._hasPendingUpdates=!1,this._updateTileStatus(e),this._sortTiles(e);const t=!this.view.state.fixedContentCamera;this._mergeAndSplit(e,t),e.run(()=>this._updateElevation(e)),e.run(()=>this._updateTextures(e)),t||this._mergeAndSplit(e,!0),this._inFrameTask=!1,this._runViewChangeUpdateIfDirty(),e.done?this.requestUpdate():this._usedMemory=this._recalculateUsedMemory(),this.notifyChange("updatingProgressValue")}_updateTileStatus(e){if(!this._viewChanged||!this.rootTiles||e.done)return;this._viewChanged=!1;const t=this._iteratorPool.acquire();for(t.reset(this.rootTiles);!t.done;){const r=t.next();if(r.loadable){const i=r.shouldSplit(this._splitLimits,this._eyePosRenderSR,this.lodSnapping);if(i===wt.SPLIT){r.resetPendingUpdate(wt.MERGE),r.isLeaf&&(r.setPendingUpdate(wt.SPLIT),t.skipSubtree());continue}r.resetPendingUpdate(wt.SPLIT)&&r.updateAgentSuspension(),i===wt.VSPLITMERGE&&r.updateAgents(er.ELEVATION)}if(t.skipSubtree(),!r.isLeaf){r.setPendingUpdate(wt.MERGE),r.resetPendingUpdate(wt.SPLIT);const i=this._iteratorPool.acquire();i.resetOne(r);for(let n=i.next();!i.done;n=i.next())this._updateClippingStatus(n),n.updateVisibility(),n.loadable&&n.updateScreenDepth(this._viewProjectionMatrix);i.remove()}}t.remove(),this.requestUpdate(),e.madeProgress()}_sortTiles(e){e.done||this._allTilesSorted||(ySt(this._allTiles,this.view.pointsOfInterest.focus.renderLocation),this._allTilesSorted=!0,this._treeDebugger&&this._treeDebugger.update(),e.madeProgress())}_prepareBatchTileGeometryUpdate(){this.neighborTilesToUpdate.size,this.deferTileNeighborUpdate=!0}_batchUpdateUpdatedTileNeighbors(){this.deferTileNeighborUpdate=!1;const e=this.neighborTilesToUpdate;(()=>{const t=()=>{for(const r of e)r.updateNeighborsWithChangedEdgeResolution()};(()=>{for(const r of e)r.updateNeighborDataAndGeometryIfNeeded()})(),t(),e.clear()})()}_mergeAndSplit(e,t){if(this.suspended||e.done||!this._allTilesDirty)return;this._allTilesDirty=!1,this.requestUpdate(),this._prepareBatchTileGeometryUpdate();let r=!1;for(;!e.done;){r=!0;let i=!1;const n=!this._allTiles.some(s=>{if(s.resetPendingUpdate(wt.MERGE)){if(!t)return s.setPendingUpdate(wt.MERGE),e.done;this._mergeTile(s),i=!0,e.madeProgress()}else s.resetPendingUpdate(wt.SPLIT)&&(this._splitTile(s),i=!0,e.madeProgress());return!e.done&&s.resetPendingUpdate(wt.RENDERDATA)&&(this._updateRenderData(s),e.madeProgress()),e.done});if(i&&(this._allTilesSorted=!1,this._allTilesDirty=!0),n){if(!i)break;this._updateTilesVisibility(this.rootTiles)}else this._allTilesDirty=!0}r||(this._allTilesDirty=!0),this._batchUpdateUpdatedTileNeighbors(),this._sortTiles(e)}_updateElevation(e){return this._prepareBatchTileGeometryUpdate(),this._allTiles.some(t=>(t.resetPendingUpdate(wt.GEOMETRY)&&(this._updateTileGeometry(t),this._updateTileTexture(t,e),e.madeProgress()),e.done)),this._batchUpdateUpdatedTileNeighbors(),e.hasProgressed}_updateTextures(e){return this._allTiles.some(t=>(this._updateTileTexture(t,e),e.done)),e.hasProgressed}_updateClippingExtent(){this.spatialReference&&(this.updateTileOverlayParams(Xn.UPDATE),this.overlayManager.setPlacementDirty(),this._updateRootTiles())}get lodBias(){const e=this.view.resourceController.memoryController.memoryFactor;return this.view.qualitySettings.tiledSurface.lodBias-(1-e)*hat}_getLodBiasCorrectedScale(e){const t=this.tilingScheme.levels,r=Le(e-this.lodBias,0,t.length-1),i=r-Math.floor(r);return t[Math.floor(r)].scale*(1-i)+t[Math.ceil(r)].scale*i}_removeAllTiles(){_(this.rootTiles)&&(this.rootTiles.forEach(e=>this._purgeTile(e,!1)),this._setRootTiles(null),this.notifyChange("ready")),this._allTiles.clear(),this.visible=!1}_purgeDescendantTiles(e){if(e.isLeaf)return!1;let t=!1;for(let r=0;r<4;++r)t=this._purgeTile(e.children[r],!1)||t;return e.unsetChildren(),t}_purgeTile(e,t){const r=this._purgeDescendantTiles(e)||e.rendered;return this._allTiles.removeUnordered(e),this._unloadTile(e),t&&this._updateTileNeighborsAfterGeometryChange(e),this._tilePool.release(e),r}_unloadTile(e){this.deferTileNeighborUpdate&&this.neighborTilesToUpdate.delete(e),e.unload(this._renderer)}_splitTile(e){V0(e.isLeaf,"tile that is already split should not be split again!");const t=e.level+1,r=2*e.lij[1],i=2*e.lij[2];e.setChildren(this._createTile(t,r,i,e),this._createTile(t,r,i+1,e),this._createTile(t,r+1,i,e),this._createTile(t,r+1,i+1,e)),e.setPendingUpdate(wt.RENDERDATA),e.updateAgentSuspension(),this._allTiles.pushArray(e.children),this._allTilesDirty=!0,this._emitTileScaleChange(e,t),++this._performanceInfo.numSplit}_emitTileScaleChange(e,t=e.level){ZI.spatialReference=this.spatialReference,ZI.extent=e.extent,ZI.scale=this._getLodBiasCorrectedScale(t),this.emit("scale-change",ZI)}_createTile(e,t,r,i){V0(!!i,"_createTile sanity check");const n=this._acquireTile(e,t,r,i);return n.updateClippingStatus(this.extent),n.loadable&&(n.updateScreenDepth(this._viewProjectionMatrix),n.shouldSplit(this._splitLimits,this._eyePosRenderSR,this.lodSnapping)===wt.SPLIT&&n.setPendingUpdate(wt.SPLIT)),n}_mergeTile(e){V0(!e.hasPendingUpdate(wt.SPLIT),"_mergeTile sanity check"),this._purgeDescendantTiles(e)&&(V0(!e.renderData,"_mergeTile sanity check"),this._loadTile(e),this._updateTileNeighborsAfterGeometryChange(e),this.deferTileNeighborUpdate||this._checkTileAndNeighborsWaterproofness(e)),this._allTilesDirty=!0,++this._performanceInfo.numMerged,this._emitTileScaleChange(e)}_checkTileAndNeighborsWaterproofness(e){e.checkGeometryWaterproofness(),this._checkTileNeighborsWaterproofness(e)}_checkTileNeighborsWaterproofness(e){}_loadChildren(e){this.deferTileNeighborUpdate||this._checkTileAndNeighborsWaterproofness(e),V0(e.rendered,"parent should be rendered"),this._unloadTile(e);const t=e.children;t.forEach(r=>this._prepareToLoadTile(r)),t.forEach(r=>this._loadTilePrepared(r)),this._updateTileNeighborsAfterGeometryChange(e,e.level+1),this.deferTileNeighborUpdate||(t.forEach(r=>r.updateNeighborsWithChangedEdgeResolution()),t.forEach(r=>r.checkGeometryWaterproofness()),this._checkTileNeighborsWaterproofness(e))}_loadParent(e){this.deferTileNeighborUpdate||this._checkTileAndNeighborsWaterproofness(e);const t=e.parent;this._unloadChildren(t),this._loadTile(t),this._updateTileNeighborsAfterGeometryChange(t),this.deferTileNeighborUpdate||this._checkTileAndNeighborsWaterproofness(t)}_unloadChildren(e){if(!e.isLeaf)for(let t=0;t<4;++t){const r=e.children[t];this._unloadChildren(r),this._unloadTile(r)}}_postLoadTile(e){e.setPendingUpdate(wt.RENDERDATA),this.requestUpdate(),this._allTilesDirty=!0,this.overlayManager&&this.overlayManager.hasOverlays&&this.overlayManager.setTileParameters(e),this._elevationUpdate(e)}_loadTile(e){e.load(this._renderer),this._postLoadTile(e)}_loadTilePrepared(e){e.loadPrepared(this._renderer),this._postLoadTile(e)}_prepareToLoadTile(e){e.prepareToLoad(this._renderer)}_elevationDataArrived(e,t,r){const i=new iSt(e.lij,e.extent,r);e.dataArrived(t,er.ELEVATION,i);const n=[e],s=e.level,a=this._iteratorPool.acquire();for(a.reset(n);!a.done;){const o=a.next();o.findElevationBoundsForLayer(t,s),o.computeElevationBounds()}a.remove(),this._updateTilesVisibility(n)}_handleLayerViewChanges(e=y6){if(!this._layerViewsDirty)return;this._layerViewsDirty=!1;let t=!1;const r=new Set;let i=-1;for(const n of this.view.allLayerViews.items)if(r.add(n.uid),wR(n))if(this._basemapLayerViewHandles.has(n.uid)){const s=this._layerClassFromLayerView(n),a=this._getLayerIdxByUID(s,n.uid);_(a)&&((a<i||R(i))&&(t=!0),i=a)}else this._registerTiledLayerView(n),n.layer.loaded&&(t=!0);this._basemapLayerViewHandles.forEach((n,s)=>{r.has(s)||(this._unregisterTiledLayerView(s),t=!0)}),t&&this._updateTiledLayers(),this._renderer.isTransparent=this._allSurfaceLayersTransparent(),this.hasCompositeBlendMode=this._hasCompositeBlendMode(),e.madeProgress()}_allSurfaceLayersTransparent(){var t,r;let e=((r=(t=this.view.map)==null?void 0:t.ground)==null?void 0:r.opacity)===0;for(const i of this.view.allLayerViews.items)if(SK(i)&&!nwe(i.layer)&&i.fullOpacity!==0)return e=!1,e;return e}_hasCompositeBlendMode(){for(const e of this.view.allLayerViews.items)if(Ak(e)){const t=ZOe(e.layer.parent)?"normal":e.layer.blendMode;if(wSt(xD[t]))return!0}return!1}_layerClassFromLayerView(e){return TK(e)?er.ELEVATION:er.MAP}_registerTiledLayerView(e){const t=[],r=this._layerClassFromLayerView(e);t.push(re(()=>e.suspended,()=>this._updateTiledLayers())),t.push(re(()=>e.fullOpacity,()=>this._updateTileTextures(sa.UNFADED))),t.push(re(()=>"effectiveScaleRange"in e.layer?e.layer.effectiveScaleRange:null,()=>this._restartAllAgents(r))),Ak(e)&&t.push(re(()=>e.layer.blendMode,()=>{this.hasCompositeBlendMode=this._hasCompositeBlendMode(),this._updateTileTextures(sa.UNFADED)})),e.on("data-changed",()=>{const i=this._getLayerIdxByUID(r,e.uid);_(i)&&this._invalidateLayerData(i,r)}),this._basemapLayerViewHandles.set(e.uid,t)}_unregisterTiledLayerView(e){const t=this._basemapLayerViewHandles.get(e);if(t){for(let r=0;r<t.length;r++)t[r].remove();this._basemapLayerViewHandles.delete(e)}}_updateTiledLayers(){if(!this.tilingScheme||this.view.suspended)return;const e=this.view.allLayerViews,t=[[],[]];let r=null;e.forEach(i=>{if(!i.layer||i.suspended||!wR(i)||!i.fullExtent)return;const n=this._layerClassFromLayerView(i);if(n===er.MAP){const s=i.displayLevelRange.maxLevel;s!==1/0&&(r===null||s>r)&&(r=s)}t[n].push(i)});for(const i of t3){const n=this._layerViews[i],s=t[i];s.reverse();const a=s.length;let o=n.length!==a;const l=new Array(a),c=new Array(n.length);this._layerIndexByUid[i].clear();for(let u=0;u<a;u++){const h=s[u].uid;this._layerIndexByUid[i].set(h,u);const p=n.indexOf(s[u]);l[u]=p,u!==p&&(o=!0),p>-1&&(c[p]=u)}if(o){const u=this._postorderIterator;for(u.reset(this.rootTiles);!u.done;)u.next().modifyLayers(c,l,i);this._layerViews[i]=s,this._restartAllAgents(i),this._updateTilesVisibility(this.rootTiles)}}this.tilingScheme.ensureMaxLod(r)&&this._viewChangeUpdate()}_restartAllAgents(e){const t=this._postorderIterator;for(t.reset(this.rootTiles);!t.done;){const r=t.next();r.restartAgents(e),e===er.ELEVATION&&r.computeElevationBounds()}}layerViewByIndex(e,t){return this._layerViews[t][e]}numLayers(e){return this._layerViews[e].length}_updateTileTextures(e){this._allTiles.forAll(t=>{t.updateAgents(er.MAP),e===sa.IMMEDIATE?this.renderer.updateTileTexture(t,wt.TEXTURE_NOFADING):t.updateRenderData(er.MAP,e)}),this._renderer.isTransparent=this._allSurfaceLayersTransparent()}_invalidateLayerData(e,t){this._allTiles.forAll(r=>r.removeLayerAgent(e,t)),this._allTiles.forAll(r=>r.invalidateLayerData(e,t))}setTileTreeDirty(){this._allTilesDirty=!0}requestRender(e=Xn.UPDATE){this.renderer.setNeedsRender(e)}requestUpdate(){++this._pendingUpdates==1&&(this._hasPendingUpdates=!0)}requestTileData(e,t,r,i){const n=this.layerViewByIndex(t,r),s=n.layer;return!s.tilemapCache||_R(n)?this._requestTileData(e,r,n,i):(++this._asyncWorkItems,s.tilemapCache.fetchAvailability(e.lij[0],e.lij[1],e.lij[2],{...i,timeout:6e3}).then(()=>--this._asyncWorkItems).catch(a=>{throw--this._asyncWorkItems,Ui(a)||this._dataMissing(e,r,n,{notInTilemap:!0}),a}).then(()=>this._frameTask.schedule(()=>this._requestTileData(e,r,n,i),i.signal)))}_requestTileData(e,t,r,i){return t===er.ELEVATION?TK(r)?this._requestElevationTileData(e,r,i):Promise.reject():SK(r)?this._requestMapTileData(e,r,i):Promise.reject()}_requestElevationTileData(e,t,r){++this._asyncWorkItems;const i=a=>{if(bs(r))return;const o=this._layerIndexByUid[er.ELEVATION].get(t.uid);o!=null?(this._usedMemory=null,this.requestUpdate(),this._elevationDataArrived(e,o,a)):vf.warn("TerrainSurface: received data from unknown layer %d %s",er.ELEVATION,e.lij.toString())},n=a=>{Ui(a)||(this._dataMissing(e,er.ELEVATION,t,a),this.requestUpdate())};if(lye(t.layer))return t.layer.fetchTile(e.lij[0],e.lij[1],e.lij[2],{noDataValue:IA,signal:r.signal}).then(a=>{if(!bs(r))return this._frameTask.schedule(()=>i(a),r.signal,n);vf.warnOnce("A call to fetchTile resolved even though the request was aborted. fetchTile should not resolve if options.signal.aborted is true.")},n).finally(()=>{--this._asyncWorkItems});const s=t.getTileUrl(e.lij[0],e.lij[1],e.lij[2]);return this._elevationDataRequester.request(s,"binary",r).then(a=>this._lercDecoder.decode(a,{noDataValue:IA},r.signal)).then(a=>{a?i({values:a.pixelData,width:a.width,height:a.height,noDataValue:a.noDataValue,minValue:a.minValue,maxValue:a.maxValue}):n(new Error("LERC decoding failed"))},n).finally(()=>{--this._asyncWorkItems})}_requestMapTileData(e,t,r){++this._asyncWorkItems;const i=(c,u)=>{--this._asyncWorkItems,a5(u),bs(r)||(this._dataMissing(e,er.MAP,t,c),this.requestUpdate())},n=c=>u=>i(u,c),s=c=>this._frameTask.schedule(()=>{--this._asyncWorkItems,this.requestUpdate(),bs(r)?a5(c):this._mapTileDataArrived(e,t,c)},r.signal,n(c)).catch(n(c)),a=(c,u=null)=>this._frameTask.schedule(()=>i(c,u));if(_R(t)){const c=t.schemaHelper.getLevelRowColumn(e.lij);return t.fetchTile(c[0],c[1],c[2],r).then(s,a)}if(FU(t))return t.fetchTile(e.lij[0],e.lij[1],e.lij[2],r).then(s,a);if(zae(t)&&lye(t.layer))return t.layer.fetchTile(e.lij[0],e.lij[1],e.lij[2],r).then(c=>{if(bs(r))return vf.warnOnce("A call to fetchTile resolved even though the request was aborted. fetchTile should not resolve if options.signal.aborted is true."),void a(br());s(c)},a);let o=t.getTileUrl(e.lij[0],e.lij[1],e.lij[2]);bit(t.layer)&&t.layer.refreshTimestamp&&(o+=`${o.includes("?")?"&":"?"}_ts=${t.layer.refreshTimestamp}`);const l=t.hasMixedImageFormats?"image+type":"image";return this._mapDataRequester.request(o,l,r).then(s,a)}_mapTileDataArrived(e,t,r){const i=this._getLayerIdxByUID(er.MAP,t.uid);_(i)?e.dataArrived(i,er.MAP,r):(a5(r),vf.warn("TerrainSurface: received data from unknown layer"))}_getLayerIdxByUID(e,t){return this._layerIndexByUid[e].get(t)}_dataMissing(e,t,r,i){const n=this._getLayerIdxByUID(t,r.uid);_(n)?e.dataMissing(n,t,i):vf.warn("TerrainSurface: received data from unknown layer")}updateTileOverlayParams(e){this.rootTiles&&this.overlayManager&&(this._allTiles.forAll(t=>{t.renderData&&this.overlayManager.setTileParameters(t)}),this._renderer.setNeedsRender(e))}get performanceInfo(){const e=this._performanceInfo;return e.numNodes=this._allTiles.length,e.numLeaves=e.numVisible=e.numRendered=e.numLoadedPerLevel.length=e.numRenderedPerLevel.length=0,this._allTiles.forAll(t=>{t.isLeaf&&e.numLeaves++;const r=t.level;t.renderData&&(e.numLoadedPerLevel[r]=(e.numLoadedPerLevel[r]||0)+1),t.visible&&(e.numVisible++,t.rendered&&(e.numRenderedPerLevel[r]=(e.numRenderedPerLevel[r]||0)+1,e.numRendered++))}),e}getUsedMemory(){return this.tilingScheme?(R(this._usedMemory)&&(this._usedMemory=this._recalculateUsedMemory()),_(this._usedMemory)?this._usedMemory:0):0}_recalculateUsedMemory(){return this.tilingScheme?this._allTiles.reduce((e,t)=>e+t.usedMemory,0):null}getUsedMemoryForLayerView(e){let t=0;const r=this._layerClassFromLayerView(e),i=this._getLayerIdxByUID(r,e.uid);return _(i)&&this._allTiles.forAll(n=>t+=n.getUsedMemoryForLayer(r,i)),t}getTile(e){if(R(e)||R(this.rootTiles))return null;const t=e.split("/").map(a=>+a);if(t[0]===0)return this.rootTiles.find(a=>a.lij[1]===t[1]&&a.lij[2]===t[2]);const r=2**t[0],i=Math.floor(t[1]/r),n=Math.floor(t[2]/r);let s;if(this.rootTiles.some(a=>a.lij[1]===i&&a.lij[2]===n&&(s=a,!0)),s){let a=1<<t[0]-1;for(;s.lij[0]<t[0];){let o=t[1]&a?2:0;if((t[2]&a)>0&&o++,!s.children[o])return null;s=s.children[o],a>>=1}return V0(s.lij[0]===t[0]&&s.lij[1]===t[1]&&s.lij[2]===t[2],"not the right tile?"),s}return null}get test(){const e=this;return{renderer:e._renderer,lercDecoder:e._lercDecoder,forceReload:()=>{_(e.rootTiles)&&(e._mergeTile(e.rootTiles[0]),e._viewChangeUpdate())},getTiles:()=>e._allTiles.toArray(),getRenderedTiles(){vH.clear(),e._allTiles.forAll(r=>{r.visible&&r.rendered&&vH.push(r)});const t=vH.toArray();return oMe(e.renderOrder,t),t},lockTilingScheme(t,r){e._extentHelper.defaultTiledLayersExtent=r,e.tilingSchemeLogic.test.lockTilingScheme(t)}}}checkAllTileWaterproofness(){}get isGlobal(){return this._isGlobal}get shadingEnabled(){return this._renderer.shadingEnabled}get isWebMercator(){var e;return!!((e=this.tilingScheme)!=null&&e.spatialReference.isWebMercator)}get isWebMercatorOnPlateeCarree(){var e;return this.isWebMercator&&aA((e=this.view)==null?void 0:e.renderSpatialReference)}isEastEndWrap(e){return this.isGlobal&&e[2]===this.lijEastEnd(e[0])-1}isWestEndWrap(e){return this.isGlobal&&e[2]===0}lijEastEnd(e){return 2**(e+(this.spatialReference.isGeographic?1:0))}wrapEastWest(e){const t=this.lijEastEnd(e[0]),r=e[2];if(0<=r&&r<t)return e;if(!this.isGlobal)return null;const i=(r+(r<0?t:0))%t;return[e[0],e[1],i]}};d([f()],lr.prototype,"_renderer",void 0),d([f()],lr.prototype,"_hasPendingUpdates",void 0),d([f()],lr.prototype,"_asyncWorkItems",void 0),d([f()],lr.prototype,"_allTilesDirty",void 0),d([f()],lr.prototype,"_allTilesSorted",void 0),d([f()],lr.prototype,"_viewChanged",void 0),d([f({readOnly:!0})],lr.prototype,"_watchUpdatingTracking",void 0),d([f()],lr.prototype,"_frameTask",void 0),d([f({readOnly:!0})],lr.prototype,"snapLevel",null),d([f({readOnly:!0})],lr.prototype,"lodSnapping",null),d([f({constructOnly:!0})],lr.prototype,"view",void 0),d([f()],lr.prototype,"_userClippingExtent",null),d([f()],lr.prototype,"_rootTilesExtent",void 0),d([f({readOnly:!0})],lr.prototype,"extent",null),d([f({readOnly:!0})],lr.prototype,"groundExtent",null),d([f({readOnly:!0})],lr.prototype,"_tilingSchemeExtent",null),d([f({readOnly:!0})],lr.prototype,"updating",null),d([f(rSt)],lr.prototype,"updatingProgress",void 0),d([f({readOnly:!0})],lr.prototype,"updatingProgressValue",null),d([f()],lr.prototype,"_maxNumUpdating",void 0),d([f({aliasOf:"view.map.ground.opacity"})],lr.prototype,"baseOpacity",void 0),d([f()],lr.prototype,"hasCompositeBlendMode",void 0),d([f({readOnly:!0})],lr.prototype,"overlayManager",void 0),d([f({readOnly:!0})],lr.prototype,"viewingMode",null),d([f()],lr.prototype,"maxTextureScale",void 0),d([f({readOnly:!0})],lr.prototype,"ready",null),d([f({value:SR.FRONT_TO_BACK})],lr.prototype,"renderOrder",null),d([f({readOnly:!0})],lr.prototype,"rootTiles",void 0),d([f({readOnly:!0})],lr.prototype,"spatialReference",null),d([f({type:Te,aliasOf:"view.map.ground.surfaceColor"})],lr.prototype,"backgroundColor",void 0),d([f({value:!1})],lr.prototype,"slicePlaneEnabled",null),d([f({readOnly:!0})],lr.prototype,"tilingScheme",void 0),d([f({readOnly:!0,aliasOf:"tilingSchemeLogic.tilingSchemeLocked"})],lr.prototype,"tilingSchemeLocked",void 0),d([f({readOnly:!0})],lr.prototype,"tilingSchemeLogic",void 0),d([f({value:!0})],lr.prototype,"velvetOverground",null),d([We("_renderer.wireframe")],lr.prototype,"wireframe",void 0),d([f({value:!1})],lr.prototype,"suspended",null),d([f({readOnly:!0,aliasOf:"view.qualitySettings.tiledSurface.textureFadeDuration"})],lr.prototype,"textureFadeDuration",void 0),d([f()],lr.prototype,"_layerViewsDirty",void 0),d([We("_renderer.renderPatchBorders")],lr.prototype,"renderPatchBorders",void 0),d([We("_renderer.renderingDisabled")],lr.prototype,"renderingDisabled",void 0),lr=d([$("esri.views.3d.terrain.TerrainSurface")],lr);const S5t=lr;function kye(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]}function IMe(e){return!e.isLeaf&&(e.children.some(t=>t.shouldLoad)||e.children.some(t=>IMe(t)))}function E5t(e){return e.isLeaf&&e.parent&&e.parent.shouldLoad}const qa=Jt(),C5t=zt(),XI=[0,0,0],vH=new Qt,YI={spatialReference:null,tile:null,extent:null,context:"ground"},ZI={spatialReference:null,extent:null,scale:0};let fC=class extends xe{constructor(e){super(e),this._residentGeomRecords=new Map,this._dirtyGeomRecords=new Map,this.dirty=!1}commit(e){this.dirty=!1,this._dirtyGeomRecords.forEach((t,r)=>this.commitLayer(r,e))}commitLayer(e,t){const r=this._dirtyGeomRecords.get(e);r&&(r.forEach((i,n)=>{const s=this._ensureGeomRecord(e,n);i.forEach((a,o)=>{const l=a[0],c=a[1],u=a[2];let h=!1;if(c&sr.Geometry.UPDATE){const p=s.get(o);if(p){const m=p[1];if(u&sr.State.TRANSFORMATION){const g=this.model.getObject(n);this.model.updateRenderGeometryTransformation(g,l,m)&&(h=!0)}h||t.updates.push({renderGeometry:m,updateType:u})}else pt(!1,"ModelDirtySet.getAddRemoveListFilteredByLayers: invalid update")}if(c&sr.Geometry.REMOVE||h){const p=s.get(o);p?(t.removes.push(p[1]),s.delete(o),p[0].disposed&&nx.pool.release(p[0])):c===sr.Geometry.REMOVE&&pt(!1,"ModelDirtySet.getAddRemoveListFilteredByLayers: invalid remove")}if(c&sr.Geometry.ADD||h){const p=this.model.getObject(n);if(_(p)){const m=this.model.getRenderGeometry(p,l),g=[l,m];t.adds.push(m),s.set(o,g)}}}),s.size===0&&this._residentGeomRecords.get(e).delete(n)}),this._residentGeomRecords.get(e).size===0&&this._residentGeomRecords.delete(e),this._dirtyGeomRecords.delete(e))}getResidentRenderGeometries(e,t){const r=this._residentGeomRecords.get(e);r&&r.forEach(i=>i.forEach(n=>t.push(n[1])))}_objectStateChanged(e,t){for(const r of t.geometryRecords)this._updateOrCreateDirtyRecord(t,r,null,sr.Geometry.UPDATE,0,0,sr.Geometry.UPDATE,sr.Geometry.ADD|sr.Geometry.REMOVE,e)}visibilityChanged(e){this._objectStateChanged(sr.State.VISIBILITIES,e)}highlightChanged(e){this._objectStateChanged(sr.State.HIGHLIGHTS,e)}occlusionChanged(e){this._objectStateChanged(sr.State.OCCLUDEES,e)}vertexAttrsUpdated(e){this._updateOrCreateDirtyRecord(e.object,e.record,null,sr.Geometry.UPDATE,0,0,sr.Geometry.UPDATE,sr.Geometry.ADD|sr.Geometry.REMOVE,sr.State.VERTEXATTRS)}layerAdded(e){e.objects.forAll(t=>this._layerObjectAdded(e,t))}layerRemoved(e){e.objects.forAll(t=>this._layerObjectRemoved(e,t))}layerObjectAdded(e){this._layerObjectAdded(e.layer,e.object)}_layerObjectAdded(e,t){const r=e.id;for(const i of t.geometryRecords)this._objectGeometryAdded(t,i,r)}layerObjectRemoved(e){this._layerObjectRemoved(e.layer,e.object)}layerObjectsAdded(e){for(const t of e.objects)this._layerObjectAdded(e.layer,t)}layerObjectsRemoved(e){for(const t of e.objects)this._layerObjectRemoved(e.layer,t)}_layerObjectRemoved(e,t){const r=e.id;for(const i of t.geometryRecords)this._objectGeometryRemoved(t,i,r)}shaderTransformationChanged(e){const t=this._residentGeomRecords.get(e.id);t&&t.forEach((r,i)=>{const n=this.model.getObject(i);n&&n.hasVolativeTransformation()&&r.forEach(s=>{s[1].shaderTransformationChanged()})})}objectTransformation(e){const t=this._getParentLayerId(e),r=e.id;this._ensureGeomRecord(t,r).forEach(i=>{this._updateOrCreateDirtyRecord(e,i[0],t,sr.Geometry.UPDATE,0,0,sr.Geometry.UPDATE,sr.Geometry.ADD|sr.Geometry.REMOVE,sr.State.TRANSFORMATION)})}objectGeometryAdded(e){this._objectGeometryAdded(e.object,e.record)}_objectGeometryAdded(e,t,r=null){this._updateOrCreateDirtyRecord(e,t,r,sr.Geometry.ADD,sr.Geometry.REMOVE,0,0,0)}objectGeometryRemoved(e){this._objectGeometryRemoved(e.object,e.record)}_objectGeometryRemoved(e,t,r=null){this._updateOrCreateDirtyRecord(e,t,r,sr.Geometry.REMOVE,sr.Geometry.ADD,sr.Geometry.UPDATE,0,0)}_updateOrCreateDirtyRecord(e,t,r,i,n,s,a,o,l){r=vt(r,this._getParentLayerId(e));const c=e.id,u=t.id,h=this._ensureDirtyRecord(r,c),p=h.get(u);if(p){const m=p[1];m&n?(h.delete(u),p[0].disposed&&nx.pool.release(p[0])):m&s?(p[1]=i,p[2]=l):m&a?p[2]|=l:m&o||pt(!1,"ModelDirtySet.objectGeometryAdded: inconsistent state")}else h.set(u,[t,i,l]);this.dirty=this._hasDirtyGeometryRecords}_ensureGeomRecord(e,t){let r=this._residentGeomRecords.get(e);r||(r=new Map,this._residentGeomRecords.set(e,r));let i=r.get(t);return i||(i=new Map,r.set(t,i)),i}get _hasDirtyGeometryRecords(){return vs(this._dirtyGeomRecords,e=>vs(e,t=>t&&t.size>0))}_ensureDirtyRecord(e,t){let r=this._dirtyGeomRecords.get(e);r||(r=new Map,this._dirtyGeomRecords.set(e,r));let i=r.get(t);return i||(i=new Map,r.set(t,i)),i}_getParentLayerId(e){return _(e.parentLayer)?e.parentLayer.id:VFe}formatDebugInfo(){const e=["ADD","UPD",void 0,"REM"];let t="";return this._dirtyGeomRecords.forEach((r,i)=>{r.forEach((n,s)=>{t.length>0&&(t+=`
`),t+=i+"."+s;const a=[];n.forEach(o=>{const l=o[1];a[l]||(a[l]=[]),a[l].push(o[0].geometry.id)});for(let o=0;o<a.length;o++)if(a[o]){t+=" "+e[o-1]+": ";for(let l=0;l<a[o].length;l++)t+=a[o][l]+", "}})}),t}get test(){const e=this;return{get residentLayerCount(){return e._residentGeomRecords.size},get residentObjectCount(){return Array.from(e._residentGeomRecords.values()).reduce((t,r)=>t+r.size,0)}}}};d([f({constructOnly:!0})],fC.prototype,"model",void 0),d([f()],fC.prototype,"dirty",void 0),fC=d([$("esri.views.3d.webgl-engine.lib.ModelDirtySet")],fC);const A5t=fC;let AD=class extends xe{constructor(){super(...arguments),this.dirtySet=new A5t({model:this}),this._content=new Map,this._originFactory=new yae(null,75e4)}getObject(e){return this._content.get(e)}add(e){const t=e.id;pt(!this._content.has(t),"Model/Stage already contains object to be added"),this._content.set(t,e),uk(e)&&this.dirtySet.layerAdded(e)}remove(e){pt(this._content.has(e.id),"Model/Stage doesn't contain object to be removed"),this._content.delete(e.id),e.unload(),uk(e)&&this.dirtySet.layerRemoved(e)}addMany(e){for(const t of e)_(t)&&(pt(!this._content.has(t.id),"Model/Stage already contains object to be added"),this._content.set(t.id,t))}removeMany(e){for(const t of e)pt(this._content.has(t.id),"Model/Stage doesn't contain object to be removed"),this._content.delete(t.id),t.unload()}has(e){return this._content.has(e.id)}forEachOfType(e,t){this._content.forEach(r=>{r.type===e&&t(r)})}getRenderGeometry(e,t){const{geometry:r,material:i,id:n,shaderTransformation:s,origin:a,instanceParameters:o}=t,l=new D9(r,i,{id:n,boundingInfo:r.boundingInfo,calculateShaderTransformation:s,castShadow:e.castShadow});return l.updateTransformation(c=>e.getCombinedStaticTransformation(t,c)),l.origin=a||this._originFactory.getOrigin(l.boundingSphere),l.instanceParameters=o,l}updateRenderGeometryTransformation(e,t,r){if(R(e))return!1;r.updateTransformation(n=>e.getCombinedStaticTransformation(t,n));const i=this._originFactory.getOrigin(r.boundingSphere);return r.origin!==i}getStats(){const e={},t=Array.from(this._content.values());for(let r=0;r<Np.COUNT;++r)e[r]=t.filter(i=>i.type===r).length;return{contentTypes:e,dirtySet:this.dirtySet.formatDebugInfo()}}get test(){return{content:Array.from(this._content.values())}}};d([f({constructOnly:!0})],AD.prototype,"dirtySet",void 0),AD=d([$("esri.views.3d.webgl-engine.parts.Model")],AD);function $Me(){const e=new Float32Array(4);return e[3]=1,e}function LMe(e){const t=new Float32Array(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function R5t(e,t,r,i){const n=new Float32Array(4);return n[0]=e,n[1]=t,n[2]=r,n[3]=i,n}function DMe(e,t){return new Float32Array(e,t,4)}Object.freeze(Object.defineProperty({__proto__:null,create:$Me,clone:LMe,fromValues:R5t,createView:DMe},Symbol.toStringTag,{value:"Module"}));const xn=!0,J3={identifierOffset:0,identifierLength:10,versionOffset:10,checksumOffset:12,byteCount:16};function eoe(e,t,r){return{identifier:String.fromCharCode.apply(null,new Uint8Array(e,r+J3.identifierOffset,J3.identifierLength)),version:t.getUint16(r+J3.versionOffset,xn),checksum:t.getUint32(r+J3.checksumOffset,xn)}}const Dc={sizeLo:0,sizeHi:4,minX:8,minY:16,minZ:24,maxX:32,maxY:40,maxZ:48,errorX:56,errorY:64,errorZ:72,count:80,reserved:84,byteCount:88};function O5t(e,t){return{sizeLo:e.getUint32(t+Dc.sizeLo,xn),sizeHi:e.getUint32(t+Dc.sizeHi,xn),minX:e.getFloat64(t+Dc.minX,xn),minY:e.getFloat64(t+Dc.minY,xn),minZ:e.getFloat64(t+Dc.minZ,xn),maxX:e.getFloat64(t+Dc.maxX,xn),maxY:e.getFloat64(t+Dc.maxY,xn),maxZ:e.getFloat64(t+Dc.maxZ,xn),errorX:e.getFloat64(t+Dc.errorX,xn),errorY:e.getFloat64(t+Dc.errorY,xn),errorZ:e.getFloat64(t+Dc.errorZ,xn),count:e.getUint32(t+Dc.count,xn),reserved:e.getUint32(t+Dc.reserved,xn)}}function lDt(e){const t=new DataView(e,0);let r=0;const{identifier:i,version:n}=eoe(e,t,r);if(r+=J3.byteCount,i!=="LEPCC     ")throw new k("lepcc-decode-error","Bad identifier");if(n>1)throw new k("lepcc-decode-error","Unknown version");const s=O5t(t,r);if(r+=Dc.byteCount,s.sizeHi*2**32+s.sizeLo!==e.byteLength)throw new k("lepcc-decode-error","Bad size");const a=new Float64Array(3*s.count),o=[],l=[],c=[],u=[];if(r=QI(e,r,o),r=QI(e,r,l),r=QI(e,r,c),r=QI(e,r,u),r!==e.byteLength)throw new k("lepcc-decode-error","Bad length");let h=0,p=0;for(let m=0;m<o.length;m++){p+=o[m];let g=0;for(let b=0;b<l[m];b++){g+=c[h];const w=u[h];a[3*h]=Math.min(s.maxX,s.minX+2*s.errorX*g),a[3*h+1]=Math.min(s.maxY,s.minY+2*s.errorY*p),a[3*h+2]=Math.min(s.maxZ,s.minZ+2*s.errorZ*w),h++}}return{errorX:s.errorX,errorY:s.errorY,errorZ:s.errorZ,result:a}}function QI(e,t,r){const i=[];t=OK(e,t,i);const n=[];for(let s=0;s<i.length;s++){n.length=0,t=OK(e,t,n);for(let a=0;a<n.length;a++)r.push(n[a]+i[s])}return t}function OK(e,t,r){const i=new DataView(e,t),n=i.getUint8(0),s=31&n,a=!!(32&n),o=(192&n)>>6;let l=0;if(o===0)l=i.getUint32(1,xn),t+=5;else if(o===1)l=i.getUint16(1,xn),t+=3;else{if(o!==2)throw new k("lepcc-decode-error","Bad count type");l=i.getUint8(1),t+=2}if(a)throw new k("lepcc-decode-error","LUT not implemented");const c=Math.ceil(l*s/8),u=new Uint8Array(e,t,c);let h=0,p=0,m=0;const g=-1>>>32-s;for(let b=0;b<l;b++){for(;p<s;)h|=u[m]<<p,p+=8,m+=1;r[b]=h&g,h>>>=s,p-=s,p+s>32&&(h|=u[m-1]>>8-p)}return t+m}const r3={sizeLo:0,sizeHi:4,count:8,colorMapCount:12,lookupMethod:14,compressionMethod:15,byteCount:16};function M5t(e,t){return{sizeLo:e.getUint32(t+r3.sizeLo,xn),sizeHi:e.getUint32(t+r3.sizeHi,xn),count:e.getUint32(t+r3.count,xn),colorMapCount:e.getUint16(t+r3.colorMapCount,xn),lookupMethod:e.getUint8(t+r3.lookupMethod),compressionMethod:e.getUint8(t+r3.compressionMethod)}}function P5t(e){const t=new DataView(e,0);let r=0;const{identifier:i,version:n}=eoe(e,t,r);if(r+=J3.byteCount,i!=="ClusterRGB")throw new k("lepcc-decode-error","Bad identifier");if(n>1)throw new k("lepcc-decode-error","Unknown version");const s=M5t(t,r);if(r+=r3.byteCount,s.sizeHi*2**32+s.sizeLo!==e.byteLength)throw new k("lepcc-decode-error","Bad size");if((s.lookupMethod===2||s.lookupMethod===1)&&s.compressionMethod===0){if(3*s.colorMapCount+s.count+r!==e.byteLength||s.colorMapCount>256)throw new k("lepcc-decode-error","Bad count");const a=new Uint8Array(e,r,3*s.colorMapCount),o=new Uint8Array(e,r+3*s.colorMapCount,s.count),l=new Uint8Array(3*s.count);for(let c=0;c<s.count;c++){const u=o[c];l[3*c]=a[3*u],l[3*c+1]=a[3*u+1],l[3*c+2]=a[3*u+2]}return l}if(s.lookupMethod===0&&s.compressionMethod===0){if(3*s.count+r!==e.byteLength||s.colorMapCount!==0)throw new k("lepcc-decode-error","Bad count");return new Uint8Array(e,r).slice()}if(s.lookupMethod<=2&&s.compressionMethod===1){if(r+3!==e.byteLength||s.colorMapCount!==1)throw new k("lepcc-decode-error","Bad count");const a=t.getUint8(r),o=t.getUint8(r+1),l=t.getUint8(r+2),c=new Uint8Array(3*s.count);for(let u=0;u<s.count;u++)c[3*u]=a,c[3*u+1]=o,c[3*u+2]=l;return c}throw new k("lepcc-decode-error","Bad method "+s.lookupMethod+","+s.compressionMethod)}const i3={sizeLo:0,sizeHi:4,count:8,scaleFactor:12,bitsPerPoint:14,reserved:15,byteCount:16};function I5t(e,t){return{sizeLo:e.getUint32(t+i3.sizeLo,xn),sizeHi:e.getUint32(t+i3.sizeHi,xn),count:e.getUint32(t+i3.count,xn),scaleFactor:e.getUint16(t+i3.scaleFactor,xn),bitsPerPoint:e.getUint8(t+i3.bitsPerPoint),reserved:e.getUint8(t+i3.reserved)}}function $5t(e){const t=new DataView(e,0);let r=0;const{identifier:i,version:n}=eoe(e,t,r);if(r+=J3.byteCount,i!=="Intensity ")throw new k("lepcc-decode-error","Bad identifier");if(n>1)throw new k("lepcc-decode-error","Unknown version");const s=I5t(t,r);if(r+=i3.byteCount,s.sizeHi*2**32+s.sizeLo!==e.byteLength)throw new k("lepcc-decode-error","Bad size");const a=new Uint16Array(s.count);if(s.bitsPerPoint===8){if(s.count+r!==e.byteLength)throw new k("lepcc-decode-error","Bad size");const o=new Uint8Array(e,r,s.count);for(let l=0;l<s.count;l++)a[l]=o[l]*s.scaleFactor}else if(s.bitsPerPoint===16){if(2*s.count+r!==e.byteLength)throw new k("lepcc-decode-error","Bad size");const o=new Uint16Array(e,r,s.count);for(let l=0;l<s.count;l++)a[l]=o[l]*s.scaleFactor}else{const o=[];if(OK(e,r,o)!==e.byteLength)throw new k("lepcc-decode-error","Bad size");for(let l=0;l<s.count;l++)a[l]=o[l]*s.scaleFactor}return a}const MK=fe.getLogger("esri.views.3d.layers.i3s.I3SBinaryReader");function L5t(e,t,r){let i="",n=0;for(;n<r;){const s=e[t+n];if(s<128)i+=String.fromCharCode(s),n++;else if(s>=192&&s<224){if(n+1>=r)throw new k("utf8-decode-error","UTF-8 Decode failed. Two byte character was truncated.");const a=(31&s)<<6|63&e[t+n+1];i+=String.fromCharCode(a),n+=2}else if(s>=224&&s<240){if(n+2>=r)throw new k("utf8-decode-error","UTF-8 Decode failed. Multi byte character was truncated.");const a=(15&s)<<12|(63&e[t+n+1])<<6|63&e[t+n+2];i+=String.fromCharCode(a),n+=3}else{if(!(s>=240&&s<248))throw new k("utf8-decode-error","UTF-8 Decode failed. Invalid multi byte sequence.");{if(n+3>=r)throw new k("utf8-decode-error","UTF-8 Decode failed. Multi byte character was truncated.");const a=(7&s)<<18|(63&e[t+n+1])<<12|(63&e[t+n+2])<<6|63&e[t+n+3];if(a>=65536){const o=55296+(a-65536>>10),l=56320+(1023&a);i+=String.fromCharCode(o,l)}else i+=String.fromCharCode(a);n+=4}}}return i}function FMe(e,t){const r={byteOffset:0,byteCount:0,fields:Object.create(null)};let i=0;for(let n=0;n<t.length;n++){const s=t[n],a=s.valueType||s.type,o=B5t[a];r.fields[s.property]=o(e,i),i+=jU[a].BYTES_PER_ELEMENT}return r.byteCount=i,r}function D5t(e,t,r){const i=[];let n,s,a=0;for(s=0;s<e;s+=1){if(n=t[s],n>0){if(i.push(L5t(r,a,n-1)),r[a+n-1]!==0)throw new k("string-array-error","Invalid string array: missing null termination.")}else i.push(null);a+=n}return i}function Vye(e,t){return new jU[t.valueType](e,t.byteOffset,t.count*t.valuesPerElement)}function F5t(e,t){return new Uint8Array(e,t.byteOffset,t.byteCount)}function N5t(e,t,r){const i=t.header!=null?FMe(e,t.header):{byteOffset:0,byteCount:0,fields:{count:r}},n={header:i,byteOffset:i.byteCount,byteCount:0,entries:Object.create(null)};let s=i.byteCount;for(let a=0;a<t.ordering.length;a++){const o=t.ordering[a],l=te(t[o]);if(l.count=i.fields.count,l.valueType==="String"){if(l.byteOffset=s,l.byteCount=i.fields[o+"ByteCount"],l.encoding!=="UTF-8")throw new k("unsupported-encoding","Unsupported String encoding.",{encoding:l.encoding})}else{if(!kMe(l.valueType))throw new k("unsupported-value-type","Unsupported binary valueType",{valueType:l.valueType});{const c=RD(l.valueType);s+=s%c!=0?c-s%c:0,l.byteOffset=s,l.byteCount=c*l.valuesPerElement*l.count}}s+=l.byteCount,n.entries[o]=l}return n.byteCount=s-n.byteOffset,n}function NMe(e,t,r){if(t!==e&&MK.error(`Invalid ${r} buffer size
 expected: ${e}, actual: ${t})`),t<e)throw new k("buffer-too-small","Binary buffer is too small",{expectedSize:e,actualSize:t})}function k5t(e){return{isDraco:!1,isLegacy:!1,color:e.color!=null,normal:e.normal!=null,uv0:e.uv0!=null,uvRegion:e.uvRegion!=null,featureIndex:e.faceRange!=null&&e.featureId!=null}}function cDt(e,t){const r=FMe(e,t&&t.header);let i=r.byteCount;const n={isDraco:!1,header:r,byteOffset:r.byteCount,byteCount:0,vertexAttributes:{}},s=r.fields,a=s.vertexCount!=null?s.vertexCount:s.count;for(const c of t.ordering){if(!t.vertexAttributes[c])continue;const u={...t.vertexAttributes[c],byteOffset:i,count:a},h=zye[c]?zye[c]:"_"+c;n.vertexAttributes[h]=u,i+=RD(u.valueType)*u.valuesPerElement*a}const o=s.faceCount;if(t.faces&&o){n.faces={};for(const c of t.ordering){if(!t.faces[c])continue;const u={...t.faces[c],byteOffset:i,count:o};n.faces[c]=u,i+=RD(u.valueType)*u.valuesPerElement*o}}const l=s.featureCount;if(t.featureAttributes&&t.featureAttributeOrder&&l){n.featureAttributes={};for(const c of t.featureAttributeOrder){if(!t.featureAttributes[c])continue;const u={...t.featureAttributes[c],byteOffset:i,count:l};n.featureAttributes[c]=u,i+=(u.valueType==="UInt64"?8:RD(u.valueType))*u.valuesPerElement*l}}return NMe(i,e.byteLength,"geometry"),n.byteCount=i-n.byteOffset,n}function dDt(e,t){return!e||!e.compressedAttributes||e.compressedAttributes.encoding!=="draco"?e?k5t(e):V5t(t):z5t(e.compressedAttributes.attributes)}function V5t(e){const t={isDraco:!1,isLegacy:!0,color:!1,normal:!1,uv0:!1,uvRegion:!1,featureIndex:!1};for(const r of e.ordering)if(e.vertexAttributes[r])switch(r){case"position":break;case"normal":t.normal=!0;break;case"color":t.color=!0;break;case"uv0":t.uv0=!0;break;case"region":t.uvRegion=!0}return e.featureAttributes&&e.featureAttributeOrder&&(t.featureIndex=!0),t}function z5t(e){const t={isDraco:!0,isLegacy:!1,color:!1,normal:!1,uv0:!1,uvRegion:!1,featureIndex:!1};for(const r of e)switch(r){case"position":break;case"normal":t.normal=!0;break;case"uv0":t.uv0=!0;break;case"color":t.color=!0;break;case"uv-region":t.uvRegion=!0;break;case"feature-index":t.featureIndex=!0}return t}const zye={position:O.POSITION,normal:O.NORMAL,color:O.COLOR,uv0:O.UV0,region:O.UVREGION};function U5t(e,t,r){if(e.encoding==="lepcc-rgb")return P5t(t);if(e.encoding==="lepcc-intensity")return $5t(t);if(e.encoding!=null&&e.encoding!=="")throw new k("unknown-attribute-storage-info-encoding","Unknown Attribute Storage Info Encoding");e["attributeByteCounts "]&&!e.attributeByteCounts&&(MK.warn("Warning: Trailing space in 'attributeByteCounts '."),e.attributeByteCounts=e["attributeByteCounts "]),e.ordering[0]==="ObjectIds"&&e.hasOwnProperty("objectIds")&&(MK.warn("Warning: Case error in objectIds"),e.ordering[0]="objectIds");const i=N5t(t,e,r);NMe(i.byteOffset+i.byteCount,t.byteLength,"attribute");const n=i.entries.attributeValues||i.entries.objectIds;if(n){if(n.valueType==="String"){const s=i.entries.attributeByteCounts,a=Vye(t,s),o=F5t(t,n);return D5t(s.count,a,o)}return Vye(t,n)}throw new k("bad-attribute-storage-info","Bad attributeStorageInfo specification.")}const jU={Float32:Float32Array,Float64:Float64Array,UInt8:Uint8Array,Int8:Int8Array,UInt16:Uint16Array,Int16:Int16Array,UInt32:Uint32Array,Int32:Int32Array},B5t={Float32:(e,t)=>new DataView(e,0).getFloat32(t,!0),Float64:(e,t)=>new DataView(e,0).getFloat64(t,!0),UInt8:(e,t)=>new DataView(e,0).getUint8(t),Int8:(e,t)=>new DataView(e,0).getInt8(t),UInt16:(e,t)=>new DataView(e,0).getUint16(t,!0),Int16:(e,t)=>new DataView(e,0).getInt16(t,!0),UInt32:(e,t)=>new DataView(e,0).getUint32(t,!0),Int32:(e,t)=>new DataView(e,0).getInt32(t,!0)};function kMe(e){return jU.hasOwnProperty(e)}function RD(e){return kMe(e)?jU[e].BYTES_PER_ELEMENT:0}function G5t(e,t,r,i){const n=j5t(e,t,r),s=Ae();return Au(r,n,s,i),s}const VMe=1,Uye=5-VMe;function j5t(e,t,r){const i=M(),n=e[3],s=2**(Math.ceil(Math.log(n)*Math.LOG2E/Uye)*Uye+VMe);if(r.isGeographic){const l=s/Ar(r).radius*180/Math.PI,c=Math.round(e[1]/l),u=Math.max(-90,Math.min(90,c*l)),h=l/Math.cos((Math.abs(u)-l/2)/180*Math.PI),p=Math.round(e[0]/h)*h;i[0]=p,i[1]=u}else{const l=Math.round(e[0]/s),c=Math.round(e[1]/s);i[0]=l*s,i[1]=c*s}const a=e[2]+t,o=Math.round(a/s);return i[2]=o*s,i}const V9=1e-6,k8=[0,0,0],JI=[0,0,0];function q5t(e,t){const{data:r,size:i}=e,n=r.length/i;if(n<=0)return;const s=new e9t(e);OD(k8,s.minProj,s.maxProj),P3(k8,k8,.5),Oh(JI,s.maxProj,s.minProj);const a=PK(JI),o=new t9t;o.quality=a,n<14&&(e={data:new Float64Array(s.buffer,112,42),size:3});const l=[0,0,0],c=[0,0,0],u=[0,0,0],h=[0,0,0],p=[0,0,0],m=[0,0,0],g=[0,0,0];switch(H5t(s,e,g,l,c,u,h,p,m,o)){case 1:return void qye(k8,JI,t);case 2:return void K5t(e,h,t)}W5t(e,g,l,c,u,h,p,m,o),zMe(e,o.b0,o.b1,o.b2,u5,h5);const b=[0,0,0];Oh(b,h5,u5),o.quality=PK(b),o.quality<a?UMe(o.b0,o.b1,o.b2,u5,h5,b,t):qye(k8,JI,t)}function H5t(e,t,r,i,n,s,a,o,l,c){return X5t(e,i,n),IK(i,n)<V9?1:(Oh(a,i,n),Qa(a,a),Y5t(t,i,a,s)<V9?2:(Oh(o,n,s),Qa(o,o),Oh(l,s,i),Qa(l,l),Mh(r,o,a),Qa(r,r),n3(t,r,a,o,l,c),0))}const V8=[0,0,0],z8=[0,0,0],Wu=[0,0,0],Xu=[0,0,0],Yu=[0,0,0],Lb=[0,0,0],Db=[0,0,0],Fb=[0,0,0];function W5t(e,t,r,i,n,s,a,o,l){Z5t(e,t,r,V8,z8),V8[0]!==void 0&&(Oh(Wu,V8,r),Qa(Wu,Wu),Oh(Xu,V8,i),Qa(Xu,Xu),Oh(Yu,V8,n),Qa(Yu,Yu),Mh(Lb,Xu,s),Qa(Lb,Lb),Mh(Db,Yu,a),Qa(Db,Db),Mh(Fb,Wu,o),Qa(Fb,Fb),n3(e,Lb,s,Xu,Wu,l),n3(e,Db,a,Yu,Xu,l),n3(e,Fb,o,Wu,Yu,l)),z8[0]!==void 0&&(Oh(Wu,z8,r),Qa(Wu,Wu),Oh(Xu,z8,i),Qa(Xu,Xu),Oh(Yu,z8,n),Qa(Yu,Yu),Mh(Lb,Xu,s),Qa(Lb,Lb),Mh(Db,Yu,a),Qa(Db,Db),Mh(Fb,Wu,o),Qa(Fb,Fb),n3(e,Lb,s,Xu,Wu,l),n3(e,Db,a,Yu,Xu,l),n3(e,Fb,o,Wu,Yu,l))}function X5t(e,t,r){let i=IK(e.maxVert[0],e.minVert[0]),n=0;for(let s=1;s<7;++s){const a=IK(e.maxVert[s],e.minVert[s]);a>i&&(i=a,n=s)}sd(t,e.minVert[n]),sd(r,e.maxVert[n])}const Zu=[0,0,0];function Y5t(e,t,r,i){const{data:n,size:s}=e;let a=Number.NEGATIVE_INFINITY,o=0;for(let l=0;l<n.length;l+=s){Zu[0]=n[l]-t[0],Zu[1]=n[l+1]-t[1],Zu[2]=n[l+2]-t[2];const c=r[0]*Zu[0]+r[1]*Zu[1]+r[2]*Zu[2],u=r[0]*r[0]+r[1]*r[1]+r[2]*r[2],h=Zu[0]*Zu[0]+Zu[1]*Zu[1]+Zu[2]*Zu[2]-c*c/u;h>a&&(a=h,o=l)}return sd(i,n,o),a}const Ls=[0,0];function Z5t(e,t,r,i,n){J5t(e,t,Ls,n,i);const s=GMe(r,t);Ls[1]-V9<=s&&(i[0]=void 0),Ls[0]+V9>=s&&(n[0]=void 0)}const Bye=[0,0,0],Gye=[0,0,0],jye=[0,0,0],OT=[0,0,0],MT=[0,0,0],KI=[0,0,0];function n3(e,t,r,i,n,s){if(BMe(t)<V9)return;Mh(Bye,r,t),Mh(Gye,i,t),Mh(jye,n,t),d5(e,t,Ls),MT[1]=Ls[0],OT[1]=Ls[1],KI[1]=OT[1]-MT[1];const a=[r,i,n],o=[Bye,Gye,jye];for(let l=0;l<3;++l){d5(e,a[l],Ls),MT[0]=Ls[0],OT[0]=Ls[1],d5(e,o[l],Ls),MT[2]=Ls[0],OT[2]=Ls[1],KI[0]=OT[0]-MT[0],KI[2]=OT[2]-MT[2];const c=PK(KI);c<s.quality&&(sd(s.b0,a[l]),sd(s.b1,t),sd(s.b2,o[l]),s.quality=c)}}const Q5t=[0,0,0];function d5(e,t,r){const{data:i,size:n}=e;r[0]=Number.POSITIVE_INFINITY,r[1]=Number.NEGATIVE_INFINITY;for(let s=0;s<i.length;s+=n){const a=i[s]*t[0]+i[s+1]*t[1]+i[s+2]*t[2];r[0]=Math.min(r[0],a),r[1]=Math.max(r[1],a)}}function J5t(e,t,r,i,n){const{data:s,size:a}=e;sd(i,s),sd(n,i),r[0]=GMe(Q5t,t),r[1]=r[0];for(let o=a;o<s.length;o+=a){const l=s[o]*t[0]+s[o+1]*t[1]+s[o+2]*t[2];l<r[0]&&(r[0]=l,sd(i,s,o)),l>r[1]&&(r[1]=l,sd(n,s,o))}}function qye(e,t,r){sd(r.center,e),P3(r.halfSize,t,.5),r.quaternion[0]=0,r.quaternion[1]=0,r.quaternion[2]=0,r.quaternion[3]=1}const Km=[0,0,0],PT=[0,0,0],U8=[0,0,0],u5=[0,0,0],h5=[0,0,0],Hye=[0,0,0];function K5t(e,t,r){sd(Km,t),Math.abs(t[0])>Math.abs(t[1])&&Math.abs(t[0])>Math.abs(t[2])?Km[0]=0:Math.abs(t[1])>Math.abs(t[2])?Km[1]=0:Km[2]=0,BMe(Km)<V9&&(Km[0]=Km[1]=Km[2]=1),Mh(PT,t,Km),Qa(PT,PT),Mh(U8,t,PT),Qa(U8,U8),zMe(e,t,PT,U8,u5,h5),Oh(Hye,h5,u5),UMe(t,PT,U8,u5,h5,Hye,r)}function zMe(e,t,r,i,n,s){d5(e,t,Ls),n[0]=Ls[0],s[0]=Ls[1],d5(e,r,Ls),n[1]=Ls[0],s[1]=Ls[1],d5(e,i,Ls),n[2]=Ls[0],s[2]=Ls[1]}const e$=[0,0,0],s0=[1,0,0,0,1,0,0,0,1],IT=[0,0,0];function UMe(e,t,r,i,n,s,a){s0[0]=e[0],s0[1]=e[1],s0[2]=e[2],s0[3]=t[0],s0[4]=t[1],s0[5]=t[2],s0[6]=r[0],s0[7]=r[1],s0[8]=r[2],r9t(a.quaternion,s0),OD(IT,i,n),P3(IT,IT,.5),P3(a.center,e,IT[0]),P3(e$,t,IT[1]),OD(a.center,a.center,e$),P3(e$,r,IT[2]),OD(a.center,a.center,e$),P3(a.halfSize,s,.5)}const Rd=7;class e9t{constructor(t){this.minVert=new Array(Rd),this.maxVert=new Array(Rd);const r=64*Rd;this.buffer=new ArrayBuffer(r);let i=0;this.minProj=new Float64Array(this.buffer,i,Rd),i+=8*Rd,this.maxProj=new Float64Array(this.buffer,i,Rd),i+=8*Rd;for(let l=0;l<Rd;++l)this.minVert[l]=new Float64Array(this.buffer,i,3),i+=24;for(let l=0;l<Rd;++l)this.maxVert[l]=new Float64Array(this.buffer,i,3),i+=24;for(let l=0;l<Rd;++l)this.minProj[l]=Number.POSITIVE_INFINITY,this.maxProj[l]=Number.NEGATIVE_INFINITY;const n=new Array(Rd),s=new Array(Rd),{data:a,size:o}=t;for(let l=0;l<a.length;l+=o){let c=a[l];c<this.minProj[0]&&(this.minProj[0]=c,n[0]=l),c>this.maxProj[0]&&(this.maxProj[0]=c,s[0]=l),c=a[l+1],c<this.minProj[1]&&(this.minProj[1]=c,n[1]=l),c>this.maxProj[1]&&(this.maxProj[1]=c,s[1]=l),c=a[l+2],c<this.minProj[2]&&(this.minProj[2]=c,n[2]=l),c>this.maxProj[2]&&(this.maxProj[2]=c,s[2]=l),c=a[l]+a[l+1]+a[l+2],c<this.minProj[3]&&(this.minProj[3]=c,n[3]=l),c>this.maxProj[3]&&(this.maxProj[3]=c,s[3]=l),c=a[l]+a[l+1]-a[l+2],c<this.minProj[4]&&(this.minProj[4]=c,n[4]=l),c>this.maxProj[4]&&(this.maxProj[4]=c,s[4]=l),c=a[l]-a[l+1]+a[l+2],c<this.minProj[5]&&(this.minProj[5]=c,n[5]=l),c>this.maxProj[5]&&(this.maxProj[5]=c,s[5]=l),c=a[l]-a[l+1]-a[l+2],c<this.minProj[6]&&(this.minProj[6]=c,n[6]=l),c>this.maxProj[6]&&(this.maxProj[6]=c,s[6]=l)}for(let l=0;l<Rd;++l){let c=n[l];sd(this.minVert[l],a,c),c=s[l],sd(this.maxVert[l],a,c)}}}class t9t{constructor(){this.b0=[1,0,0],this.b1=[0,1,0],this.b2=[0,0,1],this.quality=0}}function PK(e){return e[0]*e[1]+e[0]*e[2]+e[1]*e[2]}function OD(e,t,r){e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2]}function Oh(e,t,r){e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2]}function P3(e,t,r){e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r}function sd(e,t,r=0){e[0]=t[r+0],e[1]=t[r+1],e[2]=t[r+2]}function Mh(e,t,r){const i=t[0],n=t[1],s=t[2],a=r[0],o=r[1],l=r[2];e[0]=n*l-s*o,e[1]=s*a-i*l,e[2]=i*o-n*a}function Qa(e,t){const r=t[0]*t[0]+t[1]*t[1]+t[2]*t[2];if(r>0){const i=1/Math.sqrt(r);e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i}}function BMe(e){return e[0]*e[0]+e[1]*e[1]+e[2]*e[2]}function IK(e,t){const r=t[0]-e[0],i=t[1]-e[1],n=t[2]-e[2];return r*r+i*i+n*n}function GMe(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function r9t(e,t){const r=t[0]+t[4]+t[8];if(r>0){let i=Math.sqrt(r+1);e[3]=.5*i,i=.5/i,e[0]=(t[5]-t[7])*i,e[1]=(t[6]-t[2])*i,e[2]=(t[1]-t[3])*i}else{let i=0;t[4]>t[0]&&(i=1),t[8]>t[3*i+i]&&(i=2);const n=(i+1)%3,s=(i+2)%3;let a=Math.sqrt(t[3*i+i]-t[3*n+n]-t[3*s+s]+1);e[i]=.5*a,a=.5/a,e[3]=(t[3*n+s]-t[3*s+n])*a,e[n]=(t[3*n+i]+t[3*i+n])*a,e[s]=(t[3*s+i]+t[3*i+s])*a}}const A7=qy(),K3=M(),i9t=M(),n9t=Li();class uDt{constructor(t){const a=t*56;this.buffer=new ArrayBuffer(a),this.obbs=new Array(t);for(let o=0;o<t;o++)this.obbs[o]={center:ire(this.buffer,56*o+0),halfSize:WEe(this.buffer,56*o+24),quaternion:DMe(this.buffer,56*o+36)}}}function toe(e=[0,0,0],t=[-1,-1,-1],r=[0,0,0,1]){return{center:Kn(e),halfSize:VN(t),quaternion:LMe(r)}}function Wye(e){return toe(e.center,e.halfSize,e.quaternion)}function hDt(e,t){oe(t.center,e.center),oe(t.halfSize,e.halfSize),vO(t.quaternion,e.quaternion)}function jMe(e,t){return t=t||toe(),q5t(e,t),t}function s3(e,t){const r=di(t,e.center),i=qU(e,t);return r>i?1:r<-i?-1:0}function fDt(e,t){t||(t=is());const r=Lz(n9t,e.quaternion),i=e.halfSize[0]*Math.abs(r[0])+e.halfSize[1]*Math.abs(r[3])+e.halfSize[2]*Math.abs(r[6]),n=e.halfSize[0]*Math.abs(r[1])+e.halfSize[1]*Math.abs(r[4])+e.halfSize[2]*Math.abs(r[7]),s=e.halfSize[0]*Math.abs(r[2])+e.halfSize[1]*Math.abs(r[5])+e.halfSize[2]*Math.abs(r[8]);return t[0]=e.center[0]-i,t[1]=e.center[1]-n,t[2]=e.center[2]-s,t[3]=e.center[0]+i,t[4]=e.center[1]+n,t[5]=e.center[2]+s,t}function pDt(e,t){return di(t,e.center)-qU(e,t)}function mDt(e,t){return di(t,e.center)+qU(e,t)}function gDt(e,t){return s3(e,t[0])<=0&&s3(e,t[1])<=0&&s3(e,t[2])<=0&&s3(e,t[3])<=0&&s3(e,t[4])<=0&&s3(e,t[5])<=0}function yDt(e,t,r,i=0){Ny(A7,e.quaternion),pe(K3,t,e.center);const n=gu(K3,K3,A7),s=gu(i9t,r,A7);let a=-1/0,o=1/0;for(let l=0;l<3;l++)if(Math.abs(s[l])>1e-6){const c=(i+e.halfSize[l]-n[l])/s[l],u=(-i-e.halfSize[l]-n[l])/s[l];a=Math.max(a,Math.min(c,u)),o=Math.min(o,Math.max(c,u))}else if(n[l]>e.halfSize[l]+i||n[l]<-e.halfSize[l]-i)return!1;return a<=o}(()=>{const e=new Int8Array(162);let t=0;const r=i=>{for(let n=0;n<i.length;n++)e[t+n]=i[n];t+=6};return r([6,2,3,1,5,4]),r([0,2,3,1,5,4]),r([0,2,3,7,5,4]),r([0,1,3,2,6,4]),r([0,1,3,2,0,0]),r([0,1,5,7,3,2]),r([0,1,3,7,6,4]),r([0,1,3,7,6,2]),r([0,1,5,7,6,2]),r([0,1,5,4,6,2]),r([0,1,5,4,0,0]),r([0,1,3,7,5,4]),r([0,2,6,4,0,0]),r([0,0,0,0,0,0]),r([1,3,7,5,0,0]),r([2,3,7,6,4,0]),r([2,3,7,6,0,0]),r([2,3,1,5,7,6]),r([0,1,5,7,6,2]),r([0,1,5,7,6,4]),r([0,1,3,7,6,4]),r([4,5,7,6,2,0]),r([4,5,7,6,0,0]),r([4,5,1,3,7,6]),r([0,2,3,7,5,4]),r([6,2,3,7,5,4]),r([6,2,3,1,5,4]),e})();function qU(e,t){Ny(A7,e.quaternion),gu(K3,t,A7);const r=e.halfSize;return Math.abs(K3[0]*r[0])+Math.abs(K3[1]*r[1])+Math.abs(K3[2]*r[2])}function qMe(e,t){for(let r=0;r<8;++r){const i=t[r];i[0]=1&r?-e.halfSize[0]:e.halfSize[0],i[1]=2&r?-e.halfSize[1]:e.halfSize[1],i[2]=4&r?-e.halfSize[2]:e.halfSize[2],gu(i,i,e.quaternion),he(i,i,e.center)}}function s9t(e){return ore(e.halfSize)}function HMe(e){return e&&parseInt(e.substring(e.lastIndexOf("/")+1,e.length),10)}function bDt(e){var t;if(ue("disable-feature:i3s-draco")||!e)return!1;for(const r of e)for(const i of r.geometryBuffers)if(((t=i.compressedAttributes)==null?void 0:t.encoding)==="draco")return!0;return!1}function vDt(e,t,r,i,n,s){const a=t!==i;n.traverse(r,o=>{let l=o.mbs;return a&&(l=a9t,Nje(o.mbs,i,l,t)),o9t(e,l)!==ew.OUTSIDE&&(s(o),!0)})}function _Dt(e,t,r){let i=0,n=0;for(let s=0;s<t.length&&i<e.length;s++)e[i]===t[s]&&(r(s)&&(e[n]=e[i],n++),i++);e.length=n}function wDt(e,t,r){let i=0,n=0;for(;i<r.length;)p2e(e,r[i])>=0===t&&(r[n]=r[i],n++),i++;r.length=n}const B8=zt();function xDt(e,t){if(t.rotationScale[1]===0&&t.rotationScale[2]===0&&t.rotationScale[3]===0&&t.rotationScale[5]===0&&t.rotationScale[6]===0&&t.rotationScale[7]===0)return B8[0]=(e[0]-t.position[0])/t.rotationScale[0],B8[1]=(e[1]-t.position[1])/t.rotationScale[4],B8[2]=(e[2]-t.position[0])/t.rotationScale[0],B8[3]=(e[3]-t.position[1])/t.rotationScale[4],B8}const a9t=Jt();var ew;function o9t(e,t){const r=t[0],i=t[1],n=t[3],s=e[0]-r,a=r-e[2],o=e[1]-i,l=i-e[3],c=Math.max(s,a,0),u=Math.max(o,l,0),h=c*c+u*u;return h>n*n?ew.OUTSIDE:h>0?ew.INTERSECTS_CENTER_OUTSIDE:-Math.max(s,a,o,l)>n?ew.INSIDE:ew.INTERSECTS_CENTER_INSIDE}function l9t(e,t,r){const i=[],n=r&&r.missingFields,s=r&&r.originalFields;for(const a of e){const o=a.toLowerCase();let l=!1;for(const c of t)if(o===c.name.toLowerCase()){i.push(c.name),l=!0,s&&s.push(a);break}!l&&n&&n.push(a)}return i}async function TDt(e,t,r,i,n){if(t.length===0)return[];const s=e.attributeStorageInfo;if(_(e.associatedLayer))try{return await d9t(e.associatedLayer,t,r,i)}catch(a){if(e.associatedLayer.loaded)throw a}if(s){const a=c9t(t,r,n);if(R(a))throw new k("scenelayer:features-not-loaded","Tried to query attributes for unloaded features");const o=e.parsedUrl.path,l=await Promise.all(a.map(c=>u9t(o,s,c.node,c.indices,i).then(u=>{for(let h=0;h<c.graphics.length;h++){const p=c.graphics[h],m=u[h];if(p.attributes)for(const g in p.attributes)g in m||(m[g]=p.attributes[g]);p.attributes=m}return c.graphics})));return m2e(l)}throw new k("scenelayer:no-attribute-source","This scene layer does not have a source for attributes available")}function c9t(e,t,r){const i=new Map,n=[],s=r();for(const a of e){const o=a.attributes[t];for(let l=0;l<s.length;l++){const c=s[l],u=c.featureIds.indexOf(o);if(u>=0){let h=i.get(c.node);h||(h={node:c.node,indices:[],graphics:[]},n.push(h),i.set(c.node,h)),h.indices.push(u),h.graphics.push(a);for(let p=l;p>0;p--)s[p]=s[p-1];s[0]=c;break}}}return n}async function d9t(e,t,r,i){t.sort((l,c)=>l.attributes[r]-c.attributes[r]);const n=t.map(l=>l.attributes[r]),s=[],a=l9t(i,e.fields,{originalFields:s}),o=await WMe(e,n,a);for(let l=0;l<t.length;l++){const c=t[l],u=o[l],h={};if(c.attributes)for(const p in c.attributes)h[p]=c.attributes[p];for(let p=0;p<s.length;p++)h[s[p]]=u[a[p]];c.attributes=h}return t}function WMe(e,t,r){const i=e.capabilities.query.maxRecordCount;if(i!=null&&t.length>i){const s=HDe(t,i);return Promise.all(s.map(a=>WMe(e,a,r))).then(m2e)}const n=new Zn({objectIds:t,outFields:r,orderByFields:[e.objectIdField]});return e.queryFeatures(n).then(s=>{if(s&&s.features&&s.features.length===t.length)return s.features.map(a=>a.attributes);throw new k("scenelayer:feature-not-in-associated-layer","Feature not found in associated feature layer")})}function u9t(e,t,r,i,n){const s=[];for(const a of t)if(a&&n.includes(a.name)){const o=`${e}/nodes/${r.resources.attributes}/attributes/${a.key}/0`;s.push({url:o,storageInfo:a})}return dn(s.map(a=>qt(a.url,{responseType:"array-buffer"}).then(o=>U5t(a.storageInfo,o.data)))).then(a=>{const o=[];for(const l of i){const c={};for(let u=0;u<a.length;u++)a[u].value!=null&&(c[s[u].storageInfo.name]=p9t(a[u].value,l));o.push(c)}return o})}(function(e){e[e.OUTSIDE=0]="OUTSIDE",e[e.INTERSECTS_CENTER_OUTSIDE=1]="INTERSECTS_CENTER_OUTSIDE",e[e.INTERSECTS_CENTER_INSIDE=2]="INTERSECTS_CENTER_INSIDE",e[e.INSIDE=3]="INSIDE"})(ew||(ew={}));const h9t=-32768,f9t=-(2**31);function p9t(e,t){if(!e)return null;const r=e[t];return _2e(e)?r===h9t?null:r:w2e(e)?r===f9t?null:r:r!=r?null:r}function m9t(e){const t=e.store.indexCRS||e.store.geographicCRS,r=t===void 0?e.store.indexWKT:void 0;if(r){if(!e.spatialReference)throw new k("layerview:no-store-spatial-reference-wkt-index-and-no-layer-spatial-reference","Found indeWKT in the scene layer store but no layer spatial reference",{});if(r!==e.spatialReference.wkt)throw new k("layerview:store-spatial-reference-wkt-index-incompatible","The indeWKT of the scene layer store does not match the WKT of the layer spatial reference",{})}const i=t?new Ye(HMe(t)):e.spatialReference;return i.equals(e.spatialReference)?e.spatialReference:i}function g9t(e){const t=e.store.vertexCRS||e.store.projectedCRS,r=t===void 0?e.store.vertexWKT:void 0;if(r){if(!e.spatialReference)throw new k("layerview:no-store-spatial-reference-wkt-vertex-and-no-layer-spatial-reference","Found vertexWKT in the scene layer store but no layer spatial reference",{});if(r!==e.spatialReference.wkt)throw new k("layerview:store-spatial-reference-wkt-vertex-incompatible","The vertexWKT of the scene layer store does not match the WKT of the layer spatial reference",{})}const i=t?new Ye(HMe(t)):e.spatialReference;return i.equals(e.spatialReference)?e.spatialReference:i}function SDt(e,t){return R(t)?"@null":t===fm(t)?"@ECEF":e.equals(t)?"":t.wkid!=null?"@"+t.wkid:null}function $K(e,t,r){if(!mm(e,t))throw new k("layerview:spatial-reference-incompatible","The spatial reference of this scene layer is incompatible with the spatial reference of the view",{});if(r==="local"&&!y9t(e,t))throw new k("layerview:spatial-reference-incompatible","The spatial reference of this scene layer is incompatible with the spatial reference of the view",{})}function y9t(e,t){return e.equals(t)||e.isWGS84&&t.isWebMercator||e.isWebMercator&&t.isWGS84}function b9t(e,t,r){const i=m9t(e),n=g9t(e);$K(i,t,r),$K(n,t,r)}function v9t(e){return(e.geometryType==null||e.geometryType==="triangles")&&(e.topology==null||e.topology==="PerAttributeArray")&&e.vertexAttributes!=null&&e.vertexAttributes.position!=null}function EDt(e){if(e.store==null||e.store.defaultGeometrySchema==null||!v9t(e.store.defaultGeometrySchema))throw new k("scenelayer:unsupported-geometry-schema","The geometry schema of this scene layer is not supported.",{url:e.parsedUrl.path})}function CDt(e,t){b9t(e,t.spatialReference,t.viewingMode)}function _9t(e){return e.geometryType!=null&&e.geometryType==="points"&&(e.topology==null||e.topology==="PerAttributeArray")&&(e.encoding==null||e.encoding===""||e.encoding==="lepcc-xyz")&&e.vertexAttributes!=null&&e.vertexAttributes.position!=null}function ADt(e){if(e.store==null||e.store.defaultGeometrySchema==null||!_9t(e.store.defaultGeometrySchema))throw new k("pointcloud:unsupported-geometry-schema","The geometry schema of this point cloud scene layer is not supported.",{})}function RDt(e,t){$K(e.spatialReference,t.spatialReference,t.viewingMode)}function w9t(e){return e.type==="simple"||e.type==="class-breaks"||e.type==="unique-value"}function x9t(e){return e.type==="mesh-3d"}function ODt(e){if(e==null||!w9t(e)||(e.type==="unique-value"||e.type==="class-breaks")&&e.defaultSymbol==null)return!0;const t=e.getSymbols();if(t.length===0)return!0;for(const r of t){if(!x9t(r)||r.symbolLayers.length===0)return!0;for(const i of r.symbolLayers.items)if(i.type!=="fill"||R(i.material)||R(i.material.color)||i.material.colorMixMode!=="replace")return!0}return!1}const MDt=jAe({color:[0,0,0,0],opacity:0});class T9t{constructor(){this.edgeMaterial=null,this.material=null,this.castShadows=!0}}function PDt(e){const t=new T9t;let r=!1,i=!1;for(const n of e.symbolLayers.items)if(n.type==="fill"&&n.enabled){const s=n.material,a=n.edges;if(_(s)&&!r){const o=s.color,l=DRe(s.colorMixMode);_(o)?t.material={color:[o.r/255,o.g/255,o.b/255],alpha:o.a,colorMixMode:l}:t.material={color:[1,1,1],alpha:1,colorMixMode:Dn.Multiply},t.castShadows=n.castShadows,r=!0}_(a)&&!i&&(t.edgeMaterial=GAe(a,{}),i=!0)}return t.material||(t.material={color:[1,1,1],alpha:1,colorMixMode:Dn.Multiply}),t}function IDt(e,t){return(0|e)+(0|t)|0}function S9t(e,t,r,i,n=0){i===fm(i)?t.isGeographic?P9t(e,r,t,n):M9t(e,r,t,n):t.isWGS84&&(i.isWebMercator||aA(i))?C9t(t,e,i,r,n):t.isWebMercator&&aA(i)?O9t(t,e,i,r,n):e===r?(r.center[2]+=n,mi(r.center,t,0,r.center,i,0,1)):(ne(r.center,e.center[0],e.center[1],e.center[2]+n),mi(r.center,t,0,r.center,i,0,1),vO(r.quaternion,e.quaternion),oe(r.halfSize,e.halfSize))}function E9t(e,t,r,i,n){if(vO(n.quaternion,e.quaternion),i===Be.Global){Ny(t$,e.quaternion),gu(Nb,e.center,t$),TX($T,Nb),fwe(LT,$T,e.halfSize),pd(LT,$T,LT);const s=Oe(LT);he(LT,$T,e.halfSize);const a=Oe(LT);if(s<r)oe(n.center,e.center),ne(Nb,r,r,r),he(n.halfSize,e.halfSize,Nb);else{const o=a>0?1+t/a:1,l=s>0?1+r/s:1,c=(l+o)/2,u=(l-o)/2;le(n.halfSize,$T,u),N3(n.halfSize,n.halfSize,e.halfSize,c),le(n.center,$T,c),N3(n.center,n.center,e.halfSize,u),hwe(Nb,Nb),pV(n.center,n.center,Nb),gu(n.center,n.center,n.quaternion)}}else{const s=ne(Nb,0,0,1);N3(n.center,e.center,s,(r+t)/2),Ny(t$,e.quaternion),gu(s,s,t$),TX(s,s),N3(n.halfSize,e.halfSize,s,(r-t)/2)}return n}const Nb=M(),$T=M(),LT=M(),t$=qy();function C9t(e,t,r,i,n){oe(J1,t.center),J1[2]+=n;const s=fm(r);mi(J1,e,0,J1,s,0,1),XMe(s,t,J1,r,i)}const MD=new Float64Array(24),A9t={data:MD,size:3},Xye=M(),J1=M(),R9t=Li();function O9t(e,t,r,i,n){oe(J1,t.center),J1[2]+=n,XMe(e,t,J1,r,i)}function XMe(e,t,r,i,n){const s=Lz(R9t,t.quaternion);for(let a=0;a<8;++a){for(let o=0;o<3;++o)Xye[o]=t.halfSize[o]*((a&1<<o)!=0?-1:1);for(let o=0;o<3;++o){let l=r[o];for(let c=0;c<3;++c)l+=Xye[c]*s[3*c+o];MD[3*a+o]=l}}mi(MD,e,0,MD,i,0,8),jMe(A9t,n)}function M9t(e,t,r,i){qMe(e,LK),ne(t.center,e.center[0],e.center[1],e.center[2]+i),Au(r,t.center,Od,fm(r)),ne(t.center,Od[12],Od[13],Od[14]);const n=2*Math.sqrt(1+Od[0]+Od[5]+Od[10]);Vg[0]=(Od[6]-Od[9])/n,Vg[1]=(Od[8]-Od[2])/n,Vg[2]=(Od[1]-Od[4])/n,Vg[3]=.25*n,tse(t.quaternion,Vg,e.quaternion),Ny(Vg,t.quaternion);let s=0,a=0,o=0;for(const l of LK)l[2]+=i,mi(l,r,0,l,fm(r),0,1),pd(Sr,l,t.center),gu(Sr,Sr,Vg),s=Math.max(s,Math.abs(Sr[0])),a=Math.max(a,Math.abs(Sr[1])),o=Math.max(o,Math.abs(Sr[2]));ne(t.halfSize,s,a,o)}function P9t(e,t,r,i){const n=Ar(r),s=1+Math.max(0,i)/(n.radius+e.center[2]);ne(t.center,e.center[0],e.center[1],e.center[2]+i),mi(t.center,r,0,t.center,fm(r),0,1),vO(t.quaternion,e.quaternion),Ny(Vg,e.quaternion),ne(Sr,0,0,1),gu(Sr,Sr,Vg),ne(Sr,e.halfSize[0]*Math.abs(Sr[0]),e.halfSize[1]*Math.abs(Sr[1]),e.halfSize[2]*Math.abs(Sr[2])),le(Sr,Sr,n.inverseFlattening),he(t.halfSize,e.halfSize,Sr),le(t.halfSize,t.halfSize,s)}function $Dt(e,t,r,i,n,s){if(!s||s.length===0||R(t))return null;const a=G5t(e.mbs,n,r,t);let o;Rn(i$,a);const l=()=>{if(!o)if(o=LK,Eu(r$),_(e.serviceObb)){S9t(e.serviceObb,r,Yye,t,n),qMe(Yye,o);for(const m of o)ze(m,m,i$),Y4(r$,m)}else{const m=e.mbs,g=m[3];Ss(m,r,Sr,t),ze(Sr,Sr,i$),Sr[2]+=n;for(let b=0;b<8;++b){const w=1&b?g:-g,v=2&b?g:-g,x=4&b?g:-g,T=o[b];oe(T,[Sr[0]+w,Sr[1]+v,Sr[2]+x]),Y4(r$,T)}}};let c=1/0,u=-1/0;const h=m=>{if(m.type!=="replace")return;const g=m.geometry;if(!g.hasZ)return;Eu(_H);const b=g.spatialReference||i,w=g.rings.reduce((v,x)=>x.reduce((T,E)=>(Ss(E,b,Sr,t),ze(Sr,Sr,i$),Y4(_H,Sr),Math.min(Sr[2],T)),v),1/0);l(),KR(r$,_H)&&(c=Math.min(c,w),u=Math.max(u,w))};if(s.forEach(m=>h(m)),c===1/0)return null;const p=(m,g,b)=>{ze(Sr,b,a),m[g+0]=Sr[0],m[g+1]=Sr[1],m[g+2]=Sr[2],g+=24,b[2]=c,ze(Sr,b,a),m[g+0]=Sr[0],m[g+1]=Sr[1],m[g+2]=Sr[2],g+=24,b[2]=u,ze(Sr,b,a),m[g+0]=Sr[0],m[g+1]=Sr[1],m[g+2]=Sr[2]};for(let m=0;m<8;++m)p(Zye.data,3*m,o[m]);return jMe(Zye)}function LDt(e){return _(e)&&e.halfSize[0]>=0}function DDt(e){return e[3]>=0}function FDt(e){_(e)&&(e.halfSize[0]=-1)}function NDt(e){_(e)&&(e[3]=-1)}const Od=Ae(),Vg=$Me(),LK=[[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0]],_H=zt(),r$=zt(),Yye=toe(),Sr=[0,0,0],Zye={data:new Array(72),size:3},i$=Ae();class I9t{constructor(t){this._totalCount=t,this._indexRanges=[0,t]}allVisible(){return this.componentCount()===this._totalCount}allInvisible(){return this._indexRanges.length===0}componentCount(){const t=this._indexRanges;let r=0;for(let i=0;i<t.length;i+=2)r+=t[i+1];return r}reset(t){t==="all"||t.length===this._totalCount?this._indexRanges=[0,this._totalCount]:this._indexRanges=$9t(t)}forEachComponent(t){const r=this._indexRanges;for(let i=0;i<r.length;i+=2){const n=r[i],s=n+r[i+1];for(let a=n;a<s;a++)if(!t(a))return!1}return!0}forEachComponentRange(t){const r=this._indexRanges;for(let i=0;i<r.length;i+=2){const n=r[i];if(!t(n,n+r[i+1]))return!1}return!0}computeOffsetRanges(t){const r=new Array(this._indexRanges.length),i=this._indexRanges;for(let n=0;n<i.length;n+=2){const s=i[n],a=s+i[n+1],o=t[s],l=t[a];r[n]=o,r[n+1]=l-o}return r}}function $9t(e){const t=new Array;if(e.length===0)return t;let r=e[0],i=1;for(let n=1;n<e.length;n++){const s=e[n];r+i===s?i+=1:(t.push(r),t.push(i),r=s,i=1)}return t.push(r),t.push(i),t}class L9t extends cU{constructor(t,r){super(),this.pickability=null,this.highlightCounts=null,this.verticalOffsets=null,this.cachedGeometryRanges=null,this.cachedHighlightRanges=null,this.cachedDefaultRanges=null,this.offsets=wte(r);const i=this.count;this.visibility=new I9t(i),this.materialDataBuffer=t.getBuffer(i),this.materialDataIndices=new Uint16Array(i);for(let n=0;n<i;n++)this.materialDataIndices[n]=this.materialDataBuffer.acquireIndex()}dispose(){super.dispose();for(let t=0;t<this.count;t++)this.materialDataBuffer.releaseIndex(this.materialDataIndices[t])}get count(){return this.offsets.length-1}get geometryRanges(){return R(this.cachedGeometryRanges)&&(this.cachedGeometryRanges=this.visibility.computeOffsetRanges(this.offsets)),this.cachedGeometryRanges}get highlightRanges(){return R(this.highlightCounts)?null:(this._updateCachedHighlightRanges(),this.cachedHighlightRanges)}get defaultShadowMapRanges(){return R(this.highlightCounts)?this.geometryRanges:(this._updateCachedHighlightRanges(),this.cachedDefaultRanges)}highlightsDirty(){this.cachedHighlightRanges=null,this.cachedDefaultRanges=null}visibilityDirty(){this.cachedGeometryRanges=null,this.highlightsDirty()}_updateCachedHighlightRanges(){if((R(this.cachedHighlightRanges)||R(this.cachedDefaultRanges))&&_(this.highlightCounts)){const{highlightRanges:t,defaultRanges:r}=D9t(this.highlightCounts,this.visibility,this.offsets);this.cachedHighlightRanges=t,this.cachedDefaultRanges=r}}}function D9t(e,t,r){const i=[],n=[];let s=r.length,a=r.length;return t.forEachComponent(o=>(e[o]>0?(s!==o-1&&(i.length&&i.push(r[s+1]-i[i.length-1]),i.push(r[o])),s=o):(a!==o-1&&(n.length&&n.push(r[a+1]-n[n.length-1]),n.push(r[o])),a=o),!0)),i.length&&i.push(r[s+1]-i[i.length-1]),n.length&&n.push(r[a+1]-n[n.length-1]),{highlightRanges:i,defaultRanges:n}}class DK extends cU{constructor(){super(...arguments),this.visible=f5.Hidden}}var f5;d([Za()],DK.prototype,"renderable",void 0),d([Za()],DK.prototype,"components",void 0),function(e){e[e.Hidden=0]="Hidden",e[e.Visible=1]="Visible"}(f5||(f5={}));function F9t(e,t,r,i){if(r>=t)return e;e==null&&(e=N9t());const n=e.isVisibleBit;let s=e.data;const a=ZMe(s),o=r/a|0,l=r-a*o,c=(t-1)/a|0,u=s,h=i===n;if(!(r<u.length*a)&&h){const m=o+1,g=Math.ceil(u.length*1.5),b=c+1;let w=Math.max(m,g);w=Math.min(w,b),s=new Uint32Array(w),s.set(u)}return o<s.length&&(s[o]=V9t(s[o],l,h)),e.data=s,e}function YMe(e,t){if(e==null)return!0;const{isVisibleBit:r,data:i}=e,n=ZMe(i);return t<i.length*n?k9t(r,i,t,n):!e.isVisibleBit}function N9t(e=!0){return{isVisibleBit:!e,data:new Uint32Array(0)}}function k9t(e,t,r,i){const n=r/i|0,s=r-n*i;return z9t(t[n],s)===e}function ZMe(e){return e.BYTES_PER_ELEMENT*8}function V9t(e,t,r){return e&~(1<<t)|(r?1:0)<<t}function z9t(e,t){return(e&1<<t)!=0}class U9t{constructor(t,r){this._indices=_(t.indices)?t.indices:S9(t.positions.length/3),this._positions=new Zr(t.positions),this._components=r,this._componentIntersectionData=new Array(r.count)}getComponentAabb(t,r){if(_(this._perComponentAabbs)){for(let i=0;i<6;i++)r[i]=this._perComponentAabbs[6*t+i];return r}return this._computePerComponentAabbs(),this.getComponentAabb(t,r)}getComponentPositions(t,r){r.indices=this._indices,r.data=this._positions.typedBuffer,r.stride=this._positions.typedBufferStride,r.startIndex=this._components.offsets[t],r.endIndex=this._components.offsets[t+1]}intersect(t,r,i,n,s,a,o){const l={data:this._positions.typedBuffer,stride:this._positions.typedBufferStride,size:3},c=this._indices,u=this._components.offsets,h=W7e(t,r,B9t),p=t[2],m=r[2];this._components.visibility.forEachComponent(g=>{if(!YMe(this._components.pickability,g))return!0;const b=this.getComponentAabb(g,G9t);if(_(a)){const E=a[g];_(s)?s.componentOffset=E:(t[2]=p-E,r[2]=m-E)}if(_(s)&&s.applyToAabb(b),!Zse(b,t,h,i))return!0;const w=u[g]/3,v=u[g+1]/3,x=(E,C,A)=>{o(g,E,ed(C,C,n),A)},T=v-w;return R(s)&&T>RMe?(this._componentIntersectionData[g]==null&&(this._componentIntersectionData[g]=new k9(this._indices,w,v,l)),this._componentIntersectionData[g].intersectRay({r0:t,r1:r},x)):EO(t,r,w,v,c,l,void 0,s,x),!0})}_computePerComponentAabbs(){const t=this._components.count;this._perComponentAabbs=new Float32Array(6*t);const r=this._indices,i=this._positions.typedBuffer,n=this._positions.typedBufferStride,s=this._components.offsets;let a=0;for(let o=0;o<t;o++){const l=s[o],c=s[o+1];let u=1/0,h=1/0,p=1/0,m=-1/0,g=-1/0,b=-1/0;for(let w=l;w<c;w++){const v=r[w]*n,x=i[v],T=i[v+1],E=i[v+2];u=Math.min(u,x),h=Math.min(h,T),p=Math.min(p,E),m=Math.max(m,x),g=Math.max(g,T),b=Math.max(b,E)}this._perComponentAabbs[a++]=u,this._perComponentAabbs[a++]=h,this._perComponentAabbs[a++]=p,this._perComponentAabbs[a++]=m,this._perComponentAabbs[a++]=g,this._perComponentAabbs[a++]=b}}get positions(){return this._positions}get indices(){return this._indices}}const B9t=M(),G9t=is();class j9t{constructor(t,r,i){this.material=t,this.geometry=r,this.meta=i}dispose(){this.material.dispose(),this.geometry.dispose()}}class QMe extends cU{constructor(t,r,i,n){super(),this.primitiveType=r,this.parameters=i,this.indexed=n,this.vao=t}}d([Za()],QMe.prototype,"vao",void 0);function q9t(e,t){return{near:e,far:t}}function zO(e){return e?ER(e,1/0,-1/0):q9t(1/0,-1/0)}function ER(e,t,r){return e.near=t,e.far=r,e}function z9(e,t,r=e){return r.near=Math.min(e.near,t.near),r.far=Math.max(e.far,t.far),r}function n$(e,t){return e.near<=t&&t<=e.far}const FK={near:0,far:0};function H9t(e,t){const r=zO(),{eye:i,frustum:n,viewForward:s}=e;t.forAll(a=>{const o=_(a.offsetObb)?a.offsetObb:a.obb,l=Se(pd(zd,o.center,i),s),c=qU(o,s);if(n$(r,l-c)&&n$(r,l+c))return;const u=Q9t(o,n);if(u===-1)return;if(u===0)return eg.far=l+c,eg.near=l-c,void z9(r,eg);const h=s$.pushNew();h.near=l-c,h.far=l+c,h.mask=u,h.object=a});for(let a=0;a<s$.length;a++){const o=s$.data[a];if(n$(r,o.near)&&n$(r,o.far))continue;eg.far=o.far,eg.near=1/0,Z9t(_(o.object.offsetObb)?o.object.offsetObb:o.object.obb,i,W9t,c=>{let u=X9t;for(let h=0;h<JMe&&c.length>0;h++){if((o.mask&1<<h)==0)continue;Y9t(n[h],c,u);const p=c;c=u,u=p}for(let h=0;h<c.length;h+=3){ne(Gl,c.data[h+0],c.data[h+1],c.data[h+2]);const p=Se(pd(Gl,Gl,i),s);eg.near=Math.min(eg.near,p)}})===0&&(eg.near=0),z9(r,eg)}return s$.length=0,r}const s$=new Qt({allocator:e=>e||{near:1/0,far:-1/0,mask:0,object:null},deallocator:e=>(e.object=null,e)}),eg=zO(),Gl=M(),d2=M(),W9t=new Qt({deallocator:null}),X9t=new Qt({deallocator:null});function Y9t(e,t,r){r.length=0;const i=t.length-3;wH(Gl,t,i);const n=di(e,Gl);n<=0&&(r.push(Gl[0]),r.push(Gl[1]),r.push(Gl[2]));let s=0,a=n;for(;s<i;s+=3){wH(d2,t,s);const o=di(e,d2);a*o<0&&(As(Gl,d2,Gl,o/(o-a)),jl(r,Gl)),o<=0&&jl(r,d2),a=o,oe(Gl,d2)}a*n<0&&(wH(d2,t,i),As(Gl,d2,Gl,n/(n-a)),jl(r,Gl))}function wH(e,t,r){return ne(e,t.data[r+0],t.data[r+1],t.data[r+2])}function jl(e,t){e.push(t[0]),e.push(t[1]),e.push(t[2])}function Z9t(e,t,r,i){Ny(Jye,e.quaternion),pd(zd,t,e.center),gu(zd,zd,Jye);const n=8*((zd[0]<-e.halfSize[0]?-1:zd[0]>e.halfSize[0]?1:0)+3*(zd[1]<-e.halfSize[1]?-1:zd[1]>e.halfSize[1]?1:0)+9*(zd[2]<-e.halfSize[2]?-1:zd[2]>e.halfSize[2]?1:0)+13),s=Qye[n];if(s===0)return s;Lz(a$,e.quaternion),pse(a$,a$,e.halfSize);const a=(o,l)=>{const c=Qye[n+l+1];return ne(o,((1&c)<<1)-1,(2&c)-1,((4&c)>>1)-1),ed(o,o,a$),he(o,e.center,o)};return r.length=0,jl(r,a(xH,0)),jl(r,a(Kye,1)),jl(r,a(zd,2)),jl(r,a(ebe,3)),i(r),s===1||(r.length=0,jl(r,xH),jl(r,ebe),jl(r,a(zd,4)),jl(r,a(tbe,5)),i(r),s===2||(r.length=0,jl(r,xH),jl(r,tbe),jl(r,a(zd,6)),jl(r,Kye),i(r))),s}const Qye=(()=>{const e=new Int8Array(216);let t=0;const r=i=>{for(let n=0;n<i.length;n++)e[t+n]=i[n];t+=8};return r([3,0,6,2,3,1,5,4]),r([2,0,2,3,1,5,4,0]),r([3,1,0,2,3,7,5,4]),r([2,0,1,3,2,6,4,0]),r([1,0,1,3,2,0,0,0]),r([2,1,5,7,3,2,0,0]),r([3,2,0,1,3,7,6,4]),r([2,2,0,1,3,7,6,0]),r([3,3,0,1,5,7,6,2]),r([2,0,1,5,4,6,2,0]),r([1,0,1,5,4,0,0,0]),r([2,1,3,7,5,4,0,0]),r([1,0,2,6,4,0,0,0]),r([0,0,0,0,0,0,0,0]),r([1,1,3,7,5,0,0,0]),r([2,2,3,7,6,4,0,0]),r([1,2,3,7,6,0,0,0]),r([2,3,1,5,7,6,2,0]),r([3,4,0,1,5,7,6,2]),r([2,5,7,6,4,0,1,0]),r([3,5,0,1,3,7,6,4]),r([2,4,5,7,6,2,0,0]),r([1,4,5,7,6,0,0,0]),r([2,5,1,3,7,6,4,0]),r([3,6,0,2,3,7,5,4]),r([2,6,2,3,7,5,4,0]),r([3,7,6,2,3,1,5,4]),e})(),JMe=4;function Q9t(e,t){let r=0;for(let i=0;i<JMe;i++){const n=s3(e,t[i]);if(n>0)return-1;n===0&&(r|=1<<i)}return r}const a$=Li(),Jye=qy(),zd=M(),xH=M(),Kye=M(),ebe=M(),tbe=M();class J9t{constructor(t){this._objects=t}submit(t,r){this._objects.preSubmit(r),this._objects.visibleObjects.forAll(i=>i.renderable.material.submit(t,r,i))}queryShadowCasterDepthRange(t){return this._objects.visibleObjects.length?H9t(t,this._objects.visibleObjects):null}}function K9t(e){const t=gn().vec3f(O.POSITION);return e.normals&&t.vec2i16(O.NORMALCOMPRESSED,{glNormalized:!0}),e.textureCoordinates===ws.Default?t.vec2f(O.UV0):e.textureCoordinates===ws.Atlas&&(t.vec2f(O.UV0),t.vec4u16(O.UVREGION,{glNormalized:!0})),e.colors&&t.vec4u8(O.COLOR,{glNormalized:!0}),t.alignTo(4)}class e6t extends sn{constructor(t,r){super(t,"int",zr.Draw,(i,n,s)=>i.setUniform1i(t,r(n,s)))}}var Ap;(function(e){e[e.Uniform=0]="Uniform",e[e.Varying=1]="Varying",e[e.COUNT=2]="COUNT"})(Ap||(Ap={}));const roe=429496.7296;function KMe(e,t){oR(e/roe*.5+.5,t)}function t6t(e,t){switch(t.componentData){case Ap.Varying:return r6t(e);case Ap.Uniform:return i6t(e);case Ap.COUNT:return;default:t.componentData}}function r6t(e){const{vertex:t,fragment:r}=e;t.include(bd),t.uniforms.add([new Hi("componentColorTex"),new fy("componentColorTexInvDim")]),e.attributes.add(O.COMPONENTINDEX,"float"),e.varyings.add("vExternalColorMixMode","mediump float"),e.varyings.add("vExternalColor","vec4"),e.include(NRe),t.constants.add("elevationScale","float",2*roe),t.code.add(S`vec4 _readComponentColor() {
float normalizedIndex = (componentIndex * 2.0 + 0.5) * componentColorTexInvDim.x;
vec2 indexCoord = vec2(
mod(normalizedIndex, 1.0),
(floor(normalizedIndex) + 0.5) * componentColorTexInvDim.y
);
return texture2D(componentColorTex, indexCoord);
}
float readElevationOffset() {
float normalizedIndex = (componentIndex * 2.0 + 1.5) * componentColorTexInvDim.x;
vec2 indexCoord = vec2(
mod(normalizedIndex, 1.0),
(floor(normalizedIndex) + 0.5) * componentColorTexInvDim.y
);
return (rgba2float(texture2D(componentColorTex, indexCoord)) - 0.5) * elevationScale;
}
vec4 forwardExternalColor(out bool castShadows) {
vec4 componentColor = _readComponentColor() * 255.0;
float shadowFlag = mod(componentColor.b * 255.0, 2.0);
componentColor.b -= shadowFlag;
castShadows = shadowFlag >= 1.0;
int decodedColorMixMode;
vExternalColor = decodeSymbolColor(componentColor, decodedColorMixMode) * 0.003921568627451;
vExternalColorMixMode = float(decodedColorMixMode) + 0.5;
return vExternalColor;
}`),r.code.add(S`void readExternalColor(out vec4 externalColor, out int externalColorMixMode) {
externalColor = vExternalColor;
externalColorMixMode = int(vExternalColorMixMode);
}`)}function i6t(e){const{vertex:t,fragment:r}=e;t.uniforms.add(new Pk("externalColor",i=>i.componentParameters.externalColor)),r.uniforms.add(new e6t("externalColorMixMode",i=>i.componentParameters.externalColorMixMode)),e.varyings.add("vExternalColor","vec4"),t.code.add(S`float readElevationOffset() {
return 0.0;
}
vec4 forwardExternalColor(out bool castShadows) {
vExternalColor = externalColor;
castShadows = true;
return externalColor;
}`),r.code.add(S`void readExternalColor(out vec4 color, out int colorMixMode) {
color = vExternalColor;
colorMixMode = externalColorMixMode;
}`)}var Lh;function n6t(e,t){const r=e.vertex;switch(r.code.add(S`#define VERTEX_DISCARD_CUTOFF (1.0 - 1.0 / 255.0)`),t.vertexDiscardMode){case Lh.None:r.code.add(S`#define vertexDiscardByOpacity(_opacity_) {}`);break;case Lh.Opaque:r.code.add(S`#define vertexDiscardByOpacity(_opacity_) { if (_opacity_ >  VERTEX_DISCARD_CUTOFF) {  gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`);break;case Lh.Transparent:r.code.add(S`#define vertexDiscardByOpacity(_opacity_) { if (_opacity_ <= VERTEX_DISCARD_CUTOFF) {  gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`)}}(function(e){e[e.None=0]="None",e[e.Transparent=1]="Transparent",e[e.Opaque=2]="Opaque",e[e.COUNT=3]="COUNT"})(Lh||(Lh={}));var am;function kDt(e){return e&&Sm(e)?am.Mars:e&&Em(e)?am.Moon:am.Earth}(function(e){e[e.Earth=1]="Earth",e[e.Mars=2]="Mars",e[e.Moon=3]="Moon",e[e.COUNT=4]="COUNT"})(am||(am={}));var rbe,nu;(function(e){e[e.None=0]="None",e[e.Transparent=1]="Transparent",e[e.Opaque=2]="Opaque",e[e.COUNT=3]="COUNT"})(rbe||(rbe={})),function(e){e[e.None=0]="None",e[e.NoOverlay=1]="NoOverlay",e[e.ColorOverlay=2]="ColorOverlay",e[e.ColorOverlayWithWater=3]="ColorOverlayWithWater",e[e.COUNT=4]="COUNT"}(nu||(nu={}));class pr extends xl{constructor(){super(...arguments),this.output=K.Color,this.textureCoordinateType=ws.None,this.componentData=Ap.Uniform,this.cullFace=pi.Back,this.vertexDiscardMode=Lh.None,this.doubleSidedMode=Yi.WindingOrder,this.alphaDiscardMode=ui.Opaque,this.integratedMeshMode=nu.None,this.transparencyPassType=yt.NONE,this.ellipsoidMode=am.Earth,this.pbrMode=It.Disabled,this.normalType=Ii.Attribute,this.spherical=!1,this.doublePrecisionRequiresObfuscation=!1,this.hasVertexColors=!1,this.hasNormals=!1,this.hasSlicePlane=!1,this.hasBaseColorTexture=!1,this.receiveAmbientOcclusion=!0,this.receiveShadows=!0,this.blendingEnabled=!0,this.hasScreenSpaceReflections=!1,this.hasPolygonOffset=!1,this.hasMetalnessAndRoughnessTexture=!1,this.hasEmissionTexture=!1,this.hasOcclusionTexture=!1,this.hasNormalTexture=!1,this.hasOccludees=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1,this.isGround=!1,this.hasCloudsReflections=!0,this.snowCover=!1}}d([H({count:K.COUNT})],pr.prototype,"output",void 0),d([H({count:ws.COUNT})],pr.prototype,"textureCoordinateType",void 0),d([H({count:Ap.COUNT})],pr.prototype,"componentData",void 0),d([H({count:pi.COUNT})],pr.prototype,"cullFace",void 0),d([H({count:Lh.COUNT})],pr.prototype,"vertexDiscardMode",void 0),d([H({count:Yi.COUNT})],pr.prototype,"doubleSidedMode",void 0),d([H({count:ui.COUNT})],pr.prototype,"alphaDiscardMode",void 0),d([H({count:nu.COUNT})],pr.prototype,"integratedMeshMode",void 0),d([H({count:yt.COUNT})],pr.prototype,"transparencyPassType",void 0),d([H({count:am.COUNT})],pr.prototype,"ellipsoidMode",void 0),d([H({count:It.COUNT})],pr.prototype,"pbrMode",void 0),d([H({count:Ii.COUNT})],pr.prototype,"normalType",void 0),d([H()],pr.prototype,"spherical",void 0),d([H()],pr.prototype,"doublePrecisionRequiresObfuscation",void 0),d([H()],pr.prototype,"hasVertexColors",void 0),d([H()],pr.prototype,"hasNormals",void 0),d([H()],pr.prototype,"hasSlicePlane",void 0),d([H()],pr.prototype,"hasBaseColorTexture",void 0),d([H()],pr.prototype,"receiveAmbientOcclusion",void 0),d([H()],pr.prototype,"receiveShadows",void 0),d([H()],pr.prototype,"blendingEnabled",void 0),d([H()],pr.prototype,"hasScreenSpaceReflections",void 0),d([H()],pr.prototype,"hasPolygonOffset",void 0),d([H()],pr.prototype,"hasMetalnessAndRoughnessTexture",void 0),d([H()],pr.prototype,"hasEmissionTexture",void 0),d([H()],pr.prototype,"hasOcclusionTexture",void 0),d([H()],pr.prototype,"hasNormalTexture",void 0),d([H()],pr.prototype,"hasOccludees",void 0),d([H()],pr.prototype,"hasMultipassTerrain",void 0),d([H()],pr.prototype,"cullAboveGround",void 0),d([H()],pr.prototype,"isGround",void 0),d([H()],pr.prototype,"hasCloudsReflections",void 0),d([H()],pr.prototype,"snowCover",void 0),d([H({constValue:zr.Draw})],pr.prototype,"pbrTextureBindType",void 0),d([H({constValue:!0})],pr.prototype,"hasSliceHighlight",void 0),d([H({constValue:!1})],pr.prototype,"hasSliceInVertexProgram",void 0),d([H({constValue:!1})],pr.prototype,"useCustomDTRExponentForWater",void 0),d([H({constValue:!1})],pr.prototype,"hasVertexTangents",void 0),d([H({constValue:!0})],pr.prototype,"supportsTextureAtlas",void 0),d([H({constValue:!1})],pr.prototype,"highStepCount",void 0),d([H({constValue:!1})],pr.prototype,"instancedDoublePrecision",void 0),d([H({constValue:!0})],pr.prototype,"useFillLights",void 0);function ibe(e,t){e.include(Lx,t),e.fragment.include(pR);const r=e.fragment;r.uniforms.add(new Pk("baseColor",i=>i.baseColor)),r.uniforms.add(new VRe("objectOpacity",i=>i.objectOpacity)),t.hasVertexColors?r.code.add(S`vec3 _baseColor() {
return baseColor.rgb * vColor.rgb;
}
float _baseOpacity() {
return baseColor.a * vColor.a;
}`):r.code.add(S`vec3 _baseColor() {
return baseColor.rgb;
}
float _baseOpacity() {
return baseColor.a;
}`),r.code.add(S`vec4 computeMaterialColor(vec4 textureColor, vec4 externalColor, int externalColorMixMode) {
vec3 baseColor = _baseColor();
float baseOpacity = _baseOpacity();
vec3 color = mixExternalColor(
baseColor,
textureColor.rgb,
externalColor.rgb,
externalColorMixMode
);
float opacity = objectOpacity * mixExternalOpacity(
baseOpacity,
textureColor.a,
externalColor.a,
externalColorMixMode
);
return vec4(color, opacity);
}`)}function nbe(e,t){const r=e.fragment;switch(t.doubleSidedMode){case Yi.None:r.code.add(S`vec3 _adjustDoublesided(vec3 normal) {
return normal;
}`);break;case Yi.View:e.include(s5,t),r.code.add(S`vec3 _adjustDoublesided(vec3 normal) {
return dot(normal, vPositionWorldCameraRelative) > 0.0 ? -normal : normal;
}`);break;case Yi.WindingOrder:r.code.add(S`vec3 _adjustDoublesided(vec3 normal) {
return gl_FrontFacing ? normal : -normal;
}`);break;default:t.doubleSidedMode;case Yi.COUNT:}switch(t.normalType){case Ii.Attribute:case Ii.CompressedAttribute:e.include(fU,t),r.code.add(S`vec3 shadingNormalWorld() {
return _adjustDoublesided(normalize(vNormalWorld));
}
vec3 shadingNormal_view() {
vec3 normal = normalize(vNormalView);
return gl_FrontFacing ? normal : -normal;
}`);break;case Ii.ScreenDerivative:e.extensions.add("GL_OES_standard_derivatives"),e.include(s5,t),r.code.add(S`vec3 shadingNormalWorld() {
return normalize(cross(
dFdx(vPositionWorldCameraRelative),
dFdy(vPositionWorldCameraRelative)
));
}
vec3 shadingNormal_view() {
return normalize(cross(dFdx(vPosition_view),dFdy(vPosition_view)));
}`);break;case Ii.Ground:t.spherical?(e.include(s5,t),r.code.add(S`vec3 shadingNormalWorld() {
return normalize(positionWorld());
}`)):r.code.add(S`vec3 shadingNormalWorld() {
return vec3(0.0, 0.0, 1.0);
}`),e.extensions.add("GL_OES_standard_derivatives"),r.code.add(S`vec3 shadingNormal_view() {
return normalize(cross(dFdx(vPosition_view),dFdy(vPosition_view))).xyz;
}`);break;default:t.normalType;case Ii.COUNT:}}function s6t(e,t){const r=e.fragment;if(t.hasBaseColorTexture){e.include(nse,t);const i=t.textureCoordinateType===ws.Atlas;r.uniforms.add(d7("baseColorTexture",n=>n.texture,i)),i?(e.include(JEe),r.code.add(S`vec4 readBaseColorTexture() {
return textureAtlasLookup(baseColorTexture, baseColorTextureSize, vuv0, vuvRegion);
}`)):r.code.add(S`vec4 readBaseColorTexture() {
return texture2D(baseColorTexture, vuv0);
}`)}else r.code.add(S`vec4 readBaseColorTexture() { return vec4(1.0); }`)}const ePe=new Map([[O.POSITION,0],[O.NORMAL,1],[O.NORMALCOMPRESSED,1],[O.COLOR,2],[O.UV0,3],[O.UVREGION,4],[O.COMPONENTINDEX,5]]);function a6t(e){const t=new Qr;t.include(s5,e),t.include(fU,e),t.include(Lx,e),t.include(hy,e),t.include(LO,e),t.include(t6t,e),t.include(Hbt,e),t.include(dmt,e),t.include(s6t,e),t.include(n6t,e);const{vertex:r,fragment:i}=t;i.uniforms.add(new Jv("view")),e.pbrMode!==It.Normal&&e.pbrMode!==It.Schematic||(t.include(lse,e),e.hasNormalTexture&&t.include(BRe,e)),e.output===K.Shadow&&e.componentData===Ap.Varying?r.code.add(S`#define discardShadows(castShadows) { if(!castShadows) { gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`):r.code.add(S`#define discardShadows(castShadows) {}`);const n=e.integratedMeshMode===nu.ColorOverlay||e.integratedMeshMode===nu.ColorOverlayWithWater,s=n&&e.output===K.Color&&e.pbrMode===It.WaterOnIntegratedMesh;return n&&(t.include(ox,e),t.include(l5t,e),e.spherical?r.code.add(S`
      const float invEllipsoidRadius = ${S.float(1/(e.ellipsoidMode===am.Earth?$r.radius:e.ellipsoidMode===am.Mars?em.radius:Ay.radius))};
      vec2 projectOverlay(vec3 pos) {
        return pos.xy / (1.0 + invEllipsoidRadius * pos.z);
      }
      `):r.code.add(S`vec2 projectOverlay(vec3 pos) { return pos.xy; }`)),s&&(t.varyings.add("tbnTangent","vec3"),t.varyings.add("tbnBiTangent","vec3"),t.varyings.add("groundNormal","vec3")),r.code.add(S`
    void main() {
      bool castShadows;
      vec4 externalColor = forwardExternalColor(castShadows);
      discardShadows(castShadows);

      vertexDiscardByOpacity(externalColor.a);

      if (externalColor.a < ${S.float(ao)}) {
        // Discard this vertex
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }

      forwardPosition(readElevationOffset());
      forwardNormal();
      forwardTextureCoordinates();
      forwardVertexColor();
      forwardLinearDepth();
      ${s?e.spherical?S`
                groundNormal = normalize(positionWorld());
                tbnTangent = normalize(cross(vec3(0.0, 0.0, 1.0), groundNormal));
                tbnBiTangent = normalize(cross(groundNormal, tbnTangent));`:S`
                groundNormal = vec3(0.0, 0.0, 1.0);
                tbnTangent = vec3(1.0, 0.0, 0.0);
                tbnBiTangent = vec3(0.0, 1.0, 0.0);`:""}
      ${n?S`setOverlayVTC(projectOverlay(position));`:""}
    }
  `),e.output===K.Alpha&&(i.include(Ou),t.include(Mu,e),t.include(ibe,e),n&&i.uniforms.add(new Wt("ovColorTex",(a,o)=>RK(a,o))),i.code.add(S`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);
        ${e.hasMultipassTerrain?S`terrainDepthTest(gl_FragCoord, vPosition_view.z);`:""}

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        vec4 externalColor;
        int externalColorMixMode;
        readExternalColor(externalColor, externalColorMixMode);

        vec4 materialColor = computeMaterialColor(
          textureColor,
          externalColor,
          externalColorMixMode
        );
        ${n?S`
                vec4 overlayColor = getOverlayColor(ovColorTex, vtcOverlay);
                materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;`:""}

        gl_FragColor = vec4(materialColor.a);
      }
    `)),e.output===K.Color&&(i.include(Ou),t.include(Mu,e),t.include(ibe,e),t.include(nbe,e),t.include(ox,e),e.receiveShadows?(t.include(pU,e),i.code.add(S`float evaluateShadow() {
return readShadowMap(vPositionWorldCameraRelative, linearDepth);
}`)):i.code.add(S`float evaluateShadow() { return 0.0; }`),n&&i.uniforms.add(new Wt("ovColorTex",(a,o)=>RK(a,o))),i.code.add(S`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);
        ${e.hasMultipassTerrain?S`terrainDepthTest(gl_FragCoord, vPosition_view.z);`:""}

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        vec4 externalColor;
        int externalColorMixMode;
        readExternalColor(externalColor, externalColorMixMode);

        vec4 materialColor = computeMaterialColor(
          textureColor,
          externalColor,
          externalColorMixMode
        );
        ${n?S`vec4 overlayColor = getOverlayColor(ovColorTex, vtcOverlay);`:""}
    `),e.pbrMode===It.Normal||e.pbrMode===It.Schematic?(i.uniforms.add(new St("lightingMainIntensity",(a,o)=>o.lighting.mainLight.intensity)),i.code.add(S`
        ${e.pbrMode===It.Normal?S`
                applyPBRFactors();
                if (int(externalColorMixMode) == 3) {
                  mrr = vec3(0.0, 0.6, 0.2);
                }`:""}
        vec3 normalVertex = shadingNormalWorld();
        float additionalIrradiance = 0.02 * lightingMainIntensity[2];
      `),e.hasNormalTexture?i.code.add(S`mat3 tangentSpace = computeTangentSpace(normalVertex, vPositionWorldCameraRelative, vuv0);
vec3 shadingNormal = computeTextureNormal(tangentSpace, vuv0);`):i.code.add(S`vec3 shadingNormal = normalVertex;`),i.code.add(S`${e.spherical?S`vec3 normalGround = normalize(positionWorld());`:S`vec3 normalGround = vec3(0.0, 0.0, 1.0);`}
      `),i.code.add(S`
        vec3 viewDir = normalize(vPositionWorldCameraRelative);
        float ssao = 1.0 - occlusion * (1.0 - evaluateAmbientOcclusion());

        ${e.snowCover?S`
                vec3 surfaceNormal = normalize(shadingNormalWorld());
                float snow = smoothstep(0.5, 0.55, dot(surfaceNormal, normalize(positionWorld())));
                materialColor.rgb = mix(materialColor.rgb, vec3(1), snow);

                shadingNormal = mix(shadingNormal, surfaceNormal, snow);
                ssao = mix(ssao, 0.0, snow);
                mrr = mix(mrr, vec3(0.0, 1.0, 0.04), snow);
                emission = mix(emission, vec3(0.0), snow);`:""}

        ${n?S` materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;`:""}

        vec3 additionalLight = evaluateAdditionalLighting(ssao, positionWorld());
        vec4 shadedColor = vec4(evaluateSceneLightingPBR(shadingNormal, materialColor.rgb, evaluateShadow(), ssao, additionalLight, viewDir, normalGround, mrr, emission, additionalIrradiance), materialColor.a);
        `)):(e.receiveShadows?i.code.add(S`float shadow = evaluateShadow();`):e.spherical?(i.uniforms.add(new He("lightingGlobalFactor",(a,o)=>o.lighting.globalFactor)),i.code.add(S`float additionalAmbientScale = additionalDirectedAmbientLight(positionWorld());
float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);`)):i.code.add(S`float shadow = 0.0;`),s&&i.uniforms.add(new Wt("ovNormalTex",(a,o)=>ioe(o))),e.snowCover&&(t.extensions.add("GL_OES_standard_derivatives"),i.code.add(S`vec3 surfaceNormal = normalize(cross(dFdx(vPositionWorldCameraRelative), dFdy(vPositionWorldCameraRelative)));
float snow = smoothstep(0.5, 0.55, dot(surfaceNormal, normalize(positionWorld())));
materialColor.rgb = mix(materialColor.rgb, vec3(1), snow);`)),i.code.add(S`
        float ambientOcclusion = evaluateAmbientOcclusion();
        vec3 additionalLight = evaluateAdditionalLighting(ambientOcclusion, positionWorld());

        ${n?S` materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;`:""}

        vec4 shadedColor = vec4(evaluateSceneLighting(shadingNormalWorld(), materialColor.rgb, shadow, ambientOcclusion, additionalLight), materialColor.a);
      ${s?S`
              vec4 overlayWaterMask = getOverlayColor(ovNormalTex, vtcOverlay);
              float waterNormalLength = length(overlayWaterMask);
              if (waterNormalLength > 0.95) {
                mat3 tbnMatrix = mat3(tbnTangent, tbnBiTangent, groundNormal);
                vec4 waterColorLinear = getOverlayWaterColor(overlayWaterMask, overlayColor, -normalize(vPositionWorldCameraRelative), shadow, groundNormal, tbnMatrix, vPosition_view, positionWorld());
                vec4 waterColorNonLinear = delinearizeGamma(vec4(waterColorLinear.xyz, 1.0));
                // un-gamma the ground color to mix in linear space
                shadedColor = mix(shadedColor, waterColorNonLinear, waterColorLinear.w);
              }`:""}
      `)),i.code.add(S`
        gl_FragColor = highlightSlice(shadedColor, vPositionWorldCameraRelative);
        ${e.transparencyPassType===yt.Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}
      }
    `)),e.output!==K.Depth&&e.output!==K.Shadow||(t.include(x_,e),i.code.add(S`void main() {
discardBySlice(vPositionWorldCameraRelative);
vec4 textureColor = readBaseColorTexture();
discardOrAdjustAlpha(textureColor);
outputDepth(linearDepth);
}`)),e.output===K.Normal&&(t.include(nbe,e),i.code.add(S`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        // note: the alpha component needs to be 1.0 in order for this material
        // to influence ambient occlusion, see the ssao fragment shader
        float alpha = ${e.normalType===Ii.Ground?"0.0":"1.0"};
        gl_FragColor = vec4(vec3(.5) + .5 * shadingNormal_view(), alpha);
      }
    `)),e.output===K.Highlight&&(t.include(Ky),i.code.add(S`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        ${n?S`
                vec4 overlayColor = getCombinedOverlayColor();
                if (overlayColor.a == 0.0) {
                  gl_FragColor = vec4(0.0);
                  return;
                }`:""}

        outputHighlight();
      }
    `)),t}function ioe(e){return e.overlays.length===0?null:e.overlays[ji.INNER].getValidTexture(In.Water)}const o6t=Object.freeze(Object.defineProperty({__proto__:null,attributeLocations:ePe,build:a6t,getOverlayNormalTexture:ioe},Symbol.toStringTag,{value:"Module"}));class HU extends gi{bindDraw(t,r){const i=this.program;i.bindDraw(t,r),i.rebindTextures(),t.componentParameters.type===Ap.Varying&&t.componentParameters.texture.bind(i,"componentColorTex","componentColorTexInvDim")}initializeConfiguration(t,r){r.spherical=t.viewingMode===Be.Global,r.doublePrecisionRequiresObfuscation=$O(t.rctx)}initializeProgram(t){const r=HU.shader.get(),i=r.build(this.configuration);return new ai(t.rctx,i,r.attributeLocations)}_setPipelineState(t){const r=this.configuration,i=r.integratedMeshMode!==nu.None,n=t===yt.NONE,s=t===yt.FrontFace;return jt({blending:r.output!==K.Color&&r.output!==K.Alpha||!r.blendingEnabled?null:n?wu:eb(t),culling:Mz(r.cullFace),depthTest:{func:w_(t)},depthWrite:n||s?fc:null,colorWrite:or,stencilWrite:i||r.hasOccludees?xm:null,stencilTest:i?jyt(oc.IntegratedMeshMaskExcluded):r.hasOccludees?T_:null,polygonOffset:n||s?r.hasPolygonOffset?{factor:2,units:2}:null:tU})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}}HU.shader=new si(o6t,()=>ie(()=>import("./ComponentShader.glsl.90e3eca7.js"),[],import.meta.url));class l6t extends as{constructor(){super(...arguments),this._dirty=!0}_setDirty(){this._dirty=!0}_setClean(){if(this._dirty=!1,this._parameterBlocks!=null)for(const t of this._parameterBlocks)this[t]._setClean()}get dirty(){return this._dirty||this._checkParameterBlocksDirty()}_checkParameterBlocksDirty(){if(this._parameterBlocks==null)return!1;for(const t of this._parameterBlocks)if(this[t].dirty)return!0;return!1}}class noe{constructor(){this._dirty=!0}_setDirty(){this._dirty=!0}_setClean(){this._dirty=!1}get dirty(){return this._dirty}}function Ki(e={}){return(t,r)=>{var n;const i=(n=t._parameterCount)!=null?n:0;if(t._parameterCount=i+1,e.vectorOps){const s=e.vectorOps;Object.defineProperty(t,r,{get(){return this[i]},set(a){const o=this[i];if(o==null)this[i]=a;else{if(s.equals(o,a))return;s.copy(o,a)}this._setDirty()}})}else Object.defineProperty(t,r,{get(){return this[i]},set(s){this[i]!==s&&(e.dispose&&this[i]&&this[i].dispose(),this[i]=s,this._setDirty())}})}}function sbe(){return(e,t)=>{var i;const r=(i=e._parameterCount)!=null?i:0;e._parameterCount=r+1,e._parameterBlocks=e._parameterBlocks||[],e._parameterBlocks.push(r),Object.defineProperty(e,t,{get(){return this[r]},set(n){this[r]!==n&&(this[r]=n,this._setDirty())}})}}class WU{constructor(t){this._low=Mr(),this._high=Mr(),t&&this.set(t)}get low(){return this._low}get high(){return this._high}set(t){const r=this._low,i=this._high;oe(r,t),pd(i,t,r)}setElements(t,r,i){ne(abe,t,r,i),this.set(abe)}get(t){return he(t,this._low,this._high)}getLowScaled(t){return le(t,this._low,1)}}const abe=M();class Ys extends l6t{constructor(t,r){super(),this.toMapSpace=r,this.baseColor=nf(1,1,1,1),this.usePBR=!1,this.hasParametersFromSource=!1,this.mrrFactors=Dr(1,1,.5),this.emissiveFactor=Dr(0,0,0),this.baseColorTexture=null,this.metallicRoughnessTexture=null,this.emissionTexture=null,this.occlusionTexture=null,this.normalTexture=null,this.objectOpacity=1,this.commonMaterialParameters=new PD,this.componentParameters=new R7,this.textureAlphaCutoff=ok,this.alphaDiscardMode=ui.Opaque,this.isIntegratedMesh=!1,this.polygonOffsetEnabled=!1,this.ellipsoidMode=am.Earth,this.hasOccludees=!1,this._techniqueConfiguration=new pr;const i=new WU(t.position),n=KOe(t.rotationScale);Ix(n,n),this.transformNormalGlobalFromModel=Kh(n,n),this.transformWorldFromModelTL=i.low,this.transformWorldFromModelTH=i.high,this.transformWorldFromModelRS=t.rotationScale}dispose(){this._technique=ri(this._technique),this.baseColorTexture=null,this.metallicRoughnessTexture=null,this.emissionTexture=null,this.occlusionTexture=null,this.normalTexture=null}get texture(){return _(this.baseColorTexture)?this.baseColorTexture.glTexture:null}get textureMetallicRoughness(){return _(this.metallicRoughnessTexture)?this.metallicRoughnessTexture.glTexture:null}get textureEmissive(){return _(this.emissionTexture)?this.emissionTexture.glTexture:null}get textureOcclusion(){return _(this.occlusionTexture)?this.occlusionTexture.glTexture:null}get textureNormal(){return _(this.normalTexture)?this.normalTexture.glTexture:null}prepareTechnique(t,r,i,n){const s=this._techniqueConfiguration;s.hasVertexColors=n.colors,s.hasNormals=n.normals,s.textureCoordinateType=n.textureCoordinates,s.hasMetalnessAndRoughnessTexture=_(this.metallicRoughnessTexture),s.hasEmissionTexture=_(this.emissionTexture),s.hasOcclusionTexture=_(this.occlusionTexture),s.hasNormalTexture=_(this.normalTexture),s.transparencyPassType=r.identifier===lu.Material&&i.transparencyPassType!=null?i.transparencyPassType:yt.NONE,s.hasMultipassTerrain=r.identifier===lu.Material&&i.multipassTerrain!=null&&i.multipassTerrain.enabled,s.cullAboveGround=r.identifier===lu.Material&&i.multipassTerrain!=null&&i.multipassTerrain.cullAboveGround,s.ellipsoidMode=this.ellipsoidMode,s.componentData=this.componentParameters.type,s.cullFace=this.commonMaterialParameters.cullFace,s.doubleSidedMode=this.commonMaterialParameters.doubleSided?Yi.View:Yi.None,s.hasBaseColorTexture=_(this.baseColorTexture);const a=this._computeWhichMaterialPass();s.blendingEnabled=a===il.Transparent||a===il.OpaqueAndTransparent,s.alphaDiscardMode=this.alphaDiscardMode,s.integratedMeshMode=this.isIntegratedMesh?u6t(i)?ioe(i)?nu.ColorOverlayWithWater:nu.ColorOverlay:nu.NoOverlay:nu.None,s.isGround=this.isIntegratedMesh,s.hasPolygonOffset=this.polygonOffsetEnabled;const o=this.hasParametersFromSource&&R(this.baseColorTexture);return s.pbrMode=s.integratedMeshMode===nu.ColorOverlayWithWater?It.WaterOnIntegratedMesh:this.usePBR?o?It.Schematic:It.Normal:It.Disabled,s.normalType=s.integratedMeshMode===nu.None?s.hasNormals?Ii.CompressedAttribute:Ii.ScreenDerivative:Ii.Ground,s.hasSlicePlane=_(i.slicePlane)&&this.commonMaterialParameters.hasSlicePlane,r.identifier===lu.ShadowMap?(s.output=K.Shadow,s.vertexDiscardMode=Lh.None):r.identifier===lu.Highlight?(s.output=K.Highlight,s.vertexDiscardMode=Lh.None):(this._computeWhichMaterialPass()===il.OpaqueAndTransparent?s.vertexDiscardMode=r.transparent?Lh.Opaque:Lh.Transparent:s.vertexDiscardMode=Lh.None,s.output=c6t(r.subPass),r.subPass===Ea.Alpha&&(s.hasOccludees=i.hasOccludees),r.subPass===Ea.Color?(s.receiveAmbientOcclusion=i.ssaoHelper.ready,s.hasOccludees=i.hasOccludees,s.receiveShadows=i.shadowMap.ready,s.hasScreenSpaceReflections=i.ssr.enabled,s.hasCloudsReflections=_(i.clouds.data)):(s.receiveAmbientOcclusion=!1,s.receiveShadows=!1),s.snowCover=this.hasSnowCover(i)),this._technique=t.releaseAndAcquire(HU,s,this._technique),this._setClean(),this._technique}hasSnowCover(t){return _(t.weather)&&t.weatherVisible&&t.weather.type==="snowy"&&t.weather.snowCover==="enabled"}submit(t,r,i){if(this.objectOpacity===0)return;const n=i.renderable.geometry,s=i.components,a=i.renderable.meta.cameraDepthSquared,o=s.geometryRanges,l=s.highlightRanges,c=s.defaultShadowMapRanges;switch(this._computeWhichMaterialPass()){case il.Opaque:t.materialOpaque.submitDraw(this,n,o,a);break;case il.Transparent:t.materialTransparent.submitDraw(this,n,o,a);break;case il.OpaqueAndTransparent:t.materialOpaque.submitDraw(this,n,o,a),t.materialTransparent.submitDraw(this,n,o,a);break;case il.IntegratedMesh:t.materialIntegratedMesh.submitDraw(this,n,o,a),d6t(r)&&t.highlightIntegratedMesh.submitDraw(this,n,o,a)}const u=this.componentParameters.castShadows!==Ds.None;u&&t.shadowMap.submitDraw(this,n,o,a),_(l)&&(t.highlight.submitDraw(this,n,l,a),u&&t.highlightShadowMap.submitDraw(this,n,l,a)),u&&_(c)&&t.defaultShadowMap.submitDraw(this,n,c,a)}get attributeLocations(){return ePe}_computeWhichMaterialPass(){return this.isIntegratedMesh?il.IntegratedMesh:this.objectOpacity<1?il.Transparent:this.componentParameters.opaqueOverride===Ds.All?il.Opaque:this.baseColor[3]<1||this.alphaDiscardMode===ui.Blend||this.alphaDiscardMode===ui.MaskBlend?il.Transparent:this.componentParameters.transparent===Ds.None?il.Opaque:this.componentParameters.transparent===Ds.All?il.Transparent:il.OpaqueAndTransparent}}var obe,il,Ds;d([Ki({vectorOps:wwe})],Ys.prototype,"baseColor",void 0),d([Ki()],Ys.prototype,"usePBR",void 0),d([Ki()],Ys.prototype,"hasParametersFromSource",void 0),d([Ki({vectorOps:Dce})],Ys.prototype,"mrrFactors",void 0),d([Ki({vectorOps:Dce})],Ys.prototype,"emissiveFactor",void 0),d([Ki({dispose:!0})],Ys.prototype,"baseColorTexture",void 0),d([Ki({dispose:!0})],Ys.prototype,"metallicRoughnessTexture",void 0),d([Ki({dispose:!0})],Ys.prototype,"emissionTexture",void 0),d([Ki({dispose:!0})],Ys.prototype,"occlusionTexture",void 0),d([Ki({dispose:!0})],Ys.prototype,"normalTexture",void 0),d([Ki()],Ys.prototype,"objectOpacity",void 0),d([sbe()],Ys.prototype,"commonMaterialParameters",void 0),d([sbe()],Ys.prototype,"componentParameters",void 0),d([Ki()],Ys.prototype,"textureAlphaCutoff",void 0),d([Ki()],Ys.prototype,"alphaDiscardMode",void 0),d([Ki()],Ys.prototype,"isIntegratedMesh",void 0),d([Ki()],Ys.prototype,"polygonOffsetEnabled",void 0),d([Ki()],Ys.prototype,"ellipsoidMode",void 0),d([Ki()],Ys.prototype,"hasOccludees",void 0),function(e){e[e.VERTEX=0]="VERTEX",e[e.GROUND=1]="GROUND",e[e.SCREEN_DERIVATIVE=2]="SCREEN_DERIVATIVE"}(obe||(obe={})),function(e){e[e.Opaque=0]="Opaque",e[e.Transparent=1]="Transparent",e[e.OpaqueAndTransparent=2]="OpaqueAndTransparent",e[e.IntegratedMesh=3]="IntegratedMesh"}(il||(il={}));class PD extends noe{constructor(){super(...arguments),this.doubleSided=!1,this.cullFace=pi.Back,this.hasSlicePlane=!0}}d([Ki()],PD.prototype,"doubleSided",void 0),d([Ki()],PD.prototype,"cullFace",void 0),d([Ki()],PD.prototype,"hasSlicePlane",void 0);class R7 extends noe{constructor(){super(...arguments),this.externalColor=nf(1,1,1,1),this.externalColorMixMode=Dn.Multiply,this.castShadows=Ds.All}get transparent(){return this.externalColor[3]<1?Ds.All:Ds.None}get opaqueOverride(){return this.externalColorMixMode===Dn.Replace&&this.externalColor[3]===1?Ds.All:Ds.None}get visible(){return this.externalColor[3]>0?Ds.All:Ds.None}get type(){return Ap.Uniform}}d([Ki({vectorOps:wwe})],R7.prototype,"externalColor",void 0),d([Ki()],R7.prototype,"externalColorMixMode",void 0),d([Ki()],R7.prototype,"castShadows",void 0),function(e){e[e.All=0]="All",e[e.Some=1]="Some",e[e.None=2]="None"}(Ds||(Ds={}));class pC extends noe{constructor(){super(...arguments),this.texture=null,this.transparent=Ds.None,this.opaqueOverride=Ds.None,this.castShadows=Ds.None}get type(){return Ap.Varying}}function c6t(e){switch(e){case Ea.Color:return K.Color;case Ea.Alpha:return K.Alpha;case Ea.Depth:return K.Depth;case Ea.Normal:return K.Normal}}function d6t(e){return e.overlays.length!==0&&_(e.overlays[ji.INNER].getValidTexture(In.Highlight))}function u6t(e){return e.overlays.length!==0&&_(e.overlays[ji.INNER].getColorTextureNoRasterImage())}d([Ki()],pC.prototype,"texture",void 0),d([Ki()],pC.prototype,"transparent",void 0),d([Ki()],pC.prototype,"opaqueOverride",void 0),d([Ki()],pC.prototype,"castShadows",void 0);const CR=gn().vec3f(O.POSITION).u16(O.COMPONENTINDEX).u16(O.U16PADDING),tPe=gn().vec2u8(O.SIDENESS),lbe=vd(tPe),rPe=gn().vec3f(O.POSITION0).vec3f(O.POSITION1).u16(O.COMPONENTINDEX).u8(O.VARIANTOFFSET,{glNormalized:!0}).u8(O.VARIANTSTROKE).u8(O.VARIANTEXTENSION,{glNormalized:!0}).u8(O.U8PADDING,{glPadding:!0}).u16(O.U16PADDING,{glPadding:!0}),NK=rPe.clone().vec3f(O.NORMAL),kK=rPe.clone().vec3f(O.NORMALA).vec3f(O.NORMALB),VK=new Map([[O.POSITION0,0],[O.POSITION1,1],[O.COMPONENTINDEX,2],[O.VARIANTOFFSET,3],[O.VARIANTSTROKE,4],[O.VARIANTEXTENSION,5],[O.NORMAL,6],[O.NORMALA,6],[O.NORMALB,7],[O.SIDENESS,8]]);function cbe(e,t,r){const i=t/3,n=new Uint32Array(r+1),s=new Uint32Array(r+1),a=(v,x)=>{v<x?n[v+1]++:s[x+1]++};for(let v=0;v<i;v++){const x=e[3*v],T=e[3*v+1],E=e[3*v+2];a(x,T),a(T,E),a(E,x)}let o=0,l=0;for(let v=0;v<r;v++){const x=n[v+1],T=s[v+1];n[v+1]=o,s[v+1]=l,o+=x,l+=T}const c=new Uint32Array(6*i),u=n[r],h=(v,x,T)=>{if(v<x){const E=n[v+1]++;c[2*E]=x,c[2*E+1]=T}else{const E=s[x+1]++;c[2*u+2*E]=v,c[2*u+2*E+1]=T}};for(let v=0;v<i;v++){const x=e[3*v],T=e[3*v+1],E=e[3*v+2];h(x,T,v),h(T,E,v),h(E,x,v)}const p=(v,x)=>{const T=2*v,E=x-v;for(let C=1;C<E;C++){const A=c[T+2*C],P=c[T+2*C+1];let I=C-1;for(;I>=0&&c[T+2*I]>A;I--)c[T+2*I+2]=c[T+2*I],c[T+2*I+3]=c[T+2*I+1];c[T+2*I+2]=A,c[T+2*I+3]=P}};for(let v=0;v<r;v++)p(n[v],n[v+1]),p(u+s[v],u+s[v+1]);const m=new Int32Array(3*i),g=(v,x)=>v===e[3*x]?0:v===e[3*x+1]?1:v===e[3*x+2]?2:-1,b=(v,x)=>{const T=g(v,x);m[3*x+T]=-1},w=(v,x,T,E)=>{const C=g(v,x);m[3*x+C]=E;const A=g(T,E);m[3*E+A]=x};for(let v=0;v<r;v++){let x=n[v];const T=n[v+1];let E=s[v];const C=s[v+1];for(;x<T&&E<C;){const A=c[2*x],P=c[2*u+2*E];A===P?(w(v,c[2*x+1],P,c[2*u+2*E+1]),x++,E++):A<P?(b(v,c[2*x+1]),x++):(b(P,c[2*u+2*E+1]),E++)}for(;x<T;)b(v,c[2*x+1]),x++;for(;E<C;)b(c[2*u+2*E],c[2*u+2*E+1]),E++}return m}function Ik(e,t){return t.push(e.buffer),{buffer:e.buffer,layout:h6t(e.layout)}}function o$(e){return f6t(e.layout).createView(e.buffer)}function h6t(e){const t=new Array;return e.fields.forEach((r,i)=>{const n={...r,constructor:iPe(r.constructor)};t.push([i,n])}),{stride:e.stride,fields:t,fieldNames:e.fieldNames}}function f6t(e){const t=gn();return t.stride=e.stride,t.fieldNames=e.fieldNames,e.fields.forEach(r=>t.fields.set(r[0],{...r[1],constructor:m6t(r[1].constructor)})),t}const p6t=[_O,ef,Zr,ca,Fp,b9,v9,_9,Nn,Yw,Kv,e_,ky,Zw,t_,pc,Qw,w9,Jw,r_,Kw,x9,GA,jA,T9,ex,qA,HA,WA,tx,XA,YA,ZA,QA,JA,KA];function iPe(e){return`${e.ElementType}_${e.ElementCount}`}function m6t(e){return nPe.get(e)}const nPe=new Map;p6t.forEach(e=>nPe.set(iPe(e),e));class sPe{updateSettings(t){this.settings=t,this.edgeHashFunction=t.reducedPrecision?y6t:g6t}write(t,r,i){const n=this.edgeHashFunction(i);c$.seed=n;const s=c$.getIntRange(0,255),a=c$.getIntRange(0,this.settings.variants-1),o=.7,l=c$.getFloat(),c=255*(.5*b6t(-(1-Math.min(l/o,1))+Math.max(0,l-o)/(1-o),1.2)+.5);t.position0.setVec(r,i.position0),t.position1.setVec(r,i.position1),t.componentIndex.set(r,i.componentIndex),t.variantOffset.set(r,s),t.variantStroke.set(r,a),t.variantExtension.set(r,c)}trim(t,r){return t.slice(0,r)}}const soe=new Float32Array(6),$k=new Uint32Array(soe.buffer),bv=new Uint32Array(1);function g6t(e){const t=soe;t[0]=e.position0[0],t[1]=e.position0[1],t[2]=e.position0[2],t[3]=e.position1[0],t[4]=e.position1[1],t[5]=e.position1[2],bv[0]=5381;for(let r=0;r<$k.length;r++)bv[0]=31*bv[0]+$k[r];return bv[0]}function y6t(e){const t=soe;t[0]=DT(e.position0[0]),t[1]=DT(e.position0[1]),t[2]=DT(e.position0[2]),t[3]=DT(e.position1[0]),t[4]=DT(e.position1[1]),t[5]=DT(e.position1[2]),bv[0]=5381;for(let r=0;r<$k.length;r++)bv[0]=31*bv[0]+$k[r];return bv[0]}const dbe=1e4;function DT(e){return Math.round(e*dbe)/dbe}function b6t(e,t){const r=e<0?-1:1;return Math.abs(e)**t*r}class Lk{constructor(){this.commonWriter=new sPe}updateSettings(t){this.commonWriter.updateSettings(t)}allocate(t){return NK.createBuffer(t)}write(t,r,i){this.commonWriter.write(t,r,i),he(l$,i.faceNormal0,i.faceNormal1),we(l$,l$),t.normal.setVec(r,l$)}trim(t,r){return this.commonWriter.trim(t,r)}}Lk.Layout=NK,Lk.glLayout=vd(NK,1);class Dk{constructor(){this.commonWriter=new sPe}updateSettings(t){this.commonWriter.updateSettings(t)}allocate(t){return kK.createBuffer(t)}write(t,r,i){this.commonWriter.write(t,r,i),t.normalA.setVec(r,i.faceNormal0),t.normalB.setVec(r,i.faceNormal1)}trim(t,r){return this.commonWriter.trim(t,r)}}Dk.Layout=kK,Dk.glLayout=vd(kK,1);const l$=M(),c$=new Sh,a3=-1;var Fk;function zK(e,t,r,i=S6t){const n=e.vertices.position,s=e.vertices.componentIndex,a=kt(i.anglePlanar),o=kt(i.angleSignificantEdge),l=Math.cos(o),c=Math.cos(a),u=UK.edge,h=u.position0,p=u.position1,m=u.faceNormal0,g=u.faceNormal1,b=T6t(e),w=x6t(e),v=w.length/4,x=t.allocate(v);let T=0;const E=v,C=r.allocate(E);let A=0,P=0,I=0;const L=XDe(0,v),V=new Float32Array(v);ZDe(V,(ce,se,D)=>{n.getVec(w[4*se+0],h),n.getVec(w[4*se+1],p),D[se]=fi(h,p)}),L.sort((ce,se)=>V[se]-V[ce]);const G=new Array,B=new Array;for(let ce=0;ce<v;ce++){const se=L[ce],D=V[se],F=w[4*se+0],U=w[4*se+1],j=w[4*se+2],W=w[4*se+3],Z=W===a3;if(n.getVec(F,h),n.getVec(U,p),Z)ne(m,b[3*j+0],b[3*j+1],b[3*j+2]),oe(g,m),u.componentIndex=s.get(F),u.cosAngle=Se(m,g);else{if(ne(m,b[3*j+0],b[3*j+1],b[3*j+2]),ne(g,b[3*W+0],b[3*W+1],b[3*W+2]),u.componentIndex=s.get(F),u.cosAngle=Se(m,g),_6t(u,c))continue;u.cosAngle<-.9999&&oe(g,m)}P+=D,I++,Z||v6t(u,l)?(t.write(x,T++,u),G.push(D)):w6t(u,a)&&(r.write(C,A++,u),B.push(D))}const X=new Float32Array(G.reverse()),Y=new Float32Array(B.reverse());return{regular:{instancesData:t.trim(x,T),lodInfo:{lengths:X}},silhouette:{instancesData:r.trim(C,A),lodInfo:{lengths:Y}},averageEdgeLength:P/I}}function v6t(e,t){return e.cosAngle<t}function _6t(e,t){return e.cosAngle>t}function w6t(e,t){const r=Rs(e.cosAngle),i=UK.fwd,n=UK.ortho;return By(i,e.position1,e.position0),r*(Se(dt(n,e.faceNormal0,e.faceNormal1),i)>0?-1:1)>t}function x6t(e){const t=e.faces.length/3,r=e.faces,i=e.neighbors;let n=0;for(let o=0;o<t;o++){const l=i[3*o+0],c=i[3*o+1],u=i[3*o+2],h=r[3*o+0],p=r[3*o+1],m=r[3*o+2];n+=l===a3||h<p?1:0,n+=c===a3||p<m?1:0,n+=u===a3||m<h?1:0}const s=new Int32Array(4*n);let a=0;for(let o=0;o<t;o++){const l=i[3*o+0],c=i[3*o+1],u=i[3*o+2],h=r[3*o+0],p=r[3*o+1],m=r[3*o+2];(l===a3||h<p)&&(s[a++]=h,s[a++]=p,s[a++]=o,s[a++]=l),(c===a3||p<m)&&(s[a++]=p,s[a++]=m,s[a++]=o,s[a++]=c),(u===a3||m<h)&&(s[a++]=m,s[a++]=h,s[a++]=o,s[a++]=u)}return s}function T6t(e){const t=e.faces.length/3,r=e.vertices.position,i=e.faces,n=TH.v0,s=TH.v1,a=TH.v2,o=new Float32Array(3*t);for(let l=0;l<t;l++){const c=i[3*l+0],u=i[3*l+1],h=i[3*l+2];r.getVec(c,n),r.getVec(u,s),r.getVec(h,a),pe(s,s,n),pe(a,a,n),dt(n,s,a),we(n,n),o[3*l+0]=n[0],o[3*l+1]=n[1],o[3*l+2]=n[2]}return o}(function(e){e[e.SOLID=0]="SOLID",e[e.SKETCH=1]="SKETCH"})(Fk||(Fk={}));const UK={edge:{position0:M(),position1:M(),faceNormal0:M(),faceNormal1:M(),componentIndex:0,cosAngle:0},ortho:M(),fwd:M()},TH={v0:M(),v1:M(),v2:M()},S6t={anglePlanar:4,angleSignificantEdge:35};class aPe{async extract(t){const r=SH(t),i=aoe(r),n=[r.data.buffer];return{result:E6t(i,n),transferList:n}}async extractComponentsEdgeLocations(t){const r=SH(t),i=BK(r.data,r.skipDeduplicate,r.indices,r.indicesLength),n=zK(i,O6t,fbe),s=[];return{result:Ik(n.regular.instancesData,s),transferList:s}}async extractEdgeLocations(t){const r=SH(t),i=BK(r.data,r.skipDeduplicate,r.indices,r.indicesLength),n=zK(i,R6t,fbe),s=[];return{result:Ik(n.regular.instancesData,s),transferList:s}}}function aoe(e){const t=BK(e.data,e.skipDeduplicate,e.indices,e.indicesLength);return ube.updateSettings(e.writerSettings),hbe.updateSettings(e.writerSettings),zK(t,ube,hbe)}function SH(e){return{data:CR.createView(e.dataBuffer),indices:e.indicesType==="Uint32Array"?new Uint32Array(e.indicesBuffer):e.indicesType==="Uint16Array"?new Uint16Array(e.indicesBuffer):void 0,indicesLength:e.indicesLength,writerSettings:e.writerSettings,skipDeduplicate:e.skipDeduplicate}}function E6t(e,t){return t.push(e.regular.lodInfo.lengths.buffer),t.push(e.silhouette.lodInfo.lengths.buffer),{regular:{instancesData:Ik(e.regular.instancesData,t),lodInfo:{lengths:e.regular.lodInfo.lengths.buffer}},silhouette:{instancesData:Ik(e.silhouette.instancesData,t),lodInfo:{lengths:e.silhouette.lodInfo.lengths.buffer}},averageEdgeLength:e.averageEdgeLength}}function BK(e,t,r,i){if(t)return{faces:r,facesLength:i,neighbors:cbe(r,i,e.count),vertices:e};const n=YAe(e.buffer,e.stride/4,{originalIndices:r,originalIndicesLength:i}),s=cbe(n.indices,i,n.uniqueCount);return{faces:n.indices,facesLength:n.indices.length,neighbors:s,vertices:CR.createView(n.buffer)}}const ube=new Lk,hbe=new Dk;class C6t{allocate(t){return oPe.createBuffer(t)}trim(t,r){return t.slice(0,r)}write(t,r,i){t.position0.setVec(r,i.position0),t.position1.setVec(r,i.position1)}}class A6t{allocate(t){return ooe.createBuffer(t)}trim(t,r){return t.slice(0,r)}write(t,r,i){t.position0.setVec(r,i.position0),t.position1.setVec(r,i.position1),t.componentIndex.set(r,i.componentIndex)}}const R6t=new C6t,O6t=new A6t,fbe={allocate:()=>null,write:()=>{},trim:()=>null},oPe=gn().vec3f(O.POSITION0).vec3f(O.POSITION1),ooe=gn().vec3f(O.POSITION0).vec3f(O.POSITION1).u16(O.COMPONENTINDEX).u16(O.U16PADDING,{glPadding:!0});function M6t(){return new aPe}const P6t=Object.freeze(Object.defineProperty({__proto__:null,EdgeProcessingWorker:aPe,default:M6t,extract:aoe,extractComponentsEdgeLocationsLayout:ooe,extractEdgeLocationsLayout:oPe},Symbol.toStringTag,{value:"Module"}));class I6t{constructor(t){this.maxCount=t,this._nextIndex=0,this.recycledIndices=[]}get activeCount(){return this._nextIndex-this.recycledIndices.length}get availableCount(){return this.recycledIndices.length+this.maxCount-this._nextIndex}acquire(){return this.recycledIndices.length>0?this.recycledIndices.pop():this.availableCount?this._nextIndex++:void 0}release(t){this.recycledIndices.push(t)}}class $6t{constructor(t,r=1){this.rctx=t,this.fieldCount=r,this.textureWidth=4096,this.dirty=!0,this.texture=new at(this.rctx,{target:mt.TEXTURE_2D,pixelFormat:Ue.RGBA,dataType:At.UNSIGNED_BYTE,samplingMode:tt.NEAREST,wrapMode:xt.CLAMP_TO_EDGE,width:this.textureWidth,height:1,flipped:!1}),this.data=new pc(new ArrayBuffer(4*this.textureWidth))}dispose(){this.texture.dispose(),this.texture=void 0,this.data=void 0}setData(t,r,i,n,s,a){const o=t*this.fieldCount+r;this.dirty=!0,this.data.set(o,0,i),this.data.set(o,1,n),this.data.set(o,2,s),this.data.set(o,3,a)}setDataElement(t,r,i,n){const s=t*this.fieldCount+r;this.dirty=!0,this.data.set(s,i,n)}resizeToFit(t){const r=t*this.fieldCount;if(r>=this.data.count){const i=Math.ceil((r+1)/this.textureWidth)*this.textureWidth,n=new pc(new ArrayBuffer(4*i));n.typedBuffer.set(this.data.typedBuffer),this.data=n}}updateTexture(){if(!this.dirty)return;const t=this.texture.descriptor.width,r=this.texture.descriptor.height;this.data.count>t*r&&this.texture.resize(t,this.data.count/t),this.texture.setData(this.data.typedBuffer),this.dirty=!1}bind(t,r,i){t.bindTexture(r,this.texture),t.setUniform2f(i,1/this.texture.descriptor.width,1/this.texture.descriptor.height)}}const lPe=65536;class L6t{constructor(t,r=1){this.textureBuffer=new $6t(t,r),this.indexManager=new I6t(lPe)}dispose(){this.textureBuffer.dispose(),this.textureBuffer=void 0}get availableCount(){return this.indexManager.availableCount}get activeCount(){return this.indexManager.activeCount}acquireIndex(){const t=this.indexManager.acquire();return this.textureBuffer.resizeToFit(t),t}releaseIndex(t){this.indexManager.release(t)}}class cPe{constructor(t,r=1){this.rctx=t,this.fieldCount=r,this.buffers=[]}garbageCollect(){this.buffers=this.buffers.filter(t=>t.activeCount!==0||(t.dispose(),!1))}destroy(){this.buffers.forEach(t=>t.dispose()),this.buffers=[]}getBuffer(t){for(const i of this.buffers)if(i.availableCount>=t)return i;if(t>lPe)return null;const r=new L6t(this.rctx,this.fieldCount);return this.buffers.push(r),r}updateTextures(){for(const t of this.buffers)t.textureBuffer.updateTexture()}}const pbe=fe.getLogger("esri.views.3d.webgl-engine.collections.Component.ComponentObjectCollection");class D6t{constructor(t,r){this._renderManager=t,this._viewingMode=r,this._objects=[new Qt,new Qt],this._renderSubmit=new J9t(this),this._renderManager.register(this._renderSubmit),this._componentBufferManager=new cPe(t.rctx,2)}dispose(){pt(this._objects[f5.Hidden].length===0&&this._objects[f5.Visible].length===0,"ObjectCollection should be empty upon disposal"),this._componentBufferManager.destroy()}createObject(t){const r=new DK;return r.toMapSpace=t.toMapSpace,r.transform=t.transform,r.obb=Wye(t.obb),r.components=new L9t(this._componentBufferManager,t.geometry.componentOffsets),r.renderable=this._createRenderable(t,r.components),r.intersectionGeometry=new U9t(t.geometry.positionData,r.components),this._objects[r.visible].push(r),r}destroyObject(t){const r=t;this._objects[r.visible].removeUnordered(r),r.dispose(),this._notifyDirty()}setObjectVisibility(t,r){const i=t;r!==i.visible&&(this._objects[i.visible].removeUnordered(i),this._objects[r].push(i),i.visible=r,this._notifyDirty())}preSubmit(t){const r=t.camera.eye;this.visibleObjects.forAll(i=>i.renderable.meta.cameraDepthSquared=Vs(r,i.obb.center))}getMaterial(t){return t.renderable.material}updateMaterial(t,r){const i=t.renderable.material;r(i),i.dirty&&this._notifyDirty()}setAllComponentVisibilities(t,r){const i=t;i.components.visibility.reset(r),i.components.visibilityDirty(),this._notifyDirty()}forEachVisibleComponent(t,r){return t.components.visibility.forEachComponent(r)}getComponentCount(t){const r=t,i=r.components.visibility.componentCount();return{visible:i,invisible:r.components.count-i}}setComponentData(t,r){const i=t,n=i.renderable.material,s=i.components,a=s.materialDataBuffer,o=s.materialDataIndices,l={castShadows:!0,pickable:!0,externalColor:Nae(),externalColorMixMode:Dn.Multiply,elevationOffset:0},c=a.textureBuffer,u=new Uint8Array(4),h=new Uint32Array(u.buffer);let p=0,m=0,g=0,b=s.verticalOffsets,w=1/0,v=-1/0,x=!1,T=!1,E=0;for(let C=0;C<s.count;C++)r(C,l),p+=+(l.externalColor[3]<1),m+=+(l.externalColorMixMode===Dn.Replace&&l.externalColor[3]===1),g+=+l.castShadows,FRe(l.externalColor,l.externalColorMixMode,u),u[2]=254&u[2]|+l.castShadows,c.setData(o[C],0,u[0],u[1],u[2],u[3]),x||(x=C>0&&E!==h[0]),E=h[0],T||(T=l.elevationOffset!==0),T&&R(b)&&(b=new Array(C).fill(0)),_(b)&&(b[C]=l.elevationOffset),w=Math.min(w,l.elevationOffset),v=Math.max(v,l.elevationOffset),KMe(l.elevationOffset,u),c.setData(o[C],1,u[0],u[1],u[2],u[3]),l.pickable!==YMe(s.pickability,C)&&(s.pickability=F9t(s.pickability,s.count,C,l.pickable));s.verticalOffsets=T?b:null,i.offsetObb=T?E9t(i.obb,w,v,this._viewingMode,_(i.offsetObb)?i.offsetObb:Wye(i.obb)):null,x||T?(n.componentParameters=new pC,n.componentParameters.castShadows=EH(g,s.count),n.componentParameters.transparent=EH(p,s.count),n.componentParameters.opaqueOverride=EH(m,s.count),n.componentParameters.texture=c,c.updateTexture()):(n.componentParameters=new R7,n.componentParameters.castShadows=l.castShadows?Ds.All:Ds.None,n.componentParameters.externalColor=l.externalColor,n.componentParameters.externalColorMixMode=l.externalColorMixMode),this._notifyDirty()}getComponentAabb(t,r,i,n=!1){t.intersectionGeometry.getComponentAabb(r,i);const s=t,a=s.components.verticalOffsets;if(n||R(a))return i;const o=a[r];if(this._viewingMode===Be.Local||o===0)return i[2]+=o,i[5]+=o,i;const l=Xut(o);return l.localOrigin=s.transform.position,l.applyToAabb(i)}getComponentObb(t){return t.obb}getObjectTransform(t){return t.transform}getComponentPositions(t,r,i){return t.intersectionGeometry.getComponentPositions(r,i)}intersect(t,r,i,n,s,a){const o=t;_(s)&&(s.localOrigin=o.transform.position);const l=Ix(mbe,o.transform.rotationScale);pd(d$,r,o.transform.position),pd(u$,i,o.transform.position),ed(d$,d$,l),ed(u$,u$,l);const c=Kh(mbe,l);return o.intersectionGeometry.intersect(d$,u$,n,c,s,o.components.verticalOffsets,a)}addEdges(t,r,i,n){const s=t,{indices:a,positions:o}=s.intersectionGeometry,l=s.components.offsets;return r.addComponentObject(t,s.transform,{center:s.obb.center,radius:s9t(s.obb)},o,a,l,i,n)}async extractEdgeInformation(t,r,i){const n=t,s=n.components.visibility;if(s.allInvisible())return{buffer:ooe.createBuffer(0),origin:[0,0,0]};const{indices:a,positions:o}=n.intersectionGeometry,l=n.components.offsets,c=CR.createBuffer(o.count);RU(c.position,o),c_(c.position,c.position,n.transform.rotationScale),this._setComponentIndices(c.componentIndex,a,l);const u=c.count,h=this._computeVisibilityIndices(a,s,l,u);return{origin:Kn(n.transform.position),buffer:await r.extractComponentsEdgeLocations({indices:h,indicesLength:h.length,skipDeduplicate:!0,data:c,writerSettings:{reducedPrecision:!1,variants:0}},i)}}_setComponentIndices(t,r,i){let n=0;for(let s=0;s<i.length-1;s++){const a=i[s],o=i[s+1];for(let l=a;l<o;l++){const c=r?r[l]:l;t.set(c,n)}n++}}_computeVisibilityIndices(t,r,i,n){if(t&&r.allVisible())return t;let s=0;r.forEachComponentRange((l,c)=>(s+=i[c]-i[l],!0));const a=(t==null?void 0:t.BYTES_PER_ELEMENT)===2||n<=65536?new Uint16Array(s):new Uint32Array(s);let o=0;return r.forEachComponentRange((l,c)=>{const u=i[l],h=i[c];for(let p=u;p<h;p++)a[o++]=t?t[p]:p;return!0}),a}addComponentHighlight(t,r){const i=t.components;R(i.highlightCounts)&&(i.highlightCounts=new Uint32Array(i.count+1)),i.highlightCounts[r]++===0&&(i.highlightsDirty(),this._notifyDirty()),i.highlightCounts[i.count]++}removeComponentHighlight(t,r){const i=t.components;if(R(i.highlightCounts))return void pbe.warn("Removing non-existing highlight.");const n=i.highlightCounts[r],s=i.highlightCounts[i.count];if(n!==0){if(n>1)return i.highlightCounts[r]=n-1,void(i.highlightCounts[i.count]=s-1);i.highlightCounts[r]=0,i.highlightsDirty(),this._notifyDirty(),s===1?i.highlightCounts=null:i.highlightCounts[i.count]=s-1}else pbe.warn("Removing non-existing highlight.")}clearHighlights(t){const r=t.components;_(r.highlightCounts)&&(r.highlightCounts=null,r.highlightsDirty(),this._notifyDirty())}getObjectGPUMemoryUsage(t){return t.renderable.meta.gpuMemoryEstimate}get visibleObjects(){return this._objects[f5.Visible]}_createRenderable(t,r){const i=this._renderManager.rctx,n=t.geometry,s=n.vertices.layoutParameters,a=dr.createVertex(i,Cr.STATIC_DRAW,n.vertices.data),o=ys(n.indices,b=>dr.createIndex(i,Cr.STATIC_DRAW,b)),l=vd(K9t(s)),c=new Uint16Array(n.vertices.count);for(let b=0;b<r.count;b++){const w=r.offsets[b],v=r.offsets[b+1],x=r.materialDataIndices[b];if(_(n.indices))for(let T=w;T<v;T++)c[n.indices[T]]=x;else for(let T=w;T<v;T++)c[T]=x}const u=dr.createVertex(i,Cr.STATIC_DRAW,c.buffer),h=new Ys(t.transform,t.toMapSpace),p=new ns(i,h.attributeLocations,{data:l,componentIndices:F6t},{data:a,componentIndices:u},o),m=new QMe(p,Dt.TRIANGLES,s,_(o)),g={cameraDepthSquared:.5,gpuMemoryEstimate:a.byteSize+u.byteSize+(_(o)?o.byteSize:0)};return new j9t(h,m,g)}_notifyDirty(){this._renderManager.notifyDirty()}}const F6t=vd(gn().u16(O.COMPONENTINDEX));function EH(e,t){return e===t?Ds.All:e===0?Ds.None:Ds.Some}const mbe=yy(),d$=M(),u$=M();class dPe extends as{constructor(){super(...arguments),this.overlayIndex=0,this.opacity=1}}function N6t(e){const t=new Qr;t.include(__);const r=t.fragment;switch(e.function){case Jc.Standard:r.uniforms.add(new Wt("tex",i=>i.texture)),e.hasOpacityFactor?(r.uniforms.add(new He("opacity",i=>i.opacity)),r.code.add(S`void main() {
gl_FragColor = texture2D(tex, uv) * opacity;
}`)):r.code.add(S`void main() {
gl_FragColor = texture2D(tex, uv);
}`);break;case Jc.OverlayWithTransparency:r.uniforms.add(new Wt("tex",i=>i.texture)),r.uniforms.add(new DO("overlayIdx",i=>i.overlayIndex)),e.hasOpacityFactor&&r.uniforms.add(new He("opacity",i=>i.opacity)),r.code.add(S`
        void main() {
          vec2 overlayUV = overlayIdx == 0 ? vec2(uv.x * 0.5, uv.y) : vec2(uv.x * 0.5 + 0.5, uv.y);
          gl_FragColor = texture2D(tex, overlayUV) ${e.hasOpacityFactor?"* opacity":""};
        }`);break;case Jc.TransparentToHUDVisibility:r.uniforms.add(new Wt("tex",i=>i.texture)),r.code.add(S`void main() {
gl_FragColor = vec4(1.0 - texture2D(tex, uv).a);
}`);break;case Jc.Transparency:r.uniforms.add([new Wt("colorTexture",i=>i.colorTexture),new Wt("alphaTexture",i=>i.alphaTexture),new Wt("frontFaceTexture",i=>i.frontFaceTexture)]),r.code.add(S`void main() {
vec4 srcColor = texture2D(colorTexture, uv);
if(srcColor.a <= 1e-5){
discard;
}
float srcAlpha = texture2D(alphaTexture, uv).r;
vec4 frontFace = texture2D(frontFaceTexture, uv);
gl_FragColor = vec4(mix(srcColor.rgb/srcColor.a, frontFace.rgb, frontFace.a), 1.0 - srcAlpha);
}`);break;case Jc.COUNT:break;default:e.function}return t}const k6t=Object.freeze(Object.defineProperty({__proto__:null,CompositingPassParameters:dPe,build:N6t},Symbol.toStringTag,{value:"Module"}));class AR extends gi{initializeProgram(t){const r=AR.shader.get().build(this.configuration);return new ai(t.rctx,r,Ur)}initializePipeline(){if(this.configuration.function===Jc.TransparentToHUDVisibility)return jt({colorWrite:{r:!1,g:!0,b:!1,a:!1}});switch(this.configuration.alphaMode){case to.None:return jt({colorWrite:or});case to.Alpha:return jt({blending:ka(Re.SRC_ALPHA,Re.ONE,Re.ONE_MINUS_SRC_ALPHA,Re.ONE_MINUS_SRC_ALPHA),colorWrite:or});default:return jt({blending:Im(Re.ONE,Re.ONE_MINUS_SRC_ALPHA),colorWrite:or})}}}AR.shader=new si(k6t,()=>ie(()=>import("./Compositing.glsl.08e1aafb.js"),[],import.meta.url));class V6t{constructor(t,r){this._rctx=t,this._techniqueRepository=r,this._configuration=new uD,this._passParameters=new dPe}dispose(){this._vao=Qe(this._vao)}compositeTransparent(t,r,i,n,s=1){this._configuration.alphaMode=to.Alpha,this._configuration.function=Jc.Transparency,this._configuration.hasOpacityFactor=s!==1,this._passParameters.colorTexture=r,this._passParameters.alphaTexture=i,this._passParameters.frontFaceTexture=n;const a=this._rctx,o=this._techniqueRepository.acquire(AR,this._configuration);a.bindTechnique(o,this._passParameters,t);const l=this._ensureVAO();a.bindVAO(l),a.drawArrays(Dt.TRIANGLE_STRIP,0,io(l,"geometry")),o.release()}composite(t,r,i=to.None,n=1,s=Jc.Standard,a=ji.INNER){const o=this._rctx;this._configuration.alphaMode=i,this._configuration.function=s,this._configuration.hasOpacityFactor=n!==1,this._passParameters.overlayIndex=a,this._passParameters.texture=r,this._passParameters.opacity=n;const l=this._techniqueRepository.acquire(AR,this._configuration);o.bindTechnique(l,this._passParameters,t);const c=this._ensureVAO();o.bindVAO(c),o.drawArrays(Dt.TRIANGLE_STRIP,0,io(c,"geometry")),l.release()}_ensureVAO(){return R(this._vao)&&(this._vao=Tl(this._rctx)),this._vao}}const z6t=1e4,GK=100,U6t=500,B6t=500,G6t=.1;function j6t(e,t,r){return Kse(t,e)*(r[1]-r[0])+r[0]}function q6t(e,t,r){if(t.size<z6t)return K6t.compute(e,t);const i=zO();return r.forAll(n=>{n.isVisible&&z9(i,H6t(e,n))}),i}function H6t(e,t){if(!t.isVisible)return;const r=zO(),i=t.getSpatialQueryAccelerator();return _(i)?W6t(r,e,i):X6t(r,e,t.objects),r}function W6t(e,t,r){const i=t.eye,n=t.viewForward,s=t.frustum,a=l=>l.isVisible,o=r.objectCount;if(o<U6t)ER(vh,t.near,Math.min(e.near,t.far)),r.forEachInDepthRange(i,n,vp.DepthOrder.FRONT_TO_BACK,vh,(l,c)=>{jK(e,t,l),vh.far=e.near,c.setRange(vh)},s,a),ER(vh,Math.max(e.far,t.near),t.far),r.forEachInDepthRange(i,n,vp.DepthOrder.BACK_TO_FRONT,vh,(l,c)=>{jK(e,t,l),vh.near=e.far,c.setRange(vh)},s,a);else{const l=Math.max(Math.min(o,B6t),Math.ceil(o*G6t)),c=r.findClosest(n,vp.DepthOrder.FRONT_TO_BACK,s,a,l),u=r.findClosest(n,vp.DepthOrder.BACK_TO_FRONT,s,a,l);c&&u&&(gbe(e,t,c.boundingVolumeWorldSpace.bounds),gbe(e,t,u.boundingVolumeWorldSpace.bounds))}}function X6t(e,t,r){FT.clear(),r.forAll(i=>{i.isVisible&&i.geometryRecords.length!==0&&FT.add(i)}),FT.empty||(FT.sort(t),ER(vh,t.near,Math.min(e.near,t.far)),FT.forEachInDepthRange(vh,vp.DepthOrder.FRONT_TO_BACK,(i,n)=>{n<e.near&&jK(e,t,i)}),ER(vh,Math.max(e.far,t.near),t.far),FT.forEachInDepthRange(vh,vp.DepthOrder.BACK_TO_FRONT,(i,n,s)=>{e.far=Math.max(e.far,s)}))}function jK(e,t,r){if(!r.isVisible||!fv(t.frustum,r.boundingVolumeWorldSpace.bounds))return;const i=r.transformation,n=J6t;r.geometryRecords.forEach(s=>{Zi(n,i,s.getShaderTransformation());const a=Vw(n);uPe(e,t,s.geometry.boundingInfo,n,a)})}function uPe(e,t,r,i,n){if(R(r))return;const s=t.eye,a=t.viewForward;ze(Ja,r.center,i);const o=a[0]*(Ja[0]-s[0])+a[1]*(Ja[1]-s[1])+a[2]*(Ja[2]-s[2]);if(Ja[3]=r.radius*n,!(o-Ja[3]>e.near&&o+Ja[3]<e.far)&&fv(t.frustum,Ja))if(r.radius>GK&&r.getChildren()){const l=r.getChildren();for(let c=0;c<8;++c)l[c]&&uPe(e,t,l[c],i,n)}else qK.unionDepthRangeWithAABB(e,t.viewProjectionMatrix,i,r.bbMin,r.bbMax)}function gbe(e,t,r){const i=t.eye,n=t.viewForward,s=(r[0]-i[0])*n[0]+(r[1]-i[1])*n[1]+(r[2]-i[2])*n[2];e.near=Math.min(e.near,s-r[3]),e.far=Math.max(e.far,s+r[3])}class Y6t{constructor(){this._items=new Qt({allocator:t=>t||{obj:null,distance:0,near:0,far:0},deallocator:t=>(t.obj=null,t.distance=0,t.near=0,t.far=0,t)})}get length(){return this._items.length}get empty(){return this._items.length===0}clear(){this._items.clear()}add(t){this._items.pushNew().obj=t}sort(t){const r=t.eye,i=t.viewForward;this._items.forAll(n=>{const s=n.obj.boundingVolumeWorldSpace.bounds,a=(s[0]-r[0])*i[0]+(s[1]-r[1])*i[1]+(s[2]-r[2])*i[2];n.distance=a,n.near=a-s[3],n.far=a+s[3]}),this._items.sort((n,s)=>n.distance-s.distance)}forEachInDepthRange(t,r,i){if(r===vp.DepthOrder.FRONT_TO_BACK)for(let n=0;n<this._items.length;++n){const s=this._items.data[n];s.far<t.near||s.near>t.far||i(s.obj,s.near,s.far)}else for(let n=this._items.length-1;n>=0;--n){const s=this._items.data[n];s.far<t.near||s.near>t.far||i(s.obj,s.near,s.far)}}}class Z6t{constructor(){this.view=Ae(),this.viewProj=Ae(),this.frustum=rR(),this.geometries=[],this.near=[],this.far=[],this.nearCandidates=[],this.farCandidates=[],this.range={near:0,far:0},this.looseRange={near:0,far:0}}compute(t,r){this._reset(),Ln(this.view,t.viewMatrix),Zi(this.viewProj,t.projectionMatrix,this.view),HN(this.frustum,t.frustum);const i=this.view,n=i[2],s=i[6],a=i[10],o=i[14],l=this.range;let c=0;if(r.forEach(m=>{if(!m.instanceParameters.visible||!m.castShadow)return;let g;m.hasShaderTransformation?(m.computeBoundingSphere(m.getShaderTransformation(),Ja,1),g=Ja):g=m.boundingSphere;const b=n*g[0]+s*g[1]+a*g[2]+o,w=b-g[3],v=b+g[3];this.geometries[c]=m,this.near[c]=-v,this.far[c]=-w,++c}),this.geometries.length===0)return l;for(let m=0;m<this.geometries.length;++m)this.near[m]>l.far&&(l.far=this.near[m]),this.near[m]>2&&this.far[m]<l.near&&(l.near=this.far[m]);const u=this.looseRange;u.near=Math.max(.5*l.near,2),u.far=2*l.far;let h=0,p=0;for(let m=0;m<this.geometries.length;++m)this.near[m]<l.near&&(this.near[m]>=u.near?l.near=this.near[m]:this.nearCandidates[h++]=m),this.far[m]>l.far&&(this.far[m]<=u.far?l.far=this.far[m]:this.farCandidates[p++]=m);if(this.nearCandidates.length===0&&this.farCandidates.length===0)return l;this.nearCandidates.sort((m,g)=>this.near[m]<this.near[g]?-1:this.near[m]>this.near[g]?1:0),this.farCandidates.sort((m,g)=>this.far[m]<this.far[g]?1:this.far[m]>this.far[g]?-1:0);for(let m=0;m<this.nearCandidates.length;++m){const g=this.nearCandidates[m];if(this.near[g]<l.near){const b=this.geometries[g],w=b.boundingInfo;this._includeNearBoundingInfoRec(w,b.getShaderTransformation())}}for(let m=0;m<this.farCandidates.length;++m){const g=this.farCandidates[m];if(this.far[g]>l.far){const b=this.geometries[g],w=b.boundingInfo;this._includeFarBoundingInfoRec(w,b.getShaderTransformation())}}return l}_reset(){this.geometries.length=0,this.near.length=0,this.far.length=0,this.nearCandidates.length=0,this.farCandidates.length=0,this.range.near=Number.MAX_VALUE,this.range.far=-Number.MAX_VALUE}_includeNearBoundingInfoRec(t,r){if(R(t))return;const i=t.getCenter();ze(Ja,i,r);const n=Vw(r),s=Ja[0],a=Ja[1],o=Ja[2],l=t.getBSRadius()*n,c=this.frustum;if(c[0][0]*s+c[0][1]*a+c[0][2]*o+c[0][3]>l||c[1][0]*s+c[1][1]*a+c[1][2]*o+c[1][3]>l||c[2][0]*s+c[2][1]*a+c[2][2]*o+c[2][3]>l||c[3][0]*s+c[3][1]*a+c[3][2]*o+c[3][3]>l)return;const u=this.view[2]*s+this.view[6]*a+this.view[10]*o+this.view[14],h=u+l;if(!(-(u-l)<2||-h>=this.range.near))if(-h>this.looseRange.near)this.range.near=-h;else{if(l>GK){const p=t.getChildren();if(p!==void 0){for(let m=0;m<8;++m)p[m]!==void 0&&this._includeNearBoundingInfoRec(p[m],r);return}}qK.unionDepthRangeWithAABB(this.range,this.viewProj,r,t.getBBMin(),t.getBBMax())}}_includeFarBoundingInfoRec(t,r){if(R(t))return;let i=t.getBSRadius();const n=t.getCenter();ze(Ja,n,r);const s=Vw(r),a=Ja[0],o=Ja[1],l=Ja[2];i*=s;const c=this.frustum;if(c[0][0]*a+c[0][1]*o+c[0][2]*l+c[0][3]>i||c[1][0]*a+c[1][1]*o+c[1][2]*l+c[1][3]>i||c[2][0]*a+c[2][1]*o+c[2][2]*l+c[2][3]>i||c[3][0]*a+c[3][1]*o+c[3][2]*l+c[3][3]>i)return;const u=this.view[2]*a+this.view[6]*o+this.view[10]*l+this.view[14]-i;if(!(-u<=this.range.far))if(-u<this.looseRange.far)this.range.far=-u;else{if(i>GK){const h=t.getChildren();if(h!==void 0){for(let p=0;p<8;++p)h[p]!==void 0&&this._includeFarBoundingInfoRec(h[p],r);return}}qK.unionDepthRangeWithAABB(this.range,this.viewProj,r,t.getBBMin(),t.getBBMax())}}}class Q6t{constructor(){this.modelViewProj=Ae(),this.clipPosition=[Jt(),Jt(),Jt(),Jt(),Jt(),Jt(),Jt(),Jt()]}unionDepthRangeWithAABB(t,r,i,n,s){const a=this.modelViewProj;Zi(a,r,i);let o=!1;for(let l=0;l<8;++l){const c=this.clipPosition[l],u=l===0||l===3||l===4||l===7?n[0]:s[0],h=l===0||l===1||l===4||l===5?n[1]:s[1],p=l<4?n[2]:s[2];c[0]=a[0]*u+a[4]*h+a[8]*p+a[12],c[1]=a[1]*u+a[5]*h+a[9]*p+a[13],c[2]=a[2]*u+a[6]*h+a[10]*p+a[14],c[3]=a[3]*u+a[7]*h+a[11]*p+a[15]}for(let l=0;l<12;++l){const c=this.clipPosition[CH[l][0]],u=this.clipPosition[CH[l][1]],h=this.clipPosition[CH[l][2]],p=this._clipTriangle(c,u,h);let m=!0;for(let g=0;g<p.length;++g)if(p[g][3]>=2){m=!1;break}if(!m){o=!0;for(let g=0;g<p.length;++g){const b=p[g][3];b<t.near&&(t.near=b),b>t.far&&(t.far=b)}}}return o}_inside(t,r){return r===0?t[0]>=-t[3]:r===1?t[1]>=-t[3]:r===2?t[0]<=t[3]:r===3?t[1]<=t[3]:void pt(!1)}_intersect(t,r,i){let n=0;return i===0?n=(-t[3]-t[0])/(r[0]-t[0]+r[3]-t[3]):i===1?n=(-t[3]-t[1])/(r[1]-t[1]+r[3]-t[3]):i===2?n=(t[3]-t[0])/(r[0]-t[0]-r[3]+t[3]):i===3&&(n=(t[3]-t[1])/(r[1]-t[1]-r[3]+t[3])),mV(Jt(),t,r,n)}_clipTriangle(t,r,i){let n=[t,r,i];for(let s=0;s<4;++s){const a=n;n=[];for(let o=0;o<a.length;++o){const l=a[o],c=a[(o+1)%a.length];this._inside(c,s)?(this._inside(l,s)||n.push(this._intersect(l,c,s)),n.push(c)):this._inside(l,s)&&n.push(this._intersect(l,c,s))}}return n}}const CH=[[0,1,3],[2,3,1],[1,5,2],[6,2,5],[5,4,6],[7,6,4],[4,0,7],[3,7,0],[3,2,7],[6,7,2],[4,5,0],[1,0,5]],Ja=Us(),J6t=Ae(),vh=zO(),FT=new Y6t,K6t=new Z6t,qK=new Q6t;class e8t extends as{constructor(){super(...arguments),this.maskEnabled=!1,this.overlayEnabled=!1}}function t8t(){const e=new Qr;return e.attributes.add(O.POSITION,"vec2"),e.vertex.uniforms.add(new pl("drawPosition")),e.varyings.add("vUV","vec2"),e.vertex.code.add(S`void main(void) {
vUV = position;
gl_Position = vec4(drawPosition.xy + vec2(position - 0.5) * drawPosition.zw, 0.0, 1.0);
}`),e.fragment.uniforms.add(new Hi("textureInput")),e.fragment.uniforms.add(new Hi("textureMask")),e.fragment.uniforms.add(new Hi("textureOverlay")),e.fragment.uniforms.add(new Xw("maskEnabled",t=>t.maskEnabled)),e.fragment.uniforms.add(new Xw("overlayEnabled",t=>t.overlayEnabled)),e.fragment.code.add(S`const float barrelFactor = 1.1;
vec2 barrel(vec2 uv) {
vec2 uvn = uv * 2.0 - 1.0;
if (uvn.x == 0.0 && uvn.y == 0.0) {
return vec2(0.5, 0.5);
}
float theta = atan(uvn.y, uvn.x);
float r = pow(length(uvn), barrelFactor);
return r * vec2(cos(theta), sin(theta)) * 0.5 + 0.5;
}
void main() {
float mask = maskEnabled ? texture2D(textureMask, vUV).a : 1.0;
vec4 inputColor = texture2D(textureInput, barrel(vUV)) * mask;
vec4 overlayColor = overlayEnabled ? texture2D(textureOverlay, vUV) : vec4(0);
gl_FragColor = overlayColor + (1.0 - overlayColor.a) * inputColor;
}`),e}async function r8t(e){const t=ie(()=>import("./mask-svg.6e459ce6.js"),[],import.meta.url),r=ie(()=>import("./overlay-svg.3a82a35c.js"),[],import.meta.url),i=Dp((await t).default,{signal:e}),n=Dp((await r).default,{signal:e}),s={mask:await i,overlay:await n};return Et(e),s}let FS=class extends xe{constructor(){super(...arguments),this._handles=new Ft,this._magnifier=null,this._imageSources=null,this._imageLoadTask=null,this._resources=null,this._passParameters=new e8t,this.events=new mn,this.attributeLocations=new Map([[O.POSITION,0]]),this.tmpScreenPoint=tn(),this.tmpRenderPoint=tBe()}get updating(){return R(this._imageSources)&&_(this._imageLoadTask)&&!this._imageLoadTask.task.finished}get magnifier(){return this._magnifier}set magnifier(e){if(e===this._magnifier)return;this._handles.removeAll(),this._magnifier=e;const t=()=>{this._updateResourceLoading(),this.events.emit("request-render")};_(this._magnifier)&&this._handles.add(re(()=>ys(this._magnifier,r=>r.version),t)),t()}get enabled(){return _(this._validMagnifier)}get _validMagnifier(){return _(this._magnifier)&&this._magnifier.visible&&_(this._magnifier.position)&&this._magnifier.size>0?this._magnifier:null}get factor(){return _(this._magnifier)&&this._magnifier.factor||1}dispose(){this._magnifier=null,this._handles.destroy(),_(this._imageLoadTask)&&(this._imageLoadTask.task.abort(),this._imageLoadTask=null),this._disposeResources()}render(e,t){const r=this._validMagnifier;if(R(r))return;const i=t.camera.pixelRatio,n=Math.ceil(i*r.size);if(this._updateResources(e,n),R(this._resources))return;this._passParameters.maskEnabled=r.maskEnabled,this._passParameters.overlayEnabled=r.overlayEnabled;const s=this._resources.program;e.useProgram(s),s.bindPass(this._passParameters,t);const a=this._resources.textures,o=Math.ceil(1/this.factor*n);a.input.resize(o,o);const l=t.camera.fullWidth,c=t.camera.fullHeight;qg(r.position,this.tmpScreenPoint);const u=t.camera.screenToRender(this.tmpScreenPoint,this.tmpRenderPoint),h=.5*o,p=.5*o;u[0]=Le(u[0],h,l-h-1),u[1]=Le(u[1],p,c-p-1);const m=Math.floor(u[0]-h),g=Math.floor(u[1]-p);s.bindTexture("textureInput",a.input),e.gl.copyTexImage2D(a.input.descriptor.target,0,a.input.descriptor.pixelFormat,m,g,o,o,0);const b=r.offset.x*i,w=r.offset.y*i,v=(u[0]+b)/l*2-1,x=(u[1]-w)/c*2-1,T=n/l*2,E=n/c*2;e.bindVAO(this._resources.vao),s.bindTexture("textureOverlay",a.overlay),s.bindTexture("textureMask",a.mask),s.setUniform4f("drawPosition",v,x,T,E),e.setPipelineState(this._resources.pipelineState),e.drawArrays(Dt.TRIANGLE_STRIP,0,4)}_updateResourceLoading(){const e=this._validMagnifier;if(R(e))return;const t=e.maskUrl,r=e.overlayUrl;!_(this._imageLoadTask)||this._imageLoadTask.maskUrl===t&&this._imageLoadTask.overlayUrl===r||(this._imageLoadTask.task.abort(),this._imageLoadTask=null,this._imageSources=null),_(this._imageSources)||_(this._imageLoadTask)||(this._imageLoadTask={maskUrl:t,overlayUrl:r,task:HR(async i=>{const n=R(t)||R(r)?r8t(i):null,s=_(t)?Dp(t,{signal:i}):n.then(o=>o.mask),a=_(r)?Dp(r,{signal:i}):n.then(o=>o.overlay);this._imageSources={mask:await s,overlay:await a},this._disposeResources(),this.events.emit("request-render")})},this._imageLoadTask.task.promise.then(()=>this.notifyChange("updating"),()=>this.notifyChange("updating")))}_updateResources(e,t){if(!this.enabled)return void this._disposeResources();if(_(this._resources)){if(this._resources.textures.size!==t){const i=this._createTextureResources(e,t);if(R(i))return void this._disposeResources();this._disposeTextureResources(this._resources.textures),this._resources.textures=i}return}const r=this._createTextureResources(e,t);R(r)||(this._resources={textures:r,program:this._createProgram(e),vao:Tl(e,Jne,this.attributeLocations,0,1),pipelineState:jt({blending:Im(Re.ONE,Re.ONE_MINUS_SRC_ALPHA),depthTest:null,depthWrite:null,colorWrite:or})})}_disposeResources(){R(this._resources)||(this._disposeTextureResources(this._resources.textures),this._resources.program.dispose(),this._resources.vao.dispose(),this._resources=null)}_disposeTextureResources(e){e.mask.dispose(),e.overlay.dispose(),e.input.dispose()}_createTextureResources(e,t){if(R(this._imageSources))return null;this._imageSources.overlay.width=t,this._imageSources.overlay.height=t,this._imageSources.mask.width=t,this._imageSources.mask.height=t;const r=new at(e,{target:mt.TEXTURE_2D,pixelFormat:Ue.RGBA,internalFormat:Ue.RGBA,dataType:At.UNSIGNED_BYTE,wrapMode:xt.CLAMP_TO_EDGE,samplingMode:tt.LINEAR,flipped:!0,preMultiplyAlpha:!qte(this._imageSources.overlay.src)||!e.driverTest.svgAlwaysPremultipliesAlpha},this._imageSources.overlay),i=new at(e,{target:mt.TEXTURE_2D,pixelFormat:Ue.ALPHA,internalFormat:Ue.ALPHA,dataType:At.UNSIGNED_BYTE,wrapMode:xt.CLAMP_TO_EDGE,samplingMode:tt.LINEAR,flipped:!0},this._imageSources.mask);return{input:new at(e,{target:mt.TEXTURE_2D,pixelFormat:Ue.RGBA,internalFormat:Ue.RGBA,dataType:At.UNSIGNED_BYTE,wrapMode:xt.CLAMP_TO_EDGE,samplingMode:tt.LINEAR,flipped:!1}),mask:i,overlay:r,size:t}}_createProgram(e){return new ai(e,t8t(),this.attributeLocations)}};d([f()],FS.prototype,"_imageSources",void 0),d([f()],FS.prototype,"_imageLoadTask",void 0),d([f({readOnly:!0})],FS.prototype,"updating",null),FS=d([$("esri/views/3d/webgl-engine/lib/MagnifierHelper")],FS);const i8t=.5,n8t=1e3/30;var RR;(function(e){e[e.FrontToBack=0]="FrontToBack",e[e.BackToFront=1]="BackToFront"})(RR||(RR={}));class kb{constructor(t,r,i=RR.FrontToBack){this._rctx=t,this._techniqueRepository=r,this._sorting=i,this._draws=new Qt({initialSize:32,allocator:n=>n||{material:null,geometry:null,geometryRanges:null,bindDrawParams:null,depthSquaredHint:0,indexType:0}}),this._previouslyBoundDraw=new Map}submitDraw(t,r,i,n){const s=this._draws.pushNew();s.geometry=r,s.geometryRanges=i,s.material=t,s.depthSquaredHint=n,s.indexType=r.indexed?r.vao.indexBuffer.indexType:0}dispatch(t,r){const i=this._rctx;this._previouslyBoundDraw.clear();let n=null;const s=this._draws.map(o=>o.material.prepareTechnique(this._techniqueRepository,t,r,o.geometry.parameters)),a=this._draws.length;for(let o=0;o<a;o++){const l=s[o];l===n&&l.configuration.transparencyPassType===yt.NONE||(i.bindTechnique(l,t,r),n=l);const c=this._draws.data[o],u=c.geometry;i.bindVAO(u.vao),this._previouslyBoundDraw.get(l)!==c.material&&(l.bindDraw(c.material,r),this._previouslyBoundDraw.set(l,c.material));const h=c.geometryRanges,p=h.length;if(c.indexType!==0){const m=ID.get(c.indexType);for(let g=0;g<p;g+=2){const b=h[g],w=h[g+1];i.drawElements(u.primitiveType,w,c.indexType,b*m)}}else for(let m=0;m<p;m+=2){const g=h[m],b=h[m+1];i.drawArrays(u.primitiveType,g,b)}}}prepareSubmit(){this._draws.clear()}finishSubmit(){const t=this._sorting===RR.FrontToBack?1:-1;this._draws.sort((r,i)=>{const n=t*(r.depthSquaredHint-i.depthSquaredHint);return n!==0?n:r.geometry.vao.size-i.geometry.vao.size})}get count(){return this._draws.length}}const ID=new Map;ID.set(ft.UNSIGNED_BYTE,1),ID.set(ft.UNSIGNED_SHORT,2),ID.set(ft.UNSIGNED_INT,4);class s8t{constructor(t,r){this.rctx=t,this.shaderTechniqueRepository=r,this.canRender=!0,this._materialPassParameters=new n5t,this._shadowPassParameters=new s5t,this._highlightPassParameters=new a5t,this._systems=new Set,this._passes={materialOpaque:new kb(t,r),materialTransparent:new kb(t,r,RR.BackToFront),materialIntegratedMesh:new kb(t,r),shadowMap:new kb(t,r),highlight:new kb(t,r),highlightIntegratedMesh:new kb(t,r),highlightShadowMap:new kb(t,r),defaultShadowMap:new kb(t,r)}}register(t){this._systems.add(t)}prepareRender(t){if(this._systems.size!==0){for(const r of Object.values(this._passes))r.prepareSubmit();this._systems.forEach(r=>r.submit(this._passes,t.bindParameters));for(const r of Object.values(this._passes))r.finishSubmit();this.shaderTechniqueRepository.frameUpdate()}}render(t){if(this._systems.size!==0)switch(this._configure(t),t.bindParameters.slot){case Ee.OPAQUE_MATERIAL:switch(t.pass){case je.MATERIAL:return this._materialPassParameters.subPass=Ea.Color,this._passes.materialOpaque.dispatch(this._materialPassParameters,t.bindParameters);case je.MATERIAL_DEPTH:return this._materialPassParameters.subPass=Ea.Depth,this._passes.materialOpaque.dispatch(this._materialPassParameters,t.bindParameters);case je.MATERIAL_NORMAL:return this._materialPassParameters.subPass=Ea.Normal,this._passes.materialOpaque.dispatch(this._materialPassParameters,t.bindParameters);case je.MATERIAL_HIGHLIGHT:return this._passes.highlight.dispatch(this._highlightPassParameters,t.bindParameters);case je.MATERIAL_DEPTH_SHADOWMAP_ALL:return this._passes.shadowMap.dispatch(this._shadowPassParameters,t.bindParameters);case je.MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT:return this._passes.highlightShadowMap.dispatch(this._shadowPassParameters,t.bindParameters);case je.MATERIAL_DEPTH_SHADOWMAP_DEFAULT:return this._passes.defaultShadowMap.dispatch(this._shadowPassParameters,t.bindParameters)}return;case Ee.TRANSPARENT_MATERIAL:switch(t.pass){case je.MATERIAL:return this._materialPassParameters.subPass=Ea.Color,this._passes.materialTransparent.dispatch(this._materialPassParameters,t.bindParameters);case je.MATERIAL_ALPHA:return this._materialPassParameters.subPass=Ea.Alpha,this._passes.materialTransparent.dispatch(this._materialPassParameters,t.bindParameters);case je.MATERIAL_DEPTH:return this._materialPassParameters.subPass=Ea.Depth,this._passes.materialTransparent.dispatch(this._materialPassParameters,t.bindParameters);case je.MATERIAL_NORMAL:return this._materialPassParameters.subPass=Ea.Normal,this._passes.materialTransparent.dispatch(this._materialPassParameters,t.bindParameters)}return;case Ee.INTEGRATED_MESH:switch(t.pass){case je.MATERIAL:return this._materialPassParameters.subPass=Ea.Color,this._passes.materialIntegratedMesh.dispatch(this._materialPassParameters,t.bindParameters);case je.MATERIAL_DEPTH:return this._materialPassParameters.subPass=Ea.Depth,this._passes.materialIntegratedMesh.dispatch(this._materialPassParameters,t.bindParameters);case je.MATERIAL_NORMAL:return this._materialPassParameters.subPass=Ea.Normal,this._passes.materialIntegratedMesh.dispatch(this._materialPassParameters,t.bindParameters);case je.MATERIAL_HIGHLIGHT:return this._passes.highlightIntegratedMesh.dispatch(this._highlightPassParameters,t.bindParameters)}return}}notifyDirty(){this._context.requestRender()}slots(){return[Ee.OPAQUE_MATERIAL,Ee.TRANSPARENT_MATERIAL,Ee.INTEGRATED_MESH]}initializeRenderContext(t){this._context=t}uninitializeRenderContext(){}queryDepthRange(t){const r={near:1/0,far:-1/0};return this._systems.forEach(i=>{const n=i.queryShadowCasterDepthRange(t);_(n)&&z9(r,n,r)}),r}_configure(t){const r=t.pass===je.MATERIAL_DEPTH_SHADOWMAP_ALL||t.pass===je.MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT||t.pass===je.MATERIAL_DEPTH_SHADOWMAP_DEFAULT?this._shadowPassParameters:t.pass===je.MATERIAL_HIGHLIGHT?this._highlightPassParameters:this._materialPassParameters;this._updateParameters(t,r)}_updateParameters(t,r){const i=t.bindParameters.camera,n=i.viewInverseTransposeMatrix;ne(AH,n[3],n[7],n[11]),RH.set(AH),oe(r.transformWorldFromViewTH,RH.high),oe(r.transformWorldFromViewTL,RH.low),oe(r.slicePlaneLocalOrigin,AH),Jh(r.transformViewFromCameraRelativeRS,i.viewMatrix),Ln(r.transformProjFromView,i.projectionMatrix),r.identifier===lu.Material&&(this._materialPassParameters.transparent=t.bindParameters.slot===Ee.TRANSPARENT_MATERIAL,this._materialPassParameters.integratedMesh=t.bindParameters.slot===Ee.INTEGRATED_MESH,Kh(ybe,r.transformViewFromCameraRelativeRS),Ix(r.transformNormalViewFromGlobal,ybe))}get needsHighlight(){return this._passes.highlight.count>0||this._passes.highlightIntegratedMesh.count>0}get needsTransparentPass(){return this._passes.materialTransparent.count>0}}const AH=M(),ybe=Li(),RH=new WU,a8t=8.6,o8t=.4;function l8t(){const e=new Qr,{vertex:t,fragment:r}=e,i=t.code,n=r.code;return e.attributes.add(O.POSITION,"vec2"),e.varyings.add("uv","vec2"),e.attributes.add(O.UV0,"vec2"),t.uniforms.add(new Wt("coverageTex",s=>s.coverageTexture)),i.add(S`void main() {
vec4 cov = texture2D(coverageTex, uv0);
if (cov.r == 0.0) {
gl_Position = vec4(0.0);
return;
}
gl_Position = vec4(position, 0.0, 1.0);
uv = position.xy * 0.5 + vec2(0.5);
}`),r.uniforms.add(new Wt("tex",s=>s.blurColorTexture)),r.uniforms.add(new Wt("origin",s=>s.highlightColorTexture)),r.uniforms.add(new cr("uColor",s=>s.color)),r.uniforms.add(new cr("haloColor",s=>s.haloColor)),r.uniforms.add(new cr("opacities",s=>ei(c8t,s.haloOpacity,s.haloOpacityOccluded,s.fillOpacity,s.fillOpacityOccluded))),r.constants.add("outlineSize","float",a8t),r.constants.add("blurSize","float",o8t),n.add(S`void main() {
vec4 blurredHighlightValue = texture2D(tex, uv);
float highlightIntensity = blurredHighlightValue.a;
if (highlightIntensity == 0.0) {
discard;
}
vec4 origin_color = texture2D(origin, uv);
float outlineIntensity;
float fillIntensity;
if (blurredHighlightValue.g > blurredHighlightValue.b) {
outlineIntensity = haloColor.w * opacities[1];
fillIntensity = uColor.w * opacities[3];
}
else {
outlineIntensity = haloColor.w * opacities[0];
fillIntensity = uColor.w * opacities[2];
}
float inner = 1.0 - outlineSize / 9.0;
float outer = 1.0 - (outlineSize + blurSize) / 9.0;
float outlineFactor = smoothstep(outer, inner, highlightIntensity);
float fillFactor = any(notEqual(origin_color, vec4(0.0, 0.0, 0.0, 0.0))) ? 1.0 : 0.0;
float intensity = outlineIntensity * outlineFactor * (1.0 - fillFactor) + fillIntensity * fillFactor;
gl_FragColor = vec4(mix(haloColor.rgb, uColor.rgb, fillFactor), intensity);
}`),e}const c8t=Jt(),d8t=Object.freeze(Object.defineProperty({__proto__:null,build:l8t},Symbol.toStringTag,{value:"Module"}));class XU extends gi{initializeProgram(t){const r=XU.shader.get().build();return new ai(t.rctx,r,Ur)}initializePipeline(){return jt({blending:ka(Re.SRC_ALPHA,Re.ONE,Re.ONE_MINUS_SRC_ALPHA,Re.ONE_MINUS_SRC_ALPHA),colorWrite:or})}}XU.shader=new si(d8t,()=>ie(()=>import("./HighlightApply.glsl.d2764cb3.js"),[],import.meta.url));class hPe extends as{constructor(){super(...arguments),this.blurSize=it()}}function u8t(){const e=new Qr,{vertex:t,fragment:r}=e,i=t.code,n=r.code;return e.attributes.add(O.POSITION,"vec2"),e.attributes.add(O.UV0,"vec2"),e.varyings.add("blurCoordinate","vec3"),t.uniforms.add(new Wt("coverageTex",s=>s.coverageTexture)),r.uniforms.add(new sse("blurSize",s=>s.blurSize)),i.add(S`void main() {
gl_Position = vec4(position, 0.0, 1.0);
vec4 cov = texture2D(coverageTex, uv0);
if (cov.r == 0.0) {
gl_Position = vec4(0.0);
}
blurCoordinate = vec3(gl_Position.xy * 0.5 + vec2(0.5), max(cov.g, cov.b));
}`),r.uniforms.add(new ase("tex",s=>s.blurInputTexture)),n.add(S`void main() {
vec2 uv = blurCoordinate.xy;
vec4 center = texture2D(tex, uv);
if (blurCoordinate.z == 1.0) {
gl_FragColor = center;
} else {
vec4 sum = vec4(0.0);
sum += center * 0.204164;
sum += texture2D(tex, uv + blurSize * 1.407333) * 0.304005;
sum += texture2D(tex, uv - blurSize * 1.407333) * 0.304005;
sum += texture2D(tex, uv + blurSize * 3.294215) * 0.093913;
sum += texture2D(tex, uv - blurSize * 3.294215) * 0.093913;
gl_FragColor = sum;
}
}`),e}const h8t=Object.freeze(Object.defineProperty({__proto__:null,HighlightBlurDrawParameters:hPe,build:u8t},Symbol.toStringTag,{value:"Module"}));class YU extends gi{initializeProgram(t){const r=YU.shader.get().build();return new ai(t.rctx,r,Ur)}initializePipeline(){return jt({colorWrite:or})}}YU.shader=new si(h8t,()=>ie(()=>import("./HighlightBlur.glsl.c4baef51.js"),[],import.meta.url));class fPe extends as{constructor(){super(...arguments),this.invFramebufferDim=it()}}function f8t(){const e=new Qr,{vertex:t,fragment:r}=e,i=t.code,n=r.code;return e.attributes.add(O.POSITION,"vec2"),i.add(S`void main() {
gl_Position = vec4(vec2(1.0) - position * 2.0, 0.0, 1.0);
}`),r.uniforms.add(new ase("tex",s=>s.inputTexture)),r.uniforms.add(new sse("invFramebufferDim",s=>s.invFramebufferDim)),n.add(S`void main() {
vec2 coord = gl_FragCoord.xy * invFramebufferDim;
vec4 value = texture2D(tex, coord);
float mx = floor(max(value.g, value.b));
gl_FragColor = vec4(ceil(value.r), mx, mx, 1.0);
}`),e}const p8t=Object.freeze(Object.defineProperty({__proto__:null,HighlightDownsampleDrawParameters:fPe,build:f8t},Symbol.toStringTag,{value:"Module"}));class ZU extends gi{initializeProgram(t){const r=ZU.shader.get().build();return new ai(t.rctx,r,Ur)}initializePipeline(){return jt({colorWrite:or})}}ZU.shader=new si(p8t,()=>ie(()=>import("./HighlightDownsample.glsl.e0db7913.js"),[],import.meta.url));class bbe extends as{constructor(){super(...arguments),this.color=nf(1,0,1,1),this.haloColor=nf(1,0,1,1),this.haloOpacity=1,this.haloOpacityOccluded=.25,this.fillOpacity=.2,this.fillOpacityOccluded=.05,this.shadowColor=Tr(1,0,1,1),this.shadowOpacity=.15,this.occludedShadowOpacity=.075}}const m8t=32;class g8t{constructor(t,r){this._techniqueRep=t,this._rctx=r,this.viewportToRestore=Jt(),this._passParameters=new bbe,this._downsampleDrawParameters=new fPe,this._blurDrawParameters=new hPe,this._grid={coverageMipmap:null,vao:null,verticalCellCount:0,horizontalCellCount:0,cellPixelSize:0,mipmapLevels:0,viewportWidth:0,viewportHeight:0}}_assertResources(){if(this.quadVAO)return;this.quadVAO=Tl(this._rctx);const t={colorTarget:hn.TEXTURE,depthStencilTarget:Pr.NONE,width:0,height:0},r={target:mt.TEXTURE_2D,pixelFormat:Ue.RGBA,dataType:At.UNSIGNED_BYTE,samplingMode:tt.LINEAR,wrapMode:xt.CLAMP_TO_EDGE,width:0,height:0};this.blur0Fbo=new Pi(this._rctx,t,r),this.blur1Fbo=new Pi(this._rctx,t,r);const i=new xl;this._blurTechnique=this._techniqueRep.acquire(YU,i),this._downsampleTechnique=this._techniqueRep.acquire(ZU,i),this._applyTechnique=this._techniqueRep.acquire(XU,i)}dispose(){if(this._blurTechnique=ri(this._blurTechnique),this._downsampleTechnique=ri(this._downsampleTechnique),this._applyTechnique=ri(this._applyTechnique),this._grid.coverageMipmap)for(let t=1;t<this._grid.coverageMipmap.length;t++)this._grid.coverageMipmap[t].dispose();this._grid.vao&&this._grid.vao.dispose(!0),this.quadVAO&&(this.quadVAO.dispose(!0),this.quadVAO=null),this.blur0Fbo=Qe(this.blur0Fbo),this.blur1Fbo=Qe(this.blur1Fbo)}setDefaultOptions(t){this._passParameters={...new bbe,...t}}render(t,r,i){this._passParameters.highlightColorTexture=r.colorTexture,this._assertResources();const n=t.camera;hp(this.viewportToRestore,n.fullViewport);const s=n.fullWidth,a=n.fullHeight,o=n.pixelRatio,l=Math.ceil(s/o),c=Math.ceil(a/o);this.blur0Fbo.resize(l,c),this.blur1Fbo.resize(l,c);const u=this._rctx;u.bindVAO(this.quadVAO);let h=null;this._gridUpdateResources(r,m8t),this._gridComputeMipmap(t),this._passParameters.coverageTexture=this._grid.coverageMipmap[this._grid.mipmapLevels].colorTexture,h=this._grid.vao;const p=u.bindTechnique(this._blurTechnique,this._passParameters,t);u.bindVAO(h),u.bindFramebuffer(this.blur0Fbo),u.setViewport(0,0,l,c),u.setClearColor(0,0,0,0),u.clear(ii.COLOR_BUFFER_BIT),this._blurDrawParameters.blurInputTexture=r.colorTexture,vr(this._blurDrawParameters.blurSize,1/l,0),p.bindDraw(this._blurDrawParameters,t),u.drawArrays(this._blurTechnique.primitiveType,0,io(h,"geometry")),u.bindFramebuffer(this.blur1Fbo),u.clear(ii.COLOR_BUFFER_BIT),this._blurDrawParameters.blurInputTexture=this.blur0Fbo.colorTexture,vr(this._blurDrawParameters.blurSize,0,1/c),p.bindDraw(this._blurDrawParameters,t),u.drawArrays(this._blurTechnique.primitiveType,0,io(h,"geometry")),u.bindFramebuffer(i),u.setViewport(this.viewportToRestore[0],this.viewportToRestore[1],this.viewportToRestore[2],this.viewportToRestore[3]),this._passParameters.blurColorTexture=this.blur1Fbo.colorTexture,u.bindTechnique(this._applyTechnique,this._passParameters,t),u.drawArrays(this._applyTechnique.primitiveType,0,io(h,"geometry")),u.bindVAO(null)}_gridUpdateResources(t,r){const i=this._rctx,n=this._grid;let s=!1;if(n.coverageMipmap===null&&(n.coverageMipmap=[t],s=!0),n.viewportWidth===t.width&&n.viewportHeight===t.height||(s=!0,n.viewportWidth=t.width,n.viewportHeight=t.height),n.coverageMipmap[0]=t,n.cellPixelSize!==r&&(n.cellPixelSize=r,s=!0),s){for(let l=1;l<n.coverageMipmap.length;l++)n.coverageMipmap[l].dispose();n.mipmapLevels=Math.ceil(Math.log(n.cellPixelSize)*Math.LOG2E),n.coverageMipmap.length=n.mipmapLevels+1;for(let l=0;l<n.mipmapLevels;l++){const c=n.coverageMipmap[l],u={target:mt.TEXTURE_2D,pixelFormat:Ue.RGB,dataType:At.UNSIGNED_SHORT_5_6_5,samplingMode:tt.LINEAR,wrapMode:xt.CLAMP_TO_EDGE,width:Math.ceil(c.width/2),height:Math.ceil(c.height/2)},h={colorTarget:hn.TEXTURE,depthStencilTarget:Pr.NONE,width:Math.ceil(c.width/2),height:Math.ceil(c.height/2)};n.coverageMipmap[l+1]=new Pi(i,h,u)}}const a=Math.ceil(t.height/n.cellPixelSize),o=Math.ceil(t.width/n.cellPixelSize);if(!n.vao||n.verticalCellCount!==a||n.horizontalCellCount!==o){n.verticalCellCount=a,n.horizontalCellCount=o;const l=a+1,c=o+1,u=1/a,h=1/o,p=6,m=4,g=new Float32Array(p*m*l*c);let b=0;for(let w=0;w<l;w++)for(let v=0;v<c;v++)g[b+0]=(v-.5)*h*2-1,g[b+1]=(w-.5)*u*2-1,g[b+2]=v*h,g[b+3]=w*u,g[b+4]=(v+.5)*h*2-1,g[b+5]=(w-.5)*u*2-1,g[b+6]=v*h,g[b+7]=w*u,g[b+8]=(v-.5)*h*2-1,g[b+9]=(w+.5)*u*2-1,g[b+10]=v*h,g[b+11]=w*u,g[b+12]=(v-.5)*h*2-1,g[b+13]=(w+.5)*u*2-1,g[b+14]=v*h,g[b+15]=w*u,g[b+16]=(v+.5)*h*2-1,g[b+17]=(w-.5)*u*2-1,g[b+18]=v*h,g[b+19]=w*u,g[b+20]=(v+.5)*h*2-1,g[b+21]=(w+.5)*u*2-1,g[b+22]=v*h,g[b+23]=w*u,b+=p*m;n.vao&&n.vao.dispose(!0),n.vao=new ns(i,Ur,{geometry:bO},{geometry:dr.createVertex(i,Cr.STATIC_DRAW,g)})}}_gridComputeMipmap(t){const r=this._rctx,i=this._grid,n=r.bindTechnique(this._downsampleTechnique,this._passParameters,t);r.bindVAO(this.quadVAO);for(let s=0;s<i.mipmapLevels;s++){r.bindFramebuffer(i.coverageMipmap[s+1]);const a=i.coverageMipmap[s+1].width,o=i.coverageMipmap[s+1].height;this._downsampleDrawParameters.inputTexture=i.coverageMipmap[s].colorTexture,vr(this._downsampleDrawParameters.invFramebufferDim,1/a,1/o),n.bindDraw(this._downsampleDrawParameters,t),r.setViewport(0,0,a,o),r.drawArrays(Dt.TRIANGLE_STRIP,0,io(this.quadVAO,"geometry"))}}get gpuMemoryUsage(){let t=(_(this.blur0Fbo)?this.blur0Fbo.gpuMemoryUsage:0)+(_(this.blur1Fbo)?this.blur1Fbo.gpuMemoryUsage:0);if(this._grid.coverageMipmap)for(const r of this._grid.coverageMipmap)t+=r.gpuMemoryUsage;return t}get test(){return{coverage:this._grid.coverageMipmap,blur:[this.blur0Fbo,this.blur1Fbo]}}}const y8t={dataType:At.UNSIGNED_BYTE,internalFormat:Ue.RGBA},b8t={};class v8t{constructor(t){this.rctx=t,this._activeTargets=new Set,this._depthTextures=new Map,this._depthBuffers=new Map,this._colorTextures=new Map,this._framebuffers=new Map,this.depthTextureSupported=t.capabilities.depthTexture}dispose(){this._depthBuffers.forEach(t=>t.dispose()),this._depthBuffers.clear(),this._depthTextures.forEach(t=>t.dispose()),this._depthTextures.clear(),this._colorTextures.forEach(t=>t.dispose()),this._colorTextures.clear(),this._framebuffers.forEach(t=>t.dispose()),this._framebuffers.clear(),this._activeTargets.clear()}disposeTargetResource(t){const r=t.id;this._activeTargets.has(r)&&(this._activeTargets.delete(r),this._disposeWithFramebuffers(this._depthTextures,r),this._disposeWithFramebuffers(this._depthBuffers,r),this._disposeWithFramebuffers(this._colorTextures,r))}_disposeWithFramebuffers(t,r){const i=t.get(r);i&&(this._framebuffers.forEach((n,s)=>{n.colorAttachment!==i&&n.depthStencilAttachment!==i||(n.detachAll(),n.dispose(),this._framebuffers.delete(s))}),i.dispose(),t.delete(r))}getDepthTexture(t,r){if(!this.depthTextureSupported)return null;let i=this._depthTextures.get(t.id);return!i||i.descriptor.width===r.width&&i.descriptor.height===r.height||(i.dispose(),i=null),i||(i=new at(this.rctx,{target:mt.TEXTURE_2D,pixelFormat:Ue.DEPTH_STENCIL,dataType:At.UNSIGNED_INT_24_8,samplingMode:tt.NEAREST,wrapMode:xt.CLAMP_TO_EDGE,width:r.width,height:r.height}),this._depthTextures.set(t.id,i),this._activeTargets.add(t.id)),i}getAllocatedDepthTexture(t){return this._depthTextures.get(t.id)}getDepthBuffer(t,r){if(this.depthTextureSupported)return null;let i=this._depthBuffers.get(t.id);return i?i.descriptor.width===r.width&&i.descriptor.height===r.height||i.resize(r.width,r.height):(i=new MS(this.rctx,{internalFormat:cl.DEPTH_STENCIL,...r}),this._depthBuffers.set(t.id,i),this._activeTargets.add(t.id)),i}getColorTexture(t,r){let i=this._colorTextures.get(t.id);return i&&(i.descriptor.width===r.width&&i.descriptor.height===r.height||(i.dispose(),i=null)),i||(i=new at(this.rctx,{target:mt.TEXTURE_2D,pixelFormat:Ue.RGBA,internalFormat:t.internalFormat,dataType:t.dataType,samplingMode:t.samplingMode!=null?t.samplingMode:tt.LINEAR,wrapMode:xt.CLAMP_TO_EDGE,width:r.width,height:r.height}),this._colorTextures.set(t.id,i),this._activeTargets.add(t.id)),i}getAllocatedColorTexture(t){return this._colorTextures.get(t.id)}registerDepthTarget(t={}){return{id:ic(),...b8t,...t}}registerColorTarget(t={}){return{id:ic(),...y8t,...t}}getFramebuffer(t,r,i){const n=this._getKey(r,i);let s=this._framebuffers.get(n);const a=this.getColorTexture(r,t);if(this.depthTextureSupported){const l=i?this.getDepthTexture(i,t):void 0;return s?((s.width!==t.width||s.height!==t.height||s.colorTexture!==a||s.depthStencilTexture!==l)&&(s.detachAll(),s.resize(t.width,t.height),s.attachColorTexture(a),s.attachDepthStencilTexture(l)),s):(s=_(i)?new Pi(this.rctx,{colorTarget:hn.TEXTURE,depthStencilTarget:Pr.DEPTH_STENCIL_TEXTURE},a,l):new Pi(this.rctx,{colorTarget:hn.TEXTURE,depthStencilTarget:Pr.NONE},a),this._framebuffers.set(n,s),s)}const o=i?this.getDepthBuffer(i,t):void 0;return s?((s.width!==t.width||s.height!==t.height||s.colorTexture!==a)&&(s.detachAll(),s.resize(t.width,t.height),s.attachColorTexture(a),s.attachDepthStencilBuffer(o)),s):(s=new Pi(this.rctx,{colorTarget:hn.TEXTURE,depthStencilTarget:i?Pr.DEPTH_STENCIL_RENDER_BUFFER:Pr.NONE},a,o),this._framebuffers.set(n,s),s)}_getKey(t,r){return`${t.id}_${r?r.id:"X"}_${t.name}${r?"_"+r.name:""}`}get gpuMemoryUsage(){let t=0;const r=new Set,i=n=>{r.has(n)||(r.add(n),t+=Ww(n))};return this._depthTextures.forEach(i),this._colorTextures.forEach(i),this._depthBuffers.forEach(i),t}}class _8t{constructor(t,r){this._rctx=t,this._compositingHelper=r,this._mainColorTarget=0,this._dimensions={width:4,height:4},this._needLastFrameColorTexture=!1,this._background={type:"color",color:[0,0,0,1]};const i=t.type===yr.WEBGL2;this._renderTargetHelper=new v8t(t);const n=this._renderTargetHelper;this.mainColorTargets=[n.registerColorTarget({name:"mainColorTarget0"}),n.registerColorTarget({name:"mainColorTarget1"})],this.frontFaceTarget=n.registerColorTarget({name:"frontFaceTarget"});const s=a=>n.registerColorTarget({name:a,dataType:At.FLOAT,internalFormat:i?gt.RGBA32F:Ue.RGBA,samplingMode:tt.NEAREST});this.colorFloatTarget=s("colorFloatTarget"),this.alphaFloatTarget=s("alphaFloatTarget"),this.mainDepth=n.registerDepthTarget({name:"mainDepth"}),this.linearDepth=n.registerColorTarget({name:"linearDepth",samplingMode:tt.NEAREST}),this.terrainLinearDepth=n.registerColorTarget({name:"terrainLinearDepth"}),this.geometryLinearDepth=n.registerColorTarget({name:"geometryLinearDepth"}),this.normal=n.registerColorTarget({name:"normal"}),this.highlight=n.registerColorTarget({name:"highlight",internalFormat:i?gt.RGBA4:Ue.RGBA,dataType:At.UNSIGNED_SHORT_4_4_4_4}),this.hudVisibility=n.registerColorTarget({name:"hudVisibility",internalFormat:i?gt.RGBA4:Ue.RGBA,dataType:At.UNSIGNED_SHORT_4_4_4_4}),this.tmpColor=n.registerColorTarget({name:"tmpColor"}),this.tmpDepth=n.registerDepthTarget({name:"tmpDepth"}),this.hudColor=n.registerColorTarget({name:"hudColor"})}dispose(){this._renderTargetHelper.dispose()}get width(){return this._dimensions.width}get height(){return this._dimensions.height}set background(t){this._background=t}get background(){return this._background}get currentColorTarget(){return this.mainColorTargets[this._mainColorTarget]}get previousColorTarget(){return this.mainColorTargets[1-this._mainColorTarget]}get framebuffer(){return this.getFramebuffer(this.currentColorTarget,this.mainDepth)}getFramebuffer(t,r){return this._renderTargetHelper.getFramebuffer(this._dimensions,t,r)}get colorTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.currentColorTarget)}get depthTexture(){return this._renderTargetHelper.getAllocatedDepthTexture(this.mainDepth)}get linearDepthTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.linearDepth)}get terrainLinearDepthTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.terrainLinearDepth)}get geometryLinearDepthTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.geometryLinearDepth)}get lastFrameColorTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.previousColorTarget)}get normalTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.normal)}get highlightTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.highlight)}get hudVisibilityTexture(){return this._getColorTexture(this.hudVisibility)}get tmpColorTexture(){return this._getColorTexture(this.tmpColor)}get hudColorTexture(){return this._getColorTexture(this.hudColor)}get mainColorTexture(){return this._getColorTexture(this.currentColorTarget)}advanceCurrentRenderTarget(){this._mainColorTarget=this._mainColorTarget===0&&this._needLastFrameColorTexture?1:0}initializeFrame(t){const r=this._rctx;this._dimensions.width=t.fullWidth,this._dimensions.height=t.fullHeight,this.bindTarget(this.currentColorTarget,this.mainDepth),r.setClearStencil(0);const i=this._background.color;r.setClearColor(i[0]*i[3],i[1]*i[3],i[2]*i[3],i[3]),r.clearSafe(ii.COLOR_BUFFER_BIT|ii.DEPTH_BUFFER_BIT|ii.STENCIL_BUFFER_BIT)}composite(t){_(this.colorTexture)&&this._compositingHelper.composite(t,this.colorTexture,to.None)}renderTmpAndCompositeToMain(t,r,i,n=!1){this.renderToTargets(t,this.tmpColor,n?this.tmpDepth:this.mainDepth,w8t),this._compositingHelper.composite(r,this._getColorTexture(this.tmpColor),i)}renderHUDVisibility(t,r=!1){this.renderToTargets(t,this.hudVisibility,r?this.tmpDepth:this.mainDepth,x8t)}compositeTransparentTerrainOntoHUDVisibility(t){this.renderToTargets(()=>this._compositingHelper.composite(t,this._getColorTexture(this.tmpColor),to.None,1,Jc.TransparentToHUDVisibility),this.hudVisibility,this.tmpDepth)}renderOITPass(t,r,i){let n,s;switch(r){case yt.Color:n=this.colorFloatTarget,s=[0,0,0,0];break;case yt.Alpha:n=this.alphaFloatTarget,s=[1,1,1,1];break;case yt.FrontFace:n=this.frontFaceTarget,s=[0,0,0,0]}i?this.renderToTargets(t,n,this.tmpDepth,s,!0,!0):this.renderToTargets(t,n,this.mainDepth,s,!1)}compositeTransparentTerrainOntoMain(t){this.bindFramebuffer(),this._compositingHelper.composite(t,this._getColorTexture(this.tmpColor),to.PremultipliedAlpha)}compositeOccludedOntoMain(t,r){this.bindFramebuffer(),this._compositingHelper.composite(t,this._getColorTexture(this.tmpColor),to.PremultipliedAlpha,r)}compositeTransparentOntoOpaque(t,r){r?(this.bindTarget(this.hudColor,this.tmpDepth),this._rctx.setClearColor(0,0,0,1e-13),this._rctx.clearSafe(ii.COLOR_BUFFER_BIT)):this.bindFramebuffer(),this._compositingHelper.compositeTransparent(t,this._getColorTexture(this.colorFloatTarget),this._getColorTexture(this.alphaFloatTarget),this._getColorTexture(this.frontFaceTarget))}bindFramebuffer(){this._rctx.bindFramebuffer(this.framebuffer)}renderDepthDetached(t){this.bindTarget(this.currentColorTarget),t(),this.bindTarget(this.currentColorTarget,this.mainDepth)}disposeTarget(t){this._renderTargetHelper.disposeTargetResource(t)}set needLastFrameColorTexture(t){!t&&this._needLastFrameColorTexture&&(this._mainColorTarget=0,this.disposeTarget(this.mainColorTargets[1])),this._needLastFrameColorTexture=t}get needLastFrameColorTexture(){return this._needLastFrameColorTexture}renderToTargets(t,r,i,n,s=!1,a=!1){const o=this._rctx,l=this.bindTarget(r,i);let c=0;if(n){const h=Math.max(1e-13,n[3]);o.setClearColor(n[0],n[1],n[2],h),c|=ii.COLOR_BUFFER_BIT}return s&&(c|=ii.DEPTH_BUFFER_BIT),a===!1?a=0:(a===!0&&(a=255),c|=ii.STENCIL_BUFFER_BIT),c&&o.clearSafe(c,a),t(),o.gl.flush(),this.bindTarget(this.currentColorTarget,this.mainDepth),l}bindTarget(t,r){const i=this._renderTargetHelper.getFramebuffer(this._dimensions,t,r);return this._rctx.bindFramebuffer(i),i}_getColorTexture(t){return this._renderTargetHelper.getColorTexture(t,this._dimensions)}get gpuMemoryUsage(){let t=0;return this._renderTargetHelper&&(t+=this._renderTargetHelper.gpuMemoryUsage),t}}const w8t=[0,0,0,0],x8t=[0,1,0,1];class T8t{constructor(t){this.context=t,this._renderPlugins=new Qt,this.slots=[];for(let r=0;r<Ee.MAX_SLOTS;++r)this.slots[r]=[]}add(t,r,i){const n=()=>{if(i!=null&&i.aborted)throw r.uninitializeRenderContext(),br();this._renderPlugins.push(r);for(const a of t)this.slots[a].push(r);this.context.requestRender()},s=r.initializeRenderContext(this.context,i);if($u(s))return s.then(n);n()}remove(t){if(this._renderPlugins.removeUnordered(t)!=null){for(let r=0;r<this.slots.length;++r)this.slots[r]=this.slots[r].filter(i=>i!==t);t.uninitializeRenderContext(),this.context.requestRender()}}prepareRender(){this._renderPlugins.forAll(t=>{t.prepareRender&&t.prepareRender(this.context.renderContext)})}updateAnimation(t){let r=!1;return this._renderPlugins.forAll(i=>{i.updateAnimation&&(r=i.updateAnimation(t)||r)}),r}render(){const t=this.slots[this.context.renderContext.bindParameters.slot],r=new Array;t.filter(i=>{if(!i.canRender)return!1;if(S8t(i)){const n=i.prepareTechnique(this.context.renderContext);return!!n&&(r.push(n),!0)}return r.push(null),!0}).forEach((i,n)=>i.render(this.context.renderContext,r[n]))}queryDepthRange(t){const r=E8t;return r.near=1/0,r.far=-1/0,this._renderPlugins.forAll(i=>{if(i.queryDepthRange){const n=i.queryDepthRange(t);n&&z9(r,n,r)}}),r}get needsTransparentPass(){return this._renderPlugins.some(t=>t.needsTransparentPass)}get needsHighlight(){return this._renderPlugins.some(t=>t.needsHighlight)}get needsLinearDepth(){return this._renderPlugins.some(t=>t.needsLinearDepth)}get needsLaserlineWithContrastControl(){const t=this.slots[Ee.LASERLINES_CONTRAST_CONTROL];return!!t&&t.length>0}get renderOccludedFlags(){return this._renderPlugins.reduce((t,r)=>t|r.renderOccludedFlags,0)}}function S8t(e){return"prepareTechnique"in e}const E8t={near:0,far:0};class pPe extends bRe{}const QU=255,C8t=1/QU;function A8t(){const e=new Qr,t=e.fragment;return t.include(bd),t.include(Ou),e.include(bU),e.include(__),e.include(pU,{receiveShadows:!0}),t.uniforms.add([new Wt("depthMap",r=>r.linearDepthTexture),new Ei("inverseViewMatrix",(r,i)=>Rn(vbe,wl(vbe,i.camera.viewMatrix,i.camera.center))),new _r("nearFar",(r,i)=>i.camera.nearFar)]),t.constants.add("sampleValue","float",C8t),t.code.add(S`void main(void) {
float depth = rgba2float(texture2D(depthMap, uv));
if (depth == 0.0) {
discard;
}
float currentPixelDepth = linearDepthFromFloat(depth, nearFar);
if (-currentPixelDepth > nearFar.y || -currentPixelDepth < nearFar.x) {
discard;
}
vec4 currentPixelPos = vec4(reconstructPosition(gl_FragCoord.xy, currentPixelDepth), 1.0);
vec4 worldSpacePos = inverseViewMatrix * currentPixelPos;
mat4 shadowMatrix;
float linearDepth = -currentPixelDepth;
int i = chooseCascade(linearDepth, shadowMatrix);
if (i >= numCascades) {
discard;
}
vec3 lvpos = lightSpacePosition(worldSpacePos.xyz, shadowMatrix);
if (lvpos.z >= 1.0 || lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) {
discard;
}
vec2 uvShadow = cascadeCoordinates(i, lvpos);
float depthShadow = readShadowMapDepth(uvShadow, shadowMapTex);
bool shadow = depthShadow < lvpos.z;
if (!shadow) {
discard;
}
gl_FragColor = vec4(sampleValue);
}`),e}const vbe=Ae(),R8t=Object.freeze(Object.defineProperty({__proto__:null,ShadowCastAccumulatePassParameters:pPe,shadowCastMaxSamples:QU,build:A8t},Symbol.toStringTag,{value:"Module"}));var hx;(function(e){e[e.Gradient=0]="Gradient",e[e.Threshold=1]="Threshold",e[e.COUNT=2]="COUNT"})(hx||(hx={}));class HK extends xl{constructor(){super(...arguments),this.visualization=hx.Gradient,this.bandsEnabled=!1}}d([H({count:hx.COUNT})],HK.prototype,"visualization",void 0),d([H()],HK.prototype,"bandsEnabled",void 0);function O8t(e){const t=new Qr,r=t.fragment;r.include(bd),r.include(Ou),t.include(bU),t.include(__);const{visualization:i,bandsEnabled:n}=e;r.constants.add("inverseSampleValue","float",QU),r.uniforms.add([new Wt("shadowCastMap",o=>o.shadowCastMap),new He("sampleScale",o=>o.sampleScale),new He("opacityFromElevation",o=>o.opacityFromElevation),new cr("uColor",o=>o.color)]);const s=i===hx.Gradient,a=i===hx.Threshold;return s&&n?r.uniforms.add(new He("bandSize",o=>o.bandSize)):a&&r.uniforms.add(new He("threshold",o=>o.threshold)),r.code.add(S`
      void main(void) {
        vec4 record = texture2D(shadowCastMap, uv);
        float pixelSamples = record.r * inverseSampleValue;
        if (pixelSamples < 1.0) {
          discard;
        }

        float strength = pixelSamples * sampleScale;

        ${a?S`
            if (strength <= threshold) {
              discard;
            }`:""}

        ${s&&n?S`strength = ceil(strength / bandSize) * bandSize;`:""}

        gl_FragColor = vec4(uColor.xyz, uColor.a * opacityFromElevation ${s?S`* strength`:""});
      }
    `),t}const M8t=Object.freeze(Object.defineProperty({__proto__:null,build:O8t},Symbol.toStringTag,{value:"Module"}));class JU extends gi{constructor(t,r){super(t,r,()=>this.destroy())}initializeProgram(t){const r=JU.shader.get().build(this.configuration);return new ai(t.rctx,r,Ur)}initializePipeline(){return jt({blending:wu,colorWrite:or,depthTest:null,depthWrite:null})}get primitiveType(){return Dt.TRIANGLE_STRIP}}JU.shader=new si(M8t,()=>ie(()=>import("./ShadowCastVisualize.glsl.a473c06e.js"),[],import.meta.url));const P8t=Tr(.01,0,.25,1),I8t=4e4,$8t=5e4,mPe=1/512;let $D=class extends xe{constructor(e,t,r,i){super({}),this._techniqueRepository=e,this._rctx=t,this._shadowAccumulator=r,this._requestRender=i,this._passParameters={shadowCastMap:this._shadowCastTexture,sampleScale:0,color:P8t,threshold:.5,bandSize:.1,opacityFromElevation:1,__tagStrict:"NoParameters"},this._techniqueConfig=new HK,this._enabled=!1,this._vao=Tl(t),this._techniqueConfig.visualization=hx.Gradient}normalizeCtorArgs(){return{}}dispose(){this._stop(),this._vao=Qe(this._vao),this._techniqueRepository.release(this._technique),this._technique=null,this._shadowAccumulator=null}get visualizeShadowCastTechnique(){return this._technique=this._techniqueRepository.releaseAndAcquire(JU,this._techniqueConfig,this._technique),this._technique}render(e){if(!this._isRenderingVisualization)return;this._passParameters.sampleScale=1/this._computedSamples;const t=this.visualizeShadowCastTechnique;this._rctx.bindVAO(this._vao),this._rctx.bindTechnique(t,this._passParameters,e),this._rctx.drawArrays(t.primitiveType,0,io(this._vao,"geometry"))}setOptions(e){e.enabled!==void 0&&this._setEnabled(e.enabled),e.color!==void 0&&this._setColor(e.color),e.threshold!==void 0&&(this._threshold=e.threshold),e.visualization!==void 0&&(this._visualization=e.visualization),e.bandSize!==void 0&&(this._bandSize=e.bandSize),e.bandsEnabled!==void 0&&(this._bandsEnabled=e.bandsEnabled)}get opacityFromElevation(){return this._passParameters.opacityFromElevation}set opacityFromElevation(e){this._passParameters.opacityFromElevation!==e&&(this._passParameters.opacityFromElevation=e,this.notifyChange("opacityFromElevation"))}get _isRenderingVisualization(){return this._enabled&&this._computedSamples>0&&this.opacityFromElevation>mPe}get _computedSamples(){return this._shadowAccumulator.computedSamples}get _shadowCastTexture(){return this._shadowAccumulator.shadowCastTexture}get _threshold(){return this._passParameters.threshold}set _threshold(e){this._threshold!==e&&(this._passParameters.threshold=e,this._requestRenderIfRunning())}get _visualization(){return this._techniqueConfig.visualization}set _visualization(e){e!==this._visualization&&(this._techniqueConfig.visualization=e,this._techniqueRepository.release(this._technique),this._technique=null,this._requestRenderIfRunning())}get _bandSize(){return this._passParameters.bandSize}set _bandSize(e){e!==this._bandSize&&(this._passParameters.bandSize=e,this._requestRenderIfRunning())}get _bandsEnabled(){return this._techniqueConfig.bandsEnabled}set _bandsEnabled(e){e!==this._bandsEnabled&&(this._techniqueConfig.bandsEnabled=e,this._techniqueRepository.release(this._technique),this._technique=null,this._requestRenderIfRunning())}_setColor(e){const t=this._passParameters.color;lA(e,t)||(hp(this._passParameters.color,e),this._requestRenderIfRunning())}_setEnabled(e){e!==this._enabled&&(e?this._start():this._stop())}_requestRenderIfRunning(){this._enabled&&this._requestRender()}_start(){this._enabled=!0,this._requestRender()}_stop(){this._enabled=!1,this._requestRender()}};d([f()],$D.prototype,"opacityFromElevation",null),$D=d([$("esri.views.3d.webgl-engine.lib.ShadowCastRenderer")],$D);class KU extends gi{constructor(t,r){super(t,r,()=>this.destroy())}initializeProgram(t){const r=KU.shader.get().build();return new ai(t.rctx,r,Ur)}initializePipeline(){return jt({blending:ka(Re.ONE,Re.ONE,Re.ONE,Re.ONE),colorWrite:or,depthTest:null,depthWrite:null})}get primitiveType(){return Dt.TRIANGLE_STRIP}}KU.shader=new si(R8t,()=>ie(()=>import("./ShadowCastAccumulate.glsl.1cbf9cc9.js"),[],import.meta.url));var mC;let xo=mC=class extends xe{constructor(e,t,r,i,n,s){super({}),this._rctx=e,this._stage=r,this._prepareForShadowMapPass=i,this._renderToShadowMap=n,this._requestRender=s,this._progress=0,this._sampleCount=0,this._passParameters=new pPe,this._enabled=!1,this._cachedLightDirections=[],this._depthRange=FK,this._previewing=!1,this._handles=new Ft,this._cameraForcedForScreenshot=!1,this._bindParameters=new Fz(new bae(e,r.viewingMode),null,null),this._bindParameters.shadowMap.enabled=!0,this._bindParameters.camera=new ni,this._vao=Tl(e);const a={colorTarget:hn.TEXTURE,depthStencilTarget:Pr.NONE,width:0,height:0},o={target:mt.TEXTURE_2D,pixelFormat:Ue.RGBA,dataType:At.UNSIGNED_BYTE,samplingMode:tt.LINEAR,wrapMode:xt.CLAMP_TO_EDGE,width:0,height:0};this._fbo=new Pi(e,a,o),this._accumulationRenderer=new $D(t,e,this,s);const l=this._stage.resourceController.scheduler;this._handles.add(l.registerTask(bt.SHADOW_ACCUMULATOR,this)),this._handles.add(re(()=>r.renderView,c=>{this._handles.remove(mC.renderViewHandleKey),R(c)||this._handles.add(c.events.on("force-camera-for-screenshot",()=>this._cameraForcedForScreenshot=!0),mC.renderViewHandleKey)},Yn))}normalizeCtorArgs(){return{}}get computedSamples(){return this._progress}get shadowCastTexture(){return this._fbo.colorTexture}get isAccumulating(){return this._isPreviewing||this._isRefining}get accumulationTechnique(){if(R(this._accumulationTechnique)){const e={rctx:this._rctx,viewingMode:this._stage.viewingMode};this._accumulationTechnique=new KU(e,new xl)}return this._accumulationTechnique}get _isRefining(){return this._isActive&&!this._isDoneAccumulating&&!this._previewing}get _isPreviewing(){return this._isActive&&this._previewing}get _isActive(){return this._enabled&&this._sampleCount>0}get canAccumulate(){return this._passParameters.linearDepthTexture!==null&&this._depthRange!==FK&&this._opacityFromElevation>mPe}get _isDoneAccumulating(){return this._progress>=this._sampleCount}get _lightDirections(){return this._cachedLightDirections}set _lightDirections(e){const t=this._cachedLightDirections;if(Gv(t,e,Lw))return;const r=e.length;t.length=r,this._sampleCount=Math.min(QU,r);for(let i=0;i<r;++i){const n=e[i],s=t[i]||M();oe(s,n),t[i]=s}this._invalidate()}get _opacityFromElevation(){return this._accumulationRenderer.opacityFromElevation}set _opacityFromElevation(e){this._accumulationRenderer.opacityFromElevation=e}get running(){return this._isRefining&&this.canAccumulate&&this._progress>0}runTask(e){for(this._prepareForShadowMapPass(this._bindParameters);!e.done&&!this._isDoneAccumulating;)this._accumulateShadow(),e.madeProgress();this._requestRender()}renderAccumulation(e,t,r,i){if(this._passParameters.linearDepthTexture=e,this._depthRange=t,this._updateCamera(r),this._bindParameters.contentCamera=i,this.notifyChange("canAccumulate"),!this.isAccumulating||!this.canAccumulate)return;(this._previewing||this._progress===0||this._cameraForcedForScreenshot)&&this._clear();const n=this._cameraForcedForScreenshot?this._sampleCount:Math.min(mC.previewSamples,this._sampleCount-this._progress);for(let s=0;s<n;++s)this._accumulateShadow();this._cameraForcedForScreenshot=!1}render(e){this._accumulationRenderer.render(e)}dispose(){this._stop(),this._handles.destroy(),this._accumulationRenderer=Qe(this._accumulationRenderer),this._bindParameters.shadowMap.dispose(),this._fbo=Qe(this._fbo),this._vao=Qe(this._vao),this._accumulationTechnique=ri(this._accumulationTechnique),this._cachedLightDirections.length=0,this._sampleCount=0}setOptions(e){e.enabled!==void 0&&(this.enabled=e.enabled),e.previewing!==void 0&&(this.previewing=e.previewing),e.lightDirections!==void 0&&(this.lightDirections=e.lightDirections),this._accumulationRenderer.setOptions(e)}set previewing(e){this._previewing!==e&&(this._previewing=e,this._requestRenderIfEnabled())}set lightDirections(e){this._lightDirections=e}readAccumulatedShadow(e,t){if(!this._isActive||this._progress<1||e<0||e>this._fbo.width||t<0||t>this._fbo.height)return 0;const r=L8t;return this._fbo.readPixels(e,t,1,1,Ue.RGBA,At.UNSIGNED_BYTE,r),r[0]/this._progress}_start(){this._progress=0,this._enabled=!0}_stop(){this._enabled=!1}_invalidate(){this._progress=0,this._requestRenderIfEnabled()}_clear(){this._rctx.bindFramebuffer(this._fbo),this._rctx.setClearColor(0,0,0,0),this._rctx.clearSafe(ii.COLOR_BUFFER_BIT),this._progress=0}_accumulateShadow(){const e=this._lightDirections[this._progress];this._renderToShadowMap(this._bindParameters,e,this._depthRange),this._passParameters.origin=this._bindParameters.camera.center,this._rctx.bindFramebuffer(this._fbo);const t=this.accumulationTechnique;this._rctx.bindTechnique(t,this._passParameters,this._bindParameters),this._rctx.bindVAO(this._vao),this._rctx.drawArrays(t.primitiveType,0,io(this._vao,"geometry")),this._progress++}_updateCamera(e){e.equals(this._bindParameters.camera)||(this._bindParameters.camera.copyFrom(e),this._fbo.resize(e.fullWidth,e.fullHeight),this._opacityFromElevation=1-D5(I8t,$8t,e.relativeElevation))}set enabled(e){e!==this._enabled&&(e?this._start():this._stop())}_requestRenderIfEnabled(){this._enabled&&this._requestRender()}get test(){const e=this;return{lightDirections:this._lightDirections,get isDone(){return e._isDoneAccumulating},get isActive(){return e._isActive}}}};xo.previewSamples=6,xo.renderViewHandleKey="renderView",d([f()],xo.prototype,"_progress",void 0),d([f()],xo.prototype,"_sampleCount",void 0),d([f()],xo.prototype,"_enabled",void 0),d([f()],xo.prototype,"_depthRange",void 0),d([f()],xo.prototype,"_previewing",void 0),d([f()],xo.prototype,"_accumulationRenderer",void 0),d([f()],xo.prototype,"_isRefining",null),d([f()],xo.prototype,"_isActive",null),d([f()],xo.prototype,"canAccumulate",null),d([f()],xo.prototype,"_isDoneAccumulating",null),d([f()],xo.prototype,"_opacityFromElevation",null),d([f()],xo.prototype,"running",null),xo=mC=d([$("esri.views.3d.webgl-engine.lib.ShadowAccumulator")],xo);const L8t=new Uint8Array(4),_be={highlightedThreshold:.99999,selfShadowThreshold:.025};function D8t(){const e=new Qr;e.include(ax,{receiveShadows:!0});const t=e.fragment;return t.include(bd),t.include(Ou),e.include(bU),e.include(__),t.uniforms.add([new Wt("defaultDepthTex",(r,i)=>i.shadowMap.getSnapshot(L9.Default)),new Wt("highlightDepthTex",(r,i)=>i.shadowMap.getSnapshot(L9.Highlight)),new Wt("depthMap",(r,i)=>i.linearDepthTexture),new Wt("highlightMap",(r,i)=>i.highlightColorTexture),new cr("uColor",r=>r.shadowColor),new _r("nearFar",(r,i)=>i.camera.nearFar),new He("opacity",r=>r.shadowOpacity),new He("occludedOpacity",r=>r.occludedShadowOpacity),new He("terminationFactor",r=>r.opacityElevation*r.dayNightTerminator),new St("lightingMainDirectionView",(r,i)=>we(xbe,ze(xbe,i.lighting.lightingMainDirection,i.camera.viewInverseTransposeMatrix))),new _r("texelSize",(r,i)=>_(i.linearDepthTexture)?vr(F8t,1/i.linearDepthTexture.descriptor.width,1/i.linearDepthTexture.descriptor.height):Zh),new Ei("inverseViewMatrix",(r,i)=>Rn(wbe,wl(wbe,i.camera.viewMatrix,i.camera.center)))]),t.constants.add("unoccludedHighlightFlag","vec4",fAe).add("highlightedThreshold","float",_be.highlightedThreshold).add("selfShadowThreshold","float",_be.selfShadowThreshold),t.code.add(S`vec3 normalFromDepth(vec3 pixelPos, vec2 fragCoord, vec2 uv, vec2 texelSize, sampler2D depthMap, vec2 nearFar) {
float leftPixelDepth = linearDepthFromTexture(depthMap, uv + vec2(-1.0, 0.0) * texelSize, nearFar);
float rightPixelDepth = linearDepthFromTexture(depthMap, uv + vec2(1.0, 0.0) * texelSize, nearFar);
float bottomPixelDepth = linearDepthFromTexture(depthMap, uv + vec2(0.0, -1.0) * texelSize, nearFar);
float topPixelDepth = linearDepthFromTexture(depthMap, uv + vec2(0.0, 1.0) * texelSize, nearFar);
bool pickLeft = abs(pixelPos.z - leftPixelDepth) < abs(pixelPos.z - rightPixelDepth);
bool pickBottom = abs(pixelPos.z - bottomPixelDepth) < abs(pixelPos.z - topPixelDepth);
vec3 fragCoordHorizontal = pickLeft
? vec3(fragCoord + vec2(-1.0, 0.0), leftPixelDepth)
: vec3(fragCoord + vec2(1.0, 0.0), rightPixelDepth);
vec3 fragCoordVertical = pickBottom
? vec3(fragCoord + vec2(0.0, -1.0), bottomPixelDepth)
: vec3(fragCoord + vec2(0.0, 1.0), topPixelDepth);
vec3 verticalPixelPos = reconstructPosition(fragCoordHorizontal.xy, fragCoordHorizontal.z);
vec3 horizontalPixelPos = reconstructPosition(fragCoordVertical.xy, fragCoordVertical.z);
vec3 normal = normalize(cross(verticalPixelPos - pixelPos, horizontalPixelPos - pixelPos));
return pickLeft == pickBottom ? normal : -normal;
}`),t.code.add(S`void main(void) {
vec4 highlightInfo = texture2D(highlightMap, uv);
float visiblyHighlighted = (1.0 - clamp(distance(unoccludedHighlightFlag, highlightInfo), 0.0, 1.0)) * highlightInfo.a;
if (visiblyHighlighted > highlightedThreshold) {
discard;
}
float depth = rgba2float(texture2D(depthMap, uv));
if (depth == 0.0) {
discard;
}
float currentPixelDepth = linearDepthFromFloat(depth, nearFar);
if (-currentPixelDepth>nearFar.y || -currentPixelDepth<nearFar.x) {
discard;
}
vec4 currentPixelPos = vec4(reconstructPosition(gl_FragCoord.xy, currentPixelDepth), 1.0);
vec4 worldSpacePos = inverseViewMatrix * currentPixelPos;
mat4 shadowMatrix;
float linearDepth = -currentPixelDepth;
int i = chooseCascade(linearDepth, shadowMatrix);
if (i >= numCascades) {
discard;
}
vec3 lvpos = lightSpacePosition(worldSpacePos.xyz, shadowMatrix);
if (lvpos.z >= 1.0 || lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) {
discard;
}
vec2 uvShadow = cascadeCoordinates(i, lvpos);
float depthHighlight = readShadowMapDepth(uvShadow, highlightDepthTex);
bool shadowHighlight = depthHighlight < lvpos.z;
if (!shadowHighlight) {
discard;
}
float depthDefault = readShadowMapDepth(uvShadow, defaultDepthTex);
bool shadowDefault = depthDefault < lvpos.z;
vec3 normal = normalFromDepth(currentPixelPos.xyz, gl_FragCoord.xy, uv, texelSize, depthMap, nearFar);
bool shaded = dot(normal, lightingMainDirectionView) < selfShadowThreshold;
float fragOpacity = (shadowDefault || shaded) ? occludedOpacity : opacity;
gl_FragColor = vec4(uColor.rgb, uColor.a * fragOpacity * terminationFactor);
}`),e}const wbe=Ae(),xbe=M(),F8t=it(),N8t=Object.freeze(Object.defineProperty({__proto__:null,build:D8t},Symbol.toStringTag,{value:"Module"}));class k8t extends as{constructor(){super(...arguments),this.shadowColor=Tr(1,0,1,1),this.shadowOpacity=.2,this.occludedShadowOpacity=.1,this.opacityElevation=1,this.dayNightTerminator=1}}class eB extends gi{constructor(t){super(t,null,()=>this.destroy())}initializeProgram(t){const r=eB.shader.get().build();return new ai(t.rctx,r,Ur)}initializePipeline(){return jt({blending:ka(Re.SRC_ALPHA,Re.ONE,Re.ONE_MINUS_SRC_ALPHA,Re.ONE_MINUS_SRC_ALPHA),colorWrite:or,depthTest:null,depthWrite:null})}get primitiveType(){return Dt.TRIANGLE_STRIP}}eB.shader=new si(N8t,()=>ie(()=>import("./ShadowHighlight.glsl.5aa3e8f2.js"),[],import.meta.url));const V8t=.001953125,z8t=4e4,U8t=5e4;class B8t{constructor(t,r){this._rctx=t,this._viewingMode=r,this._maxOpacity=1,this._passParameters=new k8t,this._drawParameters=new bRe,this._vao=Tl(this._rctx)}get technique(){return R(this._technique)&&(this._technique=new eB({rctx:this._rctx,viewingMode:this._viewingMode})),this._technique}render(t,r){if(!t.shadowMap.enabled||!t.linearDepthTexture||!this.isVisible)return;const i=this.technique;this._drawParameters.origin=t.camera.center,this._rctx.bindFramebuffer(r),this._rctx.bindTechnique(i,this._passParameters,t).bindDraw(this._drawParameters,t),this._rctx.bindVAO(this._vao),this._rctx.drawArrays(i.primitiveType,0,io(this._vao,"geometry"))}get gpuMemoryUsage(){var t,r;return(r=(t=this._vao)==null?void 0:t.size)!=null?r:0}setDefaultOptions(t){this._passParameters={...this._passParameters,...t},this._updateMaxOpacity()}updateParameters(t,r){this._passParameters.opacityElevation=1-D5(z8t,U8t,t.relativeElevation);const i=this._viewingMode===Be.Global?we(Tbe,t.center):ne(Tbe,0,0,1),n=Se(i,r);this._passParameters.dayNightTerminator=D5(0,1,Le(30*n,0,1))}dispose(){this._vao=Qe(this._vao),this._technique=ri(this._technique)}get isVisible(){const{opacityElevation:t,dayNightTerminator:r}=this._passParameters;return this._maxOpacity*t*r>=V8t}_updateMaxOpacity(){const t=Math.max(this._passParameters.shadowOpacity,this._passParameters.occludedShadowOpacity);this._maxOpacity=t*this._passParameters.shadowColor[3]}}const Tbe=M(),Sbe=b_();class G8t{constructor(){this._plane=b_()}get isEnabled(){return!LSe(this.plane,Sbe)}get plane(){return this._plane}set plane(t){Ax(t||Sbe,this._plane)}}var om;(function(e){e[e.EdgeDetector=0]="EdgeDetector",e[e.BlendWeight=1]="BlendWeight",e[e.Blur=2]="Blur",e[e.COUNT=3]="COUNT"})(om||(om={}));class gPe extends xl{constructor(){super(...arguments),this.output=om.EdgeDetector}}d([H({count:om.COUNT})],gPe.prototype,"output",void 0);const Vb={threshold:.05,localConstrastAdaption:2,maxSearchSteps:8,maxDistanceAreaTex:16};function j8t(e){const t=new Qr;return e.output===om.EdgeDetector&&(t.attributes.add(O.POSITION,"vec2"),t.vertex.uniforms.add(new pl("resolution")),t.varyings.add("fTexCoord","vec2"),t.varyings.add("fOffset[3]","vec4"),t.vertex.code.add(S`void SMAAEdgeDetectionVS( vec2 texcoord ) {
fOffset[0] = texcoord.xyxy + resolution.xyxy * vec4( -1.0, 0.0, 0.0,  1.0 );
fOffset[1] = texcoord.xyxy + resolution.xyxy * vec4(  1.0, 0.0, 0.0, -1.0 );
fOffset[2] = texcoord.xyxy + resolution.xyxy * vec4( -2.0, 0.0, 0.0,  2.0 );
}
void main() {
fTexCoord = (position + 1.0 ) * 0.5;
gl_Position = vec4(position, 0, 1);
SMAAEdgeDetectionVS( fTexCoord );
}`),t.fragment.uniforms.add(new Hi("tColor")),t.fragment.code.add(S`
      vec4 SMAAColorEdgeDetectionPS( vec2 texcoord, vec4 offset[3], sampler2D colorTex ) {
        vec2 threshold = vec2( ${S.float(Vb.threshold)} );

        // Calculate color deltas:
        vec4 delta;
        vec3 C = texture2D( colorTex, texcoord ).rgb;

        vec3 Cleft = texture2D( colorTex, offset[0].xy ).rgb;
        vec3 t = abs( C - Cleft );
        delta.x = max( max( t.r, t.g ), t.b );

        vec3 Ctop = texture2D( colorTex, offset[0].zw ).rgb;
        t = abs( C - Ctop );
        delta.y = max( max( t.r, t.g ), t.b );

        // We do the usual threshold:
        vec2 edges = step( threshold, delta.xy );

        // Then discard if there is no edge:
        if ( dot( edges, vec2( 1.0, 1.0 ) ) == 0.0 )
            discard;

        // Calculate right and bottom deltas:
        vec3 Cright = texture2D( colorTex, offset[1].xy ).rgb;
        t = abs( C - Cright );
        delta.z = max( max( t.r, t.g ), t.b );

        vec3 Cbottom  = texture2D( colorTex, offset[1].zw ).rgb;
        t = abs( C - Cbottom );
        delta.w = max( max( t.r, t.g ), t.b );

        // Calculate the maximum delta in the direct neighborhood:
        float maxDelta = max( max( max( delta.x, delta.y ), delta.z ), delta.w );

        // Calculate left-left and top-top deltas:
        vec3 Cleftleft  = texture2D( colorTex, offset[2].xy ).rgb;
        t = abs( C - Cleftleft );
        delta.z = max( max( t.r, t.g ), t.b );

        vec3 Ctoptop = texture2D( colorTex, offset[2].zw ).rgb;
        t = abs( C - Ctoptop );
        delta.w = max( max( t.r, t.g ), t.b );

        // Calculate the final maximum delta:
        maxDelta = max( max( maxDelta, delta.z ), delta.w );

        // Local contrast adaptation in action:
        edges.xy *= step( maxDelta, float(${S.float(Vb.localConstrastAdaption)}) * delta.xy );

        return vec4( edges, 0.0, 0.0 );
      }

      void main() {
        gl_FragColor = SMAAColorEdgeDetectionPS( fTexCoord, fOffset, tColor );
      }
    `)),e.output===om.BlendWeight&&(t.attributes.add(O.POSITION,"vec2"),t.vertex.uniforms.add(new pl("resolution")),t.varyings.add("fTexCoord","vec2"),t.varyings.add("fOffset[3]","vec4"),t.varyings.add("fPixCoord","vec2"),t.vertex.code.add(S`
      void SMAABlendingWeightCalculationVS( vec2 texcoord ) {
        fPixCoord = texcoord * resolution.zw;
        fOffset[0] = texcoord.xyxy + resolution.xyxy * vec4( -0.25, 0.125, 1.25, 0.125 );
        fOffset[1] = texcoord.xyxy + resolution.xyxy * vec4( -0.125, 0.25, -0.125, -1.25 );
        fOffset[2] = vec4( fOffset[0].xz, fOffset[1].yw ) + vec4( -2.0, 2.0, -2.0, 2.0 ) * resolution.xxyy * float( ${S.int(Vb.maxSearchSteps)} );
      }

      void main() {
        fTexCoord = (position + 1.0 ) * 0.5;
        gl_Position = vec4(position, 0, 1);
        SMAABlendingWeightCalculationVS( fTexCoord );
      }
    `),t.fragment.uniforms.add(new Hi("tEdges")),t.fragment.uniforms.add(new Hi("tArea")),t.fragment.uniforms.add(new Hi("tSearch")),t.fragment.uniforms.add(new Hi("tColor")),t.fragment.uniforms.add(new pl("resolution")),t.fragment.code.add(S`
      #define SMAA_AREATEX_PIXEL_SIZE ( 1.0 / vec2( 160.0, 560.0 ) )
      #define SMAA_AREATEX_SUBTEX_SIZE ( 1.0 / 7.0 )

      vec4 SMAASampleLevelZeroOffset(sampler2D texture, vec2 coord, vec2 offset) {
        return texture2D(texture, coord + offset.x * resolution.xy, 0.0);
      }

      vec2 round( vec2 x ) {
        return sign( x ) * floor( abs( x ) + 0.5 );
      }

      float SMAASearchLength( sampler2D searchTex, vec2 e, float bias, float scale ) {
        e.r = bias + e.r * scale;
        return 255.0 * texture2D( searchTex, e, 0.0 ).r;
      }

      float SMAASearchXLeft( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
        vec2 e = vec2( 0.0, 1.0 );
        for ( int i = 0; i < ${S.int(Vb.maxSearchSteps)}; i ++ ) {
          e = texture2D( edgesTex, texcoord, 0.0 ).rg;
          texcoord -= vec2( 2.0, 0.0 ) * resolution.xy;
          if ( ! ( texcoord.x > end && e.g > 0.8281 && e.r == 0.0 ) ) break;
        }
        texcoord.x += 0.25 * resolution.x;
        texcoord.x += resolution.x;
        texcoord.x += 2.0 * resolution.x;
        texcoord.x -= resolution.x * SMAASearchLength(searchTex, e, 0.0, 0.5);
        return texcoord.x;
      }

      float SMAASearchXRight( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
        vec2 e = vec2( 0.0, 1.0 );
        for ( int i = 0; i < ${S.int(Vb.maxSearchSteps)}; i ++ ) {
          e = texture2D( edgesTex, texcoord, 0.0 ).rg;
          texcoord += vec2( 2.0, 0.0 ) * resolution.xy;
          if ( ! ( texcoord.x < end && e.g > 0.8281 && e.r == 0.0 ) ) break;
        }
        texcoord.x -= 0.25 * resolution.x;
        texcoord.x -= resolution.x;
        texcoord.x -= 2.0 * resolution.x;
        texcoord.x += resolution.x * SMAASearchLength( searchTex, e, 0.5, 0.5 );
        return texcoord.x;
      }

      float SMAASearchYUp( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
        vec2 e = vec2( 1.0, 0.0 );
        for ( int i = 0; i < ${S.int(Vb.maxSearchSteps)}; i ++ ) {
          e = texture2D( edgesTex, texcoord, 0.0 ).rg;
          texcoord += vec2( 0.0, 2.0 ) * resolution.xy;
          if ( ! ( texcoord.y > end && e.r > 0.8281 && e.g == 0.0 ) ) break;
        }
        texcoord.y -= 0.25 * resolution.y;
        texcoord.y -= resolution.y;
        texcoord.y -= 2.0 * resolution.y;
        texcoord.y += resolution.y * SMAASearchLength( searchTex, e.gr, 0.0, 0.5 );
        return texcoord.y;
      }

      float SMAASearchYDown( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
        vec2 e = vec2( 1.0, 0.0 );
        for ( int i = 0; i < ${S.int(Vb.maxSearchSteps)}; i ++ ) {
          e = texture2D( edgesTex, texcoord, 0.0 ).rg;
          texcoord -= vec2( 0.0, 2.0 ) * resolution.xy;
          if ( ! ( texcoord.y < end && e.r > 0.8281 && e.g == 0.0 ) ) break;
        }
        texcoord.y += 0.25 * resolution.y;
        texcoord.y += resolution.y;
        texcoord.y += 2.0 * resolution.y;
        texcoord.y -= resolution.y * SMAASearchLength( searchTex, e.gr, 0.5, 0.5 );
        return texcoord.y;
      }

      vec2 SMAAArea( sampler2D areaTex, vec2 dist, float e1, float e2, float offset ) {
        vec2 texcoord = float( ${S.int(Vb.maxDistanceAreaTex)} ) * round( 4.0 * vec2( e1, e2 ) ) + dist;
        texcoord = SMAA_AREATEX_PIXEL_SIZE * texcoord + ( 0.5 * SMAA_AREATEX_PIXEL_SIZE );
        texcoord.y += SMAA_AREATEX_SUBTEX_SIZE * offset;
        return texture2D( areaTex, texcoord, 0.0 ).rg;
      }

      vec4 SMAABlendingWeightCalculationPS( vec2 texcoord, vec2 pixcoord, vec4 offset[ 3 ], sampler2D edgesTex, sampler2D areaTex, sampler2D searchTex, ivec4 subsampleIndices ) {
        vec4 weights = vec4( 0.0, 0.0, 0.0, 0.0 );
        vec2 e = texture2D( edgesTex, texcoord ).rg;
        if ( e.g > 0.0 ) {
          vec2 d;
          vec2 coords;
          coords.x = SMAASearchXLeft( edgesTex, searchTex, offset[ 0 ].xy, offset[ 2 ].x );
          coords.y = offset[ 1 ].y;
          d.x = coords.x;
          float e1 = texture2D( edgesTex, coords, 0.0 ).r;
          coords.x = SMAASearchXRight( edgesTex, searchTex, offset[ 0 ].zw, offset[ 2 ].y );
          d.y = coords.x;
          d = d * resolution.z - pixcoord.x;
          vec2 sqrt_d = sqrt( abs( d ) );
          coords.y -= 1.0 * resolution.y;
          float e2 = SMAASampleLevelZeroOffset( edgesTex, coords, vec2( 1.0, 0.0 ) ).r;
          weights.rg = SMAAArea( areaTex, sqrt_d, e1, e2, float( subsampleIndices.y ) );
        }

        if ( e.r > 0.0 ) {
          vec2 d;
          vec2 coords;
          coords.y = SMAASearchYUp( edgesTex, searchTex, offset[ 1 ].xy, offset[ 2 ].z );
          coords.x = offset[ 0 ].x;
          d.x = coords.y;
          float e1 = texture2D( edgesTex, coords, 0.0 ).g;
          coords.y = SMAASearchYDown( edgesTex, searchTex, offset[ 1 ].zw, offset[ 2 ].w );
          d.y = coords.y;
          d = d * resolution.w - pixcoord.y;
          vec2 sqrt_d = sqrt( abs( d ) );
          coords.y -= 1.0 * resolution.y;
          float e2 = SMAASampleLevelZeroOffset( edgesTex, coords, vec2( 0.0, 1.0 ) ).g;
          weights.ba = SMAAArea( areaTex, sqrt_d, e1, e2, float( subsampleIndices.x ) );

          // for some reason the following lines are necessary to prevent
          // texture lookup precision issues on some Intel integrated graphics chips
          vec4 dbg = (offset[ 0 ]+offset[ 1 ]+offset[ 2 ] + coords.xyyx);
          weights.r += 0.00000001 * dot(vec4(0,1,0,1),dbg);
        }
        return weights;
      }

      void main() {
        gl_FragColor = SMAABlendingWeightCalculationPS( fTexCoord, fPixCoord, fOffset, tEdges, tArea, tSearch, ivec4( 0.0 ) );
      }
    `)),e.output===om.Blur&&(t.attributes.add(O.POSITION,"vec2"),t.vertex.uniforms.add(new pl("resolution")),t.varyings.add("fTexCoord","vec2"),t.varyings.add("fOffset[2]","vec4"),t.vertex.code.add(S`void SMAANeighborhoodBlendingVS( vec2 texcoord ) {
fOffset[0] = texcoord.xyxy + resolution.xyxy * vec4( -1.0, 0.0, 0.0, 1.0 );
fOffset[1] = texcoord.xyxy + resolution.xyxy * vec4( 1.0, 0.0, 0.0, -1.0 );
}
void main() {
fTexCoord = (position + 1.0 ) * 0.5;
gl_Position = vec4(position, 0, 1);
SMAANeighborhoodBlendingVS(fTexCoord);
}`),t.fragment.uniforms.add(new Hi("tBlendWeights")),t.fragment.uniforms.add(new Hi("tColor")),t.fragment.uniforms.add(new pl("resolution")),t.fragment.code.add(S`vec4 SMAANeighborhoodBlendingPS( vec2 texcoord, vec4 offset[ 2 ], sampler2D colorTex, sampler2D blendTex ) {
vec4 a;
a.xz = texture2D( blendTex, texcoord ).xz;
a.y = texture2D( blendTex, offset[ 1 ].zw ).g;
a.w = texture2D( blendTex, offset[ 1 ].xy ).a;
if ( dot(a, vec4( 1.0, 1.0, 1.0, 1.0 )) < 1e-5 ) {
return texture2D( colorTex, texcoord, 0.0 );
} else {
vec2 offset;
offset.x = a.a > a.b ? a.a : -a.b;
offset.y = a.g > a.r ? -a.g : a.r;
if ( abs( offset.x ) > abs( offset.y )) {
offset.y = 0.0;
} else {
offset.x = 0.0;
}
vec4 C = texture2D( colorTex, texcoord, 0.0 );
texcoord += sign( offset ) * resolution.xy;
vec4 Cop = texture2D( colorTex, texcoord, 0.0 );
float s = abs( offset.x ) > abs( offset.y ) ? abs( offset.x ) : abs( offset.y );
vec4 mixed = mix(C, Cop, s);
return mixed;
}
}
void main() {
gl_FragColor = SMAANeighborhoodBlendingPS( fTexCoord, fOffset, tColor, tBlendWeights );
}`)),t}const q8t=Object.freeze(Object.defineProperty({__proto__:null,build:j8t},Symbol.toStringTag,{value:"Module"}));class tB extends gi{initializeProgram(t){const r=tB.shader.get().build(this.configuration);return new ai(t.rctx,r,Ur)}initializePipeline(){return jt({colorWrite:or})}}tB.shader=new si(q8t,()=>ie(()=>import("./SMAA.glsl.5d0d5b85.js"),[],import.meta.url));let gC=class extends xe{constructor(e,t){super({}),this.rctx=e,this._techniqueRep=t,this._isEnabled=!1}normalizeCtorArgs(){return{}}dispose(){this._abortController=qh(this._abortController),this.disable()}_loadResources(e){if(_(this._abortController))return!1;if(_(this._searchTexture))return!0;this._abortController=new AbortController;const t=this._abortController.signal;return ie(()=>import("./SmaaRenderPassData.ee8f84d8.js"),[],import.meta.url).then(r=>this._loadTextures(r,t)).then(()=>e()).finally(()=>this._abortController=null),!1}_loadTextures(e,t){return Et(t),Promise.all([this._loadTextureFromBase64(e.areaTexture,tt.LINEAR,Ue.RGB),this._loadTextureFromBase64(e.searchTexure,tt.NEAREST,Ue.LUMINANCE)]).then(([r,i])=>{bs(t)?(r.dispose(),i.dispose(),Et(t)):(this._areaTexture=r,this._searchTexture=i)})}get updating(){return _(this._abortController)}enable(e){if(this._isEnabled)return!0;if(!this._edgeDetectTechnique||!this._blendWeightsTechnique||!this._blurTechnique){const t=new gPe,r=(i,n)=>this._techniqueRep.releaseAndAcquire(tB,i,n);t.output=om.EdgeDetector,this._edgeDetectTechnique=r(t,this._edgeDetectTechnique),t.output=om.BlendWeight,this._blendWeightsTechnique=r(t,this._blendWeightsTechnique),t.output=om.Blur,this._blurTechnique=r(t,this._blurTechnique)}return!!this._loadResources(e)&&(this._vao=wlt(this.rctx),this._edges=new Pi(this.rctx,{colorTarget:hn.TEXTURE,depthStencilTarget:Pr.NONE},{target:mt.TEXTURE_2D,pixelFormat:Ue.RGB,dataType:At.UNSIGNED_BYTE,samplingMode:tt.LINEAR,wrapMode:xt.CLAMP_TO_EDGE,width:4,height:4}),this._blend=new Pi(this.rctx,{colorTarget:hn.TEXTURE,depthStencilTarget:Pr.NONE},{target:mt.TEXTURE_2D,pixelFormat:Ue.RGBA,dataType:At.UNSIGNED_BYTE,samplingMode:tt.LINEAR,wrapMode:xt.CLAMP_TO_EDGE,width:4,height:4}),this._isEnabled=!0,!0)}disable(){this._isEnabled&&(this._vao=Qe(this._vao),this._areaTexture=Qe(this._areaTexture),this._searchTexture=Qe(this._searchTexture),this._blend=Qe(this._blend),this._edges=Qe(this._edges),this._isEnabled=!1)}render(e){if(!this._isEnabled)return;const t=this.rctx,r=t.getBoundFramebufferObject(),i={x:0,y:0,width:e.descriptor.width,height:e.descriptor.height};t.bindVAO(this._vao),t.setViewport(i.x,i.y,i.width,i.height),this._edges.resize(i.width,i.height),t.bindFramebuffer(this._edges),t.setClearColor(0,0,0,1),t.clear(ii.COLOR_BUFFER_BIT);const n=t.bindTechnique(this._edgeDetectTechnique);n.bindTexture("tColor",e),n.setUniform4f("resolution",1/i.width,1/i.height,i.width,i.height),t.drawArrays(Dt.TRIANGLES,0,3),this._blend.resize(i.width,i.height),t.bindFramebuffer(this._blend),t.setClearColor(0,0,1,1),t.clear(ii.COLOR_BUFFER_BIT);const s=t.bindTechnique(this._blendWeightsTechnique);s.setUniform4f("resolution",1/i.width,1/i.height,i.width,i.height),s.bindTexture("tSearch",this._searchTexture),s.bindTexture("tArea",this._areaTexture),s.bindTexture("tEdges",this._edges.colorTexture),t.drawArrays(Dt.TRIANGLES,0,3),t.bindFramebuffer(r),t.setClearColor(0,1,0,1),t.clear(ii.COLOR_BUFFER_BIT);const a=t.bindTechnique(this._blurTechnique);a.setUniform4f("resolution",1/i.width,1/i.height,i.width,i.height),a.bindTexture("tColor",e),a.bindTexture("tBlendWeights",this._blend.colorTexture),t.drawArrays(Dt.TRIANGLES,0,3)}_loadTextureFromBase64(e,t,r){return Dp(e).then(i=>new at(this.rctx,{pixelFormat:r,dataType:At.UNSIGNED_BYTE,wrapMode:xt.CLAMP_TO_EDGE,width:i.width,height:i.height,samplingMode:t},i))}};d([f()],gC.prototype,"_abortController",void 0),d([f({readOnly:!0})],gC.prototype,"updating",null),gC=d([$("esri.views.3d.webgl-engine.lib.SmaaRenderPass")],gC);function H8t(e,t){const r=t,i=-e[0],n=-e[1],s=-e[2],a=r[3],o=r[7],l=r[11],c=r[15];r[0]+=a*i,r[1]+=a*n,r[2]+=a*s,r[4]+=o*i,r[5]+=o*n,r[6]+=o*s,r[8]+=l*i,r[9]+=l*n,r[10]+=l*s,r[12]+=c*i,r[13]+=c*n,r[14]+=c*s}function W8t(e,t){const r=t,i=e[0],n=e[1],s=e[2];r[12]+=i*r[0]+n*r[4]+s*r[8],r[13]+=i*r[1]+n*r[5]+s*r[9],r[14]+=i*r[2]+n*r[6]+s*r[10],r[14]+=i*r[3]+n*r[7]+s*r[11]}class X8t{constructor(t){this.factory=t,this.originData=new Map}acquire(t){return this.register(this.factory.getOrigin(t))}register(t){const r=this.originData.get(t.id);return r?(r.refCount++,r.origin):(this.originData.set(t.id,{refCount:1,viewMatrix:Ae(),origin:t}),t)}release(t){const r=this.originData.get(t.id);r&&(r.refCount--,r.refCount===0&&this.originData.delete(t.id))}updateViewMatrices(t){this.originData.forEach(r=>{Ln(r.viewMatrix,t),W8t(r.origin.vec3,r.viewMatrix)})}getViewMatrix(t){return this.originData.get(t.id).viewMatrix}}class Y8t extends fRe{constructor(t,r,i){super(),this.distanceFalloffFactor=t,this.minimumEdgeLength=r,this.transparency=i,this.transformNormalViewFromGlobal=Li()}}class Z8t extends pRe{constructor(){super(...arguments),this.transformNormalViewFromGlobal=Li(),this.slicePlaneLocalOrigin=M(),this.transformNormalGlobalFromModel=Li()}}function Q8t(e){const t=S`bool isNaN( float val )
{
return ( val < 0.0 || 0.0 < val || val == 0.0 ) ? false : true;
}`;e.code.add(t)}const J8t=Nr(.5,-4e-4);function K8t(e,t){const r=e.vertex;r.include(Q8t),r.constants.add("depthBias","vec2",J8t),r.uniforms.add(new _r("inverseViewport",(i,n)=>n.inverseViewport)),t.legacy?(r.uniforms.add(new Jv("localView")),r.uniforms.add(new Ei("proj",(i,n)=>n.camera.projectionMatrix)),r.code.add(S`vec2 calculateProjectedBiasXY(vec4 projPos, vec3 globalNormal) {
float offsetXY = depthBias.x;
vec4 projNormal = proj * localView * vec4(globalNormal, 0.0);
return offsetXY * projPos.w * 2.0 * inverseViewport * normalize(projNormal.xyz).xy;
}`)):(r.uniforms.add(new AO("transformNormalViewFromGlobal",i=>i.transformNormalViewFromGlobal)),r.uniforms.add(new Ei("transformProjFromView",i=>i.transformProjFromView)),r.code.add(S`vec2 calculateProjectedBiasXY(vec4 projPos, vec3 globalNormal) {
float offsetXY = depthBias.x;
vec4 projNormal = transformProjFromView * vec4(transformNormalViewFromGlobal * globalNormal, 0.0);
return offsetXY * projPos.w * 2.0 * inverseViewport * normalize(projNormal.xyz).xy;
}`)),r.code.add(S`float _calculateProjectedBiasZ(vec4 projPos) {
float offsetZ = depthBias.y;
return sqrt(max(projPos.z,0.0)) * offsetZ;
}
vec4 adjustProjectedPosition(vec4 projPos, vec3 worldNormal, float lineWidth) {
vec2 offsetXY = calculateProjectedBiasXY(projPos, worldNormal);
if (!isNaN(offsetXY.x) && !isNaN(offsetXY.y)) {
projPos.xy += offsetXY;
}
projPos.z += _calculateProjectedBiasZ(projPos);
return projPos;
}`)}function eEt(e,t){const r=e.fragment;r.constants.add("coverageTestThreshold","float",.01),t.antialiasing?r.code.add(S`#define discardByCoverage(radius, coverage) { if (coverage < coverageTestThreshold) discard; }`):r.code.add(S`#define discardByCoverage(radius, coverage) { float coverageLimit = radius <= 0.5 ? coverageTestThreshold : 0.75; if (coverage < coverageLimit) discard; }`)}function tEt(e,t){const r=e.vertex;t.silhouette?(r.code.add(S`bool isSilhouetteEdge(vec3 viewDir, vec3 normalA, vec3 normalB) {
float faceAVisible = dot(viewDir, normalA);
float faceBVisible = dot(viewDir, normalB);
return faceAVisible * faceBVisible < 0.0;
}`),t.legacy?r.code.add(S`bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos) {
vec3 viewNormalA = _modelToViewNormal(normalA);
vec3 viewNormalB = _modelToViewNormal(normalB);
vec3 viewDir = -viewPos;
if (isSilhouetteEdge(viewDir, viewNormalA, viewNormalB)) {
return false;
}
gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
return true;
}`):r.code.add(S`bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos) {
vec3 worldNormalA = _modelToWorldNormal(normalA);
vec3 worldNormalB = _modelToWorldNormal(normalB);
vec3 viewDir = -worldPos;
if (isSilhouetteEdge(viewDir, worldNormalA, worldNormalB)) {
return false;
}
gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
return true;
}`)):r.code.add(S`bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos) {
return false;
}`)}function rEt(e,t){const r=e.vertex;r.include(bd),r.uniforms.add(new He("distanceFalloffFactor",i=>i.distanceFalloffFactor)),r.code.add(S`float distanceBasedPerspectiveFactor(float distance) {
return clamp(sqrt(distanceFalloffFactor / distance), 0.0, 1.0);
}`),r.uniforms.add(new Hi("componentDataTex")),r.uniforms.add(new fy("componentDataTexInvDim")),e.attributes.add(O.COMPONENTINDEX,"float"),r.constants.add("componentColorFieldOffset","float",0),r.constants.add("componentOtherFieldOffset","float",1),r.constants.add("componentVerticalOffsetFieldOffset","float",2),r.constants.add("componentFieldCount","float",3),r.constants.add("lineWidthFractionFactor","float",8),r.constants.add("extensionLengthOffset","float",128),r.constants.add("componentTexWidth","float",4096),r.constants.add("verticalOffsetScale","float",2*roe),r.code.add(S`vec2 _componentTextureCoords(float componentIndex, float fieldOffset) {
float fieldIndex = componentFieldCount * componentIndex + fieldOffset;
float rowIndex = floor(fieldIndex / componentTexWidth);
float colIndex = mod(fieldIndex, componentTexWidth);
vec2 linearIndex = vec2(
(colIndex + 0.5) / componentTexWidth,
(rowIndex + 0.5) * componentDataTexInvDim.y
);
return linearIndex;
}
struct ComponentData {
vec4 color;
float lineWidth;
float extensionLength;
float type;
float verticalOffset;
};
ComponentData readComponentData() {
vec2 colorIndex = _componentTextureCoords(componentIndex, componentColorFieldOffset);
vec2 otherIndex = _componentTextureCoords(componentIndex, componentOtherFieldOffset);
vec2 verticalOffsetIndex = _componentTextureCoords(componentIndex, componentVerticalOffsetFieldOffset);
vec4 colorValue = texture2D(componentDataTex, colorIndex);
vec4 otherValue = texture2D(componentDataTex, otherIndex);
float verticalOffset = (rgba2float(texture2D(componentDataTex, verticalOffsetIndex)) - 0.5) * verticalOffsetScale;
return ComponentData(
vec4(colorValue.rgb, colorValue.a * otherValue.w),
otherValue.x * (255.0 / lineWidthFractionFactor),
otherValue.y * 255.0 - extensionLengthOffset,
-(otherValue.z * 255.0) + 0.5,
verticalOffset
);
}`),t.legacy?r.code.add(S`vec3 _modelToWorldNormal(vec3 normal) {
return (model * vec4(normal, 0.0)).xyz;
}
vec3 _modelToViewNormal(vec3 normal) {
return (localView * model * vec4(normal, 0.0)).xyz;
}`):(r.uniforms.add(new zA("transformNormalGlobalFromModel",i=>i.transformNormalGlobalFromModel)),r.code.add(S`vec3 _modelToWorldNormal(vec3 normal) {
return transformNormalGlobalFromModel * normal;
}`)),t.silhouette?(e.attributes.add(O.NORMALA,"vec3"),e.attributes.add(O.NORMALB,"vec3"),r.code.add(S`vec3 worldNormal() {
return _modelToWorldNormal(normalize(normalA + normalB));
}`)):(e.attributes.add(O.NORMAL,"vec3"),r.code.add(S`vec3 worldNormal() {
return _modelToWorldNormal(normal);
}`)),t.legacy?r.code.add(S`void worldAndViewFromModelPosition(vec3 modelPos, float verticalOffset, out vec3 worldPos, out vec3 viewPos) {
worldPos = (model * vec4(modelPos, 1.0)).xyz;
viewPos = (localView * vec4(worldPos, 1.0)).xyz;
}`):(r.include(pk,t),r.include(pk,t),r.uniforms.add([new AO("transformViewFromCameraRelativeRS",i=>i.transformViewFromCameraRelativeRS),new zA("transformWorldFromModelRS",i=>i.transformWorldFromModelRS),new yl("transformWorldFromModelTL",i=>i.transformWorldFromModelTL),new yl("transformWorldFromModelTH",i=>i.transformWorldFromModelTH),new St("transformWorldFromViewTL",i=>i.transformWorldFromViewTL),new St("transformWorldFromViewTH",i=>i.transformWorldFromViewTH)]),r.code.add(S`
      void worldAndViewFromModelPosition(vec3 modelPos, float verticalOffset, out vec3 worldPos, out vec3 viewPos) {
        vec3 rotatedModelPosition = transformWorldFromModelRS * modelPos;

        vec3 transformCameraRelativeFromModel = dpAdd(
          transformWorldFromModelTL,
          transformWorldFromModelTH,
          -transformWorldFromViewTL,
          -transformWorldFromViewTH
        );

        worldPos = transformCameraRelativeFromModel + rotatedModelPosition;

        if (verticalOffset != 0.0) {
          vec3 vUp = ${t.spherical?S`normalize(transformWorldFromModelTL + rotatedModelPosition);`:S`vec3(0.0, 0.0, 1.0);`}
          worldPos += verticalOffset * vUp;
        }

        viewPos = transformViewFromCameraRelativeRS * worldPos;
      }
    `)),r.uniforms.add(new Ei("transformProjFromView",(i,n)=>n.camera.projectionMatrix)),r.code.add(S`vec4 projFromViewPosition(vec3 position) {
return transformProjFromView * vec4(position, 1.0);
}`),r.code.add(S`float calculateExtensionLength(float extensionLength, float lineLength) {
return extensionLength / (log2(max(1.0, 256.0 / lineLength)) * 0.2 + 1.0);
}`)}function yPe(e){return e.mode===Qn.SKETCH||e.mode===Qn.MIXED}var Qn;(function(e){e[e.SOLID=0]="SOLID",e[e.SKETCH=1]="SKETCH",e[e.MIXED=2]="MIXED",e[e.COUNT=3]="COUNT"})(Qn||(Qn={}));function iEt(e,t){const r=e.vertex;switch(t.mode){case Qn.SKETCH:r.code.add(S`#define discardShortEdges(unpackedAttributes, lineLengthPixels) { if (lineLengthPixels <= 3.0) { gl_Position = vec4(10.0, 10.0, 10.0, 1.0); return; }}`);break;case Qn.MIXED:r.code.add(S`#define discardShortEdges(unpackedAttributes, lineLengthPixels) { if (unpackedAttributes.type <= 0.0 && lineLengthPixels <= 3.0) { gl_Position = vec4(10.0, 10.0, 10.0, 1.0); return; }}`);break;case Qn.SOLID:r.code.add(S`#define discardShortEdges(unpackedAttributes, lineLengthPixels) {}`)}}function loe(e,t){const r=e.vertex;switch(e.attributes.add(O.SIDENESS,"vec2"),t.mode===Qn.MIXED?r.code.add(S`struct UnpackedAttributes {
vec2 sideness;
vec2 sidenessNorm;
float lineWidthPixels;
float extensionLengthPixels;
float type;
};`):r.code.add(S`struct UnpackedAttributes {
vec2 sideness;
vec2 sidenessNorm;
float lineWidthPixels;
float extensionLengthPixels;
};`),t.mode){case Qn.MIXED:r.code.add(S`UnpackedAttributes unpackAttributes(ComponentData component) {
vec2 sidenessNorm = sideness;
vec2 sideness = sidenessNorm * 2.0 - 1.0;
float fType = component.type;
float extensionLengthPixels = component.extensionLength;
float lineWidth = component.lineWidth;
if (fType <= 0.0) {
extensionLengthPixels *= variantExtension * 2.0 - 1.0;
}
return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels, fType);
}`);break;case Qn.SKETCH:r.code.add(S`UnpackedAttributes unpackAttributes(ComponentData component) {
vec2 sidenessNorm = sideness;
vec2 sideness = sidenessNorm * 2.0 - 1.0;
float extensionLengthPixels = component.extensionLength;
extensionLengthPixels *= variantExtension * 2.0 - 1.0;
float lineWidth = component.lineWidth;
return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels);
}`);break;case Qn.SOLID:r.code.add(S`UnpackedAttributes unpackAttributes(ComponentData component) {
vec2 sidenessNorm = sideness;
vec2 sideness = sidenessNorm * 2.0 - 1.0;
float extensionLengthPixels = component.extensionLength;
float lineWidth = component.lineWidth;
return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels);
}`);break;case Qn.COUNT:break;default:t.mode}}function nEt(e,t){const r=e.vertex;switch(e.include(loe,t),yPe(t)&&r.uniforms.add(new kr("strokesAmplitude")),t.mode){case Qn.SOLID:r.code.add(S`float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {
return 0.0;
}`);break;case Qn.SKETCH:r.code.add(S`float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {
return strokesAmplitude;
}`);break;case Qn.MIXED:r.code.add(S`float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {
float type = unpackedAttributes.type;
if (type <= 0.0) {
return strokesAmplitude;
}
else {
return 0.0;
}
}`)}}function sEt(e,t){const r=e.vertex;e.include(loe,t);const i=e.fragment;switch(yPe(t)&&(r.uniforms.add(new fy("strokesTextureScale")),r.uniforms.add(new kr("strokesLog2Resolution")),r.uniforms.add(new kr("strokeVariants")),e.varyings.add("vStrokeUV","vec2"),i.uniforms.add(new Hi("strokesTexture")),i.uniforms.add(new kr("strokesNormalizationScale")),r.code.add(S`void calculateStyleOutputsSketch(float lineLength, UnpackedAttributes unpackedAttributes) {
vec2 sidenessNorm = unpackedAttributes.sidenessNorm;
float lineIndex = clamp(ceil(log2(lineLength)), 0.0, strokesLog2Resolution);
vStrokeUV = vec2(exp2(lineIndex) * sidenessNorm.y, lineIndex * strokeVariants + variantStroke + 0.5) * strokesTextureScale;
vStrokeUV.x += variantOffset;
}`),e.fragment.include(bd),i.code.add(S`float calculateLineOffsetSketch() {
float offsetNorm = rgba2float(texture2D(strokesTexture, vStrokeUV));
return (offsetNorm - 0.5) * strokesNormalizationScale;
}
float calculateLinePressureSketch() {
return rgba2float(texture2D(strokesTexture, vStrokeUV + vec2(0.0, 0.5)));
}`)),t.mode){case Qn.SOLID:r.code.add(S`void calculateStyleOutputs(UnpackedAttributes unpackedAttributes) {}`),i.code.add(S`float calculateLineOffset() {
return 0.0;
}
float calculateLinePressure() {
return 1.0;
}`);break;case Qn.SKETCH:r.code.add(S`void calculateStyleOutputs(UnpackedAttributes unpackedAttributes)
{
calculateStyleOutputsSketch(vLineLengthPixels, unpackedAttributes);
}`),i.code.add(S`float calculateLineOffset() {
return calculateLineOffsetSketch();
}
float calculateLinePressure() {
return calculateLinePressureSketch();
}`);break;case Qn.MIXED:e.varyings.add("vType","float"),r.code.add(S`void calculateStyleOutputs(UnpackedAttributes unpackedAttributes)
{
vType = unpackedAttributes.type;
if (unpackedAttributes.type <= 0.0) {
calculateStyleOutputsSketch(vLineLengthPixels, unpackedAttributes);
}
}`),i.code.add(S`float calculateLineOffset() {
if (vType <= 0.0) {
return calculateLineOffsetSketch();
}
else {
return 0.0;
}
}
float calculateLinePressure() {
if (vType <= 0.0) {
return calculateLinePressureSketch();
}
else {
return 1.0;
}
}`)}}function aEt(e){const t=new Qr,r=t.vertex,i=t.fragment;return e.legacy&&r.uniforms.add(new Jv("model")),e.antialiasing&&(r.code.add(S`#define ANTIALIASING 1`),i.code.add(S`#define ANTIALIASING 1`)),t.include(K8t,e),t.include(rEt,e),t.include(nEt,e),t.include(loe,e),t.include(sEt,e),t.include(Cn,e),t.include(tEt,e),t.include(eEt,e),t.include(iEt,e),t.include(Mu,e),t.varyings.add("vColor","vec4"),t.varyings.add("vRadius","float"),t.varyings.add("vPosition","vec3"),t.varyings.add("vWorldPosition","vec3"),t.varyings.add("vViewPos","vec3"),t.varyings.add("vLineLengthPixels","float"),t.varyings.add("vSizeFalloffFactor","float"),r.uniforms.add(new _r("pixelToNDC",(n,s)=>vr(oEt,2/s.camera.fullViewport[2],2/s.camera.fullViewport[3]))),r.uniforms.add(new cr("viewport",(n,s)=>s.camera.fullViewport)),r.uniforms.add(new He("pixelRatio",(n,s)=>s.camera.pixelRatio)),t.attributes.add(O.POSITION0,"vec3"),t.attributes.add(O.POSITION1,"vec3"),t.attributes.add(O.VARIANTOFFSET,"float"),t.attributes.add(O.VARIANTSTROKE,"float"),t.attributes.add(O.VARIANTEXTENSION,"float"),r.code.add(S`const float opaqueCutoff = 1.0 / 255.0;
void calculateGeometricOutputs(vec3 viewPosV0, vec3 viewPosV1, vec3 worldPosV0, vec3 worldPosV1, vec3 worldNormal, UnpackedAttributes unpackedAttributes) {
vec2 sideness = unpackedAttributes.sideness;
vec2 sidenessNorm = unpackedAttributes.sidenessNorm;
vWorldPosition = mix(worldPosV0, worldPosV1, sidenessNorm.y).xyz;
vec3 viewPos = mix(viewPosV0, viewPosV1, sidenessNorm.y);
vViewPos = viewPos;
vec4 projPosV0 = projFromViewPosition(viewPosV0);
vec4 projPosV1 = projFromViewPosition(viewPosV1);
vec4 projPos = projFromViewPosition(viewPos);
vec3 screenSpaceLineNDC = (projPosV1.xyz / projPosV1.w - projPosV0.xyz / projPosV0.w);
vec2 ndcToPixel = viewport.zw * 0.5;
vec2 screenSpaceLinePixels = screenSpaceLineNDC.xy * ndcToPixel;
float lineLengthPixels = length(screenSpaceLinePixels);
float dzPerPixel = screenSpaceLineNDC.z / lineLengthPixels;
vec2 screenSpaceDirection = screenSpaceLinePixels / lineLengthPixels;
vec2 perpendicularScreenSpaceDirection = vec2(screenSpaceDirection.y, -screenSpaceDirection.x) * sideness.x;
float falloffFactor = distanceBasedPerspectiveFactor(-viewPos.z) * pixelRatio;
float lineWidthPixels = unpackedAttributes.lineWidthPixels * falloffFactor;
float extensionLengthPixels = calculateExtensionLength(unpackedAttributes.extensionLengthPixels, lineLengthPixels) * falloffFactor;
float lineAmplitudePixels = calculateLineAmplitude(unpackedAttributes) * pixelRatio;
vSizeFalloffFactor = falloffFactor;
float lineWidthAndAmplitudePixels = lineWidthPixels + lineAmplitudePixels + lineAmplitudePixels;
float extendedLineLengthPixels = lineLengthPixels + extensionLengthPixels + extensionLengthPixels;
#ifdef ANTIALIASING
const float aaPaddingPixels = 1.0;
float halfAAPaddedLineWidthAndAmplitudePixels = lineWidthAndAmplitudePixels * 0.5 + aaPaddingPixels;
float aaPaddedRoundedCapSizePixels = lineWidthPixels * 0.5 + aaPaddingPixels;
#else
float halfAAPaddedLineWidthAndAmplitudePixels = max(lineWidthAndAmplitudePixels, 1.0) * 0.5;
float aaPaddedRoundedCapSizePixels = max(lineWidthPixels, 1.0) * 0.5;
#endif
vec2 halfAAPaddedLineWidthAndAmplitudeNDC = halfAAPaddedLineWidthAndAmplitudePixels * pixelToNDC;
vec2 aaPaddedRoundedCapSizeNDC = aaPaddedRoundedCapSizePixels * pixelToNDC;
vec2 extensionLengthNDC = extensionLengthPixels * pixelToNDC;
vec2 ndcOffset = (
screenSpaceDirection * sideness.y * (aaPaddedRoundedCapSizeNDC + extensionLengthNDC)
+ perpendicularScreenSpaceDirection * halfAAPaddedLineWidthAndAmplitudeNDC
);
projPos.xy += ndcOffset * projPos.w;
projPos.z += (dzPerPixel * (aaPaddedRoundedCapSizePixels + extensionLengthPixels)) * sideness.y * projPos.w;
projPos = adjustProjectedPosition(projPos, worldNormal, 1.0 + max((lineWidthAndAmplitudePixels - 1.0) * 0.5, 0.0));
float aaPaddedLineWithCapsLengthPixels = extendedLineLengthPixels + aaPaddedRoundedCapSizePixels + aaPaddedRoundedCapSizePixels;
float pixelPositionAlongLine = aaPaddedLineWithCapsLengthPixels * sidenessNorm.y - aaPaddedRoundedCapSizePixels;
vPosition = vec3(
halfAAPaddedLineWidthAndAmplitudePixels * sideness.x,
pixelPositionAlongLine,
pixelPositionAlongLine / extendedLineLengthPixels
);
vRadius = lineWidthPixels * 0.5;
vLineLengthPixels = extendedLineLengthPixels;
discardShortEdges(unpackedAttributes, lineLengthPixels);
gl_Position = projPos;
}
void main() {
ComponentData component = readComponentData();
UnpackedAttributes unpackedAttributes = unpackAttributes(component);
vec3 worldPosV0, worldPosV1, viewPosV0, viewPosV1;
worldAndViewFromModelPosition(position0, component.verticalOffset, worldPosV0, viewPosV0);
worldAndViewFromModelPosition(position1, component.verticalOffset, worldPosV1, viewPosV1);
vColor = component.color;
if (vColor.a < opaqueCutoff) {
gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
return;
}
if (discardNonSilhouetteEdges(viewPosV0, worldPosV0)) {
return;
}
calculateGeometricOutputs(viewPosV0, viewPosV1, worldPosV0, worldPosV1, worldNormal(), unpackedAttributes);
calculateStyleOutputs(unpackedAttributes);
}`),t.fragment.code.add(S`
    vec2 lineWithCapsDistance(float radius, vec2 position, float lineLength) {
      float lineOffset = calculateLineOffset();
      float positionX = position.x - lineOffset;

      if (radius < 1.0) {
        // Handle this specifically for subpixel sizes:
        // 1. Compute correct coverage (note coverage is computed by
        //    0.5 - dist, so we make sure that that will lead to correct
        //    subpixel coverage
        // 2. Ignore rounded caps
        float coverageX = clamp(min(radius, positionX + 0.5) - max(-radius, positionX - 0.5), 0.0, 1.0);
        float coverageY = clamp(min(lineLength, position.y + 0.5) - max(0.0, position.y - 0.5), 0.0, 1.0);

        float coverage = min(coverageX, coverageY);

        return vec2(0.5 - coverage, 0.0);
      }
      else {
        // Between -radius -> 0 for start cap, 0 for line, 0 -> radius
        float positionOnCap = position.y - clamp(position.y, 0.0, lineLength);

        vec2 lineToPosition = vec2(positionX, positionOnCap);
        return vec2(length(lineToPosition) - radius, positionOnCap / radius);
      }
    }

    void main() {
      ${e.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, vViewPos.z);":""}
      float radius = vRadius * calculateLinePressure();

      vec2 distance = lineWithCapsDistance(radius, vPosition.xy, vLineLengthPixels);
      float coverage = clamp(0.5 - distance.x, 0.0, 1.0);

      discardByCoverage(radius, coverage);
      discardBySlice(vWorldPosition);

      float alpha = vColor.a * coverage;

      gl_FragColor = vec4(vColor.rgb, alpha);

    }
  `),t}const oEt=it(),lEt=Object.freeze(Object.defineProperty({__proto__:null,build:aEt},Symbol.toStringTag,{value:"Module"}));class rB extends gi{initializeProgram(t){const r=rB.shader.get().build(this.configuration);return new ai(t.rctx,r,VK)}initializePipeline(t){return t.blendMinMax?jt({blending:ka(Re.ONE,Re.ONE,Re.ZERO,Re.ONE,Dy.ADD,t.blendMinMax.MAX),depthTest:{func:vi.LEQUAL},colorWrite:or}):jt({depthTest:{func:vi.LEQUAL},depthWrite:fc,colorWrite:or})}}rB.shader=new si(lEt,()=>ie(()=>import("./EdgeShader.glsl.fe8b6c10.js"),[],import.meta.url));class A0 extends Mo{constructor(){super(...arguments),this.mode=Qn.SOLID,this.hasSlicePlane=!1,this.silhouette=!1,this.legacy=!1,this.antialiasing=!1,this.doublePrecisionRequiresObfuscation=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1,this.spherical=!1}}d([H({count:Qn.COUNT})],A0.prototype,"mode",void 0),d([H()],A0.prototype,"hasSlicePlane",void 0),d([H()],A0.prototype,"silhouette",void 0),d([H()],A0.prototype,"legacy",void 0),d([H()],A0.prototype,"antialiasing",void 0),d([H()],A0.prototype,"doublePrecisionRequiresObfuscation",void 0),d([H()],A0.prototype,"hasMultipassTerrain",void 0),d([H()],A0.prototype,"cullAboveGround",void 0),d([H()],A0.prototype,"spherical",void 0);const cEt=8,OH=128,dEt={type:"uber",hasSlicePlane:!1,strokesTexture:null,legacy:!0,spherical:!0};class uEt{constructor(){this._value=0}get value(){return this._value}increment(){this._value++}decrement(){this._value--}}const hEt={solid:Qn.SOLID,sketch:Qn.SKETCH,uber:Qn.MIXED};class O7{constructor(t,r,i){this.rctx=t,this.shaderTechniqueRepository=r,this._configuration=new A0,this.refCount=new uEt,this.renderables=new Set,this.sortedRenderables={[Nt.TRANSPARENT]:{[Nt.TRANSPARENT]:new Qt,[Nt.OPAQUE]:new Qt},[Nt.OPAQUE]:{[Nt.TRANSPARENT]:new Qt,[Nt.OPAQUE]:new Qt}},this._renderablesDirty=!1,this._drawParameters=new Z8t,this._settings={...dEt,...i},this.key=O7.getKey(this._settings.type,this._settings.hasSlicePlane,this._settings.legacy);const n=this._settings.strokesTexture.variants;this.writerSettings={variants:n,reducedPrecision:Yr.TESTS_DISABLE_OPTIMIZATIONS},this._configuration.legacy=this._settings.legacy,this._configuration.mode=hEt[this._settings.type],this._configuration.silhouette=!1,this._configuration.antialiasing=!!this.rctx.capabilities.blendMinMax,this._configuration.hasSlicePlane=this._settings.hasSlicePlane,this._configuration.doublePrecisionRequiresObfuscation=$O(t),this._configuration.spherical=i.spherical}dispose(){this._technique=ri(this._technique)}addRenderable(t){this.renderables.add(t),this._renderablesDirty=!0}removeRenderable(t){this.renderables.delete(t),this._renderablesDirty=!0}setRenderablesDirty(){this._renderablesDirty=!0}forEachRenderable(t,r){this._renderablesDirty&&this._sortRenderables(),this.sortedRenderables[r][Nt.TRANSPARENT].forAll(t),this.sortedRenderables[r][Nt.OPAQUE].forAll(t)}updateTechnique(t,r){return this._configuration.hasMultipassTerrain=!!t.multipassTerrain.enabled,this._configuration.cullAboveGround=!!t.multipassTerrain.cullAboveGround,this._configuration.silhouette=r,this._technique=this.shaderTechniqueRepository.releaseAndAcquire(rB,this._configuration,this._technique),this._technique}bindRegularEdges(t,r){return this.rctx.bindTechnique(this.updateTechnique(r,!1),t,r)}bindSilhouetteEdges(t,r){return this.rctx.bindTechnique(this.updateTechnique(r,!0),t,r)}renderRegularEdges(t,r,i,n,s){this._render(t,r,r.regular.vao,i,n,s)}renderSilhouetteEdges(t,r,i,n,s){this._render(t,r,r.silhouette.vao,i,n,s)}_render(t,r,i,n,s,a){this._bindDraw(t,r,n,a),this.rctx.bindVAO(i),this.rctx.capabilities.instancing.drawArraysInstanced(Dt.TRIANGLE_FAN,0,4,s)}_bindDraw(t,r,i,n){if(r.components.buffer.textureBuffer.bind(t,fEt,pEt),"origin"in r.transform)t.setUniformMatrix4fv("localView",n),t.setUniformMatrix4fv("model",r.transform.modelMatrix),oe(this._drawParameters.slicePlaneLocalOrigin,r.transform.origin.vec3);else{const s=new WU(r.transform.position),a=Kh(Ebe,Ix(Ebe,r.transform.rotationScale));this._drawParameters.transformWorldFromModelTL=s.low,this._drawParameters.transformWorldFromModelTH=s.high,this._drawParameters.transformWorldFromModelRS=r.transform.rotationScale,this._drawParameters.transformNormalGlobalFromModel=a;const o=i.camera.viewInverseTransposeMatrix;ne(this._drawParameters.slicePlaneLocalOrigin,o[3],o[7],o[11])}t.bindDraw(this._drawParameters,i),this._settings.type!=="uber"&&this._settings.type!=="sketch"||this._setSketchUniforms(t)}_setSketchUniforms(t){const r=this._settings.strokesTexture,i=r.texture;R(i)||(t.bindTexture("strokesTexture",i),t.setUniform2f("strokesTextureScale",1/i.descriptor.width,1/i.descriptor.height),t.setUniform1f("strokesLog2Resolution",Math.log2(r.resolution)),t.setUniform1f("strokesNormalizationScale",r.normalizationScale),t.setUniform1f("strokesAmplitude",r.amplitude),t.setUniform1f("strokeVariants",r.variants))}_sortRenderables(){this._renderablesDirty=!1,this.sortedRenderables[Nt.TRANSPARENT][Nt.TRANSPARENT].clear(),this.sortedRenderables[Nt.TRANSPARENT][Nt.OPAQUE].clear(),this.sortedRenderables[Nt.OPAQUE][Nt.TRANSPARENT].clear(),this.sortedRenderables[Nt.OPAQUE][Nt.OPAQUE].clear(),this.renderables.forEach(r=>{r.objectTransparency!==Nt.INVISIBLE&&r.edgeTransparency!==Nt.INVISIBLE&&this.sortedRenderables[r.objectTransparency][r.edgeTransparency].push(r)});const t=(r,i)=>"origin"in r.transform&&"origin"in i.transform?r.transform.origin.id<i.transform.origin.id?-1:r.transform.origin.id>i.transform.origin.id?1:0:0;this.sortedRenderables[Nt.TRANSPARENT][Nt.TRANSPARENT].sort(t),this.sortedRenderables[Nt.TRANSPARENT][Nt.OPAQUE].sort(t),this.sortedRenderables[Nt.OPAQUE][Nt.TRANSPARENT].sort(t),this.sortedRenderables[Nt.OPAQUE][Nt.OPAQUE].sort(t)}static getKey(t,r,i){return`edges-t:${t}:${r}:${i}`}}const fEt="componentDataTex",pEt="componentDataTexInvDim",Ebe=yy();class mEt extends JOe{constructor(t){super("EdgeProcessingWorker","extract",{extract:r=>[r.dataBuffer],extractComponentsEdgeLocations:r=>[r.dataBuffer],extractEdgeLocations:r=>[r.dataBuffer]},t)}async process(t,r,i){if(i)return aoe(t);const n=this._packInput(t),s=await this.invoke(n,r);return this._unpackOutput(s)}async extractEdgeLocations(t,r){const i=this._packInput(t),n=await this.invokeMethod("extractEdgeLocations",i,r);return o$(n)}async extractComponentsEdgeLocations(t,r){const i=this._packInput(t),n=await this.invokeMethod("extractComponentsEdgeLocations",i,r);return o$(n)}_packInput(t){return{dataBuffer:t.data.buffer,writerSettings:t.writerSettings,skipDeduplicate:t.skipDeduplicate,indicesBuffer:t.indices.buffer,indicesType:mF(t.indices)?"Uint32Array":"Uint16Array",indicesLength:t.indicesLength}}_unpackOutput(t){return{regular:{instancesData:o$(t.regular.instancesData),lodInfo:{lengths:new Float32Array(t.regular.lodInfo.lengths)}},silhouette:{instancesData:o$(t.silhouette.instancesData),lodInfo:{lengths:new Float32Array(t.silhouette.lodInfo.lengths)}},averageEdgeLength:t.averageEdgeLength}}}function gEt(e){const r=G8.resolution,i=r/2,n=new Uint8Array(4*r*r),s=4*r*i,a=G8.amplitude,o=2*a,l=4*r,c=Math.log2(r)+1,u=G8.strokes.length;let h=(c-1)*u*l;for(const{distance:m,pressure:g}of G8.strokes){let b=m,w=g,v=h;for(let x=0;x<c;x++){x!==0&&(b=Cbe(b,OR.DISTANCE),w=Cbe(w,OR.PRESSURE));for(let T=0;T<G8.resolution;T++){const E=.5+(b?b[T%b.length]/o:0),C=w?w[T%w.length]:1;oR(E,n,v),oR(C,n,v+s),v+=4}v-=l*(u+1)}h+=l}const p=new at(e,{pixelFormat:Ue.RGBA,dataType:At.UNSIGNED_BYTE,hasMipmap:!1,samplingMode:tt.LINEAR,width:r,height:r,wrapMode:xt.REPEAT},n);return new bEt(r,o,a,u,p)}function Cbe(e,t){if(!e)return null;const r=e.length/2,i=yEt*r,n=new Array(r);let s=0;const a=t===OR.PRESSURE;for(let o=0;o<e.length;o+=2){const l=(e[o]+e[o+1])/2;n[s++]=a?Math.min(i,1-(1-l)*Abe):Math.min(i,l*Abe)}return n}var OR;(function(e){e[e.DISTANCE=0]="DISTANCE",e[e.PRESSURE=1]="PRESSURE"})(OR||(OR={}));const yEt=.1,Abe=.5;class bEt{constructor(t,r,i,n,s){this.resolution=t,this.normalizationScale=r,this.amplitude=i,this.variants=n,this.texture=s}dispose(){this.texture=Qe(this.texture)}}const G8={amplitude:8,resolution:256,strokes:[{distance:[-1.59027,-1.59426,-1.59674,-1.59766,-1.59702,-1.59479,-1.59095,-1.5855,-1.57843,-1.56973,-1.55942,-1.5475,-1.53398,-1.5189,-1.50226,-1.4841,-1.46446,-1.44337,-1.42088,-1.39703,-1.37188,-1.34547,-1.31786,-1.28912,-1.2593,-1.22847,-1.19668,-1.16402,-1.13053,-1.09629,-1.06137,-1.02582,-.98972,-.95313,-.91611,-.87872,-.84102,-.80306,-.76488,-.72654,-.68807,-.64952,-.61092,-.57232,-.53375,-.49527,-.45692,-.41874,-.38078,-.34309,-.3057,-.26867,-.23204,-.19585,-.16015,-.12497,-.09036,-.05634,-.02296,.00977,.04183,.07321,.10389,.13386,.16313,.19169,.21956,.24672,.27321,.299,.32413,.34858,.37237,.3955,.41798,.43981,.461,.48154,.50145,.52073,.53939,.55744,.57488,.5917,.6079,.62347,.63837,.65259,.66609,.67885,.69083,.70201,.71235,.72183,.73042,.73812,.7449,.75076,.7557,.75973,.76284,.76507,.76642,.76692,.76659,.76545,.76352,.76083,.7574,.75324,.74837,.74279,.73652,.72959,.72199,.71377,.70493,.69553,.68558,.67515,.66426,.65298,.64135,.62944,.6173,.60499,.59257,.58008,.56759,.55513,.54275,.5305,.51842,.50654,.4949,.48353,.47246,.4617,.45128,.44121,.43149,.42213,.41313,.40448,.39617,.38818,.3805,.37309,.36594,.35902,.35229,.34572,.33927,.33292,.32663,.32035,.31407,.30774,.30135,.29486,.28824,.28148,.27454,.26739,.26002,.25241,.24454,.23639,.22796,.21922,.21016,.20076,.19098,.18082,.17023,.1592,.14768,.13566,.1231,.10996,.09624,.08188,.06688,.05121,.03485,.01778,0,-.0185,-.03771,-.05763,-.07824,-.09952,-.12144,-.14396,-.16706,-.19069,-.21481,-.23938,-.26436,-.28971,-.31539,-.34136,-.36759,-.39404,-.42067,-.44746,-.47437,-.50136,-.52839,-.55544,-.58248,-.60948,-.63642,-.66329,-.6901,-.71684,-.74352,-.77015,-.79675,-.82332,-.84988,-.87644,-.90301,-.92958,-.95615,-.98272,-1.00926,-1.03575,-1.06217,-1.08847,-1.11463,-1.1406,-1.16633,-1.19178,-1.2169,-1.24164,-1.26595,-1.28979,-1.31312,-1.3359,-1.35809,-1.37963,-1.4005,-1.42064,-1.44,-1.45853,-1.47616,-1.49285,-1.50853,-1.52313,-1.53659,-1.54886,-1.55986,-1.56955,-1.57788,-1.5848],pressure:[-.01365,-.00206,.01025,.02327,.03696,.05129,.06619,.08163,.09755,.11393,.1307,.14784,.16531,.18308,.20111,.21938,.23786,.25651,.2753,.29419,.31315,.33215,.35115,.37015,.38913,.40806,.42694,.44576,.46449,.48313,.50167,.5201,.53839,.55653,.57448,.59222,.60971,.62692,.6438,.66033,.67648,.69221,.70753,.72242,.73688,.75093,.76456,.77779,.79063,.80309,.81517,.82686,.83817,.84911,.85967,.86987,.87972,.88924,.89845,.90734,.91594,.92425,.93229,.94005,.94754,.95475,.96166,.96826,.97451,.9804,.98588,.99092,.99549,.99957,.99685,.99381,.99131,.98936,.98796,.98711,.98681,.98706,.98787,.98923,.99113,.99357,.99654,1,.99607,.99171,.98695,.98181,.97634,.97057,.96452,.95824,.95175,.94506,.93818,.93113,.92389,.91647,.90887,.90109,.89314,.88501,.87672,.86831,.85978,.85119,.84256,.83393,.82533,.8168,.80836,.80002,.79181,.78374,.77582,.7681,.76059,.75331,.74629,.73955,.73311,.72697,.72116,.71568,.71054,.70572,.70121,.697,.69304,.68931,.68576,.68236,.67905,.67582,.67262,.66941,.66619,.66291,.65957,.65613,.65259,.64892,.6451,.6411,.6369,.63248,.62783,.62295,.61783,.61247,.60688,.60104,.59498,.58868,.58216,.57542,.56845,.56125,.5538,.5461,.53813,.52986,.52129,.51239,.50316,.49359,.4837,.47349,.46299,.45223,.44124,.43005,.41869,.40719,.39557,.38386,.37207,.36023,.34836,.33648,.32464,.31287,.30119,.28963,.27822,.26698,.25594,.2451,.23448,.22409,.21391,.20394,.19415,.18452,.17503,.16565,.15636,.14713,.13794,.1288,.11968,.11058,.10151,.09247,.08346,.07447,.06552,.05659,.0477,.03885,.03007,.02137,.01278,.00433,-.00393,-.012,-.01983,-.02738,-.03463,-.04155,-.0481,-.05429,-.0601,-.06553,-.07057,-.07524,-.07954,-.08347,-.08703,-.09022,-.09303,-.09544,-.09744,-.09898,-.10004,-.10059,-.1006,-.10005,-.09892,-.0972,-.09487,-.09192,-.08833,-.08409,-.07918,-.07357,-.06724,-.06019,-.0524,-.04386,-.03455,-.02448]},{distance:[-3.46259,-3.47131,-3.47668,-3.47863,-3.47712,-3.4721,-3.46352,-3.45138,-3.43566,-3.41635,-3.39347,-3.36704,-3.33709,-3.30368,-3.26684,-3.22667,-3.18322,-3.1366,-3.08689,-3.0342,-2.97865,-2.92036,-2.85946,-2.79607,-2.73034,-2.66241,-2.59242,-2.52052,-2.44686,-2.37159,-2.29485,-2.2168,-2.13757,-2.05731,-1.97616,-1.89426,-1.81174,-1.72875,-1.64543,-1.56191,-1.47833,-1.39483,-1.3115,-1.22847,-1.14581,-1.06361,-.98193,-.90083,-.82036,-.74054,-.66141,-.583,-.50532,-.4284,-.35228,-.277,-.20261,-.12916,-.05672,.01463,.08485,.15384,.22153,.28784,.35269,.41602,.47776,.53787,.59629,.653,.70799,.76123,.81274,.86253,.9106,.95698,1.0017,1.04477,1.0862,1.126,1.16415,1.20065,1.23546,1.26857,1.29994,1.32953,1.35731,1.38321,1.40719,1.42921,1.44922,1.46719,1.48309,1.49691,1.50862,1.51825,1.52581,1.53133,1.53486,1.53644,1.53616,1.53409,1.53031,1.52493,1.51803,1.50972,1.50009,1.48924,1.47725,1.46421,1.45019,1.43527,1.4195,1.40295,1.38568,1.36778,1.34929,1.3303,1.31087,1.29108,1.27099,1.25066,1.23018,1.2096,1.18898,1.16838,1.14785,1.12745,1.10721,1.08719,1.06741,1.04791,1.02871,1.00986,.99136,.97324,.95551,.93819,.92127,.90476,.88866,.87296,.85767,.84277,.82823,.81406,.80022,.7867,.77346,.76049,.74774,.73519,.72278,.71049,.69827,.68606,.67381,.66145,.64893,.63618,.62313,.60973,.5959,.5816,.56675,.5513,.53516,.51826,.50053,.4819,.46231,.44169,.42002,.39725,.37336,.34834,.32219,.2949,.2665,.23698,.20638,.17469,.14193,.10809,.07316,.03714,0,-.03827,-.07772,-.11836,-.16022,-.20332,-.24768,-.29332,-.34024,-.38844,-.43788,-.48854,-.54036,-.59329,-.64724,-.70211,-.75782,-.81425,-.87128,-.92881,-.98674,-1.04498,-1.10346,-1.1621,-1.22086,-1.27969,-1.33854,-1.3974,-1.45625,-1.51511,-1.57396,-1.63283,-1.69173,-1.75067,-1.80968,-1.86875,-1.9279,-1.98712,-2.04639,-2.10568,-2.16495,-2.22416,-2.28322,-2.34208,-2.40063,-2.4588,-2.51647,-2.57354,-2.62989,-2.68543,-2.74002,-2.79357,-2.84597,-2.89711,-2.94689,-2.99521,-3.04195,-3.087,-3.13023,-3.17152,-3.21075,-3.24779,-3.28252,-3.3148,-3.34451,-3.37154,-3.39577,-3.41709,-3.43539,-3.45059],pressure:[.87183,.87151,.87129,.87118,.87117,.87128,.87149,.87182,.87225,.8728,.87347,.87424,.87513,.87613,.87723,.87845,.87978,.88122,.88276,.88441,.88616,.88801,.88996,.892,.89414,.89637,.89868,.90108,.90356,.90611,.90874,.91144,.91421,.91704,.91993,.92287,.92587,.92892,.93201,.93514,.93831,.94151,.94474,.94799,.95126,.95456,.95786,.96118,.9645,.96783,.97116,.97448,.9778,.98111,.98441,.9877,.99096,.99421,.99742,.99938,.99622,.9931,.99001,.98697,.98397,.98101,.97811,.97526,.97246,.96972,.96703,.96441,.96185,.95935,.95691,.95455,.95225,.95002,.94786,.94577,.94376,.94182,.93995,.93817,.93646,.93483,.93328,.93181,.93042,.92911,.92788,.92673,.92566,.92467,.92376,.92293,.92217,.92149,.92088,.92034,.91987,.91947,.91913,.91886,.91864,.91849,.91838,.91833,.91834,.91839,.91849,.91863,.91883,.91907,.91935,.91968,.92005,.92046,.92092,.92142,.92195,.92253,.92314,.9238,.92449,.92521,.92598,.92677,.9276,.92847,.92936,.93029,.93125,.93224,.93325,.9343,.93537,.93646,.93758,.93872,.93988,.94106,.94225,.94346,.94469,.94593,.94718,.94844,.94971,.95098,.95226,.95354,.95482,.9561,.95738,.95867,.95995,.96122,.9625,.96377,.96504,.9663,.96757,.96883,.97009,.97135,.97261,.97387,.97513,.9764,.97767,.97895,.98023,.98153,.98284,.98416,.98549,.98684,.98821,.9896,.99101,.99244,.99389,.99537,.99688,.99842,1,.99839,.99675,.99508,.99336,.99161,.98982,.98799,.98613,.98422,.98228,.98029,.97827,.97622,.97414,.97202,.96987,.9677,.96551,.9633,.96107,.95882,.95656,.9543,.95202,.94975,.94747,.94519,.94292,.94065,.93838,.93613,.93388,.93164,.92941,.9272,.92499,.9228,.92062,.91846,.91631,.91418,.91207,.90998,.90792,.90588,.90387,.90189,.89995,.89804,.89617,.89434,.89256,.89083,.88914,.88752,.88595,.88443,.88299,.88161,.8803,.87907,.87791,.87683,.87584,.87494,.87412,.8734,.87278,.87225]},{distance:[.39335,.43437,.47737,.52234,.56923,.61801,.66864,.72109,.7753,.83123,.88882,.94801,1.00875,1.07097,1.13461,1.1996,1.26586,1.33333,1.40193,1.47158,1.54221,1.61373,1.68607,1.75913,1.83284,1.90711,1.98186,2.05699,2.13243,2.20809,2.28387,2.35971,2.4355,2.51117,2.58663,2.66179,2.73658,2.81092,2.88473,2.95792,3.03043,3.10217,3.17308,3.24309,3.31211,3.3801,3.44697,3.51267,3.57712,3.64028,3.70208,3.76247,3.8214,3.87881,3.93467,3.98892,4.04152,4.09244,4.14164,4.18908,4.23474,4.27859,4.32061,4.36077,4.39905,4.43544,4.46992,4.50249,4.53314,4.56185,4.58864,4.61349,4.63642,4.65745,4.67657,4.69381,4.7092,4.72274,4.73447,4.74441,4.75259,4.75903,4.76376,4.76682,4.76822,4.768,4.76618,4.76279,4.75786,4.75142,4.74348,4.73409,4.72326,4.71102,4.69739,4.68241,4.6661,4.64849,4.6296,4.60948,4.58816,4.56567,4.54204,4.51732,4.49154,4.46473,4.43694,4.4082,4.37854,4.348,4.31662,4.28443,4.25145,4.21773,4.1833,4.14819,4.11243,4.07606,4.03912,4.00162,3.96361,3.92512,3.88618,3.84683,3.80708,3.76697,3.72653,3.68579,3.64478,3.60351,3.56202,3.52033,3.47845,3.43642,3.39425,3.35196,3.30957,3.2671,3.22455,3.18196,3.13933,3.09668,3.05402,3.01136,2.96873,2.92613,2.88357,2.84108,2.79865,2.75631,2.71407,2.67195,2.62994,2.58807,2.54634,2.50477,2.46338,2.42216,2.38114,2.34032,2.29971,2.25933,2.21916,2.17923,2.13954,2.10008,2.06087,2.02189,1.98316,1.94468,1.90644,1.86845,1.83069,1.79316,1.75586,1.71877,1.68189,1.6452,1.60868,1.57232,1.53611,1.50004,1.46407,1.4282,1.39241,1.35668,1.321,1.28535,1.24972,1.2141,1.17849,1.14286,1.10723,1.07158,1.03593,1.00028,.96464,.92902,.89344,.85793,.8225,.78719,.75203,.71705,.68231,.64784,.61369,.57991,.54656,.51368,.48134,.44959,.41849,.3881,.35848,.32967,.30174,.27474,.24872,.22373,.19982,.17702,.15539,.13497,.11579,.09791,.08137,.06621,.05248,.04022,.02948,.02029,.01271,.00677,.00252,0,-76e-5,27e-5,.00314,.00788,.01451,.02307,.03357,.04604,.0605,.07697,.09546,.11599,.13858,.16322,.18992,.21869,.24952,.28241,.31735,.35434],pressure:[.95248,.95236,.95228,.95223,.95222,.95224,.95231,.95241,.95256,.95274,.95296,.95322,.95352,.95385,.95423,.95465,.9551,.9556,.95613,.9567,.95731,.95796,.95864,.95936,.96012,.96091,.96173,.96259,.96348,.9644,.96535,.96633,.96734,.96838,.96944,.97053,.97164,.97277,.97393,.9751,.97629,.9775,.97873,.97997,.98122,.98249,.98376,.98505,.98634,.98763,.98893,.99023,.99154,.99284,.99414,.99544,.99673,.99802,.9993,.99942,.99816,.99691,.99568,.99445,.99324,.99205,.99087,.98972,.98858,.98746,.98636,.98528,.98423,.9832,.98219,.98121,.98025,.97931,.9784,.97752,.97666,.97582,.97501,.97423,.97347,.97274,.97203,.97135,.9707,.97007,.96948,.9689,.96836,.96784,.96735,.96689,.96646,.96605,.96567,.96533,.965,.96471,.96445,.96421,.964,.96382,.96367,.96355,.96346,.96339,.96335,.96334,.96336,.9634,.96348,.96358,.9637,.96385,.96403,.96423,.96446,.96471,.96499,.96529,.96561,.96595,.96631,.96669,.96709,.96751,.96795,.9684,.96887,.96935,.96984,.97035,.97087,.9714,.97194,.97249,.97304,.97361,.97418,.97476,.97534,.97592,.97651,.97711,.9777,.9783,.9789,.9795,.9801,.9807,.9813,.9819,.9825,.98309,.98369,.98428,.98486,.98545,.98603,.98661,.98718,.98775,.98832,.98888,.98944,.99,.99056,.99112,.99167,.99223,.99279,.99335,.99392,.99449,.99507,.99565,.99624,.99684,.99745,.99807,.9987,.99934,1,.99933,.99866,.99797,.99727,.99656,.99583,.9951,.99435,.99359,.99283,.99205,.99126,.99046,.98966,.98885,.98803,.9872,.98637,.98554,.9847,.98387,.98303,.98219,.98134,.9805,.97967,.97883,.978,.97717,.97634,.97552,.97471,.97389,.97309,.97229,.9715,.97071,.96993,.96915,.96838,.96762,.96687,.96612,.96539,.96466,.96395,.96324,.96255,.96187,.9612,.96055,.95991,.95929,.95869,.95811,.95754,.957,.95648,.95599,.95552,.95508,.95467,.95428,.95393,.9536,.95331,.95305,.95283,.95264]},{distance:[2.85606,2.86149,2.86432,2.8645,2.862,2.85686,2.84912,2.83886,2.82618,2.81117,2.79393,2.77456,2.75314,2.72975,2.70447,2.67734,2.64844,2.61784,2.58564,2.55196,2.5169,2.48057,2.44305,2.40438,2.36462,2.32383,2.28208,2.23943,2.19591,2.15153,2.10628,2.06016,2.01321,1.96548,1.91702,1.86793,1.8183,1.76829,1.71803,1.66767,1.61737,1.56726,1.51746,1.46803,1.41902,1.37044,1.32228,1.27452,1.22716,1.18023,1.13376,1.08781,1.04244,.99769,.95357,.91003,.86701,.82447,.78238,.74069,.69938,.65836,.61758,.57699,.53656,.49627,.45611,.41611,.37632,.33683,.29776,.25924,.22141,.18441,.14839,.11346,.07972,.04727,.01619,-.01348,-.0417,-.0684,-.09351,-.11698,-.13875,-.1588,-.17713,-.19381,-.20889,-.22242,-.23444,-.24501,-.25421,-.26216,-.26897,-.27473,-.27951,-.28336,-.28631,-.28836,-.28948,-.28963,-.28873,-.28673,-.28355,-.27916,-.27354,-.26673,-.25878,-.2498,-.23992,-.22929,-.21802,-.20623,-.19398,-.18134,-.16836,-.1551,-.14163,-.12809,-.11461,-.1013,-.08826,-.07557,-.06335,-.0517,-.04077,-.03065,-.02143,-.01321,-.00606,0,.00496,.00888,.01181,.01385,.01511,.0157,.01574,.01533,.01458,.01358,.0124,.01112,.00979,.00851,.00738,.0065,.006,.00596,.00646,.00754,.00924,.01161,.01471,.01858,.02323,.02865,.03481,.04169,.0493,.05765,.06677,.07671,.08754,.09934,.11222,.12628,.14159,.15823,.17624,.19561,.21632,.23828,.26142,.28563,.31083,.33696,.36397,.39185,.42057,.4501,.48036,.51125,.54264,.5744,.60646,.63871,.67105,.70337,.73556,.76751,.79918,.83048,.86139,.8919,.92202,.95184,.98144,1.01094,1.04045,1.0701,1.10002,1.13029,1.16103,1.1923,1.22416,1.25664,1.28979,1.32364,1.35824,1.39363,1.42985,1.4669,1.50475,1.54332,1.58252,1.62227,1.6625,1.70312,1.744,1.78501,1.82598,1.8668,1.90734,1.94754,1.98732,2.02666,2.06555,2.10402,2.1421,2.17985,2.2173,2.25448,2.29139,2.328,2.36424,2.4,2.43515,2.46955,2.50309,2.53565,2.56717,2.59761,2.62692,2.65505,2.68191,2.7074,2.73138,2.75375,2.7744,2.79324,2.81017,2.82504,2.83772,2.8481],pressure:[.22758,.23641,.24578,.25568,.26609,.27699,.28835,.30016,.31237,.32495,.33789,.35113,.36466,.37843,.39241,.40658,.4209,.43535,.44989,.4645,.47916,.49385,.50853,.5232,.53784,.55243,.56696,.58141,.59578,.61004,.62419,.63821,.65209,.6658,.67934,.69268,.70582,.71873,.73139,.7438,.75594,.76779,.77935,.79061,.80156,.81221,.82254,.83258,.84231,.85176,.86091,.86978,.87837,.88669,.89473,.9025,.91,.91725,.92425,.931,.93752,.9438,.94985,.95566,.96124,.96658,.97168,.97652,.98109,.98539,.98939,.99309,.99646,.99949,.99783,.99552,.99361,.99209,.99098,.99029,.99003,.99019,.99079,.99181,.99324,.9951,.99735,1,.99698,.99361,.98992,.98592,.98163,.97709,.97231,.96731,.96212,.95676,.95122,.94554,.93973,.93378,.92773,.92157,.91532,.90899,.90258,.89612,.88961,.88308,.87653,.87,.8635,.85705,.85068,.8444,.83823,.83219,.82628,.82052,.81493,.80952,.8043,.79929,.7945,.78994,.78561,.78151,.77765,.77402,.77062,.76742,.76443,.76161,.75896,.75645,.75406,.75175,.74951,.7473,.74511,.74289,.74064,.73833,.73592,.73341,.73078,.728,.72507,.72197,.71869,.71522,.71156,.70769,.70363,.69936,.69489,.69021,.68533,.68023,.67492,.66939,.66363,.65765,.65145,.64501,.63833,.63143,.62428,.61691,.60931,.60148,.59344,.58521,.57679,.5682,.55948,.55063,.54167,.53264,.52354,.51439,.50522,.49603,.48686,.47773,.46865,.45964,.45072,.44192,.43324,.42469,.41629,.40804,.39994,.392,.3842,.37655,.36903,.36164,.35437,.3472,.34012,.33312,.3262,.31933,.31251,.30574,.299,.2923,.28563,.27899,.27239,.26583,.25933,.25288,.24652,.24025,.2341,.22808,.22221,.21653,.21104,.20576,.20072,.19592,.19138,.18712,.18313,.17943,.17602,.17292,.17013,.16766,.16551,.16369,.16222,.1611,.16036,.16001,.16007,.16055,.16148,.16286,.16471,.16705,.16988,.17321,.17706,.18144,.18636,.19182,.19785,.20443,.21158,.2193]},{distance:[-2.31317,-2.3191,-2.32189,-2.32154,-2.31811,-2.31174,-2.30254,-2.29062,-2.27609,-2.25904,-2.23954,-2.21767,-2.19355,-2.16732,-2.13907,-2.10885,-2.07672,-2.04268,-2.00677,-1.96911,-1.92985,-1.88914,-1.84713,-1.80397,-1.75979,-1.71467,-1.66864,-1.62171,-1.57395,-1.52546,-1.47625,-1.42628,-1.3755,-1.32384,-1.27131,-1.218,-1.16408,-1.10972,-1.05508,-1.00031,-.94551,-.89077,-.83615,-.7817,-.72757,-.6739,-.62076,-.56821,-.51625,-.46484,-.41397,-.36366,-.314,-.26506,-.21689,-.16957,-.12316,-.07766,-.03301,.01085,.05399,.09643,.13827,.17967,.22079,.26176,.30265,.34342,.38397,.42414,.46381,.50285,.54115,.57863,.61524,.65093,.6856,.71914,.75153,.78275,.81283,.84182,.86972,.89651,.92208,.94634,.96919,.99052,1.01025,1.02835,1.04484,1.05976,1.07309,1.08479,1.09492,1.1036,1.11096,1.11714,1.12224,1.12627,1.12916,1.13083,1.13125,1.13036,1.12816,1.12466,1.11992,1.11397,1.10677,1.09827,1.08849,1.07746,1.06527,1.05203,1.03786,1.02283,1.00695,.99025,.97279,.9546,.93573,.9163,.8965,.8765,.85647,.83652,.81687,.79775,.77939,.76199,.74568,.73049,.71635,.70316,.69082,.67925,.66834,.65804,.64831,.63911,.63032,.62184,.61363,.60564,.59788,.59036,.58308,.57597,.5689,.56177,.55447,.5469,.53896,.53062,.5219,.51283,.5034,.49355,.48335,.47287,.46223,.45154,.44085,.43012,.41923,.40805,.39648,.38441,.37176,.35849,.34458,.32999,.31461,.29833,.28109,.26288,.2437,.22361,.20265,.18082,.15807,.13434,.1096,.0838,.0569,.02894,0,-.0298,-.0604,-.09173,-.12364,-.15594,-.18843,-.22092,-.25331,-.28559,-.31781,-.35006,-.38244,-.41502,-.44785,-.48098,-.5144,-.54811,-.58218,-.61666,-.65153,-.68677,-.72232,-.75807,-.79397,-.83002,-.86628,-.90281,-.93968,-.97693,-1.01465,-1.05282,-1.09139,-1.13031,-1.16956,-1.20917,-1.24905,-1.28907,-1.32908,-1.36891,-1.40844,-1.44765,-1.48658,-1.52527,-1.56376,-1.60206,-1.64016,-1.67801,-1.71552,-1.75264,-1.78936,-1.8257,-1.86161,-1.89702,-1.93182,-1.96584,-1.99894,-2.03102,-2.06203,-2.0919,-2.12056,-2.14794,-2.17397,-2.19852,-2.22138,-2.24235,-2.26129,-2.27805,-2.29243,-2.30422],pressure:[.9681,.97424,.98046,.98674,.99309,.9995,.99404,.98754,.981,.97444,.96785,.96124,.95462,.94801,.94139,.93479,.92822,.92167,.91515,.90868,.90225,.89589,.88959,.88336,.87722,.87115,.86519,.85932,.85356,.84792,.84239,.83699,.83173,.8266,.82162,.81679,.81211,.80759,.80324,.79906,.79505,.79121,.78756,.78409,.78081,.77771,.77481,.77211,.76959,.76728,.76516,.76324,.76153,.76001,.75869,.75757,.75665,.75593,.7554,.75507,.75493,.75498,.75523,.75565,.75627,.75706,.75803,.75917,.76049,.76197,.76361,.76541,.76737,.76947,.77172,.77409,.7766,.77923,.78198,.78484,.7878,.79086,.79401,.79724,.80055,.80394,.8074,.81092,.8145,.81813,.82182,.82556,.82934,.83317,.83703,.84093,.84487,.84884,.85284,.85687,.86094,.86503,.86915,.87329,.87746,.88166,.88587,.89011,.89436,.89863,.90291,.9072,.91149,.91579,.92009,.92438,.92867,.93295,.9372,.94144,.94566,.94985,.954,.95812,.96219,.96623,.97021,.97415,.97802,.98184,.9856,.9893,.99293,.9965,1,.99657,.9932,.98991,.98668,.98352,.98042,.97738,.9744,.97148,.9686,.96577,.96298,.96023,.95751,.95482,.95214,.94949,.94684,.9442,.94156,.93892,.93627,.93361,.93094,.92825,.92555,.92284,.9201,.91735,.91458,.91179,.90899,.90616,.90332,.90047,.8976,.89472,.89183,.88893,.88603,.88314,.88024,.87735,.87448,.87162,.86878,.86597,.86319,.86044,.85774,.85508,.85247,.84993,.84744,.84503,.84269,.84042,.83825,.83616,.83417,.83227,.83048,.8288,.82724,.82578,.82445,.82324,.82215,.82119,.82037,.81967,.81911,.81868,.81839,.81824,.81823,.81835,.81862,.81903,.81957,.82026,.82109,.82206,.82317,.82443,.82583,.82737,.82906,.83089,.83287,.83499,.83726,.83968,.84223,.84494,.84778,.85077,.8539,.85717,.86058,.86412,.86781,.87163,.87559,.87968,.88391,.88826,.89275,.89737,.90211,.90698,.91198,.91709,.92233,.92768,.93315,.93873,.94441,.95019,.95607,.96205]},{distance:[4.72925,4.81721,4.9037,4.98859,5.07177,5.15311,5.23249,5.3098,5.38491,5.45772,5.52811,5.59598,5.66122,5.72375,5.78346,5.84028,5.8941,5.94486,5.99248,6.03689,6.07803,6.11584,6.15028,6.18128,6.20882,6.23285,6.25336,6.27031,6.28369,6.29348,6.29969,6.3023,6.30133,6.29678,6.28867,6.27703,6.26187,6.24324,6.22116,6.19567,6.16683,6.13468,6.09928,6.06068,6.01896,5.97417,5.92639,5.87569,5.82217,5.76589,5.70696,5.64545,5.58147,5.5151,5.44644,5.37559,5.30265,5.2277,5.15085,5.0722,4.99184,4.90987,4.82639,4.74151,4.65533,4.56794,4.47945,4.38996,4.29959,4.20843,4.11658,4.02416,3.93125,3.83796,3.74437,3.65057,3.55666,3.46272,3.36884,3.27509,3.18155,3.08831,2.99545,2.90303,2.81114,2.71984,2.62922,2.53933,2.45026,2.36207,2.27484,2.18862,2.10349,2.01951,1.93675,1.85528,1.77515,1.69644,1.61919,1.54348,1.46935,1.39685,1.32605,1.25698,1.18967,1.12417,1.06049,.99863,.93862,.88044,.82408,.76953,.71676,.66574,.61644,.56882,.52282,.47841,.43553,.39413,.35414,.31551,.27817,.24206,.20712,.17328,.14048,.10866,.07776,.04772,.01848,-.00999,-.03776,-.06487,-.09134,-.11721,-.14251,-.16725,-.19144,-.21509,-.2382,-.26076,-.28275,-.30416,-.32496,-.34511,-.36459,-.38334,-.40134,-.41852,-.43485,-.45026,-.46471,-.47815,-.49052,-.50179,-.51189,-.52081,-.52849,-.5349,-.54003,-.54383,-.54627,-.54734,-.54702,-.54528,-.54211,-.53752,-.53149,-.52403,-.51515,-.50487,-.4932,-.48015,-.46575,-.45001,-.43297,-.41463,-.39503,-.37419,-.35213,-.32887,-.30443,-.27885,-.25214,-.22432,-.19541,-.16544,-.13442,-.10235,-.06926,-.03514,0,.03616,.07336,.11159,.15088,.19125,.23272,.27531,.31906,.36401,.41019,.45764,.5064,.55651,.60802,.66096,.71538,.77129,.82874,.88776,.94836,1.01056,1.07438,1.13982,1.20687,1.27554,1.34581,1.41766,1.49107,1.56599,1.64239,1.72025,1.79951,1.88013,1.96209,2.04532,2.12979,2.21546,2.30226,2.39017,2.47911,2.56905,2.65991,2.75164,2.84416,2.93742,3.03133,3.12582,3.2208,3.31619,3.41191,3.50785,3.60393,3.70006,3.79612,3.89202,3.98765,4.08291,4.17767,4.27182,4.36525,4.45783,4.54944,4.63995],pressure:[.30942,.30838,.30765,.30724,.30715,.30738,.30795,.30884,.31007,.31164,.31354,.31578,.31837,.32129,.32455,.32815,.33209,.33636,.34097,.34591,.35117,.35675,.36265,.36887,.37539,.38221,.38933,.39674,.40442,.41238,.4206,.42907,.43779,.44675,.45593,.46533,.47493,.48473,.49471,.50486,.51517,.52563,.53623,.54694,.55777,.5687,.57971,.59079,.60194,.61313,.62435,.6356,.64686,.65811,.66935,.68056,.69174,.70286,.71391,.72489,.73579,.74659,.75728,.76785,.7783,.7886,.79876,.80877,.81861,.82827,.83776,.84706,.85617,.86507,.87378,.88227,.89056,.89863,.90649,.91412,.92153,.92872,.93568,.94241,.94892,.95519,.96122,.96702,.97258,.97791,.98299,.98783,.99242,.99677,.99911,.99525,.99164,.98827,.98515,.98228,.97966,.97728,.97514,.97324,.97159,.97017,.96898,.96801,.96727,.96674,.96641,.96629,.96635,.96661,.96703,.96762,.96838,.96928,.97032,.97149,.97279,.9742,.97572,.97734,.97905,.98085,.98273,.98468,.98669,.98877,.99091,.99311,.99535,.99765,1,.9976,.99516,.99267,.99014,.98755,.98491,.98222,.97947,.97666,.97378,.97083,.96781,.96471,.96153,.95826,.9549,.95144,.94787,.9442,.94042,.93651,.93249,.92834,.92407,.91966,.91512,.91045,.90564,.90069,.8956,.89037,.885,.87949,.87384,.86806,.86214,.85608,.84988,.84356,.83711,.83053,.82383,.81702,.81009,.80306,.79594,.78872,.78141,.77403,.76657,.75905,.75148,.74385,.73619,.72849,.72076,.71302,.70526,.69749,.68972,.68195,.67419,.66644,.65871,.65099,.64329,.63561,.62795,.62032,.61271,.60512,.59755,.59001,.58248,.57497,.56749,.56002,.55256,.54512,.5377,.5303,.52291,.51554,.50819,.50087,.49358,.48632,.4791,.47192,.4648,.45773,.45072,.44378,.43692,.43015,.42346,.41687,.41039,.40403,.39779,.39168,.38571,.37989,.37423,.36873,.36342,.35828,.35335,.34862,.34409,.3398,.33573,.3319,.32831,.32498,.32192,.31912,.3166,.31436,.31242,.31077]}]};function Rbe(e){let t=null;for(const r of e){const i=r.type;if(vEt(r)){if(R(t))t=i;else if(t!==i)return"uber"}}return _(t)?t:"uber"}function MH(e){let t=Nt.INVISIBLE;for(const{material:r}of e)if(bPe(r)){if(r.color[3]*r.opacity<1)return Nt.TRANSPARENT;t=Nt.OPAQUE}return t}function PH(e){let t=Nt.INVISIBLE;for(const{material:r}of e)if(bPe(r)){switch(r.objectTransparency){case Nt.TRANSPARENT:case Nt.INVISIBLE:return Nt.TRANSPARENT;case Nt.OPAQUE:if(r.opacity<1)return Nt.TRANSPARENT}t=Nt.OPAQUE}return t}function bPe(e){return e.size*e.color[3]*e.opacity>0}function vEt(e){return e.size*e.color[3]>0}function _Et(e,t){const r=p2e(e,t,!0);return r===-1?t<e[0]?0:e.length:r}function Obe(e,t,r){return e.length-_Et(e,t*r.minimumEdgeLength)}function Mbe(e,t,r,i){for(let n=0;n<e.length;n++){const s=e[n].index,a=t[n],o=t[n+1];if(i)for(let l=a;l<o;l++){const c=i[l];r.set(c,s)}else for(let l=a;l<o;l++)r.set(l,s)}}const wEt=fe.getLogger("esri.views.3d.webgl-engine.lib.edgeRendering.EdgeView");let zf=class extends xe{constructor(e){super(e),this.updatingHandles=new tm,this.perObjectData=new Map,this.perObjectDataEvictionCache=new Set,this.renderers=new Map,this.numberOfRenderedEdges={[Nt.TRANSPARENT]:0,[Nt.OPAQUE]:0},this.gpuMemoryUsage=0,this.workerAbort=new AbortController,this.tmpModelPosition=M(),this.localOrigins=new X8t(new yae(e.renderSR))}initialize(){this.worker=new mEt(this.schedule),this.componentColorManager=new cPe(this.rctx,3);const e=tPe.createBuffer(4);for(let t=0;t<4;t++)e.sideness.set(t,0,t===0||t===3?0:1),e.sideness.set(t,1,t===0||t===1?0:1);this.verticesBufferObject=dr.createVertex(this.rctx,Cr.STATIC_DRAW,e.buffer)}destroy(){this.destroyed||(this.perObjectData.forEach(e=>this._discardObjectEntry(e)),this.perObjectData.clear(),this.strokesTexture=Qe(this.strokesTexture),this.componentColorManager=ct(this.componentColorManager),this.workerAbort.abort(),this.worker.destroy(),this.verticesBufferObject=Qe(this.verticesBufferObject),this.renderers.clear(),this.updatingHandles.destroy())}get updating(){return this.updatingHandles.updating}get usedMemory(){return this.gpuMemoryUsage}get numberOfRenderedPrimitives(){return this.numberOfRenderedEdges[Nt.TRANSPARENT]+this.numberOfRenderedEdges[Nt.OPAQUE]}shouldRender(){return this.renderers.size>0}async addComponentObject(e,t,r,i,n,s,a,o){if(this.hasObject(e))return this.getObjectMemoryUsage(e);let l;const c=new Pbe(new Promise(h=>l=h),r.center,r.radius);this.perObjectData.set(e,c);const u=await this.updatingHandles.addPromise(this._addComponentGeometry(t,c,i,n,s,a,o));return this.setNeedsRender(),l(),u}async addOrUpdateObject3D(e,t,r,i){if(this.destroyed)return void wEt.warn("Attempt to add an object to a destroyed instance");const n=this.perObjectData.get(e);let s;(n==null?void 0:n.renderables.length)>0&&this.perObjectDataEvictionCache.add(n);const a=e.boundingVolumeWorldSpace.bounds,o=new Pbe(new Promise(c=>s=c),a,cy(a));this.perObjectData.set(e,o);const l=new Array;if(r.mergeGeometries&&e.geometries.length>1&&TEt(e))l.push(this._addObjectMergedGeometries(e,o,t,r,i));else for(let c=0;c<e.geometries.length;c++){const u=e.geometryRecords[c];if(!u.material.supportsEdges)continue;const h=e.geometries[c];l.push(this._addGeometry(e,o,h,u,t[0],r,i))}await this.updatingHandles.addPromise(Promise.all(l)),this.perObjectDataEvictionCache.delete(o),this._discardObjectEntry(n),this.setNeedsRender(),s()}_discardObjectEntry(e){e&&(e.renderables.length&&(e.renderables.forEach(t=>this._removeRenderable(t)),this.setNeedsRender()),e.loaded=null)}hasObject(e){return this.perObjectData.has(e)}async updateAllComponentOpacities(e,t){const r=t instanceof Array?i=>t[i]:()=>t;(await this.updatingHandles.addPromise(this._getObjectEntry(e))).renderables.forEach(i=>{const n=i.components.meta.length;for(let s=0;s<n;s++){const a=r(s),o=i.components.meta[s],l=o.index;o.material.opacity=a,i.components.buffer.textureBuffer.setDataElement(l,1,3,255*a)}this._updateTransparency(i)}),this.setNeedsRender()}async getObjectMemoryUsage(e){return(await this._getObjectEntry(e)).renderables.reduce((t,r)=>t+r.statistics.gpuMemoryUsage,0)}async updateAllComponentMaterials(e,t,r,i){const n=e instanceof rb,s=!!r.hasSlicePlane,a=Rbe(t),o=O7.getKey(a,s,n);(await this.updatingHandles.addPromise(this._getObjectEntry(e))).renderables.forEach(l=>{if(o!==l.rendererKey){const c=this.renderers.get(l.rendererKey),u=this._acquireRenderer(a,s,n);c.removeRenderable(l),c.refCount.decrement(),l.rendererKey=o,u.addRenderable(l)}for(let c=0;c<t.length;c++)l.components.meta[c].material=t[c];i&&this._updateComponentBuffer(l.components),this._updateTransparency(l)}),this.setNeedsRender()}async updateAllVerticalOffsets(e,t){(await this.updatingHandles.addPromise(this._getObjectEntry(e))).renderables.forEach(r=>{var n;const i=r.components.meta;for(let s=0;s<i.length;s++)r.components.meta[s].verticalOffset=(n=t==null?void 0:t[s])!=null?n:0;this._updateComponentBuffer(r.components)}),this.setNeedsRender()}async updateObjectVisibility(e,t){(await this.updatingHandles.addPromise(this._getObjectEntry(e))).renderables.forEach(r=>r.visible=t),this.setNeedsRender()}removeObject(e){const t=this.perObjectData.get(e);t&&(this.perObjectData.delete(e),this._discardObjectEntry(t))}async _getObjectEntry(e){const t=this.perObjectData.get(e);if(!t)throw"no object";if(await t.loaded,t.loaded==null)throw br();return t}removeAll(){this.perObjectData.forEach((e,t)=>this.removeObject(t))}render(e,t){if(this.numberOfRenderedEdges[t]=0,R(this.componentColorManager))return;this.localOrigins.updateViewMatrices(e.camera.viewMatrix);const r=e.camera.viewInverseTransposeMatrix,i=M(),n=new WU;let s=0,a=0;if(this.renderers.forEach(u=>{u.refCount.value===0?(this.renderers.delete(u.key),u.dispose()):u.forEachRenderable(h=>{h.visible&&(s+=h.statistics.averageEdgeLength,a++,h.regular&&u.updateTechnique(e,!1),h.silhouette&&u.updateTechnique(e,!0))},t)}),this.componentColorManager.garbageCollect(),this.componentColorManager.updateTextures(),a===0)return;const o=40*s/a,l=e.camera.perScreenPixelRatio,c=new Y8t(o,l,t);ne(i,r[3],r[7],r[11]),n.set(i),oe(c.transformWorldFromViewTH,n.high),oe(c.transformWorldFromViewTL,n.low),Jh(c.transformViewFromCameraRelativeRS,e.camera.viewMatrix),Kh(Ibe,c.transformViewFromCameraRelativeRS),Ix(c.transformNormalViewFromGlobal,Ibe),c.transformProjFromView=e.camera.projectionMatrix,this._updateObjectCameraDistances(e),this.renderers.forEach(u=>{this._renderRegularEdges(u,e,c),this._renderSilhouetteEdges(u,e,c)})}_updateTransparency(e){const t=MH(e.components.meta),r=PH(e.components.meta);t===e.edgeTransparency&&r===e.objectTransparency||(e.edgeTransparency=t,e.objectTransparency=r,this.renderers.get(e.rendererKey).setRenderablesDirty())}_computeModelTransformWithLocalOrigin(e,t,r){if(e.getCombinedStaticTransformation(t,r),_(t.origin))this.localOrigins.register(t.origin);else{const i=ne(this.tmpModelPosition,r[12],r[13],r[14]);t.origin=this.localOrigins.acquire(i)}return H8t(t.origin.vec3,r),t.origin}_updateComponentBuffer(e){const{meta:t,buffer:r}=e,i=new Uint8Array(4);for(let n=0;n<t.length;n++){const s=t[n].material,a=t[n].index,o=Le(Math.round(s.size*cEt),0,255),l=Le(s.extensionLength,-OH,255-OH)+OH,c=s.type==="solid"?Fk.SOLID:Fk.SKETCH,u=255*s.opacity,h=s.color,p=255*h[0],m=255*h[1],g=255*h[2],b=255*h[3];r.textureBuffer.setData(a,0,p,m,g,b),r.textureBuffer.setData(a,1,o,l,c,u),KMe(t[n].verticalOffset,i),r.textureBuffer.setData(a,2,i[0],i[1],i[2],i[3])}}_createComponentBuffers(e){if(R(this.componentColorManager))return null;const t=new Array,r=this.componentColorManager.getBuffer(e.length);for(let n=0;n<e.length;n++){const s=e[n],a=r.acquireIndex();t.push({index:a,verticalOffset:0,material:s})}const i={meta:t,buffer:r};return this._updateComponentBuffer(i),i}_extractEdges(e,t,r,i,n,s=n.length){return this.worker.process({data:t,indices:n,indicesLength:s,writerSettings:e,skipDeduplicate:r},this.workerAbort.signal,i)}_createEdgeResources(e){const t={};if(R(this.verticesBufferObject))return t;if(e.regular.lodInfo.lengths.length>0){const r=new ns(this.rctx,VK,{vertices:lbe,instances:Lk.glLayout},{vertices:this.verticesBufferObject,instances:dr.createVertex(this.rctx,Cr.STATIC_DRAW,e.regular.instancesData.buffer)});t.regular={vao:r,lod:e.regular.lodInfo}}if(e.silhouette.lodInfo.lengths.length>0){const r=new ns(this.rctx,VK,{vertices:lbe,instances:Dk.glLayout},{vertices:this.verticesBufferObject,instances:dr.createVertex(this.rctx,Cr.STATIC_DRAW,e.silhouette.instancesData.buffer)});t.silhouette={vao:r,lod:e.silhouette.lodInfo}}return t}async _addGeometry(e,t,r,i,n,s,a){const o=r.vertexAttributes.get(O.POSITION),l=r.indices.get(O.POSITION),c=Ae(),u={position:o,indices:l,modelTransform:c,origin:this._computeModelTransformWithLocalOrigin(e,i,c)};return this._addPositionData(t,u,r.edgeIndicesLength,n,s,a)}async _addPositionData(e,t,r,i,n,s=!1){if(e.loaded==null)return;const a=this._createComponentBuffers([i]);if(R(a)||r<=0)return;const o=this._acquireRenderer(i.type,!!n.hasSlicePlane,!0),{modelTransform:l,origin:c}=t,u=t.indices,h=t.position,p=h.data.length/h.size,m=CR.createBuffer(p);for(let T=0;T<p;T++)m.position.set(T,0,h.data[T*h.size+0]),m.position.set(T,1,h.data[T*h.size+1]),m.position.set(T,2,h.data[T*h.size+2]);Mbe(a.meta,[0,m.componentIndex.count],m.componentIndex);const g=await this.updatingHandles.addPromise(this._extractEdges(o.writerSettings,m,!1,s,u,r));if(e.loaded==null)return;const{regular:b,silhouette:w}=this._createEdgeResources(g),v=(b?b.vao.size:0)+(w?w.vao.size:0),x={regular:b,silhouette:w,transform:{modelMatrix:l,origin:c},statistics:{gpuMemoryUsage:v,externalMemoryUsage:!1,averageEdgeLength:g.averageEdgeLength},components:a,visible:!0,edgeTransparency:MH(a.meta),objectTransparency:PH(a.meta),distanceToCamera:0,rendererKey:o.key};e.renderables.push(x),o.addRenderable(x),this.gpuMemoryUsage+=v}async _addComponentGeometry(e,t,r,i,n,s,a){if(t.loaded==null)return 0;const o=this._createComponentBuffers(s);if(R(o))return 0;const l=Rbe(s),c=this._acquireRenderer(l,a.hasSlicePlane||!1,!1),u=CR.createBuffer(r.count);RU(u.position,r),Mbe(o.meta,n,u.componentIndex,i);const h=!0,p=c.writerSettings,m=await this.updatingHandles.addPromise(this._extractEdges(p,u,h,!1,i));if(t.loaded==null)return 0;const{regular:g,silhouette:b}=this._createEdgeResources(m),w=(g?g.vao.size:0)+(b?b.vao.size:0),v={regular:g,silhouette:b,transform:e,statistics:{gpuMemoryUsage:w,externalMemoryUsage:!0,averageEdgeLength:m.averageEdgeLength},components:o,visible:!0,edgeTransparency:MH(o.meta),objectTransparency:PH(o.meta),distanceToCamera:0,rendererKey:c.key};return t.renderables.push(v),c.addRenderable(v),w}async _addObjectMergedGeometries(e,t,r,i,n){const s=new Map;let a=0,o=null,l=0;for(let v=0;v<e.geometries.length;v++){const x=e.geometries[v],T=e.geometryRecords[v];if(!T.material.supportsEdges)continue;!o&&T.origin&&(o=T);const E=x.vertexAttributes.get(O.POSITION);l+=E.data.length/E.size,a+=x.edgeIndicesLength}const c=l>=65536?Uint32Array:Uint16Array,u=a?new c(a):null,h=[];let p=0;for(let v=0;v<e.geometries.length;v++){const x=e.geometries[v];if(!e.geometryRecords[v].material.supportsEdges)continue;const T=x.vertexAttributes.get(O.POSITION),E=x.indices.get(O.POSITION);let C=s.get(T.data);if(C==null){C=h.length/3;for(let A=0;A<T.data.length;A+=T.size)h.push(T.data[A+0]),h.push(T.data[A+1]),h.push(T.data[A+2]);s.set(T.data,C)}if(E)for(let A=0;A<x.edgeIndicesLength;A++)u[p++]=C+E[A]}const m=o||e.geometryRecords[0],g=Ae(),b=this._computeModelTransformWithLocalOrigin(e,m,g);for(let v=0;v<e.geometryRecords.length;v++)e.geometryRecords[v].origin=b;const w={position:{data:h,size:3},indices:u,modelTransform:g,origin:b};await this.updatingHandles.addPromise(this._addPositionData(t,w,u.length,r[0],i,n))}_acquireRenderer(e,t,r){const i=O7.getKey(e,t,r);let n=this.renderers.get(i);return R(this.strokesTexture)&&(this.strokesTexture=gEt(this.rctx)),n||(n=new O7(this.rctx,this.techniqueRepository,{type:e,hasSlicePlane:t,strokesTexture:this.strokesTexture,legacy:r,spherical:this.viewingMode===Be.Global}),this.renderers.set(i,n)),n.refCount.increment(),n}_removeRenderable(e){xEt(e);const t=this.renderers.get(e.rendererKey);if(t){t.removeRenderable(e),t.refCount.decrement(),"origin"in e.transform&&this.localOrigins.release(e.transform.origin),this.gpuMemoryUsage-=e.statistics.externalMemoryUsage?0:e.statistics.gpuMemoryUsage;for(const r of e.components.meta)e.components.buffer.releaseIndex(r.index)}}_updateObjectCameraDistances(e){const t=e.camera.eye,r=e.camera.viewForward,i=M(),n=s=>{const{center:a,radius:o}=s;pd(i,a,t);const l=Se(i,r),c=l<-o?1/0:l<o?0:l-o;s.renderables.forEach(u=>u.distanceToCamera=c)};this.perObjectData.forEach(n),this.perObjectDataEvictionCache.forEach(n)}_renderRegularEdges(e,t,r){const i=e.bindRegularEdges(r,t),n=r.transparency;e.forEachRenderable(s=>{if(!s.visible||!s.regular)return;const a=Obe(s.regular.lod.lengths,s.distanceToCamera,r),o="origin"in s.transform?this.localOrigins.getViewMatrix(s.transform.origin):Es;e.renderRegularEdges(i,s,t,a,o),this.numberOfRenderedEdges[n]+=a},n)}_renderSilhouetteEdges(e,t,r){const i=e.bindSilhouetteEdges(r,t),n=r.transparency;e.forEachRenderable(s=>{if(!s.visible||!s.silhouette)return;const a=Obe(s.silhouette.lod.lengths,s.distanceToCamera,r),o="origin"in s.transform?this.localOrigins.getViewMatrix(s.transform.origin):Es;e.renderSilhouetteEdges(i,s,t,a,o),this.numberOfRenderedEdges[n]+=a},n)}};function xEt(e){e.regular&&(e.regular.vao.vertexBuffers.instances.dispose(),e.regular.vao.dispose(!1),e.regular.vao=null),e.silhouette&&(e.silhouette.vao.vertexBuffers.instances.dispose(),e.silhouette.vao.dispose(!1),e.silhouette.vao=null)}function TEt(e){let t=null,r=null;for(let i=0;i<e.geometries.length;i++){const n=e.geometryRecords[i];if(n.material.supportsEdges){if(t){if(!Gv(t,n.transformation))return!1}else t=n.transformation;if(!r&&_(n.origin))r=n;else if(_(r==null?void 0:r.origin)&&_(n.origin)&&r.origin.id!==n.origin.id)return!1}}return!0}d([f({constructOnly:!0})],zf.prototype,"rctx",void 0),d([f({constructOnly:!0})],zf.prototype,"renderSR",void 0),d([f({constructOnly:!0})],zf.prototype,"viewingMode",void 0),d([f({constructOnly:!0})],zf.prototype,"techniqueRepository",void 0),d([f({constructOnly:!0})],zf.prototype,"setNeedsRender",void 0),d([f({constructOnly:!0})],zf.prototype,"schedule",void 0),d([f({readOnly:!0})],zf.prototype,"updatingHandles",void 0),d([f({readOnly:!0})],zf.prototype,"updating",null),zf=d([$("esri.views.3d.webgl-engine.lib.edgeRendering.EdgeView")],zf);class Pbe{constructor(t,r,i){this.center=r,this.radius=i,this.renderables=new Array,this.loaded=t,this.loaded.then(()=>{this.loaded!=null&&(this.loaded=!0)})}}const Ibe=Li();function SEt(e){const t=e.capabilities.disjointTimerQuery;return R(t)?null:t.timestampBits()>0?new EEt(t):WK?null:new CEt(t)}class EEt{constructor(t){this.timer=t,this.start=t.createQuery(),t.createTimestamp(this.start)}stop(t,r=50){this.end=this.timer.createQuery(),this.timer.createTimestamp(this.end),this._checkQueryResult(t,r)}_checkQueryResult(t,r){if(!this.timer.resultAvailable(this.end))return void setTimeout(()=>this._checkQueryResult(t,r),r);if(this.timer.disjoint())return void t(null);const i=this.timer.getResult(this.start),n=this.timer.getResult(this.end);t((n-i)/1e6)}}class CEt{constructor(t){this.timer=t,this.query=t.createQuery(),WK=!0,this.timer.beginTimeElapsed(this.query)}stop(t,r=50){this.timer.endTimeElapsed(),WK=!1,this._checkQueryResult(t,r)}_checkQueryResult(t,r){const i=this.timer.resultAvailable(this.query),n=this.timer.disjoint();if(!i||n)n?t(null):setTimeout(()=>this._checkQueryResult(t,r),r);else{const s=this.timer.getResult(this.query);t(s/1e6)}}}let WK=!1;var Gn;(function(e){e[e.Prepare=0]="Prepare",e[e.Shadowmap=1]="Shadowmap",e[e.Lineardepth=2]="Lineardepth",e[e.Normals=3]="Normals",e[e.SSAO=4]="SSAO",e[e.Opaque=5]="Opaque",e[e.OpaqueEdges=6]="OpaqueEdges",e[e.Transparent=7]="Transparent",e[e.TransparentEdges=8]="TransparentEdges",e[e.Hudvisibility=9]="Hudvisibility",e[e.TransparentTerrain=10]="TransparentTerrain",e[e.Atmosphere=11]="Atmosphere",e[e.Laserline=12]="Laserline",e[e.Occluded=13]="Occluded",e[e.Antialiasing=14]="Antialiasing",e[e.Highlights=15]="Highlights",e[e.HudOccluded=16]="HudOccluded",e[e.HudNotoccluded=17]="HudNotoccluded"})(Gn||(Gn={}));const AEt=["prepare","shadowmap","lineardepth","normals","ssao","opaque","opaque edges","transparent","transparent edges","hudvisibility","transparent terrain","atmosphere","laserline","occluded","antialiasing","highlights","hudOccluded","hudNotoccluded"];class REt extends Rv{constructor(){super("total"),this.total=0,this.frameCount=0}}class OEt{constructor(){this._startTime=0,this._lastSample=0,this._enableGPUTimer=0,this.totalTime=new REt,this.gpuTime=new Rv("gpu",9),this.renderPassTimings=AEt.map(t=>new Rv(t))}get elapsedTime(){return performance.now()-this._startTime}enableGPUTimer(){return++this._enableGPUTimer,{remove:Tte(()=>--this._enableGPUTimer)}}prerender(t){this._startTime=this._lastSample=performance.now(),this._enableGPUTimer&&(this._gpuTimer=SEt(t))}advance(t){const r=performance.now();this.renderPassTimings[t].record(r-this._lastSample),this._lastSample=r}postrender(){_(this._gpuTimer)&&(this._gpuTimer.stop(r=>_(r)&&this.gpuTime.record(r),16),this._gpuTimer=null);const t=performance.now()-this._startTime;this.totalTime.record(t),this.totalTime.total+=t,this.totalTime.frameCount++}}const $be=.9;let Sg=class extends xe{constructor(e,t,r,i,n,s,a,o,l){super({}),this._materialRepository=e,this._shaderTechniqueRepository=r,this._rctx=i,this._compositingHelper=n,this._magnifierHelper=s,this._requestRender=a,this._stage=l,this._materialRenderers=new Map,this._needsTransparentPass=!1,this._hasHUDElements=!1,this._hasHighlights=!1,this._hasWater=!1,this._hasOverlayWater=!1,this._content=new Map,this._isRendering=!1,this._fallbackDepthStencilTexture=null,this.performanceInfo=new OEt,this._antialiasing=A3.SMAA,this._oitEnabled=!1,this._multipassTerrain=!0,this._transparentTerrain=!1,this._hasAnimations=!1,this._animationTimestep=0,this._handles=new Ft,this._renderHiddenTransparentEdges=()=>{},this._oitUsed=!1,this._smaaPass=new gC(this._rctx,r),this._oitEnabled=this._hasOITSupport,this._requestRender(),this._offscreenRendering=new _8t(this._rctx,this._compositingHelper),this._sliceHelper=new G8t,this._shadowMap=new bae(this._rctx,l.viewingMode,2),this._ssaoHelper=new ARe(r,this._rctx,()=>this._requestRender()),this._highlight=new g8t(r,this._rctx),this._shadowHighlight=new B8t(this._rctx,l.viewingMode),this._shadowAccumulator=new xo(this._rctx,r,l,c=>{const u=this.shadowsEnabled;this._shadowMap.enabled=!0,this._ensureCameraBindParameters(c.camera,c.contentCamera),this._renderPlugins.prepareRender(),this._shadowMap.enabled=u},(c,u,h)=>{c.shadowMap.start(c.camera,u,h),this._renderShadowCascades(je.MATERIAL_DEPTH_SHADOWMAP_ALL,c.shadowMap),c.camera.setGLViewport(this._rctx),this._ensureCameraBindParameters(c.camera,c.contentCamera)},()=>this._requestRender()),this._renderContext=new ebt(this._rctx,this._offscreenRendering,this._shadowMap,this._ssaoHelper,this._sliceHelper),this._renderPlugins=new T8t({renderContext:this._renderContext,shaderTechniqueRepository:r,textureRep:t,materialRep:this._materialRepository,requestRender:this._requestRender,schedule:o}),this.renderPassManager=new s8t(this._rctx,this._shaderTechniqueRepository),this._renderPlugins.add(this.renderPassManager.slots(),this.renderPassManager),this._handles.add([re(()=>this._stage.state.camera,()=>this._requestRender(),Yn),re(()=>Yr.EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES,c=>{this._renderHiddenTransparentEdges=c?()=>this._renderEdges(Nt.TRANSPARENT):()=>{},this._requestRender()},Ot)])}get _bindParameters(){return this._renderContext.bindParameters}get hasWater(){return this._hasWater||this._hasOverlayWater}get hasWaterReflection(){return this.hasWater&&this._waterReflectionEnabled}normalizeCtorArgs(){return{}}dispose(){this._handles.destroy(),this._smaaPass.dispose(),this._materialRenderers.forEach(e=>e.dispose()),this._materialRenderers.clear(),this._edgeView=ct(this._edgeView),this._offscreenRendering.dispose(),this._fallbackDepthStencilTexture=Qe(this._fallbackDepthStencilTexture),this._shadowMap.enabled=!1,this._shadowMap.dispose(),this._ssaoHelper.enabled=!1,this._ssaoHelper.dispose(),this._highlight.dispose(),this._shadowHighlight.dispose(),this._shadowAccumulator.dispose(),Nz.prune(),this._content.clear()}disposeOffscreenBuffers(){this._offscreenRendering.dispose(),this._shadowMap.dispose(),this._smaaPass.disable(),this._ssaoHelper.disposeOffscreenBuffers()}get updating(){return this._antialiasing===A3.SMAA&&this._smaaPass.updating||_(this._edgeView)&&this._edgeView.updating||this._shadowAccumulator.running||!this.isCameraFinal}ensureEdgeView(){return R(this._edgeView)&&(this._edgeView=new zf({rctx:this._rctx,renderSR:this._stage.renderSR,viewingMode:this._stage.viewingMode,techniqueRepository:this._shaderTechniqueRepository,setNeedsRender:()=>this._requestRender(),schedule:e=>this._stage.resourceController.schedule(e)}),this._handles.add(re(()=>ys(this._edgeView,e=>e.updating),()=>this._requestRender(),ti)),this._requestRender()),this._edgeView}get edgeView(){return this._edgeView}get isCameraFinal(){return RTe(this._bindParameters.ssr.reprojectionMatrix,Es)}set _reprojectionMatrix(e){vte(this._bindParameters.ssr.reprojectionMatrix,e)&&this.notifyChange("isCameraFinal")}get shadowsEnabled(){var e;return!!((e=this._shadowMap)!=null&&e.enabled)}setRenderParameters(e){const{_shadowMap:t,_ssaoHelper:r,_bindParameters:i}=this;if(e.screenSpaceReflectionsEnabled!==void 0&&i.ssr.enabled!==e.screenSpaceReflectionsEnabled&&(i.ssr.enabled=e.screenSpaceReflectionsEnabled,this._requestRender()),e.shadowMap!==void 0&&t.enabled!==e.shadowMap&&(t.enabled=e.shadowMap,this._requestRender()),e.shadowMapMaxCascades!==void 0&&t.maxCascades!==e.shadowMapMaxCascades&&(t.maxCascades=e.shadowMapMaxCascades,this._requestRender()),_(e.environment)){_(e.environment.weather)&&(this._bindParameters.weather=e.environment.weather,this._bindParameters.weatherVisible=e.weatherVisible,this._renderContext.bindParameters.weather=e.environment.weather,this._renderContext.bindParameters.weatherVisible=e.weatherVisible),e.environment.lighting.ambientOcclusionEnabled!==void 0&&r.enabled!==e.environment.lighting.ambientOcclusionEnabled&&(r.enabled=e.environment.lighting.ambientOcclusionEnabled,this._requestRender()),e.environment.lighting.waterReflectionEnabled!==void 0&&this._waterReflectionEnabled!==e.environment.lighting.waterReflectionEnabled&&(this._waterReflectionEnabled=e.environment.lighting.waterReflectionEnabled,this._requestRender());const s=e.environment.lighting.type==="sun";i.enableFillLights!==s&&(i.enableFillLights=s,this._requestRender())}e.background&&this._offscreenRendering.background!==e.background&&(this._offscreenRendering.background=e.background,this._requestRender());const n=e.antialiasingEnabled?A3.SMAA:A3.NONE;e.antialiasingEnabled!==void 0&&this._antialiasing!==n&&(this._antialiasing=n,this._requestRender()),e.highQualityTransparency!==void 0&&this._multipassTerrain!==e.highQualityTransparency&&(this._multipassTerrain=e.highQualityTransparency,this._oitEnabled=e.highQualityTransparency&&this._hasOITSupport,this._requestRender()),e.defaultHighlightOptions!==void 0&&(this._highlight.setDefaultOptions(e.defaultHighlightOptions),this._shadowHighlight.setDefaultOptions(e.defaultHighlightOptions),this._requestRender()),e.overlays!==void 0&&this._bindParameters.overlays!==e.overlays&&(this._bindParameters.overlays=e.overlays,this._requestRender()),e.slicePlane!==void 0&&this._sliceHelper.plane!==e.slicePlane&&(this._sliceHelper.plane=e.slicePlane,this._requestRender()),e.transparentTerrain!==void 0&&this._transparentTerrain!==e.transparentTerrain&&(this._transparentTerrain=e.transparentTerrain,this._requestRender()),e.hasOverlayWater!==void 0&&this._hasOverlayWater!==e.hasOverlayWater&&(this._hasOverlayWater=e.hasOverlayWater,this._requestRender()),e.shadowCastOptions!==void 0&&this._shadowAccumulator.setOptions(e.shadowCastOptions)}get hasSlicePlane(){return!!this._sliceHelper.plane}get renderPlugins(){return this._renderPlugins}get _hasOITSupport(){return this._rctx.driverTest.floatBufferBlendWorking}modify(e){this._isRendering&&console.warn("Renderer.modify called while rendering");const{adds:t,removes:r,updates:i}=e;if(t.length===0&&r.length===0&&i.length===0)return;r.forAll(({id:a})=>this._content.delete(a)),t.forAll(a=>this._content.set(a.id,a));const n=hRe(e);let s=!1;n.forEach((a,o)=>{let l=this._materialRenderers.get(o);if(!l){if(!(a.adds.length>0))return;l=new SRe(this._rctx,this._materialRepository,o),this._materialRenderers.set(o,l)}l.modify(a),l.isEmpty&&(s=!0)}),s&&this._materialRenderers.forEach((a,o)=>{a.isEmpty&&(this._materialRenderers.delete(o),a.dispose())}),this._hasHighlights=vs(this._materialRenderers,a=>a.hasHighlights),this._bindParameters.hasOccludees=vs(this._materialRenderers,a=>a.hasOccludees),this._hasWater=vs(this._materialRenderers,a=>a.hasWater),this._needsTransparentPass=vs(this._materialRenderers,a=>a.requiresSlot(Ee.TRANSPARENT_MATERIAL,je.MATERIAL)),this._hasHUDElements=vs(this._materialRenderers,a=>a.requiresSlot(Ee.LINE_CALLOUTS_HUD_DEPTH,je.MATERIAL)||a.requiresSlot(Ee.HUD_MATERIAL,je.MATERIAL)||a.requiresSlot(Ee.LABEL_MATERIAL,je.MATERIAL)),this._requestRender()}updateAnimation(e){return this._hasAnimations=!1,this._materialRenderers.forEach(t=>this._hasAnimations=t.updateAnimation(e)||this._hasAnimations),this._hasAnimations=this._renderPlugins.updateAnimation(e)||this._hasAnimations,this._hasAnimations}get animationTimestep(){return this._animationTimestep}updateLightSources(e,t,r){this._bindParameters.lighting.groundLightingFactor=t,this._bindParameters.lighting.globalFactor=r,this._bindParameters.lighting.set(e)}render(e,t,r,i){this._isRendering=!0,this.performanceInfo.prerender(this._rctx),this._bindParameters.transparencyPassType=yt.NONE;const n=this._offscreenRendering;n.needLastFrameColorTexture=this.hasWaterReflection,n.advanceCurrentRenderTarget();const s=b_(this._sliceHelper.plane);i===Hw.OFF&&(this._sliceHelper.plane=null),this._rctx.bindFramebuffer(e),t.setGLViewport(this._rctx),this._ensureCameraBindParameters(t,r),this._renderPlugins.prepareRender(),this.performanceInfo.advance(Gn.Prepare);const a=this._computeDepthRange(t);this._renderShadowMap(e,t,this._bindParameters.lighting.lightingMainDirection,a),this.performanceInfo.advance(Gn.Shadowmap),n.initializeFrame(t),this._ensureBindParameters(t,r),this._renderLinearDepth(),this.performanceInfo.advance(Gn.Lineardepth),this._accumulateShadows(a,t,r),this._renderNormal(),this.performanceInfo.advance(Gn.Normals),this._ensureBindParametersSSR(),this._ssaoHelper.computeSSAO(this._bindParameters,n.linearDepthTexture,n.normalTexture),this.performanceInfo.advance(Gn.SSAO),this._renderContext.pass=je.MATERIAL,n.bindFramebuffer(),this._renderOpaqueGeometry(),this.performanceInfo.advance(Gn.Opaque);const o=this._multipassTerrain&&this._transparentTerrain;this._renderTerrainLinearDepth(o),this._setMultipassEnabled(o),this._setTerrainCulling(o),this._renderEdges(Nt.OPAQUE),this.performanceInfo.advance(Gn.OpaqueEdges),this._offscreenRendering.bindTarget(this._offscreenRendering.currentColorTarget,this._offscreenRendering.mainDepth),this._renderSlot(Ee.VOXEL),this._renderHiddenTransparentEdges();const l=this._needsTransparentPass||this._renderPlugins.needsTransparentPass;l&&(this._oitEnabled?this._renderOrderIndependentTransparency(()=>this._renderTransparentGeometry(),!1):this._renderTransparentGeometry()),this.performanceInfo.advance(Gn.Transparent),this._renderGeometryLinearDepth(o);const c=this._renderHUDVisibility();o||this._renderInternalSlot(Ee.LINE_CALLOUTS),this.performanceInfo.advance(Gn.Hudvisibility),this._renderEdges(Nt.TRANSPARENT,o),this.performanceInfo.advance(Gn.TransparentEdges),this._renderTransparentTerrain(),this._transparentTerrain&&c&&(o?this._renderLineCallouts(bh.Occluded):n.compositeTransparentTerrainOntoHUDVisibility(this._bindParameters),this._renderHUD(bh.Occluded,n.framebuffer),this.performanceInfo.advance(Gn.HudOccluded)),this.performanceInfo.advance(Gn.TransparentTerrain),this._setTerrainCulling(!1),this._transparentTerrain&&(n.compositeTransparentTerrainOntoMain(this._bindParameters),o&&(this._renderEdges(Nt.OPAQUE),this.performanceInfo.advance(Gn.OpaqueEdges),l&&(this._oitEnabled?this._renderOrderIndependentTransparency(()=>this._renderTransparentGeometry(),!1):this._renderTransparentGeometry()),this.performanceInfo.advance(Gn.Transparent),this._renderEdges(Nt.TRANSPARENT),this.performanceInfo.advance(Gn.TransparentEdges))),o&&this._renderLineCallouts(bh.NotOccluded),this._setMultipassEnabled(!1),this._shadowAccumulator.render(this._bindParameters),n.renderToTargets(()=>{this._renderInternalSlot(Ee.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL),this._renderSlot(Ee.POSTPROCESSING_ENVIRONMENT_TRANSPARENT),this._renderSlot(Ee.LASERLINES)},n.currentColorTarget,n.mainDepth),this.performanceInfo.advance(Gn.Atmosphere),this._renderPlugins.needsLaserlineWithContrastControl&&n.renderTmpAndCompositeToMain(()=>this._renderSlot(Ee.LASERLINES_CONTRAST_CONTROL),this._bindParameters,to.PremultipliedAlpha),this.performanceInfo.advance(Gn.Laserline),this._renderOccluded(),this.performanceInfo.advance(Gn.Occluded);const u=i===Hw.ON&&this._magnifierHelper.enabled,h=u&&R(e)?this._offscreenRendering.getFramebuffer(this._offscreenRendering.tmpColor,this._offscreenRendering.tmpDepth):e;this._rctx.bindFramebuffer(h);const p=this._offscreenRendering.colorTexture;!this._renderAntiAliasing(this._antialiasing,p)&&_(p)&&this._compositingHelper.composite(this._bindParameters,p,to.None),this.performanceInfo.advance(Gn.Antialiasing),this._renderHUD(bh.NotOccluded,h),this.performanceInfo.advance(Gn.HudNotoccluded),this._renderHighlights(h,this._bindParameters),this.performanceInfo.advance(Gn.Highlights),u&&this._magnifierHelper.render(this._rctx,this._bindParameters),h!==e&&(this._rctx.bindFramebuffer(e),this._compositingHelper.composite(this._bindParameters,this._offscreenRendering.tmpColorTexture,to.None)),this._disposeOITBuffers(),this._renderContext.lastFrameCamera.copyFrom(this._bindParameters.camera),this._sliceHelper.plane=s,this._isRendering=!1,this.onPostRender&&this.onPostRender(),this.performanceInfo.postrender()}finish(e){if(this._hasAnimations||(this._animationTimestep=0),e===Xn.BACKGROUND){this._rctx.gl.getError();const t=this.performanceInfo.elapsedTime/i8t;this._animationTimestep=Math.max(this._animationTimestep*$be+t*(1-$be),n8t)}}readDepthPixels(e,t,r){const i=this._offscreenRendering.bindTarget(this._offscreenRendering.linearDepth,this._offscreenRendering.tmpDepth);if(!this._needsLinearDepth){this._ensureBindParameters(e,e),this._bindParameters.camera.setGLViewport(this._rctx),this._rctx.setClearColor(0,0,0,0);const n=ii.COLOR_BUFFER_BIT|ii.DEPTH_BUFFER_BIT|ii.STENCIL_BUFFER_BIT;this._rctx.clearSafe(n),this._renderGeometryAndTransparentTerrainPass(je.MATERIAL_DEPTH)}i.readPixels(t[0],t[1],t[2],t[3],Ue.RGBA,At.UNSIGNED_BYTE,r)}readHUDVisibility(e,t,r,i,n){this._offscreenRendering.bindTarget(this._offscreenRendering.hudVisibility).readPixels(e,t,r,i,Ue.RGBA,At.UNSIGNED_BYTE,n)}readAccumulatedShadow(e,t){return this._shadowAccumulator.readAccumulatedShadow(e,t)}_setMultipassEnabled(e){this._bindParameters.multipassTerrain.enabled=this._bindParameters.multipassGeometry.enabled=e}_setTerrainCulling(e){this._bindParameters.multipassTerrain.cullAboveGround=e}_renderSlot(e){this._bindParameters.slot=e,this._renderPlugins.render()}_renderEdges(e,t=!1){const r=this._edgeView;_(r)&&r.shouldRender()&&this._offscreenRendering.renderTmpAndCompositeToMain(()=>r.render(this._bindParameters,e),this._bindParameters,to.Alpha,t)}_renderShadowMap(e,t,r,i){const n=this._shadowMap;n.enabled&&(n.start(t,r,i),this._shadowHighlight.updateParameters(t,r),this.needsShadowHighlight?(this._renderShadowCascades(je.MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT,this._shadowMap,s=>n.takeCascadeSnapshotTo(s,L9.Highlight)),n.clear(),this._renderShadowCascades(je.MATERIAL_DEPTH_SHADOWMAP_DEFAULT,this._shadowMap,s=>{n.takeCascadeSnapshotTo(s,L9.Default),this._renderGeometryAndTransparentTerrainPass(je.MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT)})):this._renderShadowCascades(je.MATERIAL_DEPTH_SHADOWMAP_ALL),n.finish(e),t.setGLViewport(this._rctx))}_renderShadowCascades(e,t=this._shadowMap,r=i=>{}){for(const i of t.getCascades())i.camera.setGLViewport(this._rctx),this._ensureCameraBindParameters(i.camera,i.camera),this._renderGeometryAndTransparentTerrainPass(e),r(i)}get _needsLinearDepth(){return this._ssaoHelper.enabled||this._renderPlugins.needsLinearDepth||this._hasWater&&this._waterReflectionEnabled||this.needsShadowHighlight||this.needsShadowCast}_renderLinearDepth(){this._needsLinearDepth?this._offscreenRendering.renderToTargets(()=>this._renderGeometryAndTransparentTerrainPass(je.MATERIAL_DEPTH),this._offscreenRendering.linearDepth,this._offscreenRendering.tmpDepth,[0,0,0,0],!0,!0):this._offscreenRendering.disposeTarget(this._offscreenRendering.linearDepth),this._bindParameters.linearDepthTexture=this._offscreenRendering.linearDepthTexture}_renderTerrainLinearDepth(e){if(e){const t=this._renderContext.pass;this._renderContext.pass=je.MATERIAL_DEPTH,this._offscreenRendering.renderToTargets(()=>this._renderTransparentTerrain(),this._offscreenRendering.terrainLinearDepth,this._offscreenRendering.tmpDepth,[-1e10,-1e10,-1e10,1],!0,!0),this._renderContext.pass=t}else this._offscreenRendering.disposeTarget(this._offscreenRendering.terrainLinearDepth);this._bindParameters.multipassTerrain.linearDepthTexture=this._offscreenRendering.terrainLinearDepthTexture}_renderGeometryLinearDepth(e){if(e){const t=this._renderContext.pass;this._offscreenRendering.renderToTargets(()=>this._renderGeometryPass(je.MATERIAL_DEPTH),this._offscreenRendering.geometryLinearDepth,this._offscreenRendering.tmpDepth,[1,1,1,1],!0,!0),this._renderContext.pass=t}else this._offscreenRendering.disposeTarget(this._offscreenRendering.geometryLinearDepth);this._bindParameters.multipassGeometry.linearDepthTexture=this._offscreenRendering.geometryLinearDepthTexture}get needsNormal(){return this._ssaoHelper.enabled}_renderNormal(){this.needsNormal?this._offscreenRendering.renderToTargets(()=>{this._renderGeometryAndTransparentTerrainPass(je.MATERIAL_NORMAL)},this._offscreenRendering.normal,this._offscreenRendering.tmpDepth,[0,0,0,0],!0,!0):this._offscreenRendering.disposeTarget(this._offscreenRendering.normal)}get needsDepthRange(){return this._shadowMap.enabled||this.needsShadowCast}_computeDepthRange(e){if(!this.needsDepthRange)return FK;const t=q6t(e,this._content,this._stage.layers);return z9(t,this.renderPlugins.queryDepthRange(e)),t.near=Math.max(e.near,t.near),t.far=Math.min(e.far,t.far),t}_renderGeometryAndTransparentTerrainPass(e){this._renderContext.pass=e,this._renderGeometryPass(e),this._renderTransparentTerrain()}_renderGeometryPass(e){this._renderContext.pass=e,this._renderOpaqueGeometry(),this._renderTransparentGeometry()}_renderOpaqueGeometry(){this._renderSlot(Ee.INTEGRATED_MESH),this._renderSlot(Ee.OPAQUE_TERRAIN),this._renderInternalSlot(Ee.OPAQUE_MATERIAL),this._renderSlot(Ee.OPAQUE_MATERIAL),this._renderSlot(Ee.POSTPROCESSING_ENVIRONMENT_OPAQUE)}_renderTransparentGeometry(){this._renderInternalSlot(Ee.TRANSPARENT_MATERIAL),this._renderSlot(Ee.TRANSPARENT_MATERIAL)}_renderTransparentTerrain(){this._renderSlot(Ee.TRANSPARENT_TERRAIN)}_renderHUDVisibility(){let e=!1;return this._renderContext.offscreenRenderingHelper&&this._renderContext.offscreenRenderingHelper.renderHUDVisibility(()=>{this._bindParameters.hudVisibilityTexture=this._renderContext.offscreenRenderingHelper.hudVisibilityTexture,e=this._renderInternalSlot(Ee.OCCLUSION_PIXELS)},this._multipassTerrain&&this._transparentTerrain),e}_renderLineCallouts(e){this._bindParameters.renderTransparentlyOccludedHUD=e,e===bh.Occluded?this._offscreenRendering.renderToTargets(()=>this._renderInternalSlot(Ee.LINE_CALLOUTS),this._offscreenRendering.currentColorTarget,this._offscreenRendering.tmpDepth,void 0,!0,!0):this._renderInternalSlot(Ee.LINE_CALLOUTS)}_renderHUD(e,t){this._hasHUDElements&&(this._oitEnabled?(this._renderOrderIndependentTransparency(()=>this._renderHUDElements(e),!0),this._rctx.bindFramebuffer(t),this._compositingHelper.composite(this._bindParameters,this._offscreenRendering.hudColorTexture,to.PremultipliedAlpha)):e===bh.Occluded?this._offscreenRendering.renderToTargets(()=>this._renderHUDElements(bh.Occluded),this._offscreenRendering.currentColorTarget,this._offscreenRendering.tmpDepth,void 0,!0,!0):this._renderHUDElements(e))}_renderHUDElements(e){this._bindParameters.renderTransparentlyOccludedHUD=e,this._renderInternalSlot(Ee.LINE_CALLOUTS_HUD_DEPTH),this._renderInternalSlot(Ee.HUD_MATERIAL),this._renderInternalSlot(Ee.LABEL_MATERIAL)}get needsHighlight(){return this._hasHighlights||this._renderPlugins.needsHighlight}get needsShadowHighlight(){return this._shadowMap.enabled&&this._shadowHighlight.isVisible&&this.needsHighlight}_renderHighlights(e,t){if(!this.needsHighlight)return void this._offscreenRendering.disposeTarget(this._offscreenRendering.highlight);const r=this._highlight,i=this._offscreenRendering.renderToTargets(()=>{this._renderGeometryAndTransparentTerrainPass(je.MATERIAL_HIGHLIGHT),this._rctx.clearSafe(ii.DEPTH_BUFFER_BIT),this._renderHUDElements(bh.Both)},this._offscreenRendering.highlight,this._offscreenRendering.tmpDepth,[0,0,0,0],!0,!0);this._bindParameters.highlightColorTexture=i.colorTexture,this.needsShadowHighlight&&this._shadowHighlight.render(t,e),r.render(this._bindParameters,i,e)}get needsShadowCast(){return this._shadowAccumulator.isAccumulating}_accumulateShadows(e,t,r){this.needsShadowCast&&this._shadowAccumulator.renderAccumulation(this._offscreenRendering.linearDepthTexture,e,t,r)}_renderOrderIndependentTransparency(e,t){const r=n=>{this._bindParameters.transparencyPassType=n,this._offscreenRendering.renderOITPass(()=>e(),n,t)},i=this._renderContext.pass;this._renderContext.pass=je.MATERIAL_ALPHA,r(yt.Alpha),this._renderContext.pass=je.MATERIAL,r(yt.Color),r(yt.FrontFace),this._offscreenRendering.compositeTransparentOntoOpaque(this._bindParameters,t),this._bindParameters.transparencyPassType=yt.NONE,this._renderContext.pass=i,this._oitUsed=!0}_disposeOITBuffers(){this._oitUsed||(this._offscreenRendering.disposeTarget(this._offscreenRendering.alphaFloatTarget),this._offscreenRendering.disposeTarget(this._offscreenRendering.colorFloatTarget),this._offscreenRendering.disposeTarget(this._offscreenRendering.frontFaceTarget)),this._oitUsed=!1}_renderOccluded(){let e=0;this._materialRenderers.forEach((s,a)=>{a&&a.isVisible()&&a.renderOccluded===ki.OccludeAndTransparentStencil&&(e|=a.renderOccluded,q8.push(a))});const t=this._offscreenRendering,r=(s,a,o,l,c)=>{(e&a)!=0&&(t.renderToTargets(o,t.tmpColor,t.mainDepth,[0,0,0,0],l,c),t.compositeOccludedOntoMain(this._bindParameters,s))};q8.length!==0&&(this._renderInternalSlot(Ee.OCCLUDER_MATERIAL,q8),r(.5,ki.OccludeAndTransparentStencil,()=>this._renderInternalSlot(Ee.TRANSPARENT_OCCLUDER_MATERIAL,q8),!1,!1),q8.length=0),this._materialRenderers.forEach((s,a)=>{a&&a.isVisible()&&(a.renderOccluded===ki.OccludeAndTransparent||a.renderOccluded===ki.Transparent||a.renderOccluded===ki.Opaque)&&(e|=a.renderOccluded,j8.push(a))});const i=this._renderPlugins.renderOccludedFlags;if(e|=i,!e)return;const n=s=>{this._renderContext.renderOccludedMask=s,i>ki.Occlude&&this._renderSlot(Ee.OCCLUDED_TERRAIN),this._renderInternalSlot(Ee.OPAQUE_MATERIAL,j8),this._renderInternalSlot(Ee.TRANSPARENT_MATERIAL,j8),this._renderInternalSlot(Ee.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL,j8),this._renderContext.resetRenderOccludedMask()};this._renderContext.pass=je.MATERIAL,r(.5,ki.OccludeAndTransparent,()=>n(ki.OccludeAndTransparent),!0,oc.OutlineVisualElementMask),r(.5,ki.Transparent,()=>n(ki.Transparent),!0,oc.OutlineVisualElementMask),r(1,ki.Opaque,()=>n(ki.Opaque),!0,oc.OutlineVisualElementMask),j8.length=0}_renderAntiAliasing(e,t){if(e===A3.SMAA){if(this._smaaPass.enable(()=>this._requestRender())&&_(t))return this._smaaPass.render(t),!0}else this._smaaPass.disable();return!1}_ensureCameraBindParameters(e,t){this._bindParameters.camera=e,this._bindParameters.contentCamera=t}_ensureBindParameters(e,t){var i;this._ensureCameraBindParameters(e,t);const r=this._renderContext.offscreenRenderingHelper;this._bindParameters.hudVisibilityTexture=r.hudVisibilityTexture,this._bindParameters.highlightDepthTexture=(i=r.depthTexture)!=null?i:this._getFallbackDepthTexture()}_ensureBindParametersSSR(){this.hasWaterReflection?(this._renderContext.lastFrameCamera.equals(this._bindParameters.camera)?this._reprojectionMatrix=Es:(Rn(Dbe,this._bindParameters.camera.viewMatrix),Rn(Lbe,this._bindParameters.camera.projectionMatrix),Zi(NT,Dbe,Lbe),Zi(NT,this._renderContext.lastFrameCamera.viewMatrix,NT),Zi(NT,this._renderContext.lastFrameCamera.projectionMatrix,NT),this._reprojectionMatrix=NT),this._bindParameters.ssr.lastFrameColorTexture=this._offscreenRendering.lastFrameColorTexture):this._bindParameters.ssr.lastFrameColorTexture=null,this._bindParameters.ssr.enabled=this.hasWaterReflection}_renderInternalSlot(e,t){let r=!1;return this._bindParameters.slot=e,_(t)?t.forEach(i=>{if(!i.shouldRender(this._renderContext))return;const n=this._materialRenderers.get(i);_(n)&&(r=n.render(this._renderContext.pass,this._bindParameters)||r)}):this._materialRenderers.forEach((i,n)=>{n.shouldRender(this._renderContext)&&i.render(this._renderContext.pass,this._bindParameters)&&(r=!0)}),r}_getFallbackDepthTexture(){return this._fallbackDepthStencilTexture||(this._fallbackDepthStencilTexture=UEe(this._rctx)),this._fallbackDepthStencilTexture}get gpuMemoryUsage(){var e,t,r,i,n,s,a,o,l,c;return{offscreen:(t=(e=this._offscreenRendering)==null?void 0:e.gpuMemoryUsage)!=null?t:0,highlights:((i=(r=this._highlight)==null?void 0:r.gpuMemoryUsage)!=null?i:0)+((s=(n=this._shadowHighlight)==null?void 0:n.gpuMemoryUsage)!=null?s:0),shadows:(o=(a=this._shadowMap)==null?void 0:a.gpuMemoryUsage)!=null?o:0,ssao:(c=(l=this._ssaoHelper)==null?void 0:l.gpuMemoryUsage)!=null?c:0}}get test(){const e=this;return{offscreen:this._offscreenRendering,shadowMap:this._shadowMap,ssao:this._ssaoHelper,highlight:this._highlight,lighting:this._bindParameters.lighting,materialRenderers:this._materialRenderers,shadowAccumulator:this._shadowAccumulator,getFramebufferTexture:t=>{switch(t){case B1.Color:return e._offscreenRendering.colorTexture;case B1.LinearDepth:return e._offscreenRendering.linearDepthTexture;case B1.Normals:return e._offscreenRendering.normalTexture;case B1.ShadowMap:return e._shadowMap.depthTexture;case B1.HudVisibility:return e._offscreenRendering.hudVisibilityTexture;case B1.Highlight:return e._offscreenRendering.highlightTexture}}}}};var B1;d([f()],Sg.prototype,"_shadowAccumulator",void 0),d([f()],Sg.prototype,"_smaaPass",void 0),d([f()],Sg.prototype,"_antialiasing",void 0),d([f()],Sg.prototype,"_edgeView",void 0),d([f()],Sg.prototype,"updating",null),d([f()],Sg.prototype,"isCameraFinal",null),Sg=d([$("esri.views.3d.webgl-engine.lib.Renderer")],Sg),function(e){e[e.Color=0]="Color",e[e.LinearDepth=1]="LinearDepth",e[e.Normals=2]="Normals",e[e.ShadowMap=3]="ShadowMap",e[e.HudVisibility=4]="HudVisibility",e[e.Highlight=5]="Highlight"}(B1||(B1={}));const j8=[],q8=[],Lbe=Ae(),Dbe=Ae(),NT=Ae();class Fbe{constructor(){this.blend=!1,this.blendColor={r:0,g:0,b:0,a:0},this.blendFunction={srcRGB:Re.ONE,dstRGB:Re.ZERO,srcAlpha:Re.ONE,dstAlpha:Re.ZERO},this.blendEquation={mode:Dy.ADD,modeAlpha:Dy.ADD},this.colorMask={r:!0,g:!0,b:!0,a:!0},this.faceCulling=!1,this.cullFace=bp.BACK,this.frontFace=f9.CCW,this.scissorTest=!1,this.scissorRect={x:0,y:0,width:0,height:0},this.depthTest=!1,this.depthFunction=vi.LESS,this.clearDepth=1,this.depthWrite=!0,this.depthRange={zNear:0,zFar:1},this.viewport=null,this.stencilTest=!1,this.polygonOffsetFill=!1,this.polygonOffset=[0,0],this.stencilFunction={face:bp.FRONT_AND_BACK,func:vi.ALWAYS,ref:0,mask:1},this.clearStencil=0,this.stencilWriteMask=1,this.stencilOperation={face:bp.FRONT_AND_BACK,fail:fn.KEEP,zFail:fn.KEEP,zPass:fn.KEEP},this.clearColor={r:0,g:0,b:0,a:0},this.program=null,this.vertexBuffer=null,this.indexBuffer=null,this.uniformBuffer=null,this.pixelPackBuffer=null,this.pixelUnpackBuffer=null,this.copyReadBuffer=null,this.copyWriteBuffer=null,this.uniformBufferBindingPoints=new Array,this.readFramebuffer=null,this.drawFramebuffer=null,this.renderbuffer=null,this.activeTexture=0,this.textureUnitMap=new Array}}class MEt{constructor(t){this._allocations=new Map,t?Error.stackTraceLimit=1/0:(this.add=()=>{},this.remove=()=>{})}add(t){this._allocations.set(t,new Error().stack)}remove(t){this._allocations.delete(t)}print(){if(this._allocations.size>0){console.log(`${this._allocations.size} live object allocations:`);const t=new Map;this._allocations.forEach(r=>{var i;t.set(r,((i=t.get(r))!=null?i:0)+1)}),t.forEach((r,i)=>{const n=i.split(`
`);n.shift(),n.shift(),console.log(`${r}: ${n.shift()}`),n.forEach(s=>console.log("   ",s))})}}}const PEt={RECORD_ALLOCATIONS:!1};class IEt{constructor(){for(this._current=new Array,this._max=new Array,this._allocations=new MEt(PEt.RECORD_ALLOCATIONS);this._current.length<ks.COUNT;)this._current.push(0),this._max.push(0)}resetMax(){for(this._max.length=0;this._max.length<this._current.length;)this._max.push(0)}increment(t,r){const i=++this._current[t];this._max[t]=Math.max(i,this._max[t]),this._allocations.add(r)}decrement(t,r){--this._current[t],this._allocations.remove(r)}get max(){return this._max}get current(){return this._current}get total(){return this.current.reduce((t,r)=>t+r,0)}printResourceCount(){if(this.total>0){console.log("Live objects:");for(let t=0;t<ks.COUNT;++t){const r=this._current[t];r>0&&console.log(`${ks[t]}: ${r}`)}}this._allocations.print()}}const $Et=["layout","centroid","smooth","case","mat2x2","mat2x3","mat2x4","mat3x2","mat3x3","mat3x4","mat4x2","mat4x3","mat4x4","uint","uvec2","uvec3","uvec4","samplerCubeShadow","sampler2DArray","sampler2DArrayShadow","isampler2D","isampler3D","isamplerCube","isampler2DArray","usampler2D","usampler3D","usamplerCube","usampler2DArray","coherent","restrict","readonly","writeonly","resource","atomic_uint","noperspective","patch","sample","subroutine","common","partition","active","filter","image1D","image2D","image3D","imageCube","iimage1D","iimage2D","iimage3D","iimageCube","uimage1D","uimage2D","uimage3D","uimageCube","image1DArray","image2DArray","iimage1DArray","iimage2DArray","uimage1DArray","uimage2DArray","image1DShadow","image2DShadow","image1DArrayShadow","image2DArrayShadow","imageBuffer","iimageBuffer","uimageBuffer","sampler1DArray","sampler1DArrayShadow","isampler1D","isampler1DArray","usampler1D","usampler1DArray","isampler2DRect","usampler2DRect","samplerBuffer","isamplerBuffer","usamplerBuffer","sampler2DMS","isampler2DMS","usampler2DMS","sampler2DMSArray","isampler2DMSArray","usampler2DMSArray","trunc","round","roundEven","isnan","isinf","floatBitsToInt","floatBitsToUint","intBitsToFloat","uintBitsToFloat","packSnorm2x16","unpackSnorm2x16","packUnorm2x16","unpackUnorm2x16","packHalf2x16","unpackHalf2x16","outerProduct","transpose","determinant","inverse","texture","textureSize","textureProj","textureLod","textureOffset","texelFetch","texelFetchOffset","textureProjOffset","textureLodOffset","textureProjLod","textureProjLodOffset","textureGrad","textureGradOffset","textureProjGrad","textureProjGradOffset"];var Nbe,vPe={exports:{}};(Nbe=["precision","highp","mediump","lowp","attribute","const","uniform","varying","break","continue","do","for","while","if","else","in","out","inout","float","int","void","bool","true","false","discard","return","mat2","mat3","mat4","vec2","vec3","vec4","ivec2","ivec3","ivec4","bvec2","bvec3","bvec4","sampler1D","sampler2D","sampler3D","samplerCube","sampler1DShadow","sampler2DShadow","struct","asm","class","union","enum","typedef","template","this","packed","goto","switch","default","inline","noinline","volatile","public","static","extern","external","interface","long","short","double","half","fixed","unsigned","input","output","hvec2","hvec3","hvec4","dvec2","dvec3","dvec4","fvec2","fvec3","fvec4","sampler2DRect","sampler3DRect","sampler2DRectShadow","sizeof","cast","namespace","using"])!==void 0&&(vPe.exports=Nbe);const LEt=vPe.exports;var kbe,_Pe={exports:{}};kbe=_Pe,function(e){var t=["<<=",">>=","++","--","<<",">>","<=",">=","==","!=","&&","||","+=","-=","*=","/=","%=","&=","^^","^=","|=","(",")","[","]",".","!","~","*","/","%","+","-","<",">","&","^","|","?",":","=",",",";","{","}"];t!==void 0&&(kbe.exports=t)}();const Vbe=_Pe.exports;var wPe={exports:{}};(function(e){(function(t){var r=function(){return["abs","acos","all","any","asin","atan","ceil","clamp","cos","cross","dFdx","dFdy","degrees","distance","dot","equal","exp","exp2","faceforward","floor","fract","gl_BackColor","gl_BackLightModelProduct","gl_BackLightProduct","gl_BackMaterial","gl_BackSecondaryColor","gl_ClipPlane","gl_ClipVertex","gl_Color","gl_DepthRange","gl_DepthRangeParameters","gl_EyePlaneQ","gl_EyePlaneR","gl_EyePlaneS","gl_EyePlaneT","gl_Fog","gl_FogCoord","gl_FogFragCoord","gl_FogParameters","gl_FragColor","gl_FragCoord","gl_FragData","gl_FragDepth","gl_FragDepthEXT","gl_FrontColor","gl_FrontFacing","gl_FrontLightModelProduct","gl_FrontLightProduct","gl_FrontMaterial","gl_FrontSecondaryColor","gl_LightModel","gl_LightModelParameters","gl_LightModelProducts","gl_LightProducts","gl_LightSource","gl_LightSourceParameters","gl_MaterialParameters","gl_MaxClipPlanes","gl_MaxCombinedTextureImageUnits","gl_MaxDrawBuffers","gl_MaxFragmentUniformComponents","gl_MaxLights","gl_MaxTextureCoords","gl_MaxTextureImageUnits","gl_MaxTextureUnits","gl_MaxVaryingFloats","gl_MaxVertexAttribs","gl_MaxVertexTextureImageUnits","gl_MaxVertexUniformComponents","gl_ModelViewMatrix","gl_ModelViewMatrixInverse","gl_ModelViewMatrixInverseTranspose","gl_ModelViewMatrixTranspose","gl_ModelViewProjectionMatrix","gl_ModelViewProjectionMatrixInverse","gl_ModelViewProjectionMatrixInverseTranspose","gl_ModelViewProjectionMatrixTranspose","gl_MultiTexCoord0","gl_MultiTexCoord1","gl_MultiTexCoord2","gl_MultiTexCoord3","gl_MultiTexCoord4","gl_MultiTexCoord5","gl_MultiTexCoord6","gl_MultiTexCoord7","gl_Normal","gl_NormalMatrix","gl_NormalScale","gl_ObjectPlaneQ","gl_ObjectPlaneR","gl_ObjectPlaneS","gl_ObjectPlaneT","gl_Point","gl_PointCoord","gl_PointParameters","gl_PointSize","gl_Position","gl_ProjectionMatrix","gl_ProjectionMatrixInverse","gl_ProjectionMatrixInverseTranspose","gl_ProjectionMatrixTranspose","gl_SecondaryColor","gl_TexCoord","gl_TextureEnvColor","gl_TextureMatrix","gl_TextureMatrixInverse","gl_TextureMatrixInverseTranspose","gl_TextureMatrixTranspose","gl_Vertex","greaterThan","greaterThanEqual","inversesqrt","length","lessThan","lessThanEqual","log","log2","matrixCompMult","max","min","mix","mod","normalize","not","notEqual","pow","radians","reflect","refract","sign","sin","smoothstep","sqrt","step","tan","texture2D","texture2DLod","texture2DProj","texture2DProjLod","textureCube","textureCubeLod","texture2DLodEXT","texture2DProjLodEXT","textureCubeLodEXT","texture2DGradEXT","texture2DProjGradEXT","textureCubeGradEXT"]}();r!==void 0&&(e.exports=r)})()})(wPe);const DEt=wPe.exports;var _f=999,zbe=9999,IH=0,$H=1,Ube=2,Bbe=3,Gbe=4,h$=5,FEt=6,NEt=7,kEt=8,jbe=9,VEt=10,qbe=11,zEt=["block-comment","line-comment","preprocessor","operator","integer","float","ident","builtin","keyword","whitespace","eof","integer"];function UEt(){var e,t,r,i=0,n=0,s=_f,a=[],o=[],l=1,c=0,u=0,h=!1,p=!1,m="";return function(B){return o=[],B!==null?b(B.replace?B.replace(/\r\n/g,`
`):B):w()};function g(B){B.length&&o.push({type:zEt[s],data:B,position:u,line:l,column:c})}function b(B){var X;for(i=0,r=(m+=B).length;e=m[i],i<r;){switch(X=i,s){case IH:i=C();break;case $H:i=E();break;case Ube:i=T();break;case Bbe:i=A();break;case Gbe:i=L();break;case qbe:i=I();break;case h$:i=V();break;case zbe:i=G();break;case jbe:i=x();break;case _f:i=v()}X!==i&&(m[X]===`
`?(c=0,++l):++c)}return n+=i,m=m.slice(i),o}function w(B){return a.length&&g(a.join("")),s=VEt,g("(eof)"),o}function v(){return a=a.length?[]:a,t==="/"&&e==="*"?(u=n+i-1,s=IH,t=e,i+1):t==="/"&&e==="/"?(u=n+i-1,s=$H,t=e,i+1):e==="#"?(s=Ube,u=n+i,i):/\s/.test(e)?(s=jbe,u=n+i,i):(h=/\d/.test(e),p=/[^\w_]/.test(e),u=n+i,s=h?Gbe:p?Bbe:zbe,i)}function x(){return/[^\s]/g.test(e)?(g(a.join("")),s=_f,i):(a.push(e),t=e,i+1)}function T(){return e!=="\r"&&e!==`
`||t==="\\"?(a.push(e),t=e,i+1):(g(a.join("")),s=_f,i)}function E(){return T()}function C(){return e==="/"&&t==="*"?(a.push(e),g(a.join("")),s=_f,i+1):(a.push(e),t=e,i+1)}function A(){if(t==="."&&/\d/.test(e))return s=h$,i;if(t==="/"&&e==="*")return s=IH,i;if(t==="/"&&e==="/")return s=$H,i;if(e==="."&&a.length){for(;P(a););return s=h$,i}if(e===";"||e===")"||e==="("){if(a.length)for(;P(a););return g(e),s=_f,i+1}var B=a.length===2&&e!=="=";if(/[\w_\d\s]/.test(e)||B){for(;P(a););return s=_f,i}return a.push(e),t=e,i+1}function P(B){for(var X,Y,ce=0;;){if(X=Vbe.indexOf(B.slice(0,B.length+ce).join("")),Y=Vbe[X],X===-1){if(ce--+B.length>0)continue;Y=B.slice(0,1).join("")}return g(Y),u+=Y.length,(a=a.slice(Y.length)).length}}function I(){return/[^a-fA-F0-9]/.test(e)?(g(a.join("")),s=_f,i):(a.push(e),t=e,i+1)}function L(){return e==="."||/[eE]/.test(e)?(a.push(e),s=h$,t=e,i+1):e==="x"&&a.length===1&&a[0]==="0"?(s=qbe,a.push(e),t=e,i+1):/[^\d]/.test(e)?(g(a.join("")),s=_f,i):(a.push(e),t=e,i+1)}function V(){return e==="f"&&(a.push(e),t=e,i+=1),/[eE]/.test(e)||e==="-"&&/[eE]/.test(t)?(a.push(e),t=e,i+1):/[^\d]/.test(e)?(g(a.join("")),s=_f,i):(a.push(e),t=e,i+1)}function G(){if(/[^\d\w_]/.test(e)){var B=a.join("");return s=LEt.indexOf(B)>-1?kEt:DEt.indexOf(B)>-1?NEt:FEt,g(a.join("")),s=_f,i}return a.push(e),t=e,i+1}}function BEt(e){var t=UEt(),r=[];return r=(r=r.concat(t(e))).concat(t(null))}function GEt(e){return BEt(e)}function jEt(e){return e.map(t=>t.type!=="eof"?t.data:"").join("")}const LH=["GL_OES_standard_derivatives","GL_EXT_frag_depth","GL_EXT_draw_buffers","GL_EXT_shader_texture_lod"];function qEt(e,t="100",r="300 es"){const i=/^\s*\#version\s+([0-9]+(\s+[a-zA-Z]+)?)\s*/;for(const n of e)if(n.type==="preprocessor"){const s=i.exec(n.data);if(s){const a=s[1].replace(/\s\s+/g," ");if(a===r)return a;if(a===t)return n.data="#version "+r,t;throw new Error("unknown glsl version: "+a)}}return e.splice(0,0,{type:"preprocessor",data:"#version "+r},{type:"whitespace",data:`
`}),null}function HEt(e,t){for(let r=t-1;r>=0;r--){const i=e[r];if(i.type!=="whitespace"&&i.type!=="block-comment"){if(i.type!=="keyword")break;if(i.data==="attribute"||i.data==="in")return!0}}return!1}function yC(e,t,r,i){i=i||r;for(const n of e)if(n.type==="ident"&&n.data===r)return i in t?t[i]++:t[i]=0,yC(e,t,i+"_"+t[i],i);return r}function xPe(e,t,r="afterVersion"){function i(l,c){for(let u=c;u<l.length;u++){const h=l[u];if(h.type==="operator"&&h.data===";")return u}return null}function n(l){let c=-1,u=0,h=-1;for(let p=0;p<l.length;p++){const m=l[p];if(m.type==="preprocessor"&&(m.data.match(/\#(if|ifdef|ifndef)\s+.+/)?++u:m.data.match(/\#endif\s*.*/)&&--u),r!=="afterVersion"&&r!=="afterPrecision"||m.type==="preprocessor"&&/^#version/.test(m.data)&&(h=Math.max(h,p)),r==="afterPrecision"&&m.type==="keyword"&&m.data==="precision"){const g=i(l,p);if(g===null)throw new Error("precision statement not followed by any semicolons!");h=Math.max(h,g)}c<h&&u===0&&(c=p)}return c+1}const s={data:`
`,type:"whitespace"},a=l=>l<e.length&&/[^\r\n]$/.test(e[l].data);let o=n(e);a(o-1)&&e.splice(o++,0,s);for(const l of t)e.splice(o++,0,l);a(o-1)&&a(o)&&e.splice(o,0,s)}function WEt(e,t,r,i="lowp"){xPe(e,[{type:"keyword",data:"out"},{type:"whitespace",data:" "},{type:"keyword",data:i},{type:"whitespace",data:" "},{type:"keyword",data:r},{type:"whitespace",data:" "},{type:"ident",data:t},{type:"operator",data:";"}],"afterPrecision")}function XEt(e,t,r,i,n="lowp"){xPe(e,[{type:"keyword",data:"layout"},{type:"operator",data:"("},{type:"keyword",data:"location"},{type:"whitespace",data:" "},{type:"operator",data:"="},{type:"whitespace",data:" "},{type:"integer",data:i.toString()},{type:"operator",data:")"},{type:"whitespace",data:" "},{type:"keyword",data:"out"},{type:"whitespace",data:" "},{type:"keyword",data:n},{type:"whitespace",data:" "},{type:"keyword",data:r},{type:"whitespace",data:" "},{type:"ident",data:t},{type:"operator",data:";"}],"afterPrecision")}function YEt(e,t){let r,i,n=-1;for(let s=t;s<e.length;s++){const a=e[s];if(a.type==="operator"&&(a.data==="["&&(r=s),a.data==="]")){i=s;break}a.type==="integer"&&(n=parseInt(a.data,10))}return r&&i&&e.splice(r,i-r+1),n}function Hbe(e,t){const r=ZEt();if(_(r))return r;const i=GEt(e);if(qEt(i,"100","300 es")==="300 es")return e;let n=null,s=null;const a={},o={};for(let l=0;l<i.length;++l){const c=i[l];switch(c.type){case"keyword":t===iu.VERTEX_SHADER&&c.data==="attribute"?c.data="in":c.data==="varying"&&(c.data=t===iu.VERTEX_SHADER?"out":"in");break;case"builtin":if(/^texture(2D|Cube)(Proj)?(Lod|Grad)?(EXT)?$/.test(c.data.trim())&&(c.data=c.data.replace(/(2D|Cube|EXT)/g,"")),t===iu.FRAGMENT_SHADER&&c.data==="gl_FragColor"&&(n||(n=yC(i,a,"fragColor"),WEt(i,n,"vec4")),c.data=n),t===iu.FRAGMENT_SHADER&&c.data==="gl_FragData"){const u=YEt(i,l+1),h=yC(i,a,"fragData");XEt(i,h,"vec4",u,"mediump"),c.data=h}else t===iu.FRAGMENT_SHADER&&c.data==="gl_FragDepthEXT"&&(s||(s=yC(i,a,"gl_FragDepth")),c.data=s);break;case"ident":if($Et.includes(c.data)){if(t===iu.VERTEX_SHADER&&HEt(i,l))throw new Error("attribute in vertex shader uses a name that is a reserved word in glsl 300 es");c.data in o||(o[c.data]=yC(i,a,c.data)),c.data=o[c.data]}}}for(let l=i.length-1;l>=0;--l){const c=i[l];if(c.type==="preprocessor"){const u=c.data.match(/\#extension\s+(.*)\:/);if(u&&u[1]&&LH.includes(u[1].trim())){const m=i[l+1];i.splice(l,m&&m.type==="whitespace"?2:1)}const h=c.data.match(/\#ifdef\s+(.*)/);h&&h[1]&&LH.includes(h[1].trim())&&(c.data="#if 1");const p=c.data.match(/\#ifndef\s+(.*)/);p&&p[1]&&LH.includes(p[1].trim())&&(c.data="#if 0")}}return QEt(e,jEt(i))}function ZEt(e){return null}function QEt(e,t){return t}const JEt=4294967295;class KEt{constructor(t,r,i,n,s=new Map){this._context=t,this._locations=n,this._uniformBlockBindings=s,this._refCount=1,this._compiled=!1,this._nameToUniformLocation={},this._nameToUniform1={},this._nameToUniform1v=new Map,this._nameToUniform2=new Map,this._nameToUniform3=new Map,this._nameToUniform4=new Map,this._nameToUniformMatrix3=new Map,this._nameToUniformMatrix4=new Map,t||console.error("RenderingContext isn't initialized!"),r.length===0&&console.error("Shaders source should not be empty!"),this._context.type===yr.WEBGL2&&(r=Hbe(r,iu.VERTEX_SHADER),i=Hbe(i,iu.FRAGMENT_SHADER)),this._vShader=Wbe(this._context,iu.VERTEX_SHADER,r),this._fShader=Wbe(this._context,iu.FRAGMENT_SHADER,i),this._vShader&&this._fShader||console.error("Error loading shaders!"),this._context.instanceCounter.increment(ks.Shader,this),FA()&&(this.vertexShader=r,this.fragmentShader=i)}get glName(){if(_(this._glName))return this._glName;if(R(this._vShader))return null;const t=this._context.gl,r=t.createProgram();if(t.attachShader(r,this._vShader),t.attachShader(r,this._fShader),this._locations.forEach((i,n)=>t.bindAttribLocation(r,i,n)),t.linkProgram(r),FA()&&!t.getProgramParameter(r,t.LINK_STATUS)&&console.error(`Could not link shader
validated: ${t.getProgramParameter(r,t.VALIDATE_STATUS)}, gl error ${t.getError()}, vertex: ${t.getShaderParameter(this._vShader,t.COMPILE_STATUS)}, fragment: ${t.getShaderParameter(this._fShader,t.COMPILE_STATUS)}, info log: ${t.getProgramInfoLog(r)}, vertex source: ${this.vertexShader}, fragment source: ${this.fragmentShader}`),this._context.type===yr.WEBGL2){const i=t;for(const[n,s]of this._uniformBlockBindings){const a=i.getUniformBlockIndex(r,n);a<JEt&&i.uniformBlockBinding(r,a,s)}}return this._glName=r,this._context.instanceCounter.increment(ks.Program,this),r}get hasGLName(){return _(this._glName)}get isCompiled(){if(this._compiled)return!0;const t=this._context.gl.getExtension("KHR_parallel_shader_compile");return t==null?(this._compiled=!0,!0):(this._compiled=!!this._context.gl.getProgramParameter(this.glName,t.COMPLETION_STATUS_KHR),this._compiled)}dispose(){if(--this._refCount>0)return;const t=this._context.gl;this._vShader&&(t.deleteShader(this._vShader),this._vShader=null,this._context.instanceCounter.decrement(ks.Shader,this)),this._fShader&&(t.deleteShader(this._fShader),this._fShader=null),this._glName&&(t.deleteProgram(this._glName),this._glName=null,this._context.instanceCounter.decrement(ks.Program,this))}ref(){++this._refCount}_getUniformLocation(t){return this._nameToUniformLocation[t]===void 0&&(this._nameToUniformLocation[t]=this._context.gl.getUniformLocation(this.glName,t)),this._nameToUniformLocation[t]}hasUniform(t){return this._getUniformLocation(t)!==null}setUniform1i(t,r){const i=this._nameToUniform1[t];i!==void 0&&r===i||(this._context.gl.uniform1i(this._getUniformLocation(t),r),this._nameToUniform1[t]=r)}setUniform1iv(t,r){a0(this._nameToUniform1v,t,r)&&this._context.gl.uniform1iv(this._getUniformLocation(t),r)}setUniform2iv(t,r){a0(this._nameToUniform2,t,r)&&this._context.gl.uniform2iv(this._getUniformLocation(t),r)}setUniform3iv(t,r){a0(this._nameToUniform3,t,r)&&this._context.gl.uniform3iv(this._getUniformLocation(t),r)}setUniform4iv(t,r){a0(this._nameToUniform4,t,r)&&this._context.gl.uniform4iv(this._getUniformLocation(t),r)}setUniform1f(t,r){const i=this._nameToUniform1[t];i!==void 0&&r===i||(this._context.gl.uniform1f(this._getUniformLocation(t),r),this._nameToUniform1[t]=r)}setUniform1fv(t,r){a0(this._nameToUniform1v,t,r)&&this._context.gl.uniform1fv(this._getUniformLocation(t),r)}setUniform2f(t,r,i){const n=this._nameToUniform2.get(t);n===void 0?(this._context.gl.uniform2f(this._getUniformLocation(t),r,i),this._nameToUniform2.set(t,[r,i])):r===n[0]&&i===n[1]||(this._context.gl.uniform2f(this._getUniformLocation(t),r,i),n[0]=r,n[1]=i)}setUniform2fv(t,r){a0(this._nameToUniform2,t,r)&&this._context.gl.uniform2fv(this._getUniformLocation(t),r)}setUniform3f(t,r,i,n){const s=this._nameToUniform3.get(t);s===void 0?(this._context.gl.uniform3f(this._getUniformLocation(t),r,i,n),this._nameToUniform3[t]=[r,i,n]):r===s[0]&&i===s[1]&&n===s[2]||(this._context.gl.uniform3f(this._getUniformLocation(t),r,i,n),s[0]=r,s[1]=i,s[2]=n)}setUniform3fv(t,r){a0(this._nameToUniform3,t,r)&&this._context.gl.uniform3fv(this._getUniformLocation(t),r)}setUniform4f(t,r,i,n,s){const a=this._nameToUniform4.get(t);a===void 0?(this._context.gl.uniform4f(this._getUniformLocation(t),r,i,n,s),this._nameToUniform4.set(t,[r,i,n,s])):a!==void 0&&r===a[0]&&i===a[1]&&n===a[2]&&s===a[3]||(this._context.gl.uniform4f(this._getUniformLocation(t),r,i,n,s),a[0]=r,a[1]=i,a[2]=n,a[3]=s)}setUniform4fv(t,r){a0(this._nameToUniform4,t,r)&&this._context.gl.uniform4fv(this._getUniformLocation(t),r)}setUniformMatrix3fv(t,r,i=!1){a0(this._nameToUniformMatrix3,t,r)&&this._context.gl.uniformMatrix3fv(this._getUniformLocation(t),i,r)}setUniformMatrix4fv(t,r,i=!1){a0(this._nameToUniformMatrix4,t,r)&&this._context.gl.uniformMatrix4fv(this._getUniformLocation(t),i,r)}stop(){}}function Wbe(e,t,r){const i=e.gl,n=i.createShader(t);return i.shaderSource(n,r),i.compileShader(n),FA()&&!i.getShaderParameter(n,i.COMPILE_STATUS)&&(console.error("Compile error in ".concat(t===iu.VERTEX_SHADER?"vertex":"fragment"," shader")),console.error(i.getShaderInfoLog(n)),console.error(eCt(r))),n}function eCt(e){let t=2;return e.replace(/\n/g,()=>`
`+tCt(t++)+":")}function tCt(e){return e>=1e3?e.toString():("  "+e).slice(-3)}function a0(e,t,r){const i=e.get(t);return i?vte(i,r):(e.set(t,Array.from(r)),!0)}class rCt{constructor(t){this._rctx=t,this._store=new mae}dispose(){this._store.forEach(t=>t.forEach(r=>r.dispose())),this._store.clear()}acquire(t,r,i,n){const s=this._store.get(t,r);if(_(s))return s.ref(),s;const a=new KEt(this._rctx,t,r,i,n);return a.ref(),this._store.set(t,r,a),a}get test(){let t=0;return this._store.forEach(r=>r.forEach(i=>t+=i.hasGLName?2:1)),{cachedWebGLObjects:t}}}function Xbe(e,t){const r=new Pi(e,{colorTarget:hn.TEXTURE,depthStencilTarget:Pr.NONE},{target:mt.TEXTURE_2D,wrapMode:xt.CLAMP_TO_EDGE,pixelFormat:Ue.RGBA,dataType:At.UNSIGNED_BYTE,samplingMode:tt.NEAREST,width:1,height:1});function i(v,x){const T=`

  precision highp float;

  attribute vec2 position;

  uniform vec3 u_highA;
  uniform vec3 u_lowA;
  uniform vec3 u_highB;
  uniform vec3 u_lowB;

  varying vec4 v_color;

  ${t?"#define DOUBLE_PRECISION_REQUIRES_OBFUSCATION":""}

  #ifdef DOUBLE_PRECISION_REQUIRES_OBFUSCATION

  vec3 dpPlusFrc(vec3 a, vec3 b) {
    return mix(a, a + b, vec3(notEqual(b, vec3(0))));
  }

  vec3 dpMinusFrc(vec3 a, vec3 b) {
    return mix(vec3(0), a - b, vec3(notEqual(a, b)));
  }

  vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
    vec3 t1 = dpPlusFrc(hiA, hiB);
    vec3 e = dpMinusFrc(t1, hiA);
    vec3 t2 = dpMinusFrc(hiB, e) + dpMinusFrc(hiA, dpMinusFrc(t1, e)) + loA + loB;
    return t1 + t2;
  }

  #else

  vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
    vec3 t1 = hiA + hiB;
    vec3 e = t1 - hiA;
    vec3 t2 = ((hiB - e) + (hiA - (t1 - e))) + loA + loB;
    return t1 + t2;
  }

  #endif

  const float MAX_RGBA_FLOAT =
    255.0 / 256.0 +
    255.0 / 256.0 / 256.0 +
    255.0 / 256.0 / 256.0 / 256.0 +
    255.0 / 256.0 / 256.0 / 256.0 / 256.0;

  const vec4 FIXED_POINT_FACTORS = vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);

  vec4 float2rgba(const float value) {
    // Make sure value is in the domain we can represent
    float valueInValidDomain = clamp(value, 0.0, MAX_RGBA_FLOAT);

    // Decompose value in 32bit fixed point parts represented as
    // uint8 rgba components. Decomposition uses the fractional part after multiplying
    // by a power of 256 (this removes the bits that are represented in the previous
    // component) and then converts the fractional part to 8bits.
    vec4 fixedPointU8 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);

    // Convert uint8 values (from 0 to 255) to floating point representation for
    // the shader
    const float toU8AsFloat = 1.0 / 255.0;

    return fixedPointU8 * toU8AsFloat;
  }

  void main() {
    vec3 val = dpAdd(u_highA, u_lowA, -u_highB, -u_lowB);

    v_color = float2rgba(val.z / 25.0);

    gl_Position = vec4(position * 2.0 - 1.0, 0.0, 1.0);
  }
  `,E=`
  precision highp float;

  varying vec4 v_color;

  void main() {
    gl_FragColor = v_color;
  }
  `,C=e.programCache.acquire(T,E,new Map([["position",0]])),A=new Float32Array(6);zJ(v,A,3);const P=new Float32Array(6);return zJ(x,P,3),e.useProgram(C),C.setUniform3f("u_highA",A[0],A[2],A[4]),C.setUniform3f("u_lowA",A[1],A[3],A[5]),C.setUniform3f("u_highB",P[0],P[2],P[4]),C.setUniform3f("u_lowB",P[1],P[3],P[5]),C}const n=dr.createVertex(e,Cr.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),s=new ns(e,new Map([["position",0]]),{geometry:[new La("position",2,ft.UNSIGNED_SHORT,0,4)]},{geometry:n}),a=Ve(5633261287538229e-9,2626832878767164e-9,1.4349880495278358e6),o=Ve(563327146742708e-8,2.6268736381334523e6,1434963231608387e-9),l=i(a,o),c=e.getBoundFramebufferObject(),{x:u,y:h,width:p,height:m}=e.getViewport();e.bindFramebuffer(r),e.setViewport(0,0,1,1),e.bindVAO(s),e.drawArrays(Dt.TRIANGLE_STRIP,0,4);const g=new Uint8Array(4);r.readPixels(0,0,1,1,Ue.RGBA,At.UNSIGNED_BYTE,g),l.dispose(),s.dispose(!1),n.dispose(),r.dispose(),e.setViewport(u,h,p,m),e.bindFramebuffer(c);const b=(a[2]-o[2])/25,w=Kse(g);return Math.abs(b-w)}var Ybe,Zbe,Qbe,TPe={exports:{}};function iCt(e){var g,b,w,v,x;if(!e.gl)return!1;if(e.type===yr.WEBGL1)return!(!((g=e.capabilities.textureFloat)!=null&&g.textureFloat)||!((b=e.capabilities.colorBufferFloat)!=null&&b.textureFloat));if(!(((w=e.capabilities.textureFloat)==null?void 0:w.textureFloat)&&((v=e.capabilities.colorBufferFloat)==null?void 0:v.textureFloat)&&((x=e.capabilities.colorBufferFloat)==null?void 0:x.floatBlend)))return!1;const t=new Pi(e,{colorTarget:hn.TEXTURE,depthStencilTarget:Pr.NONE},{target:mt.TEXTURE_2D,wrapMode:xt.CLAMP_TO_EDGE,pixelFormat:Ue.RGBA,dataType:At.FLOAT,internalFormat:gt.RGBA32F,samplingMode:tt.NEAREST,width:1,height:1}),r=dr.createVertex(e,Cr.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),i=new ns(e,new Map([["a_pos",0]]),{geometry:[new La("a_pos",2,ft.UNSIGNED_SHORT,0,4)]},{geometry:r}),n=`
  precision highp float;
  attribute vec2 a_pos;

  void main() {
    gl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);
  }
  `,s=`
   precision highp float;

   void main() {
    gl_FragColor = vec4(0.5, 0.5, 0.5, 0.5);
   }
  `,a=e.programCache.acquire(n,s,new Map([["a_pos",0]]));e.useProgram(a);const o=e.getBoundFramebufferObject(),{x:l,y:c,width:u,height:h}=e.getViewport();e.bindFramebuffer(t),e.setViewport(0,0,1,1),e.bindVAO(i),e.drawArrays(Dt.TRIANGLE_STRIP,0,4);const p=jt({blending:mAe});e.setPipelineState(p),e.drawArrays(Dt.TRIANGLE_STRIP,0,4),TPe.exports.init(e);const m=e.gl.getError();return e.setViewport(l,c,u,h),e.bindFramebuffer(o),a.dispose(),i.dispose(!1),r.dispose(),t.dispose(),m!==1282||(console.warn("Device claims support for WebGL extension EXT_float_blend but does not support it. Using fall back."),!1)}Ybe=TPe,Zbe=function(){var e=function(b){window.console&&window.console.log&&window.console.log(b)},t=function(b){window.console&&window.console.error?window.console.error(b):e(b)},r={enable:{1:{0:!0}},disable:{1:{0:!0}},getParameter:{1:{0:!0}},drawArrays:{3:{0:!0}},drawElements:{4:{0:!0,2:!0}},createShader:{1:{0:!0}},getShaderParameter:{2:{1:!0}},getProgramParameter:{2:{1:!0}},getShaderPrecisionFormat:{2:{0:!0,1:!0}},getVertexAttrib:{2:{1:!0}},vertexAttribPointer:{6:{2:!0}},bindTexture:{2:{0:!0}},activeTexture:{1:{0:!0}},getTexParameter:{2:{0:!0,1:!0}},texParameterf:{3:{0:!0,1:!0}},texParameteri:{3:{0:!0,1:!0,2:!0}},texImage2D:{9:{0:!0,2:!0,6:!0,7:!0},6:{0:!0,2:!0,3:!0,4:!0}},texSubImage2D:{9:{0:!0,6:!0,7:!0},7:{0:!0,4:!0,5:!0}},copyTexImage2D:{8:{0:!0,2:!0}},copyTexSubImage2D:{8:{0:!0}},generateMipmap:{1:{0:!0}},compressedTexImage2D:{7:{0:!0,2:!0}},compressedTexSubImage2D:{8:{0:!0,6:!0}},bindBuffer:{2:{0:!0}},bufferData:{3:{0:!0,2:!0}},bufferSubData:{3:{0:!0}},getBufferParameter:{2:{0:!0,1:!0}},pixelStorei:{2:{0:!0,1:!0}},readPixels:{7:{4:!0,5:!0}},bindRenderbuffer:{2:{0:!0}},bindFramebuffer:{2:{0:!0}},checkFramebufferStatus:{1:{0:!0}},framebufferRenderbuffer:{4:{0:!0,1:!0,2:!0}},framebufferTexture2D:{5:{0:!0,1:!0,2:!0}},getFramebufferAttachmentParameter:{3:{0:!0,1:!0,2:!0}},getRenderbufferParameter:{2:{0:!0,1:!0}},renderbufferStorage:{4:{0:!0,1:!0}},clear:{1:{0:{enumBitwiseOr:["COLOR_BUFFER_BIT","DEPTH_BUFFER_BIT","STENCIL_BUFFER_BIT"]}}},depthFunc:{1:{0:!0}},blendFunc:{2:{0:!0,1:!0}},blendFuncSeparate:{4:{0:!0,1:!0,2:!0,3:!0}},blendEquation:{1:{0:!0}},blendEquationSeparate:{2:{0:!0,1:!0}},stencilFunc:{3:{0:!0}},stencilFuncSeparate:{4:{0:!0,1:!0}},stencilMaskSeparate:{2:{0:!0}},stencilOp:{3:{0:!0,1:!0,2:!0}},stencilOpSeparate:{4:{0:!0,1:!0,2:!0,3:!0}},cullFace:{1:{0:!0}},frontFace:{1:{0:!0}},drawArraysInstancedANGLE:{4:{0:!0}},drawElementsInstancedANGLE:{5:{0:!0,2:!0}},blendEquationEXT:{1:{0:!0}}},i=null,n=null;function s(b){if(i==null)for(var w in i={},n={},b)typeof b[w]=="number"&&(i[b[w]]=w,n[w]=b[w])}function a(){if(i==null)throw"WebGLDebugUtils.init(ctx) not called"}function o(b){return a(),i[b]!==void 0}function l(b){a();var w=i[b];return w!==void 0?"gl."+w:"/*UNKNOWN WebGL ENUM*/ 0x"+b.toString(16)}function c(b,w,v,x){var T;if((T=r[b])!==void 0&&(T=T[w])!==void 0&&T[v]){if(typeof T[v]=="object"&&T[v].enumBitwiseOr!==void 0){for(var E=T[v].enumBitwiseOr,C=0,A=[],P=0;P<E.length;++P){var I=n[E[P]];(x&I)!=0&&(C|=I,A.push(l(I)))}return C===x?A.join(" | "):l(x)}return l(x)}return x===null?"null":x===void 0?"undefined":x.toString()}function u(b,w){for(var v="",x=w.length,T=0;T<x;++T)v+=(T==0?"":", ")+c(b,x,T,w[T]);return v}function h(b,w,v){b.__defineGetter__(v,function(){return w[v]}),b.__defineSetter__(v,function(x){w[v]=x})}function p(b,w,v,x){x=x||b,s(b),w=w||function(I,L,V){for(var G="",B=V.length,X=0;X<B;++X)G+=(X==0?"":", ")+c(L,B,X,V[X]);t("WebGL error "+l(I)+" in "+L+"("+G+")")};var T={};function E(I,L){return function(){v&&v(L,arguments);var V=I[L].apply(I,arguments),G=x.getError();return G!=0&&(T[G]=!0,w(G,L,arguments)),V}}var C={};for(var A in b)if(typeof b[A]=="function")if(A!="getExtension")C[A]=E(b,A);else{var P=E(b,A);C[A]=function(){return p(P.apply(b,arguments),w,v,x)}}else h(C,b,A);return C.getError=function(){for(var I in T)if(T.hasOwnProperty(I)&&T[I])return T[I]=!1,I;return b.NO_ERROR},C}function m(b){var w=b.getParameter(b.MAX_VERTEX_ATTRIBS),v=b.createBuffer();b.bindBuffer(b.ARRAY_BUFFER,v);for(var x=0;x<w;++x)b.disableVertexAttribArray(x),b.vertexAttribPointer(x,4,b.FLOAT,!1,0,0),b.vertexAttrib1f(x,0);b.deleteBuffer(v);var T=b.getParameter(b.MAX_TEXTURE_IMAGE_UNITS);for(x=0;x<T;++x)b.activeTexture(b.TEXTURE0+x),b.bindTexture(b.TEXTURE_CUBE_MAP,null),b.bindTexture(b.TEXTURE_2D,null);for(b.activeTexture(b.TEXTURE0),b.useProgram(null),b.bindBuffer(b.ARRAY_BUFFER,null),b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,null),b.bindFramebuffer(b.FRAMEBUFFER,null),b.bindRenderbuffer(b.RENDERBUFFER,null),b.disable(b.BLEND),b.disable(b.CULL_FACE),b.disable(b.DEPTH_TEST),b.disable(b.DITHER),b.disable(b.SCISSOR_TEST),b.blendColor(0,0,0,0),b.blendEquation(b.FUNC_ADD),b.blendFunc(b.ONE,b.ZERO),b.clearColor(0,0,0,0),b.clearDepth(1),b.clearStencil(-1),b.colorMask(!0,!0,!0,!0),b.cullFace(b.BACK),b.depthFunc(b.LESS),b.depthMask(!0),b.depthRange(0,1),b.frontFace(b.CCW),b.hint(b.GENERATE_MIPMAP_HINT,b.DONT_CARE),b.lineWidth(1),b.pixelStorei(b.PACK_ALIGNMENT,4),b.pixelStorei(b.UNPACK_ALIGNMENT,4),b.pixelStorei(b.UNPACK_FLIP_Y_WEBGL,!1),b.pixelStorei(b.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),b.UNPACK_COLORSPACE_CONVERSION_WEBGL&&b.pixelStorei(b.UNPACK_COLORSPACE_CONVERSION_WEBGL,b.BROWSER_DEFAULT_WEBGL),b.polygonOffset(0,0),b.sampleCoverage(1,!1),b.scissor(0,0,b.canvas.width,b.canvas.height),b.stencilFunc(b.ALWAYS,0,4294967295),b.stencilMask(4294967295),b.stencilOp(b.KEEP,b.KEEP,b.KEEP),b.viewport(0,0,b.canvas.width,b.canvas.height),b.clear(b.COLOR_BUFFER_BIT|b.DEPTH_BUFFER_BIT|b.STENCIL_BUFFER_BIT);b.getError(););}function g(b){var w,v,x=[],T=[],E={},C=1,A=!1,P=[],I=0,L=0,V=!1,G=0,B={};function X(q){return typeof q=="function"?q:function(ee){q.handleEvent(ee)}}b.getContext=(v=b.getContext,function(){var q=v.apply(b,arguments);if(q instanceof WebGLRenderingContext){if(q!=w){if(w)throw"got different context";E=Z(w=q)}return E}return q});var Y=function(q){x.push(X(q))},ce=function(q){T.push(X(q))};function se(q){var ee=q.addEventListener;q.addEventListener=function(me,_e,De){switch(me){case"webglcontextlost":Y(_e);break;case"webglcontextrestored":ce(_e);break;default:ee.apply(q,arguments)}}}function D(){for(var q=Object.keys(B),ee=0;ee<q.length;++ee)delete B[q]}function F(){++L,A||I==L&&b.loseContext()}function U(q,ee){var me=q[ee];return function(){if(F(),!A)return me.apply(q,arguments)}}function j(){for(var q=0;q<P.length;++q){var ee=P[q];ee instanceof WebGLBuffer?w.deleteBuffer(ee):ee instanceof WebGLFramebuffer?w.deleteFramebuffer(ee):ee instanceof WebGLProgram?w.deleteProgram(ee):ee instanceof WebGLRenderbuffer?w.deleteRenderbuffer(ee):ee instanceof WebGLShader?w.deleteShader(ee):ee instanceof WebGLTexture&&w.deleteTexture(ee)}}function W(q){return{statusMessage:q,preventDefault:function(){V=!0}}}return se(b),b.loseContext=function(){if(!A){for(A=!0,I=0,++C;w.getError(););D(),B[w.CONTEXT_LOST_WEBGL]=!0;var q=W("context lost"),ee=x.slice();setTimeout(function(){for(var me=0;me<ee.length;++me)ee[me](q);G>=0&&setTimeout(function(){b.restoreContext()},G)},0)}},b.restoreContext=function(){A&&T.length&&setTimeout(function(){if(!V)throw"can not restore. webglcontestlost listener did not call event.preventDefault";j(),m(w),A=!1,L=0,V=!1;for(var q=T.slice(),ee=W("context restored"),me=0;me<q.length;++me)q[me](ee)},0)},b.loseContextInNCalls=function(q){if(A)throw"You can not ask a lost contet to be lost";I=L+q},b.getNumCalls=function(){return L},b.setRestoreTimeout=function(q){G=q},b;function Z(q){for(var ee in q)typeof q[ee]=="function"?E[ee]=U(q,ee):h(E,q,ee);E.getError=function(){if(F(),!A)for(;Ce=w.getError();)B[Ce]=!0;for(var Ce in B)if(B[Ce])return delete B[Ce],Ce;return E.NO_ERROR};for(var me=["createBuffer","createFramebuffer","createProgram","createRenderbuffer","createShader","createTexture"],_e=0;_e<me.length;++_e){var De=me[_e];E[De]=function(Ce){return function(){if(F(),A)return null;var Ne=Ce.apply(q,arguments);return Ne.__webglDebugContextLostId__=C,P.push(Ne),Ne}}(q[De])}var be=["getActiveAttrib","getActiveUniform","getBufferParameter","getContextAttributes","getAttachedShaders","getFramebufferAttachmentParameter","getParameter","getProgramParameter","getProgramInfoLog","getRenderbufferParameter","getShaderParameter","getShaderInfoLog","getShaderSource","getTexParameter","getUniform","getUniformLocation","getVertexAttrib"];for(_e=0;_e<be.length;++_e)De=be[_e],E[De]=function(Ce){return function(){return F(),A?null:Ce.apply(q,arguments)}}(E[De]);var ye=["isBuffer","isEnabled","isFramebuffer","isProgram","isRenderbuffer","isShader","isTexture"];for(_e=0;_e<ye.length;++_e)De=ye[_e],E[De]=function(Ce){return function(){return F(),!A&&Ce.apply(q,arguments)}}(E[De]);return E.checkFramebufferStatus=function(Ce){return function(){return F(),A?E.FRAMEBUFFER_UNSUPPORTED:Ce.apply(q,arguments)}}(E.checkFramebufferStatus),E.getAttribLocation=function(Ce){return function(){return F(),A?-1:Ce.apply(q,arguments)}}(E.getAttribLocation),E.getVertexAttribOffset=function(Ce){return function(){return F(),A?0:Ce.apply(q,arguments)}}(E.getVertexAttribOffset),E.isContextLost=function(){return A},E}}return{init:s,mightBeEnum:o,glEnumToString:l,glFunctionArgToString:c,glFunctionArgsToString:u,makeDebugContext:p,makeLostContextSimulatingCanvas:g,resetToInitialState:m}},(Qbe=Zbe())!==void 0&&(Ybe.exports=Qbe);const nCt=fe.getLogger("esri.views.WebGLDriverTest");function sCt(e){const t=new Pi(e,{colorTarget:hn.TEXTURE,depthStencilTarget:Pr.NONE},{target:mt.TEXTURE_2D,wrapMode:xt.CLAMP_TO_EDGE,pixelFormat:Ue.RGBA,dataType:At.UNSIGNED_BYTE,samplingMode:tt.NEAREST,width:1,height:1}),r=`
precision highp float;
attribute vec2 a_pos;
uniform highp sampler2D u_texture;
varying vec4 v_color;

float getBit(in float bitset, in int bitIndex) {
  float offset = pow(2.0, float(bitIndex));
  return mod(floor(bitset / offset), 2.0);
}

void main() {
  vec4 value = texture2D(u_texture, vec2(0.0));
  float bit = getBit(value.x * 255.0, 1);

  v_color = bit * vec4(1.0);
  gl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);
}
`,i=`
precision highp float;
varying vec4 v_color;

void main() {
  gl_FragColor = v_color;
}
`,n=new Uint8Array(4),s=dr.createVertex(e,Cr.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),a=new ns(e,new Map([["a_position",0]]),{geometry:[new La("a_position",2,ft.SHORT,0,4)]},{geometry:s}),o=e.programCache.acquire(r,i,new Map([["a_pos",0]]));e.useProgram(o);const l=new at(e,{target:mt.TEXTURE_2D,wrapMode:xt.CLAMP_TO_EDGE,pixelFormat:Ue.RGBA,dataType:At.UNSIGNED_BYTE,samplingMode:tt.NEAREST,width:1,height:1},new Uint8Array([2,255,0,0]));o.setUniform1i("u_texture",0),e.bindTexture(l,0);const c=e.getBoundFramebufferObject();e.bindFramebuffer(t),e.useProgram(o);const{x:u,y:h,width:p,height:m}=e.getViewport();e.setViewport(0,0,1,1),e.bindVAO(a),e.drawArrays(Dt.TRIANGLE_STRIP,0,4),e.setViewport(u,h,p,m),t.readPixels(0,0,1,1,Ue.RGBA,At.UNSIGNED_BYTE,n),o.dispose(),a.dispose(!1),s.dispose(),t.dispose();const g=n[0]!==255||n[1]!==255||n[2]!==255||n[3]!==255;return g&&nCt.warn(`A problem was detected with your graphics driver. Your driver does not appear to honor sampler precision specifiers, which may result in rendering issues due to numerical instability. We recommend ensuring that your drivers have been updated to the latest version. Applying lowp sampler workaround. [${n[0]}.${n[1]}.${n[2]}.${n[3]}]`),e.bindFramebuffer(c),g}new La("a_pos",2,ft.BYTE,0,2);new La("a_pos",2,ft.BYTE,0,4),new La("a_tex",2,ft.BYTE,2,4);const aCt={geometry:[new La("a_pos",2,ft.UNSIGNED_SHORT,0,4)]};async function oCt(e){const t=new Image;if(t.src="data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg width='5' height='5' version='1.1' viewBox='0 0 5 5' xmlns='http://www.w3.org/2000/svg'%3E%3Crect width='5' height='5' fill='%23f00' fill-opacity='.5'/%3E%3C/svg%3E%0A",t.width=5,t.height=5,await t.decode(),!e.gl)return!0;const r=new Pi(e,{colorTarget:hn.TEXTURE,depthStencilTarget:Pr.NONE},{target:mt.TEXTURE_2D,wrapMode:xt.CLAMP_TO_EDGE,pixelFormat:Ue.RGBA,dataType:At.UNSIGNED_BYTE,samplingMode:tt.NEAREST,width:1,height:1}),i=dr.createVertex(e,Cr.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),n=new ns(e,new Map([["a_pos",0]]),aCt,{geometry:i}),s=`
  precision highp float;

  attribute vec2 a_pos;
  varying vec2 v_uv;

  void main() {
    v_uv = a_pos;
    gl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);
  }
  `,a=`
  precision highp float;

  varying vec2 v_uv;
  uniform sampler2D u_texture;

  void main() {
    gl_FragColor = texture2D(u_texture, v_uv);
  }
  `,o=e.programCache.acquire(s,a,new Map([["a_pos",0]]));e.useProgram(o);const l=new at(e,{dataType:At.UNSIGNED_BYTE,pixelFormat:Ue.RGBA,preMultiplyAlpha:!1,wrapMode:xt.CLAMP_TO_EDGE,samplingMode:tt.LINEAR},t);e.bindTexture(l,0),o.setUniform1i("u_texture",0);const c=e.getBoundFramebufferObject(),{x:u,y:h,width:p,height:m}=e.getViewport();e.bindFramebuffer(r),e.setViewport(0,0,1,1),e.setClearColor(0,0,0,0),e.setBlendingEnabled(!1),e.clearSafe(ii.COLOR_BUFFER_BIT),e.bindVAO(n),e.drawArrays(Dt.TRIANGLE_STRIP,0,4);const g=new Uint8Array(4);return r.readPixels(0,0,1,1,Ue.RGBA,At.UNSIGNED_BYTE,g),o.dispose(),n.dispose(!1),i.dispose(),r.dispose(),l.dispose(),e.setViewport(u,h,p,m),e.bindFramebuffer(c),t.src="",g[0]===255}class lCt{constructor(t){this.context=t,this._floatBufferBlendWorking=iCt(t),oCt(t).then(r=>this._svgAlwaysPremultipliesAlpha=!r)}get floatBufferBlendWorking(){if(R(this._floatBufferBlendWorking))throw new Error("floatBufferBlendWorking test not yet available");return this._floatBufferBlendWorking}get svgAlwaysPremultipliesAlpha(){if(R(this._svgAlwaysPremultipliesAlpha))throw new Error("svgAlwaysPremultipliesAlpha test not yet available");return this._svgAlwaysPremultipliesAlpha}get doublePrecisionRequiresObfuscation(){if(R(this._doublePrecisionRequiresObfuscation)){const t=Xbe(this.context,!1),r=Xbe(this.context,!0);this._doublePrecisionRequiresObfuscation=t!==0&&(r===0||t/r>5)}return this._doublePrecisionRequiresObfuscation}get ignoresSamplerPrecision(){return R(this._ignoresSamplerPrecision)&&(this._ignoresSamplerPrecision=sCt(this.context)),this._ignoresSamplerPrecision}}class Jbe{constructor(t,r,i,n,s,a,o,l){this.createQuery=t,this.resultAvailable=r,this.getResult=i,this.disjoint=n,this.beginTimeElapsed=s,this.endTimeElapsed=a,this.createTimestamp=o,this.timestampBits=l}}function cCt(e,t){if(t.disjointTimerQuery)return null;let r=e.getExtension("EXT_disjoint_timer_query_webgl2");return r&&ia(e)?new Jbe(()=>e.createQuery(),i=>e.getQueryParameter(i,e.QUERY_RESULT_AVAILABLE),i=>e.getQueryParameter(i,e.QUERY_RESULT),()=>e.getParameter(r.GPU_DISJOINT_EXT),i=>e.beginQuery(r.TIME_ELAPSED_EXT,i),()=>e.endQuery(r.TIME_ELAPSED_EXT),i=>r.queryCounterEXT(i,r.TIMESTAMP_EXT),()=>e.getQuery(r.TIMESTAMP_EXT,r.QUERY_COUNTER_BITS_EXT)):(r=e.getExtension("EXT_disjoint_timer_query"),r?new Jbe(()=>r.createQueryEXT(),i=>r.getQueryObjectEXT(i,r.QUERY_RESULT_AVAILABLE_EXT),i=>r.getQueryObjectEXT(i,r.QUERY_RESULT_EXT),()=>e.getParameter(r.GPU_DISJOINT_EXT),i=>r.beginQueryEXT(r.TIME_ELAPSED_EXT,i),()=>r.endQueryEXT(r.TIME_ELAPSED_EXT),i=>r.queryCounterEXT(i,r.TIMESTAMP_EXT),()=>r.getQueryEXT(r.TIMESTAMP_EXT,r.QUERY_COUNTER_BITS_EXT)):null)}function dCt(e,t){if(t.disjointTimerQuery)return null;if(ia(e))return{drawBuffers:e.drawBuffers.bind(e),MAX_DRAW_BUFFERS:e.MAX_DRAW_BUFFERS,MAX_COLOR_ATTACHMENTS:e.MAX_COLOR_ATTACHMENTS};if(t.drawBuffers)return null;const r=e.getExtension("WEBGL_draw_buffers");return r?{drawBuffers:r.drawBuffersWEBGL.bind(r),MAX_DRAW_BUFFERS:r.MAX_DRAW_BUFFERS_WEBGL,MAX_COLOR_ATTACHMENTS:r.MAX_COLOR_ATTACHMENTS_WEBGL}:null}function uCt(e){if(ia(e))return{drawArraysInstanced:e.drawArraysInstanced.bind(e),drawElementsInstanced:e.drawElementsInstanced.bind(e),vertexAttribDivisor:e.vertexAttribDivisor.bind(e)};const t=e.getExtension("ANGLE_instanced_arrays");return t?{drawArraysInstanced:t.drawArraysInstancedANGLE.bind(t),drawElementsInstanced:t.drawElementsInstancedANGLE.bind(t),vertexAttribDivisor:t.vertexAttribDivisorANGLE.bind(t)}:null}function hCt(e,t){if(t.compressedTextureETC)return null;const r=e.getExtension("WEBGL_compressed_texture_etc");return r?{COMPRESSED_R11_EAC:r.COMPRESSED_R11_EAC,COMPRESSED_SIGNED_R11_EAC:r.COMPRESSED_SIGNED_R11_EAC,COMPRESSED_RG11_EAC:r.COMPRESSED_RG11_EAC,COMPRESSED_SIGNED_RG11_EAC:r.COMPRESSED_SIGNED_RG11_EAC,COMPRESSED_RGB8_ETC2:r.COMPRESSED_RGB8_ETC2,COMPRESSED_SRGB8_ETC2:r.COMPRESSED_SRGB8_ETC2,COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:r.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2,COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:r.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2,COMPRESSED_RGBA8_ETC2_EAC:r.COMPRESSED_RGBA8_ETC2_EAC,COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:r.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC}:null}function fCt(e,t){if(t.compressedTextureS3TC)return null;const r=e.getExtension("WEBGL_compressed_texture_s3tc");return r?{COMPRESSED_RGB_S3TC_DXT1:r.COMPRESSED_RGB_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT1:r.COMPRESSED_RGBA_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT3:r.COMPRESSED_RGBA_S3TC_DXT3_EXT,COMPRESSED_RGBA_S3TC_DXT5:r.COMPRESSED_RGBA_S3TC_DXT5_EXT}:null}function pCt(e,t){if(ia(e))return{MIN:e.MIN,MAX:e.MAX};if(t.blendMinMax)return null;{const r=e.getExtension("EXT_blend_minmax");return r?{MIN:r.MIN_EXT,MAX:r.MAX_EXT}:null}}function mCt(e,t){if(t.textureFilterAnisotropic)return null;const r=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");return r?{MAX_TEXTURE_MAX_ANISOTROPY:r.MAX_TEXTURE_MAX_ANISOTROPY_EXT,TEXTURE_MAX_ANISOTROPY:r.TEXTURE_MAX_ANISOTROPY_EXT}:null}function gCt(e,t){if(ia(e))return{textureFloat:!0,textureFloatLinear:!t.textureFloatLinear&&!!e.getExtension("OES_texture_float_linear"),textureHalfFloat:!0,textureHalfFloatLinear:!0,HALF_FLOAT:e.HALF_FLOAT,R16F:e.R16F,RG16F:e.RG16F,RGBA16F:e.RGBA16F,R32F:e.R32F,RG32F:e.RG32F,RGBA32F:e.RGBA32F,R11F_G11F_B10F:e.R11F_G11F_B10F,RGB16F:e.RGB16F};if(e instanceof WebGLRenderingContext){const r=!t.textureHalfFloat&&e.getExtension("OES_texture_half_float");return{textureFloat:!t.textureFloat&&!!e.getExtension("OES_texture_float"),textureFloatLinear:!t.textureFloatLinear&&!!e.getExtension("OES_texture_float_linear"),textureHalfFloat:!!r,textureHalfFloatLinear:!t.textureHalfFloatLinear&&!!e.getExtension("OES_texture_half_float_linear"),HALF_FLOAT:r?r.HALF_FLOAT_OES:void 0}}return null}function yCt(e,t){if(ia(e)){const r=!t.colorBufferHalfFloat&&e.getExtension("EXT_color_buffer_half_float")||!t.colorBufferFloat&&e.getExtension("EXT_color_buffer_float"),i=!t.colorBufferFloat&&e.getExtension("EXT_color_buffer_float"),n=!t.floatBlend&&!t.colorBufferFloat&&e.getExtension("EXT_float_blend");return r||i||n?{textureFloat:!!i,textureHalfFloat:!!r,floatBlend:!!n,R16F:e.R16F,RG16F:e.RG16F,RGBA16F:e.RGBA16F,R32F:e.R32F,RG32F:e.RG32F,RGBA32F:e.RGBA32F,R11F_G11F_B10F:e.R11F_G11F_B10F,RGB16F:e.RGB16F}:null}if(e instanceof WebGLRenderingContext){const r=!t.colorBufferHalfFloat&&e.getExtension("EXT_color_buffer_half_float"),i=!t.colorBufferFloat&&e.getExtension("WEBGL_color_buffer_float"),n=!t.floatBlend&&!t.colorBufferFloat&&e.getExtension("EXT_float_blend");return r||i||n?{textureFloat:!!i,textureHalfFloat:!!r,floatBlend:!!n,RGBA16F:r?r.RGBA16F_EXT:void 0,RGB16F:r?r.RGB16F_EXT:void 0,RGBA32F:i?i.RGBA32F_EXT:void 0}:null}return null}function H8(e,t,r,i,n){if(i&&ia(e))return!0;if(t[r])return!1;for(const s of n)if(e.getExtension(s))return!0;return!1}function bCt(e,t){if(!ia(e)||t.textureNorm16)return null;const r=e.getExtension("EXT_texture_norm16");return r?{R16:r.R16_EXT,RG16:r.RG16_EXT,RGB16:r.RGB16_EXT,RGBA16:r.RGBA16_EXT,R16_SNORM:r.R16_SNORM_EXT,RG16_SNORM:r.RG16_SNORM_EXT,RGB16_SNORM:r.RGB16_SNORM_EXT,RGBA16_SNORM:r.RGBA16_SNORM_EXT}:null}function vCt(e,t){const r=t.loseContext&&e.getExtension("WEBGL_lose_context");return r?{loseRenderingContext:()=>r.loseContext()}:null}function _Ct(e,t){if(ia(e))return{createVertexArray:e.createVertexArray.bind(e),deleteVertexArray:e.deleteVertexArray.bind(e),bindVertexArray:e.bindVertexArray.bind(e)};if(t.vao)return null;const r=e.getExtension("OES_vertex_array_object")||e.getExtension("MOZ_OES_vertex_array_object")||e.getExtension("WEBKIT_OES_vertex_array_object");return r?{createVertexArray:r.createVertexArrayOES.bind(r),deleteVertexArray:r.deleteVertexArrayOES.bind(r),bindVertexArray:r.bindVertexArrayOES.bind(r)}:null}class wCt{constructor(t,r){this.gl=t,this._depthTexture=null,this._standardDerivatives=null,this._shaderTextureLOD=null,this._fragDepth=null,this._textureFloatLinear=null,this._disabledExtensions=r.disabledExtensions||{},this._debugWebGLExtensions=r.debugWebGLExtensions||{}}get drawBuffers(){return this._drawBuffers||(this._drawBuffers=dCt(this.gl,this._disabledExtensions)),this._drawBuffers}get instancing(){return this._instancing||(this._instancing=uCt(this.gl)),this._instancing}get vao(){return this._vertexArrayObject||(this._vertexArrayObject=_Ct(this.gl,this._disabledExtensions)),this._vertexArrayObject}get compressedTextureETC(){return this._compressedTextureETC||(this._compressedTextureETC=hCt(this.gl,this._disabledExtensions)),this._compressedTextureETC}get compressedTextureS3TC(){return this._compressedTextureS3TC||(this._compressedTextureS3TC=fCt(this.gl,this._disabledExtensions)),this._compressedTextureS3TC}get textureFilterAnisotropic(){return this._textureFilterAnisotropic||(this._textureFilterAnisotropic=mCt(this.gl,this._disabledExtensions)),this._textureFilterAnisotropic}get disjointTimerQuery(){return this._disjointTimerQuery||(this._disjointTimerQuery=cCt(this.gl,this._disabledExtensions)),this._disjointTimerQuery}get textureFloat(){return this._textureFloat||(this._textureFloat=gCt(this.gl,this._disabledExtensions)),this._textureFloat}get colorBufferFloat(){return this._colorBufferFloat||(this._colorBufferFloat=yCt(this.gl,this._disabledExtensions)),this._colorBufferFloat}get blendMinMax(){return this._minMaxBlending||(this._minMaxBlending=pCt(this.gl,this._disabledExtensions)),this._minMaxBlending}get depthTexture(){return this._depthTexture===null&&(this._depthTexture=H8(this.gl,this._disabledExtensions,"depthTexture",!0,["WEBGL_depth_texture","MOZ_WEBGL_depth_texture","WEBKIT_WEBGL_depth_texture"])),this._depthTexture}get standardDerivatives(){return this._standardDerivatives===null&&(this._standardDerivatives=H8(this.gl,this._disabledExtensions,"standardDerivatives",!0,["OES_standard_derivatives"])),this._standardDerivatives}get shaderTextureLOD(){return this._shaderTextureLOD===null&&(this._shaderTextureLOD=H8(this.gl,this._disabledExtensions,"shaderTextureLOD",!0,["EXT_shader_texture_lod"])),this._shaderTextureLOD}get fragDepth(){return this._fragDepth===null&&(this._fragDepth=H8(this.gl,this._disabledExtensions,"fragDepth",!0,["EXT_frag_depth"])),this._fragDepth}get loseContext(){return this._loseContext||(this._loseContext=vCt(this.gl,this._debugWebGLExtensions)),this._loseContext}get textureNorm16(){return this._textureNorm16||(this._textureNorm16=bCt(this.gl,this._disabledExtensions)),this._textureNorm16}get textureFloatLinear(){return this._textureFloatLinear===null&&(this._textureFloatLinear=H8(this.gl,this._disabledExtensions,"textureFloatLinear",!1,["OES_texture_float_linear"])),this._textureFloatLinear}enable(t){return this[t]}}class xCt{constructor(t,r){this.gl=t,this.instanceCounter=new IEt,this.programCache=new rCt(this),this._state=new Fbe,this._numOfDrawCalls=0,this._numOfTriangles=0,this.type=ia(t)?yr.WEBGL2:yr.WEBGL1,this._loadExtensions(),this.configure(r)}configure(t){this._capabilities=new wCt(this.gl,t),this._parameters=this._loadParameters(t);const r=this.gl.getParameter(this.gl.VIEWPORT);this._state=new Fbe,this._state.viewport={x:r[0],y:r[1],width:r[2],height:r[3]},this._stateTracker=new ult({setBlending:i=>{if(i){this.setBlendingEnabled(!0),this.setBlendEquationSeparate(i.opRgb,i.opAlpha),this.setBlendFunctionSeparate(i.srcRgb,i.dstRgb,i.srcAlpha,i.dstAlpha);const n=i.color;this.setBlendColor(n.r,n.g,n.b,n.a)}else this.setBlendingEnabled(!1)},setCulling:i=>{i?(this.setFaceCullingEnabled(!0),this.setCullFace(i.face),this.setFrontFace(i.mode)):this.setFaceCullingEnabled(!1)},setPolygonOffset:i=>{i?(this.setPolygonOffsetFillEnabled(!0),this.setPolygonOffset(i.factor,i.units)):this.setPolygonOffsetFillEnabled(!1)},setDepthTest:i=>{i?(this.setDepthTestEnabled(!0),this.setDepthFunction(i.func)):this.setDepthTestEnabled(!1)},setStencilTest:i=>{if(i){this.setStencilTestEnabled(!0);const n=i.function;this.setStencilFunction(n.func,n.ref,n.mask);const s=i.operation;this.setStencilOp(s.fail,s.zFail,s.zPass)}else this.setStencilTestEnabled(!1)},setDepthWrite:i=>{i?(this.setDepthWriteEnabled(!0),this.setDepthRange(i.zNear,i.zFar)):this.setDepthWriteEnabled(!1)},setColorWrite:i=>{i?this.setColorMask(i.r,i.g,i.b,i.a):this.setColorMask(!1,!1,!1,!1)},setStencilWrite:i=>{i?this.setStencilWriteMask(i.mask):this.setStencilWriteMask(0)}}),this.enforceState(),this._driverTest=new lCt(this)}get driverTest(){return this._driverTest}get contextAttributes(){return this.gl.getContextAttributes()}get parameters(){return this._parameters}dispose(){this.programCache.dispose(),this.bindVAO(null),this.unbindBuffer(Tt.ARRAY_BUFFER),this.unbindBuffer(Tt.ELEMENT_ARRAY_BUFFER),ia(this.gl)&&(this.unbindBuffer(Tt.UNIFORM_BUFFER),this._state.uniformBufferBindingPoints.length=0,this.unbindBuffer(Tt.PIXEL_PACK_BUFFER),this.unbindBuffer(Tt.PIXEL_UNPACK_BUFFER),this.unbindBuffer(Tt.COPY_READ_BUFFER),this.unbindBuffer(Tt.COPY_WRITE_BUFFER)),this._state.textureUnitMap.length=0,mh()&&this.instanceCounter.printResourceCount()}setPipelineState(t){this._stateTracker.setPipeline(t)}setBlendingEnabled(t){this._state.blend!==t&&(t===!0?this.gl.enable(this.gl.BLEND):this.gl.disable(this.gl.BLEND),this._state.blend=t,this._stateTracker.invalidateBlending())}externalProgramUpdate(){var t;(t=this._state.program)==null||t.stop(),this._state.program=null}externalTextureUnitUpdate(t,r){for(let i=0;i<t.length;++i)this._state.textureUnitMap[t[i]]=null;r>=0&&(this._state.activeTexture=r)}externalVertexArrayObjectUpdate(){const t=this.capabilities.vao;t&&(t.bindVertexArray(null),this._state.vertexArrayObject=null),this._state.vertexBuffer=null,this._state.indexBuffer=null}externalVertexBufferUpdate(){this._state.vertexBuffer=null}externalIndexBufferUpdate(){this._state.indexBuffer=null}setBlendColor(t,r,i,n){t===this._state.blendColor.r&&r===this._state.blendColor.g&&i===this._state.blendColor.b&&n===this._state.blendColor.a||(this.gl.blendColor(t,r,i,n),this._state.blendColor.r=t,this._state.blendColor.g=r,this._state.blendColor.b=i,this._state.blendColor.a=n,this._stateTracker.invalidateBlending())}setBlendFunction(t,r){t===this._state.blendFunction.srcRGB&&r===this._state.blendFunction.dstRGB||(this.gl.blendFunc(t,r),this._state.blendFunction.srcRGB=t,this._state.blendFunction.srcAlpha=t,this._state.blendFunction.dstRGB=r,this._state.blendFunction.dstAlpha=r,this._stateTracker.invalidateBlending())}setBlendFunctionSeparate(t,r,i,n){this._state.blendFunction.srcRGB===t&&this._state.blendFunction.srcAlpha===i&&this._state.blendFunction.dstRGB===r&&this._state.blendFunction.dstAlpha===n||(this.gl.blendFuncSeparate(t,r,i,n),this._state.blendFunction.srcRGB=t,this._state.blendFunction.srcAlpha=i,this._state.blendFunction.dstRGB=r,this._state.blendFunction.dstAlpha=n,this._stateTracker.invalidateBlending())}setBlendEquation(t){this._state.blendEquation.mode!==t&&(this.gl.blendEquation(t),this._state.blendEquation.mode=t,this._state.blendEquation.modeAlpha=t,this._stateTracker.invalidateBlending())}setBlendEquationSeparate(t,r){this._state.blendEquation.mode===t&&this._state.blendEquation.modeAlpha===r||(this.gl.blendEquationSeparate(t,r),this._state.blendEquation.mode=t,this._state.blendEquation.modeAlpha=r,this._stateTracker.invalidateBlending())}setColorMask(t,r,i,n){this._state.colorMask.r===t&&this._state.colorMask.g===r&&this._state.colorMask.b===i&&this._state.colorMask.a===n||(this.gl.colorMask(t,r,i,n),this._state.colorMask.r=t,this._state.colorMask.g=r,this._state.colorMask.b=i,this._state.colorMask.a=n,this._stateTracker.invalidateColorWrite())}setClearColor(t,r,i,n){this._state.clearColor.r===t&&this._state.clearColor.g===r&&this._state.clearColor.b===i&&this._state.clearColor.a===n||(this.gl.clearColor(t,r,i,n),this._state.clearColor.r=t,this._state.clearColor.g=r,this._state.clearColor.b=i,this._state.clearColor.a=n)}setFaceCullingEnabled(t){this._state.faceCulling!==t&&(t===!0?this.gl.enable(this.gl.CULL_FACE):this.gl.disable(this.gl.CULL_FACE),this._state.faceCulling=t,this._stateTracker.invalidateCulling())}setPolygonOffsetFillEnabled(t){this._state.polygonOffsetFill!==t&&(t===!0?this.gl.enable(this.gl.POLYGON_OFFSET_FILL):this.gl.disable(this.gl.POLYGON_OFFSET_FILL),this._state.polygonOffsetFill=t,this._stateTracker.invalidatePolygonOffset())}setPolygonOffset(t,r){this._state.polygonOffset[0]===t&&this._state.polygonOffset[1]===r||(this._state.polygonOffset[0]=t,this._state.polygonOffset[1]=r,this.gl.polygonOffset(t,r),this._stateTracker.invalidatePolygonOffset())}setCullFace(t){this._state.cullFace!==t&&(this.gl.cullFace(t),this._state.cullFace=t,this._stateTracker.invalidateCulling())}setFrontFace(t){this._state.frontFace!==t&&(this.gl.frontFace(t),this._state.frontFace=t,this._stateTracker.invalidateCulling())}setScissorTestEnabled(t){this._state.scissorTest!==t&&(t===!0?this.gl.enable(this.gl.SCISSOR_TEST):this.gl.disable(this.gl.SCISSOR_TEST),this._state.scissorTest=t)}setScissorRect(t,r,i,n){this._state.scissorRect.x===t&&this._state.scissorRect.y===r&&this._state.scissorRect.width===i&&this._state.scissorRect.height===n||(this.gl.scissor(t,r,i,n),this._state.scissorRect.x=t,this._state.scissorRect.y=r,this._state.scissorRect.width=i,this._state.scissorRect.height=n)}setDepthTestEnabled(t){this._state.depthTest!==t&&(t===!0?this.gl.enable(this.gl.DEPTH_TEST):this.gl.disable(this.gl.DEPTH_TEST),this._state.depthTest=t,this._stateTracker.invalidateDepthTest())}setClearDepth(t){this._state.clearDepth!==t&&(this.gl.clearDepth(t),this._state.clearDepth=t)}setDepthFunction(t){this._state.depthFunction!==t&&(this.gl.depthFunc(t),this._state.depthFunction=t,this._stateTracker.invalidateDepthTest())}setDepthWriteEnabled(t){this._state.depthWrite!==t&&(this.gl.depthMask(t),this._state.depthWrite=t,this._stateTracker.invalidateDepthWrite())}setDepthRange(t,r){this._state.depthRange.zNear===t&&this._state.depthRange.zFar===r||(this.gl.depthRange(t,r),this._state.depthRange.zNear=t,this._state.depthRange.zFar=r,this._stateTracker.invalidateDepthWrite())}setStencilTestEnabled(t){this._state.stencilTest!==t&&(t===!0?this.gl.enable(this.gl.STENCIL_TEST):this.gl.disable(this.gl.STENCIL_TEST),this._state.stencilTest=t,this._stateTracker.invalidateStencilTest())}setClearStencil(t){t!==this._state.clearStencil&&(this.gl.clearStencil(t),this._state.clearStencil=t)}setStencilFunction(t,r,i){this._state.stencilFunction.func===t&&this._state.stencilFunction.ref===r&&this._state.stencilFunction.mask===i||(this.gl.stencilFunc(t,r,i),this._state.stencilFunction.face=bp.FRONT_AND_BACK,this._state.stencilFunction.func=t,this._state.stencilFunction.ref=r,this._state.stencilFunction.mask=i,this._stateTracker.invalidateStencilTest())}setStencilFunctionSeparate(t,r,i,n){this._state.stencilFunction.face===t&&this._state.stencilFunction.func===r&&this._state.stencilFunction.ref===i&&this._state.stencilFunction.mask===n||(this.gl.stencilFuncSeparate(t,r,i,n),this._state.stencilFunction.face=t,this._state.stencilFunction.func=r,this._state.stencilFunction.ref=i,this._state.stencilFunction.mask=n,this._stateTracker.invalidateStencilTest())}setStencilWriteMask(t){this._state.stencilWriteMask!==t&&(this.gl.stencilMask(t),this._state.stencilWriteMask=t,this._stateTracker.invalidateStencilWrite())}setStencilOp(t,r,i){this._state.stencilOperation.face===bp.FRONT_AND_BACK&&this._state.stencilOperation.fail===t&&this._state.stencilOperation.zFail===r&&this._state.stencilOperation.zPass===i||(this.gl.stencilOp(t,r,i),this._state.stencilOperation.face=bp.FRONT_AND_BACK,this._state.stencilOperation.fail=t,this._state.stencilOperation.zFail=r,this._state.stencilOperation.zPass=i,this._stateTracker.invalidateStencilTest())}setStencilOpSeparate(t,r,i,n){this._state.stencilOperation.face===t&&this._state.stencilOperation.fail===r&&this._state.stencilOperation.zFail===i&&this._state.stencilOperation.zPass===n||(this.gl.stencilOpSeparate(t,r,i,n),this._state.stencilOperation.face=t,this._state.stencilOperation.fail=r,this._state.stencilOperation.zFail=i,this._state.stencilOperation.zPass=n,this._stateTracker.invalidateStencilTest())}setActiveTexture(t,r=!1){const i=this._state.activeTexture;return t>=0&&(r||t!==this._state.activeTexture)&&(this.gl.activeTexture(wj+t),this._state.activeTexture=t),i}clear(t){t&&this.gl.clear(t)}clearSafe(t,r=255){t&&(t&ii.COLOR_BUFFER_BIT&&this.setColorMask(!0,!0,!0,!0),t&ii.DEPTH_BUFFER_BIT&&this.setDepthWriteEnabled(!0),t&ii.STENCIL_BUFFER_BIT&&this.setStencilWriteMask(r),this.gl.clear(t))}drawArrays(t,r,i){if(mh()&&(this._numOfDrawCalls++,this._numOfTriangles+=Kbe(t,i)),this.gl.drawArrays(t,r,i),mh()){const n=mpe(this);n&&console.error("drawArrays:",n)}}drawElements(t,r,i,n){var s;if(mh()&&(this._numOfDrawCalls++,this._numOfTriangles+=Kbe(t,r)),this.gl.drawElements(t,r,i,n),mh()){const a=mpe(this);if(a){const o=this.getBoundVAO(),l=o==null?void 0:o.indexBuffer,c=o==null?void 0:o.vertexBuffers,u={indexBuffer:l,vertexBuffers:c},h={mode:t,count:r,type:i,offset:n},p=(s=ys(l,b=>b.size))!=null?s:0,m=n+r,g=p<m?`. Buffer is too small. Attempted to draw index ${m} of ${p}`:"";console.error(`drawElements: ${a}${g}`,{args:h,vao:u})}}}logInfo(){mh()&&console.log(`DrawCalls: ${this._numOfDrawCalls}, Triangles: ${this._numOfTriangles}`)}resetInfo(){mh()&&(this._numOfDrawCalls=0,this._numOfTriangles=0)}get capabilities(){return this._capabilities}setViewport(t,r,i,n){i=Math.max(Math.round(i),1),n=Math.max(Math.round(n),1);const s=this._state.viewport;s.x===t&&s.y===r&&s.width===i&&s.height===n||(s.x=t,s.y=r,s.width=i,s.height=n,this.gl.viewport(t,r,i,n))}getViewport(){return{x:this._state.viewport.x,y:this._state.viewport.y,width:this._state.viewport.width,height:this._state.viewport.height}}useProgram(t){var r,i;this._state.program!==t&&((r=this._state.program)==null||r.stop(),this._state.program=t,this.gl.useProgram((i=t==null?void 0:t.glName)!=null?i:null))}bindTexture(t,r,i=!1){(r>=this.parameters.maxTextureImageUnits||r<0)&&console.error("Input texture unit is out of range of available units!");const n=this._state.textureUnitMap[r];return R(t)||t.glName==null?(_(n)&&(this.setActiveTexture(r,i),this.gl.bindTexture(n.descriptor.target,null)),this._state.textureUnitMap[r]=null,n):i||n!==t?(this.setActiveTexture(r,i),this.gl.bindTexture(t.descriptor.target,t.glName),t.applyChanges(),this._state.textureUnitMap[r]=t,n):(t.isDirty&&(this.setActiveTexture(r,i),t.applyChanges()),n)}unbindTexture(t){if(!R(t))for(let r=0;r<this.parameters.maxTextureImageUnits;r++)this._state.textureUnitMap[r]===t&&(this.bindTexture(null,r),this._state.textureUnitMap[r]=null)}bindFramebuffer(t,r=!1){if(r||this._state.readFramebuffer!==t||this._state.drawFramebuffer!==t){if(R(t))return this.gl.bindFramebuffer(ea.FRAMEBUFFER,null),this._state.readFramebuffer=null,void(this._state.drawFramebuffer=null);t.initializeAndBind(ea.FRAMEBUFFER),this._state.readFramebuffer=t,this._state.drawFramebuffer=t}}bindFramebufferSeparate(t,r,i=!1){const n=r===ea.READ_FRAMEBUFFER,s=n?this._state.readFramebuffer:this._state.drawFramebuffer;(i||s!==t)&&(R(t)?this.gl.bindFramebuffer(r,null):t.initializeAndBind(r),n?this._state.readFramebuffer=vt(t,null):this._state.drawFramebuffer=vt(t,null))}blitFramebuffer(t,r,i=0,n=0,s=t.width,a=t.height,o=0,l=0,c=r.width,u=r.height,h=ii.COLOR_BUFFER_BIT,p=tt.NEAREST){this.bindFramebufferSeparate(t,ea.READ_FRAMEBUFFER),this.bindFramebufferSeparate(r,ea.DRAW_FRAMEBUFFER),this.gl.blitFramebuffer(i,n,s,a,o,l,c,u,h,p)}bindBuffer(t,r){if(t)switch(r!=null||(r=t.bufferType),r){case Tt.ARRAY_BUFFER:this._state.vertexBuffer=Cc(this.gl,t,r,this._state.vertexBuffer);break;case Tt.ELEMENT_ARRAY_BUFFER:this._state.indexBuffer=Cc(this.gl,t,r,this._state.indexBuffer);break;case Tt.UNIFORM_BUFFER:this._state.uniformBuffer=Cc(this.gl,t,r,this._state.uniformBuffer);break;case Tt.PIXEL_PACK_BUFFER:this._state.pixelPackBuffer=Cc(this.gl,t,r,this._state.pixelPackBuffer);break;case Tt.PIXEL_UNPACK_BUFFER:this._state.pixelUnpackBuffer=Cc(this.gl,t,r,this._state.pixelUnpackBuffer);break;case Tt.COPY_READ_BUFFER:this._state.copyReadBuffer=Cc(this.gl,t,r,this._state.copyReadBuffer);break;case Tt.COPY_WRITE_BUFFER:this._state.copyWriteBuffer=Cc(this.gl,t,r,this._state.copyWriteBuffer)}}bindRenderbuffer(t){const r=this.gl;t||(r.bindRenderbuffer(r.RENDERBUFFER,null),this._state.renderbuffer=null),this._state.renderbuffer!==t&&(r.bindRenderbuffer(r.RENDERBUFFER,t.glName),this._state.renderbuffer=t)}_getBufferBinding(t,r){if(r>=this.parameters.maxUniformBufferBindings||r<0)return console.error("Uniform buffer binding point is out of range!"),null;const i=this._state.uniformBufferBindingPoints;let n=i[r];return R(n)&&(n={buffer:null,offset:0,size:0},i[r]=n),n}bindBufferBase(t,r,i){const n=this._getBufferBinding(t,r);R(n)||n.buffer===i&&n.offset===0&&n.size===0||(this.gl.bindBufferBase(t,r,i?i.glName:null),n.buffer=i,n.offset=0,n.size=0)}bindBufferRange(t,r,i,n,s){const a=this._getBufferBinding(t,r);if(!R(a)&&!(a.buffer===i&&a.offset===n&&a.size===s)){if(n%this._parameters.uniformBufferOffsetAlignment!=0)return void console.error("Uniform buffer binding offset is not a multiple of the context offset alignment");this.gl.bindBufferRange(t,r,i.glName,n,s),a.buffer=i,a.offset=n,a.size=s}}bindUBO(t,r,i,n){R(r)?this.bindBufferBase(Tt.UNIFORM_BUFFER,t,null):(mh()&&(n!=null?n:r.byteLength)>this._parameters.maxUniformBlockSize&&console.error("Attempting to bind more data than the maximum uniform block size"),r.initialize(),i!==void 0&&n!==void 0?this.bindBufferRange(Tt.UNIFORM_BUFFER,t,r.buffer,i,n):this.bindBufferBase(Tt.UNIFORM_BUFFER,t,r.buffer))}unbindUBO(t){for(let r=0,i=this._state.uniformBufferBindingPoints.length;r<i;r++){const n=this._state.uniformBufferBindingPoints[r];_(n)&&n.buffer===t.buffer&&this.bindBufferBase(Tt.UNIFORM_BUFFER,r,null)}}unbindBuffer(t){switch(t){case Tt.ARRAY_BUFFER:this._state.vertexBuffer=Cc(this.gl,null,t,this._state.vertexBuffer);break;case Tt.ELEMENT_ARRAY_BUFFER:this._state.indexBuffer=Cc(this.gl,null,t,this._state.indexBuffer);break;case Tt.UNIFORM_BUFFER:this._state.uniformBuffer=Cc(this.gl,null,t,this._state.uniformBuffer);break;case Tt.PIXEL_PACK_BUFFER:this._state.pixelPackBuffer=Cc(this.gl,null,t,this._state.pixelPackBuffer);break;case Tt.PIXEL_UNPACK_BUFFER:this._state.pixelUnpackBuffer=Cc(this.gl,null,t,this._state.pixelUnpackBuffer);break;case Tt.COPY_READ_BUFFER:this._state.copyReadBuffer=Cc(this.gl,null,t,this._state.copyReadBuffer);break;case Tt.COPY_WRITE_BUFFER:this._state.copyWriteBuffer=Cc(this.gl,null,t,this._state.copyWriteBuffer)}}bindVAO(t=null){R(t)?this._state.vertexArrayObject&&(this._state.vertexArrayObject.unbind(),this._state.vertexArrayObject=null):this._state.vertexArrayObject!==t&&(t.bind(),this._state.vertexArrayObject=t)}async clientWaitAsync(t=10){const r=this.gl,i=r.fenceSync(PJ.SYNC_GPU_COMMANDS_COMPLETE,0);let n;this.instanceCounter.increment(ks.Sync,i),r.flush();do await O5(t),n=r.clientWaitSync(i,0,0);while(n===NN.TIMEOUT_EXPIRED);if(this.instanceCounter.decrement(ks.Sync,i),r.deleteSync(i),n===NN.WAIT_FAILED)throw new Error("Client wait failed")}getBoundFramebufferObject(t=ea.FRAMEBUFFER){return t===ea.READ_FRAMEBUFFER?this._state.readFramebuffer:this._state.drawFramebuffer}getBoundVAO(){return this._state.vertexArrayObject}resetState(){this.useProgram(null),this.bindVAO(null),this.bindFramebuffer(null,!0),this.unbindBuffer(Tt.ARRAY_BUFFER),this.unbindBuffer(Tt.ELEMENT_ARRAY_BUFFER),ia(this.gl)&&(this.unbindBuffer(Tt.UNIFORM_BUFFER),this._state.uniformBufferBindingPoints.length=0,this.unbindBuffer(Tt.PIXEL_PACK_BUFFER),this.unbindBuffer(Tt.PIXEL_UNPACK_BUFFER),this.unbindBuffer(Tt.COPY_READ_BUFFER),this.unbindBuffer(Tt.COPY_WRITE_BUFFER));for(let t=0;t<this.parameters.maxTextureImageUnits;++t)this.bindTexture(null,t);this.setBlendingEnabled(!1),this.setBlendFunction(Re.ONE,Re.ZERO),this.setBlendEquation(Dy.ADD),this.setBlendColor(0,0,0,0),this.setFaceCullingEnabled(!1),this.setCullFace(bp.BACK),this.setFrontFace(f9.CCW),this.setPolygonOffsetFillEnabled(!1),this.setPolygonOffset(0,0),this.setScissorTestEnabled(!1),this.setScissorRect(0,0,this.gl.canvas.width,this.gl.canvas.height),this.setDepthTestEnabled(!1),this.setDepthFunction(vi.LESS),this.setDepthRange(0,1),this.setStencilTestEnabled(!1),this.setStencilFunction(vi.ALWAYS,0,0),this.setStencilOp(fn.KEEP,fn.KEEP,fn.KEEP),this.setClearColor(0,0,0,0),this.setClearDepth(1),this.setClearStencil(0),this.setColorMask(!0,!0,!0,!0),this.setStencilWriteMask(4294967295),this.setDepthWriteEnabled(!0),this.setViewport(0,0,this.gl.canvas.width,this.gl.canvas.height)}enforceState(){var i,n,s,a,o,l;const t=this.gl,r=this.capabilities.vao;r&&r.bindVertexArray(null);for(let c=0;c<this.parameters.maxVertexAttributes;c++)t.disableVertexAttribArray(c);if(this._state.vertexBuffer?t.bindBuffer(this._state.vertexBuffer.bufferType,this._state.vertexBuffer.glName):t.bindBuffer(Tt.ARRAY_BUFFER,null),this._state.indexBuffer?t.bindBuffer(this._state.indexBuffer.bufferType,this._state.indexBuffer.glName):t.bindBuffer(Tt.ELEMENT_ARRAY_BUFFER,null),ia(t)){this._state.uniformBuffer?t.bindBuffer(this._state.uniformBuffer.bufferType,this._state.uniformBuffer.glName):t.bindBuffer(Tt.UNIFORM_BUFFER,null);for(let c=0;c<this._parameters.maxUniformBufferBindings;c++){const u=this._state.uniformBufferBindingPoints[c];if(_(u)){const{buffer:h,offset:p,size:m}=u;h!==null?p===0&&m===0?t.bindBufferBase(Tt.UNIFORM_BUFFER,c,h.glName):t.bindBufferRange(Tt.UNIFORM_BUFFER,c,h.glName,p,m):t.bindBufferBase(Tt.UNIFORM_BUFFER,c,null)}}this._state.pixelPackBuffer?t.bindBuffer(this._state.pixelPackBuffer.bufferType,this._state.pixelPackBuffer.glName):t.bindBuffer(Tt.PIXEL_PACK_BUFFER,null),this._state.pixelUnpackBuffer?t.bindBuffer(this._state.pixelUnpackBuffer.bufferType,this._state.pixelUnpackBuffer.glName):t.bindBuffer(Tt.PIXEL_UNPACK_BUFFER,null),this._state.copyReadBuffer?t.bindBuffer(this._state.copyReadBuffer.bufferType,this._state.copyReadBuffer.glName):t.bindBuffer(Tt.COPY_READ_BUFFER,null),this._state.copyWriteBuffer?t.bindBuffer(this._state.copyWriteBuffer.bufferType,this._state.copyWriteBuffer.glName):t.bindBuffer(Tt.COPY_WRITE_BUFFER,null),t.bindFramebuffer(ea.READ_FRAMEBUFFER,null),t.readBuffer(t.BACK),this._state.readFramebuffer&&(t.bindFramebuffer(ea.READ_FRAMEBUFFER,this._state.readFramebuffer.glName),t.readBuffer(Hd.COLOR_ATTACHMENT0)),t.bindFramebuffer(ea.DRAW_FRAMEBUFFER,(n=(i=this._state.drawFramebuffer)==null?void 0:i.glName)!=null?n:null)}else this._state.readFramebuffer=this._state.drawFramebuffer,t.bindFramebuffer(ea.FRAMEBUFFER,(a=(s=this._state.drawFramebuffer)==null?void 0:s.glName)!=null?a:null);if(r&&this._state.vertexArrayObject){const c=this._state.vertexArrayObject;this._state.vertexArrayObject&&(this._state.vertexArrayObject.unbind(),this._state.vertexArrayObject=null),this.bindVAO(c)}t.useProgram((l=(o=this._state.program)==null?void 0:o.glName)!=null?l:null),t.blendColor(this._state.blendColor.r,this._state.blendColor.g,this._state.blendColor.b,this._state.blendColor.a),t.bindRenderbuffer(t.RENDERBUFFER,this._state.renderbuffer?this._state.renderbuffer.glName:null),this._state.blend===!0?t.enable(this.gl.BLEND):t.disable(this.gl.BLEND),t.blendEquationSeparate(this._state.blendEquation.mode,this._state.blendEquation.modeAlpha),t.blendFuncSeparate(this._state.blendFunction.srcRGB,this._state.blendFunction.dstRGB,this._state.blendFunction.srcAlpha,this._state.blendFunction.dstAlpha),t.clearColor(this._state.clearColor.r,this._state.clearColor.g,this._state.clearColor.b,this._state.clearColor.a),t.clearDepth(this._state.clearDepth),t.clearStencil(this._state.clearStencil),t.colorMask(this._state.colorMask.r,this._state.colorMask.g,this._state.colorMask.b,this._state.colorMask.a),t.cullFace(this._state.cullFace),t.depthFunc(this._state.depthFunction),t.depthRange(this._state.depthRange.zNear,this._state.depthRange.zFar),this._state.depthTest===!0?t.enable(t.DEPTH_TEST):t.disable(t.DEPTH_TEST),t.depthMask(this._state.depthWrite),t.frontFace(this._state.frontFace),t.lineWidth(1),this._state.faceCulling===!0?t.enable(t.CULL_FACE):t.disable(t.CULL_FACE),t.polygonOffset(this._state.polygonOffset[0],this._state.polygonOffset[1]),this._state.polygonOffsetFill===!0?t.enable(t.POLYGON_OFFSET_FILL):t.disable(t.POLYGON_OFFSET_FILL),t.scissor(this._state.scissorRect.x,this._state.scissorRect.y,this._state.scissorRect.width,this._state.scissorRect.height),this._state.scissorTest===!0?t.enable(t.SCISSOR_TEST):t.disable(t.SCISSOR_TEST),t.stencilFunc(this._state.stencilFunction.func,this._state.stencilFunction.ref,this._state.stencilFunction.mask),t.stencilOpSeparate(this._state.stencilOperation.face,this._state.stencilOperation.fail,this._state.stencilOperation.zFail,this._state.stencilOperation.zPass),this._state.stencilTest===!0?t.enable(t.STENCIL_TEST):t.disable(t.STENCIL_TEST),t.stencilMask(this._state.stencilWriteMask);for(let c=0;c<this.parameters.maxTextureImageUnits;c++){t.activeTexture(wj+c),t.bindTexture(mt.TEXTURE_2D,null),t.bindTexture(mt.TEXTURE_CUBE_MAP,null),ia(t)&&(t.bindTexture(mt.TEXTURE_3D,null),t.bindTexture(mt.TEXTURE_2D_ARRAY,null));const u=this._state.textureUnitMap[c];_(u)&&t.bindTexture(u.descriptor.target,u.glName)}t.activeTexture(wj+this._state.activeTexture),t.viewport(this._state.viewport.x,this._state.viewport.y,this._state.viewport.width,this._state.viewport.height),this.resetInfo()}_loadExtensions(){this.type===yr.WEBGL1&&this.gl.getExtension("OES_element_index_uint"),this.gl.getExtension("KHR_parallel_shader_compile")}_loadParameters(t){var o;const r=this.capabilities.textureFilterAnisotropic,i=(o=t.maxAnisotropy)!=null?o:1/0,n=ia(this.gl),s=this.gl,a={versionString:this.gl.getParameter(this.gl.VERSION),maxVertexTextureImageUnits:this.gl.getParameter(this.gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS),maxVertexAttributes:this.gl.getParameter(this.gl.MAX_VERTEX_ATTRIBS),maxMaxAnisotropy:r?Math.min(this.gl.getParameter(r.MAX_TEXTURE_MAX_ANISOTROPY),i):1,maxTextureImageUnits:this.gl.getParameter(this.gl.MAX_TEXTURE_IMAGE_UNITS),maxTextureSize:this.gl.getParameter(this.gl.MAX_TEXTURE_SIZE),maxUniformBufferBindings:n?s.getParameter(s.MAX_UNIFORM_BUFFER_BINDINGS):0,maxVertexUniformBlocks:n?s.getParameter(s.MAX_VERTEX_UNIFORM_BLOCKS):0,maxFragmentUniformBlocks:n?s.getParameter(s.MAX_FRAGMENT_UNIFORM_BLOCKS):0,maxUniformBlockSize:n?s.getParameter(s.MAX_UNIFORM_BLOCK_SIZE):0,uniformBufferOffsetAlignment:n?s.getParameter(s.UNIFORM_BUFFER_OFFSET_ALIGNMENT):1,maxArrayTextureLayers:n?s.getParameter(s.MAX_ARRAY_TEXTURE_LAYERS):1,maxSamples:n?s.getParameter(s.MAX_SAMPLES):1};return at.TEXTURE_UNIT_FOR_UPDATES=a.maxTextureImageUnits-1,a}}function Cc(e,t,r,i){return t?i!==t&&e.bindBuffer(r,t.glName):e.bindBuffer(r,null),t}function Kbe(e,t){switch(e){case Dt.POINTS:return 2*t;case Dt.TRIANGLES:return t/3;case Dt.TRIANGLE_STRIP:case Dt.TRIANGLE_FAN:return t-2;default:return 0}}class TCt extends xCt{constructor(t,r,i){super(t,r),this.newCache=i,this._refCount=1}dispose(){--this._refCount>0||super.dispose()}ref(){++this._refCount}bindTechnique(t,r,i,n){this.useProgram(t.program);const s=_(i)?i.slot:null;return t.bindPipelineState(this,s,n),_(r)&&_(i)&&t.bindPass(r,i),t.program}get test(){return this.programCache.test}}const SPe=fe.getLogger("esri.views.3d.webgl-engine.lib.TextureRepository");let NS=class extends xe{constructor(e,t,r){super({}),this._stage=e,this._techniqueRepository=t,this._rctx=r,this._textures=new Map,this._loadingCount=0,this._frameUpdates=new Map,this.events=new mn,this._frameTask=e.resourceController.scheduler.registerTask(bt.TEXTURE_UNLOAD)}normalizeCtorArgs(){return{}}dispose(){this._frameTask.remove(),this._stage.forEachOfType(Np.Texture,e=>e.unload())}get updating(){return this._loadingCount>0||this._frameTask.updating}get textureTechnique(){return R(this._textureTechnique)&&(this._textureTechnique=this._techniqueRepository.acquire(FO,new vae)),this._textureTechnique}acquire(e){const t=this._textures.get(e);return t?(t.ref(),vt(t.loadingPromise,t)):this._createNewRef(e)}update(){let e=!1;this._frameUpdates.forEach(t=>{const r=t.texture.frameUpdate(this._rctx,this.textureTechnique,t.previousToken);r>=0&&r!==t.previousToken&&(t.previousToken=r,e=!0)}),e&&this.events.emit("changed",Xn.BACKGROUND)}_createNewRef(e){const t=this._stage.getObject(e);if(R(t))return pt(t!==void 0),null;const r=t.events.on("unloaded",()=>{r.remove(),this._onTextureUnloaded(e)}),i=new SCt(e,()=>{this._frameTask.schedule(()=>{i.isUnreferenced&&t.unload()})});return this._textures.set(e,i),i.ref(),_(t.glTexture)?(this._updateGLTexture(i,t.glTexture),t.requiresFrameUpdates&&this._frameUpdates.set(e,{texture:t,previousToken:-1}),i):(this._loadingCount++,i.loadingPromise=this._stage.schedule(()=>{const n=t.load(this._rctx,()=>this.textureTechnique),s=o=>(this._loadingCount--,i.loadingPromise=null,this._updateGLTexture(i,o),t.requiresFrameUpdates&&this._frameUpdates.set(e,{texture:t,previousToken:-1}),i),a=o=>(this._loadingCount--,i.loadingPromise=null,Ui(o)||SPe.error(o),null);return $u(n)?n.then(s,a):s(n)}),i.loadingPromise)}_updateGLTexture(e,t){e.glTexture=t,this.events.emit("changed",Xn.UPDATE)}_onTextureUnloaded(e){this._textures.delete(e),this._frameUpdates.delete(e)}};d([f()],NS.prototype,"_loadingCount",void 0),d([f()],NS.prototype,"_frameTask",void 0),d([f()],NS.prototype,"updating",null),NS=d([$("esri.views.3d.webgl-engine.lib.TextureRepository")],NS);class SCt{constructor(t,r){this.id=t,this._release=r,this._refCount=0}get isUnreferenced(){return this._refCount===0}ref(){++this._refCount}release(){--this._refCount,this._refCount>0||(this._refCount!==0?(SPe.error("Cannot dereference texture that has no references!"),this._refCount=0):this._release())}}const ECt=fe.getLogger("esri.views.3d.webgl-engine.materials.internal.waterMaterialUtils");let bC=class extends xe{constructor(){super(...arguments),this._data=new Array,this._state=qc.NOT_LOADED}dispose(){this._state=qc.NOT_LOADED,this._data.forEach(e=>e.dispose()),this._data.length=0}get updating(){return this._state===qc.LOADING}get resourceState(){return this._state}loadTextures(e){const t=[xr("esri/images/materials/water/normals.jpg"),xr("esri/images/materials/water/perturbation.jpg")];this._state=qc.LOADING,Promise.all(t.map(r=>Dp(r))).then(r=>{r.forEach(i=>this._data.push(new at(e,{target:mt.TEXTURE_2D,pixelFormat:Ue.RGBA,dataType:At.UNSIGNED_BYTE,wrapMode:xt.REPEAT,samplingMode:tt.LINEAR_MIPMAP_LINEAR,hasMipmap:!0,maxAnisotropy:8,width:i.width,height:i.height},i))),this._state=qc.LOADED}).catch(r=>{ECt.error("Failed to load textures for water material.",r),this._state=qc.NOT_LOADED})}bind(e){this._state===qc.LOADED&&(e.bindTexture("texWaveNormal",this._data[0]),e.bindTexture("texWavePerturbation",this._data[1]))}};d([f()],bC.prototype,"_state",void 0),d([f({type:Boolean,readOnly:!0})],bC.prototype,"updating",null),bC=d([$("esri.views.3d.webgl-engine.materials.internal.WaterTextureRepository")],bC);class CCt extends cU{constructor(t,r,i,n,s,a){super(),this._rctx=t,this._renderScene=r,this._requestRenderScene=i,this._renderOverlay=n,this._forceCameraHook=s,this._disposeOffscreenBuffers=a,this.supersample=!0,this._screenshotQueue=new Array}dispose(){this._rctx=null}takeScreenshot(t){this._requestRenderScene(Xn.BACKGROUND);const r=Op();return this._screenshotQueue.push({settings:t,resolver:r}),r.promise}update(t){for(const r of this._screenshotQueue){if(this.isDisposed){r.resolver.reject();continue}const i={...r.settings,pixelRatio:r.settings.pixelRatio*t.viewCamera.pixelRatio},n=this._renderScreenshot(t,i);r.resolver(n)}this._screenshotQueue.length=0}_renderScreenshotOverlay(t,r,i){if(R(this._renderOverlay))return r;t.width=r.width,t.height=r.height;const n=t.getContext("2d"),s=i.pixelRatio;return n.save(),n.translate(0,r.height),n.scale(1,-1),i.region&&n.translate(-i.region.x,-i.region.y),n.scale(s,s),r=this._renderOverlay(t,r),n.restore(),r}_readbackScreenshot(t,r){return t.resample?this._readbackScreenshotResampled(t,r):this._readbackScreenshotImmediate(t,r)}_readbackScreenshotResampled(t,r){const{framebufferWidth:i,framebufferHeight:n,region:s,resample:a}=t,o=this._ensureScreenshotEncodeCanvas();let l=$q(i,n,o);this._rctx.gl.readPixels(0,0,i,n,Ue.RGBA,ft.UNSIGNED_BYTE,new Uint8Array(l.data.buffer)),r(),l=this._renderScreenshotOverlay(o,l,{...t,region:null});const c=$q(s.width,s.height,o);return Ovt(l,c,!0,a.region.x,n-(a.region.y+a.region.height),a.region.width,a.region.height)}_readbackScreenshotImmediate(t,r){const{framebufferHeight:i,region:n}=t,s=this._ensureScreenshotEncodeCanvas(),a=$q(n.width,n.height,s);return this._rctx.gl.readPixels(n.x,i-(n.y+n.height),n.width,n.height,Ue.RGBA,ft.UNSIGNED_BYTE,new Uint8Array(a.data.buffer)),r(),this._renderScreenshotOverlay(s,a,t)}_renderScreenshot(t,r){let i=null;const n=t.viewCamera,{framebufferWidth:s,framebufferHeight:a}=r;let o=!1;const l=r.disableDecorations&&t.frameHasDecorations,c=s!==n.fullWidth||a!==n.fullHeight,u=r.ignorePadding&&n.pixelRatio!==r.pixelRatio,h=c||l||u;if(h){const g=n.clone();if(r.ignorePadding){const v=BV(g.padding);for(let x=0;x<4;x++)v[x]=Math.round(v[x]/g.pixelRatio*r.pixelRatio);g.padding=v}g.fullWidth=s,g.fullHeight=a,g.pixelRatio=r.pixelRatio;const b=n.fovX-g.fovX,w=n.fovY-g.fovY;b<0&&b<w?g.fovX=n.fovX:w<0&&w<b&&(g.fovY=n.fovY),this._forceCameraHook(g),o=!0,i=new Pi(this._rctx,{width:g.fullWidth,height:g.fullHeight,colorTarget:hn.TEXTURE,depthStencilTarget:Pr.DEPTH_STENCIL_RENDER_BUFFER}),this._renderScene(i,g,r.disableDecorations?Hw.OFF:Hw.ON),this._disposeOffscreenBuffers()}const p=()=>{this._rctx.bindFramebuffer(null),Qe(i)},m=this._readbackScreenshot(r,p);if(p(),h&&!this._rctx.contextAttributes.alpha)for(let g=3;g<m.data.length;g+=4)m.data[g]=255;return o&&this._forceCameraHook(n),m}_ensureScreenshotEncodeCanvas(){return this._screenshotEncodeCanvas||(this._screenshotEncodeCanvas=document.createElement("canvas")),this._screenshotEncodeCanvas}}const e1e=fe.getLogger("esri.views.3d.webgl-engine.parts.View");let Xa=class extends lU(xe){constructor(e){super({}),this.events=new mn,this.waterTextureRepository=new bC,this._magnifierHelper=new FS,this._needsUpdate=!0,this._needsRender=!0,this._idleSuspend=!0,this._needsWaterReflectionUpdate=!1,this._lastAnimationUpdate=0,this._container=e.container,this._viewingMode=e.viewingMode,this._initializeContext(e),re(()=>{var t;return(t=this.waterTextureRepository)==null?void 0:t.updating},()=>this.requestRender(),Ot),this._magnifierHelper.events.on("request-render",()=>this.requestRender()),this._stippleTextureRepository=new RRe(this._rctx),this._shaderTechniqueRepository=new QAe({rctx:this._rctx,viewingMode:e.viewingMode,stippleTextureRepository:this._stippleTextureRepository,waterTextureRepository:this.waterTextureRepository}),this._textureRepository=new NS(e,this._shaderTechniqueRepository,this._rctx),this._textureRepository.events.on("changed",t=>this.requestRender(t)),this._materialRepository=new JAe(this._textureRepository,this._shaderTechniqueRepository,()=>this.requestRender(),()=>this.requestRender()),this._compositingHelper=new V6t(this._rctx,this._shaderTechniqueRepository),this._renderer=new Sg(this._materialRepository,this._textureRepository,this._shaderTechniqueRepository,this._rctx,this._compositingHelper,this._magnifierHelper,t=>this.requestRender(t),(t,r)=>e.schedule(t,r),e),this._screenshotManager=new CCt(this._rctx,(t,r,i)=>this._renderer.render(t,r,r,i),t=>this.requestRender(t),e.options.screenshot.renderOverlay,t=>this.events.emit("force-camera-for-screenshot",t),()=>this._renderer.disposeOffscreenBuffers()),this._registerFrameTask(e)}normalizeCtorArgs(){return{}}dispose(){this._container.contains(this._canvas)&&this._container.removeChild(this._canvas),this._frameTask=Ts(this._frameTask),this._shaderTechniqueRepository=Qe(this._shaderTechniqueRepository),super.dispose(),this._tmpDepthBuffer=null,this._rctx=null}get performanceInfo(){const e=this._rctx.gl;return{renderer:this._renderer.performanceInfo,textureMemory:e.getUsedTextureMemory!==void 0?e.getUsedTextureMemory():void 0,renderbufferMemory:e.getUsedRenderbufferMemory!==void 0?e.getUsedRenderbufferMemory():void 0,VBOMemory:e.getUsedVBOMemory!==void 0?e.getUsedVBOMemory():void 0}}requestRender(e=Xn.UPDATE){e===Xn.UPDATE?this._needsUpdate=!0:this._needsRender=!0}get updating(){return this._needsUpdate||this._needsWaterReflectionUpdate||this._renderer.updating||this._textureRepository.updating||this.waterTextureRepository.updating||this._magnifierHelper.updating}ensureEdgeView(){return this._renderer.ensureEdgeView()}get edgeView(){return this._renderer.edgeView}get textureRepository(){return this._textureRepository}get compositingHelper(){return this._compositingHelper}set magnifier(e){this._magnifierHelper.magnifier=e}updateLightSources(e,t,r){this._renderer.updateLightSources(e,t,r),this.requestRender()}setRenderParameters(e){e.idleSuspend!==void 0&&this._idleSuspend!==!!e.idleSuspend&&(this._idleSuspend=!!e.idleSuspend,this.requestRender()),this._renderer.setRenderParameters(e)}get renderingContext(){return this._rctx}get capabilities(){return this._rctx.capabilities}modify(e){this._renderer.modify(e),e.clear()}get canvas(){return this._canvas}takeScreenshot(e){return this._screenshotManager.takeScreenshot(e)}getAlpha(){return this._rctx.contextAttributes.alpha}get shadowsEnabled(){return this._renderer.shadowsEnabled}readAccumulatedShadow(e){return this._renderer.readAccumulatedShadow(e[0],e[1])}readHUDVisibility(e,t,r,i,n){this._renderer.readHUDVisibility(e,t,r,i,n)}getMinimalDepthForArea(e,t,r,i,n,s=n){const a=i.constrainWindowSize(t,r,n*i.pixelRatio,s*i.pixelRatio),o=this._ensureDepthBuffer(a);this._renderer.readDepthPixels(i,a,o);let l=Number.MAX_VALUE;for(let c=0;c<a[2]*a[3];c++){const u=j6t(4*c,o,i.nearFar);l>u&&u!==i.nearFar[0]&&u!==i.nearFar[1]&&(l=u)}if(_(e)){const c=e.pickDepth(t*i.pixelRatio,r*i.pixelRatio,i);_(c)&&l>c&&c!==i.nearFar[0]&&c!==i.nearFar[1]&&(l=c)}return l===Number.MAX_VALUE?void 0:l}_ensureDepthBuffer(e){const t=4*e[2]*e[3];return(R(this._tmpDepthBuffer)||this._tmpDepthBuffer.byteLength<t)&&(this._tmpDepthBuffer=new Uint8Array(t)),this._tmpDepthBuffer}get renderPlugins(){return this._renderer.renderPlugins}get test(){return{renderer:this._renderer}}get gpuMemoryUsage(){return this._renderer.gpuMemoryUsage}async reloadShaders(){iMe(),await this._shaderTechniqueRepository.reloadAll(),this.requestRender()}get animationTimestep(){return this._renderer.animationTimestep}_registerFrameTask(e){const t=e.state,r={viewCamera:t.camera,frameHasDecorations:!1};let i=!1,n=Xn.BACKGROUND,s=!1;const a={preRender:o=>{i=this.updating,n=this._needsUpdate?Xn.UPDATE:Xn.BACKGROUND,e.processSyncLayers();const l=o.time-this._lastAnimationUpdate;(l>this.animationTimestep||_(this.forcedAnimationTime)||i||this._needsRender)&&(this._renderer.updateAnimation({camera:t.camera,dt:l,forcedTime:this.forcedAnimationTime})&&this.requestRender(Xn.BACKGROUND),this._lastAnimationUpdate=o.time)},render:()=>{if((this._needsUpdate||this._needsRender||!this._idleSuspend||!this._renderer.isCameraFinal||this._needsWaterReflectionUpdate)&&t.camera.fullWidth>0&&t.camera.fullHeight>0){const o=this._needsUpdate&&this._idleSuspend&&this._renderer.isCameraFinal;this._needsRender=!1,this._needsUpdate=!1,this._needsWaterReflectionUpdate=!1,this._renderer.render(null,t.camera,t.contentCamera,Hw.ON),s=!0,o&&this._renderer.hasWaterReflection&&(this.requestRender(Xn.BACKGROUND),this._needsWaterReflectionUpdate=!0)}},update:()=>{r.viewCamera=t.camera,r.frameHasDecorations=this._renderer.hasSlicePlane||this._magnifierHelper.enabled,this._textureRepository.update(),this._screenshotManager.update(r)},finish:()=>{s&&(this._renderer.finish(n),s=!1)}};this._frameTask=Aw(a)}_initializeContext(e){var n;const t=e.options;this._canvas=t.canvas,this._canvas||(this._canvas=document.createElement("canvas")),this._canvas.setAttribute("style","width: 100%; height:100%; display:block;");const r={alpha:t.alpha||!1,premultipliedAlpha:!0,antialias:!1,depth:!0,stencil:t.stencil==null||t.stencil,powerPreference:"high-performance",preserveDrawingBuffer:(n=t.preserveDrawingBuffer)!=null?n:!1},i=hlt("3d",this._canvas,r);if(R(i)){const s=ue("esri-force-webgl");e1e.error(s)}else this._rctx=this._newRenderingContext(i,e),this._loadShaderOnlyExtensions(),!t.alpha&&this._rctx.contextAttributes.alpha&&e1e.error("WebGL context has alpha channel even though no alpha channel was requested"),!this._rctx.contextAttributes.alpha&&ue("safari")>=11&&(this._container.style.backgroundColor="black"),this._container.appendChild(this._canvas)}_newRenderingContext(e,t){const r={disabledExtensions:t.options.deactivatedWebGLExtensions||{},debugWebGLExtensions:t.options.debugWebGLExtensions||{},maxAnisotropy:8},i=(n,s)=>t.resourceController.memoryController.newCache(n,s);return new TCt(e,r,i)}_loadShaderOnlyExtensions(){this._rctx.capabilities.enable("standardDerivatives"),this._rctx.capabilities.enable("shaderTextureLOD"),this._rctx.capabilities.enable("textureFloat")}get componentObjectCollection(){return R(this._componentObjectCollection)&&(this._componentObjectCollection=new D6t(this._renderer.renderPassManager,this._viewingMode)),this._componentObjectCollection}set componentObjectCollection(e){this._componentObjectCollection=e}};d([f({type:Boolean,readOnly:!0})],Xa.prototype,"updating",null),d([Za()],Xa.prototype,"_rctx",void 0),d([Za()],Xa.prototype,"_container",void 0),d([Za()],Xa.prototype,"_canvas",void 0),d([Za()],Xa.prototype,"_stippleTextureRepository",void 0),d([Za(),f()],Xa.prototype,"waterTextureRepository",void 0),d([Za(),f()],Xa.prototype,"_magnifierHelper",void 0),d([Za(),f()],Xa.prototype,"_textureRepository",void 0),d([Za()],Xa.prototype,"_compositingHelper",void 0),d([Za()],Xa.prototype,"_renderer",void 0),d([Za()],Xa.prototype,"_screenshotManager",void 0),d([Za()],Xa.prototype,"componentObjectCollection",null),d([Za()],Xa.prototype,"_componentObjectCollection",void 0),d([f()],Xa.prototype,"_needsUpdate",void 0),d([f()],Xa.prototype,"_needsWaterReflectionUpdate",void 0),Xa=d([$("esri.views.3d.webgl-engine.parts.RenderView")],Xa);var LD;let zl=LD=class extends lU(xe){constructor(e){super(e),this._handles=new Ft,this._model=new AD,this._layers=new Qt,this._changeSet=new uRe,this._layerSyncSet=new Set}initialize(){this._set("renderView",new Xa(this)),this._frameTask=this.resourceController.scheduler.registerTask(bt.STAGE,this),this._handles.add(this._frameTask)}destroy(){nx.pool.prune(0),this._handles.destroy(),this.dispose()}get viewingMode(){return this.state.viewingMode}get updating(){return this._model.dirtySet.dirty||this.renderView.updating||this._frameTask.updating}add(e){this._model.add(e),uk(e)&&(e.attachStage(this),this._addLayer(e)),this.renderView.requestRender()}remove(e){R(e)||(this.renderView.requestRender(),this._model.remove(e),uk(e)&&(this._removeLayer(e),e.detachStage()))}addMany(e){_(e)&&(this._model.addMany(e),this.renderView.requestRender())}removeMany(e){_(e)&&(this._model.removeMany(e),this.renderView.requestRender())}async load(e){R(e)||(Array.isArray(e)||(e=[e]),await Promise.all(e.filter(t=>R(t.glTexture)).map(t=>this.schedule(()=>this._model.has(t)?t.load(this.renderView.renderingContext,()=>this.renderView.textureRepository.textureTechnique):null))))}loadImmediate(e){return e.load(this.renderView.renderingContext,()=>this.renderView.textureRepository.textureTechnique)}forEachOfType(e,t){this._model.forEachOfType(e,t)}handleEvent(e,t){this.destroyed||(this._model.dirtySet[e](t),this.renderView.requestRender())}get running(){return this._model.dirtySet.dirty}runTask(e){this._frameTask.processQueue(e),e.done||this._commit()}_commit(){const e=this._model.dirtySet;LD.DebugSettings.logDirtySet&&console.log("Dirty set: "+e.formatDebugInfo()),e.commit(this._changeSet),LD.DebugSettings.logDirtySet&&(console.log("RGs add: "+this._changeSet.adds.map(t=>t.id)),console.log("RGs remove: "+this._changeSet.removes.map(t=>t.id))),this._layerSyncSet.clear(),this.renderView.modify(this._changeSet),this.renderView.requestRender()}schedule(e,t){return this._frameTask.schedule(e,t)}syncLayer(e){this._layerSyncSet.add(e),this.renderView.requestRender()}processSyncLayers(){const e=this._model.dirtySet;this._layers.forAll(t=>{(this._layerSyncSet.has(t.id)||t.updatePolicy===p9.SYNC)&&(e.commitLayer(t.id,this._changeSet),this._layerSyncSet.delete(t.id))});for(const t of this._layerSyncSet)e.commitLayer(t,this._changeSet);this._layerSyncSet.clear(),this.renderView.modify(this._changeSet)}getObject(e){return this._model.getObject(e)}get layers(){return this._layers}_addLayer(e){this._layers.includes(e)||this._layers.push(e)}_removeLayer(e){this._commit(),this._layers.removeUnordered(e)!=null&&(this._model.dirtySet.getResidentRenderGeometries(e.id,this._changeSet.removes),this.renderView.modify(this._changeSet))}addRenderPlugin(e,t,r){const i=this.renderView.renderPlugins.add(e,t,r),n=()=>{iye(t)&&this.sceneIntersectionHelper.addIntersectionHandler(t)};if($u(i))return i.then(n);n()}removeRenderPlugin(e){iye(e)&&this.sceneIntersectionHelper.removeIntersectionHandler(e),this.renderView.renderPlugins.remove(e)}get performanceInfo(){return{renderView:this.renderView.performanceInfo,model:this._model.getStats()}}get test(){const e=this;return{getCount:t=>e._model.test.content.filter(r=>r.type===t).length,model:e._model}}};zl.DebugSettings={endFrameContentValidation:!1,logDirtySet:!1},d([f({constructOnly:!0})],zl.prototype,"resourceController",void 0),d([f({constructOnly:!0})],zl.prototype,"options",void 0),d([f({constructOnly:!0})],zl.prototype,"state",void 0),d([f({constructOnly:!0})],zl.prototype,"sceneIntersectionHelper",void 0),d([f({readOnly:!0})],zl.prototype,"viewingMode",null),d([f({constructOnly:!0})],zl.prototype,"container",void 0),d([f({constructOnly:!0})],zl.prototype,"renderSR",void 0),d([f({constructOnly:!0})],zl.prototype,"_handles",void 0),d([f({readOnly:!0})],zl.prototype,"updating",null),d([f({constructOnly:!0})],zl.prototype,"_model",void 0),d([Za(),f()],zl.prototype,"renderView",void 0),zl=LD=d([$("esri.views.3d.webgl-engine.Stage")],zl);function EPe(e){return Lm(e)&&e.intersector===Wi.PCL&&!!e.target}function iB(e){return Lm(e)&&e.intersector===Wi.I3S&&!!e.target}function ACt(e){return Lm(e)&&e.intersector===Wi.TERRAIN&&!!e.target}function CPe(e){return Lm(e)&&e.intersector===Wi.OVERLAY&&!!e.target}function coe(e){return Lm(e)&&e.intersector===Wi.LOD&&!!e.target}function t1e(e,t){var r;return Vz(e)||zz(e)?MR(e.target.object.metadata,t):ACt(e)?(r=t.map)==null?void 0:r.ground:EPe(e)||iB(e)||CPe(e)?MR(e.target,t):null}function VDt(e,t){const r=XK(e,t);return _(r)&&r.type==="graphic"?r.graphic:null}function XK(e,t){if(R(e))return null;if(Vz(e)||zz(e))return r1e(e.target.object.metadata,t);if(EPe(e)){const r=e.target.createGraphic();return{type:"graphic",graphic:r,layer:r.layer}}return CPe(e)||coe(e)?r1e(e.target,t):iB(e)?RCt(e.target,t):null}function r1e(e,t){if(R(e)||R(e.graphicUid))return null;const r=MR(e,t);if(R(r))return null;if(r===t.graphics)return R(t.graphicsView)||typeof e.graphicUid!="number"?null:t.graphicsView.getHit(e.graphicUid);const i=t.allLayerViews.find(n=>n.layer===r);return!i||i.suspended||R(e.graphicUid)?null:"getHit"in i?i.getHit(e.graphicUid):null}function RCt(e,t){const r=MR(e,t);if(R(r))return null;const i=t.allLayerViews.find(n=>n.layer===r);return i&&!i.suspended&&"getGraphicFromIntersectorTarget"in i?MCt(i.getGraphicFromIntersectorTarget(e)):null}function OCt(e,t){const r=MR(e,t);if(R(r))return null;const i=t.allLayerViews.find(n=>n.layer===r);return i&&!i.suspended&&"getAABBFromIntersectorTarget"in i?i.getAABBFromIntersectorTarget(e):null}function MCt(e){return _(e)?{type:"graphic",graphic:e,layer:e.layer}:null}function MR(e,t){return R(e.layerUid)?null:_(t.graphicsView)&&e.layerUid===t.graphicsView.processor.layer.id?t.graphics:t.map.findLayerByUid(e.layerUid)}function zDt(e,t){if(Vz(e)||zz(e))return cy(e.target.object.boundingVolumeWorldSpace.bounds);if(coe(e)){STe(f$,e.transformation);const r=Math.max(f$[0],f$[1],f$[2]);return e.target.baseBoundingSphere.radius*r}return iB(e)?ys(OCt(e.target,t),r=>.5*Oxe(r)):null}function UDt(e){return!Vz(e)&&!zz(e)&&(coe(e)?e.target.numLodLevels>1:!!iB(e))}const f$=M();async function PCt(e,t){if(e.type==="2d")return e.hitTest(t);const r=await e.hitTest(t);if(r.results.length===0)return r;const i=r.results[0],n=_(i.distance)?i.distance*(1+ICt):i.distance,s=r.results.findIndex(a=>a.distance>n);return s!==-1&&(r.results=r.results.slice(0,s)),r}const ICt=.05;let DH,FH;function $Ct(e){const t=NEe(e);for(;t.length>1;){const r=i1e(t.shift());if(r.available)return r}return i1e(t.shift())}function i1e(e){switch(e){case yr.WEBGL1:return LCt();case yr.WEBGL2:return DCt()}}function LCt(){return DH||(DH=kCt()),DH}function DCt(){return FH||(FH=VCt()),FH}class APe{constructor(){this.available=!1,this.majorPerformanceCaveat=!1,this.maxTextureSize=0,this.supportsVertexShaderSamplers=!1,this.supportsHighPrecisionFragment=!1,this.supportsElementIndexUint=!1,this.supportsStandardDerivatives=!1,this.supportsInstancedArrays=!1,this.supportsTextureFloat=!1,this.supportsTextureHalfFloat=!1,this.supportsColorBufferFloat=!1,this.supportsColorBufferFloatBlend=!1,this.supportsColorBufferHalfFloat=!1}}class FCt extends APe{constructor(){super(...arguments),this.type=yr.WEBGL1}}class NCt extends APe{constructor(){super(...arguments),this.type=yr.WEBGL2,this.supportsElementIndexUint=!0,this.supportsStandardDerivatives=!0,this.supportsInstancedArrays=!0,this.supportsTextureFloat=!0,this.supportsTextureHalfFloat=!0}}function RPe(e,t){var s;if(e===yr.WEBGL1&&typeof WebGLRenderingContext===void 0||e===yr.WEBGL2&&typeof WebGL2RenderingContext===void 0)return null;const r=document.createElement("canvas");if(!r)return null;let i=kN(r,e,{failIfMajorPerformanceCaveat:!0});if(R(i)&&(i=kN(r,e),_(i)&&(t.majorPerformanceCaveat=!0)),R(i))return i;if(e===yr.WEBGL1){const a=(s=i.getParameter(i.VERSION))==null?void 0:s.match(/^WebGL\s+([\d.]*)/);if(a){const o=parseFloat(a[1]);t.available=o>=.94}}else t.available=!0;t.maxTextureSize=i.getParameter(i.MAX_TEXTURE_SIZE),t.supportsVertexShaderSamplers=i.getParameter(i.MAX_VERTEX_TEXTURE_IMAGE_UNITS)>0;const n=i.getShaderPrecisionFormat(i.FRAGMENT_SHADER,i.HIGH_FLOAT);return n&&(t.supportsHighPrecisionFragment=n.precision>0),i}function kCt(){const e=new FCt,t=RPe(yr.WEBGL1,e);return R(t)||(e.supportsElementIndexUint=t.getExtension("OES_element_index_uint")!==null,e.supportsStandardDerivatives=t.getExtension("OES_standard_derivatives")!==null,e.supportsInstancedArrays=t.getExtension("ANGLE_instanced_arrays")!==null,e.supportsTextureFloat=t.getExtension("OES_texture_float")!==null,e.supportsTextureHalfFloat=t.getExtension("OES_texture_half_float")!==null,e.supportsColorBufferFloat=t.getExtension("WEBGL_color_buffer_float")!==null,e.supportsColorBufferFloatBlend=t.getExtension("EXT_float_blend")!==null,e.supportsColorBufferHalfFloat=t.getExtension("EXT_color_buffer_half_float")!==null),e}function VCt(){const e=new NCt,t=RPe(yr.WEBGL2,e);return R(t)||(e.supportsColorBufferFloat=t.getExtension("EXT_color_buffer_float")!==null,e.supportsColorBufferFloatBlend=t.getExtension("EXT_float_blend")!==null,e.supportsColorBufferHalfFloat=e.supportsColorBufferFloat||t.getExtension("EXT_color_buffer_half_float")!==null),e}function zCt(e){const t=$Ct(e);if(!t.available)return new k("webgl:required","WebGL is required but not supported.");if(e==="3d"&&t.majorPerformanceCaveat)return new k("webgl:major-performance-caveat-detected","Your WebGL implementation doesn't seem to support hardware accelerated rendering. Check your browser settings or if your GPU is in a blocklist.");if(!t.supportsHighPrecisionFragment)return new k("webgl:high-precision-fragment-required","WebGL support for high precision fragment shaders is required but not supported.");if(!t.supportsVertexShaderSamplers)return new k("webgl:vertex-shader-samplers-required","WebGL support for vertex shader samplers is required but not supported.");if(t.type===yr.WEBGL1){if(!t.supportsElementIndexUint)return new k("webgl:element-index-uint-required","WebGL support for uint vertex indices is required but not supported.");if(!t.supportsStandardDerivatives)return new k("webgl:standard-derivatives-required","WebGL support for standard derivatives is required but not supported.");if(!t.supportsInstancedArrays)return new k("webgl:instanced-arrays-required","WebGL support for instanced rendering is required but not supported.")}return null}function UCt(e){return e&&"nodeType"in e}function BCt(e){return e&&typeof e.render=="function"}const n1e={component:"esri-component"};let o3=class extends xe{constructor(){super(...arguments),this.widget=null}destroy(){this.widget&&this.widget.destroy(),this.node=null}get id(){return this.get("widget.id")||this.get("node.id")}set node(e){const t=this._get("node");e!==t&&(e&&e.classList.add(n1e.component),t&&t.classList.remove(n1e.component),this._set("node",e))}castNode(e){return e?typeof e=="string"||UCt(e)?(this._set("widget",null),$V(e)):(BCt(e)&&!e.domNode&&(e.domNode=document.createElement("div")),this._set("widget",e),e.domNode):(this._set("widget",null),null)}};d([f({dependsOn:[]})],o3.prototype,"id",null),d([f()],o3.prototype,"node",null),d([Xt("node")],o3.prototype,"castNode",null),d([f({readOnly:!0})],o3.prototype,"widget",void 0),o3=d([$("esri.views.ui.Component")],o3);const DD=o3,GCt={left:0,top:0,bottom:0,right:0},OPe={bottom:30,top:15,right:15,left:15},NH="manual",$l={ui:"esri-ui",corner:"esri-ui-corner",innerContainer:"esri-ui-inner-container",manualContainer:"esri-ui-manual-container",cornerContainer:"esri-ui-corner-container",topLeft:"esri-ui-top-left",topRight:"esri-ui-top-right",bottomLeft:"esri-ui-bottom-left",bottomRight:"esri-ui-bottom-right"};function jCt(e){return e&&!e._started&&typeof e.postMixInProperties=="function"&&typeof e.buildRendering=="function"&&typeof e.postCreate=="function"&&typeof e.startup=="function"}function kH(e){const t=e,r=typeof t=="object"&&t!==null&&Object.getPrototypeOf(t);return(r===null||r===Object.prototype)&&("component"in t||"index"in t||"position"in t)?e:null}function VH(e,{top:t,bottom:r,left:i,right:n}){e.style.top=t,e.style.bottom=r,e.style.left=i,e.style.right=n}let Eg=class extends mn.EventedAccessor{constructor(e){super(e),this._cornerNameToContainerLookup={},this._positionNameToContainerLookup={},this._components=new Array,this._componentToKey=new Map,this._handles=new Ft,this.view=null,this._applyViewPadding=()=>{const t=this.container;t&&VH(t,this._toPxPosition(this._getViewPadding()))},this._applyUIPadding=()=>{const t=this._innerContainer;t&&VH(t,this._toPxPosition(this.padding))},this._initContainers()}initialize(){this._handles.add([re(()=>{var e;return[(e=this.view)==null?void 0:e.padding,this.container]},this._applyViewPadding,Ot),re(()=>this.padding,this._applyUIPadding,Ot)])}destroy(){this.container=null;for(const e of this._components)e.destroy();this._components.length=0,this._handles.destroy(),this._componentToKey.clear()}set container(e){const t=this._get("container");e!==t&&(e&&(e.classList.add($l.ui),NYe(e),this._attachContainers(e)),t&&(t.classList.remove($l.ui),VH(t,{top:"",bottom:"",left:"",right:""}),aTe(t)),this._set("container",e))}get height(){const e=this.get("view.height")||0;if(e===0)return e;const t=this._getViewPadding(),r=t.top+t.bottom;return Math.max(e-r,0)}get padding(){return this._get("padding")}set padding(e){e?this._override("padding",e):this._clearOverride("padding")}castPadding(e){return typeof e=="number"?{bottom:e,top:e,right:e,left:e}:{...OPe,...e}}get width(){const e=this.get("view.width")||0;if(e===0)return e;const t=this._getViewPadding(),r=t.left+t.right;return Math.max(e-r,0)}add(e,t){let r,i;if(Array.isArray(e))return void e.forEach(s=>this.add(s,t));const n=kH(e);n&&({index:r,position:t,component:e,key:i}=n),t&&typeof t=="object"&&({index:r,key:i,position:t}=t),!e||t&&!this._isValidPosition(t)||this._add(e,t,r,i)}remove(e,t){if(!e)return;if(Array.isArray(e))return e.map(i=>this.remove(i,t));const r=this._find(e);if(r){const i=this._componentToKey;if(i.has(e)&&i.get(e)!==t)return;const n=this._components.indexOf(r);return r.node.parentNode&&r.node.parentNode.removeChild(r.node),this._componentToKey.delete(e),this._components.splice(n,1)[0]}}empty(e){return Array.isArray(e)?e.map(t=>this.empty(t)).reduce((t,r)=>t.concat(r)):(e=e||NH)===NH?Array.prototype.slice.call(this._manualContainer.children).filter(t=>!t.classList.contains($l.corner)).map(t=>this.remove(t)):this._isValidPosition(e)?Array.prototype.slice.call(this._cornerNameToContainerLookup[e].children).map(this.remove,this):null}move(e,t){if(Array.isArray(e)&&e.forEach(s=>this.move(s,t)),!e)return;let r;const i=kH(e)||kH(t);if(i&&(r=i.index,t=i.position,e=i.component||e),t&&!this._isValidPosition(t))return;const n=this.remove(e);n&&this.add(n,{position:t,index:r})}find(e){if(!e)return null;const t=this._findById(e);return t&&(t.widget||t.node)}getPosition(e){for(const t in this._positionNameToContainerLookup)if(this._positionNameToContainerLookup[t].contains(e))return t;return null}_add(e,t,r,i){e instanceof DD||(e=new DD({node:e})),this._place({component:e,position:t,index:r}),this._components.push(e),i&&this._componentToKey.set(e,i)}_find(e){return e?e instanceof DD?this._findByComponent(e):typeof e=="string"?this._findById(e):this._findByNode(e.domNode||e):null}_getViewPadding(){return this.get("view.padding")||GCt}_attachContainers(e){e.appendChild(this._innerContainer),e.appendChild(this._manualContainer)}_initContainers(){const e=document.createElement("div");e.classList.add($l.innerContainer),e.classList.add($l.cornerContainer);const t=document.createElement("div");t.classList.add($l.innerContainer),t.classList.add($l.manualContainer);const r=document.createElement("div");r.classList.add($l.topLeft),r.classList.add($l.corner),e.appendChild(r);const i=document.createElement("div");i.classList.add($l.topRight),i.classList.add($l.corner),e.appendChild(i);const n=document.createElement("div");n.classList.add($l.bottomLeft),n.classList.add($l.corner),e.appendChild(n);const s=document.createElement("div");s.classList.add($l.bottomRight),s.classList.add($l.corner),e.appendChild(s),this._innerContainer=e,this._manualContainer=t;const a=gp();this._cornerNameToContainerLookup={"top-left":r,"top-right":i,"bottom-left":n,"bottom-right":s,"top-leading":a?i:r,"top-trailing":a?r:i,"bottom-leading":a?s:n,"bottom-trailing":a?n:s},this._positionNameToContainerLookup={manual:t,...this._cornerNameToContainerLookup}}_isValidPosition(e){return!!this._positionNameToContainerLookup[e]}_place(e){const t=e.component,r=e.position||NH,i=e.index,n=this._positionNameToContainerLookup[r],s=i>-1;if(jCt(t.widget)&&t.widget.startup(),!s)return void n.appendChild(t.node);const a=Array.prototype.slice.call(n.children);if(i===0)return void(n.firstChild?ode(t.node,n.firstChild):n.appendChild(t.node));i>=a.length?n.appendChild(t.node):ode(t.node,a[i])}_toPxPosition(e){return{top:this._toPxUnit(e.top),left:this._toPxUnit(e.left),right:this._toPxUnit(e.right),bottom:this._toPxUnit(e.bottom)}}_toPxUnit(e){return e===0?"0":e+"px"}_findByComponent(e){let t,r=null;return this._components.some(i=>(t=i===e,t&&(r=i),t)),r}_findById(e){let t,r=null;return this._components.some(i=>(t=i.id===e,t&&(r=i),t)),r}_findByNode(e){let t,r=null;return this._components.some(i=>(t=i.node===e,t&&(r=i),t)),r}};d([f()],Eg.prototype,"container",null),d([f()],Eg.prototype,"height",null),d([f({value:OPe})],Eg.prototype,"padding",null),d([Xt("padding")],Eg.prototype,"castPadding",null),d([f()],Eg.prototype,"view",void 0),d([f()],Eg.prototype,"width",null),Eg=d([$("esri.views.ui.UI")],Eg);const qCt=Eg;function s1e(e,t){return e&&"copyright"in e&&(!t||typeof e.originOf=="function"&&e.originOf("copyright")==="user")}function HCt(e,t){return e.length!==t.length||e.some((r,i)=>r.text!==t[i].text)}function p$(e,t,r){!r||!t||e.find(i=>i.layerView===t&&i.text===r)||e.push({text:r,layerView:t})}function WCt(e){return e.type==="bing-maps"}const zb=[];let kS=class extends N5{constructor(e){super(e),this._clear=()=>{this._fetchedAttributionData.clear(),this._pendingAttributions.clear(),this.handles.remove("suspension"),this.notifyChange("state")},this._pendingAttributions=new Set,this._fetchedAttributionData=new Map,this.items=new lt,this.view=null,this._allLayerViewsChange=t=>{this.handles.remove("suspension");const r=this.get("view.allLayerViews");r&&this.handles.add(r.map(i=>re(()=>{var n;return[i.suspended,(n=i.layer)==null?void 0:n.attributionVisible]},()=>this._updateAttributionItems())),"suspension"),t&&t.removed&&t.removed.forEach(i=>{this._pendingAttributions.delete(i),this._fetchedAttributionData.delete(i)}),this._updateAttributionItems()},this.handles.add([rn(()=>{var t;return(t=this.view)==null?void 0:t.allLayerViews},"change",t=>this._allLayerViewsChange(t),{onListenerAdd:()=>this._allLayerViewsChange(),onListenerRemove:this._clear}),Fa(()=>{var t;return((t=this.view)==null?void 0:t.stationary)===!0},()=>this._updateAttributionItems())])}destroy(){this.view=null,this._fetchedAttributionData.clear(),this._pendingAttributions.clear(),this.items.removeAll()}get state(){return this.get("view.ready")?this._pendingAttributions.size>0?"loading":"ready":"disabled"}_updateAttributionItems(){const e=this.get("view.allLayerViews");zb.length=0,e?(e.forEach(t=>{var n;if(t.suspended||!((n=t.layer)!=null&&n.attributionVisible))return;const r=t.layer;if(s1e(r,"user"))return void p$(zb,t,r.copyright);if(r.hasAttributionData){if(this._fetchedAttributionData.has(t)){const s=this._fetchedAttributionData.get(t);return void(s?p$(zb,t,this._getDynamicAttribution(s,this.view,r)):s1e(r)&&p$(zb,t,r.copyright))}return void this._fetchAttributionData(t)}const i=r.get("portalItem.accessInformation");p$(zb,t,i||r.copyright)}),HCt(this.items,zb)&&(this.items.removeAll(),this.items.addMany(zb)),zb.length=0,this.notifyChange("state")):this._clear()}async _fetchAttributionData(e){if(this._pendingAttributions.has(e))return;this._pendingAttributions.add(e);const t=await Tu(e.layer.fetchAttributionData());if(this._pendingAttributions.has(e)){const r=t.ok?this._createContributionIndex(t.value,WCt(e.layer)):null;this._pendingAttributions.delete(e),this._fetchedAttributionData.set(e,r)}this._updateAttributionItems()}_createContributionIndex(e,t){const r=e.contributors,i={};if(!r)return i;for(let n=0;n<r.length;n++){const s=r[n],a=s.coverageAreas;if(!a)return;for(const o of a){const l=o.bbox,c=o.zoomMin-(t&&o.zoomMin?1:0),u=o.zoomMax-(t&&o.zoomMax?1:0),h={xmin:l[1],ymin:l[0],xmax:l[3],ymax:l[2],spatialReference:Ye.WGS84},p={extent:ly(h),attribution:s.attribution||"",score:o.score!=null?o.score:100,id:n};for(let m=c;m<=u;m++)i[m]=i[m]||[],i[m].push(p)}}return i.maxKey=Math.max.apply(null,Object.keys(i)),i}_getDynamicAttribution(e,t,r){const{extent:i,scale:n}=t;let s=r.tileInfo.scaleToZoom(n);if(s=Math.min(e.maxKey,Math.round(s)),!i||s==null||s<=-1)return"";const a=e[s],o=mx(i.center.clone().normalize(),t.spatialReference),l={};return a?a.filter(c=>{const u=!l[c.id]&&o&&Qte(c.extent,o);return u&&(l[c.id]=!0),u}).sort((c,u)=>u.score-c.score||c.objectId-u.objectId).map(c=>c.attribution).join(", "):""}};d([f({readOnly:!0,type:lt})],kS.prototype,"items",void 0),d([f({readOnly:!0})],kS.prototype,"state",null),d([f()],kS.prototype,"view",void 0),kS=d([$("esri.widgets.Attribution.AttributionViewModel")],kS);const MPe=kS,Ub={base:"esri-attribution esri-widget",poweredBy:"esri-attribution__powered-by",sources:"esri-attribution__sources",open:"esri-attribution--open",sourcesOpen:"esri-attribution__sources--open",link:"esri-attribution__link",widgetIcon:"esri-icon-description",interactive:"esri-interactive"};let Ul=class extends Bs{constructor(e,t){super(e,t),this._isOpen=!1,this._attributionTextOverflowed=!1,this._prevSourceNodeHeight=0,this._resizeObserver=new ResizeObserver(r=>r.forEach(({target:i})=>this._checkSourceTextOverflow(i))),this.iconClass=Ub.widgetIcon,this.itemDelimiter=" | ",this.label=void 0,this.messages=null,this.view=null,this.viewModel=new MPe}initialize(){this.own(rn(()=>{var e;return(e=this.viewModel)==null?void 0:e.items},"change",()=>this.scheduleRender()))}destroy(){var e;(e=this._resizeObserver)==null||e.disconnect()}get _isInteractive(){return this._isOpen||this._attributionTextOverflowed}get attributionText(){return this.viewModel.items.reduce((e,t)=>(e.includes(t.text)||e.push(t.text),e),[]).join(this.itemDelimiter)}render(){const e={[Ub.open]:this._isOpen};return z("div",{bind:this,class:this.classes(Ub.base,e),dir:"ltr",onclick:this._toggleState,onkeydown:this._toggleState},this.renderSourcesNode(),this.renderPoweredBy())}renderPoweredBy(){return z("div",{class:Ub.poweredBy},"Powered by"," ",z("a",{class:Ub.link,href:"http://www.esri.com/",target:"_blank",rel:"noreferrer"},"Esri"))}renderSourcesNode(){const e=this._isOpen,t=this._isInteractive,r=t?"0":"",{attributionText:i}=this,n={[Ub.sourcesOpen]:e,[Ub.interactive]:t};return z("div",{afterCreate:this._afterSourcesNodeCreate,bind:this,class:this.classes(Ub.sources,n),innerHTML:i,tabindex:r})}_afterSourcesNodeCreate(e){this._prevSourceNodeHeight=e.clientWidth,this._resizeObserver.observe(e)}_checkSourceTextOverflow(e){let t=!1;const{clientHeight:r,clientWidth:i,scrollWidth:n}=e,s=n>i,a=this._attributionTextOverflowed!==s;if(this._attributionTextOverflowed=s,a&&(t=!0),this._isOpen){const o=r<this._prevSourceNodeHeight;this._prevSourceNodeHeight=r,o&&(this._isOpen=!1,t=!0)}t&&this.scheduleRender()}_toggleState(){this._isInteractive&&(this._isOpen=!this._isOpen)}};d([f()],Ul.prototype,"_isOpen",void 0),d([f()],Ul.prototype,"_isInteractive",null),d([f()],Ul.prototype,"_attributionTextOverflowed",void 0),d([f()],Ul.prototype,"_prevSourceNodeHeight",void 0),d([f({readOnly:!0,dependsOn:["viewModel.items.length","itemDelimiter"]})],Ul.prototype,"attributionText",null),d([f()],Ul.prototype,"iconClass",void 0),d([f()],Ul.prototype,"itemDelimiter",void 0),d([f({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],Ul.prototype,"label",void 0),d([f(),es("esri/widgets/Attribution/t9n/Attribution")],Ul.prototype,"messages",void 0),d([We("viewModel.view")],Ul.prototype,"view",void 0),d([f({type:MPe})],Ul.prototype,"viewModel",void 0),d([ol()],Ul.prototype,"_toggleState",null),Ul=d([$("esri.widgets.Attribution")],Ul);const XCt=Ul,YCt="esri.widgets.CompassViewModel";let l3=class extends jne(xe){constructor(e){super(e),this._handles=new Ft,this.orientation={x:0,y:0,z:0},this.view=null,this._updateForCamera=this._updateForCamera.bind(this),this._updateForRotation=this._updateForRotation.bind(this),this._updateRotationWatcher=this._updateRotationWatcher.bind(this)}initialize(){this._handles.add(re(()=>this.view,this._updateRotationWatcher,Ot))}destroy(){this._handles=Ts(this._handles),this.view=null}get canShowNorth(){const e=this.get("view.spatialReference");return!(!e||!e.isWebMercator&&!e.isGeographic)}get state(){return this.get("view.ready")?this.canShowNorth?"compass":"rotation":"disabled"}reset(){if(!this.get("view.ready"))return;const e={};this.view.type==="2d"?e.rotation=0:e.heading=0,this.callGoTo({target:e})}_updateForRotation(e){e!=null&&(this.orientation={z:e})}_updateForCamera(e){if(!e)return;const t=-e.heading;this.orientation={x:0,y:0,z:t}}_updateRotationWatcher(e){this._handles.removeAll(),e&&this._handles.add(e.type==="2d"?re(()=>e==null?void 0:e.rotation,this._updateForRotation,Ot):re(()=>e==null?void 0:e.camera,this._updateForCamera,Ot))}};d([f({readOnly:!0})],l3.prototype,"canShowNorth",null),d([f()],l3.prototype,"orientation",void 0),d([f({readOnly:!0})],l3.prototype,"state",null),d([f()],l3.prototype,"view",void 0),l3=d([$(YCt)],l3);const PPe=l3,Bb={base:"esri-compass esri-widget--button esri-widget",text:"esri-icon-font-fallback-text",icon:"esri-compass__icon",rotationIcon:"esri-icon-dial",northIcon:"esri-icon-compass",widgetIcon:"esri-icon-locate-circled",interactive:"esri-interactive",disabled:"esri-disabled"};let R0=class extends Bs{constructor(e,t){super(e,t),this.goToOverride=null,this.iconClass=Bb.widgetIcon,this.label=void 0,this.messages=null,this.view=null,this.viewModel=new PPe}reset(){return this.viewModel.reset()}render(){const{orientation:e,state:t}=this.viewModel,r=t==="disabled",i=(t==="rotation"?"rotation":"compass")=="compass",n=r?-1:0,s={[Bb.disabled]:r,[Bb.interactive]:!r},a={[Bb.northIcon]:i,[Bb.rotationIcon]:!i},{messages:o}=this;return z("div",{bind:this,class:this.classes(Bb.base,s),onclick:this._reset,onkeydown:this._reset,role:"button",tabIndex:n,"aria-label":o.reset,title:o.reset},z("span",{"aria-hidden":"true",class:this.classes(Bb.icon,a),styles:this._toRotationTransform(e)}),z("span",{class:Bb.text},o.reset))}_reset(){this.viewModel.reset()}_toRotationTransform(e){return{transform:`rotateZ(${e.z}deg)`}}};d([We("viewModel.goToOverride")],R0.prototype,"goToOverride",void 0),d([f()],R0.prototype,"iconClass",void 0),d([f({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],R0.prototype,"label",void 0),d([f(),es("esri/widgets/Compass/t9n/Compass")],R0.prototype,"messages",void 0),d([We("viewModel.view")],R0.prototype,"view",void 0),d([f({type:PPe})],R0.prototype,"viewModel",void 0),d([ol()],R0.prototype,"_reset",null),R0=d([$("esri.widgets.Compass")],R0);const IPe=R0;let VS=class extends xe{constructor(e){super(e),this._handles=new Ft,this.navigationMode="pan",this.view=null}initialize(){this._handles.add(Fa(()=>{var e;return(e=this.view)==null?void 0:e.inputManager},()=>this._setNavigationMode()))}destroy(){this._handles.destroy(),this._handles=null,this.view=null}get state(){return this.get("view.ready")&&this.view.type==="3d"?"ready":"disabled"}toggle(){this.state!=="disabled"&&(this.navigationMode=this.navigationMode!=="pan"?"pan":"rotate",this._setNavigationMode())}_setNavigationMode(){this.get("view.inputManager").primaryDragAction=this.navigationMode==="pan"?"pan":"rotate"}};d([f({readOnly:!0})],VS.prototype,"state",null),d([f()],VS.prototype,"navigationMode",void 0),d([f()],VS.prototype,"view",void 0),VS=d([$("esri.widgets.NavigationToggleViewModel")],VS);const $Pe=VS,Qu={base:"esri-navigation-toggle esri-widget",button:"esri-navigation-toggle__button esri-widget--button",activeButton:"esri-navigation-toggle__button--active",panButton:"esri-navigation-toggle__button--pan",rotateButton:"esri-navigation-toggle__button--rotate",isLayoutHorizontal:"esri-navigation-toggle--horizontal",rotationIcon:"esri-icon-rotate",panIcon:"esri-icon-pan",widgetIcon:"esri-icon-pan2",disabled:"esri-disabled"};let O0=class extends Bs{constructor(e,t){super(e,t),this.iconClass=Qu.widgetIcon,this.label=void 0,this.messages=null,this.view=null,this.viewModel=new $Pe}set layout(e){e!=="horizontal"&&(e="vertical"),this._set("layout",e)}toggle(){return this.viewModel.toggle()}render(){const e=this.get("viewModel.state")==="disabled",t=this.get("viewModel.navigationMode")==="pan",r={[Qu.disabled]:e,[Qu.isLayoutHorizontal]:this.layout==="horizontal"},i={[Qu.activeButton]:t},n={[Qu.activeButton]:!t},s=e?-1:0,a=this.messages.toggle;return z("div",{bind:this,class:this.classes(Qu.base,r),onclick:this._toggle,onkeydown:this._toggle,tabIndex:s,"aria-label":a,title:a},z("div",{class:this.classes(Qu.button,Qu.panButton,i)},z("span",{class:Qu.panIcon})),z("div",{class:this.classes(Qu.button,Qu.rotateButton,n)},z("span",{class:Qu.rotationIcon})))}_toggle(){this.toggle()}};d([f()],O0.prototype,"iconClass",void 0),d([f({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],O0.prototype,"label",void 0),d([f({value:"vertical"})],O0.prototype,"layout",null),d([f(),es("esri/widgets/NavigationToggle/t9n/NavigationToggle")],O0.prototype,"messages",void 0),d([We("viewModel.view")],O0.prototype,"view",void 0),d([f({type:$Pe})],O0.prototype,"viewModel",void 0),d([ol()],O0.prototype,"_toggle",null),O0=d([$("esri.widgets.NavigationToggle")],O0);const LPe=O0,W8={button:"esri-widget--button esri-widget",disabled:"esri-disabled",interactive:"esri-interactive",iconText:"esri-icon-font-fallback-text",icon:"esri-icon"};let _1=class extends Bs{constructor(){super(...arguments),this.enabled=!0,this.iconClass="",this.title=""}render(){const e=this.enabled?0:-1,t={[W8.disabled]:!this.enabled,[W8.interactive]:this.enabled},r={[this.iconClass]:!!this.iconClass};return z("div",{bind:this,class:this.classes(W8.button,t),onclick:this._triggerAction,onkeydown:this._triggerAction,role:"button",tabIndex:e,title:this.title},z("span",{"aria-hidden":"true",role:"presentation",class:this.classes(W8.icon,r)}),z("span",{class:W8.iconText},this.title))}_triggerAction(){this.action.call(this)}};d([f()],_1.prototype,"action",void 0),d([f()],_1.prototype,"enabled",void 0),d([f()],_1.prototype,"iconClass",void 0),d([f()],_1.prototype,"title",void 0),d([ol()],_1.prototype,"_triggerAction",null),_1=d([$("esri.widgets.IconButton")],_1);const a1e=_1;let zS=class extends xe{get canZoomIn(){if(!this.get("view.ready"))return!1;const e=this.get("view.animation.target.scale")||this.get("view.scale"),t=this.get("view.constraints.effectiveMaxScale");return t===0||e>t}get canZoomOut(){if(!this.get("view.ready"))return!1;const e=this.get("view.animation.target.scale")||this.get("view.scale"),t=this.get("view.constraints.effectiveMinScale");return t===0||e<t}};d([f({readOnly:!0})],zS.prototype,"canZoomIn",null),d([f({readOnly:!0})],zS.prototype,"canZoomOut",null),d([f()],zS.prototype,"view",void 0),zS=d([$("esri.widgets.Zoom.ZoomConditions2D")],zS);const ZCt=zS;let US=class extends xe{get canZoomIn(){return!!this.get("view.ready")}get canZoomOut(){return!!this.get("view.ready")}};d([f({readOnly:!0})],US.prototype,"canZoomIn",null),d([f({readOnly:!0})],US.prototype,"canZoomOut",null),d([f()],US.prototype,"view",void 0),US=d([$("esri.widgets.Zoom.ZoomConditions3D")],US);const QCt=US;let w1=class extends xe{constructor(e){super(e),this.canZoomIn=!1,this.canZoomOut=!1}destroy(){this.view=null}get state(){return this.get("view.ready")?"ready":"disabled"}set view(e){e?e.type==="2d"?this._zoomConditions=new ZCt({view:e}):e.type==="3d"&&(this._zoomConditions=new QCt({view:e})):this._zoomConditions=null,this._set("view",e)}zoomIn(){if(!this.canZoomIn)return;const e=this.view;e.type==="2d"?e.mapViewNavigation.zoomIn():QW(e.goTo({zoomFactor:2}))}zoomOut(){if(!this.canZoomOut)return;const e=this.view;e.type==="2d"?e.mapViewNavigation.zoomOut():QW(e.goTo({zoomFactor:.5}))}};d([f()],w1.prototype,"_zoomConditions",void 0),d([f({aliasOf:"_zoomConditions.canZoomIn",readOnly:!0})],w1.prototype,"canZoomIn",void 0),d([f({aliasOf:"_zoomConditions.canZoomOut",readOnly:!0})],w1.prototype,"canZoomOut",void 0),d([f({readOnly:!0})],w1.prototype,"state",null),d([f()],w1.prototype,"view",null),w1=d([$("esri.widgets.Zoom.ZoomViewModel")],w1);const DPe=w1,X8={base:"esri-zoom esri-widget",horizontalLayout:"esri-zoom--horizontal",zoomInIcon:"esri-icon-plus",zoomOutIcon:"esri-icon-minus",widgetIcon:"esri-icon-zoom-in-magnifying-glass"};let Cg=class extends Bs{constructor(e,t){super(e,t),this.iconClass=X8.widgetIcon,this.label=void 0,this.messages=null,this.view=null,this.viewModel=new DPe}initialize(){this._zoomInButton=new a1e({action:this.zoomIn.bind(this),iconClass:X8.zoomInIcon}),this._zoomOutButton=new a1e({action:this.zoomOut.bind(this),iconClass:X8.zoomOutIcon})}destroy(){this._zoomInButton.destroy(),this._zoomOutButton.destroy(),this._zoomInButton=null,this._zoomOutButton=null}set layout(e){e!=="horizontal"&&(e="vertical"),this._set("layout",e)}render(){const e=this.viewModel,t={[X8.horizontalLayout]:this.layout==="horizontal"};return this._zoomInButton.enabled=e.state==="ready"&&e.canZoomIn,this._zoomOutButton.enabled=e.state==="ready"&&e.canZoomOut,this._zoomInButton.title=this.messages.zoomIn,this._zoomOutButton.title=this.messages.zoomOut,z("div",{class:this.classes(X8.base,t)},this._zoomInButton.render(),this._zoomOutButton.render())}zoomIn(){return this.viewModel.zoomIn()}zoomOut(){return this.viewModel.zoomOut()}};d([f()],Cg.prototype,"iconClass",void 0),d([f({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],Cg.prototype,"label",void 0),d([f({value:"vertical"})],Cg.prototype,"layout",null),d([f(),es("esri/widgets/Zoom/t9n/Zoom")],Cg.prototype,"messages",void 0),d([We("viewModel.view")],Cg.prototype,"view",void 0),d([f({type:DPe})],Cg.prototype,"viewModel",void 0),Cg=d([$("esri.widgets.Zoom")],Cg);const FPe=Cg,NPe="esri.views.ui.DefaultUI";function JCt(e){return e&&e.view!==void 0}fe.getLogger(NPe);let FD=class extends qCt{constructor(e){super(e),this._defaultPositionLookup={attribution:"manual",compass:"top-left","navigation-toggle":"top-left",zoom:"top-left"},this.components=[]}initialize(){this._handles.add([re(()=>this.components,this._componentsWatcher.bind(this),Ot),re(()=>this.view,this._updateViewAwareWidgets.bind(this),Ot)])}_add(e,t,r,i){if(typeof e=="string"&&this._defaultPositionLookup[e]){if(this._find(e))return;e=this._createComponent(e)}super._add(e,t,r,i)}_removeComponents(e){e.forEach(t=>{const r=this._find(t);r&&(this.remove(r),r.destroy())})}_updateViewAwareWidgets(e){this.components.forEach(t=>{const r=this._find(t),i=r&&r.widget;JCt(i)&&(i.view=e)})}_componentsWatcher(e,t){this._removeComponents(t),this._addComponents(e),this._adjustPadding(e)}_adjustPadding(e){if(!e.includes("attribution")&&!this._isOverridden("padding")){const{top:t}=this.padding;this.padding=t}}_addComponents(e){this.initialized&&e.forEach(t=>this.add(this._createComponent(t),this._defaultPositionLookup[t]))}_createComponent(e){const t=this._createWidget(e);if(t)return new DD({id:e,node:t})}_createWidget(e){return e==="attribution"?this._createAttribution():e==="compass"?this._createCompass():e==="navigation-toggle"?this._createNavigationToggle():e==="zoom"?this._createZoom():void 0}_createAttribution(){return new XCt({view:this.view})}_createCompass(){return new IPe({view:this.view})}_createNavigationToggle(){return new LPe({view:this.view})}_createZoom(){return new FPe({view:this.view})}};d([f()],FD.prototype,"components",void 0),FD=d([$(NPe)],FD);const KCt=FD;let ND=class extends KCt{constructor(e){super(e),this.components=["attribution","zoom","navigation-toggle","compass"]}};d([f()],ND.prototype,"components",void 0),ND=d([$("esri.views.ui.3d.DefaultUI3D")],ND);const kPe=ND,Md=fe.getLogger("esri.views.SceneView");let nt=class extends hHe(sat(_at(Wat))){constructor(e){super(e),this._userClippingArea=null,this._clippingArea=null,this._initialDefaultSpatialReference=null,this._defaults={},this._externallySet={environment:!1},this._createGraphicsViewController=null,this._resolveWhenReady=[],this.propertiesPool=new Ly({slicePlane:ASe},this),this._resourceController=rTt(this),this._defaultToMapOptions={include:new Set},this._defaultHitTestOptions={exclude:new Set},this.deconflictor=new rK({view:this}),this.labeler=new K2({view:this,deconflictor:this.deconflictor.labels}),this.sharedSymbolResources=null,this.analyses=new i9,this.basemapTerrain=null,this.elevationProvider=null,this.camera=null,this.canvas=null,this.center=null,this.constraints=new C3,this.environmentManager=new Nf,this.extent=null,this.floors=new lt,this.fullOpacity=1,this.graphicsView=null,this.analysisViewManager=new Zat({view:this}),this.groundView=null,this.navigating=!1,this.map=null,this.screenSizePerspectiveEnabled=!0,this.state=new Xwt,this.scale=null,this.spatialReference=null,this.alphaCompositingEnabled=!1,this.preserveDrawingBufferEnabled=!1,this.supersampleScreenshotsEnabled=!0,this.type="3d",this.ui=new kPe,this._numUpdating=0,this._lastUpdateTime=0,this.updatingProgress=.5,this.viewpoint=null,this.zoom=null,this.highlightOptions=new _K,this.voxelWasm=null,this.voxelWasmPromise=null,MGe(),e&&e.environment||(this._defaults.environment=new RS,this.environment=this._defaults.environment);const t=(r=null)=>{_(r)&&r.type===Jr.MOVE||(this._updatingChanged(),this.map&&this.map.allLayers.forEach(async i=>{try{await i.when()}catch{}this._updatingChanged()}))};this.handles.add([rn(()=>{var r;return(r=this.map)==null?void 0:r.allLayers},"after-changes",r=>t(r),{onListenerAdd:()=>t(),onListenerRemove:()=>t(),sync:!0}),this.allLayerViews.on("after-changes",r=>this._updateUpdatingMonitors(r)),re(()=>this.map,r=>{r&&"load"in r&&r.load&&r.load().catch(()=>{})})]),this.inputManager=new s0t({view:this}),this.stateManager=new _xt({view:this})}initialize(){this.groundView=new vat({view:this}),this._updateUpdatingMonitors();const e=()=>this._updateDefaultToMapOptions();this.handles.add(rn(()=>{var t;return(t=this.map)==null?void 0:t.allLayers},"after-changes",e,{onListenerAdd:e,onListenerRemove:e})),this.updatingHandles.add(()=>this.qualitySettings.memoryLimit,t=>{this.resourceController&&(this.resourceController.memoryController.maxMemory=t)},Ot),this.updatingHandles.add(()=>this.qualitySettings.additionalCacheMemory,t=>{this.resourceController&&(this.resourceController.memoryController.additionalCacheMemory=t)},Ot),this.updatingHandles.add(()=>this.qualitySettings.frameRate,t=>LFe(t>0?1e3/Math.ceil(t):0),Ot),this.updatingHandles.add(()=>{var t;return(t=this.map)==null?void 0:t.ground},e,Yn),this.updatingHandles.add(()=>{var t,r;return(r=(t=this.map)==null?void 0:t.ground)==null?void 0:r.opacity},()=>this._updateDefaultHitTestOptions(),Yn),this.handles.add(re(()=>this.spatialReference,()=>this.notifyChange("clippingArea"),ti))}destroy(){this.destroyed||(this.invalidate(),this.activeTool=null,this.layerViewManager.clear(),this._exitSurface(),this._disposeGraphicsView(),this.sharedSymbolResources=ct(this.sharedSymbolResources),this.labeler.destroy(),this._set("labeler",null),this.deconflictor.destroy(),this._set("deconflictor",null),this._resourceController=ct(this._resourceController),this.stateManager.destroy(),this._set("stateManager",null),this.inputManager.destroy(),this._set("inputManager",null),this.propertiesPool.destroy(),this.handles.remove("updatingMonitors"),this.environmentManager.destroy(),this._set("environmentManager",null),this.groundView=ct(this.groundView))}get renderSpatialReference(){return this.renderCoordsHelper&&this.renderCoordsHelper.spatialReference}get basemapSpatialReference(){var e;return(e=this.basemapTerrain)==null?void 0:e.spatialReference}installContentCameraReset(e={sticky:!1}){return this.stateManager.installContentCameraReset(e)}get clippingArea(){if(this.viewingMode==="global")return null;let e=this._userClippingArea||this.get("map.clippingArea");return!(!!this._userClippingArea||this.get("map.clippingEnabled"))||R(e)?(this._clippingArea=null,null):e instanceof Zt?this.spatialReference&&(e=m$(e,this.spatialReference),R(e))?(Md.error("#clippingArea","setting clippingArea with incompatible SpatialReference"),this._clippingArea):(e=e.clone(),R(e.intersection(this.groundAndLayersExtent))&&(e.xmin=e.xmax,e.ymin=e.ymax),e.zmin=void 0,e.zmax=void 0,e.equals(this._clippingArea)||(this._clippingArea=e),this._clippingArea):(Md.error("#clippingArea","only clippingArea geometries of type Extent are supported"),this._clippingArea)}set clippingArea(e){this.ready&&this.viewingMode==="global"&&_(e)?Md.error("#clippingArea=","Clipping area is only supported in local viewingMode"):this._userClippingArea=e}get renderDataExtent(){if(this.state.viewingMode===Be.Global)return null;const e=this.renderSpatialReference,t=this.dataExtent;return R(t)||R(e)||t.spatialReference.equals(e)?t:m$(t,e)}get dataExtent(){let e=this.groundAndLayersExtent;const t=this.spatialReference||Ye.WGS84,r=m$(this.clippingArea,t);_(r)&&(e=_(e)?e.intersection(r):r);const i=this._get("dataExtent");return _(e)&&e.equals(i)?i:e}get groundAndLayersExtent(){const e=this.spatialReference||Ye.WGS84;let t;const r=s=>{const a=m$(s,e);R(a)||(_(t)?t.union(a):t=a.clone())},i=this.basemapTerrain;if(i!=null&&i.spatialReference){const s=i.groundExtent;r(new Zt({xmin:s[0],ymin:s[1],zmin:0,xmax:s[2],ymax:s[3],zmax:0,spatialReference:i.spatialReference}))}if(this.map){const s=a=>{!_(a.fullExtent)||a.type==="graphics"&&a.internal||r(a.fullExtent)};this.map.allLayers.forEach(a=>s(a))}if(R(t))return null;t.hasZ?(t.zmin=Math.min(0,t.zmin),t.zmax=Math.max(0,t.zmax)):(t.zmin=0,t.zmax=0);const n=this._get("groundAndLayersExtent");return t.equals(n)?n:t}set environment(e){e!==this._defaults.environment&&(this._externallySet.environment=!0),this._set("environment",e)}castEnvironment(e){return e?e instanceof RS?e:e instanceof bEe?this.environment!=null?this.environment.cloneWithWebsceneEnvironment(e):RS.fromWebsceneEnvironment(e):rs(RS,e):new RS}get initialExtentRequired(){return this.stateManager&&!this.stateManager.hasInitialView}get _defaultsFromMapSettings(){return{required:{tileInfo:!1,heightModelInfo:!0,extent:!1}}}get interacting(){return this.navigating||_(this.activeTool)}get stationary(){return!this.animation&&!this.resizing&&(R(this.state)||this.state.stationary)}set qualityProfile(e){vD.isValidProfile(e)&&(vD.apply(e,this.qualitySettings),this._set("qualityProfile",e))}get qualityProfile(){return this._get("qualityProfile")||vD.getDefaultProfile()}set slicePlane(e){if(_(this._stage)&&this._stage.renderView.setRenderParameters({slicePlane:e}),R(e))return void this._set("slicePlane",null);const t=this.propertiesPool.get("slicePlane");Ax(e,t),this._set("slicePlane",t)}get typeSpecificPreconditionsReady(){return!!this.viewingMode}get resolution(){return this.spatialReference!=null?BSe(this.scale,this.spatialReference):0}get heightModelInfo(){const e=this.getDefaultHeightModelInfo();return e!=null?Ex.deriveUnitFromSR(e,this.spatialReference):null}get updating(){var i,n,s;if(this.destroyed)return!1;let e=0,t=this.layerViewManager.updating,r=t?this.layerViewManager.updatingRemaining:0;this.allLayerViews.forEach(a=>{if(a.isFulfilled()){if(a.updating){if(t=!0,a.suspended||wR(a))return;++r,e+=a.updatingProgress}}else++r});for(const a of[this.graphicsView,this.basemapView,this._resourceController,this._stage,this.featureTiles,this.pointsOfInterest,this.environmentManager,this.overlay,this.featureTreeDebugger,this.toolViewManager,this.analysisViewManager])_(a)&&a.updating&&(r+=.1,e+=.5*.1);for(const a of[this.deconflictor,this.labeler,this.basemapTerrain])_(a)&&a.updating&&(++r,e+=a.updatingProgress);if(t=!!(t||r>0||this.updatingHandles.updating||!this.ready||!this.stationary||this._createGraphicsViewController||((i=this.inputManager)==null?void 0:i.hasPendingInputs)||((s=(n=this.map)==null?void 0:n.allLayers)==null?void 0:s.some(a=>!a.isFulfilled()))),t?(this._numUpdating=Math.max(r,this._numUpdating),e+=this._numUpdating-r):this._numUpdating=0,this._numUpdating>0?e/=this._numUpdating:e=t?0:1,this._get("updatingProgress")!==e){const a=performance.now();if(e<1){const o=Math.min((a-this._lastUpdateTime)/2e3,1);e=this.updatingProgress*(1-o)+e*o}this._set("updatingProgress",e),this._lastUpdateTime=t&&e<1?a:0}return t}get viewingMode(){var r;const e=this._predeterminedViewingMode;if(_(e))return l7(e);const t=this.spatialReference;return t?_((r=this.defaultsFromMap)==null?void 0:r.viewingMode)&&t.equals(this.defaultsFromMap.spatialReference)?l7(this.defaultsFromMap.viewingMode):sR(t,Be.Global)?"global":"local":"global"}set viewingMode(e){this.ready?Md.error("#viewingMode","viewingMode cannot be set once view is ready"):e?this._override("viewingMode",e):e===void 0&&this._clearOverride("viewingMode")}get resourceController(){return this._resourceController}get performanceInfo(){return new STt(this)}forceAnimationTime(e){this._stage.renderView.forcedAnimationTime=this.basemapTerrain.overlayManager.forcedAnimationTime=e}on(e,t,r,i){return this.viewEvents.on(e,t,r,i)||super.on(e,t)}hasEventListener(e){return super.hasEventListener(e)||this.viewEvents.hasHandler(e)}toMap(e,t){if(!this.ready)return Md.error("#toMap()","Scene view cannot be used before it is ready"),null;const r=t?this.externalToInternalIntersectOptions(t):this._defaultToMapOptions,i=_(r.graphics)&&(_(r.graphics.include)||_(r.graphics.exclude)),n=Wfe(e)?Hfe(this,e):e,s=qg(n);r.enableDraped=r.include&&!r.include.has(op)||r.exclude&&r.exclude.has(op);const a=this.sceneIntersectionHelper,o=tf(this.state.viewingMode);if(o.options.selectionMode=!0,o.options.store=i?Da.ALL:Da.MIN,a.intersectIntersectorScreen(s,o,r),i){for(const l of o.results.all){const c=XK(l,this);if(R(c))return this._intersectResultToMapPoint(l);if(c.type!=="graphic"||this._testGraphicUidFilter(r.graphics,c.graphic))return this._intersectResultToMapPoint(l)}return null}return this._intersectResultToMapPoint(o.results.min)}toScreen(e){if(!this.ready)return Md.error("#toScreen()","Scene view cannot be used before it is ready"),null;const t=vt(e.z==null&&Q0(this.elevationProvider,e),0);return oa(e,kT,this.renderSpatialReference,t),this.state.camera.projectToScreen(kT,zH),Su(zH[0],zH[1])}pixelSizeAt(e){return this.ready?e?(oa(e,kT,this.renderSpatialReference),this.state.camera.computeScreenPixelSizeAt(kT)):0:(Md.error("#pixelSizeAt()","Scene view cannot be used before it is ready"),null)}overlayPixelSizeInMapUnits(e){const t=this.basemapTerrain.overlayManager;return t?t.overlayPixelSizeInMapUnits(e):1}hitTest(e,t){if(!this.ready)return Md.error("#hitTest()","Scene view cannot be used before it is ready"),null;const r=Wfe(e)?Hfe(this,e):e,i=tn(r.x,r.y),n=t?this.externalToInternalIntersectOptions(t):this._defaultHitTestOptions;n.requiresGroundFeedback=!0,n.enableDraped=!0;const s=tf(this.state.viewingMode);s.options.selectionMode=!0,s.options.store=Da.ALL,this.sceneIntersectionHelper.intersectIntersectorScreen(i,s,n);const a=this._intersectResultsToHits(s.results.all,n.graphics),o=s.results.ground,l=t1e(o,this),c=_(l)&&"type"in l&&l.type==="integrated-mesh"?l:null,u={screenPoint:r,results:a,ground:{mapPoint:this._intersectResultToMapPoint(o),distance:Lm(o)?o.distanceInRenderSpace:0,layer:c}};return Yr.SCENEVIEW_HITTEST_RETURN_INTERSECTOR&&(u.intersector=s),Promise.resolve(u)}async popupHitTest(e){const{results:t,ground:r}=await PCt(this,e);let i=null;return!(t.length===0||Math.abs(vt(t[0].distance,0)-r.distance)<1e-5)||r.layer&&r.layer.type==="integrated-mesh"||(i=r.mapPoint),{results:t,screenPoint:e,mapPoint:i}}goTo(e,t){return this.updatingHandles.addPromise(this.stateManager.goTo(e,t))}async whenAnalysisView(e){if(R(e.parent))throw new k("view:no-analysisview-for-analysis","The analysis has not been added to view.analyses",{analysis:e});return e.parent.type==="line-of-sight"?(await this.whenLayerView(e.parent)).whenAnalysisView():this.analysisViewManager.whenAnalysisView(e)}whenLayerView(e){return super.whenLayerView(e)}async takeScreenshot(e){const t=this._completeSettings(e);await this.whenReady();const r=await this._stage.renderView.takeScreenshot(t);return Svt(r,t,this._pixelFormat())}async _takeScreenshot(e){const t=this._completeSettings(e);await this.whenReady();const r=await this._stage.renderView.takeScreenshot(t);return Evt(r,this._pixelFormat())}_completeSettings(e){const t=Tvt(e,this);return t.pixelRatio/=this.state.pixelRatio,Mvt(t,this.supersampleScreenshotsEnabled,this.padding)}_pixelFormat(){return{flipY:!0,premultipliedAlpha:this._stage.renderView.getAlpha()}}get test(){return{takeScreenshot:e=>this._takeScreenshot(e)}}addUpdatingPromise(e){return this.updatingHandles.addPromise(e)}importLayerView(e){return tpe.importLayerView(e)}hasLayerViewModule(e){return tpe.hasLayerViewModule(e)}forceDOMReadyCycle(){this.forceReadyCycle()}getDefaultSpatialReference(){var e,t,r,i;return this.map&&"initialViewProperties"in this.map&&((t=(e=this.map)==null?void 0:e.initialViewProperties)==null?void 0:t.spatialReference)||((r=this.defaultsFromMap)==null?void 0:r.spatialReference)||((i=this.defaultsFromMap)==null?void 0:i.ready)&&this._initialDefaultSpatialReference||null}async validate(){let e=zCt(this.type);if(ue("safari")&&ue("safari")<9&&(e=new k("sceneview:browser-not-supported","This browser is not supported by SceneView (Safari < 9)",{type:"safari",requiredVersion:9,detectedVersion:ue("safari")})),_(e))throw Md.warn("#validate()",e.message),e}get _predeterminedViewingMode(){var t,r;const e=this._isOverridden("viewingMode")?this._get("viewingMode"):(r=this.map&&"initialViewProperties"in this.map?(t=this.map.initialViewProperties)==null?void 0:t.viewingMode:null)!=null?r:null;return _(e)?Jfe(e):null}getSpatialReferenceSupport({spatialReference:e,layer:t}){const r=this._predeterminedViewingMode;if(_(r))return this._validateSpatialReferenceForViewingMode(e,t,r)?{constraints:this._makeSpatialReferenceConstraints(e,t,r)}:null;const i=this._validateSpatialReferenceForViewingMode(e,t,Be.Local),n=this._validateSpatialReferenceForViewingMode(e,t,Be.Global);return i||n?i&&n?{constraints:this._makeSpatialReferenceConstraints(e,t,null)}:i?{constraints:this._makeSpatialReferenceConstraints(e,t,Be.Local)}:{constraints:this._makeSpatialReferenceConstraints(e,t,Be.Global)}:null}_validateSpatialReferenceForViewingMode(e,t,r){return!!sR(e,r)&&(!!R(t)||!!$ce(t)||(!H4(t)||!R(NU(t,e,r)))&&(!Ice(t)||r!==Be.Global))}_makeSpatialReferenceConstraints(e,t,r){if(R(t))return[{spatialReference:e,viewingMode:r}];const i=e.isWebMercator,n=e.isWGS84;return $ce(t)&&(i||n)?!n||r===Be.Local||xR(t.tileInfo,t.fullExtent,e,Be.Global)===null?[{spatialReference:e,viewingMode:r},{spatialReference:Ye.WebMercator,viewingMode:r}]:[{spatialReference:i?Ye.WGS84:Ye.WebMercator,viewingMode:r}]:H4(t)||Ice(t)||!i&&!n?H4(t)&&i&&r!==Be.Global?[{spatialReference:e,viewingMode:r},{spatialReference:Ye.WGS84,viewingMode:Be.Local}]:[{spatialReference:e,viewingMode:r}]:[{spatialReference:e,viewingMode:r},{spatialReference:i?Ye.WGS84:Ye.WebMercator,viewingMode:r}]}_validateSpatialReference(e){const t=_(this.getSpatialReferenceSupport({spatialReference:e})),r=this._predeterminedViewingMode;return t||(_(r)?Md.warnOnce(`Spatial reference defined on view not supported in ${l7(r)} viewing mode.`):e.isGeographic&&Md.warnOnce("Spatial reference is geographic but not supported.")),t}whenReady(){return new Promise(e=>{this.ready?e(this):this._resolveWhenReady.push(e)})}computeMapPointFromVec3d(e,t){let r=this.spatialReference||Ye.WGS84;return Ss(e,this.renderSpatialReference,e,r)||(r=Ye.WGS84,Ss(e,this.renderSpatialReference,e,r)),t?(t.x=e[0],t.y=e[1],t.z=e[2],t.spatialReference=r):t=new ot(e,r),t}trackGraphicState(e){if(!e.graphic)return Md.error("trackGraphicState","GraphicState.graphic must not be null or undefined to start tracking"),null;const t=this.getViewForGraphic(e.graphic);let r=null,i=!1;const n=s=>{var a;!i&&_(s)&&"processor"in s&&((a=s.processor)==null?void 0:a.type)==="graphics-3d"&&s.processor.graphicsCore&&(r=s.processor.graphicsCore.trackGraphicState(e))};return _(t)?n(t):this.whenViewForGraphic(e.graphic,{waitForLayer:!0}).then(s=>n(s),()=>{}).catch(()=>{}),{remove:()=>{i=!0,_(r)&&(r.remove(),r=null)}}}highlight(e){if(Array.isArray(e))return A5(e.map(r=>this.highlight(r)));if(lt.isCollection(e))return A5(e.toArray().map(r=>this.highlight(r)));const t=this.getViewForGraphic(e);return t&&"highlight"in t?t.highlight(e):Hh()}maskOccludee(e){if(!e)return Md.error("maskOccludee","GraphicState.graphic must not be null or undefined to mask an occludee"),null;const t=this.getViewForGraphic(e);let r=null,i=!1;const n=s=>{!i&&_(s)&&Gst(s)&&(r=s.maskOccludee(e))};return _(t)?n(t):this.whenViewForGraphic(e,{waitForLayer:!0}).then(s=>n(s),()=>{}).catch(()=>{}),{remove:()=>{i=!0,_(r)&&(r.remove(),r=null)}}}getViewForGraphic(e){return e.layer===this.graphics?this.graphicsView:e.layer?this.allLayerViews.find(t=>t.layer===e.layer):null}graphicChanged(e){_(this.graphicsView)&&this.graphicsView.graphicChanged(e)}async whenViewForGraphic(e,t){if(e.layer===this)return await td(()=>this.graphicsView),this.graphicsView;if(!e.layer||!this.map)throw new k("no-view-for-graphic");return t&&t.waitForLayer&&!this.map.allLayers.includes(e.layer)?new Promise((r,i)=>{const n=this.map.allLayers.on("change",s=>{s.added.includes(e.layer)&&(n.remove(),this.whenLayerView(e.layer).then(r,i))})}):this.whenLayerView(e.layer)}externalToInternalIntersectOptions(e){const t=this._externalToInternalRenderItems(e.include,M7.INCLUDE),r=this._externalToInternalRenderItems(e.exclude,M7.EXCLUDE);return{include:t.layerUids,exclude:r.layerUids,graphics:{include:t.graphicUids,exclude:r.graphicUids}}}_intersectResultToMapPoint(e,t){return e.getIntersectionPoint(kT)?(t=this.computeMapPointFromVec3d(kT,t),e.intersector===Wi.TERRAIN&&this.basemapTerrain&&(t.z=vt(Q0(this.basemapTerrain,t),0)),t):null}_intersectResultsToHits(e,t){const r=new Array;let i=null;for(let n=0;n<e.length;n++){const s=e[n],a=t1e(s,this);if(_(a)&&(a===this.map.ground||"type"in a&&a.type==="integrated-mesh"))break;const o=XK(s,this);if(R(o))continue;if(o.type==="graphic"){if(R(i)&&n!==e.length-1&&(i=new Set),_(i)){const u=this._getGraphicFilterUid(o.graphic);if(i.has(u))continue;i.add(u)}if(!this._testGraphicUidFilter(t,o.graphic))continue}const l=this._intersectResultToMapPoint(s),c=s.distanceInRenderSpace;r.push({...o,mapPoint:l,distance:c})}return r}_getGraphicFilterUid(e){if(e.layer&&"objectIdField"in e.layer){const t=e.attributes[e.layer.objectIdField];if(t)return`o-${e.layer.id}-${t}`}return`u-${e.uid}`}_testGraphicUidFilter(e,t){const r=this._getGraphicFilterUid(t);return R(e)||(R(e.include)||e.include.has(r))&&(R(e.exclude)||!e.exclude.has(r))}_externalToInternalRenderItems(e,t,r={layerUids:null,graphicUids:null}){if(!e)return r;if(e instanceof co)e7t(r,this._getGraphicFilterUid(e)),t===M7.INCLUDE&&(_(this.graphicsView)&&e.layer===this?Y8(r,this.graphicsView.processor.layer.id):e.layer&&Y8(r,e.layer.uid));else if(f2e(e))for(const i of e)i===this.graphics&&_(this.graphicsView)?Y8(r,this.graphicsView.processor.layer.id):i===this.map.ground?Y8(r,op):this._externalToInternalRenderItems(i,t,r);else"uid"in e&&Y8(r,e.uid);return r}_initBasemapTerrain(){this._set("basemapTerrain",new S5t({view:this})),this._set("elevationProvider",new uC({view:this})),this.elevationProvider.register("ground",this.basemapTerrain)}_exitBasemapTerrain(){this.basemapTerrain&&(this.elevationProvider.unregister(this.basemapTerrain),this.elevationProvider.destroy(),this._set("elevationProvider",null),this.basemapTerrain.destroy(),this._set("basemapTerrain",null))}_initGlobe(){this._initCoordinateSystem(),this.state.createInitialCamera(),this._initBasemapTerrain(),this._set("pointsOfInterest",new To({view:this})),this._set("featureTiles",new wa({renderCoordsHelper:this.renderCoordsHelper,cameraOnSurface:this.pointsOfInterest.contentCameraOnSurface,focus:this.pointsOfInterest.focus,tilingSchemeOwner:this.basemapTerrain,viewState:this.state,scheduler:this._resourceController.scheduler,terrain:this.basemapTerrain}));const e=()=>{var r;const t=(r=this.basemapTerrain)==null?void 0:r.extent;if(this.clippingArea||t)if(t&&this.basemapTerrain.spatialReference){const i=_(this.basemapTerrain.extent)?eO(xV(this.basemapTerrain.extent,this.basemapTerrain.spatialReference),this.spatialReference):null;_(this.clippingArea)?this.featureTiles.filterExtent=this.clippingArea.intersection(i):this.featureTiles.filterExtent=i}else this.featureTiles.filterExtent=this.clippingArea;else this.featureTiles.filterExtent=null};this.handles.add([this.updatingHandles.add(()=>Yr.FEATURE_TILE_TREE_SHOW_TILES,t=>{t&&this.featureTiles&&!this.featureTreeDebugger?this.updatingHandles.addPromise(ie(()=>import("./FeatureTileTree3DDebugger.9abdc765.js"),["FeatureTileTree3DDebugger.9abdc765.js","TileTreeDebugger.88189f1e.js"],import.meta.url)).then(({FeatureTileTree3DDebugger:r})=>{!this.featureTreeDebugger&&Yr.FEATURE_TILE_TREE_SHOW_TILES&&(this.featureTreeDebugger=new r({view:this}))}):t||!this.featureTreeDebugger||Yr.FEATURE_TILE_TREE_SHOW_TILES||(this.featureTreeDebugger.destroy(),this.featureTreeDebugger=null)},Yn),this.updatingHandles.add(()=>this.clippingArea,e,Yn),this.updatingHandles.add(()=>this.basemapTerrain.extent,e,Yn)],"feature-tiles"),this.stateManager.init()}_exitGlobe(){this.state&&(this.stateManager.deinit(),this.handles.remove("render-coords-helper"),this.handles.remove("feature-tiles"),this.featureTiles.destroy(),this._set("featureTiles",null),this.pointsOfInterest.destroy(),this._set("pointsOfInterest",null),this._exitBasemapTerrain(),this.state.exit(),this._exitCoordinateSystem())}_initCoordinateSystem(){if(this.spatialReference){const e=this.spatialReference;this.mapCoordsHelper&&this.mapCoordsHelper.spatialReference.equals(e)||this._set("mapCoordsHelper",new Uxt(this.map,e));const t=this.state.isGlobal,r=USe(t,e);r!==this.renderSpatialReference&&(this._set("renderCoordsHelper",Ek.create(this.state.viewingMode,r)),t||this.handles.add(re(()=>{var i;return(i=this.basemapTerrain)==null?void 0:i.extent},i=>{const n=this.renderCoordsHelper.spatialReference;i&&(i[0]!==0||i[1]!==0||i[2]!==0||i[3]!==0)&&zV(i,this.basemapTerrain.spatialReference,o1e,n)&&(this.renderCoordsHelper.extent=o1e)},ti),"render-coords-helper"),this.sceneIntersectionHelper&&this.sceneIntersectionHelper.setTolerance(E9/this.renderCoordsHelper.unitInMeters))}else this._set("mapCoordsHelper",null),this._set("renderCoordsHelper",null)}_exitCoordinateSystem(){this.mapCoordsHelper&&(this.handles.remove("render-coords-helper"),this._set("renderCoordsHelper",null),this._set("mapCoordsHelper",null))}_updatingChanged(){this.notifyChange("updating")}_updateUpdatingMonitors(e=null){_(e)&&e.type===Jr.MOVE||(this.handles.remove("updatingMonitors"),this.allLayerViews.forEach(t=>{t.destroyed||(this.handles.add(re(()=>[t.updating,t.updatingProgress],()=>this._updatingChanged(),ti),"updatingMonitors"),t.when(()=>this._updatingChanged(),()=>this._updatingChanged()))}),this._updatingChanged())}_renderScreenshotOverlay(e,t){if(!this.overlay||!this.overlay.hasVisibleItems)return t;const r=e.getContext("2d");return r.putImageData(t,0,0),this.overlay.renderCanvas(e),r.getImageData(0,0,t.width,t.height)}_initStage(){const e={deactivatedWebGLExtensions:this.deactivatedWebGLExtensions,debugWebGLExtensions:this.debugWebGLExtensions,alpha:this.alphaCompositingEnabled,preserveDrawingBuffer:this.preserveDrawingBufferEnabled,canvas:this.renderCanvas,screenshot:{renderOverlay:(o,l)=>this._renderScreenshotOverlay(o,l)}},t=new Ext(this.state.viewingMode,o=>this._stage.layers.forAll(o),this);this._set("sceneIntersectionHelper",t);const r=$V(this.surface),{resourceController:i,state:n,renderSpatialReference:s}=this;this._stage=new zl({options:e,container:r,resourceController:i,state:n,sceneIntersectionHelper:t,renderSR:s}),this._stage.renderView.setRenderParameters({slicePlane:this.slicePlane}),this._lostWebGLContextHandle=jR(this._stage.renderView.canvas,"webglcontextlost",()=>this.fatalError=new k("webgl-context-lost")),this.handles.add([this.updatingHandles.add(()=>this.qualitySettings.antialiasingEnabled,()=>this._stage.renderView.setRenderParameters({antialiasingEnabled:this.qualitySettings.antialiasingEnabled}),Ot),this.updatingHandles.add(()=>this.qualitySettings.highQualityTransparency,()=>this._stage.renderView.setRenderParameters({highQualityTransparency:this.qualitySettings.highQualityTransparency}),Ot),re(()=>this.magnifier,o=>this._stage.renderView.magnifier=o,Yn)],"stage");const a=()=>{this._stage.renderView.setRenderParameters({defaultHighlightOptions:_K.toEngineOptions(this.highlightOptions)})};this.handles.add(this.updatingHandles.add(()=>[this.highlightOptions.color,this.highlightOptions.haloColor,this.highlightOptions.haloOpacity,this.highlightOptions.fillOpacity,this.highlightOptions.shadowOpacity,this.highlightOptions.shadowColor,this.highlightOptions.shadowDifference],a),"stage"),a(),this.renderCoordsHelper&&this.sceneIntersectionHelper.setTolerance(E9/this.renderCoordsHelper.unitInMeters),this._set("canvas",this._stage.renderView.canvas)}_exitStage(){this._set("sceneIntersectionHelper",null),this._stage.destroy(),this._stage=null,this._lostWebGLContextHandle.remove(),this._lostWebGLContextHandle=null,this.handles.remove("stage"),this._set("canvas",null)}_initSurface(e){this._exitSurface(),this.state.init(e,this.spatialReference),this._initStage(),this._initGlobe(),this.sharedSymbolResources=new CTt({view:this,viewingMode:e,resourceController:this._resourceController,pointsOfInterest:this.pointsOfInterest,viewState:this.state,objectResourceCache:new Owt})}_exitSurface(){this.sharedSymbolResources&&(this.sharedSymbolResources.objectResourceCache.destroy(),this.sharedSymbolResources.destroy(),this.sharedSymbolResources=null,this._exitGlobe(),this._exitStage())}_createGraphicsViewIfNeeded(){if(this.graphicsView||this._createGraphicsViewController||this.graphics.length===0)return;this.handles.remove("graphics-view"),this._createGraphicsViewController=new AbortController;const e=()=>{this._createGraphicsViewController=null,this._updatingChanged()};this._createGraphicsViewAsync(this._createGraphicsViewController.signal).then(e,e),this._updatingChanged()}async _createGraphicsViewAsync(e){const t=(await ie(()=>import("./GraphicsView3D.97e53633.js"),["GraphicsView3D.97e53633.js","GraphicsProcessor.54147b4e.js","Graphics3DScaleVisibility.94299010.js","optimizedFeatureQueryEngineAdapter.bfa7c41c.js","centroid.80c9450e.js","PooledRBush.1dfcdd85.js","quickselect.bb286034.js","Graphics3DObjectStates.fe70f60a.js"],import.meta.url)).default;Et(e),await td(()=>{var r;return(r=this.basemapTerrain)==null?void 0:r.ready},e),this._set("graphicsView",new t({view:this}))}_disposeGraphicsView(){this._createGraphicsViewController&&(this._createGraphicsViewController.abort(),this._createGraphicsViewController=null),this.handles.remove("graphics-view"),_(this.graphicsView)&&(this.handles.remove(this.graphicsView.processor.layer.id),this.graphicsView.destroy(),this._set("graphicsView",null))}_startup(){const e=Jfe(this.viewingMode);if(e===Be.Global&&(this._clippingArea=null),this._initSurface(e),this._set("ready",!0),this.handles.add(rn(()=>this.graphics,"after-changes",()=>this._createGraphicsViewIfNeeded()),"graphics-view"),this._createGraphicsViewIfNeeded(),!this._externallySet.environment){const r=this.get("map.initialViewProperties.environment");r&&(this.environment=r)}this.labeler.setup(),this.environmentManager.connectView(this),this.inputManager.connect();const t=this._resolveWhenReady;this._resolveWhenReady=[],t.forEach(r=>r(this))}_teardown(){this._initialDefaultSpatialReference=null,this.inputManager.disconnect(),this.environmentManager.disconnectView(),this.labeler.dispose(),this._disposeGraphicsView(),this.handles.remove("graphics-view"),this._exitSurface(),this._set("ready",!1)}_updateDefaultToMapOptions(){if(this._defaultToMapOptions.include.clear(),this.map){this.map.ground&&this._defaultToMapOptions.include.add(op);for(const e of this.map.allLayers.items)e.type==="integrated-mesh"&&this._defaultToMapOptions.include.add(e.uid)}}_updateDefaultHitTestOptions(){if(this._defaultHitTestOptions.exclude.clear(),this.map){this.map.ground&&this.map.ground.opacity<1&&this._defaultHitTestOptions.exclude.add(op);for(const e of this.map.allLayers.items)e.type==="integrated-mesh"&&e.opacity<1&&this._defaultToMapOptions.exclude.add(e.uid)}}addVoxelLayerViewToWasm(e){return R(this.voxelWasm)?(R(this.voxelWasmPromise)&&(this.voxelWasmPromise=ie(()=>import("./VoxelWasmPerSceneView.77d565b7.js"),[],import.meta.url).then(t=>(this.voxelWasm=new t.default(this),this.voxelWasm))),this.voxelWasmPromise.then(t=>t.addVoxelLayer(e))):this.voxelWasm.addVoxelLayer(e)}removeVoxelLayerViewFromWasm(e){_(this.voxelWasm)&&this.voxelWasm.removeVoxelLayer(e)<1&&(this.voxelWasm=null,this.voxelWasmPromise=null)}};function Y8(e,t){e.layerUids||(e.layerUids=new Set),e.layerUids.add(t)}function e7t(e,t){e.graphicUids||(e.graphicUids=new Set),e.graphicUids.add(t)}function m$(e,t){return _(e)&&mm(e.spatialReference,t)?eO(e,t):null}var M7;nt.type="3d",d([f()],nt.prototype,"_userClippingArea",void 0),d([f()],nt.prototype,"_resourceController",void 0),d([f()],nt.prototype,"_stage",void 0),d([f({readOnly:!0})],nt.prototype,"deconflictor",void 0),d([f({readOnly:!0})],nt.prototype,"labeler",void 0),d([f(WY(i9,"analyses"))],nt.prototype,"analyses",void 0),d([f({type:u9,readOnly:!0,aliasOf:"state.animation"})],nt.prototype,"animation",void 0),d([f({readOnly:!0})],nt.prototype,"basemapTerrain",void 0),d([f({readOnly:!0})],nt.prototype,"elevationProvider",void 0),d([f({type:gd,aliasOf:"stateManager.camera"})],nt.prototype,"camera",void 0),d([f({type:gd,aliasOf:"stateManager.contentCamera"})],nt.prototype,"contentCamera",void 0),d([f({readOnly:!0})],nt.prototype,"canvas",void 0),d([f({type:ot,aliasOf:"stateManager.center"})],nt.prototype,"center",void 0),d([f({type:Zt})],nt.prototype,"clippingArea",null),d([f({type:C3})],nt.prototype,"constraints",void 0),d([f({type:Zt,readOnly:!0})],nt.prototype,"renderDataExtent",null),d([f({type:Zt,readOnly:!0})],nt.prototype,"dataExtent",null),d([f({type:Zt,readOnly:!0})],nt.prototype,"groundAndLayersExtent",null),d([f({value:null,type:RS})],nt.prototype,"environment",null),d([Xt("environment")],nt.prototype,"castEnvironment",null),d([f({readOnly:!0})],nt.prototype,"environmentManager",void 0),d([f({type:Zt,aliasOf:"stateManager.extent"})],nt.prototype,"extent",void 0),d([f()],nt.prototype,"floors",void 0),d([f({readOnly:!0,aliasOf:"stateManager.screenCenter"})],nt.prototype,"screenCenter",void 0),d([f({aliasOf:"stateManager.frustum"})],nt.prototype,"frustum",void 0),d([f({type:Number,readOnly:!0})],nt.prototype,"fullOpacity",void 0),d([f({readOnly:!0})],nt.prototype,"graphicsView",void 0),d([f({readOnly:!0})],nt.prototype,"analysisViewManager",void 0),d([f()],nt.prototype,"groundView",void 0),d([f({type:Boolean})],nt.prototype,"initialExtentRequired",null),d([f()],nt.prototype,"_defaultsFromMapSettings",null),d([f({type:Boolean,readOnly:!0})],nt.prototype,"interacting",null),d([f()],nt.prototype,"stationary",null),d([f({aliasOf:"state.navigating"})],nt.prototype,"navigating",void 0),d([f()],nt.prototype,"map",void 0),d([f({readOnly:!0})],nt.prototype,"mapCoordsHelper",void 0),d([f({aliasOf:"stateManager.padding"})],nt.prototype,"padding",void 0),d([f({type:To,readOnly:!0})],nt.prototype,"pointsOfInterest",void 0),d([f({type:wa,readOnly:!0})],nt.prototype,"featureTiles",void 0),d([f()],nt.prototype,"featureTreeDebugger",void 0),d([f({type:Boolean})],nt.prototype,"screenSizePerspectiveEnabled",void 0),d([f({constructOnly:!0})],nt.prototype,"deactivatedWebGLExtensions",void 0),d([f({constructOnly:!0})],nt.prototype,"debugWebGLExtensions",void 0),d([f({constructOnly:!0})],nt.prototype,"renderCanvas",void 0),d([f({constructOnly:!0})],nt.prototype,"state",void 0),d([f({readOnly:!0})],nt.prototype,"inputManager",void 0),d([f({readOnly:!0})],nt.prototype,"stateManager",void 0),d([f({type:["low","medium","high"]})],nt.prototype,"qualityProfile",null),d([f({type:sye,get(){let e=this._get("qualitySettings");return e||(e=new sye,vD.apply(this.qualityProfile,e)),e}})],nt.prototype,"qualitySettings",void 0),d([f()],nt.prototype,"slicePlane",null),d([f({readOnly:!0})],nt.prototype,"typeSpecificPreconditionsReady",null),d([f({readOnly:!0})],nt.prototype,"renderCoordsHelper",void 0),d([f({readOnly:!0})],nt.prototype,"sceneIntersectionHelper",void 0),d([f({type:Number,dependsOn:["scale","spatialReference"],readOnly:!0})],nt.prototype,"resolution",null),d([f({type:Number,aliasOf:"stateManager.scale"})],nt.prototype,"scale",void 0),d([f()],nt.prototype,"heightModelInfo",null),d([f()],nt.prototype,"spatialReference",void 0),d([f({type:Boolean,constructOnly:!0})],nt.prototype,"alphaCompositingEnabled",void 0),d([f({constructOnly:!0})],nt.prototype,"preserveDrawingBufferEnabled",void 0),d([f({type:Boolean})],nt.prototype,"supersampleScreenshotsEnabled",void 0),d([f({readOnly:!0})],nt.prototype,"type",void 0),d([f({type:kPe})],nt.prototype,"ui",void 0),d([f({type:Boolean,readOnly:!0,dependsOn:["graphicsView.updating","basemapView.updating","basemapTerrain.updating","layerViewManager.updating","layerViewManager.updatingRemaining","_resourceController.updating","_stage.updating","featureTiles.updating","pointsOfInterest.updating","environmentManager.updating","overlay.updating","updatingHandles.updating","featureTreeDebugger.updating","labeler.updating","deconflictor.updating","ready","stationary","inputManager.hasPendingInputs","toolViewManager.updating","analysisViewManager.updating"]})],nt.prototype,"updating",null),d([f({type:Number,readOnly:!0,dependsOn:["updating"]})],nt.prototype,"updatingProgress",void 0),d([f({type:["global","local"]})],nt.prototype,"viewingMode",null),d([f({type:Yh,aliasOf:"stateManager.viewpoint"})],nt.prototype,"viewpoint",void 0),d([f({type:Number,aliasOf:"stateManager.zoom"})],nt.prototype,"zoom",void 0),d([f({type:_K})],nt.prototype,"highlightOptions",void 0),nt=d([$("esri.views.SceneView")],nt),function(e){e[e.INCLUDE=0]="INCLUDE",e[e.EXCLUDE=1]="EXCLUDE"}(M7||(M7={}));const kT=M(),zH=tn(),o1e=zt(),t7t=nt,r7t={supportsStatistics:!0,supportsPercentileStatistics:!0,supportsSpatialAggregationStatistics:!1,supportedSpatialAggregationStatistics:{envelope:!1,centroid:!1,convexHull:!1},supportsCentroid:!0,supportsCacheHint:!1,supportsDistance:!0,supportsDistinct:!0,supportsExtent:!0,supportsGeometryProperties:!1,supportsHavingClause:!0,supportsOrderBy:!0,supportsPagination:!0,supportsQuantization:!0,supportsQuantizationEditMode:!1,supportsQueryGeometry:!0,supportsResultType:!1,supportsSqlExpression:!0,supportsMaxRecordCountFactor:!1,supportsStandardizedQueriesOnly:!0,supportsTopFeaturesQuery:!1,supportsQueryByOthers:!0,supportsHistoricMoment:!1,supportsFormatPBF:!1,supportsDisjointSpatialRelationship:!0,supportsDefaultSpatialReference:!1,supportsCompactGeometry:!1,maxRecordCountFactor:void 0,maxRecordCount:void 0,standardMaxRecordCount:void 0,tileMaxRecordCount:void 0};function BDt(e){return{renderer:{type:"simple",symbol:e==="esriGeometryPoint"||e==="esriGeometryMultipoint"?d8e:e==="esriGeometryPolyline"?u8e:h8e}}}const i7t=/^[_$a-zA-Z][_$a-zA-Z0-9]*$/;let n7t=1;function GDt(e,t){if(ue("esri-csp-restrictions"))return()=>({[t]:null,...e});try{let r=`this.${t} = null;`;for(const n in e)r+=`this${i7t.test(n)?`.${n}`:`["${n}"]`} = ${JSON.stringify(e[n])};`;const i=new Function(`
      return class AttributesClass$${n7t++} {
        constructor() {
          ${r};
        }
      }
    `)();return()=>new i}catch{return()=>({[t]:null,...e})}}function jDt(e={}){return[{name:"New Feature",description:"",prototype:{attributes:te(e)}}]}function s7t(e,t){return{analytics:{supportsCacheHint:!1},attachment:null,data:{isVersioned:!1,supportsAttachment:!1,supportsM:!1,supportsZ:e},metadata:{supportsAdvancedFieldProperties:!1},operations:{supportsCalculate:!1,supportsTruncate:!1,supportsValidateSql:!1,supportsAdd:t,supportsDelete:t,supportsEditing:t,supportsChangeTracking:!1,supportsQuery:!0,supportsQueryAnalytics:!1,supportsQueryAttachments:!1,supportsQueryTopFeatures:!1,supportsResizeAttachments:!1,supportsSync:!1,supportsUpdate:t,supportsExceedsLimitStatistics:!0},query:r7t,queryRelated:{supportsCount:!0,supportsOrderBy:!0,supportsPagination:!0,supportsCacheHint:!1},queryTopFeatures:{supportsCacheHint:!1},editing:{supportsGeometryUpdate:t,supportsGlobalId:!1,supportsReturnServiceEditsInSourceSpatialReference:!1,supportsRollbackOnFailure:!1,supportsUpdateWithoutM:!1,supportsUploadWithItemId:!1,supportsDeleteByAnonymous:!1,supportsDeleteByOthers:!1,supportsUpdateByAnonymous:!1,supportsUpdateByOthers:!1}}}const l1e=fe.getLogger("esri.layers.graphics.sources.GeoJSONSource");let c3=class extends hd{constructor(){super(...arguments),this.type="geojson",this.refresh=qR(async e=>{await this.load();const{extent:t,timeExtent:r}=await this._connection.invoke("refresh",e);return this.sourceJSON.extent=t,r&&(this.sourceJSON.timeInfo.timeExtent=[r.start,r.end]),{dataChanged:!0,updates:{extent:this.sourceJSON.extent,timeInfo:this.sourceJSON.timeInfo}}})}load(e){const t=_(e)?e.signal:null;return this.addResolvingPromise(this._startWorker(t)),Promise.resolve(this)}destroy(){var e;(e=this._connection)==null||e.close(),this._connection=null}applyEdits(e){return this.load().then(()=>this._applyEdits(e))}openPorts(){return this.load().then(()=>this._connection.openPorts())}queryFeatures(e,t={}){return this.load(t).then(()=>this._connection.invoke("queryFeatures",e?e.toJSON():null,t)).then(r=>ym.fromJSON(r))}queryFeaturesJSON(e,t={}){return this.load(t).then(()=>this._connection.invoke("queryFeatures",e?e.toJSON():null,t))}queryFeatureCount(e,t={}){return this.load(t).then(()=>this._connection.invoke("queryFeatureCount",e?e.toJSON():null,t))}queryObjectIds(e,t={}){return this.load(t).then(()=>this._connection.invoke("queryObjectIds",e?e.toJSON():null,t))}queryExtent(e,t={}){return this.load(t).then(()=>this._connection.invoke("queryExtent",e?e.toJSON():null,t)).then(r=>({count:r.count,extent:Zt.fromJSON(r.extent)}))}querySnapping(e,t={}){return this.load(t).then(()=>this._connection.invoke("querySnapping",e,t))}_applyEdits(e){if(!this._connection)throw new k("geojson-layer-source:edit-failure","Memory source not loaded");const t=this.layer.objectIdField,r=[],i=[],n=[];if(e.addFeatures)for(const s of e.addFeatures)r.push(this._serializeFeature(s));if(e.deleteFeatures)for(const s of e.deleteFeatures)"objectId"in s&&s.objectId!=null?i.push(s.objectId):"attributes"in s&&s.attributes[t]!=null&&i.push(s.attributes[t]);if(e.updateFeatures)for(const s of e.updateFeatures)n.push(this._serializeFeature(s));return this._connection.invoke("applyEdits",{adds:r,updates:n,deletes:i}).then(({extent:s,timeExtent:a,featureEditResults:o})=>(this.sourceJSON.extent=s,a&&(this.sourceJSON.timeInfo.timeExtent=[a.start,a.end]),this._createEditsResult(o)))}_createEditsResult(e){return{addFeatureResults:e.addResults?e.addResults.map(this._createFeatureEditResult,this):[],updateFeatureResults:e.updateResults?e.updateResults.map(this._createFeatureEditResult,this):[],deleteFeatureResults:e.deleteResults?e.deleteResults.map(this._createFeatureEditResult,this):[],addAttachmentResults:[],updateAttachmentResults:[],deleteAttachmentResults:[]}}_createFeatureEditResult(e){const t=e.success===!0?null:e.error||{code:void 0,description:void 0};return{objectId:e.objectId,globalId:e.globalId,error:t?new k("geojson-layer-source:edit-failure",t.description,{code:t.code}):null}}_serializeFeature(e){const{attributes:t}=e,r=this._geometryForSerialization(e);return r?{geometry:r.toJSON(),attributes:t}:{attributes:t}}_geometryForSerialization(e){const{geometry:t}=e;return R(t)?null:t.type==="mesh"||t.type==="extent"?$o.fromExtent(t.extent):t}async _startWorker(e){this._connection=await LV("GeoJSONSourceWorker",{strategy:ue("feature-layers-workers")?"dedicated":"local",signal:e});const{fields:t,spatialReference:r,hasZ:i,geometryType:n,objectIdField:s,url:a,timeInfo:o,customParameters:l}=this.layer,c=this.layer.originOf("spatialReference")==="defaults",u={url:a,customParameters:l,fields:t&&t.map(p=>p.toJSON()),geometryType:bV.toJSON(n),hasZ:i,objectIdField:s,timeInfo:o?o.toJSON():null,spatialReference:c?null:r&&r.toJSON()},h=await this._connection.invoke("load",u,{signal:e});for(const p of h.warnings)l1e.warn(p.message,{layer:this.layer,warning:p});h.featureErrors.length&&l1e.warn(`Encountered ${h.featureErrors.length} validation errors while loading features`,h.featureErrors),this.sourceJSON=h.layerDefinition,this.capabilities=s7t(this.sourceJSON.hasZ,!0)}};d([f()],c3.prototype,"capabilities",void 0),d([f()],c3.prototype,"type",void 0),d([f({constructOnly:!0})],c3.prototype,"layer",void 0),d([f()],c3.prototype,"sourceJSON",void 0),c3=d([$("esri.layers.graphics.sources.GeoJSONSource")],c3);const a7t=$ne();let Or=class extends e8e(Z6e(Q6e(Y6e(a8e(Rne(n8e(Ane(vz(U5))))))))){constructor(e){super(e),this.copyright=null,this.definitionExpression=null,this.displayField=null,this.editingEnabled=!1,this.elevationInfo=null,this.featureReduction=null,this.fields=null,this.fieldsIndex=null,this.fullExtent=null,this.geometryType=null,this.hasZ=void 0,this.labelsVisible=!0,this.labelingInfo=null,this.legendEnabled=!0,this.objectIdField=null,this.operationalLayerType="GeoJSON",this.popupEnabled=!0,this.popupTemplate=null,this.screenSizePerspectiveEnabled=!0,this.source=new c3({layer:this}),this.spatialReference=Ye.WGS84,this.templates=null,this.title="GeoJSON",this.type="geojson",this.typeIdField=null,this.types=null}destroy(){var e;(e=this.source)==null||e.destroy()}load(e){return this.addResolvingPromise(this.source.load(e).then(()=>{this.read(this.source.sourceJSON,{origin:"service",url:this.parsedUrl}),this.revert(["objectIdField","fields","timeInfo"],"service"),G5(this.renderer,this.fieldsIndex),Tre(this.timeInfo,this.fieldsIndex)})),Promise.resolve(this)}get capabilities(){return this.source?this.source.capabilities:null}get createQueryVersion(){return this.commitProperty("definitionExpression"),this.commitProperty("timeExtent"),this.commitProperty("timeOffset"),this.commitProperty("geometryType"),this.commitProperty("capabilities"),(this._get("createQueryVersion")||0)+1}get defaultPopupTemplate(){return this.createPopupTemplate()}get isTable(){return this.loaded&&this.geometryType==null}get parsedUrl(){return this.url?pn(this.url):null}set renderer(e){G5(e,this.fieldsIndex),this._set("renderer",e)}set url(e){if(!e)return void this._set("url",e);const t=pn(e);this._set("url",t.path),t.query&&(this.customParameters={...this.customParameters,...t.query})}async applyEdits(e,t){const r=await ie(()=>import("./editingSupport.d59c083d.js"),[],import.meta.url);await this.load();const i=await r.applyEdits(this,this.source,e,t);return this.read({extent:this.source.sourceJSON.extent,timeInfo:this.source.sourceJSON.timeInfo},{origin:"service",ignoreDefaults:!0}),i}on(e,t){return super.on(e,t)}createPopupTemplate(e){return Lne(this,e)}createQuery(){const e=new Zn,t=this.get("capabilities.data");e.returnGeometry=!0,t&&t.supportsZ&&(e.returnZ=!0),e.outFields=["*"],e.where=this.definitionExpression||"1=1";const{timeOffset:r,timeExtent:i}=this;return e.timeExtent=r!=null&&i!=null?i.offset(-r.value,r.unit):i||null,e}getFieldDomain(e,t){let r,i=!1;const n=t&&t.feature,s=n&&n.attributes,a=this.typeIdField&&s&&s[this.typeIdField];return a!=null&&this.types&&(i=this.types.some(o=>o.id==a&&(r=o.domains&&o.domains[e],r&&r.type==="inherited"&&(r=this._getLayerDomain(e)),!0))),i||r||(r=this._getLayerDomain(e)),r}getField(e){return this.fieldsIndex.get(e)}queryFeatures(e,t){return this.load().then(()=>this.source.queryFeatures(Zn.from(e)||this.createQuery(),t)).then(r=>{if(r!=null&&r.features)for(const i of r.features)i.layer=i.sourceLayer=this;return r})}queryObjectIds(e,t){return this.load().then(()=>this.source.queryObjectIds(Zn.from(e)||this.createQuery(),t))}queryFeatureCount(e,t){return this.load().then(()=>this.source.queryFeatureCount(Zn.from(e)||this.createQuery(),t))}queryExtent(e,t){return this.load().then(()=>this.source.queryExtent(Zn.from(e)||this.createQuery(),t))}async hasDataChanged(){try{const{dataChanged:e,updates:t}=await this.source.refresh(this.customParameters);return _(t)&&this.read(t,{origin:"service",url:this.parsedUrl,ignoreDefaults:!0}),e}catch{}return!1}_getLayerDomain(e){if(!this.fields)return null;let t=null;return this.fields.some(r=>(r.name===e&&(t=r.domain),!!t)),t}};d([f({readOnly:!0,json:{read:!1,write:!1}})],Or.prototype,"capabilities",null),d([f({type:String})],Or.prototype,"copyright",void 0),d([f({readOnly:!0})],Or.prototype,"createQueryVersion",null),d([f({readOnly:!0})],Or.prototype,"defaultPopupTemplate",null),d([f({type:String,json:{name:"layerDefinition.definitionExpression",write:{enabled:!0,allowNull:!0}}})],Or.prototype,"definitionExpression",void 0),d([f({type:String})],Or.prototype,"displayField",void 0),d([f({type:Boolean})],Or.prototype,"editingEnabled",void 0),d([f(Ene)],Or.prototype,"elevationInfo",void 0),d([f(g8e)],Or.prototype,"featureReduction",void 0),d([f({type:[l6],json:{name:"layerDefinition.fields",write:{ignoreOrigin:!0,isRequired:!0},origins:{service:{name:"fields"}}}})],Or.prototype,"fields",void 0),d([f(a7t.fieldsIndex)],Or.prototype,"fieldsIndex",void 0),d([f({type:Zt,json:{name:"extent"}})],Or.prototype,"fullExtent",void 0),d([f({type:["point","polygon","polyline","multipoint"],json:{read:{reader:bV.read}}})],Or.prototype,"geometryType",void 0),d([f({type:Boolean})],Or.prototype,"hasZ",void 0),d([f(Cne)],Or.prototype,"id",void 0),d([f({type:Boolean,readOnly:!0})],Or.prototype,"isTable",null),d([f(mO)],Or.prototype,"labelsVisible",void 0),d([f({type:[g6],json:{name:"layerDefinition.drawingInfo.labelingInfo",read:{reader:PA},write:!0}})],Or.prototype,"labelingInfo",void 0),d([f(Sne)],Or.prototype,"legendEnabled",void 0),d([f({type:["show","hide"]})],Or.prototype,"listMode",void 0),d([f({type:String,json:{name:"layerDefinition.objectIdField",write:{ignoreOrigin:!0,isRequired:!0},origins:{service:{name:"objectIdField"}}}})],Or.prototype,"objectIdField",void 0),d([f(n7)],Or.prototype,"opacity",void 0),d([f({type:["GeoJSON"]})],Or.prototype,"operationalLayerType",void 0),d([f({readOnly:!0})],Or.prototype,"parsedUrl",null),d([f(pO)],Or.prototype,"popupEnabled",void 0),d([f({type:_x,json:{name:"popupInfo",write:!0}})],Or.prototype,"popupTemplate",void 0),d([f({types:fO,json:{name:"layerDefinition.drawingInfo.renderer",write:!0,origins:{service:{name:"drawingInfo.renderer"},"web-scene":{types:bne}}}})],Or.prototype,"renderer",null),d([f(xne)],Or.prototype,"screenSizePerspectiveEnabled",void 0),d([f({readOnly:!0})],Or.prototype,"source",void 0),d([f({type:Ye})],Or.prototype,"spatialReference",void 0),d([f({type:[xz]})],Or.prototype,"templates",void 0),d([f()],Or.prototype,"title",void 0),d([f({json:{read:!1},readOnly:!0})],Or.prototype,"type",void 0),d([f({type:String,readOnly:!0})],Or.prototype,"typeIdField",void 0),d([f({type:[Ine]})],Or.prototype,"types",void 0),d([f(Tne)],Or.prototype,"url",null),Or=d([$("esri.layers.GeoJSONLayer")],Or);const doe=Or,qDt=Object.freeze(Object.defineProperty({__proto__:null,default:doe},Symbol.toStringTag,{value:"Module"})),o7t="#294f89",l7t="#8db9d4",c7t={FC_BRAND_BLUE_DARK:o7t,FC_BRAND_BLUE_LIGHT:l7t},{FC_BRAND_BLUE_LIGHT:d7t,FC_BRAND_BLUE_DARK:u7t}=c7t;function h7t(e){const t=new doe({url:"./Jurisdictional_Boundary.json",title:"Falls Church - Jurisdictional Boundary",id:"Jurisdictional_Boundary",opacity:.35,renderer:{type:"simple",symbol:{type:"simple-fill",style:"solid",color:d7t,outline:{color:u7t,width:1}}}});e.add(t)}function VPe(e){return e&&"getAtOrigin"in e&&"originOf"in e}function c1e(e){e&&e.writtenProperties&&e.writtenProperties.forEach(({target:t,propName:r,newOrigin:i})=>{VPe(t)&&i&&t.originOf(r)!==i&&t.updateOrigin(r,i)})}async function f7t(e,t,r,i,n,s){let a=null;if(_(r)){const c=`${e}/nodepages/`,u=c+Math.floor(r.rootIndex/r.nodesPerPage);try{return{type:"page",rootPage:(await qt(u,{query:{f:"json",token:i},responseType:"json",signal:s})).data,rootIndex:r.rootIndex,pageSize:r.nodesPerPage,lodMetric:r.lodSelectionMetricType,urlPrefix:c}}catch(h){_(n)&&n.warn("#fetchIndexInfo()","Failed to load root node page. Falling back to node documents.",u,h),a=h}}if(!t)return null;const o=`${e}/nodes/`,l=o+(t&&t.split("/").pop());try{return{type:"node",rootNode:(await qt(l,{query:{f:"json",token:i},responseType:"json",signal:s})).data,urlPrefix:o}}catch(c){throw new k("sceneservice:root-node-missing","Root node missing.",{pageError:a,nodeError:c,url:l})}}async function p7t(e,t={},r){await e.load(r);const i=vl(e.itemUrl,"resources"),{start:n=1,num:s=10,sortOrder:a="asc",sortField:o="created"}=t,l={query:{start:n,num:s,sortOrder:a,sortField:o,token:e.apiKey},signal:Vi(r,"signal")},c=await e.portal._request(i,l);return{total:c.total,nextStart:c.nextStart,resources:c.resources.map(({created:u,size:h,resource:p})=>({created:new Date(u),size:h,resource:e.resourceFromPath(p)}))}}async function m7t(e,t,r,i){if(!e.hasPath())throw new k(`portal-item-resource-${t}:invalid-path`,"Resource does not have a valid path");const n=e.portalItem;await n.load(i);const s=vl(n.userItemUrl,t==="add"?"addResources":"updateResources"),[a,o]=zPe(e.path),l=await UPe(r),c=new FormData;return a&&a!=="."&&c.append("resourcesPrefix",a),c.append("fileName",o),c.append("file",l,o),c.append("f","json"),_(i)&&i.access&&c.append("access",i.access),await n.portal._request(s,{method:"post",body:c,signal:Vi(i,"signal")}),e}async function g7t(e,t,r){if(!t.hasPath())throw new k("portal-item-resources-remove:invalid-path","Resource does not have a valid path");await e.load(r);const i=vl(e.userItemUrl,"removeResources");await e.portal._request(i,{method:"post",query:{resource:t.path},signal:Vi(r,"signal")}),t.portalItem=null}async function y7t(e,t){await e.load(t);const r=vl(e.userItemUrl,"removeResources");return e.portal._request(r,{method:"post",query:{deleteAll:!0},signal:Vi(t,"signal")})}function zPe(e){const t=e.lastIndexOf("/");return t===-1?[".",e]:[e.slice(0,t),e.slice(t+1)]}function uoe(e){const[t,r]=b7t(e),[i,n]=zPe(t);return[i,n,r]}function b7t(e){const t=Hte(e);return R(t)?[e,""]:[e.slice(0,e.length-t.length-1),`.${t}`]}async function UPe(e){return e instanceof Blob?e:(await qt(e.url,{responseType:"blob"})).data}function v7t(e,t){if(!e.hasPath())return null;const[r,,i]=uoe(e.path);return e.portalItem.resourceFromPath(vl(r,t+i))}function BPe(e,t){if(!e.hasPath())return null;const[r,,i]=uoe(e.path);return e.portalItem.resourceFromPath(vl(r,t+i))}const vC=Object.freeze(Object.defineProperty({__proto__:null,addOrUpdateResource:m7t,contentToBlob:UPe,fetchResources:p7t,getSiblingOfSameType:v7t,getSiblingOfSameTypeI:BPe,removeAllResources:y7t,removeResource:g7t,splitPrefixFileNameAndExtension:uoe},Symbol.toStringTag,{value:"Module"}));async function d1e(e,t,r){if(!t||!t.resources)return;const i=t.portalItem===e.portalItem?new Set(e.paths):new Set;e.paths.length=0,e.portalItem=t.portalItem;const n=new Set(t.resources.toKeep.map(c=>c.resource.path)),s=new Set,a=[];n.forEach(c=>{i.delete(c),e.paths.push(c)});for(const c of t.resources.toUpdate)if(i.delete(c.resource.path),n.has(c.resource.path)||s.has(c.resource.path)){const{resource:u,content:h,finish:p,error:m}=c,g=BPe(u,_ie());e.paths.push(g.path),a.push(u1e({resource:g,content:h,finish:p,error:m},r))}else e.paths.push(c.resource.path),a.push(_7t(c,r)),s.add(c.resource.path);for(const c of t.resources.toAdd)a.push(u1e(c,r)),e.paths.push(c.resource.path);if(i.forEach(c=>{const u=t.portalItem.resourceFromPath(c);a.push(u.portalItem.removeResource(u).catch(()=>{}))}),a.length===0)return;const o=await dn(a);Et(r);const l=o.filter(c=>"error"in c).map(c=>c.error);if(l.length>0)throw new k("save:resources","Failed to save one or more resources",{errors:l})}async function u1e(e,t){const r=await Tu(e.resource.portalItem.addResource(e.resource,e.content,t));if(r.ok!==!0)throw e.error&&e.error(r.error),r.error;e.finish&&e.finish(e.resource)}async function _7t(e,t){const r=await Tu(e.resource.update(e.content,t));if(r.ok!==!0)throw e.error(r.error),r.error;e.finish(e.resource)}const VT=fe.getLogger("esri.layers.mixins.SceneService"),w7t=e=>{let t=class extends e{constructor(){super(...arguments),this.spatialReference=null,this.fullExtent=null,this.heightModelInfo=null,this.minScale=0,this.maxScale=0,this.version={major:Number.NaN,minor:Number.NaN,versionString:""},this.copyright=null,this.sublayerTitleMode="item-title",this.title=null,this.layerId=null,this.indexInfo=null,this._debouncedSaveOperations=qR(async(r,i,n)=>{switch(r){case U9.SAVE:return this._save(i);case U9.SAVE_AS:return this._saveAs(n,i)}})}readSpatialReference(r,i){return this._readSpatialReference(i)}_readSpatialReference(r){if(r.spatialReference!=null)return Ye.fromJSON(r.spatialReference);{const i=r.store,n=i.indexCRS||i.geographicCRS,s=n&&parseInt(n.substring(n.lastIndexOf("/")+1,n.length),10);return s!=null?new Ye(s):null}}readFullExtent(r,i,n){if(r!=null&&typeof r=="object"){const o=r.spatialReference==null?{...r,spatialReference:this._readSpatialReference(i)}:r;return Zt.fromJSON(o,n)}const s=i.store,a=this._readSpatialReference(i);return a==null||s==null||s.extent==null||!Array.isArray(s.extent)||s.extent.some(o=>o<UH)?null:new Zt({xmin:s.extent[0],ymin:s.extent[1],xmax:s.extent[2],ymax:s.extent[3],spatialReference:a})}parseVersionString(r){const i={major:Number.NaN,minor:Number.NaN,versionString:r},n=r.split(".");return n.length>=2&&(i.major=parseInt(n[0],10),i.minor=parseInt(n[1],10)),i}readVersion(r,i){const n=i.store,s=n.version!=null?n.version.toString():"";return this.parseVersionString(s)}readTitlePortalItem(r){return this.sublayerTitleMode!=="item-title"?void 0:r}readTitleService(r,i){const n=this.portalItem&&this.portalItem.title;if(this.sublayerTitleMode==="item-title")return q6e(this.url,i.name);let s=i.name;if(!s&&this.url){const a=jw(this.url);_(a)&&(s=a.title)}return this.sublayerTitleMode==="item-title-and-service-name"&&n&&(s=n+" - "+s),_z(s)}set url(r){const i=H6e({layer:this,url:r,nonStandardUrlAllowed:!1,logger:VT});this._set("url",i.url),i.layerId!=null&&this._set("layerId",i.layerId)}writeUrl(r,i,n,s){W6e(this,r,"layers",i,s)}get parsedUrl(){const r=this._get("url");if(!r)return null;const i=pn(r);return this.layerId!=null&&(i.path=`${i.path}/layers/${this.layerId}`),i}async _fetchIndexAndUpdateExtent(r,i){this.indexInfo=f7t(this.parsedUrl.path,this.rootNode,r,this.apiKey,VT,i),this.fullExtent==null||this.fullExtent.hasZ||this._updateExtent(await this.indexInfo)}_updateExtent(r){var i,n,s;if((r==null?void 0:r.type)==="page"){const a=r.rootIndex%r.pageSize,o=(n=(i=r.rootPage)==null?void 0:i.nodes)==null?void 0:n[a];if(o==null||o.obb==null||o.obb.center==null||o.obb.halfSize==null)throw new k("sceneservice:invalid-node-page","Invalid node page.");if(o.obb.center[0]<UH||this.fullExtent==null||this.fullExtent.hasZ)return;const l=o.obb.halfSize,c=o.obb.center[2],u=Math.sqrt(l[0]*l[0]+l[1]*l[1]+l[2]*l[2]);this.fullExtent.zmin=c-u,this.fullExtent.zmax=c+u}else if((r==null?void 0:r.type)==="node"){const a=(s=r.rootNode)==null?void 0:s.mbs;if(!Array.isArray(a)||a.length!==4||a[0]<UH)return;const o=a[2],l=a[3];this.fullExtent.zmin=o-l,this.fullExtent.zmax=o+l}}async _fetchService(r){if(this.url==null)throw new k("sceneservice:url-not-set","Scene service can not be loaded without valid portal item or url");if(this.layerId==null&&/SceneServer\/*$/i.test(this.url)){const i=await this._fetchFirstLayerId(r);i!=null&&(this.layerId=i)}return this._fetchServiceLayer(r)}async _fetchFirstLayerId(r){const i=await qt(this.url,{query:{f:"json",token:this.apiKey},responseType:"json",signal:r});if(i.data&&Array.isArray(i.data.layers)&&i.data.layers.length>0)return i.data.layers[0].id}async _fetchServiceLayer(r){const i=await qt(this.parsedUrl.path,{query:{f:"json",token:this.apiKey},responseType:"json",signal:r});i.ssl&&(this.url=this.url.replace(/^http:/i,"https:"));let n=!1;if(i.data.layerType&&i.data.layerType==="Voxel"&&(n=!0),n)return this._fetchVoxelServiceLayer();const s=i.data;this.read(s,{origin:"service",url:this.parsedUrl}),this.validateLayer(s)}async _fetchVoxelServiceLayer(r){const i=(await qt(this.parsedUrl.path+"/layer",{query:{f:"json",token:this.apiKey},responseType:"json",signal:r})).data;this.read(i,{origin:"service",url:this.parsedUrl}),this.validateLayer(i)}async _ensureLoadBeforeSave(){await this.load(),"beforeSave"in this&&typeof this.beforeSave=="function"&&await this.beforeSave()}validateLayer(r){}_updateTypeKeywords(r,i,n){r.typeKeywords||(r.typeKeywords=[]);const s=i.getTypeKeywords();for(const a of s)r.typeKeywords.push(a);r.typeKeywords&&(r.typeKeywords=r.typeKeywords.filter((a,o,l)=>l.indexOf(a)===o),n===P7.newItem&&(r.typeKeywords=r.typeKeywords.filter(a=>a!=="Hosted Service")))}async _saveAs(r,i){const n={...h1e,...i};let s=I5.from(r);s||(VT.error("_saveAs(): requires a portal item parameter"),await Promise.reject(new k("sceneservice:portal-item-required","_saveAs() requires a portal item to save to"))),s.id&&(s=s.clone(),s.id=null);const a=s.portal||Cs.getDefault();await this._ensureLoadBeforeSave(),s.type=g$,s.portal=a;const o={origin:"portal-item",url:null,messages:[],portal:a,portalItem:s,writtenProperties:[],blockedRelativeUrls:[],resources:{toAdd:[],toUpdate:[],toKeep:[],pendingOperations:[]}},l={layers:[this.write({},o)]};return await Promise.all(o.resources.pendingOperations),await this._validateAgainstJSONSchema(l,o,n),s.url=this.url,s.title||(s.title=this.title),this._updateTypeKeywords(s,n,P7.newItem),await a._signIn(),await a.user.addItem({item:s,folder:n&&n.folder,data:l}),await d1e(this.resourceReferences,o,null),this.portalItem=s,c1e(o),o.portalItem=s,s}async _save(r){const i={...h1e,...r};this.portalItem||(VT.error("_save(): requires the .portalItem property to be set"),await Promise.reject(new k("sceneservice:portal-item-not-set","Portal item to save to has not been set on this SceneService"))),this.portalItem.type!==g$&&(VT.error("_save(): Non-matching portal item type. Got "+this.portalItem.type+", expected "+g$),await Promise.reject(new k("sceneservice:portal-item-wrong-type",`Portal item needs to have type "${g$}"`))),await this._ensureLoadBeforeSave();const n={origin:"portal-item",url:this.portalItem.itemUrl&&pn(this.portalItem.itemUrl),messages:[],portal:this.portalItem.portal||Cs.getDefault(),portalItem:this.portalItem,writtenProperties:[],blockedRelativeUrls:[],resources:{toAdd:[],toUpdate:[],toKeep:[],pendingOperations:[]}},s={layers:[this.write({},n)]};return await Promise.all(n.resources.pendingOperations),await this._validateAgainstJSONSchema(s,n,i),this.portalItem.url=this.url,this.portalItem.title||(this.portalItem.title=this.title),this._updateTypeKeywords(this.portalItem,i,P7.existingItem),await this.portalItem.update({data:s}),await d1e(this.resourceReferences,n,null),c1e(n),this.portalItem}async _validateAgainstJSONSchema(r,i,n){let s=i.messages.filter(a=>a.type==="error").map(a=>new k(a.name,a.message,a.details));if(n&&n.validationOptions.ignoreUnsupported&&(s=s.filter(a=>a.name!=="layer:unsupported"&&a.name!=="symbol:unsupported"&&a.name!=="symbol-layer:unsupported"&&a.name!=="property:unsupported"&&a.name!=="url:unsupported"&&a.name!=="scenemodification:unsupported")),n.validationOptions.enabled||x7t){const a=(await ie(()=>import("./schemaValidator.5a2fc991.js"),["schemaValidator.5a2fc991.js","_commonjsHelpers.ce2b5698.js"],import.meta.url)).validate(r,n.portalItemLayerType);if(a.length>0){const o=`Layer item did not validate:
${a.join(`
`)}`;if(VT.error(`_validateAgainstJSONSchema(): ${o}`),n.validationOptions.failPolicy==="throw"){const l=a.map(c=>new k("sceneservice:schema-validation",c)).concat(s);throw new k("sceneservice-validate:error","Failed to save layer item due to schema validation, see `details.errors`.",{combined:l})}}}if(s.length>0)throw new k("sceneservice:save","Failed to save SceneService due to unsupported or invalid content. See 'details.errors' for more detailed information",{errors:s})}};return d([f(Cne)],t.prototype,"id",void 0),d([f({type:Ye})],t.prototype,"spatialReference",void 0),d([$e("spatialReference",["spatialReference","store.indexCRS","store.geographicCRS"])],t.prototype,"readSpatialReference",null),d([f({type:Zt})],t.prototype,"fullExtent",void 0),d([$e("fullExtent",["fullExtent","store.extent","spatialReference","store.indexCRS","store.geographicCRS"])],t.prototype,"readFullExtent",null),d([f({readOnly:!0,type:Ex})],t.prototype,"heightModelInfo",void 0),d([f({type:Number,json:{name:"layerDefinition.minScale",write:!0,origins:{service:{read:{source:"minScale"},write:!1}}}})],t.prototype,"minScale",void 0),d([f({type:Number,json:{name:"layerDefinition.maxScale",write:!0,origins:{service:{read:{source:"maxScale"},write:!1}}}})],t.prototype,"maxScale",void 0),d([f({readOnly:!0})],t.prototype,"version",void 0),d([$e("version",["store.version"])],t.prototype,"readVersion",null),d([f({type:String,json:{read:{source:"copyrightText"}}})],t.prototype,"copyright",void 0),d([f({type:String,json:{read:!1}})],t.prototype,"sublayerTitleMode",void 0),d([f({type:String})],t.prototype,"title",void 0),d([$e("portal-item","title")],t.prototype,"readTitlePortalItem",null),d([$e("service","title",["name"])],t.prototype,"readTitleService",null),d([f({type:Number,json:{origins:{service:{read:{source:"id"}},"portal-item":{write:{target:"id",isRequired:!0,ignoreOrigin:!0},read:!1}}}})],t.prototype,"layerId",void 0),d([f(Tne)],t.prototype,"url",null),d([Xe("url")],t.prototype,"writeUrl",null),d([f()],t.prototype,"parsedUrl",null),d([f({readOnly:!0})],t.prototype,"store",void 0),d([f({type:String,readOnly:!0,json:{read:{source:"store.rootNode"}}})],t.prototype,"rootNode",void 0),t=d([$("esri.layers.mixins.SceneService")],t),t},UH=-1e38,x7t=!1;var P7;(function(e){e[e.existingItem=0]="existingItem",e[e.newItem=1]="newItem"})(P7||(P7={}));const g$="Scene Service",h1e={getTypeKeywords:()=>[],portalItemLayerType:"unknown",validationOptions:{enabled:!0,ignoreUnsupported:!1,failPolicy:"throw"}};var U9;(function(e){e[e.SAVE=0]="SAVE",e[e.SAVE_AS=1]="SAVE_AS"})(U9||(U9={}));const T7t={analytics:{supportsCacheHint:!1},attachment:{supportsContentType:!1,supportsExifInfo:!1,supportsKeywords:!1,supportsName:!1,supportsSize:!1,supportsCacheHint:!1,supportsResize:!1},data:{isVersioned:!1,supportsAttachment:!1,supportsM:!1,supportsZ:!1},editing:{supportsDeleteByAnonymous:!1,supportsDeleteByOthers:!1,supportsGeometryUpdate:!1,supportsGlobalId:!1,supportsReturnServiceEditsInSourceSpatialReference:!1,supportsRollbackOnFailure:!1,supportsUpdateByAnonymous:!1,supportsUpdateByOthers:!1,supportsUpdateWithoutM:!1,supportsUploadWithItemId:!1},metadata:{supportsAdvancedFieldProperties:!1},operations:{supportsCalculate:!1,supportsTruncate:!1,supportsValidateSql:!1,supportsAdd:!1,supportsDelete:!1,supportsEditing:!1,supportsChangeTracking:!1,supportsQuery:!1,supportsQueryAnalytics:!1,supportsQueryAttachments:!1,supportsQueryTopFeatures:!1,supportsResizeAttachments:!1,supportsSync:!1,supportsUpdate:!1,supportsExceedsLimitStatistics:!1},queryRelated:{supportsCount:!1,supportsOrderBy:!1,supportsPagination:!1,supportsCacheHint:!1},queryTopFeatures:{supportsCacheHint:!1},query:{maxRecordCount:0,maxRecordCountFactor:0,standardMaxRecordCount:0,supportsCacheHint:!1,supportsCentroid:!1,supportsCompactGeometry:!1,supportsDefaultSpatialReference:!1,supportsDisjointSpatialRelationship:!1,supportsDistance:!1,supportsDistinct:!1,supportsExtent:!1,supportsFormatPBF:!1,supportsGeometryProperties:!1,supportsHavingClause:!1,supportsHistoricMoment:!1,supportsMaxRecordCountFactor:!1,supportsOrderBy:!1,supportsPagination:!1,supportsPercentileStatistics:!1,supportsQuantization:!1,supportsQuantizationEditMode:!1,supportsQueryByOthers:!1,supportsQueryGeometry:!1,supportsResultType:!1,supportsSqlExpression:!1,supportsStandardizedQueriesOnly:!1,supportsTopFeaturesQuery:!1,supportsSpatialAggregationStatistics:!1,supportedSpatialAggregationStatistics:{envelope:!1,centroid:!1,convexHull:!1},supportsStatistics:!1,tileMaxRecordCount:0}};class S7t{constructor(t,r,i,n){this.parsedUrl=t,this.portalItem=r,this.apiKey=i,this.signal=n,this.rootDocument=null;const s=this.parsedUrl.path.match(/^(.*)\/SceneServer\/layers\/([\d]*)\/?$/i);s&&(this.urlParts={root:s[1],layerId:parseInt(s[2],10)})}async fetch(){var i;if(!this.urlParts)return null;const t=(i=this.portalItem)!=null?i:await this._portalItemFromServiceItemId();if(R(t))return this._loadFromUrl();const r=await this._findAndLoadRelatedPortalItem(t);return R(r)?null:this._loadFeatureLayerFromPortalItem(r)}async fetchPortalItem(){var r;if(!this.urlParts)return null;const t=(r=this.portalItem)!=null?r:await this._portalItemFromServiceItemId();return R(t)?null:this._findAndLoadRelatedPortalItem(t)}async _fetchRootDocument(){if(_(this.rootDocument))return this.rootDocument;if(R(this.urlParts))return this.rootDocument={},{};const t={query:{f:"json",token:this.apiKey},responseType:"json",signal:this.signal},r=`${this.urlParts.root}/SceneServer`;try{const i=await qt(r,t);this.rootDocument=i.data}catch{this.rootDocument={}}return this.rootDocument}async _fetchServiceOwningPortalUrl(){const t=Xi==null?void 0:Xi.findServerInfo(this.parsedUrl.path);if(t!=null&&t.owningSystemUrl)return t.owningSystemUrl;const r=this.parsedUrl.path.replace(/(.*\/rest)\/.*/i,"$1")+"/info";try{const i=(await qt(r,{query:{f:"json"},responseType:"json",signal:this.signal})).data.owningSystemUrl;if(i)return i}catch(i){pu(i)}return null}async _findAndLoadRelatedPortalItem(t){try{return(await t.fetchRelatedItems({relationshipType:"Service2Service",direction:"reverse"},{signal:this.signal})).find(r=>r.type==="Feature Service")||null}catch(r){return pu(r),null}}async _loadFeatureLayerFromPortalItem(t){await t.load({signal:this.signal});const r=await this._findMatchingAssociatedSublayerUrl(t.url);return new PN({url:r,portalItem:t}).load({signal:this.signal})}async _loadFromUrl(){const t=await this._findMatchingAssociatedSublayerUrl(`${this.urlParts.root}/FeatureServer`);return new PN({url:t}).load({signal:this.signal})}async _findMatchingAssociatedSublayerUrl(t){const r=t.replace(/^(.*FeatureServer)(\/[\d]*\/?)?$/i,"$1"),i={query:{f:"json"},responseType:"json",authMode:"no-prompt",signal:this.signal},n=this.urlParts.layerId,s=this._fetchRootDocument(),a=qt(r,i),[o,l]=await Promise.all([a,s]),c=l&&l.layers,u=o.data&&o.data.layers;if(!Array.isArray(u))throw new Error("expected layers array");if(Array.isArray(c)){for(let h=0;h<Math.min(c.length,u.length);h++)if(c[h].id===n)return`${r}/${u[h].id}`}else if(n<u.length)return`${r}/${u[n].id}`;throw new Error("could not find matching associated sublayer")}async _portalItemFromServiceItemId(){const t=(await this._fetchRootDocument()).serviceItemId;if(!t)return null;const r=new I5({id:t,apiKey:this.apiKey}),i=await this._fetchServiceOwningPortalUrl();_(i)&&(r.portal=new Cs({url:i}));try{return r.load({signal:this.signal})}catch(n){return pu(n),null}}}let I3=class extends ge{constructor(){super(...arguments),this.nodesPerPage=null,this.rootIndex=0,this.lodSelectionMetricType=null}};d([f({type:Number})],I3.prototype,"nodesPerPage",void 0),d([f({type:Number})],I3.prototype,"rootIndex",void 0),d([f({type:String})],I3.prototype,"lodSelectionMetricType",void 0),I3=d([$("esri.layer.support.I3SNodePageDefinition")],I3);let iy=class extends ge{constructor(){super(...arguments),this.factor=1}};d([f({type:Number,json:{read:{source:"textureSetDefinitionId"}}})],iy.prototype,"id",void 0),d([f({type:Number})],iy.prototype,"factor",void 0),iy=d([$("esri.layer.support.I3SMaterialTexture")],iy);let x1=class extends ge{constructor(){super(...arguments),this.baseColorFactor=[1,1,1,1],this.baseColorTexture=null,this.metallicRoughnessTexture=null,this.metallicFactor=1,this.roughnessFactor=1}};d([f({type:[Number]})],x1.prototype,"baseColorFactor",void 0),d([f({type:iy})],x1.prototype,"baseColorTexture",void 0),d([f({type:iy})],x1.prototype,"metallicRoughnessTexture",void 0),d([f({type:Number})],x1.prototype,"metallicFactor",void 0),d([f({type:Number})],x1.prototype,"roughnessFactor",void 0),x1=d([$("esri.layer.support.I3SMaterialPBRMetallicRoughness")],x1);let ch=class extends ge{constructor(){super(...arguments),this.alphaMode="opaque",this.alphaCutoff=.25,this.doubleSided=!1,this.cullFace="none",this.normalTexture=null,this.occlusionTexture=null,this.emissiveTexture=null,this.emissiveFactor=null,this.pbrMetallicRoughness=null}};d([Ze({opaque:"opaque",mask:"mask",blend:"blend"})],ch.prototype,"alphaMode",void 0),d([f({type:Number})],ch.prototype,"alphaCutoff",void 0),d([f({type:Boolean})],ch.prototype,"doubleSided",void 0),d([Ze({none:"none",back:"back",front:"front"})],ch.prototype,"cullFace",void 0),d([f({type:iy})],ch.prototype,"normalTexture",void 0),d([f({type:iy})],ch.prototype,"occlusionTexture",void 0),d([f({type:iy})],ch.prototype,"emissiveTexture",void 0),d([f({type:[Number]})],ch.prototype,"emissiveFactor",void 0),d([f({type:x1})],ch.prototype,"pbrMetallicRoughness",void 0),ch=d([$("esri.layer.support.I3SMaterialDefinition")],ch);let _C=class extends ge{};d([f({type:String,json:{read:{source:["name","index"],reader:(e,t)=>e!=null?e:`${t.index}`}}})],_C.prototype,"name",void 0),d([Ze({jpg:"jpg",png:"png",dds:"dds","ktx-etc2":"ktx-etc2",ktx2:"ktx2",basis:"basis"})],_C.prototype,"format",void 0),_C=d([$("esri.layer.support.I3STextureFormat")],_C);let wC=class extends ge{constructor(){super(...arguments),this.atlas=!1}};d([f({type:[_C]})],wC.prototype,"formats",void 0),d([f({type:Boolean})],wC.prototype,"atlas",void 0),wC=d([$("esri.layer.support.I3STextureSetDefinition")],wC);let ep=class extends ge{};d([Ze({Float32:"Float32",UInt64:"UInt64",UInt32:"UInt32",UInt16:"UInt16",UInt8:"UInt8"})],ep.prototype,"type",void 0),d([f({type:Number})],ep.prototype,"component",void 0),ep=d([$("esri.layer.support.I3SGeometryAttribute")],ep);let xC=class extends ge{};d([Ze({draco:"draco"})],xC.prototype,"encoding",void 0),d([f({type:[String]})],xC.prototype,"attributes",void 0),xC=d([$("esri.layer.support.I3SGeometryCompressedAttributes")],xC);let wf=class extends ge{constructor(){super(...arguments),this.offset=0}};d([f({type:Number})],wf.prototype,"offset",void 0),d([f({type:ep})],wf.prototype,"position",void 0),d([f({type:ep})],wf.prototype,"normal",void 0),d([f({type:ep})],wf.prototype,"uv0",void 0),d([f({type:ep})],wf.prototype,"color",void 0),d([f({type:ep})],wf.prototype,"uvRegion",void 0),d([f({type:ep})],wf.prototype,"featureId",void 0),d([f({type:ep})],wf.prototype,"faceRange",void 0),d([f({type:xC})],wf.prototype,"compressedAttributes",void 0),wf=d([$("esri.layer.support.I3SGeometryBuffer")],wf);let TC=class extends ge{};d([Ze({triangle:"triangle"})],TC.prototype,"topology",void 0),d([f()],TC.prototype,"geometryBuffers",void 0),TC=d([$("esri.layer.support.I3SGeometryDefinition")],TC);let T1=class extends ge{constructor(){super(...arguments),this.name=null,this.field=null,this.currentRangeExtent=null,this.fullRangeExtent=null,this.type="rangeInfo"}};d([f({type:String,json:{read:!0,write:!0}})],T1.prototype,"name",void 0),d([f({type:String,json:{read:!0,write:!0}})],T1.prototype,"field",void 0),d([f({type:[Number],json:{read:!0,write:!0}})],T1.prototype,"currentRangeExtent",void 0),d([f({type:[Number],json:{read:!0,write:!0}})],T1.prototype,"fullRangeExtent",void 0),d([f({type:["rangeInfo"],readOnly:!0,json:{read:!1,write:!0}})],T1.prototype,"type",void 0),T1=d([$("esri.layers.support.RangeInfo")],T1);function YK(e){return hoe[E7t(e)]||A7t}function E7t(e){return e instanceof Blob?e.type:C7t(e.url)}function C7t(e){const t=Hte(e);return ZK[t]||GPe}const hoe={},GPe="text/plain",A7t=hoe[GPe],ZK={png:"image/png",jpeg:"image/jpeg",jpg:"image/jpg",bmp:"image/bmp",gif:"image/gif",json:"application/json",txt:"text/plain",xml:"application/xml",svg:"image/svg+xml",zip:"application/zip",pbf:"application/vnd.mapbox-vector-tile",gz:"application/gzip"};for(const e in ZK)hoe[ZK[e]]=e;function R7t(e){const t=_(e)&&e.origins?e.origins:[void 0];return(r,i)=>{const n=O7t(e,r,i);for(const s of t){const a=Pte(r,s,i);for(const o in n)a[o]=n[o]}}}function O7t(e,t,r){if(_(e)&&e.type==="resource")return M7t(e,t,r);switch(_(e)&&e.type?e.type:"other"){case"other":return{read:!0,write:!0};case"url":{const{read:i,write:n}=DBe;return{read:i,write:n}}}}function M7t(e,t,r){const i=GR(t,r);return{type:String,read:(n,s,a)=>{const o=CV(n,s,a);return i.type===String?o:typeof i.type=="function"?new i.type({url:o}):void 0},write:{writer(n,s,a,o){if(!o||!o.resources)return typeof n=="string"?void(s[a]=Py(n,o)):void(s[a]=n.write({},o));const l=L7t(n),c=l?Py(l,{...o,verifyItemRelativeUrls:o&&o.verifyItemRelativeUrls?{writtenUrls:o.verifyItemRelativeUrls.writtenUrls,rootPath:null}:null},X5.NO):null,u=i.type!==String&&(!VPe(this)||o&&o.origin&&this.originIdOf(r)>Zg(o.origin));o&&o.portalItem&&_(c)&&!cd(c)?u?P7t(this,r,n,c,s,a,o,e):I7t(c,s,a,o):o&&o.portalItem&&(R(c)||_(kxe(c))||qv(c)||u)?jPe(this,r,n,c,s,a,o,e):s[a]=c}}}}function jPe(e,t,r,i,n,s,a,o){const l=_ie(),c=HPe(r,i,a),u=vl(Vi(o,"prefix"),l),h=`${u}.${YK(c)}`,p=a.portalItem.resourceFromPath(h);qv(i)&&a.resources.pendingOperations.push($7t(i).then(m=>{p.path=`${u}.${YK(m)}`,n[s]=p.itemRelativeUrl}).catch(()=>{})),qPe(e,t,p,c,a.resources.toAdd),n[s]=p.itemRelativeUrl}function P7t(e,t,r,i,n,s,a,o){const l=a.portalItem.resourceFromPath(i),c=HPe(r,i,a);YK(c)===Hte(l.path)?(qPe(e,t,l,c,a.resources.toUpdate),n[s]=i):jPe(e,t,r,i,n,s,a,o)}function I7t(e,t,r,i){i.resources.toKeep.push({resource:i.portalItem.resourceFromPath(e)}),t[r]=e}function qPe(e,t,r,i,n){n.push({resource:r,content:i,finish:s=>{D7t(e,t,s)}})}function HPe(e,t,r){return typeof e=="string"?{url:t}:new Blob([JSON.stringify(e.toJSON(r))],{type:"application/json"})}async function $7t(e){const t=(await ie(()=>Promise.resolve().then(()=>Z3e),void 0,import.meta.url)).default,{data:r}=await t(e,{responseType:"blob"});return r}function L7t(e){return R(e)?null:typeof e=="string"?e:e.url}function D7t(e,t,r){typeof e[t]=="string"?e[t]=r.url:e[t].url=r.url}var kD;let QK=kD=class extends Z9(lt.ofType($o)){constructor(e){super(e)}clone(){return new kD(this.items.map(e=>e.clone()))}write(e,t){return this.toJSON(t)}toJSON(e){var r;const t=(r=e==null?void 0:e.layer)==null?void 0:r.spatialReference;return t?this.toArray().map(i=>{if(!t.equals(i.spatialReference)){if(!mm(i.spatialReference,t))return e&&e.messages&&e.messages.push(new cc("scenefilter:unsupported","Scene filters with incompatible spatial references are not supported",{modification:this,spatialReference:e.layer.spatialReference,context:e})),null;const s=new $o;Ije(i,s,t),i=s}const n=i.toJSON(e);return delete n.spatialReference,n}).filter(i=>i!=null):(e!=null&&e.messages&&e.messages.push(new cc("scenefilter:unsupported","Writing Scene filters without context layer is not supported",{modification:this,spatialReference:e.layer.spatialReference,context:e})),this.toArray().map(i=>i.toJSON(e)))}static fromJSON(e,t){const r=new kD;return e.forEach(i=>r.add($o.fromJSON(i,t))),r}};QK=kD=d([$("esri.layers.support.PolygonCollection")],QK);const JK=QK;var KK;let BS=KK=class extends ge{constructor(e){super(e),this.spatialRelationship="disjoint",this.geometries=new JK,this._geometriesSource=null,this._handles=new Ft}initialize(){this._handles.add(rn(()=>this.geometries,"after-changes",()=>this.geometries=this.geometries,ti))}destroy(){this._handles.destroy()}readGeometries(e,t,r){this._geometriesSource={url:My(e,r),context:r}}async loadGeometries(e,t){if(R(this._geometriesSource))return;const{url:r,context:i}=this._geometriesSource,n=await qt(r,{responseType:"json",signal:Vi(t,"signal")}),s=e.toJSON(),a=n.data.map(o=>({...o,spatialReference:s}));this.geometries=JK.fromJSON(a,i),this._geometriesSource=null}clone(){return new KK({geometries:te(this.geometries),spatialRelationship:this.spatialRelationship})}};d([f({type:["disjoint","contains"],nonNullable:!0,json:{write:!0}})],BS.prototype,"spatialRelationship",void 0),d([f({type:JK,nonNullable:!0,json:{write:!0}}),R7t({origins:["web-scene","portal-item"],type:"resource",prefix:"geometries"})],BS.prototype,"geometries",void 0),d([$e(["web-scene","portal-item"],"geometries")],BS.prototype,"readGeometries",null),BS=KK=d([$("esri.layers.support.SceneFilter")],BS);const F7t=BS,N7t=["3DObject","Point"],zT=fe.getLogger("esri.layers.SceneLayer"),f1e=$ne();let Lt=class extends w7t(X6e(Ane(t8e(Rne(vz(U6e(U5))))))){constructor(...e){super(...e),this.featureReduction=null,this.rangeInfos=null,this.operationalLayerType="ArcGISSceneServiceLayer",this.type="scene",this.fields=null,this.floorInfo=null,this.outFields=null,this.nodePages=null,this.materialDefinitions=null,this.textureSetDefinitions=null,this.geometryDefinitions=null,this.serviceUpdateTimeStamp=null,this.excludeObjectIds=new lt,this.definitionExpression=null,this.filter=null,this.path=null,this.labelsVisible=!0,this.labelingInfo=null,this.legendEnabled=!0,this.priority=null,this.semantic=null,this.cachedDrawingInfo={color:!1},this.popupEnabled=!0,this.popupTemplate=null,this.objectIdField=null,this.globalIdField=null,this._fieldUsageInfo={},this.screenSizePerspectiveEnabled=!0}normalizeCtorArgs(e,t){return typeof e=="string"?{url:e,...t}:e}getField(e){return this.fieldsIndex.get(e)}getFieldDomain(e,t){var i,n,s,a;const r=(n=(i=this.getFeatureType(t==null?void 0:t.feature))==null?void 0:i.domains)==null?void 0:n[e];return r&&r.type!=="inherited"?r:(a=(s=this.getField(e))==null?void 0:s.domain)!=null?a:null}getFeatureType(e){return e&&_(this.associatedLayer)?this.associatedLayer.getFeatureType(e):null}get types(){return _(this.associatedLayer)?this.associatedLayer.types:[]}get typeIdField(){return _(this.associatedLayer)?this.associatedLayer.typeIdField:null}get formTemplate(){return _(this.associatedLayer)?this.associatedLayer.formTemplate:null}get fieldsIndex(){return new y8e(this.fields)}readNodePages(e,t,r){return t.layerType==="Point"&&(e=t.pointNodePages),e==null||typeof e!="object"?null:I3.fromJSON(e,r)}set elevationInfo(e){this._set("elevationInfo",e),this.loaded&&this._validateElevationInfo()}get geometryType(){return k7t[this.profile]||"mesh"}set renderer(e){G5(e,this.fieldsIndex),this._set("renderer",e)}readCachedDrawingInfo(e){return e!=null&&typeof e=="object"||(e={}),e.color==null&&(e.color=!1),e}get capabilities(){const e=_(this.associatedLayer)&&this.associatedLayer.capabilities?this.associatedLayer.capabilities:T7t,{query:t,editing:{supportsGlobalId:r,supportsRollbackOnFailure:i,supportsUploadWithItemId:n,supportsReturnServiceEditsInSourceSpatialReference:s},data:{supportsZ:a,supportsM:o,isVersioned:l,supportsAttachment:c},operations:{supportsEditing:u,supportsUpdate:h,supportsQuery:p,supportsQueryAttachments:m}}=e,g=e.operations.supportsChangeTracking;return{query:t,editing:{supportsGlobalId:r,supportsReturnServiceEditsInSourceSpatialReference:s,supportsRollbackOnFailure:i,supportsGeometryUpdate:!1,supportsUploadWithItemId:n},data:{supportsAttachment:c,supportsZ:a,supportsM:o,isVersioned:l},operations:{supportsQuery:p,supportsQueryAttachments:m,supportsEditing:u&&g,supportsAdd:!1,supportsDelete:!1,supportsUpdate:h&&g}}}get editingEnabled(){return this._isOverridden("editingEnabled")?this._get("editingEnabled"):this.userHasEditingPrivileges}set editingEnabled(e){e!=null?this._override("editingEnabled",e):this._clearOverride("editingEnabled")}get defaultPopupTemplate(){return _(this.associatedLayer)||this.attributeStorageInfo?this.createPopupTemplate():null}readObjectIdField(e,t){return!e&&t.fields&&t.fields.some(r=>(r.type==="esriFieldTypeOID"&&(e=r.name),!!e)),e||void 0}readGlobalIdField(e,t){return!e&&t.fields&&t.fields.some(r=>(r.type==="esriFieldTypeGlobalID"&&(e=r.name),!!e)),e||void 0}get displayField(){return _(this.associatedLayer)?this.associatedLayer.displayField:null}readProfile(e,t){const r=t.store.profile;return r!=null&&p1e[r]?p1e[r]:(zT.error("Unknown or missing profile",{profile:r,layer:this}),"mesh-pyramids")}load(e){const t=_(e)?e.signal:null,r=this.loadFromPortal({supportedTypes:["Scene Service"]},e).catch(pu).then(()=>this._fetchService(t)).then(()=>Promise.all([this._fetchIndexAndUpdateExtent(this.nodePages,t),this._setAssociatedFeatureLayer(t),_(this.filter)?this.filter.loadGeometries(this.spatialReference):null])).then(()=>this._validateElevationInfo()).then(()=>this._applyAssociatedLayerOverrides()).then(()=>this._populateFieldUsageInfo()).then(()=>v8e(this,{origin:"service"},t)).then(()=>G5(this.renderer,this.fieldsIndex)).then(()=>this.finishLoadEditablePortalLayer(e));return this.addResolvingPromise(r),Promise.resolve(this)}async beforeSave(){_(this.filter)&&await this.load()}createQuery(){const e=new Zn;return this.geometryType!=="mesh"&&(e.returnGeometry=!0,e.returnZ=!0),e.where=this.definitionExpression||"1=1",e.sqlFormat="standard",e}queryExtent(e,t){return this._getAssociatedLayerForQuery().then(r=>r.queryExtent(e||this.createQuery(),t))}queryFeatureCount(e,t){return this._getAssociatedLayerForQuery().then(r=>r.queryFeatureCount(e||this.createQuery(),t))}queryFeatures(e,t){return this._getAssociatedLayerForQuery().then(r=>r.queryFeatures(e||this.createQuery(),t)).then(r=>{if(r!=null&&r.features)for(const i of r.features)i.layer=this,i.sourceLayer=this;return r})}queryObjectIds(e,t){return this._getAssociatedLayerForQuery().then(r=>r.queryObjectIds(e||this.createQuery(),t))}queryAttachments(e,t){return this._getAssociatedLayerForQuery().then(r=>r.queryAttachments(e,t))}getFieldUsageInfo(e){const t={supportsLabelingInfo:!1,supportsRenderer:!1,supportsPopupTemplate:!1,supportsLayerQuery:!1};return this.loaded?this._fieldUsageInfo[e]||t:(zT.error("#getFieldUsageInfo()","Unavailable until layer is loaded"),t)}createPopupTemplate(e){return Lne(this,e)}_getAssociatedLayerForQuery(){const e=this.associatedLayer;return _(e)&&e.loaded?Promise.resolve(e):this._loadAssociatedLayerForQuery()}async _loadAssociatedLayerForQuery(){if(await this.load(),R(this.associatedLayer))throw new k("scenelayer:query-not-available","SceneLayer queries are not available without an associated feature layer",{layer:this});try{await this.associatedLayer.load()}catch(e){throw new k("scenelayer:query-not-available","SceneLayer associated feature layer could not be loaded",{layer:this,error:e})}return this.associatedLayer}hasCachedStatistics(e){return this.statisticsInfo!=null&&this.statisticsInfo.some(t=>t.name===e)}async queryCachedStatistics(e,t){if(await this.load(t),!this.statisticsInfo)throw new k("scenelayer:no-cached-statistics","Cached statistics are not available for this layer");const r=this.fieldsIndex.get(e);if(!r)throw new k("scenelayer:field-unexisting",`Field '${e}' does not exist on the layer`);for(const i of this.statisticsInfo)if(i.name===r.name){const n=vl(this.parsedUrl.path,i.href);return qt(n,{query:{f:"json",token:this.apiKey},responseType:"json",signal:t?t.signal:null}).then(s=>s.data)}throw new k("scenelayer:no-cached-statistics","Cached statistics for this attribute are not available")}async saveAs(e,t){return this._debouncedSaveOperations(U9.SAVE_AS,{...t,getTypeKeywords:()=>this._getTypeKeywords(),portalItemLayerType:"scene"},e)}async save(){const e={getTypeKeywords:()=>this._getTypeKeywords(),portalItemLayerType:"scene"};return this._debouncedSaveOperations(U9.SAVE,e)}async applyEdits(e,t){const r=await ie(()=>import("./editingSupport.d59c083d.js"),[],import.meta.url);if(await this.load(),R(this.associatedLayer))throw new k(`${this.type}-layer:not-editable`,"Service is not editable");return await this.associatedLayer.load(),r.applyEdits(this,this.associatedLayer.source,e,t)}on(e,t){return super.on(e,t)}validateLayer(e){if(e.layerType&&!N7t.includes(e.layerType))throw new k("scenelayer:layer-type-not-supported","SceneLayer does not support this layer type",{layerType:e.layerType});if(isNaN(this.version.major)||isNaN(this.version.minor))throw new k("layer:service-version-not-supported","Service version is not supported.",{serviceVersion:this.version.versionString,supportedVersions:"1.x, 2.x"});if(this.version.major>2)throw new k("layer:service-version-too-new","Service version is too new.",{serviceVersion:this.version.versionString,supportedVersions:"1.x, 2.x"});function t(r,i){let n=!1,s=!1;if(r==null)n=!0,s=!0;else{const a=i&&i.isGeographic;switch(r){case"east-north-up":case"earth-centered":n=!0,s=a;break;case"vertex-reference-frame":n=!0,s=!a;break;default:n=!1}}if(!n)throw new k("scenelayer:unsupported-normal-reference-frame","Normal reference frame is invalid.");if(!s)throw new k("scenelayer:incompatible-normal-reference-frame","Normal reference frame is incompatible with layer spatial reference.")}t(this.normalReferenceFrame,this.spatialReference)}_getTypeKeywords(){const e=[];if(this.profile==="points")e.push("Point");else{if(this.profile!=="mesh-pyramids")throw new k("scenelayer:unknown-profile","SceneLayer:save() encountered an unknown SceneLayer profile: "+this.profile);e.push("3DObject")}return e}_populateFieldUsageInfo(){if(this._fieldUsageInfo={},this.fields)for(const e of this.fields){const t=!(!this.attributeStorageInfo||!this.attributeStorageInfo.some(n=>n.name===e.name)),r=!!(_(this.associatedLayer)&&this.associatedLayer.fields&&this.associatedLayer.fields.some(n=>n&&e.name===n.name)),i={supportsLabelingInfo:t,supportsRenderer:t,supportsPopupTemplate:t||r,supportsLayerQuery:r};this._fieldUsageInfo[e.name]=i}}_applyAssociatedLayerOverrides(){this._applyAssociatedLayerFieldsOverrides(),this._applyAssociatedLayerPopupOverrides()}_applyAssociatedLayerFieldsOverrides(){if(R(this.associatedLayer)||!this.associatedLayer.fields)return;let e=null;for(const t of this.associatedLayer.fields){const r=this.getField(t.name);r?(!r.domain&&t.domain&&(r.domain=t.domain.clone()),r.editable=t.editable,r.nullable=t.nullable,r.length=t.length):(e||(e=this.fields?this.fields.slice():[]),e.push(t.clone()))}e&&this._set("fields",e)}_applyAssociatedLayerPopupOverrides(){if(R(this.associatedLayer))return;const e=["popupTemplate","popupEnabled"],t=Do(this);for(let r=0;r<e.length;r++){const i=e[r],n=this.originIdOf(i),s=this.associatedLayer.originIdOf(i);n<s&&(s===Gt.SERVICE||s===Gt.PORTAL_ITEM)&&t.setAtOrigin(i,this.associatedLayer[i],s)}}async _setAssociatedFeatureLayer(e){if(!["mesh-pyramids","points"].includes(this.profile))return;const t=new S7t(this.parsedUrl,this.portalItem,this.apiKey,e);try{this.associatedLayer=await t.fetch()}catch(r){Ui(r)||this._logWarningOnPopupEnabled()}}async _logWarningOnPopupEnabled(){await td(()=>this.popupEnabled&&this.popupTemplate!=null);const e=`this SceneLayer: ${this.title}`;this.attributeStorageInfo==null?zT.warn(`Associated FeatureLayer could not be loaded and no binary attributes found. Popups will not work on ${e}`):zT.info(`Associated FeatureLayer could not be loaded. Falling back to binary attributes for Popups on ${e}`)}_validateElevationInfo(){const e=this.elevationInfo;e&&(this.profile==="mesh-pyramids"&&e.mode==="relative-to-scene"&&zT.warn(".elevationInfo=","Mesh scene layers don't support relative-to-scene elevation mode"),e.featureExpressionInfo&&e.featureExpressionInfo.expression!=="0"&&zT.warn(".elevationInfo=","Scene layers do not support featureExpressionInfo"))}};d([f({types:{key:"type",base:uy,typeMap:{selection:dJ}},json:{origins:{"web-scene":{name:"layerDefinition.featureReduction",write:!0},"portal-item":{name:"layerDefinition.featureReduction",write:!0}}}})],Lt.prototype,"featureReduction",void 0),d([f({type:[T1],json:{read:!1,origins:{"web-scene":{name:"layerDefinition.rangeInfos",write:!0},"portal-item":{name:"layerDefinition.rangeInfos",write:!0}}}})],Lt.prototype,"rangeInfos",void 0),d([f({json:{read:!1}})],Lt.prototype,"associatedLayer",void 0),d([f({type:["show","hide"]})],Lt.prototype,"listMode",void 0),d([f({type:["ArcGISSceneServiceLayer"]})],Lt.prototype,"operationalLayerType",void 0),d([f({json:{read:!1},readOnly:!0})],Lt.prototype,"type",void 0),d([f({...f1e.fields,readOnly:!0,json:{read:!1,origins:{service:{read:!0}}}})],Lt.prototype,"fields",void 0),d([f()],Lt.prototype,"types",null),d([f()],Lt.prototype,"typeIdField",null),d([f()],Lt.prototype,"formTemplate",null),d([f({readOnly:!0})],Lt.prototype,"fieldsIndex",null),d([f({type:b8e,json:{read:{source:"layerDefinition.floorInfo"},write:{target:"layerDefinition.floorInfo"}}})],Lt.prototype,"floorInfo",void 0),d([f(f1e.outFields)],Lt.prototype,"outFields",void 0),d([f({type:I3,readOnly:!0,json:{read:!1}})],Lt.prototype,"nodePages",void 0),d([$e("service","nodePages",["nodePages","pointNodePages"])],Lt.prototype,"readNodePages",null),d([f({type:[ch],readOnly:!0})],Lt.prototype,"materialDefinitions",void 0),d([f({type:[wC],readOnly:!0})],Lt.prototype,"textureSetDefinitions",void 0),d([f({type:[TC],readOnly:!0})],Lt.prototype,"geometryDefinitions",void 0),d([f({readOnly:!0})],Lt.prototype,"serviceUpdateTimeStamp",void 0),d([f({readOnly:!0})],Lt.prototype,"attributeStorageInfo",void 0),d([f({readOnly:!0})],Lt.prototype,"statisticsInfo",void 0),d([f({type:lt.ofType(Number),nonNullable:!0,json:{origins:{service:{read:!1,write:!1}},name:"layerDefinition.excludeObjectIds",write:{enabled:!0}}})],Lt.prototype,"excludeObjectIds",void 0),d([f({type:String,json:{origins:{service:{read:!1,write:!1}},name:"layerDefinition.definitionExpression",write:{enabled:!0,allowNull:!0}}})],Lt.prototype,"definitionExpression",void 0),d([f({type:F7t,json:{name:"layerDefinition.polygonFilter",write:!0}})],Lt.prototype,"filter",void 0),d([f({type:String,json:{origins:{"web-scene":{read:!0,write:!0}},read:!1}})],Lt.prototype,"path",void 0),d([f(Ene)],Lt.prototype,"elevationInfo",null),d([f({type:String})],Lt.prototype,"geometryType",null),d([f(mO)],Lt.prototype,"labelsVisible",void 0),d([f({type:[g6],json:{origins:{service:{name:"drawingInfo.labelingInfo",read:{reader:PA},write:!1}},name:"layerDefinition.drawingInfo.labelingInfo",read:{reader:PA},write:!0}})],Lt.prototype,"labelingInfo",void 0),d([f(Sne)],Lt.prototype,"legendEnabled",void 0),d([f({type:Number,json:{origins:{"web-document":{default:1,write:{enabled:!0,target:{opacity:{type:Number},"layerDefinition.drawingInfo.transparency":{type:Number}}},read:{source:["opacity","layerDefinition.drawingInfo.transparency"],reader(e,t){var i,n;if(typeof e=="number"&&e>=0&&e<=1)return e;const r=(n=(i=t.layerDefinition)==null?void 0:i.drawingInfo)==null?void 0:n.transparency;return r!==void 0?F5(r):void 0}}},"portal-item":{write:!0},service:{read:!1}}}})],Lt.prototype,"opacity",void 0),d([f({type:["Low","High"],readOnly:!0,json:{read:!1,origins:{service:{read:!0}}}})],Lt.prototype,"priority",void 0),d([f({type:["Labels"],readOnly:!0,json:{read:!1,origins:{service:{read:!0}}}})],Lt.prototype,"semantic",void 0),d([f({types:bne,json:{origins:{service:{read:{source:"drawingInfo.renderer"}}},name:"layerDefinition.drawingInfo.renderer",write:!0},value:null})],Lt.prototype,"renderer",null),d([f({json:{read:!1}})],Lt.prototype,"cachedDrawingInfo",void 0),d([$e("service","cachedDrawingInfo")],Lt.prototype,"readCachedDrawingInfo",null),d([f({readOnly:!0,json:{read:!1}})],Lt.prototype,"capabilities",null),d([f({type:Boolean,json:{read:!1}})],Lt.prototype,"editingEnabled",null),d([f(pO)],Lt.prototype,"popupEnabled",void 0),d([f({type:_x,json:{name:"popupInfo",write:!0}})],Lt.prototype,"popupTemplate",void 0),d([f({readOnly:!0,json:{read:!1}})],Lt.prototype,"defaultPopupTemplate",null),d([f({type:String,json:{read:!1}})],Lt.prototype,"objectIdField",void 0),d([$e("service","objectIdField",["objectIdField","fields"])],Lt.prototype,"readObjectIdField",null),d([f({type:String,json:{read:!1}})],Lt.prototype,"globalIdField",void 0),d([$e("service","globalIdField",["globalIdField","fields"])],Lt.prototype,"readGlobalIdField",null),d([f({readOnly:!0,type:String,json:{read:!1}})],Lt.prototype,"displayField",null),d([f({type:String,json:{read:!1}})],Lt.prototype,"profile",void 0),d([$e("service","profile",["store.profile"])],Lt.prototype,"readProfile",null),d([f({readOnly:!0,type:String,json:{origins:{service:{read:{source:"store.normalReferenceFrame"}}},read:!1}})],Lt.prototype,"normalReferenceFrame",void 0),d([f(xne)],Lt.prototype,"screenSizePerspectiveEnabled",void 0),Lt=d([$("esri.layers.SceneLayer")],Lt);const p1e={"mesh-pyramids":"mesh-pyramids",meshpyramids:"mesh-pyramids","features-meshes":"mesh-pyramids",points:"points","features-points":"points",lines:"lines","features-lines":"lines",polygons:"polygons","features-polygons":"polygons"},k7t={"mesh-pyramids":"mesh",points:"point",lines:"polyline",polygons:"polygon"},WPe=Lt,HDt=Object.freeze(Object.defineProperty({__proto__:null,default:WPe},Symbol.toStringTag,{value:"Module"}));function V7t(e){const t={title:"Falls Church - 3D Building Information",content:[{type:"fields",fieldInfos:[{fieldName:"name",label:"Name"},{fieldName:"building",label:"Building Type "},{fieldName:"building_levels",label:"Floors"}]}]},r=new WPe({url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",popupTemplate:t,title:"Buildings",id:"osm3D_BuildingsLayer"});let i={type:"mesh-3d",symbolLayers:[{type:"fill",material:{color:"#fff"}}]};r.renderer={type:"simple",symbol:i},e.add(r)}const PR=-1;let M0=class extends xe{constructor(e){super(e),this._from=null,this._to=null,this._final=null,this._current=[],this._time=0,this.duration=ue("mapview-transitions-duration"),this.effects=[]}set effect(e){if(this._get("effect")!==(e=e||"")){this._set("effect",e);try{this._transitionTo(m1e(e))}catch(t){this._transitionTo([]),fe.getLogger(this.declaredClass).warn("Invalid Effect",{effect:e,error:t})}}}get hasEffects(){return this.transitioning||!!this.effects.length}set scale(e){this._updateForScale(e)}get transitioning(){return this._to!==null}canTransitionTo(e){try{return this.scale>0&&g1e(this._current,m1e(e),this.scale)}catch{return!1}}transitionStep(e,t){this._applyTimeTransition(e),this._updateForScale(t)}end(){this._applyTimeTransition(this.duration)}_transitionTo(e){this.scale>0&&g1e(this._current,e,this.scale)?(this._final=e,this._to=te(e),z7t(this._current,this._to,this.scale),this._from=te(this._current),this._time=0):(this._from=this._to=this._final=null,this._current=e),this._set("effects",this._current[0]?te(this._current[0].effects):[])}_applyTimeTransition(e){if(!(this._to&&this._from&&this._current&&this._final))return;this._time+=e;const t=Math.min(1,this._time/this.duration);for(let r=0;r<this._current.length;r++){const i=this._current[r],n=this._from[r],s=this._to[r];i.scale=U7t(n.scale,s.scale,t);for(let a=0;a<i.effects.length;a++){const o=i.effects[a],l=n.effects[a],c=s.effects[a];o.interpolate(l,c,t)}}t===1&&(this._current=this._final,this._set("effects",this._current[0]?te(this._current[0].effects):[]),this._from=this._to=this._final=null)}_updateForScale(e){if(this._set("scale",e),this._current.length===0)return;const t=this._current,r=this._current.length-1;let i,n,s=1;if(t.length===1||e>=t[0].scale)n=i=t[0].effects;else if(e<=t[r].scale)n=i=t[r].effects;else for(let a=0;a<r;a++){const o=t[a],l=t[a+1];if(o.scale>=e&&l.scale<=e){s=(e-o.scale)/(l.scale-o.scale),i=o.effects,n=l.effects;break}}for(let a=0;a<this.effects.length;a++)this.effects[a].interpolate(i[a],n[a],s)}};function m1e(e){const t=Iie(e)||[];return B7t(t)?[{scale:PR,effects:t}]:t}function g1e(e,t,r){var i,n,s,a;return!((i=e[0])!=null&&i.effects)||!((n=t[0])!=null&&n.effects)?!0:!((((s=e[0])==null?void 0:s.scale)===PR||((a=t[0])==null?void 0:a.scale)===PR)&&(e.length>1||t.length>1)&&r<=0)&&i5e(e[0].effects,t[0].effects)}function z7t(e,t,r){var l,c;const i=e.length>t.length?e:t,n=e.length>t.length?t:e,s=n[n.length-1],a=(l=s==null?void 0:s.scale)!=null?l:r,o=(c=s==null?void 0:s.effects)!=null?c:[];for(let u=n.length;u<i.length;u++)n.push({scale:a,effects:[...o]});for(let u=0;u<i.length;u++)n[u].scale=n[u].scale===PR?r:n[u].scale,i[u].scale=i[u].scale===PR?r:i[u].scale,n5e(n[u].effects,i[u].effects)}function U7t(e,t,r){return e+(t-e)*r}function B7t(e){const t=e[0];return!!t&&"type"in t}d([f()],M0.prototype,"_to",void 0),d([f()],M0.prototype,"duration",void 0),d([f({value:""})],M0.prototype,"effect",null),d([f({readOnly:!0})],M0.prototype,"effects",void 0),d([f({readOnly:!0})],M0.prototype,"hasEffects",null),d([f({value:0})],M0.prototype,"scale",null),d([f({readOnly:!0})],M0.prototype,"transitioning",null),M0=d([$("esri.layers.effects.EffectView")],M0);function WDt(e){var r;const t=e.layer;return"floorInfo"in t&&((r=t.floorInfo)==null?void 0:r.floorField)&&"floors"in e.view?XPe(e.view.floors,t.floorInfo.floorField):null}function y1e(e,t){var r;return"floorInfo"in t&&((r=t.floorInfo)==null?void 0:r.floorField)?XPe(e,t.floorInfo.floorField):null}function XPe(e,t){if(!(e!=null&&e.length))return null;const r=e.filter(i=>i!=="").map(i=>`'${i}'`);return r.push("''"),`${t} IN (${r.join(",")}) OR ${t} IS NULL`}function XDt(e,t,r){return t.flatten(({sublayers:n})=>n).length!==e.length?!0:!!e.some(n=>n.originIdOf("minScale")>r||n.originIdOf("maxScale")>r||n.originIdOf("renderer")>r||n.originIdOf("labelingInfo")>r||n.originIdOf("opacity")>r||n.originIdOf("labelsVisible")>r||n.originIdOf("source")>r)||!YPe(e,t)}function G7t(e,t,r){return!!e.some(i=>{const n=i.source;return!(!n||n.type==="map-layer"&&n.mapLayerId===i.id&&(R(n.gdbVersion)||n.gdbVersion===r))||i.originIdOf("renderer")>Gt.SERVICE||i.originIdOf("labelingInfo")>Gt.SERVICE||i.originIdOf("opacity")>Gt.SERVICE||i.originIdOf("labelsVisible")>Gt.SERVICE})||!YPe(e,t)}function YPe(e,t){if(!e||!e.length||R(t))return!0;const r=t.slice().reverse().flatten(({sublayers:s})=>s&&s.toArray().reverse()).map(s=>s.id).toArray();if(e.length>r.length)return!1;let i=0;const n=r.length;for(const{id:s}of e){for(;i<n&&r[i]!==s;)i++;if(i>=n)return!1}return!0}function YDt(e){return!!e&&e.some(t=>t.minScale!=null||t.layerDefinition&&t.layerDefinition.minScale!=null)}const j7t={visible:"visibleSublayers",definitionExpression:"layerDefs",labelingInfo:"hasDynamicLayers",labelsVisible:"hasDynamicLayers",opacity:"hasDynamicLayers",minScale:"visibleSublayers",maxScale:"visibleSublayers",renderer:"hasDynamicLayers",source:"hasDynamicLayers"};let Ud=class extends Cm(xe){constructor(e){super(e),this.floors=null,this.scale=0}destroy(){this.layer=null}get dynamicLayers(){if(!this.hasDynamicLayers)return null;const e=this.visibleSublayers.map(t=>{const r=y1e(this.floors,t);return t.toExportImageJSON(r)});return e.length?JSON.stringify(e):null}get hasDynamicLayers(){return this.layer&&G7t(this.visibleSublayers,this.layer.serviceSublayers,this.layer.gdbVersion)}set layer(e){this._get("layer")!==e&&(this._set("layer",e),this.handles.remove("layer"),e&&this.handles.add([e.allSublayers.on("change",()=>this.notifyChange("visibleSublayers")),e.on("sublayer-update",t=>this.notifyChange(j7t[t.propertyName]))],"layer"))}get layers(){const e=this.visibleSublayers;return e?e.length?"show:"+e.map(t=>t.id).join(","):"show:-1":null}get layerDefs(){var r;const e=!!((r=this.floors)!=null&&r.length),t=this.visibleSublayers.filter(i=>i.definitionExpression!=null||e&&i.floorInfo!=null);return t.length?JSON.stringify(t.reduce((i,n)=>{const s=y1e(this.floors,n),a=F6e(s,n.definitionExpression);return _(a)&&(i[n.id]=a),i},{})):null}get version(){this.commitProperty("layers"),this.commitProperty("layerDefs"),this.commitProperty("dynamicLayers"),this.commitProperty("timeExtent");const e=this.layer;return e&&(e.commitProperty("dpi"),e.commitProperty("imageFormat"),e.commitProperty("imageTransparency"),e.commitProperty("gdbVersion")),(this._get("version")||0)+1}get visibleSublayers(){const e=[];if(!this.layer)return e;const t=this.layer.sublayers,r=n=>{const s=this.scale,a=s===0,o=n.minScale===0||s<=n.minScale,l=n.maxScale===0||s>=n.maxScale;n.visible&&(a||o&&l)&&(n.sublayers?n.sublayers.forEach(r):e.unshift(n))};t&&t.forEach(r);const i=this._get("visibleSublayers");return!i||i.length!==e.length||i.some((n,s)=>e[s]!==n)?e:i}toJSON(){const e=this.layer;let t={dpi:e.dpi,format:e.imageFormat,transparent:e.imageTransparency,gdbVersion:e.gdbVersion||null};return this.hasDynamicLayers&&this.dynamicLayers?t.dynamicLayers=this.dynamicLayers:t={...t,layers:this.layers,layerDefs:this.layerDefs},t}};d([f({readOnly:!0})],Ud.prototype,"dynamicLayers",null),d([f()],Ud.prototype,"floors",void 0),d([f({readOnly:!0})],Ud.prototype,"hasDynamicLayers",null),d([f()],Ud.prototype,"layer",null),d([f({readOnly:!0})],Ud.prototype,"layers",null),d([f({readOnly:!0})],Ud.prototype,"layerDefs",null),d([f({type:Number})],Ud.prototype,"scale",void 0),d([f(cit)],Ud.prototype,"timeExtent",void 0),d([f({readOnly:!0})],Ud.prototype,"version",null),d([f({readOnly:!0})],Ud.prototype,"visibleSublayers",null),Ud=d([$("esri.layers.mixins.ExportImageParameters")],Ud);function ZPe(e){return R(e)||e.type==="simple"||e.type==="unique-value"||e.type==="class-breaks"||e.type==="dictionary"||e.type==="heatmap"}function ZDt(e){if(R(e))return null;if(!ZPe(e))return new k("renderer-conversion-3d:unsupported-renderer",`Unsupported renderer of type '${e.type||e.declaredClass}'`,{renderer:e});switch(e.type){case"simple":return q7t(e);case"unique-value":return H7t(e);case"class-breaks":return W7t(e);case"dictionary":case"heatmap":return null}return null}function foe(e,t){if(!t)return null;let r;if(r=Array.isArray(t)?t:[t],r.length>0){const i=r.map(s=>s.details.symbol.type||s.details.symbol.declaredClass).filter(s=>!!s);i.sort();const n=[];return i.forEach((s,a)=>{a!==0&&s===i[a-1]||n.push(s)}),new k("renderer-conversion-3d:unsupported-symbols",`Renderer contains symbols (${n.join(", ")}) which are not supported in 3D`,{renderer:e,symbolErrors:r})}return null}function q7t(e){return foe(e,l9(e.symbol).error)}function H7t(e){const t=e.uniqueValueInfos.map(i=>l9(i.symbol).error).filter(i=>!!i),r=l9(e.defaultSymbol);return r.error&&t.unshift(r.error),foe(e,t)}function W7t(e){const t=e.classBreakInfos.map(i=>l9(i.symbol).error).filter(i=>!!i),r=l9(e.defaultSymbol);return r.error&&t.unshift(r.error),foe(e,t)}const X7t=(e,t)=>{const r=e.featuresTilingScheme.getClosestInfoForScale(e.scale).level;return t!=null&&t.levels?t.levels[r]:null};function Y7t(e,t){if(!e||!("visualVariables"in e)||!e.visualVariables)return null;const r=e.visualVariables.find(n=>n.type==="size"),i=X7t(t,r);return i?new bm({field:r.field,minSize:i[2].size,minDataValue:i[2].value,maxSize:i[3].size,maxDataValue:i[3].value}):null}function QPe(e,t,r,i){return e.name?e.styleName&&e.styleName==="Esri2DPointSymbolsStyle"?Z7t(e,t,i):P6e(e,t,i).then(n=>JPe(n,e.name,t,r,i)):Promise.reject(new k("symbolstyleutils:style-symbol-reference-name-missing","Missing name in style symbol reference"))}function JPe(e,t,r,i,n){const s=e.data,a=r&&_(r.portal)?r.portal:Cs.getDefault(),o={portal:a,url:pn(e.baseUrl),origin:"portal-item"},l=s.items.find(m=>m.name===t);if(!l){const m=`The symbol name '${t}' could not be found`;return Promise.reject(new k("symbolstyleutils:symbol-name-not-found",m,{symbolName:t}))}let c=My(Crt(l,i),o),u=l.thumbnail&&l.thumbnail.href;const h=l.thumbnail&&l.thumbnail.imageData;y_t()&&(c=pK(c),u=pK(u));const p={portal:a,url:pn(jte(c)),origin:"portal-item"};return yne(c,n).then(m=>{const g=i==="cimRef"?I6e(m.data):m.data,b=x6e(g,p);if(b&&hm(b)){if(u){const w=My(u,o);b.thumbnail=new aw({url:w})}else h&&(b.thumbnail=new aw({url:`data:image/png;base64,${h}`}));e.styleUrl?b.styleOrigin=new pA({portal:r.portal,styleUrl:e.styleUrl,name:t}):e.styleName&&(b.styleOrigin=new pA({portal:r.portal,styleName:e.styleName,name:t}))}return b})}function Z7t(e,t,r){const i=Art.replace(/\{SymbolName\}/gi,e.name),n=_(t.portal)?t.portal:Cs.getDefault();return yne(i,r).then(s=>{const a=I6e(s.data);return x6e(a,{portal:n,url:pn(jte(i)),origin:"portal-item"})})}const Q7t=Object.freeze(Object.defineProperty({__proto__:null,fetchSymbolFromStyle:JPe,resolveWebStyleSymbol:QPe},Symbol.toStringTag,{value:"Module"})),$3=la.size,VD=la.maxSize,poe=la.maxOutlineSize,b1e=la.lineWidth,eee=la.tallSymbolWidth,J7t=fe.getLogger("esri.symbols.support.previewSymbol3D");function I4(e){const t=e.outline,r=_(e.material)?e.material.color:null,i=_(r)?r.toHex():null;if(R(t)||"pattern"in t&&_(t.pattern)&&t.pattern.type==="style"&&t.pattern.style==="none")return e.type==="fill"&&i==="#ffffff"?{color:"#bdc3c7",width:.75}:null;const n=ur(t.size)||0;return{color:"rgba("+(_(t.color)?t.color.toRgba():"255,255,255,1")+")",width:Math.min(n,poe),style:"pattern"in t&&_(t.pattern)&&t.pattern.type==="style"?zie(t.pattern.style):null,join:"butt",cap:"patternCap"in t?t.patternCap:"butt"}}function K7t(e,t){const r=t&&t.resource,i=r&&r.href;if(e.thumbnail&&e.thumbnail.url)return Promise.resolve(e.thumbnail.url);if(i&&t.type!=="object")return Promise.resolve(h5e(e,t));const n=xr("esri/images/Legend/legend3dsymboldefault.png");return e.styleOrigin&&(e.styleOrigin.styleName||e.styleOrigin.styleUrl)?QPe(e.styleOrigin,{portal:e.styleOrigin.portal},"webRef").catch(s=>s).then(s=>{var a;return((a=s==null?void 0:s.thumbnail)==null?void 0:a.url)||n}):Promise.resolve(n)}function BH(e,t=1){const r=e.a,i=kne(e),n=i.h,s=i.s/t,a=100-(100-i.v)/t,{r:o,g:l,b:c}=gO({h:n,s,v:a});return[o,l,c,r]}function Nk(e){return e.type==="water"?R(e.color)?null:e.color:R(e.material)||R(e.material.color)?null:e.material.color}function Ri(e,t=0){const r=Nk(e);if(!r){if(e.type==="fill")return null;const n=GZe.r,s=$v(n,t);return[s,s,s,100]}const i=r.toRgba();for(let n=0;n<3;n++)i[n]=$v(i[n],t);return i}async function KPe(e,t){const r=e.style;return r==="none"?null:{type:"pattern",x:0,y:0,src:await BZe(xr(`esri/symbols/patterns/${r}.png`),t.toCss(!0)),width:5,height:5}}function v1e(e){return e.outline?I4(e):{color:"rgba(0, 0, 0, 1)",width:1.5}}function eIe(e,t){const r=Nk(e);if(!r)return null;let i="rgba(";return i+=$v(r.r,t)+",",i+=$v(r.g,t)+",",i+=$v(r.b,t)+",",i+r.a+");"}function tee(e,t){const r=eIe(e,t);return r?"pattern"in e&&_(e.pattern)&&e.pattern.type==="style"&&e.pattern.style==="none"?null:{color:r,width:Math.min(e.size?ur(e.size):.75,poe),style:"pattern"in e&&_(e.pattern)&&e.pattern.type==="style"?zie(e.pattern.style):null,cap:"cap"in e?e.cap:null,join:"join"in e?e.join==="miter"?ur(2):e.join:null}:{}}function y$(e,t,r){const i=.75*r;return{type:"linear",x1:i?.25*i:0,y1:i?.5*i:0,x2:i||4,y2:i?.5*i:4,colors:[{color:e,offset:0},{color:t,offset:1}]}}function eAt(e){const t=e.depth,r=e.height,i=e.width;return i&&t&&r&&i===t&&i<r}function tAt(e,t,r){const i=[];if(!e)return i;switch(e.type){case"icon":{const a=t,o=t;switch(e.resource&&e.resource.primitive||zxe){case"circle":i.push({shape:{type:"circle",cx:0,cy:0,r:.5*t},fill:Ri(e,0),stroke:I4(e)});break;case"square":i.push({shape:{type:"path",path:[{command:"M",values:[0,o]},{command:"L",values:[0,0]},{command:"L",values:[a,0]},{command:"L",values:[a,o]},{command:"Z",values:[]}]},fill:Ri(e,0),stroke:I4(e)});break;case"triangle":i.push({shape:{type:"path",path:[{command:"M",values:[0,o]},{command:"L",values:[.5*a,0]},{command:"L",values:[a,o]},{command:"Z",values:[]}]},fill:Ri(e,0),stroke:I4(e)});break;case"cross":i.push({shape:{type:"path",path:[{command:"M",values:[.5*a,0]},{command:"L",values:[.5*a,o]},{command:"M",values:[0,.5*o]},{command:"L",values:[a,.5*o]}]},stroke:v1e(e)});break;case"x":i.push({shape:{type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[a,o]},{command:"M",values:[a,0]},{command:"L",values:[0,o]}]},stroke:v1e(e)});break;case"kite":i.push({shape:{type:"path",path:[{command:"M",values:[0,.5*o]},{command:"L",values:[.5*a,0]},{command:"L",values:[a,.5*o]},{command:"L",values:[.5*a,o]},{command:"Z",values:[]}]},fill:Ri(e,0),stroke:I4(e)})}break}case"object":switch(e.resource&&e.resource.primitive||Nre){case"cone":{const n=y$(Ri(e,0),Ri(e,-.6),r?eee:t),s=Int(t,r);i.push({shape:s[0],fill:n}),i.push({shape:s[1],fill:n});break}case"inverted-cone":{const n=Ri(e,0),s=y$(n,Ri(e,-.6),t),a=$nt(t);i.push({shape:a[0],fill:s}),i.push({shape:a[1],fill:n});break}case"cube":{const n=Mnt(t,r);i.push({shape:n[0],fill:Ri(e,0)}),i.push({shape:n[1],fill:Ri(e,-.3)}),i.push({shape:n[2],fill:Ri(e,-.5)});break}case"cylinder":{const n=y$(Ri(e,0),Ri(e,-.6),r?eee:t),s=Pnt(t,r);i.push({shape:s[0],fill:n}),i.push({shape:s[1],fill:n}),i.push({shape:s[2],fill:Ri(e,0)});break}case"diamond":{const n=Lnt(t);i.push({shape:n[0],fill:Ri(e,-.3)}),i.push({shape:n[1],fill:Ri(e,0)}),i.push({shape:n[2],fill:Ri(e,-.3)}),i.push({shape:n[3],fill:Ri(e,-.7)});break}case"sphere":{const n=y$(Ri(e,0),Ri(e,-.6));n.x1=0,n.y1=0,n.x2=.25*t,n.y2=.25*t,i.push({shape:{type:"circle",cx:0,cy:0,r:.5*t},fill:n});break}case"tetrahedron":{const n=Dnt(t);i.push({shape:n[0],fill:Ri(e,-.3)}),i.push({shape:n[1],fill:Ri(e,0)}),i.push({shape:n[2],fill:Ri(e,-.6)});break}}break}return i}function nB(e){const t=typeof(e==null?void 0:e.size)=="number"?e==null?void 0:e.size:null;return t?ur(t):null}function rAt(e){return e.type==="icon"?"multiply":"tint"}function iAt(e,t){const r=nB(t),i=t&&t.maxSize?ur(t.maxSize):null,n=t&&t.disableUpsampling,s=e.symbolLayers,a=[];let o=0,l=0;const c=s.getItemAt(s.length-1);let u;return c&&c.type==="icon"&&(u=c.size&&ur(c.size)),s.forEach(h=>{var g;if(h.type!=="icon"&&h.type!=="object")return;const p=h.type==="icon"?h.size&&ur(h.size):0,m=r||p?Math.ceil(Math.min(r||p,i||VD)):$3;if(h&&h.resource&&h.resource.href){const b=K7t(e,h).then(w=>{const v=h.get("material.color"),x=rAt(h);return Ost(w,m,v,x,n)}).then(w=>{const v=w.width,x=w.height;return o=Math.max(o,v),l=Math.max(l,x),[{shape:{type:"image",x:0,y:0,width:v,height:x,src:w.url},fill:null,stroke:null}]});a.push(b)}else{let b=m;h.type==="icon"&&u&&r&&(b=m*(p/u));const w=(t==null?void 0:t.symbolConfig)==="tall"||((g=t==null?void 0:t.symbolConfig)==null?void 0:g.isTall)||h.type==="object"&&eAt(h);o=Math.max(o,w?eee:b),l=Math.max(l,b),a.push(Promise.resolve(tAt(h,b,w)))}}),dn(a).then(h=>{const p=[];return h.forEach(m=>{m.value?p.push(m.value):m.error&&J7t.warn("error while building swatchInfo!",m.error)}),yO(p,[o,l],{node:t&&t.node,scale:!1,opacity:t&&t.opacity})})}function nAt(e,t){const r=e.symbolLayers,i=[],n=lz(e),s=nB(t),a=(t&&t.maxSize?ur(t.maxSize):null)||poe;let o,l=0,c=0;return r.forEach((u,h)=>{if(!u||u.type!=="line"&&u.type!=="path")return;const p=[];switch(u.type){case"line":{const m=tee(u,0);if(R(m))break;const g=m&&m.width||0;h===0&&(o=g);const b=Math.min(s||g,a),w=h===0?b:s?b*(g/o):b,v=w>b1e/2?2*w:b1e;c=Math.max(c,w),l=Math.max(l,v),m.width=w,p.push({shape:{type:"path",path:[{command:"M",values:[0,.5*c]},{command:"L",values:[l,.5*c]}]},stroke:m});break}case"path":{const m=Math.min(s||$3,a),g=Ri(u,0),b=Ri(u,-.2),w=eIe(u,-.4),v=w?{color:w,width:1}:{};if(u.profile==="quad"){const x=u.width,T=u.height,E=Ant(x&&T?x/T:1,T===0,x===0),C={...v,join:"bevel"};p.push({shape:E[0],fill:b,stroke:C}),p.push({shape:E[1],fill:b,stroke:C}),p.push({shape:E[2],fill:g,stroke:C})}else p.push({shape:hJ.pathSymbol3DLayer[0],fill:b,stroke:v}),p.push({shape:hJ.pathSymbol3DLayer[1],fill:g,stroke:v});c=Math.max(c,m),l=c}}i.push(p)}),Promise.resolve(yO(i,[l,c],{node:t&&t.node,scale:n,opacity:t&&t.opacity}))}async function sAt(e,t){const r=e.type==="mesh-3d",i=e.symbolLayers,n=nB(t),s=t&&t.maxSize?ur(t.maxSize):null,a=n||$3,o=[];let l=0,c=0,u=!1;for(let h=0;h<i.length;h++){const p=i.getItemAt(h),m=[];if(r&&p.type!=="fill")continue;const g=hJ.fill[0];switch(p.type){case"fill":{const b=I4(p),w=Math.min(a,s||VD);l=Math.max(l,w),c=Math.max(c,w),u=!0;let v=Ri(p,0);const x="pattern"in p&&p.pattern,T=Nk(p);!r&&_(x)&&x.type==="style"&&x.style!=="solid"&&T&&(v=await KPe(x,T)),m.push({shape:g,fill:v,stroke:b});break}case"line":{const b=tee(p,0);if(R(b))break;const w={stroke:b,shape:g};l=Math.max(l,$3),c=Math.max(c,$3),m.push(w);break}case"extrude":{const b={join:"round",width:1,...tee(p,-.4)},w=Ri(p,0),v=Ri(p,-.2),x=Math.min(a,s||VD),T=Rnt(x);b.width=1,m.push({shape:T[0],fill:v,stroke:b}),m.push({shape:T[1],fill:v,stroke:b}),m.push({shape:T[2],fill:w,stroke:b});const E=$3,C=.7*$3+.5*x;l=Math.max(l,E),c=Math.max(c,C);break}case"water":{const b=Nk(p),w=BH(b),v=BH(b,2),x=BH(b,3),T=Ont();u=!0,m.push({shape:T[0],fill:w}),m.push({shape:T[1],fill:v}),m.push({shape:T[2],fill:x});const E=Math.min(a,s||VD);l=Math.max(l,E),c=Math.max(c,E);break}}o.push(m)}return yO(o,[l,c],{node:t&&t.node,scale:u,opacity:t&&t.opacity})}function aAt(e,t){if(e.symbolLayers.length===0)return Promise.reject(new k("symbolPreview: renderPreviewHTML3D","No symbolLayers in the symbol."));switch(e.type){case"point-3d":return iAt(e,t);case"line-3d":return nAt(e,t);case"polygon-3d":case"mesh-3d":return sAt(e,t)}return Promise.reject(new k("symbolPreview: swatchInfo3D","symbol not supported."))}const oAt=Object.freeze(Object.defineProperty({__proto__:null,getPatternDescriptor:KPe,getSizeFromOptions:nB,getSymbolLayerFill:Ri,previewSymbol3D:aAt},Symbol.toStringTag,{value:"Module"})),_1e={HH:315,HL:45,LL:135,LH:225},lAt={2:[["HL","HH"],["LL","LH"]],3:[["HL","HM","HH"],["ML","MM","MH"],["LL","LM","LH"]],4:[["HL","HM1","HM2","HH"],["M2L","M2M1","M2M2","M2H"],["M1L","M1M1","M1M2","M1H"],["LL","LM1","LM2","LH"]]};function cAt(e){if(!e)return;const{type:t}=e;if(t.includes("3d"))return Ri(e.symbolLayers.getItemAt(0));if(t==="simple-line"){const r=xA(e);return r&&r.color}if(e.type==="simple-marker"&&(e.style==="x"||e.style==="cross")){const r=xA(e);return r&&r.color}return UZe(e)}function dAt(e,t){const r=t.HH.label,i=t.LL.label,n=t.HL.label,s=t.LH.label;switch(e){case"HH":default:return{top:r,bottom:i,left:n,right:s};case"HL":return{top:n,bottom:s,left:i,right:r};case"LL":return{top:i,bottom:r,left:s,right:n};case"LH":return{top:s,bottom:n,left:r,right:i}}}function uAt(e){const{focus:t,infos:r,numClasses:i}=e,n=lAt[i],s={};r.forEach(o=>{s[o.value]={label:o.label,fill:cAt(o.symbol)}});const a=[];for(let o=0;o<i;o++){const l=[];for(let c=0;c<i;c++){const u=s[n[o][c]];l.push(u.fill)}a.push(l)}return{type:"relationship-ramp",numClasses:i,focus:t,colors:a,labels:dAt(t,s),rotation:tIe(t)}}function tIe(e){let t=_1e[e];return e&&t==null&&(t=_1e.HH),t||0}const ree=30,iee=12,rIe=[255,255,255],iIe=[200,200,200],$4=[128,128,128],hAt=20,fAt=5;function pAt(e){return e.declaredClass==="esri.symbols.SimpleMarkerSymbol"}function mAt(e){return e.declaredClass==="esri.symbols.PictureMarkerSymbol"}function gAt(e){return e.declaredClass==="esri.symbols.SimpleLineSymbol"}function yAt(e){return e.declaredClass==="esri.symbols.TextSymbol"}function bAt(e,t){const r=e.length-1;return e.map((i,n)=>y5e(i,n,r,t))}async function vAt(e,t,r,i,n,s){const a=t.legendOptions,o=a&&a.customValues,l=await xAt(e,r),c=!!l,u=!!o,h=t.minSize!=null&&t.maxSize!=null,p=t.stops&&t.stops.length>1,m=!!t.target;if(!c||!u&&!(h||p&&!m))return;const g=lz(l);let b=null,w=null,v=null;w=g&&!p?mN([t.minDataValue,t.maxDataValue]):o||await SAt(t,l,i,n);const x=e==null?void 0:e.authoringInfo,T=(x==null?void 0:x.type)==="univariate-color-size",E=T&&(x==null?void 0:x.univariateTheme)==="above-and-below";if(!w&&p&&(w=t.stops.map(I=>I.value),b=t.stops.some(I=>!!I.label),e.type==="flow"&&(w=mN(w)),b&&(v=t.stops.map(I=>I.label))),g&&(w==null?void 0:w.length)>2&&!E&&(w=[w[0],w[w.length-1]]),!w)return null;T&&(w==null?void 0:w.length)!==5&&(w=aIe({minSize:w[0],maxSize:w[w.length-1]}));const C=g?_At(e,w):null,A=HZe(l),P=b?null:bAt(w,s);return(await Promise.all(w.map(async(I,L)=>{const V=g?C[L]:await GS(t,l,I,i,n);return{value:I,symbol:AAt(E&&e.type==="class-breaks"?wAt(e,L):l,V),label:b?v[L]:P[L],size:V,outlineSize:A}}))).reverse()}function _At(e,t){const r=e==null?void 0:e.authoringInfo,i=(r==null?void 0:r.type)==="univariate-color-size";let n=[iee,ree];if(i){const s=t[0],a=t[t.length-1],o=iee,l=ree;n=t.map(c=>o+(c-s)/(a-s)*(l-o))}return i&&(r==null?void 0:r.univariateTheme)==="below"&&n.reverse(),n}function wAt(e,t){const r=e.classBreakInfos,i=r.length,n=i<2||!(t>=2)?r[0].symbol.clone():r[i-1].symbol.clone();return e.visualVariables.some(s=>s.type==="color")&&(n.type.includes("3d")?nIe(n):sIe(n)),n}async function xAt(e,t){var n;if(e.type==="flow")return b5e(e,t);if(e.type==="pie-chart")return new nc({color:null,outline:(n=e.outline)!=null&&n.width?e.outline:new bc});let r=null,i=null;if(e.type==="simple")r=e.symbol;else if(e.type==="class-breaks"){const s=e.classBreakInfos;r=s&&s[0]&&s[0].symbol,i=s.length>1}else if(e.type==="unique-value"){const s=e.uniqueValueInfos;r=s&&s[0]&&s[0].symbol,i=s.length>1}return!r||TAt(r)?null:(r=r.clone(),(t||i)&&(r.type.includes("3d")?nIe(r):sIe(r)),r)}function TAt(e){return e?hm(e)?!!e.symbolLayers&&e.symbolLayers.some(t=>t&&t.type==="fill"):e.type.includes("fill"):!1}function nIe(e){e.type==="line-3d"?e.symbolLayers.forEach(t=>{t.material={color:$4}}):e.symbolLayers.forEach(t=>{t.type!=="icon"||t.resource&&t.resource.href?t.material={color:iIe}:(t.material={color:rIe},t.outline={color:$4,size:1.5})})}function sIe(e){var r,i;const t=Pie();e.type==="cim"?l5e(e,new Te(iIe)):e.type.includes("line")?e.color=$4:(e.color=t?$4:rIe,e.type==="simple-marker"&&(e.outline?((i=(r=e.outline)==null?void 0:r.color)==null?void 0:i.toHex())==="#ffffff"&&(e.outline.color=$4):e.outline={color:$4,width:1.5}))}async function SAt(e,t,r,i){const n=(await ie(()=>Promise.resolve().then(()=>Px),void 0,import.meta.url)).getSizeRangeAtScale(e,r,i),s=n&&aIe(n);if(!n&&!s)return;let a=s.map(o=>EAt(o,e,n));a=mN(a);for(let o=1;o<a.length-1;o++){const l=await CAt(e,t,a[o],a[o-1],r,i);l&&(a[o]=l[0],s[o]=l[1])}return a}function aIe(e){const t=e.minSize,r=e.maxSize,i=fAt,n=(r-t)/(i-1),s=[];for(let a=0;a<i;a++)s.push(t+n*a);return s}function EAt(e,t,r){const i=r.minSize,n=r.maxSize,s=t.minDataValue,a=t.maxDataValue;let o=null;return e<=i?o=s:e>=n?o=a:o=(e-i)/(n-i)*(a-s)+s,o}async function CAt(e,t,r,i,n,s){const a=await GS(e,t,r,n,s),o=await GS(e,t,i,n,s),l=pN(r),c=l.fractional,u=hAt;let h=l.integer,p=null,m=null;r>0&&r<1&&(p=10**c,h=pN(r*=p).integer);for(let g=h-1;g>=0;g--){const b=10**g;let w=Math.floor(r/b)*b,v=Math.ceil(r/b)*b;p!=null&&(w/=p,v/=p);let x=(w+v)/2;[,x]=mN([w,x,v],{indexes:[1]});const T=await GS(e,t,w,n,s),E=await GS(e,t,v,n,s),C=await GS(e,t,x,n,s),A=_L(a,T,o,null),P=_L(a,E,o,null),I=_L(a,C,o,null);let L=A.previous<=u,V=P.previous<=u;if(L&&V&&(A.previous<=P.previous?(L=!0,V=!1):(V=!0,L=!1)),L?m=[w,T]:V?m=[v,E]:I.previous<=u&&(m=[x,C]),m)break}return m}async function GS(e,t,r,i,n){const{getSize:s}=await ie(()=>Promise.resolve().then(()=>Px),void 0,import.meta.url);return s(e,r,{scale:i,view:n,shape:t.type==="simple-marker"?t.style:null})}function AAt(e,t){const r=e.clone();if(hm(r))lz(r)||r.symbolLayers.forEach(i=>{i.type!=="fill"&&(i.size=t)});else if(pAt(r))r.size=t;else if(mAt(r)){const i=r.width,n=r.height;r.height=t,r.width=t*(i/n)}else gAt(r)?r.width=t:yAt(r)&&r.font&&(r.font.size=t);return r}function RAt(e){const r=Math.floor(Math.log10(Math.abs(e)))+1,i=r<4||r>6?4:r,n=1e6,s=Math.abs(e)>=n?"compact":"standard";return Xh(e,{notation:s,minimumSignificantDigits:2,maximumSignificantDigits:i})}const Gb=fe.getLogger("esri.widgets.Legend.support.ActiveLayerInfo"),OAt="https://utility.arcgis.com/sharing/tools/legend",MAt="esri.layers.ImageryLayer",PAt="esri.layers.ImageryTileLayer",IAt="esri.layers.WCSLayer",b$=/^\s*(return\s+)?\$view\.scale\s*(;)?\s*$/i,$At=new tr({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryMultiPatch:"multipatch"}),w1e={u1:[0,1],u2:[0,3],u4:[0,15],u8:[0,255],s8:[-128,127],u16:[0,65535],s16:[-32768,32767],u32:[0,4294967295],s32:[-2147483648,2147483647],f32:[-34e38,34e38],f64:[-Number.MAX_VALUE,Number.MAX_VALUE]},v$=new nc({size:6,outline:{color:[128,128,128,.5],width:.5}}),LAt=new kp({style:"solid"});function nee(e){return e.type==="flow"}function oIe(e){return e.type==="vector-field"}function lIe(e){return e.type==="raster-colormap"}function cIe(e){return e.type==="raster-stretch"}function dIe(e){return e.type==="raster-shaded-relief"}function jS(e){return e.declaredClass==="esri.renderers.SimpleRenderer"}function qS(e){return e.declaredClass==="esri.renderers.ClassBreaksRenderer"}function see(e){return e.declaredClass==="esri.renderers.UniqueValueRenderer"}function uIe(e){return e.declaredClass==="esri.renderers.HeatmapRenderer"}function DAt(e){return moe(e)||goe(e)||yoe(e)||FAt(e)}function FAt(e){return e.declaredClass==="esri.renderers.PointCloudRGBRenderer"}function moe(e){return e.declaredClass==="esri.renderers.PointCloudClassBreaksRenderer"}function goe(e){return e.declaredClass==="esri.renderers.PointCloudStretchRenderer"}function yoe(e){return e.declaredClass==="esri.renderers.PointCloudUniqueValueRenderer"}function hIe(e){return e.declaredClass==="esri.renderers.DotDensityRenderer"}function fIe(e){return e.declaredClass==="esri.renderers.PieChartRenderer"}function NAt(e,t){return jS(e)||qS(e)||see(e)||uIe(e)||hIe(e)||fIe(e)?t.type==="2d"||ZPe(e):cIe(e)||lIe(e)||dIe(e)||moe(e)||goe(e)||yoe(e)||oIe(e)||nee(e)}function x1e(e){return e.declaredClass==="esri.layers.BuildingSceneLayer"}function kAt(e){return e.declaredClass==="esri.layers.VoxelLayer"}function VAt(e){return e.declaredClass==="esri.layers.WMSLayer"}function zAt(e){return e.declaredClass==="esri.layers.WMTSLayer"}function T1e(e){return e.declaredClass==="esri.layers.MapImageLayer"}function UAt(e){return e.declaredClass==="esri.layers.TileLayer"}function BAt(e){return e.declaredClass==="esri.layers.FeatureLayer"}function Z8(e){return e.declaredClass===MAt}function GH(e){return e.declaredClass===PAt}function GAt(e){return e.declaredClass===IAt}function jAt(e){return e.type==="stretch-ramp"}function qAt(e){var t;return((t="authoringInfo"in e&&(e==null?void 0:e.authoringInfo))==null?void 0:t.type)==="univariate-color-size"}function HAt(e){const t="authoringInfo"in e&&(e==null?void 0:e.authoringInfo);return(t==null?void 0:t.type)==="univariate-color-size"&&(t==null?void 0:t.univariateTheme)==="above-and-below"}const WAt=new nc({style:"path",path:"M10,5 L5,0 0,5 M5,0 L5,15",size:15,outline:{width:1,color:[85,85,85,1]}});let UT={},Zs=class extends xe{constructor(e){super(e),this._handles=new Ft,this._hasColorRamp=!1,this._hasOpacityRamp=!1,this._hasSizeRamp=!1,this._webStyleSymbolCache=new Map,this._dotDensityUrlCache=new Map,this._scaleDrivenSizeVariable=null,this._hasClusterSizeVariable=!1,this.children=new lt,this.layerView=null,this.layer=null,this.legendElements=[],this.parent=null,this.hideLayersNotInCurrentView=!1,this.keepCacheOnDestroy=!1,this.respectLayerVisibility=!0,this.sublayerIds=[],this.title=null,this.view=null}initialize(){const e=()=>this.notifyChange("ready");this._handles.add([rn(()=>this.children,"change",t=>{const{added:r,removed:i}=t,n=this._handles;r.forEach(s=>{const a=`activeLayerInfo-ready-watcher-${s.layer.uid}`;n.add(re(()=>s.ready,e,Ot),a)}),i.forEach(s=>n.remove(s.layer.uid)),e()})]),this.keepCacheOnDestroy||(UT={})}destroy(){this._handles.destroy(),this._handles=null,this._webStyleSymbolCache=null,this._dotDensityUrlCache=null,this._scaleDrivenSizeVariable=null,this.keepCacheOnDestroy||(UT=null)}get effectList(){const e=this.layer;let t=null;return"effect"in e&&e.effect&&(t=new M0,t.effect=e.effect,t.end(),t.scale=this.scale),t}get opacity(){var n;const e=this.layer.opacity,t=(n=this.parent)==null?void 0:n.opacity,r=this.layer.parent,i=r&&"uid"in r?this._getParentLayerOpacity(r):null;return t!=null?t*e:i!=null?i*e:e}get ready(){return this.layer===null||(this.children.length>0?this._isGroupActive():this.legendElements.length>0)}get scale(){return this.view&&this.view.scale}get isScaleDriven(){const e=this.layer;if(e===null)return!1;if("effect"in e&&e.effect&&Array.isArray(e.effect))return!0;if("featureReduction"in e&&e.featureReduction){if(e.featureReduction.type==="cluster")return!0;if(e.featureReduction.type==="binning"&&"renderer"in e.featureReduction&&e.featureReduction.renderer)return this._isRendererScaleDriven(e.featureReduction.renderer)}return"renderer"in e&&e.renderer?this._isRendererScaleDriven(e.renderer):this._isLayerScaleDriven(this.layer)}get version(){return this._get("version")+1}async buildLegendElementsForFeatureCollections(e){if(!(!this.hideLayersNotInCurrentView||await this._isLayerInCurrentView()))return this.legendElements=[],void this.notifyChange("ready");const t=Array.from(e,r=>{if(BAt(r))return this._getRendererLegendElements(r.renderer,{title:r.title});if(r.featureSet&&r.featureSet.features.length){const i=r.layerDefinition,n=i&&i.drawingInfo,s=n&&$6e(n.renderer),a=$At.read(i.geometryType);return s?this._getRendererLegendElements(s,{title:r.name,geometryType:a}):(Gb.warn("drawingInfo not available!"),null)}return null});try{const r=[];await dn(t).then(i=>{i.forEach(({value:n})=>n&&r.push(...n))}),this.legendElements=r,this.notifyChange("ready")}catch(r){Gb.warn("error while building legend for layer!",r)}}async buildLegendElementsForRenderer(e){try{const t=!this.hideLayersNotInCurrentView||await this._isLayerInCurrentView();this.legendElements=t?await this._getRendererLegendElements(e):[],this.notifyChange("ready")}catch(t){Gb.warn("error while building legend for layer!",t)}}async buildLegendElementsForTools(){var t,r;const e=this.layer;if(kAt(e))this._constructLegendElementsForVoxellayer();else if(zAt(e))this._constructLegendElementsForWMTSlayer();else if(VAt(e))await this._constructLegendElementsForWMSSublayers();else if(x1e(e))await this._constructLegendElementsForBuildingSceneLayer();else if(T1e(e)||UAt(e)||x1e(e))await this._constructLegendElementsForSublayers();else{this._handles.remove("imageryLayers-watcher");let i="default";Z8(e)&&(i=(((t=e==null?void 0:e.renderingRule)==null?void 0:t.functionName)||"default")+"_"+((r=e.bandIds)!=null&&r.length?e.bandIds.join(""):"###")),await this._getLegendLayers(`${e.uid}-${i}`).then(async n=>{this.legendElements=[],this.notifyChange("ready");const s=n.map(async a=>{if(Z8(e)||GH(e)){const l=re(()=>["renderingRule"in e&&e.renderingRule,e.bandIds],()=>qR(async()=>{UT.default=null,e.renderer?await this.buildLegendElementsForRenderer(e.renderer):await this.buildLegendElementsForTools()})());this._handles.add(l,"imageryLayers-watcher")}const o=this._generateSymbolTableElementForLegendLayer(a);o&&o.infos.length&&(Z8(e)&&(o.title=e.title),this.legendElements.push(o)),this.notifyChange("ready")});await dn(s)}).catch(n=>{Gb.warn("Request to server for legend has failed!",n)})}}async _isLayerInCurrentView(){const e=this.layer,t=this.layerView,r=t&&"createQuery"in t&&"queryFeatureCount"in t;if(!r&&!(t&&"createQuery"in e&&"queryFeatureCount"in e))return!0;await td(()=>!t.updating);const i=r?"createQuery"in t&&t.createQuery():"createQuery"in e&&e.createQuery();return i.geometry=this.view.extent,(r?"queryFeatureCount"in t&&await t.queryFeatureCount(i):"queryFeatureCount"in e&&await e.queryFeatureCount(i))!==0}_getParentLayerOpacity(e){let t=1;const r=e.parent;return r&&"uid"in r&&(t=this._getParentLayerOpacity(r)),e.opacity*t}_isGroupActive(){const e=this.children;return!!e.length&&e.some(t=>t.ready)}_isRendererScaleDriven(e){if(e.type==="dot-density")return!0;const t="valueExpression"in e&&e.valueExpression;if(b$.test(t))return!0;const r="visualVariables"in e&&e.visualVariables;return!!r&&r.some(i=>this._isScaleDrivenSizeVariable(i))}_isScaleDrivenSizeVariable(e){if(e&&e.type!=="size")return!1;const t=e,r=t.minSize,i=t.maxSize;return typeof r=="object"&&r?this._isScaleDrivenSizeVariable(r):typeof i=="object"&&i?this._isScaleDrivenSizeVariable(i):!!t.expression||b$.test(t.valueExpression)}_isLayerScaleDriven(e){if("minScale"in e&&e.minScale>0||"maxScale"in e&&e.maxScale>0)return!0;if("sublayers"in e&&e.sublayers)return e.sublayers.some(r=>this._isLayerScaleDriven(r));const t=e.parent;if(e.loaded===!1&&t&&T1e(t)&&"source"in e&&e.source&&e.source.type==="map-layer"){for(const r of t.sourceJSON.layers)if(r.id===e.source.mapLayerId&&(r.minScale>0||r.maxScale>0))return!0}return!1}async _constructLegendElementsForVoxellayer(){var s;this.legendElements=[],this._handles.remove("voxel-style-watcher");const e=this.layer;this._handles.add(re(()=>e.currentVariableId,()=>this._constructLegendElementsForVoxellayer()),"voxel-style-watcher");const t=e.getVariableStyle(null),r=[];if(t){if((s=t.uniqueValues)!=null&&s.length){const a=[];t.uniqueValues.forEach(o=>{o.enabled&&a.push({label:o.label||`${o.value}`,value:o.value,symbol:new kp({color:o.color,outline:null})})}),a.length&&r.push({type:"symbol-table",title:t.label,infos:a})}else if(t.transferFunction){const{colorStops:a,stretchRange:o}=t.transferFunction,l=a.toArray().reverse(),c=o.map((h,p)=>`${p===0?m5e:g5e} ${RAt(h)}`).reverse(),u=l.map(h=>({color:h.color,value:null,label:null}));u[0].label=c[0],u[u.length-1].label=c[1],r.push({type:"color-ramp",title:t.label,infos:u,preview:j2(l.map(h=>h.color))})}}const i=e.opacity,n=r.reduce((a,o)=>a.concat(this._getAllInfos(o)),[]).filter(a=>!!(a!=null&&a.symbol)).map(a=>this._getSymbolPreview(a,i));await dn(n),this.legendElements=r,this.notifyChange("ready")}_constructLegendElementsForWMTSlayer(){this.legendElements=[],this._handles.remove("wmts-activeLayer-watcher");const e=this.layer.activeLayer;if(this._handles.add(re(()=>{const{layer:t}=this;return t&&"activeLayer"in t&&t.activeLayer},()=>this._constructLegendElementsForWMTSlayer()),"wmts-activeLayer-watcher"),e.styleId&&e.styles){let t=null;e.styles.some(r=>e.styleId===r.id&&(t=r.legendUrl,!0)),t&&(this.legendElements=[{type:"symbol-table",title:e.title,infos:[{src:t,opacity:this.opacity}]}])}this.notifyChange("ready")}async _constructLegendElementsForWMSSublayers(){this.legendElements=[],this._handles.remove("wms-sublayers-watcher");const e=this.layer;let t=null;(e.customParameters||e.customLayerParameters)&&(t={...e.customParameters,...e.customLayerParameters}),this._handles.add(re(()=>{const{layer:r}=this;return r&&"sublayers"in r&&r.sublayers},()=>this._constructLegendElementsForWMSSublayers()),"wms-sublayers-watcher"),this.legendElements=await this._generateLegendElementsForWMSSublayers(e.sublayers,t),this.notifyChange("ready")}async _generateLegendElementsForWMSSublayers(e,t){const r=[];this._handles.add(e.on("change",()=>this._constructLegendElementsForWMSSublayers()),"wms-sublayers-watcher");const i=e.toArray();for(const n of i){const s=re(()=>[n.title,n.visible,n.legendEnabled],()=>this._constructLegendElementsForWMSSublayers());if(this._handles.add(s,"wms-sublayers-watcher"),!this.respectLayerVisibility||n.visible&&n.legendEnabled){const a=await this._generateSymbolTableElementForWMSSublayer(n,t);a&&a.infos.length&&r.unshift(a)}}return r}async _generateSymbolTableElementForWMSSublayer(e,t){if(!e.legendUrl&&e.sublayers){const r=(await this._generateLegendElementsForWMSSublayers(e.sublayers,t)).filter(i=>i);return{type:"symbol-table",title:e.title,infos:r}}return this._generateSymbolTableElementForLegendUrl(e,t)}async _generateSymbolTableElementForLegendUrl(e,t){var a;let r=e.legendUrl;if(!r)return;const i={type:"symbol-table",title:e.title||e.name||e.id&&e.id+"",infos:[]};t&&(r=B$(r,t));let n=null;const s=(a=e.layer)==null?void 0:a.opacity;try{n=(await qt(r,{responseType:"image"})).data,n&&(n.style.opacity=s)}catch{}return i.infos.push({src:r,preview:n,opacity:s}),i}_getLegendLayers(e,t){const r=UT&&UT[e];return r?Promise.resolve(r):this._legendRequest(t).then(i=>{const n=i.layers;return UT[e]=n,n})}_legendRequest(e){const t=this.layer;let r={f:"json",dynamicLayers:e};if(Z8(t)){const n=t.exportImageServiceParameters.renderingRule;if(n&&(r.renderingRule=JSON.stringify(n.rasterFunctionDefinition||n.toJSON())),t.bandIds&&(r.bandIds=t.bandIds.join()),t.raster||t.viewId||t.customParameters){const{raster:s,viewId:a,customParameters:o}=t;r={raster:s,viewId:a,...r,...o}}}let i=t.url.replace(/(\/)+$/,"");if("version"in t&&t.version>=10.01){const n=i.indexOf("?");n>-1?i=i.substring(0,n)+"/legend"+i.substring(n):i+="/legend"}else{const n=i.toLowerCase().indexOf("/rest/"),s=i.substring(0,n)+i.substring(n+5,i.length);i=OAt+"?soapUrl="+encodeURI(s)+"&returnbytes=true"}return qt(i,{query:r}).then(n=>n.data)}async _constructLegendElementsForBuildingSceneLayer(){this.legendElements=[],this._handles.remove("sublayers-watcher");const e=this.layer;this._handles.add(re(()=>e.sublayers,()=>this._constructLegendElementsForBuildingSceneLayer()),"sublayers-watcher");try{this.legendElements=await this._generateLegendElementsForBuildingSublayers(e.sublayers,this.opacity),this.notifyChange("ready")}catch(t){Gb.warn("Request to server for legend has failed!",t)}}async _generateLegendElementsForBuildingSublayers(e,t){let r=[];this._handles.add(e.on("change",()=>this._constructLegendElementsForBuildingSceneLayer()),"sublayers-watcher");const i=e.toArray();for(const n of i){const s=re(()=>["renderer"in n&&n.renderer,n.opacity,n.title,n.visible],()=>this._constructLegendElementsForBuildingSceneLayer());if(this._handles.add(s,"sublayers-watcher"),!this.respectLayerVisibility||n.visible){const a=n&&n.opacity!=null?n.opacity:null,o=a!=null?a*t:t;if(n.type==="building-group"){const l={type:"symbol-table",title:n.title,infos:[]},c=await this._generateLegendElementsForBuildingSublayers(n.sublayers,o);l.infos.push(...c),r=[l,...r]}else n.renderer&&(r=[...await this._getRendererLegendElements(n.renderer,{title:n.title,opacity:o,sublayer:n}),...r])}}return r.filter(n=>!!n&&(!("infos"in n)||n.infos.length>0))}async _constructLegendElementsForSublayers(){this.legendElements=[],this._handles.remove("sublayers-watcher");const e=this.layer;this._handles.add(re(()=>e.sublayers,()=>this._constructLegendElementsForSublayers),"sublayers-watcher");try{this.legendElements=await this._generateLegendElementsForSublayers(e.sublayers,this.opacity),this.notifyChange("ready")}catch(t){Gb.warn("Request to server for legend has failed!",t)}}async _generateLegendElementsForSublayers(e,t,r){const i=this.layer;let n=[];this._handles.add(e.on("change",()=>this._constructLegendElementsForSublayers()),"sublayers-watcher");let s=e.toArray();!r&&this.sublayerIds&&this.sublayerIds.length&&(s=this.sublayerIds.map(a=>i.findSublayerById(a)).filter(Boolean));for(const a of s){const o=re(()=>[a.renderer,a.opacity,a.title,a.visible,a.legendEnabled],()=>this._constructLegendElementsForSublayers());if(this._handles.add(o,"sublayers-watcher"),!this.respectLayerVisibility||a.visible&&a.legendEnabled&&this._isSublayerInScale(a)){const l=a&&a.opacity!=null?a.opacity:null,c=l!=null?l*t:t;if(a.renderer&&!a.sublayers&&a.originIdOf("renderer")>Gt.SERVICE)await a.load(),n=[...await this._getRendererLegendElements(a.renderer,{title:a.title,opacity:c,sublayer:a}),...n];else{const u=await this._generateSymbolTableElementForSublayer(a,c,r);u&&n.unshift(u)}}}return n.filter(a=>!!a&&(!("infos"in a)||a.infos.length>0))}async _generateSymbolTableElementForSublayer(e,t,r){if(!r){r=new Map;const n=this.layer,s=e.source;let a=null;if(!(!s||s.type==="map-layer"&&s.mapLayerId===e.id&&(!s.gdbVersion||s.gdbVersion===("gdbVersion"in n&&n.gdbVersion)))||e.originIdOf("renderer")>Gt.SERVICE||e.originIdOf("labelingInfo")>Gt.SERVICE||e.originIdOf("labelsVisible")>Gt.SERVICE){const l=new Ud({layer:this.layer});a=l.hasDynamicLayers?l.dynamicLayers:null,l.destroy()}const o=a||`${n.uid}-default`;(await this._getLegendLayers(o,a)).forEach(l=>r.set(l.layerId,l))}const i=r.get(e.id);if((!i||(i==null?void 0:i.subLayerIds)&&i.defaultVisibility)&&e.sublayers){const n=await this._generateLegendElementsForSublayers(e.sublayers,t,r);return{type:"symbol-table",title:e.title,infos:n}}return this._generateSymbolTableElementForLegendLayer(i,e,t)}_generateSymbolTableElementForLegendLayer(e,t,r){var o;if(!e||!e.legend||this.respectLayerVisibility&&!this._isLegendLayerInScale(e,t))return null;const i=t==null?void 0:t.renderer;let n=(t==null?void 0:t.title)||e.layerName;if(i&&(!t||(t==null?void 0:t.originIdOf("renderer"))>Gt.SERVICE)){const l=(t==null?void 0:t.title)||this._getRendererTitle(i,t);l&&(n&&typeof l!="string"&&"title"in l&&(l.title=n),n=l)}const s={type:"symbol-table",title:n,legendType:e.legendType?e.legendType:null,infos:[]},a=t?this._sanitizeLegendForSublayer(e.legend.slice(),t):e.legend;return((o=e.legendGroups)==null?void 0:o.length)>0?e.legendGroups.forEach(l=>{var u;const c={type:"symbol-table",title:l.heading,legendType:e.legendType?e.legendType:null,infos:this._generateSymbolTableElementInfosForLegendLayer(a.filter(h=>h.groupId===l.id),e.layerId,r)};((u=c.infos)==null?void 0:u.length)>0&&s.infos.push(c)}):s.infos=this._generateSymbolTableElementInfosForLegendLayer(a,e.layerId,r),s.infos.length>0?s:null}_generateSymbolTableElementInfosForLegendLayer(e,t,r){return e.map(i=>{let n=i.url;if(i.imageData&&i.imageData.length>0)n=`data:image/png;base64,${i.imageData}`;else{if(n.indexOf("http")===0)return null;n=q3e(`${this.layer.url}/${t}/images/${n}`)}return{label:i.label,src:n,opacity:r==null?this.opacity:r,width:i.width,height:i.height}}).filter(i=>!!i)}_isSublayerInScale(e){const t=e.minScale||0,r=e.maxScale||0;return!(t>0&&t<this.scale||r>this.scale)}_isLegendLayerInScale(e,t){const r=t||this.layer;let i=null,n=null,s=!0;return!r.minScale&&r.minScale!==0||!r.maxScale&&r.maxScale!==0?(e.minScale===0&&r.tileInfo&&(i=r.tileInfo.lods[0].scale),e.maxScale===0&&r.tileInfo&&(n=r.tileInfo.lods[r.tileInfo.lods.length-1].scale)):(i=Math.min(r.minScale,e.minScale)||r.minScale||e.minScale,n=Math.max(r.maxScale,e.maxScale)),(i>0&&i<this.scale||n>this.scale)&&(s=!1),s}_sanitizeLegendForSublayer(e,t){if("version"in this.layer&&this.layer.version<10.1||e.length===0)return e;const r=t.renderer,i=e.some(a=>a.values);let n=null,s=null;return i&&e.some((a,o)=>(a.values||(n=o,s=a,s.label||(s.label="others")),s!=null)),r?r.type==="unique-value"?s&&(e.splice(n,1),e.push(s)):r.type==="class-breaks"&&(s&&e.splice(n,1),e.reverse(),s&&e.push(s)):s&&(e.splice(n,1),e.push(s)),e}async _getRendererLegendElements(e,t={}){return NAt(e,this.view)?DAt(e)?this._constructPointCloudRendererLegendElements(e,t):hIe(e)?this._constructDotDensityRendererLegendElements(e):fIe(e)?this._constructPieChartRendererLegendElements(e):this._constructRendererLegendElements(e,t):(Gb.warn(`Renderer of type '${e.type}' not supported!`),[])}_getPointCloudRendererTitle(e){return e.legendOptions&&e.legendOptions.title||e.field}_constructPointCloudRendererLegendElements(e,t={}){const r=t.title,i=[];let n=null,s=null;if(moe(e))n={type:"symbol-table",title:r||this._getPointCloudRendererTitle(e),infos:[]},e.colorClassBreakInfos.forEach(o=>{n.infos.unshift({label:o.label||o.minValue+" - "+o.maxValue,value:[o.minValue,o.maxValue],symbol:this._getAppliedCloneSymbol(v$,o.color)})});else if(goe(e)){const o=e.stops;let l=null;if(o.length&&(o.length===1&&(l=o[0].color),!l)){const u=o[0].value,h=o[o.length-1].value;u!=null&&h!=null&&(l=_5e(u+(h-u)/2,o))}n={type:"symbol-table",title:null,infos:[{label:null,value:null,symbol:this._getAppliedCloneSymbol(v$,l||v$.color)}]};const c=dQe(e.stops);s={type:"color-ramp",title:r||this._getPointCloudRendererTitle(e),infos:c,preview:j2(c.map(u=>u.color))}}else yoe(e)&&(n={type:"symbol-table",title:r||this._getPointCloudRendererTitle(e),infos:[]},e.colorUniqueValueInfos.forEach(o=>{n.infos.push({label:o.label||o.values.join(", "),value:o.values.join(", "),symbol:this._getAppliedCloneSymbol(v$,o.color)})}));n&&n.infos.length&&i.push(n),s&&s.infos.length&&i.push(s);const a=i.reduce((o,l)=>o.concat(l.infos),[]).filter(o=>!!o.symbol).map(o=>this._getSymbolPreview(o,this.opacity,{symbolConfig:{applyColorModulation:!!e.colorModulation}}));return dn(a).then(()=>i)}_getElementInfoForDotDensity(e,t){var p;const{backgroundColor:r,outline:i,dotSize:n}=e,s=(p=this.effectList)==null?void 0:p.effects.map(m=>m.toJSON()),a=gN(s),o=n+"-"+t+"-"+r+"-"+(i&&JSON.stringify(i.toJSON()))+"-"+a,l=this._dotDensityUrlCache,c=l.has(o)?l.get(o):Mst(e,t);l.set(o,c);const u={shape:{type:"image",x:0,y:0,width:c.width,height:c.height,src:c.src},fill:null,stroke:null,offset:[0,0]},h=yO([[u]],[c.width,c.height],{effectView:this.effectList});return{opacity:1,src:c.src,preview:h,width:c.width,height:c.height}}_constructDotDensityRendererLegendElements(e){const t=e.calculateDotValue(this.view.scale),r=e.legendOptions&&e.legendOptions.unit,i={type:"symbol-table",title:{value:t&&Math.round(t),unit:r||""},infos:[]};return e.attributes.forEach(n=>{const s=this._getElementInfoForDotDensity(e,n.color);s.label=n.label||n.valueExpressionTitle||n.field,i.infos.push(s)}),Promise.resolve([i])}async _constructPieChartRendererLegendElements(e){var l,c,u,h;const t=this.layer.opacity,r=[],i="Others",n=e.outline;e.attributes.forEach(p=>{const m=new nc({color:p.color,outline:n}),g=p.label||p.valueExpressionTitle||p.field;r.push({label:g,symbol:m})});const s=r.length?[...r]:[];if(((l=e.othersCategory)==null?void 0:l.color)&&((c=e.othersCategory)==null?void 0:c.threshold)!==0){const p=new nc({color:e.othersCategory.color,outline:n});r.push({label:e.othersCategory.label||i,symbol:p})}if((u=e.defaultColor)!=null&&u.a){const p=new nc({color:e.defaultColor,outline:n});r.push({label:e.defaultLabel,symbol:p})}const a=await this._getVisualVariableLegendElements(e,this.layer)||[];if(r.length){a.unshift({type:"symbol-table",title:null,infos:r});const p=s.filter(g=>g.label!==i).map(g=>g.symbol.color).filter(Boolean),m=Pst(p,{holePercentage:e.holePercentage,backgroundColor:(h=e.backgroundFillSymbol)==null?void 0:h.color,effectList:this.effectList,outline:n});a.unshift({type:"pie-chart-ramp",title:this._getRendererTitle(e,this.layer),infos:r,preview:m})}const o=a.reduce((p,m)=>p.concat(this._getAllInfos(m)),[]).filter(p=>!!(p!=null&&p.symbol)&&!(p!=null&&p.preview)).map(p=>this._getSymbolPreview(p,t,{effectList:this.effectList}));return await dn(o),a}async _constructRendererLegendElements(e,t={}){var w;const{title:r,sublayer:i}=t,n=i||this.layer;let s=await this._loadRenderer(e);this._hasColorRamp=!1,this._hasOpacityRamp=!1,this._hasSizeRamp=!1,this._scaleDrivenSizeVariable=null;const a=await this._getVisualVariableLegendElements(s,n)||[],o={type:"symbol-table",title:r||this._getRendererTitle(s,n),infos:[]};let l=null,c=!1;const u=new Set;if(nee(s)&&!this._hasSizeRamp){const v=await b5e(s);o.infos.push({label:null,symbol:v})}else if(qAt(s)){let v=r;const x=HAt(s)?"univariate-above-and-below-ramp":"univariate-color-size-ramp",T=a.findIndex(I=>I.type==="color-ramp"),E=T!==-1?a.splice(T,1)[0]:null,C=a.findIndex(I=>I.type==="size-ramp"),A=C!==-1?a.splice(C,1)[0]:null,P=[];E&&(v=E.title,P.push(E)),A&&(v=A.title,P.push(A)),P.length>0&&a.push({type:x,title:v,infos:P})}else if(uIe(s)){const v=w5e(s);a.push({type:"heatmap-ramp",title:r||((w=s.legendOptions)==null?void 0:w.title),infos:v,preview:j2(v.map(x=>x.color),{effectList:this.effectList})})}else if(see(s)){const v=s&&s.authoringInfo;if(v&&v.type==="relationship"){const{focus:x,numClasses:T,field1:E,field2:C}=v;if(T&&E&&C){const A=[E,C];let P=tIe(x)||0;for(const L of A){const{field:V,normalizationField:G,label:B}=L,X=B||{field:this._getFieldAlias(V,n),normField:G&&this._getFieldAlias(G,n)},Y=WAt.clone();Y.angle=P,o.infos.push({label:X,symbol:Y}),u.add(Y),P+=90}const I=uAt({focus:x,numClasses:T,infos:s.uniqueValueInfos});a.unshift(I)}}else{const x=s.field;s.uniqueValueInfos.forEach(T=>{T.symbol&&o.infos.push({label:T.label||this._getDomainName(x,T.value,n)||T.value,value:T.value,symbol:T.symbol})})}s.defaultSymbol&&(o.infos.push({label:s.defaultLabel||"others",symbol:s.defaultSymbol}),c=!0)}else if(qS(s))l=this._isUnclassedRenderer(s),(!l||!this._hasSizeRamp)&&(s.classBreakInfos.forEach(v=>{v.symbol&&o.infos.unshift({label:v.label||(l?null:v.minValue+" - "+v.maxValue),value:[v.minValue,v.maxValue],symbol:v.symbol})}),l&&(o.title=null),this._updateInfosforClassedSizeRenderer(s,o.infos)),s.defaultSymbol&&!l&&(o.infos.push({label:s.defaultLabel||"others",symbol:s.defaultSymbol}),c=!0);else if(cIe(s))if(GH(this.layer)||GAt(this.layer)){const v=this._constructTileImageryStretchRendererElements(s);jAt(v)?a.push(v):o.infos=v}else{const v=this.layer;let x,T;s.statistics&&s.statistics.length&&(x=s.statistics[0].min!=null?s.statistics[0].min:s.statistics[0][0],T=s.statistics[0].max!=null?s.statistics[0].max:s.statistics[0][1]);let E=[];const C=v.renderingRule?await v.generateRasterInfo(v.renderingRule):v.serviceRasterInfo,A=C.keyProperties.BandProperties,P=w1e[v.rasterInfo.pixelType.toLowerCase()];C.bandCount===1||v.bandIds&&v.bandIds.length===1?(x=x!=null?x:C.statistics?C.statistics[v.bandIds[0]].min:P[0],T=T!=null?T:C.statistics?C.statistics[v.bandIds[0]].max:P[1],x||T?a.push(this._getStretchLegendElements(s,{min:x,max:T})):this._getServerSideLegend()):C.bandCount>=3?A&&A.length>=C.bandCount?v.bandIds&&v.bandIds.length===3?(E=v.bandIds.map(I=>A[I].BandName),o.infos=this._createSymbolTableElementMultiBand(E)):v.format==="lerc"?(E=[0,1,2].map(I=>A[I].BandName),o.infos=this._createSymbolTableElementMultiBand(E)):this._getServerSideLegend():v.format==="lerc"?(E=["band1","band2","band3"],o.infos=this._createSymbolTableElementMultiBand(E)):this._getServerSideLegend():this._getServerSideLegend()}else if(lIe(s))s.colormapInfos.forEach(v=>{o.infos.push({label:v.label,value:v.value,symbol:this._getAppliedCloneSymbol(LAt,v.color)})});else if(jS(s)){let v=s.symbol;switch(t.geometryType){case"point":v="pointSymbol"in n&&n.pointSymbol;break;case"polyline":v="lineSymbol"in n&&n.lineSymbol;break;case"polygon":v="polygonSymbol"in n&&n.polygonSymbol}s.symbol&&!this._hasSizeRamp&&o.infos.push({label:s.label,symbol:v})}else if(oIe(s)){s.outputUnit&&(this.title="("+s.toJSON().outputUnit+")"),o.title=s.attributeField;const v=s.getClassBreakInfos();v!=null&&v.length?v.forEach(x=>{o.infos.push({label:x.minValue+" - "+x.maxValue,symbol:x.symbol})}):o.infos.push({label:s.attributeField,symbol:s.getDefaultSymbol()})}else dIe(s)&&a.push(this._getStretchLegendElements(s,{min:0,max:255}));const h=s.defaultSymbol;!h||c||jS(s)||l&&!this._hasColorRamp&&!this._hasSizeRamp&&!this._hasOpacityRamp||a.push({type:"symbol-table",infos:[{label:s.defaultLabel||"others",symbol:h}]}),o.infos.length&&a.unshift(o);const p=t.opacity==null?this.opacity:t.opacity,m=this._isTallSymbol("visualVariables"in s&&s.visualVariables),g=Z8(this.layer)||GH(this.layer),b=a.reduce((v,x)=>v.concat(this._getAllInfos(x)),[]).filter(v=>!!(v!=null&&v.symbol)).map(v=>this._getSymbolPreview(v,p,{isDefault:v.symbol===h,applyScaleDrivenSize:!u.has(v.symbol),symbolConfig:{isTall:m,isSquareFill:g},effectList:u.has(v.symbol)?null:this.effectList}));return s=null,await dn(b),a}_getServerSideLegend(){setTimeout(()=>this.buildLegendElementsForTools(),0)}_getAllInfos(e){const t=e==null?void 0:e.infos;return t?t.reduce((r,i)=>r.concat(this._getAllInfos(i)),[]):[e]}_constructTileImageryStretchRendererElements(e){var u,h;const t=this.layer,r=t.rasterInfo,i=r.bandCount||e.statistics.length;let n,s,a=[];const o=r.keyProperties&&r.keyProperties.BandProperties,l=(u=e==null?void 0:e.statistics)!=null&&u.length?e.statistics:r==null?void 0:r.statistics;if(l)n=l[0].min!==void 0?l[0].min:l[0][0],s=l[0].max||l[0][1];else{const p=w1e[t.rasterInfo.pixelType.toLowerCase()];n=p[0],s=p[1]}if(t.hasStandardTime()&&(n=t.getStandardTimeValue(n),s=t.getStandardTimeValue(s)),r.bandCount===1||((h=t.bandIds)==null?void 0:h.length)===1)return this._getStretchLegendElements(e,{min:n,max:s});function c(p){var g;const m=((g=t==null?void 0:t.bandIds)!=null&&g.length?t.bandIds:Array.from(Array(Math.min(r.bandCount,3)).keys())).map(b=>p&&p[b]&&p[b].BandName||"band"+(b+1));return m.length<3?m.push(m[1]):m.length>3&&m.splice(3),m}return a=o&&o.length>=i?c(o):c(),this._createSymbolTableElementMultiBand(a)}_getStretchLegendElements(e,t){const r=e.colorRamp,i=hQe(r,t);return{type:"stretch-ramp",title:"",infos:i,preview:j2(i.map(n=>n.color))}}async _getSizeLegendElement(e,t,r,i){return{type:"size-ramp",title:this._hasClusterSizeVariable?this._getClusterTitle(t):e,infos:await vAt(r,t,await RZ(r),this.scale,this.view.type,i)}}_createSymbolTableElementMultiBand(e){const t=[],r=["red","green","blue"];return e.forEach((i,n)=>{var s;t.push({label:{colorName:r[n],bandName:i},src:oQe[n],opacity:(s=this.opacity)!=null?s:1})}),t}_updateInfosforClassedSizeRenderer(e,t){const r=e.authoringInfo&&e.authoringInfo.type==="class-breaks-size",i=e.classBreakInfos.some(n=>lz(n.symbol));if(r&&i){const n=ree,s=iee,a=e.classBreakInfos.length,o=(n-s)/(a>1?a-1:a);t.forEach((l,c)=>{l.size=n-o*c})}}_isTallSymbol(e){let t=!1,r=!1;if(e)for(let i=0;i<e.length&&(!t||!r);i++){const n=e[i];n.type==="size"&&(n.axis==="height"&&(t=!0),n.axis==="width-and-depth"&&(r=!0))}return t&&r}async _getSymbolPreview(e,t,r){let i=!(r!=null&&r.isDefault)&&e.size==null&&this._hasSizeRamp?zs(la.size):e.size;if(this._scaleDrivenSizeVariable&&(r==null?void 0:r.applyScaleDrivenSize)){const{getSize:n}=await ie(()=>Promise.resolve().then(()=>Px),void 0,import.meta.url);i=n(this._scaleDrivenSizeVariable,null,{view:this.view.type,scale:this.scale,shape:e.symbol.type==="simple-marker"?e.symbol.style:null})}return j8e(e.symbol,{size:i,opacity:t,scale:!1,symbolConfig:r==null?void 0:r.symbolConfig,effectView:r==null?void 0:r.effectList}).then(n=>(e.preview=n,e)).catch(()=>(e.preview=null,e))}async _loadRenderer(e){var s,a;const t=[],r=this.layer;e=e.clone(),this._hasClusterSizeVariable=!1;const i="visualVariables"in e&&((s=e.visualVariables)==null?void 0:s.some(o=>o.type==="size"&&o.target!=="outline"&&!b$.test(o.valueExpression)));if(e&&"visualVariables"in e&&!i&&"featureReduction"in r&&((a=r.featureReduction)==null?void 0:a.type)==="cluster"){const o=this.layerView._effectiveRenderer,l=Y7t(o,this.view);if(l){const c=r.featureReduction;if("clusterMinSize"in c&&"clusterMaxSize"in c){const{clusterMinSize:h,clusterMaxSize:p}=c;l.legendOptions=new f6e({showLegend:h!==p})}const u=e.visualVariables||[];e.visualVariables=u.concat([l]),this._hasClusterSizeVariable=!0}}const n=await RZ(e);if(qS(e)||see(e)){const o=(e.classBreakInfos||e.uniqueValueInfos).map(l=>this._fetchSymbol(l.symbol,n).then(c=>{l.symbol=c}).catch(()=>{l.symbol=null}));Array.prototype.push.apply(t,o)}return t.push(this._fetchSymbol(e.symbol||e.defaultSymbol,e.defaultSymbol?null:n).then(o=>{this._applySymbolToRenderer(e,o,jS(e))}).catch(()=>{this._applySymbolToRenderer(e,null,jS(e))})),dn(t).then(()=>e)}_applySymbolToRenderer(e,t,r){r?e.symbol=t:e.defaultSymbol=t}async _fetchSymbol(e,t){if(!e)throw new Error;if(e.type==="web-style"){const r=this._webStyleSymbolCache;try{const i=await(this.view.type==="2d"?e.fetchCIMSymbol({cache:r}):e.fetchSymbol({cache:r}));return this._getAppliedCloneSymbol(i,t)}catch{throw Gb.warn("Fetching web-style failed!"),new Error}}return this._getAppliedCloneSymbol(e,t)}_getAppliedCloneSymbol(e,t){if(!e||!t)return e;const r=e.clone(),i=t&&t.toRgba();return r.type.includes("3d")?this._applyColorTo3dSymbol(r,i):r.type==="cim"?l5e(r,t):r.color&&(r.color=new Te(i||r.color)),r}_applyColorTo3dSymbol(e,t){t&&e.symbolLayers.forEach(r=>{r&&(r.material||(r.material={}),r.material.color=new Te(t))})}async _getVisualVariableLegendElements(e,t){if(!("visualVariables"in e)||!e.visualVariables||e.type==="vector-field")return null;const r=e.visualVariables,i=[],n=[],s=[];for(const u of r)u.type==="color"?i.push(u):u.type==="size"?n.push(u):u.type==="opacity"&&s.push(u);const a=[...i,...n,...s];let o,l;if(i.length===0&&qS(e)&&e.classBreakInfos&&e.classBreakInfos.length===1){const u=e.classBreakInfos[0];o=u&&u.symbol}if(i.length===0&&jS(e)&&(o=e.symbol),o)if(o.type.includes("3d")){const u=o.symbolLayers.getItemAt(0);u.type==="water"?_(u.color)&&(l=u.color):_(u.material)&&_(u.material.color)&&(l=u.material.color)}else o.url||(l=o.color);const c=this.effectList;return(await Promise.all(a.map(async u=>{if(!u.legendOptions||u.legendOptions.showLegend!==!1){const h=nee(e)?u.field:this._getRampTitle(u,t);let p=null;const m="getField"in t&&t.getField&&t.getField(u.field),g=m&&X4(m);if(u.type==="color"){const b=await OZ(u,null,g);p={type:"color-ramp",title:h,infos:b,preview:j2(b.map(w=>w.color),{effectList:c})},this._hasColorRamp||(this._hasColorRamp=!(p.infos==null||!p.infos.length))}else if(u.type==="size"&&u.target!=="outline")b$.test(u.valueExpression)?this._hasClusterSizeVariable||(this._scaleDrivenSizeVariable=u):(p=await this._getSizeLegendElement(h,u,e,g),this._hasSizeRamp||(this._hasSizeRamp=!(p.infos==null||!p.infos.length)));else if(u.type==="opacity"){const b=await OZ(u,l,g);p={type:"opacity-ramp",title:h,infos:b,preview:j2(b.map(w=>w.color),{effectList:c})},this._hasOpacityRamp||(this._hasOpacityRamp=!(p.infos==null||!p.infos.length))}return p&&p.infos?p:null}}))).filter(u=>!!u)}_getDomainName(e,t,r){if(e&&typeof e!="function"){const i="getField"in r&&r.getField&&r.getField(e),n=i&&"getFieldDomain"in r&&r.getFieldDomain?r.getFieldDomain(i.name):null;return n&&n.type==="coded-value"?n.getName(t):null}return null}_getClusterTitle(e){const t=this.layer,r=e.field;if("featureReduction"in t&&t.featureReduction&&t.featureReduction.type==="cluster"){const i=t.featureReduction,n="popupTemplate"in i&&i.popupTemplate,s=n&&n.fieldInfos;if(s){for(const a of s)if(a.fieldName===r)return r==="cluster_count"?a.label||{showCount:!0}:a.label}}return{showCount:!0}}_getRampTitle(e,t){let r=e.field,i=e.normalizationField,n=!1,s=!1,a=!1,o=null;r=typeof r=="function"?null:r,i=typeof i=="function"?null:i;const l=e.legendOptions&&e.legendOptions.title;if(l!=null)o=l;else if(e.valueExpressionTitle)o=e.valueExpressionTitle;else{if("renderer"in t&&t.renderer&&"authoringInfo"in t.renderer&&t.renderer.authoringInfo&&t.renderer.authoringInfo.visualVariables){const c=t.renderer.authoringInfo.visualVariables;for(let u=0;u<c.length;u++){const h=c[u];if(h.type==="color"){if(h.style==="ratio"){n=!0;break}if(h.style==="percent"){s=!0;break}if(h.style==="percent-of-total"){a=!0;break}}}}o={field:r&&this._getFieldAlias(r,t),normField:i&&this._getFieldAlias(i,t),ratio:n,ratioPercent:s,ratioPercentTotal:a}}return o}_getRendererTitle(e,t){const r=e;if(r.legendOptions&&r.legendOptions.title)return r.legendOptions.title;if(r.valueExpressionTitle)return r.valueExpressionTitle;let i=r.field,n=null,s=null;qS(r)&&(n=r.normalizationField,s=r.normalizationType==="percent-of-total"),i=typeof i=="function"?null:i,n=typeof n=="function"?null:n;let a=null;return(i||n)&&(a={field:i&&this._getFieldAlias(i,t),normField:n&&this._getFieldAlias(n,t),normByPct:s}),a}_getFieldAlias(e,t){const r="popupTemplate"in t&&t.popupTemplate,i=r&&r.fieldInfos;let n=null;i&&i.some(l=>e===l.fieldName&&(n=l,!0));let s=null;"getField"in t&&t.getField?s=t.getField(e):"fieldsIndex"in t&&t.fieldsIndex&&(s=t.fieldsIndex.get(e));const a=n||s;let o=null;return a&&(o=n&&n.label||s&&s.alias||"name"in a&&a.name||"fieldName"in a&&a.fieldName),o}_isUnclassedRenderer(e){const t=e.visualVariables;let r=!1;return qS(e)&&e.classBreakInfos&&e.classBreakInfos.length===1&&t&&(r=e.field?t.some(i=>!(!i||e.field!==i.field||(e.normalizationField||i.normalizationField)&&e.normalizationField!==i.normalizationField)):!!t.length),r}};d([f()],Zs.prototype,"children",void 0),d([f({readOnly:!0})],Zs.prototype,"effectList",null),d([f()],Zs.prototype,"layerView",void 0),d([f()],Zs.prototype,"layer",void 0),d([f()],Zs.prototype,"legendElements",void 0),d([f({readOnly:!0})],Zs.prototype,"opacity",null),d([f()],Zs.prototype,"parent",void 0),d([f({readOnly:!0,dependsOn:[]})],Zs.prototype,"ready",null),d([f()],Zs.prototype,"hideLayersNotInCurrentView",void 0),d([f()],Zs.prototype,"keepCacheOnDestroy",void 0),d([f()],Zs.prototype,"respectLayerVisibility",void 0),d([f({readOnly:!0})],Zs.prototype,"scale",null),d([f()],Zs.prototype,"sublayerIds",void 0),d([f({readOnly:!0})],Zs.prototype,"isScaleDriven",null),d([f()],Zs.prototype,"title",void 0),d([f({readOnly:!0,dependsOn:["ready"],value:0})],Zs.prototype,"version",null),d([f()],Zs.prototype,"view",void 0),Zs=d([$("esri.widgets.Legend.support.ActiveLayerInfo")],Zs);const pIe=Zs,u2={state:"state",view:"view",allLayerViews:"all-layer-views",legendProperties:"legend-properties"},mIe=lt.ofType(pIe),XAt=["esri.layers.BuildingSceneLayer","esri.layers.CSVLayer","esri.layers.FeatureLayer","esri.layers.GeoJSONLayer","esri.layers.GeoRSSLayer","esri.layers.GroupLayer","esri.layers.HeatmapLayer","esri.layers.ImageryLayer","esri.layers.ImageryTileLayer","esri.layers.MapImageLayer","esri.layers.OGCFeatureLayer","esri.layers.PointCloudLayer","esri.layers.StreamLayer","esri.layers.SceneLayer","esri.layers.TileLayer","esri.layers.VoxelLayer","esri.layers.WFSLayer","esri.layers.WMSLayer","esri.layers.WMTSLayer","esri.layers.WCSLayer"],gIe="view.basemapView.baseLayerViews",yIe="view.groundView.layerViews",bIe="view.basemapView.referenceLayerViews",YAt=[gIe,yIe,"view.layerViews",bIe];let dh=class extends xe{constructor(e){super(e),this._handles=new Ft,this._layerViewByLayerId={},this._layerInfosByLayerViewId={},this._activeLayerInfosByLayerViewId={},this._activeLayerInfosWithNoParent=new lt,this.activeLayerInfos=new mIe,this.basemapLegendVisible=!1,this.groundLegendVisible=!1,this.hideLayersNotInCurrentView=!1,this.keepCacheOnDestroy=!1,this.respectLayerVisibility=!0,this.layerInfos=[],this.view=null}initialize(){this._handles.add(re(()=>this.view,()=>this._viewHandles(),Ot),u2.view),this._handles.add(twe(()=>this._refresh()))}destroy(){this._destroyViewActiveLayerInfos(),this._handles.destroy(),this._handles=null,this.view=null}get state(){return this.get("view.ready")?"ready":"disabled"}_viewHandles(){this._handles.remove(u2.state),this.view&&this._handles.add(re(()=>this.state,()=>this._stateHandles(),Ot),u2.state)}_stateHandles(){this._resetAll(),this.state==="ready"&&this._watchPropertiesAndAllLayerViews()}_resetAll(){this._handles.remove([u2.allLayerViews,u2.legendProperties]),this._destroyViewActiveLayerInfos(),this.activeLayerInfos.removeAll()}_destroyViewActiveLayerInfos(){Object.keys(this._activeLayerInfosByLayerViewId).forEach(this._destroyViewActiveLayerInfo,this)}_destroyViewActiveLayerInfo(e){this._handles.remove(e);const t=this._activeLayerInfosByLayerViewId[e];delete this._activeLayerInfosByLayerViewId[e],t&&t.parent&&t.parent.children.remove(t)}_watchPropertiesAndAllLayerViews(){const{allLayerViews:e}=this.view;e.length&&this._refresh(),this._handles.add(e.on("change",t=>this._allLayerViewsChangeHandle(t)),u2.allLayerViews),this._handles.add(re(()=>[this.layerInfos,this.basemapLegendVisible,this.groundLegendVisible],()=>this._propertiesChangeHandle()),u2.legendProperties)}_allLayerViewsChangeHandle(e){e.removed.forEach(t=>this._destroyViewActiveLayerInfo(t.uid)),this._refresh()}_propertiesChangeHandle(){this._destroyViewActiveLayerInfos(),this._refresh()}_refresh(){this._layerInfosByLayerViewId={},this.activeLayerInfos.removeAll(),this._generateLayerViews().filter(this._filterLayerViewsByLayerInfos,this).filter(this._isLayerViewSupported,this).forEach(this._generateActiveLayerInfo,this),this._sortActiveLayerInfos(this.activeLayerInfos)}_sortActiveLayerInfos(e){if(e.length<2)return;const t=[];e.forEach(i=>{if(!i.parent){const n=i.layer.parent,s=n&&"uid"in n&&this._layerViewByLayerId[n.uid],a=s&&this._activeLayerInfosByLayerViewId[s.uid];a&&e.includes(a)&&(t.push(i),i.parent=a,a.children.add(i),this._sortActiveLayerInfos(a.children))}}),e.removeMany(t);const r={};this.view.allLayerViews.forEach((i,n)=>r[i.layer.uid]=n),e.sort((i,n)=>{const s=r[i.layer.uid]||0;return(r[n.layer.uid]||0)-s})}_generateLayerViews(){const e=[];return YAt.filter(this._filterLayerViews,this).map(this.get,this).filter(t=>t!=null).forEach(this._collectLayerViews("layerViews",e)),e}_filterLayerViews(e){const t=!this.basemapLegendVisible&&(e===gIe||e===bIe),r=!this.groundLegendVisible&&e===yIe;return!t&&!r}_collectLayerViews(e,t){const r=i=>(i&&i.forEach(n=>{t.push(n),r(n[e])}),t);return r}_filterLayerViewsByLayerInfos(e){const t=this.layerInfos;return!t||!t.length||t.some(r=>this._hasLayerInfo(r,e))}_hasLayerInfo(e,t){const r=this._isLayerUIDMatching(e.layer,t.layer.uid);return r&&(this._layerInfosByLayerViewId[t.uid]=e),r}_isLayerUIDMatching(e,t){return e&&(e.uid===t||this._hasLayerUID(e.layers,t))}_hasLayerUID(e,t){return e&&e.some(r=>this._isLayerUIDMatching(r,t))}_isLayerViewSupported(e){return!!XAt.includes(e.layer.declaredClass)&&(this._layerViewByLayerId[e.layer.uid]=e,!0)}_generateActiveLayerInfo(e){this._isLayerActive(e)?this._buildActiveLayerInfo(e):(this._handles.remove(e.uid),this._handles.add(re(()=>{var t;return[e.legendEnabled,(t=e.layer)==null?void 0:t.legendEnabled]},()=>this._layerActiveHandle(e)),e.uid))}_layerActiveHandle(e){this._isLayerActive(e)&&(this._handles.remove(e.uid),this._buildActiveLayerInfo(e))}_isLayerActive(e){return!this.respectLayerVisibility||e.legendEnabled&&e.get("layer.legendEnabled")}_buildActiveLayerInfo(e){var a;const t=e.layer,r=e.uid,i=this._layerInfosByLayerViewId[r];let n=this._activeLayerInfosByLayerViewId[r];if(!n){const o=i&&i.title!==void 0&&i.layer.uid===t.uid;n=new pIe({layer:t,layerView:e,title:o?i.title:t.title,view:this.view,respectLayerVisibility:this.respectLayerVisibility,hideLayersNotInCurrentView:this.hideLayersNotInCurrentView,keepCacheOnDestroy:this.keepCacheOnDestroy,sublayerIds:i&&i.sublayerIds||[]}),this._activeLayerInfosByLayerViewId[r]=n}const s=t.parent&&"uid"in t.parent&&this._layerViewByLayerId[(a=t.parent)==null?void 0:a.uid];if(n.parent=this._activeLayerInfosByLayerViewId[s==null?void 0:s.uid],!this._handles.has(r)){const o=[re(()=>t.title,l=>this._titleHandle(l,n)),re(()=>[t.opacity,"renderer"in t&&t.renderer,"pointSymbol"in t&&t.pointSymbol,"lineSymbol"in t&&t.lineSymbol,"polygonSymbol"in t&&t.polygonSymbol],()=>this._constructLegendElements(n)),Fa(()=>{var l;return((l=this.view)==null?void 0:l.stationary)===!0},()=>this._scaleHandle(n),Ot),re(()=>e._effectiveRenderer,()=>this._constructLegendElements(n)),re(()=>"effect"in t&&t.effect,()=>this._constructLegendElements(n))];if(this.respectLayerVisibility){const l=re(()=>e.legendEnabled,u=>this._legendEnabledHandle(u,n)),c=re(()=>t.legendEnabled,u=>this._legendEnabledHandle(u,n));o.push(l,c)}this._handles.add(o,r)}n.isScaleDriven||this._constructLegendElements(n),this._addActiveLayerInfo(n)}_titleHandle(e,t){t.title=e,this._constructLegendElements(t)}_legendEnabledHandle(e,t){e?this._addActiveLayerInfo(t):this._removeActiveLayerInfo(t)}_scaleHandle(e){(e.isScaleDriven||e.hideLayersNotInCurrentView)&&this._constructLegendElements(e)}_addActiveLayerInfo(e){var i;const{layerView:t,layer:r}=e;if(this._isLayerActive(t)&&!this.activeLayerInfos.includes(e)){const n=e.parent;if(n)n.children.includes(e)||n.children.push(e),this._sortActiveLayerInfos(n.children);else{const s=(i=this.layerInfos)==null?void 0:i.some(a=>a.layer.uid===r.uid);r.parent&&"uid"in r.parent&&!s?this._activeLayerInfosWithNoParent.add(e):(this.activeLayerInfos.add(e),this._sortActiveLayerInfos(this.activeLayerInfos))}if(this._activeLayerInfosWithNoParent.length){const s=[];this._activeLayerInfosWithNoParent.forEach(a=>{const o=a.layer.parent,l=o&&"uid"in o&&this._layerViewByLayerId[o==null?void 0:o.uid],c=this._activeLayerInfosByLayerViewId[l==null?void 0:l.uid];c&&(s.push(a),a.parent=c)}),s.length&&(this._activeLayerInfosWithNoParent.removeMany(s),s.forEach(a=>this._addActiveLayerInfo(a)))}}}_removeActiveLayerInfo(e){const t=e.parent;t?t.children.remove(e):this.activeLayerInfos.remove(e)}_constructLegendElements(e){var r;const t=e.layer;"featureCollections"in t&&t.featureCollections?e.buildLegendElementsForFeatureCollections(t.featureCollections):"featureReduction"in t&&((r=t.featureReduction)==null?void 0:r.type)==="binning"&&"renderer"in t.featureReduction?e.buildLegendElementsForRenderer(t.featureReduction.renderer):"renderer"in t&&t.renderer?e.buildLegendElementsForRenderer(t.renderer):"url"in t&&t.url?e.buildLegendElementsForTools():e.children.forEach(i=>this._constructLegendElements(i))}};d([f({type:mIe})],dh.prototype,"activeLayerInfos",void 0),d([f()],dh.prototype,"basemapLegendVisible",void 0),d([f()],dh.prototype,"groundLegendVisible",void 0),d([f()],dh.prototype,"hideLayersNotInCurrentView",void 0),d([f()],dh.prototype,"keepCacheOnDestroy",void 0),d([f()],dh.prototype,"respectLayerVisibility",void 0),d([f()],dh.prototype,"layerInfos",void 0),d([f({readOnly:!0})],dh.prototype,"state",null),d([f()],dh.prototype,"view",void 0),dh=d([$("esri.widgets.Legend.LegendViewModel")],dh);const ZAt=dh,QAt="http://www.w3.org/2000/svg",Bi={diamondContainer:"esri-relationship-ramp--diamond__container",diamondLeftCol:"esri-relationship-ramp--diamond__left-column",diamondRightCol:"esri-relationship-ramp--diamond__right-column",diamondMidCol:"esri-relationship-ramp--diamond__middle-column",diamondMidColLabel:"esri-relationship-ramp--diamond__middle-column--label",diamondMidColRamp:"esri-relationship-ramp--diamond__middle-column--ramp",squareTable:"esri-relationship-ramp--square__table",squareTableRow:"esri-relationship-ramp--square__table-row",squareTableCell:"esri-relationship-ramp--square__table-cell",squareTableLabel:"esri-relationship-ramp--square__table-label",squareTableLabelLeftBottom:"esri-relationship-ramp--square__table-label--left-bottom",squareTableLabelRightBottom:"esri-relationship-ramp--square__table-label--right-bottom",squareTableLabelLeftTop:"esri-relationship-ramp--square__table-label--left-top",squareTableLabelRightTop:"esri-relationship-ramp--square__table-label--right-top"};function vIe(e,t,r,i){const{focus:n,labels:s}=e,a=!!n,o=JAt(e,t,r,i),l={justifyContent:"center"},c=gp();return a?z("div",{class:Bi.diamondContainer,styles:l},z("div",{class:Bi.diamondLeftCol},c?s.right:s.left),z("div",{class:Bi.diamondMidCol},z("div",{class:Bi.diamondMidColLabel},s.top),o,z("div",{class:Bi.diamondMidColLabel},s.bottom)),z("div",{class:Bi.diamondRightCol},c?s.left:s.right)):z("div",{class:Bi.squareTable},z("div",{class:Bi.squareTableRow},z("div",{class:h4(Bi.squareTableCell,Bi.squareTableLabel,Bi.squareTableLabelRightBottom)},c?s.top:s.left),z("div",{class:Bi.squareTableCell}),z("div",{class:h4(Bi.squareTableCell,Bi.squareTableLabel,Bi.squareTableLabelLeftBottom)},c?s.left:s.top)),z("div",{class:Bi.squareTableRow},z("div",{class:Bi.squareTableCell}),o,z("div",{class:Bi.squareTableCell})),z("div",{class:Bi.squareTableRow},z("div",{class:h4(Bi.squareTableCell,Bi.squareTableLabel,Bi.squareTableLabelRightTop)},c?s.right:s.bottom),z("div",{class:Bi.squareTableCell}),z("div",{class:h4(Bi.squareTableCell,Bi.squareTableLabel,Bi.squareTableLabelLeftTop)},c?s.bottom:s.right)))}function S1e(e,t,r){const i=`${r}_arrowStart`,n=`${r}_arrowEnd`,s=e==="left",a={markerStart:null,markerEnd:null};switch(t){case"HL":s?a.markerStart=`url(#${n})`:a.markerEnd=`url(#${i})`;break;case"LL":a.markerStart=`url(#${n})`;break;case"LH":s?a.markerEnd=`url(#${i})`:a.markerStart=`url(#${n})`;break;default:a.markerEnd=`url(#${i})`}return a}function JAt(e,t,r,i,n=60){const{focus:s,numClasses:a,colors:o,rotation:l}=e,c=!!s,u=Math.sqrt(n**2+n**2)+(c?0:5),h=[],p=[],m=[],g=(n||75)/a;for(let V=0;V<a;V++){const G=V*g;for(let B=0;B<a;B++){const X=B*g,Y=Bne(o[V][B]),ce=Gne(null),se={type:"rect",x:X,y:G,width:g,height:g};h.push(z8e(Y)),p.push(Une(se,Y.fill,ce,null)),m.push(U8e(se))}}const b=10,w=15,v=15,x=10;let T=null;c||(T="margin: -15px -15px -18px -15px");const E=S1e("left",s,t),C=S1e("right",s,t),A=B8e(m),P=fJ(A,u,u,0,!1,l,!1),I=fJ(A,u,u,0,!1,c?-45:null,!1),L={filter:SA(i),opacity:r==null?null:`${r}`};return z("div",{styles:L,class:c?Bi.diamondMidColRamp:Bi.squareTableCell},z("svg",{xmlns:QAt,width:u,height:u,style:T},z("defs",null,z("marker",{id:`${t}_arrowStart`,markerWidth:"10",markerHeight:"10",refX:"5",refY:"5",markerUnits:"strokeWidth",orient:"auto"},z("polyline",{points:"0,0 5,5 0,10",fill:"none",stroke:"#555555","stroke-width":"1"})),z("marker",{id:`${t}_arrowEnd`,markerWidth:"10",markerHeight:"10",refX:"0",refY:"5",markerUnits:"strokeWidth",orient:"auto"},z("polyline",{points:"5,0 0,5 5,10",fill:"none",stroke:"#555555","stroke-width":"1"})),h),z("g",{transform:P},p),z("g",{transform:I},z("line",{fill:"none",stroke:"#555555","stroke-width":"1","marker-start":E.markerStart,"marker-end":E.markerEnd,x1:-b,y1:n-w,x2:-b,y2:w}),z("line",{fill:"none",stroke:"#555555","stroke-width":"1","marker-start":C.markerStart,"marker-end":C.markerEnd,x1:v,y1:n+x,x2:n-v,y2:n+x}))))}const KAt=rN(),_Ie=10,boe=20,sB=10,voe=20,_oe={univariateAboveAndBelowSymbol:"esri-univariate-above-and-below-ramp__symbol",colorRamp:"esri-legend__color-ramp"};function eRt(e="vertical"){const t="stroke:rgb(200, 200, 200);stroke-width:1";return e==="vertical"?z("svg",{height:"4",width:"10"},z("line",{x1:"0",y1:"2",x2:"10",y2:"2",style:t})):z("svg",{height:"10",width:"10"},z("line",{x1:"5",y1:"0",x2:"5",y2:"10",style:t}))}function tRt(e,t="vertical"){const r=document.createElement("div");return r.style.height=`${boe}px`,r.className=_oe.univariateAboveAndBelowSymbol,e!=null&&(r.style.opacity=e.toString()),KAt.append(r,eRt.bind(null,t)),r}function wIe(e,t,r="vertical",i){e.infos.forEach((n,s)=>{if(i&&s===2)n.preview=tRt(t,r);else{const a=ur(n.size)+(r==="horizontal"?voe:sB),o=n.preview.tagName.toLowerCase()==="div",l=o?n.preview:document.createElement("div");l.className=_oe.univariateAboveAndBelowSymbol,r==="horizontal"?l.style.width=`${a}px`:l.style.height=`${a}px`,o||l.appendChild(n.preview),n.preview=l}})}function kk(e,t="classic"){const r=e.infos;return t==="classic"?(ur(r[0].size)+sB)/2:(ur(r[0].size)-ur(r[r.length-1].size))/2}function p5(e,t){if(!e)return null;const r=e.infos.map(n=>n.color),i=j2(t.type==="full"?r:t.type==="above"?r.slice(0,3):r.slice(2,5),{width:t.width,height:t.height,align:t.rampAlignment,effectList:t.effectList});return i.className=_oe.colorRamp,t.opacity!=null&&(i.style.opacity=t.opacity.toString()),i}function aee(e,t,r,i="vertical"){let n=0;const s=e.infos,a=Math.floor(s.length/2),o=t==="full"||t==="above"?0:a,l=t==="full"||t==="below"?s.length-1:a;for(let c=o;c<=l;c++)r&&c===a?n+=i==="horizontal"?_Ie:boe:n+=ur(s[c].size)+(i==="horizontal"?voe:sB);return Math.round(n)}function m5(e,t,r,i="vertical"){const n=aee(e,t,r,i),s=e.infos,a=Math.floor(s.length/2),o=t==="full"||t==="above"?0:a,l=t==="full"||t==="below"?s.length-1:a,c=t==="full"?s[o].size+s[l].size:t==="above"?s[o].size:s[l].size,u=r?i==="vertical"?boe:_Ie:0,h=i==="vertical"?sB*(t==="full"?2:1):voe*(t==="full"?2:1);return Math.round(n-(ur(c)/2+u/2+h/2))}function xIe(e,t,r="vertical"){const i=e.infos;let n=i.find(({type:a})=>a==="size-ramp"),s=i.find(({type:a})=>a==="color-ramp");return n&&(n={...n},n.infos=[...n.infos],wIe(n,t,r,!0)),s&&(s={...s},s.infos=[...s.infos]),r==="horizontal"&&(n==null||n.infos.reverse(),s==null||s.infos.reverse()),{sizeRampElement:n,colorRampElement:s}}function TIe(e,t="vertical"){const r=e.infos;let i=r.find(({type:s})=>s==="size-ramp"),n=r.find(({type:s})=>s==="color-ramp");return i&&(i={...i},i.infos=[...i.infos],wIe(i,null,t,!1)),n&&(n={...n},n.infos=[...n.infos]),t==="horizontal"&&(i==null||i.infos.reverse(),n==null||n.infos.reverse()),{sizeRampElement:i,colorRampElement:n}}function rRt(e,t){return t}function Ta(e){const t=this;e.appendChild(t)}function g5(e,t,r){if(!t)return;if(typeof t=="string"||typeof t=="number")return t;if("value"in t||"unit"in t)return fh(e.dotValue,t);if("colorName"in t||"bandName"in t)return e[t.colorName]+": "+(e[t.bandName]||t.bandName);if("showCount"in t)return t.showCount?e.clusterCountTitle:null;let i=null;return rRt(t,r)?i=t.ratioPercentTotal?"showRatioPercentTotal":t.ratioPercent?"showRatioPercent":t.ratio?"showRatio":t.normField?"showNormField":t.field?"showField":null:SIe(t,r)&&(i=t.normField?"showNormField":t.normByPct?"showNormPct":t.field?"showField":null),i?fh(i==="showField"?"{field}":e[i],{field:t.field,normField:t.normField}):null}function SIe(e,t){return!t}function EIe(e,t){return!!(t&&t==="Stretched"&&e.version>=10.3&&e.declaredClass==="esri.layers.ImageryLayer")}const _t={activated:"esri-legend--card__carousel-indicator--activated",base:"esri-legend--card",stacked:"esri-legend--stacked",carouselTitle:"esri-legend--card__carousel-title",indicator:"esri-legend--card__carousel-indicator",intervalSeparator:"esri-legend--card__interval-separator",imageryLayerStretchedImage:"esri-legend--card__imagery-layer-image--stretched",imageLabel:"esri-legend--card__image-label",layerCaption:"esri-legend--card__layer-caption",labelElement:"esri-legend--card__label-element",layerRow:"esri-legend--card__layer-row",labelCell:"esri-legend--card__label-cell",message:"esri-legend--card__message",rampLabel:"esri-legend--card__ramp-label",section:"esri-legend--card__section",relationshipSection:"esri-legend--card__relationship-section",serviceCaptionText:"esri-legend--card__service-caption-text",serviceContent:"esri-legend--card__service-content",service:"esri-legend--card__service",groupLayer:"esri-legend--card__group-layer",groupLayerChild:"esri-legend--card__group-layer-child",symbol:"esri-legend--card__symbol",sizeRampRow:"esri-legend--card__size-ramp-row",symbolRow:"esri-legend--card__symbol-row",symbolCell:"esri-legend--card__symbol-cell",indicatorContainer:"esri-legend--card__carousel-indicator-container",intervalSeparatorsContainer:"esri-legend--card__interval-separators-container",relationshipLabelContainer:"esri-legend--card__relationship-label-container",labelContainer:"esri-legend--card__label-container",serviceCaptionContainer:"esri-legend--card__service-caption-container",symbolContainer:"esri-legend--card__symbol-container",sizeRampContainer:"esri-legend--card__size-ramp-container",sizeRampPreview:"esri-legend--card__size-ramp-preview",pieChartRampPreview:"esri-legend--card__pie-chart-ramp-preview",rampContainer:"esri-legend__ramps",sizeRampHorizontal:"esri-legend__size-ramp--horizontal",rampLabelsContainer:"esri-legend__ramp-labels",layerInfo:"esri-legend__layer-cell esri-legend__layer-cell--info",univariateAboveAndBelowColorRamp:"esri-univariate-above-and-below-ramp__color--card",hidden:"esri-hidden"},iRt=25,nRt=25,sRt=768,aRt=100;var I7;(function(e){e.Auto="auto",e.Stack="stack",e.SideBySide="side-by-side"})(I7||(I7={}));const oRt="#ddd",BT=window.devicePixelRatio;function lRt(e){if(e){if(e.type.includes("3d")){const t=e.symbolLayers&&e.symbolLayers.length;if(!t)return;const r=e.symbolLayers.getItemAt(t-1),i=r.resource&&r.resource.primitive;return i==="circle"||i==="cross"||i==="kite"||i==="sphere"||i==="cube"||i==="diamond"}{const t=e.style;return t==="circle"||t==="diamond"||t==="cross"}}}function cRt(e){if(e){if(e.type.includes("3d")){const t=e.symbolLayers&&e.symbolLayers.length;if(!t)return;const r=e.symbolLayers.getItemAt(t-1).get("resource.primitive");return r==="triangle"||r==="cone"||r==="tetrahedron"}return e.style==="triangle"}}let Uf=class extends Bs{constructor(e,t){super(e,t),this._handles=new Ft,this._hasIndicators=!1,this._selectedSectionName=null,this._sectionNames=[],this._sectionMap=new Map,this.activeLayerInfos=null,this.headingLevel=3,this.layout=I7.Stack,this.messages=null,this.messagesCommon=null,this.type="card",this.view=null}initialize(){this.own(re(()=>this.activeLayerInfos,e=>{this._handles.removeAll(),this._watchForSectionChanges(e)}))}destroy(){this._handles.destroy(),this._handles=null}render(){this._hasIndicators=this.layout===I7.Auto&&this.view.container.clientWidth<=sRt||this.layout===I7.Stack;const e=this.activeLayerInfos,t=e&&e.toArray().map(o=>this._renderLegendForLayer(o)).filter(o=>!!o);this._hasIndicators?this._selectedSectionName&&this._sectionNames.includes(this._selectedSectionName)||(this._selectedSectionName=this._sectionNames&&this._sectionNames[0]):this._selectedSectionName=null;const r=this._sectionNames.length,i=this._sectionNames.map((o,l)=>{const c=fh(this.messagesCommon.pagination.pageText,{index:l+1,total:r});return z("div",{key:o,role:"tab",id:o,"aria-label":c,"aria-controls":`${o}-panel`,"aria-selected":(this._selectedSectionName===o).toString(),tabIndex:this._selectedSectionName===o?0:-1,title:c,onclick:this._selectSection,onkeydown:this._focusSection,bind:this,class:this.classes(_t.indicator,{[_t.activated]:this._selectedSectionName===o}),"data-section-name":o})}),n=this._hasIndicators&&r>1?z("div",{class:_t.indicatorContainer,key:"carousel-navigation",role:"tablist"},i):null,s=this._hasIndicators?this._sectionMap.get(this._selectedSectionName):t&&t.length?t:null,a={[_t.stacked]:this._hasIndicators};return z("div",{class:this.classes(_t.base,a)},s||z("div",{class:_t.message},this.messages.noLegend),n)}_selectSection(e){const t=e.target.getAttribute("data-section-name");t&&(this._selectedSectionName=t)}_focusSection(e){switch(e.key){case"ArrowLeft":case"ArrowRight":this._switchSectionOnArrowPress(e);break;case"Enter":case" ":this._selectSection(e)}}_switchSectionOnArrowPress(e){const t=e.key,r=t==="ArrowLeft"?-1:1,i=e.target.getAttribute("data-section-name"),n=this._sectionNames.indexOf(i),s=this._sectionNames;let a=null;n!==-1&&(s[n+r]?a=document.getElementById(s[n+r]):t==="ArrowLeft"?a=document.getElementById(s[s.length-1]):t==="ArrowRight"&&(a=document.getElementById(s[0])),a&&a.focus())}_watchForSectionChanges(e){if(this._generateSectionNames(),e){e.forEach(r=>{const i=`activeLayerInfo-${r.layer.uid}-version-change`;this._handles.remove(i),this._watchForSectionChanges(r.children),this._handles.add(re(()=>r.version,()=>this._generateSectionNames()),i)});const t="activeLayerInfos-collection-change";this._handles.remove(t),this._handles.add(e.on("change",()=>this._watchForSectionChanges(e)),t)}}_generateSectionNames(){this._sectionNames.length=0,this._selectedSectionName=null,this.activeLayerInfos&&this.activeLayerInfos.forEach(this._generateSectionNamesForActiveLayerInfo,this)}_getSectionName(e,t,r){return`${this.id}${e.uid}-type-${t.type}-${r}`}_generateSectionNamesForActiveLayerInfo(e){e.children.forEach(this._generateSectionNamesForActiveLayerInfo,this),e.legendElements&&e.legendElements.forEach((t,r)=>{this._sectionNames.push(this._getSectionName(e.layer,t,r))})}_renderLegendForLayer(e){if(!e.ready)return null;if(e.children.length){const t=e.children.map(r=>this._renderLegendForLayer(r)).toArray();return z("div",{key:e.layer.uid,class:this.classes(_t.service,_t.groupLayer)},z("div",{class:_t.serviceCaptionContainer},e.title),t)}{const t=e.legendElements;if(t&&!t.length)return null;const r=t.some(s=>s.type==="relationship-ramp"),i=t.map((s,a)=>this._renderLegendForElement(s,e,a,r)).filter(s=>!!s);if(!i.length)return null;const n={[_t.groupLayerChild]:!!e.parent};return z("div",{key:e.layer.uid,class:this.classes(_t.service,n)},z("div",{class:_t.serviceCaptionContainer},z("div",{class:_t.serviceCaptionText},e.title)),z("div",{class:_t.serviceContent},i))}}_renderLegendForElement(e,t,r,i=!1){const n=e.type==="color-ramp",s=e.type==="opacity-ramp",a=e.type==="size-ramp",o=t.layer;let l=null;if(typeof e.title=="string")l=e.title;else if(e.title){const g=e.title,b=g5(this.messages,g,n||s);l=g.title?`${g.title} (${b})`:b}const c=this._getSectionName(o,e,r),u=this._hasIndicators?z("div",null,z(Pv,{level:this.headingLevel,class:_t.carouselTitle},t.title),z(Pv,{level:OYe(this.headingLevel),class:_t.layerCaption},l)):l?z(Pv,{level:this.headingLevel,class:_t.layerCaption},l):null,h=t.effectList;let p=null;if(e.type==="symbol-table"){const g=e.infos.map((b,w)=>this._renderLegendForElementInfo(b,t,e.legendType,w)).filter(b=>!!b);if(g.length){const b=g[0].properties.classes&&g[0].properties.classes[_t.symbolRow],w={[_t.labelContainer]:!b&&!i,[_t.relationshipLabelContainer]:i};p=z("div",{class:this.classes(w)},g)}}else e.type==="color-ramp"||e.type==="opacity-ramp"||e.type==="heatmap-ramp"?p=this._renderLegendForRamp(e,o.opacity,h):a?p=this._renderSizeRamp(e,o.opacity):e.type==="pie-chart-ramp"?p=this._renderPieChartRamp(e):e.type==="relationship-ramp"?p=vIe(e,this.id,o.opacity,h):e.type==="univariate-above-and-below-ramp"?p=this._renderUnivariateAboveAndBelowRamp(e,o.opacity,h):e.type==="univariate-color-size-ramp"&&(p=this._renderUnivariateColorSizeRamp(e,o.opacity,h));if(!p)return null;const m=z("div",{key:c,class:_t.section,id:`${c}-panel`,role:"tabpanel","aria-labelledby":c,tabIndex:0},[u,p]);return this._sectionMap.set(c,m),m}_renderPieChartRamp(e){return z("div",{class:_t.pieChartRampPreview,bind:e.preview,afterCreate:Ta})}_renderUnivariateAboveAndBelowRamp(e,t,r){const{sizeRampElement:i,colorRampElement:n}=xIe(e,t,"horizontal");if(!i)return null;const s=aee(i,"full",!0,"horizontal"),a=m5(i,"above",!0,"horizontal"),o=m5(i,"below",!0,"horizontal"),l=12,c=p5(n,{width:a,height:l,rampAlignment:"horizontal",opacity:t,type:"above",effectList:r}),u=p5(n,{width:o,height:l,rampAlignment:"horizontal",opacity:t,type:"below",effectList:r}),h=kk(i,"card"),p=i.infos.map(T=>T.label),m=p.length-1,g=p.map((T,E)=>E===0||E===m?z("div",{key:E},T):null),b={display:"flex",flexDirection:"column"},w={display:"flex",flexDirection:"row"},v={marginTop:"3px",display:"flex"};gp(this.container)?v.marginRight=`${h}px`:v.marginLeft=`${h}px`;const x={width:`${s}px`,display:"flex",flexDirection:"row",justifyContent:"space-between"};return z("div",{class:_t.layerRow,key:"size-ramp-preview",styles:b},z("div",{class:this.classes(_t.symbolContainer,_t.sizeRampHorizontal),styles:w},i.infos.map((T,E)=>z("div",{key:E,class:_t.symbol,bind:T.preview,afterCreate:Ta}))),c?z("div",{class:_t.univariateAboveAndBelowColorRamp,styles:v,key:"color-ramp-preview"},z("div",{bind:c,afterCreate:Ta}),z("div",{bind:u,afterCreate:Ta})):null,z("div",{class:_t.layerInfo},z("div",{class:_t.rampLabelsContainer,styles:x},g)))}_renderUnivariateColorSizeRamp(e,t,r){const{sizeRampElement:i,colorRampElement:n}=TIe(e,"horizontal");if(!i)return null;const s=aee(i,"full",!1,"horizontal"),a=m5(i,"full",!1,"horizontal"),o=p5(n,{width:a,height:12,rampAlignment:"horizontal",opacity:t,type:"full",effectList:r}),l=kk(i,"card"),c=i.infos.length-1,u=i.infos.map((b,w)=>w===0||w===c?z("div",{key:w},b.label):null),h={display:"flex",flexDirection:"column"},p={display:"flex",flexDirection:"row"},m={marginTop:"3px",display:"flex"};gp(this.container)?m.marginRight=`${l}px`:m.marginLeft=`${l}px`;const g={width:`${s}px`,display:"flex",flexDirection:"row",justifyContent:"space-between"};return z("div",{class:_t.layerRow,key:"size-ramp-preview",styles:h},z("div",{class:this.classes(_t.symbolContainer,_t.sizeRampHorizontal),styles:p},i.infos.map((b,w)=>z("div",{key:w,class:_t.symbol,bind:b.preview,afterCreate:Ta}))),z("div",{class:_t.univariateAboveAndBelowColorRamp,styles:m,key:"color-ramp-preview"},z("div",{bind:o,afterCreate:Ta})),z("div",{class:_t.layerInfo},z("div",{class:_t.rampLabelsContainer,styles:g},u)))}_renderLegendForElementInfo(e,t,r,i){var a,o;const n=t.layer;if(e.type)return this._renderLegendForElement(e,t,i);const s=EIe(n,r);if(e.preview){if(!e.symbol||!e.symbol.type.includes("simple-fill")){if(!e.label)return z("div",{key:i,bind:e.preview,afterCreate:Ta});const C={[_t.symbolCell]:this._hasIndicators};return z("div",{key:i,class:this.classes(_t.layerRow,{[_t.symbolRow]:this._hasIndicators})},z("div",{class:this.classes(C),bind:e.preview,afterCreate:Ta}),z("div",{class:this.classes(_t.imageLabel,{[_t.labelCell]:this._hasIndicators})},g5(this.messages,e.label,!1)||""))}let l=255,c=255,u=255,h=0,p=255,m=255,g=255,b=0;const w=e.symbol.color&&e.symbol.color.a,v=e.symbol.outline&&e.symbol.outline.color&&e.symbol.outline.color.a;w&&(l=e.symbol.color.r,c=e.symbol.color.g,u=e.symbol.color.b,h=e.symbol.color.a*n.opacity),v&&(p=e.symbol.outline.color.r,m=e.symbol.outline.color.g,g=e.symbol.outline.color.b,b=e.symbol.outline.color.a*n.opacity);const x=(o=(a=e.symbol.color)==null?void 0:a.isBright)!=null?o:!0,T=x?"rgba(255, 255, 255, .6)":"rgba(0, 0, 0, .6)",E={background:w?`rgba(${l}, ${c}, ${u}, ${h})`:"none",color:x?"black":"white",textShadow:`-1px -1px 0 ${T},
                                              1px -1px 0 ${T},
                                              -1px 1px 0 ${T},
                                              1px 1px 0 ${T}`,border:v?`1px solid rgba(${p}, ${m}, ${g}, ${b})`:"none",filter:SA(t.effectList)};return z("div",{key:i,class:_t.layerRow},z("div",{class:_t.labelElement,styles:E}," ",e.label," "))}if(e.src){const l=this._renderImage(e,n,s);return z("div",{key:i,class:_t.layerRow},l,z("div",{class:_t.imageLabel},e.label||""))}}_renderImage(e,t,r){const{label:i,src:n,opacity:s}=e,a={[_t.imageryLayerStretchedImage]:r,[_t.symbol]:!r},o={opacity:`${s!=null?s:t.opacity}`};return z("img",{alt:g5(this.messages,i,!1),src:n,border:0,width:e.width,height:e.height,class:this.classes(a),styles:o})}_renderSizeRampLines(e){const t=e.infos,r=t[0],i=t[t.length-1],n=r.symbol,s=this._hasIndicators,a=ur(r.size+r.outlineSize)*BT,o=ur(i.size+i.outlineSize)*BT,l=s?a:a+50*BT,c=s?a/2+50*BT:a,u=cRt(n),h=lRt(n),p=document.createElement("canvas");p.width=l,p.height=c,p.style.width=p.width/BT+"px",p.style.height=p.height/BT+"px";const m=p.getContext("2d");if(s){m.beginPath();const g=0,b=0,w=l/2-o/2,v=c;m.moveTo(g,b),m.lineTo(w,v);const x=l,T=0,E=l/2+o/2,C=c;m.moveTo(x,T),m.lineTo(E,C)}else{m.beginPath();const g=0,b=c/2-o/2,w=l,v=0;m.moveTo(g,b),m.lineTo(w,v);const x=0,T=c/2+o/2,E=l,C=c;m.moveTo(x,T),m.lineTo(E,C)}return m.strokeStyle=oRt,m.stroke(),z("div",{bind:p,afterCreate:Ta,styles:s?{display:"flex",marginTop:`-${u?0:h?a/2:0}px`,marginBottom:`-${u?o:h?o/2:0}px`}:{display:"flex",marginRight:`-${u?0:h?a/2:0}px`,marginLeft:`-${u?0:h?o/2:0}px`}})}_renderSizeRamp(e,t){const r=e.infos,i=r[0].label,n=r[r.length-1].label;let s=r[0].preview,a=r[r.length-1].preview;const o=this._hasIndicators,l={"flex-direction":o?"column":"row-reverse"};s&&(s=s.cloneNode(!0),s.style.display="flex"),a&&(a=a.cloneNode(!0),a.style.display="flex");const c={opacity:t!=null?`${t}`:""};return z("div",{class:this.classes(_t.layerRow,{[_t.sizeRampRow]:o})},z("div",{class:_t.rampLabel},o?i:n),z("div",{class:_t.sizeRampContainer,styles:l},z("div",{bind:s,afterCreate:Ta,class:_t.sizeRampPreview,styles:c}),this._renderSizeRampLines(e),z("div",{bind:a,afterCreate:Ta,class:_t.sizeRampContainer,styles:c})),z("div",{class:_t.rampLabel},o?n:i))}_renderLegendForRamp(e,t,r){const i=e.infos,n=e.type==="heatmap-ramp",s=i.length-1,a=nRt,o=s>2&&!n?iRt*s:aRt,l=o+20,c=10,u=i.slice(0).reverse();u.forEach((C,A)=>{C.offset=n?C.ratio:A/s});const h=u.length-1,p=u.length%2!=0&&u[u.length/2|0],m=p&&z("div",{class:_t.intervalSeparatorsContainer},z("div",{class:_t.intervalSeparator},"|"),z("div",{class:_t.rampLabel},p.label)),g=i[i.length-1].label,b=i[0].label,w=[[{shape:{type:"path",path:`M0 ${a/2} L${c} 0 L${c} ${a} Z`},fill:u[0].color,stroke:{width:0}},{shape:{type:"rect",x:c,y:0,width:o,height:a},fill:{type:"linear",x1:c,y1:0,x2:o+c,y2:0,colors:u},stroke:{width:0}},{shape:{type:"path",path:`M${o+c} 0 L${l} ${a/2} L${o+c} ${a} Z`},fill:u[h].color,stroke:{width:0}}]],v=G8e(w,l,a),{messages:x}=this,T={filter:SA(r),opacity:t==null?null:`${t}`},E={justifyContent:"center"};return z("div",{class:_t.layerRow,styles:E},z("div",{class:_t.rampLabel},n?x[g]:g),z("div",{class:_t.symbolContainer},z("div",{styles:T},v),m),z("div",{class:_t.rampLabel},n?x[b]:b))}};d([f()],Uf.prototype,"activeLayerInfos",void 0),d([f()],Uf.prototype,"headingLevel",void 0),d([f()],Uf.prototype,"layout",void 0),d([f(),es("esri/widgets/Legend/t9n/Legend")],Uf.prototype,"messages",void 0),d([f(),es("esri/t9n/common")],Uf.prototype,"messagesCommon",void 0),d([f({readOnly:!0})],Uf.prototype,"type",void 0),d([f()],Uf.prototype,"view",void 0),d([ol()],Uf.prototype,"_selectSection",null),Uf=d([$("esri.widgets.Legend.styles.Card")],Uf);const jH=Uf,Vt={service:"esri-legend__service",label:"esri-legend__service-label",layer:"esri-legend__layer",groupLayer:"esri-legend__group-layer",groupLayerChild:"esri-legend__group-layer-child",layerTable:"esri-legend__layer-table",layerTableSizeRamp:"esri-legend__layer-table--size-ramp",layerChildTable:"esri-legend__layer-child-table",layerCaption:"esri-legend__layer-caption",layerBody:"esri-legend__layer-body",layerRow:"esri-legend__layer-row",layerCell:"esri-legend__layer-cell",layerInfo:"esri-legend__layer-cell esri-legend__layer-cell--info",imageryLayerStretchedImage:"esri-legend__imagery-layer-image--stretched",imageryLayerCellStretched:"esri-legend__imagery-layer-cell--stretched",imageryLayerInfoStretched:"esri-legend__imagery-layer-info--stretched",symbolContainer:"esri-legend__layer-cell esri-legend__layer-cell--symbols",symbol:"esri-legend__symbol",rampContainer:"esri-legend__ramps",sizeRamp:"esri-legend__size-ramp",colorRamp:"esri-legend__color-ramp",opacityRamp:"esri-legend__opacity-ramp",borderlessRamp:"esri-legend__borderless-ramp",rampTick:"esri-legend__ramp-tick",rampFirstTick:"esri-legend__ramp-tick-first",rampLastTick:"esri-legend__ramp-tick-last",rampLabelsContainer:"esri-legend__ramp-labels",rampLabel:"esri-legend__ramp-label",univariateAboveAndBelowSymbol:"esri-univariate-above-and-below-ramp__symbol",univariateAboveAndBelowLabel:"esri-univariate-above-and-below-ramp__label",message:"esri-legend__message",header:"esri-widget__heading",hidden:"esri-hidden"},dRt="esri-legend__",uRt=24,E1e={display:"flex",alignItems:"flex-start"},qH={marginLeft:"3px"},GT={display:"table-cell",verticalAlign:"middle"};let d3=class extends Bs{constructor(e,t){super(e,t),this.activeLayerInfos=null,this.headingLevel=3,this.messages=null,this.type="classic"}render(){const e=this.activeLayerInfos,t=e&&e.toArray().map(r=>this._renderLegendForLayer(r)).filter(r=>!!r);return z("div",null,t&&t.length?t:z("div",{class:Vt.message},this.messages.noLegend))}_renderLegendForLayer(e){if(!e.ready)return null;const t=!!e.children.length,r=`${dRt}${e.layer.uid}-version-${e.version}`,i=e.title?Pv({level:this.headingLevel,class:this.classes(Vt.header,Vt.label)},e.title):null;if(t){const n=e.children.map(s=>this._renderLegendForLayer(s)).toArray();return z("div",{key:r,class:this.classes(Vt.service,Vt.groupLayer)},i,n)}{const n=e.legendElements;if(n&&!n.length)return null;const s=n.map(o=>this._renderLegendForElement(o,e.layer,e.effectList)).filter(o=>!!o);if(!s.length)return null;const a={[Vt.groupLayerChild]:!!e.parent};return z("div",{key:r,class:this.classes(Vt.service,a),tabIndex:0},i,z("div",{class:Vt.layer},s))}}_renderLegendForElement(e,t,r,i){const n=e.type==="color-ramp",s=e.type==="opacity-ramp",a=e.type==="size-ramp";let o=null;if(e.type==="symbol-table"||a){const m=e.infos.map(g=>this._renderLegendForElementInfo(g,t,r,a,e.legendType)).filter(g=>!!g);m.length&&(o=z("div",{class:Vt.layerBody},m))}else e.type==="color-ramp"||e.type==="opacity-ramp"||e.type==="heatmap-ramp"||e.type==="stretch-ramp"?o=this._renderLegendForRamp(e,t.opacity):e.type==="relationship-ramp"?o=vIe(e,this.id,t.opacity,r):e.type==="pie-chart-ramp"?o=this._renderPieChartRamp(e):e.type==="univariate-above-and-below-ramp"?o=this._renderUnivariateAboveAndBelowRamp(e,t.opacity,r):e.type==="univariate-color-size-ramp"&&(o=this._renderUnivariateColorSizeRamp(e,t.opacity,r));if(!o)return null;const l=e.title;let c=null;if(typeof l=="string")c=l;else if(l){const m=g5(this.messages,l,n||s);c=SIe(l,n||s)&&l.title?`${l.title} (${m})`:m}const u=i?Vt.layerChildTable:Vt.layerTable,h=c?z("div",{class:Vt.layerCaption},c):null,p={[Vt.layerTableSizeRamp]:a||!i};return z("div",{class:this.classes(u,p)},h,o)}_renderPieChartRamp(e){return z("div",{bind:e.preview,afterCreate:Ta})}_renderUnivariateAboveAndBelowRamp(e,t,r){const{sizeRampElement:i,colorRampElement:n}=xIe(e,t);if(!i)return null;const s=m5(i,"above",!0),a=m5(i,"below",!0),o=12,l=p5(n,{width:o,height:s,rampAlignment:"vertical",opacity:t,type:"above",effectList:r}),c=p5(n,{width:o,height:a,rampAlignment:"vertical",opacity:t,type:"below",effectList:r}),u=kk(i),h=i.infos.map(E=>E.label),p=h.map((E,C)=>C===0?z("div",{key:C,class:E?l?Vt.univariateAboveAndBelowLabel:Vt.rampLabel:null},E):C===2?z("div",null):null),m=h.length-1,g=Math.floor(h.length/2),b=h.map((E,C)=>C===g||C===m?z("div",{key:C,class:E?l?Vt.univariateAboveAndBelowLabel:Vt.rampLabel:null},E):null),w={display:"table-cell",verticalAlign:"middle"},v={marginTop:`${u}px`},x={height:`${s}px`},T={height:`${a}px`};return z("div",{key:"univariate-above-and-below-ramp-preview",styles:E1e},z("div",{class:Vt.layerBody},i.infos.map((E,C)=>z("div",{class:this.classes(Vt.layerRow,Vt.sizeRamp)},z("div",{class:Vt.symbol,styles:w,bind:E.preview,afterCreate:Ta}),l||C%2!=0?null:z("div",{class:Vt.layerInfo},h[C])))),l?z("div",{styles:v,key:"color-ramp-preview"},z("div",{styles:qH},z("div",{styles:GT},z("div",{class:Vt.rampContainer,bind:l,afterCreate:Ta})),z("div",{styles:GT},z("div",{class:Vt.rampLabelsContainer,styles:x},p))),z("div",{styles:qH},z("div",{styles:GT},z("div",{class:Vt.rampContainer,bind:c,afterCreate:Ta})),z("div",{styles:GT},z("div",{class:Vt.rampLabelsContainer,styles:T},b)))):null)}_renderUnivariateColorSizeRamp(e,t,r){const{sizeRampElement:i,colorRampElement:n}=TIe(e);if(!i)return null;const s=kk(i),a=12,o=m5(i,"full",!1),l=p5(n,{width:a,height:o,rampAlignment:"vertical",opacity:t,type:"full",effectList:r}),c=i.infos.length-1,u=i.infos.map((g,b)=>b===0||b===c?z("div",{key:b,class:g.label?n?Vt.univariateAboveAndBelowLabel:Vt.rampLabel:null},g.label):null),h={display:"table-cell",verticalAlign:"middle"},p={marginTop:`${s}px`},m={height:`${o}px`};return z("div",{key:"univariate-above-and-below-ramp-preview",styles:E1e},z("div",{class:Vt.layerBody},i.infos.map(g=>z("div",{class:this.classes(Vt.layerRow,Vt.sizeRamp)},z("div",{class:Vt.symbol,styles:h,bind:g.preview,afterCreate:Ta})))),z("div",{styles:p,key:"color-ramp-preview"},z("div",{styles:qH},z("div",{styles:GT},z("div",{class:Vt.rampContainer,bind:l,afterCreate:Ta})),z("div",{styles:GT},z("div",{class:Vt.rampLabelsContainer,styles:m},u)))))}_renderLegendForRamp(e,t){const r=e.infos,i=e.type==="opacity-ramp",n=e.type==="heatmap-ramp",s=e.type==="stretch-ramp",a=e.preview,o=i?Vt.opacityRamp:"";a.className=`${Vt.colorRamp} ${o}`,t!=null&&(a.style.opacity=t.toString());const l=r.map(h=>z("div",{class:h.label?Vt.rampLabel:null},n?this.messages[h.label]||h.label:s?this._getStretchStopLabel(h):h.label)),c={width:`${uRt}px`},u={height:a.style.height};return z("div",{class:Vt.layerRow},z("div",{class:Vt.symbolContainer,styles:c},z("div",{class:Vt.rampContainer,bind:a,afterCreate:Ta})),z("div",{class:Vt.layerInfo},z("div",{class:Vt.rampLabelsContainer,styles:u},l)))}_getStretchStopLabel(e){return e.label?this.messages[e.label]+": "+(typeof e.value=="string"?e.value:Xh(e.value,{style:"decimal",notation:e.value.toString().includes("e")?"scientific":"standard"})):""}_renderLegendForElementInfo(e,t,r,i,n){if(e.type)return this._renderLegendForElement(e,t,r,!0);let s=null;const a=EIe(t,n);if(e.preview?s=z("div",{class:Vt.symbol,bind:e.preview,afterCreate:Ta}):e.src&&(s=this._renderImage(e,t,a)),!s)return null;const o={[Vt.imageryLayerInfoStretched]:a},l={[Vt.imageryLayerInfoStretched]:a,[Vt.sizeRamp]:!a&&i};return z("div",{class:Vt.layerRow},z("div",{class:this.classes(Vt.symbolContainer,l)},s),z("div",{class:this.classes(Vt.layerInfo,o)},g5(this.messages,e.label,!1)||""))}_renderImage(e,t,r){const{label:i,src:n,opacity:s}=e,a={[Vt.imageryLayerStretchedImage]:r,[Vt.symbol]:!r},o={opacity:`${s!=null?s:t.opacity}`};return z("img",{alt:g5(this.messages,i,!1),src:n,border:0,width:e.width,height:e.height,class:this.classes(a),styles:o})}};d([f()],d3.prototype,"activeLayerInfos",void 0),d([f()],d3.prototype,"headingLevel",void 0),d([f(),es("esri/widgets/Legend/t9n/Legend")],d3.prototype,"messages",void 0),d([f({readOnly:!0})],d3.prototype,"type",void 0),d3=d([$("esri.widgets.Legend.styles.Classic")],d3);const jT=d3,_$={base:"esri-legend",widget:"esri-widget",panel:"esri-widget--panel",widgetIcon:"esri-icon-layer-list"};let Ya=class extends Bs{constructor(e,t){super(e,t),this._handles=new Ft,this.activeLayerInfos=null,this.basemapLegendVisible=!1,this.groundLegendVisible=!1,this.headingLevel=3,this.hideLayersNotInCurrentView=!1,this.keepCacheOnDestroy=!1,this.respectLayerVisibility=!0,this.iconClass=_$.widgetIcon,this.label=void 0,this.layerInfos=null,this.messages=null,this.style=new jT,this.view=null,this.viewModel=new ZAt}initialize(){this.own([rn(()=>this.view,"resize",()=>this.scheduleRender()),rn(()=>this.activeLayerInfos,"change",()=>this._refreshActiveLayerInfos(this.activeLayerInfos)),re(()=>this.headingLevel,e=>{const{style:t}=this;t&&(t.headingLevel=e)}),re(()=>this.style,(e,t)=>{t&&e!==t&&t.destroy(),e&&(e.activeLayerInfos=this.activeLayerInfos,e.type==="card"&&(e.view=this.view),e.headingLevel=this.headingLevel)},Ot)])}destroy(){this._handles=ct(this._handles)}castStyle(e){if(e instanceof jH||e instanceof jT)return e;if(typeof e=="string")return e==="card"?new jH:new jT;if(e&&typeof e.type=="string"){const t={...e};return delete t.type,new(e.type==="card"?jH:jT)(t)}return new jT}render(){return z("div",{class:this.classes(_$.base,_$.widget,this.style instanceof jT?_$.panel:null)},this.style.render())}_refreshActiveLayerInfos(e){this._handles.removeAll(),e.forEach(t=>this._renderOnActiveLayerInfoChange(t)),this.scheduleRender()}_renderOnActiveLayerInfoChange(e){const t=re(()=>e.version,()=>this.scheduleRender());this._handles.add(t,`version_${e.layer.uid}`);const r=rn(()=>e.children,"change",()=>e.children.forEach(i=>this._renderOnActiveLayerInfoChange(i)),Ot);this._handles.add(r,`children_${e.layer.uid}`),e.children.forEach(i=>this._renderOnActiveLayerInfoChange(i))}};d([We("viewModel.activeLayerInfos")],Ya.prototype,"activeLayerInfos",void 0),d([We("viewModel.basemapLegendVisible")],Ya.prototype,"basemapLegendVisible",void 0),d([We("viewModel.groundLegendVisible")],Ya.prototype,"groundLegendVisible",void 0),d([f()],Ya.prototype,"headingLevel",void 0),d([We("viewModel.hideLayersNotInCurrentView")],Ya.prototype,"hideLayersNotInCurrentView",void 0),d([We("viewModel.keepCacheOnDestroy")],Ya.prototype,"keepCacheOnDestroy",void 0),d([We("viewModel.respectLayerVisibility")],Ya.prototype,"respectLayerVisibility",void 0),d([f()],Ya.prototype,"iconClass",void 0),d([f({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],Ya.prototype,"label",void 0),d([We("viewModel.layerInfos")],Ya.prototype,"layerInfos",void 0),d([f(),es("esri/widgets/Legend/t9n/Legend")],Ya.prototype,"messages",void 0),d([f()],Ya.prototype,"style",void 0),d([Xt("style")],Ya.prototype,"castStyle",null),d([We("viewModel.view")],Ya.prototype,"view",void 0),d([f()],Ya.prototype,"viewModel",void 0),Ya=d([$("esri.widgets.Legend")],Ya);const hRt=Ya;async function fRt(e,t={}){await mRt(e,t),Et(t)}async function pRt(e,t={}){const{basemap:r,view:i}=e;if(Et(t),"spatialReferenceLocked"in i&&!i.spatialReferenceLocked||(await r.load(t),Et(t),r.baseLayers.length===0))return;const n=r.baseLayers.getItemAt(0);if(!H4(n))return;if(r.spatialReference){if(i.spatialReference.equals(r.spatialReference))return;C1e()}await n.load(t),Et(t);const s=(("supportedSpatialReferences"in n?n.supportedSpatialReferences:null)||["tileInfo"in n?n.tileInfo.spatialReference:null]).filter(Boolean);s.length!==0&&s.every(a=>!i.spatialReference.equals(a))&&C1e()}function C1e(){throw new k("basemap-compatibility:incompatible-spatial-reference","Basemap spatial reference is not compatible with the view")}async function mRt(e,t){const{basemap:r,view:i}=e;if(await r.load(t),r.baseLayers.length===0)return;const n=r.baseLayers.concat(r.referenceLayers).toArray().filter(a=>!Pce(a)).map(a=>new k("basemap-compatibility:unsupported-basemap-layer-type","Unsupported basemap layer type ${operationalLayerType}",{layer:a,operationalLayerType:a.operationalLayerType||"unknown"}));if(n.length)throw n[0];const s=r.baseLayers.getItemAt(0);if(Pce(s)){try{await s.load(t)}catch(a){const o="basemap-compatibility:unknown-error",l="Unknown basemap compatibility error",{name:c=o,message:u=l,details:h}=a;throw new k(c,u,h)}gRt(s,i)}}function gRt(e,t){const r=t.state.viewingMode;if(!r)return;let i,n;if((e==null?void 0:e.type)==="wmts"){const l=QOe(e,t.spatialReference,r);if(R(l.tileInfo))throw new k("basemapgalleryitem:tiling-scheme-incompatible","Basemap tiling scheme is incompatible with the view");i=l.tileInfo,n=l.fullExtent}else i=e.tileInfo,n=e.fullExtent;if(R(i))return;if(!sR(i.spatialReference,r))throw new k(`basemapgalleryitem:spatial-reference-unsupported-${l7(r)}`,`Basemap spatial reference is unsupported in ${l7(r)} mode`);const s=i.spatialReference.isGeographic,a=(e==null?void 0:e.type)==="vector-tile"?i.getOrCreateCompatible(256,s?1:2):null;if(r===Be.Global){let l=xR(i,n,null,r);if(l&&(e==null?void 0:e.type)==="vector-tile"&&_(n)&&a&&!xR(a,n,null,r)&&(l=null),l){const c=i.spatialReference.isWebMercator?"web-mercator":"wgs84";throw new k(`basemapgalleryitem:tiling-scheme-unsupported-${c}-global`,"Basemap tiling scheme is unsupported in global mode",{error:l})}}else if(Mi.checkUnsupported(i))throw new k("basemapgalleryitem:tiling-scheme-unsupported-local","Basemap tiling scheme is unsupported in local mode");const o=t.get("basemapTerrain.tilingScheme");if(o&&!o.compatibleWith(i)&&((e==null?void 0:e.type)!=="vector-tile"||!a||!o.compatibleWith(a)))throw new k("basemapgalleryitem:tiling-scheme-incompatible","Basemap tiling scheme is incompatible with the view")}let P0=class extends Cm(xe){constructor(e){super(e),this.compatibilityFunction=null,this.error=null,this.state="loading",this.view=null}initialize(){const e=()=>this.refresh();this.handles.add([re(()=>{var t;return(t=this.basemap)==null?void 0:t.loadStatus},e),re(()=>this.compatibilityFunction,e),re(()=>{var t;return this.view&&"basemapTerrain"in this.view&&((t=this.view.basemapTerrain)==null?void 0:t.tilingScheme)},e),re(()=>{var t;return(t=this.view)==null?void 0:t.ready},e),re(()=>{var t;return(t=this.view)==null?void 0:t.spatialReference},e)]),this.refresh()}destroy(){this._cancelRefresh(),this.basemap=null,this.compatibilityFunction=null,this.view=null}get _spatialReferenceTask(){return Nze(this.view,this.basemap)}set basemap(e){const t=this._get("basemap");t&&t.cancelLoad(),e&&e.load().catch(()=>{}),this._set("basemap",e)}get spatialReference(){return this._spatialReferenceTask.spatialReference}refresh(){var i;this._cancelRefresh(),this._set("state","loading");const e=(i=this.basemap)==null?void 0:i.loadStatus;if(e!=="loaded"&&e!=="failed")return;if(!this.compatibilityFunction)return void(e==="loaded"?(this._set("state","ready"),this._set("error",null)):(this._set("state","error"),this._set("error",this.basemap.loadError)));const t=new AbortController,{signal:r}=t;this.compatibilityFunction(this,{signal:r}).then(()=>td(()=>!this._spatialReferenceTask.updating,r)).then(()=>{this._set("state","ready"),this._set("error",null)}).catch(n=>{Ui(n)||(this._set("state","error"),this._set("error",n))}),this._refreshController=t}_cancelRefresh(){this._refreshController&&(this._refreshController.abort(),this._refreshController=null)}};d([f({readOnly:!0})],P0.prototype,"_spatialReferenceTask",null),d([f()],P0.prototype,"basemap",null),d([f()],P0.prototype,"compatibilityFunction",void 0),d([f({readOnly:!0})],P0.prototype,"error",void 0),d([f({readOnly:!0})],P0.prototype,"spatialReference",null),d([f({readOnly:!0})],P0.prototype,"state",void 0),d([f()],P0.prototype,"view",void 0),P0=d([$("esri.widgets.BasemapGallery.support.BasemapGalleryItem")],P0);const CIe=P0,AIe=lt.ofType(dp);let SC=class extends xe{constructor(e){super(e),this.basemaps=new AIe}get state(){return"ready"}refresh(){}};d([f({type:AIe})],SC.prototype,"basemaps",void 0),d([f({readOnly:!0})],SC.prototype,"state",null),SC=d([$("esri.widgets.BasemapGallery.support.LocalBasemapsSource")],SC);const RIe=SC,OIe=lt.ofType(dp),MIe="esri.widgets.BasemapGallery.support.PortalBasemapsSource",yRt=fe.getLogger(MIe);let Ag=class extends hd.LoadableMixin(XR(RIe)){constructor(e){super(e),this._handles=new Ft,this.basemaps=new OIe,this.filterFunction=null,this.portal=Cs.getDefault(),this.query=null,this.updateBasemapsCallback=null}initialize(){this._handles.add([re(()=>{var e,t;return[this.filterFunction,this.loadStatus,(e=this.portal)==null?void 0:e.basemapGalleryGroupQuery,(t=this.portal)==null?void 0:t.user,this.query,this.updateBasemapsCallback]},()=>this.refresh(),Ot)])}destroy(){this._handles.destroy(),this._handles=null,this.filterFunction=null,this.portal=null}get state(){return this.loadStatus==="not-loaded"?"not-loaded":this.loadStatus==="loading"||this._lastPortalBasemapFetchController?"loading":"ready"}load(e){return this.addResolvingPromise(this.portal.load(e)),this.notifyChange("state"),Promise.resolve(this)}async refresh(){if(this.state!=="ready")return;this._lastPortalBasemapFetchController&&(this._lastPortalBasemapFetchController.abort(),this._lastPortalBasemapFetchController=null);const e=this.portal,t=new AbortController;this._lastPortalBasemapFetchController=t,this.notifyChange("state");try{const r=await e.fetchBasemaps(this._toQueryString(this.query),t);this._updateBasemaps(r)}catch(r){if(Ui(r))throw r;yRt.warn(new k("basemap-source:fetch-basemaps-error","Could not fetch basemaps from portal.",{error:r})),this._updateBasemaps()}this._lastPortalBasemapFetchController=null,this.notifyChange("state")}_toQueryString(e){return e&&typeof e!="string"?Object.keys(e).map(t=>`${t}:${e[t]}`).join(" AND "):e}_updateBasemaps(e=[]){let t=this.filterFunction?e.filter(this.filterFunction):e;t=this.updateBasemapsCallback?this.updateBasemapsCallback(t):t,this.basemaps.removeAll(),this.basemaps.addMany(t)}};d([f({readOnly:!0,type:OIe})],Ag.prototype,"basemaps",void 0),d([f()],Ag.prototype,"filterFunction",void 0),d([f({type:Cs})],Ag.prototype,"portal",void 0),d([f()],Ag.prototype,"query",void 0),d([f({readOnly:!0})],Ag.prototype,"state",null),d([f()],Ag.prototype,"updateBasemapsCallback",void 0),Ag=d([$(MIe)],Ag);const zD=Ag,PIe=lt.ofType(CIe);function bRt(e){return e&&e.declaredClass==="esri.portal.Portal"}function vRt(e){return e&&!(e instanceof zD)&&(!!e.portal||!!e.query)}function _Rt(e){return e&&"basemaps"in e&&"state"in e&&"refresh"in e}let Bf=class extends Cm(hd){constructor(e){super(e),this._loadingProjectionEngine=!1,this.items=new PIe,this.source=new zD,this.view=null}initialize(){const e=()=>this._recreateItems();this.handles.add([re(()=>this.state==="ready"?this.compatibilityFunction:null,()=>this._updateItems()),rn(()=>{var t;return(t=this.source)==null?void 0:t.basemaps},"change",e,{onListenerAdd:e})])}get activeBasemap(){var e,t,r;return(r=(t=(e=this.view)==null?void 0:e.map)==null?void 0:t.basemap)!=null?r:null}set activeBasemap(e){var i,n;if(!this.view.map)return;const t=typeof e=="string"?dp.fromId(e):e;if(!t||!this.view.ready)return this.view.map.basemap=t,void this._clearOverride("activeBasemap");const r=t.spatialReference||((n=(i=this.items)==null?void 0:i.find(s=>this.basemapEquals(t,s.basemap)))==null?void 0:n.spatialReference);if(r&&"spatialReferenceLocked"in this.view&&!this.view.spatialReferenceLocked){const s=this.view.spatialReference;if(_(r)&&!_l(s,r)&&!mm(this.view.spatialReference,r)&&!VV())return this._override("activeBasemap",t),this._loadingProjectionEngine=!0,void yA().then(()=>{this._get("activeBasemap")===e&&(this.view.map.basemap=e,this.view.spatialReference=r,this._clearOverride("activeBasemap"))},()=>{}).then(()=>{this._loadingProjectionEngine=!1});this.view.map.basemap=t,this._clearOverride("activeBasemap"),_(r)&&!_l(this.view.spatialReference,r)&&(this.view.spatialReference=r)}else this.view.map.basemap=t,this._clearOverride("activeBasemap")}get compatibilityFunction(){var e;return((e=this.view)==null?void 0:e.type)==="3d"?fRt:pRt}set compatibilityFunction(e){_(e)?this._override("compatibilityFunction",e):this._clearOverride("compatibilityFunction")}castSource(e){return Array.isArray(e)||lt.isCollection(e)?new RIe({basemaps:e}):bRt(e)?new zD({portal:e}):vRt(e)?new zD(e):_Rt(e)?e:null}get state(){var e;return((e=this.view)==null?void 0:e.ready)&&this.source?this._loadingProjectionEngine?"loading":"ready":"disabled"}basemapEquals(e,t){return Fze(e,t)}refresh(){this._recreateItems()}load(e){return this.addResolvingPromise(hd.isLoadable(this.source)?this.source.load(e):null),Promise.resolve(this)}_recreateItems(){var i;const e=(i=this.source)==null?void 0:i.basemaps,{view:t,compatibilityFunction:r}=this;this.items.removeAll().forEach(n=>n.destroy()),e&&this.items.addMany(e.map(n=>new CIe({basemap:n,compatibilityFunction:r,view:t})))}_updateItems(){for(const e of this.items)e.compatibilityFunction=this.compatibilityFunction,e.view=this.view}};d([f()],Bf.prototype,"_loadingProjectionEngine",void 0),d([f()],Bf.prototype,"activeBasemap",null),d([f()],Bf.prototype,"compatibilityFunction",null),d([f({readOnly:!0,type:PIe})],Bf.prototype,"items",void 0),d([f()],Bf.prototype,"source",void 0),d([Xt("source")],Bf.prototype,"castSource",null),d([f({readOnly:!0})],Bf.prototype,"state",null),d([f()],Bf.prototype,"view",void 0),Bf=d([$("esri.widgets.BasemapGallery.BasemapGalleryViewModel")],Bf);const wRt=Bf,Pd={base:"esri-basemap-gallery esri-widget esri-widget--panel-height-only",sourceLoading:"esri-basemap-gallery--source-loading",loader:"esri-basemap-gallery__loader",item:"esri-basemap-gallery__item",itemContainer:"esri-basemap-gallery__item-container",itemTitle:"esri-basemap-gallery__item-title",itemThumbnail:"esri-basemap-gallery__item-thumbnail",selectedItem:"esri-basemap-gallery__item--selected",itemError:"esri-basemap-gallery__item--error",emptyMessage:"esri-widget__content--empty",widgetIcon:"esri-icon-basemap",disabled:"esri-disabled",loaderAnimation:"esri-widget__loader-animation"};let Bd=class extends Bs{constructor(e,t){super(e,t),this._handles=new Ft,this.activeBasemap=null,this.disabled=!1,this.headingLevel=2,this.iconClass=Pd.widgetIcon,this.label=void 0,this.messages=null,this.source=null,this.view=null,this.viewModel=new wRt}initialize(){const e=this._handles;this.own([rn(()=>this.viewModel.items,"change",t=>{const r="basemap-gallery-item-changes",{added:i,moved:n}=t;e.remove(r),e.add([...i,...n].map(s=>re(()=>s.state,()=>this.scheduleRender())),r),this.scheduleRender()}),e,Fa(()=>this.source,()=>this.viewModel.load(),{initial:!0,once:!0})])}destroy(){this._handles.destroy()}loadDependencies(){return ie(()=>import("./calcite-scrim.fbaa1714.js"),[],import.meta.url)}render(){const e=this.get("source.state")==="loading",t=this.disabled||this.get("viewModel.state")==="disabled",r=this.get("viewModel.items").toArray().map(this._renderBasemapGalleryItem,this),i={[Pd.sourceLoading]:e,[Pd.disabled]:t},n=e?z("div",{class:Pd.loader,key:"esri-basemap-gallery__loader"}):null,s=e?null:r.length>0?z("ul",{class:Pd.itemContainer,key:"esri-basemap-gallery__item-container",role:"menu"},r):z("div",{class:Pd.emptyMessage,key:"esri-basemap-gallery__empty-message"},z(Pv,{level:this.headingLevel},this.messages.noBasemaps));return z("div",{class:this.classes(Pd.base,i)},n,s)}_handleClick(e){const t=e.currentTarget["data-item"];t.state==="ready"&&(this.viewModel.activeBasemap=t.basemap)}_renderBasemapGalleryItem(e){const t=e.get("basemap.thumbnailUrl")||xr("esri/themes/base/images/basemap-toggle-64.svg"),r=e.get("basemap.title"),i=e.get("basemap.portalItem.snippet"),n=e.get("error.message")||i||r,{viewModel:s}=this,a=!this.disabled&&s.state!=="disabled"&&e.state==="ready"?0:-1,o=s.basemapEquals(e.basemap,this.activeBasemap),l=s.state==="loading",c={[Pd.selectedItem]:o,[Pd.itemError]:e.state==="error"};return z("li",{"aria-selected":o.toString(),bind:this,class:this.classes(Pd.item,c),"data-item":e,onkeydown:this._handleClick,onclick:this._handleClick,role:"menuitem",tabIndex:a,title:n},z("img",{alt:"",class:Pd.itemThumbnail,src:t}),z("div",{class:Pd.itemTitle},r),e.state==="loading"||o&&l?z("calcite-scrim",null,z("span",{"aria-hidden":"true",role:"presentation",class:Pd.loaderAnimation})):null)}};d([We("viewModel.activeBasemap")],Bd.prototype,"activeBasemap",void 0),d([f()],Bd.prototype,"disabled",void 0),d([f()],Bd.prototype,"headingLevel",void 0),d([f()],Bd.prototype,"iconClass",void 0),d([f({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],Bd.prototype,"label",void 0),d([f(),es("esri/widgets/BasemapGallery/t9n/BasemapGallery")],Bd.prototype,"messages",void 0),d([We("viewModel.source")],Bd.prototype,"source",void 0),d([We("viewModel.view")],Bd.prototype,"view",void 0),d([f()],Bd.prototype,"viewModel",void 0),d([ol()],Bd.prototype,"_handleClick",null),Bd=d([$("esri.widgets.BasemapGallery")],Bd);const xRt=Bd;let Rg=class extends jne(mn.EventedAccessor){constructor(e){super(e),this._initialViewpoint=null,this._goingHomeController=null,this.go=this.go.bind(this)}destroy(){this._cancelGo(),this.view=null}get state(){return this.get("view.ready")?this._goingHomeController?"going-home":"ready":"disabled"}set view(e){this._initialViewpoint=null,this._set("view",e),e&&e.when().then(()=>{this.view===e&&(this._initialViewpoint=e.viewpoint.clone(),this.notifyChange("viewpoint"))})}get viewpoint(){return this._get("viewpoint")||this._initialViewpoint}set viewpoint(e){this._set("viewpoint",e)}async go(){if(!this.get("view.ready"))throw new k("home:disabled-state","Cannot go when disabled.");this._cancelGo(),this.emit("go");const e=new AbortController;this._goingHomeController=e;try{await this.view.when(),await this.callGoTo({target:this.viewpoint,options:{signal:e.signal}})}catch{}this._goingHomeController=null}cancelGo(){this._cancelGo()}_cancelGo(){const{_goingHomeController:e}=this;e&&e.abort(),this._goingHomeController=null}};d([f()],Rg.prototype,"_goingHomeController",void 0),d([f({readOnly:!0})],Rg.prototype,"state",null),d([f()],Rg.prototype,"view",null),d([f({type:Yh})],Rg.prototype,"viewpoint",null),d([f()],Rg.prototype,"go",null),d([f()],Rg.prototype,"cancelGo",null),Rg=d([$("esri.widgets.Home.HomeViewModel")],Rg);const IIe=Rg,h2={base:"esri-home esri-widget--button esri-widget",text:"esri-icon-font-fallback-text",homeIcon:"esri-icon esri-icon-home",loadingIcon:"esri-icon-loading-indicator",rotatingIcon:"esri-rotating",widgetIcon:"esri-icon-home",disabled:"esri-disabled"};let Bl=class extends Bs{constructor(e,t){super(e,t),this.goToOverride=null,this.iconClass=h2.widgetIcon,this.label=void 0,this.messages=null,this.messagesCommon=null,this.view=null,this.viewModel=new IIe,this.viewpoint=null}get homeTitle(){var i;const e=(i=this.viewModel)==null?void 0:i.state,{messagesCommon:t,messages:r}=this;return e==="going-home"?t.cancel:r.title}cancelGo(){return null}go(){return null}render(){var i;const e=(i=this.viewModel)==null?void 0:i.state,{homeTitle:t}=this,r={[h2.disabled]:e==="disabled"};return z("div",{bind:this,class:this.classes(h2.base,r),role:"button",tabIndex:0,onclick:this._go,onkeydown:this._go,"aria-label":t,title:t},this.renderIcon(),this.renderText())}renderIcon(){var r;const e=(r=this.viewModel)==null?void 0:r.state,t={[h2.loadingIcon]:e==="going-home",[h2.rotatingIcon]:e==="going-home"};return z("span",{"aria-hidden":"true",class:this.classes(h2.homeIcon,t)})}renderText(){const{messages:e}=this;return z("span",{class:h2.text},e.button)}_go(){const{viewModel:e}=this;e.state==="going-home"?e.cancelGo():e.go()}};d([We("viewModel.goToOverride")],Bl.prototype,"goToOverride",void 0),d([f({readOnly:!0})],Bl.prototype,"homeTitle",null),d([f()],Bl.prototype,"iconClass",void 0),d([f({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],Bl.prototype,"label",void 0),d([f(),es("esri/widgets/Home/t9n/Home")],Bl.prototype,"messages",void 0),d([f(),es("esri/t9n/common")],Bl.prototype,"messagesCommon",void 0),d([We("viewModel.view")],Bl.prototype,"view",void 0),d([f({type:IIe}),Q4e("go")],Bl.prototype,"viewModel",void 0),d([We("viewModel.viewpoint")],Bl.prototype,"viewpoint",void 0),d([We("viewModel.cancelGo")],Bl.prototype,"cancelGo",null),d([We("viewModel.go")],Bl.prototype,"go",null),d([ol()],Bl.prototype,"_go",null),Bl=d([$("esri.widgets.Home")],Bl);const TRt=Bl;let S1=class extends xe{constructor(e){super(e),this._viewpointHandle=null,this._handles=new Ft,this.group=null}initialize(){this._handles.add(rn(()=>{var e;return(e=this.view)==null?void 0:e.ui},"expand",e=>{const{target:t}=e;t&&t!==this&&t.expanded&&t.group&&t.group===this.group&&this._collapse()}))}destroy(){this._viewpointHandle=null,this.view=null,this._handles.destroy(),this._handles=null}set autoCollapse(e){this._set("autoCollapse",e),this._watchViewpoint()}set expanded(e){const t=!!e;this._set("expanded",t);const r=this.get("view.ui");r&&r.emit("expand",{target:this}),this._viewpointHandleChange(t)}get state(){return this.get("view.ready")?"ready":"disabled"}set view(e){this._get("view")!==e&&(this._set("view",e),e&&Fa(()=>e.ready,()=>{this.view===e&&this._watchViewpoint()},{once:!0,initial:!0}))}_viewpointHandleChange(e){this._viewpointHandle&&(e?Fa(()=>this.view.stationary,()=>this._viewpointHandle.resume(),{once:!0,initial:!0}):this._viewpointHandle.pause())}_watchViewpoint(){const e="viewpoint";this._handles.remove(e),this._viewpointHandle=null;const{autoCollapse:t,view:r}=this;if(r&&t){const i=Mze(()=>r.type==="3d"?r.camera:r.viewpoint,()=>this._collapse());this._handles.add(i,e),this._viewpointHandle=i}}_collapse(){this.expanded=!1}};d([f({value:!1})],S1.prototype,"autoCollapse",null),d([f({value:!1})],S1.prototype,"expanded",null),d([f()],S1.prototype,"group",void 0),d([f({readOnly:!0})],S1.prototype,"state",null),d([f({value:null})],S1.prototype,"view",null),S1=d([$("esri.widgets.Expand.ExpandViewModel")],S1);const $Ie=S1,js={base:"esri-expand esri-widget",modeAuto:"esri-expand--auto",modeDrawer:"esri-expand--drawer",modeFloating:"esri-expand--floating",container:"esri-expand__container",containerExpanded:"esri-expand__container--expanded",panel:"esri-expand__panel",button:"esri-widget--button",text:"esri-icon-font-fallback-text",icon:"esri-collapse__icon",iconExpanded:"esri-expand__icon--expanded",iconNumber:"esri-expand__icon-number",iconNumberExpanded:"esri-expand__icon-number--expanded",expandIcon:"esri-icon-expand",collapseIcon:"esri-icon-collapse",content:"esri-expand__content",contentExpanded:"esri-expand__content--expanded",expandMask:"esri-expand__mask",expandMaskExpanded:"esri-expand__mask--expanded"};let cs=class extends Bs{constructor(e,t){super(e,t),this.autoCollapse=null,this.closeOnEsc=!0,this.collapseTooltip="",this.content="",this.expanded=null,this.expandTooltip="",this.group=null,this.iconNumber=0,this.label=void 0,this.messages=null,this.messagesCommon=null,this.mode="auto",this.view=null,this.viewModel=new $Ie,this._handleKeyDown=r=>{const{closeOnEsc:i,_toggleButtonEl:n,expanded:s}=this;!s||!i||r.target===n||r.key!=="Escape"||(typeof i=="function"?i(r):i)&&(this.expanded=!1,n==null||n.focus())}}get contentId(){return`${this.id}_controls_content`}get expandTitle(){const{expanded:e,messagesCommon:t,collapseTooltip:r,expandTooltip:i}=this;return e?r||t.collapse:i||t.expand}get collapseIconClass(){return js.collapseIcon}set collapseIconClass(e){e?this._override("collapseIconClass",e):this._clearOverride("collapseIconClass")}get expandIconClass(){return fN(this.content)?this.content.iconClass:js.expandIcon}set expandIconClass(e){e?this._override("expandIconClass",e):this._clearOverride("expandIconClass")}expand(){this.viewModel.expanded=!0}collapse(){this.viewModel.expanded=!1}toggle(){this.viewModel.expanded=!this.viewModel.expanded}render(){const{mode:e}=this,t={[js.modeAuto]:e==="auto",[js.modeDrawer]:e==="drawer",[js.modeFloating]:e==="floating"};return z("div",{class:this.classes(js.base,t),onkeydown:this._handleKeyDown},this.renderMask(),this.renderContainer())}renderContainer(){const{expanded:e}=this,t={[js.containerExpanded]:e};return z("div",{class:this.classes(js.container,t)},this.renderPanel(),this.renderContent())}renderMask(){const{expanded:e}=this,t={[js.expandMaskExpanded]:e};return z("div",{bind:this,onclick:this._toggle,class:this.classes(js.expandMask,t)})}renderBadgeNumber(){const{expanded:e,iconNumber:t}=this;return t&&!e?z("span",{key:"expand__icon-number",class:js.iconNumber},t):null}renderPanelNumber(){const{iconNumber:e,expanded:t}=this;return e&&t?z("span",{key:"expand__expand-icon-number",class:this.classes(js.iconNumber,js.iconNumberExpanded)},e):null}renderIcon(){const{collapseIconClass:e,expandIconClass:t,expanded:r}=this,i={[js.iconExpanded]:r,[e]:r,[t]:!r};return e===t&&(i[e]=!0),z("span",{"aria-hidden":"true",class:this.classes(js.icon,i)})}renderTitle(){return z("span",{class:js.text},this.expandTitle)}renderExpandButton(){const{expanded:e,expandTitle:t,contentId:r}=this;return z("div",{afterCreate:this._storeToggleButtonEl,"aria-controls":r,"aria-expanded":e?"true":"false",bind:this,class:js.button,onclick:this._toggle,onkeydown:this._toggle,role:"button",tabindex:"0",title:t},this.renderBadgeNumber(),this.renderIcon(),this.renderTitle())}renderPanel(){return z("div",{class:js.panel},this.renderExpandButton(),this.renderPanelNumber())}renderContent(){const{expanded:e,contentId:t,content:r}=this,i={[js.contentExpanded]:e},n={id:t,role:"region",class:this.classes(js.content,i)};return typeof r=="string"?z("div",{key:"content__string",innerHTML:r,...n}):fN(r)?z("div",{key:"content__widget",...n},r.render()):r instanceof HTMLElement?z("div",{key:"content__html-element",bind:r,afterCreate:this._attachToNode,...n}):K4e(r)?z("div",{key:"content__node",bind:r.domNode,afterCreate:this._attachToNode,...n}):null}_toggle(){this.toggle()}_attachToNode(e){const t=this;e.appendChild(t)}_storeToggleButtonEl(e){this._toggleButtonEl=e}};d([f({readOnly:!0})],cs.prototype,"contentId",null),d([f({readOnly:!0})],cs.prototype,"expandTitle",null),d([We("viewModel.autoCollapse")],cs.prototype,"autoCollapse",void 0),d([f()],cs.prototype,"closeOnEsc",void 0),d([f()],cs.prototype,"collapseIconClass",null),d([f()],cs.prototype,"collapseTooltip",void 0),d([f()],cs.prototype,"content",void 0),d([We("viewModel.expanded")],cs.prototype,"expanded",void 0),d([f()],cs.prototype,"expandIconClass",null),d([f()],cs.prototype,"expandTooltip",void 0),d([We("viewModel.group")],cs.prototype,"group",void 0),d([f()],cs.prototype,"iconNumber",void 0),d([f({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],cs.prototype,"label",void 0),d([f(),es("esri/widgets/Expand/t9n/Expand")],cs.prototype,"messages",void 0),d([f(),es("esri/t9n/common")],cs.prototype,"messagesCommon",void 0),d([f()],cs.prototype,"mode",void 0),d([We("viewModel.view")],cs.prototype,"view",void 0),d([f({type:$Ie})],cs.prototype,"viewModel",void 0),d([ol()],cs.prototype,"_toggle",null),cs=d([$("esri.widgets.Expand")],cs);const SRt=cs,Q8="top-right";function ERt(e){const t=new xRt({view:e,source:[dp.fromId("dark-gray-vector"),dp.fromId("topo-vector"),dp.fromId("streets-vector"),dp.fromId("satellite")]});e.ui.components=["attribution"],e.ui.add(new SRt({view:e,content:t,expandTooltip:"Basemap Gallery"}),Q8),e.ui.add(new IPe({view:e}),Q8),e.ui.add(new LPe({view:e}),Q8),e.ui.add(new TRt({view:e}),Q8),e.ui.add(new FPe({view:e}),Q8)}var oee;let HS=oee=class extends ge{constructor(){super(...arguments),this.field=null,this.minValue=0,this.maxValue=255}clone(){return new oee({field:this.field,minValue:this.minValue,maxValue:this.maxValue})}};d([f({type:String,json:{write:!0}})],HS.prototype,"field",void 0),d([f({type:Number,nonNullable:!0,json:{write:!0}})],HS.prototype,"minValue",void 0),d([f({type:Number,nonNullable:!0,json:{write:!0}})],HS.prototype,"maxValue",void 0),HS=oee=d([$("esri.renderers.support.pointCloud.ColorModulation")],HS);const CRt=HS,HH=new tr({pointCloudFixedSizeAlgorithm:"fixed-size",pointCloudSplatAlgorithm:"splat"});let UD=class extends ge{};d([f({type:HH.apiValues,readOnly:!0,nonNullable:!0,json:{type:HH.jsonValues,read:!1,write:HH.write}})],UD.prototype,"type",void 0),UD=d([$("esri.renderers.support.pointCloud.PointSizeAlgorithm")],UD);const woe=UD;var lee;let WS=lee=class extends woe{constructor(){super(...arguments),this.type="fixed-size",this.size=0,this.useRealWorldSymbolSizes=null}clone(){return new lee({size:this.size,useRealWorldSymbolSizes:this.useRealWorldSymbolSizes})}};d([Ze({pointCloudFixedSizeAlgorithm:"fixed-size"})],WS.prototype,"type",void 0),d([f({type:Number,nonNullable:!0,json:{write:!0}})],WS.prototype,"size",void 0),d([f({type:Boolean,json:{write:!0}})],WS.prototype,"useRealWorldSymbolSizes",void 0),WS=lee=d([$("esri.renderers.support.pointCloud.PointSizeFixedSizeAlgorithm")],WS);const ARt=WS;var cee;let EC=cee=class extends woe{constructor(){super(...arguments),this.type="splat",this.scaleFactor=1}clone(){return new cee({scaleFactor:this.scaleFactor})}};d([Ze({pointCloudSplatAlgorithm:"splat"})],EC.prototype,"type",void 0),d([f({type:Number,value:1,nonNullable:!0,json:{write:!0}})],EC.prototype,"scaleFactor",void 0),EC=cee=d([$("esri.renderers.support.pointCloud.PointSizeSplatAlgorithm")],EC);const RRt=EC,ORt={key:"type",base:woe,typeMap:{"fixed-size":ARt,splat:RRt}},WH=uo()({pointCloudClassBreaksRenderer:"point-cloud-class-breaks",pointCloudRGBRenderer:"point-cloud-rgb",pointCloudStretchRenderer:"point-cloud-stretch",pointCloudUniqueValueRenderer:"point-cloud-unique-value"});let Og=class extends ge{constructor(e){super(e),this.type=void 0,this.pointSizeAlgorithm=null,this.colorModulation=null,this.pointsPerInch=10}clone(){return console.warn(".clone() is not implemented for "+this.declaredClass),null}cloneProperties(){return{pointSizeAlgorithm:te(this.pointSizeAlgorithm),colorModulation:te(this.colorModulation),pointsPerInch:te(this.pointsPerInch)}}};d([f({type:WH.apiValues,readOnly:!0,nonNullable:!0,json:{type:WH.jsonValues,read:!1,write:WH.write}})],Og.prototype,"type",void 0),d([f({types:ORt,json:{write:!0}})],Og.prototype,"pointSizeAlgorithm",void 0),d([f({type:CRt,json:{write:!0}})],Og.prototype,"colorModulation",void 0),d([f({json:{write:!0},nonNullable:!0,type:Number})],Og.prototype,"pointsPerInch",void 0),Og=d([$("esri.renderers.PointCloudRenderer")],Og),function(e){e.fieldTransformTypeKebabDict=new tr({none:"none",lowFourBit:"low-four-bit",highFourBit:"high-four-bit",absoluteValue:"absolute-value",moduloTen:"modulo-ten"})}(Og||(Og={}));const ml=Og;var dee;let E1=dee=class extends ge{constructor(){super(...arguments),this.description=null,this.label=null,this.minValue=0,this.maxValue=0,this.color=null}clone(){return new dee({description:this.description,label:this.label,minValue:this.minValue,maxValue:this.maxValue,color:te(this.color)})}};d([f({type:String,json:{write:!0}})],E1.prototype,"description",void 0),d([f({type:String,json:{write:!0}})],E1.prototype,"label",void 0),d([f({type:Number,json:{read:{source:"classMinValue"},write:{target:"classMinValue"}}})],E1.prototype,"minValue",void 0),d([f({type:Number,json:{read:{source:"classMaxValue"},write:{target:"classMaxValue"}}})],E1.prototype,"maxValue",void 0),d([f({type:Te,json:{type:[$i],write:!0}})],E1.prototype,"color",void 0),E1=dee=d([$("esri.renderers.support.pointCloud.ColorClassBreakInfo")],E1);const MRt=E1;var uee;let C1=uee=class extends ml{constructor(e){super(e),this.type="point-cloud-class-breaks",this.field=null,this.legendOptions=null,this.fieldTransformType=null,this.colorClassBreakInfos=null}clone(){return new uee({...this.cloneProperties(),field:this.field,fieldTransformType:this.fieldTransformType,colorClassBreakInfos:te(this.colorClassBreakInfos),legendOptions:te(this.legendOptions)})}};d([Ze({pointCloudClassBreaksRenderer:"point-cloud-class-breaks"})],C1.prototype,"type",void 0),d([f({json:{write:!0},type:String})],C1.prototype,"field",void 0),d([f({type:nm,json:{write:!0}})],C1.prototype,"legendOptions",void 0),d([f({type:ml.fieldTransformTypeKebabDict.apiValues,json:{type:ml.fieldTransformTypeKebabDict.jsonValues,read:ml.fieldTransformTypeKebabDict.read,write:ml.fieldTransformTypeKebabDict.write}})],C1.prototype,"fieldTransformType",void 0),d([f({type:[MRt],json:{write:!0}})],C1.prototype,"colorClassBreakInfos",void 0),C1=uee=d([$("esri.renderers.PointCloudClassBreaksRenderer")],C1);const QDt=C1;var hee;let CC=hee=class extends ml{constructor(e){super(e),this.type="point-cloud-rgb",this.field=null}clone(){return new hee({...this.cloneProperties(),field:te(this.field)})}};d([Ze({pointCloudRGBRenderer:"point-cloud-rgb"})],CC.prototype,"type",void 0),d([f({type:String,json:{write:!0}})],CC.prototype,"field",void 0),CC=hee=d([$("esri.renderers.PointCloudRGBRenderer")],CC);const JDt=CC;var fee;let A1=fee=class extends ml{constructor(e){super(e),this.type="point-cloud-stretch",this.field=null,this.legendOptions=null,this.fieldTransformType=null,this.stops=null}clone(){return new fee({...this.cloneProperties(),field:te(this.field),fieldTransformType:te(this.fieldTransformType),stops:te(this.stops),legendOptions:te(this.legendOptions)})}};d([Ze({pointCloudStretchRenderer:"point-cloud-stretch"})],A1.prototype,"type",void 0),d([f({json:{write:!0},type:String})],A1.prototype,"field",void 0),d([f({type:nm,json:{write:!0}})],A1.prototype,"legendOptions",void 0),d([f({type:ml.fieldTransformTypeKebabDict.apiValues,json:{type:ml.fieldTransformTypeKebabDict.jsonValues,read:ml.fieldTransformTypeKebabDict.read,write:ml.fieldTransformTypeKebabDict.write}})],A1.prototype,"fieldTransformType",void 0),d([f({type:[r5e],json:{write:!0}})],A1.prototype,"stops",void 0),A1=fee=d([$("esri.renderers.PointCloudStretchRenderer")],A1);const KDt=A1;var pee;let u3=pee=class extends ge{constructor(){super(...arguments),this.description=null,this.label=null,this.values=null,this.color=null}clone(){return new pee({description:this.description,label:this.label,values:te(this.values),color:te(this.color)})}};d([f({type:String,json:{write:!0}})],u3.prototype,"description",void 0),d([f({type:String,json:{write:!0}})],u3.prototype,"label",void 0),d([f({type:[String],json:{write:!0}})],u3.prototype,"values",void 0),d([f({type:Te,json:{type:[$i],write:!0}})],u3.prototype,"color",void 0),u3=pee=d([$("esri.renderers.support.pointCloud.ColorUniqueValueInfo")],u3);const PRt=u3;var mee;let R1=mee=class extends ml{constructor(e){super(e),this.type="point-cloud-unique-value",this.field=null,this.fieldTransformType=null,this.colorUniqueValueInfos=null,this.legendOptions=null}clone(){return new mee({...this.cloneProperties(),field:te(this.field),fieldTransformType:te(this.fieldTransformType),colorUniqueValueInfos:te(this.colorUniqueValueInfos),legendOptions:te(this.legendOptions)})}};d([Ze({pointCloudUniqueValueRenderer:"point-cloud-unique-value"})],R1.prototype,"type",void 0),d([f({json:{write:!0},type:String})],R1.prototype,"field",void 0),d([f({type:ml.fieldTransformTypeKebabDict.apiValues,json:{type:ml.fieldTransformTypeKebabDict.jsonValues,read:ml.fieldTransformTypeKebabDict.read,write:ml.fieldTransformTypeKebabDict.write}})],R1.prototype,"fieldTransformType",void 0),d([f({type:[PRt],json:{write:!0}})],R1.prototype,"colorUniqueValueInfos",void 0),d([f({type:nm,json:{write:!0}})],R1.prototype,"legendOptions",void 0),R1=mee=d([$("esri.renderers.PointCloudUniqueValueRenderer")],R1);const eFt=R1;function A1e(e,t=!1){let r=[];if(t){for(const h of e)if(h.geometry){const p=h.geometry;r.push.apply(r,p.points)}}else r=e.map(h=>h.geometry);const i=[],n=[];let s=1/0,a=-1/0,o=0,l=0,c=0,u=0;for(const h of r){if(!h)continue;t?(i[0]=h[0],i[1]=h[1]):(i[0]=h.x,i[1]=h.y);let p=1/0,m=-1/0;for(const g of r){if(g===h||!g)continue;t?(n[0]=g[0],n[1]=g[1]):(n[0]=g.x,n[1]=g.y);const b=yV(i,n);b>0&&(b<p&&(p=b),b<s&&(s=b),b>m&&(m=b),b>a&&(a=b))}p!==1/0&&(++c,o+=p),m!==-1/0&&(++u,l+=m)}return{minDistance:s!==1/0?s:null,maxDistance:a!==-1/0?a:null,avgMinDistance:c?o/c:null,avgMaxDistance:u?l/u:null}}function IRt(e){let t=0,r=0,i=1/0,n=-1/0;for(const s of e){const a=s.geometry;if(a){let o=0;for(const l of a.paths){const c=hre(l);c>0&&(o+=c)}o>0&&(++t,r+=o,o<i&&(i=o),o>n&&(n=o))}}return{minLength:i!==1/0?i:null,maxLength:n!==-1/0?n:null,avgLength:t?r/t:null}}function $Rt(e){let t=0,r=0,i=1/0,n=-1/0;for(const s of e){const a=s.geometry;if(a){const o=a.extent;if(o){const l=Math.sqrt(o.width*o.height);l>0&&(++t,r+=l,l<i&&(i=l),l>n&&(n=l))}}}return{minSize:i!==1/0?i:null,maxSize:n!==-1/0?n:null,avgSize:t?r/t:null}}function LIe(e){const{features:t}=e;let r=null;switch(e.geometryType){case"point":r=A1e(t);break;case"multipoint":r=A1e(t,!0);break;case"polyline":r=IRt(t);break;case"polygon":r=$Rt(t)}return Promise.resolve(r)}function qT(e,t){return Number(e.toFixed(t))}function LRt(e){const t=FIe(e),r=[],i=t.uniqueValues.length;for(let n=0;n<i;n++){const s=t.uniqueValues[n],a=t.valueFrequency[n],o=s.toString();r.push({value:s,count:a,label:o})}return{uniqueValues:r}}function DIe(e){const{normalizationTotal:t}=e;return{classBreaks:DRt(e),normalizationTotal:t}}function DRt(e){const t=e.definition,{classificationMethod:r,breakCount:i,normalizationType:n,definedInterval:s}=t,a=[];let o=e.values;if(o.length===0)return[];o=o.sort((u,h)=>u-h);const l=o[0],c=o[o.length-1];if(r==="equal-interval")if(o.length>=i){const u=(c-l)/i;let h=l;for(let p=1;p<i;p++){const m=qT(l+p*u,6);a.push({minValue:h,maxValue:m,label:Ac(h,m,n)}),h=m}a.push({minValue:h,maxValue:c,label:Ac(h,c,n)})}else o.forEach(u=>{a.push({minValue:u,maxValue:u,label:Ac(u,u,n)})});else if(r==="natural-breaks"){const u=FIe(o),h=e.valueFrequency||u.valueFrequency,p=FRt(u.uniqueValues,h,i);let m=l;for(let g=1;g<i;g++)if(u.uniqueValues.length>g){const b=qT(u.uniqueValues[p[g]],6);a.push({minValue:m,maxValue:b,label:Ac(m,b,n)}),m=b}a.push({minValue:m,maxValue:c,label:Ac(m,c,n)})}else if(r==="quantile")if(o.length>=i&&l!==c){let u=l,h=Math.ceil(o.length/i),p=0;for(let m=1;m<i;m++){let g=h+p-1;g>o.length&&(g=o.length-1),g<0&&(g=0),a.push({minValue:u,maxValue:o[g],label:Ac(u,o[g],n)}),u=o[g],p+=h,h=Math.ceil((o.length-p)/(i-m))}a.push({minValue:u,maxValue:c,label:Ac(u,c,n)})}else{let u=-1;for(let h=0;h<o.length;h++){const p=o[h];p!==u&&(u=p,a.push({minValue:u,maxValue:p,label:Ac(u,p,n)}),u=p)}}else if(r==="standard-deviation"){const u=VRt(o),h=zRt(o,u);if(h===0)a.push({minValue:o[0],maxValue:o[0],label:Ac(o[0],o[0],n)});else{const p=kRt(l,c,i,u,h)*h;let m=0,g=l;for(let w=i;w>=1;w--){const v=qT(u-(w-.5)*p,6);a.push({minValue:g,maxValue:v,label:Ac(g,v,n)}),g=v,m++}let b=qT(u+.5*p,6);a.push({minValue:g,maxValue:b,label:Ac(g,b,n)}),g=b,m++;for(let w=1;w<=i;w++)b=m===2*i?c:qT(u+(w+.5)*p,6),a.push({minValue:g,maxValue:b,label:Ac(g,b,n)}),g=b,m++}}else if(r==="defined-interval"){if(!s)return a;const u=o[0],h=o[o.length-1],p=Math.ceil((h-u)/s);let m=u;for(let g=1;g<p;g++){const b=qT(u+g*s,6);a.push({minValue:m,maxValue:b,label:Ac(m,b,n)}),m=b}a.push({minValue:m,maxValue:h,label:Ac(m,h,n)})}return a}function Ac(e,t,r){let i=null;return i=e===t?r&&r==="percent-of-total"?e+"%":e.toString():r&&r==="percent-of-total"?e+"% - "+t+"%":e+" - "+t,i}function FIe(e){const t=[],r=[];let i=Number.MIN_VALUE,n=1,s=-1;for(let a=0;a<e.length;a++){const o=e[a];o===i?(n++,r[s]=n):o!==null&&(t.push(o),i=o,n=1,r.push(n),s++)}return{uniqueValues:t,valueFrequency:r}}function FRt(e,t,r){const i=e.length,n=[];r>i&&(r=i);for(let a=0;a<r;a++)n.push(Math.round(a*i/r-1));n.push(i-1);let s=R1e(n,e,t,r);return NRt(s.mean,s.sdcm,n,e,t,r)&&(s=R1e(n,e,t,r)),n}function R1e(e,t,r,i){let n=[],s=[],a=[],o=0;const l=[],c=[];for(let m=0;m<i;m++){const g=L4(m,e,t,r);l.push(g.sbMean),c.push(g.sbSdcm),o+=c[m]}let u,h=o,p=!0;for(;p||o<h;){p=!1,n=[];for(let m=0;m<i;m++)n.push(e[m]);for(let m=0;m<i;m++)for(let g=e[m]+1;g<=e[m+1];g++)if(u=t[g],m>0&&g!==e[m+1]&&Math.abs(u-l[m])>Math.abs(u-l[m-1]))e[m]=g;else if(m<i-1&&e[m]!==g-1&&Math.abs(u-l[m])>Math.abs(u-l[m+1])){e[m+1]=g-1;break}h=o,o=0,s=[],a=[];for(let m=0;m<i;m++){s.push(l[m]),a.push(c[m]);const g=L4(m,e,t,r);l[m]=g.sbMean,c[m]=g.sbSdcm,o+=c[m]}}if(o>h){for(let m=0;m<i;m++)e[m]=n[m],l[m]=s[m],c[m]=a[m];o=h}return{mean:l,sdcm:c}}function NRt(e,t,r,i,n,s){let a=0,o=0,l=0,c=0,u=!0;for(let h=0;h<2&&u;h++){h===0&&(u=!1);for(let p=0;p<s-1;p++)for(;r[p+1]+1!==r[p+2];){r[p+1]=r[p+1]+1;const m=L4(p,r,i,n);l=m.sbMean,a=m.sbSdcm;const g=L4(p+1,r,i,n);if(c=g.sbMean,o=g.sbSdcm,!(a+o<t[p]+t[p+1])){r[p+1]=r[p+1]-1;break}t[p]=a,t[p+1]=o,e[p]=l,e[p+1]=c,u=!0}for(let p=s-1;p>0;p--)for(;r[p]!==r[p-1]+1;){r[p]=r[p]-1;const m=L4(p-1,r,i,n);l=m.sbMean,a=m.sbSdcm;const g=L4(p,r,i,n);if(c=g.sbMean,o=g.sbSdcm,!(a+o<t[p-1]+t[p])){r[p]=r[p]+1;break}t[p-1]=a,t[p]=o,e[p-1]=l,e[p]=c,u=!0}}return u}function kRt(e,t,r,i,n){let s=Math.max(i-e,t-i)/n/r;return s=s>=1?1:s>=.5?.5:.25,s}function VRt(e){let t=0;for(let r=0;r<e.length;r++)t+=e[r];return t/=e.length,t}function zRt(e,t){let r=0;for(let i=0;i<e.length;i++){const n=e[i];r+=(n-t)*(n-t)}return r/=e.length,Math.sqrt(r)}function L4(e,t,r,i){let n=0,s=0;for(let l=t[e]+1;l<=t[e+1];l++){const c=i[l];n+=r[l]*c,s+=c}s<=0&&console.log("Exception in Natural Breaks calculation");const a=n/s;let o=0;for(let l=t[e]+1;l<=t[e+1];l++)o+=i[l]*(r[l]-a)**2;return{sbMean:a,sbSdcm:o}}const O1e=new tr({classBreaksDef:"class-breaks-definition",uniqueValueDef:"unique-value-definition"});let XS=class extends ge{constructor(){super(...arguments),this.baseSymbol=null,this.colorRamp=null,this.type=null}};d([f({type:yc,json:{write:!0}})],XS.prototype,"baseSymbol",void 0),d([f({types:a6e,json:{read:{reader:o6e},write:!0}})],XS.prototype,"colorRamp",void 0),d([f({json:{read:O1e.read,write:O1e.write}})],XS.prototype,"type",void 0),XS=d([$("esri.rest.support.ClassificationDefinition")],XS);const xoe=XS,M1e=new tr({esriClassifyEqualInterval:"equal-interval",esriClassifyManual:"manual",esriClassifyNaturalBreaks:"natural-breaks",esriClassifyQuantile:"quantile",esriClassifyStandardDeviation:"standard-deviation",esriClassifyDefinedInterval:"defined-interval"}),P1e=new tr({esriNormalizeByLog:"log",esriNormalizeByPercentOfTotal:"percent-of-total",esriNormalizeByField:"field"});let Gf=class extends xoe{constructor(){super(...arguments),this.breakCount=null,this.classificationField=null,this.classificationMethod=null,this.normalizationField=null,this.normalizationType=null,this.type="class-breaks-definition"}set standardDeviationInterval(e){this.classificationMethod==="standard-deviation"&&this._set("standardDeviationInterval",e)}set definedInterval(e){this.classificationMethod==="defined-interval"&&this._set("definedInterval",e)}};d([f({json:{write:!0}})],Gf.prototype,"breakCount",void 0),d([f({json:{write:!0}})],Gf.prototype,"classificationField",void 0),d([f({type:String,json:{read:M1e.read,write:M1e.write}})],Gf.prototype,"classificationMethod",void 0),d([f({json:{write:!0}})],Gf.prototype,"normalizationField",void 0),d([f({json:{read:P1e.read,write:P1e.write}})],Gf.prototype,"normalizationType",void 0),d([f({value:null,json:{write:!0}})],Gf.prototype,"standardDeviationInterval",null),d([f({value:null,json:{write:!0}})],Gf.prototype,"definedInterval",null),d([f()],Gf.prototype,"type",void 0),Gf=d([$("esri.rest.support.ClassBreaksDefinition")],Gf);const URt=Gf,BRt="equal-interval",GRt=1,jRt=5,qRt=10,HRt=/\s*(\+|-)?((\d+(\.\d+)?)|(\.\d+))\s*/gi,I1e=new Set(["esriFieldTypeInteger","esriFieldTypeSmallInteger","esriFieldTypeSingle","esriFieldTypeDouble"]),NIe=["min","max","avg","stddev","count","sum","variance","nullcount","median"];function Toe(e){const t=e.normalizationField!=null||e.normalizationType!=null,r=e.minValue!=null||e.maxValue!=null,i=!!e.sqlExpression&&e.supportsSQLExpression;return!t&&!r&&!i}function WRt(e){const t=e.returnDistinct?[...new Set(e.values)]:e.values,r=t.filter(n=>n!=null).length,i={count:r};return e.supportsNullCount&&(i.nullcount=t.length-r),e.percentileParams&&(i.median=VIe(t,e.percentileParams)),i}function kIe(e){const{values:t,useSampleStdDev:r,supportsNullCount:i}=e;let n=Number.POSITIVE_INFINITY,s=Number.NEGATIVE_INFINITY,a=null,o=null,l=null,c=null,u=0;const h=e.minValue==null?-1/0:e.minValue,p=e.maxValue==null?1/0:e.maxValue;for(const g of t)Number.isFinite(g)?g>=h&&g<=p&&(a+=g,n=Math.min(n,g),s=Math.max(s,g),u++):typeof g=="string"&&u++;if(u&&a!=null){o=a/u;let g=0;for(const b of t)Number.isFinite(b)&&b>=h&&b<=p&&(g+=(b-o)**2);c=r?u>1?g/(u-1):0:u>0?g/u:0,l=Math.sqrt(c)}else n=null,s=null;const m={avg:o,count:u,max:s,min:n,stddev:l,sum:a,variance:c};return i&&(m.nullcount=t.length-u),e.percentileParams&&(m.median=VIe(t,e.percentileParams)),m}function VIe(e,t){const{fieldType:r,value:i,orderBy:n,isDiscrete:s}=t,a=XRt(r,n==="desc");if((e=[...e].filter(m=>m!=null).sort((m,g)=>a(m,g))).length===0)return null;if(i<=0)return e[0];if(i>=1)return e[e.length-1];const o=(e.length-1)*i,l=Math.floor(o),c=l+1,u=o%1,h=e[l],p=e[c];return c>=e.length||s||typeof h=="string"||typeof p=="string"?h:h*(1-u)+p*u}function XRt(e,t){const r=t?1:-1,i=YRt(t),n=$1e(t);if(!(!!e&&["esriFieldTypeDate","esriFieldTypeString","esriFieldTypeGUID","esriFieldTypeGlobalID",...I1e].includes(e)))return(s,a)=>typeof s=="number"&&typeof a=="number"?i(s,a):typeof s=="string"&&typeof a=="string"?n(s,a):r;if(e==="esriFieldTypeDate")return(s,a)=>{const o=new Date(s).getTime(),l=new Date(a).getTime();return isNaN(o)||isNaN(l)?r:i(o,l)};if(I1e.has(e))return(s,a)=>i(s,a);if(e==="esriFieldTypeString")return(s,a)=>n(s,a);if(e==="esriFieldTypeGUID"||e==="esriFieldTypeGlobalID"){const s=$1e(t);return(a,o)=>s(L1e(a),L1e(o))}return t?(s,a)=>1:(s,a)=>-1}function $1e(e){return e?(t,r)=>(t=t==null?void 0:t.toUpperCase(),r=r==null?void 0:r.toUpperCase(),t>r?-1:t<r?1:0):(t,r)=>(t=t==null?void 0:t.toUpperCase(),r=r==null?void 0:r.toUpperCase(),t<r?-1:t>r?1:0)}function YRt(e){return e?(t,r)=>r-t:(t,r)=>t-r}function L1e(e){return e.substr(24,12)+e.substr(19,4)+e.substr(16,2)+e.substr(14,2)+e.substr(11,2)+e.substr(9,2)+e.substr(6,2)+e.substr(4,2)+e.substr(2,2)+e.substr(0,2)}function $7(e,t){let r;for(r in e)NIe.includes(r)&&(Number.isFinite(e[r])||(e[r]=null));return t&&["avg","stddev","variance"].forEach(i=>{e[i]!=null&&(e[i]=Math.ceil(e[i]))}),e}function ZRt(e){const t={};for(let r of e)(r==null||typeof r=="string"&&r.trim()==="")&&(r=null),t[r]==null?t[r]={count:1,data:r}:t[r].count++;return{count:t}}function y5(e,t,r){const i=e.count,n=[];r&&t&&t.type==="coded-value"&&t.codedValues.forEach(s=>{const a=s.code;i.hasOwnProperty(a)||(i[a]={data:a,count:0})});for(const s in i){const a=i[s];n.push({value:a.data,count:a.count,label:a.label})}return{uniqueValueInfos:n}}function QRt(e,t,r,i){let n=null;switch(t){case"log":e!==0&&(n=Math.log(e)*Math.LOG10E);break;case"percent-of-total":Number.isFinite(i)&&i!==0&&(n=e/i*100);break;case"field":Number.isFinite(r)&&r!==0&&(n=e/r);break;case"natural-log":e>0&&(n=Math.log(e));break;case"square-root":e>0&&(n=e**.5)}return n}function zIe(e,t){const r=gee({field:t.field,normalizationType:t.normalizationType,normalizationField:t.normalizationField,classificationMethod:t.classificationMethod,standardDeviationInterval:t.standardDeviationInterval,breakCount:t.numClasses||jRt});return e=JRt(e,t.minValue,t.maxValue),DIe({definition:r,values:e,normalizationTotal:t.normalizationTotal})}function JRt(e,t,r){return t=t==null?-1/0:t,r=r==null?1/0:r,e.filter(i=>Number.isFinite(i)&&i>=t&&i<=r)}function gee(e){const t=e.field,r=e.classificationMethod||BRt,i=e.normalizationType,n=e.normalizationField,s=new URt;return s.classificationField=t,s.breakCount=e.breakCount,s.classificationMethod=r,s.standardDeviationInterval=r==="standard-deviation"?e.standardDeviationInterval||GRt:void 0,s.normalizationType=i,s.normalizationField=i==="field"?n:void 0,s}function yee(e,t){let r=e.classBreaks;const i=r.length,n=r[0].minValue,s=r[i-1].maxValue,a=t==="standard-deviation",o=HRt;return r=r.map(l=>{const c=l.label,u={minValue:l.minValue,maxValue:l.maxValue,label:c};if(a&&c){const h=c.match(o).map(p=>+p.trim());h.length===2?(u.minStdDev=h[0],u.maxStdDev=h[1],h[0]<0&&h[1]>0&&(u.hasAvg=!0)):h.length===1&&(c.includes("<")?(u.minStdDev=null,u.maxStdDev=h[0]):c.includes(">")&&(u.minStdDev=h[0],u.maxStdDev=null))}return u}),{minValue:n,maxValue:s,classBreakInfos:r,normalizationTotal:e.normalizationTotal}}function KRt(e,t){const{min:r,max:i,intervals:n}=eOt(e,t),s=n.map((a,o)=>({minValue:n[o][0],maxValue:n[o][1],count:0}));for(const a of e)if(a!=null&&a>=r&&a<=i){const o=tOt(n,a);o>-1&&s[o].count++}return{bins:s,minValue:r,maxValue:i,normalizationTotal:t.normalizationTotal}}function eOt(e,t){const{field:r,classificationMethod:i,standardDeviationInterval:n,normalizationType:s,normalizationField:a,normalizationTotal:o,minValue:l,maxValue:c}=t,u=t.numBins||qRt;let h=null,p=null,m=null;if((!i||i==="equal-interval")&&!s){if(l!=null&&c!=null)h=l,p=c;else{const g=kIe({values:e,minValue:l,maxValue:c,useSampleStdDev:!s,supportsNullCount:Toe({normalizationType:s,normalizationField:a,minValue:l,maxValue:c})});h=g.min,p=g.max}m=Vk(h,p,u)}else{const{classBreaks:g}=zIe(e,{field:r,normalizationType:s,normalizationField:a,normalizationTotal:o,classificationMethod:i,standardDeviationInterval:n,minValue:l,maxValue:c,numClasses:u});h=g[0].minValue,p=g[g.length-1].maxValue,m=g.map(b=>[b.minValue,b.maxValue])}return{min:h,max:p,intervals:m}}function tOt(e,t){let r=-1;for(let i=e.length-1;i>=0;i--)if(t>=e[i][0]){r=i;break}return r}function Vk(e,t,r){const i=(t-e)/r,n=[];let s,a=e;for(let o=1;o<=r;o++)s=a+i,s=Number(s.toFixed(16)),n.push([a,o===r?t:s]),a=s;return n}let HT=null;function rOt(e,t,r){return e.x<0?e.x+=t:e.x>r&&(e.x-=t),e}function iOt(e,t,r,i){const n=U3e(r)?oy(r):null,s=n?Math.round((n.valid[1]-n.valid[0])/t.scale[0]):null;return e.map(a=>{const o=new ot(a.geometry);return tgt(t,o,o,o.hasZ,o.hasM),a.geometry=n?rOt(o,s,i[0]):o,a})}function nOt(e,t=18,r,i,n,s){const a=new Float64Array(n*s);t=Math.round(ur(t));let o=Number.POSITIVE_INFINITY,l=Number.NEGATIVE_INFINITY,c=0,u=0,h=0,p=0;const m=prt(i,r);for(const{geometry:b,attributes:w}of e){const{x:v,y:x}=b,T=Math.max(0,v-t),E=Math.max(0,x-t),C=Math.min(s,x+t),A=Math.min(n,v+t),P=+m(w);for(let I=E;I<C;I++)for(let L=T;L<A;L++){const V=I*n+L,G=R6e(L-v,I-x,t),B=a[V];c=a[V]+=G*P;const X=c-B;u+=X,h+=X*X,c<o&&(o=c),c>l&&(l=c),p++}}if(!p)return{mean:0,stddev:0,min:0,max:0,mid:0,count:0};const g=(l-o)/2;return{mean:u/p,stdDev:Math.sqrt((h-u*u/p)/p),min:o,max:l,mid:g,count:p}}async function B9(e,t){if(!t)return[];const r=e.field,i=e.valueExpression,n=e.normalizationType,s=e.normalizationField,a=e.normalizationTotal,o=[],l=e.viewInfoParams;let c=null,u=null;if(i){if(!HT){const{arcadeUtils:m}=await Wh();HT=m}c=HT.createFunction(i),u=l&&HT.getViewInfo({viewingMode:l.viewingMode,scale:l.scale,spatialReference:new Ye(l.spatialReference)})}const h=e.fieldInfos,p=!(t[0]&&"declaredClass"in t[0]&&t[0].declaredClass==="esri.Graphic")&&h?{fields:h}:null;return t.forEach(m=>{const g=m.attributes;let b;if(i){const w=p?{...m,layer:p}:m,v=HT.createExecContext(w,u);b=HT.executeFunction(c,v)}else g&&(b=g[r]);if(n&&isFinite(b)){const w=g&&parseFloat(g[s]);b=QRt(b,n,w,a)}o.push(b)}),o}function w$(e){const t=e.field,r=e.normalizationType,i=e.normalizationField;let n;return r==="field"?n="(NOT "+i+" = 0)":r!=="log"&&r!=="natural-log"&&r!=="square-root"||(n=`(${t} > 0)`),n}function D1e(e,t){return new k(e,t)}function XH(e,t,r){const i=t!=null?e+" >= "+t:"",n=r!=null?e+" <= "+r:"";let s="";return s=i&&n?ql(i,n):i||n,s?"("+s+")":""}function ql(e,t){let r=_(e)?e:"";return _(t)&&t&&(r=r?"("+r+") AND ("+t+")":t),r}function sOt(e,t,r){const i=aOt({layer:e,fields:t});if(i.length)return D1e(r,"Unknown fields: "+i.join(", ")+". You can only use fields defined in the layer schema");const n=oOt({layer:e,fields:t});return n.length?D1e(r,"Unsupported fields: "+n.join(", ")+". You can only use fields that can be fetched i.e. AdapterFieldUsageInfo.supportsStatistics must be true"):void 0}function aOt(e){const t=e.layer;return e.fields.filter(r=>!t.getField(r))}function oOt(e){const t=e.layer;return e.fields.filter(r=>{const i=t.getFieldUsageInfo(r);return!i||!i.supportsStatistics})}class ny{async open(t){this.connection=await LV("statsWorker",{strategy:"distributed",signal:t})}destroy(){var t;(t=this.connection)==null||t.close()}static getInstance(){return ny.instance||(ny.instance=new ny),ny.instance}async summaryStatistics(t,r){if(!this.connection)throw new k("worker-client:summary-statistics","connection is required");return this.connection.invoke("summaryStatistics",{attribute:t,features:r})}async uniqueValues(t,r){if(!this.connection)throw new k("worker-client:unique-values","connection is required");return this.connection.invoke("uniqueValues",{attribute:t,features:r})}async classBreaks(t,r){if(!this.connection)throw new k("worker-client:class-breaks","connection is required");return this.connection.invoke("classBreaks",{attribute:t,features:r})}async histogram(t,r){if(!this.connection)throw new k("worker-client:histogram","connection is required");return this.connection.invoke("histogram",{attribute:t,features:r})}async heatmapStatistics(t,r){if(!this.connection)throw new k("worker-client:heatmap-statistics","connection is required");return this.connection.invoke("heatmapStatistics",{attribute:t,features:r})}}const G9={light:["streets","gray","topo","terrain","national-geographic","oceans","osm","gray-vector","streets-vector","topo-vector","streets-relief-vector","streets-navigation-vector","arcgis-light-gray","arcgis-navigation","arcgis-streets","arcgis-streets-relief","arcgis-topographic","arcgis-oceans","osm-standard","osm-standard-relief","osm-streets","osm-streets-relief","osm-light-gray","arcgis-terrain","arcgis-charted-territory","arcgis-community","arcgis-colored-pencil","arcgis-modern-antique","arcgis-midcentury","arcgis-newspaper","arcgis-hillshade-light"],dark:["satellite","hybrid","dark-gray","dark-gray-vector","streets-night-vector","arcgis-imagery","arcgis-imagery-standard","arcgis-dark-gray","arcgis-navigation-night","arcgis-streets-night","osm-dark-gray","arcgis-nova","arcgis-hillshade-dark"]},F1e={years:365,months:30,days:1,hours:1/24,minutes:1/1440,seconds:1/86400,milliseconds:1/864e5},lOt=["integer","small-integer"];let YH=null;async function _w(e){const t=e.field,r=e.normalizationField,i=e.valueExpression;let n=[];if(i){if(!YH){const{arcadeUtils:s}=await Wh();YH=s}n=YH.extractFieldNames(i)}return t&&n.push(t),r&&n.push(r),n}function J8(e){return String(e).padStart(2,"0")}function N1e(e,t,r){let i;return t==="date"||t==="number"?(t==="number"&&(e=new Date(e)),i=`TIMESTAMP'${r?e.getFullYear():e.getUTCFullYear()}-${J8((r?e.getMonth():e.getUTCMonth())+1)}-${J8(r?e.getDate():e.getUTCDate())} ${J8(r?e.getHours():e.getUTCHours())}:${J8(r?e.getMinutes():e.getUTCMinutes())}:${J8(r?e.getSeconds():e.getUTCSeconds())}'`):i=e,i}function cOt(e,t,r,i){const{hasQueryEngine:n}=e;let s=`(${N1e(r,k1e(e,r),n)} - ${N1e(t,k1e(e,t),n)})`;n&&(s=`(${s} * ${F1e.milliseconds})`);let a=F1e[i],o="/";return a<1&&(a=1/a,o="*"),{sqlExpression:a===1?s:`(${s} ${o} ${a})`,sqlWhere:null}}function k1e(e,t){if(t instanceof Date)return"date";if(typeof t=="number")return"number";if(typeof t=="string"){const r=e.getField(t);if(t.toLowerCase()==="<now>")return;if(r&&r.type==="date")return"field"}}function Soe(e,t=G9){for(const r in t)if(t[r].includes(e))return r}function Eoe(e,t,r=!0){let i=null;return e&&(typeof e=="string"?t.includes(e)&&(i=e):i=Dze(e)),r?i||"gray":i}function UIe(e,t){const r=t&&e.getField(t);return r&&lOt.includes(r.type)}function AC(e){return`cast(${e} as float)`}let RC=class extends ge{constructor(){super(...arguments),this.classificationDefinition=null,this.where=null}};d([f({type:xoe,json:{read:{source:"classificationDef"},write:{target:"classificationDef"}}})],RC.prototype,"classificationDefinition",void 0),d([f({type:String,json:{write:!0}})],RC.prototype,"where",void 0),RC=d([$("esri.rest.support.GenerateRendererParameters")],RC);const ZH=RC;let Mg=class extends xoe{constructor(){super(...arguments),this.attributeField=null,this.attributeField2=null,this.attributeField3=null,this.fieldDelimiter=null,this.type="unique-value-definition"}get uniqueValueFields(){const e=[];return this.attributeField&&e.push(this.attributeField),this.attributeField2&&e.push(this.attributeField2),this.attributeField3&&e.push(this.attributeField3),e}};d([f()],Mg.prototype,"attributeField",void 0),d([f()],Mg.prototype,"attributeField2",void 0),d([f()],Mg.prototype,"attributeField3",void 0),d([f({json:{write:!0}})],Mg.prototype,"fieldDelimiter",void 0),d([f({json:{write:!0}})],Mg.prototype,"uniqueValueFields",null),d([f()],Mg.prototype,"type",void 0),Mg=d([$("esri.rest.support.UniqueValueDefinition")],Mg);const dOt=Mg,BIe="no_dominant_category";function uOt(e){return{expression:hOt(e,{returnFieldName:!0,defaultValue:`'${BIe}'`})}}function hOt(e,t){const{returnFieldName:r,defaultValue:i,layer:n}=t,s=[];if(r&&i){const a=e.map(o=>`${o} <= 0`).join(" AND ");s.push(`WHEN ${a} THEN ${i}`)}for(const a of e){const o=e.reduce((u,h)=>(a!==h&&u.push(`${a} > ${h}`),u),[]).join(" AND "),l=n&&UIe(n,a),c=r&&`'${a}'`?`'${a}'`:l?AC(a):a;s.push(`WHEN ${o} THEN ${c}`)}return`CASE ${s.join(" ")} ELSE ${i||"0"} END`}function fOt(e){return e&&e.map(t=>`$feature["${t}"];`).join(`
`)+`
`||""}function pOt(e,t=!1){const r=e.map(n=>`"${n}"`),i=`
  if(value != null && value >= 0) {
    if (totalValue == null) { totalValue = 0; }
    totalValue = totalValue + value;
  }
  `;return`
  var fieldNames = [ ${r.join(", ")} ];
  var numFields = ${r.length};
  var maxValueField = null;
  var maxValue = -Infinity;
  var value, i, totalValue = null;

  for(i = 0; i < numFields; i++) {
    value = $feature[fieldNames[i]];

    if(value > 0) {
      if(value > maxValue) {
        maxValue = value;
        maxValueField = fieldNames[i];
      }
      else if (value == maxValue) {
        maxValueField = null;
      }
    }
    ${t?i:""}
  }
  `}function GIe(e){const t=pOt(e);return`
  ${fOt(e)}
  ${t}
  return maxValueField;
  `}async function IR(e){const{attribute:t,features:r}=e,{normalizationType:i,normalizationField:n,minValue:s,maxValue:a,fieldType:o}=t,l=await B9({field:t.field,valueExpression:t.valueExpression,normalizationType:i,normalizationField:n,normalizationTotal:t.normalizationTotal,viewInfoParams:t.viewInfoParams,fieldInfos:t.fieldInfos},r),c=Toe({normalizationType:i,normalizationField:n,minValue:s,maxValue:a}),u={value:.5,fieldType:o},h=o==="esriFieldTypeString"?WRt({values:l,supportsNullCount:c,percentileParams:u}):kIe({values:l,minValue:s,maxValue:a,useSampleStdDev:!i,supportsNullCount:c,percentileParams:u});return $7(h,o==="esriFieldTypeDate")}async function Coe(e){const{attribute:t,features:r}=e,i=await B9({field:t.field,valueExpression:t.valueExpression,viewInfoParams:t.viewInfoParams,fieldInfos:t.fieldInfos},r),n=ZRt(i);return y5(n,t.domain,t.returnAllCodedValues)}async function Aoe(e){const{attribute:t,features:r}=e,{field:i,normalizationType:n,normalizationField:s,normalizationTotal:a,classificationMethod:o}=t,l=await B9({field:i,valueExpression:t.valueExpression,normalizationType:n,normalizationField:s,normalizationTotal:a,viewInfoParams:t.viewInfoParams,fieldInfos:t.fieldInfos},r),c=zIe(l,{field:i,normalizationType:n,normalizationField:s,normalizationTotal:a,classificationMethod:o,standardDeviationInterval:t.standardDeviationInterval,numClasses:t.numClasses,minValue:t.minValue,maxValue:t.maxValue});return yee(c,o)}async function Roe(e){const{attribute:t,features:r}=e,{field:i,normalizationType:n,normalizationField:s,normalizationTotal:a,classificationMethod:o}=t,l=await B9({field:i,valueExpression:t.valueExpression,normalizationType:n,normalizationField:s,normalizationTotal:a,viewInfoParams:t.viewInfoParams,fieldInfos:t.fieldInfos},r);return KRt(l,{field:i,normalizationType:n,normalizationField:s,normalizationTotal:a,classificationMethod:o,standardDeviationInterval:t.standardDeviationInterval,numBins:t.numBins,minValue:t.minValue,maxValue:t.maxValue})}async function jIe(e){const{attribute:t,features:r}=e,{field:i,radius:n,fieldOffset:s,transform:a,spatialReference:o,size:l}=t,c=iOt(r,a,o,l),{count:u,min:h,max:p,mean:m,stdDev:g}=nOt(c,n,s,i,l[0],l[1]);return{count:u,min:h,max:p,avg:m,stddev:g}}const mOt=Object.freeze(Object.defineProperty({__proto__:null,classBreaks:Aoe,heatmapStatistics:jIe,histogram:Roe,summaryStatistics:IR,uniqueValues:Coe},Symbol.toStringTag,{value:"Module"}));let jf=class extends hd{constructor(e){super(e)}};d([f({constructOnly:!0})],jf.prototype,"layer",void 0),d([f()],jf.prototype,"geometryType",void 0),d([f()],jf.prototype,"objectIdField",void 0),d([f()],jf.prototype,"supportsSQLExpression",void 0),d([f()],jf.prototype,"hasQueryEngine",void 0),d([f()],jf.prototype,"minScale",void 0),d([f()],jf.prototype,"maxScale",void 0),d([f()],jf.prototype,"fullExtent",void 0),jf=d([$("esri.smartMapping.support.adapters.LayerAdapter")],jf);const Ooe=jf,gOt=/_value$/i,yOt=Math.LOG10E;function L7(e){return e.map(t=>t.toJSON())}async function zk(e,t,r){const i=[];if(t)for(const n of t){const s=e.getField(n);"availableFields"in r&&!r.availableFields.includes(s.name)&&i.push(s.name)}return i}function bee(e,t){const r=e&&e.features,i=r&&r[0]&&r[0].attributes,n={};for(const s in i)n[s.replace(gOt,"").toLowerCase()]=i[s];return n.totalcount!=null&&n.totalcount>=n.count&&(n.nullcount=n.totalcount-n.count),delete n.totalcount,n.min===n.max&&n.min!=null&&n.stddev==null&&(n.stddev=n.variance=0),t&&(["min","max","avg","stddev","sum","variance"].forEach(s=>{n[s]!=null&&(n[s]=Math.ceil(n[s]))}),n.min===n.max&&n.min!=null&&(n.avg=n.min,n.stddev=n.variance=0)),n}function bOt(e){const t=[],r=e.classBreaks,i=r[0].minValue,n=r[r.length-1].maxValue;r.forEach(a=>{t.push([a.minValue,a.maxValue])});const s={field:e.field,normalizationType:e.normalizationType,normalizationField:e.normalizationField,normalizationTotal:e.normalizationTotal,layer:e.layer};return{min:i,max:n,intervals:t,sqlExpr:OC(s),excludeZerosExpr:e.where,normTotal:e.normalizationTotal}}function OC(e){const{field:t,normalizationType:r,normalizationField:i,normalizationTotal:n,layer:s}=e,a=UIe(s,t);let o=t;return r==="percent-of-total"?o=`((${a?AC(t):t} / ${n}) * 100)`:r==="log"?o=`(log(${t}) * ${yOt})`:r==="field"?o=`(${a?AC(t):t} / ${i})`:r==="natural-log"?o=`(log(${a?AC(t):t}))`:r==="square-root"&&(o=`(power(${a?AC(t):t}, 0.5))`),o}function qIe(e,t){let r;if(t=t.toLowerCase(),e){for(const i in e)if(i.toLowerCase()!==t){r=e[i];break}}return r}function vee(e,t){let r;if(t=t.toLowerCase(),e){for(const i in e)if(i.toLowerCase()===t){r=e[i];break}}return r}function HIe(e,t,r,i,n){const s={},a="countOFExpr";e&&e.features&&e.features.forEach(l=>{const c=l.attributes,u=qIe(c,a),h=vee(c,a);u!==0&&(s[u]=h)});const o=[];return Vk(t,r,i).forEach((l,c)=>{const u=(c+1).toString();o.push({minValue:l[0],maxValue:l[1],count:s.hasOwnProperty(u)?s[u]:0})}),{bins:o,minValue:t,maxValue:r,normalizationTotal:n}}function Uk(e,t,r,i,n,s){const a=e&&e.features,o="countOF"+(r||"Expr"),l={};let c=!1;if(a.forEach(u=>{const h=u.attributes,p=vee(h,o);let m=r?vee(h,r):qIe(h,o);m===null&&p===0&&(c=!0),(m==null||typeof m=="string"&&m.trim()==="")&&(m=null),l[m]==null?l[m]={count:p,data:m}:l[m].count=l[m].count+p}),r&&c){const u=r+" is NULL";return t.queryFeatureCount({whereClause:u,view:i,signal:s}).then(h=>(h=h||0,l.null.count=l.null.count+h,QH(l,n))).catch(()=>(Et(s),QH(l,n)))}return Promise.resolve(QH(l,n))}function QH(e,t){if(t)for(const r in e)e[r].label=t[r];return{count:e}}function V1e(e,t){return cOt(e,new Date(0),t,"milliseconds").sqlExpression}function vv(e){var t;return{viewingMode:e.type==="2d"?"map":e.viewingMode,scale:e.scale,spatialReference:(t=e.spatialReference)==null?void 0:t.toJSON()}}function WIe(e,t){const r=e.map(n=>n.value),i=t.filter(n=>!r.includes(n));for(const n of i)e.push({value:n,count:0});e.sort((n,s)=>t.indexOf(n.value)-t.indexOf(s.value));for(const n of e)n.value===BIe&&(n.value=null);return{predominantCategoryInfos:e}}function vOt(e,t){return t}function Moe(e,t,r,i){switch(r){case 0:return $R(e,t+i,0);case 1:return e.originPosition==="lowerLeft"?$R(e,t+i,1):xOt(e,t+i,1)}}function XIe(e,t,r,i){return r===2?$R(e,t,2):Moe(e,t,r,i)}function _Ot(e,t,r,i){return r===2?$R(e,t,3):Moe(e,t,r,i)}function wOt(e,t,r,i){return r===3?$R(e,t,3):XIe(e,t,r,i)}function $R({translate:e,scale:t},r,i){return e[i]+r*t[i]}function xOt({translate:e,scale:t},r,i){return e[i]-r*t[i]}class TOt{constructor(t){this.options=t,this.geometryTypes=["esriGeometryPoint","esriGeometryMultipoint","esriGeometryPolyline","esriGeometryPolygon"],this.previousCoordinate=[0,0],this.transform=null,this.applyTransform=vOt,this.lengths=[],this.currentLengthIndex=0,this.toAddInCurrentPath=0,this.vertexDimension=0,this.coordinateBuffer=null,this.coordinateBufferPtr=0,this._attributesConstructor=()=>{}}createFeatureResult(){return{fields:[],features:[]}}finishFeatureResult(t){if(this.options.applyTransform&&(t.transform=null),this._attributesConstructor=()=>{},this.coordinateBuffer=null,this.lengths.length=0,!t.hasZ)return;const r=Wre(t.geometryType,this.options.sourceSpatialReference,t.spatialReference);if(!R(r))for(const i of t.features)r(i.geometry)}createSpatialReference(){return{}}addField(t,r){t.fields.push(r);const i=t.fields.map(n=>n.name);this._attributesConstructor=function(){for(const n of i)this[n]=null}}addFeature(t,r){t.features.push(r)}prepareFeatures(t){switch(this.transform=t.transform,this.options.applyTransform&&t.transform&&(this.applyTransform=this._deriveApplyTransform(t)),this.vertexDimension=2,t.hasZ&&this.vertexDimension++,t.hasM&&this.vertexDimension++,t.geometryType){case"esriGeometryPoint":this.addCoordinate=(r,i,n)=>this.addCoordinatePoint(r,i,n),this.createGeometry=r=>this.createPointGeometry(r);break;case"esriGeometryPolygon":this.addCoordinate=(r,i,n)=>this._addCoordinatePolygon(r,i,n),this.createGeometry=r=>this._createPolygonGeometry(r);break;case"esriGeometryPolyline":this.addCoordinate=(r,i,n)=>this._addCoordinatePolyline(r,i,n),this.createGeometry=r=>this._createPolylineGeometry(r);break;case"esriGeometryMultipoint":this.addCoordinate=(r,i,n)=>this._addCoordinateMultipoint(r,i,n),this.createGeometry=r=>this._createMultipointGeometry(r);break;default:t.geometryType}}createFeature(){return this.lengths.length=0,this.currentLengthIndex=0,this.previousCoordinate[0]=0,this.previousCoordinate[1]=0,this.coordinateBuffer=null,this.coordinateBufferPtr=0,{attributes:new this._attributesConstructor}}allocateCoordinates(){}addLength(t,r,i){this.lengths.length===0&&(this.toAddInCurrentPath=r),this.lengths.push(r)}addQueryGeometry(t,r){const{queryGeometry:i,queryGeometryType:n}=r,s=XZ(i.clone(),i,!1,!1,this.transform),a=Z5e(s,n,!1,!1);t.queryGeometryType=n,t.queryGeometry={...a}}createPointGeometry(t){const r={x:0,y:0,spatialReference:t.spatialReference};return t.hasZ&&(r.z=0),t.hasM&&(r.m=0),r}addCoordinatePoint(t,r,i){switch(r=this.applyTransform(this.transform,r,i,0),i){case 0:t.x=r;break;case 1:t.y=r;break;case 2:"z"in t?t.z=r:t.m=r;break;case 3:t.m=r}}_transformPathLikeValue(t,r){let i=0;return r<=1&&(i=this.previousCoordinate[r],this.previousCoordinate[r]+=t),this.applyTransform(this.transform,t,r,i)}_addCoordinatePolyline(t,r,i){this._dehydratedAddPointsCoordinate(t.paths,r,i)}_addCoordinatePolygon(t,r,i){this._dehydratedAddPointsCoordinate(t.rings,r,i)}_addCoordinateMultipoint(t,r,i){i===0&&t.points.push([]);const n=this._transformPathLikeValue(r,i);t.points[t.points.length-1].push(n)}_createPolygonGeometry(t){return{rings:[[]],spatialReference:t.spatialReference,hasZ:!!t.hasZ,hasM:!!t.hasM}}_createPolylineGeometry(t){return{paths:[[]],spatialReference:t.spatialReference,hasZ:!!t.hasZ,hasM:!!t.hasM}}_createMultipointGeometry(t){return{points:[],spatialReference:t.spatialReference,hasZ:!!t.hasZ,hasM:!!t.hasM}}_dehydratedAddPointsCoordinate(t,r,i){i===0&&this.toAddInCurrentPath--==0&&(t.push([]),this.toAddInCurrentPath=this.lengths[++this.currentLengthIndex]-1,this.previousCoordinate[0]=0,this.previousCoordinate[1]=0);const n=this._transformPathLikeValue(r,i),s=t[t.length-1];i===0&&(this.coordinateBufferPtr=0,this.coordinateBuffer=new Array(this.vertexDimension),s.push(this.coordinateBuffer)),this.coordinateBuffer[this.coordinateBufferPtr++]=n}_deriveApplyTransform(t){const{hasZ:r,hasM:i}=t;return r&&i?wOt:r?XIe:i?_Ot:Moe}}async function SOt(e,t,r){const i=Lu(e),n={...r},s=Zn.from(t),a=!s.quantizationParameters,{data:o}=await I5e(i,s,new TOt({sourceSpatialReference:s.sourceSpatialReference,applyTransform:a}),n);return o}function EOt(e){const t=e.toJSON();return t.attachmentTypes&&(t.attachmentTypes=t.attachmentTypes.join(",")),t.keywords&&(t.keywords=t.keywords.join(",")),t.globalIds&&(t.globalIds=t.globalIds.join(",")),t.objectIds&&(t.objectIds=t.objectIds.join(",")),t.size&&(t.size=t.size.join(",")),t}function COt(e,t){const r={};for(const i of e){const{parentObjectId:n,parentGlobalId:s,attachmentInfos:a}=i;for(const o of a){const{id:l}=o,c=ake(q3e(`${t}/${n}/attachments/${l}`)),u=N4e.fromJSON(o);u.set({url:c,parentObjectId:n,parentGlobalId:s}),r[n]?r[n].push(u):r[n]=[u]}}return r}function AOt(e,t,r){let i={query:sO({...e.query,f:"json",...EOt(t)})};return r&&(i={...r,...i,query:{...r.query,...i.query}}),qt(e.path+"/queryAttachments",i)}async function ROt(e,t,r){const i=Lu(e);return AOt(i,cN.from(t),{...r}).then(n=>COt(n.data.attachmentGroups,i.path))}async function OOt(e,t,r){const i=Lu(e);return D5e(i,Zn.from(t),{...r}).then(n=>n.data.count)}async function MOt(e,t,r){const i=Lu(e);return F5e(i,Zn.from(t),{...r}).then(n=>({count:n.data.count,extent:Zt.fromJSON(n.data.extent)}))}async function POt(e,t,r){const i=Lu(e);return L5e(i,Zn.from(t),{...r}).then(n=>n.data.objectIds)}function IOt(e,t){const r=e.toJSON();return r.objectIds&&(r.objectIds=r.objectIds.join(",")),r.orderByFields&&(r.orderByFields=r.orderByFields.join(",")),r.outFields&&!(t!=null&&t.returnCountOnly)?r.outFields.includes("*")?r.outFields="*":r.outFields=r.outFields.join(","):delete r.outFields,r.outSpatialReference&&(r.outSR=r.outSR.wkid||JSON.stringify(r.outSR.toJSON()),delete r.outSpatialReference),r.dynamicDataSource&&(r.layer=JSON.stringify({source:r.dynamicDataSource}),delete r.dynamicDataSource),r}async function $Ot(e,t,r){const i=await YIe(e,t,r),n=i.data,s=n.geometryType,a=n.spatialReference,o={};for(const l of n.relatedRecordGroups){const c={fields:void 0,objectIdFieldName:void 0,geometryType:s,spatialReference:a,hasZ:!!n.hasZ,hasM:!!n.hasM,features:l.relatedRecords};if(l.objectId!=null)o[l.objectId]=c;else for(const u in l)l.hasOwnProperty(u)&&u!=="relatedRecords"&&(o[l[u]]=c)}return{...i,data:o}}async function LOt(e,t,r){const i=await YIe(e,t,r,{returnCountOnly:!0}),n=i.data,s={};for(const a of n.relatedRecordGroups)a.objectId!=null&&(s[a.objectId]=a.count);return{...i,data:s}}async function YIe(e,t,r={},i){const n=sO({...e.query,f:"json",...i,...IOt(t,i)});return qt(e.path+"/queryRelatedRecords",{...r,query:{...r.query,...n}})}async function DOt(e,t,r){t=Bw.from(t);const i=Lu(e);return $Ot(i,t,r).then(n=>{const s=n.data,a={};return Object.keys(s).forEach(o=>a[o]=ym.fromJSON(s[o])),a})}async function FOt(e,t,r){t=Bw.from(t);const i=Lu(e);return LOt(i,t,{...r}).then(n=>n.data)}const z1e="Layer does not support extent calculation.";function NOt(e,t){var s,a;const r=e.geometry,i=e.toJSON(),n=i;if(_(r)&&(n.geometry=JSON.stringify(r),n.geometryType=yx(r),n.inSR=r.spatialReference.wkid||JSON.stringify(r.spatialReference)),(s=i.topFilter)!=null&&s.groupByFields&&(n.topFilter.groupByFields=i.topFilter.groupByFields.join(",")),(a=i.topFilter)!=null&&a.orderByFields&&(n.topFilter.orderByFields=i.topFilter.orderByFields.join(",")),i.topFilter&&(n.topFilter=JSON.stringify(n.topFilter)),i.objectIds&&(n.objectIds=i.objectIds.join(",")),i.orderByFields&&(n.orderByFields=i.orderByFields.join(",")),i.outFields&&!((t==null?void 0:t.returnCountOnly)||(t==null?void 0:t.returnExtentOnly)||(t==null?void 0:t.returnIdsOnly))?i.outFields.includes("*")?n.outFields="*":n.outFields=i.outFields.join(","):delete n.outFields,i.outSR?n.outSR=i.outSR.wkid||JSON.stringify(i.outSR):r&&i.returnGeometry&&(n.outSR=n.inSR),i.returnGeometry&&delete i.returnGeometry,i.timeExtent){const o=i.timeExtent,{start:l,end:c}=o;l==null&&c==null||(n.time=l===c?l:`${l==null?"null":l},${c==null?"null":c}`),delete i.timeExtent}return n}async function kOt(e,t,r,i){const n=await aB(e,t,"json",i);return _N(t,r,n.data),n}async function VOt(e,t,r){return _(t.timeExtent)&&t.timeExtent.isEmpty?{data:{objectIds:[]}}:aB(e,t,"json",r,{returnIdsOnly:!0})}async function zOt(e,t,r){return _(t.timeExtent)&&t.timeExtent.isEmpty?{data:{count:0,extent:null}}:aB(e,t,"json",r,{returnExtentOnly:!0,returnCountOnly:!0}).then(i=>{const n=i.data;if(n.hasOwnProperty("extent"))return i;if(n.features)throw new Error(z1e);if(n.hasOwnProperty("count"))throw new Error(z1e);return i})}function UOt(e,t,r){return _(t.timeExtent)&&t.timeExtent.isEmpty?Promise.resolve({data:{count:0}}):aB(e,t,"json",r,{returnIdsOnly:!0,returnCountOnly:!0})}function aB(e,t,r,i={},n={}){const s=typeof e=="string"?pn(e):e,a=t.geometry?[t.geometry]:[];return i.responseType=r==="pbf"?"array-buffer":"json",Gie(a,null,i).then(o=>{const l=o&&o[0];_(l)&&((t=t.clone()).geometry=l);const c=sO({...s.query,f:r,...n,...NOt(t,n)});return qt(vl(s.path,"queryTopFeatures"),{...i,query:{...c,...i.query}})})}async function BOt(e,t,r,i){const n=Lu(e),s={...i},{data:a}=await kOt(n,uv.from(t),r,s);return ym.fromJSON(a)}async function GOt(e,t,r){const i=Lu(e);return(await VOt(i,uv.from(t),{...r})).data.objectIds}async function jOt(e,t,r){const i=Lu(e),n=await zOt(i,uv.from(t),{...r});return{count:n.data.count,extent:Zt.fromJSON(n.data.extent)}}async function qOt(e,t,r){const i=Lu(e);return(await UOt(i,uv.from(t),{...r})).data.count}let YS=class extends xe{constructor(...e){super(...e),this.requestOptions=null,this.url=null}normalizeCtorArgs(e,t){return typeof e!="string"?e:{url:e,...t}}get parsedUrl(){return this._parseUrl(this.url)}_parseUrl(e){return e?pn(e):null}_encode(e,t,r){const i={};for(const n in e){if(n==="declaredClass")continue;const s=e[n];if(s!=null&&typeof s!="function")if(Array.isArray(s)){i[n]=[];for(let a=0;a<s.length;a++)i[n][a]=this._encode(s[a])}else if(typeof s=="object")if(s.toJSON){const a=s.toJSON(r&&r[n]);i[n]=t?a:JSON.stringify(a)}else i[n]=t?s:JSON.stringify(s);else i[n]=s}return i}};d([f({readOnly:!0})],YS.prototype,"parsedUrl",null),d([f()],YS.prototype,"requestOptions",void 0),d([f({type:String})],YS.prototype,"url",void 0),YS=d([$("esri.tasks.Task")],YS);const ZIe=YS;let Pg=class extends ZIe{constructor(e){super(e),this.dynamicDataSource=null,this.fieldsIndex=null,this.format="json",this.gdbVersion=null,this.infoFor3D=null,this.sourceSpatialReference=null}execute(e,t){return this.executeJSON(e,t).then(r=>this.featureSetFromJSON(e,r,t))}async executeJSON(e,t){var l;const r={...this.requestOptions,...t},i=this._normalizeQuery(e),n=((l=e.outStatistics)==null?void 0:l[0])!=null,s=ue("featurelayer-pbf-statistics"),a=!n||s;let o;if(this.format==="pbf"&&a)try{o=await SOt(this.url,i,r)}catch(c){if(c.name!=="query:parsing-pbf")throw c;this.format="json"}return this.format!=="json"&&a||(o=await k5e(this.url,i,r)),this._normalizeFields(o.fields),o}async featureSetFromJSON(e,t,r){if(!this._queryIs3DObjectFormat(e)||R(this.infoFor3D)||!t.features||!t.features.length)return ym.fromJSON(t);const{meshFeatureSetFromJSON:i}=await q2e(ie(()=>import("./meshFeatureSet.6552fe19.js"),["meshFeatureSet.6552fe19.js","georeference.f85d44f2.js"],import.meta.url),r);return i(e,this.infoFor3D,t)}executeForCount(e,t){const r={...this.requestOptions,...t},i=this._normalizeQuery(e);return OOt(this.url,i,r)}executeForExtent(e,t){const r={...this.requestOptions,...t},i=this._normalizeQuery(e);return MOt(this.url,i,r)}executeForIds(e,t){const r={...this.requestOptions,...t},i=this._normalizeQuery(e);return POt(this.url,i,r)}executeRelationshipQuery(e,t){e=Bw.from(e);const r={...this.requestOptions,...t};return(this.gdbVersion||this.dynamicDataSource)&&((e=e.clone()).gdbVersion=e.gdbVersion||this.gdbVersion,e.dynamicDataSource=e.dynamicDataSource||this.dynamicDataSource),DOt(this.url,e,r)}executeRelationshipQueryForCount(e,t){e=Bw.from(e);const r={...this.requestOptions,...t};return(this.gdbVersion||this.dynamicDataSource)&&((e=e.clone()).gdbVersion=e.gdbVersion||this.gdbVersion,e.dynamicDataSource=e.dynamicDataSource||this.dynamicDataSource),FOt(this.url,e,r)}executeAttachmentQuery(e,t){const r={...this.requestOptions,...t};return ROt(this.url,e,r)}executeTopFeaturesQuery(e,t){const r={...this.requestOptions,...t};return BOt(this.parsedUrl,e,this.sourceSpatialReference,r)}executeForTopIds(e,t){const r={...this.requestOptions,...t};return GOt(this.parsedUrl,e,r)}executeForTopExtents(e,t){const r={...this.requestOptions,...t};return jOt(this.parsedUrl,e,r)}executeForTopCount(e,t){const r={...this.requestOptions,...t};return qOt(this.parsedUrl,e,r)}_normalizeQuery(e){let t=Zn.from(e);if(t.sourceSpatialReference=t.sourceSpatialReference||this.sourceSpatialReference,(this.gdbVersion||this.dynamicDataSource)&&(t=t===e?t.clone():t,t.gdbVersion=e.gdbVersion||this.gdbVersion,t.dynamicDataSource=e.dynamicDataSource?jc.from(e.dynamicDataSource):this.dynamicDataSource),_(this.infoFor3D)&&this._queryIs3DObjectFormat(e)){t=t===e?t.clone():t,t.formatOf3DObjects=null;for(const r of this.infoFor3D.queryFormats){if(r.id==="3D_glb"){t.formatOf3DObjects=r.id;break}r.id!=="3D_gltf"||t.formatOf3DObjects||(t.formatOf3DObjects=r.id)}if(!t.formatOf3DObjects)throw new k("query:unsupported-3d-query-formats","Could not find any supported 3D object query format. Only supported formats are 3D_glb and 3D_gltf");if(R(t.outFields)||!t.outFields.includes("*")){t=t===e?t.clone():t,R(t.outFields)&&(t.outFields=[]);const{originX:r,originY:i,originZ:n,translationX:s,translationY:a,translationZ:o,scaleX:l,scaleY:c,scaleZ:u,rotationX:h,rotationY:p,rotationZ:m,rotationDeg:g}=this.infoFor3D.transformFieldRoles;t.outFields.push(r,i,n,s,a,o,l,c,u,h,p,m,g)}}return t}_normalizeFields(e){if(_(this.fieldsIndex)&&_(e))for(const t of e){const r=this.fieldsIndex.get(t.name);r&&Object.assign(t,r.toJSON())}}_queryIs3DObjectFormat(e){return _(this.infoFor3D)&&e.returnGeometry&&e.multipatchOption!=="xyFootprint"&&!e.outStatistics}};d([f({type:jc})],Pg.prototype,"dynamicDataSource",void 0),d([f()],Pg.prototype,"fieldsIndex",void 0),d([f()],Pg.prototype,"format",void 0),d([f()],Pg.prototype,"gdbVersion",void 0),d([f()],Pg.prototype,"infoFor3D",void 0),d([f()],Pg.prototype,"sourceSpatialReference",void 0),Pg=d([$("esri.tasks.QueryTask")],Pg);const HOt=Pg;let h3=class extends ZIe{constructor(e){super(e),this._field=null,this.checkValueRange=null,this.gdbVersion=null,this.source=null}get parsedUrl(){const e=this._parseUrl(this.url);return e.path+="/generateRenderer",e}execute(e,t){var s;const{classificationDefinition:r}=e,i={...e.toJSON(),f:"json"};if(r.declaredClass==="esri.rest.support.ClassBreaksDefinition"?this._field=r.classificationField:this._field=r.attributeField,this.source){const a={source:(s=this.source)==null?void 0:s.toJSON()};i.layer=JSON.stringify(a)}this.gdbVersion&&(i.gdbVersion=this.gdbVersion),i.classificationDef&&(i.classificationDef=JSON.stringify(i.classificationDef));let n={query:i};return(this.requestOptions||t)&&(n={...this.requestOptions,...t,...n}),qt(this.parsedUrl.path,n).then(a=>this._handleExecuteResponse(a))}_handleExecuteResponse(e){const t=e&&e.data;if(!t)return;if(!this.checkValueRange){const a=this._processRendererJSON(t);return Promise.resolve(a)}const r=new HOt({url:this.url}),i=new pw({statisticType:"min",onStatisticField:this._field}),n=new pw({statisticType:"max",onStatisticField:this._field}),s=new Zn({outStatistics:[i,n]});return r.execute(s).then(a=>{const o=a.features[0].attributes;let l=null,c=null;for(const u in o)u.toLowerCase().indexOf("min")===0?l=o[u]:c=o[u];return this._processRendererJSON(t,l,c)})}_processRendererJSON(e,t,r){if(e.type==="classBreaks"){const i=$6e(e);return{classBreaks:i.classBreakInfos.map((n,s)=>(s===0&&t!=null&&(n.minValue=t),s===i.classBreakInfos.length-1&&r!=null&&(n.maxValue=r),{minValue:n.minValue,maxValue:n.maxValue,label:n.label})),normalizationTotal:i.normalizationTotal}}return{uniqueValues:e.uniqueValueInfos.map((i,n)=>(n===0&&t!=null&&(i.value=t),n===e.uniqueValueInfos.length-1&&r!=null&&(i.value=r),{count:i.count,value:i.value,label:i.label}))}}};d([f()],h3.prototype,"checkValueRange",void 0),d([f()],h3.prototype,"gdbVersion",void 0),d([f({type:jc})],h3.prototype,"source",void 0),d([f({readOnly:!0})],h3.prototype,"parsedUrl",null),h3=d([$("esri.tasks.GenerateRendererTask")],h3);const WOt=h3,XOt=fe.getLogger("esri.smartMapping.support.adapters.FeatureLayerAdapter"),JH=5,x$=10,U1e=2e4,YOt=4e5;let BD=class extends Ooe{constructor(e){super(e)}destroy(){var e;this._hasLocalSource=null,(e=this.workerClient)==null||e.destroy()}_isStatsSupportedOnService(){const e=this.layer;return!e.get("capabilities.query.supportsStatistics")||this.geometryType==="multipatch"&&!wne(e.url)&&e.version<10.5?Promise.reject(new k("feature-layer-adapter:not-supported","Layer does not support statistics query")):Promise.resolve()}async _waitForLayerViewUpdate(e){if(!e)throw new k("feature-layer-adapter:insufficient-data","layerView is required to fetch the features");const t=new AbortController,r=td(()=>!e.updating,t.signal);await H2e(r,5e3,t).catch(i=>{throw XOt.warn("LayerView is taking too long to update. Aborting fetch from layerView."),i})}async _fetchFeaturesFromMemory(e,t,r,i){const n=this.layer,s=i==="json";if(this._hasLocalSource){const o=await n.queryFeatures(t);return s?L7(o.features):o.features}if(await this._waitForLayerViewUpdate(e),s&&"queryFeaturesJSON"in e&&e.queryFeaturesJSON){const{features:o}=await e.queryFeaturesJSON(t,{signal:r});return o}const a=await e.queryFeatures(t,{signal:r});return s?L7(a.features):a.features}_fetchFeaturesFromService(e,t){return this.layer.queryFeatures(e,{signal:t}).then(r=>r.features)}_fetchFeaturesJSONFromService(e,t){return this._fetchFeaturesFromService(e,t).then(L7)}_fetchFeaturesForStats(e,t){return _w({field:e.field,normalizationField:e.normalizationField,valueExpression:e.valueExpression}).then(r=>this.getSampleFeatures({sampleSize:-1,view:e.view,returnGeometry:e.returnGeometry,requiredFields:r,signal:e.signal},t))}_summaryStatsFromGenRend(e){const t=e.normalizationType,r=e.normalizationField;return this.classBreaks({field:e.field,numClasses:JH,classificationMethod:"standard-deviation",standardDeviationInterval:.25,normalizationType:t,normalizationField:t==="field"?r:void 0,minValue:e.minValue,maxValue:e.maxValue,signal:e.signal}).then(i=>{let n,s,a;if(i.classBreakInfos.some(l=>(l.hasAvg&&(n=l),!!n)),n){const l=n.maxValue-n.minValue;s=n.minValue+l/2,a=4*l}const o={min:i.minValue,max:i.maxValue,avg:s,stddev:a};return $7(o)})}_getSummaryStatsQuery(e,t){const{field:r,normalizationType:i,normalizationField:n,normalizationTotal:s,minValue:a,maxValue:o}=e,l=this.supportsSQLExpression&&t?V1e(this,r):e.sqlExpression,c=OC({field:r,normalizationType:i,normalizationField:n,normalizationTotal:s,layer:this}),u=l||c,h=u?XH(u,a,o):null,p=w$({field:r,normalizationField:n,normalizationType:i}),m=ql(e.sqlWhere,p),g=ql(m,h),b=Toe({normalizationField:n,normalizationType:i,sqlExpression:l,supportsSQLExpression:this.supportsSQLExpression,minValue:a,maxValue:o}),w=MUe(this.getField(r)),v=NIe.filter(T=>T==="nullcount"?b:!w||T==="count"),x=this.layer.createQuery();return x.where=ql(x.where,g),x.sqlFormat=l?"standard":null,x.outStatistics=v.map(T=>{const E=new pw;let C=null,A=null,P=`${T}_value`;return T==="variance"?(C="var",A=u):T==="nullcount"?(C="count",A=this.layer.objectIdField,P="totalcount_value"):T==="median"?(C="percentile-continuous",A=u,E.statisticParameters={value:.5}):(C=T,A=u),E.statisticType=C,E.onStatisticField=A,E.outStatisticFieldName=P,E}),x}async _summaryStatsFromServiceQuery(e,t){await this._isStatsSupportedOnService(),e.normalizationType==="percent-of-total"&&(e.normalizationTotal=await this._getNormalizationTotal(e.field,e.normalizationType));const r=this._getSummaryStatsQuery(e,t),i=await this.layer.queryFeatures(r,{signal:e.signal}),n=bee(i,t);return $7(n)}async _summaryStatsFromClientQuery(e,t){const r=this._getSummaryStatsQuery(e,t),i=await this.layer.queryFeatures(r,{signal:e.signal}),n=bee(i,t);return $7(n)}async _getNormalizationTotalFromMemory(e,t,r){const{featuresJSON:i,graphics:n,layerView:s,query:a}=t,o=(!i&&!n&&s&&"querySummaryStatistics"in s?await s.querySummaryStatistics(a,{field:e},{signal:r}):i?await this.workerClient.summaryStatistics({field:e},i):await IR({attribute:{field:e},features:n})).sum;if(o==null)throw new k("feature-layer-adapter:invalid","invalid normalizationTotal");return o}async _summaryStatsFromMemory(e,t){const{view:r,field:i,valueExpression:n,normalizationType:s,signal:a}=e,o={field:i,valueExpression:n,normalizationType:s,normalizationField:e.normalizationField,normalizationTotal:e.normalizationTotal,minValue:e.minValue,maxValue:e.maxValue},{featuresJSON:l,graphics:c,layerView:u,query:h,fieldInfos:p}=await this._processStatsFromMemoryParams({...e,layerViewFunc:"querySummaryStatistics"});return n&&r&&(l||c)&&(o.fieldType=t!=null&&t.type?Bie.toJSON(t.type):null,o.viewInfoParams=vv(r),o.fieldInfos=p),s==="percent-of-total"&&e.normalizationTotal==null&&(o.normalizationTotal=await this._getNormalizationTotalFromMemory(i,{featuresJSON:l,graphics:c,layerView:u,query:h},a)),!l&&!c&&u&&"querySummaryStatistics"in u?u.querySummaryStatistics(h,o,{signal:a}):l?this.workerClient.summaryStatistics(o,l):IR({attribute:o,features:c})}async _processStatsFromMemoryParams(e){const t=e.features;if(t!=null&&t.length)return t.length&&"declaredClass"in t[0]&&t[0].declaredClass==="esri.Graphic"?{graphics:t}:{featuresJSON:t};const{view:r,field:i,normalizationField:n,valueExpression:s,returnGeometry:a,layerViewFunc:o,signal:l}=e;let c=null,u=null,h=null,p=null,m=null;if(r)try{c=await r.whenLayerView(this.layer),u=o in c&&typeof c[o]=="function"}catch{u=!1}if(u)try{await this._waitForLayerViewUpdate(c);const g=await _w({field:i,normalizationField:n,valueExpression:s});(await zk(this,g,c)).length?u=!1:(h=this.layer.createQuery(),h.outFields=g,h.returnGeometry=!1),c.suspended&&(u=!1)}catch{u=!1}if(!u&&(p=await this._fetchFeaturesForStats({field:i,valueExpression:s,normalizationField:n,returnGeometry:a,view:r,signal:l},"json"),m=(await _w({valueExpression:s})).map(g=>{var b;return(b=this.getField(g))==null?void 0:b.toJSON()}).filter(Boolean),!(p!=null&&p.length)))throw new k("feature-layer-adapter:insufficient-data","No features are available to calculate statistics");return{layerView:c,query:h,featuresJSON:p,fieldInfos:m}}_uvFromGenRenderer(e,t){const r=e.field,i=new dOt;i.attributeField=r;const n=new ZH;return n.classificationDefinition=i,this.generateRenderer(n,e.signal).then(s=>{const a={},o=this.getField(r);return s.uniqueValues.forEach(l=>{let c=l.value;c!=null&&c!==""&&(typeof c!="string"||c.trim()!==""&&c.toLowerCase()!=="<null>")||(c=null),a[c]==null?a[c]={count:l.count,data:J9(o)&&c?Number(c):c}:a[c].count=a[c].count+l.count}),{count:a}}).then(s=>y5(s,t,e.returnAllCodedValues))}_getUVQuery(e){const t=e.field,r=e.sqlExpression,i="countOF"+(t||"Expr"),n=new pw;n.statisticType="count",n.onStatisticField=r?"1":t,n.outStatisticFieldName=i;const s=this.layer.createQuery();return s.where=ql(s.where,e.sqlWhere),s.sqlFormat=r?"standard":null,s.outStatistics=[n],s.groupByFieldsForStatistics=[t||r],s}_uvFromServiceQuery(e,t){return this._isStatsSupportedOnService().then(()=>this.layer.queryFeatures(this._getUVQuery(e),{signal:e.signal})).then(r=>Uk(r,this,e.field,e.view,null,e.signal)).then(r=>y5(r,t,e.returnAllCodedValues))}async _uvFromClientQuery(e,t){const{signal:r}=e,i=this._getUVQuery(e),n=await this.layer.queryFeatures(i,{signal:r}),s=await Uk(n,this,e.field,e.view,null,r);return y5(s,t,e.returnAllCodedValues)}async _uvFromMemory(e,t){const{view:r,field:i,valueExpression:n,returnAllCodedValues:s,signal:a}=e,{featuresJSON:o,graphics:l,layerView:c,query:u,fieldInfos:h}=await this._processStatsFromMemoryParams({...e,layerViewFunc:"queryUniqueValues"}),p={field:i,valueExpression:n,domain:t,returnAllCodedValues:s};return n&&r&&o&&(p.viewInfoParams=vv(r),p.fieldInfos=h),!o&&!l&&c&&"queryUniqueValues"in c?c.queryUniqueValues(u,p,{signal:a}):o?this.workerClient.uniqueValues(p,o):Coe({attribute:p,features:l})}_calcBinsSQL(e,t,r){const i=[],n=t.length;return t.forEach((s,a)=>{const[o,l]=s;let c=null;c=a!==0||r?a!==n-1||r?ql(`${e} >= ${o}`,`${e} ${a===n-1?" <= ":" < "} ${l}`):`${e} >= ${o}`:`${e} < ${l}`,i.push("WHEN ("+c+") THEN "+(a+1))}),["CASE",i.join(" "),"ELSE 0","END"].join(" ")}_getNormalizationTotal(e,t,r){return e&&t==="percent-of-total"?this.summaryStatistics({field:e,signal:r}).then(i=>i.sum):Promise.resolve(null)}_getQueryParamsForExpr(e,t){const r=e.valueExpression||e.sqlExpression,i=e.signal;if(!r){const{field:n,normalizationType:s,normalizationField:a}=e,o=n?this.getField(n):null,l=X4(o);return{sqlExpression:l?V1e(this,n):OC({field:n,normalizationType:s,normalizationField:a,normalizationTotal:t,layer:this}),sqlWhere:l?null:e.sqlWhere||w$({field:n,normalizationType:s,normalizationField:a}),signal:i}}return{valueExpression:e.valueExpression,sqlExpression:e.sqlExpression,sqlWhere:e.sqlWhere,signal:i}}_getDataRange(e,t,r){return t!=null&&r!=null?Promise.resolve({min:t,max:r}):this.summaryStatistics(e).then(i=>({min:i.min,max:i.max}))}_histogramForExpr(e){return this._getNormalizationTotal(e.field,e.normalizationType,e.signal).then(t=>{const r=this._getQueryParamsForExpr(e,t);return this._getDataRange(r,e.minValue,e.maxValue).then(i=>{const{min:n,max:s}=i,a=e.numBins||x$,o=Vk(n,s,a),l=this._calcBinsSQL(r.sqlExpression,o,e.minValue!=null&&e.maxValue!=null),c=new pw({statisticType:"count",outStatisticFieldName:"countOFExpr",onStatisticField:"1"}),u=this.layer.createQuery();return u.where=ql(u.where,r.sqlWhere),u.sqlFormat="standard",u.outStatistics=[c],u.groupByFieldsForStatistics=[l],u.orderByFields=[l],this._isStatsSupportedOnService().then(()=>this.layer.queryFeatures(u,{signal:r.signal})).then(h=>HIe(h,n,s,a,t))})})}_histogramForField(e){let t=null;return t=e.minValue!=null&&e.maxValue!=null?Promise.resolve({min:e.minValue,max:e.maxValue}):this.summaryStatistics(e).then(r=>{if(!r.count)throw new k("feature-layer-adapter:insufficient-data","Either the layer has no features or none of the features have data for the field");return{min:r.min,max:r.max}}),t.then(r=>this._getBins({min:r.min,max:r.max},e.field,e.numBins,e.view,e.signal))}_getBins(e,t,r=x$,i,n){const{min:s,max:a,normTotal:o,excludeZerosExpr:l}=e,c=e.intervals||Vk(s,a,r),u=e.sqlExpr||t;return this._queryBins(c,u,l,i,n).then(h=>({bins:h.map((p,m)=>({minValue:c[m][0],maxValue:c[m][1],count:p.value})),minValue:s,maxValue:a,normalizationTotal:o}))}_queryBins(e,t,r,i,n){const s=[],a=e.length;for(let o=0;o<a;o++){const l=ql(r,ql(t+" >= "+e[o][0],e[o][1]!==null?t+(o===a-1?" <= ":" < ")+e[o][1]:""));s.push(l)}return dn(s.map(o=>this.queryFeatureCount({whereClause:o,view:i,signal:n})))}_binParamsFromGenRend(e,t){const{field:r,normalizationType:i,normalizationField:n,signal:s}=e,a=w$({field:r,normalizationType:i,normalizationField:n}),o=new ZH({classificationDefinition:gee({field:r,normalizationType:i,normalizationField:n,classificationMethod:e.classificationMethod,standardDeviationInterval:e.standardDeviationInterval,breakCount:e.numBins||x$}),where:ql(a,t)});return this.generateRenderer(o,s).then(l=>{const{normalizationTotal:c,classBreaks:u}=l;return bOt({field:r,normalizationType:i,normalizationField:n,normalizationTotal:c,classBreaks:u,where:a,layer:this})})}async _histogramFromMemory(e){const{view:t,field:r,signal:i}=e,{featuresJSON:n,graphics:s,layerView:a,query:o,fieldInfos:l}=await this._processStatsFromMemoryParams({...e,layerViewFunc:"queryHistogram"}),c={field:r,valueExpression:e.valueExpression,normalizationType:e.normalizationType,normalizationField:e.normalizationField,normalizationTotal:e.normalizationTotal,minValue:e.minValue,maxValue:e.maxValue,standardDeviationInterval:e.standardDeviationInterval,classificationMethod:e.classificationMethod,numBins:e.numBins};return e.valueExpression&&t&&n&&(c.viewInfoParams=vv(t),c.fieldInfos=l),e.normalizationType==="percent-of-total"&&e.normalizationTotal==null&&(c.normalizationTotal=await this._getNormalizationTotalFromMemory(r,{featuresJSON:n,graphics:s,layerView:a,query:o},i)),!n&&!s&&a&&"queryHistogram"in a?a.queryHistogram(o,c,{signal:i}):n?this.workerClient.histogram(c,n):Roe({attribute:c,features:s})}_classBreaksFromGenRend(e){const{field:t,normalizationType:r,normalizationField:i,normalizationTotal:n,signal:s}=e,a=w$({field:t,normalizationType:r,normalizationField:i}),o=OC({field:t,normalizationType:r,normalizationField:i,normalizationTotal:n,layer:this}),l=XH(o,e.minValue,e.maxValue),c=gee({field:t,normalizationType:r,normalizationField:i,classificationMethod:e.classificationMethod,standardDeviationInterval:e.standardDeviationInterval,breakCount:e.numClasses||JH}),u=new ZH;return u.classificationDefinition=c,u.where=ql(a,l),this.generateRenderer(u,s).then(h=>yee(h,e.classificationMethod))}_classBreaksFromInterpolation(e){const{minValue:t,maxValue:r}=e,i=e.numClasses||JH,n=[],s=(r-t)/i;for(let l=0;l<i;l++){const c=t+l*s;n.push({minValue:c,maxValue:c+s})}n[i-1].maxValue=r;const a={classBreaks:n,normalizationTotal:e.normalizationTotal},o=yee(a,e.classificationMethod);return Promise.resolve(o)}async _classBreaksFromMemory(e){const{view:t,field:r,signal:i}=e,{featuresJSON:n,graphics:s,layerView:a,query:o,fieldInfos:l}=await this._processStatsFromMemoryParams({...e,layerViewFunc:"queryClassBreaks"}),c={field:r,valueExpression:e.valueExpression,normalizationType:e.normalizationType,normalizationField:e.normalizationField,normalizationTotal:e.normalizationTotal,minValue:e.minValue,maxValue:e.maxValue,standardDeviationInterval:e.standardDeviationInterval,classificationMethod:e.classificationMethod,numClasses:e.numClasses};return e.valueExpression&&t&&n&&(c.viewInfoParams=vv(t),c.fieldInfos=l),e.normalizationType==="percent-of-total"&&e.normalizationTotal==null&&(c.normalizationTotal=await this._getNormalizationTotalFromMemory(r,{featuresJSON:n,graphics:s,layerView:a,query:o},i)),!n&&!s&&a&&"queryClassBreaks"in a?a.queryClassBreaks(o,c,{signal:i}):n?this.workerClient.classBreaks(c,n):Aoe({attribute:c,features:s})}async _heatmapStatsFromMemory(e,t){var c;const{view:r,field:i,radius:n}=e,{featuresJSON:s,graphics:a}=await this._processStatsFromMemoryParams({...e,returnGeometry:!0}),o=new N5e({extent:r.extent,tolerance:r.type==="2d"?r.state.resolution:r.pixelSizeAt(r.center)}),l={field:i,fieldOffset:t,radius:n,transform:Ymt(o),spatialReference:(c=r.spatialReference)==null?void 0:c.toJSON(),size:r.size};return(s==null?void 0:s.length)||(a==null?void 0:a.length)?s?this.workerClient.heatmapStatistics(l,s):jIe({attribute:l,features:a}):{count:0,min:null,max:null,avg:null,stddev:null}}getField(e=""){return this.layer.getField(e)}getFieldUsageInfo(e){return this.getField(e)?{supportsLabelingInfo:!0,supportsRenderer:!0,supportsPopupTemplate:!0,supportsLayerQuery:!0,supportsStatistics:!0}:null}getFieldDomain(e,t){return this.layer.getFieldDomain(e,t)}summaryStatistics(e){const{field:t,normalizationType:r,sqlExpression:i,view:n,features:s,useFeaturesInView:a}=e,o=t?this.getField(t):null,l=X4(o),c=e.valueExpression||i,u=c&&!i,h=this._hasLocalSource||s||a,p=n&&n.type==="3d";return h||u?u||s||a||p?this._summaryStatsFromMemory(e,o):this._summaryStatsFromClientQuery(e,l):!this.supportsSQLExpression&&(l||c||r==="natural-log"||r==="square-root")?Promise.reject(new k("feature-layer-adapter:not-supported","Layer does not support standardized SQL expression for queries")):(r&&!this.supportsSQLExpression?this._summaryStatsFromGenRend(e):this._summaryStatsFromServiceQuery(e,l)).catch(()=>(Et(e.signal),this._summaryStatsFromMemory(e,o)))}uniqueValues(e){const{field:t,valueExpression:r,sqlExpression:i,features:n,useFeaturesInView:s,signal:a}=e,o=(t?this.getField(t):null)&&this.getFieldDomain(t),l=r&&(!i||!this.supportsSQLExpression),c=this._hasLocalSource||n||s||l,u=e.view,h=u&&u.type==="3d";return c?l||n||s||h?this._uvFromMemory(e,o):this._uvFromClientQuery(e,o):this._uvFromServiceQuery(e,o).catch(p=>(Et(a),e.field?this._uvFromGenRenderer(e,o):p)).catch(()=>(Et(a),h?this._uvFromMemory(e,o):this._uvFromClientQuery(e,o)))}histogram(e){const{field:t,normalizationType:r,normalizationField:i,classificationMethod:n,view:s,signal:a}=e,o=t?this.getField(t):null,l=X4(o),c=e.valueExpression||e.sqlExpression,u=c&&!e.sqlExpression,h=this._hasLocalSource||e.features||e.useFeaturesInView||u,p=this.supportsSQLExpression,m=!n||n==="equal-interval",g=e.minValue,b=e.maxValue,w=g!=null&&b!=null,v=e.numBins||x$;return h?this._histogramFromMemory(e):(c||p)&&m?p||!c&&r!=="natural-log"&&r!=="square-root"?this._histogramForExpr(e):Promise.reject(new k("feature-layer-adapter:not-supported","Layer does not support standardized SQL expression for queries")):l&&m?Promise.reject(new k("feature-layer-adapter:not-supported","Normalization and date field are not allowed when layer does not support standardized SQL expression for queries")):r||!m?this._binParamsFromGenRend(e).then(x=>{if(!w)return this._getBins(x,t,v,s,a);if(g>x.max||b<x.min)throw new k("histogram:insufficient-data","Range defined by 'minValue' and 'maxValue' does not intersect available data range of the field");if(m)return this._getBins({min:g,max:b,sqlExpr:x.sqlExpr,excludeZerosExpr:x.excludeZerosExpr},t,v,s,a);{const T={field:t,normalizationType:r,normalizationField:i,normalizationTotal:x.normTotal,layer:this},E=OC(T),C=XH(E,g,b);return this._binParamsFromGenRend(e,C).then(A=>this._getBins(A,t,v,s,a))}}):this._histogramForField(e)}classBreaks(e){const t=e.analyzeData!==!1,r=this._hasLocalSource||e.features||e.useFeaturesInView||e.valueExpression;return t&&r?this._classBreaksFromMemory(e):(t?this._classBreaksFromGenRend(e):this._classBreaksFromInterpolation(e)).catch(()=>(Et(e.signal),this._classBreaksFromMemory(e)))}queryFeatureCount(e){if(this._hasLocalSource)return Promise.reject(new k("feature-layer-adapter:not-supported","Layer does not support count query"));const t=this.layer,r=t.createQuery();return r.where=ql(r.where,e.whereClause),t.queryFeatureCount(r,{signal:e.signal})}generateRenderer(e,t){const r=this.layer;if(this._hasLocalSource||r.version<10.1)return Promise.reject(new k("feature-layer-adapter:not-supported","Layer does not support generateRenderer operation (requires ArcGIS Server version 10.1+)"));const i=new WOt({url:r.parsedUrl.path,source:r.dynamicDataSource,gdbVersion:r.gdbVersion}),n=r.createQuery();return e.where=ql(e.where,n.where),i.execute(e,{signal:t})}heatmapStatistics(e){const{field:t,fieldOffset:r,view:i,signal:n}=e;return(t&&r==null?this.summaryStatistics({field:t,view:i,signal:n}):Promise.resolve(null)).then(s=>{let a=r||0;if(s){const{count:o,min:l,max:c}=s;o?l===c&&l===0?a=1:c<=0?a="abs":l<0&&(a=-1.01*l):a=1}return this._heatmapStatsFromMemory(e,a).then(o=>({...o,summaryStatistics:s,fieldOffset:a}))})}async predominantCategories(e){if(!this._hasLocalSource&&!this.supportsSQLExpression)throw new k("feature-layer-adapter:not-supported","Layer does not support advanced SQL expressions and standardized queries");const{fields:t,view:r,signal:i}=e,n=GIe(t),s=uOt(t),a=r&&this._hasLocalSource?await this._uvFromMemory({valueExpression:n,view:r,signal:i}):await this._uvFromServiceQuery({sqlExpression:s.expression,valueExpression:n,signal:i});return WIe(a.uniqueValueInfos,t)}async getSampleFeatures(e,t){const{view:r,sampleSize:i,requiredFields:n,returnGeometry:s,signal:a}=e,o=this.layer.createQuery(),l=1,c=t==="json";o.outSpatialReference=e.spatialReference||r&&r.spatialReference,o.returnGeometry=!!s,o.outFields=n;let u=[],h=!1;if(r)try{const p=await r.whenLayerView(this.layer);if(h=!(await zk(this,n,p)).length,h&&(u=await this._fetchFeaturesFromMemory(p,o,a,t),u.length&&i>0&&i<=u.length))return J7(u,i,l)}catch{Et(a)}try{if(this._hasLocalSource)return h?u:c?this._fetchFeaturesJSONFromService(o,a):this._fetchFeaturesFromService(o,a);const p=await this.queryFeatureCount({view:r,signal:a}),m=this.layer.capabilities.query.maxRecordCount;let g=i===-1?p:i;if(g=m&&g>m?m:g,p<=u.length||u.length>=m)return u;const b=r.extent.width/r.width/r.scale*YOt;if(o.maxAllowableOffset=e.resolution||b,p<=g)return c?this._fetchFeaturesJSONFromService(o,a):this._fetchFeaturesFromService(o,a);if(p<=U1e){const w=await this.layer.queryObjectIds();return o.objectIds=J7(w,g,l),c?this._fetchFeaturesJSONFromService(o,a):this._fetchFeaturesFromService(o,a)}return this.layer.get("capabilities.query.supportsPagination")&&(o.num=Math.min(g,U1e)),c?this._fetchFeaturesJSONFromService(o,a):this._fetchFeaturesFromService(o,a)}catch{return Et(a),u}}load(e){const t=this.layer.load(e).then(async r=>{this.geometryType=r.geometryType,this.objectIdField=r.objectIdField,this.supportsSQLExpression=r.get("capabilities.query.supportsSqlExpression"),this._hasLocalSource=!r.url&&!!r.source,this.hasQueryEngine=this._hasLocalSource,this.minScale=r.minScale,this.maxScale=r.maxScale,this.fullExtent=r.fullExtent,this.workerClient=ny.getInstance(),await this.workerClient.open(e.signal)});return this.addResolvingPromise(t),Promise.resolve(this)}};d([f({constructOnly:!0})],BD.prototype,"layer",void 0),BD=d([$("esri.smartMapping.support.adapters.FeatureLayerAdapter")],BD);const b5=BD;function B1e(e){return e.declaredClass==="esri.rest.support.ClassBreaksDefinition"}function G1e(e){return e.declaredClass==="esri.rest.support.UniqueValueDefinition"}let _ee=class extends b5{constructor(e){super(e)}async _createGenerateRendererResult(e,t,r,i,n){const s=e==null?void 0:e.features;if(!(s==null?void 0:s.length))throw new k("csv-layer-adapter:insufficient-data","No features are available to calculate statistics");const o=L7(s);let l=null;if(i==="percent-of-total"&&(l=(await this.workerClient.summaryStatistics({field:t},o)).sum,l==null))throw new k("csv-layer-adapter:invalid","invalid normalizationTotal");if(B1e(n)){const c=(await B9({field:t,normalizationType:i,normalizationField:r,normalizationTotal:l},o)).filter(u=>Number.isFinite(u));return DIe({definition:n,values:c,normalizationTotal:l})}if(G1e(n)){const c=(await B9({field:t},o)).filter(u=>u!=null&&typeof u=="string"&&u.trim()!=="");return LRt(c)}}generateRenderer(e,t){const r=e.classificationDefinition;let i=null,n=null,s=null;B1e(r)?(i=r.classificationField,n=r.normalizationField,s=r.normalizationType):G1e(r)&&(i=r.attributeField);const a=this.layer;return _w({field:i,normalizationField:n}).then(o=>{const l=a.createQuery();return l.returnGeometry=!1,l.outFields=o,l.where=ql(l.where,e.where),a.queryFeatures(l,{signal:t}).then(c=>this._createGenerateRendererResult(c,i,n,s,r))})}load(e){const t=this.layer.load(e).then(async r=>{this.geometryType=r.geometryType,this.objectIdField=r.objectIdField,this.supportsSQLExpression=!0,this._hasLocalSource=!1,this.hasQueryEngine=!0,this.workerClient=ny.getInstance(),await this.workerClient.open(e.signal)});return this.addResolvingPromise(t),Promise.resolve(this)}};_ee=d([$("esri.smartMapping.support.adapters.CSVLayerAdapter")],_ee);const ZOt=_ee;let wee=class extends b5{constructor(e){super(e)}async _waitForLayerViewUpdate(e){if(!e)throw new k("ogc-feature-layer-adapter:insufficient-data","layerView is required to fetch the features");await td(()=>!e.updating)}async _summaryStatsFromClientQuery(e,t){const{signal:r,view:i}=e;if(!i)throw new k("ogc-feature-layer-adapter:insufficient-data","view is required to fetch the features from layerView");const n=this._getSummaryStatsQuery(e,t),s=await i.whenLayerView(this.layer);await td(()=>!s.updating,r);const a=await s.queryFeatures(n,{signal:r}),o=bee(a,t);return $7(o)}async _uvFromClientQuery(e,t){const{signal:r,view:i}=e;if(!i)throw new k("ogc-feature-layer-adapter:insufficient-data","view is required to fetch the features from layerView");const n=this._getUVQuery(e),s=await i.whenLayerView(this.layer);await td(()=>!s.updating,r);const a=await s.queryFeatures(n,{signal:r}),o=await Uk(a,this,e.field,e.view,null,r);return y5(o,t,e.returnAllCodedValues)}summaryStatistics(e){const{field:t,valueExpression:r,sqlExpression:i,features:n,view:s}=e,a=t?this.getField(t):null,o=X4(a),l=!!r,c=(s==null?void 0:s.type)==="3d";if(!r&&i&&!this.supportsSQLExpression)throw new k("ogc-feature-layer-adapter:not-supported","Layer does not support standardized SQL expression for queries");return l||n||c?this._summaryStatsFromMemory(e,a):this._summaryStatsFromClientQuery(e,o)}uniqueValues(e){const{field:t,valueExpression:r,sqlExpression:i,features:n,view:s}=e,a=(t?this.getField(t):null)&&this.getFieldDomain(t),o=!!r,l=(s==null?void 0:s.type)==="3d";if(!r&&i&&!this.supportsSQLExpression)throw new k("ogc-feature-layer-adapter:not-supported","Layer does not support standardized SQL expression for queries");return o||n||l?this._uvFromMemory(e,a):this._uvFromClientQuery(e,a)}histogram(e){const{features:t,valueExpression:r,normalizationType:i,sqlExpression:n}=e,s=t||!!r;if(!r&&n&&!this.supportsSQLExpression)throw new k("ogc-feature-layer-adapter:not-supported","Layer does not support standardized SQL expression for queries");return s||i?this._histogramFromMemory(e):this._histogramForField(e)}classBreaks(e){return e.analyzeData!==!1?this._classBreaksFromMemory(e):this._classBreaksFromInterpolation(e)}async queryFeatureCount(e){const{whereClause:t,view:r,signal:i}=e;if(!r)throw new k("ogc-feature-layer-adapter:insufficient-data","view is required to fetch the features from layerView");const n=this.layer.createQuery();n.where=ql(n.where,t);const s=await r.whenLayerView(this.layer);return await td(()=>!s.updating,i),s.queryFeatureCount(n,{signal:i})}generateRenderer(e,t){throw new k("ogc-feature-layer-adapter:not-supported","OGCFeatureLayer does not support generateRenderer operation")}async predominantCategories(e){const{fields:t,view:r,signal:i}=e,n=GIe(t),s=await this._uvFromMemory({valueExpression:n,view:r,signal:i});return WIe(s.uniqueValueInfos,t)}async getSampleFeatures(e,t){const{view:r,sampleSize:i,requiredFields:n,returnGeometry:s,signal:a}=e,o=this.layer.createQuery(),l=1;if(o.outSpatialReference=e.spatialReference||r&&r.spatialReference,o.returnGeometry=!!s,o.outFields=n,!r)throw new k("ogc-feature-layer-adapter:not-supported","view is required to get sample features for OGCFeatureLayer");const c=await r.whenLayerView(this.layer);if((await zk(this,n,c)).length)throw new k("ogc-feature-layer-adapter:not-supported","Required fields need to be passed in the outFields for OGCFeatureLayer");const u=await this._fetchFeaturesFromMemory(c,o,a,t);return J7(u,i>0&&i<=u.length?i:u.length,l)}load(e){const t=this.layer.load(e).then(async r=>{this.geometryType=r.geometryType,this.objectIdField=r.objectIdField,this.supportsSQLExpression=r.get("capabilities.query.supportsSqlExpression"),this.minScale=r.minScale,this.maxScale=r.maxScale,this.fullExtent=r.fullExtent,this.workerClient=ny.getInstance(),await this.workerClient.open(e.signal)});return this.addResolvingPromise(t),Promise.resolve(this)}};wee=d([$("esri.smartMapping.support.adapters.OGCFeatureLayerAdapter")],wee);const QOt=wee;let GD=class extends Ooe{constructor(e){super(e)}destroy(){var e;this._featureLayerAdapter=null,(e=this.workerClient)==null||e.destroy()}_hasCachedStatistics(e){return this.layer.hasCachedStatistics(e)}_updateQuery(e,t=[],r=[]){if(!r.length)return e;const i=this.layer.objectIdField,n=e.clone(),s=t.filter(o=>{const l=this.layer.getField(o);return!r.includes(l.name)}),a=s.some(o=>this.layer.getField(o).name===i);return n.outFields=a?s:[...s,i],n}async _fetchFeaturesFromMemory(e,t,r){if(!e)throw new k("scene-layer-adapter:insufficient-data","view is required to fetch the features from layerView");const i=await e.whenLayerView(this.layer),n=new AbortController,s=n.signal,a=td(()=>!i.updating,s);await H2e(a,5e3,n);const o=await zk(this,r,i);Et(s);const l=this._updateQuery(t,r,o),c=await i.queryFeatures(l,{signal:s});Et(s);const u=c.features;return o.length?i.whenGraphicAttributes(u,o):u}async _fetchFeaturesJSONFromMemory(e,t,r){return this._fetchFeaturesFromMemory(e,t,r).then(L7)}_fetchFeaturesForStats(e,t){return _w({field:e.field,normalizationField:e.normalizationField,valueExpression:e.valueExpression}).then(r=>this.getSampleFeatures({sampleSize:-1,view:e.view,returnGeometry:e.returnGeometry,requiredFields:r,signal:e.signal},t))}async _processStatsFromMemoryParams(e){const t=e.features;if(t!=null&&t.length)return t.length&&"declaredClass"in t[0]&&t[0].declaredClass==="esri.Graphic"?{graphics:t}:{featuresJSON:t};const{view:r,field:i,normalizationField:n,valueExpression:s,signal:a}=e,o=await this._fetchFeaturesForStats({field:i,valueExpression:s,normalizationField:n,view:r,signal:a});if(!(o!=null&&o.length))throw new k("scene-layer-adapter:insufficient-data","No features are available to calculate statistics");return{graphics:o}}_generateFeatureSetForCachedHistogram(e,t=e.minimum,r=e.maximum,i){const n=[];for(let u=0;u<i;u++)n[u]=0;const s=e.counts.length,a=e.minimum,o=e.maximum;for(let u=0;u<s;u++){const h=(u+.5)/s,p=((1-h)*a+h*o-t)/(r-t)*i;p>=0&&p<=i&&(n[p===i?i-1:Math.floor(p)]+=e.counts[u])}const l=[];n.forEach((u,h)=>{const p=new co({attributes:{}});p.attributes.EXPR_1=h+1,p.attributes.countOFExpr=u,l.push(p)});const c=new ym;return c.features=l,c}_getCachedStatistics(e,t){const r=this.layer;return e.valueExpression||e.sqlExpression||e.sqlWhere||e.minValue||e.maxValue?Promise.reject(new k("scene-layer-adapter:not-supported","This Layer does not support calculating statistics when 'valueExpression', 'sqlExpression', 'sqlWhere', 'minValue' or 'maxValue' is specified")):r.queryCachedStatistics(t&&t.name,{signal:e.signal}).then(i=>{const n=i.stats,{min:s,max:a,totalValuesCount:o}=n;let{avg:l,stddev:c,sum:u,variance:h,count:p}=n;return s===0&&a===0||(l=l===0?null:l,u=u===0?null:u,c=c===0?null:c,h=h===0?null:h,p=p===0?null:p),p==null&&(u!=null&&l!=null?p=Math.round(u/l):o!=null&&(p=o)),{avg:l,count:p,max:a,min:s,stddev:c,sum:u,variance:h}})}async _getNormalizationTotal(e,t,r){const i=(t?await this.workerClient.summaryStatistics({field:e},t):await IR({attribute:{field:e},features:r})).sum;if(i==null)throw new k("scene-layer-adapter:invalid","invalid normalizationTotal");return i}async _getSummaryStatisticsFromMemory(e,t){const{view:r,field:i,normalizationField:n,valueExpression:s}=e,{featuresJSON:a,graphics:o}=await this._processStatsFromMemoryParams(e),l={field:i,valueExpression:s,normalizationType:e.normalizationType,normalizationField:n,normalizationTotal:e.normalizationTotal,minValue:e.minValue,maxValue:e.maxValue};return e.valueExpression&&r&&a&&(l.fieldType=t!=null&&t.type?Bie.toJSON(t.type):null,l.viewInfoParams=vv(r)),e.normalizationType==="percent-of-total"&&e.normalizationTotal==null&&(l.normalizationTotal=await this._getNormalizationTotal(i,a,o)),a?this.workerClient.summaryStatistics(l,a):IR({attribute:l,features:o})}_getCachedStatisticsForUniqueValues(e,t){const r=this.layer,i=t&&t.name,n=t&&this.getFieldDomain(e.field);return e.valueExpression||e.sqlExpression||e.sqlWhere?Promise.reject(new k("scene-layer-adapter:not-supported","This Layer does not support calculating statistics when 'valueExpression', 'sqlExpression' or 'sqlWhere' is specified")):r.queryCachedStatistics(i,{signal:e.signal}).then(s=>{const a=s.stats;if(!a.mostFrequentValues)throw new Error;const o=s.labels&&s.labels.labels,l={},c=[],u="countOF"+i;a.mostFrequentValues.forEach(p=>{const m=new co({attributes:{}});m.attributes[i]=t&&t.name!==r.objectIdField&&(J9(t)||X4(t))?Number(p.value):p.value,m.attributes[u]=p.count,c.push(m)}),o&&o.forEach(p=>{l[p.value]=p.label});const h=new ym;return h.features=c,Uk(h,this,e.field,e.view,l,e.signal)}).then(s=>y5(s,n,e.returnAllCodedValues))}async _getUniqueValuesFromMemory(e,t){const r=t&&this.getFieldDomain(e.field),{view:i,field:n,valueExpression:s,returnAllCodedValues:a}=e,o={field:n,valueExpression:s,domain:r,returnAllCodedValues:a},{featuresJSON:l,graphics:c}=await this._processStatsFromMemoryParams(e);return e.valueExpression&&i&&l&&(o.viewInfoParams=vv(i)),l?this.workerClient.uniqueValues(o,l):Coe({attribute:o,features:c})}_getCachedStatisticsForHistogram(e,t){const r=this.layer;return e.valueExpression||e.sqlExpression||e.sqlWhere||e.normalizationType?Promise.reject(new k("scene-layer-adapter:not-supported","This Layer does not support calculating statistics when 'valueExpression' or 'sqlExpression' or 'sqlWhere' or 'normalizationType' is specified")):r.queryCachedStatistics(t&&t.name,{signal:e.signal}).then(i=>{const n=i.stats,{minValue:s,maxValue:a}=e,o=s!=null?s:n.min,l=a!=null?a:n.max,c=e.numBins||10,u=this._generateFeatureSetForCachedHistogram(n.histogram,o,l,c);return HIe(u,o,l,c)})}async _getClassBreaksFromMemory(e){const{view:t,field:r,normalizationField:i,valueExpression:n}=e,{featuresJSON:s,graphics:a}=await this._processStatsFromMemoryParams(e),o={field:r,valueExpression:n,normalizationType:e.normalizationType,normalizationField:i,normalizationTotal:e.normalizationTotal,minValue:e.minValue,maxValue:e.maxValue,standardDeviationInterval:e.standardDeviationInterval,classificationMethod:e.classificationMethod,numClasses:e.numClasses};return e.valueExpression&&t&&s&&(o.viewInfoParams=vv(t)),e.normalizationType==="percent-of-total"&&e.normalizationTotal==null&&(o.normalizationTotal=await this._getNormalizationTotal(r,s,a)),s?this.workerClient.classBreaks(o,s):Aoe({attribute:o,features:a})}async _getHistogramFromMemory(e){const{view:t,field:r}=e,{featuresJSON:i,graphics:n}=await this._processStatsFromMemoryParams(e),s={field:r,valueExpression:e.valueExpression,normalizationType:e.normalizationType,normalizationField:e.normalizationField,normalizationTotal:e.normalizationTotal,minValue:e.minValue,maxValue:e.maxValue,standardDeviationInterval:e.standardDeviationInterval,classificationMethod:e.classificationMethod,numBins:e.numBins};return e.valueExpression&&t&&i&&(s.viewInfoParams=vv(t)),e.normalizationType==="percent-of-total"&&e.normalizationTotal==null&&(s.normalizationTotal=await this._getNormalizationTotal(r,i,n)),i?this.workerClient.histogram(s,i):Roe({attribute:s,features:n})}getField(e=""){return this.layer.getField(e)}getFieldUsageInfo(e){const t=this.getField(e);if(!t)return null;const r=this.layer.getFieldUsageInfo(t.name);return{supportsLabelingInfo:r.supportsLabelingInfo,supportsPopupTemplate:r.supportsPopupTemplate,supportsRenderer:r.supportsRenderer,supportsLayerQuery:r.supportsLayerQuery,supportsStatistics:!0}}getFieldDomain(e,t){return this._featureLayerAdapter?this._featureLayerAdapter.getFieldDomain(e,t):null}summaryStatistics(e){const t=this.getField(e.field);return this._featureLayerAdapter?this._featureLayerAdapter.summaryStatistics(e):this._hasCachedStatistics(t&&t.name)?this._getCachedStatistics(e,t).catch(()=>(Et(e.signal),this._getSummaryStatisticsFromMemory(e,t))):this._getSummaryStatisticsFromMemory(e,t)}uniqueValues(e){const t=this.getField(e.field);return this._featureLayerAdapter?this._featureLayerAdapter.uniqueValues(e):this._hasCachedStatistics(t&&t.name)?this._getCachedStatisticsForUniqueValues(e,t).catch(()=>(Et(e.signal),this._getUniqueValuesFromMemory(e,t))):this._getUniqueValuesFromMemory(e,t)}histogram(e){const t=this.getField(e.field);return this._featureLayerAdapter?this._featureLayerAdapter.histogram(e):this._hasCachedStatistics(t&&t.name)?this._getCachedStatisticsForHistogram(e,t).catch(()=>(Et(e.signal),this._getHistogramFromMemory(e))):this._getHistogramFromMemory(e)}classBreaks(e){const t=this.getField(e.field);return this._featureLayerAdapter?this._featureLayerAdapter.classBreaks(e):this._hasCachedStatistics(t&&t.name)?Promise.reject(new k("scene-layer-adapter:not-supported","Cached stats not supported")):this._getClassBreaksFromMemory(e)}queryFeatureCount(e){return this._featureLayerAdapter?this._featureLayerAdapter.queryFeatureCount(e):Promise.reject(new k("scene-layer-adapter:not-supported","SceneLayer without associated FeatureLayer does not support count query"))}generateRenderer(e,t){return this._featureLayerAdapter?this._featureLayerAdapter.generateRenderer(e,t):Promise.reject(new k("scene-layer-adapter:not-supported","SceneLayer without associated FeatureLayer does not support generateRenderer operation"))}heatmapStatistics(e){return this._featureLayerAdapter?this._featureLayerAdapter.heatmapStatistics(e):Promise.reject(new k("scene-layer-adapter:not-supported","SceneLayer without associated FeatureLayer does not support heatmapStatistics operation"))}async predominantCategories(e){if(this._featureLayerAdapter)return this._featureLayerAdapter.predominantCategories(e);throw new k("scene-layer-adapter:not-supported","SceneLayer without associated FeatureLayer does not support predominantCategories")}async getSampleFeatures(e,t){const{view:r,sampleSize:i,requiredFields:n,returnGeometry:s,signal:a}=e,o=1,l=t==="json",c=this.layer.createQuery();c.outFields=n,c.returnGeometry=!!s,c.where=null,c.num=i;let u=[];try{if(u=l?await this._fetchFeaturesJSONFromMemory(r,c,n):await this._fetchFeaturesFromMemory(r,c,n),u.length&&i>0&&i<=u.length)return J7(u,i,o)}catch{Et(a)}let h=null;if(this._featureLayerAdapter){const p={...e};delete p.view,h=await this._featureLayerAdapter.getSampleFeatures(p,t)}return h&&h.length?h:J7(u,u.length,o)}load(e){const t=this.layer.load(e).then(async r=>{this.workerClient=ny.getInstance(),await this.workerClient.open(e.signal);const i=r.associatedLayer;if(this.geometryType=r.geometryType,_(i))return this._featureLayerAdapter=new b5({layer:i}),this._featureLayerAdapter.load(e).then(()=>{this.objectIdField=this._featureLayerAdapter.objectIdField,this.supportsSQLExpression=this._featureLayerAdapter.supportsSQLExpression,this.minScale=this._featureLayerAdapter.minScale,this.maxScale=this._featureLayerAdapter.maxScale,this.fullExtent=this._featureLayerAdapter.fullExtent});this.objectIdField=r.objectIdField,this.supportsSQLExpression=!1,this.hasQueryEngine=!1,this.fullExtent=r.fullExtent});return this.addResolvingPromise(t),Promise.resolve(this)}};d([f({constructOnly:!0})],GD.prototype,"layer",void 0),GD=d([$("esri.smartMapping.support.adapters.SceneLayerAdapter")],GD);const QIe=GD;let xee=class extends QIe{constructor(e){super(e)}getField(e=""){return this.layer.fieldsIndex.get(e)}getFieldUsageInfo(e){const t=this.getField(e);if(!t)return null;const r=this._hasCachedStatistics(t.name);return{supportsLabelingInfo:r,supportsPopupTemplate:r,supportsRenderer:r,supportsLayerQuery:!1,supportsStatistics:r}}getFieldDomain(){return null}load(e){const t=this.layer.load(e).then(()=>{this.geometryType="point",this.objectIdField=null,this.supportsSQLExpression=!1,this.hasQueryEngine=!1});return this.addResolvingPromise(t),Promise.resolve(this)}};xee=d([$("esri.smartMapping.support.adapters.PointCloudLayerAdapter")],xee);const JOt=xee;var gs;(function(e){e[e.CSVLayer=0]="CSVLayer",e[e.GeoJSONLayer=1]="GeoJSONLayer",e[e.FeatureLayer=2]="FeatureLayer",e[e.OGCFeatureLayer=3]="OGCFeatureLayer",e[e.SceneLayer=4]="SceneLayer",e[e.PointCloudLayer=5]="PointCloudLayer",e[e.WFSLayer=6]="WFSLayer"})(gs||(gs={}));const Tee={[gs.CSVLayer]:{adapter:ZOt,type:"csv",label:"CSVLayer"},[gs.FeatureLayer]:{adapter:b5,type:"feature",label:"FeatureLayer"},[gs.OGCFeatureLayer]:{adapter:QOt,type:"ogc-feature",label:"OGCFeatureLayer"},[gs.GeoJSONLayer]:{adapter:b5,type:"geojson",label:"GeoJSONLayer"},[gs.SceneLayer]:{adapter:QIe,type:"scene",label:"SceneLayer"},[gs.PointCloudLayer]:{adapter:JOt,type:"point-cloud",label:"PointCloudLayer"},[gs.WFSLayer]:{adapter:b5,type:"wfs",label:"WFSLayer"}},See=[gs.CSVLayer,gs.FeatureLayer,gs.OGCFeatureLayer,gs.GeoJSONLayer,gs.SceneLayer,gs.PointCloudLayer,gs.WFSLayer],h_=[gs.CSVLayer,gs.FeatureLayer,gs.OGCFeatureLayer,gs.SceneLayer,gs.GeoJSONLayer,gs.WFSLayer];function UO(e){return e.map(t=>Tee[t].label)}function BO(e,t=See){if(e instanceof Ooe)return e;let r=null;return t.some(i=>{const n=e.type===Tee[i].type;if(n){const s=Tee[i].adapter;r=new s({layer:e})}return n}),r}const KOt=[{size:10,width:0},{size:20,width:.5},{size:80,width:1},{size:250,width:2}];async function eMt(e){const{view:t}=e;if(!(e&&t&&e.layer))throw new k("outline:missing-parameters","'view' and 'layer' parameters are required");const{layer:r,...i}=e,n=BO(r,h_),s={layerAdapter:n,...i};if(!n)throw new k("outline:invalid-parameters","'layer' must be one of these types: "+UO(h_).join(", "));await t.when();const a=_(s.signal)?{signal:s.signal}:null;if(await n.load(a),n.geometryType!=="polygon")throw new k("outline:not-supported",`outline is not supported for geometryType: ${n.geometryType}`);return s}function tMt(e,t){const r=e.avgSize,i=fZ(1,t.spatialReference),n=KOt.map(s=>({size:s.width,value:Math.round(r/s.size*i)}));return n.sort((s,a)=>s.value-a.value),{visualVariables:[new bm({target:"outline",valueExpression:"$view.scale",stops:n})],opacity:.25}}async function rMt(e){const{layerAdapter:t,...r}=await eMt(e),i=-1,n=await t.getSampleFeatures({sampleSize:i,returnGeometry:!0,...r}),s=await LIe({features:n,geometryType:t.geometryType});if(!("avgSize"in s)||!s.avgSize)throw new k("outline:insufficient-info","average polygon size is invalid");return tMt(s,r.view)}const iMt=500,nMt=1e8,KH=1280,sMt=12,aMt=30,oMt=15;async function lMt(e){const{view:t,sampleSize:r}=e;if(!(e&&t&&e.layer))throw new k("scale-range:missing-parameters","'view' and 'layer' parameters are required");const{layer:i,...n}=e,s=BO(i,h_),a={layerAdapter:s,...n};if(a.sampleSize=r||iMt,!s)throw new k("scale-range:invalid-parameters","'layer' must be one of these types: "+UO(h_).join(", "));await t.when();const o=_(a.signal)?{signal:a.signal}:null;return await s.load(o),a}function cMt(e,t){const r=sMt,i=KH/4,n=aMt,s=KH/4,a=oMt,o=KH/2;let l=null,c=null,u=null,h=null;switch(e){case"point":case"multipoint":{const p=t;l=p.avgMinDistance,c=r,u=p.minDistance,h=i;break}case"polyline":{const p=t;l=p.avgLength,c=n,u=p.minLength,h=s;break}case"polygon":{const p=t;l=p.avgSize,c=a,u=p.minSize,h=o;break}}return{resolutionForMinScale:l>0?l/c:null,resolutionForMaxScale:u>0?u/h:null}}function dMt(e,t,r){const i=cMt(e.geometryType,t);return{minScale:fZ(i.resolutionForMinScale,r.spatialReference),maxScale:fZ(i.resolutionForMaxScale,r.spatialReference)}}function j1e(e,t,r=!0){if(e.constraints&&"effectiveLODs"in e.constraints){const i=e.constraints.effectiveLODs,n=r?i:i.slice(0).reverse();let s=null;for(const a of n)if(!(r?a.scale>t:a.scale<t)){s=a;break}return s}}function uMt(e,t,r,i){const{view:n,snapToLOD:s,layerAdapter:a}=e;if(s){const o=j1e(n,t),l=j1e(n,r,!1);t=o?o.scale:t,r=l?l.scale:r}if(t<r)throw new k("scale-range:invalid","calculated minScale is less than maxScale.");return r>t/2&&(r=Math.floor(r/2)),t>nMt&&(t=0),a.geometryType!=="polygon"&&(r=0),{minScale:Math.ceil(t),maxScale:Math.floor(r),spatialStatistics:i}}async function hMt(e){const t=await lMt(e),{view:r,sampleSize:i,layerAdapter:n,signal:s}=t,a=await n.getSampleFeatures({view:r,sampleSize:i,returnGeometry:!0,signal:s}),o=await LIe({features:a,geometryType:n.geometryType}),{minScale:l,maxScale:c}=dMt(n,o,r);return uMt(t,l,c,o)}const fMt=1e8,pMt=1128.497176,mMt=591657527591555e-6,gMt=[10,8,4,2],yMt=[100,100,60,30],bMt=[2,1,.75,.5],vMt=[32,18,12,6],_Mt=[{level:0,resolution:156543.03392800014,scale:591657527591555e-6},{level:1,resolution:78271.51696399994,scale:295828763795777e-6},{level:2,resolution:39135.75848200009,scale:147914381897889e-6},{level:3,resolution:19567.87924099992,scale:73957190948944e-6},{level:4,resolution:9783.93962049996,scale:36978595474472e-6},{level:5,resolution:4891.96981024998,scale:18489297737236e-6},{level:6,resolution:2445.98490512499,scale:9244648868618e-6},{level:7,resolution:1222.992452562495,scale:4622324434309e-6},{level:8,resolution:611.4962262813797,scale:2311162217155e-6},{level:9,resolution:305.74811314055756,scale:1155581108577e-6},{level:10,resolution:152.87405657041106,scale:577790.554289},{level:11,resolution:76.43702828507324,scale:288895.277144},{level:12,resolution:38.21851414253662,scale:144447.638572},{level:13,resolution:19.10925707126831,scale:72223.819286},{level:14,resolution:9.554628535634155,scale:36111.909643},{level:15,resolution:4.77731426794937,scale:18055.954822},{level:16,resolution:2.388657133974685,scale:9027.977411},{level:17,resolution:1.1943285668550503,scale:4513.988705},{level:18,resolution:.5971642835598172,scale:2256.994353},{level:19,resolution:.29858214164761665,scale:1128.497176}];async function wMt(e){const{view:t}=e;if(!(e&&t&&e.layer))throw new k("size-range:missing-parameters","'view' and 'layer' parameters are required");const{layer:r,...i}=e,n=BO(r,h_),s={layerAdapter:n,...i};if(!n)throw new k("size-range:invalid-parameters","'layer' must be one of these types: "+UO(h_).join(", "));await t.when();const a=_(s.signal)?{signal:s.signal}:null;await n.load(a);const o=n.geometryType;if(o!=="point"&&o!=="multipoint"&&o!=="polyline"&&o!=="polygon")throw new k("size-range:not-supported",`sizeRange is not supported for geometryType: ${o}`);return s}function xMt(e,t){const r=Math.ceil(e/t);let i=Math.ceil(r/4);i<4?i=4:i>16&&(i=16);const n=5*i;return{min:i,max:n<50?50:n}}function JIe(e,t){const{view:r}=e,i=t.minScale||fMt,n=r.constraints&&"effectiveLODs"in r.constraints&&r.constraints.effectiveLODs||_Mt,s=[];for(const a in n){if(n[a].scale>i)continue;const o=Number(a),l=[o-3,o,o+3,o+6];for(const c of l)c>-1&&c<n.length&&s.push(n[c].scale);break}return s.sort((a,o)=>a-o)}function TMt(e,t){const{view:r,layerAdapter:i}=e,n=i.fullExtent,s=i.minScale||pMt,a=i.maxScale||mMt,o=t.minScale||0,l=t.maxScale||0;let c=_(n)?cHe(r,n):0;return c=c<s&&c>a?c:0,{scales:[s,a,o,l,c].map(Math.round).sort((u,h)=>u-h).filter((u,h,p)=>!!u&&p.indexOf(u)===h).filter((u,h,p)=>!h||Math.abs(u-p[h-1])>5),fullExtentScale:c}}function SMt(e,t){const{minScale:r,maxScale:i}=t,n=JIe(e,{minScale:r,maxScale:i});if(!n.length)throw new k("scale-range:insufficient-info","not enough scale values");return{minSize:new bm({valueExpression:"$view.scale",stops:n.map((s,a)=>({value:s,size:zs(gMt[a])}))}),maxSize:new bm({valueExpression:"$view.scale",stops:n.map((s,a)=>({value:s,size:zs(yMt[a])}))})}}function EMt(e,t){const{minScale:r,maxScale:i}=t,n=JIe(e,{minScale:r,maxScale:i});if(!n.length)throw new k("scale-range:insufficient-info","not enough scale values");return{minSize:new bm({valueExpression:"$view.scale",stops:n.map((s,a)=>({value:s,size:zs(bMt[a])}))}),maxSize:new bm({valueExpression:"$view.scale",stops:n.map((s,a)=>({value:s,size:zs(vMt[a])}))})}}function CMt(e,t){const{spatialStatistics:r,minScale:i,maxScale:n}=t;if(!("avgSize"in r)||!r.avgSize)throw new k("size-range:insufficient-info","average polygon size is invalid");const s=r.avgSize,{resolution:a,scale:o}=e.view,l=a/o,{scales:c,fullExtentScale:u}=TMt(e,{minScale:i,maxScale:n}),h=[],p=[];return c.forEach((m,g)=>{const{min:b,max:w}=xMt(s,l*m),v=c.indexOf(u),x=v>-1&&g>v?2:1;h.push({value:m,size:zs(b/x)}),p.push({value:m,size:zs(w/x)})}),{minSize:new bm({valueExpression:"$view.scale",stops:h}),maxSize:new bm({valueExpression:"$view.scale",stops:p})}}async function AMt(e){const t=await wMt(e),{view:r,layerAdapter:i,signal:n}=t,s=await hMt({layer:i,view:r,signal:n});switch(i.geometryType){case"point":case"multipoint":return SMt(t,s);case"polyline":return EMt(t,s);case"polygon":return CMt(t,s);case"mesh":case"multipatch":return null}return null}async function RMt(e){await e.whenReady();const t=e.basemapView.baseLayerViews.map(u=>u.layer);if(!t.length){const u=getComputedStyle(e.container).backgroundColor,h=u&&new Te(u);return e.get("background.color")||(h&&h.a!==0?h:null)||null}const r=(await e.takeScreenshot({format:"png",layers:t.toArray()})).data.data,i=r.length;let n=0,s=0,a=0,o=0,l=0,c=0;for(let u=0;u<i;u+=4){const h=r[u],p=r[u+1],m=r[u+2],g=r[u+3],b=g/255;n+=h*h*b,s+=p*p*b,a+=m*m*b,l+=b,g&&(o+=g,c++)}return n=Math.round(Math.sqrt(n/l)),s=Math.round(Math.sqrt(s/l)),a=Math.round(Math.sqrt(a/l)),new Te([n,s,a,o/c/255])}async function OMt(e){if(!e)return null;const t=await RMt(e);return _(t)?MMt(t):null}function MMt(e){return KIe(e).isBright?"light":"dark"}function KIe(e){let{r:t,g:r,b:i,a:n}=e;return n<1&&(t=Math.round(n*t+255*(1-n)),r=Math.round(n*r+255*(1-n)),i=Math.round(n*i+255*(1-n))),new Te({r:t,g:r,b:i})}function tFt(e){const{r:t,g:r,b:i}=KIe(e);return .2126*t+.7152*r+.0722*i}const q1e=[0,0,0,.4],PMt=[].concat(G9.light).concat(G9.dark);function H1e(e,t){return new k(e,t)}function W1e(e,t){const r=[],i=e.length;for(let n=0;n<t;n++)r.push(new Te(e[n%i]));return r}function IMt(e,t,r){switch(t){case"point":case"multipoint":return r?"noDataSize"in e?e.noDataSize:null:"size"in e?e.size:null;case"polyline":return r?"noDataWidth"in e?e.noDataWidth:null:"width"in e?e.width:null;case"polygon":return"size"in e?e.size:null;default:return}}function $Mt(e,t,r){switch(t){case"point":case"multipoint":case"polygon":{if(!("outline"in e))return null;const i={color:e.outline.color,width:e.outline.width};if(r!=null&&i.color){const n=i.color.clone();n.a=r,i.color=n}return i}default:return}}function T$(e,t){const{type:r,size:i,color:n,outline:s}=t;let a;switch(e){case"point":case"multipoint":if(r==="2d")a=new nc({color:n,size:i,outline:{color:s.color,width:s.width}});else if(r==="3d-flat")a=new Y0({symbolLayers:[new Qg({size:i,resource:{primitive:"circle"},material:{color:n},outline:{color:s.color,size:s.width}})]});else if(r.includes("3d-volumetric")){const o=r==="3d-volumetric-uniform",l=new AV({height:i,resource:{primitive:o?"sphere":"cylinder"},material:{color:n}});o||(l.width=t.widthAndDepth,l.depth=t.widthAndDepth),a=new Y0({symbolLayers:[l]})}break;case"polyline":r==="2d"?a=new bc({color:n,width:i}):r==="3d-flat"?a=new Y5({symbolLayers:[new t6({size:i,material:{color:n}})]}):r==="3d-volumetric"&&(a=new Y5({symbolLayers:[new RV({width:typeof i=="number"?i:parseFloat(i),height:typeof i=="number"?i:parseFloat(i),material:{color:n}})]}));break;case"polygon":r==="2d"?a=new kp({color:n,outline:{color:s.color,width:s.width}}):r==="3d-flat"?a=new Fw({symbolLayers:[new W5({material:{color:n},outline:{color:s.color,size:s.width}})]}):r==="3d-volumetric"&&(a=new Fw({symbolLayers:[new Ore({size:i,material:{color:n}})]}));break;case"mesh":{const o=t.meshInfo&&t.meshInfo.colorMixMode,l=t.meshInfo&&t.meshInfo.edgesType;a=new MV({symbolLayers:[new W5({material:{color:n,colorMixMode:o||null},edges:l==="solid"?new bxe({color:q1e}):l==="sketch"?new yxe({color:q1e}):null})]});break}}return a}function LMt(e,t,r){const i=DMt({layer:e,fields:t});if(i.length)return H1e(r,"Unknown fields: "+i.join(", ")+". You can only use fields defined in the layer schema");const n=FMt({layer:e,fields:t});return n.length?H1e(r,"Unsupported fields: "+n.join(", ")+". You can only use fields that are accessible to the renderer i.e. FieldUsageInfo.supportsRenderer must be true"):void 0}function DMt(e){const t=e.layer;return e.fields.filter(r=>!t.getField(r))}function FMt(e){const t=e.layer;return e.fields.filter(r=>{const i=t.getFieldUsageInfo(r);return!i||!i.supportsRenderer})}async function NMt(e,t){var n;let r=null,i=null;if(!e&&!t)return{basemapId:r,basemapTheme:i};if(!e&&t&&(e=t&&((n=t.map)==null?void 0:n.basemap)),e&&(r=Eoe(e,PMt,!1),r)){const s=Soe(r);_(s)&&(i=s)}return r||(t==null?void 0:t.type)!=="2d"||(i=await OMt(t),_(i)&&(r=i==="dark"?"dark-gray":"gray")),{basemapId:r,basemapTheme:i}}async function kMt(e){if(!e||!e.layer||!e.field&&!e.valueExpression)throw new k("unique-values:missing-parameters","'layer' and 'field' or 'valueExpression' parameters are required");const t=e.valueExpression||e.sqlExpression,r=t&&!e.sqlExpression;if(t){if(r){if(!e.view)throw new k("unique-values:missing-parameters","View is required when 'valueExpression' is specified")}else if(!e.valueExpression)throw new k("unique-values:missing-parameters","'valueExpression' parameters are required")}const{layer:i,...n}=e,s=BO(i,See),a={layerAdapter:s,...n};if(!s)throw new k("unique-values:invalid-parameters","'layer' must be one of these types: "+UO(See).join(", "));const o=_(a.signal)?{signal:a.signal}:null;await s.load(o);const l=await _w({field:a.field,valueExpression:a.valueExpression}),c=sOt(s,l,"unique-values:invalid-parameters");if(c)throw c;return a}async function VMt(e){const{layerAdapter:t,...r}=await kMt(e);return t.uniqueValues(r)}const zMt={"seq-yellow-orange-red-bright":{1:["#ff7b22"],2:["#c0370f","#ff7b22"],3:["#b1260b","#e05919","#ff8e33"],4:["#a11506","#d04814","#ef6a1d","#ffa143"],5:["#a11506","#d04814","#ef6a1d","#ff8e33","#ffb454"],6:["#a11506","#c0370f","#e05919","#ef6a1d","#ff8e33","#ffb454"],7:["#a11506","#c0370f","#e05919","#ef6a1d","#ff7b22","#ffa143","#ffc764"],8:["#910000","#b1260b","#c0370f","#e05919","#ef6a1d","#ff7b22","#ffa143","#ffc764"],9:["#910000","#b1260b","#c0370f","#e05919","#ef6a1d","#ff7b22","#ffa143","#ffb454","#ffda74"],10:["#910000","#b1260b","#c0370f","#e05919","#ef6a1d","#ff7b22","#ffa143","#ffb454","#ffda74","#ffed85"],stops:["#910000","#c33910","#f6711f","#fbaf52","#ffed85"],tags:["light","reds","yellows","oranges","bright","sequential","colorblind-friendly"],name:"Orange 1"},"seq-yellow-pink-purple":{1:["#b65fa5"],2:["#e6b7c4","#b65fa5"],3:["#eecec9","#d588b9","#a14e96"],4:["#f6e5cf","#dd9fbf","#cc71b4","#8c3c88"],5:["#f6e5cf","#dd9fbf","#cc71b4","#a14e96","#762a79"],6:["#f6e5cf","#e6b7c4","#d588b9","#cc71b4","#a14e96","#762a79"],7:["#f6e5cf","#e6b7c4","#d588b9","#cc71b4","#b65fa5","#8c3c88","#61196a"],8:["#fffcd4","#eecec9","#e6b7c4","#d588b9","#cc71b4","#b65fa5","#8c3c88","#61196a"],9:["#fffcd4","#eecec9","#e6b7c4","#d588b9","#cc71b4","#b65fa5","#8c3c88","#762a79","#4b075b"],10:["#fffcd4","#eecec9","#e6b7c4","#d588b9","#cc71b4","#b65fa5","#8c3c88","#762a79","#4b075b","#350242"],stops:["#fffcd4","#e0b2c1","#c168ad","#7b3578","#350242"],tags:["light","purples","pinks","sequential","colorblind-friendly"],name:"Purple 1"},"seq-red-blue-green":{1:["#6193b3"],2:["#bac6df","#6193b3"],3:["#d1d1e5","#8cb1d2","#4e8099"],4:["#e8dbeb","#a3bbd8","#75a6cc","#3b6e80"],5:["#e8dbeb","#a3bbd8","#75a6cc","#4e8099","#275b67"],6:["#e8dbeb","#bac6df","#8cb1d2","#75a6cc","#4e8099","#275b67"],7:["#e8dbeb","#bac6df","#8cb1d2","#75a6cc","#6193b3","#3b6e80","#14484d"],8:["#ffe6f1","#d1d1e5","#bac6df","#8cb1d2","#75a6cc","#6193b3","#3b6e80","#14484d"],9:["#ffe6f1","#d1d1e5","#bac6df","#8cb1d2","#75a6cc","#6193b3","#3b6e80","#275b67","#003534"],10:["#ffe6f1","#d1d1e5","#bac6df","#8cb1d2","#75a6cc","#6193b3","#3b6e80","#275b67","#003534","#002624"],stops:["#ffe6f1","#b5c2d9","#6b9dc0","#366272","#002624"],tags:["light","blues","subdued","sequential","colorblind-friendly"],name:"Blue 1"},"seq-pink-red":{1:["#c75c49"],2:["#ecacaa","#c75c49"],3:["#f1c1c5","#e18073","#b44f3b"],4:["#f6d7e0","#e6968e","#db6a58","#a1412c"],5:["#f6d7e0","#e6968e","#db6a58","#b44f3b","#8d331d"],6:["#f6d7e0","#ecacaa","#e18073","#db6a58","#b44f3b","#8d331d"],7:["#f6d7e0","#ecacaa","#e18073","#db6a58","#c75c49","#a1412c","#7a260f"],8:["#fcedfb","#f1c1c5","#ecacaa","#e18073","#db6a58","#c75c49","#a1412c","#7a260f"],9:["#fcedfb","#f1c1c5","#ecacaa","#e18073","#db6a58","#c75c49","#a1412c","#8d331d","#661800"],10:["#fcedfb","#f1c1c5","#ecacaa","#e18073","#db6a58","#c75c49","#a1412c","#8d331d","#661800","#510b00"],stops:["#fcedfb","#e7a8a6","#d16351","#913729","#510b00"],tags:["light","reds","subdued","sequential","colorblind-friendly"],name:"Red 1"},"seq-yellow-purple-blue":{1:["#8573cb"],2:["#cdc1d9","#8573cb"],3:["#ddd4d7","#ab99db","#7062b9"],4:["#eee8d6","#bcadda","#9a85dd","#5a50a7"],5:["#eee8d6","#bcadda","#9a85dd","#7062b9","#453e94"],6:["#eee8d6","#cdc1d9","#ab99db","#9a85dd","#7062b9","#453e94"],7:["#eee8d6","#cdc1d9","#ab99db","#9a85dd","#8573cb","#5a50a7","#302d82"],8:["#fffcd4","#ddd4d7","#cdc1d9","#ab99db","#9a85dd","#8573cb","#5a50a7","#302d82"],9:["#fffcd4","#ddd4d7","#cdc1d9","#ab99db","#9a85dd","#8573cb","#5a50a7","#453e94","#1b1b70"],10:["#fffcd4","#ddd4d7","#cdc1d9","#ab99db","#9a85dd","#8573cb","#5a50a7","#453e94","#1b1b70","#10104f"],stops:["#fffcd4","#c8bcd4","#907cd4","#504692","#10104f"],tags:["light","purples","sequential","colorblind-friendly"],name:"Purple 2"},"seq-yellow-orange-red":{1:["#d4743c"],2:["#f2c38e","#d4743c"],3:["#f6d6a5","#e99e5f","#c35d30"],4:["#fbe9bd","#eeb177","#e58b48","#b24625"],5:["#fbe9bd","#eeb177","#e58b48","#c35d30","#a12f19"],6:["#fbe9bd","#f2c38e","#e99e5f","#e58b48","#c35d30","#a12f19"],7:["#fbe9bd","#f2c38e","#e99e5f","#e58b48","#d4743c","#b24625","#90180d"],8:["#fffcd4","#f6d6a5","#f2c38e","#e99e5f","#e58b48","#d4743c","#b24625","#90180d"],9:["#fffcd4","#f6d6a5","#f2c38e","#e99e5f","#e58b48","#d4743c","#b24625","#a12f19","#7f0101"],10:["#fffcd4","#f6d6a5","#f2c38e","#e99e5f","#e58b48","#d4743c","#b24625","#a12f19","#7f0101","#660000"],stops:["#fffcd4","#eebe8b","#dd8042","#a24021","#660000"],tags:["light","reds","oranges","sequential","colorblind-friendly"],name:"Red 2"},"seq-yellow-green-blue":{1:["#5a93a8"],2:["#b4d2c6","#5a93a8"],3:["#cde0ca","#82b6bc","#4b7e98"],4:["#e6eecf","#9bc4c1","#69a8b7","#3d6a89"],5:["#e6eecf","#9bc4c1","#69a8b7","#4b7e98","#2e557a"],6:["#e6eecf","#b4d2c6","#82b6bc","#69a8b7","#4b7e98","#2e557a"],7:["#e6eecf","#b4d2c6","#82b6bc","#69a8b7","#5a93a8","#3d6a89","#1f406a"],8:["#fffcd4","#cde0ca","#b4d2c6","#82b6bc","#69a8b7","#5a93a8","#3d6a89","#1f406a"],9:["#fffcd4","#cde0ca","#b4d2c6","#82b6bc","#69a8b7","#5a93a8","#3d6a89","#2e557a","#102b5b"],10:["#fffcd4","#cde0ca","#b4d2c6","#82b6bc","#69a8b7","#5a93a8","#3d6a89","#2e557a","#102b5b","#0d2644"],stops:["#fffcd4","#b1cdc2","#629eb0","#38627a","#0d2644"],tags:["light","blues","sequential","colorblind-friendly"],name:"Blue 2"},"seq-yellow-red-purple":{1:["#420239"],2:["#fffcd4","#420239"],3:["#fffcd4","#d86868","#420239"],4:["#fffcd4","#ecb29e","#d86868","#420239"],5:["#fffcd4","#ecb29e","#d86868","#9b3557","#420239"],6:["#fffcd4","#ecb29e","#d86868","#9b3557","#872351","#420239"],7:["#fffcd4","#ecb29e","#d86868","#9b3557","#872351","#5e0146","#420239"],8:["#fffcd4","#ecb29e","#df817a","#d86868","#9b3557","#872351","#5e0146","#420239"],9:["#fffcd4","#f2cbb0","#ecb29e","#df817a","#d86868","#9b3557","#872351","#5e0146","#420239"],10:["#fffcd4","#f2cbb0","#ecb29e","#df817a","#d86868","#c45762","#9b3557","#872351","#5e0146","#420239"],stops:["#fffcd4","#e7ae9d","#ce6065","#88314f","#420239"],tags:["light","purples","sequential","colorblind-friendly"],name:"Pink 1"},"seq-orange-red-light":{1:["#660202"],2:["#ffefdc","#660202"],3:["#ffefdc","#d15e3d","#660202"],4:["#ffefdc","#f5c5ab","#d15e3d","#660202"],5:["#ffefdc","#f5c5ab","#d15e3d","#b13925","#660202"],6:["#ffefdc","#f5c5ab","#e27149","#d15e3d","#b13925","#660202"],7:["#ffefdc","#f5c5ab","#e78662","#e27149","#d15e3d","#b13925","#660202"],8:["#ffefdc","#f5c5ab","#e78662","#e27149","#d15e3d","#b13925","#a02619","#660202"],9:["#ffefdc","#f5c5ab","#f1b093","#e78662","#e27149","#d15e3d","#b13925","#a02619","#660202"],10:["#ffefdc","#f5c5ab","#f1b093","#e78662","#e27149","#d15e3d","#b13925","#a02619","#7f0101","#660202"],stops:["#ffefdc","#edac90","#da6843","#a03523","#660202"],tags:["light","reds","sequential","colorblind-friendly"],name:"Red 3"},"seq-orange-red-dark":{1:["#470000"],2:["#ffefdc","#470000"],3:["#ffefdc","#ab472f","#470000"],4:["#ffefdc","#ab472f","#7a1c13","#470000"],5:["#ffefdc","#c76f54","#ab472f","#7a1c13","#470000"],6:["#ffefdc","#dea28b","#c76f54","#ab472f","#7a1c13","#470000"],7:["#ffefdc","#dea28b","#c76f54","#ab472f","#8b2b1d","#7a1c13","#470000"],8:["#ffefdc","#dea28b","#c76f54","#ab472f","#8b2b1d","#7a1c13","#590000","#470000"],9:["#ffefdc","#dea28b","#c76f54","#bc5539","#ab472f","#8b2b1d","#7a1c13","#590000","#470000"],10:["#ffefdc","#e9bca6","#dea28b","#c76f54","#bc5539","#ab472f","#8b2b1d","#7a1c13","#590000","#470000"],stops:["#ffefdc","#d99f88","#b34e34","#7d271a","#470000"],tags:["light","reds","sequential","colorblind-friendly"],name:"Red 4"},"seq-single-blues":{1:["#9ecae1"],2:["#bdd7e7","#6baed6"],3:["#deebf7","#9ecae1","#3182bd"],4:["#eff3ff","#bdd7e7","#6baed6","#2171b5"],5:["#eff3ff","#bdd7e7","#6baed6","#3182bd","#08519c"],6:["#eff3ff","#c6dbef","#9ecae1","#6baed6","#3182bd","#08519c"],7:["#eff3ff","#c6dbef","#9ecae1","#6baed6","#4292c6","#2171b5","#084594"],8:["#f7fbff","#deebf7","#c6dbef","#9ecae1","#6baed6","#4292c6","#2171b5","#084594"],9:["#f7fbff","#deebf7","#c6dbef","#9ecae1","#6baed6","#4292c6","#2171b5","#08519c","#08306b"],10:["#f7fbff","#deebf7","#c6dbef","#9ecae1","#6baed6","#4292c6","#2171b5","#08519c","#083582","#022259"],stops:["rgba(239, 243, 255, 1)","rgba(189, 215, 231, 1)","rgba(107, 174, 214, 1)","rgba(49, 130, 189, 1)","rgba(8, 81, 156, 1)"],tags:["light","blues","sequential","colorblind-friendly"],name:"Blue 3"},"seq-single-greens":{1:["#a1d99b"],2:["#bae4b3","#74c476"],3:["#e5f5e0","#a1d99b","#31a354"],4:["#edf8e9","#bae4b3","#74c476","#238b45"],5:["#edf8e9","#bae4b3","#74c476","#31a354","#006d2c"],6:["#edf8e9","#c7e9c0","#a1d99b","#74c476","#31a354","#006d2c"],7:["#edf8e9","#c7e9c0","#a1d99b","#74c476","#41ab5d","#238b45","#005a32"],8:["#f7fcf5","#e5f5e0","#c7e9c0","#a1d99b","#74c476","#41ab5d","#238b45","#005a32"],9:["#f7fcf5","#e5f5e0","#c7e9c0","#a1d99b","#74c476","#41ab5d","#238b45","#006d2c","#00441b"],10:["#f7fcf5","#e5f5e0","#c7e9c0","#a1d99b","#74c476","#41ab5d","#238b45","#006d2c","#065220","#023414"],stops:["rgba(237, 248, 233, 1)","rgba(186, 228, 179, 1)","rgba(116, 196, 118, 1)","rgba(49, 163, 84, 1)","rgba(0, 109, 44, 1)"],tags:["light","greens","sequential","colorblind-friendly"],name:"Green 1"},"seq-single-grays":{1:["#bdbdbd"],2:["#cccccc","#969696"],3:["#f0f0f0","#bdbdbd","#636363"],4:["#f7f7f7","#cccccc","#969696","#525252"],5:["#f7f7f7","#cccccc","#969696","#636363","#252525"],6:["#f7f7f7","#d9d9d9","#bdbdbd","#969696","#636363","#252525"],7:["#f7f7f7","#d9d9d9","#bdbdbd","#969696","#737373","#525252","#252525"],8:["#ffffff","#f0f0f0","#d9d9d9","#bdbdbd","#969696","#737373","#525252","#252525"],9:["#ffffff","#f0f0f0","#d9d9d9","#bdbdbd","#969696","#737373","#525252","#252525","#000000"],10:["#ffffff","#f0f0f0","#d9d9d9","#bdbdbd","#999999","#7a7a7a","#595959","#404040","#262626","#000000"],stops:["rgba(247, 247, 247, 1)","rgba(204, 204, 204, 1)","rgba(150, 150, 150, 1)","rgba(99, 99, 99, 1)","rgba(37, 37, 37, 1)"],tags:["light","grays","sequential","colorblind-friendly"],name:"Gray 1"},"seq-single-oranges":{1:["#fdae6b"],2:["#fdbe85","#fd8d3c"],3:["#fee6ce","#fdae6b","#e6550d"],4:["#feedde","#fdbe85","#fd8d3c","#d94701"],5:["#feedde","#fdbe85","#fd8d3c","#e6550d","#a63603"],6:["#feedde","#fdd0a2","#fdae6b","#fd8d3c","#e6550d","#a63603"],7:["#feedde","#fdd0a2","#fdae6b","#fd8d3c","#f16913","#d94801","#8c2d04"],8:["#fff5eb","#fee6ce","#fdd0a2","#fdae6b","#fd8d3c","#f16913","#d94801","#8c2d04"],9:["#fff5eb","#fee6ce","#fdd0a2","#fdae6b","#fd8d3c","#f16913","#d94801","#a63603","#7f2704"],10:["#fff5eb","#fee6ce","#fdd0a2","#fdae6b","#fd8d3c","#f16913","#d94801","#a63603","#7f2704","#591502"],stops:["rgba(254, 237, 222, 1)","rgba(253, 190, 133, 1)","rgba(253, 141, 60, 1)","rgba(230, 85, 13, 1)","rgba(166, 54, 3, 1)"],tags:["light","oranges","sequential","colorblind-friendly"],name:"Orange 2"},"seq-single-purples":{1:["#bcbddc"],2:["#cbc9e2","#9e9ac8"],3:["#efedf5","#bcbddc","#756bb1"],4:["#f2f0f7","#cbc9e2","#9e9ac8","#6a51a3"],5:["#f2f0f7","#cbc9e2","#9e9ac8","#756bb1","#54278f"],6:["#f2f0f7","#dadaeb","#bcbddc","#9e9ac8","#756bb1","#54278f"],7:["#f2f0f7","#dadaeb","#bcbddc","#9e9ac8","#807dba","#6a51a3","#4a1486"],8:["#fcfbfd","#efedf5","#dadaeb","#bcbddc","#9e9ac8","#807dba","#6a51a3","#4a1486"],9:["#fcfbfd","#efedf5","#dadaeb","#bcbddc","#9e9ac8","#807dba","#6a51a3","#54278f","#3f007d"],10:["#fcfbfd","#efedf5","#dadaeb","#bcbddc","#9e9ac8","#807dba","#6a51a3","#54278f","#3f007d","#2d0059"],stops:["rgba(242, 240, 247, 1)","rgba(203, 201, 226, 1)","rgba(158, 154, 200, 1)","rgba(117, 107, 177, 1)","rgba(84, 39, 143, 1)"],tags:["light","purples","sequential","colorblind-friendly"],name:"Purple 3"},"seq-single-reds":{1:["#fc9272"],2:["#fcae91","#fb6a4a"],3:["#fee0d2","#fc9272","#de2d26"],4:["#fee5d9","#fcae91","#fb6a4a","#cb181d"],5:["#fee5d9","#fcae91","#fb6a4a","#de2d26","#a50f15"],6:["#fee5d9","#fcbba1","#fc9272","#fb6a4a","#de2d26","#a50f15"],7:["#fee5d9","#fcbba1","#fc9272","#fb6a4a","#ef3b2c","#cb181d","#99000d"],8:["#fff5f0","#fee0d2","#fcbba1","#fc9272","#fb6a4a","#ef3b2c","#cb181d","#99000d"],9:["#fff5f0","#fee0d2","#fcbba1","#fc9272","#fb6a4a","#ef3b2c","#cb181d","#a50f15","#67000d"],10:["#fff5f0","#fee0d2","#fcbba1","#fc9272","#fb6a4a","#ef3b2c","#cb181d","#a50f15","#7d0011","#52000b"],stops:["rgba(254, 229, 217, 1)","rgba(252, 174, 145, 1)","rgba(251, 106, 74, 1)","rgba(222, 45, 38, 1)","rgba(165, 15, 21, 1)"],tags:["light","reds","sequential","colorblind-friendly"],name:"Red 5"},"seq-multi-bugn":{1:["#99d8c9"],2:["#b2e2e2","#66c2a4"],3:["#e5f5f9","#99d8c9","#2ca25f"],4:["#edf8fb","#b2e2e2","#66c2a4","#238b45"],5:["#edf8fb","#b2e2e2","#66c2a4","#2ca25f","#006d2c"],6:["#edf8fb","#ccece6","#99d8c9","#66c2a4","#2ca25f","#006d2c"],7:["#edf8fb","#ccece6","#99d8c9","#66c2a4","#41ae76","#238b45","#005824"],8:["#f7fcfd","#e5f5f9","#ccece6","#99d8c9","#66c2a4","#41ae76","#238b45","#005824"],9:["#f7fcfd","#e5f5f9","#ccece6","#99d8c9","#66c2a4","#41ae76","#238b45","#006d2c","#00441b"],10:["#f7fcfd","#e5f5f9","#ccece6","#99d8c9","#66c2a4","#41ae76","#238b45","#006d2c","#005824","#033d18"],stops:["rgba(237, 248, 251, 1)","rgba(178, 226, 226, 1)","rgba(102, 194, 164, 1)","rgba(44, 162, 95, 1)","rgba(0, 109, 44, 1)"],tags:["light","greens","sequential","colorblind-friendly"],name:"Green 2"},"seq-multi-bupu":{1:["#9ebcda"],2:["#b3cde3","#8c96c6"],3:["#e0ecf4","#9ebcda","#8856a7"],4:["#edf8fb","#b3cde3","#8c96c6","#88419d"],5:["#edf8fb","#b3cde3","#8c96c6","#8856a7","#810f7c"],6:["#edf8fb","#bfd3e6","#9ebcda","#8c96c6","#8856a7","#810f7c"],7:["#edf8fb","#bfd3e6","#9ebcda","#8c96c6","#8c6bb1","#88419d","#6e016b"],8:["#f7fcfd","#e0ecf4","#bfd3e6","#9ebcda","#8c96c6","#8c6bb1","#88419d","#6e016b"],9:["#f7fcfd","#e0ecf4","#bfd3e6","#9ebcda","#8c96c6","#8c6bb1","#88419d","#810f7c","#4d004b"],10:["#f7fcfd","#e0ecf4","#bfd3e6","#9ebcda","#8c96c6","#8c6bb1","#88419d","#810f7c","#680066","#3f013f"],stops:["rgba(237, 248, 251, 1)","rgba(179, 205, 227, 1)","rgba(140, 150, 198, 1)","rgba(136, 86, 167, 1)","rgba(129, 15, 124, 1)"],tags:["light","purples","sequential","colorblind-friendly"],name:"Purple 4"},"seq-multi-gnbu":{1:["#a8ddb5"],2:["#bae4bc","#7bccc4"],3:["#e0f3db","#a8ddb5","#43a2ca"],4:["#f0f9e8","#bae4bc","#7bccc4","#2b8cbe"],5:["#f0f9e8","#bae4bc","#7bccc4","#43a2ca","#0868ac"],6:["#f0f9e8","#ccebc5","#a8ddb5","#7bccc4","#43a2ca","#0868ac"],7:["#f0f9e8","#ccebc5","#a8ddb5","#7bccc4","#4eb3d3","#2b8cbe","#08589e"],8:["#f7fcf0","#e0f3db","#ccebc5","#a8ddb5","#7bccc4","#4eb3d3","#2b8cbe","#08589e"],9:["#f7fcf0","#e0f3db","#ccebc5","#a8ddb5","#7bccc4","#4eb3d3","#2b8cbe","#0868ac","#084081"],10:["#f7fcf0","#e0f3db","#ccebc5","#a8ddb5","#7bccc4","#4eb3d3","#2b8cbe","#0868ac","#084081","#0e2f6b"],stops:["rgba(240, 249, 232, 1)","rgba(186, 228, 188, 1)","rgba(123, 204, 196, 1)","rgba(67, 162, 202, 1)","rgba(8, 104, 172, 1)"],tags:["light","blues","greens","sequential","colorblind-friendly"],name:"Blue 4"},"seq-multi-orrd":{1:["#fdbb84"],2:["#fdcc8a","#fc8d59"],3:["#fee8c8","#fdbb84","#e34a33"],4:["#fef0d9","#fdcc8a","#fc8d59","#d7301f"],5:["#fef0d9","#fdcc8a","#fc8d59","#e34a33","#b30000"],6:["#fef0d9","#fdd49e","#fdbb84","#fc8d59","#e34a33","#b30000"],7:["#fef0d9","#fdd49e","#fdbb84","#fc8d59","#ef6548","#d7301f","#990000"],8:["#fff7ec","#fee8c8","#fdd49e","#fdbb84","#fc8d59","#ef6548","#d7301f","#990000"],9:["#fff7ec","#fee8c8","#fdd49e","#fdbb84","#fc8d59","#ef6548","#d7301f","#b30000","#7f0000"],10:["#fff7ec","#fee8c8","#fdd49e","#fdbb84","#fc8d59","#ef6548","#d7301f","#b30000","#8a0002","#660000"],stops:["rgba(254, 240, 217, 1)","rgba(253, 204, 138, 1)","rgba(252, 141, 89, 1)","rgba(227, 74, 51, 1)","rgba(179, 0, 0, 1)"],tags:["light","reds","sequential","colorblind-friendly"],name:"Red 6"},"seq-multi-pubu":{1:["#a6bddb"],2:["#bdc9e1","#74a9cf"],3:["#ece7f2","#a6bddb","#2b8cbe"],4:["#f1eef6","#bdc9e1","#74a9cf","#0570b0"],5:["#f1eef6","#bdc9e1","#74a9cf","#2b8cbe","#045a8d"],6:["#f1eef6","#d0d1e6","#a6bddb","#74a9cf","#2b8cbe","#045a8d"],7:["#f1eef6","#d0d1e6","#a6bddb","#74a9cf","#3690c0","#0570b0","#034e7b"],8:["#fff7fb","#ece7f2","#d0d1e6","#a6bddb","#74a9cf","#3690c0","#0570b0","#034e7b"],9:["#fff7fb","#ece7f2","#d0d1e6","#a6bddb","#74a9cf","#3690c0","#0570b0","#045a8d","#023858"],10:["#fff7fb","#ece7f2","#d0d1e6","#a6bddb","#74a9cf","#3690c0","#0570b0","#045a8d","#06436b","#05304d"],stops:["rgba(241, 238, 246, 1)","rgba(189, 201, 225, 1)","rgba(116, 169, 207, 1)","rgba(43, 140, 190, 1)","rgba(4, 90, 141, 1)"],tags:["light","blues","sequential","colorblind-friendly"],name:"Blue 5"},"seq-multi-pubugn":{1:["#a6bddb"],2:["#bdc9e1","#67a9cf"],3:["#ece2f0","#a6bddb","#1c9099"],4:["#f6eff7","#bdc9e1","#67a9cf","#02818a"],5:["#f6eff7","#bdc9e1","#67a9cf","#1c9099","#016c59"],6:["#f6eff7","#d0d1e6","#a6bddb","#67a9cf","#1c9099","#016c59"],7:["#f6eff7","#d0d1e6","#a6bddb","#67a9cf","#3690c0","#02818a","#016450"],8:["#fff7fb","#ece2f0","#d0d1e6","#a6bddb","#67a9cf","#3690c0","#02818a","#016450"],9:["#fff7fb","#ece2f0","#d0d1e6","#a6bddb","#67a9cf","#3690c0","#02818a","#016c59","#014636"],10:["#fff7fb","#ece2f0","#d0d1e6","#a6bddb","#67a9cf","#3690c0","#02818a","#016c59","#095742","#073d2c"],stops:["rgba(246, 239, 247, 1)","rgba(189, 201, 225, 1)","rgba(103, 169, 207, 1)","rgba(28, 144, 153, 1)","rgba(1, 108, 89, 1)"],tags:["light","greens","blues","sequential","colorblind-friendly"],name:"Green 3"},"seq-multi-purd":{1:["#c994c7"],2:["#d7b5d8","#df65b0"],3:["#e7e1ef","#c994c7","#dd1c77"],4:["#f1eef6","#d7b5d8","#df65b0","#ce1256"],5:["#f1eef6","#d7b5d8","#df65b0","#dd1c77","#980043"],6:["#f1eef6","#d4b9da","#c994c7","#df65b0","#dd1c77","#980043"],7:["#f1eef6","#d4b9da","#c994c7","#df65b0","#e7298a","#ce1256","#91003f"],8:["#f7f4f9","#e7e1ef","#d4b9da","#c994c7","#df65b0","#e7298a","#ce1256","#91003f"],9:["#f7f4f9","#e7e1ef","#d4b9da","#c994c7","#df65b0","#e7298a","#ce1256","#980043","#67001f"],10:["#f7f4f9","#e7e1ef","#d4b9da","#c994c7","#df65b0","#e7298a","#ce1256","#980043","#67001f","#48000c"],stops:["rgba(241, 238, 246, 1)","rgba(215, 181, 216, 1)","rgba(223, 101, 176, 1)","rgba(221, 28, 119, 1)","rgba(152, 0, 67, 1)"],tags:["light","pinks","sequential","colorblind-friendly"],name:"Pink 2"},"seq-multi-rdpu":{1:["#fa9fb5"],2:["#fbb4b9","#f768a1"],3:["#fde0dd","#fa9fb5","#c51b8a"],4:["#feebe2","#fbb4b9","#f768a1","#ae017e"],5:["#feebe2","#fbb4b9","#f768a1","#c51b8a","#7a0177"],6:["#feebe2","#fcc5c0","#fa9fb5","#f768a1","#c51b8a","#7a0177"],7:["#feebe2","#fcc5c0","#fa9fb5","#f768a1","#dd3497","#ae017e","#7a0177"],8:["#fff7f3","#fde0dd","#fcc5c0","#fa9fb5","#f768a1","#dd3497","#ae017e","#7a0177"],9:["#fff7f3","#fde0dd","#fcc5c0","#fa9fb5","#f768a1","#dd3497","#ae017e","#7a0177","#49006a"],10:["#fff7f3","#fde0dd","#fcc5c0","#fa9fb5","#f768a1","#dd3497","#ae017e","#7a0177","#49006a","#2d004d"],stops:["rgba(254, 235, 226, 1)","rgba(251, 180, 185, 1)","rgba(247, 104, 161, 1)","rgba(197, 27, 138, 1)","rgba(122, 1, 119, 1)"],tags:["light","pinks","sequential","colorblind-friendly"],name:"Pink 3"},"seq-multi-ylgn":{1:["#addd8e"],2:["#c2e699","#78c679"],3:["#f7fcb9","#addd8e","#31a354"],4:["#ffffcc","#c2e699","#78c679","#238443"],5:["#ffffcc","#c2e699","#78c679","#31a354","#006837"],6:["#ffffcc","#d9f0a3","#addd8e","#78c679","#31a354","#006837"],7:["#ffffcc","#d9f0a3","#addd8e","#78c679","#41ab5d","#238443","#005a32"],8:["#ffffe5","#f7fcb9","#d9f0a3","#addd8e","#78c679","#41ab5d","#238443","#005a32"],9:["#ffffe5","#f7fcb9","#d9f0a3","#addd8e","#78c679","#41ab5d","#238443","#006837","#004529"],10:["#ffffe5","#f7fcb9","#d9f0a3","#addd8e","#78c679","#41ab5d","#238443","#006837","#09522c","#023827"],stops:["rgba(255, 255, 204, 1)","rgba(194, 230, 153, 1)","rgba(120, 198, 121, 1)","rgba(49, 163, 84, 1)","rgba(0, 104, 55, 1)"],tags:["light","greens","sequential","colorblind-friendly"],name:"Green 4"},"seq-multi-ylgnbu":{1:["#7fcdbb"],2:["#a1dab4","#41b6c4"],3:["#edf8b1","#7fcdbb","#2c7fb8"],4:["#ffffcc","#a1dab4","#41b6c4","#225ea8"],5:["#ffffcc","#a1dab4","#41b6c4","#2c7fb8","#253494"],6:["#ffffcc","#c7e9b4","#7fcdbb","#41b6c4","#2c7fb8","#253494"],7:["#ffffcc","#c7e9b4","#7fcdbb","#41b6c4","#1d91c0","#225ea8","#0c2c84"],8:["#ffffd9","#edf8b1","#c7e9b4","#7fcdbb","#41b6c4","#1d91c0","#225ea8","#0c2c84"],9:["#ffffd9","#edf8b1","#c7e9b4","#7fcdbb","#41b6c4","#1d91c0","#225ea8","#253494","#081d58"],10:["#ffffd9","#edf8b1","#c7e9b4","#7fcdbb","#41b6c4","#1d91c0","#225ea8","#2f419e","#152875","#061b42"],stops:["rgba(255, 255, 204, 1)","rgba(161, 218, 180, 1)","rgba(65, 182, 196, 1)","rgba(44, 127, 184, 1)","rgba(37, 52, 148, 1)"],tags:["light","blues","greens","sequential","colorblind-friendly"],name:"Blue 6"},"seq-multi-ylorbr":{1:["#fec44f"],2:["#fed98e","#fe9929"],3:["#fff7bc","#fec44f","#d95f0e"],4:["#ffffd4","#fed98e","#fe9929","#cc4c02"],5:["#ffffd4","#fed98e","#fe9929","#d95f0e","#993404"],6:["#ffffd4","#fee391","#fec44f","#fe9929","#d95f0e","#993404"],7:["#ffffd4","#fee391","#fec44f","#fe9929","#ec7014","#cc4c02","#8c2d04"],8:["#ffffe5","#fff7bc","#fee391","#fec44f","#fe9929","#ec7014","#cc4c02","#8c2d04"],9:["#ffffe5","#fff7bc","#fee391","#fec44f","#fe9929","#ec7014","#cc4c02","#993404","#662506"],10:["#ffffe5","#fff7bc","#fee391","#fec44f","#fe9929","#ec7014","#cc4c02","#993404","#702607","#57220b"],stops:["rgba(255, 255, 212, 1)","rgba(254, 217, 142, 1)","rgba(254, 153, 41, 1)","rgba(217, 95, 14, 1)","rgba(153, 52, 4, 1)"],tags:["light","yellows","oranges","sequential","colorblind-friendly"],name:"Orange 3"},"seq-multi-ylorrd":{1:["#feb24c"],2:["#fecc5c","#fd8d3c"],3:["#ffeda0","#feb24c","#f03b20"],4:["#ffffb2","#fecc5c","#fd8d3c","#e31a1c"],5:["#ffffb2","#fecc5c","#fd8d3c","#f03b20","#bd0026"],6:["#ffffb2","#fed976","#feb24c","#fd8d3c","#f03b20","#bd0026"],7:["#ffffb2","#fed976","#feb24c","#fd8d3c","#fc4e2a","#e31a1c","#b10026"],8:["#ffffcc","#ffeda0","#fed976","#feb24c","#fd8d3c","#fc4e2a","#e31a1c","#b10026"],9:["#ffffcc","#ffeda0","#fed976","#feb24c","#fd8d3c","#fc4e2a","#e31a1c","#bd0026","#800026"],10:["#ffffcc","#ffeda0","#fed976","#feb24c","#fd8d3c","#fc4e2a","#e31a1c","#bd0026","#940025","#67001f"],stops:["rgba(255, 255, 178, 1)","rgba(254, 204, 92, 1)","rgba(253, 141, 60, 1)","rgba(240, 59, 32, 1)","rgba(189, 0, 38, 1)"],tags:["light","reds","yellows","oranges","sequential","colorblind-friendly"],name:"Orange 4"},"seq-teal-lightgreen-bright":{1:["#add46a"],2:["#e2ebd3","#2d8078"],3:["#e2ebd3","#add46a","#2d8078"],4:["#e2ebd3","#c8e09f","#add46a","#2d8078"],5:["#e2ebd3","#c8e09f","#add46a","#62afa7","#2d8078"],6:["#e2ebd3","#c8e09f","#add46a","#8fc890","#62afa7","#2d8078"],7:["#e2ebd3","#d5e5b9","#c8e09f","#add46a","#8fc890","#50a098","#2d8078"],8:["#e2ebd3","#d5e5b9","#c8e09f","#add46a","#8fc890","#73bfb7","#50a098","#2d8078"],9:["#e2ebd3","#d5e5b9","#c8e09f","#add46a","#8fc890","#73bfb7","#62afa7","#50a098","#2d8078"],10:["#e2ebd3","#d5e5b9","#c8e09f","#bada84","#add46a","#8fc890","#73bfb7","#62afa7","#50a098","#2d8078"],stops:["#e2ebd3","#c8e09f","#add46a","#62afa7","#2d8078"],tags:["light","greens","blues","sequential","colorblind-friendly"],name:"Green 5"},"seq-green-lightgray-bright":{1:["#a3af96"],2:["#e6e4e1","#4e6605"],3:["#e6e4e1","#a3af96","#4e6605"],4:["#e6e4e1","#d9d7d6","#7c9e14","#4e6605"],5:["#e6e4e1","#d9d7d6","#a3af96","#7c9e14","#4e6605"],6:["#e6e4e1","#d9d7d6","#a3af96","#93ba1c","#7c9e14","#4e6605"],7:["#e6e4e1","#d9d7d6","#c0bebe","#a3af96","#93ba1c","#7c9e14","#4e6605"],8:["#e6e4e1","#d9d7d6","#c0bebe","#b3b1b3","#a3af96","#93ba1c","#7c9e14","#4e6605"],9:["#e6e4e1","#d9d7d6","#c0bebe","#b3b1b3","#a3af96","#93ba1c","#7c9e14","#65820d","#4e6605"],10:["#e6e4e1","#d9d7d6","#cdcbca","#c0bebe","#b3b1b3","#a3af96","#93ba1c","#7c9e14","#65820d","#4e6605"],stops:["#e6e4e1","#d9d7d6","#a3af96","#7c9e14","#4e6605"],tags:["light","greens","sequential","grays","colorblind-friendly"],name:"Green 6"},"seq-red-lightgray-bright":{1:["#b3bfd1"],2:["#d7e1ee","#991f17"],3:["#d7e1ee","#b3bfd1","#991f17"],4:["#d7e1ee","#cbd6e4","#c86558","#991f17"],5:["#d7e1ee","#cbd6e4","#b3bfd1","#c86558","#991f17"],6:["#d7e1ee","#cbd6e4","#b3bfd1","#df8879","#c86558","#991f17"],7:["#d7e1ee","#cbd6e4","#bfcbdb","#b3bfd1","#df8879","#c86558","#991f17"],8:["#d7e1ee","#cbd6e4","#bfcbdb","#b3bfd1","#df8879","#c86558","#b04238","#991f17"],9:["#d7e1ee","#cbd6e4","#bfcbdb","#b3bfd1","#a4a2a8","#df8879","#c86558","#b04238","#991f17"],10:["#d7e1ee","#cbd6e4","#bfcbdb","#b3bfd1","#a7b4c7","#a4a2a8","#df8879","#c86558","#b04238","#991f17"],stops:["#d7e1ee","#cbd6e4","#b3bfd1","#c86558","#991f17"],tags:["light","reds","sequential","colorblind-friendly"],name:"Red 7"},"seq-blue-lightgray-bright":{1:["#9cadb4"],2:["#ebe6df","#007f99"],3:["#ebe6df","#9cadb4","#007f99"],4:["#ebe6df","#c3beb9","#40a7b9","#007f99"],5:["#ebe6df","#c3beb9","#9cadb4","#40a7b9","#007f99"],6:["#ebe6df","#ded9d2","#c3beb9","#9cadb4","#40a7b9","#007f99"],7:["#ebe6df","#ded9d2","#c3beb9","#9cadb4","#40a7b9","#2093a9","#007f99"],8:["#ebe6df","#ded9d2","#d1ccc6","#c3beb9","#9cadb4","#40a7b9","#2093a9","#007f99"],9:["#ebe6df","#ded9d2","#d1ccc6","#c3beb9","#9cadb4","#60bbc9","#40a7b9","#2093a9","#007f99"],10:["#ebe6df","#ded9d2","#d1ccc6","#c3beb9","#b6b1ac","#9cadb4","#60bbc9","#40a7b9","#2093a9","#007f99"],stops:["#ebe6df","#c3beb9","#9cadb4","#40a7b9","#007f99"],tags:["light","blues","sequential","grays","colorblind-friendly"],name:"Blue 7"},"seq-orange-lightgray-bright":{1:["#b39e93"],2:["#dfe1e6","#8c4a23"],3:["#dfe1e6","#b39e93","#8c4a23"],4:["#dfe1e6","#bbbfc9","#c4703e","#8c4a23"],5:["#dfe1e6","#bbbfc9","#b39e93","#c4703e","#8c4a23"],6:["#dfe1e6","#d3d6dc","#bbbfc9","#e0834c","#c4703e","#8c4a23"],7:["#dfe1e6","#d3d6dc","#bbbfc9","#b39e93","#e0834c","#c4703e","#8c4a23"],8:["#dfe1e6","#d3d6dc","#c7cbd3","#bbbfc9","#b39e93","#e0834c","#c4703e","#8c4a23"],9:["#dfe1e6","#d3d6dc","#c7cbd3","#bbbfc9","#b39e93","#e0834c","#c4703e","#a85d31","#8c4a23"],10:["#dfe1e6","#d3d6dc","#c7cbd3","#bbbfc9","#afb4bf","#b39e93","#e0834c","#c4703e","#a85d31","#8c4a23"],stops:["#dfe1e6","#bbbfc9","#b39e93","#c4703e","#8c4a23"],tags:["light","oranges","browns","sequential","grays","colorblind-friendly"],name:"Orange 5"},"seq-blue-red-yellow-bright":{1:["#c59ca4"],2:["#eae2bb","#1d4e89"],3:["#eae2bb","#c59ca4","#1d4e89"],4:["#e9d7b8","#e8c9b3","#a48d9e","#606d94"],5:["#e9d7b8","#e8c9b3","#c59ca4","#a48d9e","#606d94"],6:["#eae2bb","#e9d7b8","#e8c9b3","#a48d9e","#606d94","#1d4e89"],7:["#eae2bb","#e9d7b8","#e8c9b3","#c59ca4","#a48d9e","#606d94","#1d4e89"],8:["#eae2bb","#e9d7b8","#e8c9b3","#e8baae","#c59ca4","#a48d9e","#606d94","#1d4e89"],9:["#eae2bb","#e9d7b8","#e8c9b3","#e8baae","#c59ca4","#a48d9e","#827d99","#606d94","#1d4e89"],10:["#eae2bb","#e9d7b8","#e8c9b3","#e8baae","#d7aba9","#c59ca4","#a48d9e","#827d99","#606d94","#1d4e89"],stops:["#e9d7b8","#e8c9b3","#c59ca4","#a48d9e","#606d94"],tags:["light","blues","sequential","colorblind-friendly"],name:"Blue 8"},"seq-gray-lightgreen-bright":{1:["#b1bf85"],2:["#635e5e","#d9f191"],3:["#635e5e","#b1bf85","#d9f191"],4:["#635e5e","#928d8d","#c2e655","#d9f191"],5:["#635e5e","#928d8d","#b1bf85","#c2e655","#d9f191"],6:["#7b7676","#928d8d","#aaa5a5","#b6e038","#c2e655","#d9f191"],7:["#7b7676","#928d8d","#aaa5a5","#b1bf85","#b6e038","#c2e655","#d9f191"],8:["#7b7676","#928d8d","#aaa5a5","#b1bf85","#b6e038","#c2e655","#ceec73","#d9f191"],9:["#635e5e","#7b7676","#928d8d","#aaa5a5","#b1bf85","#b6e038","#c2e655","#ceec73","#d9f191"],10:["#635e5e","#7b7676","#928d8d","#aaa5a5","#b1bf85","#b6e038","#c2e655","#ceec73","#d9f191","#e5f7ae"],stops:["#635e5e","#928d8d","#b1bf85","#c2e655","#d9f191"],tags:["dark","greens","sequential","bright","grays","colorblind-friendly"],name:"Green 7"},"seq-blue-tan-bright":{1:["#afbac4"],2:["#ebe6df","#436480"],3:["#ebe6df","#afbac4","#436480"],4:["#ebe6df","#d9c2b1","#7d9ab3","#436480"],5:["#ebe6df","#d9c2b1","#afbac4","#7d9ab3","#436480"],6:["#ebe6df","#e5dad0","#d9c2b1","#7d9ab3","#607f99","#436480"],7:["#ebe6df","#e5dad0","#d9c2b1","#afbac4","#7d9ab3","#607f99","#436480"],8:["#ebe6df","#e5dad0","#dfcec0","#d9c2b1","#afbac4","#7d9ab3","#607f99","#436480"],9:["#ebe6df","#e5dad0","#dfcec0","#d9c2b1","#c4bebc","#afbac4","#7d9ab3","#607f99","#436480"],10:["#ebe6df","#e5dad0","#dfcec0","#d9c2b1","#c4bebc","#afbac4","#9ab5cc","#7d9ab3","#607f99","#436480"],stops:["#ebe6df","#d9c2b1","#afbac4","#7d9ab3","#436480"],tags:["light","blues","sequential","subdued","colorblind-friendly"],name:"Blue 9"},"seq-teal-lightbrown-bright":{1:["#aabdb5"],2:["#eee2cf","#3b758c"],3:["#eee2cf","#aabdb5","#3b758c"],4:["#eee2cf","#dbd0b9","#74a2b3","#3b758c"],5:["#eee2cf","#dbd0b9","#aabdb5","#74a2b3","#3b758c"],6:["#eee2cf","#e4d9c4","#dbd0b9","#74a2b3","#588ba0","#3b758c"],7:["#eee2cf","#e4d9c4","#dbd0b9","#aabdb5","#74a2b3","#588ba0","#3b758c"],8:["#eee2cf","#e4d9c4","#dbd0b9","#c7bea2","#aabdb5","#74a2b3","#588ba0","#3b758c"],9:["#eee2cf","#e4d9c4","#dbd0b9","#c7bea2","#aabdb5","#91b8c7","#74a2b3","#588ba0","#3b758c"],10:["#eee2cf","#e4d9c4","#dbd0b9","#d1c7ad","#c7bea2","#aabdb5","#91b8c7","#74a2b3","#588ba0","#3b758c"],stops:["#eee2cf","#dbd0b9","#aabdb5","#74a2b3","#3b758c"],tags:["light","blues","sequential","subdued","colorblind-friendly"],name:"Blue 10"},"seq-reds-bright":{1:["#ec5244"],2:["#7b4238","#fff0dc"],3:["#7b4238","#ec5244","#fff0dc"],4:["#57453b","#c23d33","#f9816c","#fff0dc"],5:["#7b4238","#c23d33","#ec5244","#f9816c","#ffc4ae"],6:["#7b4238","#c23d33","#ec5244","#f9816c","#ffc4ae","#fff0dc"],7:["#57453b","#7b4238","#c23d33","#ec5244","#f9816c","#ffc4ae","#fff0dc"],8:["#7b4238","#9f4036","#c23d33","#d7483c","#ec5244","#f3696c","#f9816c","#ffc4ae"],9:["#57453b","#7b4238","#9f4036","#c23d33","#d7483c","#ec5244","#f3696c","#f9816c","#ffc4ae"],10:["#57453b","#7b4238","#9f4036","#c23d33","#d7483c","#ec5244","#f3696c","#f9816c","#ffc4ae","#fff0dc"],stops:["#7b4238","#c23d33","#ec5244","#f9816c","#ffc4ae"],tags:["dark","reds","sequential","bright","colorblind-friendly"],name:"Red 8"},"seq-purples-bright":{1:["#946bdc"],2:["#5a4a78","#e6e1ff"],3:["#5a4a78","#946bdc","#e6e1ff"],4:["#4e465c","#695291","#aa89e8","#e6e1ff"],5:["#4e465c","#695291","#8663c3","#aa89e8","#d7c4ff"],6:["#5a4a78","#775baa","#946bdc","#aa89e8","#d7c4ff","#e6e1ff"],7:["#4e465c","#5a4a78","#775baa","#946bdc","#aa89e8","#d7c4ff","#e6e1ff"],8:["#5a4a78","#695291","#775baa","#8663c3","#946bdc","#aa89e8","#c1a6f3","#d7c4ff"],9:["#4e465c","#5a4a78","#695291","#775baa","#8663c3","#946bdc","#aa89e8","#c1a6f3","#d7c4ff"],10:["#4e465c","#5a4a78","#695291","#775baa","#8663c3","#946bdc","#aa89e8","#c1a6f3","#d7c4ff","#e6e1ff"],stops:["#4e465c","#695291","#8663c3","#aa89e8","#d7c4ff"],tags:["dark","purples","sequential","bright","colorblind-friendly"],name:"Purple 5"},"seq-blues-bright":{1:["#50a5e7"],2:["#435c6c","#e6faff"],3:["#435c6c","#50a5e7","#e6faff"],4:["#404d54","#48799d","#74bbed","#e6faff"],5:["#404d54","#48799d","#4d96ce","#74bbed","#bce6f9"],6:["#435c6c","#4b88b6","#4d96ce","#74bbed","#bce6f9","#e6faff"],7:["#404d54","#435c6c","#4b88b6","#4d96ce","#74bbed","#bce6f9","#e6faff"],8:["#435c6c","#48799d","#4b88b6","#4d96ce","#50a5e7","#74bbed","#98d0f3","#bce6f9"],9:["#404d54","#435c6c","#48799d","#4b88b6","#4d96ce","#50a5e7","#74bbed","#98d0f3","#bce6f9"],10:["#404d54","#435c6c","#48799d","#4b88b6","#4d96ce","#50a5e7","#74bbed","#98d0f3","#bce6f9","#e6faff"],stops:["#404d54","#48799d","#4d96ce","#74bbed","#bce6f9"],tags:["dark","blues","sequential","bright","colorblind-friendly"],name:"Blue 11"},"seq-greens-bright":{1:["#33b581"],2:["#39544c","#f4ffea"],3:["#39544c","#4bc392","#f4ffea"],4:["#39544c","#368165","#64d2a2","#f4ffea"],5:["#39544c","#368165","#33b581","#64d2a2","#cbf6d9"],6:["#39544c","#386757","#359b73","#4bc392","#7ce0b3","#f4ffea"],7:["#39544c","#386757","#359b73","#4bc392","#64d2a2","#cbf6d9","#f4ffea"],8:["#386757","#368165","#359b73","#33b581","#4bc392","#64d2a2","#7ce0b3","#cbf6d9"],9:["#39544c","#386757","#368165","#359b73","#33b581","#4bc392","#64d2a2","#7ce0b3","#cbf6d9"],10:["#39544c","#386757","#368165","#359b73","#33b581","#4bc392","#64d2a2","#7ce0b3","#cbf6d9","#f4ffea"],stops:["#39544c","#368165","#33b581","#64d2a2","#cbf6d9"],tags:["dark","greens","sequential","bright","colorblind-friendly"],name:"Green 8"},"seq-browns-bright":{1:["#eba748"],2:["#524834","#f9e0b7"],3:["#524834","#eba748","#f9e0b7"],4:["#524834","#ae8140","#eeb664","#f9e0b7"],5:["#715b38","#ae8140","#cc9444","#eeb664","#f9e0b7"],6:["#524834","#715b38","#ae8140","#eba748","#f0c47f","#fff8eb"],7:["#524834","#715b38","#8f6e3c","#ae8140","#eba748","#f0c47f","#fff8eb"],8:["#715b38","#8f6e3c","#ae8140","#cc9444","#eba748","#eeb664","#f0c47f","#f9e0b7"],9:["#524834","#715b38","#8f6e3c","#ae8140","#cc9444","#eba748","#eeb664","#f0c47f","#f9e0b7"],10:["#524834","#715b38","#8f6e3c","#ae8140","#cc9444","#eba748","#eeb664","#f0c47f","#f9e0b7","#fff8eb"],stops:["#715b38","#ae8140","#cc9444","#eeb664","#f9e0b7"],tags:["dark","oranges","browns","sequential","bright","colorblind-friendly"],name:"Yellow 1"},"seq-dark-to-light-magenta-bright":{1:["#ec2e96"],2:["#614149","#fff0ff"],3:["#614149","#ec2e96","#fff0ff"],4:["#7c3d58","#c33381","#ec90c6","#fff0ff"],5:["#7c3d58","#c33381","#e84fa6","#ec90c6","#fff0ff"],6:["#614149","#7c3d58","#c33381","#e84fa6","#ec90c6","#fff0ff"],7:["#614149","#7c3d58","#c33381","#ec2e96","#ea6fb6","#ec90c6","#fff0ff"],8:["#7c3d58","#9f386d","#c33381","#ec2e96","#e84fa6","#ea6fb6","#ec90c6","#edb2d4"],9:["#614149","#7c3d58","#9f386d","#c33381","#ec2e96","#e84fa6","#ea6fb6","#ec90c6","#edb2d4"],10:["#614149","#7c3d58","#9f386d","#c33381","#ec2e96","#e84fa6","#ea6fb6","#ec90c6","#edb2d4","#fff0ff"],stops:["#7c3d58","#c33381","#e84fa6","#ec90c6","#fff0ff"],tags:["dark","pinks","sequential","bright","colorblind-friendly"],name:"Pink 4"},"seq-dark-to-light-purple-bright":{1:["#8b87e4"],2:["#4a4672","#f0f0ff"],3:["#4a4672","#8b87e4","#f0f0ff"],4:["#545086","#6f6abb","#aaa7ff","#f0f0ff"],5:["#545086","#6f6abb","#8b87e4","#aaa7ff","#f0f0ff"],6:["#4a4672","#545086","#6f6abb","#8b87e4","#aaa7ff","#f0f0ff"],7:["#545086","#615da1","#6f6abb","#7c77d6","#9b97f1","#aaa7ff","#f0f0ff"],8:["#545086","#615da1","#6f6abb","#7c77d6","#8b87e4","#9b97f1","#aaa7ff","#cdccff"],9:["#4a4672","#545086","#615da1","#6f6abb","#7c77d6","#8b87e4","#9b97f1","#aaa7ff","#cdccff"],10:["#4a4672","#545086","#615da1","#6f6abb","#7c77d6","#8b87e4","#9b97f1","#aaa7ff","#cdccff","#f0f0ff"],stops:["#545086","#6f6abb","#8b87e4","#aaa7ff","#f0f0ff"],tags:["dark","purples","sequential","bright","colorblind-friendly"],name:"Purple 6"},"seq-dark-to-light-blue-bright":{1:["#5686ff"],2:["#41495f","#e6f5fa"],3:["#41495f","#5686ff","#e6f5fa"],4:["#45537a","#4e6dbd","#96b8fe","#e6f5fa"],5:["#45537a","#4e6dbd","#5686ff","#96b8fe","#e6f5fa"],6:["#41495f","#45537a","#4e6dbd","#5686ff","#96b8fe","#e6f5fa"],7:["#45537a","#49609b","#4e6dbd","#5279de","#769ffe","#96b8fe","#e6f5fa"],8:["#45537a","#49609b","#4e6dbd","#5279de","#5686ff","#769ffe","#96b8fe","#b6d1fd"],9:["#41495f","#45537a","#49609b","#4e6dbd","#5279de","#5686ff","#769ffe","#96b8fe","#b6d1fd"],10:["#41495f","#45537a","#49609b","#4e6dbd","#5279de","#5686ff","#769ffe","#96b8fe","#b6d1fd","#e6f5fa"],stops:["#45537a","#4e6dbd","#5686ff","#96b8fe","#e6f5fa"],tags:["dark","blues","sequential","bright","colorblind-friendly"],name:"Blue 12"},"seq-dark-to-light-green-bright":{1:["#72c66d"],2:["#3d5439","#f5fff2"],3:["#3d5439","#72c66d","#f5fff2"],4:["#43683f","#5b9756","#b7e3b2","#f5fff2"],5:["#43683f","#5b9756","#72c66d","#b7e3b2","#f5fff2"],6:["#3d5439","#43683f","#5b9756","#72c66d","#b7e3b2","#f5fff2"],7:["#43683f","#4f804b","#5b9756","#66af62","#95d490","#b7e3b2","#f5fff2"],8:["#43683f","#4f804b","#5b9756","#66af62","#72c66d","#95d490","#b7e3b2","#daf1d5"],9:["#3d5439","#43683f","#4f804b","#5b9756","#66af62","#72c66d","#95d490","#b7e3b2","#daf1d5"],10:["#3d5439","#43683f","#4f804b","#5b9756","#66af62","#72c66d","#95d490","#b7e3b2","#daf1d5","#f5fff2"],stops:["#43683f","#5b9756","#72c66d","#b7e3b2","#f5fff2"],tags:["dark","greens","sequential","bright","colorblind-friendly"],name:"Green 9"},"seq-brown-to-tan-bright":{1:["#d69253"],2:["#594439","#fff5e6"],3:["#594439","#d69253","#fff5e6"],4:["#744d30","#af6b2f","#ebc39a","#fff5e6"],5:["#744d30","#af6b2f","#d69253","#ebc39a","#fff5e6"],6:["#594439","#744d30","#af6b2f","#d69253","#ebc39a","#fff5e6"],7:["#744d30","#915c30","#af6b2f","#cc7a2f","#e1ab76","#ebc39a","#fff5e6"],8:["#744d30","#915c30","#af6b2f","#cc7a2f","#d69253","#e1ab76","#ebc39a","#f5dbbd"],9:["#594439","#744d30","#915c30","#af6b2f","#cc7a2f","#d69253","#e1ab76","#ebc39a","#f5dbbd"],10:["#594439","#744d30","#915c30","#af6b2f","#cc7a2f","#d69253","#e1ab76","#ebc39a","#f5dbbd","#fff5e6"],stops:["#744d30","#af6b2f","#d69253","#ebc39a","#fff5e6"],tags:["dark","browns","sequential","bright","colorblind-friendly"],name:"Brown 1"},"seq-lightgray-blue-bright":{1:["#6e8d99"],2:["#325361","#faefdb"],3:["#325361","#6e8d99","#faefdb"],4:["#325361","#2f7589","#bcb4a6","#faefdb"],5:["#325361","#2f7589","#6e8d99","#bcb4a6","#faefdb"],6:["#325361","#316475","#2e859c","#bcb4a6","#dbd2c0","#faefdb"],7:["#325361","#316475","#2e859c","#6e8d99","#bcb4a6","#dbd2c0","#faefdb"],8:["#325361","#316475","#2f7589","#2e859c","#9d978b","#bcb4a6","#dbd2c0","#faefdb"],9:["#325361","#316475","#2f7589","#2e859c","#6e8d99","#9d978b","#bcb4a6","#dbd2c0","#faefdb"],10:["#325361","#316475","#2f7589","#2e859c","#2c96b0","#6e8d99","#9d978b","#bcb4a6","#dbd2c0","#faefdb"],stops:["#325361","#2f7589","#6e8d99","#bcb4a6","#faefdb"],tags:["dark","blues","sequential","grays","colorblind-friendly"],name:"Blue 13"},"seq-lightgray-green-bright":{1:["#6f9988"],2:["#2c593f","#e6f4ff"],3:["#2c593f","#6f9988","#e6f4ff"],4:["#2c593f","#387c55","#aab5c0","#e6f4ff"],5:["#2c593f","#387c55","#6f9988","#aab5c0","#e6f4ff"],6:["#2e6a46","#387c55","#4ba072","#8c96a0","#aab5c0","#e6f4ff"],7:["#2e6a46","#387c55","#418e63","#6f9988","#8c96a0","#aab5c0","#e6f4ff"],8:["#2e6a46","#387c55","#418e63","#4ba072","#8c96a0","#aab5c0","#c8d5df","#e6f4ff"],9:["#2e6a46","#387c55","#418e63","#4ba072","#6f9988","#8c96a0","#aab5c0","#c8d5df","#e6f4ff"],10:["#2c593f","#2e6a46","#387c55","#418e63","#4ba072","#6f9988","#8c96a0","#aab5c0","#c8d5df","#e6f4ff"],stops:["#2c593f","#387c55","#6f9988","#aab5c0","#e6f4ff"],tags:["dark","greens","sequential","grays","colorblind-friendly"],name:"Green 10"},"seq-lightgray-darkmagenta-bright":{1:["#a3829b"],2:["#5c3a5b","#faefdb"],3:["#5c3a5b","#a3829b","#faefdb"],4:["#5c3a5b","#864d84","#bcb4a6","#faefdb"],5:["#5c3a5b","#864d84","#a3829b","#bcb4a6","#faefdb"],6:["#5c3a5b","#71446f","#9b5798","#9d978b","#bcb4a6","#faefdb"],7:["#5c3a5b","#71446f","#9b5798","#a3829b","#9d978b","#bcb4a6","#faefdb"],8:["#5c3a5b","#71446f","#864d84","#9b5798","#9d978b","#bcb4a6","#dbd2c0","#faefdb"],9:["#5c3a5b","#71446f","#864d84","#9b5798","#a3829b","#9d978b","#bcb4a6","#dbd2c0","#faefdb"],10:["#5c3a5b","#71446f","#864d84","#9b5798","#b060ac","#a3829b","#9d978b","#bcb4a6","#dbd2c0","#faefdb"],stops:["#5c3a5b","#864d84","#a3829b","#bcb4a6","#faefdb"],tags:["dark","purples","sequential","grays","colorblind-friendly"],name:"Purple 7"},"seq-yellow-darkblue-bright":{1:["#799a96"],2:["#3a4d6b","#ffec99"],3:["#3a4d6b","#799a96","#ffec99"],4:["#3a4d6b","#3d6da2","#ccbe6a","#ffec99"],5:["#3a4d6b","#3d6da2","#799a96","#ccbe6a","#ffec99"],6:["#3b5d87","#3d6da2","#3e7cbe","#b3a752","#ccbe6a","#ffec99"],7:["#3b5d87","#3d6da2","#3e7cbe","#799a96","#b3a752","#ccbe6a","#ffec99"],8:["#3b5d87","#3d6da2","#3e7cbe","#3f8cd9","#b3a752","#ccbe6a","#e6d581","#ffec99"],9:["#3b5d87","#3d6da2","#3e7cbe","#3f8cd9","#799a96","#b3a752","#ccbe6a","#e6d581","#ffec99"],10:["#3a4d6b","#3b5d87","#3d6da2","#3e7cbe","#3f8cd9","#799a96","#b3a752","#ccbe6a","#e6d581","#ffec99"],stops:["#3a4d6b","#3d6da2","#799a96","#ccbe6a","#ffec99"],tags:["dark","blues","yellows","sequential","colorblind-friendly"],name:"Blue 14"},"seq-lightred-darkgray-bright":{1:["#948889"],2:["#484c59","#ffe9e6"],3:["#484c59","#948889","#ffe9e6"],4:["#484c59","#63687a","#e0b9b5","#ffe9e6"],5:["#484c59","#63687a","#948889","#e0b9b5","#ffe9e6"],6:["#484c59","#63687a","#71768a","#c18983","#f0d1cd","#ffe9e6"],7:["#484c59","#63687a","#71768a","#948889","#d1a19c","#f0d1cd","#ffe9e6"],8:["#484c59","#565a69","#63687a","#71768a","#d1a19c","#e0b9b5","#f0d1cd","#ffe9e6"],9:["#484c59","#565a69","#63687a","#71768a","#c18983","#d1a19c","#e0b9b5","#f0d1cd","#ffe9e6"],10:["#484c59","#565a69","#63687a","#71768a","#948889","#c18983","#d1a19c","#e0b9b5","#f0d1cd","#ffe9e6"],stops:["#484c59","#63687a","#948889","#e0b9b5","#ffe9e6"],tags:["light","pinks","grays","sequential","subdued","colorblind-friendly"],name:"Pink 5"},"seq-lightmagenta-darkgray-bright":{1:["#9e8998"],2:["#4d4d41","#ffe1ff"],3:["#4d4d41","#9e8998","#ffe1ff"],4:["#4d4d41","#77756a","#e8a3e8","#ffe1ff"],5:["#4d4d41","#77756a","#9e8998","#e8a3e8","#ffe1ff"],6:["#4d4d41","#626155","#77756a","#dd83dd","#e8a3e8","#ffe1ff"],7:["#4d4d41","#626155","#77756a","#9e8998","#dd83dd","#e8a3e8","#ffe1ff"],8:["#4d4d41","#626155","#77756a","#8c897e","#dd83dd","#e8a3e8","#f4c2f4","#ffe1ff"],9:["#4d4d41","#626155","#77756a","#8c897e","#9e8998","#dd83dd","#e8a3e8","#f4c2f4","#ffe1ff"],10:["#4d4d41","#626155","#77756a","#8c897e","#9e8998","#d164d1","#dd83dd","#e8a3e8","#f4c2f4","#ffe1ff"],stops:["#4d4d41","#77756a","#9e8998","#e8a3e8","#ffe1ff"],tags:["dark","purples","grays","sequential","bright","colorblind-friendly"],name:"Purple 8"},"seq-lightblue-darkgray-bright":{1:["#7d8e93"],2:["#4c4a44","#d9fcff"],3:["#4c4a44","#7d8e93","#d9fcff"],4:["#4c4a44","#6d6a63","#9cd2dc","#d9fcff"],5:["#4c4a44","#6d6a63","#7d8e93","#9cd2dc","#d9fcff"],6:["#4c4a44","#5c5a53","#6d6a63","#7ebdca","#9cd2dc","#d9fcff"],7:["#4c4a44","#5c5a53","#6d6a63","#7d8e93","#7ebdca","#9cd2dc","#d9fcff"],8:["#4c4a44","#5c5a53","#6d6a63","#7d7a72","#7ebdca","#9cd2dc","#bbe7ed","#d9fcff"],9:["#4c4a44","#5c5a53","#6d6a63","#7d7a72","#7d8e93","#7ebdca","#9cd2dc","#bbe7ed","#d9fcff"],10:["#4c4a44","#5c5a53","#6d6a63","#7d7a72","#7d8e93","#5fa8b8","#7ebdca","#9cd2dc","#bbe7ed","#d9fcff"],stops:["#4c4a44","#6d6a63","#7d8e93","#9cd2dc","#d9fcff"],tags:["dark","blues","sequential","grays","bright","colorblind-friendly"],name:"Blue 15"},"seq-blue-bright-1":{1:["#00ffff"],2:["#007b7b","#00ffff"],3:["#007b7b","#00a4a4","#00ffff"],4:["#005353","#007b7b","#00a4a4","#00ffff"],5:["#005353","#007b7b","#00a4a4","#00cccc","#00ffff"],6:["#005353","#007b7b","#009090","#00a4a4","#00cccc","#00ffff"],7:["#005353","#006767","#007b7b","#009090","#00a4a4","#00cccc","#00ffff"],8:["#003f3f","#005353","#006767","#007b7b","#009090","#00a4a4","#00cccc","#00ffff"],9:["#003f3f","#005353","#006767","#007b7b","#009090","#00a4a4","#00b8b8","#00cccc","#00ffff"],10:["#003f3f","#005353","#006767","#007b7b","#009090","#00a4a4","#00b8b8","#00cccc","#00e0e0","#00ffff"],stops:["#005353","#007b7b","#00a4a4","#00cccc","#00ffff"],tags:["dark","blues","bright","sequential","colorblind-friendly"],name:"Blue 16"},"seq-green-bright-1":{1:["#00ffaa"],2:["#007e4f","#00ffaa"],3:["#007e4f","#00a76a","#00ffaa"],4:["#005435","#007e4f","#00a76a","#00ffaa"],5:["#005435","#007e4f","#00a76a","#00d184","#00ffaa"],6:["#005435","#007e4f","#00935c","#00a76a","#00d184","#00ffaa"],7:["#005435","#006942","#007e4f","#00935c","#00a76a","#00d184","#00ffaa"],8:["#003f28","#005435","#006942","#007e4f","#00935c","#00a76a","#00d184","#00ffaa"],9:["#003f28","#005435","#006942","#007e4f","#00935c","#00a76a","#00bc77","#00d184","#00ffaa"],10:["#003f28","#005435","#006942","#007e4f","#00935c","#00a76a","#00bc77","#00d184","#00e691","#00ffaa"],stops:["#005435","#007e4f","#00a76a","#00d184","#00ffaa"],tags:["dark","greens","bright","sequential","colorblind-friendly"],name:"Green 11"},"seq-green-bright-2":{1:["#00ff00"],2:["#007f00","#00ff00"],3:["#007f00","#00aa00","#00ff00"],4:["#005400","#007f00","#00aa00","#00ff00"],5:["#005400","#007f00","#00aa00","#00d400","#00ff00"],6:["#005400","#007f00","#009400","#00aa00","#00d400","#00ff00"],7:["#005400","#006a00","#007f00","#009400","#00aa00","#00d400","#00ff00"],8:["#003f00","#005400","#006a00","#007f00","#009400","#00aa00","#00d400","#00ff00"],9:["#003f00","#005400","#006a00","#007f00","#009400","#00aa00","#00bf00","#00d400","#00ff00"],10:["#003f00","#005400","#006a00","#007f00","#009400","#00aa00","#00bf00","#00d400","#00ea00","#00ff00"],stops:["#005400","#007f00","#00aa00","#00d400","#00ff00"],tags:["dark","greens","bright","sequential","colorblind-friendly"],name:"Green 12"},"seq-green-bright-3":{1:["#b2ff56"],2:["#537f1d","#b2ff56"],3:["#537f1d","#73aa30","#b2ff56"],4:["#34540a","#537f1d","#73aa30","#b2ff56"],5:["#34540a","#537f1d","#73aa30","#92d443","#b2ff56"],6:["#34540a","#537f1d","#639426","#73aa30","#92d443","#b2ff56"],7:["#34540a","#446a13","#537f1d","#639426","#73aa30","#92d443","#b2ff56"],8:["#243f00","#34540a","#446a13","#537f1d","#639426","#73aa30","#92d443","#b2ff56"],9:["#243f00","#34540a","#446a13","#537f1d","#639426","#73aa30","#83bf39","#92d443","#b2ff56"],10:["#243f00","#34540a","#446a13","#537f1d","#639426","#73aa30","#83bf39","#92d443","#a2ea4c","#b2ff56"],stops:["#34540a","#537f1d","#73aa30","#92d443","#b2ff56"],tags:["dark","greens","bright","sequential","colorblind-friendly"],name:"Green 13"},"seq-blue-bright-2":{1:["#8378ff"],2:["#4c33cc","#8378ff"],3:["#4c33cc","#6040ff","#8378ff"],4:["#392699","#4c33cc","#6040ff","#8378ff"],5:["#392699","#4c33cc","#6040ff","#765cff","#8378ff"],6:["#392699","#4c33cc","#563ae6","#6040ff","#765cff","#8378ff"],7:["#392699","#432db3","#4c33cc","#563ae6","#6040ff","#765cff","#8378ff"],8:["#2f2080","#392699","#432db3","#4c33cc","#563ae6","#6040ff","#765cff","#8378ff"],9:["#2f2080","#392699","#432db3","#4c33cc","#563ae6","#6040ff","#6f4eff","#765cff","#8378ff"],10:["#2f2080","#392699","#432db3","#4c33cc","#563ae6","#6040ff","#6f4eff","#765cff","#7c6aff","#8378ff"],stops:["#392699","#4c33cc","#6040ff","#765cff","#8378ff"],tags:["dark","blues","bright","sequential"],name:"Blue 17"},"seq-blue-bright-3":{1:["#4d91ff"],2:["#3039b7","#4d91ff"],3:["#3039b7","#3948e1","#4d91ff"],4:["#2b2e80","#3039b7","#3948e1","#4d91ff"],5:["#2b2e80","#3039b7","#3948e1","#445bff","#4d91ff"],6:["#2b2e80","#3039b7","#333fd3","#3948e1","#445bff","#4d91ff"],7:["#2b2e80","#2e349b","#3039b7","#333fd3","#3948e1","#445bff","#4d91ff"],8:["#282864","#2b2e80","#2e349b","#3039b7","#333fd3","#3948e1","#445bff","#4d91ff"],9:["#282864","#2b2e80","#2e349b","#3039b7","#333fd3","#3948e1","#3e52f0","#445bff","#4d91ff"],10:["#282864","#2b2e80","#2e349b","#3039b7","#333fd3","#3948e1","#3e52f0","#445bff","#4976ff","#4d91ff"],stops:["#2b2e80","#3039b7","#3948e1","#445bff","#4d91ff"],tags:["dark","blues","bright","sequential"],name:"Blue 18"},"seq-blue-bright-4":{1:["#00b7ff"],2:["#0062a8","#00b7ff"],3:["#0062a8","#007cd3","#00b7ff"],4:["#00497c","#0062a8","#007cd3","#00b7ff"],5:["#00497c","#0062a8","#007cd3","#0095ff","#00b7ff"],6:["#00497c","#0062a8","#006fbd","#007cd3","#0095ff","#00b7ff"],7:["#00497c","#005592","#0062a8","#006fbd","#007cd3","#0095ff","#00b7ff"],8:["#003c66","#00497c","#005592","#0062a8","#006fbd","#007cd3","#0095ff","#00b7ff"],9:["#003c66","#00497c","#005592","#0062a8","#006fbd","#007cd3","#0088e9","#0095ff","#00b7ff"],10:["#003c66","#00497c","#005592","#0062a8","#006fbd","#007cd3","#0088e9","#0095ff","#009cff","#00b7ff"],stops:["#00497c","#0062a8","#007cd3","#0095ff","#00b7ff"],tags:["dark","blues","bright","sequential"],name:"Blue 19"},"seq-blue-bright-5":{1:["#00ddff"],2:["#006a85","#00ddff"],3:["#006a85","#008bae","#00ddff"],4:["#004a5d","#006a85","#008bae","#00ddff"],5:["#004a5d","#006a85","#008bae","#00aed6","#00ddff"],6:["#004a5d","#006a85","#007b9a","#008bae","#00aed6","#00ddff"],7:["#004a5d","#005a71","#006a85","#007b9a","#008bae","#00aed6","#00ddff"],8:["#003a49","#004a5d","#005a71","#006a85","#007b9a","#008bae","#00aed6","#00ddff"],9:["#003a49","#004a5d","#005a71","#006a85","#007b9a","#008bae","#009bc2","#00aed6","#00ddff"],10:["#003a49","#004a5d","#005a71","#006a85","#007b9a","#008bae","#009bc2","#00aed6","#00c6eb","#00ddff"],stops:["#004a5d","#006a85","#008bae","#00aed6","#00ddff"],tags:["dark","blues","bright","sequential","colorblind-friendly"],name:"Blue 20"},"seq-red-purple-bright":{1:["#bf66ff"],2:["#6a27a0","#bf66ff"],3:["#6a27a0","#8531c1","#bf66ff"],4:["#4d267d","#6a27a0","#8531c1","#bf66ff"],5:["#4d267d","#6a27a0","#8531c1","#9f44e0","#bf66ff"],6:["#4d267d","#6a27a0","#7827b1","#8531c1","#9f44e0","#bf66ff"],7:["#4d267d","#5b268e","#6a27a0","#7827b1","#8531c1","#9f44e0","#bf66ff"],8:["#3e256b","#4d267d","#5b268e","#6a27a0","#7827b1","#8531c1","#9f44e0","#bf66ff"],9:["#3e256b","#4d267d","#5b268e","#6a27a0","#7827b1","#8531c1","#923ad0","#9f44e0","#bf66ff"],10:["#3e256b","#4d267d","#5b268e","#6a27a0","#7827b1","#8531c1","#923ad0","#9f44e0","#af55ef","#bf66ff"],stops:["#4d267d","#6a27a0","#8531c1","#9f44e0","#bf66ff"],tags:["dark","purples","bright","sequential","colorblind-friendly"],name:"Purple 9"},"seq-red-magenta-bright":{1:["#ff00ff"],2:["#750580","#ff00ff"],3:["#750580","#9c00aa","#ff00ff"],4:["#4e0f55","#750580","#9c00aa","#ff00ff"],5:["#4e0f55","#750580","#9c00aa","#ca00d4","#ff00ff"],6:["#4e0f55","#750580","#880095","#9c00aa","#ca00d4","#ff00ff"],7:["#4e0f55","#620a6b","#750580","#880095","#9c00aa","#ca00d4","#ff00ff"],8:["#3b1440","#4e0f55","#620a6b","#750580","#880095","#9c00aa","#ca00d4","#ff00ff"],9:["#3b1440","#4e0f55","#620a6b","#750580","#880095","#9c00aa","#af00bf","#ca00d4","#ff00ff"],10:["#3b1440","#4e0f55","#620a6b","#750580","#880095","#9c00aa","#af00bf","#ca00d4","#e400ea","#ff00ff"],stops:["#4e0f55","#750580","#9c00aa","#ca00d4","#ff00ff"],tags:["dark","purples","bright","sequential","colorblind-friendly"],name:"Purple 10"},"seq-red-bright-3":{1:["#ff4a0d"],2:["#83080a","#ff4a0d"],3:["#83080a","#b20000","#ff4a0d"],4:["#531717","#83080a","#b20000","#ff4a0d"],5:["#531717","#83080a","#b20000","#df0000","#ff4a0d"],6:["#531717","#83080a","#9b0103","#b20000","#df0000","#ff4a0d"],7:["#531717","#6b1010","#83080a","#9b0103","#b20000","#df0000","#ff4a0d"],8:["#3b1e1e","#531717","#6b1010","#83080a","#9b0103","#b20000","#df0000","#ff4a0d"],9:["#3b1e1e","#531717","#6b1010","#83080a","#9b0103","#b20000","#c80000","#df0000","#ff4a0d"],10:["#3b1e1e","#531717","#6b1010","#83080a","#9b0103","#b20000","#c80000","#df0000","#ef2607","#ff4a0d"],stops:["#531717","#83080a","#b20000","#df0000","#ff4a0d"],tags:["dark","reds","bright","sequential","colorblind-friendly"],name:"Red 9"},"seq-red-bright-4":{1:["#ffa200"],2:["#914505","#ffa200"],3:["#914505","#c85700","#ffa200"],4:["#582c0e","#914505","#c85700","#ffa200"],5:["#582c0e","#914505","#c85700","#ff6e00","#ffa200"],6:["#582c0e","#914505","#ad5100","#c85700","#ff6e00","#ffa200"],7:["#582c0e","#743909","#914505","#ad5100","#c85700","#ff6e00","#ffa200"],8:["#402315","#582c0e","#743909","#914505","#ad5100","#c85700","#ff6e00","#ffa200"],9:["#402315","#582c0e","#743909","#914505","#ad5100","#c85700","#e46300","#ff6e00","#ffa200"],10:["#402315","#582c0e","#743909","#914505","#ad5100","#c85700","#e46300","#ff6e00","#ff8800","#ffa200"],stops:["#582c0e","#914505","#c85700","#ff6e00","#ffa200"],tags:["dark","browns","oranges","bright","sequential","colorblind-friendly"],name:"Orange 6"},"seq-yellow-bright-1":{1:["#ffc800"],2:["#886200","#ffc800"],3:["#886200","#b78300","#ffc800"],4:["#584100","#886200","#b78300","#ffc800"],5:["#584100","#886200","#b78300","#e7a300","#ffc800"],6:["#584100","#886200","#a07200","#b78300","#e7a300","#ffc800"],7:["#584100","#705100","#886200","#a07200","#b78300","#e7a300","#ffc800"],8:["#403000","#584100","#705100","#886200","#a07200","#b78300","#e7a300","#ffc800"],9:["#403000","#584100","#705100","#886200","#a07200","#b78300","#cf9300","#e7a300","#ffc800"],10:["#403000","#584100","#705100","#886200","#a07200","#b78300","#cf9300","#e7a300","#ffb400","#ffc800"],stops:["#584100","#886200","#b78300","#e7a300","#ffc800"],tags:["dark","browns","oranges","bright","sequential","colorblind-friendly"],name:"Yellow 2"},"seq-yellow-bright-2":{1:["#ffdd00"],2:["#7a6a00","#ffdd00"],3:["#7a6a00","#a79100","#ffdd00"],4:["#4e4400","#7a6a00","#a79100","#ffdd00"],5:["#4e4400","#7a6a00","#a79100","#d3b700","#ffdd00"],6:["#4e4400","#7a6a00","#907d00","#a79100","#d3b700","#ffdd00"],7:["#4e4400","#645700","#7a6a00","#907d00","#a79100","#d3b700","#ffdd00"],8:["#383100","#4e4400","#645700","#7a6a00","#907d00","#a79100","#d3b700","#ffdd00"],9:["#383100","#4e4400","#645700","#7a6a00","#907d00","#a79100","#bda400","#d3b700","#ffdd00"],10:["#383100","#4e4400","#645700","#7a6a00","#907d00","#a79100","#bda400","#d3b700","#e9ca00","#ffdd00"],stops:["#4e4400","#7a6a00","#a79100","#d3b700","#ffdd00"],tags:["dark","yellows","bright","sequential","colorblind-friendly"],name:"Yellow 3"},"seq-yellow-bright-3":{1:["#ffff00"],2:["#757500","#ffff00"],3:["#757500","#a3a300","#ffff00"],4:["#474700","#757500","#a3a300","#ffff00"],5:["#474700","#757500","#a3a300","#d1d100","#ffff00"],6:["#474700","#757500","#8c8c00","#a3a300","#d1d100","#ffff00"],7:["#474700","#5e5e00","#757500","#8c8c00","#a3a300","#d1d100","#ffff00"],8:["#303000","#474700","#5e5e00","#757500","#8c8c00","#a3a300","#d1d100","#ffff00"],9:["#303000","#474700","#5e5e00","#757500","#8c8c00","#a3a300","#baba00","#d1d100","#ffff00"],10:["#303000","#474700","#5e5e00","#757500","#8c8c00","#a3a300","#baba00","#d1d100","#e8e800","#ffff00"],stops:["#474700","#757500","#a3a300","#d1d100","#ffff00"],tags:["dark","yellows","bright","sequential","colorblind-friendly"],name:"Yellow 4"},"seq-yellow-bright-4":{1:["#d0ff00"],2:["#637900","#d0ff00"],3:["#637900","#87a600","#d0ff00"],4:["#3e4c00","#637900","#87a600","#d0ff00"],5:["#3e4c00","#637900","#87a600","#acd200","#d0ff00"],6:["#3e4c00","#637900","#758f00","#87a600","#acd200","#d0ff00"],7:["#3e4c00","#506300","#637900","#758f00","#87a600","#acd200","#d0ff00"],8:["#2c3600","#3e4c00","#506300","#637900","#758f00","#87a600","#acd200","#d0ff00"],9:["#2c3600","#3e4c00","#506300","#637900","#758f00","#87a600","#99bc00","#acd200","#d0ff00"],10:["#2c3600","#3e4c00","#506300","#637900","#758f00","#87a600","#99bc00","#acd200","#bee900","#d0ff00"],stops:["#3e4c00","#637900","#87a600","#acd200","#d0ff00"],tags:["dark","greens","bright","sequential","colorblind-friendly"],name:"Green 14"},"seq-yellow-gray-bright":{1:["#ffff00"],2:["#68655d","#ffff00"],3:["#68655d","#959258","#ffff00"],4:["#45423b","#68655d","#959258","#ffff00"],5:["#45423b","#68655d","#959258","#cac92c","#ffff00"],6:["#45423b","#68655d","#7a776e","#959258","#cac92c","#ffff00"],7:["#45423b","#57544c","#68655d","#7a776e","#959258","#cac92c","#ffff00"],8:["#33312a","#45423b","#57544c","#68655d","#7a776e","#959258","#cac92c","#ffff00"],9:["#33312a","#45423b","#57544c","#68655d","#7a776e","#959258","#afad42","#cac92c","#ffff00"],10:["#33312a","#45423b","#57544c","#68655d","#7a776e","#959258","#afad42","#cac92c","#e4e416","#ffff00"],stops:["#45423b","#68655d","#959258","#cac92c","#ffff00"],tags:["dark","yellows","grays","bright","sequential","colorblind-friendly"],name:"Yellow 5"},"seq-green-gray-bright":{1:["#aaff00"],2:["#5b695b","#aaff00"],3:["#5b695b","#789753","#aaff00"],4:["#3b453b","#5b695b","#789753","#aaff00"],5:["#3b453b","#5b695b","#789753","#91cc26","#aaff00"],6:["#3b453b","#5b695b","#6b7b6b","#789753","#91cc26","#aaff00"],7:["#3b453b","#4b574b","#5b695b","#6b7b6b","#789753","#91cc26","#aaff00"],8:["#2b332b","#3b453b","#4b574b","#5b695b","#6b7b6b","#789753","#91cc26","#aaff00"],9:["#2b332b","#3b453b","#4b574b","#5b695b","#6b7b6b","#789753","#84b33a","#91cc26","#aaff00"],10:["#2b332b","#3b453b","#4b574b","#5b695b","#6b7b6b","#789753","#84b33a","#91cc26","#9de613","#aaff00"],stops:["#3b453b","#5b695b","#789753","#91cc26","#aaff00"],tags:["dark","greens","grays","bright","sequential","colorblind-friendly"],name:"Green 15"},"seq-blue-gray-bright":{1:["#00ffff"],2:["#455873","#00ffff"],3:["#455873","#3f83a1","#00ffff"],4:["#2f3f56","#455873","#3f83a1","#00ffff"],5:["#2f3f56","#455873","#3f83a1","#1ec1d5","#00ffff"],6:["#2f3f56","#455873","#506482","#3f83a1","#1ec1d5","#00ffff"],7:["#2f3f56","#3a4b65","#455873","#506482","#3f83a1","#1ec1d5","#00ffff"],8:["#243247","#2f3f56","#3a4b65","#455873","#506482","#3f83a1","#1ec1d5","#00ffff"],9:["#243247","#2f3f56","#3a4b65","#455873","#506482","#3f83a1","#2da2c0","#1ec1d5","#00ffff"],10:["#243247","#2f3f56","#3a4b65","#455873","#506482","#3f83a1","#2da2c0","#1ec1d5","#0fe0ea","#00ffff"],stops:["#2f3f56","#455873","#3f83a1","#1ec1d5","#00ffff"],tags:["dark","blues","grays","bright","sequential","colorblind-friendly"],name:"Blue 21"},"seq-red-gray-bright":{1:["#ff80ff"],2:["#54504c","#ff80ff"],3:["#54504c","#ab3da9","#ff80ff"],4:["#3b3734","#54504c","#ab3da9","#ff80ff"],5:["#3b3734","#54504c","#ab3da9","#eb44e8","#ff80ff"],6:["#3b3734","#54504c","#6b506b","#ab3da9","#eb44e8","#ff80ff"],7:["#3b3734","#474440","#54504c","#6b506b","#ab3da9","#eb44e8","#ff80ff"],8:["#2e2b28","#3b3734","#474440","#54504c","#6b506b","#ab3da9","#eb44e8","#ff80ff"],9:["#2e2b28","#3b3734","#474440","#54504c","#6b506b","#ab3da9","#de25da","#eb44e8","#ff80ff"],10:["#2e2b28","#3b3734","#474440","#54504c","#6b506b","#ab3da9","#de25da","#eb44e8","#f261f1","#ff80ff"],stops:["#3b3734","#54504c","#ab3da9","#eb44e8","#ff80ff"],tags:["dark","pinks","purples","grays","bright","sequential","colorblind-friendly"],name:"Pink 6"},"seq-gray-redbright":{1:["#d4d1ce"],2:["#892520","#d4d1ce"],3:["#892520","#8c6e62","#d4d1ce"],4:["#680000","#892520","#8c6e62","#d4d1ce"],5:["#680000","#892520","#8c6e62","#ada297","#d4d1ce"],6:["#680000","#892520","#8e493f","#8c6e62","#ada297","#d4d1ce"],7:["#680000","#830000","#892520","#8e493f","#8c6e62","#ada297","#d4d1ce"],8:["#4d0000","#680000","#830000","#892520","#8e493f","#8c6e62","#ada297","#d4d1ce"],9:["#4d0000","#680000","#830000","#892520","#8e493f","#8c6e62","#998b7c","#ada297","#d4d1ce"],10:["#4d0000","#680000","#830000","#892520","#8e493f","#8c6e62","#998b7c","#ada297","#c0bab3","#d4d1ce"],stops:["#680000","#892520","#8c6e62","#ada297","#d4d1ce"],tags:["dark","reds","grays","sequential","colorblind-friendly"],name:"Red 10"},"seq-gray-green-bright":{1:["#c8d7c8"],2:["#217c31","#c8d7c8"],3:["#217c31","#68876c","#c8d7c8"],4:["#00590f","#217c31","#68876c","#c8d7c8"],5:["#00590f","#217c31","#68876c","#9baa9b","#c8d7c8"],6:["#00590f","#217c31","#42864d","#68876c","#9baa9b","#c8d7c8"],7:["#00590f","#007215","#217c31","#42864d","#68876c","#9baa9b","#c8d7c8"],8:["#003f0a","#00590f","#007215","#217c31","#42864d","#68876c","#9baa9b","#c8d7c8"],9:["#003f0a","#00590f","#007215","#217c31","#42864d","#68876c","#849384","#9baa9b","#c8d7c8"],10:["#003f0a","#00590f","#007215","#217c31","#42864d","#68876c","#849384","#9baa9b","#b1c0b1","#c8d7c8"],stops:["#00590f","#217c31","#68876c","#9baa9b","#c8d7c8"],tags:["dark","greens","grays","sequential","colorblind-friendly"],name:"Green 16"},"seq-gray-blue-bright":{1:["#b0c4d8"],2:["#1d3bef","#b0c4d8"],3:["#1d3bef","#5b6da6","#b0c4d8"],4:["#0010d9","#1d3bef","#5b6da6","#b0c4d8"],5:["#0010d9","#1d3bef","#5b6da6","#8d9fb7","#b0c4d8"],6:["#0010d9","#1d3bef","#3956df","#5b6da6","#8d9fb7","#b0c4d8"],7:["#0010d9","#0020ff","#1d3bef","#3956df","#5b6da6","#8d9fb7","#b0c4d8"],8:["#0000b3","#0010d9","#0020ff","#1d3bef","#3956df","#5b6da6","#8d9fb7","#b0c4d8"],9:["#0000b3","#0010d9","#0020ff","#1d3bef","#3956df","#5b6da6","#7c8ca6","#8d9fb7","#b0c4d8"],10:["#0000b3","#0010d9","#0020ff","#1d3bef","#3956df","#5b6da6","#7c8ca6","#8d9fb7","#9fb1c7","#b0c4d8"],stops:["#0010d9","#1d3bef","#5b6da6","#8d9fb7","#b0c4d8"],tags:["dark","blues","grays","bright","sequential","colorblind-friendly"],name:"Blue 22"},"seq-gray-purple-bright":{1:["#c4bedc"],2:["#6535a6","#c4bedc"],3:["#6535a6","#7d6aa1","#c4bedc"],4:["#481295","#6535a6","#7d6aa1","#c4bedc"],5:["#481295","#6535a6","#7d6aa1","#9e97b8","#c4bedc"],6:["#481295","#6535a6","#7346af","#7d6aa1","#9e97b8","#c4bedc"],7:["#481295","#57239e","#6535a6","#7346af","#7d6aa1","#9e97b8","#c4bedc"],8:["#3a008c","#481295","#57239e","#6535a6","#7346af","#7d6aa1","#9e97b8","#c4bedc"],9:["#3a008c","#481295","#57239e","#6535a6","#7346af","#7d6aa1","#8b83a6","#9e97b8","#c4bedc"],10:["#3a008c","#481295","#57239e","#6535a6","#7346af","#7d6aa1","#8b83a6","#9e97b8","#b1aaca","#c4bedc"],stops:["#481295","#6535a6","#7d6aa1","#9e97b8","#c4bedc"],tags:["dark","purples","grays","sequential","colorblind-friendly"],name:"Purple 11"},"seq-plaingray-bright":{1:["#f7f7f7"],2:["#686868","#f7f7f7"],3:["#686868","#8c8c8c","#f7f7f7"],4:["#454545","#686868","#8c8c8c","#f7f7f7"],5:["#454545","#686868","#8c8c8c","#c2c2c2","#f7f7f7"],6:["#454545","#686868","#7a7a7a","#8c8c8c","#c2c2c2","#f7f7f7"],7:["#454545","#575757","#686868","#7a7a7a","#8c8c8c","#c2c2c2","#f7f7f7"],8:["#333333","#454545","#575757","#686868","#7a7a7a","#8c8c8c","#c2c2c2","#f7f7f7"],9:["#333333","#454545","#575757","#686868","#7a7a7a","#8c8c8c","#a7a7a7","#c2c2c2","#f7f7f7"],10:["#333333","#454545","#575757","#686868","#7a7a7a","#8c8c8c","#a7a7a7","#c2c2c2","#dcdcdc","#f7f7f7"],stops:["#454545","#686868","#8c8c8c","#c2c2c2","#f7f7f7"],tags:["dark","grays","sequential","colorblind-friendly"],name:"Gray 2"},"seq-greengray-bright":{1:["#f2f7f5"],2:["#5c6864","#f2f7f5"],3:["#5c6864","#7e8c87","#f2f7f5"],4:["#3a4541","#5c6864","#7e8c87","#f2f7f5"],5:["#3a4541","#5c6864","#7e8c87","#b8c2be","#f2f7f5"],6:["#3a4541","#5c6864","#6d7a75","#7e8c87","#b8c2be","#f2f7f5"],7:["#3a4541","#4b5752","#5c6864","#6d7a75","#7e8c87","#b8c2be","#f2f7f5"],8:["#29332f","#3a4541","#4b5752","#5c6864","#6d7a75","#7e8c87","#b8c2be","#f2f7f5"],9:["#29332f","#3a4541","#4b5752","#5c6864","#6d7a75","#7e8c87","#9ba7a3","#b8c2be","#f2f7f5"],10:["#29332f","#3a4541","#4b5752","#5c6864","#6d7a75","#7e8c87","#9ba7a3","#b8c2be","#d5dcda","#f2f7f5"],stops:["#3a4541","#5c6864","#7e8c87","#b8c2be","#f2f7f5"],tags:["dark","grays","sequential","colorblind-friendly"],name:"Gray 3"},"seq-coolgray-bright":{1:["#f0f4f7"],2:["#566068","#f0f4f7"],3:["#566068","#78838c","#f0f4f7"],4:["#353d45","#566068","#78838c","#f0f4f7"],5:["#353d45","#566068","#78838c","#b4bcc2","#f0f4f7"],6:["#353d45","#566068","#67727a","#78838c","#b4bcc2","#f0f4f7"],7:["#353d45","#464f57","#566068","#67727a","#78838c","#b4bcc2","#f0f4f7"],8:["#242c33","#353d45","#464f57","#566068","#67727a","#78838c","#b4bcc2","#f0f4f7"],9:["#242c33","#353d45","#464f57","#566068","#67727a","#78838c","#969fa7","#b4bcc2","#f0f4f7"],10:["#242c33","#353d45","#464f57","#566068","#67727a","#78838c","#969fa7","#b4bcc2","#d2d8dc","#f0f4f7"],stops:["#353d45","#566068","#78838c","#b4bcc2","#f0f4f7"],tags:["dark","grays","sequential","colorblind-friendly"],name:"Gray 4"},"seq-warmgray-bright":{1:["#f7f5f7"],2:["#686268","#f7f5f7"],3:["#686268","#8c858c","#f7f5f7"],4:["#453f45","#686268","#8c858c","#f7f5f7"],5:["#453f45","#686268","#8c858c","#c8c2c8","#f7f5f7"],6:["#453f45","#686268","#7a737a","#8c858c","#c8c2c8","#f7f5f7"],7:["#453f45","#575057","#686268","#7a737a","#8c858c","#c8c2c8","#f7f5f7"],8:["#332d33","#453f45","#575057","#686268","#7a737a","#8c858c","#c8c2c8","#f7f5f7"],9:["#332d33","#453f45","#575057","#686268","#7a737a","#8c858c","#b1aab1","#c8c2c8","#f7f5f7"],10:["#332d33","#453f45","#575057","#686268","#7a737a","#8c858c","#b1aab1","#c8c2c8","#e0dce0","#f7f5f7"],stops:["#453f45","#686268","#8c858c","#c8c2c8","#f7f5f7"],tags:["dark","grays","sequential","colorblind-friendly"],name:"Gray 5"},"seq-yellow-green-combo-bright":{1:["#d0ff00"],2:["#008c1a","#d0ff00"],3:["#008c1a","#00bf25","#d0ff00"],4:["#00590f","#008c1a","#00bf25","#d0ff00"],5:["#00590f","#008c1a","#00bf25","#76df13","#d0ff00"],6:["#00590f","#008c1a","#00a520","#00bf25","#76df13","#d0ff00"],7:["#00590f","#007215","#008c1a","#00a520","#00bf25","#76df13","#d0ff00"],8:["#003f0a","#00590f","#007215","#008c1a","#00a520","#00bf25","#76df13","#d0ff00"],9:["#003f0a","#00590f","#007215","#008c1a","#00a520","#00bf25","#49cf1c","#76df13","#d0ff00"],10:["#003f0a","#00590f","#007215","#008c1a","#00a520","#00bf25","#49cf1c","#76df13","#a3ef09","#d0ff00"],stops:["#00590f","#008c1a","#00bf25","#76df13","#d0ff00"],tags:["dark","greens","bright","sequential","colorblind-friendly"],name:"Green 17"},"seq-cyan-blue-combo-bright":{1:["#00ffff"],2:["#0040ff","#00ffff"],3:["#0040ff","#0080ff","#00ffff"],4:["#0010d9","#0040ff","#0080ff","#00ffff"],5:["#0010d9","#0040ff","#0080ff","#00bfff","#00ffff"],6:["#0010d9","#0040ff","#0060ff","#0080ff","#00bfff","#00ffff"],7:["#0010d9","#0020ff","#0040ff","#0060ff","#0080ff","#00bfff","#00ffff"],8:["#0000b3","#0010d9","#0020ff","#0040ff","#0060ff","#0080ff","#00bfff","#00ffff"],9:["#0000b3","#0010d9","#0020ff","#0040ff","#0060ff","#0080ff","#009fff","#00bfff","#00ffff"],10:["#0000b3","#0010d9","#0020ff","#0040ff","#0060ff","#0080ff","#009fff","#00bfff","#00dfff","#00ffff"],stops:["#0010d9","#0040ff","#0080ff","#00bfff","#00ffff"],tags:["dark","blues","bright","sequential","colorblind-friendly"],name:"Blue 23"},"seq-magenta-purple-combo-bright":{1:["#e566ff"],2:["#690cc2","#e566ff"],3:["#690cc2","#8f14f7","#e566ff"],4:["#43048d","#690cc2","#8f14f7","#e566ff"],5:["#43048d","#690cc2","#8f14f7","#b63df4","#e566ff"],6:["#43048d","#690cc2","#7c10dd","#8f14f7","#b63df4","#e566ff"],7:["#43048d","#5608a8","#690cc2","#7c10dd","#8f14f7","#b63df4","#e566ff"],8:["#300073","#43048d","#5608a8","#690cc2","#7c10dd","#8f14f7","#b63df4","#e566ff"],9:["#300073","#43048d","#5608a8","#690cc2","#7c10dd","#8f14f7","#9f29ee","#b63df4","#e566ff"],10:["#300073","#43048d","#5608a8","#690cc2","#7c10dd","#8f14f7","#9f29ee","#b63df4","#ce52f9","#e566ff"],stops:["#43048d","#690cc2","#8f14f7","#b63df4","#e566ff"],tags:["dark","purples","bright","sequential","colorblind-friendly"],name:"Purple 13"},"seq-magenta":{stops:["#4D394D","#6C2F68","#901F8A","#C700BB","#FF33F3"],tags:["dark","pinks","sequential","colorblind-friendly"],name:"Magenta 1"},"seq-red":{stops:["#452D31","#6C2F39","#901F32","#C70021","#FF3355"],tags:["dark","reds","sequential","colorblind-friendly"],name:"Red 11"},"seq-orange":{stops:["#4D4139","#6F4222","#91430B","#B84D00","#FF6900"],tags:["dark","oranges","sequential","colorblind-friendly"],name:"Orange 7"},"seq-yellow":{stops:["#453F1C","#665B1F","#887922","#B39E27","#F9D70E"],tags:["dark","yellows","sequential","colorblind-friendly"],name:"Yellow 6"},"seq-yellowgreen":{stops:["#37451C","#4B5E1D","#6B8822","#8EB327","#A8E000"],tags:["dark","greens","sequential","colorblind-friendly"],name:"Green 18"},"seq-green":{stops:["#234028","#23642E","#228833","#27B33E","#2DE64B"],tags:["dark","greens","sequential","colorblind-friendly"],name:"Green 19"},"seq-turquoise":{stops:["#1C4542","#1C5955","#218279","#29BAAD","#00FFEA"],tags:["dark","blues","sequential","colorblind-friendly"],name:"Turquoise 1"},"seq-royal":{stops:["#1F3D4D","#204F66","#226687","#298ABA","#33BBFF"],tags:["dark","blues","sequential","colorblind-friendly"],name:"Royal Blue 1"},"seq-blueberry":{stops:["#3D3D66","#5E5EAA","#6C6CB8","#8888D5","#A5A5F1"],tags:["dark","purples","sequential","colorblind-friendly"],name:"Purple 14"},"seq-purple":{stops:["#453A59","#5A4089","#6E46B9","#8050DC","#9259FF"],tags:["dark","purples","sequential","colorblind-friendly"],name:"Purple 15"},"seq-brown":{stops:["#40312D","#6D5048","#996F63","#CCA391","#FFD7BE"],tags:["dark","browns","sequential","colorblind-friendly"],name:"Brown 2"},"seq-blue":{stops:["#273859","#4A5D83","#6D81AC","#8FA5D6","#B2CAFF"],tags:["dark","blues","sequential","colorblind-friendly"],name:"Blue 24"},"seq-red-darkblue":{stops:["#3a454d","#435955","#645b4b","#964c2f","#cc3d3d"],tags:["dark","reds","sequential","3d","colorblind-friendly"],name:"Red 12"},"seq-purple-darkgreen":{stops:["#403f19","#594411","#804141","#a63a8b","#992fe6"],tags:["dark","purples","sequential","3d","colorblind-friendly"],name:"Purple 16"},"seq-blue-darkgreen":{stops:["#403c26","#57591f","#4b7345","#387c8c","#3c98f2"],tags:["dark","blues","sequential","3d","colorblind-friendly"],name:"Blue 25"},"seq-green-darkpurple":{stops:["#4d434d","#665347","#807119","#4d9900","#00c484"],tags:["dark","greens","sequential","3d","colorblind-friendly"],name:"Green 20"},"seq-blue-gray":{stops:["#494d49","#606644","#7d802d","#77a66e","#51c8e6"],tags:["dark","greens","blues","sequential","3d","colorblind-friendly"],name:"Blue 26"},"seq-magenta-light":{stops:["#D9CFD9","#C6A3C4","#B377B0","#9F4C9B","#85007D"],tags:["light","pinks","sequential","colorblind-friendly"],name:"Magenta 2"},"seq-red-light":{stops:["#D9CACA","#D09898","#C66565","#BD3333","#A60000"],tags:["light","reds","sequential","colorblind-friendly"],name:"Red 13"},"seq-orange-light":{stops:["#D9D0C3","#D6BA92","#D3A462","#CF8E31","#BF7000"],tags:["light","oranges","browns","sequential","colorblind-friendly"],name:"Orange 8"},"seq-mustard-light":{stops:["#D9D8C3","#CCC992","#C0BB62","#969131","#807900"],tags:["light","yellows","sequential","colorblind-friendly"],name:"Mustard"},"seq-yellowgreen-light":{stops:["#D5D9C3","#bac392","#a0ac62","#859631","#6a8000"],tags:["light","greens","sequential","colorblind-friendly"],name:"Green 21"},"seq-green-light":{stops:["#C3D9C7","#92C99C","#62B970","#31A945","#008C17"],tags:["light","greens","sequential","colorblind-friendly"],name:"Green 22"},"seq-aqua-light":{stops:["#C3D9D7","#8FD3CD","#5BCDC3","#26C2B5","#00A698"],tags:["light","greens","sequential","colorblind-friendly"],name:"Green 23"},"seq-cyan-light":{stops:["#CAD2D9","#98C9E3","#6DC2EC","#45B0E6","#0099E6"],tags:["light","blues","sequential","colorblind-friendly"],name:"Royal Blue 2"},"seq-blue-light":{stops:["#CACCD9","#A8B1E3","#8595EC","#6076ED","#405FFF"],tags:["light","purples","blues","sequential","colorblind-friendly"],name:"Blue 27"},"seq-purple-light":{stops:["#CAC3D9","#B1A1D3","#997FCC","#805CC5","#673ABF"],tags:["light","purples","sequential","colorblind-friendly"],name:"Purple 17"},"seq-brown-light":{stops:["#D9C8C3","#C0A69E","#A68479","#8D6153","#733F2E"],tags:["light","browns","sequential","colorblind-friendly"],name:"Brown 3"},"seq-steel-light":{stops:["#C3CAD9","#a9b3c9","#8898c0","#6d7fad","#505e85"],tags:["light","blues","sequential","colorblind-friendly"],name:"Blue 28"},"seq-brown-palegreen":{stops:["#cceedc","#95baa4","#857c4f","#995d08","#8c1515"],tags:["light","greens","browns","sequential","3d","colorblind-friendly"],name:"Green and Brown 2"},"seq-purple-pink-yellow":{stops:["#fff966","#ebb42f","#bf6060","#8c256a","#6f158c"],tags:["light","yellows","purples","sequential","3d","colorblind-friendly"],name:"Purple and Yellow 5"},"seq-blue-green-yellow":{stops:["#ffee99","#d4d94c","#77b46c","#3d8799","#2b57d9"],tags:["light","yellows","blues","greens","sequential","3d","colorblind-friendly"],name:"Blue and Yellow 12"},"seq-green-avocado-lightpurple":{stops:["#ffd9ff","#d1aa9d","#8c8746","#4e8043","#006655"],tags:["light","purples","greens","sequential","3d","colorblind-friendly"],name:"Purple and Green 12"},"seq-turquoise-lightgreen":{stops:["#dae6c8","#c2d182","#97ba66","#5c997c","#2c8499"],tags:["light","blues","greens","sequential","3d","colorblind-friendly"],name:"Green and Blue 10"},"seq-red-brown-white":{stops:["#ffffff","#e6d889","#c0974c","#99550f","#8c1515"],tags:["light","reds","sequential","3d","colorblind-friendly"],name:"Red 13"},"seq-purple-pink-white":{stops:["#ffffff","#e6d889","#b97f7a","#8c256a","#6f158c"],tags:["light","purples","sequential","3d","colorblind-friendly"],name:"Purple 18"},"seq-blue-green-white":{stops:["#ffffff","#dee689","#81a683","#3d8799","#2b57d9"],tags:["light","greens","blues","sequential","3d","colorblind-friendly"],name:"Green and Blue 11"},"seq-green-avocado-white":{stops:["#ffffff","#d9b098","#90b445","#428200","#006e5c"],tags:["light","greens","sequential","3d","colorblind-friendly"],name:"Green 24"},"seq-turquoise-lightgreen-white":{stops:["#ffffff","#d2e096","#c7cc47","#78a66f","#308fa6"],tags:["light","greens","blues","sequential","3d","colorblind-friendly"],name:"Green 25"},"seq-subdued-red-yellow":{1:["#eecb9a"],2:["#c06677","#eecb9a"],3:["#c06677","#e09d85","#eecb9a"],4:["#c06677","#e09d85","#e7b48f","#eecb9a"],5:["#c06677","#d9867a","#e09d85","#e7b48f","#eecb9a"],6:["#c06677","#d9867a","#e09d85","#e7b48f","#eecb9a","#faebc8"],7:["#c06677","#cc7678","#d9867a","#e09d85","#e7b48f","#eecb9a","#faebc8"],8:["#c06677","#cc7678","#d9867a","#e09d85","#e7b48f","#eecb9a","#f2d6a9","#faebc8"],9:["#b35675","#c06677","#cc7678","#d9867a","#e09d85","#e7b48f","#eecb9a","#f2d6a9","#faebc8"],10:["#b35675","#c06677","#cc7678","#d9867a","#e09d85","#e7b48f","#eecb9a","#f2d6a9","#f6e0b9","#faebc8"],stops:["#c06677","#d9867a","#e09d85","#e7b48f","#eecb9a"],tags:["light","reds","yellows","subdued","sequential","colorblind-friendly"],name:"Sunburned Skies"},"seq-subdued-purple-blue":{1:["#a586c2"],2:["#a586c2","#afd1e9"],3:["#9972b0","#b299d4","#afd1e9"],4:["#9972b0","#b299d4","#afd1e9","#d2e5f2"],5:["#9972b0","#b299d4","#b0bee2","#afd1e9","#d2e5f2"],6:["#9972b0","#b299d4","#b1acdb","#b0bee2","#afd1e9","#d2e5f2"],7:["#9972b0","#a586c2","#b299d4","#b1acdb","#b0bee2","#afd1e9","#d2e5f2"],8:["#9972b0","#a586c2","#b299d4","#b1acdb","#b0bee2","#afd1e9","#c0dbee","#d2e5f2"],9:["#8c5f9e","#9972b0","#a586c2","#b299d4","#b1acdb","#b0bee2","#afd1e9","#c0dbee","#d2e5f2"],10:["#8c5f9e","#9972b0","#a586c2","#b299d4","#b1acdb","#b0bee2","#afd1e9","#c0dbee","#d2e5f2","#e3eff7"],stops:["#9972b0","#b299d4","#b0bee2","#afd1e9","#d2e5f2"],tags:["light","blues","purples","subdued","sequential","colorblind-friendly"],name:"Winter Solstice"},"seq-subdued-blue-cyan":{1:["#8ac3d3"],2:["#6780b0","#8ac3d3"],3:["#6780b0","#8ac3d3","#afd8e0"],4:["#5870a0","#768fbf","#8ac3d3","#afd8e0"],5:["#5870a0","#768fbf","#8ac3d3","#afd8e0","#d4eded"],6:["#5870a0","#768fbf","#80a9c9","#8ac3d3","#afd8e0","#d4eded"],7:["#5870a0","#768fbf","#80a9c9","#8ac3d3","#9dcdda","#afd8e0","#d4eded"],8:["#5870a0","#6780b0","#768fbf","#80a9c9","#8ac3d3","#9dcdda","#afd8e0","#d4eded"],9:["#5870a0","#6780b0","#768fbf","#80a9c9","#8ac3d3","#9dcdda","#afd8e0","#c2e3e7","#d4eded"],10:["#496191","#5870a0","#6780b0","#768fbf","#80a9c9","#8ac3d3","#9dcdda","#afd8e0","#c2e3e7","#d4eded"],stops:["#5870a0","#768fbf","#8ac3d3","#afd8e0","#d4eded"],tags:["light","blues","subdued","sequential","colorblind-friendly"],name:"Silky Sapphire"},"seq-subdued-green-yellow":{1:["#d0c8a0"],2:["#78835f","#d0c8a0"],3:["#78835f","#d0c8a0","#f7e9cc"],4:["#78835f","#a5b386","#d0c8a0","#f7e9cc"],5:["#78835f","#a5b386","#d0c8a0","#eedebd","#f7e9cc"],6:["#78835f","#a5b386","#d0c8a0","#e6d2ad","#eedebd","#f7e9cc"],7:["#78835f","#a5b386","#bbbd93","#d0c8a0","#e6d2ad","#eedebd","#f7e9cc"],8:["#78835f","#8e9b72","#a5b386","#bbbd93","#d0c8a0","#e6d2ad","#eedebd","#f7e9cc"],9:["#78835f","#8e9b72","#a5b386","#bbbd93","#d0c8a0","#e6d2ad","#eedebd","#f7e9cc","#fff5dc"],10:["#616b4b","#78835f","#8e9b72","#a5b386","#bbbd93","#d0c8a0","#e6d2ad","#eedebd","#f7e9cc","#fff5dc"],stops:["#78835f","#a5b386","#d0c8a0","#eedebd","#f7e9cc"],tags:["light","greens","subdued","sequential","colorblind-friendly"],name:"Sansevieria"},"seq-subdued-green":{1:["#99c5b6"],2:["#99c5b6","#e3f1d2"],3:["#4d8c8c","#99c5b6","#e3f1d2"],4:["#4d8c8c","#99c5b6","#cbe0b2","#e3f1d2"],5:["#4d8c8c","#6fa9aa","#99c5b6","#cbe0b2","#e3f1d2"],6:["#4d8c8c","#6fa9aa","#99c5b6","#b2d2b4","#cbe0b2","#e3f1d2"],7:["#4d8c8c","#6fa9aa","#80b7b8","#99c5b6","#b2d2b4","#cbe0b2","#e3f1d2"],8:["#4d8c8c","#6fa9aa","#80b7b8","#99c5b6","#b2d2b4","#cbe0b2","#d7e9c2","#e3f1d2"],9:["#4d8c8c","#5e9a9b","#6fa9aa","#80b7b8","#99c5b6","#b2d2b4","#cbe0b2","#d7e9c2","#e3f1d2"],10:["#4d8c8c","#5e9a9b","#6fa9aa","#80b7b8","#99c5b6","#b2d2b4","#cbe0b2","#d7e9c2","#e3f1d2","#effae2"],stops:["#4d8c8c","#6fa9aa","#99c5b6","#cbe0b2","#e3f1d2"],tags:["light","greens","subdued","sequential","colorblind-friendly"],name:"Garden Grass"},"seq-subdued-brown-tan":{1:["#91595c"],2:["#e8c29c","#91595c"],3:["#e8c29c","#b78165","#91595c"],4:["#e8c29c","#b78165","#a6695c","#91595c"],5:["#e8c29c","#c79a6d","#b78165","#a6695c","#91595c"],6:["#e8c29c","#c79a6d","#b78165","#a6695c","#91595c","#664755"],7:["#e8c29c","#d8ae84","#c79a6d","#b78165","#a6695c","#91595c","#664755"],8:["#e8c29c","#d8ae84","#c79a6d","#b78165","#a6695c","#91595c","#7f5158","#664755"],9:["#f9d6b3","#e8c29c","#d8ae84","#c79a6d","#b78165","#a6695c","#91595c","#7f5158","#664755"],10:["#f9d6b3","#e8c29c","#d8ae84","#c79a6d","#b78165","#a6695c","#91595c","#7f5158","#734c56","#664755"],stops:["#e8c29c","#c79a6d","#b78165","#a6695c","#91595c"],tags:["dark","browns","subdued","sequential","colorblind-friendly"],name:"Golden Glory"},"seq-subdued-gray-green":{1:["#4a6989"],2:["#9fd5d0","#4a6989"],3:["#9fd5d0","#619aa1","#4a6989"],4:["#9fd5d0","#619aa1","#568295","#4a6989"],5:["#9fd5d0","#6db3ad","#619aa1","#568295","#4a6989"],6:["#9fd5d0","#6db3ad","#619aa1","#568295","#4a6989","#454f59"],7:["#9fd5d0","#86c4bf","#6db3ad","#619aa1","#568295","#4a6989","#454f59"],8:["#9fd5d0","#86c4bf","#6db3ad","#619aa1","#568295","#4a6989","#496179","#454f59"],9:["#b8e6e2","#9fd5d0","#86c4bf","#6db3ad","#619aa1","#568295","#4a6989","#496179","#454f59"],10:["#b8e6e2","#9fd5d0","#86c4bf","#6db3ad","#619aa1","#568295","#4a6989","#496179","#475869","#454f59"],stops:["#9fd5d0","#6db3ad","#619aa1","#568295","#4a6989"],tags:["dark","greens","grays","subdued","sequential","colorblind-friendly"],name:"Morning Dew"},"seq-subdued-green-tan":{1:["#546d3f"],2:["#c2c5a1","#546d3f"],3:["#c2c5a1","#7f8c62","#546d3f"],4:["#c2c5a1","#7f8c62","#6a7d50","#546d3f"],5:["#c2c5a1","#959c73","#7f8c62","#6a7d50","#546d3f"],6:["#c2c5a1","#959c73","#7f8c62","#6a7d50","#546d3f","#325438"],7:["#c2c5a1","#acb08a","#959c73","#7f8c62","#6a7d50","#546d3f","#325438"],8:["#c2c5a1","#acb08a","#959c73","#7f8c62","#6a7d50","#546d3f","#446639","#325438"],9:["#d9d9b8","#c2c5a1","#acb08a","#959c73","#7f8c62","#6a7d50","#546d3f","#446639","#325438"],10:["#d9d9b8","#c2c5a1","#acb08a","#959c73","#7f8c62","#6a7d50","#546d3f","#446639","#346033","#325438"],stops:["#c2c5a1","#959c73","#7f8c62","#6a7d50","#546d3f"],tags:["dark","greens","subdued","sequential","colorblind-friendly"],name:"Alligator Armor"},"seq-subdued-blue-purple":{1:["#726299"],2:["#a0c8dd","#726299"],3:["#a0c8dd","#7e8daa","#726299"],4:["#a0c8dd","#7e8daa","#7878a2","#726299"],5:["#a0c8dd","#84a3b3","#7e8daa","#7878a2","#726299"],6:["#a0c8dd","#84a3b3","#7e8daa","#7878a2","#726299","#524573"],7:["#a0c8dd","#92b6c8","#84a3b3","#7e8daa","#7878a2","#726299","#524573"],8:["#a0c8dd","#92b6c8","#84a3b3","#7e8daa","#7878a2","#726299","#68588d","#524573"],9:["#aedbf2","#a0c8dd","#92b6c8","#84a3b3","#7e8daa","#7878a2","#726299","#68588d","#524573"],10:["#aedbf2","#a0c8dd","#92b6c8","#84a3b3","#7e8daa","#7878a2","#726299","#68588d","#5d4f80","#524573"],stops:["#a0c8dd","#84a3b3","#7e8daa","#7878a2","#726299"],tags:["dark","blues","purples","subdued","sequential","colorblind-friendly"],name:"Moonstones"},"seq-subdued-pink-brown":{1:["#895277"],2:["#eeb1b1","#895277"],3:["#eeb1b1","#b66d7a","#895277"],4:["#eeb1b1","#b66d7a","#9f6078","#895277"],5:["#eeb1b1","#cc7b7b","#b66d7a","#9f6078","#895277"],6:["#eeb1b1","#cc7b7b","#b66d7a","#9f6078","#895277","#693f5a"],7:["#eeb1b1","#dd9696","#cc7b7b","#b66d7a","#9f6078","#895277","#693f5a"],8:["#eeb1b1","#dd9696","#cc7b7b","#b66d7a","#9f6078","#895277","#7d4b6d","#693f5a"],9:["#ffcccc","#eeb1b1","#dd9696","#cc7b7b","#b66d7a","#9f6078","#895277","#7d4b6d","#693f5a"],10:["#ffcccc","#eeb1b1","#dd9696","#cc7b7b","#b66d7a","#9f6078","#895277","#7d4b6d","#724463","#693f5a"],stops:["#eeb1b1","#cc7b7b","#b66d7a","#9f6078","#895277"],tags:["dark","browns","purples","pinks","subdued","sequential","colorblind-friendly"],name:"Watermelon Sugar"},"seq-subdued-green-pink":{1:["#3b9ea2"],2:["#3b9ea2","#f8c8be"],3:["#3b9ea2","#b8bcba","#f8c8be"],4:["#006e76","#3b9ea2","#f8c8be","#fcd4cc"],5:["#006e76","#3b9ea2","#b8bcba","#f8c8be","#fcd4cc"],6:["#006e76","#3b9ea2","#8cb2b2","#b8bcba","#f8c8be","#fcd4cc"],7:["#006e76","#3b9ea2","#8cb2b2","#b8bcba","#f8c8be","#fcd4cc","#ffe0d9"],8:["#006e76","#3b9ea2","#63a8aa","#8cb2b2","#b8bcba","#f8c8be","#fcd4cc","#ffe0d9"],9:["#006e76","#3b9ea2","#63a8aa","#8cb2b2","#b8bcba","#e6c2bc","#f8c8be","#fcd4cc","#ffe0d9"],10:["#006e76","#1e868c","#3b9ea2","#63a8aa","#8cb2b2","#b8bcba","#e6c2bc","#f8c8be","#fcd4cc","#ffe0d9"],stops:["#006e76","#3b9ea2","#b8bcba","#f8c8be","#fcd4cc"],tags:["dark","greens","pinks","subdued","sequential","colorblind-friendly"],name:"Forest Dusk"},"seq-lines-blue-orange":{1:["#a889b8"],2:["#0060a6","#ffcabf"],3:["#0060a6","#a889b8","#ffcabf"],4:["#0060a6","#2782c4","#ffa18e","#ffcabf"],5:["#0060a6","#2782c4","#a889b8","#ffa18e","#ffcabf"],6:["#0060a6","#2782c4","#a889b8","#d78e9a","#ffa18e","#ffcabf"],7:["#0060a6","#2782c4","#698bc4","#a889b8","#d78e9a","#ffa18e","#ffcabf"],8:["#0060a6","#2782c4","#698bc4","#a889b8","#d78e9a","#ffa18e","#ffb5a6","#ffcabf"],9:["#0060a6","#1474b9","#2782c4","#698bc4","#a889b8","#d78e9a","#ffa18e","#ffb5a6","#ffcabf"],10:["#0060a6","#1474b9","#2782c4","#698bc4","#a889b8","#d78e9a","#ed9595","#ffa18e","#ffb5a6","#ffcabf"],stops:["#0060a6","#2782c4","#a889b8","#ffa18e","#ffcabf"],tags:["light","blues","lines","sequential","colorblind-friendly"],name:"Perfect Pigtails"},"seq-lines-purple-brown":{1:["#9e6b90"],2:["#3900b3","#ebb698"],3:["#3900b3","#9e6b90","#ebb698"],4:["#3900b3","#714dbf","#cf9270","#ebb698"],5:["#3900b3","#714dbf","#9e6b90","#cf9270","#ebb698"],6:["#3900b3","#714dbf","#9e6b90","#b17777","#cf9270","#ebb698"],7:["#3900b3","#714dbf","#8c5fae","#9e6b90","#b17777","#cf9270","#ebb698"],8:["#3900b3","#714dbf","#8c5fae","#9e6b90","#b17777","#cf9270","#dba283","#ebb698"],9:["#3900b3","#5929c0","#714dbf","#8c5fae","#9e6b90","#b17777","#cf9270","#dba283","#ebb698"],10:["#3900b3","#5929c0","#714dbf","#8c5fae","#9e6b90","#b17777","#c4825e","#cf9270","#dba283","#ebb698"],stops:["#3900b3","#714dbf","#9e6b90","#cf9270","#ebb698"],tags:["light","purples","browns","lines","sequential","colorblind-friendly"],name:"Andromeda"},"seq-lines-green-brown":{1:["#00ffd4"],2:["#00ffd4","#8c4600"],3:["#00ffd4","#36ba84","#8c4600"],4:["#00ffd4","#5b9a5b","#8c4600","#592d00"],5:["#00ffd4","#5b9a5b","#8f6519","#8c4600","#592d00"],6:["#00ffd4","#36ba84","#5b9a5b","#8f6519","#8c4600","#592d00"],7:["#00ffd4","#11d9ad","#36ba84","#5b9a5b","#8f6519","#8c4600","#592d00"],8:["#00ffd4","#11d9ad","#36ba84","#5b9a5b","#8f6519","#8c4600","#733900","#592d00"],9:["#00ffd4","#11d9ad","#36ba84","#5b9a5b","#807b32","#8f6519","#8c4600","#733900","#592d00"],10:["#00ffd4","#11d9ad","#36ba84","#5b9a5b","#807b32","#8f6519","#9e4f00","#8c4600","#733900","#592d00"],stops:["#00ffd4","#5b9a5b","#8f6519","#8c4600","#592d00"],tags:["dark","greens","browns","lines","sequential","colorblind-friendly"],name:"Chocolate Mint"},"seq-lines-yellow-blue":{1:["#ffff00"],2:["#ffff00","#0040bf"],3:["#ffff00","#4c6f80","#0040bf"],4:["#ffff00","#8fa745","#4c6f80","#0040bf"],5:["#ffff00","#8fa745","#4c6f80","#1150ba","#0040bf"],6:["#ffff00","#b5c42e","#8fa745","#4c6f80","#1150ba","#0040bf"],7:["#ffff00","#dae217","#b5c42e","#8fa745","#4c6f80","#1150ba","#0040bf"],8:["#ffff00","#dae217","#b5c42e","#8fa745","#4c6f80","#215eb3","#1150ba","#0040bf"],9:["#ffff00","#dae217","#b5c42e","#8fa745","#6a895c","#4c6f80","#215eb3","#1150ba","#0040bf"],10:["#ffff00","#dae217","#b5c42e","#8fa745","#6a895c","#4c6f80","#215eb3","#1150ba","#0040bf","#00359e"],stops:["#ffff00","#8fa745","#4c6f80","#1150ba","#0040bf"],tags:["dark","yellows","blues","lines","sequential","colorblind-friendly"],name:"Going Bananas"},"seq-esribrand-red":{1:["#f07062"],2:["#a8281e","#fbb1a8"],3:["#a8281e","#f07062","#fbb1a8"],4:["#a8281e","#d83020","#f07062","#fbb1a8"],5:["#a8281e","#d83020","#f07062","#f89b91","#fbb1a8"],6:["#a8281e","#c02c1f","#e45041","#f48579","#f89b91","#ffc6bf"],7:["#a8281e","#c02c1f","#d83020","#e45041","#f48579","#f89b91","#ffc6bf"],8:["#a8281e","#c02c1f","#d83020","#e45041","#f07062","#f48579","#fbb1a8","#ffc6bf"],9:["#a8281e","#c02c1f","#d83020","#e45041","#f07062","#f48579","#f89b91","#fbb1a8","#ffc6bf"],10:["#99241b","#a8281e","#c02c1f","#d83020","#e45041","#f07062","#f48579","#f89b91","#fbb1a8","#ffc6bf"],stops:["#a8281e","#d83020","#f07062","#f89b91","#fbb1a8"],tags:["light","reds","esri-brand","sequential","colorblind-friendly"],name:"Esri Red 1"},"seq-esribrand-red-orange":{1:["#e68261"],2:["#ad3c16","#f9d2c5"],3:["#ad3c16","#e68261","#f9d2c5"],4:["#ad3c16","#da4d1e","#e68261","#f9d2c5"],5:["#ad3c16","#da4d1e","#e68261","#f3b7a3","#f9d2c5"],6:["#ad3c16","#c4451a","#e0673f","#ec9c82","#f3b7a3","#ffece6"],7:["#ad3c16","#c4451a","#da4d1e","#e0673f","#ec9c82","#f3b7a3","#ffece6"],8:["#ad3c16","#c4451a","#da4d1e","#e0673f","#e68261","#ec9c82","#f9d2c5","#ffece6"],9:["#ad3c16","#c4451a","#da4d1e","#e0673f","#e68261","#ec9c82","#f3b7a3","#f9d2c5","#ffece6"],10:["#963413","#ad3c16","#c4451a","#da4d1e","#e0673f","#e68261","#ec9c82","#f3b7a3","#f9d2c5","#ffece6"],stops:["#ad3c16","#da4d1e","#e68261","#f3b7a3","#f9d2c5"],tags:["light","reds","sequential","esri-brand","colorblind-friendly"],name:"Esri Red 2"},"seq-esribrand-orange":{1:["#f7975e"],2:["#c65a18","#fdd4ba"],3:["#c65a18","#f7975e","#fdd4ba"],4:["#c65a18","#f36f20","#f7975e","#fdd4ba"],5:["#c65a18","#f36f20","#f7975e","#fbc09b","#fdd4ba"],6:["#c65a18","#dd651c","#fa8640","#f9ab7c","#fbc09b","#ffe8d9"],7:["#c65a18","#dd651c","#f36f20","#fa8640","#f9ab7c","#fbc09b","#ffe8d9"],8:["#c65a18","#dd651c","#f36f20","#fa8640","#f7975e","#f9ab7c","#fdd4ba","#ffe8d9"],9:["#c65a18","#dd651c","#f36f20","#fa8640","#f7975e","#f9ab7c","#fbc09b","#fdd4ba","#ffe8d9"],10:["#b35116","#c65a18","#dd651c","#f36f20","#fa8640","#f7975e","#f9ab7c","#fbc09b","#fdd4ba","#ffe8d9"],stops:["#c65a18","#f36f20","#f7975e","#fbc09b","#fdd4ba"],tags:["light","oranges","sequential","esri-brand","colorblind-friendly"],name:"Esri Orange 1"},"seq-esribrand-orangeyellow":{1:["#fbb664"],2:["#c67718","#fed9ad"],3:["#c67718","#fbb664","#fed9ad"],4:["#c67718","#f29526","#fbb664","#fed9ad"],5:["#c67718","#f29526","#fbb664","#fdcc92","#fed9ad"],6:["#c67718","#dc861f","#f7a645","#fcc17b","#fdcc92","#ffe6c7"],7:["#c67718","#dc861f","#f29526","#f7a645","#fcc17b","#fdcc92","#ffe6c7"],8:["#c67718","#dc861f","#f29526","#f7a645","#fbb664","#fcc17b","#fed9ad","#ffe6c7"],9:["#c67718","#dc861f","#f29526","#f7a645","#fbb664","#fcc17b","#fdcc92","#fed9ad","#ffe6c7"],10:["#b36a16","#c67718","#dc861f","#f29526","#f7a645","#fbb664","#fcc17b","#fdcc92","#fed9ad","#ffe6c7"],stops:["#c67718","#f29526","#fbb664","#fdcc92","#fed9ad"],tags:["light","browns","yellows","sequential","esri-brand","colorblind-friendly"],name:"Esri Pumpkin Pie"},"seq-esribrand-yellow":{1:["#f1df55"],2:["#beac2d","#fff5bf"],3:["#beac2d","#f1df55","#fff5bf"],4:["#beac2d","#ddca39","#f1df55","#fff5bf"],5:["#beac2d","#ddca39","#f1df55","#fdf19d","#fff5bf"],6:["#beac2d","#d3c035","#e7d33c","#fbea6e","#fdf19d","#fff9d6"],7:["#beac2d","#d3c035","#ddca39","#e7d33c","#fbea6e","#fdf19d","#fff9d6"],8:["#beac2d","#d3c035","#ddca39","#e7d33c","#f1df55","#fbea6e","#fff5bf","#fff9d6"],9:["#beac2d","#d3c035","#ddca39","#e7d33c","#f1df55","#fbea6e","#fdf19d","#fff5bf","#fff9d6"],10:["#ad9d29","#beac2d","#d3c035","#ddca39","#e7d33c","#f1df55","#fbea6e","#fdf19d","#fff5bf","#fff9d6"],stops:["#beac2d","#ddca39","#f1df55","#fdf19d","#fff5bf"],tags:["light","yellows","sequential","esri-brand","colorblind-friendly"],name:"Esri Yellow 1"},"seq-esribrand-yellowgreen":{1:["#b9db62"],2:["#84a338","#e5f7b4"],3:["#84a338","#b9db62","#e5f7b4"],4:["#84a338","#a4c74c","#b9db62","#e5f7b4"],5:["#84a338","#a4c74c","#b9db62","#d4ec95","#e5f7b4"],6:["#84a338","#97ba42","#add056","#c2e075","#d4ec95","#f0ffc7"],7:["#84a338","#97ba42","#a4c74c","#add056","#c2e075","#d4ec95","#f0ffc7"],8:["#84a338","#97ba42","#a4c74c","#add056","#b9db62","#c2e075","#e5f7b4","#f0ffc7"],9:["#84a338","#97ba42","#a4c74c","#add056","#b9db62","#c2e075","#d4ec95","#e5f7b4","#f0ffc7"],10:["#748f31","#84a338","#97ba42","#a4c74c","#add056","#b9db62","#c2e075","#d4ec95","#e5f7b4","#f0ffc7"],stops:["#84a338","#a4c74c","#b9db62","#d4ec95","#e5f7b4"],tags:["light","greens","sequential","esri-brand","colorblind-friendly"],name:"Esri Green 1"},"seq-esribrand-green":{1:["#61c66f"],2:["#288835","#b5f1bd"],3:["#288835","#61c66f","#b5f1bd"],4:["#288835","#35ac46","#61c66f","#b5f1bd"],5:["#288835","#35ac46","#61c66f","#99e3a3","#b5f1bd"],6:["#288835","#2f9a3e","#45b855","#7dd489","#99e3a3","#d1ffd7"],7:["#288835","#2f9a3e","#35ac46","#45b855","#7dd489","#99e3a3","#d1ffd7"],8:["#288835","#2f9a3e","#35ac46","#45b855","#61c66f","#7dd489","#b5f1bd","#d1ffd7"],9:["#288835","#2f9a3e","#35ac46","#45b855","#61c66f","#7dd489","#99e3a3","#b5f1bd","#d1ffd7"],10:["#22732d","#288835","#2f9a3e","#35ac46","#45b855","#61c66f","#7dd489","#99e3a3","#b5f1bd","#d1ffd7"],stops:["#288835","#35ac46","#61c66f","#99e3a3","#b5f1bd"],tags:["light","greens","sequential","esri-brand","colorblind-friendly"],name:"Esri Green 2"},"seq-esribrand-greenblue":{1:["#3cd3d0"],2:["#009b98","#a7eeed"],3:["#009b98","#3cd3d0","#a7eeed"],4:["#009b98","#00bab5","#3cd3d0","#a7eeed"],5:["#009b98","#00bab5","#3cd3d0","#81e7e5","#a7eeed"],6:["#009b98","#00aba7","#1ec7c3","#5ae0de","#81e7e5","#cef5f4"],7:["#009b98","#00aba7","#00bab5","#1ec7c3","#5ae0de","#81e7e5","#cef5f4"],8:["#009b98","#00aba7","#00bab5","#1ec7c3","#3cd3d0","#5ae0de","#a7eeed","#cef5f4"],9:["#009b98","#00aba7","#00bab5","#1ec7c3","#3cd3d0","#5ae0de","#81e7e5","#a7eeed","#cef5f4"],10:["#00807d","#009b98","#00aba7","#00bab5","#1ec7c3","#3cd3d0","#5ae0de","#81e7e5","#a7eeed","#cef5f4"],stops:["#009b98","#00bab5","#3cd3d0","#81e7e5","#a7eeed"],tags:["light","blues","sequential","esri-brand","colorblind-friendly"],name:"Esri Blue 1"},"seq-esribrand-blue":{1:["#49a4d8"],2:["#00619b","#a6d8f6"],3:["#00619b","#49a4d8","#a6d8f6"],4:["#00619b","#1480bf","#49a4d8","#a6d8f6"],5:["#00619b","#1480bf","#49a4d8","#8cc9ed","#a6d8f6"],6:["#00619b","#006eaf","#2891ce","#6bb6e3","#8cc9ed","#bfe7ff"],7:["#00619b","#006eaf","#1480bf","#2891ce","#6bb6e3","#8cc9ed","#bfe7ff"],8:["#00619b","#006eaf","#1480bf","#2891ce","#49a4d8","#6bb6e3","#a6d8f6","#bfe7ff"],9:["#00619b","#006eaf","#1480bf","#2891ce","#49a4d8","#6bb6e3","#8cc9ed","#a6d8f6","#bfe7ff"],10:["#005080","#00619b","#006eaf","#1480bf","#2891ce","#49a4d8","#6bb6e3","#8cc9ed","#a6d8f6","#bfe7ff"],stops:["#00619b","#1480bf","#49a4d8","#8cc9ed","#a6d8f6"],tags:["light","blues","sequential","esri-brand","colorblind-friendly"],name:"Esri Blue 2"},"seq-esribrand-violet":{1:["#a085c6"],2:["#57318c","#d6c4f1"],3:["#57318c","#a085c6","#d6c4f1"],4:["#57318c","#7b5ba9","#a085c6","#d6c4f1"],5:["#57318c","#7b5ba9","#a085c6","#c4afe2","#d6c4f1"],6:["#57318c","#69469a","#8d70b7","#b29ad4","#c4afe2","#e8d9ff"],7:["#57318c","#69469a","#7b5ba9","#8d70b7","#b29ad4","#c4afe2","#e8d9ff"],8:["#57318c","#69469a","#7b5ba9","#8d70b7","#a085c6","#b29ad4","#d6c4f1","#e8d9ff"],9:["#57318c","#69469a","#7b5ba9","#8d70b7","#a085c6","#b29ad4","#c4afe2","#d6c4f1","#e8d9ff"],10:["#3f2466","#57318c","#69469a","#7b5ba9","#8d70b7","#a085c6","#b29ad4","#c4afe2","#d6c4f1","#e8d9ff"],stops:["#57318c","#7b5ba9","#a085c6","#c4afe2","#d6c4f1"],tags:["light","purples","sequential","esri-brand","colorblind-friendly"],name:"Esri Purple 1"},"seq-esribrand-violetred":{1:["#b983c3"],2:["#73377e","#eac5f0"],3:["#73377e","#b983c3","#eac5f0"],4:["#73377e","#9753a3","#b983c3","#eac5f0"],5:["#73377e","#9753a3","#b983c3","#daafe1","#eac5f0"],6:["#73377e","#864691","#a466af","#ca99d2","#daafe1","#fadbff"],7:["#73377e","#864691","#9753a3","#a466af","#ca99d2","#daafe1","#fadbff"],8:["#73377e","#864691","#9753a3","#a466af","#b983c3","#ca99d2","#eac5f0","#fadbff"],9:["#73377e","#864691","#9753a3","#a466af","#b983c3","#ca99d2","#daafe1","#eac5f0","#fadbff"],10:["#5d2d66","#73377e","#864691","#9753a3","#a466af","#b983c3","#ca99d2","#daafe1","#eac5f0","#fadbff"],stops:["#73377e","#9753a3","#b983c3","#daafe1","#eac5f0"],tags:["light","purples","sequential","esri-brand","colorblind-friendly"],name:"Esri Purple 2"},"seq-esribrand-brown":{1:["#ad8b62"],2:["#684217","#e5ceb1"],3:["#684217","#ad8b62","#e5ceb1"],4:["#684217","#855621","#ad8b62","#e5ceb1"],5:["#684217","#855621","#ad8b62","#d2b897","#e5ceb1"],6:["#684217","#764c1c","#946d3f","#c0a27d","#d2b897","#f7e4cb"],7:["#684217","#764c1c","#855621","#946d3f","#c0a27d","#d2b897","#f7e4cb"],8:["#684217","#764c1c","#855621","#946d3f","#ad8b62","#c0a27d","#e5ceb1","#f7e4cb"],9:["#684217","#764c1c","#855621","#946d3f","#ad8b62","#c0a27d","#d2b897","#e5ceb1","#f7e4cb"],10:["#593812","#684217","#764c1c","#855621","#946d3f","#ad8b62","#c0a27d","#d2b897","#e5ceb1","#f7e4cb"],stops:["#684217","#855621","#ad8b62","#d2b897","#e5ceb1"],tags:["light","browns","sequential","esri-brand","colorblind-friendly"],name:"Esri Brown 1"},"seq-esribrand-gray":{1:["#999999"],2:["#404040","#cecece"],3:["#404040","#999999","#cecece"],4:["#404040","#666666","#999999","#cecece"],5:["#404040","#666666","#999999","#bcbcbc","#cecece"],6:["#404040","#535353","#808080","#ababab","#bcbcbc","#dfdfdf"],7:["#404040","#535353","#666666","#808080","#ababab","#bcbcbc","#dfdfdf"],8:["#404040","#535353","#666666","#808080","#999999","#ababab","#cecece","#dfdfdf"],9:["#404040","#535353","#666666","#808080","#999999","#ababab","#bcbcbc","#cecece","#dfdfdf"],10:["#2e2e2e","#404040","#535353","#666666","#808080","#999999","#ababab","#bcbcbc","#cecece","#dfdfdf"],stops:["#404040","#666666","#999999","#bcbcbc","#cecece"],tags:["light","grays","sequential","esri-brand","colorblind-friendly"],name:"Esri Gray 1"},"seq-mentone-beach":{stops:["#48385F","#995375","#DB4A5B","#FC9A59","#FEE086"],tags:["dark","purples","yellows","sequential","colorblind-friendly"],name:"Mentone Beach"},"seq-snowy-mountain":{stops:["#e8e6f1","#c9d5eb","#a9c4e5","#87b3de","#60a3d8"],tags:["light","blues","sequential","colorblind-friendly"],name:"Snowy Mountain"},"seq-snow-cactus":{stops:["#F3F5E8","#E2DBBF","#90825D","#3E4939","#2A3225"],tags:["light","greens","sequential","colorblind-friendly"],name:"Snow Cactus"},"div-orange-pink":{1:["#b796b8"],2:["#d8a79c","#b796b8"],3:["#d8a79c","#ffffff","#b796b8"],4:["#bf6d59","#e5c4bd","#cfb9d0","#874f88"],5:["#bf6d59","#e5c4bd","#ffffff","#cfb9d0","#874f88"],6:["#b24f38","#d8a79c","#f2e2de","#e7dce7","#b796b8","#6f2c71"],7:["#b24f38","#d8a79c","#f2e2de","#ffffff","#e7dce7","#b796b8","#6f2c71"],8:["#b24f38","#cc8a7a","#e5c4bd","#f2e2de","#e7dce7","#cfb9d0","#9f72a0","#6f2c71"],9:["#b24f38","#cc8a7a","#e5c4bd","#f2e2de","#ffffff","#e7dce7","#cfb9d0","#9f72a0","#6f2c71"],10:["#a53217","#b24f38","#cc8a7a","#e5c4bd","#f2e2de","#e7dce7","#cfb9d0","#9f72a0","#6f2c71","#570959"],stops:["#a53217","#d2998b","#ffffff","#ab84ac","#570959"],tags:["light","reds","purples","diverging","colorblind-friendly"],name:"Purple and Red 1"},"div-orange-yellow-pink":{1:["#b795aa"],2:["#d8a78d","#b795aa"],3:["#d8a78d","#fffee6","#b795aa"],4:["#bf6c52","#e5c4ab","#cfb8be","#874f81"],5:["#bf6c52","#e5c4ab","#fffee6","#cfb8be","#874f81"],6:["#b24f35","#d8a78d","#f2e1c8","#e7dbd2","#b795aa","#6f2c6d"],7:["#b24f35","#d8a78d","#f2e1c8","#fffee6","#e7dbd2","#b795aa","#6f2c6d"],8:["#b24f35","#cc8970","#e5c4ab","#f2e1c8","#e7dbd2","#cfb8be","#9f7295","#6f2c6d"],9:["#b24f35","#cc8970","#e5c4ab","#f2e1c8","#fffee6","#e7dbd2","#cfb8be","#9f7295","#6f2c6d"],10:["#a53217","#b24f35","#cc8970","#e5c4ab","#f2e1c8","#e7dbd2","#cfb8be","#9f7295","#6f2c6d","#570959"],stops:["#a53217","#d2987f","#fffee6","#ab84a0","#570959"],tags:["light","reds","purples","diverging","colorblind-friendly"],name:"Purple and Red 2"},"div-bluegreen-redpurple":{1:["#bd929b"],2:["#92aeaa","#bd929b"],3:["#92aeaa","#ffffff","#bd929b"],4:["#497871","#b6c9c6","#d3b6bc","#924959"],5:["#497871","#b6c9c6","#ffffff","#d3b6bc","#924959"],6:["#245d54","#92aeaa","#dbe4e3","#e9dbde","#bd929b","#7c2437"],7:["#245d54","#92aeaa","#dbe4e3","#ffffff","#e9dbde","#bd929b","#7c2437"],8:["#245d54","#6d938d","#b6c9c6","#dbe4e3","#e9dbde","#d3b6bc","#a86d7a","#7c2437"],9:["#245d54","#6d938d","#b6c9c6","#dbe4e3","#ffffff","#e9dbde","#d3b6bc","#a86d7a","#7c2437"],10:["#004238","#245d54","#6d938d","#b6c9c6","#dbe4e3","#e9dbde","#d3b6bc","#a86d7a","#7c2437","#660016"],stops:["#004238","#80a19c","#ffffff","#b3808b","#660016"],tags:["light","reds","greens","diverging"],name:"Red and Green 1"},"div-bluegreen-yellow-redpurple":{1:["#bd918d"],2:["#92ad9b","#bd918d"],3:["#92ad9b","#fffee6","#bd918d"],4:["#49786a","#b6c8b4","#d3b5ab","#924951"],5:["#49786a","#b6c8b4","#fffee6","#d3b5ab","#924951"],6:["#245d51","#92ad9b","#dbe3cd","#e9dac8","#bd918d","#7c2434"],7:["#245d51","#92ad9b","#dbe3cd","#fffee6","#e9dac8","#bd918d","#7c2434"],8:["#245d51","#6d9383","#b6c8b4","#dbe3cd","#e9dac8","#d3b5ab","#a86d6f","#7c2434"],9:["#245d51","#6d9383","#b6c8b4","#dbe3cd","#fffee6","#e9dac8","#d3b5ab","#a86d6f","#7c2434"],10:["#004238","#245d51","#6d9383","#b6c8b4","#dbe3cd","#e9dac8","#d3b5ab","#a86d6f","#7c2434","#660016"],stops:["#004238","#80a08f","#fffee6","#b37f7e","#660016"],tags:["light","reds","greens","diverging"],name:"Red and Green 1"},"div-green-orange":{1:["#d8a79c"],2:["#aab193","#d8a79c"],3:["#aab193","#ffffff","#d8a79c"],4:["#717d4b","#c6cbb7","#e5c4bd","#bf6d59"],5:["#717d4b","#c6cbb7","#ffffff","#e5c4bd","#bf6d59"],6:["#546327","#aab193","#e3e5db","#f2e2de","#d8a79c","#b24f38"],7:["#546327","#aab193","#e3e5db","#ffffff","#f2e2de","#d8a79c","#b24f38"],8:["#546327","#8d976f","#c6cbb7","#e3e5db","#f2e2de","#e5c4bd","#cc8a7a","#b24f38"],9:["#546327","#8d976f","#c6cbb7","#e3e5db","#ffffff","#f2e2de","#e5c4bd","#cc8a7a","#b24f38"],10:["#384903","#546327","#8d976f","#c6cbb7","#e3e5db","#f2e2de","#e5c4bd","#cc8a7a","#b24f38","#a53217"],stops:["#384903","#9ca481","#ffffff","#d2998b","#a53217"],tags:["light","reds","greens","diverging"],name:"Red and Green 2"},"div-green-yellow-orange":{1:["#d8a78d"],2:["#aab085","#d8a78d"],3:["#aab085","#fffee6","#d8a78d"],4:["#717d44","#c6caa5","#e5c4ab","#bf6c52"],5:["#717d44","#c6caa5","#fffee6","#e5c4ab","#bf6c52"],6:["#546323","#aab085","#e3e4c6","#f2e1c8","#d8a78d","#b24f35"],7:["#546323","#aab085","#e3e4c6","#fffee6","#f2e1c8","#d8a78d","#b24f35"],8:["#546323","#8d9764","#c6caa5","#e3e4c6","#f2e1c8","#e5c4ab","#cc8970","#b24f35"],9:["#546323","#8d9764","#c6caa5","#e3e4c6","#fffee6","#f2e1c8","#e5c4ab","#cc8970","#b24f35"],10:["#384903","#546323","#8d9764","#c6caa5","#e3e4c6","#f2e1c8","#e5c4ab","#cc8970","#b24f35","#a53217"],stops:["#384903","#9ca375","#fffee6","#d2987f","#a53217"],tags:["light","reds","greens","diverging"],name:"Red and Green 3"},"div-bluegreen-orange":{1:["#d8a79c"],2:["#92aeaa","#d8a79c"],3:["#92aeaa","#ffffff","#d8a79c"],4:["#497871","#b6c9c6","#e5c4bd","#bf6d59"],5:["#497871","#b6c9c6","#ffffff","#e5c4bd","#bf6d59"],6:["#245d54","#92aeaa","#dbe4e3","#f2e2de","#d8a79c","#b24f38"],7:["#245d54","#92aeaa","#dbe4e3","#ffffff","#f2e2de","#d8a79c","#b24f38"],8:["#245d54","#6d938d","#b6c9c6","#dbe4e3","#f2e2de","#e5c4bd","#cc8a7a","#b24f38"],9:["#245d54","#6d938d","#b6c9c6","#dbe4e3","#ffffff","#f2e2de","#e5c4bd","#cc8a7a","#b24f38"],10:["#004238","#245d54","#6d938d","#b6c9c6","#dbe4e3","#f2e2de","#e5c4bd","#cc8a7a","#b24f38","#a53217"],stops:["#004238","#80a19c","#ffffff","#d2998b","#a53217"],tags:["light","reds","greens","diverging"],name:"Red and Green 4"},"div-bluegreen-yellow-orange":{1:["#d8a78d"],2:["#92ad9b","#d8a78d"],3:["#92ad9b","#fffee6","#d8a78d"],4:["#49786a","#b6c8b4","#e5c4ab","#bf6c52"],5:["#49786a","#b6c8b4","#fffee6","#e5c4ab","#bf6c52"],6:["#245d51","#92ad9b","#dbe3cd","#f2e1c8","#d8a78d","#b24f35"],7:["#245d51","#92ad9b","#dbe3cd","#fffee6","#f2e1c8","#d8a78d","#b24f35"],8:["#245d51","#6d9383","#b6c8b4","#dbe3cd","#f2e1c8","#e5c4ab","#cc8970","#b24f35"],9:["#245d51","#6d9383","#b6c8b4","#dbe3cd","#fffee6","#f2e1c8","#e5c4ab","#cc8970","#b24f35"],10:["#004238","#245d51","#6d9383","#b6c8b4","#dbe3cd","#f2e1c8","#e5c4ab","#cc8970","#b24f35","#a53217"],stops:["#004238","#80a08f","#fffee6","#d2987f","#a53217"],tags:["light","reds","greens","diverging"],name:"Red and Green 5"},"div-green-redpurple":{1:["#bd929b"],2:["#aab193","#bd929b"],3:["#aab193","#ffffff","#bd929b"],4:["#717d4b","#c6cbb7","#d3b6bc","#924959"],5:["#717d4b","#c6cbb7","#ffffff","#d3b6bc","#924959"],6:["#546327","#aab193","#e3e5db","#e9dbde","#bd929b","#7c2437"],7:["#546327","#aab193","#e3e5db","#ffffff","#e9dbde","#bd929b","#7c2437"],8:["#546327","#8d976f","#c6cbb7","#e3e5db","#e9dbde","#d3b6bc","#a86d7a","#7c2437"],9:["#546327","#8d976f","#c6cbb7","#e3e5db","#ffffff","#e9dbde","#d3b6bc","#a86d7a","#7c2437"],10:["#384903","#546327","#8d976f","#c6cbb7","#e3e5db","#e9dbde","#d3b6bc","#a86d7a","#7c2437","#660016"],stops:["#384903","#9ca481","#ffffff","#b3808b","#660016"],tags:["light","reds","greens","diverging"],name:"Red and Green 6"},"div-green-yellow-redpurple":{1:["#bd918d"],2:["#aab085","#bd918d"],3:["#aab085","#fffee6","#bd918d"],4:["#717d44","#c6caa5","#d3b5ab","#924951"],5:["#717d44","#c6caa5","#fffee6","#d3b5ab","#924951"],6:["#546323","#aab085","#e3e4c6","#e9dac8","#bd918d","#7c2434"],7:["#546323","#aab085","#e3e4c6","#fffee6","#e9dac8","#bd918d","#7c2434"],8:["#546323","#8d9764","#c6caa5","#e3e4c6","#e9dac8","#d3b5ab","#a86d6f","#7c2434"],9:["#546323","#8d9764","#c6caa5","#e3e4c6","#fffee6","#e9dac8","#d3b5ab","#a86d6f","#7c2434"],10:["#384903","#546323","#8d9764","#c6caa5","#e3e4c6","#e9dac8","#d3b5ab","#a86d6f","#7c2434","#660016"],stops:["#384903","#9ca375","#fffee6","#b37f7e","#660016"],tags:["light","reds","greens","diverging"],name:"Red and Green 7"},"div-orange-yellow-blue-light":{1:["#99a6ac"],2:["#d8a78d","#99a6ac"],3:["#d8a78d","#fffee6","#99a6ac"],4:["#bf6c52","#e5c4ab","#bbc3bf","#546b85"],5:["#bf6c52","#e5c4ab","#fffee6","#bbc3bf","#546b85"],6:["#b24f35","#d8a78d","#f2e1c8","#dde1d3","#99a6ac","#324d71"],7:["#b24f35","#d8a78d","#f2e1c8","#fffee6","#dde1d3","#99a6ac","#324d71"],8:["#b24f35","#cc8970","#e5c4ab","#f2e1c8","#dde1d3","#bbc3bf","#768898","#324d71"],9:["#b24f35","#cc8970","#e5c4ab","#f2e1c8","#fffee6","#dde1d3","#bbc3bf","#768898","#324d71"],10:["#a53217","#b24f35","#cc8970","#e5c4ab","#f2e1c8","#dde1d3","#bbc3bf","#768898","#324d71","#10305e"],stops:["#a53217","#d2987f","#fffee6","#8897a2","#10305e"],tags:["light","reds","blues","diverging","colorblind-friendly"],name:"Blue and Red 1"},"div-orange-yellow-blue-dark":{1:["#92a1a3"],2:["#c0a183","#92a1a3"],3:["#c0a183","#fffee6","#92a1a3"],4:["#956442","#d5c0a4","#b6c0b9","#496476"],5:["#956442","#d5c0a4","#fffee6","#b6c0b9","#496476"],6:["#804521","#c0a183","#eadfc5","#dbdfd0","#92a1a3","#24455f"],7:["#804521","#c0a183","#eadfc5","#fffee6","#dbdfd0","#92a1a3","#24455f"],8:["#804521","#aa8363","#d5c0a4","#eadfc5","#dbdfd0","#b6c0b9","#6d838c","#24455f"],9:["#804521","#aa8363","#d5c0a4","#eadfc5","#fffee6","#dbdfd0","#b6c0b9","#6d838c","#24455f"],10:["#6b2600","#804521","#aa8363","#d5c0a4","#eadfc5","#dbdfd0","#b6c0b9","#6d838c","#24455f","#002649"],stops:["#6b2600","#b59273","#fffee6","#809298","#002649"],tags:["light","browns","blues","diverging","colorblind-friendly"],name:"Blue and Brown 1"},"div-red-yellow-pink":{1:["#b795aa"],2:["#d39688","#b795aa"],3:["#d39688","#fffee6","#b795aa"],4:["#b6504a","#e2b9a7","#cfb8be","#874f81"],5:["#b6504a","#e2b9a7","#fffee6","#cfb8be","#874f81"],6:["#a82e2a","#d39688","#f0dbc7","#e7dbd2","#b795aa","#6f2c6d"],7:["#a82e2a","#d39688","#f0dbc7","#fffee6","#e7dbd2","#b795aa","#6f2c6d"],8:["#a82e2a","#c57369","#e2b9a7","#f0dbc7","#e7dbd2","#cfb8be","#9f7295","#6f2c6d"],9:["#a82e2a","#c57369","#e2b9a7","#f0dbc7","#fffee6","#e7dbd2","#cfb8be","#9f7295","#6f2c6d"],10:["#990b0b","#a82e2a","#c57369","#e2b9a7","#f0dbc7","#e7dbd2","#cfb8be","#9f7295","#6f2c6d","#570959"],stops:["#990b0b","#cc8579","#fffee6","#ab84a0","#570959"],tags:["light","reds","purples","diverging","colorblind-friendly"],name:"Purple and Red 3"},"div-red-yellow-purple":{1:["#ae9db2"],2:["#d39688","#ae9db2"],3:["#d39688","#fffee6","#ae9db2"],4:["#b6504a","#e2b9a7","#c9bdc3","#775c90"],5:["#b6504a","#e2b9a7","#fffee6","#c9bdc3","#775c90"],6:["#a82e2a","#d39688","#f0dbc7","#e4ded5","#ae9db2","#5c3b7e"],7:["#a82e2a","#d39688","#f0dbc7","#fffee6","#e4ded5","#ae9db2","#5c3b7e"],8:["#a82e2a","#c57369","#e2b9a7","#f0dbc7","#e4ded5","#c9bdc3","#927ca1","#5c3b7e"],9:["#a82e2a","#c57369","#e2b9a7","#f0dbc7","#fffee6","#e4ded5","#c9bdc3","#927ca1","#5c3b7e"],10:["#990b0b","#a82e2a","#c57369","#e2b9a7","#f0dbc7","#e4ded5","#c9bdc3","#927ca1","#5c3b7e","#411b6d"],stops:["#990b0b","#cc8579","#fffee6","#a08daa","#411b6d"],tags:["light","reds","purples","diverging","colorblind-friendly"],name:"Purple and Red 4"},"div-blue-green":{1:["#aab193"],2:["#99a6ba","#aab193"],3:["#99a6ba","#ffffff","#aab193"],4:["#546b8c","#bbc4d1","#c6cbb7","#717d4b"],5:["#546b8c","#bbc4d1","#ffffff","#c6cbb7","#717d4b"],6:["#324e75","#99a6ba","#dde1e8","#e3e5db","#aab193","#546327"],7:["#324e75","#99a6ba","#dde1e8","#ffffff","#e3e5db","#aab193","#546327"],8:["#324e75","#7689a3","#bbc4d1","#dde1e8","#e3e5db","#c6cbb7","#8d976f","#546327"],9:["#324e75","#7689a3","#bbc4d1","#dde1e8","#ffffff","#e3e5db","#c6cbb7","#8d976f","#546327"],10:["#10305e","#324e75","#7689a3","#bbc4d1","#dde1e8","#e3e5db","#c6cbb7","#8d976f","#546327","#384903"],stops:["#10305e","#8898af","#ffffff","#9ca481","#384903"],tags:["light","greens","blues","diverging","colorblind-friendly"],name:"Green and Blue 1"},"div-red-blue":{1:["#99a6ba"],2:["#d39696","#99a6ba"],3:["#d39696","#ffffff","#99a6ba"],4:["#b65151","#e2b9b9","#bbc4d1","#546b8c"],5:["#b65151","#e2b9b9","#ffffff","#bbc4d1","#546b8c"],6:["#a82e2e","#d39696","#f0dcdc","#dde1e8","#99a6ba","#324e75"],7:["#a82e2e","#d39696","#f0dcdc","#ffffff","#dde1e8","#99a6ba","#324e75"],8:["#a82e2e","#c57474","#e2b9b9","#f0dcdc","#dde1e8","#bbc4d1","#7689a3","#324e75"],9:["#a82e2e","#c57474","#e2b9b9","#f0dcdc","#ffffff","#dde1e8","#bbc4d1","#7689a3","#324e75"],10:["#990b0b","#a82e2e","#c57474","#e2b9b9","#f0dcdc","#dde1e8","#bbc4d1","#7689a3","#324e75","#10305e"],stops:["#990b0b","#cc8585","#ffffff","#8898af","#10305e"],tags:["light","reds","blues","diverging","colorblind-friendly"],name:"Blue and Red 2"},"div-bluegreen-purple":{1:["#ae9dc0"],2:["#92aeaa","#ae9dc0"],3:["#92aeaa","#ffffff","#ae9dc0"],4:["#497871","#b6c9c6","#c9bed5","#775c97"],5:["#497871","#b6c9c6","#ffffff","#c9bed5","#775c97"],6:["#245d54","#92aeaa","#dbe4e3","#e4deea","#ae9dc0","#5c3c82"],7:["#245d54","#92aeaa","#dbe4e3","#ffffff","#e4deea","#ae9dc0","#5c3c82"],8:["#245d54","#6d938d","#b6c9c6","#dbe4e3","#e4deea","#c9bed5","#927dac","#5c3c82"],9:["#245d54","#6d938d","#b6c9c6","#dbe4e3","#ffffff","#e4deea","#c9bed5","#927dac","#5c3c82"],10:["#004238","#245d54","#6d938d","#b6c9c6","#dbe4e3","#e4deea","#c9bed5","#927dac","#5c3c82","#411b6d"],stops:["#004238","#80a19c","#ffffff","#a08db6","#411b6d"],tags:["light","greens","purples","diverging","colorblind-friendly"],name:"Purple and Green 1"},"div-redpurple-blue":{1:["#99a6ba"],2:["#bd929b","#99a6ba"],3:["#bd929b","#ffffff","#99a6ba"],4:["#924959","#d3b6bc","#bbc4d1","#546b8c"],5:["#924959","#d3b6bc","#ffffff","#bbc4d1","#546b8c"],6:["#7c2437","#bd929b","#e9dbde","#dde1e8","#99a6ba","#324e75"],7:["#7c2437","#bd929b","#e9dbde","#ffffff","#dde1e8","#99a6ba","#324e75"],8:["#7c2437","#a86d7a","#d3b6bc","#e9dbde","#dde1e8","#bbc4d1","#7689a3","#324e75"],9:["#7c2437","#a86d7a","#d3b6bc","#e9dbde","#ffffff","#dde1e8","#bbc4d1","#7689a3","#324e75"],10:["#660016","#7c2437","#a86d7a","#d3b6bc","#e9dbde","#dde1e8","#bbc4d1","#7689a3","#324e75","#10305e"],stops:["#660016","#b3808b","#ffffff","#8898af","#10305e"],tags:["light","reds","blues","diverging","colorblind-friendly"],name:"Blue and Red 3"},"div-orange-blue":{1:["#99a6ba"],2:["#d8a79c","#99a6ba"],3:["#d8a79c","#ffffff","#99a6ba"],4:["#bf6d59","#e5c4bd","#bbc4d1","#546b8c"],5:["#bf6d59","#e5c4bd","#ffffff","#bbc4d1","#546b8c"],6:["#b24f38","#d8a79c","#f2e2de","#dde1e8","#99a6ba","#324e75"],7:["#b24f38","#d8a79c","#f2e2de","#ffffff","#dde1e8","#99a6ba","#324e75"],8:["#b24f38","#cc8a7a","#e5c4bd","#f2e2de","#dde1e8","#bbc4d1","#7689a3","#324e75"],9:["#b24f38","#cc8a7a","#e5c4bd","#f2e2de","#ffffff","#dde1e8","#bbc4d1","#7689a3","#324e75"],10:["#a53217","#b24f38","#cc8a7a","#e5c4bd","#f2e2de","#dde1e8","#bbc4d1","#7689a3","#324e75","#10305e"],stops:["#a53217","#d2998b","#ffffff","#8898af","#10305e"],tags:["light","reds","blues","diverging","colorblind-friendly"],name:"Blue and Red 4"},"div-green-pink":{1:["#b796b8"],2:["#aab193","#b796b8"],3:["#aab193","#ffffff","#b796b8"],4:["#717d4b","#c6cbb7","#cfb9d0","#874f88"],5:["#717d4b","#c6cbb7","#ffffff","#cfb9d0","#874f88"],6:["#546327","#aab193","#e3e5db","#e7dce7","#b796b8","#6f2c71"],7:["#546327","#aab193","#e3e5db","#ffffff","#e7dce7","#b796b8","#6f2c71"],8:["#546327","#8d976f","#c6cbb7","#e3e5db","#e7dce7","#cfb9d0","#9f72a0","#6f2c71"],9:["#546327","#8d976f","#c6cbb7","#e3e5db","#ffffff","#e7dce7","#cfb9d0","#9f72a0","#6f2c71"],10:["#384903","#546327","#8d976f","#c6cbb7","#e3e5db","#e7dce7","#cfb9d0","#9f72a0","#6f2c71","#570959"],stops:["#384903","#9ca481","#ffffff","#ab84ac","#570959"],tags:["light","greens","purples","diverging","colorblind-friendly"],name:"Purple and Green 2"},"div-red-green":{1:["#aab193"],2:["#d39696","#aab193"],3:["#d39696","#ffffff","#aab193"],4:["#b65151","#e2b9b9","#c6cbb7","#717d4b"],5:["#b65151","#e2b9b9","#ffffff","#c6cbb7","#717d4b"],6:["#a82e2e","#d39696","#f0dcdc","#e3e5db","#aab193","#546327"],7:["#a82e2e","#d39696","#f0dcdc","#ffffff","#e3e5db","#aab193","#546327"],8:["#a82e2e","#c57474","#e2b9b9","#f0dcdc","#e3e5db","#c6cbb7","#8d976f","#546327"],9:["#a82e2e","#c57474","#e2b9b9","#f0dcdc","#ffffff","#e3e5db","#c6cbb7","#8d976f","#546327"],10:["#990b0b","#a82e2e","#c57474","#e2b9b9","#f0dcdc","#e3e5db","#c6cbb7","#8d976f","#546327","#384903"],stops:["#990b0b","#cc8585","#ffffff","#9ca481","#384903"],tags:["light","reds","greens","diverging"],name:"Red and Green 8"},"div-bluegreen-pink":{1:["#b796b8"],2:["#92aeaa","#b796b8"],3:["#92aeaa","#ffffff","#b796b8"],4:["#497871","#b6c9c6","#cfb9d0","#874f88"],5:["#497871","#b6c9c6","#ffffff","#cfb9d0","#874f88"],6:["#245d54","#92aeaa","#dbe4e3","#e7dce7","#b796b8","#6f2c71"],7:["#245d54","#92aeaa","#dbe4e3","#ffffff","#e7dce7","#b796b8","#6f2c71"],8:["#245d54","#6d938d","#b6c9c6","#dbe4e3","#e7dce7","#cfb9d0","#9f72a0","#6f2c71"],9:["#245d54","#6d938d","#b6c9c6","#dbe4e3","#ffffff","#e7dce7","#cfb9d0","#9f72a0","#6f2c71"],10:["#004238","#245d54","#6d938d","#b6c9c6","#dbe4e3","#e7dce7","#cfb9d0","#9f72a0","#6f2c71","#570959"],stops:["#004238","#80a19c","#ffffff","#ab84ac","#570959"],tags:["light","greens","purples","diverging","colorblind-friendly"],name:"Purple and Green 3"},"div-orange-purple":{1:["#ae9dc0"],2:["#d8a79c","#ae9dc0"],3:["#d8a79c","#ffffff","#ae9dc0"],4:["#bf6d59","#e5c4bd","#c9bed5","#775c97"],5:["#bf6d59","#e5c4bd","#ffffff","#c9bed5","#775c97"],6:["#b24f38","#d8a79c","#f2e2de","#e4deea","#ae9dc0","#5c3c82"],7:["#b24f38","#d8a79c","#f2e2de","#ffffff","#e4deea","#ae9dc0","#5c3c82"],8:["#b24f38","#cc8a7a","#e5c4bd","#f2e2de","#e4deea","#c9bed5","#927dac","#5c3c82"],9:["#b24f38","#cc8a7a","#e5c4bd","#f2e2de","#ffffff","#e4deea","#c9bed5","#927dac","#5c3c82"],10:["#a53217","#b24f38","#cc8a7a","#e5c4bd","#f2e2de","#e4deea","#c9bed5","#927dac","#5c3c82","#411b6d"],stops:["#a53217","#d2998b","#ffffff","#a08db6","#411b6d"],tags:["light","reds","purples","diverging","colorblind-friendly"],name:"Purple and Red 5"},"div-orange-gray-blue":{1:["#4f847c"],2:["#8a6a36","#4f847c"],3:["#8a6a36","#333333","#4f847c"],4:["#c58e37","#6d5835","#466964","#62b9ac"],5:["#c58e37","#6d5835","#333333","#466964","#62b9ac"],6:["#e2a138","#8a6a36","#504534","#3c4e4b","#4f847c","#6cd4c5"],7:["#e2a138","#8a6a36","#504534","#333333","#3c4e4b","#4f847c","#6cd4c5"],8:["#e2a138","#a87c36","#6d5835","#504534","#3c4e4b","#466964","#599e94","#6cd4c5"],9:["#e2a138","#a87c36","#6d5835","#504534","#333333","#3c4e4b","#466964","#599e94","#6cd4c5"],10:["#ffb339","#e2a138","#a87c36","#6d5835","#504534","#3c4e4b","#466964","#599e94","#6cd4c5","#75efdd"],stops:["#ffb339","#997336","#333333","#549188","#75efdd"],tags:["dark","yellows","blues","diverging","bright","colorblind-friendly"],name:"Blue and Orange 1"},"div-yellow-gray-purple":{1:["#826288"],2:["#8a8356","#826288"],3:["#8a8356","#333333","#826288"],4:["#c5b86e","#6d684a","#68526c","#b681c0"],5:["#c5b86e","#6d684a","#333333","#68526c","#b681c0"],6:["#e2d279","#8a8356","#504e3f","#4d434f","#826288","#d190dd"],7:["#e2d279","#8a8356","#504e3f","#333333","#4d434f","#826288","#d190dd"],8:["#e2d279","#a89d62","#6d684a","#504e3f","#4d434f","#68526c","#9c71a4","#d190dd"],9:["#e2d279","#a89d62","#6d684a","#504e3f","#333333","#4d434f","#68526c","#9c71a4","#d190dd"],10:["#ffed85","#e2d279","#a89d62","#6d684a","#504e3f","#4d434f","#68526c","#9c71a4","#d190dd","#eba0f9"],stops:["#ffed85","#99905c","#333333","#8f6a96","#eba0f9"],tags:["dark","purples","diverging","bright","colorblind-friendly"],name:"Purple and Yellow 1"},"div-red-gray-blue":{1:["#4f847c"],2:["#8a5757","#4f847c"],3:["#8a5757","#333333","#4f847c"],4:["#c57070","#6d4b4b","#466964","#62b9ac"],5:["#c57070","#6d4b4b","#333333","#466964","#62b9ac"],6:["#e27c7c","#8a5757","#503f3f","#3c4e4b","#4f847c","#6cd4c5"],7:["#e27c7c","#8a5757","#503f3f","#333333","#3c4e4b","#4f847c","#6cd4c5"],8:["#e27c7c","#a86464","#6d4b4b","#503f3f","#3c4e4b","#466964","#599e94","#6cd4c5"],9:["#e27c7c","#a86464","#6d4b4b","#503f3f","#333333","#3c4e4b","#466964","#599e94","#6cd4c5"],10:["#ff8888","#e27c7c","#a86464","#6d4b4b","#503f3f","#3c4e4b","#466964","#599e94","#6cd4c5","#75efdd"],stops:["#ff8888","#995e5e","#333333","#549188","#75efdd"],tags:["dark","pinks","blues","diverging","colorblind-friendly"],name:"Blue and Red 5"},"div-green-gray-purple":{1:["#826288"],2:["#598459","#826288"],3:["#598459","#333333","#826288"],4:["#72b972","#4c694c","#68526c","#b681c0"],5:["#72b972","#4c694c","#333333","#68526c","#b681c0"],6:["#7ed47e","#598459","#404e40","#4d434f","#826288","#d190dd"],7:["#7ed47e","#598459","#404e40","#333333","#4d434f","#826288","#d190dd"],8:["#7ed47e","#659e65","#4c694c","#404e40","#4d434f","#68526c","#9c71a4","#d190dd"],9:["#7ed47e","#659e65","#4c694c","#404e40","#333333","#4d434f","#68526c","#9c71a4","#d190dd"],10:["#8bef8b","#7ed47e","#659e65","#4c694c","#404e40","#4d434f","#68526c","#9c71a4","#d190dd","#eba0f9"],stops:["#8bef8b","#5f915f","#333333","#8f6a96","#eba0f9"],tags:["dark","greens","purples","diverging","bright","colorblind-friendly"],name:"Purple and Green 4"},"div-blue-yellow-red-bright":{1:["#ead98b"],2:["#954151","#1d4e89"],3:["#954151","#ead98b","#1d4e89"],4:["#954151","#ead98b","#9aacae","#1d4e89"],5:["#954151","#db9793","#ead98b","#7295bf","#1d4e89"],6:["#954151","#db9793","#ead98b","#c2c29c","#7295bf","#1d4e89"],7:["#954151","#ba6f75","#db9793","#ead98b","#9aacae","#7295bf","#1d4e89"],8:["#954151","#ba6f75","#db9793","#ead98b","#c2c29c","#9aacae","#7295bf","#1d4e89"],9:["#954151","#ba6f75","#db9793","#deba87","#ead98b","#c2c29c","#9aacae","#7295bf","#1d4e89"],10:["#954151","#ba6f75","#db9793","#deba87","#ead98b","#c2c29c","#9aacae","#7295bf","#4872a4","#1d4e89"],stops:["#954151","#db9793","#ead98b","#7295bf","#1d4e89"],tags:["reds","yellows","blues","diverging","colorblind-friendly"],name:"Blue and Red 6"},"div-green-gray-bright":{1:["#dae6d5"],2:["#757172","#5d7a06"],3:["#757172","#dae6d5","#5d7a06"],4:["#757172","#bcb8b4","#9ebb51","#5d7a06"],5:["#757172","#bcb8b4","#dae6d5","#9ebb51","#5d7a06"],6:["#757172","#a5a19e","#bcb8b4","#bfdc76","#9ebb51","#5d7a06"],7:["#757172","#a5a19e","#bcb8b4","#dae6d5","#bfdc76","#9ebb51","#5d7a06"],8:["#757172","#a5a19e","#bcb8b4","#d4d0ca","#dae6d5","#bfdc76","#9ebb51","#5d7a06"],9:["#757172","#a5a19e","#bcb8b4","#d4d0ca","#dae6d5","#bfdc76","#9ebb51","#7e9b2b","#5d7a06"],10:["#757172","#8d8988","#a5a19e","#bcb8b4","#d4d0ca","#dae6d5","#bfdc76","#9ebb51","#7e9b2b","#5d7a06"],stops:["#757172","#bcb8b4","#dae6d5","#9ebb51","#5d7a06"],tags:["light","grays","greens","bright","diverging","colorblind-friendly"],name:"Green and Gray 1"},"div-red-green-bright":{1:["#dedad2"],2:["#54bebe","#c80064"],3:["#54bebe","#dedad2","#c80064"],4:["#54bebe","#98d1d1","#df979e","#c80064"],5:["#54bebe","#98d1d1","#dedad2","#df979e","#c80064"],6:["#54bebe","#98d1d1","#dedad2","#e4bcad","#df979e","#c80064"],7:["#54bebe","#98d1d1","#badbdb","#dedad2","#e4bcad","#df979e","#c80064"],8:["#54bebe","#98d1d1","#badbdb","#dedad2","#e4bcad","#df979e","#d7658b","#c80064"],9:["#54bebe","#76c8c8","#98d1d1","#badbdb","#dedad2","#e4bcad","#df979e","#d7658b","#c80064"],10:["#54bebe","#76c8c8","#98d1d1","#badbdb","#dedad2","#e4bcad","#df979e","#d7658b","#d03277","#c80064"],stops:["#54bebe","#98d1d1","#dedad2","#df979e","#c80064"],tags:["light","blues","pinks","bright","diverging","colorblind-friendly"],name:"Pink and Blue 1"},"div-red-blue-bright":{1:["#c5c8d4"],2:["#4d7799","#b5515b"],3:["#4d7799","#c5c8d4","#b5515b"],4:["#4d7799","#7fa4c4","#d48e95","#b5515b"],5:["#4d7799","#7fa4c4","#c5c8d4","#d48e95","#b5515b"],6:["#4d7799","#7fa4c4","#98bbd9","#c5c8d4","#d48e95","#b5515b"],7:["#4d7799","#7fa4c4","#98bbd9","#c5c8d4","#e3adb2","#d48e95","#b5515b"],8:["#4d7799","#7fa4c4","#98bbd9","#c5c8d4","#f2cbcf","#e3adb2","#d48e95","#b5515b"],9:["#4d7799","#668eae","#7fa4c4","#98bbd9","#c5c8d4","#f2cbcf","#e3adb2","#d48e95","#b5515b"],10:["#4d7799","#668eae","#7fa4c4","#98bbd9","#c5c8d4","#f2cbcf","#e3adb2","#d48e95","#c46f78","#b5515b"],stops:["#4d7799","#7fa4c4","#c5c8d4","#d48e95","#b5515b"],tags:["light","blues","reds","diverging","colorblind-friendly"],name:"Blue and Red 7"},"div-orange-gray-bright":{1:["#d5cbcb"],2:["#6d717a","#a65a2c"],3:["#6d717a","#d5cbcb","#a65a2c"],4:["#6d717a","#a2a6b1","#db9167","#a65a2c"],5:["#6d717a","#a2a6b1","#d5cbcb","#db9167","#a65a2c"],6:["#6d717a","#a2a6b1","#d5cbcb","#e2b49a","#db9167","#a65a2c"],7:["#6d717a","#a2a6b1","#bcc1cc","#d5cbcb","#e2b49a","#db9167","#a65a2c"],8:["#6d717a","#a2a6b1","#bcc1cc","#d5cbcb","#edd5ca","#e2b49a","#db9167","#a65a2c"],9:["#6d717a","#878c95","#a2a6b1","#bcc1cc","#d5cbcb","#edd5ca","#e2b49a","#db9167","#a65a2c"],10:["#6d717a","#878c95","#a2a6b1","#bcc1cc","#d5cbcb","#edd5ca","#e2b49a","#db9167","#cc7441","#a65a2c"],stops:["#6d717a","#a2a6b1","#d5cbcb","#db9167","#a65a2c"],tags:["light","grays","browns","oranges","diverging","colorblind-friendly"],name:"Orange and Gray 1"},"div-blue-orange-bright":{1:["#d6cdcd"],2:["#bf5b1d","#547a99"],3:["#bf5b1d","#d6cdcd","#547a99"],4:["#bf5b1d","#e48043","#84a7c4","#547a99"],5:["#bf5b1d","#e48043","#d6cdcd","#84a7c4","#547a99"],6:["#bf5b1d","#e48043","#eb9b6a","#d6cdcd","#84a7c4","#547a99"],7:["#bf5b1d","#e48043","#eb9b6a","#d6cdcd","#9cbdd9","#84a7c4","#547a99"],8:["#bf5b1d","#d26d30","#e48043","#eb9b6a","#d6cdcd","#9cbdd9","#84a7c4","#547a99"],9:["#bf5b1d","#d26d30","#e48043","#eb9b6a","#d6cdcd","#9cbdd9","#84a7c4","#6c90ae","#547a99"],10:["#bf5b1d","#d26d30","#e48043","#eb9b6a","#f2b591","#d6cdcd","#9cbdd9","#84a7c4","#6c90ae","#547a99"],stops:["#bf5b1d","#e48043","#d6cdcd","#84a7c4","#547a99"],tags:["light","blues","oranges","diverging","colorblind-friendly"],name:"Blue and Orange 2"},"div-blue-lightgreen-bright":{1:["#99b9c3"],2:["#dbf2e3","#364187"],3:["#dbf2e3","#99b9c3","#364187"],4:["#c5ead4","#99b9c3","#6f72b2","#364187"],5:["#dbf2e3","#c5ead4","#99b9c3","#6f72b2","#364187"],6:["#dbf2e3","#c5ead4","#99b9c3","#a7a3dc","#6f72b2","#364187"],7:["#dbf2e3","#c5ead4","#98d9b5","#99b9c3","#a7a3dc","#6f72b2","#364187"],8:["#dbf2e3","#c5ead4","#98d9b5","#99b9c3","#a7a3dc","#8b8bc7","#6f72b2","#364187"],9:["#dbf2e3","#c5ead4","#aee1c4","#98d9b5","#99b9c3","#a7a3dc","#8b8bc7","#6f72b2","#364187"],10:["#dbf2e3","#c5ead4","#aee1c4","#98d9b5","#99b9c3","#a7a3dc","#8b8bc7","#6f72b2","#525a9c","#364187"],stops:["#dbf2e3","#c5ead4","#99b9c3","#6f72b2","#364187"],tags:["light","blues","purples","greens","diverging","colorblind-friendly"],name:"Green and Blue 2"},"div-red-gray-bright":{1:["#c7d3e5"],2:["#667181","#be3027"],3:["#667181","#c7d3e5","#be3027"],4:["#667181","#97a2b3","#d5857f","#be3027"],5:["#667181","#97a2b3","#ebd9d8","#d5857f","#be3027"],6:["#667181","#97a2b3","#c7d3e5","#ebd9d8","#d5857f","#be3027"],7:["#667181","#97a2b3","#c7d3e5","#ebd9d8","#e0afac","#d5857f","#be3027"],8:["#667181","#97a2b3","#afbbcc","#c7d3e5","#ebd9d8","#e0afac","#d5857f","#be3027"],9:["#667181","#97a2b3","#afbbcc","#c7d3e5","#ebd9d8","#e0afac","#d5857f","#c95a53","#be3027"],10:["#667181","#7e8a9a","#97a2b3","#afbbcc","#c7d3e5","#ebd9d8","#e0afac","#d5857f","#c95a53","#be3027"],stops:["#667181","#97a2b3","#ebd9d8","#d5857f","#be3027"],tags:["light","reds","grays","diverging","colorblind-friendly"],name:"Red and Gray 1"},"div-blue-gray-bright":{1:["#ced9d9"],2:["#78716e","#009db3"],3:["#78716e","#ced9d9","#009db3"],4:["#78716e","#a19b96","#54c5d5","#009db3"],5:["#78716e","#a19b96","#ced9d9","#54c5d5","#009db3"],6:["#78716e","#a19b96","#ced9d9","#7ed9e6","#54c5d5","#009db3"],7:["#78716e","#a19b96","#b5afaa","#ced9d9","#7ed9e6","#54c5d5","#009db3"],8:["#78716e","#a19b96","#b5afaa","#c9c4be","#ced9d9","#7ed9e6","#54c5d5","#009db3"],9:["#78716e","#a19b96","#b5afaa","#c9c4be","#ced9d9","#7ed9e6","#54c5d5","#2ab1c4","#009db3"],10:["#78716e","#8c8682","#a19b96","#b5afaa","#c9c4be","#ced9d9","#7ed9e6","#54c5d5","#2ab1c4","#009db3"],stops:["#78716e","#a19b96","#ced9d9","#54c5d5","#009db3"],tags:["light","blues","grays","bright","diverging","colorblind-friendly"],name:"Blue and Gray 1"},"div-red-lightgreen-bright":{1:["#bab0bf"],2:["#cfe6e6","#a60053"],3:["#cfe6e6","#bab0bf","#a60053"],4:["#cfe6e6","#a7d5d5","#da6aa2","#a60053"],5:["#cfe6e6","#a7d5d5","#bab0bf","#da6aa2","#a60053"],6:["#cfe6e6","#bbdddd","#a7d5d5","#da6aa2","#c94788","#a60053"],7:["#cfe6e6","#bbdddd","#a7d5d5","#bab0bf","#da6aa2","#c94788","#a60053"],8:["#cfe6e6","#bbdddd","#a7d5d5","#bab0bf","#da6aa2","#c94788","#b7236d","#a60053"],9:["#cfe6e6","#bbdddd","#a7d5d5","#93cccc","#bab0bf","#da6aa2","#c94788","#b7236d","#a60053"],10:["#cfe6e6","#bbdddd","#a7d5d5","#93cccc","#bab0bf","#eb8dbc","#da6aa2","#c94788","#b7236d","#a60053"],stops:["#cfe6e6","#a7d5d5","#bab0bf","#da6aa2","#a60053"],tags:["light","blues","pinks","diverging","colorblind-friendly"],name:"Pink and Blue 2"},"div-blue-green-bright":{1:["#dae1da"],2:["#3a8059","#434e96"],3:["#3a8059","#dae1da","#434e96"],4:["#3a8059","#85bf9b","#8a8fbf","#434e96"],5:["#3a8059","#85bf9b","#dae1da","#8a8fbf","#434e96"],6:["#3a8059","#85bf9b","#abdebc","#d1d0e7","#8a8fbf","#434e96"],7:["#3a8059","#85bf9b","#abdebc","#dae1da","#d1d0e7","#8a8fbf","#434e96"],8:["#3a8059","#85bf9b","#abdebc","#dae1da","#d1d0e7","#aeb0d3","#8a8fbf","#434e96"],9:["#3a8059","#609f7a","#85bf9b","#abdebc","#dae1da","#d1d0e7","#aeb0d3","#8a8fbf","#434e96"],10:["#3a8059","#609f7a","#85bf9b","#abdebc","#dae1da","#d1d0e7","#aeb0d3","#8a8fbf","#666faa","#434e96"],stops:["#3a8059","#85bf9b","#dae1da","#8a8fbf","#434e96"],tags:["light","blues","greens","diverging","colorblind-friendly"],name:"Green and Blue 3"},"div-purple-brown-bright":{1:["#dbd3d4"],2:["#935b44","#84628b"],3:["#935b44","#dbd3d4","#84628b"],4:["#935b44","#bc9483","#b49fbc","#84628b"],5:["#935b44","#bc9483","#dbd3d4","#b49fbc","#84628b"],6:["#935b44","#bc9483","#d9c4c2","#ccbed4","#b49fbc","#84628b"],7:["#935b44","#bc9483","#d9c4c2","#dbd3d4","#ccbed4","#b49fbc","#84628b"],8:["#935b44","#bc9483","#d1b1a3","#d9c4c2","#dbd3d4","#ccbed4","#b49fbc","#84628b"],9:["#935b44","#bc9483","#d1b1a3","#d9c4c2","#dbd3d4","#ccbed4","#b49fbc","#9c81a3","#84628b"],10:["#935b44","#a87864","#bc9483","#d1b1a3","#d9c4c2","#dbd3d4","#ccbed4","#b49fbc","#9c81a3","#84628b"],stops:["#935b44","#bc9483","#dbd3d4","#b49fbc","#84628b"],tags:["light","browns","purples","subdued","diverging","colorblind-friendly"],name:"Purple and Brown 1"},"div-blue-brown-bright":{1:["#cbd7e6"],2:["#946e43","#547a99"],3:["#946e43","#cbd7e6","#547a99"],4:["#946e43","#bd9f83","#90a9c0","#547a99"],5:["#946e43","#bd9f83","#cbd7e6","#90a9c0","#547a99"],6:["#946e43","#bd9f83","#cec7c5","#cbd7e6","#90a9c0","#547a99"],7:["#946e43","#bd9f83","#cec7c5","#cbd7e6","#adc0d3","#90a9c0","#547a99"],8:["#946e43","#bd9f83","#d1b7a3","#cec7c5","#cbd7e6","#adc0d3","#90a9c0","#547a99"],9:["#946e43","#bd9f83","#d1b7a3","#cec7c5","#cbd7e6","#adc0d3","#90a9c0","#7291ac","#547a99"],10:["#946e43","#a88663","#bd9f83","#d1b7a3","#cec7c5","#cbd7e6","#adc0d3","#90a9c0","#7291ac","#547a99"],stops:["#946e43","#bd9f83","#cbd7e6","#90a9c0","#547a99"],tags:["light","blues","browns","subdued","diverging","colorblind-friendly"],name:"Blue and Brown 2"},"div-teal-brown-bright":{1:["#d2dec8"],2:["#806c44","#448199"],3:["#806c44","#d2dec8","#448199"],4:["#806c44","#ad9d79","#8fb6bc","#448199"],5:["#806c44","#ad9d79","#d2dec8","#8fb6bc","#448199"],6:["#806c44","#ad9d79","#cbcaae","#b5d0cd","#8fb6bc","#448199"],7:["#806c44","#ad9d79","#cbcaae","#d2dec8","#b5d0cd","#8fb6bc","#448199"],8:["#806c44","#ad9d79","#c4b594","#cbcaae","#d2dec8","#b5d0cd","#8fb6bc","#448199"],9:["#806c44","#ad9d79","#c4b594","#cbcaae","#d2dec8","#b5d0cd","#8fb6bc","#6a9baa","#448199"],10:["#806c44","#97845f","#ad9d79","#c4b594","#cbcaae","#d2dec8","#b5d0cd","#8fb6bc","#6a9baa","#448199"],stops:["#806c44","#ad9d79","#d2dec8","#8fb6bc","#448199"],tags:["light","blues","browns","subdued","diverging","colorblind-friendly"],name:"Blue and Brown 3"},"div-green-teal-bright":{1:["#c8e6cf"],2:["#358c84","#5d7a06"],3:["#358c84","#c8e6cf","#5d7a06"],4:["#358c84","#73b5ae","#9cbd58","#5d7a06"],5:["#358c84","#73b5ae","#c8e6cf","#9cbd58","#5d7a06"],6:["#358c84","#73b5ae","#92cac2","#bcde81","#9cbd58","#5d7a06"],7:["#358c84","#73b5ae","#92cac2","#c8e6cf","#bcde81","#9cbd58","#5d7a06"],8:["#358c84","#73b5ae","#92cac2","#b1ded7","#c8e6cf","#bcde81","#9cbd58","#5d7a06"],9:["#358c84","#73b5ae","#92cac2","#b1ded7","#c8e6cf","#bcde81","#9cbd58","#7d9b2f","#5d7a06"],10:["#358c84","#54a199","#73b5ae","#92cac2","#b1ded7","#c8e6cf","#bcde81","#9cbd58","#7d9b2f","#5d7a06"],stops:["#358c84","#73b5ae","#c8e6cf","#9cbd58","#5d7a06"],tags:["light","blues","greens","diverging","colorblind-friendly"],name:"Green and Blue 4"},"div-lightgreen-yellow-bright":{1:["#505944"],2:["#ffea8c","#8cffdc"],3:["#ffea8c","#505944","#8cffdc"],4:["#ffea8c","#b3ab60","#5aa28b","#8cffdc"],5:["#ffea8c","#b3ab60","#505944","#5aa28b","#8cffdc"],6:["#ffea8c","#b3ab60","#666b33","#417363","#5aa28b","#8cffdc"],7:["#ffea8c","#b3ab60","#666b33","#505944","#417363","#5aa28b","#8cffdc"],8:["#ffea8c","#d9ca76","#b3ab60","#8c8b49","#417363","#5aa28b","#73d0b4","#8cffdc"],9:["#ffea8c","#d9ca76","#b3ab60","#8c8b49","#505944","#417363","#5aa28b","#73d0b4","#8cffdc"],10:["#ffea8c","#d9ca76","#b3ab60","#8c8b49","#666b33","#505944","#417363","#5aa28b","#73d0b4","#8cffdc"],stops:["#ffea8c","#b3ab60","#505944","#5aa28b","#8cffdc"],tags:["dark","blues","yellows","bright","diverging","colorblind-friendly"],name:"Blue and Yellow 1"},"div-lightblue-gray-bright":{1:["#757269"],2:["#faefdb","#80f3ff"],3:["#faefdb","#757269","#80f3ff"],4:["#faefdb","#a19c8f","#40b2c6","#80f3ff"],5:["#faefdb","#a19c8f","#00708d","#40b2c6","#80f3ff"],6:["#faefdb","#a19c8f","#50716e","#2091aa","#40b2c6","#80f3ff"],7:["#faefdb","#a19c8f","#50716e","#00708d","#2091aa","#40b2c6","#80f3ff"],8:["#faefdb","#cec5b5","#a19c8f","#757269","#2091aa","#40b2c6","#60d2e2","#80f3ff"],9:["#faefdb","#cec5b5","#a19c8f","#757269","#50716e","#2091aa","#40b2c6","#60d2e2","#80f3ff"],10:["#faefdb","#cec5b5","#a19c8f","#757269","#50716e","#00708d","#2091aa","#40b2c6","#60d2e2","#80f3ff"],stops:["#faefdb","#a19c8f","#00708d","#40b2c6","#80f3ff"],tags:["light","blues","grays","bright","diverging","colorblind-friendly"],name:"Blue and Gray 2"},"div-lightgreen-gray-bright":{1:["#555b61"],2:["#becdd9","#99ffc5"],3:["#becdd9","#555b61","#99ffc5"],4:["#becdd9","#788189","#64b47f","#99ffc5"],5:["#becdd9","#788189","#41543e","#64b47f","#99ffc5"],6:["#becdd9","#788189","#555b61","#4a8f5c","#64b47f","#99ffc5"],7:["#becdd9","#788189","#555b61","#2f6939","#4a8f5c","#64b47f","#99ffc5"],8:["#becdd9","#9ba7b1","#788189","#555b61","#4a8f5c","#64b47f","#7fdaa2","#99ffc5"],9:["#becdd9","#9ba7b1","#788189","#555b61","#41543e","#4a8f5c","#64b47f","#7fdaa2","#99ffc5"],10:["#becdd9","#9ba7b1","#788189","#555b61","#41543e","#2f6939","#4a8f5c","#64b47f","#7fdaa2","#99ffc5"],stops:["#becdd9","#788189","#41543e","#64b47f","#99ffc5"],tags:["dark","greens","grays","bright","diverging","colorblind-friendly"],name:"Green and Gray 2"},"div-lightred-gray-bright":{1:["#616673"],2:["#d4d9e6","#ffbdb3"],3:["#d4d9e6","#616673","#ffbdb3"],4:["#d4d9e6","#9ba0ad","#c27166","#ffbdb3"],5:["#d4d9e6","#9ba0ad","#616673","#c27166","#ffbdb3"],6:["#9ba0ad","#7e8390","#616673","#a44b40","#c27166","#e1978d"],7:["#9ba0ad","#7e8390","#616673","#6b472d","#a44b40","#c27166","#e1978d"],8:["#d4d9e6","#b7bcc9","#9ba0ad","#7e8390","#a44b40","#c27166","#e1978d","#ffbdb3"],9:["#b7bcc9","#9ba0ad","#7e8390","#616673","#6b472d","#a44b40","#c27166","#e1978d","#ffbdb3"],10:["#d4d9e6","#b7bcc9","#9ba0ad","#7e8390","#616673","#6b472d","#a44b40","#c27166","#e1978d","#ffbdb3"],stops:["#d4d9e6","#9ba0ad","#616673","#c27166","#ffbdb3"],tags:["dark","reds","grays","diverging","subdued","colorblind-friendly"],name:"Red and Gray 2"},"div-lightmagenta-gray-bright":{1:["#594154"],2:["#faefdb","#ff99ff"],3:["#faefdb","#594154","#ff99ff"],4:["#faefdb","#a7a194","#b650b6","#ff99ff"],5:["#faefdb","#a7a194","#594154","#b650b6","#ff99ff"],6:["#faefdb","#a7a194","#54534d","#922c91","#b650b6","#ff99ff"],7:["#faefdb","#a7a194","#54534d","#594154","#922c91","#b650b6","#ff99ff"],8:["#faefdb","#d1c8b8","#a7a194","#7e7a70","#922c91","#b650b6","#db75da","#ff99ff"],9:["#faefdb","#d1c8b8","#a7a194","#7e7a70","#594154","#922c91","#b650b6","#db75da","#ff99ff"],10:["#faefdb","#d1c8b8","#a7a194","#7e7a70","#54534d","#594154","#922c91","#b650b6","#db75da","#ff99ff"],stops:["#faefdb","#a7a194","#594154","#b650b6","#ff99ff"],tags:["dark","purples","bright","grays","diverging","colorblind-friendly"],name:"Purple and Gray 1"},"div-yellow-green-bright":{1:["#8fa17b"],2:["#38524d","#ffec99"],3:["#38524d","#8fa17b","#ffec99"],4:["#38524d","#4a7c6e","#ccbe6a","#ffec99"],5:["#38524d","#4a7c6e","#8fa17b","#ccbe6a","#ffec99"],6:["#38524d","#41675e","#53917f","#b3a752","#ccbe6a","#ffec99"],7:["#38524d","#41675e","#53917f","#8fa17b","#b3a752","#ccbe6a","#ffec99"],8:["#38524d","#41675e","#4a7c6e","#53917f","#b3a752","#ccbe6a","#e6d581","#ffec99"],9:["#38524d","#41675e","#4a7c6e","#53917f","#8fa17b","#b3a752","#ccbe6a","#e6d581","#ffec99"],10:["#38524d","#41675e","#4a7c6e","#53917f","#5ca68f","#8fa17b","#b3a752","#ccbe6a","#e6d581","#ffec99"],stops:["#38524d","#4a7c6e","#8fa17b","#ccbe6a","#ffec99"],tags:["dark","yellows","greens","diverging","colorblind-friendly"],name:"Green and Yellow 1"},"div-lightblue-yellow-bright":{1:["#4b595e"],2:["#ffea8c","#aadbff"],3:["#ffea8c","#4b595e","#aadbff"],4:["#ffea8c","#b3ab60","#6693c8","#aadbff"],5:["#ffea8c","#b3ab60","#4b595e","#6693c8","#aadbff"],6:["#ffea8c","#b3ab60","#8c8b49","#446fad","#6693c8","#aadbff"],7:["#ffea8c","#b3ab60","#8c8b49","#4b595e","#446fad","#6693c8","#aadbff"],8:["#ffea8c","#d9ca76","#b3ab60","#8c8b49","#446fad","#6693c8","#88b7e4","#aadbff"],9:["#ffea8c","#d9ca76","#b3ab60","#8c8b49","#4b595e","#446fad","#6693c8","#88b7e4","#aadbff"],10:["#ffea8c","#d9ca76","#b3ab60","#8c8b49","#666b33","#4b595e","#446fad","#6693c8","#88b7e4","#aadbff"],stops:["#ffea8c","#b3ab60","#4b595e","#6693c8","#aadbff"],tags:["dark","yellows","blues","bright","diverging","colorblind-friendly"],name:"Blue and Yellow 2"},"div-green-darkgray-bright":{1:["#4bb375"],2:["#4a4e54","#d9ffe9"],3:["#4a4e54","#4bb375","#d9ffe9"],4:["#4a4e54","#636a71","#92d9af","#d9ffe9"],5:["#4a4e54","#636a71","#4bb375","#92d9af","#d9ffe9"],6:["#575c63","#636a71","#6c8a83","#6fc692","#92d9af","#d9ffe9"],7:["#575c63","#636a71","#707880","#4bb375","#6fc692","#92d9af","#d9ffe9"],8:["#575c63","#636a71","#707880","#6c8a83","#6fc692","#92d9af","#b6eccc","#d9ffe9"],9:["#575c63","#636a71","#707880","#6c8a83","#4bb375","#6fc692","#92d9af","#b6eccc","#d9ffe9"],10:["#4a4e54","#575c63","#636a71","#707880","#6c8a83","#4bb375","#6fc692","#92d9af","#b6eccc","#d9ffe9"],stops:["#4a4e54","#636a71","#4bb375","#92d9af","#d9ffe9"],tags:["dark","grays","greens","diverging","colorblind-friendly"],name:"Green and Gray 3"},"div-brbg":{1:["#d8b365"],2:["#d8b365","#5ab4ac"],3:["#d8b365","#f5f5f5","#5ab4ac"],4:["#a6611a","#dfc27d","#80cdc1","#018571"],5:["#a6611a","#dfc27d","#f5f5f5","#80cdc1","#018571"],6:["#8c510a","#d8b365","#f6e8c3","#c7eae5","#5ab4ac","#01665e"],7:["#8c510a","#d8b365","#f6e8c3","#f5f5f5","#c7eae5","#5ab4ac","#01665e"],8:["#8c510a","#bf812d","#dfc27d","#f6e8c3","#c7eae5","#80cdc1","#35978f","#01665e"],9:["#8c510a","#bf812d","#dfc27d","#f6e8c3","#f5f5f5","#c7eae5","#80cdc1","#35978f","#01665e"],10:["#543005","#8c510a","#bf812d","#dfc27d","#f6e8c3","#c7eae5","#80cdc1","#35978f","#01665e","#003c30"],11:["#543005","#8c510a","#bf812d","#dfc27d","#f6e8c3","#f5f5f5","#c7eae5","#80cdc1","#35978f","#01665e","#003c30"],stops:["rgba(166, 97, 26, 1)","rgba(223, 194, 125, 1)","rgba(245, 245, 245, 1)","rgba(128, 205, 193, 1)","rgba(1, 133, 113, 1)"],tags:["light","browns","greens","diverging","colorblind-friendly"],name:"Green and Brown 1"},"div-piyg":{1:["#e9a3c9"],2:["#e9a3c9","#a1d76a"],3:["#e9a3c9","#f7f7f7","#a1d76a"],4:["#d01c8b","#f1b6da","#b8e186","#4dac26"],5:["#d01c8b","#f1b6da","#f7f7f7","#b8e186","#4dac26"],6:["#c51b7d","#e9a3c9","#fde0ef","#e6f5d0","#a1d76a","#4d9221"],7:["#c51b7d","#e9a3c9","#fde0ef","#f7f7f7","#e6f5d0","#a1d76a","#4d9221"],8:["#c51b7d","#de77ae","#f1b6da","#fde0ef","#e6f5d0","#b8e186","#7fbc41","#4d9221"],9:["#c51b7d","#de77ae","#f1b6da","#fde0ef","#f7f7f7","#e6f5d0","#b8e186","#7fbc41","#4d9221"],10:["#8e0152","#c51b7d","#de77ae","#f1b6da","#fde0ef","#e6f5d0","#b8e186","#7fbc41","#4d9221","#276419"],11:["#8e0152","#c51b7d","#de77ae","#f1b6da","#fde0ef","#f7f7f7","#e6f5d0","#b8e186","#7fbc41","#4d9221","#276419"],stops:["rgba(208, 28, 139, 1)","rgba(241, 182, 218, 1)","rgba(247, 247, 247, 1)","rgba(184, 225, 134, 1)","rgba(77, 172, 38, 1)"],tags:["light","pinks","bright","greens","diverging","colorblind-friendly"],name:"Green and Pink 1"},"div-prgn":{1:["#af8dc3"],2:["#af8dc3","#7fbf7b"],3:["#af8dc3","#f7f7f7","#7fbf7b"],4:["#7b3294","#c2a5cf","#a6dba0","#008837"],5:["#7b3294","#c2a5cf","#f7f7f7","#a6dba0","#008837"],6:["#762a83","#af8dc3","#e7d4e8","#d9f0d3","#7fbf7b","#1b7837"],7:["#762a83","#af8dc3","#e7d4e8","#f7f7f7","#d9f0d3","#7fbf7b","#1b7837"],8:["#762a83","#9970ab","#c2a5cf","#e7d4e8","#d9f0d3","#a6dba0","#5aae61","#1b7837"],9:["#762a83","#9970ab","#c2a5cf","#e7d4e8","#f7f7f7","#d9f0d3","#a6dba0","#5aae61","#1b7837"],10:["#40004b","#762a83","#9970ab","#c2a5cf","#e7d4e8","#d9f0d3","#a6dba0","#5aae61","#1b7837","#00441b"],11:["#40004b","#762a83","#9970ab","#c2a5cf","#e7d4e8","#f7f7f7","#d9f0d3","#a6dba0","#5aae61","#1b7837","#00441b"],stops:["rgba(123, 50, 148, 1)","rgba(194, 165, 207, 1)","rgba(247, 247, 247, 1)","rgba(166, 219, 160, 1)","rgba(0, 136, 55, 1)"],tags:["light","purples","greens","bright","diverging","colorblind-friendly"],name:"Purple and Green 5"},"div-puor":{1:["#f1a340"],2:["#f1a340","#998ec3"],3:["#f1a340","#f7f7f7","#998ec3"],4:["#e66101","#fdb863","#b2abd2","#5e3c99"],5:["#e66101","#fdb863","#f7f7f7","#b2abd2","#5e3c99"],6:["#b35806","#f1a340","#fee0b6","#d8daeb","#998ec3","#542788"],7:["#b35806","#f1a340","#fee0b6","#f7f7f7","#d8daeb","#998ec3","#542788"],8:["#b35806","#e08214","#fdb863","#fee0b6","#d8daeb","#b2abd2","#8073ac","#542788"],9:["#b35806","#e08214","#fdb863","#fee0b6","#f7f7f7","#d8daeb","#b2abd2","#8073ac","#542788"],10:["#7f3b08","#b35806","#e08214","#fdb863","#fee0b6","#d8daeb","#b2abd2","#8073ac","#542788","#2d004b"],11:["#7f3b08","#b35806","#e08214","#fdb863","#fee0b6","#f7f7f7","#d8daeb","#b2abd2","#8073ac","#542788","#2d004b"],stops:["rgba(230, 97, 1, 1)","rgba(253, 184, 99, 1)","rgba(247, 247, 247, 1)","rgba(178, 171, 210, 1)","rgba(94, 60, 153, 1)"],tags:["light","browns","purples","oranges","diverging","colorblind-friendly"],name:"Purple and Brown 2"},"div-rdbu":{1:["#ef8a62"],2:["#ef8a62","#67a9cf"],3:["#ef8a62","#f7f7f7","#67a9cf"],4:["#ca0020","#f4a582","#92c5de","#0571b0"],5:["#ca0020","#f4a582","#f7f7f7","#92c5de","#0571b0"],6:["#b2182b","#ef8a62","#fddbc7","#d1e5f0","#67a9cf","#2166ac"],7:["#b2182b","#ef8a62","#fddbc7","#f7f7f7","#d1e5f0","#67a9cf","#2166ac"],8:["#b2182b","#d6604d","#f4a582","#fddbc7","#d1e5f0","#92c5de","#4393c3","#2166ac"],9:["#b2182b","#d6604d","#f4a582","#fddbc7","#f7f7f7","#d1e5f0","#92c5de","#4393c3","#2166ac"],10:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#d1e5f0","#92c5de","#4393c3","#2166ac","#053061"],11:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#f7f7f7","#d1e5f0","#92c5de","#4393c3","#2166ac","#053061"],stops:["rgba(202, 0, 32, 1)","rgba(244, 165, 130, 1)","rgba(247, 247, 247, 1)","rgba(146, 197, 222, 1)","rgba(5, 113, 176, 1)"],tags:["light","reds","blues","diverging","bright","colorblind-friendly"],name:"Blue and Red 8"},"div-rdgy":{1:["#ef8a62"],2:["#ef8a62","#999999"],3:["#ef8a62","#ffffff","#999999"],4:["#ca0020","#f4a582","#bababa","#404040"],5:["#ca0020","#f4a582","#ffffff","#bababa","#404040"],6:["#b2182b","#ef8a62","#fddbc7","#e0e0e0","#999999","#4d4d4d"],7:["#b2182b","#ef8a62","#fddbc7","#ffffff","#e0e0e0","#999999","#4d4d4d"],8:["#b2182b","#d6604d","#f4a582","#fddbc7","#e0e0e0","#bababa","#878787","#4d4d4d"],9:["#b2182b","#d6604d","#f4a582","#fddbc7","#ffffff","#e0e0e0","#bababa","#878787","#4d4d4d"],10:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#e0e0e0","#bababa","#878787","#4d4d4d","#1a1a1a"],11:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#ffffff","#e0e0e0","#bababa","#878787","#4d4d4d","#1a1a1a"],stops:["rgba(202, 0, 32, 1)","rgba(244, 165, 130, 1)","rgba(255, 255, 255, 1)","rgba(186, 186, 186, 1)","rgba(64, 64, 64, 1)"],tags:["light","grays","reds","diverging","colorblind-friendly"],name:"Red and Gray 3"},"div-rdylbu":{1:["#fc8d59"],2:["#fc8d59","#91bfdb"],3:["#fc8d59","#ffffbf","#91bfdb"],4:["#d7191c","#fdae61","#abd9e9","#2c7bb6"],5:["#d7191c","#fdae61","#ffffbf","#abd9e9","#2c7bb6"],6:["#d73027","#fc8d59","#fee090","#e0f3f8","#91bfdb","#4575b4"],7:["#d73027","#fc8d59","#fee090","#ffffbf","#e0f3f8","#91bfdb","#4575b4"],8:["#d73027","#f46d43","#fdae61","#fee090","#e0f3f8","#abd9e9","#74add1","#4575b4"],9:["#d73027","#f46d43","#fdae61","#fee090","#ffffbf","#e0f3f8","#abd9e9","#74add1","#4575b4"],10:["#a50026","#d73027","#f46d43","#fdae61","#fee090","#e0f3f8","#abd9e9","#74add1","#4575b4","#313695"],11:["#a50026","#d73027","#f46d43","#fdae61","#fee090","#ffffbf","#e0f3f8","#abd9e9","#74add1","#4575b4","#313695"],stops:["rgba(215, 25, 28, 1)","rgba(253, 174, 97, 1)","rgba(255, 255, 191, 1)","rgba(171, 217, 233, 1)","rgba(44, 123, 182, 1)"],tags:["light","blues","reds","oranges","diverging","bright","colorblind-friendly"],name:"Blue and Red 9"},"div-rdylgn":{1:["#fc8d59"],2:["#fc8d59","#91cf60"],3:["#fc8d59","#ffffbf","#91cf60"],4:["#d7191c","#fdae61","#a6d96a","#1a9641"],5:["#d7191c","#fdae61","#ffffbf","#a6d96a","#1a9641"],6:["#d73027","#fc8d59","#fee08b","#d9ef8b","#91cf60","#1a9850"],7:["#d73027","#fc8d59","#fee08b","#ffffbf","#d9ef8b","#91cf60","#1a9850"],8:["#d73027","#f46d43","#fdae61","#fee08b","#d9ef8b","#a6d96a","#66bd63","#1a9850"],9:["#d73027","#f46d43","#fdae61","#fee08b","#ffffbf","#d9ef8b","#a6d96a","#66bd63","#1a9850"],10:["#a50026","#d73027","#f46d43","#fdae61","#fee08b","#d9ef8b","#a6d96a","#66bd63","#1a9850","#006837"],11:["#a50026","#d73027","#f46d43","#fdae61","#fee08b","#ffffbf","#d9ef8b","#a6d96a","#66bd63","#1a9850","#006837"],stops:["rgba(215, 25, 28, 1)","rgba(253, 174, 97, 1)","rgba(255, 255, 191, 1)","rgba(166, 217, 106, 1)","rgba(26, 150, 65, 1)"],tags:["light","reds","bright","greens","diverging"],name:"Red and Green 9"},"div-spectral":{1:["#fc8d59"],2:["#fc8d59","#99d594"],3:["#fc8d59","#ffffbf","#99d594"],4:["#d7191c","#fdae61","#abdda4","#2b83ba"],5:["#d7191c","#fdae61","#ffffbf","#abdda4","#2b83ba"],6:["#d53e4f","#fc8d59","#fee08b","#e6f598","#99d594","#3288bd"],7:["#d53e4f","#fc8d59","#fee08b","#ffffbf","#e6f598","#99d594","#3288bd"],8:["#d53e4f","#f46d43","#fdae61","#fee08b","#e6f598","#abdda4","#66c2a5","#3288bd"],9:["#d53e4f","#f46d43","#fdae61","#fee08b","#ffffbf","#e6f598","#abdda4","#66c2a5","#3288bd"],10:["#9e0142","#d53e4f","#f46d43","#fdae61","#fee08b","#e6f598","#abdda4","#66c2a5","#3288bd","#5e4fa2"],11:["#9e0142","#d53e4f","#f46d43","#fdae61","#fee08b","#ffffbf","#e6f598","#abdda4","#66c2a5","#3288bd","#5e4fa2"],stops:["rgba(215, 25, 28, 1)","rgba(253, 174, 97, 1)","rgba(255, 255, 191, 1)","rgba(171, 221, 164, 1)","rgba(43, 131, 186, 1)"],tags:["light","reds","oranges","yellows","blues","greens","bright","diverging"],name:"Blue and Red 10"},"div-yellow-orange-purple-bright":{1:["#ffb400"],2:["#ffb400","#9080ff"],3:["#ffb400","#363445","#9080ff"],4:["#ffb400","#a57c1b","#5e569b","#9080ff"],5:["#ffb400","#a57c1b","#363445","#5e569b","#9080ff"],6:["#ffb400","#a57c1b","#786028","#48446e","#5e569b","#9080ff"],7:["#ffb400","#a57c1b","#786028","#363445","#48446e","#5e569b","#9080ff"],8:["#ffb400","#d2980d","#a57c1b","#786028","#363445","#48446e","#5e569b","#9080ff"],9:["#ffb400","#d2980d","#a57c1b","#786028","#363445","#48446e","#5e569b","#776bcd","#9080ff"],10:["#ffb400","#d2980d","#a57c1b","#786028","#454034","#363445","#48446e","#5e569b","#776bcd","#9080ff"],stops:["#ffb400","#a57c1b","#363445","#5e569b","#9080ff"],tags:["dark","yellows","oranges","purples","bright","diverging","colorblind-friendly"],name:"Purple and Orange 2"},"div-yellow-blue-bright-1":{1:["#ffc700"],2:["#ffc700","#6ca0ff"],3:["#ffc700","#343a45","#6ca0ff"],4:["#ffc700","#a4861c","#4c689b","#6ca0ff"],5:["#ffc700","#a4861c","#343a45","#4c689b","#6ca0ff"],6:["#ffc700","#a4861c","#77662a","#3c4c69","#4c689b","#6ca0ff"],7:["#ffc700","#a4861c","#77662a","#343a45","#3c4c69","#4c689b","#6ca0ff"],8:["#ffc700","#d2a60e","#a4861c","#77662a","#343a45","#3c4c69","#4c689b","#6ca0ff"],9:["#ffc700","#d2a60e","#a4861c","#77662a","#343a45","#3c4c69","#4c689b","#5c84cd","#6ca0ff"],10:["#ffc700","#d2a60e","#a4861c","#77662a","#4a4538","#343a45","#3c4c69","#4c689b","#5c84cd","#6ca0ff"],stops:["#ffc700","#a4861c","#343a45","#4c689b","#6ca0ff"],tags:["dark","yellows","blues","bright","diverging","colorblind-friendly"],name:"Blue and Yellow 6"},"div-yellow-blue-bright-2":{1:["#ffda00"],2:["#ffda00","#48c0ff"],3:["#ffda00","#343f45","#48c0ff"],4:["#ffda00","#a4901c","#3b799b","#48c0ff"],5:["#ffda00","#a4901c","#343f45","#3b799b","#48c0ff"],6:["#ffda00","#a4901c","#776b2a","#345669","#3b799b","#48c0ff"],7:["#ffda00","#a4901c","#776b2a","#343f45","#345669","#3b799b","#48c0ff"],8:["#ffda00","#d2b50e","#a4901c","#776b2a","#343f45","#345669","#3b799b","#48c0ff"],9:["#ffda00","#d2b50e","#a4901c","#776b2a","#343f45","#345669","#3b799b","#419dcd","#48c0ff"],10:["#ffda00","#d2b50e","#a4901c","#776b2a","#4a4738","#343f45","#345669","#3b799b","#419dcd","#48c0ff"],stops:["#ffda00","#a4901c","#343f45","#3b799b","#48c0ff"],tags:["dark","blues","yellows","bright","diverging","colorblind-friendly"],name:"Blue and Yellow 7"},"div-yellow-blue-bright":{1:["#ffff00"],2:["#ffff00","#00ffff"],3:["#ffff00","#344545","#00ffff"],4:["#ffff00","#a4a41c","#219797","#00ffff"],5:["#ffff00","#a4a41c","#344545","#219797","#00ffff"],6:["#ffff00","#a4a41c","#77772a","#316363","#219797","#00ffff"],7:["#ffff00","#a4a41c","#77772a","#344545","#316363","#219797","#00ffff"],8:["#ffff00","#d2d20e","#a4a41c","#77772a","#344545","#316363","#219797","#00ffff"],9:["#ffff00","#d2d20e","#a4a41c","#77772a","#344545","#316363","#219797","#10cbcb","#00ffff"],10:["#ffff00","#d2d20e","#a4a41c","#77772a","#4f4f3c","#344545","#316363","#219797","#10cbcb","#00ffff"],stops:["#ffff00","#a4a41c","#344545","#219797","#00ffff"],tags:["dark","yellows","greens","blues","diverging","colorblind-friendly"],name:"Blue and Yellow 8"},"div-yellow-blue-bright-3":{1:["#e8ff00"],2:["#e8ff00","#4a99ff"],3:["#e8ff00","#3b434f","#4a99ff"],4:["#e8ff00","#97a41c","#3f69a2","#4a99ff"],5:["#e8ff00","#97a41c","#3b434f","#3f69a2","#4a99ff"],6:["#e8ff00","#97a41c","#6f772a","#395173","#3f69a2","#4a99ff"],7:["#e8ff00","#97a41c","#6f772a","#3b434f","#395173","#3f69a2","#4a99ff"],8:["#e8ff00","#c0d20e","#97a41c","#6f772a","#3b434f","#395173","#3f69a2","#4a99ff"],9:["#e8ff00","#c0d20e","#97a41c","#6f772a","#3b434f","#395173","#3f69a2","#4481d0","#4a99ff"],10:["#e8ff00","#c0d20e","#97a41c","#6f772a","#50523e","#3b434f","#395173","#3f69a2","#4481d0","#4a99ff"],stops:["#e8ff00","#97a41c","#3b434f","#3f69a2","#4a99ff"],tags:["dark","yellows","blues","diverging","colorblind-friendly"],name:"Blue and Yellow 9"},"div-yellow-purple-bright-1":{1:["#e8ff00"],2:["#e8ff00","#8c80ff"],3:["#e8ff00","#413f54","#8c80ff"],4:["#e8ff00","#97a41c","#655dbb","#8c80ff"],5:["#e8ff00","#97a41c","#413f54","#655dbb","#8c80ff"],6:["#e8ff00","#97a41c","#6f772a","#524b99","#655dbb","#8c80ff"],7:["#e8ff00","#97a41c","#6f772a","#413f54","#524b99","#655dbb","#8c80ff"],8:["#e8ff00","#c0d20e","#97a41c","#6f772a","#413f54","#524b99","#655dbb","#8c80ff"],9:["#e8ff00","#c0d20e","#97a41c","#6f772a","#413f54","#524b99","#655dbb","#796edd","#8c80ff"],10:["#e8ff00","#c0d20e","#97a41c","#6f772a","#50523e","#413f54","#524b99","#655dbb","#796edd","#8c80ff"],stops:["#e8ff00","#97a41c","#413f54","#655dbb","#8c80ff"],tags:["dark","yellows","purples","bright","diverging","colorblind-friendly"],name:"Purple and Yellow 2"},"div-yellow-purple-bright-2":{1:["#d0ff00"],2:["#d0ff00","#ac4dff"],3:["#d0ff00","#3d3345","#ac4dff"],4:["#d0ff00","#7f9717","#6f3d9c","#ac4dff"],5:["#d0ff00","#7f9717","#3d3345","#6f3d9c","#ac4dff"],6:["#d0ff00","#7f9717","#576323","#51356b","#6f3d9c","#ac4dff"],7:["#d0ff00","#7f9717","#576323","#3d3345","#51356b","#6f3d9c","#ac4dff"],8:["#d0ff00","#a8cb0c","#7f9717","#576323","#3d3345","#51356b","#6f3d9c","#ac4dff"],9:["#d0ff00","#a8cb0c","#7f9717","#576323","#3d3345","#51356b","#6f3d9c","#8e45ce","#ac4dff"],10:["#d0ff00","#a8cb0c","#7f9717","#576323","#424534","#3d3345","#51356b","#6f3d9c","#8e45ce","#ac4dff"],stops:["#d0ff00","#7f9717","#3d3345","#6f3d9c","#ac4dff"],tags:["dark","greens","purples","bright","diverging","colorblind-friendly"],name:"Purple and Yellow 3"},"div-yellow-red-bright-1":{1:["#d0ff00"],2:["#d0ff00","#fb2bff"],3:["#d0ff00","#443745","#fb2bff"],4:["#d0ff00","#7f9717","#98319b","#fb2bff"],5:["#d0ff00","#7f9717","#443745","#98319b","#fb2bff"],6:["#d0ff00","#7f9717","#576323","#673469","#98319b","#fb2bff"],7:["#d0ff00","#7f9717","#576323","#443745","#673469","#98319b","#fb2bff"],8:["#d0ff00","#a8cb0c","#7f9717","#576323","#443745","#673469","#98319b","#fb2bff"],9:["#d0ff00","#a8cb0c","#7f9717","#576323","#443745","#673469","#98319b","#ca2ecd","#fb2bff"],10:["#d0ff00","#a8cb0c","#7f9717","#576323","#424534","#443745","#673469","#98319b","#ca2ecd","#fb2bff"],stops:["#d0ff00","#7f9717","#443745","#98319b","#fb2bff"],tags:["dark","pinks","greens","purples","bright","diverging","colorblind-friendly"],name:"Pink and Yellow 3"},"div-yellow-red-bright-2":{1:["#d0ff00"],2:["#d0ff00","#ff0099"],3:["#d0ff00","#45373f","#ff0099"],4:["#d0ff00","#7f9717","#9b236b","#ff0099"],5:["#d0ff00","#7f9717","#45373f","#9b236b","#ff0099"],6:["#d0ff00","#7f9717","#576323","#693454","#9b236b","#ff0099"],7:["#d0ff00","#7f9717","#576323","#45373f","#693454","#9b236b","#ff0099"],8:["#d0ff00","#a8cb0c","#7f9717","#576323","#45373f","#693454","#9b236b","#ff0099"],9:["#d0ff00","#a8cb0c","#7f9717","#576323","#45373f","#693454","#9b236b","#cd1182","#ff0099"],10:["#d0ff00","#a8cb0c","#7f9717","#576323","#424534","#45373f","#693454","#9b236b","#cd1182","#ff0099"],stops:["#d0ff00","#7f9717","#45373f","#9b236b","#ff0099"],tags:["dark","greens","pinks","bright","diverging","colorblind-friendly"],name:"Pink and Yellow 4"},"div-yellow-gray-bright-1":{1:["#ffff00"],2:["#ffff00","#cccccc"],3:["#ffff00","#424038","#cccccc"],4:["#ffff00","#a4a41c","#8a8a8a","#cccccc"],5:["#ffff00","#a4a41c","#424038","#8a8a8a","#cccccc"],6:["#ffff00","#a4a41c","#77772a","#5e5e5e","#8a8a8a","#cccccc"],7:["#ffff00","#a4a41c","#77772a","#424038","#5e5e5e","#8a8a8a","#cccccc"],8:["#ffff00","#d2d20e","#a4a41c","#77772a","#424038","#5e5e5e","#8a8a8a","#cccccc"],9:["#ffff00","#d2d20e","#a4a41c","#77772a","#424038","#5e5e5e","#8a8a8a","#ababab","#cccccc"],10:["#ffff00","#d2d20e","#a4a41c","#77772a","#4f4f3c","#424038","#5e5e5e","#8a8a8a","#ababab","#cccccc"],stops:["#ffff00","#a4a41c","#424038","#8a8a8a","#cccccc"],tags:["dark","yellows","grays","bright","diverging","colorblind-friendly"],name:"Yellow and Gray 1"},"div-yellow-gray-bright-2":{1:["#ffff00"],2:["#ffff00","#aab2c8"],3:["#ffff00","#383b42","#aab2c8"],4:["#ffff00","#a4a41c","#727681","#aab2c8"],5:["#ffff00","#a4a41c","#383b42","#727681","#aab2c8"],6:["#ffff00","#a4a41c","#77772a","#50545e","#727681","#aab2c8"],7:["#ffff00","#a4a41c","#77772a","#383b42","#50545e","#727681","#aab2c8"],8:["#ffff00","#d2d20e","#a4a41c","#77772a","#383b42","#50545e","#727681","#aab2c8"],9:["#ffff00","#d2d20e","#a4a41c","#77772a","#383b42","#50545e","#727681","#9196a5","#aab2c8"],10:["#ffff00","#d2d20e","#a4a41c","#77772a","#4f4f3c","#383b42","#50545e","#727681","#9196a5","#aab2c8"],stops:["#ffff00","#a4a41c","#383b42","#727681","#aab2c8"],tags:["dark","yellows","grays","bright","diverging","colorblind-friendly"],name:"Yellow and Gray 2"},"div-yellow-gray-bright-3":{1:["#d0ff00"],2:["#d0ff00","#ccafaf"],3:["#d0ff00","#3d3434","#ccafaf"],4:["#d0ff00","#849c19","#837171","#ccafaf"],5:["#d0ff00","#849c19","#3d3434","#837171","#ccafaf"],6:["#d0ff00","#849c19","#5e6b26","#5e5151","#837171","#ccafaf"],7:["#d0ff00","#849c19","#5e6b26","#3d3434","#5e5151","#837171","#ccafaf"],8:["#d0ff00","#aace0d","#849c19","#5e6b26","#3d3434","#5e5151","#837171","#ccafaf"],9:["#d0ff00","#aace0d","#849c19","#5e6b26","#3d3434","#5e5151","#837171","#a79090","#ccafaf"],10:["#d0ff00","#aace0d","#849c19","#5e6b26","#4a4d3a","#3d3434","#5e5151","#837171","#a79090","#ccafaf"],stops:["#d0ff00","#849c19","#3d3434","#837171","#ccafaf"],tags:["dark","greens","grays","bright","diverging","colorblind-friendly"],name:"Yellow and Gray 3"},"div-purple-green-bright-1":{1:["#c333ff"],2:["#c333ff","#00ff32"],3:["#c333ff","#37453a","#00ff32"],4:["#c333ff","#8c2db2","#179930","#00ff32"],5:["#c333ff","#8c2db2","#37453a","#179930","#00ff32"],6:["#c333ff","#8c2db2","#702a8c","#22662f","#179930","#00ff32"],7:["#c333ff","#8c2db2","#702a8c","#37453a","#22662f","#179930","#00ff32"],8:["#c333ff","#a730d9","#8c2db2","#702a8c","#37453a","#22662f","#179930","#00ff32"],9:["#c333ff","#a730d9","#8c2db2","#702a8c","#37453a","#22662f","#179930","#0bcc31","#00ff32"],10:["#c333ff","#a730d9","#8c2db2","#702a8c","#403445","#37453a","#22662f","#179930","#0bcc31","#00ff32"],stops:["#c333ff","#8c2db2","#37453a","#179930","#00ff32"],tags:["dark","purples","greens","bright","diverging","colorblind-friendly"],name:"Purple and Green 9"},"div-purple-green-bright-2":{1:["#ff00ff"],2:["#ff00ff","#beff00"],3:["#ff00ff","#414537","#beff00"],4:["#ff00ff","#b21bb2","#76961d","#beff00"],5:["#ff00ff","#b21bb2","#414537","#76961d","#beff00"],6:["#ff00ff","#b21bb2","#8c2a8c","#52612c","#76961d","#beff00"],7:["#ff00ff","#b21bb2","#8c2a8c","#414537","#52612c","#76961d","#beff00"],8:["#ff00ff","#d90ed9","#b21bb2","#8c2a8c","#414537","#52612c","#76961d","#beff00"],9:["#ff00ff","#d90ed9","#b21bb2","#8c2a8c","#414537","#52612c","#76961d","#9aca0f","#beff00"],10:["#ff00ff","#d90ed9","#b21bb2","#8c2a8c","#453445","#414537","#52612c","#76961d","#9aca0f","#beff00"],stops:["#ff00ff","#b21bb2","#414537","#76961d","#beff00"],tags:["dark","purples","pinks","greens","bright","diverging","colorblind-friendly"],name:"Green and Pink 2"},"div-pink-yellow-bright-1":{1:["#ff00cc"],2:["#ff00cc","#ffff00"],3:["#ff00cc","#453442","#ffff00"],4:["#ff00cc","#b21c97","#96961d","#ffff00"],5:["#ff00cc","#b21c97","#453442","#96961d","#ffff00"],6:["#ff00cc","#b21c97","#8c2a7c","#61612c","#96961d","#ffff00"],7:["#ff00cc","#b21c97","#8c2a7c","#453442","#61612c","#96961d","#ffff00"],8:["#ff00cc","#d90eb1","#b21c97","#8c2a7c","#453442","#61612c","#96961d","#ffff00"],9:["#ff00cc","#d90eb1","#b21c97","#8c2a7c","#453442","#61612c","#96961d","#caca0f","#ffff00"],10:["#ff00cc","#d90eb1","#b21c97","#8c2a7c","#453442","#454537","#61612c","#96961d","#caca0f","#ffff00"],stops:["#ff00cc","#b21c97","#453442","#96961d","#ffff00"],tags:["dark","pinks","yellows","bright","diverging","colorblind-friendly"],name:"Pink and Yellow 1"},"div-pink-yellow-bright-2":{1:["#ff0099"],2:["#ff0099","#ffc800"],3:["#ff0099","#45343e","#ffc800"],4:["#ff0099","#aa1970","#92781c","#ffc800"],5:["#ff0099","#aa1970","#45343e","#92781c","#ffc800"],6:["#ff0099","#aa1970","#80265b","#5c502a","#92781c","#ffc800"],7:["#ff0099","#aa1970","#80265b","#45343e","#5c502a","#92781c","#ffc800"],8:["#ff0099","#d50d84","#aa1970","#80265b","#45343e","#5c502a","#92781c","#ffc800"],9:["#ff0099","#d50d84","#aa1970","#80265b","#45343e","#5c502a","#92781c","#c9a00e","#ffc800"],10:["#ff0099","#d50d84","#aa1970","#80265b","#45343e","#474439","#5c502a","#92781c","#c9a00e","#ffc800"],stops:["#ff0099","#aa1970","#45343e","#92781c","#ffc800"],tags:["dark","pinks","yellows","bright","diverging","colorblind-friendly"],name:"Pink and Yellow 2"},"div-red-blue-bright-1":{1:["#ff4d6a"],2:["#ff4d6a","#23ccff"],3:["#ff4d6a","#453437","#23ccff"],4:["#ff4d6a","#a63245","#2b819b","#23ccff"],5:["#ff4d6a","#a63245","#453437","#2b819b","#23ccff"],6:["#ff4d6a","#a63245","#7a2433","#2f5b69","#2b819b","#23ccff"],7:["#ff4d6a","#a63245","#7a2433","#453437","#2f5b69","#2b819b","#23ccff"],8:["#ff4d6a","#d33f58","#a63245","#7a2433","#453437","#2f5b69","#2b819b","#23ccff"],9:["#ff4d6a","#d33f58","#a63245","#7a2433","#453437","#2f5b69","#2b819b","#27a6cd","#23ccff"],10:["#ff4d6a","#d33f58","#a63245","#7a2433","#453437","#34474f","#2f5b69","#2b819b","#27a6cd","#23ccff"],stops:["#ff4d6a","#a63245","#453437","#2b819b","#23ccff"],tags:["dark","reds","pinks","blues","bright","diverging","colorblind-friendly"],name:"Blue and Red 13"},"div-red-blue-bright-2":{1:["#ff2638"],2:["#ff2638","#1993ff"],3:["#ff2638","#403031","#1993ff"],4:["#ff2638","#a6242e","#2e6ca4","#1993ff"],5:["#ff2638","#a6242e","#403031","#2e6ca4","#1993ff"],6:["#ff2638","#a6242e","#7a2329","#395976","#2e6ca4","#1993ff"],7:["#ff2638","#a6242e","#7a2329","#403031","#395976","#2e6ca4","#1993ff"],8:["#ff2638","#d32533","#a6242e","#7a2329","#403031","#395976","#2e6ca4","#1993ff"],9:["#ff2638","#d32533","#a6242e","#7a2329","#403031","#395976","#2e6ca4","#2480d1","#1993ff"],10:["#ff2638","#d32533","#a6242e","#7a2329","#403031","#373e45","#395976","#2e6ca4","#2480d1","#1993ff"],stops:["#ff2638","#a6242e","#403031","#2e6ca4","#1993ff"],tags:["dark","reds","blues","bright","diverging","colorblind-friendly"],name:"Blue and Red 14"},"div-orange-blue-bright-3":{1:["#ff6219"],2:["#ff6219","#00ffdc"],3:["#ff6219","#3b312c","#00ffdc"],4:["#ff6219","#9c461e","#1f9787","#00ffdc"],5:["#ff6219","#9c461e","#3b312c","#1f9787","#00ffdc"],6:["#ff6219","#9c461e","#6b3820","#2e635c","#1f9787","#00ffdc"],7:["#ff6219","#9c461e","#6b3820","#3b312c","#2e635c","#1f9787","#00ffdc"],8:["#ff6219","#ce541b","#9c461e","#6b3820","#3b312c","#2e635c","#1f9787","#00ffdc"],9:["#ff6219","#ce541b","#9c461e","#6b3820","#3b312c","#2e635c","#1f9787","#0fcbb1","#00ffdc"],10:["#ff6219","#ce541b","#9c461e","#6b3820","#3b312c","#394745","#2e635c","#1f9787","#0fcbb1","#00ffdc"],stops:["#ff6219","#9c461e","#3b312c","#1f9787","#00ffdc"],tags:["dark","oranges","greens","blues","bright","diverging","colorblind-friendly"],name:"Blue and Orange 8"},"div-orange-blue-bright-4":{1:["#ff6219"],2:["#ff6219","#66a0ff"],3:["#ff6219","#3b312c","#66a0ff"],4:["#ff6219","#9c461e","#4c6da5","#66a0ff"],5:["#ff6219","#9c461e","#3b312c","#4c6da5","#66a0ff"],6:["#ff6219","#9c461e","#6b3820","#3f5478","#4c6da5","#66a0ff"],7:["#ff6219","#9c461e","#6b3820","#3b312c","#3f5478","#4c6da5","#66a0ff"],8:["#ff6219","#ce541b","#9c461e","#6b3820","#3b312c","#3f5478","#4c6da5","#66a0ff"],9:["#ff6219","#ce541b","#9c461e","#6b3820","#3b312c","#3f5478","#4c6da5","#5987d2","#66a0ff"],10:["#ff6219","#ce541b","#9c461e","#6b3820","#3b312c","#393e47","#3f5478","#4c6da5","#5987d2","#66a0ff"],stops:["#ff6219","#9c461e","#3b312c","#4c6da5","#66a0ff"],tags:["dark","oranges","blues","bright","diverging","colorblind-friendly"],name:"Blue and Orange 9"},"div-red-purple-bright":{1:["#ff5000"],2:["#ff5000","#9333ff"],3:["#ff5000","#382f2a","#9333ff"],4:["#ff5000","#9c3f15","#6c3ba4","#9333ff"],5:["#ff5000","#9c3f15","#382f2a","#6c3ba4","#9333ff"],6:["#ff5000","#9c3f15","#6b3620","#593f76","#6c3ba4","#9333ff"],7:["#ff5000","#9c3f15","#6b3620","#382f2a","#593f76","#6c3ba4","#9333ff"],8:["#ff5000","#ce470b","#9c3f15","#6b3620","#382f2a","#593f76","#6c3ba4","#9333ff"],9:["#ff5000","#ce470b","#9c3f15","#6b3620","#382f2a","#593f76","#6c3ba4","#8037d1","#9333ff"],10:["#ff5000","#ce470b","#9c3f15","#6b3620","#382f2a","#433952","#593f76","#6c3ba4","#8037d1","#9333ff"],stops:["#ff5000","#9c3f15","#382f2a","#6c3ba4","#9333ff"],tags:["dark","reds","purples","bright","diverging","colorblind-friendly"],name:"Purple and Orange 1"},"div-red-gray-bright-1":{1:["#ff1947"],2:["#ff1947","#cccccc"],3:["#ff1947","#3b2d30","#cccccc"],4:["#ff1947","#9c253d","#7f7f7f","#cccccc"],5:["#ff1947","#9c253d","#3b2d30","#7f7f7f","#cccccc"],6:["#ff1947","#9c253d","#6b2b38","#595959","#7f7f7f","#cccccc"],7:["#ff1947","#9c253d","#6b2b38","#3b2d30","#595959","#7f7f7f","#cccccc"],8:["#ff1947","#ce1f42","#9c253d","#6b2b38","#3b2d30","#595959","#7f7f7f","#cccccc"],9:["#ff1947","#ce1f42","#9c253d","#6b2b38","#3b2d30","#595959","#7f7f7f","#a6a6a6","#cccccc"],10:["#ff1947","#ce1f42","#9c253d","#6b2b38","#3b2d30","#414141","#595959","#7f7f7f","#a6a6a6","#cccccc"],stops:["#ff1947","#9c253d","#3b2d30","#7f7f7f","#cccccc"],tags:["dark","reds","grays","bright","diverging","colorblind-friendly"],name:"Red and Gray 4"},"div-red-gray-bright-2":{1:["#ff1947"],2:["#ff1947","#aab2c8"],3:["#ff1947","#3e3140","#aab2c8"],4:["#ff1947","#9c253d","#727681","#aab2c8"],5:["#ff1947","#9c253d","#3e3140","#727681","#aab2c8"],6:["#ff1947","#9c253d","#6b2b38","#50545e","#727681","#aab2c8"],7:["#ff1947","#9c253d","#6b2b38","#3e3140","#50545e","#727681","#aab2c8"],8:["#ff1947","#ce1f42","#9c253d","#6b2b38","#3e3140","#50545e","#727681","#aab2c8"],9:["#ff1947","#ce1f42","#9c253d","#6b2b38","#3e3140","#50545e","#727681","#9196a5","#aab2c8"],10:["#ff1947","#ce1f42","#9c253d","#6b2b38","#3e3140","#3e424d","#50545e","#727681","#9196a5","#aab2c8"],stops:["#ff1947","#9c253d","#3e3140","#727681","#aab2c8"],tags:["dark","reds","grays","bright","diverging","colorblind-friendly"],name:"Red and Gray 5"},"div-red-gray-bright-3":{1:["#ff1947"],2:["#ff1947","#ccafaf"],3:["#ff1947","#3b2d35","#ccafaf"],4:["#ff1947","#9c253d","#837171","#ccafaf"],5:["#ff1947","#9c253d","#3b2d35","#837171","#ccafaf"],6:["#ff1947","#9c253d","#6b2b38","#5e5151","#837171","#ccafaf"],7:["#ff1947","#9c253d","#6b2b38","#3b2d35","#5e5151","#837171","#ccafaf"],8:["#ff1947","#ce1f42","#9c253d","#6b2b38","#3b2d35","#5e5151","#837171","#ccafaf"],9:["#ff1947","#ce1f42","#9c253d","#6b2b38","#3b2d35","#5e5151","#837171","#a79090","#ccafaf"],10:["#ff1947","#ce1f42","#9c253d","#6b2b38","#3b2d35","#4d3f3f","#5e5151","#837171","#a79090","#ccafaf"],stops:["#ff1947","#9c253d","#3b2d35","#837171","#ccafaf"],tags:["dark","reds","grays","bright","diverging","colorblind-friendly"],name:"Red and Gray 6"},"div-teal-yellow-bright-1":{1:["#00ffc8"],2:["#00ffc8","#ffff00"],3:["#00ffc8","#4a4a3d","#ffff00"],4:["#00ffc8","#12a585","#979724","#ffff00"],5:["#00ffc8","#12a585","#4a4a3d","#979724","#ffff00"],6:["#00ffc8","#12a585","#1b7864","#636336","#979724","#ffff00"],7:["#00ffc8","#12a585","#1b7864","#4a4a3d","#636336","#979724","#ffff00"],8:["#00ffc8","#09d2a7","#12a585","#1b7864","#4a4a3d","#636336","#979724","#ffff00"],9:["#00ffc8","#09d2a7","#12a585","#1b7864","#4a4a3d","#636336","#979724","#cbcb12","#ffff00"],10:["#00ffc8","#09d2a7","#12a585","#1b7864","#355951","#4a4a3d","#636336","#979724","#cbcb12","#ffff00"],stops:["#00ffc8","#12a585","#4a4a3d","#979724","#ffff00"],tags:["dark","greens","blues","yellows","bright","diverging","colorblind-friendly"],name:"Blue and Yellow 5"},"div-teal-yellow-bright-2":{1:["#00ffc8"],2:["#00ffc8","#ffc800"],3:["#00ffc8","#4a483d","#ffc800"],4:["#00ffc8","#12a585","#997f25","#ffc800"],5:["#00ffc8","#12a585","#4a483d","#997f25","#ffc800"],6:["#00ffc8","#12a585","#1b7864","#665b38","#997f25","#ffc800"],7:["#00ffc8","#12a585","#1b7864","#4a483d","#665b38","#997f25","#ffc800"],8:["#00ffc8","#09d2a7","#12a585","#1b7864","#4a483d","#665b38","#997f25","#ffc800"],9:["#00ffc8","#09d2a7","#12a585","#1b7864","#4a483d","#665b38","#997f25","#cca413","#ffc800"],10:["#00ffc8","#09d2a7","#12a585","#1b7864","#355951","#4a483d","#665b38","#997f25","#cca413","#ffc800"],stops:["#00ffc8","#12a585","#4a483d","#997f25","#ffc800"],tags:["dark","greens","oranges","yellows","bright","diverging","colorblind-friendly"],name:"Blue and Orange 6"},"div-teal-orange-bright":{1:["#00ffc8"],2:["#00ffc8","#ff7d00"],3:["#00ffc8","#4a443d","#ff7d00"],4:["#00ffc8","#1db695","#a06022","#ff7d00"],5:["#00ffc8","#1db695","#4a443d","#a06022","#ff7d00"],6:["#00ffc8","#1db695","#2b917b","#705133","#a06022","#ff7d00"],7:["#00ffc8","#1db695","#2b917b","#4a443d","#705133","#a06022","#ff7d00"],8:["#00ffc8","#0edaae","#1db695","#2b917b","#4a443d","#705133","#a06022","#ff7d00"],9:["#00ffc8","#0edaae","#1db695","#2b917b","#4a443d","#705133","#a06022","#cf6e11","#ff7d00"],10:["#00ffc8","#0edaae","#1db695","#2b917b","#3a6d62","#4a443d","#705133","#a06022","#cf6e11","#ff7d00"],stops:["#00ffc8","#1db695","#4a443d","#a06022","#ff7d00"],tags:["dark","greens","blues","oranges","bright","diverging","colorblind-friendly"],name:"Blue and Orange 7"},"div-green-red-bright":{1:["#00ffaa"],2:["#00ffaa","#ff0000"],3:["#00ffaa","#403c35","#ff0000"],4:["#00ffaa","#17a67d","#b02626","#ff0000"],5:["#00ffaa","#17a67d","#403c35","#b02626","#ff0000"],6:["#00ffaa","#17a67d","#237a60","#783737","#b02626","#ff0000"],7:["#00ffaa","#17a67d","#237a60","#403c35","#783737","#b02626","#ff0000"],8:["#00ffaa","#0bd39a","#17a67d","#237a60","#403c35","#783737","#b02626","#ff0000"],9:["#00ffaa","#0bd39a","#17a67d","#237a60","#403c35","#783737","#b02626","#d11212","#ff0000"],10:["#00ffaa","#0bd39a","#17a67d","#237a60","#2e4d43","#403c35","#783737","#b02626","#d11212","#ff0000"],stops:["#00ffaa","#17a67d","#403c35","#b02626","#ff0000"],tags:["dark","greens","reds","bright","diverging","colorblind-friendly"],name:"Red and Green 11"},"div-green-magenta-bright":{1:["#00ff64"],2:["#00ff64","#ff00d2"],3:["#00ff64","#423940","#ff00d2"],4:["#00ff64","#17a64f","#a3248d","#ff00d2"],5:["#00ff64","#17a64f","#423940","#a3248d","#ff00d2"],6:["#00ff64","#17a64f","#237a45","#733568","#a3248d","#ff00d2"],7:["#00ff64","#17a64f","#237a45","#423940","#733568","#a3248d","#ff00d2"],8:["#00ff64","#0bd35a","#17a64f","#237a45","#423940","#733568","#a3248d","#ff00d2"],9:["#00ff64","#0bd35a","#17a64f","#237a45","#423940","#733568","#a3248d","#d112b0","#ff00d2"],10:["#00ff64","#0bd35a","#17a64f","#237a45","#31523d","#423940","#733568","#a3248d","#d112b0","#ff00d2"],stops:["#00ff64","#17a64f","#423940","#a3248d","#ff00d2"],tags:["dark","greens","purples","pinks","bright","diverging","colorblind-friendly"],name:"Purple and Green 6"},"div-green-purple-bright-1":{1:["#00ff32"],2:["#00ff32","#bf00ff"],3:["#00ff32","#403a42","#bf00ff"],4:["#00ff32","#17a633","#8b26ad","#bf00ff"],5:["#00ff32","#17a633","#403a42","#8b26ad","#bf00ff"],6:["#00ff32","#17a633","#237a33","#663675","#8b26ad","#bf00ff"],7:["#00ff32","#17a633","#237a33","#403a42","#663675","#8b26ad","#bf00ff"],8:["#00ff32","#0bd332","#17a633","#237a33","#403a42","#663675","#8b26ad","#bf00ff"],9:["#00ff32","#0bd332","#17a633","#237a33","#403a42","#663675","#8b26ad","#a713d9","#bf00ff"],10:["#00ff32","#0bd332","#17a633","#237a33","#2e4d33","#403a42","#663675","#8b26ad","#a713d9","#bf00ff"],stops:["#00ff32","#17a633","#403a42","#8b26ad","#bf00ff"],tags:["dark","greens","purples","bright","diverging","colorblind-friendly"],name:"Purple and Green 7"},"div-green-purple-bright-2":{1:["#00ff00"],2:["#00ff00","#aa80ff"],3:["#00ff00","#423f47","#aa80ff"],4:["#00ff00","#19a919","#735ba5","#aa80ff"],5:["#00ff00","#19a919","#423f47","#735ba5","#aa80ff"],6:["#00ff00","#19a919","#257d25","#584878","#735ba5","#aa80ff"],7:["#00ff00","#19a919","#257d25","#423f47","#584878","#735ba5","#aa80ff"],8:["#00ff00","#0cd40c","#19a919","#257d25","#423f47","#584878","#735ba5","#aa80ff"],9:["#00ff00","#0cd40c","#19a919","#257d25","#423f47","#584878","#735ba5","#8f6dd2","#aa80ff"],10:["#00ff00","#0cd40c","#19a919","#257d25","#325432","#423f47","#584878","#735ba5","#8f6dd2","#aa80ff"],stops:["#00ff00","#19a919","#423f47","#735ba5","#aa80ff"],tags:["dark","greens","purples","bright","diverging","colorblind-friendly"],name:"Purple and Green 8"},"div-green-blue-bright-1":{1:["#b4f000"],2:["#b4f000","#00c8ff"],3:["#b4f000","#3f4547","#00c8ff"],4:["#b4f000","#7ea018","#1385a4","#00c8ff"],5:["#b4f000","#7ea018","#3f4547","#1385a4","#00c8ff"],6:["#b4f000","#7ea018","#627723","#1d6476","#1385a4","#00c8ff"],7:["#b4f000","#7ea018","#627723","#3f4547","#1d6476","#1385a4","#00c8ff"],8:["#b4f000","#99c80c","#7ea018","#627723","#3f4547","#1d6476","#1385a4","#00c8ff"],9:["#b4f000","#99c80c","#7ea018","#627723","#3f4547","#1d6476","#1385a4","#0aa7d1","#00c8ff"],10:["#b4f000","#99c80c","#7ea018","#627723","#474f2f","#3f4547","#1d6476","#1385a4","#0aa7d1","#00c8ff"],stops:["#b4f000","#7ea018","#3f4547","#1385a4","#00c8ff"],tags:["dark","greens","blues","bright","diverging","colorblind-friendly"],name:"Green and Blue 6"},"div-green-blue-bright-2":{1:["#b4f000"],2:["#b4f000","#00ffff"],3:["#b4f000","#3f4747","#00ffff"],4:["#b4f000","#7ea018","#129e9e","#00ffff"],5:["#b4f000","#7ea018","#3f4747","#129e9e","#00ffff"],6:["#b4f000","#7ea018","#627723","#1b6e6e","#129e9e","#00ffff"],7:["#b4f000","#7ea018","#627723","#3f4747","#1b6e6e","#129e9e","#00ffff"],8:["#b4f000","#99c80c","#7ea018","#627723","#3f4747","#1b6e6e","#129e9e","#00ffff"],9:["#b4f000","#99c80c","#7ea018","#627723","#3f4747","#1b6e6e","#129e9e","#09cfcf","#00ffff"],10:["#b4f000","#99c80c","#7ea018","#627723","#474f2f","#3f4747","#1b6e6e","#129e9e","#09cfcf","#00ffff"],stops:["#b4f000","#7ea018","#3f4747","#129e9e","#00ffff"],tags:["dark","greens","blues","bright","diverging","colorblind-friendly"],name:"Green and Blue 7"},"div-green-gray-bright-1":{1:["#00ff00"],2:["#00ff00","#cccccc"],3:["#00ff00","#424038","#cccccc"],4:["#00ff00","#1dac1d","#8a8a8a","#cccccc"],5:["#00ff00","#1dac1d","#424038","#8a8a8a","#cccccc"],6:["#00ff00","#1dac1d","#2c832c","#5e5e5e","#8a8a8a","#cccccc"],7:["#00ff00","#1dac1d","#2c832c","#424038","#5e5e5e","#8a8a8a","#cccccc"],8:["#00ff00","#0fd50f","#1dac1d","#2c832c","#424038","#5e5e5e","#8a8a8a","#cccccc"],9:["#00ff00","#0fd50f","#1dac1d","#2c832c","#424038","#5e5e5e","#8a8a8a","#ababab","#cccccc"],10:["#00ff00","#0fd50f","#1dac1d","#2c832c","#3a593a","#424038","#5e5e5e","#8a8a8a","#ababab","#cccccc"],stops:["#00ff00","#1dac1d","#424038","#8a8a8a","#cccccc"],tags:["dark","greens","grays","bright","diverging","colorblind-friendly"],name:"Green and Gray 4"},"div-green-gray-bright-2":{1:["#00ff00"],2:["#00ff00","#aab2c8"],3:["#00ff00","#383b42","#aab2c8"],4:["#00ff00","#1dac1d","#727681","#aab2c8"],5:["#00ff00","#1dac1d","#383b42","#727681","#aab2c8"],6:["#00ff00","#1dac1d","#2c832c","#50545e","#727681","#aab2c8"],7:["#00ff00","#1dac1d","#2c832c","#383b42","#50545e","#727681","#aab2c8"],8:["#00ff00","#0fd50f","#1dac1d","#2c832c","#383b42","#50545e","#727681","#aab2c8"],9:["#00ff00","#0fd50f","#1dac1d","#2c832c","#383b42","#50545e","#727681","#9196a5","#aab2c8"],10:["#00ff00","#0fd50f","#1dac1d","#2c832c","#3a593a","#383b42","#50545e","#727681","#9196a5","#aab2c8"],stops:["#00ff00","#1dac1d","#383b42","#727681","#aab2c8"],tags:["dark","greens","grays","bright","diverging","colorblind-friendly"],name:"Green and Gray 5"},"div-green-gray-bright-3":{1:["#82ff00"],2:["#82ff00","#ccafaf"],3:["#82ff00","#3d3434","#ccafaf"],4:["#82ff00","#5fa21a","#837171","#ccafaf"],5:["#82ff00","#5fa21a","#3d3434","#837171","#ccafaf"],6:["#82ff00","#5fa21a","#4d7327","#5e5151","#837171","#ccafaf"],7:["#82ff00","#5fa21a","#4d7327","#3d3434","#5e5151","#837171","#ccafaf"],8:["#82ff00","#70d00d","#5fa21a","#4d7327","#3d3434","#5e5151","#837171","#ccafaf"],9:["#82ff00","#70d00d","#5fa21a","#4d7327","#3d3434","#5e5151","#837171","#a79090","#ccafaf"],10:["#82ff00","#70d00d","#5fa21a","#4d7327","#424f34","#3d3434","#5e5151","#837171","#a79090","#ccafaf"],stops:["#82ff00","#5fa21a","#3d3434","#837171","#ccafaf"],tags:["dark","greens","grays","bright","diverging","colorblind-friendly"],name:"Green and Gray 6"},"div-blue-green-bright-1":{1:["#45b4ff"],2:["#45b4ff","#beff00"],3:["#45b4ff","#3e422f","#beff00"],4:["#45b4ff","#3d80ac","#799b14","#beff00"],5:["#45b4ff","#3d80ac","#3e422f","#799b14","#beff00"],6:["#45b4ff","#3d80ac","#396583","#56691e","#799b14","#beff00"],7:["#45b4ff","#3d80ac","#396583","#3e422f","#56691e","#799b14","#beff00"],8:["#45b4ff","#419ad5","#3d80ac","#396583","#3e422f","#56691e","#799b14","#beff00"],9:["#45b4ff","#419ad5","#3d80ac","#396583","#3e422f","#56691e","#799b14","#9bcd0a","#beff00"],10:["#45b4ff","#419ad5","#3d80ac","#396583","#374d5c","#3e422f","#56691e","#799b14","#9bcd0a","#beff00"],stops:["#45b4ff","#3d80ac","#3e422f","#799b14","#beff00"],tags:["dark","blues","greens","bright","diverging","colorblind-friendly"],name:"Green and Blue 5"},"div-blue-yellow-bright-2":{1:["#23ccff"],2:["#23ccff","#ffff00"],3:["#23ccff","#42422f","#ffff00"],4:["#23ccff","#2c8eac","#9b9b15","#ffff00"],5:["#23ccff","#2c8eac","#42422f","#9b9b15","#ffff00"],6:["#23ccff","#2c8eac","#316f83","#696920","#9b9b15","#ffff00"],7:["#23ccff","#2c8eac","#316f83","#42422f","#696920","#9b9b15","#ffff00"],8:["#23ccff","#28add5","#2c8eac","#316f83","#42422f","#696920","#9b9b15","#ffff00"],9:["#23ccff","#28add5","#2c8eac","#316f83","#42422f","#696920","#9b9b15","#cdcd0b","#ffff00"],10:["#23ccff","#28add5","#2c8eac","#316f83","#355059","#42422f","#696920","#9b9b15","#cdcd0b","#ffff00"],stops:["#23ccff","#2c8eac","#42422f","#9b9b15","#ffff00"],tags:["dark","blues","yellows","bright","diverging","colorblind-friendly"],name:"Blue and Yellow 3"},"div-blue-lightorange-bright":{1:["#23ccff"],2:["#23ccff","#ffc800"],3:["#23ccff","#474333","#ffc800"],4:["#23ccff","#2c8eac","#9b8020","#ffc800"],5:["#23ccff","#2c8eac","#474333","#9b8020","#ffc800"],6:["#23ccff","#2c8eac","#316f83","#695c30","#9b8020","#ffc800"],7:["#23ccff","#2c8eac","#316f83","#474333","#695c30","#9b8020","#ffc800"],8:["#23ccff","#28add5","#2c8eac","#316f83","#474333","#695c30","#9b8020","#ffc800"],9:["#23ccff","#28add5","#2c8eac","#316f83","#474333","#695c30","#9b8020","#cda410","#ffc800"],10:["#23ccff","#28add5","#2c8eac","#316f83","#355059","#474333","#695c30","#9b8020","#cda410","#ffc800"],stops:["#23ccff","#2c8eac","#474333","#9b8020","#ffc800"],tags:["dark","blues","yellows","bright","diverging","colorblind-friendly"],name:"Blue and Orange 3"},"div-blue-orange-bright-1":{1:["#12c0ff"],2:["#12c0ff","#ffa300"],3:["#12c0ff","#474033","#ffa300"],4:["#12c0ff","#2589ad","#9b6e20","#ffa300"],5:["#12c0ff","#2589ad","#474033","#9b6e20","#ffa300"],6:["#12c0ff","#2589ad","#2e6d85","#695430","#9b6e20","#ffa300"],7:["#12c0ff","#2589ad","#2e6d85","#474033","#695430","#9b6e20","#ffa300"],8:["#12c0ff","#1ba4d6","#2589ad","#2e6d85","#474033","#695430","#9b6e20","#ffa300"],9:["#12c0ff","#1ba4d6","#2589ad","#2e6d85","#474033","#695430","#9b6e20","#cd8910","#ffa300"],10:["#12c0ff","#1ba4d6","#2589ad","#2e6d85","#37515c","#474033","#695430","#9b6e20","#cd8910","#ffa300"],stops:["#12c0ff","#2589ad","#474033","#9b6e20","#ffa300"],tags:["dark","blues","oranges","bright","diverging","colorblind-friendly"],name:"Blue and Orange 4"},"div-blue-orange-bright-2":{1:["#12c0ff"],2:["#12c0ff","#ff7d00"],3:["#12c0ff","#473d33","#ff7d00"],4:["#12c0ff","#2589ad","#9b5c20","#ff7d00"],5:["#12c0ff","#2589ad","#473d33","#9b5c20","#ff7d00"],6:["#12c0ff","#2589ad","#2e6d85","#694b30","#9b5c20","#ff7d00"],7:["#12c0ff","#2589ad","#2e6d85","#473d33","#694b30","#9b5c20","#ff7d00"],8:["#12c0ff","#1ba4d6","#2589ad","#2e6d85","#473d33","#694b30","#9b5c20","#ff7d00"],9:["#12c0ff","#1ba4d6","#2589ad","#2e6d85","#473d33","#694b30","#9b5c20","#cd6c10","#ff7d00"],10:["#12c0ff","#1ba4d6","#2589ad","#2e6d85","#37515c","#473d33","#694b30","#9b5c20","#cd6c10","#ff7d00"],stops:["#12c0ff","#2589ad","#473d33","#9b5c20","#ff7d00"],tags:["dark","blues","oranges","bright","diverging","colorblind-friendly"],name:"Blue and Orange 5"},"div-blue-red-bright-1":{1:["#2799ff"],2:["#2799ff","#ff3333"],3:["#2799ff","#423a3a","#ff3333"],4:["#2799ff","#3070aa","#a53636","#ff3333"],5:["#2799ff","#3070aa","#423a3a","#a53636","#ff3333"],6:["#2799ff","#3070aa","#345b80","#783737","#a53636","#ff3333"],7:["#2799ff","#3070aa","#345b80","#423a3a","#783737","#a53636","#ff3333"],8:["#2799ff","#2b84d5","#3070aa","#345b80","#423a3a","#783737","#a53636","#ff3333"],9:["#2799ff","#2b84d5","#3070aa","#345b80","#423a3a","#783737","#a53636","#d23434","#ff3333"],10:["#2799ff","#2b84d5","#3070aa","#345b80","#324554","#423a3a","#783737","#a53636","#d23434","#ff3333"],stops:["#2799ff","#3070aa","#423a3a","#a53636","#ff3333"],tags:["dark","reds","blues","bright","diverging","colorblind-friendly"],name:"Blue and Red 11"},"div-blue-red-bright-2":{1:["#6690ff"],2:["#6690ff","#ff0040"],3:["#6690ff","#42383b","#ff0040"],4:["#6690ff","#526aad","#a22343","#ff0040"],5:["#6690ff","#526aad","#42383b","#a22343","#ff0040"],6:["#6690ff","#526aad","#475785","#733444","#a22343","#ff0040"],7:["#6690ff","#526aad","#475785","#42383b","#733444","#a22343","#ff0040"],8:["#6690ff","#5c7dd6","#526aad","#475785","#42383b","#733444","#a22343","#ff0040"],9:["#6690ff","#5c7dd6","#526aad","#475785","#42383b","#733444","#a22343","#d01141","#ff0040"],10:["#6690ff","#5c7dd6","#526aad","#475785","#3d445c","#42383b","#733444","#a22343","#d01141","#ff0040"],stops:["#6690ff","#526aad","#42383b","#a22343","#ff0040"],tags:["dark","blues","reds","bright","diverging","colorblind-friendly"],name:"Blue and Red 12"},"div-blue-orange-bright-3":{1:["#6690ff"],2:["#6690ff","#ff9573"],3:["#6690ff","#423b38","#ff9573"],4:["#6690ff","#526aad","#945e4c","#ff9573"],5:["#6690ff","#526aad","#423b38","#945e4c","#ff9573"],6:["#6690ff","#526aad","#475785","#5e4338","#945e4c","#ff9573"],7:["#6690ff","#526aad","#475785","#423b38","#5e4338","#945e4c","#ff9573"],8:["#6690ff","#5c7dd6","#526aad","#475785","#423b38","#5e4338","#945e4c","#ff9573"],9:["#6690ff","#5c7dd6","#526aad","#475785","#423b38","#5e4338","#945e4c","#c97a5f","#ff9573"],10:["#6690ff","#5c7dd6","#526aad","#475785","#3d445c","#423b38","#5e4338","#945e4c","#c97a5f","#ff9573"],stops:["#6690ff","#526aad","#423b38","#945e4c","#ff9573"],tags:["dark","blues","browns","bright","diverging","colorblind-friendly"],name:"Blue and Brown 4"},"div-blue-tan-bright":{1:["#6690ff"],2:["#6690ff","#bf9f00"],3:["#6690ff","#424038","#bf9f00"],4:["#6690ff","#526aad","#7c6e24","#bf9f00"],5:["#6690ff","#526aad","#424038","#7c6e24","#bf9f00"],6:["#6690ff","#526aad","#475785","#5b5536","#7c6e24","#bf9f00"],7:["#6690ff","#526aad","#475785","#424038","#5b5536","#7c6e24","#bf9f00"],8:["#6690ff","#5c7dd6","#526aad","#475785","#424038","#5b5536","#7c6e24","#bf9f00"],9:["#6690ff","#5c7dd6","#526aad","#475785","#424038","#5b5536","#7c6e24","#9e8612","#bf9f00"],10:["#6690ff","#5c7dd6","#526aad","#475785","#404861","#424038","#5b5536","#7c6e24","#9e8612","#bf9f00"],stops:["#6690ff","#526aad","#424038","#7c6e24","#bf9f00"],tags:["dark","blues","yellows","bright","diverging","colorblind-friendly"],name:"Blue and Yellow 4"},"div-blue-gray-bright-1":{1:["#00b3ff"],2:["#00b3ff","#cccccc"],3:["#00b3ff","#424038","#cccccc"],4:["#00b3ff","#1d82ac","#8a8a8a","#cccccc"],5:["#00b3ff","#1d82ac","#424038","#8a8a8a","#cccccc"],6:["#00b3ff","#1d82ac","#2c6983","#5e5e5e","#8a8a8a","#cccccc"],7:["#00b3ff","#1d82ac","#2c6983","#424038","#5e5e5e","#8a8a8a","#cccccc"],8:["#00b3ff","#0f9ad5","#1d82ac","#2c6983","#424038","#5e5e5e","#8a8a8a","#cccccc"],9:["#00b3ff","#0f9ad5","#1d82ac","#2c6983","#424038","#5e5e5e","#8a8a8a","#ababab","#cccccc"],10:["#00b3ff","#0f9ad5","#1d82ac","#2c6983","#3a5059","#424038","#5e5e5e","#8a8a8a","#ababab","#cccccc"],stops:["#00b3ff","#1d82ac","#424038","#8a8a8a","#cccccc"],tags:["dark","blues","grays","bright","diverging","colorblind-friendly"],name:"Blue and Gray 3"},"div-blue-gray-bright-2":{1:["#00b3ff"],2:["#00b3ff","#aab2c8"],3:["#00b3ff","#383b42","#aab2c8"],4:["#00b3ff","#1d82ac","#727681","#aab2c8"],5:["#00b3ff","#1d82ac","#383b42","#727681","#aab2c8"],6:["#00b3ff","#1d82ac","#2c6983","#50545e","#727681","#aab2c8"],7:["#00b3ff","#1d82ac","#2c6983","#383b42","#50545e","#727681","#aab2c8"],8:["#00b3ff","#0f9ad5","#1d82ac","#2c6983","#383b42","#50545e","#727681","#aab2c8"],9:["#00b3ff","#0f9ad5","#1d82ac","#2c6983","#383b42","#50545e","#727681","#9196a5","#aab2c8"],10:["#00b3ff","#0f9ad5","#1d82ac","#2c6983","#3a5059","#383b42","#50545e","#727681","#9196a5","#aab2c8"],stops:["#00b3ff","#1d82ac","#383b42","#727681","#aab2c8"],tags:["dark","blues","grays","bright","diverging","colorblind-friendly"],name:"Blue and Gray 4"},"div-blue-gray-bright-3":{1:["#00b3ff"],2:["#00b3ff","#ccafaf"],3:["#00b3ff","#3d3434","#ccafaf"],4:["#00b3ff","#1d82ac","#837171","#ccafaf"],5:["#00b3ff","#1d82ac","#3d3434","#837171","#ccafaf"],6:["#00b3ff","#1d82ac","#2c6983","#5e5151","#837171","#ccafaf"],7:["#00b3ff","#1d82ac","#2c6983","#3d3434","#5e5151","#837171","#ccafaf"],8:["#00b3ff","#0f9ad5","#1d82ac","#2c6983","#3d3434","#5e5151","#837171","#ccafaf"],9:["#00b3ff","#0f9ad5","#1d82ac","#2c6983","#3d3434","#5e5151","#837171","#a79090","#ccafaf"],10:["#00b3ff","#0f9ad5","#1d82ac","#2c6983","#3a5059","#3d3434","#5e5151","#837171","#a79090","#ccafaf"],stops:["#00b3ff","#1d82ac","#3d3434","#837171","#ccafaf"],tags:["dark","blues","grays","bright","diverging","colorblind-friendly"],name:"Blue and Gray 5"},"div-blue-yellow-brown":{1:["#daffa5"],2:["#0051f2","#b35a00"],3:["#0051f2","#daffa5","#b35a00"],4:["#0051f2","#6da7fb","#d9963a","#b35a00"],5:["#0051f2","#6da7fb","#daffa5","#d9963a","#b35a00"],6:["#0051f2","#377cf6","#6da7fb","#ffd173","#d9963a","#b35a00"],7:["#0051f2","#377cf6","#6da7fb","#daffa5","#ffd173","#d9963a","#b35a00"],8:["#0051f2","#377cf6","#6da7fb","#a4d2ff","#ffd173","#ecb356","#d9963a","#b35a00"],9:["#0051f2","#377cf6","#6da7fb","#a4d2ff","#daffa5","#ffd173","#ecb356","#d9963a","#b35a00"],10:["#0051f2","#377cf6","#6da7fb","#a4d2ff","#daffa5","#ffd173","#ecb356","#d9963a","#c6781d","#b35a00"],stops:["#0051f2","#6da7fb","#daffa5","#d9963a","#b35a00"],tags:["light","blues","browns","diverging","colorblind-friendly"],name:"Blue and Brown 5"},"div-purple-yellow-brown":{1:["#ffcce6"],2:["#6000e6","#b35a00"],3:["#6000e6","#ffcce6","#b35a00"],4:["#6000e6","#a069ee","#ce922e","#b35a00"],5:["#6000e6","#a069ee","#ffcce6","#ce922e","#b35a00"],6:["#6000e6","#8035ea","#a069ee","#e9c95c","#ce922e","#b35a00"],7:["#6000e6","#8035ea","#a069ee","#ffcce6","#e9c95c","#ce922e","#b35a00"],8:["#6000e6","#8035ea","#a069ee","#c09ef2","#e9c95c","#dcad45","#ce922e","#b35a00"],9:["#6000e6","#8035ea","#a069ee","#c09ef2","#ffcce6","#e9c95c","#dcad45","#ce922e","#b35a00"],10:["#6000e6","#8035ea","#a069ee","#c09ef2","#ffcce6","#e9c95c","#dcad45","#ce922e","#c17617","#b35a00"],stops:["#6000e6","#a069ee","#ffcce6","#ce922e","#b35a00"],tags:["light","purples","browns","diverging","colorblind-friendly"],name:"Purple and Brown 3"},"div-purple-beige-green":{1:["#f2cf9e"],2:["#8100e6","#2b9900"],3:["#8100e6","#f2cf9e","#2b9900"],4:["#8100e6","#b360d1","#6eb830","#2b9900"],5:["#8100e6","#b360d1","#f2cf9e","#6eb830","#2b9900"],6:["#8100e6","#9a30dc","#b360d1","#b0d660","#6eb830","#2b9900"],7:["#8100e6","#9a30dc","#b360d1","#f2cf9e","#b0d660","#6eb830","#2b9900"],8:["#8100e6","#9a30dc","#b360d1","#cc90c7","#b0d660","#8fc748","#6eb830","#2b9900"],9:["#8100e6","#9a30dc","#b360d1","#cc90c7","#f2cf9e","#b0d660","#8fc748","#6eb830","#2b9900"],10:["#8100e6","#9a30dc","#b360d1","#cc90c7","#f2cf9e","#b0d660","#8fc748","#6eb830","#4ca818","#2b9900"],stops:["#8100e6","#b360d1","#f2cf9e","#6eb830","#2b9900"],tags:["light","purples","greens","diverging","colorblind-friendly"],name:"Purple and Green 10"},"div-teal-yellow-brown":{1:["#f2f2aa"],2:["#00998c","#b34a00"],3:["#00998c","#f2f2aa","#b34a00"],4:["#00998c","#69d4cb","#d98346","#b34a00"],5:["#00998c","#69d4cb","#f2f2aa","#d98346","#b34a00"],6:["#00998c","#35b7ac","#69d4cb","#ffbc8c","#d98346","#b34a00"],7:["#00998c","#35b7ac","#69d4cb","#f2f2aa","#ffbc8c","#d98346","#b34a00"],8:["#00998c","#35b7ac","#69d4cb","#9ef2eb","#ffbc8c","#eca069","#d98346","#b34a00"],9:["#00998c","#35b7ac","#69d4cb","#9ef2eb","#f2f2aa","#ffbc8c","#eca069","#d98346","#b34a00"],10:["#00998c","#35b7ac","#69d4cb","#9ef2eb","#f2f2aa","#ffbc8c","#eca069","#d98346","#c66723","#b34a00"],stops:["#00998c","#69d4cb","#f2f2aa","#d98346","#b34a00"],tags:["light","purples","browns","diverging","colorblind-friendly"],name:"Purple and Brown 4"},"div-yellow-magenta-light":{1:["#daf2b5"],2:["#a49d0c","#a600a6"],3:["#a49d0c","#daf2b5","#a600a6"],4:["#a49d0c","#d6cd45","#d35dc0","#a600a6"],5:["#a49d0c","#d6cd45","#daf2b5","#d35dc0","#a600a6"],6:["#a49d0c","#bbb327","#d6cd45","#ffbada","#d35dc0","#a600a6"],7:["#a49d0c","#bbb327","#d6cd45","#daf2b5","#ffbada","#d35dc0","#a600a6"],8:["#a49d0c","#bbb327","#d6cd45","#e9e05c","#ffbada","#e98bcd","#d35dc0","#a600a6"],9:["#a49d0c","#bbb327","#d6cd45","#e9e05c","#daf2b5","#ffbada","#e98bcd","#d35dc0","#a600a6"],10:["#a49d0c","#bbb327","#d6cd45","#e9e05c","#daf2b5","#ffbada","#e98bcd","#d35dc0","#bc2eb3","#a600a6"],stops:["#a49d0c","#d6cd45","#daf2b5","#d35dc0","#a600a6"],tags:["light","purples","greens","yellows","diverging","colorblind-friendly"],name:"Yellow and Magenta"},"div-green-yellow-blue":{1:["#f2e695"],2:["#758f12","#0080ff"],3:["#758f12","#f2e695","#0080ff"],4:["#758f12","#acc05d","#53a9ff","#0080ff"],5:["#758f12","#acc05d","#f2e695","#53a9ff","#0080ff"],6:["#758f12","#90a838","#acc05d","#8bdee6","#53a9ff","#0080ff"],7:["#758f12","#90a838","#acc05d","#f2e695","#8bdee6","#53a9ff","#0080ff"],8:["#758f12","#90a838","#acc05d","#c7d983","#8bdee6","#7dbeff","#53a9ff","#0080ff"],9:["#758f12","#90a838","#acc05d","#c7d983","#f2e695","#8bdee6","#7dbeff","#53a9ff","#0080ff"],10:["#758f12","#90a838","#acc05d","#c7d983","#f2e695","#8bdee6","#7dbeff","#53a9ff","#2a95ff","#0080ff"],stops:["#758f12","#acc05d","#f2e695","#53a9ff","#0080ff"],tags:["light","greens","blues","diverging","colorblind-friendly"],name:"Green and Blue 8"},"div-brown-blue":{1:["#cae0cf"],2:["#9e7300","#4253a6"],3:["#9e7300","#cae0cf","#4253a6"],4:["#9e7300","#c9aa61","#7988d0","#4253a6"],5:["#9e7300","#c9aa61","#cae0cf","#7988d0","#4253a6"],6:["#9e7300","#b38f30","#c9aa61","#afbcfa","#7988d0","#4253a6"],7:["#9e7300","#b38f30","#c9aa61","#cae0cf","#afbcfa","#7988d0","#4253a6"],8:["#9e7300","#b38f30","#c9aa61","#dec691","#afbcfa","#94a2e5","#7988d0","#4253a6"],9:["#9e7300","#b38f30","#c9aa61","#dec691","#cae0cf","#afbcfa","#94a2e5","#7988d0","#4253a6"],10:["#9e7300","#b38f30","#c9aa61","#dec691","#cae0cf","#afbcfa","#94a2e5","#7988d0","#5d6dbb","#4253a6"],stops:["#9e7300","#c9aa61","#cae0cf","#7988d0","#4253a6"],tags:["light","purples","blues","browns","diverging","colorblind-friendly"],name:"Blue and Brown 6"},"div-red-green-cyan":{1:["#dae695"],2:["#a00000","#008fbf"],3:["#a00000","#dae695","#008fbf"],4:["#a00000","#df7b7b","#47b0df","#008fbf"],5:["#a00000","#df7b7b","#dae695","#47b0df","#008fbf"],6:["#a00000","#c03d3d","#df7b7b","#8dd0ff","#47b0df","#008fbf"],7:["#a00000","#c03d3d","#df7b7b","#dae695","#8dd0ff","#47b0df","#008fbf"],8:["#a00000","#c03d3d","#df7b7b","#ffb8b8","#8dd0ff","#6ac0ef","#47b0df","#008fbf"],9:["#a00000","#c03d3d","#df7b7b","#ffb8b8","#dae695","#8dd0ff","#6ac0ef","#47b0df","#008fbf"],10:["#a00000","#c03d3d","#df7b7b","#ffb8b8","#dae695","#8dd0ff","#6ac0ef","#47b0df","#239fcf","#008fbf"],stops:["#a00000","#df7b7b","#dae695","#47b0df","#008fbf"],tags:["light","reds","blues","diverging","colorblind-friendly"],name:"Blue and Red 15"},"div-yellow-slate-teal":{1:["#d9ccff"],2:["#a49d0c","#008a97"],3:["#a49d0c","#d9ccff","#008a97"],4:["#a49d0c","#d6cd45","#46b4bf","#008a97"],5:["#a49d0c","#d6cd45","#d9ccff","#46b4bf","#008a97"],6:["#a49d0c","#c3bb2e","#d6cd45","#8bdee6","#46b4bf","#008a97"],7:["#a49d0c","#c3bb2e","#d6cd45","#d9ccff","#8bdee6","#46b4bf","#008a97"],8:["#a49d0c","#c3bb2e","#d6cd45","#e9e05c","#8bdee6","#68c9d2","#46b4bf","#008a97"],9:["#a49d0c","#c3bb2e","#d6cd45","#e9e05c","#d9ccff","#8bdee6","#68c9d2","#46b4bf","#008a97"],10:["#a49d0c","#c3bb2e","#d6cd45","#e9e05c","#d9ccff","#8bdee6","#68c9d2","#46b4bf","#239fab","#008a97"],stops:["#a49d0c","#d6cd45","#d9ccff","#46b4bf","#008a97"],tags:["light","yellows","blues","diverging","colorblind-friendly"],name:"Blue and Yellow 10"},"div-blue-green-orange":{1:["#1c4d31"],2:["#00aaff","#ffaa00"],3:["#00aaff","#1c4d31","#ffaa00"],4:["#00aaff","#0072aa","#bd7e00","#ffaa00"],5:["#00aaff","#0072aa","#1c4d31","#bd7e00","#ffaa00"],6:["#00aaff","#008ed5","#0072aa","#7a5200","#bd7e00","#ffaa00"],7:["#00aaff","#008ed5","#0072aa","#1c4d31","#7a5200","#bd7e00","#ffaa00"],8:["#00aaff","#008ed5","#0072aa","#005e8c","#7a5200","#bd7e00","#de9400","#ffaa00"],9:["#00aaff","#008ed5","#0072aa","#005e8c","#1c4d31","#7a5200","#bd7e00","#de9400","#ffaa00"],10:["#00aaff","#008ed5","#0072aa","#005e8c","#1c4d31","#7a5200","#9b6800","#bd7e00","#de9400","#ffaa00"],stops:["#00aaff","#0072aa","#1c4d31","#bd7e00","#ffaa00"],tags:["dark","blues","browns","oranges","diverging","colorblind-friendly"],name:"Blue and Orange 10"},"div-purple-orange":{1:["#590e47"],2:["#9952ff","#ff7300"],3:["#9952ff","#590e47","#ff7300"],4:["#9952ff","#6c1be6","#c05600","#ff7300"],5:["#9952ff","#6c1be6","#590e47","#c05600","#ff7300"],6:["#9952ff","#8337f2","#6c1be6","#803800","#c05600","#ff7300"],7:["#9952ff","#8337f2","#6c1be6","#590e47","#803800","#c05600","#ff7300"],8:["#9952ff","#8337f2","#6c1be6","#5600d9","#803800","#c05600","#df6400","#ff7300"],9:["#9952ff","#8337f2","#6c1be6","#5600d9","#590e47","#803800","#c05600","#df6400","#ff7300"],10:["#9952ff","#8337f2","#6c1be6","#5600d9","#590e47","#803800","#a04700","#c05600","#df6400","#ff7300"],stops:["#9952ff","#6c1be6","#590e47","#c05600","#ff7300"],tags:["dark","purples","browns","diverging","colorblind-friendly"],name:"Purple and Orange 3"},"div-purple-green":{1:["#4d3839"],2:["#b533ff","#6ede00"],3:["#b533ff","#4d3839","#6ede00"],4:["#b533ff","#8d11d4","#56ac00","#6ede00"],5:["#b533ff","#8d11d4","#4d3839","#56ac00","#6ede00"],6:["#b533ff","#a122ea","#8d11d4","#3f8000","#56ac00","#6ede00"],7:["#b533ff","#a122ea","#8d11d4","#4d3839","#3f8000","#56ac00","#6ede00"],8:["#b533ff","#a122ea","#8d11d4","#7900bf","#3f8000","#56ac00","#61c300","#6ede00"],9:["#b533ff","#a122ea","#8d11d4","#7900bf","#4d3839","#3f8000","#56ac00","#61c300","#6ede00"],10:["#b533ff","#a122ea","#8d11d4","#7900bf","#4d3839","#3f8000","#4a9600","#56ac00","#61c300","#6ede00"],stops:["#b533ff","#8d11d4","#4d3839","#56ac00","#6ede00"],tags:["dark","purples","greens","diverging","colorblind-friendly"],name:"Purple and Green 11"},"div-teal-orange":{1:["#604080"],2:["#66ffcc","#ffb900"],3:["#66ffcc","#604080","#ffb900"],4:["#66ffcc","#22aa7d","#b98600","#ffb900"],5:["#66ffcc","#22aa7d","#604080","#b98600","#ffb900"],6:["#66ffcc","#44d5a4","#22aa7d","#735200","#b98600","#ffb900"],7:["#66ffcc","#44d5a4","#22aa7d","#604080","#735200","#b98600","#ffb900"],8:["#66ffcc","#44d5a4","#22aa7d","#008055","#735200","#b98600","#dc9f00","#ffb900"],9:["#66ffcc","#44d5a4","#22aa7d","#008055","#604080","#735200","#b98600","#dc9f00","#ffb900"],10:["#66ffcc","#44d5a4","#22aa7d","#008055","#604080","#735200","#966c00","#b98600","#dc9f00","#ffb900"],stops:["#66ffcc","#22aa7d","#604080","#b98600","#ffb900"],tags:["dark","greens","oranges","diverging","colorblind-friendly"],name:"Green and Orange"},"div-red-purple-blue":{1:["#472459"],2:["#0080ff","#ff4d4d"],3:["#0080ff","#472459","#ff4d4d"],4:["#0080ff","#005bb2","#c40f0f","#ff4d4d"],5:["#0080ff","#005bb2","#472459","#c40f0f","#ff4d4d"],6:["#0080ff","#006dd9","#005bb2","#800000","#c40f0f","#ff4d4d"],7:["#0080ff","#006dd9","#005bb2","#472459","#800000","#c40f0f","#ff4d4d"],8:["#0080ff","#006dd9","#005bb2","#00488c","#800000","#c40f0f","#e61616","#ff4d4d"],9:["#0080ff","#006dd9","#005bb2","#00488c","#472459","#800000","#c40f0f","#e61616","#ff4d4d"],10:["#0080ff","#006dd9","#005bb2","#00488c","#472459","#800000","#a20707","#c40f0f","#e61616","#ff4d4d"],stops:["#0080ff","#005bb2","#472459","#c40f0f","#ff4d4d"],tags:["dark","blues","reds","diverging","colorblind-friendly"],name:"Blue and Red 16"},"div-yellow-magenta":{1:["#1f4f59"],2:["#fff565","#e600e6"],3:["#fff565","#1f4f59","#e600e6"],4:["#fff565","#999122","#b300b3","#e600e6"],5:["#fff565","#999122","#1f4f59","#b300b3","#e600e6"],6:["#fff565","#ccc343","#999122","#800080","#b300b3","#e600e6"],7:["#fff565","#ccc343","#999122","#1f4f59","#800080","#b300b3","#e600e6"],8:["#fff565","#ccc343","#999122","#665f00","#800080","#b300b3","#cd00cd","#e600e6"],9:["#fff565","#ccc343","#999122","#665f00","#1f4f59","#800080","#b300b3","#cd00cd","#e600e6"],10:["#fff565","#ccc343","#999122","#665f00","#1f4f59","#800080","#9a009a","#b300b3","#cd00cd","#e600e6"],stops:["#fff565","#999122","#1f4f59","#b300b3","#e600e6"],tags:["dark","purples","yellows","diverging","colorblind-friendly"],name:"Purple and Yellow 4"},"div-green-blue":{1:["#663840"],2:["#d4ff33","#33ddff"],3:["#d4ff33","#663840","#33ddff"],4:["#d4ff33","#83a211","#1a9dc5","#33ddff"],5:["#d4ff33","#83a211","#663840","#1a9dc5","#33ddff"],6:["#d4ff33","#abd022","#83a211","#005d8c","#1a9dc5","#33ddff"],7:["#d4ff33","#abd022","#83a211","#663840","#005d8c","#1a9dc5","#33ddff"],8:["#d4ff33","#abd022","#83a211","#5a7300","#005d8c","#1a9dc5","#26bde2","#33ddff"],9:["#d4ff33","#abd022","#83a211","#5a7300","#663840","#005d8c","#1a9dc5","#26bde2","#33ddff"],10:["#d4ff33","#abd022","#83a211","#5a7300","#663840","#005d8c","#0d7da9","#1a9dc5","#26bde2","#33ddff"],stops:["#d4ff33","#83a211","#663840","#1a9dc5","#33ddff"],tags:["dark","greens","blues","diverging","colorblind-friendly"],name:"Green and Blue 9"},"div-blue-brown":{1:["#5b2e73"],2:["#65a5ff","#ffb900"],3:["#65a5ff","#5b2e73","#ffb900"],4:["#65a5ff","#4366c4","#b98600","#ffb900"],5:["#65a5ff","#4366c4","#5b2e73","#b98600","#ffb900"],6:["#65a5ff","#5485e1","#4366c4","#735200","#b98600","#ffb900"],7:["#65a5ff","#5485e1","#4366c4","#5b2e73","#735200","#b98600","#ffb900"],8:["#65a5ff","#5485e1","#4366c4","#3246a6","#735200","#b98600","#dc9f00","#ffb900"],9:["#65a5ff","#5485e1","#4366c4","#3246a6","#5b2e73","#735200","#b98600","#dc9f00","#ffb900"],10:["#65a5ff","#5485e1","#4366c4","#3246a6","#5b2e73","#735200","#966c00","#b98600","#dc9f00","#ffb900"],stops:["#65a5ff","#4366c4","#5b2e73","#b98600","#ffb900"],tags:["dark","purples","blues","browns","diverging","colorblind-friendly"],name:"Blue and Brown 7"},"div-red-cyan":{1:["#592e73"],2:["#ff7040","#33ddff"],3:["#ff7040","#592e73","#33ddff"],4:["#ff7040","#bc3f2b","#1a99c0","#33ddff"],5:["#ff7040","#bc3f2b","#592e73","#1a99c0","#33ddff"],6:["#ff7040","#de5836","#bc3f2b","#005580","#1a99c0","#33ddff"],7:["#ff7040","#de5836","#bc3f2b","#592e73","#005580","#1a99c0","#33ddff"],8:["#ff7040","#de5836","#bc3f2b","#9b2721","#005580","#1a99c0","#26bbdf","#33ddff"],9:["#ff7040","#de5836","#bc3f2b","#9b2721","#592e73","#005580","#1a99c0","#26bbdf","#33ddff"],10:["#ff7040","#de5836","#bc3f2b","#9b2721","#592e73","#005580","#0d77a0","#1a99c0","#26bbdf","#33ddff"],stops:["#ff7040","#bc3f2b","#592e73","#1a99c0","#33ddff"],tags:["dark","reds","blues","diverging","colorblind-friendly"],name:"Blue and Red 17"},"div-yellow-teal":{1:["#663840"],2:["#ffff00","#00ffff"],3:["#ffff00","#663840","#00ffff"],4:["#ffff00","#999900","#00b9b9","#00ffff"],5:["#ffff00","#999900","#663840","#00b9b9","#00ffff"],6:["#ffff00","#cccc00","#999900","#007373","#00b9b9","#00ffff"],7:["#ffff00","#cccc00","#999900","#663840","#007373","#00b9b9","#00ffff"],8:["#ffff00","#cccc00","#999900","#666600","#007373","#00b9b9","#00dcdc","#00ffff"],9:["#ffff00","#cccc00","#999900","#666600","#663840","#007373","#00b9b9","#00dcdc","#00ffff"],10:["#ffff00","#cccc00","#999900","#666600","#663840","#007373","#009696","#00b9b9","#00dcdc","#00ffff"],stops:["#ffff00","#999900","#663840","#00b9b9","#00ffff"],tags:["dark","yellows","blues","diverging","colorblind-friendly"],name:"Blue and Yellow 11"},"div-green-purple":{stops:["#a3cc29","#567300","#403E3A","#6F00A6","#AA00FF"],tags:["dark","greens","purples","diverging","colorblind-friendly"],name:"Purple and Green 13"},"div-blue-red":{stops:["#00AAFF","#0060A6","#403E3A","#801921","#d92b2b"],tags:["dark","reds","blues","diverging","colorblind-friendly"],name:"Blue and Red 18"},"div-green-magenta":{stops:["#48d92c","#137300","#453F40","#800078","#e616da"],tags:["dark","greens","purples","diverging","colorblind-friendly"],name:"Purple and Green 14"},"div-blue-orange":{stops:["#00EAFF","#007580","#3F453F","#804B00","#FF9600"],tags:["dark","oranges","blues","diverging","colorblind-friendly"],name:"Blue and Orange 11"},"div-blue-yellow":{stops:["#1984FF","#0E4F99","#40453F","#737327","#e6d316"],tags:["dark","yellows","blues","diverging","colorblind-friendly"],name:"Blue and Yellow 13"},"div-purple-yellow":{stops:["#8A4DFF","#5933A6","#45413F","#806A00","#FFD400"],tags:["dark","purples","yellows","diverging","colorblind-friendly"],name:"Purple and Yellow 6"},"div-magenta-yellow":{stops:["#FF00E9","#800078","#453F41","#737327","#FFFF00"],tags:["dark","yellows","pinks","diverging","colorblind-friendly"],name:"Pink and Yellow 5"},"div-purple-green-dark":{stops:["#7933FF","#4F22A6","#423F45","#558000","#a0e616"],tags:["dark","greens","purples","diverging","colorblind-friendly"],name:"Purple and Green 15"},"div-green-brown":{stops:["#00FFD5","#00806B","#3F4540","#663D14","#BF6100"],tags:["dark","greens","browns","diverging","colorblind-friendly"],name:"Green and Brown 3"},"div-green-gray":{stops:["#24B360","#1E6B40","#3F4543","#6D7699","#B5C7FF"],tags:["dark","greens","blues","diverging","colorblind-friendly"],name:"Green and Blue 12"},"div-blue-white":{stops:["#1984FF","#0E4F99","#3F4245","#736C61","#CCC1AC"],tags:["dark","browns","blues","diverging","colorblind-friendly"],name:"Blue and Brown 8"},"div-red-steel":{stops:["#E64916","#99262F","#453F42","#454143","#A5B4FF"],tags:["dark","reds","blues","diverging","colorblind-friendly"],name:"Blue and Red 19"},"div-aqua-darkgray-red":{stops:["#00c3ff","#4e858c","#47443a","#94593b","#ff4040"],tags:["dark","reds","blues","diverging","3d","colorblind-friendly"],name:"Blue and Red 20"},"div-green-purple-light":{stops:["#799100","#B8BF76","#C7BFBF","#BF72BB","#85007D"],tags:["light","purples","greens","diverging","colorblind-friendly"],name:"Purple and Green 15"},"div-blue-red-light":{stops:["#4596E6","#8FB0DE","#C4BCC7","#C0656B","#A60000"],tags:["light","reds","blues","diverging","colorblind-friendly"],name:"Blue and Red 21"},"div-green-purple-light-2":{stops:["#698C00","#98AF5B","#B3B8B6","#BF60B9","#A60098"],tags:["light","greens","purples","diverging","colorblind-friendly"],name:"Purple and Green 16"},"div-cyan-blue-light":{stops:["#00AFBF","#69CCCC","#C3CCBE","#D9AD70","#BF7000"],tags:["light","browns","greens","diverging","colorblind-friendly"],name:"Green and Brown 4"},"div-blue-yellow-light":{stops:["#4DA0FF","#8CC7FF","#C3D1C7","#D9D94B","#BFBF00"],tags:["light","yellows","blues","diverging","colorblind-friendly"],name:"Blue and Yellow 14"},"div-purple-yellow-light":{stops:["#805CC5","#A089BB","#BFB6B0","#B9A658","#B39500"],tags:["light","yellows","purples","diverging","colorblind-friendly"],name:"Purple and Yellow 7"},"div-magenta-yellow-light":{stops:["#98008B","#AE5DA0","#C4BAB5","#C1C15B","#B8B812"],tags:["light","yellows","purples","diverging","colorblind-friendly"],name:"Purple and Yellow 8"},"div-purple-green-light":{stops:["#805CC5","#A089BB","#B7BCC4","#98AF5B","#739900"],tags:["light","purples","greens","diverging","colorblind-friendly"],name:"Purple and Green 18"},"div-blue-blue":{stops:["#00A6A6","#56BFBF","#BFBFB4","#998355","#8C6338"],tags:["light","greens","browns","diverging","colorblind-friendly"],name:"Green and Brown 5"},"div-green-green":{stops:["#009940","#5BB084","#B1C1C2","#9098AF","#666E85"],tags:["light","greens","grays","diverging","colorblind-friendly"],name:"Green and Gray 7"},"div-blue-green-light":{stops:["#4596E6","#7FACD9","#B8C2CC","#A29F98","#767064"],tags:["light","grays","blues","diverging","colorblind-friendly"],name:"Blue and Gray 6"},"div-red-green-light":{stops:["#A62900","#B8755E","#C0BAC7","#939AB5","#697696"],tags:["light","reds","grays","diverging","colorblind-friendly"],name:"Red and Gray 7"},"div-blue-yellow-brown-light":{stops:["#308fa6","#6ca68b","#d2e096","#c7811e","#8c270e"],tags:["light","greens","browns","diverging","3d","colorblind-friendly"],name:"Green and Brown 6"},"div-blue-white-brown":{stops:["#308fa6","#98c7d3","#ffffff","#c67e6d","#8c270e"],tags:["light","greens","browns","diverging","3d","colorblind-friendly"],name:"Green and Brown 7"},"div-subdued-red-green":{1:["#ec8787"],2:["#ec8787","#70b6ba"],3:["#ec8787","#fff0d0","#70b6ba"],4:["#ec8787","#f9cbb3","#b7d5d7","#70b6ba"],5:["#ec8787","#f9cbb3","#fff0d0","#b7d5d7","#70b6ba"],6:["#ec8787","#f3a696","#f9cbb3","#b7d5d7","#93c6c9","#70b6ba"],7:["#ec8787","#f3a696","#f9cbb3","#fff0d0","#b7d5d7","#93c6c9","#70b6ba"],8:["#de6868","#ec8787","#f3a696","#f9cbb3","#dbe3d3","#b7d5d7","#93c6c9","#70b6ba"],9:["#de6868","#ec8787","#f3a696","#f9cbb3","#fff0d0","#dbe3d3","#b7d5d7","#93c6c9","#70b6ba"],10:["#de6868","#ec8787","#f3a696","#f9cbb3","#fff0d0","#dbe3d3","#b7d5d7","#93c6c9","#70b6ba","#5aa3b3"],stops:["#ec8787","#f9cbb3","#fff0d0","#b7d5d7","#70b6ba"],tags:["light","reds","yellows","greens","subdued","diverging","colorblind-friendly"],name:"Starburst"},"div-subdued-red-purple":{1:["#db897e"],2:["#db897e","#b592c4"],3:["#db897e","#ecf2cd","#b592c4"],4:["#db897e","#edcab2","#d8bde6","#b592c4"],5:["#db897e","#edcab2","#ecf2cd","#d8bde6","#b592c4"],6:["#db897e","#f3a196","#edcab2","#d8bde6","#c7a8d5","#b592c4"],7:["#db897e","#f3a196","#edcab2","#ecf2cd","#d8bde6","#c7a8d5","#b592c4"],8:["#c27166","#db897e","#f3a196","#edcab2","#d8bde6","#c7a8d5","#b592c4","#a47db3"],9:["#c27166","#db897e","#f3a196","#edcab2","#ecf2cd","#d8bde6","#c7a8d5","#b592c4","#a47db3"],10:["#c27166","#db897e","#f3a196","#edcab2","#ecf2cd","#dfd8da","#d8bde6","#c7a8d5","#b592c4","#a47db3"],stops:["#db897e","#edcab2","#ecf2cd","#d8bde6","#b592c4"],tags:["light","reds","yellows","purples","subdued","diverging","colorblind-friendly"],name:"Glorious Purpose"},"div-subdued-brown-gray":{1:["#bd9f83"],2:["#bd9f83","#c8d2d8"],3:["#bd9f83","#f4e6c8","#c8d2d8"],4:["#a98762","#ceb396","#c8d2d8","#8b9da7"],5:["#a98762","#ceb396","#f4e6c8","#c8d2d8","#8b9da7"],6:["#a98762","#bd9f83","#ceb396","#c8d2d8","#a9b7c0","#8b9da7"],7:["#a98762","#bd9f83","#ceb396","#f4e6c8","#c8d2d8","#a9b7c0","#8b9da7"],8:["#946f40","#a98762","#bd9f83","#ceb396","#c8d2d8","#a9b7c0","#8b9da7","#70848f"],9:["#946f40","#a98762","#bd9f83","#ceb396","#f4e6c8","#c8d2d8","#a9b7c0","#8b9da7","#70848f"],10:["#946f40","#a98762","#bd9f83","#ceb396","#dec8aa","#f4e6c8","#c8d2d8","#a9b7c0","#8b9da7","#70848f"],stops:["#a98762","#ceb396","#f4e6c8","#c8d2d8","#8b9da7"],tags:["light","browns","grays","subdued","diverging","colorblind-friendly"],name:"Desert Winds"},"div-subdued-sepia-gray":{1:["#dea37a"],2:["#dea37a","#c1d1db"],3:["#dea37a","#f5ebd4","#c1d1db"],4:["#d39367","#eab28c","#c1d1db","#839ba8"],5:["#d39367","#eab28c","#f5ebd4","#c1d1db","#839ba8"],6:["#d39367","#dea37a","#eab28c","#c1d1db","#a2b6c2","#839ba8"],7:["#d39367","#dea37a","#eab28c","#f5ebd4","#c1d1db","#a2b6c2","#839ba8"],8:["#b87a4f","#d39367","#dea37a","#eab28c","#c1d1db","#a2b6c2","#839ba8","#64808f"],9:["#b87a4f","#d39367","#dea37a","#eab28c","#f5ebd4","#c1d1db","#a2b6c2","#839ba8","#64808f"],10:["#b87a4f","#d39367","#dea37a","#eab28c","#f2ceb5","#f5ebd4","#c1d1db","#a2b6c2","#839ba8","#64808f"],stops:["#d39367","#eab28c","#f5ebd4","#c1d1db","#839ba8"],tags:["light","browns","grays","subdued","diverging","colorblind-friendly"],name:"Cigar Smoke"},"div-subdued-blue-gray":{1:["#86b6cf"],2:["#86b6cf","#d9c8cf"],3:["#86b6cf","#e6f5e6","#d9c8cf"],4:["#72a3bd","#9ac9e0","#d9c8cf","#a6999e"],5:["#72a3bd","#9ac9e0","#e6f5e6","#d9c8cf","#a6999e"],6:["#72a3bd","#86b6cf","#9ac9e0","#d9c8cf","#bfb0b7","#a6999e"],7:["#72a3bd","#86b6cf","#9ac9e0","#e6f5e6","#d9c8cf","#bfb0b7","#a6999e"],8:["#5e90ab","#72a3bd","#86b6cf","#9ac9e0","#d9c8cf","#bfb0b7","#a6999e","#8c8186"],9:["#5e90ab","#72a3bd","#86b6cf","#9ac9e0","#e6f5e6","#d9c8cf","#bfb0b7","#a6999e","#8c8186"],10:["#5e90ab","#72a3bd","#86b6cf","#9ac9e0","#aedcf2","#e6f5e6","#d9c8cf","#bfb0b7","#a6999e","#8c8186"],stops:["#72a3bd","#9ac9e0","#e6f5e6","#d9c8cf","#a6999e"],tags:["light","blues","grays","subdued","diverging","colorblind-friendly"],name:"Seattle Skyline"},"div-subdued-tan-blue":{1:["#f9cbb3"],2:["#f9cbb3","#aedcf2"],3:["#f9cbb3","#5e435a","#aedcf2"],4:["#f9cbb3","#9e7871","#567787","#aedcf2"],5:["#f9cbb3","#9e7871","#5e435a","#567787","#aedcf2"],6:["#f9cbb3","#c9a090","#9e7871","#567787","#8bb2c5","#aedcf2"],7:["#f9cbb3","#c9a090","#9e7871","#5e435a","#567787","#8bb2c5","#aedcf2"],8:["#f9cbb3","#c9a090","#9e7871","#7d5757","#567787","#688899","#8bb2c5","#aedcf2"],9:["#f9cbb3","#c9a090","#9e7871","#7d5757","#5e435a","#567787","#688899","#8bb2c5","#aedcf2"],10:["#f9cbb3","#c9a090","#9e7871","#7d5757","#5e435a","#456373","#567787","#688899","#8bb2c5","#aedcf2"],stops:["#f9cbb3","#9e7871","#5e435a","#567787","#aedcf2"],tags:["dark","browns","blues","subdued","diverging","colorblind-friendly"],name:"Desert Rain"},"div-subdued-green-blue":{1:["#cdd9b8"],2:["#cdd9b8","#aecaf2"],3:["#cdd9b8","#58506b","#aecaf2"],4:["#cdd9b8","#757d61","#5e728f","#aecaf2"],5:["#cdd9b8","#757d61","#58506b","#5e728f","#aecaf2"],6:["#cdd9b8","#9ba689","#757d61","#5e728f","#8fa8cc","#aecaf2"],7:["#cdd9b8","#9ba689","#757d61","#58506b","#5e728f","#8fa8cc","#aecaf2"],8:["#cdd9b8","#9ba689","#757d61","#596144","#5e728f","#778ead","#8fa8cc","#aecaf2"],9:["#cdd9b8","#9ba689","#757d61","#596144","#58506b","#5e728f","#778ead","#8fa8cc","#aecaf2"],10:["#cdd9b8","#9ba689","#757d61","#596144","#58506b","#4c607d","#5e728f","#778ead","#8fa8cc","#aecaf2"],stops:["#cdd9b8","#757d61","#58506b","#5e728f","#aecaf2"],tags:["dark","greens","blues","subdued","diverging","colorblind-friendly"],name:"Milky Way"},"div-subdued-green-pink":{1:["#ffb7e7"],2:["#cdd9b8","#ffb7e7"],3:["#cdd9b8","#424c59","#ffb7e7"],4:["#cdd9b8","#757d61","#8c5b7c","#ffb7e7"],5:["#cdd9b8","#757d61","#424c59","#8c5b7c","#ffb7e7"],6:["#cdd9b8","#9ba689","#757d61","#8c5b7c","#d697c1","#ffb7e7"],7:["#cdd9b8","#9ba689","#757d61","#424c59","#8c5b7c","#d697c1","#ffb7e7"],8:["#cdd9b8","#9ba689","#757d61","#596144","#8c5b7c","#ad769b","#d697c1","#ffb7e7"],9:["#cdd9b8","#9ba689","#757d61","#596144","#424c59","#8c5b7c","#ad769b","#d697c1","#ffb7e7"],10:["#cdd9b8","#9ba689","#757d61","#596144","#424c59","#784868","#8c5b7c","#ad769b","#d697c1","#ffb7e7"],stops:["#cdd9b8","#757d61","#424c59","#8c5b7c","#ffb7e7"],tags:["dark","greens","purples","pinks","subdued","diverging","colorblind-friendly"],name:"Soft Velvet"},"div-subdued-green-brown":{1:["#3b9ea2"],2:["#3b9ea2","#e9bbb2"],3:["#3b9ea2","#d8d9ce","#e9bbb2"],4:["#006e76","#3b9ea2","#e9bbb2","#cca199"],5:["#006e76","#3b9ea2","#d8d9ce","#e9bbb2","#cca199"],6:["#006e76","#3b9ea2","#8cb2b2","#f8c8be","#e9bbb2","#cca199"],7:["#006e76","#3b9ea2","#8cb2b2","#d8d9ce","#f8c8be","#e9bbb2","#cca199"],8:["#006e76","#3b9ea2","#63a8aa","#8cb2b2","#f8c8be","#e9bbb2","#dbaea5","#cca199"],9:["#006e76","#3b9ea2","#63a8aa","#8cb2b2","#d8d9ce","#f8c8be","#e9bbb2","#dbaea5","#cca199"],10:["#006e76","#1e868c","#3b9ea2","#63a8aa","#8cb2b2","#d8d9ce","#f8c8be","#e9bbb2","#dbaea5","#cca199"],stops:["#006e76","#3b9ea2","#d8d9ce","#e9bbb2","#cca199"],tags:["light","browns","greens","subdued","diverging","colorblind-friendly"],name:"Conifer Forest"},"div-lines-blue-brown":{1:["#a3d9bb"],2:["#005a8c","#806000"],3:["#005a8c","#a3d9bb","#806000"],4:["#005a8c","#0099d1","#a68721","#806000"],5:["#005a8c","#0099d1","#a3d9bb","#a68721","#806000"],6:["#005a8c","#0099d1","#00b5f2","#b1ae74","#a68721","#806000"],7:["#005a8c","#0099d1","#00b5f2","#a3d9bb","#b1ae74","#a68721","#806000"],8:["#005a8c","#007aad","#0099d1","#00b5f2","#b1ae74","#a68721","#937411","#806000"],9:["#005a8c","#007aad","#0099d1","#00b5f2","#a3d9bb","#b1ae74","#a68721","#937411","#806000"],10:["#005a8c","#007aad","#0099d1","#00b5f2","#4cc3d9","#a3d9bb","#b1ae74","#a68721","#937411","#806000"],stops:["#005a8c","#0099d1","#a3d9bb","#a68721","#806000"],tags:["light","blues","browns","lines","diverging","colorblind-friendly"],name:"Queen Conch Shell"},"div-lines-green-purple":{1:["#ebb788"],2:["#3a7300","#ab0080"],3:["#3a7300","#ebb788","#ab0080"],4:["#3a7300","#53a600","#d957b9","#ab0080"],5:["#3a7300","#53a600","#ebb788","#d957b9","#ab0080"],6:["#3a7300","#53a600","#83a63c","#e39199","#d957b9","#ab0080"],7:["#3a7300","#53a600","#83a63c","#ebb788","#e39199","#d957b9","#ab0080"],8:["#3a7300","#478d00","#53a600","#83a63c","#e39199","#d957b9","#c62ca0","#ab0080"],9:["#3a7300","#478d00","#53a600","#83a63c","#ebb788","#e39199","#d957b9","#c62ca0","#ab0080"],10:["#3a7300","#478d00","#53a600","#83a63c","#ebb788","#e39199","#e673b0","#d957b9","#c62ca0","#ab0080"],stops:["#3a7300","#53a600","#ebb788","#d957b9","#ab0080"],tags:["light","greens","purples","pinks","lines","diverging","colorblind-friendly"],name:"Thai Lily"},"div-lines-red-gray":{1:["#b89fa0"],2:["#850000","#50567a"],3:["#850000","#b89fa0","#50567a"],4:["#850000","#d12020","#8790bf","#50567a"],5:["#850000","#d12020","#b89fa0","#8790bf","#50567a"],6:["#850000","#d12020","#eb2f2f","#8790bf","#6c739d","#50567a"],7:["#850000","#d12020","#eb2f2f","#b89fa0","#8790bf","#6c739d","#50567a"],8:["#850000","#ac1010","#d12020","#eb2f2f","#9b92b9","#8790bf","#6c739d","#50567a"],9:["#850000","#ac1010","#d12020","#eb2f2f","#b89fa0","#9b92b9","#8790bf","#6c739d","#50567a"],10:["#850000","#ac1010","#d12020","#eb2f2f","#e3717e","#b89fa0","#9b92b9","#8790bf","#6c739d","#50567a"],stops:["#850000","#d12020","#b89fa0","#8790bf","#50567a"],tags:["light","reds","grays","lines","diverging","colorblind-friendly"],name:"Icy Rouge"},"div-lines-green-orange":{1:["#315b61"],2:["#ffaa00","#00ffd4"],3:["#ffaa00","#315b61","#00ffd4"],4:["#ffaa00","#b45a00","#00b294","#00ffd4"],5:["#ffaa00","#b45a00","#315b61","#00b294","#00ffd4"],6:["#ffaa00","#e67500","#b45a00","#008c74","#00b294","#00ffd4"],7:["#ffaa00","#e67500","#b45a00","#315b61","#008c74","#00b294","#00ffd4"],8:["#ffaa00","#f28e00","#e67500","#b45a00","#008c74","#00b294","#00d9b4","#00ffd4"],9:["#ffaa00","#f28e00","#e67500","#b45a00","#315b61","#008c74","#00b294","#00d9b4","#00ffd4"],10:["#ffaa00","#f28e00","#e67500","#cd6700","#b45a00","#315b61","#008c74","#00b294","#00d9b4","#00ffd4"],stops:["#ffaa00","#b45a00","#315b61","#00b294","#00ffd4"],tags:["dark","oranges","greens","lines","diverging","colorblind-friendly"],name:"Halloween Morning"},"div-lines-yellow-blue":{1:["#2d5959"],2:["#ffff00","#99bbff"],3:["#ffff00","#2d5959","#99bbff"],4:["#ffff00","#a19700","#457ae6","#99bbff"],5:["#ffff00","#a19700","#2d5959","#457ae6","#99bbff"],6:["#ffff00","#c0ba00","#a19700","#457ae6","#6f9bf3","#99bbff"],7:["#ffff00","#c0ba00","#a19700","#2d5959","#457ae6","#6f9bf3","#99bbff"],8:["#ffff00","#c0ba00","#a19700","#67782d","#3b6ba3","#457ae6","#6f9bf3","#99bbff"],9:["#ffff00","#c0ba00","#a19700","#67782d","#2d5959","#3b6ba3","#457ae6","#6f9bf3","#99bbff"],10:["#ffff00","#e0dc00","#c0ba00","#a19700","#67782d","#2d5959","#3b6ba3","#457ae6","#6f9bf3","#99bbff"],stops:["#ffff00","#a19700","#2d5959","#457ae6","#99bbff"],tags:["dark","yellows","blues","lines","diverging","colorblind-friendly"],name:"Fire and Ice"},"div-esribrand-red-bluegreen":{1:["#f07062"],2:["#d83020","#009b98"],3:["#d83020","#ffe0d9","#009b98"],4:["#a8281e","#f07062","#00bab5","#00807d"],5:["#a8281e","#f07062","#ffe0d9","#00bab5","#00807d"],6:["#a8281e","#f07062","#fbb3ab","#56d6d4","#00bab5","#00807d"],7:["#a8281e","#f07062","#fbb3ab","#ffe0d9","#56d6d4","#00bab5","#00807d"],8:["#a8281e","#d83020","#f07062","#fbb3ab","#b8d9d5","#56d6d4","#00bab5","#00807d"],9:["#a8281e","#d83020","#f07062","#fbb3ab","#ffe0d9","#b8d9d5","#56d6d4","#00bab5","#00807d"],10:["#a8281e","#d83020","#f07062","#fbb3ab","#ffe0d9","#b8d9d5","#56d6d4","#00bab5","#009b98","#00807d"],stops:["#a8281e","#f07062","#ffe0d9","#00bab5","#00807d"],tags:["light","reds","greens","diverging","esri-brand","colorblind-friendly"],name:"Esri Red and Green 1"},"div-esribrand-red-blue":{1:["#f07062"],2:["#d83020","#007ac2"],3:["#d83020","#ffd6cc","#007ac2"],4:["#a8281e","#f07062","#50a7da","#00619b"],5:["#a8281e","#f07062","#ffd6cc","#50a7da","#00619b"],6:["#a8281e","#f07062","#fbb1a8","#8ec4e6","#50a7da","#00619b"],7:["#a8281e","#f07062","#fbb1a8","#ffd6cc","#8ec4e6","#50a7da","#00619b"],8:["#a8281e","#d83020","#f07062","#fbb1a8","#c7cfd9","#8ec4e6","#50a7da","#00619b"],9:["#a8281e","#d83020","#f07062","#fbb1a8","#ffd6cc","#c7cfd9","#8ec4e6","#50a7da","#00619b"],10:["#a8281e","#d83020","#f07062","#fbb1a8","#ffd6cc","#c7cfd9","#8ec4e6","#50a7da","#007ac2","#00619b"],stops:["#a8281e","#f07062","#ffd6cc","#50a7da","#00619b"],tags:["light","reds","blues","diverging","esri-brand","colorblind-friendly"],name:"Esri Red and Blue 1"},"div-esribrand-red-violet":{1:["#f07062"],2:["#d83020","#6a3fa6"],3:["#d83020","#ffd6cc","#6a3fa6"],4:["#a8281e","#f07062","#987ac3","#4e2c7e"],5:["#a8281e","#f07062","#ffd6cc","#987ac3","#4e2c7e"],6:["#a8281e","#f07062","#fbb1a8","#c1a7d9","#987ac3","#4e2c7e"],7:["#a8281e","#f07062","#fbb1a8","#ffd6cc","#c1a7d9","#987ac3","#4e2c7e"],8:["#a8281e","#d83020","#f07062","#fbb1a8","#e0bfdd","#c1a7d9","#987ac3","#4e2c7e"],9:["#a8281e","#d83020","#f07062","#fbb1a8","#ffd6cc","#e0bfdd","#c1a7d9","#987ac3","#4e2c7e"],10:["#a8281e","#d83020","#f07062","#fbb1a8","#ffd6cc","#e0bfdd","#c1a7d9","#987ac3","#6a3fa6","#4e2c7e"],stops:["#a8281e","#f07062","#ffd6cc","#987ac3","#4e2c7e"],tags:["light","reds","purples","diverging","esri-brand","colorblind-friendly"],name:"Esri Red and Purple 1"},"div-esribrand-red-violetred":{1:["#f07062"],2:["#d83020","#8e499b"],3:["#d83020","#ffd6cc","#8e499b"],4:["#a8281e","#f07062","#b983c3","#73377e"],5:["#a8281e","#f07062","#ffd6cc","#b983c3","#73377e"],6:["#a8281e","#f07062","#fbb1a8","#d3abd5","#b983c3","#73377e"],7:["#a8281e","#f07062","#fbb1a8","#ffd6cc","#d3abd5","#b983c3","#73377e"],8:["#a8281e","#d83020","#f07062","#fbb1a8","#e9beca","#d3abd5","#b983c3","#73377e"],9:["#a8281e","#d83020","#f07062","#fbb1a8","#ffd6cc","#e9beca","#d3abd5","#b983c3","#73377e"],10:["#a8281e","#d83020","#f07062","#fbb1a8","#ffd6cc","#e9beca","#d3abd5","#b983c3","#8e499b","#73377e"],stops:["#a8281e","#f07062","#ffd6cc","#b983c3","#73377e"],tags:["light","reds","purples","diverging","esri-brand","colorblind-friendly"],name:"Esri Red and Purple 2"},"div-esribrand-red-gray":{1:["#ffd6cc"],2:["#a8281e","#404040"],3:["#a8281e","#ffd6cc","#404040"],4:["#a8281e","#f07062","#999999","#404040"],5:["#a8281e","#f07062","#ffd6cc","#999999","#404040"],6:["#a8281e","#f07062","#fbb1a8","#d6c5c3","#999999","#404040"],7:["#a8281e","#f07062","#fbb1a8","#ffd6cc","#d6c5c3","#999999","#404040"],8:["#a8281e","#d83020","#f07062","#fbb1a8","#d6c5c3","#c0bab9","#999999","#404040"],9:["#a8281e","#d83020","#f07062","#fbb1a8","#ffd6cc","#d6c5c3","#c0bab9","#999999","#404040"],10:["#a8281e","#d83020","#f07062","#fbb1a8","#ffd6cc","#d6c5c3","#c0bab9","#999999","#666666","#404040"],stops:["#a8281e","#f07062","#ffd6cc","#999999","#404040"],tags:["light","reds","grays","diverging","esri-brand","colorblind-friendly"],name:"Esri Red and Gray 1"},"div-esribrand-redorange-greenblue":{1:["#e97e5a"],2:["#da4d1e","#009b98"],3:["#da4d1e","#ffd0bf","#009b98"],4:["#963413","#e97e5a","#00bab5","#00807d"],5:["#963413","#e97e5a","#ffd0bf","#00bab5","#00807d"],6:["#963413","#e97e5a","#f4a78d","#56d6d4","#00bab5","#00807d"],7:["#963413","#e97e5a","#f4a78d","#ffd0bf","#56d6d4","#00bab5","#00807d"],8:["#963413","#da4d1e","#e97e5a","#f4a78d","#b8d9d5","#56d6d4","#00bab5","#00807d"],9:["#963413","#da4d1e","#e97e5a","#f4a78d","#ffd0bf","#b8d9d5","#56d6d4","#00bab5","#00807d"],10:["#963413","#da4d1e","#e97e5a","#f4a78d","#ffd0bf","#b8d9d5","#56d6d4","#00bab5","#009b98","#00807d"],stops:["#963413","#e97e5a","#ffd0bf","#00bab5","#00807d"],tags:["light","reds","greens","diverging","esri-brand","colorblind-friendly"],name:"Esri Red and Green 2"},"div-esribrand-redorange-blue":{1:["#e97e5a"],2:["#da4d1e","#3c8ab8"],3:["#da4d1e","#ffd0bf","#3c8ab8"],4:["#963413","#e97e5a","#79b2d5","#00619b"],5:["#963413","#e97e5a","#ffd0bf","#79b2d5","#00619b"],6:["#963413","#e97e5a","#f4a78d","#a5cbe3","#79b2d5","#00619b"],7:["#963413","#e97e5a","#f4a78d","#ffd0bf","#a5cbe3","#79b2d5","#00619b"],8:["#963413","#da4d1e","#e97e5a","#f4a78d","#d2ced1","#a5cbe3","#79b2d5","#00619b"],9:["#963413","#da4d1e","#e97e5a","#f4a78d","#ffd0bf","#d2ced1","#a5cbe3","#79b2d5","#00619b"],10:["#963413","#da4d1e","#e97e5a","#f4a78d","#ffd0bf","#d2ced1","#a5cbe3","#79b2d5","#3c8ab8","#00619b"],stops:["#963413","#e97e5a","#ffd0bf","#79b2d5","#00619b"],tags:["light","reds","blues","diverging","esri-brand","colorblind-friendly"],name:"Esri Red and Blue 2"},"div-esribrand-redorange-violet":{1:["#e97e5a"],2:["#da4d1e","#633b9b"],3:["#da4d1e","#ffd0bf","#633b9b"],4:["#963413","#e97e5a","#987ac3","#4e2c7e"],5:["#963413","#e97e5a","#ffd0bf","#987ac3","#4e2c7e"],6:["#963413","#e97e5a","#f4a78d","#bfa8d7","#987ac3","#4e2c7e"],7:["#963413","#e97e5a","#f4a78d","#ffd0bf","#bfa8d7","#987ac3","#4e2c7e"],8:["#963413","#da4d1e","#e97e5a","#f4a78d","#d2bccb","#bfa8d7","#987ac3","#4e2c7e"],9:["#963413","#da4d1e","#e97e5a","#f4a78d","#ffd0bf","#d2bccb","#bfa8d7","#987ac3","#4e2c7e"],10:["#963413","#da4d1e","#e97e5a","#f4a78d","#ffd0bf","#d2bccb","#bfa8d7","#987ac3","#633b9b","#4e2c7e"],stops:["#963413","#e97e5a","#ffd0bf","#987ac3","#4e2c7e"],tags:["light","reds","purples","diverging","esri-brand","colorblind-friendly"],name:"Esri Red and Purple 3"},"div-esribrand-redorange-violetred":{1:["#e97e5a"],2:["#da4d1e","#8e499b"],3:["#da4d1e","#ffd0bf","#8e499b"],4:["#963413","#e97e5a","#b983c3","#73377e"],5:["#963413","#e97e5a","#ffd0bf","#b983c3","#73377e"],6:["#963413","#e97e5a","#f4a78d","#d3abd5","#b983c3","#73377e"],7:["#963413","#e97e5a","#f4a78d","#ffd0bf","#d3abd5","#b983c3","#73377e"],8:["#963413","#da4d1e","#e97e5a","#f4a78d","#e9beca","#d3abd5","#b983c3","#73377e"],9:["#963413","#da4d1e","#e97e5a","#f4a78d","#ffd0bf","#e9beca","#d3abd5","#b983c3","#73377e"],10:["#963413","#da4d1e","#e97e5a","#f4a78d","#ffd0bf","#e9beca","#d3abd5","#b983c3","#8e499b","#73377e"],stops:["#963413","#e97e5a","#ffd0bf","#b983c3","#73377e"],tags:["light","reds","purples","diverging","esri-brand","colorblind-friendly"],name:"Esri Red and Purple 4"},"div-esribrand-redorange-gray":{1:["#e97e5a"],2:["#da4d1e","#666666"],3:["#da4d1e","#ffd0bf","#666666"],4:["#963413","#e97e5a","#999999","#404040"],5:["#963413","#e97e5a","#ffd0bf","#999999","#404040"],6:["#963413","#e97e5a","#f4a78d","#bcbcbc","#999999","#404040"],7:["#963413","#e97e5a","#f4a78d","#ffd0bf","#bcbcbc","#999999","#404040"],8:["#963413","#da4d1e","#e97e5a","#f4a78d","#d7c6be","#bcbcbc","#999999","#404040"],9:["#963413","#da4d1e","#e97e5a","#f4a78d","#ffd0bf","#d7c6be","#bcbcbc","#999999","#404040"],10:["#963413","#da4d1e","#e97e5a","#f4a78d","#ffd0bf","#d7c6be","#bcbcbc","#999999","#666666","#404040"],stops:["#963413","#e97e5a","#ffd0bf","#999999","#404040"],tags:["light","reds","grays","diverging","esri-brand","colorblind-friendly"],name:"Esri Red and Gray 2"},"div-esribrand-orange-greenblue":{1:["#f89960"],2:["#f36f20","#009b98"],3:["#f36f20","#ffd8bf","#009b98"],4:["#b35116","#f89960","#00bab5","#00807d"],5:["#b35116","#f89960","#ffd8bf","#00bab5","#00807d"],6:["#b35116","#f89960","#fcb990","#56d6d4","#00bab5","#00807d"],7:["#b35116","#f89960","#fcb990","#ffd8bf","#56d6d4","#00bab5","#00807d"],8:["#b35116","#f36f20","#f89960","#fcb990","#b8d9d5","#56d6d4","#00bab5","#00807d"],9:["#b35116","#f36f20","#f89960","#fcb990","#ffd8bf","#b8d9d5","#56d6d4","#00bab5","#00807d"],10:["#b35116","#f36f20","#f89960","#fcb990","#ffd8bf","#b8d9d5","#56d6d4","#00bab5","#009b98","#00807d"],stops:["#b35116","#f89960","#ffd8bf","#00bab5","#00807d"],tags:["light","reds","greens","diverging","esri-brand","colorblind-friendly"],name:"Esri Orange and Green 1"},"div-esribrand-orange-blue":{1:["#f89960"],2:["#f36f20","#007ac2"],3:["#f36f20","#ffd8bf","#007ac2"],4:["#b35116","#f89960","#50a7da","#00619b"],5:["#b35116","#f89960","#ffd8bf","#50a7da","#00619b"],6:["#b35116","#f89960","#fcb990","#91bcd5","#50a7da","#00619b"],7:["#b35116","#f89960","#fcb990","#ffd8bf","#91bcd5","#50a7da","#00619b"],8:["#b35116","#f36f20","#f89960","#fcb990","#d1d1d0","#91bcd5","#50a7da","#00619b"],9:["#b35116","#f36f20","#f89960","#fcb990","#ffd8bf","#d1d1d0","#91bcd5","#50a7da","#00619b"],10:["#b35116","#f36f20","#f89960","#fcb990","#ffd8bf","#d1d1d0","#91bcd5","#50a7da","#007ac2","#00619b"],stops:["#b35116","#f89960","#ffd8bf","#50a7da","#00619b"],tags:["light","oranges","blues","diverging","esri-brand","colorblind-friendly"],name:"Esri Orange and Blue 1"},"div-esribrand-orange-violet":{1:["#f89960"],2:["#f36f20","#633b9b"],3:["#f36f20","#ffd8bf","#633b9b"],4:["#b35116","#f89960","#987ac3","#4e2c7e"],5:["#b35116","#f89960","#ffd8bf","#987ac3","#4e2c7e"],6:["#b35116","#f89960","#fcb990","#bca0ca","#987ac3","#4e2c7e"],7:["#b35116","#f89960","#fcb990","#ffd8bf","#bca0ca","#987ac3","#4e2c7e"],8:["#b35116","#f36f20","#f89960","#fcb990","#e0c5d0","#bca0ca","#987ac3","#4e2c7e"],9:["#b35116","#f36f20","#f89960","#fcb990","#ffd8bf","#e0c5d0","#bca0ca","#987ac3","#4e2c7e"],10:["#b35116","#f36f20","#f89960","#fcb990","#ffd8bf","#e0c5d0","#bca0ca","#987ac3","#633b9b","#4e2c7e"],stops:["#b35116","#f89960","#ffd8bf","#987ac3","#4e2c7e"],tags:["light","oranges","purples","diverging","esri-brand","colorblind-friendly"],name:"Esri Orange and Purple 1"},"div-esribrand-orange-violetred":{1:["#f89960"],2:["#f36f20","#8e499b"],3:["#f36f20","#ffd8bf","#8e499b"],4:["#b35116","#f89960","#b983c3","#73377e"],5:["#b35116","#f89960","#ffd8bf","#b983c3","#73377e"],6:["#b35116","#f89960","#fcb990","#d5a6cc","#b983c3","#73377e"],7:["#b35116","#f89960","#fcb990","#ffd8bf","#d5a6cc","#b983c3","#73377e"],8:["#b35116","#f36f20","#f89960","#fcb990","#f0c8d4","#d5a6cc","#b983c3","#73377e"],9:["#b35116","#f36f20","#f89960","#fcb990","#ffd8bf","#f0c8d4","#d5a6cc","#b983c3","#73377e"],10:["#b35116","#f36f20","#f89960","#fcb990","#ffd8bf","#f0c8d4","#d5a6cc","#b983c3","#8e499b","#73377e"],stops:["#b35116","#f89960","#ffd8bf","#b983c3","#73377e"],tags:["light","oranges","purples","diverging","esri-brand","colorblind-friendly"],name:"Esri Orange and Purple 2"},"div-esribrand-orange-gray":{1:["#f89960"],2:["#f36f20","#666666"],3:["#f36f20","#ffd8bf","#666666"],4:["#b35116","#f89960","#999999","#404040"],5:["#b35116","#f89960","#ffd8bf","#999999","#404040"],6:["#b35116","#f89960","#fcb990","#b8b2ac","#999999","#404040"],7:["#b35116","#f89960","#fcb990","#ffd8bf","#b8b2ac","#999999","#404040"],8:["#b35116","#f36f20","#f89960","#fcb990","#d7cbbf","#b8b2ac","#999999","#404040"],9:["#b35116","#f36f20","#f89960","#fcb990","#ffd8bf","#d7cbbf","#b8b2ac","#999999","#404040"],10:["#b35116","#f36f20","#f89960","#fcb990","#ffd8bf","#d7cbbf","#b8b2ac","#999999","#666666","#404040"],stops:["#b35116","#f89960","#ffd8bf","#999999","#404040"],tags:["light","oranges","grays","diverging","esri-brand","colorblind-friendly"],name:"Esri Orange and Gray 1"},"div-esribrand-orangeyellow-greenblue":{1:["#fbb664"],2:["#f29526","#009b98"],3:["#f29526","#ffe7c7","#009b98"],4:["#c67718","#fbb664","#00bab5","#00807d"],5:["#c67718","#fbb664","#ffe7c7","#00bab5","#00807d"],6:["#c67718","#fbb664","#fdcc92","#56d6d4","#00bab5","#00807d"],7:["#c67718","#fbb664","#fdcc92","#ffe7c7","#56d6d4","#00bab5","#00807d"],8:["#c67718","#f29526","#fbb664","#fdcc92","#b8d9d5","#56d6d4","#00bab5","#00807d"],9:["#c67718","#f29526","#fbb664","#fdcc92","#ffe7c7","#b8d9d5","#56d6d4","#00bab5","#00807d"],10:["#c67718","#f29526","#fbb664","#fdcc92","#ffe7c7","#b8d9d5","#56d6d4","#00bab5","#009b98","#00807d"],stops:["#c67718","#fbb664","#ffe7c7","#00bab5","#00807d"],tags:["light","browns","greens","diverging","esri-brand","colorblind-friendly"],name:"Esri Orange and Green 2"},"div-esribrand-orangeyellow-blue":{1:["#fbb664"],2:["#f29526","#007ac2"],3:["#f29526","#ffe7c7","#007ac2"],4:["#c67718","#fbb664","#50a7da","#00619b"],5:["#c67718","#fbb664","#ffe7c7","#50a7da","#00619b"],6:["#c67718","#fbb664","#fdcc92","#8cc9ed","#50a7da","#00619b"],7:["#c67718","#fbb664","#fdcc92","#ffe7c7","#8cc9ed","#50a7da","#00619b"],8:["#c67718","#f29526","#fbb664","#fdcc92","#c6d8da","#8cc9ed","#50a7da","#00619b"],9:["#c67718","#f29526","#fbb664","#fdcc92","#ffe7c7","#c6d8da","#8cc9ed","#50a7da","#00619b"],10:["#c67718","#f29526","#fbb664","#fdcc92","#ffe7c7","#c6d8da","#8cc9ed","#50a7da","#007ac2","#00619b"],stops:["#c67718","#fbb664","#ffe7c7","#50a7da","#00619b"],tags:["light","browns","blues","diverging","esri-brand","colorblind-friendly"],name:"Esri Orange and Blue 2"},"div-esribrand-orangeyellow-violet":{1:["#fbb664"],2:["#f29526","#633b9b"],3:["#f29526","#ffe7c7","#633b9b"],4:["#c67718","#fbb664","#987ac3","#4e2c7e"],5:["#c67718","#fbb664","#ffe7c7","#987ac3","#4e2c7e"],6:["#c67718","#fbb664","#fdcc92","#c0aae1","#987ac3","#4e2c7e"],7:["#c67718","#fbb664","#fdcc92","#ffe7c7","#c0aae1","#987ac3","#4e2c7e"],8:["#c67718","#f29526","#fbb664","#fdcc92","#e0c9d4","#c0aae1","#987ac3","#4e2c7e"],9:["#c67718","#f29526","#fbb664","#fdcc92","#ffe7c7","#e0c9d4","#c0aae1","#987ac3","#4e2c7e"],10:["#c67718","#f29526","#fbb664","#fdcc92","#ffe7c7","#e0c9d4","#c0aae1","#987ac3","#633b9b","#4e2c7e"],stops:["#c67718","#fbb664","#ffe7c7","#987ac3","#4e2c7e"],tags:["light","browns","oranges","purples","diverging","esri-brand","colorblind-friendly"],name:"Esri Orange and Purple 3"},"div-esribrand-orangeyellow-violetred":{1:["#fbb664"],2:["#f29526","#8e499b"],3:["#f29526","#ffe7c7","#8e499b"],4:["#c67718","#fbb664","#b983c3","#73377e"],5:["#c67718","#fbb664","#ffe7c7","#b983c3","#73377e"],6:["#c67718","#fbb664","#fdcc92","#daafe1","#b983c3","#73377e"],7:["#c67718","#fbb664","#fdcc92","#ffe7c7","#daafe1","#b983c3","#73377e"],8:["#c67718","#f29526","#fbb664","#fdcc92","#edcbd4","#daafe1","#b983c3","#73377e"],9:["#c67718","#f29526","#fbb664","#fdcc92","#ffe7c7","#edcbd4","#daafe1","#b983c3","#73377e"],10:["#c67718","#f29526","#fbb664","#fdcc92","#ffe7c7","#edcbd4","#daafe1","#b983c3","#8e499b","#73377e"],stops:["#c67718","#fbb664","#ffe7c7","#b983c3","#73377e"],tags:["light","browns","oranges","purples","diverging","esri-brand","colorblind-friendly"],name:"Esri Orange and Purple 4"},"div-esribrand-orangeyellow-gray":{1:["#fbb664"],2:["#f29526","#666666"],3:["#f29526","#ffe7c7","#666666"],4:["#c67718","#fbb664","#999999","#404040"],5:["#c67718","#fbb664","#ffe7c7","#999999","#404040"],6:["#c67718","#fbb664","#fdcc92","#bcbcbc","#999999","#404040"],7:["#c67718","#fbb664","#fdcc92","#ffe7c7","#bcbcbc","#999999","#404040"],8:["#c67718","#f29526","#fbb664","#fdcc92","#d7d2c2","#bcbcbc","#999999","#404040"],9:["#c67718","#f29526","#fbb664","#fdcc92","#ffe7c7","#d7d2c2","#bcbcbc","#999999","#404040"],10:["#c67718","#f29526","#fbb664","#fdcc92","#ffe7c7","#d7d2c2","#bcbcbc","#999999","#666666","#404040"],stops:["#c67718","#fbb664","#ffe7c7","#999999","#404040"],tags:["light","browns","grays","diverging","esri-brand","colorblind-friendly"],name:"Esri Orange and Gray 2"},"div-esribrand-yellow-green-blue":{1:["#e8d966"],2:["#dbc62c","#009b98"],3:["#dbc62c","#fff58f","#009b98"],4:["#beac2d","#e8d966","#00bab5","#00807d"],5:["#beac2d","#e8d966","#fff58f","#00bab5","#00807d"],6:["#beac2d","#e8d966","#f5e998","#56d6d4","#00bab5","#00807d"],7:["#beac2d","#e8d966","#f5e998","#fff58f","#56d6d4","#00bab5","#00807d"],8:["#beac2d","#dbc62c","#e8d966","#f5e998","#b8d9d5","#56d6d4","#00bab5","#00807d"],9:["#beac2d","#dbc62c","#e8d966","#f5e998","#fff58f","#b8d9d5","#56d6d4","#00bab5","#00807d"],10:["#beac2d","#dbc62c","#e8d966","#f5e998","#fff58f","#b8d9d5","#56d6d4","#00bab5","#009b98","#00807d"],stops:["#beac2d","#e8d966","#fff58f","#00bab5","#00807d"],tags:["light","yellows","greens","diverging","esri-brand","colorblind-friendly"],name:"Esri Yellow and Green 1"},"div-esribrand-yellow-blue":{1:["#e8d966"],2:["#dbc62c","#007ac2"],3:["#dbc62c","#fff58f","#007ac2"],4:["#beac2d","#e8d966","#50a7da","#00619b"],5:["#beac2d","#e8d966","#fff58f","#50a7da","#00619b"],6:["#beac2d","#e8d966","#f5e998","#8ec7de","#50a7da","#00619b"],7:["#beac2d","#e8d966","#f5e998","#fff58f","#8ec7de","#50a7da","#00619b"],8:["#beac2d","#dbc62c","#e8d966","#f5e998","#cce6e2","#8ec7de","#50a7da","#00619b"],9:["#beac2d","#dbc62c","#e8d966","#f5e998","#fff58f","#cce6e2","#8ec7de","#50a7da","#00619b"],10:["#beac2d","#dbc62c","#e8d966","#f5e998","#fff58f","#cce6e2","#8ec7de","#50a7da","#007ac2","#00619b"],stops:["#beac2d","#e8d966","#fff58f","#50a7da","#00619b"],tags:["light","yellows","blues","diverging","esri-brand","colorblind-friendly"],name:"Esri Yellow and Blue 1"},"div-esribrand-yellow-violet":{1:["#e8d966"],2:["#dbc62c","#633b9b"],3:["#dbc62c","#fff58f","#633b9b"],4:["#beac2d","#e8d966","#987ac3","#4e2c7e"],5:["#beac2d","#e8d966","#fff58f","#987ac3","#4e2c7e"],6:["#beac2d","#e8d966","#f5e998","#bfa8cc","#987ac3","#4e2c7e"],7:["#beac2d","#e8d966","#f5e998","#fff58f","#bfa8cc","#987ac3","#4e2c7e"],8:["#beac2d","#dbc62c","#e8d966","#f5e998","#e6d5d5","#bfa8cc","#987ac3","#4e2c7e"],9:["#beac2d","#dbc62c","#e8d966","#f5e998","#fff58f","#e6d5d5","#bfa8cc","#987ac3","#4e2c7e"],10:["#beac2d","#dbc62c","#e8d966","#f5e998","#fff58f","#e6d5d5","#bfa8cc","#987ac3","#633b9b","#4e2c7e"],stops:["#beac2d","#e8d966","#fff58f","#987ac3","#4e2c7e"],tags:["light","yellows","purples","diverging","esri-brand","colorblind-friendly"],name:"Esri Yellow and Purple 1"},"div-esribrand-yellow-violetred":{1:["#e8d966"],2:["#dbc62c","#8e499b"],3:["#dbc62c","#fff58f","#8e499b"],4:["#beac2d","#e8d966","#b983c3","#73377e"],5:["#beac2d","#e8d966","#fff58f","#b983c3","#73377e"],6:["#beac2d","#e8d966","#f5e998","#d6adcc","#b983c3","#73377e"],7:["#beac2d","#e8d966","#f5e998","#fff58f","#d6adcc","#b983c3","#73377e"],8:["#beac2d","#dbc62c","#e8d966","#f5e998","#f2d7d5","#d6adcc","#b983c3","#73377e"],9:["#beac2d","#dbc62c","#e8d966","#f5e998","#fff58f","#f2d7d5","#d6adcc","#b983c3","#73377e"],10:["#beac2d","#dbc62c","#e8d966","#f5e998","#fff58f","#f2d7d5","#d6adcc","#b983c3","#8e499b","#73377e"],stops:["#beac2d","#e8d966","#fff58f","#b983c3","#73377e"],tags:["light","yellows","purples","diverging","esri-brand","colorblind-friendly"],name:"Esri Yellow and Purple 2"},"div-esribrand-yellow-brown":{1:["#e8d966"],2:["#dbc62c","#85551e"],3:["#dbc62c","#fff58f","#85551e"],4:["#beac2d","#e8d966","#ad8b62","#664015"],5:["#beac2d","#e8d966","#fff58f","#ad8b62","#664015"],6:["#beac2d","#e8d966","#f5e998","#cfb489","#ad8b62","#664015"],7:["#beac2d","#e8d966","#f5e998","#fff58f","#cfb489","#ad8b62","#664015"],8:["#beac2d","#dbc62c","#e8d966","#f5e998","#f0dcb0","#cfb489","#ad8b62","#664015"],9:["#beac2d","#dbc62c","#e8d966","#f5e998","#fff58f","#f0dcb0","#cfb489","#ad8b62","#664015"],10:["#beac2d","#dbc62c","#e8d966","#f5e998","#fff58f","#f0dcb0","#cfb489","#ad8b62","#85551e","#664015"],stops:["#beac2d","#e8d966","#fff58f","#ad8b62","#664015"],tags:["light","yellows","browns","diverging","esri-brand","colorblind-friendly"],name:"Esri Bananas"},"div-esribrand-yellow-gray":{1:["#e8d966"],2:["#dbc62c","#666666"],3:["#dbc62c","#fff58f","#666666"],4:["#beac2d","#e8d966","#999999","#404040"],5:["#beac2d","#e8d966","#fff58f","#999999","#404040"],6:["#beac2d","#e8d966","#f5e998","#bcbcbc","#999999","#404040"],7:["#beac2d","#e8d966","#f5e998","#fff58f","#bcbcbc","#999999","#404040"],8:["#beac2d","#dbc62c","#e8d966","#f5e998","#e6e0c4","#bcbcbc","#999999","#404040"],9:["#beac2d","#dbc62c","#e8d966","#f5e998","#fff58f","#e6e0c4","#bcbcbc","#999999","#404040"],10:["#beac2d","#dbc62c","#e8d966","#f5e998","#fff58f","#e6e0c4","#bcbcbc","#999999","#666666","#404040"],stops:["#beac2d","#e8d966","#fff58f","#999999","#404040"],tags:["light","yellows","grays","diverging","esri-brand","colorblind-friendly"],name:"Esri Yellow and Gray 1"},"div-esribrand-yellowgreen-greenblue":{1:["#c2e075"],2:["#aad048","#009b98"],3:["#aad048","#daf2de","#009b98"],4:["#84a338","#c2e075","#00bab5","#00807d"],5:["#84a338","#c2e075","#daf2de","#00bab5","#00807d"],6:["#84a338","#c2e075","#daebab","#56d6d4","#00bab5","#00807d"],7:["#84a338","#c2e075","#daebab","#daf2de","#56d6d4","#00bab5","#00807d"],8:["#84a338","#aad048","#c2e075","#daebab","#b8d9d5","#56d6d4","#00bab5","#00807d"],9:["#84a338","#aad048","#c2e075","#daebab","#daf2de","#b8d9d5","#56d6d4","#00bab5","#00807d"],10:["#84a338","#aad048","#c2e075","#daebab","#daf2de","#b8d9d5","#56d6d4","#00bab5","#009b98","#00807d"],stops:["#84a338","#c2e075","#daf2de","#00bab5","#00807d"],tags:["light","greens","blues","diverging","esri-brand","colorblind-friendly"],name:"Esri Green and Blue 1"},"div-esribrand-yellowgreen-blue":{1:["#c2e075"],2:["#aad048","#007ac2"],3:["#aad048","#daf2de","#007ac2"],4:["#84a338","#c2e075","#50a7da","#00619b"],5:["#84a338","#c2e075","#daf2de","#50a7da","#00619b"],6:["#84a338","#c2e075","#daebab","#8cc9ed","#50a7da","#00619b"],7:["#84a338","#c2e075","#daebab","#daf2de","#8cc9ed","#50a7da","#00619b"],8:["#84a338","#aad048","#c2e075","#daebab","#bce4ee","#8cc9ed","#50a7da","#00619b"],9:["#84a338","#aad048","#c2e075","#daebab","#daf2de","#bce4ee","#8cc9ed","#50a7da","#00619b"],10:["#84a338","#aad048","#c2e075","#daebab","#daf2de","#bce4ee","#8cc9ed","#50a7da","#007ac2","#00619b"],stops:["#84a338","#c2e075","#daf2de","#50a7da","#00619b"],tags:["light","greens","blues","diverging","esri-brand","colorblind-friendly"],name:"Esri Green and Blue 2"},"div-esribrand-yellowgreen-violet":{1:["#c2e075"],2:["#aad048","#633b9b"],3:["#aad048","#e6e8da","#633b9b"],4:["#84a338","#c2e075","#987ac3","#4e2c7e"],5:["#84a338","#c2e075","#e6e8da","#987ac3","#4e2c7e"],6:["#84a338","#c2e075","#daebab","#c0aae1","#987ac3","#4e2c7e"],7:["#84a338","#c2e075","#daebab","#e6e8da","#c0aae1","#987ac3","#4e2c7e"],8:["#84a338","#aad048","#c2e075","#daebab","#dad0e6","#c0aae1","#987ac3","#4e2c7e"],9:["#84a338","#aad048","#c2e075","#daebab","#e6e8da","#dad0e6","#c0aae1","#987ac3","#4e2c7e"],10:["#84a338","#aad048","#c2e075","#daebab","#e6e8da","#dad0e6","#c0aae1","#987ac3","#633b9b","#4e2c7e"],stops:["#84a338","#c2e075","#e6e8da","#987ac3","#4e2c7e"],tags:["light","greens","purples","diverging","esri-brand","colorblind-friendly"],name:"Esri Green and Purple 1"},"div-esribrand-yellowgreen-violetred":{1:["#c2e075"],2:["#aad048","#8e499b"],3:["#aad048","#ede9e2","#8e499b"],4:["#84a338","#c2e075","#b983c3","#73377e"],5:["#84a338","#c2e075","#ede9e2","#b983c3","#73377e"],6:["#84a338","#c2e075","#daebab","#daafe1","#b983c3","#73377e"],7:["#84a338","#c2e075","#daebab","#ede9e2","#daafe1","#b983c3","#73377e"],8:["#84a338","#aad048","#c2e075","#daebab","#e9d1e6","#daafe1","#b983c3","#73377e"],9:["#84a338","#aad048","#c2e075","#daebab","#ede9e2","#e9d1e6","#daafe1","#b983c3","#73377e"],10:["#84a338","#aad048","#c2e075","#daebab","#ede9e2","#e9d1e6","#daafe1","#b983c3","#8e499b","#73377e"],stops:["#84a338","#c2e075","#ede9e2","#b983c3","#73377e"],tags:["light","greens","purples","diverging","esri-brand","colorblind-friendly"],name:"Esri Green and Purple 2"},"div-esribrand-yellowgreen-brown":{1:["#c2e075"],2:["#aad048","#7b4f1c"],3:["#aad048","#f5f4cf","#7b4f1c"],4:["#84a338","#c2e075","#ad8b62","#664015"],5:["#84a338","#c2e075","#f5f4cf","#ad8b62","#664015"],6:["#84a338","#c2e075","#daebab","#d2b797","#ad8b62","#664015"],7:["#84a338","#c2e075","#daebab","#f5f4cf","#d2b797","#ad8b62","#664015"],8:["#84a338","#aad048","#c2e075","#daebab","#e6d8b6","#d2b797","#ad8b62","#664015"],9:["#84a338","#aad048","#c2e075","#daebab","#f5f4cf","#e6d8b6","#d2b797","#ad8b62","#664015"],10:["#84a338","#aad048","#c2e075","#daebab","#f5f4cf","#e6d8b6","#d2b797","#ad8b62","#7b4f1c","#664015"],stops:["#84a338","#c2e075","#f5f4cf","#ad8b62","#664015"],tags:["light","greens","browns","diverging","esri-brand","colorblind-friendly"],name:"Esri Green and Brown 1"},"div-esribrand-yellowgreen-gray":{1:["#c2e075"],2:["#aad048","#666666"],3:["#aad048","#ecf2dd","#666666"],4:["#84a338","#c2e075","#999999","#404040"],5:["#84a338","#c2e075","#ecf2dd","#999999","#404040"],6:["#84a338","#c2e075","#daebab","#bcbcbc","#999999","#404040"],7:["#84a338","#c2e075","#daebab","#ecf2dd","#bcbcbc","#999999","#404040"],8:["#84a338","#aad048","#c2e075","#daebab","#d7dacf","#bcbcbc","#999999","#404040"],9:["#84a338","#aad048","#c2e075","#daebab","#ecf2dd","#d7dacf","#bcbcbc","#999999","#404040"],10:["#84a338","#aad048","#c2e075","#daebab","#ecf2dd","#d7dacf","#bcbcbc","#999999","#666666","#404040"],stops:["#84a338","#c2e075","#ecf2dd","#999999","#404040"],tags:["light","greens","grays","diverging","esri-brand","colorblind-friendly"],name:"Esri Green and Gray 1"},"div-esribrand-green-blue":{1:["#6bc878"],2:["#35ac46","#007ac2"],3:["#35ac46","#d2f7ed","#007ac2"],4:["#288835","#6bc878","#50a7da","#00619b"],5:["#288835","#6bc878","#d2f7ed","#50a7da","#00619b"],6:["#288835","#6bc878","#b0e6b8","#7dc4e3","#50a7da","#00619b"],7:["#288835","#6bc878","#b0e6b8","#d2f7ed","#7dc4e3","#50a7da","#00619b"],8:["#288835","#35ac46","#6bc878","#b0e6b8","#abe2eb","#7dc4e3","#50a7da","#00619b"],9:["#288835","#35ac46","#6bc878","#b0e6b8","#d2f7ed","#abe2eb","#7dc4e3","#50a7da","#00619b"],10:["#288835","#35ac46","#6bc878","#b0e6b8","#d2f7ed","#abe2eb","#7dc4e3","#50a7da","#007ac2","#00619b"],stops:["#288835","#6bc878","#d2f7ed","#50a7da","#00619b"],tags:["light","greens","blues","diverging","esri-brand","colorblind-friendly"],name:"Esri Green and Blue 3"},"div-esribrand-green-violet":{1:["#6bc878"],2:["#35ac46","#633b9b"],3:["#35ac46","#dfebe9","#633b9b"],4:["#288835","#6bc878","#987ac3","#4e2c7e"],5:["#288835","#6bc878","#dfebe9","#987ac3","#4e2c7e"],6:["#288835","#6bc878","#b0e6b8","#b2a2d2","#987ac3","#4e2c7e"],7:["#288835","#6bc878","#b0e6b8","#dfebe9","#b2a2d2","#987ac3","#4e2c7e"],8:["#288835","#35ac46","#6bc878","#b0e6b8","#cccae1","#b2a2d2","#987ac3","#4e2c7e"],9:["#288835","#35ac46","#6bc878","#b0e6b8","#dfebe9","#cccae1","#b2a2d2","#987ac3","#4e2c7e"],10:["#288835","#35ac46","#6bc878","#b0e6b8","#dfebe9","#cccae1","#b2a2d2","#987ac3","#633b9b","#4e2c7e"],stops:["#288835","#6bc878","#dfebe9","#987ac3","#4e2c7e"],tags:["light","greens","purples","diverging","esri-brand","colorblind-friendly"],name:"Esri Green and Purple 3"},"div-esribrand-green-violetred":{1:["#6bc878"],2:["#35ac46","#8e499b"],3:["#35ac46","#e2ebe7","#8e499b"],4:["#288835","#6bc878","#b983c3","#73377e"],5:["#288835","#6bc878","#e2ebe7","#b983c3","#73377e"],6:["#288835","#6bc878","#b0e6b8","#c9a8d1","#b983c3","#73377e"],7:["#288835","#6bc878","#b0e6b8","#e2ebe7","#c9a8d1","#b983c3","#73377e"],8:["#288835","#35ac46","#6bc878","#b0e6b8","#d9cde0","#c9a8d1","#b983c3","#73377e"],9:["#288835","#35ac46","#6bc878","#b0e6b8","#e2ebe7","#d9cde0","#c9a8d1","#b983c3","#73377e"],10:["#288835","#35ac46","#6bc878","#b0e6b8","#e2ebe7","#d9cde0","#c9a8d1","#b983c3","#8e499b","#73377e"],stops:["#288835","#6bc878","#e2ebe7","#b983c3","#73377e"],tags:["light","greens","purples","diverging","esri-brand","colorblind-friendly"],name:"Esri Green and Purple 4"},"div-esribrand-green-gray":{1:["#6bc878"],2:["#35ac46","#666666"],3:["#35ac46","#daeddd","#666666"],4:["#288835","#6bc878","#999999","#404040"],5:["#288835","#6bc878","#daeddd","#999999","#404040"],6:["#288835","#6bc878","#b0e6b8","#b1b8b2","#999999","#404040"],7:["#288835","#6bc878","#b0e6b8","#daeddd","#b1b8b2","#999999","#404040"],8:["#288835","#35ac46","#6bc878","#b0e6b8","#c9d6cb","#b1b8b2","#999999","#404040"],9:["#288835","#35ac46","#6bc878","#b0e6b8","#daeddd","#c9d6cb","#b1b8b2","#999999","#404040"],10:["#288835","#35ac46","#6bc878","#b0e6b8","#daeddd","#c9d6cb","#b1b8b2","#999999","#666666","#404040"],stops:["#288835","#6bc878","#daeddd","#999999","#404040"],tags:["light","greens","grays","diverging","esri-brand","colorblind-friendly"],name:"Esri Green and Gray 2"},"div-esribrand-greenblue-blue":{1:["#00bab5"],2:["#009b98","#007ac2"],3:["#009b98","#d2f7ed","#007ac2"],4:["#00807d","#00bab5","#50a7da","#00619b"],5:["#00807d","#00bab5","#d2f7ed","#50a7da","#00619b"],6:["#00807d","#00bab5","#5ae0de","#8cc9ed","#50a7da","#00619b"],7:["#00807d","#00bab5","#5ae0de","#d2f7ed","#8cc9ed","#50a7da","#00619b"],8:["#00807d","#009b98","#00bab5","#5ae0de","#bce4ee","#8cc9ed","#50a7da","#00619b"],9:["#00807d","#009b98","#00bab5","#5ae0de","#d2f7ed","#bce4ee","#8cc9ed","#50a7da","#00619b"],10:["#00807d","#009b98","#00bab5","#5ae0de","#d2f7ed","#bce4ee","#8cc9ed","#50a7da","#007ac2","#00619b"],stops:["#00807d","#00bab5","#d2f7ed","#50a7da","#00619b"],tags:["light","greens","blues","diverging","esri-brand"],name:"Esri Green and Blue 4"},"div-esribrand-greenblue-violetred":{1:["#00bab5"],2:["#009b98","#8e499b"],3:["#009b98","#d2f7ed","#8e499b"],4:["#00807d","#00bab5","#b983c3","#73377e"],5:["#00807d","#00bab5","#d2f7ed","#b983c3","#73377e"],6:["#00807d","#00bab5","#5ae0de","#daafe1","#b983c3","#73377e"],7:["#00807d","#00bab5","#5ae0de","#d2f7ed","#daafe1","#b983c3","#73377e"],8:["#00807d","#009b98","#00bab5","#5ae0de","#e9d1e6","#daafe1","#b983c3","#73377e"],9:["#00807d","#009b98","#00bab5","#5ae0de","#d2f7ed","#e9d1e6","#daafe1","#b983c3","#73377e"],10:["#00807d","#009b98","#00bab5","#5ae0de","#d2f7ed","#e9d1e6","#daafe1","#b983c3","#8e499b","#73377e"],stops:["#00807d","#00bab5","#d2f7ed","#b983c3","#73377e"],tags:["light","greens","purples","diverging","esri-brand","colorblind-friendly"],name:"Esri Green and Purple 5"},"div-esribrand-greenblue-brown":{1:["#00bab5"],2:["#009b98","#7b4f1c"],3:["#009b98","#d2f7ed","#7b4f1c"],4:["#00807d","#00bab5","#ad8b62","#664015"],5:["#00807d","#00bab5","#d2f7ed","#ad8b62","#664015"],6:["#00807d","#00bab5","#5ae0de","#d2b797","#ad8b62","#664015"],7:["#00807d","#00bab5","#5ae0de","#d2f7ed","#d2b797","#ad8b62","#664015"],8:["#00807d","#009b98","#00bab5","#5ae0de","#e6d8b6","#d2b797","#ad8b62","#664015"],9:["#00807d","#009b98","#00bab5","#5ae0de","#d2f7ed","#e6d8b6","#d2b797","#ad8b62","#664015"],10:["#00807d","#009b98","#00bab5","#5ae0de","#d2f7ed","#e6d8b6","#d2b797","#ad8b62","#7b4f1c","#664015"],stops:["#00807d","#00bab5","#d2f7ed","#ad8b62","#664015"],tags:["light","greens","browns","diverging","esri-brand","colorblind-friendly"],name:"Esri Green and Brown 2"},"div-esribrand-greenblue-gray":{1:["#00bab5"],2:["#009b98","#666666"],3:["#009b98","#d2f7ed","#666666"],4:["#00807d","#00bab5","#999999","#404040"],5:["#00807d","#00bab5","#d2f7ed","#999999","#404040"],6:["#00807d","#00bab5","#5ae0de","#bcbcbc","#999999","#404040"],7:["#00807d","#00bab5","#5ae0de","#d2f7ed","#bcbcbc","#999999","#404040"],8:["#00807d","#009b98","#00bab5","#5ae0de","#d7dacf","#bcbcbc","#999999","#404040"],9:["#00807d","#009b98","#00bab5","#5ae0de","#d2f7ed","#d7dacf","#bcbcbc","#999999","#404040"],10:["#00807d","#009b98","#00bab5","#5ae0de","#d2f7ed","#d7dacf","#bcbcbc","#999999","#666666","#404040"],stops:["#00807d","#00bab5","#d2f7ed","#999999","#404040"],tags:["light","greens","grays","diverging","esri-brand","colorblind-friendly"],name:"Esri Green and Gray 3"},"div-esribrand-blue-brown":{1:["#50a7da"],2:["#007ac2","#7b4f1c"],3:["#007ac2","#d3e6e3","#7b4f1c"],4:["#00619b","#50a7da","#ad8b62","#664015"],5:["#00619b","#50a7da","#d3e6e3","#ad8b62","#664015"],6:["#00619b","#50a7da","#9bcde5","#c0ad91","#ad8b62","#664015"],7:["#00619b","#50a7da","#9bcde5","#d3e6e3","#c0ad91","#ad8b62","#664015"],8:["#00619b","#007ac2","#50a7da","#9bcde5","#d3d0c1","#c0ad91","#ad8b62","#664015"],9:["#00619b","#007ac2","#50a7da","#9bcde5","#d3e6e3","#d3d0c1","#c0ad91","#ad8b62","#664015"],10:["#00619b","#007ac2","#50a7da","#9bcde5","#d3e6e3","#d3d0c1","#c0ad91","#ad8b62","#7b4f1c","#664015"],stops:["#00619b","#50a7da","#d3e6e3","#ad8b62","#664015"],tags:["light","blues","browns","diverging","esri-brand","colorblind-friendly"],name:"Esri Blue and Brown 1"},"div-esribrand-blue-gray":{1:["#50a7da"],2:["#007ac2","#666666"],3:["#007ac2","#d7e3eb","#666666"],4:["#00619b","#50a7da","#999999","#404040"],5:["#00619b","#50a7da","#d7e3eb","#999999","#404040"],6:["#00619b","#50a7da","#9bcde5","#b0b4b7","#999999","#404040"],7:["#00619b","#50a7da","#9bcde5","#d7e3eb","#b0b4b7","#999999","#404040"],8:["#00619b","#007ac2","#50a7da","#9bcde5","#c8d0d4","#b0b4b7","#999999","#404040"],9:["#00619b","#007ac2","#50a7da","#9bcde5","#d7e3eb","#c8d0d4","#b0b4b7","#999999","#404040"],10:["#00619b","#007ac2","#50a7da","#9bcde5","#d7e3eb","#c8d0d4","#b0b4b7","#999999","#666666","#404040"],stops:["#00619b","#50a7da","#d7e3eb","#999999","#404040"],tags:["light","blues","grays","diverging","esri-brand","colorblind-friendly"],name:"Esri Blue and Gray 1"},"div-esribrand-violet-brown":{1:["#987ac3"],2:["#6940a1","#7b4f1c"],3:["#6940a1","#faeff4","#7b4f1c"],4:["#4e2c7e","#987ac3","#ad8b62","#664015"],5:["#4e2c7e","#987ac3","#faeff4","#ad8b62","#664015"],6:["#4e2c7e","#987ac3","#decef7","#c7ac93","#ad8b62","#664015"],7:["#4e2c7e","#987ac3","#decef7","#faeff4","#c7ac93","#ad8b62","#664015"],8:["#4e2c7e","#6940a1","#987ac3","#decef7","#e0cec3","#c7ac93","#ad8b62","#664015"],9:["#4e2c7e","#6940a1","#987ac3","#decef7","#faeff4","#e0cec3","#c7ac93","#ad8b62","#664015"],10:["#4e2c7e","#6940a1","#987ac3","#decef7","#faeff4","#e0cec3","#c7ac93","#ad8b62","#7b4f1c","#664015"],stops:["#4e2c7e","#987ac3","#faeff4","#ad8b62","#664015"],tags:["light","purples","browns","diverging","esri-brand","colorblind-friendly"],name:"Esri Purple and Brown 1"},"esribrand-violet-gray":{1:["#987ac3"],2:["#6940a1","#666666"],3:["#6940a1","#f4effa","#666666"],4:["#4e2c7e","#987ac3","#999999","#404040"],5:["#4e2c7e","#987ac3","#f4effa","#999999","#404040"],6:["#4e2c7e","#987ac3","#decef7","#b7b6b9","#999999","#404040"],7:["#4e2c7e","#987ac3","#decef7","#f4effa","#b7b6b9","#999999","#404040"],8:["#4e2c7e","#6940a1","#987ac3","#decef7","#d6d2da","#b7b6b9","#999999","#404040"],9:["#4e2c7e","#6940a1","#987ac3","#decef7","#f4effa","#d6d2da","#b7b6b9","#999999","#404040"],10:["#4e2c7e","#6940a1","#987ac3","#decef7","#f4effa","#d6d2da","#b7b6b9","#999999","#666666","#404040"],stops:["#4e2c7e","#987ac3","#f4effa","#999999","#404040"],tags:["light","purples","grays","diverging","esri-brand","colorblind-friendly"],name:"Esri Purple and Gray 1"},"div-esribrand-violetred-gray":{1:["#b983c3"],2:["#8e499b","#666666"],3:["#8e499b","#eee1f0","#666666"],4:["#73377e","#b983c3","#999999","#404040"],5:["#73377e","#b983c3","#eee1f0","#999999","#404040"],6:["#73377e","#b983c3","#ebc8f0","#b0b4b7","#999999","#404040"],7:["#73377e","#b983c3","#ebc8f0","#eee1f0","#b0b4b7","#999999","#404040"],8:["#73377e","#8e499b","#b983c3","#ebc8f0","#d5cfd6","#b0b4b7","#999999","#404040"],9:["#73377e","#8e499b","#b983c3","#ebc8f0","#eee1f0","#d5cfd6","#b0b4b7","#999999","#404040"],10:["#73377e","#8e499b","#b983c3","#ebc8f0","#eee1f0","#d5cfd6","#b0b4b7","#999999","#666666","#404040"],stops:["#73377e","#b983c3","#eee1f0","#999999","#404040"],tags:["light","purples","grays","diverging","esri-brand","colorblind-friendly"],name:"Esri Purple and Gray 2"},"div-esribrand-brown-gray":{1:["#ad8b62"],2:["#7b4f1c","#666666"],3:["#7b4f1c","#f0e9df","#666666"],4:["#664015","#ad8b62","#999999","#404040"],5:["#664015","#ad8b62","#f0e9df","#999999","#404040"],6:["#664015","#ad8b62","#ebd5b7","#b0b4b7","#999999","#404040"],7:["#664015","#ad8b62","#ebd5b7","#f0e9df","#b0b4b7","#999999","#404040"],8:["#664015","#7b4f1c","#ad8b62","#ebd5b7","#d6d3ce","#b0b4b7","#999999","#404040"],9:["#664015","#7b4f1c","#ad8b62","#ebd5b7","#f0e9df","#d6d3ce","#b0b4b7","#999999","#404040"],10:["#664015","#7b4f1c","#ad8b62","#ebd5b7","#f0e9df","#d6d3ce","#b0b4b7","#999999","#666666","#404040"],stops:["#664015","#ad8b62","#f0e9df","#999999","#404040"],tags:["light","browns","grays","diverging","esri-brand","colorblind-friendly"],name:"Esri Brown and Gray 1"},"highlight-orange":{3:["rgba(165,50,23,0.40)","rgba(165,50,23,1.0)","rgba(165,50,23,0.40)"],5:["rgba(165,50,23,0.20)","rgba(165,50,23,0.60)","rgba(165,50,23,1.0)","rgba(165,50,23,0.60)","rgba(165,50,23,0.20)"],7:["rgba(165,50,23,0.10)","rgba(165,50,23,0.40)","rgba(165,50,23,0.70)","rgba(165,50,23,1.0)","rgba(165,50,23,0.70)","rgba(165,50,23,0.40)","rgba(165,50,23,0.10)"],9:["rgba(165,50,23,0.10)","rgba(165,50,23,0.33)","rgba(165,50,23,0.55)","rgba(165,50,23,0.78)","rgba(165,50,23,1.0)","rgba(165,50,23,0.78)","rgba(165,50,23,0.55)","rgba(165,50,23,0.33)","rgba(165,50,23,0.10)"],stops:["rgba(165,50,23,0)","rgba(165,50,23,0.5)","rgba(165,50,23,1.0)","rgba(165,50,23,0.5)","rgba(165,50,23,0)"],tags:["reds","centered-on","colorblind-friendly"],name:"Centered on Red 1"},"highlight-bluegreen":{3:["rgba(0,66,56,0.40)","rgba(0,66,56,1.0)","rgba(0,66,56,0.40)"],5:["rgba(0,66,56,0.20)","rgba(0,66,56,0.60)","rgba(0,66,56,1.0)","rgba(0,66,56,0.60)","rgba(0,66,56,0.20)"],7:["rgba(0,66,56,0.10)","rgba(10,66,56,0.40)","rgba(0,66,56,0.70)","rgba(0,66,56,1.0)","rgba(0,66,56,0.70)","rgba(0,66,56,0.40)","rgba(0,66,56,0.10)"],9:["rgba(0,66,56,0.10)","rgba(0,66,56,0.33)","rgba(0,66,56,0.55)","rgba(0,66,56,0.78)","rgba(0,66,56,1.0)","rgba(0,66,56,0.78)","rgba(0,66,56,0.55)","rgba(0,66,56,0.33)","rgba(0,66,56,0.10)"],stops:["rgba(0,66,56,0)","rgba(0,66,56,0.5)","rgba(0,66,56,1.0)","rgba(0,66,56,0.5)","rgba(0,66,56,0)"],tags:["greens","centered-on","colorblind-friendly"],name:"Centered on Green 1"},"highlight-red":{3:["rgba(153,11,11,0.40)","rgba(153,11,11,1.0)","rgba(153,11,11,0.40)"],5:["rgba(153,11,11,0.20)","rgba(153,11,11,0.60)","rgba(153,11,11,1.0)","rgba(153,11,11,0.60)","rgba(153,11,11,0.20)"],7:["rgba(153,11,11,0.10)","rgba(153,11,11,0.40)","rgba(153,11,11,0.70)","rgba(153,11,11,1.0)","rgba(153,11,11,0.70)","rgba(153,11,11,0.40)","rgba(153,11,11,0.10)"],9:["rgba(153,11,11,0.10)","rgba(153,11,11,0.33)","rgba(153,11,11,0.55)","rgba(153,11,11,0.78)","rgba(153,11,11,1.0)","rgba(153,11,11,0.78)","rgba(153,11,11,0.55)","rgba(153,11,11,0.33)","rgba(153,11,11,0.10)"],stops:["rgba(153,11,11,0)","rgba(153,11,11,0.5)","rgba(153,11,11,1.0)","rgba(153,11,11,0.5)","rgba(153,11,11,0)"],tags:["reds","centered-on","bright","dark","colorblind-friendly"],name:"Centered on Red 2"},"highlight-orange-dark":{3:["rgba(107,38,0,0.40)","rgba(107,38,0,1.0)","rgba(107,38,0,0.40)"],5:["rgba(107,38,0,0.20)","rgba(107,38,0,0.60)","rgba(107,38,0,1.0)","rgba(107,38,0,0.60)","rgba(107,38,0,0.20)"],7:["rgba(107,38,0,0.10)","rgba(107,38,0,0.40)","rgba(107,38,0,0.70)","rgba(107,38,0,1.0)","rgba(107,38,0,0.70)","rgba(107,38,0,0.40)","rgba(107,38,0,0.10)"],9:["rgba(107,38,0,0.10)","rgba(107,38,0,0.33)","rgba(107,38,0,0.55)","rgba(107,38,0,0.78)","rgba(107,38,0,1.0)","rgba(107,38,0,0.78)","rgba(107,38,0,0.55)","rgba(107,38,0,0.33)","rgba(107,38,0,0.10)"],stops:["rgba(107,38,0,0)","rgba(107,38,0,0.5)","rgba(107,38,0,1.0)","rgba(107,38,0,0.5)","rgba(107,38,0,0)"],tags:["browns","centered-on","colorblind-friendly"],name:"Centered on Red 3"},"highlight-orange-bright":{3:["rgba(255,179,57,0.40)","rgba(255,179,57,1.0)","rgba(255,179,57,0.40)"],5:["rgba(255,179,57,0.20)","rgba(255,179,57,0.60)","rgba(255,179,57,1.0)","rgba(255,179,57,0.60)","rgba(255,179,57,0.20)"],7:["rgba(255,179,57,0.10)","rgba(255,179,57,0.40)","rgba(255,179,57,0.70)","rgba(255,179,57,1.0)","rgba(255,179,57,0.70)","rgba(255,179,57,0.40)","rgba(255,179,57,0.10)"],9:["rgba(255,179,57,0.10)","rgba(255,179,57,0.33)","rgba(255,179,57,0.55)","rgba(255,179,57,0.78)","rgba(255,179,57,1.0)","rgba(255,179,57,0.78)","rgba(255,179,57,0.55)","rgba(255,179,57,0.33)","rgba(255,179,57,0.10)"],stops:["rgba(255,179,57,0)","rgba(255,179,57,0.5)","rgba(255,179,57,1.0)","rgba(255,179,57,0.5)","rgba(255,179,57,0)"],tags:["yellows","centered-on","bright","dark","colorblind-friendly"],name:"Centered on Yellow 1"},"highlight-purple":{3:["rgba(65,27,109,0.40)","rgba(65,27,109,1.0)","rgba(65,27,109,0.40)"],5:["rgba(65,27,109,0.20)","rgba(65,27,109,0.60)","rgba(65,27,109,1.0)","rgba(65,27,109,0.60)","rgba(65,27,109,0.20)"],7:["rgba(65,27,109,0.10)","rgba(65,27,109,0.40)","rgba(65,27,109,0.70)","rgba(65,27,109,1.0)","rgba(65,27,109,0.70)","rgba(65,27,109,0.40)","rgba(65,27,109,0.10)"],9:["rgba(65,27,109,0.10)","rgba(65,27,109,0.33)","rgba(65,27,109,0.55)","rgba(65,27,109,0.78)","rgba(65,27,109,1.0)","rgba(65,27,109,0.78)","rgba(65,27,109,0.55)","rgba(65,27,109,0.33)","rgba(65,27,109,0.10)"],stops:["rgba(65,27,109,0)","rgba(65,27,109,0.5)","rgba(65,27,109,1.0)","rgba(65,27,109,0.5)","rgba(65,27,109,0)"],tags:["purples","centered-on","colorblind-friendly"],name:"Centered on Purple 1"},"highlight-pink":{3:["rgba(87,9,89,0.40)","rgba(87,9,89,1.0)","rgba(87,9,89,0.40)"],5:["rgba(87,9,89,0.20)","rgba(87,9,89,0.60)","rgba(87,9,89,1.0)","rgba(87,9,89,0.60)","rgba(87,9,89,0.20)"],7:["rgba(87,9,89,0.10)","rgba(87,9,89,0.40)","rgba(87,9,89,0.70)","rgba(87,9,89,1.0)","rgba(87,9,89,0.70)","rgba(87,9,89,0.40)","rgba(87,9,89,0.10)"],9:["rgba(87,9,89,0.10)","rgba(87,9,89,0.33)","rgba(87,9,89,0.55)","rgba(87,9,89,0.78)","rgba(87,9,89,1.0)","rgba(87,9,89,0.78)","rgba(87,9,89,0.55)","rgba(87,9,89,0.33)","rgba(87,9,89,0.10)"],stops:["rgba(87,9,89,0)","rgba(87,9,89,0.5)","rgba(87,9,89,1.0)","rgba(87,9,89,0.5)","rgba(87,9,89,0)"],tags:["purples","centered-on","colorblind-friendly"],name:"Centered on Purple 2"},"highlight-blue":{3:["rgba(16,48,94,0.40)","rgba(16,48,94,1.0)","rgba(16,48,94,0.40)"],5:["rgba(16,48,94,0.20)","rgba(16,48,94,0.60)","rgba(16,48,94,1.0)","rgba(16,48,94,0.60)","rgba(16,48,94,0.20)"],7:["rgba(16,48,94,0.10)","rgba(16,48,94,0.40)","rgba(16,48,94,0.70)","rgba(16,48,94,1.0)","rgba(16,48,94,0.70)","rgba(16,48,94,0.40)","rgba(16,48,94,0.10)"],9:["rgba(16,48,94,0.10)","rgba(16,48,94,0.33)","rgba(16,48,94,0.55)","rgba(16,48,94,0.78)","rgba(16,48,94,1.0)","rgba(16,48,94,0.78)","rgba(16,48,94,0.55)","rgba(16,48,94,0.33)","rgba(16,48,94,0.10)"],stops:["rgba(16,48,94,0)","rgba(16,48,94,0.5)","rgba(16,48,94,1.0)","rgba(16,48,94,0.5)","rgba(16,48,94,0)"],tags:["blues","centered-on","colorblind-friendly"],name:"Centered on Blue 1"},"highlight-blue-dark":{3:["rgba(0,38,73,0.40)","rgba(0,38,73,1.0)","rgba(0,38,73,0.40)"],5:["rgba(0,38,73,0.20)","rgba(0,38,73,0.60)","rgba(0,38,73,1.0)","rgba(0,38,73,0.60)","rgba(0,38,73,0.20)"],7:["rgba(0,38,73,0.10)","rgba(10,38,73,0.40)","rgba(0,38,73,0.70)","rgba(0,38,73,1.0)","rgba(0,38,73,0.70)","rgba(0,38,73,0.40)","rgba(0,38,73,0.10)"],9:["rgba(0,38,73,0.10)","rgba(0,38,73,0.33)","rgba(0,38,73,0.55)","rgba(0,38,73,0.78)","rgba(0,38,73,1.0)","rgba(0,38,73,0.78)","rgba(0,38,73,0.55)","rgba(0,38,73,0.33)","rgba(0,38,73,0.10)"],stops:["rgba(0,38,73,0)","rgba(0,38,73,0.5)","rgba(0,38,73,1.0)","rgba(0,38,73,0.5)","rgba(0,38,73,0)"],tags:["blues","centered-on","colorblind-friendly"],name:"Centered on Blue 2"},"highlight-blue-bright":{3:["rgba(117,239,221,0.40)","rgba(117,239,221,1.0)","rgba(117,239,221,0.40)"],5:["rgba(117,239,221,0.20)","rgba(117,239,221,0.60)","rgba(117,239,221,1.0)","rgba(117,239,221,0.60)","rgba(117,239,221,0.20)"],7:["rgba(117,239,221,0.10)","rgba(117,239,221,0.40)","rgba(117,239,221,0.70)","rgba(117,239,221,1.0)","rgba(117,239,221,0.70)","rgba(117,239,221,0.40)","rgba(117,239,221,0.10)"],9:["rgba(117,239,221,0.10)","rgba(117,239,221,0.33)","rgba(117,239,221,0.55)","rgba(117,239,221,0.78)","rgba(117,239,221,1.0)","rgba(117,239,221,0.78)","rgba(117,239,221,0.55)","rgba(117,239,221,0.33)","rgba(117,239,221,0.10)"],stops:["rgba(117,239,221,0)","rgba(117,239,221,0.5)","rgba(117,239,221,1.0)","rgba(117,239,221,0.5)","rgba(117,239,221,0)"],tags:["blues","centered-on","dark","bright","colorblind-friendly"],name:"Centered on Blue 3"},"highlight-orange-gray":{3:["#bf9990","#a53217","#bf9990"],5:["#cccccc","#b97f72","#a53217","#b97f72","#cccccc"],7:["#cccccc","#bf9990","#b26553","#a53217","#b26553","#bf9990","#cccccc"],9:["#cccccc","#c2a69f","#b97f72","#af5944","#a53217","#af5944","#b97f72","#c2a69f","#cccccc"],stops:["#cccccc","#b97f72","#a53217","#b97f72","#cccccc"],tags:["reds","centered-on","light","subdued","colorblind-friendly"],name:"Centered on Red 4"},"highlight-bluegreen-gray":{3:["#889e9b","#004238","#889e9b"],5:["#cccccc","#668782","#004238","#668782","#cccccc"],7:["#cccccc","#889e9b","#447069","#004238","#447069","#889e9b","#cccccc"],9:["#cccccc","#99aaa7","#668782","#33655d","#004238","#33655d","#668782","#99aaa7","#cccccc"],stops:["#cccccc","#668782","#004238","#668782","#cccccc"],tags:["greens","centered-on","light","subdued","colorblind-friendly"],name:"Centered on Green 2"},"highlight-red-gray":{3:["#bb8c8c","#990b0b","#bb8c8c"],5:["#cccccc","#b36c6c","#990b0b","#b36c6c","#cccccc"],7:["#cccccc","#bb8c8c","#aa4b4b","#990b0b","#aa4b4b","#bb8c8c","#cccccc"],9:["#cccccc","#bf9c9c","#b36c6c","#a63b3b","#990b0b","#a63b3b","#b36c6c","#bf9c9c","#cccccc"],stops:["#cccccc","#b36c6c","#990b0b","#b36c6c","#cccccc"],tags:["reds","centered-on","light","subdued","colorblind-friendly"],name:"Centered on Red 5"},"highlight-orange-gray-dark":{3:["#ac9588","#6b2600","#ac9588"],5:["#cccccc","#9c7966","#6b2600","#9c7966","#cccccc"],7:["#cccccc","#ac9588","#8b5d44","#6b2600","#8b5d44","#ac9588","#cccccc"],9:["#cccccc","#b4a399","#9c7966","#835033","#6b2600","#835033","#9c7966","#b4a399","#cccccc"],stops:["#cccccc","#9c7966","#6b2600","#9c7966","#cccccc"],tags:["browns","centered-on","light","subdued","colorblind-friendly"],name:"Centered on Red 6"},"highlight-orange-gray-bright":{3:["#775e35","#ffb339","#775e35"],5:["#333333","#997336","#ffb339","#997336","#333333"],7:["#333333","#775e35","#bb8837","#ffb339","#bb8837","#775e35","#333333"],9:["#333333","#665335","#997336","#cc9338","#ffb339","#cc9338","#997336","#665335","#333333"],stops:["#333333","#997336","#ffb339","#997336","#333333"],tags:["yellows","centered-on","bright","dark","colorblind-friendly"],name:"Centered on Yellow 2"},"highlight-purple-gray":{3:["#9e91ac","#411b6d","#9e91ac"],5:["#cccccc","#87749d","#411b6d","#87749d","#cccccc"],7:["#cccccc","#9e91ac","#6f568d","#411b6d","#6f568d","#9e91ac","#cccccc"],9:["#cccccc","#a9a0b4","#87749d","#644785","#411b6d","#644785","#87749d","#a9a0b4","#cccccc"],stops:["#cccccc","#87749d","#411b6d","#87749d","#cccccc"],tags:["purples","centered-on","light","colorblind-friendly"],name:"Centered on Purple 3"},"highlight-pink-gray":{3:["#a58ba6","#570959","#a58ba6"],5:["#cccccc","#926b93","#570959","#926b93","#cccccc"],7:["#cccccc","#a58ba6","#7e4a7f","#570959","#7e4a7f","#a58ba6","#cccccc"],9:["#cccccc","#af9baf","#926b93","#743a76","#570959","#743a76","#926b93","#af9baf","#cccccc"],stops:["#cccccc","#926b93","#570959","#926b93","#cccccc"],tags:["purples","centered-on","light","colorblind-friendly"],name:"Centered on Purple 4"},"highlight-blue-gray":{3:["#8d98a7","#10305e","#8d98a7"],5:["#cccccc","#6e7e95","#10305e","#6e7e95","#cccccc"],7:["#cccccc","#8d98a7","#4f6483","#10305e","#4f6483","#8d98a7","#cccccc"],9:["#cccccc","#9da5b1","#6e7e95","#3f577a","#10305e","#3f577a","#6e7e95","#9da5b1","#cccccc"],stops:["#cccccc","#6e7e95","#10305e","#6e7e95","#cccccc"],tags:["blues","centered-on","light","colorblind-friendly"],name:"Centered on Blue 4"},"highlight-blue-gray-dark":{3:["#8895a0","#002649","#8895a0"],5:["#cccccc","#66798b","#002649","#66798b","#cccccc"],7:["#cccccc","#8895a0","#445d75","#002649","#445d75","#8895a0","#cccccc"],9:["#cccccc","#99a3ab","#66798b","#33506a","#002649","#33506a","#66798b","#99a3ab","#cccccc"],stops:["#cccccc","#66798b","#002649","#66798b","#cccccc"],tags:["blues","centered-on","light","colorblind-friendly"],name:"Centered on Blue 5"},"highlight-blue-gray-bright":{3:["#49726c","#75efdd","#49726c"],5:["#333333","#549188","#75efdd","#549188","#333333"],7:["#333333","#49726c","#5fb0a4","#75efdd","#5fb0a4","#49726c","#333333"],9:["#333333","#44625e","#549188","#65c0b3","#75efdd","#65c0b3","#549188","#44625e","#333333"],stops:["#333333","#549188","#75efdd","#549188","#333333"],tags:["blues","greens","centered-on","dark","bright","colorblind-friendly"],name:"Centered on Green 3"},"highlight-red-gray-bright":{stops:["#4d414d","#a63a55","#ff4141","#a63a55","#4d414d"],tags:["reds","centered-on","dark","bright","colorblind-friendly"],name:"Centered on Red 7"},"highlight-purple-gray-bright":{stops:["#4c374d","#7e3ca6","#b44dff","#7e3ca6","#4c374d"],tags:["purples","centered-on","dark","bright","colorblind-friendly"],name:"Centered on Purple 5"},"highlight-blue-bright-gray-bright":{stops:["#383855","#2c6f9e","#40bfff","#2c6f9e","#383855"],tags:["blues","centered-on","dark","bright","colorblind-friendly"],name:"Centered on Blue 6"},"highlight-green-gray-bright":{stops:["#2f4147","#18a064","#00ff78","#18a064","#2f4147"],tags:["greens","centered-on","dark","bright","colorblind-friendly"],name:"Centered on Green 4"},"highlight-yellow-gray-bright":{stops:["#41472e","#878c34","#f9ff5a","#878c34","#41472e"],tags:["yellows","centered-on","dark","bright","colorblind-friendly"],name:"Centered on Yellow 3"},"highlight-pink-gray-dark":{stops:["#bbb8cc","#995c99","#a6004e","#995c99","#bbb8cc"],tags:["purples","pinks","centered-on","light","colorblind-friendly"],name:"Centered on Pink 1"},"highlight-purple-gray-dark":{stops:["#bdb8d9","#835fa6","#7f0099","#835fa6","#bdb8d9"],tags:["purples","centered-on","light","colorblind-friendly"],name:"Centered on Purple 6"},"highlight-blue-bright-gray-dark":{stops:["#c2cff2","#6187f2","#003df2","#6187f2","#c2cff2"],tags:["blues","centered-on","light","colorblind-friendly"],name:"Centered on Blue 7"},"highlight-green-gray-dark":{stops:["#b8d5d9","#4d9a94","#00735f","#4d9a94","#b8d5d9"],tags:["greens","centered-on","light","colorblind-friendly"],name:"Centered on Green 5"},"highlight-brown-gray-dark":{stops:["#ccbdad","#b38657","#994e00","#b38657","#ccbdad"],tags:["browns","centered-on","light","colorblind-friendly"],name:"Centered on Brown 1"},"extremesdiv-bluegreen-yellow-orange":{stops:["rgba(0,66,56,1)","rgba(0,66,56,0.5)","rgba(255,255,255,0)","rgba(165,50,23,0.5)","rgba(165,50,23,1)"],tags:["reds","greens","extremes","light","colorblind-friendly"],name:"Red and Green Extremes 1"},"extremesdiv-orange-yellow-blue-light":{stops:["rgba(165,50,23,1)","rgba(165,50,23,0.5)","rgba(255,255,255,0)","rgba(16,48,94,0.5)","rgba(16,48,94,1)"],tags:["reds","blues","extremes","light","colorblind-friendly"],name:"Blue and Red Extremes 1"},"extremesdiv-green-yellow-redpurple":{stops:["rgba(56,73,3,1)","rgba(56,73,3,0.5)","rgba(255,255,255,0)","rgba(102,0,22,0.5)","rgba(102,0,22,1)"],tags:["reds","greens","extremes","light"],name:"Red and Green Extremes 2"},"extremesdiv-green-yellow-orange":{stops:["rgba(56,73,3,1)","rgba(56,73,3,0.5)","rgba(255,255,255,0)","rgba(165,50,23,0.5)","rgba(165,50,23,1)"],tags:["reds","greens","extremes","light"],name:"Red and Green Extremes 3"},"extremesdiv-orange-purple":{stops:["rgba(165,50,23,1)","rgba(165,50,23,0.5)","rgba(255,255,255,0)","rgba(65,27,109,0.5)","rgba(65,27,109,1)"],tags:["reds","purples","extremes","dark","colorblind-friendly"],name:"Purple and Red Extremes 1"},"extremesdiv-bluegreen-purple":{stops:["rgba(0,66,56,1)","rgba(0,66,56,0.5)","rgba(255,255,255,0)","rgba(65,27,109,0.5)","rgba(65,27,109,1)"],tags:["purples","greens","extremes","light","colorblind-friendly"],name:"Purple and Green Extremes 1"},"extremesdiv-bluegreen-orange":{stops:["rgba(0,66,56,1)","rgba(0,66,56,0.5)","rgba(255,255,255,0)","rgba(165,50,23,0.5)","rgba(165,50,23,1)"],tags:["reds","greens","extremes","light","colorblind-friendly"],name:"Red and Green Extremes 4"},"extremesdiv-orange-pink":{stops:["rgba(165,50,23,1)","rgba(165,50,23,0.5)","rgba(255,255,255,0)","rgba(87,9,89,0.5)","rgba(87,9,89,1)"],tags:["reds","purples","extremes","dark","colorblind-friendly"],name:"Purple and Red Extremes 2"},"extremesdiv-redpurple-blue":{stops:["rgba(102,0,22,1)","rgba(102,0,22,0.5)","rgba(255,255,255,0)","rgba(16,48,94,0.5)","rgba(16,48,94,1)"],tags:["reds","blues","extremes","light","colorblind-friendly"],name:"Blue and Red Extremes 2"},"extremesdiv-orange-blue":{stops:["rgba(165,50,23,1)","rgba(165,50,23,0.5)","rgba(255,255,255,0)","rgba(16,48,94,0.5)","rgba(16,48,94,1)"],tags:["reds","blues","extremes","light","colorblind-friendly"],name:"Blue and Red Extremes 3"},"extremesdiv-green-pink":{stops:["rgba(56,73,3,1)","rgba(56,73,3,0.5)","rgba(255,255,255,0)","rgba(87,9,89,0.5)","rgba(87,9,89,1)"],tags:["purples","greens","extremes","light","colorblind-friendly"],name:"Purple and Green Extremes 2"},"extremesdiv-bluegreen-redpurple":{stops:["rgba(0,66,56,1)","rgba(0,66,56,0.5)","rgba(255,255,255,0)","rgba(102,0,22,0.5)","rgba(102,0,22,1)"],tags:["reds","greens","extremes","light"],name:"Red and Green Extremes 5"},"extremesdiv-green-redpurple":{stops:["rgba(56,73,3,1)","rgba(56,73,3,0.5)","rgba(255,255,255,0)","rgba(102,0,22,0.5)","rgba(102,0,22,1)"],tags:["reds","greens","extremes","light"],name:"Red and Green Extremes 6"},"extremesdiv-green-orange":{stops:["rgba(56,73,3,1)","rgba(56,73,3,0.5)","rgba(255,255,255,0)","rgba(165,50,23,0.5)","rgba(165,50,23,1)"],tags:["reds","greens","extremes","light"],name:"Red and Green Extremes 7"},"extremesdiv-red-yellow-pink":{stops:["rgba(153,11,11,1)","rgba(153,11,11,0.5)","rgba(255,255,255,0)","rgba(87,9,89,0.5)","rgba(87,9,89,1)"],tags:["reds","purples","extremes","dark","colorblind-friendly"],name:"Purple and Red Extremes 3"},"extremesdiv-blue-green":{stops:["rgba(16,48,94,1)","rgba(16,48,94,0.5)","rgba(255,255,255,0)","rgba(56,73,3,0.5)","rgba(56,73,3,1)"],tags:["greens","blues","extremes","light","colorblind-friendly"],name:"Green and Blue Extremes 1"},"extremesdiv-bluegreen-yellow-redpurple":{stops:["rgba(0,66,56,1)","rgba(0,66,56,0.5)","rgba(255,255,255,0)","rgba(102,0,22,0.5)","rgba(102,0,22,1)"],tags:["reds","greens","extremes","light"],name:"Red and Green Extremes 8"},"extremesdiv-bluegreen-pink":{stops:["rgba(0,66,56,1)","rgba(0,66,56,0.5)","rgba(255,255,255,0)","rgba(87,9,89,0.5)","rgba(87,9,89,1)"],tags:["purples","greens","extremes","light","colorblind-friendly"],name:"Purple and Green Extremes 3"},"extremesdiv-orange-yellow-blue-dark":{stops:["rgba(107,38,0,1)","rgba(107,38,0,0.5)","rgba(255,255,255,0)","rgba(0,38,73,0.5)","rgba(0,38,73,1)"],tags:["reds","blues","extremes","light","colorblind-friendly"],name:"Blue and Red Extremes 4"},"extremesdiv-red-yellow-purple":{stops:["rgba(153,11,11,1)","rgba(153,11,11,0.5)","rgba(255,255,255,0)","rgba(65,27,109,0.5)","rgba(65,27,109,1)"],tags:["reds","purples","extremes","dark","colorblind-friendly"],name:"Purple and Red Extremes 4"},"extremesdiv-orange-yellow-pink":{stops:["rgba(165,50,23,1)","rgba(165,50,23,0.5)","rgba(255,255,255,0)","rgba(87,9,89,0.5)","rgba(87,9,89,1)"],tags:["reds","purples","extremes","dark","colorblind-friendly"],name:"Purple and Red Extremes 5"},"extremesdiv-orange-gray-blue":{stops:["rgba(255,179,57,1)","rgba(255,179,57,0.5)","rgba(255,255,255,0)","rgba(117,239,221,0.5)","rgba(117,239,221,1)"],tags:["yellows","blues","greens","extremes","dark","bright","colorblind-friendly"],name:"Blue and Orange Extremes 1"},"extremesdiv-yellow-gray-purple":{stops:["rgba(255,237,133,1)","rgba(255,237,133,0.5)","rgba(255,255,255,0)","rgba(235,160,249,0.5)","rgba(235,160,249,1)"],tags:["yellows","purples","extremes","dark","bright","colorblind-friendly"],name:"Purple and Yellow Extremes 1"},"extremesdiv-red-gray-blue":{stops:["rgba(255,136,136,1)","rgba(255,136,136,0.5)","rgba(255,255,255,0)","rgba(117,239,221,0.5)","rgba(117,239,221,1)"],tags:["pinks","reds","blues","extremes","dark","light","bright","colorblind-friendly"],name:"Blue and Red Extremes 5"},"extremesdiv-green-gray-purple":{stops:["rgba(139,239,139,1)","rgba(139,239,139,0.5)","rgba(255,255,255,0)","rgba(235,160,249,0.5)","rgba(235,160,249,1)"],tags:["purples","greens","extremes","dark","bright","colorblind-friendly"],name:"Purple and Green Extremes 4"},"extremes-orange":{3:["rgba(165,50,23,1.0)","rgba(165,50,23,0.40)","rgba(165,50,23,1.0)"],5:["rgba(165,50,23,1.0)","rgba(165,50,23,0.60)","rgba(165,50,23,0.20)","rgba(165,50,23,0.60)","rgba(165,50,23,1.0)"],7:["rgba(165,50,23,1.0)","rgba(165,50,23,0.70)","rgba(165,50,23,0.40)","rgba(165,50,23,0.10)","rgba(165,50,23,0.40)","rgba(165,50,23,0.70)","rgba(165,50,23,1.0)"],9:["rgba(165,50,23,1.0)","rgba(165,50,23,0.78)","rgba(165,50,23,0.55)","rgba(165,50,23,0.33)","rgba(165,50,23,0.10)","rgba(165,50,23,0.33)","rgba(165,50,23,0.55)","rgba(165,50,23,0.78)","rgba(165,50,23,1.0)"],stops:["rgba(165,50,23,1.0)","rgba(165,50,23,0.5)","rgba(165,50,23,0)","rgba(165,50,23,0.5)","rgba(165,50,23,1.0)"],tags:["reds","extremes","dark","colorblind-friendly"],name:"Red Extremes 1"},"extremes-bluegreen":{3:["rgba(0,66,56,1.0)","rgba(0,66,56,0.40)","rgba(0,66,56,1.0)"],5:["rgba(0,66,56,1.0)","rgba(0,66,56,0.60)","rgba(0,66,56,0.20)","rgba(0,66,56,0.60)","rgba(0,66,56,1.0)"],7:["rgba(0,66,56,1.0)","rgba(0,66,56,0.70)","rgba(0,66,56,0.40)","rgba(0,66,56,0.10)","rgba(0,66,56,0.40)","rgba(0,66,56,0.70)","rgba(0,66,56,1.0)"],9:["rgba(0,66,56,1.0)","rgba(0,66,56,0.78)","rgba(0,66,56,0.55)","rgba(0,66,56,0.33)","rgba(0,66,56,0.10)","rgba(0,66,56,0.33)","rgba(0,66,56,0.55)","rgba(0,66,56,0.78)","rgba(0,66,56,1.0)"],stops:["rgba(0,66,56,1.0)","rgba(0,66,56,0.5)","rgba(0,66,56,0)","rgba(0,66,56,0.5)","rgba(0,66,56,1.0)"],tags:["greens","extremes","light","colorblind-friendly"],name:"Green Extremes 1"},"extremes-red":{3:["rgba(153,11,11,1.0)","rgba(153,11,11,0.40)","rgba(153,11,11,1.0)"],5:["rgba(153,11,11,1.0)","rgba(153,11,11,0.60)","rgba(153,11,11,0.20)","rgba(153,11,11,0.60)","rgba(153,11,11,1.0)"],7:["rgba(153,11,11,1.0)","rgba(153,11,11,0.70)","rgba(153,11,11,0.40)","rgba(153,11,11,0.10)","rgba(153,11,11,0.40)","rgba(153,11,11,0.70)","rgba(153,11,11,1.0)"],9:["rgba(153,11,11,1.0)","rgba(153,11,11,0.78)","rgba(153,11,11,0.55)","rgba(153,11,11,0.33)","rgba(153,11,11,0.10)","rgba(153,11,11,0.33)","rgba(153,11,11,0.55)","rgba(153,11,11,0.78)","rgba(153,11,11,1.0)"],stops:["rgba(153,11,11,1.0)","rgba(153,11,11,0.5)","rgba(153,11,11,0)","rgba(153,11,11,0.5)","rgba(153,11,11,1.0)"],tags:["reds","extremes","bright","dark","colorblind-friendly"],name:"Red Extremes 2"},"extremes-orange-dark":{3:["rgba(107,38,0,1.0)","rgba(107,38,0,0.40)","rgba(107,38,0,1.0)"],5:["rgba(107,38,0,1.0)","rgba(107,38,0,0.60)","rgba(107,38,0,0.20)","rgba(107,38,0,0.60)","rgba(107,38,0,1.0)"],7:["rgba(107,38,0,1.0)","rgba(107,38,0,0.70)","rgba(107,38,0,0.40)","rgba(107,38,0,0.10)","rgba(107,38,0,0.40)","rgba(107,38,0,0.70)","rgba(107,38,0,1.0)"],9:["rgba(107,38,0,1.0)","rgba(107,38,0,0.78)","rgba(107,38,0,0.55)","rgba(107,38,0,0.33)","rgba(107,38,0,0.10)","rgba(107,38,0,0.33)","rgba(107,38,0,0.55)","rgba(107,38,0,0.78)","rgba(107,38,0,1.0)"],stops:["rgba(107,38,0,1.0)","rgba(107,38,0,0.5)","rgba(107,38,0,0)","rgba(107,38,0,0.5)","rgba(107,38,0,1.0)"],tags:["extremes","browns","dark","colorblind-friendly"],name:"Red Extremes 3"},"extremes-orange-bright":{3:["rgba(255,179,57,1.0)","rgba(255,179,57,0.40)","rgba(255,179,57,1.0)"],5:["rgba(255,179,57,1.0)","rgba(255,179,57,0.60)","rgba(255,179,57,0.20)","rgba(255,179,57,0.60)","rgba(255,179,57,1.0)"],7:["rgba(255,179,57,1.0)","rgba(255,179,57,0.70)","rgba(255,179,57,0.40)","rgba(255,179,57,0.10)","rgba(255,179,57,0.40)","rgba(255,179,57,0.70)","rgba(255,179,57,1.0)"],9:["rgba(255,179,57,1.0)","rgba(255,179,57,0.78)","rgba(255,179,57,0.55)","rgba(255,179,57,0.33)","rgba(255,179,57,0.10)","rgba(255,179,57,0.33)","rgba(255,179,57,0.55)","rgba(255,179,57,0.78)","rgba(255,179,57,1.0)"],stops:["rgba(255,179,57,1.0)","rgba(255,179,57,0.5)","rgba(255,179,57,0)","rgba(255,179,57,0.5)","rgba(255,179,57,1.0)"],tags:["oranges","extremes","bright","dark","colorblind-friendly"],name:"Yellow Extremes 1"},"extremes-purple":{3:["rgba(65,27,109,1.0)","rgba(65,27,109,0.40)","rgba(65,27,109,1.0)"],5:["rgba(65,27,109,1.0)","rgba(65,27,109,0.60)","rgba(65,27,109,0.20)","rgba(65,27,109,0.60)","rgba(65,27,109,1.0)"],7:["rgba(65,27,109,1.0)","rgba(65,27,109,0.70)","rgba(65,27,109,0.40)","rgba(65,27,109,0.10)","rgba(65,27,109,0.40)","rgba(65,27,109,0.70)","rgba(65,27,109,1.0)"],9:["rgba(65,27,109,1.0)","rgba(65,27,109,0.78)","rgba(65,27,109,0.55)","rgba(65,27,109,0.33)","rgba(65,27,109,0.10)","rgba(65,27,109,0.33)","rgba(65,27,109,0.55)","rgba(65,27,109,0.78)","rgba(65,27,109,1.0)"],stops:["rgba(65,27,109,1.0)","rgba(65,27,109,0.5)","rgba(65,27,109,0)","rgba(65,27,109,0.5)","rgba(65,27,109,1.0)"],tags:["purples","extremes","light","colorblind-friendly"],name:"Purple Extremes 1"},"extremes-pink":{3:["rgba(87,9,89,1.0)","rgba(87,9,89,0.40)","rgba(87,9,89,1.0)"],5:["rgba(87,9,89,1.0)","rgba(87,9,89,0.60)","rgba(87,9,89,0.20)","rgba(87,9,89,0.60)","rgba(87,9,89,1.0)"],7:["rgba(87,9,89,1.0)","rgba(87,9,89,0.70)","rgba(87,9,89,0.40)","rgba(87,9,89,0.10)","rgba(87,9,89,0.40)","rgba(87,9,89,0.70)","rgba(87,9,89,1.0)"],9:["rgba(87,9,89,1.0)","rgba(87,9,89,0.78)","rgba(87,9,89,0.55)","rgba(87,9,89,0.33)","rgba(87,9,89,0.10)","rgba(87,9,89,0.33)","rgba(87,9,89,0.55)","rgba(87,9,89,0.78)","rgba(87,9,89,1.0)"],stops:["rgba(87,9,89,1.0)","rgba(87,9,89,0.5)","rgba(87,9,89,0)","rgba(87,9,89,0.5)","rgba(87,9,89,1.0)"],tags:["purples","extremes","light","colorblind-friendly"],name:"Purple Extremes 2"},"extremes-blue":{3:["rgba(16,48,94,1.0)","rgba(16,48,94,0.40)","rgba(16,48,94,1.0)"],5:["rgba(16,48,94,1.0)","rgba(16,48,94,0.60)","rgba(16,48,94,0.20)","rgba(16,48,94,0.60)","rgba(16,48,94,1.0)"],7:["rgba(16,48,94,1.0)","rgba(16,48,94,0.70)","rgba(16,48,94,0.40)","rgba(16,48,94,0.10)","rgba(16,48,94,0.40)","rgba(16,48,94,0.70)","rgba(16,48,94,1.0)"],9:["rgba(16,48,94,1.0)","rgba(16,48,94,0.78)","rgba(16,48,94,0.55)","rgba(16,48,94,0.33)","rgba(16,48,94,0.10)","rgba(16,48,94,0.33)","rgba(16,48,94,0.55)","rgba(16,48,94,0.78)","rgba(16,48,94,1.0)"],stops:["rgba(16,48,94,1.0)","rgba(16,48,94,0.5)","rgba(16,48,94,0)","rgba(16,48,94,0.5)","rgba(16,48,94,1.0)"],tags:["blues","extremes","light","colorblind-friendly"],name:"Blue Extremes 1"},"extremes-blue-dark":{3:["rgba(0,38,73,1.0)","rgba(0,38,73,0.40)","rgba(0,38,73,1.0)"],5:["rgba(0,38,73,1.0)","rgba(0,38,73,0.60)","rgba(0,38,73,0.20)","rgba(0,38,73,0.60)","rgba(0,38,73,1.0)"],7:["rgba(0,38,73,1.0)","rgba(0,38,73,0.70)","rgba(0,38,73,0.40)","rgba(0,38,73,0.10)","rgba(0,38,73,0.40)","rgba(0,38,73,0.70)","rgba(0,38,73,1.0)"],9:["rgba(0,38,73,1.0)","rgba(0,38,73,0.78)","rgba(0,38,73,0.55)","rgba(0,38,73,0.33)","rgba(0,38,73,0.10)","rgba(0,38,73,0.33)","rgba(0,38,73,0.55)","rgba(0,38,73,0.78)","rgba(0,38,73,1.0)"],stops:["rgba(0,38,73,1.0)","rgba(0,38,73,0.5)","rgba(0,38,73,0)","rgba(0,38,73,0.5)","rgba(0,38,73,1.0)"],tags:["blues","extremes","light","colorblind-friendly"],name:"Blue Extremes 2"},"extremes-blue-bright":{3:["rgba(117,239,221,1.0)","rgba(117,239,221,0.40)","rgba(117,239,221,1.0)"],5:["rgba(117,239,221,1.0)","rgba(117,239,221,0.60)","rgba(117,239,221,0.20)","rgba(117,239,221,0.60)","rgba(117,239,221,1.0)"],7:["rgba(117,239,221,1.0)","rgba(117,239,221,0.70)","rgba(117,239,221,0.40)","rgba(117,239,221,0.10)","rgba(117,239,221,0.40)","rgba(117,239,221,0.70)","rgba(117,239,221,1.0)"],9:["rgba(117,239,221,1.0)","rgba(117,239,221,0.78)","rgba(117,239,221,0.55)","rgba(117,239,221,0.33)","rgba(117,239,221,0.10)","rgba(117,239,221,0.33)","rgba(117,239,221,0.55)","rgba(117,239,221,0.78)","rgba(117,239,221,1.0)"],stops:["rgba(117,239,221,1.0)","rgba(117,239,221,0.5)","rgba(117,239,221,0)","rgba(117,239,221,0.5)","rgba(117,239,221,1.0)"],tags:["blues","greens","bright","extremes","dark","colorblind-friendly"],name:"Green Extremes 2"},"extremes-orange-gray":{3:["#a53217","#bf9990","#a53217"],5:["#a53217","#b97f72","#cccccc","#b97f72","#a53217"],7:["#a53217","#b26553","#bf9990","#cccccc","#bf9990","#b26553","#a53217"],9:["#a53217","#af5944","#b97f72","#c2a69f","#cccccc","#c2a69f","#b97f72","#af5944","#a53217"],stops:["#a53217","#b97f72","#cccccc","#b97f72","#a53217"],tags:["reds","extremes","light","subdued","colorblind-friendly"],name:"Red Extremes 4"},"extremes-bluegreen-gray":{3:["#004238","#889e9b","#004238"],5:["#004238","#668782","#cccccc","#668782","#004238"],7:["#004238","#447069","#889e9b","#cccccc","#889e9b","#447069","#004238"],9:["#004238","#33655d","#668782","#99aaa7","#cccccc","#99aaa7","#668782","#33655d","#004238"],stops:["#004238","#668782","#cccccc","#668782","#004238"],tags:["greens","extremes","light","subdued","colorblind-friendly"],name:"Green Extremes 3"},"extremes-red-gray":{3:["#990b0b","#bb8c8c","#990b0b"],5:["#990b0b","#b36c6c","#cccccc","#b36c6c","#990b0b"],7:["#990b0b","#aa4b4b","#bb8c8c","#cccccc","#bb8c8c","#aa4b4b","#990b0b"],9:["#990b0b","#a63b3b","#b36c6c","#bf9c9c","#cccccc","#bf9c9c","#b36c6c","#a63b3b","#990b0b"],stops:["#990b0b","#b36c6c","#cccccc","#b36c6c","#990b0b"],tags:["reds","extremes","light","colorblind-friendly"],name:"Red Extremes 5"},"extremes-orange-gray-dark":{3:["#6b2600","#ac9588","#6b2600"],5:["#6b2600","#9c7966","#cccccc","#9c7966","#6b2600"],7:["#6b2600","#8b5d44","#ac9588","#cccccc","#ac9588","#8b5d44","#6b2600"],9:["#6b2600","#835033","#9c7966","#b4a399","#cccccc","#b4a399","#9c7966","#835033","#6b2600"],stops:["#6b2600","#9c7966","#cccccc","#9c7966","#6b2600"],tags:["browns","extremes","light","subdued","colorblind-friendly"],name:"Brown Extremes 1"},"extremes-orange-gray-bright":{3:["#ffb339","#775e35","#ffb339"],5:["#ffb339","#997336","#333333","#997336","#ffb339"],7:["#ffb339","#bb8837","#775e35","#333333","#775e35","#bb8837","#ffb339"],9:["#ffb339","#cc9338","#997336","#665335","#333333","#665335","#997336","#cc9338","#ffb339"],stops:["#ffb339","#997336","#333333","#997336","#ffb339"],tags:["oranges","extremes","dark","colorblind-friendly"],name:"Yellow Extremes 2"},"extremes-purple-gray":{3:["#411b6d","#9e91ac","#411b6d"],5:["#411b6d","#87749d","#cccccc","#87749d","#411b6d"],7:["#411b6d","#6f568d","#9e91ac","#cccccc","#9e91ac","#6f568d","#411b6d"],9:["#411b6d","#644785","#87749d","#a9a0b4","#cccccc","#a9a0b4","#87749d","#644785","#411b6d"],stops:["#411b6d","#87749d","#cccccc","#87749d","#411b6d"],tags:["purples","extremes","light","colorblind-friendly"],name:"Purple Extremes 3"},"extremes-pink-gray":{3:["#570959","#a58ba6","#570959"],5:["#570959","#926b93","#cccccc","#926b93","#570959"],7:["#570959","#7e4a7f","#a58ba6","#cccccc","#a58ba6","#7e4a7f","#570959"],9:["#570959","#743a76","#926b93","#af9baf","#cccccc","#af9baf","#926b93","#743a76","#570959"],stops:["#570959","#926b93","#cccccc","#926b93","#570959"],tags:["purples","extremes","light","colorblind-friendly"],name:"Purple Extremes 4"},"extremes-blue-gray":{3:["#10305e","#8d98a7","#10305e"],5:["#10305e","#6e7e95","#cccccc","#6e7e95","#10305e"],7:["#10305e","#4f6483","#8d98a7","#cccccc","#8d98a7","#4f6483","#10305e"],9:["#10305e","#3f577a","#6e7e95","#9da5b1","#cccccc","#9da5b1","#6e7e95","#3f577a","#10305e"],stops:["#10305e","#6e7e95","#cccccc","#6e7e95","#10305e"],tags:["blues","extremes","light","colorblind-friendly"],name:"Blue Extremes 3"},"extremes-blue-gray-dark":{3:["#002649","#8895a0","#002649"],5:["#002649","#66798b","#cccccc","#66798b","#002649"],7:["#002649","#445d75","#8895a0","#cccccc","#8895a0","#445d75","#002649"],9:["#002649","#33506a","#66798b","#99a3ab","#cccccc","#99a3ab","#66798b","#33506a","#002649"],stops:["#002649","#66798b","#cccccc","#66798b","#002649"],tags:["blues","extremes","light","subdued","colorblind-friendly"],name:"Blue Extremes 4"},"extremes-blue-gray-bright":{3:["#75efdd","#49726c","#75efdd"],5:["#75efdd","#549188","#333333","#549188","#75efdd"],7:["#75efdd","#5fb0a4","#49726c","#333333","#49726c","#5fb0a4","#75efdd"],9:["#75efdd","#65c0b3","#549188","#44625e","#333333","#44625e","#549188","#65c0b3","#75efdd"],stops:["#75efdd","#549188","#333333","#549188","#75efdd"],tags:["blues","greens","bright","extremes","dark","colorblind-friendly"],name:"Green Extremes 4"},"extremes-red-gray-bright":{stops:["#ff4141","#a63a55","#4d414d","#a63a55","#ff4141"],tags:["reds","extremes","dark","bright","colorblind-friendly"],name:"Red Extremes 6"},"extremes-purple-gray-bright":{stops:["#b44dff","#7e3ca6","#4c374d","#7e3ca6","#b44dff"],tags:["purples","extremes","dark","bright","colorblind-friendly"],name:"Purple Extremes 5"},"extremes-blue-bright-gray-bright":{stops:["#40bfff","#2c6f9e","#383855","#2c6f9e","#40bfff"],tags:["blues","extremes","dark","bright","colorblind-friendly"],name:"Blue Extremes 5"},"extremes-green-gray-bright":{stops:["#00ff78","#18a064","#2f4147","#18a064","#00ff78"],tags:["greens","extremes","dark","bright","colorblind-friendly"],name:"Green Extremes 5"},"extremes-yellow-gray-bright":{stops:["#f9ff5a","#878c34","#41472e","#878c34","#f9ff5a"],tags:["yellows","extremes","dark","bright","colorblind-friendly"],name:"Yellow Extremes 3"},"extremes-pink-gray-dark":{stops:["#a6004e","#995c99","#bbb8cc","#995c99","#a6004e"],tags:["purples","pinks","extremes","light","colorblind-friendly"],name:"Purple Extremes 6"},"extremes-purple-gray-dark":{stops:["#7f0099","#835fa6","#bdb8d9","#835fa6","#7f0099"],tags:["purples","extremes","light","bright","colorblind-friendly"],name:"Purple Extremes 7"},"extremes-blue-bright-gray-dark":{stops:["#003df2","#6187f2","#c2cff2","#6187f2","#003df2"],tags:["blues","extremes","light","bright","colorblind-friendly"],name:"Blue Extremes 6"},"extremes-green-gray-dark":{stops:["#00735f","#4d9a94","#b8d5d9","#4d9a94","#00735f"],tags:["greens","extremes","light","colorblind-friendly"],name:"Green Extremes 6"},"extremes-brown-gray-dark":{stops:["#994e00","#b38657","#ccbdad","#b38657","#994e00"],tags:["browns","extremes","light","colorblind-friendly"],name:"Brown Extremes 2"},"point-cloud-elevation-scheme":{stops:["rgb(88, 19, 252)","rgb(28, 194, 253)","rgb(125, 253, 148)","rgb(245, 201, 38)","rgb(255, 43, 24)"],tags:["blues","reds","yellows","greens","point-cloud","bright","colorblind-friendly"],name:"Point Cloud 1"},"point-cloud-intensity-scheme":{stops:["rgb(0, 0, 0)","rgb(50, 50, 50)","rgb(73, 73, 73)","rgb(140, 140, 140)","rgb(255, 255, 255)"],tags:["grays","point-cloud","subdued","colorblind-friendly"],name:"Point Cloud 2"},"cat-dark":{2:["#ed5151","#149ece"],3:["#ed5151","#149ece","#a7c636"],4:["#ed5151","#149ece","#a7c636","#9e559c"],5:["#ed5151","#149ece","#a7c636","#9e559c","#fc921f"],6:["#ed5151","#149ece","#a7c636","#9e559c","#fc921f","#ffde3e"],7:["#ed5151","#149ece","#a7c636","#9e559c","#fc921f","#ffde3e","#f789d8"],8:["#ed5151","#149ece","#a7c636","#9e559c","#fc921f","#ffde3e","#f789d8","#b7814a"],9:["#ed5151","#149ece","#a7c636","#9e559c","#fc921f","#ffde3e","#f789d8","#b7814a","#3caf99"],10:["#ed5151","#149ece","#a7c636","#9e559c","#fc921f","#ffde3e","#f789d8","#b7814a","#3caf99","#6b6bd6"],11:["#ed5151","#149ece","#a7c636","#9e559c","#fc921f","#ffde3e","#f789d8","#b7814a","#3caf99","#6b6bd6","#b54779"],12:["#ed5151","#149ece","#a7c636","#9e559c","#fc921f","#ffde3e","#f789d8","#b7814a","#3caf99","#6b6bd6","#b54779","#7f7f7f"],stops:["#ed5151","#149ece","#a7c636","#9e559c","#fc921f","#ffde3e","#f789d8","#b7814a","#3caf99","#6b6bd6","#b54779","#7f7f7f"],tags:["bright","categorical"],name:"Metro Movement"},"cat-light":{2:["#fd7f6f","#7eb0d5"],3:["#fd7f6f","#7eb0d5","#b2e061"],4:["#fd7f6f","#7eb0d5","#b2e061","#bd7ebe"],5:["#fd7f6f","#7eb0d5","#b2e061","#bd7ebe","#ffb55a"],6:["#fd7f6f","#7eb0d5","#b2e061","#bd7ebe","#ffb55a","#ffee65"],7:["#fd7f6f","#7eb0d5","#b2e061","#bd7ebe","#ffb55a","#ffee65","#beb9db"],8:["#fd7f6f","#7eb0d5","#b2e061","#bd7ebe","#ffb55a","#ffee65","#beb9db","#fdcce5"],9:["#fd7f6f","#7eb0d5","#b2e061","#bd7ebe","#ffb55a","#ffee65","#beb9db","#fdcce5","#8bd3c7"],10:["#fd7f6f","#7eb0d5","#b2e061","#bd7ebe","#ffb55a","#ffee65","#beb9db","#fdcce5","#8bd3c7","#cbecc4"],11:["#fd7f6f","#7eb0d5","#b2e061","#bd7ebe","#ffb55a","#ffee65","#beb9db","#fdcce5","#8bd3c7","#cbecc4","#ffffaf"],12:["#fd7f6f","#7eb0d5","#b2e061","#bd7ebe","#ffb55a","#ffee65","#beb9db","#fdcce5","#8bd3c7","#cbecc4","#ffffaf","#d9d9d9"],stops:["#fd7f6f","#7eb0d5","#b2e061","#bd7ebe","#ffb55a","#ffee65","#beb9db","#fdcce5","#8bd3c7","#cbecc4","#ffffaf","#d9d9d9"],tags:["light","categorical"],name:"Pastel Dreams"},"predominant-v1":{1:["#a03500"],2:["#a03500","#d9b400"],3:["#a03500","#d9b400","#3264c8"],4:["#a03500","#d9b400","#3264c8","#72b38e"],5:["#a03500","#d9b400","#3264c8","#72b38e","#986ba1"],6:["#a03500","#d9b400","#3264c8","#72b38e","#986ba1","#b9a087"],7:["#a03500","#d9b400","#3264c8","#72b38e","#986ba1","#b9a087","#4c91bf"],8:["#a03500","#d9b400","#3264c8","#72b38e","#986ba1","#b9a087","#4c91bf","#a5d236"],9:["#a03500","#d9b400","#3264c8","#72b38e","#986ba1","#b9a087","#4c91bf","#a5d236","#96aedc"],10:["#a03500","#d9b400","#3264c8","#72b38e","#986ba1","#b9a087","#4c91bf","#a5d236","#96aedc","#ad8516"],stops:["#a03500","#d9b400","#3264c8","#72b38e","#986ba1","#b9a087","#4c91bf","#a5d236","#96aedc","#ad8516"],tags:["subdued","categorical"],name:"Mother Earth"},"predominant-v2":{1:["#dc4b00"],2:["#dc4b00","#3c6ccc"],3:["#dc4b00","#3c6ccc","#d9dc00"],4:["#dc4b00","#3c6ccc","#d9dc00","#91d900"],5:["#dc4b00","#3c6ccc","#d9dc00","#91d900","#986ba1"],6:["#dc4b00","#3c6ccc","#d9dc00","#91d900","#986ba1","#d99f00"],7:["#dc4b00","#3c6ccc","#d9dc00","#91d900","#986ba1","#d99f00","#4db478"],8:["#dc4b00","#3c6ccc","#d9dc00","#91d900","#986ba1","#d99f00","#4db478","#4cafdc"],9:["#dc4b00","#3c6ccc","#d9dc00","#91d900","#986ba1","#d99f00","#4db478","#4cafdc","#96aedc"],10:["#dc4b00","#3c6ccc","#d9dc00","#91d900","#986ba1","#d99f00","#4db478","#4cafdc","#96aedc","#d7a799"],stops:["#dc4b00","#3c6ccc","#d9dc00","#91d900","#986ba1","#d99f00","#4db478","#4cafdc","#96aedc","#d7a799"],tags:["dark","categorical"],name:"Rainforest Frogs"},"predominant-v3":{1:["#1e8553"],2:["#1e8553","#c44296"],3:["#1e8553","#c44296","#d9bf0d"],4:["#1e8553","#c44296","#d9bf0d","#d97f00"],5:["#1e8553","#c44296","#d9bf0d","#d97f00","#00b6f1"],6:["#1e8553","#c44296","#d9bf0d","#d97f00","#00b6f1","#9933cc"],7:["#1e8553","#c44296","#d9bf0d","#d97f00","#00b6f1","#9933cc","#3abf66"],8:["#1e8553","#c44296","#d9bf0d","#d97f00","#00b6f1","#9933cc","#3abf66","#b9a087"],9:["#1e8553","#c44296","#d9bf0d","#d97f00","#00b6f1","#9933cc","#3abf66","#b9a087","#96aedc"],10:["#1e8553","#c44296","#d9bf0d","#d97f00","#00b6f1","#9933cc","#3abf66","#b9a087","#96aedc","#807b71"],stops:["#1e8553","#c44296","#d9bf0d","#d97f00","#00b6f1","#9933cc","#3abf66","#b9a087","#96aedc","#807b71"],tags:["dark","categorical"],name:"Fruit Basket"},"predominant-v4":{1:["#ccb642"],2:["#ccb642","#6998b4"],3:["#ccb642","#6998b4","#a67474"],4:["#ccb642","#6998b4","#a67474","#6bb38f"],5:["#ccb642","#6998b4","#a67474","#6bb38f","#9a6bb3"],6:["#ccb642","#6998b4","#a67474","#6bb38f","#9a6bb3","#bf8739"],7:["#ccb642","#6998b4","#a67474","#6bb38f","#9a6bb3","#bf8739","#96aedc"],8:["#ccb642","#6998b4","#a67474","#6bb38f","#9a6bb3","#bf8739","#96aedc","#a0a043"],9:["#ccb642","#6998b4","#a67474","#6bb38f","#9a6bb3","#bf8739","#96aedc","#a0a043","#b9a087"],10:["#ccb642","#6998b4","#a67474","#6bb38f","#9a6bb3","#bf8739","#96aedc","#a0a043","#b9a087","#8f8399"],stops:["#ccb642","#6998b4","#a67474","#6bb38f","#9a6bb3","#bf8739","#96aedc","#a0a043","#b9a087","#8f8399"],tags:["subdued","categorical"],name:"Rainy Day"},"predominant-v5":{1:["#e60049"],2:["#e60049","#0bb4ff"],3:["#e60049","#0bb4ff","#50e991"],4:["#e60049","#0bb4ff","#50e991","#e6d800"],5:["#e60049","#0bb4ff","#50e991","#e6d800","#9b19f5"],6:["#e60049","#0bb4ff","#50e991","#e6d800","#9b19f5","#ffa300"],7:["#e60049","#0bb4ff","#50e991","#e6d800","#9b19f5","#ffa300","#dc0ab4"],8:["#e60049","#0bb4ff","#50e991","#e6d800","#9b19f5","#ffa300","#dc0ab4","#b3d4ff"],9:["#e60049","#0bb4ff","#50e991","#e6d800","#9b19f5","#ffa300","#dc0ab4","#b3d4ff","#00bfa0"],10:["#e60049","#0bb4ff","#50e991","#e6d800","#9b19f5","#ffa300","#dc0ab4","#b3d4ff","#00bfa0","#f0cccc"],stops:["#e60049","#0bb4ff","#50e991","#e6d800","#9b19f5","#ffa300","#dc0ab4","#b3d4ff","#00bfa0","#f0cccc"],tags:["bright","categorical"],name:"Flower Field"},"predominance-race":{1:["#00b6f1"],2:["#00b6f1","#d9bf0d"],3:["#00b6f1","#d9bf0d","#c44245"],4:["#00b6f1","#d9bf0d","#c44245","#6a28c7"],5:["#00b6f1","#d9bf0d","#c44245","#6a28c7","#b9a087"],6:["#00b6f1","#d9bf0d","#c44245","#6a28c7","#b9a087","#ab579d"],7:["#00b6f1","#d9bf0d","#c44245","#6a28c7","#b9a087","#ab579d","#78aea0"],8:["#00b6f1","#d9bf0d","#c44245","#6a28c7","#b9a087","#ab579d","#78aea0","#1e8553"],9:["#00b6f1","#d9bf0d","#c44245","#6a28c7","#b9a087","#ab579d","#78aea0","#1e8553","#ada016"],10:["#00b6f1","#d9bf0d","#c44245","#6a28c7","#b9a087","#ab579d","#78aea0","#1e8553","#ada016","#0094bf"],stops:["#00b6f1","#d9bf0d","#c44245","#6a28c7","#b9a087","#ab579d","#78aea0","#1e8553","#ada016","#0094bf"],tags:["bright","categorical"],name:"Mushroom Soup"},"predominance-money":{1:["#437a75"],2:["#437a75","#d9d78c"],3:["#437a75","#d9d78c","#bf7860"],4:["#437a75","#d9d78c","#bf7860","#72231f"],5:["#437a75","#d9d78c","#bf7860","#72231f","#afbfa2"],6:["#437a75","#d9d78c","#bf7860","#72231f","#afbfa2","#5a9bc8"],7:["#437a75","#d9d78c","#bf7860","#72231f","#afbfa2","#5a9bc8","#89a6a6"],8:["#437a75","#d9d78c","#bf7860","#72231f","#afbfa2","#5a9bc8","#89a6a6","#99905c"],9:["#437a75","#d9d78c","#bf7860","#72231f","#afbfa2","#5a9bc8","#89a6a6","#99905c","#414b8c"],10:["#437a75","#d9d78c","#bf7860","#72231f","#afbfa2","#5a9bc8","#89a6a6","#99905c","#414b8c","#a664a0"],stops:["#437a75","#d9d78c","#bf7860","#72231f","#afbfa2","#5a9bc8","#89a6a6","#99905c","#414b8c","#a664a0"],tags:["subdued","categorical"],name:"Olive Harmony"},"predominance-race-ethnic":{1:["#0040bf"],2:["#0040bf","#a3cc52"],3:["#0040bf","#a3cc52","#b9a087"],4:["#0040bf","#a3cc52","#b9a087","#a01fcc"],5:["#0040bf","#a3cc52","#b9a087","#a01fcc","#5bb698"],6:["#0040bf","#a3cc52","#b9a087","#a01fcc","#5bb698","#5e851e"],7:["#0040bf","#a3cc52","#b9a087","#a01fcc","#5bb698","#5e851e","#d1943f"],8:["#0040bf","#a3cc52","#b9a087","#a01fcc","#5bb698","#5e851e","#d1943f","#96aedc"],9:["#0040bf","#a3cc52","#b9a087","#a01fcc","#5bb698","#5e851e","#d1943f","#96aedc","#629ed9"],10:["#0040bf","#a3cc52","#b9a087","#a01fcc","#5bb698","#5e851e","#d1943f","#96aedc","#629ed9","#8a64b3"],stops:["#0040bf","#a3cc52","#b9a087","#a01fcc","#5bb698","#5e851e","#d1943f","#96aedc","#629ed9","#8a64b3"],tags:["dark","categorical"],name:"Galaxy Berries"},"predominance-rainbow":{1:["#d43f70"],2:["#007fd9","#d43f70"],3:["#007fd9","#d43f70","#c4dc66"],4:["#007fd9","#d43f70","#b6a135","#c4dc66"],5:["#007fd9","#d43f70","#b6a135","#c4dc66","#ebe498"],6:["#007fd9","#d43f70","#d9874c","#b6a135","#c4dc66","#ebe498"],7:["#007fd9","#881fc5","#d43f70","#d9874c","#b6a135","#c4dc66","#ebe498"],8:["#007fd9","#443dbf","#881fc5","#d43f70","#d9874c","#b6a135","#c4dc66","#ebe498"],9:["#007fd9","#443dbf","#881fc5","#d43f70","#d9874c","#b6a135","#adbf27","#c4dc66","#ebe498"],10:["#007fd9","#443dbf","#881fc5","#bf00bf","#d43f70","#d9874c","#b6a135","#adbf27","#c4dc66","#ebe498"],stops:["#007fd9","#443dbf","#881fc5","#bf00bf","#d43f70","#d9874c","#b6a135","#adbf27","#c4dc66","#ebe498"],tags:["bright","categorical"],name:"Retro Flow"},"predominance-sequence":{1:["#b30000"],2:["#b30000","#ebdc78"],3:["#b30000","#8be04e","#ebdc78"],4:["#b30000","#1a53ff","#8be04e","#ebdc78"],5:["#b30000","#7c1158","#1a53ff","#8be04e","#ebdc78"],6:["#b30000","#7c1158","#1a53ff","#00b7c7","#8be04e","#ebdc78"],7:["#b30000","#7c1158","#4421af","#1a53ff","#00b7c7","#8be04e","#ebdc78"],8:["#b30000","#7c1158","#4421af","#1a53ff","#00b7c7","#5ad45a","#8be04e","#ebdc78"],9:["#b30000","#7c1158","#4421af","#1a53ff","#0d88e6","#00b7c7","#5ad45a","#8be04e","#ebdc78"],10:["#b30000","#7c1158","#4421af","#1a53ff","#0d88e6","#00b7c7","#5ad45a","#8be04e","#c5d96d","#ebdc78"],stops:["#b30000","#7c1158","#4421af","#1a53ff","#0d88e6","#00b7c7","#5ad45a","#8be04e","#c5d96d","#ebdc78"],tags:["bright","categorical"],name:"Sunset Fade"},"tropical-bliss":{stops:["rgba(252, 62, 90, 1)","rgba(252, 225, 56, 1.0)","rgba(76, 129, 205, 1)","rgba(241, 152, 60, 1)","rgba(72, 136, 92, 1)","rgba(165, 83, 183, 1)","rgba(255, 247, 153, 1)","rgba(177, 169, 208, 1)","rgba(110, 207, 252, 1)","rgba(252, 111, 132, 1)","rgba(106, 246, 137, 1)","rgba(252, 210, 126, 1)"],tags:["bright","categorical"],name:"Tropical Bliss"},"desert-blooms":{stops:["rgba(217, 53, 26, 1)","rgba(255, 199, 48, 1)","rgba(20, 77, 89, 1)","rgba(44, 105, 84, 1)","rgba(237, 147, 16, 1)","rgba(140, 33, 63, 1)","rgba(16, 36, 50, 1)","rgba(166, 79, 27, 1)","rgba(24, 56, 46, 1)","rgba(102, 21, 16, 1)","rgba(179, 21, 21, 1)","rgba(74, 9, 50, 1)"],tags:["light","dark","categorical"],name:"Desert Bloom"},"under-the-sea":{stops:["rgba(2, 78, 118, 1)","rgba(234, 49, 31, 1)","rgba(0, 115, 76, 1)","rgba(112, 68, 137, 1)","rgba(240, 145, 0, 1)","rgba(96, 113, 0, 1)","rgba(117, 112, 179, 1)","rgba(198, 0, 75, 1)","rgba(102, 102, 102, 1)","rgba(1, 172, 202 1)","rgba(191, 151, 39, 1)","rgba(51, 51, 51, 1)"],tags:["light","dark","categorical"],name:"Under the Sea"},"vibrant-rainbow":{stops:["rgba(50, 184, 166, 1)","rgba(245, 203, 17, 1)","rgba(235, 114, 0, 1)","rgba(196, 97, 235, 1)","rgba(108, 112, 0, 1)","rgba(191, 46, 46, 1)","rgba(70, 227, 156, 1)","rgba(159, 212, 12, 1)","rgba(173, 0, 242, 1)","rgba(255, 251, 0, 1)","rgba(127, 242, 250, 1)","rgba(232, 167, 132, 1)"],tags:["bright","categorical"],name:"Vibrant Rainbow"},"ocean-bay":{stops:["rgba(196, 53, 65, 1)","rgba(17, 73, 92, 1)","rgba(135, 176, 81, 1)","rgba(219, 182, 88, 1)","rgba(155, 224, 192, 1)","rgba(143, 143, 130, 1)","rgba(25, 25, 33, 1)","rgba(120, 177, 194, 1)","rgba(69, 79, 75, 1)","rgba(247, 236, 136, 1)","rgba(235, 220, 193, 1)","rgba(117, 53, 30, 1)"],tags:["subdued","categorical"],name:"Ocean Bay"},"prairie-summer":{stops:["rgba(123, 250, 235, 1)","rgba(234, 218, 64, 1)","rgba(117, 21, 85, 1)","rgba(212, 112, 19, 1)","rgba(51, 36, 36, 1)","rgba(130, 170, 214, 1)","rgba(31, 194, 53, 1)","rgba(214, 137, 137, 1)","rgba(33, 17, 115, 1)","rgba(107, 100, 8, 1)","rgba(110, 201, 168, 1)","rgba(204, 197, 74, 1)"],tags:["light","dark","categorical"],name:"Prairie Summer"},"pastel-chalk":{stops:["rgba(160, 184, 181, 1)","rgba(191, 142, 142, 1)","rgba(255, 253, 153, 1)","rgba(193, 212, 140, 1)","rgba(223, 193, 235, 1)","rgba(242, 185, 131, 1)","rgba(203, 247, 250, 1)","rgba(148, 153, 92, 1)","rgba(215, 145, 242, 1)","rgba(245, 230, 164, 1)","rgba(184, 227, 208, 1)","rgba(232, 196, 178, 1)"],tags:["subdued","categorical"],name:"Pastel Chalk"},"cat-symbols-strong":{1:["#d92b30"],2:["#d92b30","#ffdf3c"],3:["#d92b30","#3cccb4","#ffdf3c"],4:["#d92b30","#3cccb4","#ffdf3c","#f260a1"],5:["#d92b30","#3cccb4","#ffdf3c","#c27c30","#f260a1"],6:["#d92b30","#0095ba","#3cccb4","#ffdf3c","#c27c30","#f260a1"],7:["#d92b30","#0095ba","#3cccb4","#ab52b3","#ffdf3c","#c27c30","#f260a1"],8:["#d92b30","#0095ba","#3cccb4","#ab52b3","#ffdf3c","#c27c30","#a0d17d","#f260a1"],9:["#d92b30","#0095ba","#3cccb4","#ab52b3","#ffdf3c","#eb82eb","#c27c30","#a0d17d","#f260a1"],10:["#d92b30","#0095ba","#3cccb4","#ab52b3","#ffb259","#ffdf3c","#eb82eb","#c27c30","#a0d17d","#f260a1"],stops:["#d92b30","#0095ba","#3cccb4","#ab52b3","#ffb259","#ffdf3c","#eb82eb","#c27c30","#a0d17d","#f260a1"],tags:["light","categorical","colorblind-friendly"],name:"Circling Circus"},"cat-symbols-autumnal":{1:["#3e756d"],2:["#3e756d","#d9d78c"],3:["#3e756d","#d9d78c","#b86b53"],4:["#3e756d","#d9d78c","#b86b53","#5c98ca"],5:["#3e756d","#d9d78c","#b86b53","#5c98ca","#9c5596"],6:["#3e756d","#d9d78c","#b86b53","#5c98ca","#86afb3","#9c5596"],7:["#3e756d","#d9d78c","#b86b53","#73241f","#5c98ca","#86afb3","#9c5596"],8:["#3e756d","#d9d78c","#b86b53","#73241f","#5c98ca","#86afb3","#44498b","#9c5596"],9:["#3e756d","#d9d78c","#b86b53","#73241f","#5c98ca","#86afb3","#ad9d63","#44498b","#9c5596"],10:["#3e756d","#d9d78c","#b86b53","#73241f","#b0bfa2","#5c98ca","#86afb3","#ad9d63","#44498b","#9c5596"],stops:["#3e756d","#d9d78c","#b86b53","#73241f","#b0bfa2","#5c98ca","#86afb3","#ad9d63","#44498b","#9c5596"],tags:["light","categorical","colorblind-friendly"],name:"Falling Leaves"},"cat-symbols-bright":{1:["#f22f00"],2:["#f22f00","#ffdd00"],3:["#f22f00","#26ffff","#ffdd00"],4:["#f22f00","#26ffff","#ffdd00","#5ff500"],5:["#f22f00","#26ffff","#ffdd00","#5ff500","#0040ff"],6:["#f22f00","#26ffff","#ffdd00","#ff4dc4","#5ff500","#0040ff"],7:["#f22f00","#26ffff","#d99800","#ffdd00","#ff4dc4","#5ff500","#0040ff"],8:["#f22f00","#26ffff","#a040ff","#d99800","#ffdd00","#ff4dc4","#5ff500","#0040ff"],9:["#f22f00","#ffff80","#26ffff","#a040ff","#d99800","#ffdd00","#ff4dc4","#5ff500","#0040ff"],10:["#f22f00","#ffff80","#26ffff","#a040ff","#d99800","#c0ff73","#ffdd00","#ff4dc4","#5ff500","#0040ff"],stops:["#f22f00","#ffff80","#26ffff","#a040ff","#d99800","#c0ff73","#ffdd00","#ff4dc4","#5ff500","#0040ff"],tags:["light","categorical","colorblind-friendly"],name:"High Light"},"cat-symbols-midrange":{1:["#e65154"],2:["#e65154","#ff8cd9"],3:["#e65154","#67e6d1","#ff8cd9"],4:["#e65154","#67e6d1","#ff8cd9","#c8f2a9"],5:["#e65154","#67e6d1","#ff8cd9","#c8f2a9","#d4b8ff"],6:["#e65154","#67e6d1","#ff8cd9","#d99d5b","#c8f2a9","#d4b8ff"],7:["#e65154","#67e6d1","#ffca8c","#ff8cd9","#d99d5b","#c8f2a9","#d4b8ff"],8:["#e65154","#67e6d1","#cd76d6","#ffca8c","#ff8cd9","#d99d5b","#c8f2a9","#d4b8ff"],9:["#e65154","#26b6ff","#67e6d1","#cd76d6","#ffca8c","#ff8cd9","#d99d5b","#c8f2a9","#d4b8ff"],10:["#e65154","#26b6ff","#67e6d1","#cd76d6","#ffca8c","#fff2b3","#ff8cd9","#d99d5b","#c8f2a9","#d4b8ff"],stops:["#e65154","#26b6ff","#67e6d1","#cd76d6","#ffca8c","#fff2b3","#ff8cd9","#d99d5b","#c8f2a9","#d4b8ff"],tags:["light","categorical","colorblind-friendly"],name:"Beaded Pastel"},"cat-symbols-subdued":{1:["#b5d6f2"],2:["#b5d6f2","#e3a3dd"],3:["#7db3ab","#b5d6f2","#e3a3dd"],4:["#7db3ab","#b5d6f2","#bf7872","#e3a3dd"],5:["#7db3ab","#dbe6d1","#b5d6f2","#bf7872","#e3a3dd"],6:["#7db3ab","#dbe6d1","#b5d6f2","#bf7872","#9093c7","#e3a3dd"],7:["#7db3ab","#dbe6d1","#b5d6f2","#bf7872","#d1c79d","#9093c7","#e3a3dd"],8:["#7db3ab","#dbe6d1","#b5d6f2","#f2f1c2","#bf7872","#d1c79d","#9093c7","#e3a3dd"],9:["#7db3ab","#dbe6d1","#d6a394","#b5d6f2","#f2f1c2","#bf7872","#d1c79d","#9093c7","#e3a3dd"],10:["#7db3ab","#dbe6d1","#d6a394","#c8e0e3","#b5d6f2","#f2f1c2","#bf7872","#d1c79d","#9093c7","#e3a3dd"],stops:["#7db3ab","#dbe6d1","#d6a394","#c8e0e3","#b5d6f2","#f2f1c2","#bf7872","#d1c79d","#9093c7","#e3a3dd"],tags:["light","categorical","colorblind-friendly"],name:"Chamois"},"cat-symbols-pastel":{1:["#ffe3d6"],2:["#ffe3d6","#e8add4"],3:["#b8f5e7","#ffe3d6","#e8add4"],4:["#e0c9af","#b8f5e7","#ffe3d6","#e8add4"],5:["#e0c9af","#b8f5e7","#e0ccff","#ffe3d6","#e8add4"],6:["#e0c9af","#b8f5e7","#e0ccff","#ffe3d6","#e8add4","#7dbdfa"],7:["#e0c9af","#b8f5e7","#e0ccff","#ffe3d6","#e8add4","#bac29c","#7dbdfa"],8:["#e0c9af","#b8f5e7","#e0ccff","#ffe3d6","#e8add4","#bac29c","#7dbdfa","#fff6cc"],9:["#e0c9af","#b8f5e7","#e0ccff","#ffe3d6","#e8add4","#bac29c","#7dbdfa","#fff6cc","#e88b9b"],10:["#9f8eed","#e0c9af","#b8f5e7","#e0ccff","#ffe3d6","#e8add4","#bac29c","#7dbdfa","#fff6cc","#e88b9b"],stops:["#9f8eed","#e0c9af","#b8f5e7","#e0ccff","#ffe3d6","#e8add4","#bac29c","#7dbdfa","#fff6cc","#e88b9b"],tags:["light","categorical","colorblind-friendly"],name:"Low Satch"},"cat-symbols-red":{1:["#ffbfc9"],2:["#ffbfc9","#ffb180"],3:["#ffbfc9","#ffb180","#ff6e9d"],4:["#de2c30","#ffb180","#c74f8c","#ff6e9d"],5:["#de2c30","#ffb180","#c74f8c","#ffdaa6","#ff6e9d"],6:["#e6772e","#de2c30","#ffb180","#c74f8c","#ffdaa6","#ff6e9d"],7:["#e6772e","#de2c30","#ffb180","#c74f8c","#ff9e9e","#ffdaa6","#ff6e9d"],8:["#99004d","#e6772e","#ffbfc9","#ffb180","#c74f8c","#ff9e9e","#ffdaa6","#ff6e9d"],9:["#99004d","#e6772e","#ffbfc9","#de2c30","#ffb180","#c74f8c","#ff9e9e","#ffdaa6","#ff6e9d"],10:["#99004d","#e6772e","#ffbfc9","#de2c30","#ffb180","#fa8870","#c74f8c","#ff9e9e","#ffdaa6","#ff6e9d"],stops:["#99004d","#e6772e","#ffbfc9","#de2c30","#ffb180","#fa8870","#c74f8c","#ff9e9e","#ffdaa6","#ff6e9d"],tags:["light","categorical","reds","yellows","colorblind-friendly"],name:"Blushing Rose"},"cat-symbols-blue":{1:["#61dbf2"],2:["#bfc5ff","#61dbf2"],3:["#bfc5ff","#61dbf2","#0095e0"],4:["#bfc5ff","#6b78ff","#61dbf2","#0095e0"],5:["#0066cc","#bfc5ff","#6b78ff","#61dbf2","#0095e0"],6:["#0066cc","#599eff","#bfc5ff","#6b78ff","#61dbf2","#0095e0"],7:["#0066cc","#599eff","#bfc5ff","#6b78ff","#bfefff","#61dbf2","#0095e0"],8:["#0066cc","#599eff","#bfc5ff","#6b78ff","#bfefff","#0d71ff","#61dbf2","#0095e0"],9:["#0066cc","#599eff","#bfc5ff","#6b78ff","#bfefff","#0d71ff","#61dbf2","#3b2fbf","#0095e0"],10:["#0066cc","#599eff","#bfc5ff","#6b78ff","#bfefff","#0d71ff","#61dbf2","#6bb5ff","#3b2fbf","#0095e0"],stops:["#0066cc","#599eff","#bfc5ff","#6b78ff","#bfefff","#0d71ff","#61dbf2","#6bb5ff","#3b2fbf","#0095e0"],tags:["light","categorical","blues","colorblind-friendly"],name:"Tidal Crest"},"cat-symbols-green":{1:["#78ede4"],2:["#78ede4","#a3f9a0"],3:["#78ede4","#a3f9a0","#00bfaf"],4:["#008c5e","#52cc52","#a3f9a0","#00bfaf"],5:["#008c5e","#75de43","#52cc52","#a3f9a0","#00bfaf"],6:["#008c5e","#75de43","#52cc52","#54994d","#a3f9a0","#00bfaf"],7:["#008c5e","#75de43","#52cc52","#54994d","#a3f9a0","#70e0bb","#00bfaf"],8:["#008c5e","#75de43","#78ede4","#54994d","#a3f9a0","#70e0bb","#007300","#00bfaf"],9:["#008c5e","#75de43","#78ede4","#52cc52","#54994d","#a3f9a0","#70e0bb","#007300","#00bfaf"],10:["#008c5e","#75de43","#78ede4","#52cc52","#ccffb3","#54994d","#a3f9a0","#70e0bb","#007300","#00bfaf"],stops:["#008c5e","#75de43","#78ede4","#52cc52","#ccffb3","#54994d","#a3f9a0","#70e0bb","#007300","#00bfaf"],tags:["light","categorical","greens","colorblind-friendly"],name:"Fresh Stems"},"cat-symbols-gray":{1:["#e6dada"],2:["#e6dada","#b4c9d2"],3:["#e6dada","#b4c9d2","#738491"],4:["#5d5d50","#9a9a91","#b4c9d2","#738491"],5:["#5d5d50","#afbaaf","#9a9a91","#b4c9d2","#738491"],6:["#5d5d50","#afbaaf","#9a9a91","#856b6b","#b4c9d2","#738491"],7:["#5d5d50","#afbaaf","#9a9a91","#856b6b","#b4c9d2","#b4a5ac","#738491"],8:["#5d5d50","#afbaaf","#e6dada","#856b6b","#b4c9d2","#b4a5ac","#335766","#738491"],9:["#5d5d50","#afbaaf","#e6dada","#9a9a91","#856b6b","#b4c9d2","#b4a5ac","#335766","#738491"],10:["#5d5d50","#afbaaf","#e6dada","#9a9a91","#e7e7d2","#856b6b","#b4c9d2","#b4a5ac","#335766","#738491"],stops:["#5d5d50","#afbaaf","#e6dada","#9a9a91","#e7e7d2","#856b6b","#b4c9d2","#b4a5ac","#335766","#738491"],tags:["light","categorical","grays","colorblind-friendly"],name:"Stone and Gravel"},"relationship-brewer-yellow-blue-black":{2:[["#f3b300","#000000"],["#f3f3f3","#509dc2"]],3:[["#f3b300","#7a5a00","#000000"],["#f3d37a","#8e916e","#284f61"],["#e8e6f2","#a2c8db","#509dc2"]],4:[["#f3b300","#a27700","#513c00","#000000"],["#f3c851","#ab974c","#636546","#1b3441"],["#f3dea2","#b4b797","#74908c","#356981"],["#f3f3f3","#bdd6e3","#86bad2","#509dc2"]],tags:["colorblind-friendly","relationship","light"],name:"Sunflower Skies"},"relationship-brewer-pink-blue-purple":{2:[["#de4fa6","#2a1a8a"],["#e8e6f2","#4fadd0"]],3:[["#de4fa6","#843598","#2a1a8a"],["#e39bcc","#9080bd","#3d64ad"],["#e9e6f2","#9ccae1","#4fadd0"]],4:[["#de4fa6","#a23d9d","#662c93","#2a1a8a"],["#e181bf","#a86fb5","#6f5dab","#364ba1"],["#e5b4d9","#afa1ce","#798fc4","#437cb9"],["#e8e6f2","#b5d3e7","#82c0db","#4fadd0"]],tags:["light","relationship","light"],name:"Blueberry Parfait"},"relationship-brewer-orange-pink-purple-green":{2:[["#f0008b","#5a4da4"],["#f37300","#008837"]],3:[["#f0008b","#cd9acc","#5a4da4"],["#fe9aa6","#e6e6e6","#9ac9d5"],["#f37300","#cce88b","#008837"]],4:[["#f0008b","#e67fe6","#bb7fe6","#5a4da4"],["#e67fb6","#ffd9f4","#ddd9ff","#8aade6"],["#f29a92","#ffe8d9","#d9ffe6","#6cd9d2"],["#f37300","#e6c97e","#96e67e","#008837"]],tags:["colorblind-friendly","relationship","light"],name:"Unicorn Wishes"},"relationship-brewer-purple-orange":{2:[["#240d5e","#b30000"],["#c4b3d8","#ffcc80"]],3:[["#240d5e","#7f7f7f","#b30000"],["#7c67ab","#bfbfbf","#f35926"],["#c4b3d8","#e6e6e6","#ffcc80"]],4:[["#240d5e","#72668f","#b96060","#b30000"],["#594487","#988db0","#d08e84","#cc442b"],["#8f7caf","#bfb3d1","#e8bda8","#e68855"],["#c4b3d8","#e5daf2","#ffebcc","#ffcc80"]],tags:["colorblind-friendly","relationship","light"],name:"Lava Flows"},"relationship-blue-orange-brown":{2:[["#07a9d0","#705a50"],["#f3d8cb","#ea7f45"]],3:[["#00afe7","#427a8e","#5c473d"],["#98cfe5","#af978b","#aa5f37"],["#ffefe2","#ffb286","#f97529"]],4:[["#00b1f3","#0089af","#46636f","#533e34"],["#4ccaf2","#82a0ad","#8f786c","#8b4f30"],["#c3e2f0","#d0b7ab","#d08c69","#c56027"],["#fffaed","#ffcda7","#ff9f63","#ff6f16"]],tags:["colorblind-friendly","relationship","light"],name:"Fish Scales"},"relationship-purple-green-blue":{2:[["#c47add","#5064a0"],["#f2f2f2","#a9bf39"]],3:[["#c47add","#7b72ab","#5064a0"],["#dbb6e8","#ad9d91","#7d926d"],["#f2f2f2","#ced996","#a9bf39"]],4:[["#c47add","#917abf","#7b72ab","#5064a0"],["#d3a2e4","#a79abc","#918a91","#6e827e"],["#e3caeb","#c2bebe","#a8ad7b","#8ba15b"],["#f2f2f2","#dce1c0","#c1c989","#a9bf39"]],tags:["colorblind-friendly","relationship","light"],name:"Grapes on Vines"},"relationship-blue-green-purple":{2:[["#66b0ff","#79379c"],["#efffe3","#9ebf39"]],3:[["#66b0ff","#7364aa","#79379c"],["#abd8f1","#8ea09c","#7a7a4c"],["#efffe3","#c7df8e","#9ebf39"]],4:[["#66b0ff","#7388c8","#7364aa","#79379c"],["#94caf6","#93a9be","#8a8997","#85697b"],["#c1e5ec","#b4c9b4","#a2af85","#929268"],["#efffe3","#d4eaaa","#b9d472","#9ebf39"]],tags:["colorblind-friendly","relationship","light"],name:"Forest Canopy"},"relationship-blue-orange-green":{2:[["#66bfff","#066b2d"],["#f2f2f2","#f09900"]],3:[["#66bfff","#398273","#066b2d"],["#acd9f9","#a1ac9c","#7d7755"],["#f2f2f2","#e7c696","#f09900"]],4:[["#66bfff","#599bab","#398273","#066b2d"],["#95d0fb","#8caea8","#769468","#59782f"],["#c3e1f6","#bec1a4","#b4a55c","#9c8a2d"],["#f2f2f2","#f1d4a1","#f1b751","#f09900"]],tags:["colorblind-friendly","relationship","light"],name:"Backyard Garden"},"relationship-mustard-blue-wine":{2:[["#f0d200","#8c0b00"],["#faffe3","#64c8ff"]],3:[["#f0d200","#9e5114","#8c0b00"],["#eff279","#aaafa0","#627b94"],["#faffe3","#afe4f1","#64c8ff"]],4:[["#f0d200","#bd9024","#9e5114","#8c0b00"],["#f5e052","#bfac6a","#9a7d61","#80565f"],["#f1e7a1","#c1c8b0","#97aaae","#7789a2"],["#faffe3","#c3e4f6","#93d6fb","#64c8ff"]],tags:["colorblind-friendly","relationship","light"],name:"Campfire Flames"},"relationship-pink-blue-purple":{2:[["#ff7373","#593fb3"],["#f2f2f2","#62e7f5"]],3:[["#ff7373","#945c90","#593fb3"],["#f9b8b8","#a699d4","#5593d4"],["#f2f2f2","#a3ecf4","#62e7f5"]],4:[["#ff7373","#bf6989","#945c90","#593fb3"],["#fb9d9d","#bb97ac","#938cb1","#6077bf"],["#f6c8c8","#c1c2d0","#93bbd3","#73afd3"],["#f2f2f2","#c2eef3","#92ebf4","#62e7f5"]],tags:["colorblind-friendly","relationship","light"],name:"Cottoncandy Wisps"},"relationship-olive-blue-green":{2:[["#d1d100","#066b2d"],["#faffe3","#50aaff"]],3:[["#d1d100","#4f852c","#066b2d"],["#e8eb75","#aab4a0","#608f94"],["#faffe3","#b1dbf5","#50aaff"]],4:[["#d1d100","#8aa32e","#4f852c","#066b2d"],["#dfe04c","#9ebb6e","#629b6f","#367a71"],["#ecf097","#b0cfad","#76b0b3","#5293ab"],["#faffe3","#c1e3ec","#89c6f6","#50aaff"]],tags:["colorblind-friendly","relationship","light"],name:"Jungle Adventure"},"relationship-yellow-cyan-blue":{2:[["#ffeb00","#007bcc"],["#faffe3","#00e6e6"]],3:[["#ffeb00","#63a18e","#007bcc"],["#fffbb3","#9dbdcc","#5dadbf"],["#faffe3","#a6fff5","#00e6e6"]],4:[["#ffeb00","#aabf5e","#63a18e","#007bcc"],["#fff44d","#a9d28b","#5ebbab","#289fc8"],["#fffca6","#a8e4b7","#58d4c8","#30c2d6"],["#faffe3","#a7f7e4","#53eee5","#00e6e6"]],tags:["colorblind-friendly","relationship","light"],name:"Mountain Trails"},"relationship-blue-pink-purple":{2:[["#57a5d9","#631673"],["#ece6f2","#cc5a5a"]],3:[["#5ea5d8","#624d8a","#621371"],["#a5c6e5","#9e799b","#963567"],["#ece6f2","#daa5ac","#c9585c"]],4:[["#57a5d9","#6175a7","#624e8c","#631673"],["#89bbe1","#8c8baf","#89628c","#7f3c6b"],["#bad0ea","#b6a1b7","#b0758d","#974a62"],["#ece6f2","#e1b7bf","#d7898d","#cc5a5a"]],tags:["colorblind-friendly","relationship","light"],name:"Dawn Rising"},"relationship-purple-green-wine":{2:[["#ad77d9","#7a0a00"],["#ece6f2","#9cbf57"]],3:[["#ad77d9","#7a4873","#7a0a00"],["#cdafe6","#a59b98","#6e6548"],["#ece6f2","#c4d3a5","#9cbf57"]],4:[["#ad77d9","#9460a6","#7a4873","#7a0a00"],["#c29ce1","#a888ae","#8e747b","#7a613c"],["#d7c1ea","#bdb1b6","#a3a083","#8a834c"],["#ece6f2","#d1d9be","#b7cc8b","#9cbf57"]],tags:["colorblind-friendly","relationship","light"],name:"Wine Tasting"},"relationship-blue-red-pink":{2:[["#4d79ff","#ebccff"],["#333380","#c03050"]],3:[["#4d79ff","#9ca3ff","#ebccff"],["#4056c0","#8b7bc0","#d57ea8"],["#333380","#803a6e","#c03050"]],4:[["#4d79ff","#8395ff","#b8b0ff","#ebccff"],["#4462d5","#7773cc","#aa83c9","#df98c5"],["#3c4aaa","#6d539e","#9d5a93","#cf648a"],["#333380","#623270","#913160","#c03050"]],tags:["colorblind-friendly","relationship","dark"],name:"Sunset Smudge"},"relationship-blue-green-brightgreen":{2:[["#0d6eff","#73FF73"],["#004d54","#6fa600"]],3:[["#0d6eff","#3691b3","#73ff73"],["#134da2","#35798c","#6dd33a"],["#004d54","#397027","#6FA600"]],4:[["#0d6eff","#2e90d6","#35c4ac","#73ff73"],["#0662c4","#2c85a0","#3baa94","#76de4e"],["#035a8f","#2a7b6b","#459e5a","#71cc1F"],["#004d54","#287035","#468b1b","#6fa600"]],tags:["colorblind-friendly","relationship","dark"],name:"Aurora Borealis"},"relationship-blue-orange-lavender":{2:[["#0066ff","#cfbfff"],["#241159","#ab5600"]],3:[["#0066ff","#6893ff","#cfbfff"],["#0f3699","#7a6896","#bd8b80"],["#241159","#612d19","#ab5600"]],4:[["#0066ff","#4584ff","#8aa1ff","#cfbfff"],["#0c4ac8","#3e69b8","#9685b4","#c39caa"],["#182d90","#5d4b78","#8a6273","#b77955"],["#241159","#51283b","#7e3f1e","#ab5600"]],tags:["colorblind-friendly","relationship","dark"],name:"Soft Leather"},"relationship-pink-purple-peach":{2:[["#bf1d4e","#ebbebe"],["#47002f","#7040ff"]],3:[["#bf1d4e","#d56e86","#ebbebe"],["#831427","#8c4885","#a979df"],["#47002f","#531a80","#7040ff"]],4:[["#bf1d4e","#ce5373","#dc8899","#ebbebe"],["#97183e","#a22572","#c25aa8","#bf90d4"],["#6f122d","#812677","#923faf","#9261e9"],["#47002f","#5e136d","#6223b6","#7040ff"]],tags:["colorblind-friendly","relationship","dark"],name:"Rose Petals"},"relationship-purple-mustard-eggshell":{2:[["#8251e6","#ffe6c2"],["#4d3147","#b39e12"]],3:[["#8251e6","#ba97d4","#ffe6c2"],["#6e4c97","#96847d","#d3bd6a"],["#4d3147","#776525","#b39e12"]],4:[["#8251e6","#a77fda","#cdaece","#ffe6c2"],["#7046b1","#8870a0","#b793b1","#ddc787"],["#5f3c7c","#7a6172","#a18a59","#C8B300"],["#4d3147","#63522b","#8b781f","#b39e12"]],tags:["colorblind-friendly","relationship","dark"],name:"Seasonal Eggplant"},"relationship-blue-brick-green":{2:[["#0080ad","#d4ff99"],["#4c2f54","#ab4211"]],3:[["#0080ad","#7ebd99","#d4ff99"],["#345070","#806d7c","#c09b4d"],["#4c2f54","#7b332a","#ab4211"]],4:[["#0080ad","#61a799","#9ad399","#d4ff99"],["#1f5f86","#5e8485","#96a17b","#e3af44"],["#3d3e5e","#6b4b65","#8f694a","#c7803c"],["#4c2f54","#6c353e","#8b3c27","#ab4211"]],tags:["colorblind-friendly","relationship","dark"],name:"Seventies Poncho"},"relationship-orange-purple-lavender":{2:[["#bf4343","#e6b3ff"],["#542d3d","#7e39a1"]],3:[["#bf4343","#d97ba1","#e6b3ff"],["#803a1c","#8c5d86","#b876d0"],["#542d3d","#69336f","#7e39a1"]],4:[["#bf4343","#cc6882","#d98ec0","#e6b3ff"],["#9b3c41","#a6465e","#ad7199","#cf89dd"],["#78343f","#874368","#955192","#a460bb"],["#542d3d","#61305d","#6f347d","#7e39a1"]],tags:["colorblind-friendly","relationship","dark"],name:"Violet Delights"},"relationship-brown-purple-lilac":{2:[["#bf9b5e","#ffccee"],["#4a3449","#67679e"]],3:[["#bf9b5e","#d9afa4","#ffccee"],["#7b6654","#896f8c","#b298c2"],["#4a3449","#594c7e","#67679e"]],4:[["#bf9b5e","#d4ab8e","#e8bbbe","#ffccee"],["#947857","#a98980","#ba99aa","#d2afd9"],["#69554f","#7f6773","#8b7896","#9a89b9"],["#4a3449","#574769","#5d5682","#67679e"]],tags:["colorblind-friendly","relationship","dark"],name:"Winter Canyon"},"relationship-teal-yellow-lightteal":{2:[["#00b3ff","#c0ffb3"],["#286652","#b5b800"]],3:[["#00b3ff","#5ce3d3","#c0ffb3"],["#008c8c","#57ad56","#c1d94f"],["#286652","#6F820D","#b5b800"]],4:[["#00b3ff","#3dcce2","#7ae6c5","#c0ffb3"],["#0d99c5","#3cb5aa","#87cc8b","#b6e770"],["#1b808c","#58996f","#79b655","#b6d038"],["#286652","#578137","#869d1b","#b5b800"]],tags:["colorblind-friendly","relationship","dark"],name:"Persian Lime"},"relationship-blue-red-yellow":{2:[["#195DFC","#FEFF80"],["#402447","#C82920"]],3:[["#195DFC","#8CA5BE","#FEFF80"],["#272E99","#8140A4","#E58100"],["#402447","#8A0017","#C82920"]],4:[["#195DFC","#6593d3","#a9c9ae","#FEFF80"],["#264ac0","#5951bf","#a0828a","#ecb860"],["#353987","#5e406b","#993e71","#da7040"],["#402447","#692438","#9b272d","#C82920"]],tags:["colorblind-friendly","relationship","dark"],name:"Summer Picnic"},"relationship-blue-rose-peach":{2:[["#66c0ff","#ff8080"],["#004473","#852828"]],3:[["#66c0ff","#7b6586","#ff8080"],["#3382b9","#644d70","#c25454"],["#004473","#4d3559","#852828"]],4:[["#66c0ff","#5d6fa6","#995b65","#ff8080"],["#4497d0","#505e8c","#7B4B50","#d66363"],["#226da2","#424c73","#5e3b40","#ae4545"],["#004473","#353b59","#452e31","#852828"]],tags:["colorblind-friendly","relationship","dark"],name:"Coral Reef"},"relationship-pink-lilac-blue":{2:[["#ffa5ba","#66ffff"],["#ffff80","#aa99ff"]],3:[["#ffa5ba","#71818c","#66ffff"],["#b35a5a","#5b4666","#7070cc"],["#ffff80","#8c7f54","#aa99ff"]],4:[["#ffa5ba","#906499","#738999","#66ffff"],["#994d65","#663344","#38428c","#5c5ce6"],["#a66153","#4d3d27","#3b2e73","#8767e6"],["#ffff80","#807d53","#6f6264","#aa99ff"]],tags:["colorblind-friendly","relationship","dark"],name:"Spring Showers"},"relationship-blue-peach-purple":{2:[["#198dff","#590059"],["#e6e6c3","#b35a5a"]],3:[["#198dff","#4a51ba","#590059"],["#86c0e1","#6674ad","#8d2d60"],["#e6e6c3","#d3a68e","#b35a5a"]],4:[["#198dff","#3a60d5","#5730a6","#590059"],["#66b3e3","#6d82d9","#6d4b94","#8f1954"],["#b2d9c6","#99a2ba","#a4707d","#a33a59"],["#e6e6c3","#e6c8a1","#cc9191","#b35a5a"]],tags:["colorblind-friendly","relationship","light"],name:"Cosmic Symphony"},"relationship-mint-mustard-green":{2:[["#00aacc","#00594a"],["#ffffaa","#e69a00"]],3:[["#00aacc","#00828b","#00594a"],["#80d4bb","#80ac7a","#737a25"],["#ffffaa","#f3cd55","#e69a00"]],4:[["#00aacc","#008fa1","#007475","#00594a"],["#55c6c1","#52a889","#508a51","#596f00"],["#aae3b5","#aac88a","#9fa345","#a08400"],["#ffffaa","#f7dd71","#eebc39","#e69a00"]],tags:["colorblind-friendly","relationship","light"],name:"Mustard Grove"},"relationship-purple-mustard-darkpurple":{2:[["#aa4ed9","#66004d"],["#f2ceda","#ccaa00"]],3:[["#aa4ed9","#8e2999","#66004d"],["#ce8eda","#bb7c6d","#995527"],["#f2ceda","#e4bb80","#ccaa00"]],4:[["#aa4ed9","#9334aa","#7d1a7c","#66004d"],["#bf75dd","#b063a5","#9d4f6c","#883933"],["#d9a2dc","#d296a7","#c18660","#aa711a"],["#f2ceda","#f0c4aa","#e5bd55","#ccaa00"]],tags:["colorblind-friendly","relationship","light"],name:"Morning Amethyst"},"relationship-blue-orange-purple":{2:[["#6b9bb3","#600080"],["#d2edc9","#cca352"]],3:[["#6b9bb3","#6e54a6","#600080"],["#9ccdc0","#9c9f83","#965269"],["#d2edc9","#ccd18f","#cca352"]],4:[["#6b9bb3","#6767a2","#643491","#600080"],["#8bbcbb","#898fa2","#86638a","#843671"],["#acdec4","#abb8a3","#a99382","#a86d61"],["#d2edc9","#cce0a3","#ccc27b","#cca352"]],tags:["colorblind-friendly","relationship","light"],name:"Marine Heliotrope"},"relationship-pink-periwinkle-violet":{2:[["#ff5c5c","#7a0050"],["#f2dcee","#809dff"]],3:[["#ff5c5c","#c73c63","#7a0050"],["#f99ca5","#c67a92","#885ab3"],["#f2dcee","#b9bdf7","#809dff"]],4:[["#ff5c5c","#d04559","#a22e4b","#7a0050"],["#fb878d","#cf708d","#a35a85","#77448d"],["#f6b1bd","#cd9cc0","#a586bf","#7c70c6"],["#f2dcee","#ccc7f4","#a6b2f9","#809dff"]],tags:["colorblind-friendly","relationship","light"],name:"Strawberry Tulips"},"relationship-blue-tan-green":{2:[["#00a1f2","#4e592c"],["#ffffcc","#bf9357"]],3:[["#00a1f2","#277d8f","#4e592c"],["#80d0df","#7ca199","#817e5c"],["#ffffcc","#dfc992","#bf9357"]],4:[["#00a1f2","#1a89b0","#34716e","#4e592c"],["#55c0e5","#5fa4ac","#698873","#746c3a"],["#aae0d9","#a5c0a9","#9fa079","#998049"],["#ffffcc","#eadba5","#d4b77e","#bf9357"]],tags:["colorblind-friendly","relationship","light"],name:"Coconut Palms"},"relationship-purple-green-olive":{2:[["#731773","#595900"],["#de9bde","#bfbf73"]],3:[["#731773","#b1767a","#595900"],["#b94cb9","#d899ac","#9e9f36"],["#de9bde","#f2beb5","#bfbf73"]],4:[["#731773","#b35d8a","#b38f6b","#595900"],["#a23aa2","#cc7ea7","#ccab80","#88881b"],["#d05dd0","#e69ec4","#e6c694","#a5a638"],["#de9bde","#ffbfe1","#ffe2a9","#bfbf73"]],tags:["colorblind-friendly","relationship","light"],name:"Blooming Lilypad"},election:{11:["#086ca0","#2668a0","#4364a1","#6160a1","#7e5ca2","#9c58a2","#a44d8b","#ac4274","#b5385d","#bd2d46","#c5222f"],stops:["#086ca0","#2668a0","#4364a1","#6160a1","#7e5ca2","#9c58a2","#a44d8b","#ac4274","#b5385d","#bd2d46","#c5222f"],tags:["group-similar","colorblind-friendly"],name:"Group Similar 1"},temperature:{12:["#000068","#333399","#756db5","#9a93ca","#c6c3e2","#e7e6f2","#fdece3","#fdd2bf","#faa98b","#f68460","#f23d2f","#c60000"],stops:["#000068","#333399","#756db5","#9a93ca","#c6c3e2","#e7e6f2","#fdece3","#fdd2bf","#faa98b","#f68460","#f23d2f","#c60000"],tags:["group-similar","colorblind-friendly"],name:"Group Similar 2"},"elevation-warm-humid":{11:["#6c9a87","#77ad95","#86b89d","#a9c0a7","#d5c9b6","#d4b8a4","#d4c1b4","#d4cecc","#dcdddd","#ebebeb","#f5f5f5"],stops:["#6c9a87","#77ad95","#86b89d","#a9c0a7","#d5c9b6","#d4b8a4","#d4c1b4","#d4cecc","#dcdddd","#ebebeb","#f5f5f5"],tags:["group-similar"],name:"Group Similar 3"},"elevation-cool-humid":{11:["#72958e","#82a5a0","#91b2ac","#b4bfb5","#d5c9b6","#d4b8a4","#d4c1b4","#d4cecc","#dcdddd","#ebebeb","#f5f5f5"],stops:["#72958e","#82a5a0","#91b2ac","#b4bfb5","#d5c9b6","#d4b8a4","#d4c1b4","#d4cecc","#dcdddd","#ebebeb","#f5f5f5"],tags:["group-similar"],name:"Group Similar 4"},"elevation-arid":{11:["#938b83","#a99f94","#b4aa9e","#cabead","#d5c9b6","#d4b8a4","#d4c1b4","#d4cecc","#dcdddd","#ebebeb","#f5f5f5"],stops:["#938b83","#a99f94","#b4aa9e","#cabead","#d5c9b6","#d4b8a4","#d4c1b4","#d4cecc","#dcdddd","#ebebeb","#f5f5f5"],tags:["group-similar"],name:"Group Similar 5"},"elevation-polar":{8:["#94a9c0","#a3b4cb","#abc0d5","#b8c9e0","#cad6e8","#dbe1f0","#edf2fb","#eff3fb"],stops:["#94a9c0","#a3b4cb","#abc0d5","#b8c9e0","#cad6e8","#dbe1f0","#edf2fb","#eff3fb"],tags:["group-similar"],name:"Group Similar 6"},precipitation:{17:["#f11714","#f88c51","#fcb16b","#fec784","#ffe6b6","#e7f0c0","#cfe5ac","#b6db98","#9ed187","#85c860","#6ec13a","#13b445","#00a64b","#9089c4","#756db5","#625cab","#2d2b94"],stops:["#f11714","#f88c51","#fcb16b","#fec784","#ffe6b6","#e7f0c0","#cfe5ac","#b6db98","#9ed187","#85c860","#6ec13a","#13b445","#00a64b","#9089c4","#756db5","#625cab","#2d2b94"],tags:["group-similar"],name:"Group Similar 7"},spectral:{6:["#b8529e","#3853a3","#6fcbdc","#69bc45","#f6eb0f","#ec1e24"],stops:["#b8529e","#3853a3","#6fcbdc","#69bc45","#f6eb0f","#ec1e24"],tags:["group-similar","colorblind-friendly"],name:"Group Similar 8"},bathymetry:{14:["#e9f5ff","#d4eaf8","#bfdff2","#abd5ec","#96cae5","#81bfdf","#6cb4d8","#5ca0ca","#4c8dbc","#3d79ae","#2d65a0","#1d5292","#0d3e84","#08306b"],stops:["#e9f5ff","#d4eaf8","#bfdff2","#abd5ec","#96cae5","#81bfdf","#6cb4d8","#5ca0ca","#4c8dbc","#3d79ae","#2d65a0","#1d5292","#0d3e84","#08306b"],tags:["group-similar","colorblind-friendly"],name:"Group Similar 9"},"cat-dark-6":{6:["#ed5151","#149ece","#a7c636","#9e559c","#fc921f","#ffde3e"],stops:["#ed5151","#149ece","#a7c636","#9e559c","#fc921f","#ffde3e"],tags:["dark"],name:"Candy Shop"},"cat-light-6":{6:["#fd7f6f","#7eb0d5","#b2e061","#bd7ebe","#ffb55a","#ffee65"],stops:["#fd7f6f","#7eb0d5","#b2e061","#bd7ebe","#ffb55a","#ffee65"],tags:["light"],name:"Watercolor Surprise"},"point-cloud-class-scheme":{stops:["rgb(178, 178, 178)","rgb(178, 178, 178)","rgb(168, 112, 0)","rgb(38, 115, 0)","rgb(76, 230, 0)","rgb(205, 245, 122)","rgb(230, 75, 65)","rgb(230, 0, 0)","rgb(168, 112, 0)","rgb(0, 92, 230)","rgb(132, 0, 168)","rgb(78, 78, 78)","rgb(197, 0, 255)","rgb(0, 77, 168)","rgb(255, 255, 115)","rgb(115, 178, 255)","rgb(225, 115, 255)","rgb(130, 130, 130)","rgb(230, 0, 0)","rgb(230, 230, 0)"],tags:["point-cloud"],name:"Point Cloud 3"},"heatmap-v1":{stops:["#85c1c8","#90a1be","#9c8184","#a761aa","#af4980","#b83055","#c0182a","#c80000","#d33300","#de6600","#e99900","#f4cc00","#ffff00"],tags:["light","dark","heatmap"],name:"Heatmap 1"},"heatmap-v2":{stops:["#f3e4e5","#e4becb","#d498b2","#c57298","#b95685","#ae3972","#a21d5e","#96004b","#ab006f","#c00093","#d500b7","#ea00db","#ff00ff"],tags:["light","colorblind-friendly","heatmap"],name:"Heatmap 2"},"heatmap-v3":{stops:["#d4e3f5","#b3c5f7","#93a6fa","#7288fc","#566ffd","#3955fe","#1d3bfe","#0022ff","#334ecc","#667a99","#99a766","#ccd333","#ffff00"],tags:["light","colorblind-friendly","heatmap"],name:"Heatmap 3"},"heatmap-v4":{stops:["#0022c8","#2b1ca7","#551785","#801164","#aa0b43","#d50621","#ff0000","#ff3900","#ff7100","#ffaa00","#ffc655","#ffe3aa","#ffffff"],tags:["dark","colorblind-friendly","heatmap"],name:"Heatmap 4"},"dark-yellow-orange":{stops:["#664c28","#795523","#8d5f1e","#a06819","#b37114","#c67a0f","#d9830a","#ec8c05","#ff9500","#ffae00","#ffc600","#ffde00","#fff700"],tags:["dark","colorblind-friendly","heatmap"],name:"Heatmap 5"},"dark-yellow-green":{stops:["#284c66","#35585b","#436550","#507145","#5d7d3a","#6f8e2c","#819e1d","#92af0f","#a4bf00","#b9cf00","#cedf00","#e2eF00","#f7ff00"],tags:["dark","colorblind-friendly","heatmap"],name:"Heatmap 6"},"dark-yellow-purple":{stops:["#3f2866","#472b77","#4e2d87","#563098","#5d32a8","#6735be","#7139d4","#7b3ce9","#853fff","#a46fbf","#c29f80","#e0cf40","#ffff00"],tags:["dark","colorblind-friendly","heatmap"],name:"Heatmap 7"},"dark-yellow-magenta":{stops:["#730073","#820082","#910091","#a000a0","#af00af","#c300c3","#d700d7","#eb00eb","#ff00ff","#ff58a0","#ff896b","#ffb935","#ffea00"],tags:["dark","colorblind-friendly","heatmap"],name:"Heatmap 8"},"dark-white-blue":{stops:["#215587","#245b91","#26629b","#2968a5","#2b6eaf","#307bc3","#3687d7","#3b94eb","#40a0ff","#6db8ff","#9bd0ff","#c8e7ff","#f5ffff"],tags:["dark","colorblind-friendly","heatmap"],name:"Heatmap 9"},"dark-white-blue-metal":{stops:["#404873","#485182","#505990","#57629f","#5f6aad","#6772bb","#6f7bca","#7683d8","#7e8be6","#9ea8ec","#bfc5f3","#dfe2f9","#ffffff"],tags:["dark","colorblind-friendly","heatmap"],name:"Heatmap 10"},"dark-white-gold":{stops:["#4d4700","#5f5700","#706700","#827700","#938700","#a59700","#b6a700","#c8b700","#d9c700","#e3d540","#ece380","#f6f1bf","#ffffff"],tags:["dark","colorblind-friendly","heatmap"],name:"Heatmap 11"},"dark-yellow-bronze":{stops:["#592d00","#68390a","#764615","#85521F","#935e29","#a16a33","#b0773e","#be8348","#cc8f52","#d9a877","#e6c19c","#f2dac1","#fff3e6"],tags:["dark","colorblind-friendly","heatmap"],name:"Heatmap 12"},"neutral-yellow-orange":{stops:["#ccbba3","#d3b68a","#d9b270","#e0ad57","#e6a852","#eca32f","#f39f1f","#f99a10","#ff9500","#ffae00","#ffc600","#ffde00","#fff700"],tags:["light","colorblind-friendly","heatmap"],name:"Heatmap 13"},"neutral-yellow-green":{stops:["#a3bccc","#a3bdb3","#a4bd99","#a4be7f","#a4be66","#a4be4d","#a4bf33","#a4bf1a","#a4bf00","#b9cf00","#cedf00","#e2ef00","#f7ff00"],tags:["light","colorblind-friendly","heatmap"],name:"Heatmap 14"},"neutral-yellow-purple":{stops:["#a297b3","#9f8cbd","#9b81c6","#9876d0","#946bd9","#9060cf","#8d55ec","#894af6","#853fff","#a46fbf","#c29f80","#e0cf40","#ffff00"],tags:["light","colorblind-friendly","heatmap"],name:"Heatmap 15"},"neutral-yellow-magenta":{stops:["#b397b3","#bd84bd","#c672c6","#d05fd0","#d94cd9","#e339e3","#ec26ec","#f613f6","#ff00ff","#ff3bbf","#ff7580","#ffb040","#ffea00"],tags:["light","colorblind-friendly","heatmap"],name:"Heatmap 16"},"neutral-white-blue":{stops:["#97a5b3","#8ca4bd","#82a4c6","#77a3d0","#6ca2d9","#61a2e3","#56a1ec","#4ba1f6","#40a0ff","#6db8ff","#9bd0ff","#c8e7ff","#f5ffff"],tags:["light","heatmap"],name:"Heatmap 17"},"neutral-white-blue-metal":{stops:["#979cb3","#949ab9","#9198c0","#8d96c6","#8a94cc","#8792d3","#8490d9","#818de0","#7e8be6","#9ea8ec","#bfc5f3","#dfe2f9","#ffffff"],tags:["light","heatmap"],name:"Heatmap 18"},"neutral-white-gold":{stops:["#b3b197","#b8b484","#bdb772","#c1b95f","#c6bc4c","#cbbf39","#d0c226","#d4c413","#d9c700","#e3d540","#ece380","#f6f1bf","#ffffff"],tags:["light","heatmap"],name:"Heatmap 19"},"neutral-yellow-bronze":{stops:["#bfb0a1","#c1ac97","#c3a88d","#c4a483","#c6a079","#c89c6f","#c99866","#cb935c","#cc8f52","#d9a877","#e6c19c","#f2dac1","#fff3e6"],tags:["light","heatmap"],name:"Heatmap 20"}};function UMt(e,t,r){let i=null,n=null;if(t&&(i=Eoe(t,e,!1),i)){const s=Soe(i);_(s)&&(n=s)}return!i&&r&&(i=r==="dark"?"dark-gray":"gray",n=r),i||n||(i="gray",n="light"),{basemapId:i,basemapTheme:n}}class BMt{constructor(t){this.name=null,this.label=null,this.description=null,this.supportedBasemaps=null,this.basemapGroups=null,this.schemes=null;const{name:r,label:i,description:n,schemes:s}=t;this.name=r,this.label=i,this.description=n,this.schemes=s;const a=t.basemapGroups||G9;let o=[];if(a)for(const l in a)o=o.concat(a[l]);this.supportedBasemaps=o,this.basemapGroups=a}isBasemapSupported(t){const r=Eoe(t,this.supportedBasemaps);return!(!r||!this.supportedBasemaps.includes(r))}getRawSchemes(t){const{basemapId:r,basemapTheme:i}=UMt(this.supportedBasemaps,t.basemap,t.basemapTheme);let n=i;if(r){const o=Soe(r,this.basemapGroups);_(o)&&(n=o)}let s=t.geometryType;s==="multipoint"?s="point":s==="mesh"&&(s="polygon");const a=this.schemes[s]||this.schemes.default;return{schemesInfo:te(a[n]),basemapId:r,basemapTheme:i}}}function GMt(e){const t=e.themeDictionary,r=new Map;for(const i in t){const n=t[i];r.set(i,new BMt(n))}return r}function jMt(e){const t=e.theme;if(t)return t.getRawSchemes({basemap:e.basemap,geometryType:e.geometryType,basemapTheme:e.basemapTheme})}const qMt=G9.light,HMt=G9.dark;[...qMt,...HMt];function WMt(e){const t=e.width,r=e.height;let i=e.pixelSizeAt(e.toMap(Su(.5*t,.5*r),{exclude:[]}));if(i<=0&&(i=e.pixelSizeAt(e.toMap(Su(.5*t,.95*r),{exclude:[]})),i<=0)){const n=e.camera.position.clone();n.z=0,i=2*e.pixelSizeAt(n)}return i}function Poe(e,t){return Math.ceil(WMt(t)*ur(Xr(e)))}const S$={light:{color:[153,153,153,.25],width:"1px"},dark:{color:[153,153,153,.25],width:"1px"},darker:{color:[26,26,26,.25],width:"1px"}},WT=["tropical-bliss","desert-blooms","under-the-sea","vibrant-rainbow","ocean-bay","prairie-summer","pastel-chalk"],XT=["predominant-v1","predominant-v2","predominant-v3","predominant-v4","predominant-v5","predominance-race","predominance-money","predominance-race-ethnic","predominance-rainbow","predominance-sequence"],YT=["cat-symbols-strong","cat-symbols-autumnal","cat-symbols-bright","cat-symbols-midrange","cat-symbols-subdued","cat-symbols-pastel","cat-symbols-red","cat-symbols-blue","cat-symbols-green","cat-symbols-gray"],ZT="#aaaaaa",XMt="12px",YMt=GMt({themeDictionary:{default:{name:"default",label:"Default",description:"Default theme for visualizing features by their type.",schemes:{point:{light:{common:{noDataColor:ZT,outline:S$.light,size:"8px"},primary:"cat-dark",secondary:["cat-light"].concat(YT).concat(WT).concat(XT)},dark:{common:{noDataColor:ZT,outline:S$.darker,size:"8px"},primary:"cat-light",secondary:["cat-dark"].concat(YT).concat(WT).concat(XT)}},polyline:{light:{common:{noDataColor:ZT,width:"2px"},primary:"cat-dark",secondary:["cat-light"].concat(YT).concat(WT).concat(XT)},dark:{common:{noDataColor:ZT,width:"2px"},primary:"cat-light",secondary:["cat-dark"].concat(YT).concat(WT).concat(XT)}},polygon:{light:{common:{noDataColor:ZT,outline:S$.light,fillOpacity:.8},primary:"cat-dark",secondary:["cat-light"].concat(YT).concat(WT).concat(XT)},dark:{common:{noDataColor:ZT,outline:S$.dark,fillOpacity:.8},primary:"cat-light",secondary:["cat-dark"].concat(YT).concat(WT).concat(XT)}}}},"point-cloud-class":{name:"point-cloud-class",label:"Point Cloud Class",description:"Default theme for visualizing point cloud data based on classification.",schemes:{point:{light:{primary:"point-cloud-class-scheme",secondary:[]},dark:{primary:"point-cloud-class-scheme",secondary:[]}}}}}});function ZMt(e){const t=e.theme||"default",r=jMt({basemap:e.basemap,geometryType:e.geometryType,basemapTheme:e.basemapTheme,theme:YMt.get(t)});if(!r)return;const{schemesInfo:i,basemapId:n,basemapTheme:s}=r,a=i.common;return{primaryScheme:X1e(e,i.primary,a),secondarySchemes:i.secondary.map(o=>X1e(e,o,a)).filter(Boolean),basemapId:n,basemapTheme:s}}function e$e(e){if(!e)return;const t={...e};return t.colors=t.colors.map(r=>new Te(r)),t.tags=[...t.tags],"noDataColor"in t&&t.noDataColor&&(t.noDataColor=new Te(t.noDataColor)),"outline"in t&&t.outline&&(t.outline={color:t.outline.color&&new Te(t.outline.color),width:t.outline.width}),t}function X1e(e,t,r){const i=e.theme||"default",n=zMt[t];if(!n)return;const s=n.stops,a=e.geometryType!=="mesh"&&e.worldScale?e.view:null;switch(e.geometryType){case"point":case"multipoint":{if(i==="point-cloud-class")return QMt({theme:i,name:n.name,tags:n.tags,colors:s});const o=r;return JMt({name:n.name,tags:n.tags,theme:i,colors:s,noDataColor:o.noDataColor,opacity:1,outline:o.outline,size:o.size},a)}case"polyline":{const o=r;return KMt({name:n.name,tags:n.tags,theme:i,colors:s,noDataColor:o.noDataColor,opacity:1,width:o.width},a)}case"polygon":{const o=r;return ePt({name:n.name,tags:n.tags,theme:i,colors:s,noDataColor:o.noDataColor,opacity:o.fillOpacity||1,outline:o.outline,size:XMt},a)}case"mesh":{const o=r;return tPt({name:n.name,tags:n.tags,theme:i,colors:s,noDataColor:o.noDataColor,opacity:o.fillOpacity||1})}default:return}}function QMt(e){return{name:e.name,tags:[...e.tags],theme:e.theme,colors:e.colors.map(t=>new Te(t))}}function JMt(e,t){return{name:e.name,tags:[...e.tags],theme:e.theme,colors:e.colors.map(r=>new Te(r)),noDataColor:new Te(e.noDataColor),outline:{color:new Te(e.outline.color),width:e.outline.width},size:t?Poe(e.size,t):e.size,opacity:e.opacity}}function KMt(e,t){return{name:e.name,tags:[...e.tags],theme:e.theme,colors:e.colors.map(r=>new Te(r)),noDataColor:new Te(e.noDataColor),width:t?Poe(e.width,t):e.width,opacity:e.opacity}}function ePt(e,t){return{name:e.name,tags:[...e.tags],theme:e.theme,colors:e.colors.map(r=>new Te(r)),noDataColor:new Te(e.noDataColor),outline:{color:new Te(e.outline.color),width:e.outline.width},opacity:e.opacity,size:t?Poe(e.size,t):e.size}}function tPt(e){return{name:e.name,tags:[...e.tags],theme:e.theme,colors:e.colors.map(t=>new Te(t)),noDataColor:new Te(e.noDataColor),opacity:e.opacity}}const rPt="date";async function iPt(e){if(!e||!e.layer||!e.field&&!e.valueExpression)throw new k("type-renderer:missing-parameters","'layer' and 'field' or 'valueExpression' parameters are required");if(e.valueExpression&&!e.view)throw new k("type-renderer:missing-parameters","View is required when 'valueExpression' is specified");const t={...e};t.symbolType=t.symbolType||"2d",t.numTypes=t.numTypes==null?10:t.numTypes,t.defaultSymbolEnabled=t.defaultSymbolEnabled==null||t.defaultSymbolEnabled,t.sortBy=t.sortBy==null?"count":t.sortBy,t.sortEnabled=t.sortEnabled==null||t.sortEnabled,t.statistics=te(t.statistics);const r=BO(t.layer,h_);if(t.layer=r,!r)throw new k("type-renderer:invalid-parameters","'layer' must be one of these types: "+UO(h_).join(", "));const i=_(t.signal)?{signal:t.signal}:null;await r.load(i);const n=r.geometryType;if(t.outlineOptimizationEnabled=n==="polygon"&&t.outlineOptimizationEnabled,t.sizeOptimizationEnabled=(n==="point"||n==="multipoint"||n==="polyline")&&t.sizeOptimizationEnabled,n==="mesh")t.symbolType="3d-volumetric",t.colorMixMode=t.colorMixMode||"replace",t.edgesType=t.edgesType||"none";else{if(t.symbolType==="3d-volumetric-uniform"&&n!=="point")throw new k("type-renderer:not-supported","3d-volumetric-uniform symbols are supported for point layers only");if(t.symbolType.includes("3d-volumetric")&&(!t.view||t.view.type!=="3d"))throw new k("type-renderer:invalid-parameters","'view' parameter should be an instance of SceneView when 'symbolType' parameter is '3d-volumetric' or '3d-volumetric-uniform'")}const s=await _w({field:t.field,valueExpression:t.valueExpression}),a=LMt(r,s,"type-renderer:invalid-parameters");if(a)throw a;return t}async function nPt(e){let t=e.typeScheme,r=null,i=null;const n=await NMt(e.basemap,e.view);if(r=_(n.basemapId)?n.basemapId:null,i=_(n.basemapTheme)?n.basemapTheme:null,t)return{scheme:e$e(t),basemapId:r,basemapTheme:i};const s=ZMt({basemap:r,basemapTheme:i,geometryType:e.geometryType,theme:e.theme,worldScale:e.worldScale,view:e.view});return s&&(t=s.primaryScheme,r=s.basemapId,i=s.basemapTheme),{scheme:t,basemapId:r,basemapTheme:i}}function t$e(e,t){let r;return r=e.label<t.label?-1:e.label>t.label?1:0,r}function r$e(e,t){let r;return r=e.value<t.value?-1:e.value>t.value?1:0,r}function sPt(e,t){let r=t.count-e.count;return r===0&&(r=t$e(e,t)),r}function aPt(e,t){let r=t.count-e.count;return r===0&&(r=r$e(e,t)),r}function oPt(e,t,r){let i;t==="count"?(i=aPt,r&&r.codedValues&&(i=sPt)):t==="value"&&(i=r$e,r&&r.codedValues&&(i=t$e)),i&&e.sort(i)}async function lPt(e,t,r,i){const n=await ere("esri/smartMapping/t9n/smartMapping"),s=e.uniqueValueInfos,a=t.layer,o=t.field,l=o?a.getField(o):null,c=l?a.getFieldDomain(l.name):null,u=t.numTypes===-1?s.length:t.numTypes,h=a.geometryType,p=await nPt({basemap:t.basemap,geometryType:h,typeScheme:t.typeScheme,worldScale:t.symbolType.includes("3d-volumetric"),view:t.view}),m=p.scheme,g=new bz({field:o});let b,w=-1;const v={value:null,domain:c,fieldInfo:l};if(s.forEach((I,L)=>{v.value=I.value,I.label=bue(v),I.value===null&&(w=L)}),w>-1&&(b=s.splice(w,1)[0]),t.sortEnabled!==!1&&oPt(s,t.sortBy,c),l&&l.type===rPt){const I=s.filter((L,V)=>V<u).map(L=>L.value);v.dateFormatInterval=gQe(I)}const x=r&&r.opacity;let T=W1e(m.colors,s.length);const E=IMt(m,h),C=$Mt(m,h,x);s.forEach((I,L)=>{v.value=I.value,I.label=bue(v),I.symbol=T$(h,{type:t.symbolType,color:T[L],size:E,outline:C,meshInfo:{colorMixMode:t.colorMixMode,edgesType:t.edgesType}})}),t.valueExpression&&(g.valueExpression=t.valueExpression,g.valueExpressionTitle=t.valueExpressionTitle),t.legendOptions&&(g.legendOptions=new nm(t.legendOptions)),T=W1e(m.colors,u);for(let I=0;I<u;I++){const L=s[I];L&&g.addUniqueValueInfo({value:L.value,label:L.label,symbol:T$(h,{type:t.symbolType,color:T[I],size:E,outline:C,meshInfo:{colorMixMode:t.colorMixMode,edgesType:t.edgesType}})})}t.defaultSymbolEnabled&&(g.defaultSymbol=T$(h,{type:t.symbolType,color:m.noDataColor,size:E,outline:C,meshInfo:{colorMixMode:t.colorMixMode,edgesType:t.edgesType}}),g.defaultLabel=n.other),b&&(b.symbol=T$(h,{type:t.symbolType,color:m.noDataColor,size:E,outline:C,meshInfo:{colorMixMode:t.colorMixMode,edgesType:t.edgesType}}),s.push(b));const A=[],P=g.uniqueValueInfos.length===s.length?-1:g.uniqueValueInfos.length;if(P>-1)for(let I=P;I<s.length;I++)A.push({...s[I]});return r&&r.visualVariables&&r.visualVariables.length&&(g.visualVariables=r.visualVariables.map(I=>I.clone())),i&&i.minSize&&(g.visualVariables?g.visualVariables.push(i.minSize):g.visualVariables=[i.minSize]),{renderer:g,uniqueValueInfos:s,excludedUniqueValueInfos:A,typeScheme:e$e(m),basemapId:p.basemapId,basemapTheme:p.basemapTheme}}async function cPt(e){const t=await iPt(e),{layer:r,view:i,signal:n}=t,s={layer:r,field:t.field,valueExpression:t.valueExpression,returnAllCodedValues:t.returnAllCodedValues,view:i,signal:n},[a,o,l]=await Promise.all([t.statistics!=null?t.statistics:VMt(s),t.outlineOptimizationEnabled?rMt({layer:r,view:i,signal:n}):null,t.sizeOptimizationEnabled?AMt({layer:r,view:i,signal:n}):null]);return lPt(a,t,o,l)}const dPt=async(e,t)=>{const r={title:"Job Opportunities",content:[{type:"fields",fieldInfos:[{fieldName:"NAME",label:"Zone Name"},{fieldName:"ZN_CODE",label:"Zone Code"}]}]},i=new doe({url:"./ZoningDistrict.json",title:"Job Opportunities",id:"FallsChurch_JobOpportunities",opacity:1,popupTemplate:r});await cPt({layer:i,view:t,field:"NAME",legendOptions:{title:"Zoning Type"}}).then(s=>{console.log("COLOR[0]:",JSON.stringify(s.uniqueValueInfos[0].symbol.color)),console.log("COLOR[1]:",JSON.stringify(s.uniqueValueInfos[1].symbol.color)),i.renderer=s.renderer,e.add(i)}).catch(s=>{console.error("there was an error: ",s)})};var Ioe={exports:{}},oB={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var uPt=v5.exports,hPt=Symbol.for("react.element"),fPt=Symbol.for("react.fragment"),pPt=Object.prototype.hasOwnProperty,mPt=uPt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,gPt={key:!0,ref:!0,__self:!0,__source:!0};function i$e(e,t,r){var i,n={},s=null,a=null;r!==void 0&&(s=""+r),t.key!==void 0&&(s=""+t.key),t.ref!==void 0&&(a=t.ref);for(i in t)pPt.call(t,i)&&!gPt.hasOwnProperty(i)&&(n[i]=t[i]);if(e&&e.defaultProps)for(i in t=e.defaultProps,t)n[i]===void 0&&(n[i]=t[i]);return{$$typeof:hPt,type:e,key:s,ref:a,props:n,_owner:mPt.current}}oB.Fragment=fPt;oB.jsx=i$e;oB.jsxs=i$e;(function(e){e.exports=oB})(Ioe);const LR=Ioe.exports.jsx,yPt=Ioe.exports.jsxs,bPt=()=>LR("h1",{className:"App__title",children:"Falls Church - Job Opportunities"});function vPt(){const[e,t]=v5.exports.useState(!1);v5.exports.useEffect(()=>{r().then(()=>{t(!0)})},[]);const r=async()=>{try{const i=new Wwe({basemap:"dark-gray-vector"}),n=new t7t({map:i,container:"mapContainer",camera:{position:[-77.1701,38.8553,3750],tilt:40}});ERt(n),await h7t(i),await V7t(i),await dPt(i,n);const s=new hRt({view:n,layerInfos:[{layer:i.findLayerById("Jurisdictional_Boundary")},{layer:i.findLayerById("FallsChurch_JobOpportunities")},{layer:i.findLayerById("osm3D_BuildingsLayer")}]});n.ui.add(s,"bottom-left")}catch(i){console.error(i)}};return yPt("div",{className:"App",children:[LR("main",{id:"mapContainer",className:"mapContainer"}),LR(bPt,{})]})}const _Pt=document.getElementById("root");eW.createRoot(_Pt).render(LR(I$e.StrictMode,{children:LR(vPt,{})}));export{hwt as $,BLt as A,U5 as B,lgt as C,Fy as D,Zn as E,lt as F,Yn as G,Hh as H,LLt as I,jLt as J,nLt as K,Y5 as L,sLt as M,Fw as N,aLt as O,MV as P,W5 as Q,c8e as R,kp as S,bxe as T,ti as U,iLt as V,mn as W,ILt as X,Oje as Y,ac as Z,gm as _,Y0 as a,ZPe as a$,nyt as a0,Tu as a1,Et as a2,_te as a3,ue as a4,SIt as a5,fe as a6,tf as a7,Da as a8,Z5 as a9,tRe as aA,dn as aB,vs as aC,NPt as aD,ou as aE,Ra as aF,jv as aG,Vi as aH,fp as aI,td as aJ,ne as aK,Ss as aL,he as aM,le as aN,ot as aO,eu as aP,cP as aQ,PLt as aR,Ede as aS,CLt as aT,ayt as aU,OV as aV,mm as aW,TPt as aX,Sx as aY,fwt as aZ,sae as a_,nit as aa,vt as ab,bi as ac,Dre as ad,oe as ae,um as af,Eu as ag,M as ah,is as ai,Ly as aj,Zt as ak,d9 as al,Qt as am,zLt as an,l9 as ao,VLt as ap,JLt as aq,yae as ar,kLt as as,NLt as at,Fa as au,rn as av,y6 as aw,bt as ax,Ts as ay,k as az,_re as b,O as b$,Wh as b0,bz as b1,xs as b2,X9 as b3,zt as b4,DOe as b5,EIt as b6,ZDt as b7,mi as b8,zV as b9,v8e as bA,I5 as bB,Cs as bC,aE as bD,Ye as bE,FIt as bF,eO as bG,pn as bH,mLt as bI,Cxe as bJ,vc as bK,q2e as bL,pu as bM,gx as bN,uu as bO,jat as bP,yLt as bQ,rSt as bR,aDt as bS,xR as bT,Cm as bU,XR as bV,su as bW,$p as bX,Uc as bY,KR as bZ,Gi as b_,uLt as ba,Oy as bb,Axe as bc,nw as bd,tde as be,Rxe as bf,$wt as bg,Ar as bh,OPt as bi,b2e as bj,g2e as bk,ie as bl,xr as bm,je as bn,Ee as bo,yr as bp,vi as bq,bp as br,fn as bs,qt as bt,et as bu,ci as bv,Ek as bw,Be as bx,USe as by,Y1 as bz,tm as c,Xwe as c$,qR as c0,sw as c1,dV as c2,Yr as c3,Fo as c4,bs as c5,br as c6,sr as c7,Hn as c8,xt as c9,ai as cA,Ur as cB,jt as cC,eb as cD,Mz as cE,w_ as cF,fc as cG,Kz as cH,or as cI,xm as cJ,d_ as cK,T_ as cL,rU as cM,Mo as cN,Dm as cO,eU as cP,Yz as cQ,sx as cR,yU as cS,mbt as cT,ose as cU,S6 as cV,GAe as cW,Dn as cX,BV as cY,ys as cZ,l9t as c_,ji as ca,D9 as cb,hLt as cc,aL as cd,mx as ce,Vxt as cf,Qr as cg,_u as ch,no as ci,_r as cj,sSe as ck,S as cl,Cn as cm,Mu as cn,Wt as co,He as cp,K as cq,ok as cr,$m as cs,yt as ct,si as cu,Im as cv,Re as cw,H as cx,pi as cy,gi as cz,f as d,$Dt as d$,nIt as d0,NUe as d1,m9t as d2,Jrt as d3,$K as d4,A5 as d5,cc as d6,WNe as d7,$e as d8,$i as d9,tb as dA,JOe as dB,iV as dC,Aw as dD,lje as dE,ze as dF,cy as dG,gqe as dH,Ae as dI,Wi as dJ,Xut as dK,LDt as dL,yDt as dM,DDt as dN,Ase as dO,e9 as dP,toe as dQ,ODt as dR,EDt as dS,CDt as dT,SDt as dU,xX as dV,J7e as dW,vd as dX,K9t as dY,TDt as dZ,G5t as d_,tLt as da,Vhe as db,hd as dc,y8e as dd,PN as de,f7t as df,Lne as dg,T7t as dh,I3 as di,ch as dj,wC as dk,TC as dl,oit as dm,bne as dn,pO as dp,_x as dq,Ze as dr,tr as ds,$ne as dt,F2e as du,TV as dv,ide as dw,hu as dx,$xe as dy,ed as dz,d as e,S9t as e$,j5t as e0,NIt as e1,Wye as e2,f5 as e3,dw as e4,Zi as e5,nje as e6,Jh as e7,yy as e8,VIt as e9,ym as eA,Jt as eB,cIt as eC,rie as eD,Oe as eE,NDt as eF,FDt as eG,$u as eH,ri as eI,bLt as eJ,L5 as eK,ui as eL,kDt as eM,U5t as eN,zPt as eO,dDt as eP,Fh as eQ,te as eR,Ate as eS,DPt as eT,rR as eU,aA as eV,Du as eW,FLt as eX,zCe as eY,hp as eZ,ygt as e_,Tr as ea,ws as eb,Op as ec,_Dt as ed,p9t as ee,Nje as ef,o9t as eg,ew as eh,IDt as ei,ei as ej,r6 as ek,PDt as el,Nt as em,g6e as en,y6e as eo,DLt as ep,MDt as eq,xDt as er,D6 as es,wDt as et,jre as eu,yA as ev,Pre as ew,oG as ex,Le as ey,$r as ez,ct as f,G5e as f$,E9t as f0,gDt as f1,fv as f2,mqe as f3,Vs as f4,fi as f5,Se as f6,fl as f7,pe as f8,fm as f9,dc as fA,yx as fB,kie as fC,r7t as fD,AZe as fE,H5 as fF,_l as fG,Gie as fH,Ry as fI,yJe as fJ,tIt as fK,l4 as fL,zC as fM,Ov as fN,Ow as fO,Sde as fP,RZe as fQ,QRt as fR,M$t as fS,Nue as fT,I$t as fU,iIt as fV,V3e as fW,Eke as fX,x$t as fY,q5e as fZ,W5e as f_,WL as fa,H0 as fb,g9t as fc,Jfe as fd,vDt as fe,ede as ff,fLt as fg,Gxt as fh,HDe as fi,VPt as fj,Xh as fk,Hje as fl,Wje as fm,R7t as fn,Xe as fo,ge as fp,Ije as fq,wte as fr,bSe as fs,nVe as ft,uVe as fu,iw as fv,X5e as fw,jwe as fx,Qte as fy,HPt as fz,co as g,ii as g$,Toe as g0,MUe as g1,WRt as g2,kIe as g3,$7 as g4,ZRt as g5,y5 as g6,zIe as g7,yee as g8,KRt as g9,IPt as gA,oDt as gB,yIt as gC,xV as gD,N5e as gE,MLt as gF,Mi as gG,pw as gH,wne as gI,__ as gJ,qbt as gK,wu as gL,Dt as gM,as as gN,L0 as gO,hn as gP,Pr as gQ,mt as gR,Ue as gS,gt as gT,At as gU,tt as gV,Pi as gW,Tl as gX,at as gY,xl as gZ,Qe as g_,XRt as ga,Ymt as gb,Bwe as gc,Hze as gd,eIt as ge,VIe as gf,l6 as gg,c6 as gh,P5e as gi,RLt as gj,Krt as gk,cit as gl,AFe as gm,WDt as gn,dIt as go,sIt as gp,oIt as gq,aIt as gr,lIt as gs,cA as gt,Uh as gu,FUe as gv,RAe as gw,sgt as gx,OLt as gy,_It as gz,Ot as h,Jv as h$,io as h0,Dy as h1,gn as h2,hH as h3,vr as h4,FN as h5,v_ as h6,Zz as h7,TLt as h8,it as h9,F6e as hA,bx as hB,Mm as hC,M5 as hD,Xce as hE,Lu as hF,xQe as hG,wQe as hH,Ud as hI,DIt as hJ,MPt as hK,Dv as hL,oy as hM,ZM as hN,bre as hO,yre as hP,vre as hQ,C5e as hR,KPt as hS,G3 as hT,hDt as hU,fDt as hV,xIt as hW,_Be as hX,s3 as hY,uDt as hZ,dk as h_,ur as ha,ZTe as hb,zIt as hc,BSe as hd,Y$t as he,J9 as hf,T$t as hg,EPt as hh,oa as hi,_ae as hj,lc as hk,Jr as hl,z$ as hm,bV as hn,LPt as ho,JPt as hp,P$t as hq,J$t as hr,v3e as hs,Rw as ht,nK as hu,HR as hv,qh as hw,cHe as hx,G7t as hy,y1e as hz,N5 as i,hw as i$,Ei as i0,fy as i1,tc as i2,bd as i3,Ky as i4,La as i5,ft as i6,CIt as i7,iO as i8,Mr as i9,eFt as iA,KDt as iB,QDt as iC,k5 as iD,uo as iE,yd as iF,ow as iG,lV as iH,Cy as iI,VV as iJ,b9t as iK,Wre as iL,bDt as iM,Kke as iN,jMe as iO,Ve as iP,p2e as iQ,B$ as iR,O5 as iS,USt as iT,$Ct as iU,ZY as iV,wn as iW,YY as iX,JY as iY,YF as iZ,Aje as i_,Er as ia,Io as ib,Mxe as ic,pDt as id,mDt as ie,Lre as ig,lqe as ih,NV as ii,SLt as ij,ns as ik,dr as il,Cr as im,QLt as io,ADt as ip,RDt as iq,x5e as ir,LE as is,SSe as it,OFe as iu,VN as iv,_M as iw,cDt as ix,Vye as iy,lDt as iz,Tx as j,PIt as j$,LV as j0,U0 as j1,rDt as j2,sDt as j3,KOe as j4,_ye as j5,tDt as j6,iDt as j7,eDt as j8,E7 as j9,kw as jA,bu as jB,kIt as jC,XIt as jD,YIt as jE,Xne as jF,yX as jG,Ope as jH,kt as jI,Q0 as jJ,uTe as jK,PGe as jL,Y4 as jM,Rje as jN,cr as jO,ka as jP,ki as jQ,lA as jR,qLt as jS,twe as jT,YPt as jU,ps as jV,OIt as jW,RIt as jX,UGe as jY,VGe as jZ,ere as j_,wL as ja,GTt as jb,nf as jc,XPt as jd,gse as je,ul as jf,bye as jg,vTt as jh,_Tt as ji,dLt as jj,gO as jk,cLt as jl,Xt as jm,Fn as jn,Sh as jo,p$t as jp,zs as jq,vN as jr,oR as js,OVe as jt,QIt as ju,Lje as jv,Dje as jw,we as jx,dt as jy,P9 as jz,y7 as k,Bht as k$,IIt as k0,LIt as k1,$It as k2,q0 as k3,DA as k4,ro as k5,KV as k6,a$t as k7,o$t as k8,l$t as k9,aie as kA,r9 as kB,di as kC,YC as kD,qV as kE,Lw as kF,KIt as kG,JIt as kH,xot as kI,Cot as kJ,XY as kK,Su as kL,tn as kM,Zne as kN,tBe as kO,qe as kP,Kn as kQ,ZIt as kR,Cqe as kS,xre as kT,Eh as kU,Qce as kV,Fse as kW,Om as kX,Ma as kY,Kl as kZ,uw as k_,c$t as ka,Ln as kb,rb as kc,gl as kd,Nae as ke,Oxt as kf,R4 as kg,dK as kh,cx as ki,Nr as kj,OS as kk,KTe as kl,Na as km,As as kn,Wl as ko,mV as kp,Gv as kq,Kf as kr,us as ks,wEe as kt,got as ku,Yne as kv,Qc as kw,W4 as kx,ME as ky,By as kz,Te as l,ZPt as l$,xLt as l0,_Lt as l1,wLt as l2,qIt as l3,mEt as l4,R5 as l5,QW as l6,ugt as l7,gLt as l8,N3 as l9,nie as lA,Rn as lB,Lge as lC,$A as lD,pLt as lE,gIt as lF,UIt as lG,op as lH,Ou as lI,bU as lJ,Hi as lK,wl as lL,pl as lM,kr as lN,Us as lO,Y7e as lP,GIt as lQ,T0t as lR,Ru as lS,du as lT,aqe as lU,Np as lV,iAe as lW,O9 as lX,$5 as lY,tae as lZ,DV as l_,pd as la,MIt as lb,ni as lc,qfe as ld,Tte as le,qg as lf,qCe as lg,Cx as lh,sie as li,pIt as lj,HIt as lk,vIt as ll,jfe as lm,Rm as ln,Qre as lo,VTe as lp,pm as lq,Li as lr,_m as ls,St as lt,ao as lu,tU as lv,Qz as lw,pt as lx,Zr as ly,TIt as lz,i6 as m,tse as m$,UDe as m0,WIt as m1,iB as m2,JF as m3,ACt as m4,VDt as m5,UDt as m6,zDt as m7,sre as m8,xte as m9,eje as mA,rm as mB,hV as mC,i$t as mD,e$t as mE,b4e as mF,eXe as mG,X6e as mH,Ane as mI,t8e as mJ,vz as mK,BTt as mL,rA as mM,Ex as mN,Tne as mO,qL as mP,PPt as mQ,nrt as mR,FPt as mS,jw as mT,Zrt as mU,jPt as mV,Wet as mW,TUe as mX,GDt as mY,BDt as mZ,BEe as m_,bIt as ma,m2 as mb,Gfe as mc,_0 as md,Z9 as me,bA as mf,lie as mg,J5 as mh,mIt as mi,wft as mj,cie as mk,xTe as ml,Q5 as mm,cge as mn,md as mo,fqe as mp,b_ as mq,Hqe as mr,Iy as ms,WV as mt,Glt as mu,BIt as mv,KLt as mw,sV as mx,Ax as my,Cu as mz,$ as n,Xc as n$,GEe as n0,qy as n1,rd as n2,Nn as n3,Au as n4,PO as n5,RTe as n6,Es as n7,RU as n8,gje as n9,uIt as nA,Cze as nB,ALt as nC,XZ as nD,ELt as nE,ic as nF,QQe as nG,_rt as nH,pUe as nI,LQe as nJ,$$t as nK,qQe as nL,Cue as nM,$5e as nN,O$t as nO,uGe as nP,Q$t as nQ,qY as nR,DG as nS,FG as nT,ZW as nU,zDe as nV,CPt as nW,APt as nX,tu as nY,b$t as nZ,RPt as n_,g9 as na,XLt as nb,c_ as nc,HLt as nd,YLt as ne,WLt as nf,Wvt as ng,Qvt as nh,Xvt as ni,Yvt as nj,Zvt as nk,F5e as nl,I5e as nm,v$t as nn,R$t as no,A$t as np,D5e as nq,s8e as nr,Bie as ns,jDt as nt,Z5e as nu,Y5e as nv,E$t as nw,S$t as nx,hIt as ny,fIt as nz,Yce as o,Gw as o$,C$t as o0,dz as o1,$Me as o2,Dr as o3,Ny as o4,gu as o5,nv as o6,kne as o7,vp as o8,ooe as o9,W9 as oA,qPt as oB,$M as oC,cG as oD,CBe as oE,s$t as oF,r$t as oG,n$t as oH,t$t as oI,Xl as oJ,Yl as oK,Co as oL,fd as oM,Pm as oN,EL as oO,AA as oP,cne as oQ,EN as oR,jn as oS,gtt as oT,Iv as oU,ll as oV,ptt as oW,Qh as oX,ctt as oY,stt as oZ,ntt as o_,jIt as oa,Tqe as ob,wPt as oc,hke as od,iA as oe,Gte as of,xPt as og,nDt as oh,Hc as oi,Ste as oj,vye as ok,es as ol,Bs as om,z as on,fh as oo,pZ as op,fN as oq,Xi as or,S2e as os,j4 as ot,O3e as ou,BPt as ov,jR as ow,Vr as ox,zh as oy,uV as oz,p9 as p,h$t as p$,Kd as p0,t6e as p1,BJe as p2,Jet as p3,ttt as p4,ar as p5,e6e as p6,mu as p7,mtt as p8,dtt as p9,W$t as pA,ett as pB,Ket as pC,rtt as pD,itt as pE,p4 as pF,PMe as pG,f5t as pH,HOt as pI,jrt as pJ,COt as pK,ud as pL,c1e as pM,tre as pN,jDe as pO,WPt as pP,la as pQ,UZe as pR,xA as pS,hJ as pT,lLt as pU,yO as pV,tFt as pW,BZe as pX,IZe as pY,y$t as pZ,f$t as p_,Ox as pa,fre as pb,ytt as pc,btt as pd,vtt as pe,one as pf,wtt as pg,_tt as ph,xtt as pi,j3e as pj,CA as pk,Xet as pl,ftt as pm,utt as pn,att as po,Ptt as pp,Rtt as pq,Att as pr,j$t as ps,Ott as pt,Mtt as pu,ott as pv,ltt as pw,htt as px,Ett as py,Zie as pz,wrt as q,I3t as q$,d$t as q0,d4 as q1,LZe as q2,u$t as q3,PZe as q4,MZe as q5,ZR as q6,y1t as q7,m$t as q8,g$t as q9,hk as qA,Uyt as qB,ePe as qC,a6t as qD,ioe as qE,l8t as qF,hPe as qG,u8t as qH,fPe as qI,f8t as qJ,pPe as qK,A8t as qL,QU as qM,D8t as qN,j8t as qO,jte as qP,Ute as qQ,Hvt as qR,Gu as qS,GLt as qT,hbt as qU,O8t as qV,aEt as qW,ovt as qX,Kvt as qY,m3t as qZ,k3t as q_,Bot as qa,oct as qb,lCe as qc,jct as qd,fdt as qe,bse as qf,ydt as qg,Fdt as qh,Hdt as qi,mmt as qj,lk as qk,Xbt as ql,Kbt as qm,kbt as qn,Ns as qo,Ia as qp,CSt as qq,dPe as qr,N6t as qs,Hct as qt,Ygt as qu,Fbt as qv,OSt as qw,RSt as qx,VU as qy,MSt as qz,_ as r,Gt as r$,Y6e as r0,Rne as r1,n8e as r2,vxe as r3,_ie as r4,w7t as r5,U6e as r6,vl as r7,C3e as r8,U9 as r9,a8e as rA,Z6e as rB,Yit as rC,p6 as rD,Xr as rE,l6e as rF,nm as rG,a6e as rH,o6e as rI,h6e as rJ,nQe as rK,Ytt as rL,sQe as rM,b6e as rN,E6e as rO,RN as rP,kPt as rQ,s6e as rR,ON as rS,Qrt as rT,My as rU,rIt as rV,rs as rW,$Pt as rX,Dw as rY,wIt as rZ,Zg as r_,S7t as ra,rLt as rb,Ene as rc,CV as rd,Xv as re,s7t as rf,dUe as rg,lUe as rh,Uze as ri,Lce as rj,Do as rk,sA as rl,Cne as rm,Sne as rn,yc as ro,bc as rp,PV as rq,nc as rr,bm as rs,We as rt,n7 as ru,JW as rv,LG as rw,POt as rx,OOt as ry,aNe as rz,Kt as s,yne as s$,XDt as s0,dx as s1,Mte as s2,hm as s3,uS as s4,b8e as s5,g6 as s6,fO as s7,jc as s8,Ine as s9,K$t as sA,cd as sB,Tp as sC,UPt as sD,Vxe as sE,lit as sF,eLt as sG,zNe as sH,nce as sI,N as sJ,AIt as sK,OSe as sL,Bqe as sM,Eo as sN,Sat as sO,Z$t as sP,IN as sQ,tst as sR,x3 as sS,Qnt as sT,X2 as sU,Ez as sV,Sz as sW,L$t as sX,zne as sY,P6e as sZ,Art as s_,YDt as sa,bF as sb,o7 as sc,WY as sd,Q6e as se,e8e as sf,G5 as sg,Tre as sh,g8e as si,PA as sj,mO as sk,xne as sl,K8e as sm,cm as sn,lm as so,ml as sp,JDt as sq,hxe as sr,D3e as ss,SPt as st,L6e as su,gne as sv,uit as sw,dit as sx,Y9 as sy,nTe as sz,R as t,vLt as t$,I6e as t0,Crt as t1,y_t as t2,pK as t3,Fit as t4,Nit as t5,kit as t6,G$t as t7,bhe as t8,D$t as t9,GPt as tA,mOe as tB,yOe as tC,M3 as tD,w7 as tE,QPt as tF,pae as tG,C_t as tH,dOe as tI,__t as tJ,pOe as tK,hOe as tL,E_t as tM,ca as tN,mK as tO,pc as tP,fOe as tQ,r_ as tR,w_t as tS,t_ as tT,iK as tU,Jw as tV,dyt as tW,e2t as tX,K_t as tY,J_t as tZ,ef as t_,yhe as ta,Stt as tb,B$t as tc,H$t as td,q$t as te,Bw as tf,N$t as tg,F$t as th,k$t as ti,V$t as tj,U$t as tk,Qet as tl,_he as tm,z$t as tn,Ttt as to,gz as tp,i6e as tq,n6e as tr,Tm as ts,Ult as tt,Jje as tu,Zje as tv,X0 as tw,nOe as tx,Ote as ty,Plt as tz,Ft as u,bT as u0,Z3e as u1,_$t as u2,w$t as u3,X$t as u4,oLt as u5,$Lt as u6,ZLt as u7,qDt as u8,HDt as u9,$o as v,Ui as w,re as x,xe as y,ULt as z};
